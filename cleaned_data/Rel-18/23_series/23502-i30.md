# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document defines the Stage 2 procedures and Network Function
Services for the 5G system architecture which is described in the TS 23.501
[2] and for the policy and charging control framework which is described in TS
23.503 [20].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] IETF RFC 7296: _\"_ Internet Key Exchange Protocol Version 2 (IKEv2)_\"._
[4] Void.
[5] Void.
[6] IETF RFC 4861: \"Neighbor Discovery for IP version 6 (IPv6)\".
[7] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[8] IETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
[9] 3GPP TS 38.300: \"NR and NG-RAN Overall Description; Stage 2\".
[10] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[11] Void.
[12] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
Specification\".
[13] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[14] Void.
[15] 3GPP TS 33.501: \"Security Architecture and Procedures for 5G System\".
[16] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[17] 3GPP TS 29.500: \"5G System; Technical Realization of Service Based
Architecture; Stage 3\".
[18] 3GPP TS 29.518: \"5G System; Access and Mobility Management Services;
Stage 3\".
[19] Void.
[20] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System
\".
[21] IETF RFC 4191: \"Default Router Preferences and More-Specific Routes\".
[22] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station in idle mode\".
[23] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
with packet data networks and applications\".
[24] 3GPP TS 23.203: \"Policy and charging control architecture\".
[25] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[26] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[27] Void.
[28] 3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".
[29] Void.
[30] Void.
[31] Void.
[32] 3GPP TS 29.507: \"Access and Mobility Policy Control Service; Stage 3\".
[33] 3GPP TS 23.003: \"Numbering, Addressing and Identification\".
[34] Void.
[35] 3GPP TS 23.251: \"Network sharing; Architecture and functional
description\".
[36] 3GPP TS 29.502: \"5G System; Session Management Services; Stage 3\".
[37] 3GPP TS 29.510: \"5G System; Network function repository services; Stage
3\".
[38] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[39] 3GPP TS 32.421: \"Telecommunication management; Subscriber and equipment
trace; Trace concepts and requirements\".
[40] IETF RFC 4555: \"IKEv2 Mobility and Multihoming Protocol (MOBIKE)\".
[41] 3GPP TS 24.502: \"Access to the 3GPP 5G Core Network (5GCN) via Non-3GPP
Access Networks (N3AN); Stage 3\".
[42] 3GPP TS 32.290: \"Services, operations and procedures of charging using
Service Based Interface (SBI)\".
[43] 3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) procedures in idle mode\".
[44] 3GPP TS 38.304: \"NR; User Equipment (UE) procedures in idle mode\".
[45] 3GPP TS 32.255: \"5G system; 5G data connectivity domain charging; Stage
2\".
[46] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall
description; Stage 2\".
[47] 3GPP TS 29.513: \"5G System; Policy and Charging Control signalling flows
and QoS parameter mapping; Stage 3\".
[48] IEEE Std 802.11-2016 (Revision of IEEE Std 802.11-2012): \"IEEE Standard
for Information technology - Telecommunications and information exchange
between systems Local and metropolitan area networks - Specific requirements -
Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY)
Specifications\".
[49] IETF RFC 2410: \"The NULL Encryption Algorithm and its use with IPsec\".
[50] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
support network data analytics services; Stage 2\".
[51] 3GPP TS 23.273: \"5G System (5GS) Location Services (LCS); Stage 2\".
[52] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".
[53] 3GPP TS 23.316: \"Wireless and wireline convergence access support for
the 5G System (5GS)\".
[54] 3GPP TS 23.222: \"Functional architecture and information flows to
support Common API Framework for 3GPP Northbound APIs; Stage 2\".
[55] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[56] 3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Medium Access Control (MAC) protocol specification\".
[57] 3GPP TS 29.512: \"5G System; Session Management Policy Control Service;
Stage 3\".
[58] 3GPP TS 29.525: \"5G System; UE Policy Control Service; Stage 3\".
[59] IETF RFC 6696: \"EAP Extensions for the EAP Re-authentication Protocol
(ERP)\", July 2012.
[60] IETF RFC 5295: \"Specification for the Derivation of Root Keys from an
Extended Master Session Key (EMSK)\", Aug. 2008.
[61] 3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System
(EPS); Stage 2\".
[62] 3GPP TS 29.501: \"5G System; Principles and Guidelines for Services
Definition; Stage 3\".
[63] 3GPP TS 29.561: \"5G System; Interworking between 5G Network and external
Data Networks; Stage 3\".
[64] 3GPP TS 29.413: \"Application of the NG Application Protocol (NGAP) to
non-3GPP access\".
[65] Void.
[66] IEEE Std 802.1Q-2022: \"IEEE Standard for Local and Metropolitan Area
Networks-Bridges and Bridged Networks\".
[67] Void.
[68] 3GPP TS 23.632: \"User Data Interworking, Coexistence and Migration\".
[69] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
nodes\".
[70] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces; Stage 3\".
[71] 3GPP TS 32.256: \"Charging Management; 5G connection and mobility domain
charging; Stage 2\".
[72] 3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\".
[73] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to
support Vehicle-to-Everything (V2X) services\".
[74] 3GPP TS 23.548: \"5G System Enhancements for Edge Computing; Stage 2\".
[75] IEEE Std 802.1AS-2020: \"IEEE Standard for Local and metropolitan area
networks--Timing and Synchronization for Time-Sensitive Applications\".
[76] IEEE Std 1588-2019: \"IEEE Standard for a Precision Clock Synchronization
Protocol for Networked Measurement and Control\".
[77] 3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System
(5GS)\".
[78] 3GPP TS 23.247: \"Architectural enhancements for 5G multicast-broadcast
services\".
[79] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[80] 3GPP TS 23.256: \"Support of Uncrewed Aerial Systems (UAS) connectivity,
identification and tracking; Stage 2\".
[81] 3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC); Stage 2\".
[82] 3GPP TS 29.519: \"5G System; Usage of the Unified Data Repository service
for Policy Data, Application Data and Structure Data for Exposure; Stage 3\".
[83] 3GPP TS 23.558: \"Architecture for enabling Edge Applications\".
[84] 3GPP TS 23.540: \"Technical realization of Service Based Short Message
Service; Stage 2\".
[85] 3GPP TS 29.598: \"Unstructured data storage services\".
[86] 3GPP TS 23.041: \"Technical realization of Cell Broadcast Service
(CBS)\".
[87] 3GPP TS 29.522: \"5G System; Network Exposure Function Northbound APIs;
Stage 3\".
[88] 3GPP TS 23.586: \"Architectural Enhancements to support Ranging based
services and Sidelink Positioning\".
[89] 3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1], TS 23.501 [2] and TS 23.503 [20] apply. A term defined in TS
23.501 [2] or TS 23.503 [20] takes precedence over the definition of the same
term, if any, in any other specifications.
**Multi-member AF session:** A type of AF session (see definition in TS 29.214
[89]) in which the AF establishes an application level session with a set of
UEs. A Multi-member AF session can only be established via a supporting NEF
(even for the trusted AF scenario). Such NEF associates the Multi-member AF
session with one or more AF sessions (one AF session per UE in the set), in
order to interact with each UE\'s serving PCF on a per AF session basis.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1], TS 23.501 [2] and TS 23.503 [20] apply. An abbreviation defined in TS
23.501 [2] or TS 23.503 [20] takes precedence over the definition of the same
abbreviation, if any, in any other specifications.
# 4 System procedures
## 4.1 General
The clause 4 describes the procedures and Network Function services for the
5GS by end-to-end information flows and these information flows make use of NF
service operations, defined in clause 5, for the communication within the 5GC
Control Plane.
## 4.2 Connection, Registration and Mobility Management procedures
### 4.2.1 General
The Connection Management is used to establish and release the Control Plane
signalling connection between the UE and the AMF. The Registration Management
is used to register or deregister a UE/user with the 5GS and establish the
user context in the 5GS. The Mobility Management functions are used to keep
track of the current location of a UE. The procedures in clause 4.2 provides
Connection, Registration and Mobility Management functionality.
### 4.2.2 Registration Management procedures
#### 4.2.2.1 General
The Registration and Deregistration procedures in clause 4.2.2 provides the
required functionality to register or deregister a UE/user with the 5GS.
Additional functionality to support Registration Management for non-3GPP
access is defined in clause 4.12. Additional functionality to support
Registration Management for specific services such as SMS over NAS is defined
in clause 4.13.
#### 4.2.2.2 Registration procedures
##### 4.2.2.2.1 General
A UE needs to register with the network to get authorized to receive services,
to enable mobility tracking and to enable reachability. The UE initiates the
Registration procedure using one of the following Registration types:
\- Initial Registration to the 5GS;
\- Mobility Registration Update upon changing to a new Tracking Area (TA)
outside the UE\'s Registration Area in both CM-CONNECTED and CM-IDLE state, or
when the UE needs to update its capabilities or protocol parameters that are
negotiated in Registration procedure with or without changing to a new TA, or
a change in the UE\'s Preferred Network Behaviour that would create an
incompatibility with the Supported Network Behaviour provided by the serving
AMF, or when the UE intends to retrieve LADN Information, or with NR satellite
access upon changing to a suitable cell indicating multiple TAs for the RPLMN
all of which are outside the UE\'s Registration Area in both CM-CONNECTED and
CM-IDLE state, or when the Multi-USIM UE needs a new 5G-GUTI assignment, or
when the UE needs to indicate or returns from an Unavailability Period (see
clause 5.4.1.4 of TS 23.501 [2]), or when the UE using a RAN that provides
discontinuous coverage (e.g. for satellite access with discontinuous coverage)
is about to leave the satellite network coverage as described in clause
5.4.13.1 of TS 23.501 [2], or when the UE has informed the network it is
unreachable and now returns to coverage using either satellite or terrestrial
access as described in clause 5.4.1.4 of TS 23.501 [2]; or
\- Periodic Registration Update (due to a predefined time period of
inactivity); or
\- Emergency Registration; or
\- Disaster Roaming Initial Registration, as specified in clause 5.40 of TS
23.501 [2]; or
\- Disaster Roaming Mobility Registration Update, as specified in clause 5.40
of TS 23.501 [2]; or
\- SNPN Onboarding Registration allows the UE to access an ON-SNPN for the
purpose of provisioning the UE with SO-SNPN credentials to enable SO-SNPN
access. SNPN Onboarding Registration is only applicable for registration with
ON-SNPN i.e. when the UE uses PLMN credentials for accessing an ONN the UE
initiates an Initial Registration. The SNPN Onboarding Registration is
specified in clause 4.2.2.2.4.
NOTE 1: With NR satellite access, more than one TAC can be indicated to a UE
for each PLMN in any cell.
The General Registration call flow in clause 4.2.2.2.2 applies on all these
Registration procedures, but the periodic registration need not include all
parameters that are used in other registration cases.
The following are the cleartext IEs, as defined in TS 24.501 [25] that can be
sent by the UE in the Registration Request message if the UE has no NAS
security context:
\- Registration type;
\- SUCI or 5G-GUTI or PEI;
\- Security parameters;
\- additional GUTI;
\- 4G Tracking Area Update;
\- the indication that the UE is moving from EPS;
\- PLMN with Disaster Condition;
\- if the UE is registering with an SNPN, the NID of the SNPN that assigned
the 5G-GUTI.
NOTE 2: The NID is provided when the 5G-GUTI is assigned by another SNPN than
the selected SNPN.
Aspects related to dual registration in 3GPP and non-3GPP access are described
in clause 4.12. The general Registration call flow in clause 4.2.2.2.2 is also
used for the case of registration in 3GPP access when the UE is already
registered in a non-3GPP access and vice versa. Registration in 3GPP access
when the UE is already registered in a non-3GPP access scenario may require an
AMF change, as further detailed in clause 4.12.8.
The general Registration call flow in clause 4.2.2.2.2 is also used by UEs in
limited service state (see TS 23.122 [22]) registering for emergency services
only (referred to as Emergency Registration), see clause 5.16.4 of TS 23.501
[2].
During the initial registration the PEI is obtained from the UE. If the PEI is
needed (e.g. for EIR check), the AMF shall retrieve the PEI when it
establishes the NAS security context with a Security Mode Command during
initial registration. The AMF operator may check the PEI with an EIR. If the
PEI was retrieved by the AMF (either from the UE or another AMF), AMF shall
provide it to the UDM using Nudm_UECM_Registration in order to ensure that the
UDM always has the latest PEI available e.g. for reporting event Change of
SUPI-PEI association. The AMF passes the PEI to the UDM, to the SMF and the
PCF. The UDM may store this data in UDR by Nudr_SDM_Update.
NOTE 3: The use of NSI ID in the 5GC is optional and depends on the deployment
choices of the operator.
During the registration the Home Network (or Credentials Holder in case of
access to an SNPN) can provide Steering of Roaming information to the UE via
the AMF (i.e. a list of preferred PLMN/access technology combinations and/or
Credentials Holder controlled prioritized lists of preferred SNPNs and GINs
and/or Credentials Holder controlled prioritized lists of preferred SNPNs and
GINs for accessing Localized Services or HPLMN/Credentials Holder indication
that \'no change of the above list(s) stored in the UE is needed\'). The Home
Network can include an indication for the UE to send an acknowledgement of the
reception of this information. Details regarding the handling of Steering of
Roaming information including how this information is managed between the AMF
and the UE are defined in TS 23.122 [22].
The AMF determines Access Type and RAT Type as defined in clause 5.3.2.3 of TS
23.501 [2].
##### 4.2.2.2.2 General Registration
Figure 4.2.2.2.2-1: Registration procedure
1\. UE to (R)AN: AN message (AN parameters, Registration Request (Registration
type, SUCI or 5G-GUTI or PEI, [last visited TAI (if available)], Security
parameters, [Requested NSSAI], [Mapping Of Requested NSSAI], [Default
Configured NSSAI Indication], [UE Radio Capability Update], [UE MM Core
Network Capability], [PDU Session status], [List Of PDU Sessions To Be
Activated], [Follow-on request], [MICO mode preference], [Requested Active
Time], [Requested DRX parameters for E-UTRA and NR], [Requested DRX parameters
for NB-IoT], [extended idle mode DRX parameters], [LADN DNN(s) or Indicator Of
Requesting LADN Information], [NAS message container], [Support for
restriction of use of Enhanced Coverage], [Preferred Network Behaviour], [UE
paging probability information], [Paging Subgrouping Support Indication], [UE
Policy Container (the list of PSIs, indication of UE support for ANDSP, the
operating system identifier, Indication of URSP Provisioning Support in EPS,
UE capability of reporting URSP rule enforcement to network, UE capability of
supporting VPLMN-specific URSP rules)] and [UE Radio Capability ID], [Release
Request indication], [Paging Restriction Information], PEI, [PLMN with
Disaster Condition], [Requested Periodic Update time], [Unavailability Period
Duration], [Start of Unavailability Period], [Unavailability Type])).
NOTE 1: The UE Policy Container and its usage is defined in TS 23.503 [20].
In the case of NG-RAN, the AN parameters include e.g. 5G-S-TMSI or GUAMI, the
Selected PLMN ID (or PLMN ID and NID, see clause 5.30 of TS 23.501 [2]) and
NSSAI information, the AN parameters also include Establishment cause. The
Establishment cause provides the reason for requesting the establishment of an
RRC connection. Whether and how the UE includes the NSSAI information as part
of the AN parameters is dependent on the value of the Access Stratum
Connection Establishment NSSAI Inclusion Mode parameter, as specified in
clause 5.15.9 of TS 23.501 [2].
The AN parameters shall also include an IAB-Indication if the UE is an IAB-
node accessing 5GS.
The AN parameters shall also include a MBSR Indication if the UE is part of an
MBSR node accessing 5GS attempting MBSR operation in the PLMN as specified in
clause 5.35A.1 of TS 23.501 [2].
The Registration type indicates if the UE wants to perform an Initial
Registration (i.e. the UE is in RM-DEREGISTERED state), a Mobility
Registration Update (i.e. the UE is in RM-REGISTERED state and initiates a
Registration procedure due to mobility or due to the UE needs to update its
capabilities or protocol parameters, or to request a change of the set of
network slices it is allowed to use), a Periodic Registration Update (i.e. the
UE is in RM-REGISTERED state and initiates a Registration procedure due to the
Periodic Registration Update timer expiry, see clause 4.2.2.2.1), an Emergency
Registration (i.e. the UE is in limited service state), a Disaster Roaming
Initial Registration, or a Disaster Roaming Mobility Registration Update.
When the UE is using E-UTRA, the UE indicates its support of CIoT 5GS
Optimisations, which is relevant for the AMF selection, in the RRC connection
establishment signalling associated with the Registration Request.
When the UE is performing an Initial Registration or a Disaster Roaming
Registration the UE shall indicate its UE identity in the Registration Request
message as follows, listed in decreasing order of preference in the case of
registration with a PLMN:
i) a 5G-GUTI mapped from an EPS GUTI, if the UE has a valid EPS GUTI.
ii) a native 5G-GUTI assigned by the PLMN to which the UE is attempting to
register, if available;
iii) a native 5G-GUTI assigned by an equivalent PLMN to the PLMN to which the
UE is attempting to register, if available;
iv) a native 5G-GUTI assigned by any other PLMN, if available; or
NOTE 2: This can also be a 5G-GUTIs assigned via another access type.
v) Otherwise, the UE shall include its SUCI in the Registration Request as
defined in TS 33.501 [15].
If the UE is registering with an SNPN, when the UE is performing an Initial
Registration the UE shall indicate its UE identity in the Registration Request
message as follows, listed in decreasing order of preference:
i) a native 5G-GUTI assigned by the same SNPN to which the UE is attempting to
register, if available;
ii) a native 5G-GUTI assigned by an equivalent SNPN to the SNPN to which the
UE is attempting to register along with the NID of the SNPN that assigned the
5G-GUTI, if available;
iii) a native 5G-GUTI assigned by any other SNPN along with the NID of the
SNPN that assigned the 5G-GUTI, if available; or
iv) Otherwise, the UE shall include its SUCI in the Registration Request as
defined in TS 33.501 [15].
When the UE performing an Initial Registration has both a valid EPS GUTI and a
native 5G-GUTI, the UE shall also indicate the native 5G-GUTI as Additional
GUTI. If more than one native 5G-GUTIs are available, the UE shall select the
5G-GUTI in decreasing order of preference among items (ii)-(iv) in the list
above.
The NAS message container shall be included if the UE is sending a
Registration Request message as an Initial NAS message and the UE has a valid
5G NAS security context and the UE needs to send non-cleartext IEs, see clause
4.4.6 of TS 24.501 [25]. If the UE does not need to send non-cleartext IEs,
the UE shall send a Registration Request message without including the NAS
message container.
If the UE does not have a valid 5G NAS security context, the UE shall send the
Registration Request message without including the NAS message container. The
UE shall include the entire Registration Request message (i.e. containing
cleartext IEs and non-cleartext IEs) in the NAS message container that is sent
as part of the Security Mode Complete message in step 9b.
When the UE is performing an Initial Registration (i.e. the UE is in RM-
DEREGISTERED state) with a native 5G-GUTI then the UE shall indicate the
related GUAMI information in the AN parameters. When the UE is performing an
Initial Registration with its SUCI, the UE shall not indicate any GUAMI
information in the AN parameters.
When the UE is performing an Initial Registration or a Mobility Registration
and if CIoT 5GS Optimisations are supported the UE shall indicate its
Preferred Network Behaviour (see clause 5.31.2 of TS 23.501 [2]). If S1 mode
is supported the UE\'s EPC Preferred Network Behaviour is included in the S1
UE network capabilities in the Registration Request message, see clause
8.2.6.1 of TS 24.501 [25].
For an Emergency Registration, the SUCI shall be included if the UE does not
have a valid 5G-GUTI available; the PEI shall be included when the UE has no
SUPI and no valid 5G-GUTI. In other cases, the 5G-GUTI is included and it
indicates the last serving AMF.
The UE may provide the UE\'s usage setting based on its configuration as
defined in clause 5.16.3.7 of TS 23.501 [2]. The UE provides Requested NSSAI
(as described in clause 5.15.5.2.1 of TS 23.501 [2] and if the UE supports the
subscription-based restrictions to simultaneous registration of network
slices, also taking into account the NSSRG Information constraints as
described in clause 5.15.12 of TS 23.501 [2] and in the case of Initial
Registration or Mobility Registration Update, the UE includes the Mapping Of
Requested NSSAI (if available), which is the mapping of each S-NSSAI of the
Requested NSSAI to the HPLMN S-NSSAIs, to ensure that the network is able to
verify whether the S-NSSAI(s) in the Requested NSSAI are permitted based on
the Subscribed S-NSSAIs. In the case of inter PLMN mobility, if the serving
PLMN S-NSSAI(s) corresponding to the established PDU Session(s) are not
present in the UE, the associated HPLMN S-NSSAI(s) associated with the
established PDU Session(s) shall be provided in the Mapping Of Requested NSSAI
as described in clause 5.15.5.2.1 TS 23.501 [2]. If the UEs supports
reconnection to the network due to RAN timing synchronization status change as
described in TS 23.501 [2], the UE indicates the support of this capability to
the network. If the UE supports UE configuration of network-controlled Slice
Usage Policy and the UE stores Slice Usage Policy, the UE shall include an on
demand S-NSSAI in the Requested NSSAI only when applications in the UE require
data transmission by a PDU session associated with the on demand S-NSSAI as
described in clause 5.15.15 of TS 23.501 [2].
The UE includes the Default Configured NSSAI Indication if the UE is using a
Default Configured NSSAI, as defined in TS 23.501 [2].
The UE may include UE paging probability information if it supports the
assignment of WUS Assistance Information or AMF PEIPS Assistance Information
from the AMF (see TS 23.501 [2]).
The UE may include Paging Subgrouping Support Indication as defined in TS
23.501 [2].
In the case of Mobility Registration Update, the UE includes in the List Of
PDU Sessions To Be Activated the PDU Sessions for which there are pending
uplink data. When the UE includes the List Of PDU Sessions To Be Activated,
the UE shall indicate PDU Sessions only associated with the access the
Registration Request is related to. As defined in TS 24.501 [25] the UE shall
include always-on PDU Sessions which are accepted by the network in the List
Of PDU Sessions To Be Activated even if there are no pending uplink data for
those PDU Sessions.
NOTE 3: A PDU Session corresponding to a LADN is not included in the List Of
PDU Sessions To Be Activated when the UE is outside the area of availability
of the LADN.
The UE MM Core Network Capability is provided by the UE and handled by AMF as
defined in clause 5.4.4a of TS 23.501 [2]. The UE includes in the UE MM Core
Network Capability an indication if it supports Request Type flag \"handover\"
for PDN connectivity request during the attach procedure as defined in clause
5.17.2.3.1 of TS 23.501 [2]. If the UE supports \'Strictly Periodic
Registration Timer Indication\', the UE indicates its capability of \'Strictly
Periodic Registration Timer Indication\' in the UE MM Core Network Capability.
If the UE supports CAG, the UE indicates its capability of \"CAG supported\"
in the UE MM Core Network Capability. If the UE operating two or more USIMs,
supports and intends to use one or more Multi-USIM feature(s), the UE
indicates one or more Multi-USIM specific features described in clause 5.38 of
TS 23.501 [2] in the UE MM Core Network Capability. If the UE supports
equivalent SNPNs, the UE indicates its capability of \"equivalent SNPNs\" in
the UE MM Core Network Capability. If the UE supports Unavailability Period,
the UE indicates its capability of \"Unavailability Period Support\" in the UE
MM Core Network Capability. If the UE supports LADN per DNN and S-NSSAI, the
UE indicates its support of LADN per DNN and S-NSSAI in the UE MM Core Network
Capability. If the UE supports the Network Slice Replacement feature, the UE
indicates support for Network Slice Replacement feature as described in clause
5.15.19 of TS 23.501 [2]. If the UE supports UE configuration of network-
controlled Slice Usage Policy, the UE indicates its capability of \"UE
Configuration of network-controlled Slice Usage Policy\" in the UE MM Core
Network Capability as described in clause 5.15.15 of TS 23.501 [2].
The UE may provide either the LADN DNN(s) or an Indication Of Requesting LADN
Information as described in clause 5.6.5 of TS 23.501 [2].
If available, the last visited TAI shall be included in order to help the AMF
produce Registration Area for the UE.
NOTE 4: With NR satellite access, the last visited TAI is determined as
specified in clause 5.4.11.6 of TS 23.501 [2].
The Security parameters are used for Authentication and integrity protection,
see TS 33.501 [15]. Requested NSSAI indicates the Network Slice Selection
Assistance Information (as defined in clause 5.15 of TS 23.501 [2]). The PDU
Session status indicates the previously established PDU Sessions in the UE.
When the UE is connected to the two AMFs belonging to different PLMN via 3GPP
access and non-3GPP access then the PDU Session status indicates the
established PDU Session of the current PLMN in the UE.
The Follow-on request is included when the UE has pending uplink signalling
and the UE doesn\'t include List Of PDU Sessions To Be Activated, or the
Registration type indicates the UE wants to perform an Emergency Registration.
In Initial Registration and Mobility Registration Update, UE provides the UE
Requested DRX parameters, as defined in clause 5.4.5 of TS 23.501 [2]. The UE
may provide the extended idle mode DRX parameters as defined in clause
5.31.7.2 of TS 23.501 [2] to request extended idle mode DRX.
The UE provides UE Radio Capability Update indication as described in TS
23.501 [2].
The UE includes the MICO mode preference and optionally a Requested Active
Time value and Requested Periodic Update time value if the UE wants to use
MICO Mode with Active Time.
For a UE using NR satellite access that provides discontinuous coverage, the
UE may include an Unavailability Type, an Unavailability Period Duration
and/or Start of Unavailability Period as described in clause 5.4.13.1 of TS
23.501 [2].
The UE may indicate its Service Gap Control Capability in the UE MM Core
Network Capability, see clause 5.31.16 of TS 23.501 [2].
For a UE with a running Service Gap timer in the UE, the UE shall not set
Follow-on Request indication or Uplink data status in the Registration Request
message (see clause 5.31.16 of TS 23.501 [2]), except for network access for
regulatory prioritized services like Emergency services or exception
reporting.
If UE supports RACS and has been assigned UE Radio Capability ID(s), the UE
shall indicate a UE Radio Capability ID as defined in clause 5.4.4.1a of TS
23.501 [2] as non-cleartext IE.
The PEI may be retrieved in initial registration from the UE as described in
clause 4.2.2.2.1.
If a UE supports the subscription-based restrictions to simultaneous
registration of network slices feature, it includes the NSSRG handling support
indication in the UE 5GMM Core Network Capability according to clause 5.15.12
of TS 23.501 [2]. The AMF stores whether the UE supports this feature in the
UE context.
When a Multi-USIM UE wants to enter CM-IDLE state immediately e.g. after
having performed mobility or periodic registration, it includes the Release
Request indication and optionally provides Paging Restriction Information.
When the UE is performing a Disaster Roaming Registration, the UE may indicate
the PLMN with Disaster Condition for the cases as defined in TS 24.501 [25].
If the UE and network have indicated support Unavailability Period and an
event is triggered in the UE that would make the UE unavailable for a certain
period of time, the UE indicates Unavailability Period by including
Unavailability Period Duration and/or Start of Unavailability Period as
described in clause 5.4.1.4 of TS 23.501 [2].
2\. If a 5G-S-TMSI or GUAMI is not included or the 5G-S-TMSI or GUAMI does not
indicate a valid AMF the (R)AN, based on (R)AT and Requested NSSAI, if
available, selects an AMF
The (R)AN selects an AMF as described in clause 6.3.5 of TS 23.501 [2]. If UE
is in CM-CONNECTED state, the (R)AN can forward the Registration Request
message to the AMF based on the N2 connection of the UE.
If the (R)AN cannot select an appropriate AMF, it forwards the Registration
Request to an AMF which has been configured, in (R)AN, to perform AMF
selection.
3\. (R)AN to new AMF: N2 message (N2 parameters, Registration Request (as
described in step 1) and [LTE-M Indication].
When NG-RAN is used, the N2 parameters include the Selected PLMN ID (or PLMN
ID and NID, see clause 5.30 of TS 23.501 [2]), Location Information and Cell
Identity related to the cell in which the UE is camping, UE Context Request
which indicates that a UE context including security information needs to be
setup at the NG-RAN.
When NG-RAN is used, the N2 parameters shall also include the Establishment
cause and IAB-Indication or MBSR Indication if the indication is received in
AN parameters in step 1.
Mapping Of Requested NSSAI is provided only if available.
If the Registration type indicated by the UE is Periodic Registration Update,
then steps 4 to 19 may be omitted.
When the Establishment cause is associated with priority services (e.g. MPS,
MCS), the AMF includes a Message Priority header to indicate priority
information. Other NFs relay the priority information by including the Message
Priority header in service-based interfaces, as specified in TS 29.500 [17].
The RAT Type the UE is using is determined (see clause 4.2.2.2.1) and based on
it the AMF determines whether the UE is performing Inter-RAT mobility to or
from NB-IoT. If the AMF receives the LTE M indication, then it considers that
the RAT Type is LTE-M and stores the LTE-M Indication in UE Context.
If a UE includes a Preferred Network Behaviour, this defines the Network
Behaviour the UE supports and is expecting to be available in the network as
defined in clause 5.31.2 of TS 23.501 [2].
If the UE has included the Preferred Network Behaviour and what the UE
indicated it supports in Preferred Network Behaviour is incompatible with the
network support, the AMF shall reject the Registration Request with an
appropriate cause value (e.g. one that avoids retries on this PLMN).
If there is a Service Gap timer running in the UE Context in AMF for the UE
and Follow-on Request indication or Uplink data status is included in the
Registration Request message, the AMF shall ignore the Follow-on Request
indication and Uplink data status and not perform any of the actions related
to the status.
If the UE has included a UE Radio Capability ID in step 1 and the AMF supports
RACS, the AMF stores the Radio Capability ID in UE context.
For NR satellite access, the AMF may verify the UE location and determine
whether the PLMN is allowed to operate at the UE location, as described in
clause 5.4.11.4 of TS 23.501 [2]. If the UE receives a Registration Reject
message with cause value indicating that the PLMN is not allowed to operate at
the present UE location, the UE shall attempt to select a PLMN as specified in
TS 23.122 [22].
For a Disaster Roaming Registration, based on the ULI (including Cell ID)
received from the NG-RAN, the PLMN with Disaster Condition derived from the
UE\'s 5G-GUTI, derived from the UE\'s SUCI or indicated by the UE and the
local configuration, the AMF determines if Disaster Roaming service can be
provided. If the current location is not subject to Disaster Roaming service
or the Disaster Roaming service is not provided to the PLMN with Disaster
Condition derived from the UE\'s 5G-GUTI, derived from the UE\'s SUCI or
indicated by UE, then the AMF should reject the Registration Request
indicating a suitable Cause value.
4\. [Conditional] new AMF to old AMF: Namf_Communication_UEContextTransfer
(complete Registration Request) or new AMF to UDSF: Nudsf_Unstructured Data
Management_Query().
The new AMF determines the old AMF using the UE\'s 5G-GUTI. If the new AMF
received an NID in the Registration request, it determines that the 5G-GUTI
was assigned by an SNPN and determines the old AMF using the 5G-GUTI and NID
of the SNPN.
(With UDSF Deployment): If the UE\'s 5G-GUTI was included in the Registration
Request and the serving AMF has changed since last Registration procedure, new
AMF and old AMF are in the same AMF Set and UDSF is deployed, the new AMF
retrieves the stored UE\'s SUPI and UE context directly from the UDSF using
Nudsf_UnstructuredDataManagement_Query service operation or they can share
stored UE context via implementation specific means if UDSF is not deployed.
This includes also event subscription information by each NF consumer for the
given UE. In this case, the new AMF uses integrity protected complete
Registration request NAS message to perform and verify integrity protection.
(Without UDSF Deployment): If the UE\'s 5G-GUTI was included in the
Registration Request and the serving AMF has changed since last Registration
procedure, the new AMF may invoke the Namf_Communication_UEContextTransfer
service operation on the old AMF including the complete Registration Request
NAS message, which may be integrity protected, as well as the Access Type, to
request the UE\'s SUPI and UE Context. See clause 5.2.2.2.2 for details of
this service operation. In this case, the old AMF uses either 5G-GUTI and the
integrity protected complete Registration request NAS message, or the SUPI and
an indication that the UE is validated from the new AMF, to verify integrity
protection if the context transfer service operation invocation corresponds to
the UE requested. The old AMF also transfers the event subscriptions
information by each NF consumer, for the UE, to the new AMF. If the old AMF
has not yet reported a non-zero MO Exception Data Counter to the (H-)SMF, the
Context Response also includes the MO Exception Data Counter.
If the old AMF has PDU Sessions for another access type (different from the
Access Type indicated in this step) and if the old AMF determines that there
is no possibility for relocating the N2 interface to the new AMF, the old AMF
returns UE\'s SUPI and indicates that the Registration Request has been
validated for integrity protection, but does not include the rest of the UE
context.
For inter PLMN mobility, UE Context information includes HPLMN S-NSSAIs
corresponding to the Allowed NSSAI for each Access Type and Partially Allowed
NSSAI, without Allowed NSSAI and Partially Allowed NSSAI of old PLMN.
NOTE 5: The new AMF Sets the indication that the UE is validated according to
step 9a, if the new AMF has performed successful UE authentication after
previous integrity check failure in the old AMF.
NOTE 6: The NF consumers do not need to subscribe for the events once again
with the new AMF after the UE is successfully registered with the new AMF.
If the new AMF has already received UE contexts from the old AMF during
handover procedure, then step 4,5 and 10 shall be skipped.
For an Emergency Registration, if the UE identifies itself with a 5G-GUTI that
is not known to the AMF, steps 4 and 5 are skipped and the AMF immediately
requests the SUPI from the UE. If the UE identifies itself with PEI, the SUPI
request shall be skipped. Allowing Emergency Registration without a user
identity is dependent on local regulations.
5\. [Conditional] old AMF to new AMF: Response to
Namf_Communication_UEContextTransfer (SUPI, UE Context in AMF (as per Table
5.2.2.2.2-1)) or UDSF to new AMF: Nudsf_Unstructured Data Management_Query().
The old AMF may start an implementation specific (guard) timer for the UE
context.
If the UDSF was queried in step 4, the UDSF responds to the new AMF for the
Nudsf_Unstructured Data Management_Query invocation with the related contexts
including established PDU Sessions, the old AMF includes SMF information DNN,
S-NSSAI(s) and PDU Session ID, active NGAP UE-TNLA bindings to
N3IWF/TNGF/W-AGF, the old AMF includes information about the NGAP UE-TNLA
bindings. If the Old AMF was queried in step 4, Old AMF responds to the new
AMF for the Namf_Communication_UEContextTransfer invocation by including the
UE\'s SUPI and UE Context.
If old AMF holds information about established PDU Session(s) and it is not an
Initial Registration, the old AMF includes SMF information, DNN(s), S-NSSAI(s)
and PDU Session ID(s).
If old AMF holds UE context established via N3IWF, W-AGF or TNGF, the old AMF
includes the CM state via N3IWF, W-AGF or TNGF. If the UE is in CM-CONNECTED
state via N3IWF, W-AGF or TNGF, the old AMF includes information about the
NGAP UE-TNLA bindings.
If old AMF fails the integrity check of the Registration Request NAS message,
the old AMF shall indicate the integrity check failure. If the new AMF is
configured to allow emergency services for unauthenticated UE, the new AMF
behaves as follows:
\- If the UE has only an emergency PDU Session, the AMF either skips the
authentication and security procedure or accepts that the authentication may
fail and continues the Mobility Registration Update procedure; or
\- If the UE has both emergency and non emergency PDU Sessions and
authentication fails, the AMF continues the Mobility Registration Update
procedure and deactivates all the non-emergency PDU Sessions as specified in
clause 4.3.4.2.
NOTE 7: The new AMF can determine if a PDU Session is used for emergency
service by checking whether the DNN matches the emergency DNN.
If old AMF holds information about AM Policy Association and the information
about UE Policy Association (i.e. the Policy Control Request Trigger for
updating UE Policy as defined in TS 23.503 [20]), the old AMF includes the
information about the AM Policy Association, the UE Policy Association and PCF
ID. In the roaming case, V-PCF ID and H-PCF ID are included.
If old AMF was a consumer of UE related NWDAF services, the old AMF includes
information about active analytics subscriptions, i.e. the Subscription
Correlation ID, NWDAF identifier (i.e. Instance ID or Set ID), Analytics ID(s)
and associated Analytics specific data in the
Namf_Communication_UEContextTransfer response. Usage of the analytics
information by the new AMF is specified in TS 23.288 [50].
During inter PLMN mobility, the handling of the UE Radio Capability ID in the
new AMF is as defined in TS 23.501 [2].
NOTE 8: When new AMF uses UDSF for context retrieval, interactions between old
AMF, new AMF and UDSF due to UE signalling on old AMF at the same time is
implementation issue.
6\. [Conditional] new AMF to UE: Identity Request ().
If the SUCI is not provided by the UE nor retrieved from the old AMF the
Identity Request procedure is initiated by AMF sending an Identity Request
message to the UE requesting the SUCI.
7\. [Conditional] UE to new AMF: Identity Response ().
The UE responds with an Identity Response message including the SUCI. The UE
derives the SUCI by using the provisioned public key of the HPLMN, as
specified in TS 33.501 [15].
8\. The AMF may decide to initiate UE authentication by invoking an AUSF. In
that case, the AMF selects an AUSF based on SUPI or SUCI, as described in
clause 6.3.4 of TS 23.501 [2].
If the AMF is configured to support Emergency Registration for unauthenticated
SUPIs and the UE indicated Registration type Emergency Registration, the AMF
skips the authentication or the AMF accepts that the authentication may fail
and continues the Registration procedure.
9a. If authentication is required, the AMF requests it from the AUSF; if
Tracing Requirements about the UE are available at the AMF, the AMF provides
Tracing Requirements in its request to AUSF. For a Disaster Roaming
Registration, the AMF may provide the indication of Disaster Roaming service
in its request to AUSF. Upon request from the AMF, the AUSF shall execute
authentication of the UE. The authentication is performed as described in TS
33.501 [15]. The AUSF selects a UDM as described in clause 6.3.8 of TS 23.501
[2] and gets the authentication data from UDM.
The AUSF may provide the indication of Disaster Roaming service to UDM if the
indication is received from AMF. For a Disaster Roaming Registration, the AUSF
executes authentication of the UE based on the local policy and/or local
configuration as specified in clause 5.40.4 of TS 23.501 [2] and in TS 33.501
[15].
Once the UE has been authenticated the AUSF provides relevant security related
information to the AMF. If the AMF provided a SUCI to AUSF, the AUSF shall
return the SUPI to AMF only after the authentication is successful.
After successful authentication in new AMF, which is triggered by the
integrity check failure in old AMF at step 5, the new AMF invokes step 4 above
again and indicates that the UE is validated (i.e. through the reason
parameter as specified in clause 5.2.2.2.2).
9b If NAS security context does not exist, the NAS security initiation is
performed as described in TS 33.501 [15]. If the UE had no NAS security
context in step 1, the UE includes the full Registration Request message as
defined in TS 24.501 [25].
The AMF decides if the Registration Request needs to be rerouted as described
in clause 4.2.2.2.3, where the initial AMF refers to the AMF.
9c. The AMF initiates NGAP procedure to provide the 5G-AN with security
context as specified in TS 38.413 [10] if the 5G-AN had requested for UE
Context. Also, if the AMF decides that EPS fallback is supported (e.g. based
on UE capability to support Request Type flag \"handover\" for PDN
connectivity request during the attach procedure as defined in clause
5.17.2.3.1 of TS 23.501 [2], subscription data and local policy), the AMF
shall send an indication \"Redirection for EPS fallback for voice is
possible\" towards 5G-AN as specified in TS 38.413 [10]. Otherwise, the AMF
indicates \"Redirection for EPS fallback for voice is not possible\". In
addition, if Tracing Requirements about the UE are available at the AMF, the
AMF provides the 5G-AN with Tracing Requirements in the NGAP procedure.
9d. The 5G-AN stores the security context and acknowledges to the AMF. The
5G-AN uses the security context to protect the messages exchanged with the UE
as described in TS 33.501 [15].
10\. [Conditional] new AMF to old AMF:
Namf_Communication_RegistrationStatusUpdate (PDU Session ID(s) to be released
e.g. due to slice not supported).
If the AMF has changed the new AMF informs the old AMF that the registration
of the UE in the new AMF is completed by invoking the
Namf_Communication_RegistrationStatusUpdate service operation.
If the authentication/security procedure fails, then the Registration shall be
rejected and the new AMF invokes the
Namf_Communication_RegistrationStatusUpdate service operation with a reject
indication towards the old AMF. The old AMF continues as if the UE context
transfer service operation was never received.
The new AMF determines the PDU Session(s) that cannot be supported in the new
Registration Area in the cases below:
\- If one or more of the S-NSSAIs used in the old Registration Area cannot be
served in the target Registration Area.
\- When continuity of the PDU Session(s) cannot be supported between networks
(e.g. SNPN-SNPN mobility, inter-PLMN mobility where no HR agreement exists).
If any of the cases is met, the new AMF invokes the
Namf_Communication_RegistrationStatusUpdate service operation including the
rejected PDU Session ID towards the old AMF. Then the new AMF modifies the PDU
Session Status correspondingly. The old AMF informs the corresponding SMF(s)
to locally release the UE\'s SM context by invoking the
Nsmf_PDUSession_ReleaseSMContext service operation.
If new AMF received in the UE context transfer in step 5 the information about
the AM Policy Association and the UE Policy Association and decides, based on
local policies, not to use the PCF(s) identified by the PCF ID(s) for the AM
Policy Association and the UE Policy Association, then it will inform the old
AMF that the AM Policy Association and the UE Policy Association in the UE
context is not used any longer and then the PCF selection is performed in step
15.
If the new AMF received in the UE context transfer in step 5 the information
about UE related analytics subscription(s), the new AMF may take over the
analytics subscription(s) from the old AMF. Otherwise, if the new AMF instead
determines to create new analytics subscription(s), it informs the old AMF
about the analytics subscriptions (identified by their Subscription
Correlation ID) that are not needed any longer and the old AMF may now
unsubscribe those NWDAF analytics subscriptions for the UE according to TS
23.288 [50].
11\. [Conditional] new AMF to UE: Identity Request/Response (PEI).
If the PEI was not provided by the UE nor retrieved from the old AMF the
Identity Request procedure is initiated by AMF sending an Identity Request
message to the UE to retrieve the PEI. The PEI shall be transferred encrypted
unless the UE performs Emergency Registration and cannot be authenticated.
For an Emergency Registration, the UE may have included the PEI in the
Registration Request. If so, the PEI retrieval is skipped.
If the UE supports RACS as indicated in UE MM Core Network Capability, the AMF
shall use the PEI of the UE to obtain the IMEI/TAC for the purpose of RACS
operation.
12\. Optionally the new AMF initiates ME identity check by invoking the
N5g-eir_EquipmentIdentityCheck_Get service operation (see clause 5.2.4.2.2).
The PEI check is performed as described in clause 4.7.
For an Emergency Registration, if the PEI is blocked, operator policies
determine whether the Emergency Registration procedure continues or is
stopped.
13\. If step 14 is to be performed, the new AMF, based on the SUPI, selects a
UDM, then UDM may select a UDR instance. See clause 6.3.9 of TS 23.501 [2].
The AMF selects a UDM as described in clause 6.3.8 of TS 23.501 [2].
14a-c. If the AMF has changed since the last Registration procedure, if UE
Registration type is Initial Registration or Emergency Registration, or if the
UE provides a SUPI which does not refer to a valid context in the AMF, or if
the UE registers to the same AMF it has already registered to a non-3GPP
access (i.e. the UE is registered over a non-3GPP access and initiates this
Registration procedure to add a 3GPP access), the new AMF registers with the
UDM using Nudm_UECM_Registration for the access to be registered (and
subscribes to be notified when the UDM deregisters this AMF). The UDM based on
the \"Registration Type\" in the Nudm_UECM_Registration request, can act on
SoR information according to TS 23.122 [22]. In this case, if the AMF does not
have event exposure subscription information for this UE, the AMF indicates it
to UDM. Then, if the UDM has existing applicable event exposure subscriptions
for events detected in AMF for this UE or for any of the groups this UE
belongs to (possibly retrieved from UDR), UDM invokes the
Namf_EventExposure_Subscribe service for recreating the event exposure
subscriptions.
The AMF provides the \"Homogenous Support of IMS Voice over PS Sessions\"
indication (see clause 5.16.3.3 of TS 23.501 [2]) to the UDM. The \"Homogenous
Support of IMS Voice over PS Sessions\" indication shall not be included
unless the AMF has completed its evaluation of the support of \"IMS Voice over
PS Session\" as specified in clause 5.16.3.2 of TS 23.501 [2].
During initial Registration, if the AMF and UE supports SRVCC from NG-RAN to
UTRAN the AMF provides UDM with the UE SRVCC capability.
If the AMF determines that only the UE SRVCC capability has changed, the AMF
sends UE SRVCC capability to the UDM.
NOTE 9: At this step, it is possible that the AMF does not have all the
information needed to determine the setting of the IMS Voice over PS Session
Supported indication for this UE (see clause 5.16.3.2 of TS 23.501 [2]). Hence
the AMF can send the \"Homogenous Support of IMS Voice over PS Sessions\"
later on in this procedure.
After AMF has successfully completed the Nudm_UECM_Registration operation and
if the AMF does not have subscription data for the UE, the AMF retrieves the
Access and Mobility Subscription data, SMF Selection Subscription data, UE
context in SMF data and LCS mobile origination using Nudm_SDM_Get. If the AMF
already has subscription data for the UE but the SoR Update Indicator in the
UE context requires the AMF to retrieve SoR information depending on the NAS
Registration Type (\"Initial Registration\" or \"Emergency Registration\")
(see Annex C of TS 23.122 [22]), the AMF retrieves the Steering of Roaming
information using Nudm_SDM_Get. This requires that UDM may retrieve this
information from UDR by Nudr_DM_Query. After a successful response is
received, the AMF subscribes to be notified using Nudm_SDM_Subscribe when the
data requested is modified, UDM may subscribe to UDR by Nudr_DM_Subscribe. The
GPSI is provided to the AMF in the Access and Mobility Subscription data from
the UDM if the GPSI is available in the UE subscription data. The UDM may
provide indication that the subscription data for network slicing is updated
for the UE. If the UE is subscribed to MPS in the serving PLMN, \"MPS
priority\" is included in the Access and Mobility Subscription data provided
to the AMF. If the UE is subscribed to MCX in the serving PLMN, \"MCX
priority\" is included in the Access and Mobility Subscription data provided
to the AMF. The UDM also provides the IAB-Operation allowed indication or MBSR
Operation allowed indication to AMF as part of the Access and Mobility
Subscription data. The AMF shall trigger the setup of the UE context in NG-
RAN, or modification of the UE context in NG-RAN if the initial setup is at
step 9c, including an indication that the IAB-node is authorized or MBSR is
authorized. If a S-NSSAI in the Subscribed S-NSSAIs is subject to network
slice usage control and the S-NSSAI is dedicated for a single AF, the UDM may
provide a Slice Usage Policy information including whether a network slice is
on demand and a slice deregistration inactvity timer value for the Subscribed
S-NSSAIs as described in clause 5.15.15 of TS 23.501 [2].
For a Disaster Roaming Registration, the AMF may provide the indication of
Disaster Roaming service to the UDM. The UDM provides the subscription data
for a Disaster Roaming service to the AMF based on the local policy and/or the
local configuration as specified in clause 5.40.4 of TS 23.501 [2].
The AMF provides MINT support indication via Nudm_UECM_Registration towards
UDM, if UE includes the MINT support indication in the 5GMM capability as
specified in clause 5.40.2 of TS 23.501 [2] or if the MINT support indication
in the 5GMM capability is changed.
If the AMF receives a priority indication (e.g. MPS, MCX) as part of the
Access and Mobility Subscription data, but the UE did not provide an
Establishment cause associated with priority services, the AMF shall include a
Message Priority header to indicate priority information for all subsequent
messages. Other NFs relay the priority information by including the Message
Priority header in service-based interfaces, as specified in TS 29.500 [17].
The new AMF provides the Access Type it serves for the UE to the UDM and the
Access Type is set to \"3GPP access\". The UDM stores the associated Access
Type together with the serving AMF and does not remove the AMF identity
associated to the other Access Type if any. The UDM may store in UDR
information provided at the AMF registration by Nudr_DM_Update.
If the UE was registered in the old AMF for an access and the old and the new
AMFs are in the same PLMN, the new AMF sends a separate/independent
Nudm_UECM_Registration to update UDM with Access Type set to access used in
the old AMF, after the old AMF relocation is successfully completed.
The new AMF creates an UE context for the UE after getting the Access and
Mobility Subscription data from the UDM. The Access and Mobility Subscription
data includes whether the UE is allowed to include NSSAI in the 3GPP access
RRC Connection Establishment in clear text. The Access and Mobility
Subscription data may include Enhanced Coverage Restricted information. If
received from the UDM and the UE included support for restriction of use of
Enhanced Coverage in step 1, the AMF determines whether Enhanced Coverage is
restricted or not for the UE as specified in clause 5.31.12 of TS 23.501 [2]
and stores the updated Enhanced Coverage Restricted information in the UE
context.
The Access and Mobility Subscription data may include the NB-IoT UE Priority.
For subscribed S-NSSAIs subject to NSAC, the AMF stores the corresponding
applicable NSAC admission mode.
The subscription data may contain Service Gap Time parameter. If received from
the UDM, the AMF stores this Service Gap Time in the UE Context in AMF for the
UE.
If the AMF has the LADN service area and UE indication of support for LADN per
DNN and S-NSSAI, the AMF applies LADN per DNN and S-NSSAI as described in
5.20b.2 of TS 23.501 [2].
For an Emergency Registration in which the UE was not successfully
authenticated, the AMF shall not register with the UDM.
The AMF enforces the Mobility Restrictions as specified in clause 5.3.4.1.1 of
TS 23.501 [2]. For an Emergency Registration, the AMF shall not check for
Mobility Restrictions, access restrictions, regional restrictions or
subscription restrictions. For an Emergency Registration, the AMF shall ignore
any unsuccessful registration response from UDM and continue with the
Registration procedure.
NOTE 10: The AMF can, instead of the Nudm_SDM_Get service operation, use the
Nudm_SDM_Subscribe service operation with an Immediate Report Indication that
triggers the UDM to immediately return the subscribed data if the
corresponding feature is supported by both the AMF and the UDM.
14d. When the UDM stores the associated Access Type (e.g. 3GPP) together with
the serving AMF as indicated in step 14a, it will cause the UDM to initiate a
Nudm_UECM_DeregistrationNotification (see clause 5.2.3.2.2) to the old AMF
corresponding to the same (e.g. 3GPP) access, if one exists. If the timer
started in step 5 is not running, the old AMF may remove the UE context for
the same Access Type. Otherwise, the AMF may remove UE context for the same
Access Type when the timer expires. If the serving NF removal reason indicated
by the UDM is Initial Registration, then, as described in clause 4.2.2.3.2,
the old AMF invokes the Nsmf_PDUSession_ReleaseSMContext (SM Context ID)
service operation towards all the associated SMF(s) of the UE to notify that
the UE is deregistered from old AMF for the same Access Type. The SMF(s) shall
release the PDU Session on getting this notification.
If the old AMF has established an AM Policy Association and a UE Policy
Association with the PCF(s) and the old AMF did not transfer the PCF ID(s) to
the new AMF (e.g. new AMF is in different PLMN), the old AMF performs an AMF-
initiated Policy Association Termination procedure, as defined in clause
4.16.3.2 and performs an AMF-initiated UE Policy Association Termination
procedure, as defined in clause 4.16.13.1. In addition, if the old AMF
transferred the PCF ID(s) in the UE context but the new AMF informed in step
10 that the AM Policy Association information and UE Policy Association
information in the UE context will not be used then the old AMF performs an
AMF-initiated Policy Association Termination procedure, as defined in clause
4.16.3.2 and performs an AMF-initiated UE Policy Association Termination
procedure, as defined in clause 4.16.13.1.
If the old AMF has an N2 connection for that UE (e.g. because the UE was in
RRC_INACTIVE state but has now moved to E-UTRAN or moved to an area not served
by the old AMF), the old AMF shall perform AN Release (see clause 4.2.6) with
a cause value that indicates that the UE has already locally released the NG-
RAN\'s RRC Connection.
If the UE context in the old AMF contains an Allowed NSSAI or Partially
Allowed NSSAI including one or more S-NSSAI(s) subject to NSAC, the old AMF
upon receipt of the Nudm_UECM_DeregistrationNotification from the UDM, sends
an update request message for each S-NSSAI subject to NSAC to the
corresponding NSACF(s) with update flag parameter set to decrease (see clause
4.2.11.2).
At the end of registration procedure, the AMF may initiate synchronization of
event exposure subscriptions with the UDM if the AMF does not indicate
unavailability of event exposure subscription in step 14a.
NOTE 11: The AMF can initiate synchronization with UDM even if events are
available in the UE context (e.g. as received from old AMF) at any given time
and based on local policy. This can be done during subscription change related
event.
14e. [Conditional] If old AMF does not have UE context for another access type
(i.e. non-3GPP access), the Old AMF unsubscribes with the UDM for subscription
data using Nudm_SDM_unsubscribe.
15\. If the AMF decides to initiate PCF communication, the AMF acts as
follows.
If the new AMF decides to use the (V-)PCF identified by the (V-)PCF ID
included in UE context from the old AMF in step 5, the AMF contacts the
(V-)PCF identified by the (V-)PCF ID to obtain policy. If the AMF decides to
perform PCF discovery and selection and the AMF selects a (V)-PCF and may
select an H-PCF (for roaming scenario) as described in clause 6.3.7.1 of TS
23.501 [2] and according to the V-NRF to H-NRF interaction described in clause
4.3.2.2.3.3.
16\. [Optional] new AMF performs an AM Policy Association
Establishment/Modification. For an Emergency Registration, this step is
skipped.
If the new AMF selects a new (V-)PCF in step 15, the new AMF performs AM
Policy Association Establishment with the selected (V-)PCF as defined in
clause 4.16.1.2.
If the (V-)PCF identified by the (V-)PCF ID included in UE context from the
old AMF is used, the new AMF performs AM Policy Association Modification with
the (V-)PCF as defined in clause 4.16.2.1.2.
If the AMF notifies the Mobility Restrictions (e.g. UE location) to the PCF
for adjustment, or if the PCF updates the Mobility Restrictions itself due to
some conditions (e.g. application in use, time and date), the PCF shall
provide the updated Mobility Restrictions to the AMF. If the subscription
information includes Tracing Requirements, the AMF provides the PCF with
Tracing Requirements.
If the AMF supports DNN replacement, the AMF provides the PCF with the Allowed
NSSAI and Partially Allowed NSSAI and if available, the Mapping Of Allowed
NSSAI and Mapping Of Partially Allowed NSSAI.
If the PCF supports DNN replacement, the PCF provides the AMF with triggers
for DNN replacement.
If the PCF supports the slice replacement, the PCF provides the AMF with
triggers for slice replacement.
If a S-NSSAI in subject to network slice usage control, the PCF may provide a
Slice Usage Policy information including, whether a network slice is on demand
and a slice deregistration inactvity timer value, for the Subscribed S-NSSAIs
as described in clause 5.15.15 of TS 23.501 [2].
17\. [Conditional] AMF to SMF: Nsmf_PDUSession_UpdateSMContext ().
For an Emergency Registered UE (see TS 23.501 [2]), this step is applied when
the Registration Type is Mobility Registration Update.
The AMF invokes the Nsmf_PDUSession_UpdateSMContext (see clause 5.2.8.2.6) in
the following scenario(s):
\- If the List Of PDU Sessions To Be Activated is included in the Registration
Request in step 1, the AMF sends Nsmf_PDUSession_UpdateSMContext Request to
SMF(s) associated with the PDU Session(s) in order to activate User Plane
connections of these PDU Session(s). Steps from step 5 onwards described in
clause 4.2.3.2 are executed to complete the User Plane connection activation
without sending the RRC Inactive Assistance Information and without sending MM
NAS Service Accept from the AMF to (R)AN described in step 12 of clause
4.2.3.2. When a User Plane connection for a PDU Session is activated, the AS
layer in the UE indicates it to the NAS layer.
\- If the AMF has determined in step 3 that the UE is performing Inter-RAT
mobility to or from NB-IoT, the AMF sends Nsmf_PDUSession_UpdateSMContext
Request to SMF(s) associated with the UEs PDU Session(s), so the SMF(s) can
update them according to the \"PDU Session continuity at inter RAT mobility\"
subscription data. Steps from step 5 onwards described in clause 4.2.3.2 are
executed without sending MM NAS Service Accept from the AMF to (R)AN described
in step 12 of clause 4.2.3.2.
When the serving AMF has changed, the new serving AMF notifies the SMF for
each PDU Session that it has taken over the responsibility of the signalling
path towards the UE: the new serving AMF invokes the
Nsmf_PDUSession_UpdateSMContext service operation using SMF information
received from the old AMF at step 5. It also indicates whether the PDU Session
is to be re-activated.
NOTE 12: If the UE moves into a different PLMN, the AMF in the serving PLMN
can insert or change the V-SMF(s) in the serving PLMN for Home Routed PDU
session(s). In addition, a V-SMF is removed in case the UE moves from a VPLMN
into the HPLMN. In these cases, the same procedures described in clause 4.23.3
are applied for the V-SMF change as for the I-SMF change (i.e. by replacing
the I-SMF with V-SMF). During inter-PLMN change, if the same SMF is used,
session continuity can be supported depending on operator policies.
Steps from step 5 onwards described in clause 4.2.3.2 are executed. In the
case that the intermediate UPF insertion, removal, or change is performed for
the PDU Session(s) not included in \"PDU Session(s) to be re-activated\", the
procedure is performed without N11 and N2 interactions to update the N3 user
plane between (R)AN and 5GC.
The AMF invokes the Nsmf_PDUSession_ReleaseSMContext service operation towards
the SMF in the following scenario:
\- If any PDU Session status indicates that it is released at the UE, the AMF
invokes the Nsmf_PDUSession_ReleaseSMContext service operation towards the SMF
in order to release any network resources related to the PDU Session.
If the serving AMF is changed, the new AMF shall wait until step 18 is
finished with all the SMFs associated with the UE. Otherwise, steps 19 to 22
can continue in parallel to this step.
18\. [Conditional] If the new AMF and the old AMF are in the same PLMN, the
new AMF sends a UE Context Modification Request to N3IWF/TNGF/W-AGF as
specified in TS 29.413 [64].
If the AMF has changed and the old AMF has indicated that the UE is in CM-
CONNECTED state via N3IWF, W-AGF or TNGF and if the new AMF and the old AMF
are in the same PLMN, the new AMF creates an NGAP UE association towards the
N3IWF/TNGF/W-AGF to which the UE is connected. This automatically releases the
existing NGAP UE association between the old AMF and the N3IWF/TNGF/W-AGF.
19\. N3IWF/TNGF/W-AGF sends a UE Context Modification Response to the new AMF.
19a. [Conditional] After the new AMF receives the response message from the
N3IWF, W-AGF or TNGF in step 19, the new AMF registers with the UDM using
Nudm_UECM_Registration as step 14a, but with the Access Type set to \"non-3GPP
access\". The UDM stores the associated Access Type together with the serving
AMF and does not remove the AMF identity associated to the other Access Type
if any. The UDM may store in UDR information provided at the AMF registration
by Nudr_DM_Update.
19b. [Conditional] When the UDM stores the associated Access Type (i.e.
non-3GPP) together with the serving AMF as indicated in step 19a, it will
cause the UDM to initiate a Nudm_UECM_DeregistrationNotification (see clause
5.2.3.2.2) to the old AMF corresponding to the same (i.e. non-3GPP) access.
The old AMF removes the UE context for non-3GPP access.
19c. The Old AMF unsubscribes with the UDM for subscription data using
Nudm_SDM_unsubscribe.
20a. Void.
21\. New AMF to UE: Registration Accept (5G-GUTI, Registration Area, [Mobility
restrictions], [PDU Session status], [Allowed NSSAI], [Mapping Of Allowed
NSSAI], [Partially Allowed NSSAI], [Mapping Of Partially Allowed NSSAI], [TAI
List for S-NSSAIs in Partially Allowed NSSAI], [Configured NSSAI for the
Serving PLMN], [Mapping Of Configured NSSAI], [NSSRG Information], [NSAG
Information], [rejected S-NSSAIs], [TAI List for any rejected S-NSSAI
Partially in the RA], [Pending NSSAI], [Mapping Of Pending NSSAI], [Periodic
Registration Update timer], [Active Time], [Strictly Periodic Registration
Timer Indication], [LADN Information], [accepted MICO mode], [IMS Voice over
PS session supported Indication], [Emergency Service Support indicator],
[Accepted DRX parameters for E-UTRA and NR], [Accepted DRX parameters for NB-
IoT], [extended idle mode DRX parameters], [Paging Time Window], [Network
support of Interworking without N26], [Access Stratum Connection Establishment
NSSAI Inclusion Mode], [Network Slicing Subscription Change Indication],
[Operator-defined access category definitions], [List of equivalent PLMNs],
[Enhanced Coverage Restricted information], [Supported Network Behaviour],
[Service Gap Time], [PLMN-assigned UE Radio Capability ID], [PLMN-assigned UE
Radio Capability ID deletion], [WUS Assistance Information], [AMF PEIPS
Assistance Information], [Truncated 5G-S-TMSI Configuration], [Connection
Release Supported], [Paging Cause Indication for Voice Service Supported],
[Paging Restriction Supported], [Reject Paging Request Supported], [Paging
Restriction Information acceptance / rejection], [\"List of PLMN(s) to be used
in Disaster Condition\"], [Disaster Roaming wait range information], [Disaster
Return wait range information], [Forbidden TAI(s)], [List of equivalent
SNPNs], [Registered NID], [Unavailability Period Supported], [MBSR
authorization information], [Discontinuous Coverage Supported], [Return To
Coverage Notification Not Required], [Unavailability Period Duration],
[S-NSSAI location availability information], [Mapping Of Alternative NSSAI],
[Slice Usage Policy], [Maximum Time Offset]).
If the Requested NSSAI does not include S-NSSAIs which map to S-NSSAIs of the
HPLMN subject to Network Slice-Specific Authentication and Authorization and
the AMF determines that no S-NSSAI can be provided in the Allowed NSSAI for
the UE in the current UE\'s Tracking Area and if no default S-NSSAI(s) not yet
involved in the current UE Registration procedure could be further considered,
the AMF shall reject the UE Registration and shall include in the rejection
message the list of Rejected S-NSSAIs, each of them with the appropriate
rejection cause value.
The Allowed NSSAI for the Access Type for the UE is included in the N2 message
carrying the Registration Accept message. The Allowed NSSAI contains only
S-NSSAIs that do not require, based on subscription information, Network
Slice-Specific Authentication and Authorization and based on the UE Context in
the AMF, those S-NSSAIs for which Network Slice-Specific Authentication and
Authorization previously succeeded, regardless of the Access Type. The Mapping
Of Pending NSSAI is the mapping of each S-NSSAI of the Pending NSSAI for the
Serving PLMN to the HPLMN S-NSSAIs.
If the UE has indicated its support for the Partial Network Slice support in a
Registration Area (see clause 5.15.17 of TS 23.501 [2]) in the UE MM Core
Network Capability in the Registration Request, the AMF may include Partially
Allowed NSSAI in the Registration Accept with the related TAI List for
S-NSSAIs in Partially allowed NSSAI as per TS 23.501 [2] clause 5.1517 and in
the N2 message carrying the Registration Accept message without the TAI List
for S-NSSAIs in Partially allowed NSSAI. The Partially Allowed NSSAI contains
only S-NSSAIs that do not require, based on subscription information, Network
Slice-Specific Authentication and Authorization and based on the UE Context in
the AMF, those S-NSSAIs for which Network Slice-Specific Authentication and
Authorization previously succeeded, regardless of the Access Type. The Mapping
Of Partially Allowed NSSAI is the mapping of each S-NSSAI of the Partially
Allowed NSSAI for the Serving PLMN to the HPLMN S-NSSAIs.
If the UE has indicated its support for the Partial Network Slice support in a
Registration Area (see clause 5.15.17 of TS 23.501 [2]) in the UE MM Core
Network Capability in the Registration Request, the AMF may include S-NSSAI(s)
rejected partially in the RA in the Registration Accept with the applicable
TAI List for rejected S-NSSAI partially in the RA.
Editor\'s note: The Partially Allowed NSSAI support over N2 is to be
confirmed. It is FFS if the N2 information also includes S-NSSAI rejected
partially in RA.
If the UE has indicated its support of the Network Slice-Specific
Authentication and Authorization procedure in the UE MM Core Network
Capability in the Registration Request, AMF includes in the Pending NSSAI the
S-NSSAIs that map to an S-NSSAI of the HPLMN which in the subscription
information has indication that it is subject to Network Slice-Specific
Authentication and Authorization, as described in clause 4.6.2.4 of TS 24.501
[25]. In such case, the AMF then shall trigger at step 25 the Network Slice-
Specific Authentication and Authorization procedure, specified in clause
4.2.9.2, except, based on Network policies, for those S-NSSAIs for which
Network Slice-Specific Authentication and Authorization have already been
initiated on another Access Type for the same S-NSSAI(s). The UE shall not
attempt re-registration with the S-NSSAIs included in the list of Pending
NSSAIs until the Network Slice-Specific Authentication and Authorization
procedure has been completed, regardless of the Access Type.
If the UE has not indicated its support of the Network Slice-Specific
Authentication and Authorization procedure in the UE 5GMM Core Network
Capability in the Registration Request and the Requested NSSAI includes
S-NSSAIs which map to HPLMN S-NSSAIs subject to Network Slice-Specific
Authentication and Authorization, the AMF includes those S-NSSAIs in the
Requested NSSAI in the Rejected S-NSSAIs.
If no S-NSSAI can be provided in the Allowed NSSAI because:
\- all the S-NSSAI(s) in the Requested NSSAI are to be subject to Network
Slice-Specific Authentication and Authorization; or
\- no Requested NSSAI was provided or none of the S-NSSAIs in the Requested
NSSAI matches any of the Subscribed S-NSSAIs and all the S-NSSAI(s) marked as
default in the Subscribed S-NSSAIs are to be subject to Network Slice-Specific
Authentication and Authorization.
The AMF shall provide an empty Allowed NSSAI. Upon receiving an empty Allowed
NSSAI and a Pending NSSAI, the UE is registered in the PLMN but shall wait for
the completion of the Network Slice-Specific Authentication and Authorization
procedure without attempting to use any service provided by the PLMN on any
access, except e.g. emergency services (see TS 24.501 [25]), until the UE
receives an Allowed NSSAI.
The AMF stores the NB-IoT Priority retrieved in Step 14 and associates it to
the 5G-S-TMSI allocated to the UE.
If the Registration Request message received over 3GPP access does not include
any Paging Restriction Information, the AMF shall delete any stored Paging
Restriction Information for this UE and stop restricting paging accordingly.
If the Registration Request message received over 3GPP access includes the
Paging Restriction Information, AMF may accept or reject the Paging
Restriction Information requested by the UE based on operator policy. If the
AMF rejects the Paging Restriction Information, the AMF removes any stored
Paging Restriction Information from the UE context and discards the UE
requested Paging Restriction Information. If the AMF accepts the Paging
Restriction Information from the UE, the AMF stores the Paging Restriction
Information from the UE in the UE context and informs the UE about the
acceptance/rejection of the requested Paging Restriction Information in the
Registration Accept message.
If the Registration Request message received over 3GPP access includes a
Release Request indication, then:
\- the AMF updates the UE context with any received Paging Restriction
Information, then enforces it in the network triggered Service Request
procedure as described in clause 4.2.3.3;
\- the AMF does not establish User Plane resources and triggers the AN release
procedure as described in clause 4.2.6 after the completion of Registration
procedure.
The AMF sends a Registration Accept message to the UE indicating that the
Registration Request has been accepted. 5G-GUTI is included if the AMF
allocates a new 5G-GUTI. Upon receiving a Registration Request message of type
\"Initial Registration\", \"mobility registration update\", \"Disaster Roaming
Initial Registration\" or \"Disaster Roaming Mobility Registration Update\"
from the UE, the AMF shall include a new 5G-GUTI in the Registration Accept
message. Upon receiving a Registration Request message of type \"periodic
registration update\" from the UE, the AMF should include a new 5G-GUTI in the
Registration Accept message. If the UE is already in RM-REGISTERED state via
another access in the same PLMN, the UE shall use the 5G-GUTI received in the
Registration Accept for both registrations. If no 5G-GUTI is included in the
Registration Accept, then the UE uses the 5G-GUTI assigned for the existing
registration also for the new registration. If the AMF allocates a new
Registration area, it shall send the Registration area to the UE via
Registration Accept message. For a Disaster Roaming Registration, the AMF
allocates the Registration Area limited to the area with Disaster Condition as
specified in clause 5.40 of TS 23.501 [2]. If there is no Registration area
included in the Registration Accept message, the UE shall consider the old
Registration Area as valid. Mobility Restrictions is included if mobility
restrictions applies for the UE and Registration Type is not Emergency
Registration. The AMF indicates the established PDU Sessions to the UE in the
PDU Session status. The UE removes locally any internal resources related to
PDU Sessions that are not marked as established in the received PDU Session
status. If the AMF invokes the Nsmf_PDUSession_UpdateSMContext procedure for
UP activation of PDU Session(s) in step 18 and receives rejection from the
SMF, then the AMF indicates to the UE the PDU Session ID and the cause why the
User Plane resources were not activated. When the UE is connected to the two
AMFs belonging to different PLMN via 3GPP access and non-3GPP access then the
UE removes locally any internal resources related to the PDU Session of the
current PLMN that are not marked as established in received PDU Session
status. If the PDU Session status information was in the Registration Request,
the AMF shall indicate the PDU Session status to the UE.
If the RAT Type is NB-IoT and the network is configured to use the Control
Plane Relocation Indication procedure then the AMF shall include in the
Registration Accept message the Truncated 5G-S-TMSI Configuration that the UE
using Control Plane CIoT 5GS Optimisation uses to create the Truncated 5G-S-
TMSI, see clause 5.31.4.3 of TS 23.501 [2].
The Allowed NSSAI provided in the Registration Accept is valid in the
Registration Area and it applies for all the PLMNs which have their Tracking
Areas included in the Registration Area. The Mapping Of Allowed NSSAI is the
mapping of each S-NSSAI of the Allowed NSSAI to the HPLMN S-NSSAIs. The
Mapping Of Configured NSSAI is the mapping of each S-NSSAI of the Configured
NSSAI for the Serving PLMN to the HPLMN S-NSSAIs.
For non-roaming UE, if the UE has indicated its support of Slice Usange Policy
in the UE 5GMM Core Network Capability, the AMF may include Slice Usage
Policies for the slices in the Configured NSSAI as described in clause 5.15.15
of TS 23.501 [2]. In the Slice Usage Policy, the AMF indicates if an S-NSSAI
is on demand slice and slice deregistration inactivity timer value. If the AMF
includes slice deregistration timer value, the UE starts any slice
deregistration inactivity timer for the on demand S-NSSAIs as described in
clause 5.15.15 of TS 23.501 [2].
If the UE has indicated its support of the subscription-based restrictions to
simultaneous registration of network slices feature in the UE 5GMM Core
Network Capability, the AMF includes, if available, the NSSRG Information,
defined in clause 5.15.12 of TS 23.501 [2].
If the UE has not indicated its support of the subscription-based restrictions
to simultaneous registration of network slices feature and the subscription
information for the UE includes NSSRG information and the AMF is providing the
Configured NSSAI to the UE, the Configured NSSAI shall include the S-NSSAIs
according to clause 5.15.12 of TS 23.501 [2].
If the UE has indicated its support of the NSAG feature in the 5GMM Core
Network Capability, the AMF includes, if available, the NSAG Information,
defined in clause 5.15.14 of TS 23.501 [2].
The AMF shall include in the Registration Accept message the LADN Information
for the list of LADNs, described in clause 5.6.5 of TS 23.501 [2], that are
available within the Registration area determined by the AMF for the UE. If
the UE indicates its support of LADN per DNN and S-NSSAI in the UE MM Core
Network Capability, the AMF may include LADN Information per DNN and S-NSSAI.
The AMF may include Operator-defined access category definitions to let the UE
determinine the applicable Operator-specific access category definitions as
described in TS 24.501 [25].
If the UE included MICO mode in the Registration Request, then AMF responds in
the Registration Accept message whether MICO mode should be used. When MICO
mode is allowed for the UE, the AMF may include an Active Time value and/or
Strictly Periodic Registration Timer Indication in the Registration Accept
message. The AMF determines the Periodic Registration Update timer value,
Active Time value and the Strictly Periodic Registration Timer Indication
based on:
\- local configuration;
\- Expected UE Behaviour if available;
\- UE indicated preferences;
\- UE capability;
\- UE subscription information;
\- if using a RAN that provides discontinuous coverage, UE availability (see
clause 5.4.13.1 of TS 23.501 [2]); and
\- network policies,
or any combination of them so as to enable UE power saving, as described in
clause 5.31.7 of TS 23.501 [2]. The AMF determines to apply the Strictly
Periodic Registration Timer Indication to the UE if the UE indicates its
capability of the Strictly Periodic Registration Timer Indication in the
registration request message, as described in step 1. If the AMF provides the
Periodic Registration Update timer value with the Strictly Periodic
Registration Timer Indication to the UE, the UE and the AMF start the Periodic
Registration Update timer after this step, as described in clause 5.31.7.5 of
TS 23.501 [2].
In the case of registration over 3GPP access, the AMF Sets the IMS Voice over
PS session supported Indication as described in clause 5.16.3.2 of TS 23.501
[2]. In order to set the IMS Voice over PS session supported Indication the
AMF may need to perform the UE Capability Match Request procedure in clause
4.2.8a to check the compatibility of the UE and NG-RAN radio capabilities
related to IMS Voice over PS. If the AMF hasn\'t received Voice Support Match
Indicator from the NG-RAN on time then, based on implementation, AMF may set
IMS Voice over PS session supported Indication and update it at a later stage.
In the case of registration over 3GPP access and the AMF has retrieved or
determined according to local configuration a Target NSSAI and a corresponding
RFSP Index for the purpose of allowing the NG-RAN to redirect the UE to a cell
supporting network slices not available in the current TA as described in
clause 5.3.4.3.3 of TS 23.501 [2], the AMF provides the Target NSSAI and the
corresponding RFSP Index to the NG-RAN.
In the case of registration over non-3GPP access, the AMF Sets the IMS Voice
over PS session supported Indication as described in clause 5.16.3.2a of TS
23.501 [2].
The Emergency Service Support indicator informs the UE that emergency services
are supported, i.e. the UE is allowed to request PDU Session for emergency
services. If the AMF received \"MPS priority\" from the UDM as part of Access
and Mobility Subscription data, based on operator policy, \"MPS priority\" is
included in the Registration Accept message to the UE to inform the UE whether
configuration of Access Identity 1 is valid within the selected PLMN, as
specified in TS 24.501 [25]. If the AMF received \"MCX priority\" from the UDM
as part of Access and Mobility Subscription data, based on operator policy and
UE subscription to MCX Services, \"MCX priority\" is included in the
Registration Accept message to the UE to inform the UE whether configuration
of Access Identity 2 is valid within the selected PLMN, as specified in TS
24.501 [25].
The Accepted DRX parameters are defined in clause 5.4.5 of TS 23.501 [2]. The
AMF includes Accepted DRX parameters for NB-IoT, if the UE included Requested
DRX parameters for NB-IoT in the Registration Request message. The AMF Sets
the Network support of Interworking without N26 parameter as described in
clause 5.17.2.3.1 of TS 23.501 [2]. If the AMF accepts the use of extended
idle mode DRX, the AMF includes the extended idle mode DRX parameters and
Paging Time Window as described in 5.31.7.2 of TS 23.501 [2]. For a UE using
NR satellite access that provides discontinuous coverage, the AMF may
determine extended idle mode DRX parameters and Paging Time Window considering
the Unavailability Period Duration (if available), Start of Unavailability
Period (if available) and the UE requested extended idle mode DRX parameters
as described in clause 5.4.13.1 of TS 23.501 [2].
If the UDM intends to indicate the UE that subscription has changed, the
Network Slicing Subscription Change Indication is included. If the AMF
includes Network Slicing Subscription Change Indication, then the UE shall
locally erase all the network slicing configuration for all PLMNs and if
applicable, update the configuration for the current PLMN based on any
received information.
The Access Stratum Connection Establishment NSSAI Inclusion Mode, as specified
in clause 5.15.9 of TS 23.501 [2], is included to instruct the UE on what
NSSAI, if any, to include in the Access Stratum connection establishment. The
AMF can set the value to modes of operation a,b,c defined in clause 5.15.9 of
TS 23.501 [2] in the 3GPP Access only if the Inclusion of NSSAI in RRC
Connection Establishment Allowed indicates that it is allowed to do so.
For a UE registered in a PLMN, the AMF may provide a List of equivalent PLMNs
which is handled as specified in TS 24.501 [25]. The AMF shall not provide a
list of equivalent SNPNs to the UE.
For a UE registered in an SNPN and the UE has included support of equivalent
SNPNs in step 1, the AMF may provide a List of equivalent SNPNs which is
handled as specified in TS 24.501 [25]. The AMF shall not provide a list of
equivalent PLMNs to the UE.
If the UE included support for restriction of use of Enhanced Coverage in step
1, the AMF sends the Enhanced Coverage Restricted information to the NG-RAN in
N2 message. The AMF also sends Enhanced Coverage Restricted information to the
UE in the Registration Accept message.
If the UE receives Enhanced Coverage Restricted information in the
Registration Accept message, the UE shall store this information and shall use
the value of Enhanced Coverage Restricted information to determine if Enhanced
Coverage feature should be used or not.
If the UE and the AMF have negotiated to enable MICO mode and the AMF uses the
Extended connected timer, then the AMF provides the Extended Connected time
value to NG-RAN (see clause 5.31.7.3 of TS 23.501 [2]) in this step. The
Extended Connected Time value indicates the minimum time the RAN should keep
the UE in RRC_CONNECTED state regardless of inactivity. For a UE using NR
satellite access that provides discontinuous coverage, the AMF may determine
the Extended Connected Timer value considering the Unavailability Period
Duration (if available), Start of Unavailability Period (if available) as
described in clause 5.4.13.1 of TS 23.501 [2].
The AMF indicates the CIoT 5GS Optimisations it supports and accepts in the
Supported Network Behaviour information (see clause 5.31.2 of TS 23.501 [2])
if the UE included Preferred Network Behaviour in its Registration Request.
The AMF may steer the UE from 5GC by rejecting the Registration Request. The
AMF should take into account the Preferred and Supported Network Behaviour
(see clause 5.31.2 of TS 23.501 [2]) and availability of EPC to the UE before
steering the UE from 5GC.
If the AMF accepts MICO mode and knows there may be mobile terminated data or
signalling pending, the AMF maintains the N2 connection for at least the
Extended Connected Time as described in clause 5.31.7.3 of TS 23.501 [2] and
provides the Extended Connected Time value to the RAN.
The AMF includes Service Gap Time if Service Gap Time is present in the
subscription information (steps 14a-c) or the Service Gap Time has been
updated by the Subscriber Data Update Notification to AMF procedure (see
clause 4.5.1) and the UE has indicated UE Service Gap Control Capability.
If the UE receives a Service Gap Time in the Registration Accept message, the
UE shall store this parameter and apply Service Gap Control (see clause
5.31.16 of TS 23.501 [2]).
If the network supports WUS grouping (see TS 23.501 [2]), the AMF shall send
the WUS Assistance Information to the UE. If the UE provided the UE paging
probability information in Step 1, the AMF takes it into account to determine
the WUS Assistance Information.
If the UE provided Paging Subgrouping Support Indication in step 1, a
supporting AMF may provide the AMF PEIPS Assistance Information, including the
Paging Subgroup ID as defined in TS 23.501 [2].
When the UE and the AMF supports RACS as defined in clause 5.4.4.1a of TS
23.501 [2] and the AMF needs to configure the UE with a UE Radio Capability ID
and the AMF already has the UE radio capabilities other than NB-IoT radio
capabilities for the UE, the AMF may provide the UE with the UE Radio
Capability ID for the UE radio capabilities the UCMF returns to the AMF in a
Nucmf_assign service operation for this UE. Alternatively, when the UE and the
AMF support RACS, the AMF may provide the UE with an indication to delete any
PLMN-assigned UE Radio Capability ID in this PLMN (see clause 5.4.4.1a of TS
23.501 [2]).
If the UE is \"CAG supported\" and the AMF needs to update the CAG information
of the UE, the AMF may include the CAG information as part of the Mobility
Restrictions in the Registration Accept message.
If the UE has indicated the support of Unavailability Period, the AMF shall
indicate to the UE whether the corresponding feature is supported by providing
the Unavailability Period Supported indication.
If the UE has provided Unavailability Period Duration and/or Start of
Unavailability Period in step 1, the AMF shall store the received
Unavailability Period Duration and/or Start of Unavailability Period in UE
context. The AMF considers that the UE is unavailable at the start of
unavailability period as described in clause 5.4.1.4 of TS 23.501 [2]. The AMF
may provide Periodic Registration Update timer based on Unavailability Period
Duration and/or Start of Unavailability Period indicated by the UE as
described in clause 5.4.1.4 of TS 23.501 [2].
If the Multi-USIM UE has indicated support for one or more Multi-USIM Specific
Capabilities in the UE 5GMM Core Network Capability in step 1, the AMF shall
indicate to the Multi-USIM UE whether the corresponding one or more Multi-USIM
specific features described in clause 5.38 of TS 23.501 [2] are supported,
based on network capability and preference by the network (i.e. based on local
network policy), by providing one or more of the Connection Release Supported,
Paging Cause Indication for Voice Service Supported, Paging Restriction
Supported and Reject Paging Request Supported indications. The AMF shall only
indicate Paging Restriction Supported together with either Connection Release
Supported or Reject Paging Request Supported. The UE shall only use Multi-USIM
specific features that the AMF indicated as being supported.
If the NG-RAN provides MBSR indication in step 3 and the subscription data
received in step 14 does not allow the MBSR operation, the AMF may either
accept or reject the registration as specified in clause 5.35A.4 of TS 23.501
[2] and provide the MBSR authorization information to MBSR (IAB-UE).
If the UE and AMF supports Disaster Roaming service, the AMF may include the
\"list of PLMN(s) to be used in Disaster Condition\", Disaster Roaming wait
range information and Disaster Return wait range information as specified in
TS 23.501 [2].
If AMF receives multiple TAIs from the NG-RAN in step 3 and determines that
some, but not all of them are forbidden by subscription or by operator policy,
the AMF shall include the forbidden TAI(s) in the Registration Accept message.
In the case of Emergency Registration, the AMF shall not indicate support for
any Multi-USIM specific features to the UE.
If the UE has included support of equivalent SNPNs in step 1 and the serving
SNPN changes, the AMF shall include the Registered NID in the Registration
Accept message as specified in TS 23.501 [2].
For a UE using NR satellite access that provides discontinuous coverage, the
AMF may provide Return To Coverage Notification Not Required, which requests
the UE in CM-IDLE state to not perform the Mobility Registration Update
procedure when it returns to coverage and/or provide the UE with a
Unavailability Period Duration, as described in clause 5.4.13.1 of TS 23.501
[2]. The AMF may determine a Maximum Time Offset and provide it to UE when it
is allowed to initiate NAS signalling with the network as described in clause
5.4.13.5 of TS 23.501 [2].
If the UE has indicated the support of S-NSSAI location availability
information, the AMF may include S-NSSAI location availability information as
described in clause 5.15.18 of TS 23.501 [2].
If the UE indicated a support for the Network Slice Replacement feature in the
5GMM Core Network Capability and the AMF determines that an S-NSSAI from an
Allowed NSSAI is to be replaced with an Alternative S-NSSAI (as described in
clause 5.15.19 of TS 23.501 [2]), the AMF includes the Mapping Of Alternative
NSSAI within the Registration Accept message to the UE and also adds the
Alternative S-NSSAI to the Allowed NSSAI and/or Configured NSSAI, if not
already included. The Mapping Of Alternative NSSAI is the mapping of each
Alternative S-NSSAI, included in the Allowed NSSAI and/or Configured NSSAI, to
the corresponding replaced VPLMN S-NSSAI or HPLMN S-NSSAI (as described in
clause 5.15.19 of TS 23.501 [2]).
If the UE has indicated a support for reconnection to the network due to RAN
timing synchronization status in step 1 as described in TS 23.501 [2], and if
the AMF received \"clock quality detail level\" either as part of an AM Policy
Association procedure or from the UDM as part of Clock Quality Reporting
Control Information (CQRCI) included in the Access and Mobility Subscription
data, \"UE reconnection indication\" is included in the Registration Accept
message to the UE to inform the UE when to connect to the network in case when
the UE later detects that the NG-RAN timing synchronization status has changed
while the UE is in RRC IDLE or RRC INACTIVE state, as specified in clause
5.27.1.12 of TS 23.501 [2].
21b. [Optional] The new AMF performs a UE Policy Association Establishment as
defined in clause 4.16.11. For an Emergency Registration, this step is
skipped.
The new AMF sends a Npcf_UEPolicyControl Create Request to PCF. PCF sends a
Npcf_UEPolicyControl Create Response to the new AMF.
PCF triggers UE Configuration Update Procedure as defined in clause 4.2.4.3.
22\. [Conditional] UE to new AMF: Registration Complete ().
The UE sends a Registration Complete message to the AMF when it has
successfully updated itself after receiving any of the [Configured NSSAI for
the Serving PLMN], [Mapping Of Configured NSSAI], [NSSRG Information], [NSAG
Information] and a Network Slicing Subscription Change Indication, or CAG
information in step 21.
The UE sends a Registration Complete message to the AMF to acknowledge if a
new 5G-GUTI was assigned.
If new 5G-GUTI was assigned, then the UE passes the new 5G-GUTI to its 3GPP
access\' lower layer when a lower layer (either 3GPP access or non-3GPP
access) indicates to the UE\'s RM layer that the Registration Complete message
has been successfully transferred across the radio interface.
NOTE 13: The above is needed because the NG-RAN may use the RRC_INACTIVE state
and a part of the 5G-GUTI is used to calculate the Paging Frame (see TS 38.304
[44] and TS 36.304 [43]). It is assumed that the Registration Complete is
reliably delivered to the AMF after the 5G-AN has acknowledged its receipt to
the UE.
When the List Of PDU Sessions To Be Activated is not included in the
Registration Request and the Registration procedure was not initiated in CM-
CONNECTED state, the AMF releases the signalling connection with UE, according
to clause 4.2.6.
When the Follow-on request is included in the Registration Request, the AMF
should not release the signalling connection after the completion of the
Registration procedure.
If the AMF is aware that some signalling is pending in the AMF or between the
UE and the 5GC, the AMF should not release the signalling connection
immediately after the completion of the Registration procedure.
If the UE has provided Unavailability Period Duration and not included Start
of Unavailability Period in step 1, the AMF shall release the signalling
connection immediately after the completion of the Registration procedure.
If the UE has indicated Start of Unavailability Period in step 1, the AMF
shall release the signalling connection before the start of unavailability
period.
If PLMN-assigned UE Radio Capability ID is included in step 21, the AMF stores
the PLMN-assigned UE Radio Capability ID in UE context if receiving
Registration Complete message.
If the UE receives PLMN-assigned UE Radio Capability ID deletion indication in
step 21, the UE shall delete the PLMN-assigned UE Radio Capability ID(s) for
this PLMN.
23\. [Conditional] AMF to UDM: If the Access and Mobility Subscription data
provided by UDM to AMF in 14b includes Steering of Roaming information with an
indication that the UDM requests an acknowledgement of the reception of this
information from the UE, the AMF provides the UE acknowledgement to UDM using
Nudm_SDM_Info. For more details regarding the handling of Steering of Roaming
information refer to TS 23.122 [22].
23a. For Registration over 3GPP Access, if the AMF does not release the
signalling connection, the AMF sends the RRC Inactive Assistance Information
to the NG-RAN.
For Registration over non-3GPP Access, if the UE is also in CM-CONNECTED state
on 3GPP access, the AMF sends the RRC Inactive Assistance Information to the
NG-RAN. If the Multi-USIM UE has indicated support for the Paging Cause
Indication for Voice Service feature and the network supports the Paging Cause
Indication for Voice Service, the AMF shall include an indication in the RRC
Inactive Assistance Information that the UE supports the Paging Cause
Indication for Voice Service to NG-RAN to enable NG-RAN to apply the Paging
Cause Indication for Voice Service feature for RAN based paging.
The AMF also uses the Nudm_SDM_Info service operation to provide an
acknowledgment to UDM that the UE received CAG information, or the Network
Slicing Subscription Change Indication (see step 21 and step 22) and acted
upon it.
24\. [Conditional] AMF to UDM: After step 14a and in parallel to any of the
preceding steps, the AMF shall send a \"Homogeneous Support of IMS Voice over
PS Sessions\" indication to the UDM using Nudm_UECM_Update:
\- If the AMF has evaluated the support of IMS Voice over PS Sessions, see
clause 5.16.3.2 of TS 23.501 [2]; and
\- If the AMF determines that it needs to update the Homogeneous Support of
IMS Voice over PS Sessions, see clause 5.16.3.3 of TS 23.501 [2].
25\. [Conditional] If the UE indicates its support for Network Slice-Specific
Authentication and Authorization procedure in the UE MM Core Network
Capability in Registration Request and any S-NSSAI of the HPLMN is subject to
Network Slice-Specific Authentication and Authorization, the related procedure
is executed at this step (see clause 4.2.9.1). Once the Network Slice-Specific
Authentication and Authorization procedure is completed for all S-NSSAIs, the
AMF shall trigger a UE Configuration Update procedure to deliver an Allowed
NSSAI (or Partially Allowed NSSAI) containing also the S-NSSAIs for which the
Network Slice-Specific Authentication and Authorization was successful and
include any rejected NSSAIs with an appropriate rejection cause value.
The AMF stores an indication in the UE context for any S-NSSAI of the HPLMN
subject to Network Slice-Specific Authentication and Authorization for which
the Network Slice-Specific Authentication and Authorization succeeds.
Once completed the Network Slice-Specific Authentication and Authorization
procedure, if the AMF determines that no S-NSSAI can be provided in the
Allowed NSSAI for the UE, which is already authenticated and authorized
successfully by a PLMN and if no default S-NSSAI(s) could be further
considered, the AMF shall execute the Network-initiated Deregistration
procedure described in clause 4.2.2.3.3 and shall include in the explicit De-
Registration Request message the list of Rejected S-NSSAIs, each of them with
the appropriate rejection cause value.
If Unavailability Period Duration is received from the UE and there is \"Loss
of Connectivity\" monitoring event subscription for the UE, the AMF triggers
\"Loss of Connectivity\" monitoring event report and includes the remaining
values of the Unavailability Period Duration as described in clause 4.15.
The mobility related event notifications towards the NF consumers are
triggered at the end of this procedure for cases as described in clause
4.15.4.
##### 4.2.2.2.3 Registration with AMF re-allocation
When an AMF receives a Registration request, the AMF may need to reroute the
Registration request to another AMF, e.g. when the initial AMF is not the
appropriate AMF to serve the UE. The Registration with AMF re-allocation
procedure, described in figure 4.2.2.2.3-1, is used to reroute the NAS message
of the UE to the target AMF during a Registration procedure.
Figure 4.2.2.2.3-1: Registration with AMF re-allocation procedure
The initial AMF and the target AMF register their capability at the NRF.
1\. If the UE is in CM-IDLE State, steps 1 and 2 of figure 4.2.2.2.2-1 have
occurred and the (R)AN sends the Registration request message within an
Initial UE message to the initial AMF. If the UE is in CM-CONNECTED state and
triggers registration procedure, the NG-RAN sends Registration request message
in the Uplink NAS Transport message to the serving AMF which is initial AMF.
The AMF may skip step 2-3.
2\. If the AMF needs the SUPI and/or UE\'s subscription information to decide
whether to reroute the Registration Request or if the Registration Request was
not sent integrity protected or integrity protection is indicated as failed,
then AMF performs steps 4 to 9a or to 9b of figure 4.2.2.2.2-1.
3a. [Conditional] If the initial AMF needs UE\'s subscription information to
decide whether to reroute the Registration Request and UE\'s slice selection
subscription information was not provided by old AMF, the AMF selects a UDM as
described in clause 6.3.8 of TS 23.501 [2].
3b. Initial AMF to UDM: Nudm_SDM_Get (SUPI, Slice Selection Subscription
data).
The initial AMF request UE\'s Slice Selection Subscription data from UDM by
invoking the Nudm_SDM_Get (see clause 5.2.3.3.1) service operation. UDM may
get this information from UDR by Nudr_DM_Query(SUPI, Slice Selection
Subscription data).
For a Disaster Roaming Registration, the AMF may provide the indication of
Disaster Roaming service to the UDM.
3c. UDM to initial AMF: Response to Nudm_SDM_Get. The AMF gets the Slice
Selection Subscription data including Subscribed S-NSSAIs.
UDM responds with slice selection subscription data to initial AMF.
For a Disaster Roaming Registration, the UDM responds with the slice selection
subscription data for a Disaster Roaming service to initial AMF based on the
local policy and/or the local configuration as specified in clause 5.40.4 of
TS 23.501 [2].
4a. [Conditional] Initial AMF to NSSF: Nnssf_NSSelection_Get (Requested NSSAI,
[Mapping Of Requested NSSAI], Subscribed S-NSSAI(s) with the default S-NSSAI
indication, [NSSRG Information], TAI, Allowed NSSAI for the other access type
(if any), [Mapping of Allowed NSSAI], PLMN ID of the SUPI).
If there is a need for slice selection, (see clause 5.15.5.2.1 of TS 23.501
[2]), e.g. the initial AMF cannot serve all the S-NSSAI(s) from the Requested
NSSAI permitted by the subscription information, the initial AMF invokes the
Nnssf_NSSelection_Get service operation from the NSSF by including Requested
NSSAI, optionally Mapping Of Requested NSSAI, Subscribed S-NSSAIs with the
default S-NSSAI indication, [NSSRG Information], Allowed NSSAI for the other
access type (if any), Mapping of Allowed NSSAI, PLMN ID of the SUPI and the
TAI of the UE. If the AMF needs to indicate the NSSF to return the Configured
NSSAI to obtain network slice configuration when it receives from the UDM an
indication that subscription has changed for the UE (see step 14b of clause
4.2.2.2.2) to ensure that the information returned by the NSSF includes the
new Configured NSSAI for the UE which can be used to update UE network slicing
configuration (see step 21 of clause 4.2.2.2.2), the AMF indicates the NSSF
that the AMF needs a Configured NSSAI.
The AMF includes, if available, the NSSRG Information for the S-NSSAIs of the
HPLMN, defined in clause 5.15.12 of TS 23.501 [2], including information
whether the UE has indicated support of the subscription-based restrictions to
simultaneous registration of network slices and whether the UDM has indicated
to provide all subscribed S-NSSAIs for non-supporting UEs.
If the UE context includes Partially Allowed NSSAI, then the AMF includes the
S-NSSAIs of the Partially Allowed NSSAI in the Allowed NSSAI and includes the
corresponding HPLMN S-NSSAI in the Mapping Of Allowed NSSAI.
4b. [Conditional] NSSF to Initial AMF: Response to Nnssf_NSSelection_Get (AMF
Set or list of AMF addresses, Allowed NSSAI for the first access type,
[Mapping Of Allowed NSSAI], [Allowed NSSAI for the second access type],
[Mapping of Allowed NSSAI], [NSI ID(s)], [NRF(s)], [List of rejected
(S-NSSAI(s), cause value(s))], [Configured NSSAI for the Serving PLMN],
[Mapping Of Configured NSSAI]).
The NSSF performs the steps specified in point (B) in clause 5.15.5.2.1 of TS
23.501 [2]. The NSSF returns to initial AMF the Allowed NSSAI for the first
access type, optionally the Mapping Of Allowed NSSAI, the Allowed NSSAI for
the second access type (if any), optionally the Mapping of Allowed NSSAI and
the target AMF Set or, based on configuration, the list of candidate AMF(s).
The NSSF may return NSI ID(s) associated to the Network Slice instance(s)
corresponding to certain S-NSSAI(s). The NSSF may return the NRF(s) to be used
to select NFs/services within the selected Network Slice instance(s). It may
return also information regarding rejection causes for S-NSSAI(s) not included
in the Allowed NSSAI. The NSSF may return Configured NSSAI for the Serving
PLMN and possibly the associated mapping of the Configured NSSAI. If the NSSRG
information was included in the request, the NSSF provides the Configured
NSSAI as described in clause 5.15.12 of TS 23.501 [2].
NOTE 1: The NRF(s) returned by the NSSF, if any, belong to any level of NRF
(see clause 6.2.6 of TS 23.501 [2]) according to the deployment decision of
the operator.
5\. [Conditional] Initial AMF to old AMF:
Namf_Communication_RegistrationStatusUpdate (failure cause ).
If the UE was in CM-IDLE and another AMF is selected, the initial AMF sends a
reject indication to the old AMF telling that the UE Registration procedure
did not fully complete at the initial AMF. The old AMF continues as if the
Namf_Communication_UEContextTransfer had never been received.
6a. [Conditional] Initial AMF to NRF: Nnrf_NFDiscovery_Request (NF type, AMF
Set).
If the initial AMF does not locally store the target AMF address and if the
initial AMF intends to use direct reroute to target AMF or the reroute via
(NG-R)AN message needs to include AMF address, then the initial AMF invokes
the Nnrf_NFDiscovery_Request service operation from the NRF to find a proper
target AMF which has required NF capabilities to serve the UE. The NF type is
set to AMF. The AMF Set is included in the Nnrf_NFDiscovery_Request.
6b. [Conditional] NRF to AMF: Response to Nnrf_NFDiscovery_Request (list of
(AMF pointer, AMF address, plus additional selection rules and NF
capabilities)).
The NRF replies with the list of potential target AMF(s). The NRF may also
provide the details of the services offered by the candidate AMF(s) along with
the notification end-point for each type of notification service that the
selected AMF had registered with the NRF, if available. As an alternative, it
provides a list of potential target AMFs and their capabilities and
optionally, additional selection rules. Based on the information about
registered NFs and required capabilities, a target AMF is selected by the
initial AMF.
If the security association has been established between the UE and initial
AMF, to avoid a registration failure, the initial AMF shall forward the NAS
message to the target AMF by executing step 7(A).
NOTE 2: The security context in the initial AMF is not transferred to the
target AMF if initial AMF forward the NAS message to the target AMF via (R)AN.
In this case the UE rejects the NAS message sent from target AMF as the
security context in the UE and target AMF are not synchronized.
NOTE 3: Network slice isolation cannot be completely maintained in case the
AMF reallocation is executed by step 7(A).
If the initial AMF is not part of the target AMF Set and is not able to get a
list of candidate AMF(s) by querying the NRF with the target AMF Set (e.g. the
NRF locally pre-configured on AMF does not provide the requested information,
the query to the appropriate NRF provided by the NSSF is not successful, or
the initial AMF has knowledge that the initial AMF is not authorized as
serving AMF etc.) then the initial AMF shall forward the NAS message to the
target AMF via (R)AN executing step 7(B) unless the security association has
been established between the UE and initial AMF; the Allowed NSSAI, optionally
the Partially Allowed NSSAI and the AMF Set are included to enable the (R)AN
to select the target AMF as described in clause 6.3.5 of TS 23.501 [2].
7(A). If the initial AMF, based on local policy and subscription information,
decides to forward the NAS message to the target AMF directly, the initial AMF
invokes the Namf_Communication_N1MessageNotify to the target AMF, carrying the
rerouted NAS message. The Namf_Communication_N1MessageNotify service operation
includes AN access information (e.g. the information enabling (R)AN to
identify the N2 terminating point, CAG Identifier(s) of the CAG cell) and the
complete Registration Request message in clear text as specified in TS 33.501
[15] and the UE\'s SUPI and MM Context if available. If the initial AMF has
obtained the information from the NSSF as described at step 4b, that
information except the AMF Set or list of AMF addresses is included. The
target AMF then updates the (R)AN with a new updated N2 termination point for
the UE in the first message from target AMF to RAN in step 8.
7(B). [Conditional] if the UE was in CM-IDLE, if the initial AMF, based on
local policy and subscription information, decides to forward the NAS message
to the target AMF via (R)AN unless the target AMF(s) are returned from the
NSSF and identified by a list of candidate AMF(s), the initial AMF sends a
NGAP Reroute NAS Request message to the (R)AN (step 7a). The NGAP Reroute
Request NAS message includes the information about the target AMF and the
complete Registration Request message. If the initial AMF has obtained the
information as described at step 4b, that information is included. The (R)AN
sends the Initial UE message to the target AMF (step 7b) indicating reroute
due to slicing including the information from step 4b that the NSSF provided.
NOTE 4: Step 7B is not supported if the UE was in CM-CONNECTED i.e. the NGAP
Uplink NAS Transport message was received at step 1.
8\. After receiving the Registration Request message transmitted at step 7(A)a
or step 7(B)b, the target AMF continues with the Registration procedure from
step 4 until 22 of figure 4.2.2.2.2-1 (with the target AMF corresponding to
the new AMF), which includes the UE context retrieved from old AMF. If the 5G
security context is received from the initial AMF, the target AMF continue
using that one instead of the 5G security context the target AMF may have
retrieved from the old AMF. If the initial AMF decides to forward the NAS
message to the target AMF (step 7(A), the first message from the target AMF to
(R)AN (either Initial Context Setup Request, or Downlink NAS Transport)
contain the AMF name of the initial AMF and target AMF UE NGAP ID.
##### 4.2.2.2.4 Registration with Onboarding SNPN
This clause specifies how a UE can register to an ON-SNPN for provisioning the
UE with SO-SNPN credentials and other information to enable SNPN access as
defined in clause 5.30.2.10 of TS 23.501 [2].
The Registration procedure for Onboarding SNPN shall be supported as specified
in clause 4.2.2.2.2 with the following changes compared to the steps in the
call flow represented in Figure 4.2.2.2.2-1, covering three cases, i.e. when
DCS is hosting AAA Server and when DCS is hosting AUSF/UDM and when DCS is not
involved, as shown in Figure 4.2.2.2.4-1.
Figure 4.2.2.2.4-1: UE Registration with ON-SNPN
1\. UE to NG-RAN: AN parameters shall include Onboarding indication if the UE
is accessing 5GS for Onboarding. The Registration Type \"SNPN Onboarding\"
indicates that the UE wants to perform SNPN Onboarding Registration (i.e.
allows the UE to access an ON-SNPN for the purpose of provisioning the UE with
SO-SNPN credentials). For SNPN Onboarding Registration, a SUCI generated from
a SUPI derived from Default UE Credentials shall be included as described in
clause 5.30.2.10.2.6 of TS 23.501 [2].
If the UE has registered in the ON-SNPN for onboarding, the UE can perform a
Mobility Registration Update, or a Periodic Registration Update as specified
in clause 4.2.2.2.2. If the onboarding registered UE wants to perform a
Mobility Registration Update the AN parameters shall also include an
Onboarding indication that the UE is registered for onboarding.
NOTE: When the UE is performing Registration for Onboarding to an ON-SNPN, the
UE does not include a Requested NSSAI as the UE is not pre-configured with a
S-NSSAI for the purpose of UE onboarding in the ON-SNPN.
2\. Based on the Onboarding indication in step 1, the NG-RAN selects an AMF as
described in clause 6.3.5 of TS 23.501 [2].
3\. NG-RAN to AMF: The N2 message contains the Registration Request as
described in step 1.
4\. [Conditional] new AMF to old AMF: Namf_Communication_UEContextTransfer
(complete Registration Request).
5\. [Conditional] old AMF to new AMF: Response to
Namf_Communication_UEContextTransfer (SUPI, UE Context in AMF (as per Table
5.2.2.2.2-1)). Once the registration is completed successfully, the new AMF
may start an implementation specific deregistration timer for when to
deregister the onboarding registered UE if the UE context contains the
indication that the UE is registered for onboarding.
6-7. Skipped.
8\. When the AMF receives a NAS Registration Request with the 5GS Registration
Type set to \"SNPN Onboarding\", the AMF applies locally configured AMF
Configuration Data for Onboarding in order to restrict UE network usage to
only onboarding and stores in the UE Context in AMF an indication that the UE
is registered for onboarding. The AMF selects an AUSF as described in clause
5.30.2.10.2.6 of TS 23.501 [2]. Based on ON-SNPN policies, the AMF may start
an implementation specific deregistration timer configured for UE Onboarding
as described in TS 23.501 [2].
9\. The authentication is performed as described in TS 33.501 [15].
For DCS hosting AAA Server as shown in step 9-1, based on local configuration
(e.g. using the realm part of the SUCI), the AUSF sends the SUPI towards the
AAA Server in the DCS domain via the NSSAAF, then the AAA Server in the DCS
domain authenticates the UE based on received data from AUSF. During
authentication procedure the AAA Server in the DCS domain may provide PVS
FQDN(s) and/or PVS IP address(es) for the UE to the AUSF via the NSSAAF, the
AUSF then provides PVS FQDN(s) and/or PVS IP address(es) to the AMF.
For DCS hosting AUSF/UDM as shown in step 9-2, the AUSF in DCS domain performs
UDM selection. The AMF sends the SUCI and Default UE credentials received from
the UE towards the AUSF in DCS domain, which authenticates the UE based on
received data from AMF and subscription data from the UDM in DCS domain.
During authentication procedure, the AUSF in the DCS domain provides PVS
FQDN(s) and/or PVS IP address(es) to the AMF.
When DCS is not involved during primary authentication as shown in step 9-3,
the AMF selects a local AUSF as defined in clause 6.3.4 of TS 23.501 [2] and
performs primary authentication towards the local AUSF using Default UE
credentials as described in TS 33.501 [15].
10\. [Conditional] new AMF to old AMF:
Namf_Communication_RegistrationStatusUpdate.
11\. [Conditional] AMF to UE: Identity Request/Response (PEI).
If the PEI was not provided by the UE, the Identity Request procedure is
initiated by AMF sending an Identity Request message to the UE to retrieve the
PEI.
12\. Optionally the new AMF initiates ME identity check by invoking the
N5g-eir_EquipmentIdentityCheck_Get service operation (see clause 5.2.4.2.2).
The PEI check is performed as described in clause 4.7.
13-20. Skipped.
21\. AMF to UE: The AMF sends a Registration Accept message to the UE
indicating that the Registration Request for Onboarding SNPN has been
accepted. The Allowed NSSAI containing the S-NSSAI from the AMF Onboarding
Configuration Data is included in the N2 message to NG-RAN.
21b. Skipped.
22\. UE to AMF: The UE sends a Registration Complete message to the AMF.
23-25. Skipped.
#### 4.2.2.3 Deregistration procedures
##### 4.2.2.3.1 General
The Deregistration procedure allows:
\- the UE to inform the network that it does not want to access the 5GS any
longer; and
\- the network to inform the UE that it does not have access to the 5GS any
longer; or
\- the network to inform the UE that the UE\'s Registered PLMN is not allowed
to operate at the UE location.
The Deregistration request by the UE and Deregistration request by the network
include whether the Deregistration applies to the 3GPP access, to the non-3GPP
access, or to both. When the UE is registered to both accesses in the same
PLMN, the Deregistration message can be sent over any access regardless of the
access the Deregistration is applied to.
Network-initiated Deregistration may be initiated if the UE\'s registered PLMN
is not allowed to operate in the present UE location.
##### 4.2.2.3.2 UE-initiated Deregistration
The UE uses this procedure to deregister from the registered PLMN as shown in
Figure 4.2.2.3.2-1.
Figure 4.2.2.3.2-1: UE-initiated Deregistration
1\. The UE sends NAS message Deregistration Request (5G-GUTI, Deregistration
type (e.g. Switch off), Access Type, [Unavailability Period Duration]) to the
AMF.
Access type indicates whether the Deregistration procedure applies to the 3GPP
access, to the non-3GPP access, or to both if the 3GPP access and non-3GPP
access of the UE are served by the same AMF (refer to TS 23.501 [2]). The AMF
shall invoke the Deregistration procedure for the target access indicated by
the UE.
If the UE and network support Unavailability Period and an event is triggered
in the UE that would make the UE unavailable for a period of time, the UE
includes Unavailability Period Duration as described in clause 5.4.1.4 of TS
23.501 [2].
2\. [Conditional] AMF to SMF (or V-SMF): Nsmf_PDUSession_ReleaseSMContext (SM
Context ID).
If the UE has no established PDU Session over the target access indicated in
step 1, then steps 2 to 5 are not executed. All PDU Sessions over the target
access(es), which belong to the UE are released by the AMF sending
Nsmf_PDUSession_ReleaseSMContext Request (SM Context ID) message to the SMF
(or V-SMF) for each PDU Session. If the AMF determines that the secondary RAT
usage reporting is required for the PDU Session, the AMF shall execute step 7
and 8 and then wait for the completion of step 8 to receive the secondary RAT
usage data from the NG-RAN. After that, steps 2 to 6 in this procedure are
performed to e.g. release the PDU Session(s).
For home routed roaming case, the V-SMF initiates the release of the PDU
Session at the H-SMF by invoking the Nsmf_PDUSession_Release request.
3\. [Conditional] The SMF (or H-SMF) releases all resources e.g. the IP
address / Prefix(es) that were allocated to the PDU Session and releases the
corresponding User Plane resources:
3a. [Conditional] The SMF (or H-SMF) sends N4 Session Release Request (N4
Session ID) message to the UPF(s) of the PDU Session. The UPF(s) shall drop
any remaining packets of the PDU Session and release all tunnel resource and
contexts associated with the N4 Session.
3b. [Conditional] The UPF(s) acknowledges the N4 Session Release Request by
the transmission of an N4 Session Release Response (N4 Session ID) message to
the SMF.
4\. [Conditional] The SMF (or V-SMF) responds with
Nsmf_PDUSession_ReleaseSMContext Response message.
For home routed roaming case, the H-SMF responds to the V-SMF with a
Nsmf_PDUSession_Release response. The V-SMF releases the corresponding User
Plane resources. The V-SMF responds to AMF with
Nsmf_PDUSession_ReleaseSMContext Response message.
5a. [Conditional] If dynamic PCC applied to this session the SMF performs an
SM Policy Association Termination procedure as defined in clause 4.16.6.
5b-c. [Conditional] If it is the last PDU Session the SMF is handling for the
UE for the associated (DNN, S-NSSAI), the SMF unsubscribes from Session
Management Subscription data changes notification with the UDM by means of the
Nudm_SDM_Unsubscribe service operation. The SMF invokes the
Nudm_UECM_Deregistration service operation so that the UDM removes the
association it had stored between the SMF identity and the associated DNN and
PDU Session Id.
6\. [Conditional] If there is any association with the PCF for this UE and the
UE is no more registered over any access, the AMF performs a AMF-initiated AM
Policy Association Termination procedure as defined in clause 4.16.3.2 delete
the association with the PCF.
6a. [Conditional] If there is any association with the PCF for this UE and the
UE is no more registered over any access, the AMF performs a AMF-initiated UE
Policy Association Termination procedure as defined in clause 4.16.13.1 delete
the association with the PCF.
7\. [Conditional] The AMF sends NAS message Deregistration Accept to UE
depending on the Deregistration type i.e. if Deregistration type is switch-
off, AMF does not send Deregistration Accept message.
7a [Conditional] If Unavailability Period Duration is received from the UE and
there is \"Loss of Connectivity\" monitoring event subscription for the UE,
the AMF triggers \"Loss of Connectivity\" monitoring event report and includes
the remaining value of the Unavailability Period Duration.
8\. [Conditional] AMF to AN: N2 UE Context Release Request (Cause)
If the target access for Deregistration procedure is 3GPP access or both 3GPP
access and non-3GPP access and there is N2 signalling connection to NG-RAN,
the AMF sends N2 UE Release command to NG-RAN with Cause set to Deregistration
to release N2 signalling connection. The details of this step are covered by
steps 2 to 4 in the AN Release procedure, as described in clause 4.2.6.
If the target access for Deregistration procedure is non-3GPP access or both
3GPP access and non-3GPP access and there is N2 signalling connection to the
N3IWF/TNGF/W-AGF, the AMF sends N2 UE Release command to N3IWF/TNGF/W-AGF with
Cause set to Deregistration to release N2 signalling connection. The details
of this step are covered by steps 2 to 5 in the \"Deregistration procedure for
(un)trusted non-3gpp access\", as described in clauses 4.12.3 / 4.12a.3 and in
clause 7.2.1 of TS 23.316 [53] for W-5GAN access.
##### 4.2.2.3.3 Network-initiated Deregistration
The procedure depicted in Figure 4.2.2.3.3-1 shows Network-initiated
Deregistration procedure. The AMF can initiate this procedure for either
explicit (e.g. by O&M intervention or if the AMF determines that no S-NSSAI
can be provided in the Allowed NSSAI for the UE or the UE\'s registered PLMN
is not allowed to operate in the present UE location or if a disaster
condition is no longer being applicable, the AMF initiates Network-initiated
Deregistration to trigger the return of UEs to the PLMN that had a Disaster
Condition) or implicit (e.g. expiring of Implicit Deregistration timer). The
UDM can trigger this procedure for operator-determined purposes (e.g. if a
disaster condition is no longer being applicable as specified in clause 5.40.5
of TS 23.501 [2]) to request the removal of a subscriber\'s RM context and PDU
Session(s) of the UE.
Figure 4.2.2.3.3-1: Network-initiated Deregistration
1\. [Conditional] If the UDM wants to request the immediate deletion of a
subscriber\'s RM contexts and PDU Sessions, the UDM shall send a
Nudm_UECM_DeregistrationNotification (SUPI, Access Type, Removal Reason)
message with Removal Reason set to Subscription Withdrawn to the registered
AMF. The Access Type may indicate 3GPP Access, non-3GPP Access or both.
2\. If the AMF receives Nudm_UECM_DeregistrationNotification in Step 1 with
Removal Reason as Subscription Withdrawn, the AMF executes Deregistration
procedure over the access(es) the Access Type indicates.
The AMF-initiated Deregistration procedure is either explicit (e.g. by O&M
intervention or if the AMF determines that no S-NSSAI can be provided in the
Allowed NSSAI for the UE) or implicit. The AMF does not send the
Deregistration Request message to the UE for Implicit Deregistration. If the
UE is in CM-CONNECTED state, the AMF may explicitly deregister the UE by
sending a Deregistration Request message (Deregistration type, Access Type,
[list of Rejected S-NSSAIs, each of them with the appropriate rejection cause
value]) to the UE. The Deregistration type may be set to Re-registration in
which case the UE should re-register at the end of the Deregistration
procedure. Access Type indicates whether Deregistration procedure applies to
the 3GPP access or non-3GPP access, or both. If the Deregistration Request
message is sent over 3GPP access and the UE is in CM-IDLE state in 3GPP
access, the AMF pages the UE. The list of Rejected S-NSSAIs, each of them with
the appropriate rejection cause value, is provided if the AMF determines that
no S-NSSAI can be provided to the UE in the Allowed NSSAI.
If the UE has established PDU Session associated with emergency service, the
AMF shall not initiate Deregistration procedure. In this case, the AMF
performs network requested PDU Session Release for any PDU session associated
with non-emergency service as described in clause 4.3.4.
For NR satellite access, the AMF initiates Network-initiated Deregistration if
it detects that the UE\'s registered PLMN is not allowed to operate in the
present UE location. In this case, the AMF shall provide the appropriate cause
value indicating the PLMN is not allowed to operate in the present UE
location, see clause 5.4.11.4 of TS 23.501 [2].
If the network de-registration is triggered for a UE registered for Disaster
Roaming due to a disaster condition no longer being applicable, the
Deregistration Request shall contain the cause value \"PLMN not allowed\" and
include a disaster return wait range as described in clause 5.5.2.3.1 of TS
24.501 [25] and as specified in clause 5.40.5 of TS 23.501 [2], the network,
shall organise the return of the Disaster Roaming UEs in a manner that does
not cause overload (e.g. of signalling) in the PLMN that previously had the
Disaster Condition.
If the MBSR authorization state changes for a MBSR (IAB-UE) registered in
network as specified in clause 5.35A.4 of TS 23.501 [2], based on operator
configuration, the AMF triggers Deregistration procedure.
3\. [Conditional] If the Deregistration procedure is triggered by UDM (Step
1), the AMF acknowledges the Nudm_UECM_DeRegistrationNotification to the UDM.
If Access Type indicates 3GPP Access or non-3GPP Access and AMF does not have
UE context for another access type, or if Access Type indicates both, the AMF
unsubscribes with the UDM using Nudm_SDM_Unsubscribe service operation.
4\. [Conditional] If the UE has any established PDU Session over the target
access for deregistration indicated in step 2, then step 2 \~ step 5 of UE-
initiated Deregistration procedure in clause 4.2.2.3.2 is performed.
5\. [Conditional] As in step 6 of Figure 4.2.2.3.2-1.
5a. [Conditional] As in step 6a of Figure 4.2.2.3.2-1.
6\. [Conditional] If the UE receives the Deregistration Request message from
the AMF in step 2, the UE sends a Deregistration Accept message to the AMF any
time after step 2. The NG-RAN forwards this NAS message to the AMF along with
the TAI+ Cell identity of the cell which the UE is using.
7\. [Conditional] AMF to AN: N2 UE Context Release Request (Cause): as in step
8 of Figure 4.2.2.3.2.
If the UE is deregistered over only 3GPP access or non-3GPP access and the AMF
does not have UE context for the other, or if the procedure applies to both
access types, then at any time, AMF can unsubscribe from the UDM, otherwise
the AMF can deregister from UDM using Nudm_UECM_Deregistration request by
indicating its associating access type.
### 4.2.3 Service Request procedures
#### 4.2.3.1 General
The Service Request procedure is used by a UE in CM-IDLE state or the 5GC to
request the establishment of a secure connection to an AMF. The Service
Request procedure is also used both when the UE is in CM-IDLE and in CM-
CONNECTED to activate a User Plane connection for an established PDU Session.
The Service Request procedure is also used to release the connection to an
AMF.
For Home routed PDU sessions, by replacing the I-SMF with V-SMF and SMF with
H-SMF the same procedure as defined in clause 4.23.4 is reused.
The UE shall not initiate a Service Request procedure if there is an ongoing
Service Request procedure.
#### 4.2.3.2 UE Triggered Service Request
The UE in CM-IDLE state initiates the Service Request procedure in order to
send uplink signalling messages, user data, to request emergency services
fallback, or as a response to a network paging request. The UE shall not
initiate UE Triggered Service Request from CM-IDLE if there is a Service Gap
timer running. After receiving the Service Request message, the AMF may
perform authentication. After the establishment of the signalling connection
to an AMF, the UE or network may send signalling messages, e.g. PDU Session
establishment from UE to the SMF, via the AMF.
The Service Request procedure is used by a UE in CM-CONNECTED to request
activation of a User Plane connection for PDU Sessions and to respond to a NAS
Notification message from the AMF. When a User Plane connection for a PDU
Session is activated, the AS layer in the UE indicates it to the NAS layer.
The Service Request procedure is used by the Multi-USIM UE over 3GPP access,
in:
a) CM-CONNECTED state to request release of the UE connection, stop data
transmission, discard of any pending data and optionally, store Paging
Restriction Information; or
b) CM-IDLE state to request removal of Paging Restriction Information.
The Multi-USIM UE shall not execute UE triggered Service Request procedure
with Release Request indication if regulatory prioritized services (e.g.
emergency service, emergency callback waiting) are ongoing. After an emergency
call, the UE shall not execute a UE triggered Service Request procedure with
Release Request indication for a duration which is sufficient for emergency
call back.
c) CM-IDLE state to respond to paging with a Reject Paging Indication that
indicates that N1 connection shall be released and no user plane connection
shall be established. The UE optionally provides the Paging Restriction
Information. The UE may be unable to respond to paging with a Reject Paging
Indication, e.g. due to UE implementation constraints.
NOTE 1: A Multi-USIM UE in RRC_INACTIVE/CM-CONNECTED state that decides to
reject the RAN paging, requests the release of the UE connection as in bullet
a) above. The UE can discard, by implementation, any data or NAS PDUs that it
receives before it is released.
For any Service Request, the AMF responds with a Service Accept message to
synchronize PDU Session status between UE and network, if necessary. The AMF
responds with a Service Reject message to UE, if the Service Request cannot be
accepted by network. The AMF may steer the UE from 5GC by rejecting the
Service Request. The AMF should take into account the Preferred and Supported
Network Behaviour (see clause 5.31.2 of TS 23.501 [2]) and availability of EPC
to the UE before steering the UE from 5GC. The Service Reject message may
include an indication or cause code requesting the UE to perform Registration
procedure.
For this procedure, the impacted SMF and UPF, if any, are all under control of
the PLMN serving the UE, e.g. in Home Routed roaming case the SMF and UPF in
HPLMN are not involved if V-SMF relocation is not triggered.
For Service Request due to user data, network may take further actions if User
Plane connection activation is not successful.
The procedure in this clause 4.2.3.2 is applicable to the scenarios with or
without intermediate UPF and with or without intermediate UPF reselection.
If the UE initiates Service Request procedures via non-3GPP Access, functions
defined in clause 4.12.4.1 are applied.
The User Plane of all PDU Sessions with redundant I-UPFs or with redundant
N3/N9 tunnels for URLLC shall be activated during the Service Request
procedure if the UE in CM-IDLE state initiates the Service Request procedure
from 3GPP access. If the redundant I-UPFs are to be added/replaced/removed,
the N4 Session procedure to manage the I-UPF is done for each I-UPF in steps
6c, 6d,7a, 7b, 8a, 8b, 9, 10, 17a,17b, 20a, 20b, 21a,21b, 22a and 22b of the
figure 4.2.3.2-1. If the redundant N3/N9 tunnels are used for URLLC and the
I-UPF is to be added/replaced/removed, the N4 Session procedure to update the
tunnel is done for each N3/N9 tunnel in steps 6c, 6d, 7a, 7b, 8a, 8b, 9, 10,
17a, 17b. 20a, 20b, 21a and 21b of the figure 4.2.3.2-1.
Figure 4.2.3.2-1: UE Triggered Service Request procedure
1\. UE to (R)AN: AN message (AN parameters, Service Request (List Of PDU
Sessions To Be Activated, List Of Allowed PDU Sessions, security parameters,
PDU Session status, 5G-S-TMSI, [NAS message container], Exempt Indication,
[Release Request indication], [Paging Restriction Information], [Reject Paging
Indication])).
The NAS message container shall be included if the UE is sending a Service
Request message as an Initial NAS message and the UE needs to send non-
cleartext IEs, see clause 4.4.6 of TS 24.501 [25].
The Multi-USIM UE in CM-CONNECTED state may include the Release Request
indication and optionally Paging Restriction Information in the Service
Request message over 3GPP access, if the UE intends to leave CM-CONNECTED
state.
The Multi-USIM UE in CM-IDLE state may include the Release Request indication
and not include Paging Restriction Information in the Service Request message
over 3GPP access, if the UE intends to delete the Paging Restriction
Information.
If the Multi-USIM UE in CM-IDLE state decides not to accept the paging, it may
send a Service Request message including a Reject Paging Indication and
optionally Paging Restriction Information, unless it is not able to send this
message e.g. due to UE implementation constraints.
The List Of PDU Sessions To Be Activated is provided by UE when the UE wants
to re-activate the PDU Session(s). The List Of Allowed PDU Sessions is
provided by the UE when the Service Request is a response of a Paging or a NAS
Notification for a PDU Session associated with non-3GPP access and identifies
the PDU Sessions that can be transferred to 3GPP access.
In the case of NG-RAN:
\- The AN parameters include 5G-S-TMSI, Selected PLMN ID (or PLMN ID and NID,
see clause 5.30 of TS 23.501 [2]), Establishment cause and may also include
NSSAI information. The Establishment cause provides the reason for requesting
the establishment of an RRC connection. Whether and how the UE includes the
NSSAI information as part of the AN parameters is dependent on the value of
the Access Stratum Connection Establishment NSSAI Inclusion Mode parameter, as
specified in clause 5.15.9 of TS 23.501 [2].
\- The UE sends Service Request message towards the AMF encapsulated in an RRC
message to the NG-RAN. The RRC message(s) that can be used to carry the 5G-S-
TMSI and this NAS message are described in TS 38.331 [12] and TS 36.331 [16].
If the Service Request is triggered by the UE for user data, the UE
identifies, using the List Of PDU Sessions To Be Activated, the PDU Session(s)
for which the UP connections are to be activated in Service Request message.
When the UE includes the List Of PDU Sessions To Be Activated, the UE shall
indicate PDU Sessions only associated with the access the Service Request is
related to. If the Service Request is triggered by the UE for signalling only,
the UE doesn\'t identify any List Of PDU Sessions To Be Activated. If this
procedure is triggered for paging response and the UE has at the same time
some user data to be transferred, the UE identifies the PDU Session(s) whose
UP connections are to be activated in Service Request message, by the List Of
PDU Sessions To Be Activated. Otherwise the UE does not identify any PDU
Session(s) in the Service Request message for paging response. As defined in
TS 24.501 [25] the UE shall include always-on PDU Sessions which are accepted
by the network in the List Of PDU Sessions To Be Activated even if there are
no pending uplink data for those PDU Sessions or when the Service Request is
triggered for signalling only or when the Service Request is triggered for
paging response.
If the Service Request over 3GPP access is triggered in response to the paging
or NAS Notification indicating non-3GPP access, the Service Request message
shall identify the list of PDU Sessions associated with the non-3GPP access
that can be re-activated over 3GPP access in the List Of Allowed PDU Sessions,
as described in clause 4.2.3.3 (step 6) of this specification and in clause
5.6.8 of TS 23.501 [2]. When the UE over 3GPP access is in NB-N1 mode and the
resulting number of PDU Sessions with user plane resources activated for the
UE does not exceed the maximum number of supported user plane resources (0, 1
or 2), based on whether the UE supports UP data transfer and the UE\'s 5GMM
Core Network Capability as described in clause 5.31.19 of TS 23.501 [2], the
AMF shall notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access can be performed
as defined in TS 24.501 [25].
If the Service Request is triggered to report PS Data Off status change and
the UE is in Non-Allowed Area, the UE shall send Service Request message with
an indication that the message is exempted from restriction (e.g. Non-Allowed
Area). In this case, if the UE is in Non-Allowed Area, the UE shall not
include the List Of PDU Sessions To Be Activated and as a result the always-on
PDU Session is not re-activated during the Service Request procedure.
The PDU Session status indicates the PDU Sessions available in the UE.
The UE shall not trigger a Service Request procedure for a PDU Session
corresponding to a LADN when the UE is outside the area of availability of the
LADN.
NOTE 2: A PDU Session corresponding to a LADN is not included in the List Of
PDU Sessions To Be Activated when the UE is outside the area of availability
of the LADN.
For UE in CM-CONNECTED state, only the List Of PDU Sessions To Be Activated
and List Of Allowed PDU Sessions need to be included in the Service Request.
The UE shall not trigger a Service Request procedure for a PDU Session
associated to an S-NSSAI if the S-NSSAI is not valid as per the S-NSSAI
location availability information.
NOTE 3: A PDU Session associated to an S-NSSAI is not included in the List Of
PDU Sessions To Be Activated when the S-NSSAI is not valid as per the S-NSSAI
location availability information.
2\. (R)AN to AMF: N2 Message (N2 parameters, Service Request).
Details of this step are described in TS 38.413 [10]. If the AMF can\'t handle
the Service Request it will reject it.
When NG-RAN is used, the N2 parameters include the 5G-S-TMSI, Selected PLMN ID
(or PLMN ID and NID, see clause 5.30 of TS 23.501 [2]), Location information
and Establishment cause, UE Context Request.
If the UE is in CM-IDLE state, the NG-RAN obtains the 5G-S-TMSI in RRC
procedure. NG-RAN selects the AMF according to 5G-S-TMSI. The Location
Information relates to the cell in which the UE is camping.
Based on the PDU Session status, the AMF may initiate PDU Session Release
procedure in the network for the PDU Sessions whose PDU Session ID(s) were
indicated by the UE as not available.
When the Establishment cause is associated with priority services (e.g. MPS,
MCX), or when the AMF determines that the UE has priority subscription (e.g.
MPS, MCX) in the UDM, the AMF includes a Message Priority header to indicate
priority information. Other NFs relay the priority information by including
the Message Priority header in service-based interfaces, as specified in TS
29.500 [17].
The AMF enforces the Mobility Restrictions as specified in clause 5.3.4.1.1 of
TS 23.501 [2].
If there is a Service Gap timer running in AMF for the UE and the AMF is not
waiting for a MT paging response from the UE and the Service Request is not
for regulatory prioritized services like Emergency services or not for
exception reporting, the AMF rejects the Service Request with an appropriate
cause. In addition, AMF may also provide a UE with a Mobility Management Back-
off timer set to the remaining value of the Service Gap timer.
If the AMF supports RACS and the AMF detects that the selected PLMN is
different from the currently registered PLMN for the UE, the AMF determines
the UE Radio Capability ID of the newly selected PLMN to the gNB as described
in clause 5.4.4.1a of TS 23.501 [2].
For NR satellite access, the AMF may decide to verify the UE location and
determine whether the PLMN is allowed to operate at the UE location, as
described in clause 5.4.11.4 of TS 23.501 [2]. If the UE receives a Service
Reject message with cause value indicating that the PLMN is not allowed to
operate in the present UE location, the UE shall attempt to select a PLMN, as
specified in TS 23.122 [22].
3a) AMF to (R)AN: N2 Request (security context, Mobility Restriction List,
list of recommended cells / TAs / NG-RAN node identifiers).
If the 5G-AN had requested for UE Context or there is a requirement for AMF to
provide this e.g. the AMF needs to initiate fallback procedure as in clause
4.13.4.2 for Emergency services, AMF initiates NGAP procedure as specified in
TS 38.413 [10]. For UE in CM-IDLE state, 5G-AN stores the Security Context in
the UE AN context. Mobility Restriction List is described in clause 5.3.4.1 of
TS 23.501 [2].
The 5G-AN uses the Security Context to protect the messages exchanged with the
UE as described in TS 33.501 [15].
If the NG-RAN node had provided the list of recommended cells / TAs / NG-RAN
node identifiers during the AN Release procedure (see clause 4.2.6), the AMF
shall include it in the N2 Request. The RAN may use this information to
allocate the RAN Notification Area when the RAN decides to enable RRC_INACTIVE
state for the UE.
3\. If the Service Request was not sent integrity protected or integrity
protection verification failed, the AMF shall reject the Service Request as
stated in TS 24.501 [25].
If the UE in CM-IDLE state triggered the Service Request to establish a
signalling connection only, after successful establishment of the signalling
connection the UE and the network can exchange NAS signalling and steps 4 to
11 and 15 to 22 are skipped.
If the UE in Non-Allowed Area triggered the Service Request with an indication
that the message is exempted from restriction (e.g. Non-Allowed Area), the AMF
should accept the Service Request. In this case, if the UE is in Non-Allowed
Area, the AMF rejects user plane setup request from the SMF except for
emergency services.
If the procedure was triggered in response to paging or NAS notification
indicating non-3GPP access and the AMF received N1 SM Container only from the
SMF in step 3a of clause 4.2.3.3, the AMF sends the NAS signalling including
the N1 SM Container to the UE in step 7 of clause 4.2.3.3 without updating the
access associated to the PDU Session.
If the Service Request message is received over 3GPP access without a Release
Request indication or a Reject Paging Indication, the AMF shall delete any
stored Paging Restriction Information for this UE and stop restricting paging
accordingly.
If the Service Request message over 3GPP access includes a Release Request
indication or a Reject Paging Indication, then:
\- the AMF may accept or reject the received Paging Restriction Information
requested by the UE based on operator policy. If the AMF rejects the Paging
Restriction Information, the AMF removes any stored Paging Restriction
Information from the UE context and discards the UE requested Paging
Restriction Information. If the AMF accepts the Paging Restriction Information
from the UE, the AMF stores the Paging Restriction Information from the UE in
the UE context.
\- If no Paging Restriction Information is provided, no paging restrictions
apply and the AMF removes any stored Paging Restriction Information from the
UE context.
\- no User Plane resources are established and instead the AMF triggers the AN
Release procedure as described in clause 4.2.6.
NOTE 4: If AMF does not perform steps 5-7 before step 2 then some DL data
might not be delivered to the UE.
If the procedure was triggered in response to paging and the Service Request
message includes a Reject Paging Indication, the AMF initiates the UCU
procedure as described in step 7 of clause 4.2.3.3 before the triggering of
the AN Release procedure.
4\. [Conditional] AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID(s), Operation Type, UE location information, Access Type, RAT Type,
UE presence in LADN service area, Indication of Access Type can be changed,
[MO Exception Data Counter]).
The Nsmf_PDUSession_UpdateSMContext Request is invoked:
\- If the UE identifies List Of PDU Sessions To Be Activated in the Service
Request message;
\- This procedure is triggered by the SMF but the PDU Session(s) identified by
the UE correlates to other PDU Session ID(s) than the one triggering the
procedure; or
\- If this procedure is triggered by the SMF in response to paging or NAS
notification indicating 3GPP access or if this step onwards is invoked
following step 4a of clause 4.2.3.3 and the current UE location is outside the
\"Area of validity for the N2 SM information\" provided by the SMF in step 3a
of clause 4.2.3.3 or the \"Area of validity for the N2 SM information\" was
not provided by the SMF in step 3a of clause 4.2.3.3, the AMF shall not send
the N2 information provided by the SMF in step 3a of clause 4.2.3.3.
Otherwise, if the current UE location is in the \"Area of validity for the N2
SM information\", steps 4 to 11 are skipped; or
\- If this procedure is triggered by the SMF in response to paging or NAS
notification indicating non-3GPP access and the AMF received N2 SM Information
only, or both N1 SM Container and N2 SM Information in step 3a of clause
4.2.3.3.
If the DNN corresponds to an LADN then the \"UE presence in LADN service
area\" indicates if the UE is IN or OUT of the LADN service area. If the AMF
does not provide the \"UE presence in LADN service area\" indication and the
SMF determines that the DNN corresponds to a LADN, then the SMF considers that
the UE is OUT of the LADN service area.
The AMF determines the PDU Session(s) for which the UP connection(s) shall be
activated and sends an Nsmf_PDUSession_UpdateSMContext Request to SMF(s)
associated with the PDU Session(s) with Operation Type set to \"UP activate\"
to indicate establishment of User Plane resources for the PDU Session(s). The
AMF determines Access Type and RAT Type, see clause 4.2.2.2.1. If the RAT type
is NB-IoT, the AMF shall ensure that the number of PDU session(s) for which UP
connection(s) are active does not exceed this UE\'s maximum number of
supported user plane resources (0, 1 or 2) based on whether the UE supports UP
data transfer and the UE 5GMM Core Network Capability as described in clause
5.31.19 of TS 23.501 [2].
If the procedure was triggered in response to paging or NAS Notification
indicating non-3GPP access, the AMF received N2 SM Information in step 3a of
clause 4.2.3.3 and the PDU Session for which the UE was paged or notified is
not in the List Of Allowed PDU Sessions provided by the UE, the AMF notifies
the SMF that the UE is not reachable. For other PDU Sessions in the List Of
Allowed PDU Sessions the Service Request Procedure succeeds without re-
activating the User Plane of any PDU Sessions, unless they have also been
included by the UE in the List Of PDU Sessions To Be Activated.
If the procedure was triggered in response to paging or NAS notification
indicating non-3GPP access and the PDU Session for which the UE was paged or
notified is in the List Of Allowed PDU Sessions provided by the UE and the AMF
received N2 SM Information only or N1 SM Container and N2 SM Information from
the SMF in step 3a of clause 4.2.3.3, the AMF notifies the SMF that the access
type of the PDU session can be changed. The AMF discards any already received
N1 SM Container and N2 SM Information. In Home Routed roaming case, the V-SMF
triggers Nsmf_PDUSession_Update service operation towards the H-SMF to notify
the access type of the PDU Session can be changed and the procedure continues
as specified in clause 4.3.3.3 from step 1a to step 10.
If the UE is accessing via the NB-IoT RAT, the AMF may inform all (H-)SMFs
whether the RRC establishment cause is set to \"MO exception data\", as
described in clause 5.31.14.3 of TS 23.501 [2]. The AMF may immediately send
the MO Exception Data Counter to the (H-)SMF.
The AMF may receive a Service Request to establish another NAS signalling
connection via a new NG-RAN while it has maintained an old NAS signalling
connection for UE still via an old NG-RAN. The new NG-RAN and the old NG-RAN
can be the same NG-RAN node. In this case, AMF shall trigger the AN release
procedure toward the old NG-RAN to release the old NAS signalling connection
as defined in clause 4.2.6 and:
\- For the PDU Sessions indicated by the UE in the List Of PDU Sessions To Be
Activated, the AMF requests the SMF to activate the PDU Session(s) immediately
by performing this step 4; and
NOTE 5: This activates the UP of PDU Session(s) using resources of the new NG-
RAN.
\- For the PDU Sessions indicated by the old NG-RAN in the \"List of PDU
Session ID(s) with active N3 user plane\" but not in the List Of PDU Sessions
To Be Activated sent by the UE, the AMF requests the SMF to deactivate the PDU
Session(s).
NOTE 6: This deactivates the UP of PDU Session(s) that are no more needed by
the UE.
5a. Void.
5b. If the PDU Session ID corresponds to a LADN and the SMF determines that
the UE is outside the area of availability of the LADN based on the \"UE
presence in LADN service area\" from the AMF, the SMF decides to (based on
local policies) either:
\- keep the PDU Session, but reject the activation of User Plane connection
for the PDU Session and inform the AMF about it. If the procedure has been
triggered by a Network Triggered Service Request as described in clause
4.3.2.3, the SMF may notify the UPF that originated the Data Notification to
discard downlink data for the PDU Sessions and/or to not provide further Data
Notification messages; or
\- to release the PDU Session: the SMF releases the PDU Session and informs
the AMF that the PDU Session is released.
In any case of the two cases above the SMF answers to the AMF (step10) with an
appropriate reject cause and the User Plane Activation of PDU Session is
stopped.
Otherwise, based on the location info received from the AMF, the SMF checks
the UPF Selection Criteria according to clause 6.3.3 of TS 23.501 [2] and
determines to perform one of the following:
\- accepts the activation of UP connection and continue using the current
UPF(s);
\- accepts the activation of UP connection and selects a new intermediate UPF
(or add/remove an intermediate UPF), if the UE has moved out of the service
area of the UPF that was previously connecting to the AN, while maintaining
the UPF(s) acting as PDU Session Anchor. The steps to perform I-UPF
addition/change/removal are described as conditional steps in the following of
the current procedure; or
NOTE 7: If the old and/or new I-UPF implements an UL CL or BP functionality
and a PDU Session Anchor for connectivity to the local access to the Data
Network as described in clause 5.6.4.2 of TS 23.501 [2], the signalling
described in the current clause is intended as the signalling to add, remove
or change the PDU Session Anchor and must be complemented by the signalling to
add, release or change the UL CL or BP as described respectively in clauses
4.3.5.4, 4.3.5.5 and 4.3.5.7.
\- rejects the activation of UP connection of a PDU Session of SSC mode 2 and
trigger re-establishment of the PDU Session after Service Request procedure to
perform the allocation of a new UPF to act as PDU Session Anchor, e.g. the UE
has moved out of the service area of the anchor UPF which is connecting to NG-
RAN.
In the case that the SMF fails to find suitable I-UPF, the SMF decides to
(based on local policies) either:
\- trigger re-establishment of PDU Session. After Service Request procedure,
SMF sends N1 SM message to the UE via the AMF by invoking
Namf_Communication_N1N2MessageTransfer containing the cause indicating PDU
Session re-establishment is required for the UE; or
\- keep the PDU Session, but reject the activation request of User Plane
connection for the PDU Session and inform the AMF about it; or
\- release the PDU Session after Service Request procedure.
If the SMF has determined that the UE is performing Inter-RAT mobility to or
from the NB-IoT RAT then the SMF uses the \"PDU Session continuity at inter
RAT mobility\" to determine how to handle the PDU Session.
6a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
Depending on the network deployment, the CN Tunnel Info of UPF (PSA) allocated
for N3 or N9 interface may be changed during the Service Request procedure,
e.g. UPF connected to different IP domains. If different CN Tunnel Info need
be used, the SMF sends N4 Session Modification Request message to UPF (PSA)
and requests CN Tunnel Info providing the target Network Instance.
6b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response.
The UPF (PSA) sends an N4 Session Establishment Response message to the SMF.
The UPF provides CN Tunnel Info to the SMF. The UPF (PSA) associate the CN
Tunnel Info with UL Packet detection rules provided by the SMF.
If the redundant I-UPFs are used for URLLC, each I-UPF provides UL CN Tunnel
Info for N3 interface to the SMF in the N4 Session Establishment Response
message.
If the redundant N3 tunnels are used for URLLC, the UPF (PSA) provides
redundant UL CN Tunnel Info for N3 interface to the SMF in N4 Session
Establishment Response message.
6c. [Conditional] SMF to new UPF (intermediate): N4 Session Establishment
Request.
If the SMF selects a new UPF to act as intermediate UPF for the PDU Session,
or if the SMF selects to insert an intermediate UPF for a PDU Session which
did not have an intermediate UPF, an N4 Session Establishment Request message
is sent to the new UPF, providing Packet detection, Data forwarding,
enforcement and reporting rules to be installed on the intermediate UPF. The
CN Tunnel Info (on N9) of PSA, i.e. which is used to establish the N9 tunnel,
for this PDU Session is also provided to the intermediate UPF.
If a new UPF is selected by the SMF to replace the old (intermediate) UPF, the
SMF may also include a request for the new UPF to allocate a second tunnel
endpoint for buffered DL data from the old I-UPF and to indicate via usage
reporting end marker reception on this second tunnel. In this case, the UPF is
instructed by the SMF to buffer the DL data it may receive at the same time
from the UPF (PSA).
6d. New UPF (intermediate) to SMF: N4 Session Establishment Response.
The new intermediate UPF sends an N4 Session Establishment Response message to
the SMF. The UPF provides DL CN Tunnel Info as requested by SMF in step 6c.
The SMF starts a timer, to be used in step 22a to release the resource in old
intermediate UPF if there is one.
7a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
If the SMF selects a new UPF to act as intermediate UPF for the PDU Session,
the SMF sends N4 Session Modification Request message to PDU Session Anchor
UPF, providing DL Tunnel Info from new intermediate UPF. If the new
intermediate UPF was added for the PDU Session, the UPF (PSA) begins to send
the DL data to the new I-UPF as indicated in the DL CN Tunnel Info. The UPF
(PSA) sends one or more \"end marker\" packets for each N9 tunnel to the old
I-UPF immediately after switching the path to new I-UPF.
If the Service Request is triggered by the network and the SMF removes the old
I-UPF but does not replace it with a new I-UPF, the SMF may also include a
request for the UPF to allocate a second tunnel endpoint for buffered DL data
from the old I-UPF and to indicate end marker reception on this second tunnel
via usage reporting. In this case, the UPF (PSA) begins to buffer the DL data
it may receive at the same time from the N6 interface. The UPF (PSA) sends one
or more \"end marker\" packets for each N9 tunnel to the old I-UPF immediately
after switching the path to (R)AN.
7b. The UPF (PSA) sends N4 Session Modification Response message to SMF.
If requested by SMF, the UPF (PSA) sends DL CN tunnel info for the old
(intermediate) UPF to the SMF. The SMF starts a timer, to be used in step 22a
to release the resource in old intermediate UPF if there is one.
If the UPF that connects to RAN is the UPF (PSA) and if the SMF finds that the
PDU Session is activated when receiving the Nsmf_PDUSession_UpdateSMContext
Request in step 4 with Operation Type set to \"UP activate\" to indicate
establishment of User Plane resources for the PDU Session(s), it deletes the
AN Tunnel Info and initiates an N4 Session Modification procedure to remove
Tunnel Info of AN in the UPF.
8a. [Conditional] SMF to old UPF (intermediate): N4 Session Modification
Request (New UPF address, New UPF DL Tunnel ID)
If the service request is triggered by the network and the SMF removes the old
(intermediate) UPF, the SMF sends the N4 Session Modification Request message
to the old (intermediate) UPF, providing the DL Tunnel Info for the buffered
DL data. If the SMF allocated new I-UPF, the DL Tunnel Info is from the new
(intermediate) UPF acting as N3 terminating point. If the SMF did not allocate
a new I-UPF, the DL Tunnel Info is from the new UPF (PSA) acting as N3
terminating point. The SMF starts a timer to monitor the forwarding tunnel as
step 6d or 7b.
If the old I-UPF receives end marker packets and there is no associated tunnel
to forward these packets, the old I-UPF discards the received end marker
packets and does not send any Data Notification to SMF.
If the SMF find the PDU Session is activated when receiving the
Nsmf_PDUSession_UpdateSMContext Request in step 4 with Operation Type set to
\"UP activate\" to indicate establishment of User Plane resources for the PDU
Session(s), it deletes the AN Tunnel Info and initiates an N4 Session
Modification procedure to remove Tunnel Info of AN in the UPF.
8b. old UPF (intermediate) to SMF: N4 Session Modification Response
The old (intermediate) UPF sends N4 Session Modification Response message to
SMF.
9\. [Conditional] old UPF (intermediate) to new UPF (intermediate): buffered
downlink data forwarding
If the I-UPF is changed and forwarding tunnel was established to the new
I-UPF, the old (intermediate) UPF forwards its buffered data to the new
(intermediate) UPF acting as N3 terminating point. If indicated by SMF in step
6c, the new I-UPF reports to SMF when end marker packet is received. Then the
SMF initiates N4 Session Modification procedure to indicate the new I-UPF to
send the buffered downlink packet(s) received from the UPF (PSA).
10\. [Conditional] old UPF (intermediate) to UPF (PSA): buffered downlink data
forwarding
If the old I-UPF is removed and no new I-UPF is assigned for the PDU Session
and forwarding tunnel was established to the UPF (PSA), the old (intermediate)
UPF forwards its buffered data to the UPF (PSA) acting as N3 Terminating
Point. If indicated by SMF in step 7a, the UPF (PSA) reports to SMF when the
end marker packet has been received. Then the SMF initiates N4 Session
Modification procedure to request the UPF (PSA) to send the buffered DL data
received from the N6 interface.
11\. [Conditional] SMF to AMF: Nsmf_PDUSession_UpdateSMContext Response (N2 SM
information (PDU Session ID, QFI(s), QoS profile(s), CN N3 Tunnel Info,
S-NSSAI, User Plane Security Enforcement, UE Integrity Protection Maximum Data
Rate, RSN, PDU Session Pair ID), N1 SM Container, Cause) to the AMF. If the
UPF that connects to RAN is the UPF (PSA), the N3 CN Tunnel Info is the UL CN
Tunnel Info of the UPF (PSA). If the UPF that connects to RAN is the new
intermediate UPF, the CN N3 Tunnel Info is the UL Tunnel Info of the
intermediate UPF.
For the PDU Session with redundant I-UPFs or with redundant N3 tunnels for
URLLC, the two UL N3 CN Tunnel Info are included, the SMF also indicates the
NG-RAN that one of the CN Tunnel Info is used as the redundancy tunnel of the
PDU session as described in clause 5.33.2.2 of TS 23.501 [2].
The SMF shall send N1 SM Container and/or N2 SM Information to the AMF when
applicable. (e.g. when the SMF was notified from the AMF that the access type
of the PDU Session can be changed in step 4).
For a PDU Session that the SMF has determined to accept the activation of UP
connection in step 5a or 5b, the SMF generates only N2 SM information and
sends Nsmf_PDUSession_UpdateSMContext Response to the AMF to establish the
User Plane(s). The N2 SM information contains information that the AMF shall
provide to the NG-RAN. The SMF may indicate for each QoS Flow whether
redundant transmission shall be performed by a corresponding redundant
transmission indicator. If the SMF decided to change the PSA UPF for the SSC
mode 3 PDU Session, the SMF triggers the change of SSC mode 3 PDU Session
anchor as an independent procedure described in clause 4.3.5.2 or clause
4.3.5.3 after accepting the activation of UP of the PDU Session.
For each QoS Flow:
\- an ECN marking for L4S indicator to (R)AN in the case of ECN marking for
L4S in RAN as described in clause 5.37.3 of TS 23.501 [2]; or,
\- a QoS monitoring configuration for congestion information as described in
clause 5.45.3 of TS 23.501 [2], in the case of ECN marking for L4S by PSA UPF
as described in clause 5.37.3 of TS 23.501 [2] or QoS monitoring for
congestion information as described in clause 5.45.3 of TS 23.501 [2].
The SMF can reject the activation of UP of the PDU Session by including a
cause in the Nsmf_PDUSession_UpdateSMContext Response. Following are some of
the cases:
\- If the PDU Session corresponds to a LADN and the UE is outside the area of
availability of the LADN as described in step 5b;
\- If the AMF notified the SMF that the UE is reachable only for regulatory
prioritized service and the PDU Session to be activated is not for a
regulatory prioritized service; or
\- If the SMF decided to change the PSA UPF for the requested PDU Session as
described in step 5b. In this case, after sending
Nsmf_PDUSession_UpdateSMContext Response, the SMF triggers another procedure
to instruct UE to re-establish the PDU Session as described in clause 4.3.5.1
for SSC mode 2.
\- If the SMF received negative response in Step 6b due to UPF resource
unavailability.
If the PDU Session has been assigned any EPS bearer ID, the SMF also includes
the mapping between EPS bearer ID(s) and QFI(s) into the N2 SM information to
be sent to the NG-RAN.
The User Plane Security Enforcement information is determined by the SMF upon
PDU session establishment as described in clause 5.10.3 of TS 23.501 [2]. If
the User Plane Security Enforcement information indicates that Integrity
Protection is \"Preferred\" or \"Required\", the SMF also includes the UE
Integrity Protection Maximum Data Rate.
The RSN and PDU Session Pair ID are included when applicable, as determined by
the SMF during PDU Session establishment as described in clause 5.33.2.1 of TS
23.501 [2].
12\. AMF to (R)AN: N2 Request (N2 SM information received from SMF, security
context, Mobility Restriction List, UE-AMBR, List of UE-Slice-MBR(s) (optional
and for 3GPP access type only), MM NAS Service Accept, list of recommended
cells / TAs / NG-RAN node identifiers, UE Radio Capability, Core Network
Assistance Information, Tracing Requirements, UE Radio Capability ID). The
Allowed NSSAI for the Access Type for the UE and Partially Allowed NSSAI are
included in the N2 message. If the subscription information includes Tracing
Requirements, the AMF includes Tracing Requirements in the N2 Request.
If the UE triggered the Service Request while in CM-CONNECTED state, only N2
SM information received from SMF and MM NAS Service Accept are included in the
N2 Request.
If the Service Request procedure is triggered by the Network (as described in
clause 4.2.3.3) while the UE is in CM-CONNECTED state, only N2 SM information
received from SMF is included in the N2 Request.
If the Service Request procedure is triggered by the Network (as described in
clause 4.2.3.3) while the UE is in CM-IDLE state, only N2 SM information
received from SMF and MM NAS Service Accept is included in the N2 Request.
For a UE that was in CM-IDLE state when the Service Request was triggered, the
NG-RAN stores the Security Context. If the Service Request is not triggered by
UE for a signalling connection only, RAN also stores QoS Information for the
QoS Flows of the PDU Sessions that are activated and N3 Tunnel IDs in the UE
RAN context and Mobility Restriction List (as described in clause 5.3.4.1 of
TS 23.501 [2]).
MM NAS Service Accept includes PDU Session status in AMF. Any local PDU
Session Release during the Session Request procedure is indicated to the UE
via the Session Status. PDU Session Reactivation Result is provided in Service
Accept for the PDU sessions in the List Of PDU Sessions To Be Activated and
the PDU Session in the List of Allowed PDU Sessions which has caused paging or
NAS notification. If the PDU Session Reactivation Result of a PDU Session is
failure, the cause of the failure is also provided.
If the AMF accepts the Paging Restriction Information sent from the UE, the
AMF informs the UE about the acceptance/rejection of the requested Paging
Restriction Information in the MM NAS Service Accept message.
If AMF receives multiple TAIs from the NG-RAN in step 2 and determines that
some, but not all of them are forbidden by subscription or by operator policy,
the AMF shall include the forbidden TAI(s) in the MM NAS Service Accept
message.
If there are multiple PDU Sessions that involves multiple SMFs, AMF does not
need to wait for responses from all SMFs in step 11 before it sends N2 SM
information to the RAN. However, the AMF shall wait for all responses from the
SMFs before it sends MM NAS Service Accept message to the UE.
AMF shall include at least one N2 SM information from SMF if this step is
triggered for PDU Session User Plane activation. AMF may send additional N2 SM
information from SMFs in separate N2 message(s) (e.g. N2 tunnel setup
request), if there is any. Alternatively, if multiple SMFs are involved, the
AMF may send one N2 Request message to (R)AN after all the
Nsmf_PDUSession_UpdateSMContext Response service operations from all the SMFs
associated with the UE are received.
If the NG-RAN node had provided the list of recommended cells / TAs / NG-RAN
node identifiers during the AN Release procedure (see clause 4.2.6), the AMF
shall include it in the N2 Request. The NG-RAN may use this information to
allocate the RAN Notification Area when the NG-RAN decides to enable
RRC_INACTIVE state for the UE.
The AMF includes the UE\'s \"RRC Inactive Assistance Information\" as defined
in clause 5.3.3.2.5 of TS 23.501 [2].
If the NG-RAN node does not support RACS and the AMF have UE Radio Capability
ID but not the UE Radio Capability information, then AMF will use
Nucmf_UECapabilityManagement_Resolve to try to retrieve the corresponding UE
Radio Capability information.
If the NG-RAN node does not support RACS, or the AMF does not have UE Radio
Capability ID in UE context, the AMF shall include the UE Radio Capability
information, if available, to the NG-RAN node as described in TS 23.501 [2].
If the RAT Type is NB-IoT then NB-IoT specific UE Radio Access Capability
Information is included instead, if available.
If AMF has UE Radio Capability ID in UE context valid for the PLMN the UE is
currently in and the NG-RAN supports RACS, the AMF signals the UE Radio
Capability ID. If the NG-RAN node does not have mapping between the UE Radio
Capability ID and the corresponding UE radio capabilities, it shall use the
non-UE associated procedure described in TS 38.413 [10] to retrieve the
mapping from the AMF.
The AMF may include the Core Network Assistance Information which includes
Core Network assisted RAN parameters tuning and Core Network assisted RAN
paging information as defined in TS 23.501 [2].
If the UE included support for restriction of use of Enhanced Coverage, the
AMF sends Enhanced Coverage Restricted information to the (R)AN in the N2
message.
If the UE and the AMF have negotiated to enable MICO mode and the AMF uses the
Extended connected timer, then the AMF provides the Extended Connected time
value to NG-RAN (see clause 5.31.7.3 of TS 23.501 [2]) in this step. The
Extended Connected Time value indicates the minimum time the RAN should keep
the UE in RRC_CONNECTED state regardless of inactivity.
If the AMF accepted MICO mode in the last registration procedure and knows
there may be mobile terminated data or signalling pending, the AMF maintains
the N2 connection for at least the Extended Connected Time as described in
clause 5.31.7.3 of TS 23.501 [2] and provides the Extended Connected Time
value to the RAN in N2 message with Service Accept message. The RAN should
keep the UE in RRC_CONNECTED state for an Extended Connected Time period in
order to ensure the downlink data and/or signalling is delivered to the UE.
If the RAN receives two CN Tunnel Info for a PDU session in step 11 for
redundant transmission, RAN also allocates two AN Tunnel Info correspondingly
and indicate to SMF one of the AN Tunnel Info is used as the redundancy tunnel
of the PDU session as described in clause 5.33.2.2 of TS 23.501 [2].
13\. (R)AN to UE: The NG-RAN performs RRC Connection Reconfiguration with the
UE depending on the QoS Information for all the QoS Flows of the PDU Sessions
whose UP connections are activated and Data Radio Bearers. For a UE that was
in CM-IDLE state, if the Service Request is not triggered by UE for a
signalling connection only, the User Plane security is established at this
step, which is described in detail in TS 38.331 [12] and TS 36.331 [16]. For a
UE that was in CM-IDLE state, if the Service Request is triggered by UE for a
signalling connection only, AS security context may be established in this
step, which is described in detail in TS 38.331 [12] and TS 36.331 [16].
If the N2 Request includes a NAS message, the NG-RAN forwards the NAS message
to the UE. The UE locally deletes context of PDU Sessions that are not
available in 5GC.
NOTE 8: The reception of the Service Accept message does not imply the
successful activation of the User Plane radio resources.
NOTE 9: If not all the requested User Plane AN resources are successfully
activated, see TS 38.413 [10].
After the User Plane radio resources are setup, the uplink data from the UE
can now be forwarded to NG-RAN. The NG-RAN sends the uplink data to the UPF
address and Tunnel ID provided in the step 11.
If the NG-RAN can not establish redundant user plane for the PDU Session as
indicated by the RSN parameter and PDU Session Pair ID, the NG-RAN takes the
decision on how to proceed with the PDU Session as described in TS 23.501 [2].
14\. [Conditional] (R)AN to AMF: N2 Request Ack (List of PDU Sessions To Be
Established with N2 SM information (AN Tunnel Info, List of accepted QoS Flows
for the PDU Sessions whose UP connections are activated, List of rejected QoS
Flows for the PDU Sessions whose UP connections are activated), established
QoS Flows status (active/not active) for QoS monitoring configuration for
congestion information, established QoS Flows status (active/not active) for
ECN marking for L4S, List of PDU Sessions that failed to be established with
the failure cause given in the N2 SM information element).
The message may include N2 SM information(s), e.g. AN Tunnel Info. NG-RAN may
respond N2 SM information with separate N2 message (e.g. N2 tunnel setup
response) if AMF sends separate N2 message in step 11.
If multiple N2 SM information are included in the N2 Request message in step
12, the N2 Request Ack includes multiple N2 SM information and information to
enable the AMF to associate the responses to relevant SMF.
15\. [Conditional] AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (N2 SM
information, RAT Type, Access Type) per PDU Session to the SMF. The AMF
determines Access Type and RAT Type, see clause 4.2.2.2.1.
If the AMF received N2 SM information (one or multiple) in step 14, then the
AMF shall forward the N2 SM information to the relevant SMF per PDU Session
ID. If the UE Time Zone has changed compared to the last reported UE Time Zone
then the AMF shall include the UE Time Zone IE in this message.
If the PDU Session is moved from the non-3GPP access to 3GPP access (i.e. N3
tunnel for the PDU Session is established successfully), the SMF and AMF
update associated access of the PDU Session. The UE updates associated access
of the PDU Session when the user plane resource for the PDU Session is
successfully established.
Procedure for unpausing a charging pause initiated earlier is specified in
clause 4.4.4.
If a PDU Session is rejected by the serving NG-RAN with an indication that the
PDU Session was rejected because User Plane Security Enforcement is not
supported in the serving NG-RAN and the User Plane Enforcement Policy
indicates \"Required\" as described in clause 5.10.3 of TS 23.501 [2], the SMF
shall trigger the release of this PDU Session. In all other cases of PDU
Session rejection, the SMF can decide whether to release the PDU Session or to
deactivate the UP connection of this PDU Session.
If some of the QoS Flows of a PDU Session are not accepted by the serving NG-
RAN, the SMF shall initiate the PDU Session Modification procedure to remove
the non-accepted QoS Flows from the PDU Session after this procedure is
completed.
16\. [Optional] SMF to PCF: If dynamic PCC is deployed and if Policy Control
Request Trigger condition(s) have been met (e.g. change of Access Type, change
of UE location), performs SMF initiated SM Policy Modification procedure as
defined in clause 4.16.5.1. The PCF may provide updated policies.
17a. [Conditional] SMF to new intermediate UPF: N4 Session Modification
Request (AN Tunnel Info and List of accepted QFI(s)).
If the SMF selected a new UPF to act as intermediate UPF for the PDU Session
in step 5b, the SMF initiates a N4 Session Modification procedure to the new
I-UPF and provides AN Tunnel Info. The Downlink Data from the new I-UPF can
now be forwarded to NG-RAN and UE.
17b. [Conditional] UPF to SMF: N4 Session Modification Response.
18a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request (AN
Tunnel Info, List of rejected QoS Flows).
If a User Plane is to be setup or modified and after the modification there is
no I-UPF, the SMF initiates a N4 Session Modification procedure to UPF (PSA)
and provides AN Tunnel Info. The Downlink Data from the UPF (PSA) can now be
forwarded to NG-RAN and UE.
For QoS Flows in the List of rejected QoS Flows, the SMF shall instruct the
UPF to remove the rules (e.g. Packet Detection Rules etc.) which are
associated with the QoS Flows.
If SMF decides to perform redundant transmission for one or more QoS Flows of
the PDU, the SMF also indicates the UPF (PSA) to perform packet duplication
for the QoS Flow(s) in downlink direction by forwarding rules.
If the PCC rule(s) are updated in step 16, the SMF may initiate a N4 Session
Modification procedure to UPF (PSA) based on the updated PCC rule(s).
18b. [Conditional] UPF to SMF: N4 Session Modification Response.
19\. [Conditional] SMF to AMF: Nsmf_PDUSession_UpdateSMContext Response.
20a. [Conditional] SMF to new UPF (intermediate): N4 Session Modification
Request.
If forwarding tunnel has been established to the new I-UPF and if the timer
SMF set for forwarding tunnel at step 8a has expired, SMF sends N4 Session
modification request to new (intermediate) UPF acting as N3 terminating point
to release the forwarding tunnel.
20b. [Conditional] new UPF (intermediate) to SMF: N4 Session modification
response.
New (intermediate) UPF acting as N3 terminating point sends N4 Session
Modification response to SMF.
21a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
If forwarding tunnel has been established to the UPF (PSA) and if the timer
SMF set for forwarding tunnel at step 7b has expired, SMF sends N4 Session
modification request to UPF (PSA) acting as N3 Terminating Point to release
the forwarding tunnel.
21b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response.
UPF (PSA) acting as N3 Terminating Point sends N4 Session Modification
Response to SMF.
22a. [Conditional] SMF to old UPF: N4 Session Modification Request or N4
Session Release Request.
If the SMF decided to continue using the old UPF in step 5b, the SMF sends an
N4 Session Modification Request, providing AN Tunnel Info.
If the SMF decided to select a new UPF to act as intermediate UPF in step 5b
and the old UPF is not PSA UPF, the SMF initiates resource release, after
timer in step 6b or 7b expires, by sending an N4 Session Release Request
(Release Cause) to the old intermediate UPF.
22b. [Conditional] Old intermediate UPF to SMF: N4 Session Modification
Response or N4 Session Release Response.
The old UPF acknowledges with an N4 Session Modification Response or N4
Session Release Response message to confirm the modification or release of
resources.
For the mobility related events described in clause 4.15.4, the AMF invokes
the Namf_EventExposure_Notify service operation after step 4.
Upon reception of the Namf_EventExposure_Notify with an indication that the UE
is reachable, if the SMF has pending DL data the SMF invokes the
Namf_Communication_N1N2MessageTransfer service operation to the AMF to
establish the User Plane(s) for the PDU Sessions, otherwise the SMF resumes
sending DL data notifications to the AMF in the case of DL data.
Upon reception of the Namf_EventExposure_Notify with an indication that UE is
reachable only for regulatory prioritized service, the SMF deactivates the PDU
Session if the service of the PDU Session is not regulatory prioritized. For
home routed roaming case, the V-SMF triggers the deactivation of the PDU
Session, in addition, the H-SMF refrains from sending downlink signalling if
the signalling is not related to regulatory prioritized service upon receiving
the notification.
#### 4.2.3.3 Network Triggered Service Request
This procedure is used when the network needs to signal (e.g. N1 signalling to
UE, Mobile-terminated SMS, User Plane connection activation for PDU Session(s)
to deliver mobile terminating user data) with a UE. When the procedure is
triggered by SMSF, PCF, LMF, GMLC, NEF, AMF or UDM, the SMF (and UPF, if
applicable) in the following figure should be replaced by the respective NF.
If the UE is in CM-IDLE state or CM-CONNECTED state in 3GPP access, the
network initiates a Network Triggered Service Request procedure. If the UE is
in CM-IDLE state and asynchronous type communication is not activated, the
network sends a Paging Request to (R)AN/UE. The Paging Request triggers the UE
Triggered Service Request procedure in the UE. If asynchronous type
communication is activated, the network stores the received message and
forward the message to the (R)AN and/or the UE (i.e. synchronizes the context
with the (R)AN and/or the UE) when the UE enters CM-CONNECTED state.
If the UE is in CM-IDLE state in non-3GPP access and if the UE is
simultaneously registered over 3GPP and non-3GPP accesses in a PLMN, the
network shall initiate a Network Triggered Service Request procedure over 3GPP
access.
If the UE is in CM-IDLE state in 3GPP access and in CM-CONNECTED state in
non-3GPP access and if the UE is simultaneously registered over 3GPP and
non-3GPP accesses in the same PLMN, the network may initiate a Network
Triggered Service Request procedure for 3GPP access via non-3GPP access.
For this procedure, the impacted SMF and UPF are all under control of the PLMN
serving the UE, e.g. in Home Routed roaming case the SMF and UPF in HPLMN are
not involved.
The procedure below covers the following non exhaustive list of use-cases for
3GPP access (detailed conditions of when the steps apply are stated in the
procedure below):
\- The SMF needs to setup N3 tunnel to deliver downlink packet to the UE for a
PDU Session and the UE is in CM-IDLE state: Step 3a contains an N2 message and
Step 4b (paging) is performed.
\- The SMF needs to setup N3 tunnel to deliver downlink packet to the UE for a
PDU Session and the UE is in CM-CONNECTED state: Step 3a contains an N2
message and Step 4a (UP reactivation) is performed.
\- NF (e.g. SMF, SMSF, PCF or LMF) needs to send an N1 message to the UE,
using the Namf_Communication_N1N2MessageTransfer service operation and the UE
is in CM-IDLE state: Step 3a contains an N1 message, Step 3b contains cause
\"Attempting to reach UE\" and Step 4b (paging) occurs.
\- The LMF triggers AMF, using the Namf_Communication_N1N2MessageTransfer
service operation, to setup a NAS connection with the UE and the UE is in CM-
IDLE state: Step 3b contains cause \"Attempting to reach UE\" and step 4b
(paging) occurs.
\- The GMLC triggers AMF, using the Namf_Location_ProvideLocation service
operation, to setup a NAS connection with the UE and the UE is in CM-IDLE
state: Step 4b (paging) occurs.
\- The PCF needs to send a message to the UE, using the
Npcf_AMPolicyControl_Create Response service operation, or the
Npcf_AMPolicyControl_UpdateNotify service operation and the UE is in CM-IDLE
state: Step 3a contains a message and step 4b (paging) occurs.
\- NF (e.g. SMSF or SMF) triggers AMF, using the Namf_MT_EnableUEReachability
service operation, to setup a NAS connection with the UE and the UE is in CM-
IDLE state: The trigger is specific to the procedure and Step 4b (paging)
occurs.
As described in clause 4.2.4.2, the AMF may also trigger the Network Triggered
Service Request before the AMF sends a UE Configuration Update.
Figure 4.2.3.3-1: Network Triggered Service Request
1\. When a UPF receives downlink data for a PDU Session and there is no AN
Tunnel Info stored in UPF for the PDU Session, based on the instruction from
the SMF (as described in clause 5.8.3 of TS 23.501 [2]), the UPF may buffer
the downlink data (steps 2a and 2b), or forward the downlink data to the SMF
(step 2c).
2a. UPF to SMF: Data Notification (N4 Session ID, Information to identify the
QoS Flow for the DL data packet, DSCP).
\- On arrival of the first downlink data packet for any QoS Flow, the UPF
shall send Data Notification message to the SMF, if the SMF has not previously
notified the UPF to not send the Data Notification to the SMF (in which case
the next steps are skipped).
\- If the UPF receives downlink data packets for another QoS Flow in the same
PDU Session, the UPF shall send another Data Notification message to the SMF.
\- If the Paging Policy Differentiation feature (as specified in clause 5.4.3
of TS 23.501 [2]) is supported by the UPF and if the PDU Session type is IP,
the UPF shall also include the DSCP in TOS (IPv4) / TC (IPv6) value from the
IP header of the downlink data packet and the information to identify the QoS
Flow for the DL data packet.
2b. SMF to UPF: Data Notification Ack.
2c. The UPF forwards the downlink data packets towards the SMF if the SMF
instructed the UPF to do so (i.e. the SMF will buffer the data packets).
\- If the Paging Policy Differentiation feature is supported by the SMF and if
the PDU Session type is IP, the SMF determines the Paging Policy Indicator
based on the DSCP in TOS (IPv4) / TC (IPv6) value from the IP header of the
received downlink data packet and identifies the corresponding QoS Flow from
the QFI of the received DL data packet.
3a. [Conditional] SMF to AMF: Namf_Communication_N1N2MessageTransfer (SUPI,
PDU Session ID, N1 SM container (SM message), N2 SM information (QFI(s), QoS
profile(s), CN N3 Tunnel Info, S-NSSAI), Area of validity for N2 SM
information, ARP, Paging Policy Indicator, 5QI, N1N2TransferFailure
Notification Target Address, Extended Buffering support), or NF to AMF:
Namf_Communication_N1N2MessageTransfer (SUPI, N1 message).
The SMF shall not include both N1 SM Container and N2 SM Information in
Namf_Communication_N1N2MessageTransfer unless the N1 SM Container is related
to the N2 SM Information.
If this step is triggered by a notification from UPF, upon reception of a Data
Notification message, for a PDU Session corresponding to a LADN, the SMF takes
actions as specified in clause 5.6.5 of TS 23.501 [2]. The SMF may notify the
UPF that originated the Data Notification to discard downlink data for the PDU
Sessions and/or to not provide further Data Notification messages.
Otherwise, the SMF determines whether to contact the AMF. The SMF does not
contact the AMF:
\- if the SMF had previously been notified that the UE is unreachable; or
\- if the UE is reachable only for regulatory prioritized service and the PDU
Session is not for regulatory prioritized service.
The SMF determines the AMF and invokes the
Namf_Communication_N1N2MessageTransfer to the AMF including the PDU Session ID
of the PDU Session. If this step is triggered by a notification from the UPF
in step 2a, the SMF determines the PDU Session ID based on the N4 Session ID
received in step 2a.
The SMF determines whether Extended Buffering applies based on local policy
and the capability of the SMF (for SMF-based buffering) or the capability of
the UPF (for UPF-based buffering). If Extended Buffering applies, the SMF
includes \"Extended Buffering support\" indication in
Namf_Communication_N1N2MessageTransfer.
If the SMF, while waiting for the User Plane Connection to be activated,
receives any additional Data Notification message or, in the case that the SMF
buffers the data packets, additional data packets for a QoS Flow associated
with a higher priority (i.e. ARP priority level) than the priority indicated
to the AMF in the previous Namf_Communication_N1N2MessageTransfer, or the SMF
derive a different Paging Policy Indicator according to the additional Data
Notification or the DSCP of the data packet, the SMF invokes a new
Namf_Communication_N1N2MessageTransfer indicating the higher priority or
different Paging Policy Indicator to the AMF.
If the SMF, while waiting for the User Plane to be activated, receives a
message from a new AMF other than the one to which the SMF invoked
theNamf_Communication_N1N2MessageTransfer, the SMF re-invokes the
Namf_Communication_N1N2MessageTransfer towards the new AMF.
When supporting Paging Policy Differentiation, the SMF determines the Paging
Policy Indicator related to the downlink data that has been received from the
UPF or triggered the Data Notification message, based on the DSCP as described
in clause 5.4.3 of TS 23.501 [2] and indicates the Paging Policy Indicator in
the Namf_Communication_N1N2MessageTransfer.
NOTE 1: AMF may receive request message(s) from other network functions which
leads to signalling towards UE/RAN, e.g. Network-initiated Deregistration, SMF
initiated PDU Session Modification. If the UE is in CM-CONNECTED state and the
AMF only delivers N1 message towards UE, the flow continues in step 6 below.
The N2 SM information is optional and is not provided e.g. in the case that
the SMF only wants to send an N1 message such as PDU Session Modification
Command with only updating the UE with a PCO.
For PDU session with user plane in Suspend mode (i.e. applying User Plane CIoT
5GS Optimisation as specified in clause 5.31.8 of TS 23.501 [2]) for 3GPP
access, the SMF uses Namf_MT_EnableUEReachability service operation if there
is neither N1 SM container nor N2 SM information to be delivered by SMF.
3b. [conditional] The AMF responds to the SMF.
If the UE is in CM-IDLE state at the AMF and the AMF is able to page the UE
the AMF sends a Namf_Communication_N1N2MessageTransfer response to the SMF
immediately to indicate to the SMF that AMF is attempting to reach UE and the
N2 SM information provided in step 3a, may be ignored by the AMF once the UE
is reachable and the SMF may be asked to provide the N2 SM information again.
While waiting for the UE to respond to a previous paging request, if the AMF
receives an Namf_Communication_N1N2MessageTransfer Request message with the
same or a lower priority than the previous message triggering the paging, or
if the AMF has determined not to trigger additional paging requests for this
UE based on local policy, the AMF rejects the
Namf_Communication_N1N2MessageTransfer Request message.
If the UE is in CM-CONNECTED state at the AMF then the AMF sends a
Namf_Communication_N1N2MessageTransfer response to the SMF immediately to
indicate that the N1/N2 message has been sent out.
If the UE is in CM-IDLE state and the AMF determines that the UE is not
reachable for paging, the AMF shall send an
Namf_Communication_N1N2MessageTransfer response to the NF from which AMF
received the request message in step 3a to indicate that the UE is not
reachable, or the AMF performs asynchronous type communication and stores the
UE context based on the received message, it shall send an
Namf_Communication_N1N2MessageTransfer response to indicate that asynchronous
type communication is invoked. If asynchronous type communication is invoked,
the AMF initiates communication with the UE and (R)AN when the UE is reachable
e.g. when the UE enters CM-CONNECTED state.
If the AMF detects that the UE context contains Paging Restriction
Information, the AMF may block the paging for this UE, based on local policy
and the stored Paging Restriction Information (see clause 5.38.1 of TS 23.501
[2]). If the AMF blocks paging, the AMF sends
Namf_Communication_N1N2MessageTransfer response with an indication that its
request has been rejected due to restricted paging to the NF from which AMF
received the request message in step 3a.
If the AMF has determined the UE is unreachable for the SMF (e.g. due to the
UE in MICO mode, the UE using extended idle mode DRX or the UE is only
registered over non-3GPP access and its state is CM-IDLE), then the AMF
rejects the request from the SMF. The AMF may include in the reject message an
indication that the SMF need not trigger the
Namf_Communication_N1N2MessageTransfer Request to the AMF, if the SMF has not
subscribed to the event of the UE reachability. If the SMF included the
Extended Buffering Support indication, the AMF indicates the Estimated Maximum
Wait time, in the reject message, for the SMF to determine the Extended
Buffering time. If the UE is in MICO mode, the AMF determines the Estimated
Maximum Wait time based on the next expected periodic registration by the UE
or by implementation. If the UE is using extended idle mode DRX, the AMF
determines the Estimated Maximum Wait time based on the start of the next
Paging Time Window. The AMF stores an indication that the SMF has been
informed that the UE is unreachable.
If the AMF has determined the UE is reachable and the AMF detects the UE is in
a Non-Allowed Area unless the request from the SMF is for regulatory
prioritized service, the AMF rejects the request from the SMF and notifies the
SMF that the UE is reachable only for regulatory prioritized service. The AMF
stores an indication that the SMF has been informed that the UE is reachable
only for regulatory prioritized service. If the AMF cannot determine whether
the UE is in a Non-Allowed Area (e.g. due to UE\'s Registration Area
containing both Allowed area and Non-Allowed Area), the procedure continues in
step 4.
If the Registration procedure with AMF change is in progress when the old AMF
receives the Namf_Communication_N1N2MessageTransfer, the old AMF may reject
the request with an indication that the Namf_Communication_N1N2MessageTransfer
has been temporarily rejected.
Upon reception of an Namf_Communication_N1N2MessageTransfer response with an
indication that its request has been temporarily rejected, the SMF shall start
a locally configured guard timer and wait for any message to come from an AMF.
Upon reception of a message from an AMF, the SMF shall re-invoke the
Namf_Communication_N1N2MessageTransfer (with N2 SM info and/or N1 SM info) to
the AMF from which it received the message. Otherwise the SMF takes the step
3c at expiry of the guard timer. If the SMF decides that the control plane
buffering applies, the SMF shall request UPF to start forwarding the downlink
data PDU towards the SMF.
3c. [Conditional] SMF responds to the UPF
SMF may notify the UPF about the User Plane setup failure.
If the SMF receives an indication from the AMF that the UE is unreachable or
reachable only for regulatory prioritized service and the SMF determines that
Extended Buffering does not apply, the SMF may, based on network policies,
either:
\- indicate to the UPF to stop sending Data Notifications;
\- indicate to the UPF to stop buffering DL data and discard the buffered
data;
\- indicate to the UPF to stop sending Data Notifications and stop buffering
DL data and discard the buffered data; or
\- refrains from sending further Namf_Communication_N1N2MessageTransfer
message for DL data to the AMF while the UE is unreachable.
Then the SMF subscribes to the AMF for UE reachability event notifications.
Based on operator policies, the SMF applies the pause of charging procedure as
specified in clause 4.4.4.
If the SMF receives an indication from the AMF that the
Namf_Communication_N1N2MessageTransfer message requested from an SMF has been
temporarily rejected, the SMF may, based on network policies, indicate to the
UPF to apply temporary buffering.
If the SMF receives an \"Estimated Maximum Wait time\" from the AMF and
Extended Buffering applies, the SMF may either:
\- If the DL data buffering in the SMF applies, store the DL Data for an
Extended Buffering time. The SMF does not send any additional
Namf_Communication_N1N2MessageTransfer message if subsequent downlink data
packets are received. If the Extended Buffering timer expires, the SMF
discards the buffered downlink data.
\- If the DL data buffering in the UPF applies, send a Failure indication with
an indication to the UPF to buffer the DL data with an Extended Buffering time
and optionally a DL Buffering Suggested Packet Count. The Suggested Number of
Downlink Packets network configuration parameter (if available) may be used to
derive the value for DL Buffering Suggested Packet Count. The SMF may also
indicate to the UPF to stop sending Data Notifications.
The Extended Buffering time is determined by the SMF and should be larger or
equal to the Estimated Maximum Wait time received from the AMF.
If the UPF receives an Extended Buffering indication from the SMF, the UPF
initiates Extended Buffering of the downlink data and starts an Extended
Buffering timer. If the Extended Buffering timer expires, the UPF discards the
buffered downlink data.
4a. [Conditional] If the UE is in CM-CONNECTED state in the access associated
with the PDU Session ID received from the SMF in step 3a, the steps 4 to 22 in
UE Triggered Service Request procedure (see clause 4.2.3.2) are performed for
this PDU Session (i.e. establish the radio resources and in the case that the
User Plane is to be activated, to establish the N3 tunnel) without sending a
Paging message to the (R)AN node and the UE. In step 12 of clause 4.2.3.2, the
AMF does not send the NAS Service Accept message to the UE. The rest of this
procedure is omitted.
4b. [Conditional] If the UE is in CM-IDLE state in 3GPP access and the PDU
Session ID received from the SMF in step 3a has been associated with 3GPP
access and based on local policy the AMF decides to notify the UE through 3GPP
access even when UE is in CM-CONNECTED state for non-3GPP access, the AMF may
send a Paging message to NG-RAN node(s) via 3GPP access.
If the UE is simultaneously registered over 3GPP and non-3GPP accesses in the
same PLMN, the UE is in CM-IDLE state in both 3GPP access and non-3GPP access
and the PDU Session ID in step 3a is associated with non-3GPP access, the AMF
sends a Paging message with associated access \"non-3GPP\" to NG-RAN node(s)
via 3GPP access.
If the UE is in RM-REGISTERED state and CM-IDLE and reachable in 3GPP access,
the AMF sends a Paging message (NAS ID for paging, Registration Area list,
Paging DRX length, Paging Priority, access associated to the PDU Session,
Enhanced Coverage Restricted information, WUS Assistance Information) to (R)AN
node(s) belonging to the Registration Area(s) in which the UE is registered,
then the NG-RAN node pages the UE, including the access associated to the PDU
Session in the paging message if received from the AMF, see TS 38.331 [12]. If
extended idle mode DRX was accepted by the AMF in the last registration
procedure, the AMF includes extended idle mode DRX cycle length and Paging
Time Window in the Paging message. The AMF shall ensure that the correct
Paging DRX length is provided based on the accepted UE Specific DRX of the
current RAT.
NOTE 2: The usage of the Access associated with a PDU Session when paging an
UE is defined in clause 5.6.8 of TS 23.501 [2].
NOTE 3: This step is performed also when the UE and the network support User
Plane CIoT 5GS Optimisation and the previous RRC connection has been
suspended. For PDU session in Suspend mode, the SMF uses the service operation
as described in step 3a.
Different paging strategies may be configured in the AMF for different
combinations of DNN, Paging Policy Indicator (if supported), ARP and 5QI.
For RRC_INACTIVE state, the paging strategies may be configured in the (R)AN
for different combinations of Paging Policy Indicator, ARP and 5QI.
Paging Priority is included only:
\- if the AMF receives an Namf_Communication_N1N2MessageTransfer message with
an ARP value associated with priority services (e.g. MPS, MCS), as configured
by the operator.
\- if the AMF receives an Nudm_SDM_Notification message for a change in
priority subscription (e.g. MPS), with a priority value as configured by the
operator.
\- One Paging Priority level can be used for multiple ARP values. The mapping
of ARP values to Paging Priority level (or levels) is configured by operator
policy in the AMF and in NG-RAN.
The (R)AN may prioritise the paging of UEs according to the Paging Priority.
If the AMF, while waiting for a UE response to the Paging Request message sent
without Paging Priority, receives an Namf_Communication_N1N2MessageTransfer
message, which indicates an ARP value associated with priority services (e.g.
MPS, MCS), as configured by the operator, the AMF shall send another paging
message with the suitable Paging Priority. For subsequent received
Namf_Communication_N1N2MessageTransfer messages with the same or higher
priority, the AMF may determine whether to send the Paging message with
suitable Paging Priority based on local policy.
If the AMF has assigned PEIPS Assistance Information, the AMF shall provide
the information. The NG-RAN uses this information as described in TS 23.501
[2].
Paging strategies may include:
\- paging retransmission scheme (e.g. how frequently the paging is repeated or
with what time interval);
\- determining whether to send the Paging message to the (R)AN nodes during
certain AMF high load conditions;
\- whether to apply sub-area based paging (e.g. first page in the last known
cell-id or TA and retransmission in all registered TAs).
NOTE 4: Setting of Paging Priority in the Paging message is independent from
any paging strategy.
The AMF and the (R)AN may support further paging optimisations in order to
reduce the signalling load and the network resources used to successfully page
a UE by one or several of the following means:
\- by the AMF implementing specific paging strategies (e.g. the N2 Paging
message is sent to the (R)AN nodes that served the UE last);
\- by the AMF considering Information On Recommended Cells And NG-RAN nodes
provided by the (R)AN at transition to CM-IDLE state. The AMF takes the (R)AN
nodes related part of this information into account to determine the (R)AN
nodes to be paged and provides the information on recommended cells within the
N2 Paging message to each of these (R)AN nodes;
\- by the (R)AN considering the Paging Attempt Count Information provided by
the AMF at paging.
If the UE Radio Capability for Paging Information is available in the AMF, the
AMF adds the UE Radio Capability for Paging Information in the N2 Paging
message to the (R)AN nodes.
If the Information On Recommended Cells And (R)AN nodes For Paging is
available in the AMF, the AMF shall take that information into account to
determine the (R)AN nodes for paging and when paging a (R)AN node, the AMF may
transparently convey the information on recommended cells to the (R)AN node.
The AMF may include in the N2 Paging message(s) the paging attempt count
information. The paging attempt count information shall be the same for all
(R)AN nodes selected by the AMF for paging.
If the AMF has Paging Assistance Data for CE capable UE stored in the UE
Context in AMF and Enhanced Coverage is not restricted for the UE then the AMF
shall include Paging Assistance Data for CE capable UE in the N2 paging
message for all NG-RAN nodes selected by the AMF for paging.
The AMF may include in the N2 Paging message(s) the WUS Assistance
Information, if available. If the WUS Assistance Information is included by
the N2 Paging message, the NG-eNB takes it into account when paging the UE
(see TS 36.300 [46]).
The AMF may include in the N2 paging message the PLMN ID(s) of Serving PLMN
and equivalent PLMN(s) supported by NG-RAN and corresponding CAG information
per PLMN ID which including an Allowed CAG list and optionally an indication
whether the UE is only allowed to access 5GS via CAG cells, if available. If
the above information is included in N2 paging message, the NG-RAN node may
take it into account when determining the cells where paging will be performed
(see TS 38.413 [10]).
If the UE and NG-eNB support WUS, then:
\- if the NGAP Paging message contains the _Assistance Data for Recommended
Cells_ IE (see TS 38.413 [10]), the NG-eNB shall only broadcast the UE\'s Wake
Up Signal in the last used cell;
\- else (i.e. the _Assistance Data for Recommended Cells_ IE is not included
in the NGAP Paging message) the eNodeB should not broadcast the UE\'s Wake Up
Signal.
If the network supports the Paging Cause Indication for Voice Service feature
and if the UE context in the AMF indicates that the UE supports the Paging
Cause Indication for Voice Service feature, the AMF should provide the Voice
Service Indication in the NGAP Paging message only when the AMF detects that
the downlink data which triggers the Paging message is related to voice
service, as specified in clause 5.38.3 of TS 23.501 [2]. If the NG RAN
supporting the Paging Cause Indication for Voice Service feature receives the
Voice Service Indication, it provides the Voice Service Indication in the
Paging message and sends the Paging message to the UE.
4c. [Conditional] If the UE is simultaneously registered over 3GPP and
non-3GPP accesses in the same PLMN and the UE is in CM-CONNECTED state in 3GPP
access and the PDU Session ID in step 3a is associated with non-3GPP access,
the AMF sends a NAS Notification message containing the non-3GPP Access Type
to the UE over 3GPP access and sets a Notification timer. Step 5 is omitted.
If the UE is simultaneously registered over 3GPP and non-3GPP accesses in the
same PLMN and the UE is in CM-CONNECTED state for non-3GPP access and in CM-
IDLE for 3GPP access and if the PDU Session ID in step 3a is associated with
3GPP access and based on local policy the AMF decides to notify the UE through
non-3GPP access, the AMF may send a NAS Notification message containing the
3GPP Access Type to the UE over non-3GPP access and sets a Notification timer.
If the network supports the Paging Cause Indication for Voice Service feature
and if the UE context in the AMF indicates that the UE supports the Paging
Cause Indication for Voice Service feature and the AMF detects that the
downlink data is related to voice service, as specified in clause 5.38.3 of TS
23.501 [2], the AMF shall send Paging message over 3GPP access as specified in
step 4b.
NOTE 5: This step is performed also when the UE and the network support User
Plane CIoT 5GS Optimisation in 3GPP access and the previous RRC connection has
been suspended.
5\. [Conditional] AMF to SMF: Namf_Communication_N1N2Transfer Failure
Notification.
The AMF supervises the paging procedure with a timer. If the AMF receives no
response from the UE to the Paging Request message, the AMF may apply further
paging according to any applicable paging strategy described in step 4b.
The AMF notifies the SMF by sending Namf_Communications_N1N2MessageTransfer
Failure Notification to the Notification Target Address provided by the SMF in
step 3a if the UE does not respond to paging, unless the AMF is aware of an
ongoing MM procedure that prevents the UE from responding, i.e. the AMF
receives an N14 Context Request message indicating that the UE performs
Registration procedure with another AMF.
When a Namf_Communication_N1N2Transfer Failure Notification is received, SMF
informs the UPF (if applicable).
Procedure for pause of charging at SMF is specified in clause 4.4.4.
6\. If the UE is in CM-IDLE state in 3GPP access, upon reception of paging
request for a PDU Session associated to 3GPP access, the UE shall initiate the
UE Triggered Service Request procedure (clause 4.2.3.2) or, if the UE is
enabled to use User Plane CIoT 5GS Optimisation and there is suspended access
stratum context stored in the UE, the UE initiates the Connection Resume in
CM-IDLE with Suspend procedure (clause 4.8.2.3). To support the buffered data
forwarding, the SMF instruct the UPF to establish a Data forwarding tunnel
between the old UPF and the new UPF or to the PSA as described at steps 6a,
7a, 8a of clause 4.2.3.2.
If the UE is in CM-IDLE state in 3GPP access and is using the Multi-USIM
Paging Rejection feature (see clause 5.38 of TS 23.501 [2]), upon reception of
paging request and if the UE determines not to accept the paging, the UE
attempts to send a Reject Paging Indication via the UE Triggered Service
Request procedure (clause 4.2.3.2) unless it is unable to do so e.g. due to UE
implementation constraints.
If the UE is in CM-IDLE state in both non-3GPP and 3GPP accesses, upon
reception of paging request for a PDU Session associated to non-3GPP access,
the UE shall initiate the UE Triggered Service Request procedure (clause
4.2.3.2) which shall contain the List Of Allowed PDU Sessions that, according
to UE policies and whether the S-NSSAIs of these PDU Sessions are within the
Allowed NSSAI or Partially Allowed NSSAI, if the serving cell is in a TA where
the S-NSSAIs are supported or in a serving cell where the S-NSSAIs are
available (according to clause 5.15.18 of TS 23.501 [2]) for 3GPP access, can
be re-activated over the 3GPP access. If there is no PDU Session that can be
re-activated over the 3GPP access, the UE includes an empty List Of Allowed
PDU Sessions. If the AMF receives a Service Request message from the UE via
non-3GPP access as described in clause 4.12.4.1 (e.g. because the UE
successfully connects to a non-3GPP access), the AMF stops the paging
procedure and processes the received Service Request procedure. If the AMF
receives the Service Request message and the List Of Allowed PDU Sessions
provided by the UE does not include the PDU Session for which the UE was
paged, the AMF notifies the SMF that the UE was reachable but did not accept
to re-activate the PDU Session by invoking Namf_EventExposure_Notify service
as described in step 4 of clause 4.2.3.2.
If the UE is in CM-IDLE state in non-3GPP access and in CM-CONNECTED state in
3GPP access, upon reception of NAS Notification message over 3GPP access
containing the non-3GPP Access Type, the UE shall initiate the UE Triggered
Service Request procedure (clause 4.2.3.2) with the List Of Allowed PDU
Sessions that, according to UE policies and whether the S-NSSAIs of these PDU
Sessions are within the Allowed NSSAI or Partially Allowed NSSAI, if the
serving cell is in a TA where the S-NSSAIs are supported or in a serving cell
where the S-NSSAIs are available (according to clause 5.15.18 of TS 23.501
[2]) for 3GPP access, can be re-activated over the 3GPP access. If there is no
PDU Session that can be re-activated over the 3GPP access, the UE include an
empty List Of Allowed PDU Sessions. When the AMF receives the Service Request
message and the List of Allowed PDU Sessions provided by the UE does not
include the PDU Session for which the UE was notified, the AMF notifies the
SMF that the UE was reachable but did not accept to re-activate the PDU
Session by invoking Namf_EventExposure_Notify service. If the AMF receives a
Service Request message from the UE via non-3GPP access as described in clause
4.12.4.1 (e.g. because the UE successfully connects to a non-3GPP access), the
AMF stops the Notification timer and processes the received Service Request
procedure.
\- Alternatively, if the UE is in CM-IDLE state in non-3GPP access with the
Mobility Management back-off timer running, upon reception of Paging Message
over 3GPP access containing the non-3GPP Access Type, the UE on stopping the
back-off timer (for both accesses), shall initiate the UE Triggered Service
Request procedure (clause 4.12.4.1) over non-3GPP access if non-3GPP access is
available. When the AMF receives a Service Request message from the UE via
non-3GPP access, the AMF stops the Paging timer and processes the received
Service Request.
NOTE 6: A scenario where the UE is CM-IDLE over non-3GPP access and yet
non-3GPP access is available, is when the UE over the non-3GPP access is
running the Mobility Management back-off timer and network has released the
NAS signalling connection upon service reject.
If the UE is in CM-IDLE state in 3GPP access and in CM-CONNECTED state in
non-3GPP access, upon reception of NAS Notification message over non-3GPP
access identifying the 3GPP access type, the UE shall initiate the UE
triggered Service Request procedure (clause 4.2.3.2) over the 3GPP access when
3GPP access is available. The Multi-USIM UE may not be able to trigger Service
Request procedure (clause 4.2.3.2) over the 3GPP access to response the NAS
Notification, e.g. due to UE implementation constraints. If the AMF does not
receive the Service Request message before Notification timer expires, the AMF
may either page the UE through 3GPP access or notify the SMF that the UE was
not able to re-activate the PDU Session.
The User Plane of all PDU Sessions for URLLC shall be activated during the
Service Request procedure if the UE initiates the Service Request from 3GPP
access in CM-IDLE state as described in clause 4.2.3.2.
6a. After receiving the Reject Paging Indication, the AMF notifies the SMF
using the Namf_Communication_N1N2MessageTransfer Failure Notification that the
UE rejected the page and no user plane connection will be established. The UE
remains reachable for future paging attempts.
If the AMF detects the UE is in a Non-Allowed Area unless the request from the
SMF is for regulatory prioritized service, the AMF rejects the request from
the SMF and notifies the SMF that the UE is reachable only for regulatory
prioritized service. The AMF stores an indication that the SMF has been
informed that the UE is reachable only for regulatory prioritized service.
7\. If the AMF has paged the UE to trigger the Service Request Procedure, the
AMF shall initiate the UE configuration update procedure as defined in clause
4.2.4.2 to assign a new 5G-GUTI. If the UE response in the Service Request
includes a Reject Paging Indication, the AMF triggers the release of the UE as
specified in clause 4.2.3.2.
8\. The UPF transmits the buffered downlink data toward UE via (R)AN node
which performed the Service Request procedure. If data is buffered in the SMF,
the SMF delivers buffered downlink data to the UPF.
The network also sends downlink signalling to the UE if the procedure is
triggered due to request from other NFs, as described in step 3a.
### 4.2.4 UE Configuration Update
#### 4.2.4.1 General
UE configuration may be updated by the network at any time using UE
Configuration Update procedure. UE configuration includes:
\- Access and Mobility Management related parameters decided and provided by
the AMF. This includes the Configured NSSAI and its mapping to the Subscribed
S-NSSAIs, the Allowed NSSAI and its mapping to Subscribed S-NSSAIs, the
Partially Allowed NSSAI and its mapping to Subscribed S-NSSAIs, the list of
S-NSSAI(s) rejected partially in the RA, the Service Gap time, the list of
Rejected NSSAIs if the UE Configuration Update procedure is triggered by the
AMF after Network Slice-Specific Authentication and Authorization of S-NSSAIs,
the Truncated 5G-S-TMSI Configuration and a priority subscription indication
(e.g. MPS). If the UE and the AMF support RACS, this may also include a PLMN-
assigned UE Radio Capability ID or alternatively a PLMN-assigned UE Radio
Capability ID deletion indication. If the UE and AMF supports Disaster Roaming
service, this may also include the \"list of PLMN(s) to be used in Disaster
Condition\", Disaster Roaming wait range information, Disaster Return wait
range information and notifying UE that the disaster condition is no longer
applicable, as specified in TS 23.501 [2]. The AMF may also update MBSR (IAB-
UE) with MBSR authorization information as specified in clause 5.35A.4 of TS
23.501 [2], S-NSSAI location availability information.
\- UE Policy provided by the PCF.
When AMF wants to change the UE configuration for access and mobility
management related parameters the AMF initiates the procedure defined in
clause 4.2.4.2. When the PCF wants to change or provide new UE Policies in the
UE, the PCF initiates the procedure defined in clause 4.2.4.3.
If the UE Configuration Update procedure requires the UE to initiate a
Registration procedure, the AMF indicates this to the UE explicitly.
The procedure in clause 4.2.4.2 may be triggered also when the AAA Server that
performed Network Slice-Specific Authentication and Authorization for an
S-NSSAI revokes the authorization.
#### 4.2.4.2 UE Configuration Update procedure for access and mobility
management related parameters
This procedure is initiated by the AMF when the AMF wants to update access and
mobility management related parameters in the UE configuration.
This procedure is also used to trigger UE to perform, based on network
indication, either Mobility Registration Update procedure while the UE is in
CM-CONNECTED state to modify NAS parameters that require negotiation (e.g.
MICO mode) or to steer the UE towards EPC as specified in clause 5.31.3 of TS
23.501 [2], or Mobility Registration Update procedure after the UE enters CM-
IDLE state (e.g. for changes to Allowed NSSAI that require re-registration) or
to update the UE with the Alternative S-NSSAI. If a Registration procedure is
needed, the AMF provides an indication to the UE to initiate a Registration
procedure.
UE Configuration Update shall be sent over the Access Type (i.e. 3GPP access
or non-3GPP access) the UE Configuration Update is applied to, when
applicable. If the AMF wants to update NAS parameters in the UE which require
UE acknowledgement, then the AMF provides an indication to the UE of whether
the UE shall acknowledge the command or not. The AMF should not request
acknowledgement of the NITZ command. The AMF shall request acknowledgement for
NSSAI information (e.g. Allowed NSSAI, Partially Allowed NSSAI, S-NSSAI
rejected partially in the RA), 5G-GUTI, TAI List, [TAI List for S-NSSAIs in
Partially Allowed NSSAI], [TAI List for S-NSSAI(s) rejected partially in RA]
and Mobility Restrictions, LADN Information, MICO, Operator-defined access
category definitions, PLMN-assigned UE Radio Capability ID, S-NSSAI location
availability information and SMS subscription.
Figure 4.2.4.2-1: UE Configuration Update procedure for access and mobility
management related parameters
0\. AMF determines the necessity of UE configuration change due to various
reasons (e.g. UE mobility change, NW policy, reception of Subscriber Data
Update Notification from UDM, change of Network Slice configuration (including
due to change of the NSSRG information in subscription information as
specified in clause 5.15.12 of TS 23.501 [2], or due to change of NSAG
Information as specified in clause 5.15.14 of TS 23.501 [2]), or to remove
S-NSSAI from the Allowed NSSAI due to expiry of slice deregistration
inactivity timer or to provide the UE with updated Slice Usage Policy as
specified in clause 5.15.15 of TS 23.501 [2], need to assign PLMN-assigned UE
Radio Capability ID, change of Enhanced Coverage Restriction information in
the UE context, informing MBSR (IAB-UE) authorization state changes as
specified in clause 5.35A.4 of TS 23.501 [2] based on operator configuration,
a change related to discontinuous coverage (e.g. out-of-coverage period
change), need to notify the UE to reconnect to the network due to NG-RAN
timing synchronization status change as specified in clause 4.15.9.4) or that
the UE needs to perform a Registration Procedure. If a UE is in CM-IDLE, the
AMF can wait until the UE is in CM-CONNECTED state or triggers Network
Triggered Service Request (in clause 4.2.3.3).
NOTE 1: It is up to the network implementation whether the AMF can wait until
the UE is in CM-CONNECTED state or trigger the Network Triggered Service
Request.
NOTE 2: The AMF can check whether Network Slice configuration needs to be
updated by using the Nnssf_NSSelection_Get service operation and in such case
the AMF compares the stored information with the output from the NSSF to
decide whether an update of the UE is required.
The AMF may include Mobility Restriction List in N2 message that delivers UE
Configuration Update Command to the UE if the service area restriction for the
UE is updated.
1\. The AMF sends UE Configuration Update Command containing one or more UE
parameters (Configuration Update Indication, 5G-GUTI, TAI List, Allowed NSSAI,
Mapping Of Allowed NSSAI, [Partially Allowed NSSAI], [Mapping Of Partially
Allowed NSSAI], [TAI List for S-NSSAIs in Partially Allowed NSSAI], Configured
NSSAI for the Serving PLMN, Mapping Of Configured NSSAI, [NSSRG Information],
rejected S-NSSAIs, [TAI List for S-NSSAI(s) rejected partially in RA], NITZ,
Mobility Restrictions, LADN Information, MICO, Operator-defined access
category definitions, SMS Subscribed Indication, [PLMN-assigned UE Radio
Capability ID], [PLMN-assigned UE Radio Capability ID deletion indication],
[\"List of PLMN(s) to be used in Disaster Condition\"], [Disaster Roaming wait
range information], [Disaster Return wait range information], [MPS priority],
[MCX priority], [UAS services Indication], MBSR authorization information,
[S-NSSAI location availability information], [Mapping Of Alternative NSSAI],
UE reconnection indication, [Slice Usage Policy], [Maximum Time Offset]) to
the UE. Optionally, the AMF may update the rejected S-NSSAIs in the UE
Configuration Update command.
The AMF includes one or more of 5G-GUTI, TAI List, Allowed NSSAI, Mapping Of
Allowed NSSAI, Partially Allowed NSSAI, Mapping Of Partially Allowed NSSAI,
[TAI List for S-NSSAIs in Partially Allowed NSSAI], Configured NSSAI for the
Serving PLMN, Mapping Of Configured NSSAI, rejected S-NSSAIs, [TAI List for
S-NSSAI(s) rejected partially in RA], NITZ (Network Identity and Time Zone),
Mobility Restrictions parameters, LADN Information, Operator-defined access
category definitions, PLMN-assigned UE Radio Capability ID, or SMS Subscribed
Indication if the AMF wants to update these NAS parameters without triggering
a UE Registration procedure.
The AMF may include in the UE Configuration Update Command also Configuration
Update Indication parameters indicating whether:
\- Network Slicing Subscription Change has occurred;
\- the UE shall acknowledge the command; and
\- whether a Registration procedure is requested.
If the AMF indicates Network Slicing Subscription Change, then the UE shall
locally erase all the network slicing configuration for all PLMNs and if
applicable, update the configuration for the current PLMN based on any
received information. If the AMF indicates Network Slicing Subscription
Change, the UE shall also be requested to acknowledge in step 2.
If the AMF also includes in the UE Configuration Update Command message a new
Configured NSSAI for the Serving PLMN, then the AMF should also include a new
Allowed NSSAI with, if available, the associated Mapping Of Allowed NSSAI,
unless the AMF cannot determine the new Allowed NSSAI after the Subscribed
S-NSSAI(s) are updated, in which case the AMF does not include in the UE
Configuration Update Command message any Allowed NSSAI. If the UE has
indicated its support of the subscription-based restrictions to simultaneous
registration of network slices feature in the UE 5GMM Core Network Capability,
the AMF includes, if available, the NSSRG Information, defined in clause
5.15.12 of TS 23.501 [2]. If the UE has not indicated its support of the
subscription-based restrictions to simultaneous registration of network slices
feature and the subscription information for the UE includes NSSRG information
and the AMF is providing the Configured NSSAI to the UE, the Configured NSSAI
shall include the S-NSSAIs according to clause 5.15.12 of TS 23.501 [2]. For a
non-roaming UE, if the UE has indicated its support of Slice Usage Policy in
the UE 5GMM Core Network Capability, the AMF may include Slice Usage Policies
for slices in the Configured NSSAI as described in clause 5.15.15 of TS 23.501
[2]. In the Slice Usage Policy, the AMF indicates an S-NSSAI is on demand
slice and slice deregistration inactivity timer value. If the AMF includes
slice deregistration timer value, the UE starts any slice deregistration
inactivity timer for the on demand S-NSSAIs as described in clause 5.15.15 of
TS 23.501 [2].
If the UE has indicated its support of NSAG feature in 5GMM Core Network
Capability, the AMF includes, if available, the NSAG Information, defined in
clause 5.15.14 of TS 23.501 [2] when providing a new Configured NSSAI which
includes S-NSSAIs with associated NSAG Value(s) or when the NSAG Information
changes for some S-NSSAI in the Configured NSSAI. When NSAG Information is
provided to the UE, the AMF requests the UE to acknowledge the UE
Configuration Command message.
When the UE and the AMF supports RACS as defined in clause 5.4.4.1a of TS
23.501 [2] and the AMF needs to configure the UE with a UE Radio Capability ID
and the AMF already has the UE radio capabilities other than NB-IoT radio
capabilities for the UE and the AMF may provide the UE with the UE Radio
Capability ID for the UE radio capabilities the UCMF returns to the AMF in a
Nucmf_assign service operation for this UE.
If the UE is needed to be redirected to the dedicated frequency band(s) for
S-NSSAI(s), the AMF may determine a Target NSSAI, as described in clause
5.3.4.3.3 of TS 23.501 [2], itself or by interacting with the NSSF using
Nnssf_NSSelection_Get which includes e.g. the Rejected S-NSSAI(s) for RA and
Allowed NSSAI. The AMF may determine RFSP index associated to the Target NSSAI
by interacting with the PCF using Npcf_AMPolicyControl_Update which includes
the Target NSSAI to retrieve a corresponding RFSP index or based on local
configuration in case PCF is not deployed. The Target NSSAI and the RFSP index
associated with the Target NSSAI are provided to the NG-RAN within the N2
message carrying the UE Configuration Update Command message.
If the UE and AMF supports Disaster Roaming service, the AMF may include the
\"list of PLMN(s) to be used in Disaster Condition\", Disaster Roaming wait
range information and Disaster Return wait range information as specified in
TS 23.501 [2]. When the disaster condition is no longer applicable, the
serving AMF that provides Disaster Roaming service may notify the UE as
specified in clause 5.40.5 of TS 23.501 [2].
If the AMF receives a Subscriber Data Update Notification from the UDM that
includes MPS priority or MCX priority, the AMF includes MPS priority or MCX
priority in the UE Configuration Update Command, respectively, as specified in
clause 5.22.2 of TS 23.501 [2].
If UAS service becomes enabled or disabled (e.g. because the aerial
subscription is part of the UE subscription data retrieved from UDM changes),
the AMF may include an Indication of UAS services being enabled or disabled in
the UE Configuration Update Command.
If the UE indicates its support of LADN per DNN and S-NSSAI in the UE MM Core
Network Capability during the Registration procedure as specified in clause
4.2.2.2.2, the AMF may include LADN Information per DNN and S-NSSAI.
For MBSR (IAB-UE) registered in AMF, the AMF may update the MBSR authorization
information as specified in clause 5.35A.4 of TS 23.501 [2].
If the UE indicated a support for the Network Slice Replacement feature in the
5GMM Core Network Capability and the AMF determines that an S-NSSAI from an
Allowed NSSAI is to be replaced with an Alternative S-NSSAI (as described in
clause 5.15.19 of TS 23.501 [2]), the AMF includes the Mapping Of Alternative
NSSAI within the UE Configuration Update Command to the UE and also adds the
Alternative S-NSSAI to the Allowed NSSAI and/or Configured NSSAI, if not
already included.
If both the UE and the network support unavailability due to discontinuous
coverage, the AMF determines this Maximum Time Offset as described in clause
5.4.13.5 of TS 23.501 [2]. The AMF includes the Maximum Time Offset within the
UE Configuration Update Command to the UE.
2a. If the UE Configuration Update Indication requires acknowledgement of the
UE Configuration Update Command, then the UE shall send a UE Configuration
Update complete message to the AMF. The AMF should request acknowledgement for
all UE Configuration Updates, except when only NITZ is provided. If
Registration procedure is not required, steps 3a, 3b, 3c and step 4 are
skipped. If the Configuration Update Indication is included in the UE
Configuration Update Command message and it requires a Registration procedure,
depending on the other NAS parameters included in the UE Configuration Update
command, the UE shall execute steps 3a or 3b or 3c+4 as applicable.
If the PLMN-assigned UE Radio Capability ID is included in step1, the AMF
stores the UE Radio Capability ID in UE context if receiving UE Configuration
Update complete message.
If the UE receives PLMN-assigned UE Radio Capability ID deletion indication in
step 1, the UE shall delete the PLMN-assigned UE Radio Capability ID(s) for
this PLMN. If UE Configuration Update is only for this purpose, the following
steps are skipped.
2b. [Conditional] The AMF also uses the Nudm_SDM_Info service operation to
provide an acknowledgment to UDM that the UE received CAG information as part
of the Mobility Restrictions (if the CAG information was updated), or the
Network Slicing Subscription Change Indication (if this was indicated in step
1) and acted upon it.
2c. [Conditional] If the AMF has reconfigured the 5G-GUTI over 3GPP access,
the AMF informs the NG-RAN of the new UE Identity Index Value (derived from
the new 5G-GUTI) when the AMF receives the acknowledgement from the UE in step
2a.
[Conditional] If the UE is registered to the same PLMN via both 3GPP and
non-3GPP access and if the AMF has reconfigured the 5G-GUTI over non-3GPP
access and the UE is in CM-CONNECTED state over 3GPP access, then the AMF
informs the NG-RAN of the new UE Identity Index Value (derived from the new
5G-GUTI) when the AMF receives the acknowledgement from the UE in step 2a.
[Conditional] If the AMF has configured the UE with a PLMN-assigned UE Radio
Capability ID, the AMF informs NG-RAN of the UE Radio Capability ID, when it
receives the acknowledgement from the UE in step 2a.
[Conditional] If the Mobility Restrictions for the UE were updated and the
Mobility Restrictions were not provided in the N2 message that delivers the UE
Configuration Update Command, the AMF provides the NG-RAN with updated
Mobility Restrictions unless the AMF releases the UE in this step (see below).
If the AMF initiated the UE Configuration Update procedure due to receiving
Nudm_SDM_Notification and the CAG information has changed such that a CAG
Identifier has been removed from the Allowed CAG list or the UE is only
allowed to access CAG cells, the AMF shall release the NAS signalling
connection by triggering the AN Release procedure for UEs that are not
receiving Emergency Services as defined in TS 23.501 [2].
If the AMF need to update Allowed CAG list to the NG-RAN due to change of
validity condition as described in TS 23.501 [2], the AMF may either update
NG-RAN and keep the NAS signalling connection or release the NAS signalling
connection by triggering the AN Release procedure, without updating Allowed
CAG list to the NG-RAN, for the UEs that are not receiving Emergency Services
as defined in TS 23.501 [2].
NOTE 3: If validity condition needs to be applied immediately before the NG-
RAN enforces Allowed CAG list, the AMF can trigger AN Release without sending
updated Allowed CAG list to the NG-RAN.
NOTE 4: When the UE is accessing the network for emergency service the
conditions in clause 5.16.4.3 of TS 23.501 [2] apply.
2d [Conditional] If the UE is configured with a new 5G-GUTI in step 2a via
non-3GPP access and the UE is registered to the same PLMN via both 3GPP and
non-3GPP access, then the UE passes the new 5G-GUTI to its 3GPP access\' lower
layers.
If the UE is configured with a new 5G-GUTI in step 2a over the 3GPP access,
the UE passes the new 5G-GUTI to its 3GPP access\' lower layers.
NOTE 5: Steps 2c and 2d are needed because the NG-RAN may use the RRC_INACTIVE
state and a part of the 5G-GUTI is used to calculate the Paging Frame (see TS
38.304 [44] and TS 36.304 [43]). It is assumed that the UE Configuration
Update Complete is reliably delivered to the AMF after the 5G-AN has
acknowledged its receipt to the UE.
3a. [Conditional] If only NAS parameters that can be updated without
transition from CM-IDLE are included (e.g. MICO mode, Enhanced Coverage
Restricted information) the UE shall initiate a Registration procedure
immediately after the acknowledgement to re-negotiate the updated NAS
parameter(s) with the network. Steps 3b, 3c and step 4 are skipped.
3b. [Conditional] If a new Allowed NSSAI and/or a new Mapping Of Allowed NSSAI
and/or Partially Allowed NSSAI and/or Mapping Of Partially Allowed NSSAI
and/or a new Configured NSSAI provided by the AMF to the UE in step 1 does not
affect the existing connectivity to AMF, the AMF needs not release the NAS
signalling connection for the UE after receiving the acknowledgement in step 2
and immediate registration is not required. The UE can start immediately using
the new Allowed NSSAI and/or the new Mapping Of Allowed NSSAI and/or Partially
Allowed NSSAI and/or Mapping Of Partially Allowed NSSAI. If one or more PDU
Sessions use a S-NSSAI that is not part of the new Allowed NSSAI or Partially
Allowed NSSAI, the AMF indicates to the SMF(s) the corresponding PDU Session
ID(s) and each SMF releases the PDU Session(s) according to clause 4.3.4.2.
The UE cannot connect to an S-NSSAI included in the new Configured NSSAI for
the Serving PLMN but not included in the new Allowed NSSAI or Partially
Allowed NSSAI until the UE performs a Registration procedure and includes a
Requested NSSAI based on the new Configured NSSAI, following the requirements
described in clause 5.15.5.2 of TS 23.501 [2]. Steps 3c and 4 are skipped.
The AMF may, based on its policy, provide anyway an indication that a
Registration procedure is required even though the UE Configuration Update
Command in step 1 does not affect the existing connectivity to Network Slices:
in such a case only step 3c is skipped.
3c. [Conditional] If a new Allowed NSSAI and/or a new Mapping Of Allowed NSSAI
and/or Partially Allowed NSSAI and/or Mapping Of Partially Allowed NSSAI
and/or a new Configured NSSAI provided by the AMF to the UE in step 1 affects
ongoing existing connectivity to AMF, then the AMF shall provide an indication
that the UE shall initiate a Registration procedure.
4\. [Conditional] After receiving the acknowledgement in step 2, the AMF shall
release the NAS signalling connection for the UE by triggering the AN Release
procedure, unless there is one established PDU Sessions associated with
regulatory prioritized services. If there is one established PDU Session
associated with regulatory prioritized services, the AMF informs SMFs to
release the PDU Session(s) associated with non regulatory prioritized services
for this UE (see clause 4.3.4).
The AMF shall reject any NAS Message from the UE carrying PDU Session
Establishment Request for a non-emergency PDU Session before the required
Registration procedure has been successfully completed by the UE.
The UE initiates a Registration procedure (see clauses 4.2.2.2.2 and 4.13.3.1)
with registration type Mobility Registration Update after the UE enters CM-
IDLE state and shall not include the 5G-S-TMSI or GUAMI in Access Stratum
signalling and shall include, subject to the conditions set out in clause
5.15.9 of TS 23.501 [2], a Requested NSSAI in access stratum signalling. If
there is an established PDU Session associated with emergency service and the
UE has received an indication to perform the Registration procedure, the UE
shall initiate the Registration procedure only after the PDU Session
associated with emergency service is released.
NOTE 6: Receiving UE Configuration Update command without an indication
requesting to perform re-registration, can still trigger Registration
procedure by the UE for other reasons.
#### 4.2.4.3 UE Configuration Update procedure for transparent UE Policy
delivery
This procedure is initiated when the PCF wants to update UE policy information
(i.e. UE policy) in the UE configuration. In the non-roaming case, the V-PCF
is not involved and the role of the H-PCF is performed by the PCF. For the
roaming scenarios, the V-PCF interacts with the AMF and the H-PCF interacts
with the V-PCF.
Figure 4.2.4.3-1: UE Configuration Update procedure for transparent UE Policy
delivery
0\. PCF decides to update UE policy based on triggering conditions such as an
initial registration, registration with 5GS when the UE moves from EPS to 5GS,
or need for updating UE policy as follows:
\- For the case of initial registration and registration with 5GS when the UE
moves from EPS to 5GS, the PCF compares the list of PSIs included in the UE
policy information in Npcf_UEPolicyControl_Create request and determines, as
described in clause 6.1.2.2.2 of TS 23.503 [20], whether UE policy information
have to be updated and be provided to the UE via the AMF using DL NAS
TRANSPORT message; and
\- For the network triggered UE policy update case (e.g. the change of UE
location, the change of Subscribed S-NSSAIs as described in clause 6.1.2.2.2
of TS 23.503 [20]), the PCF checks the latest list of PSIs to decide which UE
policies have to be sent to the UE.
The PCF checks if the size of the resulting UE policy information exceeds a
predefined limit:
\- If the size is under the limit, then UE policy information are included in
a single Namf_Communication_N1N2MessageTransfer service operation as described
below.
\- If the size exceeds the predefined limit, the PCF splits the UE policy
information in smaller, logically independent UE policy information ensuring
the size of each is under the predefined limit. Each UE policy information
will be then sent in separated Namf_Communication_N1N2MessageTransfer service
operations as described below.
NOTE 1: NAS messages from AMF to UE do not exceed the maximum size limit
allowed in NG-RAN (PDCP layer), so the predefined size limit in PCF is related
to that limitation.
NOTE 2: The mechanism used to split the UE policy information is described in
TS 29.507 [32].
0a. If the PCF has not subscribed to be notified by the AMF about the UE
response to an update of UE policy information, the PCF subscribes to the AMF
to be notified about the UE response to an update of UE policy information.
1\. PCF invokes Namf_Communication_N1N2MessageTransfer service operation
provided by the AMF. The message includes SUPI, UE Policy Container.
2\. If the UE is registered and reachable by AMF in either 3GPP access or
non-3GPP access, AMF shall transfers transparently the UE Policy container to
the UE via the registered and reachable access.
If the UE is registered in both 3GPP and non-3GPP accesses and reachable on
both access and served by the same AMF, the AMF transfers transparently the UE
Policy container to the UE via one of the accesses based on the AMF local
policy.
If the UE is not reachable by AMF over both 3GPP access and non-3GPP access,
the AMF reports to the PCF that the UE Policy container could not be delivered
to the UE using Namf_Communication_N1N2TransferFailureNotification as in the
step 5 in clause 4.2.3.3.
If AMF decides to transfer transparently the UE Policy container to the UE via
3GPP access, e.g. the UE is registered and reachable by AMF in 3GPP access
only, or if the UE is registered and reachable by AMF in both 3GPP and
non-3GPP accesses served by the same AMF and the AMF decides to transfer
transparently the UE Policy container to the UE via 3GPP access based on local
policy and the UE is in CM-IDLE and reachable by AMF in 3GPP access, the AMF
starts the paging procedure by sending a Paging message described in the step
4b of Network Triggered Service Request (in clause 4.2.3.3). Upon reception of
paging request, the UE shall initiate the UE Triggered Service Request
procedure (clause 4.2.3.2).
3\. If the UE is in CM-CONNECTED over 3GPP access or non-3GPP access, the AMF
transfers transparently the UE Policy container (UE policy information)
received from the PCF to the UE. The UE Policy container includes the list of
Policy Sections as described in TS 23.503 [20].
4\. The UE updates the UE policy provided by the PCF and sends the result to
the AMF.
5\. The AMF forwards the response of the UE to the PCF using
Namf_Communication_N1MessageNotify.
The PCF maintains the latest list of PSIs delivered to the UE and updates the
latest list of PSIs in the UDR by invoking Nudr_DM_Update (SUPI, Policy Data,
Policy Set Entry, updated PSI data) service operation.
If the PCF is notified about UE Policy delivery failure from the AMF, the PCF
may initiate UE Policy Association Modification procedure to provide a new
trigger \"Connectivity state changes\" in Policy Control Request Trigger of UE
Policy Association to AMF as defined in clause 4.16.12.2. The PCF may re-
initiate the UE Configuration Update procedure for transparent UE Policy
delivery as in step 1 when the PCF is notified of the UE connectivity state
changed to CONNECTED.
NOTE 3: For backward compatibility the PCF may subscribe the \"Connectivity
state changes (IDLE or CONNECTED)\" event in Rel-15 AMF as defined in clause
5.2.2.3.
### 4.2.5 Reachability procedures
#### 4.2.5.1 General
Elements of this procedure are used for UDM/NF initiated UE Reachability
Notification requests, e.g. for \"SMS over NAS\".
The procedure applies to UEs that are in RRC_IDLE, RRC_INACTIVE and
RRC_CONNECTED states.
There are two procedures necessary for any service related entity that would
need to be notified by the reachability of the UE:
\- UE Reachability Notification Request procedure; and
\- UE Activity Notification procedure.
#### 4.2.5.2 UE Reachability Notification Request procedure
The UE Reachability Notification Request procedure is illustrated in figure
4.2.5.2-1.
Figure 4.2.5.2-1: UE Reachability Notification Request Procedure
1a. [Conditional] When a service-related entity requests the UDM to provide an
indication regarding UE reachability, the UDM checks whether that service-
related entity is authorized to perform this request on this subscriber. The
service-related entity may subscribe in UDM to receive notifications about UE
Reachability or UE Reachability for SMS delivery events as defined in clause
4.15.3.
NOTE 1: This request for UE Reachability Notification is received in UDM using
different interfaces/services depending on the service-related entity. For
example, an SBI capable service-related entity can use the
Nudm_EventExposure_Subscribe service while an SMS-GMSC using non-SBI
interfaces triggers this procedure as described in TS 23.040 [7].
The UDM may retrieve from the UDR the list of NF IDs for Network Functions
authorized by the HPLMN to request notifications on this UE\'s reachability.
If the entity is not authorized, the UDM may reject the request (e.g. if the
requesting entity is recognized as being a valid entity, but not authorized
for that subscriber) or discard it silently (e.g. if the requesting entity is
not recognized). Appropriate O&M reports are generated.
1b. [Conditional] The UDM stores the identity of the service-related entity.
In the case that the service-related entity is an SMS-GMSC using non-SBI
interfaces, the UDM stores the SC address within the MWD list. Otherwise, if
the service-related entity is an SBI capable service-related entity, the UDM
stores the address of the SBI capable service-related entity in the form of a
subscription to the Nudm_EventExposure service.
If the UE Reachability Notification Request is for SMS over NAS and no SMSF is
registered for the target UE, steps 2 to 4 are skipped.
Otherwise the UDM sets the URRP-AMF flag parameter and continues with step 2.
1c. [Conditional] An NF (e.g. SMF) may subscribe event of UE reachability
status change by using the Namf_EventExposure_Subscribe service operation.
Steps 2 to 4 are skipped.
The AMF invokes the Namf_EventExposure_Notify service operation to report the
current reachability state of a UE to the NF if requested by the consumer NF.
2\. [Conditional] If the value of URRP-AMF flag parameter changes from \"not
set\" to \"set\" and an AMF is registered in the UDM for the target UE, the
UDM initiates Namf_EventExposure_Subscribe service operation for UE
reachability for UE reachable for DL traffic (SUPI, UE Reachability) towards
the AMF. The UDM may indicate if direct notification to NF shall be used by
the AMF. When direct notification to NF is indicated to the AMF, the URRP-AMF
is not set in the UDM in step 1a for NF initiated requests. If the service-
related entity requested UDM to receive notifications about UE Reachability
for SMS delivery, the UDM shall not indicate direct notification to NF.
NOTE 2: The UDM can trigger UE Reachability Notification Request procedure
with two different AMFs for a UE which is connected to 5G Core Network over
3GPP access and non-3GPP access simultaneously. Also, for interworking with
EPC, the UDM/HSS can trigger UE Reachability Notification Request procedure
with MME as described in TS 23.401 [13].
3\. The AMF checks that the requesting entity is authorized to perform this
request on this subscriber.
If the AMF has an MM Context for that user, the AMF stores the NF ID in the
URRP-AMF information, associated with URRP-AMF information flag to indicate
the need to report to the UDM or directly to the NF with a UE Activity
Notification (see clause 4.2.5.3).
4\. [Conditional] For UE reachability for UE reachable for DL traffic, if the
UE state in AMF is in CM-CONNECTED state and the Access Type is 3GPP access,
the AMF initiates N2 Notification procedure (see clause 4.8.3) with reporting
type set to Single RRC_CONNECTED state notification.
#### 4.2.5.3 UE Activity Notification procedure
The UE Activity Notification procedure is illustrated in figure 4.2.5.3-1.
Figure 4.2.5.3-1: UE Activity Procedure
0\. Event has been subscribed in the AMF for UE reachability for DL traffic or
for UE reachability status change.
1a. For a UE in CM-IDLE, the AMF receives (N1) NAS signalling implying UE is
reachable for DL traffic, e.g. a Registration Request or Service Request
message from the UE, the AMF performs step 2;
1b. For a UE in CM-CONNECTED, if the AMF has initiated the N2 Notification
procedure in Step 4 of clause 4.2.5.2 and when the AMF receives a (N2) UE
Notification (see clause 4.8.3) or a (N2) Path Switch Request (see clause
4.9.1.2) implying UE is reachable for DL traffic from the NG-RAN, the AMF
performs step 2. Otherwise, i.e. UE is in CM-CONNECTED and AMF has not
initiated N2 Notification procedure, the AMF performs step 2; or
1c. The UE\'s reachability state changes from reachable to unreachable, then
AMF performs step 2.
2a. For event subscription of \"UE reachable for DL traffic\", if the AMF has
an MM context for the UE and the URRP-AMF information flag associated with the
subscribing NF is set to report once that the UE is reachable for DL traffic,
the AMF initiates the Namf_EventExposure_Notify service operation (SUPI, UE
Reachable) message (or Nudm_UECM_Registration service operation when
applicable) to the UDM following step 1a or step 1b. The AMF clears the
corresponding URRP-AMF information if applicable for the UE.
2a1. When the UDM receives the Namf_EventExposure_Notify service operation
(SUPI, UE-Reachable) message or Nudm_UECM_Registration service from AMF for a
UE that has URRP-AMF information flag set in the UDM, it triggers appropriate
notifications to the service-related entities associated with the URRP-AMF
information flag that have subscribed to the UDM for UE Reachability
notifications.
If SMSF is registered, it also triggers appropriate notifications to the
service-related entities associated with the URRP-AMF information flag that
have subscribed to the UDM for UE reachability for SMS delivery notification
(e.g. SMS-GMSC, HSS). UDM clears the URRP-AMF information for the UE.
If no SMSF is registered and there are service-related entities subscribed to
the UDM for the UE reachability for SMS delivery notification, the UDM clears
the URRP-AMF information for the UE but does not notify any service-related
entity.
When the UDM receives the Nudm_UECM_Registration service from SMSF for a UE
that has service-related entities subscribed to the UDM for the UE
reachability for SMS delivery notification and no URRP-AMF flag set in the
UDM, the UDM triggers appropriate notifications to the service-related
entities that have subscribed to the UDM for UE reachability for SMS delivery
notification).
NOTE: The UE Reachability Notification is sent by the UDM using different
interfaces/services depending on the service-related entity. For example, an
SBI capable service-related entity can receive the notification using the
Nudm_EventExposure_Notify service operation (if previously subscribed) while
an SMS-SC can get the notification as described in TS 23.040 [7] based on the
SC address stored in the MWD list.
2b. If in step 0 the AMF received Namf_EventExposure_Subscribe_service
operation directly from an NF authorised to receive direct notifications in
the case of UE reachability status change, or the UDM indicated that the
notification needs to be sent directly to the NF in the case of UE
reachability for DL traffic, the AMF initiates the Namf_EventExposure_Notify
service operation (SUPI, UE reachability state) message directly to the NF.
### 4.2.6 AN Release
This procedure is used to release the logical NG-AP signalling connection for
the UE between the (R)AN and the AMF and the associated N3 User Plane
connections and (R)AN signalling connection between the UE and the (R)AN and
the associated (R)AN resources.
When the NG-AP signalling connection is lost due to (R)AN or AMF failure, the
AN release is performed locally by the AMF or the (R)AN as described in the
procedure flow below without using or relying on any of the signalling shown
between (R)AN and AMF. The AN release causes all UP connections of the UE to
be deactivated.
The initiation of AN release may be due to:
\- (R)AN-initiated with cause e.g. O&M Intervention, Unspecified Failure,
(R)AN (e.g. Radio) Link Failure, User Inactivity, Inter-System Redirection,
request for establishment of QoS Flow for IMS voice, Release due to UE
generated signalling connection release, mobility restriction, Release
Assistance Information (RAI) from the UE, UE using satellite access moved out
of PLMN serving area, etc.; or
\- AMF-initiated with cause e.g. Unspecified Failure, etc.
Both (R)AN-initiated and AMF-initiated AN Release procedures are shown in
Figure 4.2.6-1.
If Service Gap Control shall be applied for the UE (see clause 5.31.16 of TS
23.501 [2]) and the Service Gap timer is not already running, the Service Gap
timer shall be started in AMF and UE when entering CM-IDLE, unless the
connection was initiated after a paging of an MT event, or after a
Registration procedure without Uplink data status or after a Registration
procedure for regulatory prioritized services like Emergency services or
exception reporting.
For this procedure, the impacted SMF and UPF are all under control of the PLMN
serving the UE, e.g. in Home Routed roaming case the SMF and UPF in HPLMN are
not involved.
Figure 4.2.6-1: AN Release procedure
1\. If there is some confirmed (R)AN conditions (e.g. Radio Link Failure) or
for other (R)AN internal reason, the (R)AN may decide to initiate the UE
context release in the (R)AN. In this case, the (R)AN sends an N2 UE Context
Release Request (Cause, List of PDU Session ID(s) with active N3 user plane)
message to the AMF. Cause indicates the reason for the release (e.g. AN Link
Failure, O&M intervention, unspecified failure, etc.). The List of PDU Session
ID(s) indicates the PDU Sessions served by (R)AN of the UE. If the (R)AN is
NG-RAN, this step is described in clause 8.3.2 of TS 38.413 [10]. If the (R)AN
is an N3IWF this step is described in clause 4.12.4.2.
If the reason for the release is the NG-RAN received an AS Release Assistance
Indicator as defined in TS 36.331 [16], NG-RAN should not immediately release
the RRC connection but instead send an N2 UE Context Release Request message
to the AMF. If the AS RAI indicates only a single downlink transmission is
expected then NG-RAN should only send the N2 UE Context Release Request after
a single downlink NAS PDU or N3 data PDU has been transferred.
If N2 Context Release Request cause indicates the release is requested due to
user inactivity or AS RAI then the AMF continues with the AN Release procedure
unless the AMF is aware of pending MT traffic or signalling.
If N2 Context Release Request cause indicates the release is requested due to
a UE using satellite access moved out of PLMN serving area, the AMF may
deregister the UE as described in clause 4.2.2.3.3 before continuing with the
AN Release procedure.
2\. AMF to (R)AN: If the AMF receives the N2 UE Context Release Request
message or due to an internal AMF event, including the reception of Service
Request or Registration Request to establish another NAS signalling connection
still via (R)AN, the AMF sends an N2 UE Context Release Command (Cause) to the
(R)AN. The Cause indicates either the Cause from (R)AN in step 1 or the Cause
due to an AMF event. If the (R)AN is a NG-RAN this step is described in detail
in clause 8.3.3 of TS 38.413 [10]. If the (R)AN is an N3IWF/TNGF/W-AGF this
step is described in clauses 4.12.4.2 / 4.12a and in clause 7.2.5 of TS 23.316
[53] for W-5GAN access.
If the AMF receives Service Request or Registration Request to establish
another NAS signalling connection still via (R)AN, after successfully
authenticating the UE, the AMF releases the old NAS signalling connection and
then continues the Service Request or Registration Request procedure.
3\. [Conditional] If the (R)AN connection (e.g. RRC connection or NWu
connection) with the UE is not already released (step 1), either:
a) the (R)AN requests the UE to release the (R)AN connection. Upon receiving
(R)AN connection release confirmation from the UE, the (R)AN deletes the UE\'s
context, or
b) if the Cause in the N2 UE Context Release Command indicates that the UE has
already locally released the RRC connection, the (R)AN locally releases the
RRC connection.
4\. The (R)AN confirms the N2 Release by returning an N2 UE Context Release
Complete (List of PDU Session ID(s) with active N3 user plane, User Location
Information, Age of Location Information) message to the AMF. The List of PDU
Session ID(s) indicates the PDU Sessions served by (R)AN of the UE. The AMF
stores always the latest UE Radio Capability information or NB-IoT specific UE
Radio Access Capability Information received from the NG-RAN node received as
described in TS 38.413 [10]. The N2 signalling connection between the AMF and
the (R)AN for that UE is released. If the UE is served by an NG-eNB that
supports WUS, then the NG-eNB should include the Information On Recommended
Cells And RAN nodes For Paging; otherwise the (R)AN may provide the list of
recommended cells / TAs / NG-RAN node identifiers for paging to the AMF.
If the PLMN has configured secondary RAT usage reporting, the NG-RAN node may
provide RAN usage data Report.
This step shall be performed promptly after step 2, i.e. it shall not be
delayed, for example, in situations where the UE does not acknowledge the RRC
Connection Release.
The NG-RAN includes Paging Assistance Data for CE capable UE, if available, in
the N2 UE Context Release Complete message. The AMF stores the received Paging
Assistance Data for CE capable UE in the UE context for subsequent Paging
procedure.
5\. [Conditional] AMF to SMF: For each of the PDU Sessions in the N2 UE
Context Release Complete, the AMF invokes Nsmf_PDUSession_UpdateSMContext
Request (PDU Session ID, PDU Session Deactivation, Cause, Operation Type, User
Location Information, Age of Location Information, N2 SM Information
(Secondary RAT usage data)). The Cause in step 5 is the same Cause in step 2.
If List of PDU Session ID(s) with active N3 user plane is included in step 1b,
the step 5 to 7 are performed before step 2. The Operation Type is set to \"UP
deactivate\" to indicate deactivation of user plane resources for the PDU
Session.
For PDU Sessions using Control Plane CIoT 5GS Optimisation and if the UE has
negotiated the use of extended Idle mode DRX, the AMF informs the SMF
immediately that the UE is not reachable for downlink data. For PDU Sessions
using Control Plane CIoT 5GS Optimisation and if the UE has negotiated the use
of MICO mode with Active Time, the AMF informs the SMF that the UE is not
reachable for downlink data once the Active Time has expired.
6a [Conditional] SMF to UPF: N4 Session Modification Request (AN or N3 UPF
Tunnel Info to be removed, Buffering on/off).
For PDU Sessions not using Control Plane CIoT 5GS Optimisation, the SMF
initiates an N4 Session Modification procedure indicating the need to remove
Tunnel Info of AN or UPF terminating N3. Buffering on/off indicates whether
the UPF shall buffer incoming DL PDU or not.
If the SMF has received an indication from the AMF that the UE is not
reachable for downlink data for PDU Sessions using Control Plane CIoT 5GS
Optimisation, the SMF may initiate an N4 Session Modification procedure to
activate buffering in the UPF.
If multiple UPFs are used in the PDU Session and the SMF determines to release
the UPF terminating N3, step 6a is performed towards the UPF (e.g. PSA)
terminating N9 towards the current N3 UPF. The SMF then releases the N4
session towards the N3 UPF (the N4 release is not shown on the call flow).
See clause 4.4 for more details.
If the cause of AN Release is because of User Inactivity, or UE Redirection,
the SMF shall preserve the GBR QoS Flows. If the AN Release is due to the
reception of Service Request or Registration Request to establish another NAS
signalling connection via (R)AN as described in step 2, the SMF also preserves
the GBR QoS Flows. In any other case, the SMF shall trigger the PDU Session
Modification procedure (see clause 4.3.3) for the GBR QoS Flows of the UE
after the AN Release procedure is completed.
If the redundant I-UPFs are used for URLLC, the N4 Session Modification
Request procedure is done for each I-UPF. In this case, SMF selects both the
redundant I-UPFs to buffer the DL packets for this PDU Session or drop the DL
packets for this PDU session or forward the DL packets for this PDU session to
the SMF, based on buffering instruction provided by the SMF as described in
clause 5.8.3.2 or 5.8.3.3 of TS 23.501 [2].
If the redundant N3 tunnels are used for URLLC, the N4 Session Modification
Request procedure to the UPF of N3 terminating point is to remove the dual AN
Tunnel Info for N3 tunnel of the corresponding PDU Session.
6b. [Conditional] UPF to SMF: N4 Session Modification Response acknowledging
the SMF request.
See clause 4.4 for more details.
7\. [Conditional] SMF to AMF: Nsmf_PDUSession_UpdateSMContext Response for
step 5.
Upon completion of the procedure, the AMF considers the N2 and N3 as released
and enters CM-IDLE state.
After completion of the procedure, the AMF reports towards the NF consumers
are triggered for cases in clause 4.15.4.
After completion of the procedure, if steps 5 to 7 were performed before step
2 and the AMF received N2 SM information from NG-RAN in step 4 (e.g. Secondary
RAT usage data report), the AMF initiates a Nsmf_PDUSession_UpdateSMContext
towards SMF to deliver the N2 SM information.
### 4.2.7 N2 procedures
#### 4.2.7.1 N2 Configuration
At power up, restart and when modifications are applied, the 5G-AN node and
AMF use non-UE related N2 signalling to exchange configuration data. Full
details of this configuration data are specified in TS 38.413 [10], but the
following highlights some aspects.
The AMF supplies the 5G-AN node with information about:
a) the AMF Name and the GUAMI(s) configured on that AMF Name;
b) the set of TNL associations to be established between the NG-RAN node and
the AMF;
c) weight factor associated with each of the TNL association within the AMF;
and
d) weight factor for each AMF Name within the AMF Set; and
e) (optional) for each GUAMI(s) configured on that AMF the corresponding
backup AMF Name.
The weight factors are used for load distribution of the initial N2 messages.
The AMF chooses whether or not to use the same TNL association for the initial
N2 message and subsequent messages for that UE. TNL associations configured
with a weight factor set to zero are not permitted for the initial N2 message,
but can be used for subsequent N2 messages.
Deployments that rely solely on 5GC-based load balancing can set the weight
factors associated with TNL associations that are permitted for the initial N2
message to the same value.
The 5G-AN supplies over N2 the AMF with information about the Tracking Area(s)
it serves and the S-NSSAI(s) it supports in each of these Tracking Areas. See
clause 5.3.2.3 of TS 23.501 [2].
#### 4.2.7.2 NGAP UE-TNLA-binding related procedures
##### 4.2.7.2.1 Creating **NGAP UE-TNLA-bindings during Registration and
Service Request**
When a UE connects to the 5GC via a 5G-AN node without providing any UE
identities (i.e. a GUAMI or a 5G-S-TMSI), or the UE provides a GUAMI or a
5G-S-TMSI but the 5G-AN node cannot associate to any of its connected AMFs,
the following steps are performed:
1\. The 5G-AN **node** selects an AMF as defined in clause 6.3.5 of TS 23.501
[2].
2\. The 5G-AN **node** creates an **NGAP UE-TNLA-binding** for the UE by
selecting a TNL association from the available TNL associations permitted for
the initial message e.g. N2 INITIAL UE MESSAGE for the selected AMF, as
defined in clause 5.21.1.3 of TS 23.501 [2] and forwards the UE message to the
AMF via the selected TNL association.
3\. The AMF may decide to use the TNL association selected by the 5G-AN or the
AMF may modify the NGAP UE-TNLA-binding by triangular redirection.
NOTE 1: This process could take place during the Registration procedure (for
Initial Registration, Mobility Registration Update).
4\. The AMF may decide to modify the NGAP UE-TNLA-binding toward other 5G-AN
nodes such as N3IWF. This is done if the AMF is changed and old AMF have
existing NGAP UE-TNLA-bindings toward other 5G-AN nodes.
When a UE connects to the 5GC via a 5G-AN node with a 5G-S-TMSI or GUAMI
associated with the AMF usable by the 5G-AN node, the following steps are
performed:
1\. The 5G-AN node creates an **NGAP UE-TNLA-binding** for the UE by selecting
a TNL association from the available TNL associations permitted for the
initial N2 message for the AMF identified by the UE\'s 5G-S-TMSI or GUAMI.
2\. The AMF may decide to use the TNL association selected by the 5G-AN or the
AMF may modify the NGAP UE-TNLA-binding by triangular redirection.
NOTE 2: This process could take place during the Registration procedure or
Service Request procedure.
##### 4.2.7.2.2 Creating NGAP UE-TNLA-bindings during handovers
During an Xn-based inter NG-RAN node handover, the following applies
\- If an NGAP UE-TNLA-binding exists for a UE, the source 5G-AN **node**
supplies the target 5G-AN **node** with the corresponding TNL address of the
AMF for the currently used TNL association.
\- If the target 5G-AN does not have a TNL association towards the TNL address
of the AMF received from the source 5G-AN node, the target 5G-AN **node**
establishes a TNL association towards the TNL address received from the source
5G-AN **node** , creates an **NGAP UE-TNLA-binding to this TNL association and
sends the N2 Path Switch Request via this TNL association.**
\- Otherwise, the target 5G-AN node creates an **NGAP UE-TNLA-binding** for
the UE by selecting a TNL association from the available TNL associations
towards the TNL address, permitted for the initial N2 message for the AMF
identified by the UE\'s GUAMI.
\- The AMF may decide to use the TNL association selected by the 5G-AN or the
AMF may modify the NGAP UE-TNLA-binding by triangular redirection.
During an inter NG-RAN node handover without Xn interface (i.e. during an N2
handover) the following applies:
\- If an NGAP UE-TNLA-binding exists for a UE, the source 5G-AN **node** sends
the N2 Handover Required message using the corresponding TNL address of the
AMF.
\- Otherwise the 5G-AN node creates an **NGAP UE-TNLA-binding** for the UE by
selecting a TNL association from the available TNL associations permitted for
the initial N2 message for the AMF identified by the UE\'s GUAMI.
**\- The target AMF selects** a TNL association from the available TNL
associations for the target 5G-AN **node** and sends the N2 Handover Request
message via this TNL association. The target 5G-AN **node** creates an **NGAP
UE-TNLA-binding** for the UE based on the TNL association selected by the
target AMF.
##### 4.2.7.2.3 Re-Creating NGAP UE-TNLA-bindings subsequent to NGAP UE-TNLA-
binding release
**If the AMF has released the NGAP UE-TNLA-binding in the 5G-AN node for a UE
and the 5G-AN node needs to send an N2 message for this UE, the following**
applies:
\- The 5G-AN node checks the GUAMI stored in the UE context and the associated
AMF:
\- If the GUAMI is available, 5G-AN selects the AMF which owns that GUAMI.
\- If GUAMI has been marked as unavailable (i.e. based on AMF unavailable
status indication received from AMF) but one corresponding target AMF has been
indicated, 5G-AN selects that target AMF even if the GUAMI has not been
updated as available by the target AMF.
\- If GUAMI has been marked as unavailable (i.e. based on AMF unavailable
status indication received from AMF) and no corresponding target AMF has been
indicated, the 5G-AN selects an AMF from the AMF Set based on AMF Set ID of
the GUAMI, as defined in clause 6.3.5 of TS 23.501 [2].
\- The 5G-AN node creates an NGAP UE-TNLA-binding for the UE by selecting a
TNL association from the available TNL associations permitted for the initial
N2 message with the selected AMF, as defined in clause 5.21.1.3 of TS 23.501
[2],and sends the N2 message to the AMF via the selected TNL association.
\- The AMF may decide to use the TNL association selected by the 5G-AN or the
AMF may modify the NGAP UE-TNLA-binding by triangular redirection.
**If the NGAP UE-TNLA-binding has been released for a UE and the AMF needs to
send an N2 message for this UE, the following applies:**
**\- The AMF selects** a TNL association from the available TNL associations
for the target 5G-AN **node** and sends the N2 message via this TNL
association. The target 5G-AN **node** creates an **NGAP UE-TNLA-binding** for
the UE based on the TNL association selected by the AMF.
The TNL association chosen by the AMF always takes precedence.
NOTE: This addresses situations where 5G-AN node and AMF select a TNL
association for a UE concurrently.
##### 4.2.7.2.4 **NGAP UE-TNLA-binding update procedure**
At any time the AMF may decide to re-bind the NGAP UE association to a new TNL
association:
\- by sending a UE-specific NGAP message on a new TNL association (triangular
redirection), if:
\- AMF responds to the 5G-AN node initiated NGAP message (i.e. triangular
redirection) as described in clauses 4.2.7.2.1, 4.2.7.2.2 and 4.2.7.2.3; or
\- AMF initiated UE-specific NGAP message needs to be sent to 5G-AN node;
\- by **sending** a UE-specific NGAP UE-TNLA binding release message to 5G-AN
and the 5G-AN node updates the NGAP UE-TNLA binding with the new TNL
association.
##### 4.2.7.2.5 **NGAP UE-TNLA-binding per UE Release procedure**
At any time the AMF may decide to release the NGAP UE-TNLA binding while
keeping the UE in CM-CONNECTED state while keeping the corresponding N3
interface. The AMF releases the NGAP UE-TNLA binding by sending a UE-specific
NGAP UE-TNLA binding release message on the current TNL association.
If the AMF releases the NGAP UE-TNLA-binding without sending AMF unavailable
status indication, then the AN may immediately trigger creation of a new NGAP-
UE-TNLA-binding with the same AMF for subsequent N2 messages or may leave the
NGAP UE association without NGAP UE-TNLA-binding. In the latter case the new
NGAP UE-TNLA-binding is re-created upon the subsequent AN-initiated or AMF-
initiated UE-specific N2 signalling as specified in clause 4.2.7.2.3.
If the AMF releases the NGAP UE-TNLA-binding after AMF unavailable status
indication, then the AN has to re-create the NGAP-UE-TNLA-binding with a
different AMF. The 5G-AN re-creates N2AP UE-TNLA-binding for subsequent N2
messages for the given UE as specified in clause 4.2.7.2.3.
#### 4.2.7.3 AMF Failure or Planned Maintenance handling procedure
For UE(s) in CM-CONNECTED state:
\- If AMF failure is detected by 5G-AN, all NGAP UE TNLA binding for UEs
served by that AMF are released.
\- If AMF becomes unavailable due to planned maintenance, the AMF notifies the
5G-AN about the unavailable GUAMI(s) and provides optionally a target AMF Name
corresponding to each unavailable GUAMI. The 5G-AN releases all NGAP UE TNLA
binding of the UEs related to the indicated unavailable GUAMI(s) unless the
notification from the AMF includes an indicator that the AMF will rebind or
release the NGAP UE TNLA binding on a per UE-basis. In that case, if 5G-AN
supports, the 5G-AN waits the release until the timer expires so that the AMF
may release or rebind the N2AP UE-TNLA binding on per UE-basis.
\- For the release NGAP TNLA binding, the affected UE is kept in CM-CONNECTED
state and the corresponding N3 interface is also kept.
For UE(s) in CM-IDLE state, when it subsequently returns from CM-IDLE state
and the 5G-AN receives an initial NAS message with a 5G S-TMSI or GUAMI, the
5G-AN uses 5G S-TMSI or GUAMI to select the target AMF, the 5G-AN forwards N2
message.
#### **4.2.7.4 Additional User Location Information with Mobile Base Station
Relay (MBSR)**
As described in clause 5.35A of TS 23.501 [2], when a UE is being served by an
MBSR, for any N2 messages sent by NG-RAN to AMF, if the User Location
Information is included, the N2 parameters shall also include the User
Location Information of this MBSR.
### 4.2.8 Void
### 4.2.8a UE Capability Match Request procedure
If the AMF requires more information on the UE radio capabilities support to
be able to set the IMS voice over PS Session Supported Indication (see clause
5.16.3 of TS 23.501 [2]), then the AMF may send a UE Radio Capability Match
Request message to the NG-RAN. This procedure is typically used during the
registration procedure or when AMF has not received the Voice Support Match
Indicator (as part of the 5GMM Context).
Figure 4.2.8a-1: UE Capability Match Request
1\. The AMF indicates whether the AMF wants to receive Voice support match
indicator. The AMF may include the UE radio capability information it has
previously received from NG-RAN.
2\. Upon receiving the UE Capability Match Request message, if the NG-RAN has
not already received the UE radio capabilities from the UE or from AMF in step
1, the NG-RAN requests the UE to upload the UE radio capability information.
3\. The UE provides the NG-RAN with its UE radio capabilities sending the RRC
UE Capability Information.
4\. The NG-RAN checks whether the UE radio capabilities are compatible with
the network configuration for ensuring voice service continuity of voice calls
initiated in IMS.
For determining the appropriate UE Radio Capability Match Response, the NG-RAN
is configured by the operator to check whether the UE supports certain
capabilities required for Voice continuity of voice calls using IMS PS. In a
shared network, the NG-RAN keeps a configuration separately per PLMN.
NOTE 1: What checks to perform depends on network configuration, i.e.
following are some examples of UE capabilities to be taken into account:
\- E-UTRAN/NG-RAN Voice over PS capabilities;
\- the Radio capabilities for E-UTRAN/NG-RAN FDD and/or TDD; and/or
\- the support of E-UTRAN/NG-RAN frequency bands;
\- the SRVCC from NG-RAN to UTRAN capabilities and the support of UTRAN
frequency bands.
NOTE 2: The network configuration considered in the decision for the Voice
Support Match Indicator is homogenous within a certain area (e.g. AMF Set) in
order to guarantee that the Voice Support Match Indicator from the NG-RAN is
valid within such area.
The NG-RAN provides a Voice Support Match Indicator to the AMF to indicate
whether the UE capabilities and networks configuration are compatible for
ensuring voice service continuity of voice calls initiated in IMS.
The AMF stores the received Voice support match indicator in the 5GMM Context
and uses it as an input for setting the IMS voice over PS Session Supported
Indication.
5\. If NG-RAN requested radio capabilities from UE in step 2 and 3, the NG-RAN
also sends the UE radio capabilities to the AMF. The AMF stores the UE radio
capabilities without interpreting them for further provision to the NG-RAN
according to clause 5.4.4.1 of TS 23.501 [2].
NOTE 3: Steps 4 and 5 could be received by the AMF in any order.
### 4.2.9 Network Slice-Specific Authentication and Authorization procedure
#### 4.2.9.1 General
The Network Slice-Specific Authentication and Authorization procedure is
triggered for an S-NSSAI requiring Network Slice-Specific Authentication and
Authorization with an AAA Server (AAA-S) which may be hosted by the H-PLMN
operator or by a third party which has a business relationship with the
H-PLMN, using the EAP framework as described in TS 33.501 [15]. An AAA Proxy
(AAA-P) in the HPLMN may be involved e.g. if the AAA Server belongs to a third
party.
This procedure is triggered by the AMF during a Registration procedure when
some Network Slices require Slice-Specific Authentication and Authorization,
when AMF determines that Network Slice-Specific Authentication and
Authorization is requires for an S-NSSAI in the current Allowed NSSAI or
Partially Allowed NSSAI (e.g. subscription change), or when the AAA Server
that authenticated the Network Slice triggers a re-authentication.
NOTE 1: The S-NSSAI in the procedure can be part of Allowed NSSAI, Mapping Of
Allowed NSSAI, Partially Allowed NSSAI or Mapping Of Partially Allowed NSSAI.
The AMF performs the role of the EAP Authenticator and communicates with the
AAA-S via the Network Slice specific and SNPN Authentication and Authorization
Function (NSSAAF). The NSSAAF undertakes any AAA protocol interworking with
the AAA protocol supported by the AAA-S.
The Network Slice-Specific Authentication and Authorization procedure requires
the use of a GPSI. In other words, a subscription that contains S-NSSAIs
subject to Network Slice-Specific Authentication and Authorization shall
include at least one GPSI.
After a successful or unsuccessful UE Network Slice-Specific Authentication
and Authorization, the AMF store the NSSAA result status for the related
S-NSSAI in the UE context.
NOTE 2: If an S-NSSAI subject to the NSSAA is rejected due to Network Slice
Admission Control (e.g. the maximum number of UEs per network slice has been
reached), the NSSAA result status stored in the UE context is not impacted.
#### 4.2.9.2 Network Slice-Specific Authentication and Authorization
Figure 4.2.9.2-1: Network Slice-Specific Authentication and Authorization
procedure
1\. For S-NSSAIs that are requiring Network Slice-Specific Authentication and
Authorization, based on change of subscription information, or triggered by
the AAA-S, the AMF may trigger the start of the Network Slice Specific
Authentication and Authorization procedure.
If Network Slice Specific Authentication and Authorization is triggered as a
result of Registration procedure, the AMF may determine, based on UE Context
in the AMF, that for some or all S-NSSAI(s) subject to Network Slice Specific
Authentication and Authorization, the UE has already been authenticated
following a Registration procedure on a first access. Depending on Network
Slice Specific Authentication and Authorization result (e.g. success/failure)
from the previous Registration, the AMF may decide, based on Network policies,
to skip Network Slice Specific Authentication and Authorization for these
S-NSSAIs during the Registration on a second access.
If the Network Slice Specific Authentication and Authorization procedure
corresponds to a re-authentication and re-authorization procedure triggered as
a result of AAA Server-triggered UE re-authentication and re-authorization for
one or more S-NSSAIs, as described in 4.2.9.2, or triggered by the AMF based
on operator policy or a subscription change and if S-NSSAIs that are requiring
Network Slice-Specific Authentication and Authorization are included in the
Allowed NSSAI for each Access Type, the AMF selects an Access Type to be used
to perform the Network Slice Specific Authentication and Authorization
procedure based on network policies.
2\. The AMF may send an EAP Identity Request for the S-NSSAI in a NAS MM
Transport message including the S-NSSAI. This is the S-NSSAI of the H-PLMN,
not the locally mapped S-NSSAI value.
3\. The UE provides the EAP Identity Response for the S-NSSAI alongside the
S-NSSAI in an NAS MM Transport message towards the AMF.
4\. The AMF sends the EAP Identity Response to the NSSAAF in a
Nnssaaf_NSSAA_Authenticate Request (EAP Identity Response, GPSI, S-NSSAI).
NOTE: If the UE subscription includes multiple GPSIs, the AMF uses any GPSI in
the list provided by the UDM for NSSAA procedures.
5\. If the AAA-P is present (e.g. because the AAA-S belongs to a third party
and the operator deploys a proxy towards third parties), the NSSAAF forwards
the EAP ID Response message to the AAA-P, otherwise the NSSAAF forwards the
message directly to the AAA-S. The NSSAAF is responsible to send the NSSAA
requests to the appropriate AAA-S based on local configuration of AAA-S
address per S-NSSAI. The NSSAAF uses towards the AAA-P or the AAA-S an AAA
protocol message of the same protocol supported by the AAA-S.
6\. The AAA-P forwards the EAP Identity message to the AAA-S addressable by
the AAA-S address together with S-NSSAI and GPSI. The AAA-S stores the GPSI to
create an association with the EAP Identity in the EAP ID response message, so
the AAA-S can later use it to revoke authorization or to trigger
reauthentication.
7-14. EAP-messages are exchanged with the UE. One or more than one iteration
of these steps may occur.
15\. EAP authentication completes. The AAA-S stores the S-NSSAI for which the
authorisation has been granted, so it may decide to trigger reauthentication
and reauthorization based on its local policies. An EAP-Success/Failure
message is delivered to the AAA-P (or if the AAA-P is not present, directly to
the NSSAAF) with GPSI and S-NSSAI.
16\. If the AAA-P is used, the AAA-P sends an AAA Protocol message including
(EAP-Success/Failure, S-NSSAI, GPSI) to the NSSAAF.
17\. The NSSAAF sends the Nnssaaf_NSSAA_Authenticate Response (EAP-
Success/Failure, S-NSSAI, GPSI) to the AMF.
18\. The AMF transmits a NAS MM Transport message (EAP-Success/Failure) to the
UE. The AMF shall store the EAP result for each S-NSSAI for which the NSSAA
procedure in steps 1-17 was executed.
19a. [Conditional] If a new Allowed NSSAI (i.e. including any new S-NSSAIs in
a Requested NSSAI for which the NSSAA procedure succeeded and/or excluding any
S-NSSAI(s) in the existing Allowed NSSAI for the UE for which the procedure
has failed, or including default S-NSSAI(s) if all S-NSSAIs in a Requested
NSSAI or in the existing Allowed NSSAI are subject to NSSAA and due to failure
of the NSSAA procedures, they cannot be in the Allowed NSSAI)) and/or new
Rejected S-NSSAIs (i.e. including any S-NSSAI(s) in the existing Allowed NSSAI
for the UE for which the procedure has failed, or any new requested S-NSSAI(s)
for which the NSSAA procedure failed) need to be delivered to the UE, or if
the AMF re-allocation is required, the AMF initiates the UE Configuration
Update procedure, for each Access Type, as described in clause 4.2.4.2. If the
Network Slice-Specific Re-Authentication and Re-Authorization fails and there
are PDU session(s) established that are associated with the S-NSSAI for which
the NSSAA procedure failed, the AMF shall initiate the PDU Session Release
procedure as specified in clause 4.3.4 to release the PDU sessions with the
appropriate cause value.
19b. [Conditional] If the Network Slice-Specific Authentication and
Authorization fails for all S-NSSAIs (if any) in the existing Allowed NSSAI
for the UE and (if any) for all S-NSSAIs in the Requested NSSAI and no default
S-NSSAI could be added in the Allowed NSSAI, the AMF shall execute the
Network-initiated Deregistration procedure described in clause 4.2.2.3.3 and
it shall include in the explicit De-Registration Request the list of Rejected
S-NSSAIs, each of them with the appropriate rejection cause value.
#### 4.2.9.3 AAA Server triggered Network Slice-Specific Re-authentication and
Re-authorization procedure
Figure 4.2.9.3-1: AAA Server initiated Network Slice-Specific Re-
authentication and Re-authorization procedure
1\. The AAA-S requests the re-authentication and re-authorization for the
Network Slice specified by the S-NSSAI in the AAA protocol Re-Auth Request
message, for the UE identified by the GPSI in this message. This message is
sent to a AAA-P, if the AAA-P is used (e.g. the AAA Server belongs to a third
party), otherwise it is sent directly to the NSSAAF.
2\. The AAA-P, if present, relays the request to the NSSAAF.
3a-3b. NSSAAF gets AMF ID from UDM using Nudm_UECM_Get with the GPSI in the
received AAA message. If NSSAAF receives two different AMF address then the
NSSAAF either decide to notify both AMFs or the NSSAF may decide to notify one
AMF first and if NSSAA fails also notify the other AMF.
3c. The NSSAAF provides an acknowledgement to the AAA protocol Re-Auth Request
message. If the AMF is not registered in UDM the procedure is stopped here.
4\. If the AMF is registered in UDM, the NSSAAF notifies the AMF to re-
authenticate/re-authorize the S-NSSAI for the UE using Nnssaaf_NSSAA_Re-
AuthNotification with the GPSI and S-NSSAI in the received AAA message. The
callback URI of the notification for the AMF is derived via NRF as specified
in TS 29.501 [62].
5\. If the UE is registered with the S-NSSAI in the Mapping Of Allowed NSSAI,
the AMF triggers the Network Slice-Specific Authentication and Authorization
procedure defined in clause 4.2.9.1. If the S-NSSAI is included in the Allowed
NSSAI for 3GPP access and non-3GPP access, AMF selects an access type to
perform NSSAA based on network policies. If the S-NSSAI is only included in
the Allowed NSSAI of non-3GPP access and UE is CM-IDLE in non-3GPP access, the
AMF marks the S-NSSAI as pending. In this case, when UE becomes CM-CONNECTED
in non-3GPP access, the AMF initiates NSSAA if needed.
If the UE is registered but the S-NSSAI is not in the Mapping Of Allowed
NSSAI, the AMF removes any status of the corresponding S-NSSAI subject to
Network Slice-Specific Authentication and Authorization in the UE context it
may have kept, so that an NSSAA is executed next time the UE requests to
register with the S-NSSAI.
#### 4.2.9.4 AAA Server triggered Slice-Specific Authorization Revocation
Figure 4.2.9.4-1: AAA Server-initiated Network Slice-Specific Authorization
Revocation procedure
1\. The AAA-S requests the revocation of authorization for the Network Slice
specified by the S-NSSAI in the AAA protocol Revoke Auth Request message, for
the UE identified by the GPSI in this message. This message is sent to AAA-P
if it is used.
2\. The AAA-P, if present, relays the request to the NSSAAF.
3a-3b. The NSSAAF gets AMF ID from UDM using Nudm_UECM_Get with the GPSI in
the received AAA message. If two different AMF addresses are received, the
NSSAAF initiates the step 4 towards both AMFs.
3c. The NSSAAF provides an acknowledgement to the AAA protocol Re-Auth Request
message. If the AMF is not registered in UDM the procedure is stopped here.
4\. If the AMF is registered in UDM, the NSSAAF notifies the AMF to revoke the
S-NSSAI authorization for the UE using Nnssaaf_NSSAA_RevocationNotification
with the GPSI and S-NSSAI in the received AAA message. The callback URI of the
notification for the AMF is derived via NRF as specified in TS 29.501 [62].
5\. If the UE is registered with the S-NSSAI in the Mapping Of Allowed NSSAI,
the AMF updates the UE configuration to revoke the S-NSSAI from the current
Allowed NSSAI, for any Access Type for which Network Slice Specific
Authentication and Authorization had been successfully run on this S-NSSAI.
The UE Configuration Update may include a request to Register if the AMF needs
to be re-allocated. The AMF provides a new Allowed NSSAI to the UE by removing
the S-NSSAI for which authorization has been revoked. The AMF provides new
rejected NSSAIs to the UE including the S-NSSAI for which authorization has
been revoked. If no S-NSSAI is left in Allowed NSSAI for an access after the
revocation and a Default NSSAI exists that requires no Network Slice Specific
Authentication or for which a Network Slice Specific Authentication did not
previously fail over this access, then the AMF may provide a new Allowed NSSAI
to the UE containing the Default NSSAI. If no S-NSSAI is left in Allowed NSSAI
for an access after the revocation and no Default NSSAI can be provided to the
UE in the Allowed NSSAI or a previous Network Slice Specific Authentication
failed for the Default NSSAI over this access, then the AMF shall execute the
Network-initiated Deregistration procedure for the access as described in
clause 4.2.2.3.3 and it shall include in the explicit De-Registration Request
message the list of Rejected S-NSSAIs, each of them with the appropriate
rejection cause value. If there are PDU session(s) established that are
associated with the revoked S-NSSAI, the AMF shall initiate the PDU Session
Release procedure as specified in clause 4.3.4 to release the PDU sessions
with the appropriate cause value.
If the UE is registered but the S-NSSAI is not in the Mapping Of Allowed
NSSAI, the AMF removes any status it may have kept of the corresponding
S-NSSAI subject to Network Slice-Specific Authentication and Authorization in
the UE context.
### 4.2.10 N3 data transfer establishment procedure when Control Plane CIoT
5GS Optimisation is enabled
#### 4.2.10.1 UE triggered N3 data transfer establishment procedure
If UE and AMF successfully negotiate N3 data transfer in addition to Control
Plane CIoT 5GS Optimisation based on the Preferred and Supported Network
Behaviour as defined in clause 5.31.2 of TS 23.501 [2], then the UE may, e.g.
based on the amount of data to be transferred in uplink, initiate N3 data
transfer establishment procedure for any PDU session for which Control Plane
Only Indicator was not included.
The UE triggered N3 data transfer establishment procedure may be initiated by
the UE in CM-IDLE or CM-CONNECTED state and follows the UE triggered Service
Request procedure as defined in clause 4.2.3.2 with the following differences.
Step 1.
The UE includes in the AN message a Service Request for Control Plane CIoT 5GS
Optimisation (List Of PDU Sessions To Be Activated, List Of Allowed PDU
Sessions, security parameters, PDU Session status, [NAS message container])).
The List Of PDU Sessions To Be Activated is provided by UE when the UE wants
to activate user plane resources for the PDU Session(s). The UE shall not
include PDU sessions for which Control Plane Only Indicator was received in
the List Of PDU Sessions To Be Activated. If the UE is camping on NB-IoT, the
UE shall construct the List of PDU Sessions To Be Activated to not exceed 2
PDU session(s) with active user plane resources.
If this procedure is triggered for paging response and the UE has at the same
time some user data to be transferred, the UE may decide to request N3 data
transfer establishment for one of more PDU sessions. The UE indicates this in
the List Of PDU Sessions To Be Activated. Otherwise the UE does not identify
any PDU Session in the List Of PDU Sessions To Be Activated.
Step 4 or 5a.
Upon reception of Nsmf_PDUSession_UpdateSMContext Request or after SMF
initiated SM Policy Association Modification, based on UE request and local
policies, the SMF decides whether to establish N3 data transfer for the PDU
session. The SMF shall not decide to establish N3 data transfer for a PDU
session for which Control Plane Only Inidcator was received.
Step 11.
The SMF indicates in Nsmf_PDUSession_UpdateSMContext Response whether to
establish N3 data transfer, i.e. activate Data Radio Bearer and N3 tunnel, for
the PDU session.
Step 12.
If the RAT type is NB-IoT, the AMF shall ensure that number of PDU Sessions
with active user plane resources does not exceed 2. If the AMF decides to not
include a PDU Session to be activated in the N2 message, the AMF indicates
this to the SMF in step 15 Nsmf_PDUSession_UpdateSMContext Request in the List
of PDU Sessions that failed to be established with the failure cause given in
the N2 SM information element.
The AMF includes a NAS service accept for Control Plane CIoT 5GS Optimisation
containing information on the PDU sessions with established N3 data transfer,
based on the request(s) from the SMF(s) in step 11.
The network starts using N3 bearers for all DL data on this PDU session.
Control Plane CIoT 5GS Optimisation is considered enabled for data transfer
for all PDU sessions without established N3 data transfer.
Step 13.
The UE starts using N3 bearears for all UL data on this PDU session.
#### 4.2.10.2 SMF triggered N3 data transfer establishment procedure
If UE and AMF successfully negotiate N3 data transfer in addition to Control
Plane CIoT 5GS Optimisation based on the Preferred and Supported Network
Behaviour as defined in clause 5.31.2, then the SMF may, e.g. based on the
amount of data to be transferred or due to congestion, initiate N3 data
transfer establishment procedure for any PDU session for which Control Plane
Only Indicator was not included.
The SMF triggered N3 data transfer establishment procedure may be initiated by
the SMF while the UE is in CM-IDLE or CM-CONNECTED state and follows the
Network Triggered Service Request procedure defined in clause 4.2.3.3 with the
following differences:
Step 3a.
The SMF request the activation of Data Radio Bearer and N3 tunnel for the PDU
session in Namf_Communication_N1N2MessageTransfer.
Step 3b.
If the RAT type is NB-IoT and the UE already has 2 PDU Sessions with active
user plane resources, the AMF shall not proceed with the rest of the procedure
and instead the AMF shall respond with Namf_Communication_N1N2MessageTransfer
Response with appropriate failure message.
Step 6.
The UE triggered N3 data transfer establishment procedure defined in clause
4.2.10.1 is applied instead of Service Request procedure from clause 4.2.3.2.
Step 7.
When the N3 data transfer is set up for a PDU session, the UE and the network
shall only use user plane radio bearers to transfer data PDUs on that PDU
Session.
### 4.2.11 Network Slice Admission Control Function (NSACF) procedures
#### 4.2.11.1 General
The Network Slice Admission Control Function procedures are performed for an
S-NSSAI which is subject to Network Slice Admission Control (NSAC) as
described in TS 23.501 [2]. If charging needs to be enabled, the NSACF may act
as a NF (CTF) and interact with the CHF to support the Event based charging as
defined in TS 32.290 [42].
Depending on the NSAC architecture deployed in the network, three options of
NSAC procedures are defined:
\- Option 1: The NSAC procedure for number of UEs or PDU sessions for an
S-NSSAI is based on non-Hierarchal NSAC architecture. The corresponding
procedures are described in clause 4.2.11.2 and clause 4.2.11.4 respectively.
\- Option 2: The NSAC procedure for number of UEs or PDU sessions for an
S-NSSAI is based on centralized NSAC architecture. The corresponding
procedures are described in clause 4.2.11.2 and clause 4.2.11.4 respectively.
\- Option 3: The NSAC procedure for number of UEs or PDU sessions for an
S-NSSAI is based on hierarchical NSAC architecture. The corresponding
procedures are described in clause 4.2.11.2a and clause 4.2.11.4a
respectively.
#### 4.2.11.2 Number of UEs per network slice availability check and update
procedure
This clause applies to Non-Hierarchical and centralized NSAC architectures.
The difference between the two architectures for the various steps, where
applicable, is described at the end of the clause.
The number of UEs per network slice availability check and update procedure is
to update (i.e. increase or decrease) the number of UEs registered with an
S-NSSAI which is subject to NSAC. The AMF is configured with the information
indicating which network slice is subject to NSAC.
Figure 4.2.11.2-1: Number of UEs per network slice availability check and
update procedure
1\. If the AMF is not aware of which NSACF to communicate, the AMF performs
NSACF discovery as described in clause 6.3.22 of TS 23.501 [2] and in clause
5.2.7.3.2. The AMF triggers the Number of UEs per network slice availability
check and update procedure to update the number of UEs registered with a
network slice when a network slice subject to NSAC is included in the Allowed
NSSAI or Partially Allowed NSSAI (i.e. the AMF requests to register the UE
with the S-NSSAI) or removed from the Allowed NSSAI or Partially Allowed NSSAI
(i.e. the AMF requests to de-register the UE from the S-NSSAI) for a UE. The
trigger event at the AMF also includes the change of Allowed NSSAI or
Partially Allowed NSSAI in the case of inter-AMF mobility. The procedure is
triggered in the following cases:
\- At UE Registration procedure, according to clause 4.2.2.2.2 (including
Registration types of Initial Registration or Mobility Registration Update in
inter-AMF mobility in CM-CONNECTED or CM-IDLE state):
\- before the Registration Accept in step 21 if the EAC mode is active; or
\- after the Registration Accept message if the EAC mode is not active;
\- At UE Deregistration procedure, as per clause 4.2.2.3, after the
Deregistration procedure is completed;
\- At UE Configuration Update procedure (which may result from NSSAA procedure
or subscribed S-NSSAI change):
\- before the UE Configuration Update message if the EAC mode is active and
the update flag is to increase; or
\- after the UE Configuration Update message if the EAC mode is active and the
update flag is to decrease; or
\- after the UE Configuration Update message if the EAC mode is not active.
NOTE 1: Depending on the deployment, there may be different NSACF for
different S-NSSAI subject to NSAC and hence, during the registration, AMF
triggers the Number of UEs per network slice availability check and update
procedure to multiple NSACFs.
2\. The AMF sends Nnsacf_NSAC_NumOfUEsUpdate_Request message to the NSACF. The
AMF includes in the message the UE ID, Access Type to which the Allowed NSSAI
or Partially Allowed NSSAI is applied, the S-NSSAI(s), the NF ID and the
update flag which indicates whether the number of UEs registered with the
S-NSSAI(s) is to be increased when the UE has gained registration to network
slice(s) subject to NSAC or the number of UEs registered with the S-NSSAI(s)
is to be decreased when the UE has deregistered from S-NSSAI(s) or could not
renew its registration to an S-NSSAI subject to NSAC.
If this is the first time to perform NSAC procedure for the S-NSSAI towards
the NSACF, the AMF includes notification endpoint for EAC Notification to
implicitly subscribe the EAC notification for the S-NSSAI from the NSACF.
3\. The NSACF determines whether the Access Type provided by the AMF is
configured for the NSAC based on its configuration. If the Access Type is not
configured for the NSAC, the NSACF always accepts the request from the AMF
without increasing or decreasing the number of UEs. If the Access Type is
configured for the NSAC, the NSACF updates the current number of UEs
registered for the S-NSSAI, i.e. increases or decrease the number of UEs
registered per network slice based on the information provided by the AMF in
the update flag parameter.
If the update flag parameter from the AMF indicates increase, the following
applies:
\- If the UE ID is already in the list of UEs registered with the network
slice, the current number of UEs is not increased as the UE has already been
counted as registered with the network slice. The NSACF creates a new entry
associated with this new update and shall also maintain the old entry
associated with previous update. The multiple entries for the same UE ID in
the NSACF are differentiated based on the NF ID of the NF sending the update
request. The NSACF removes the entry associated with the NF ID upon reception
of a request having update flag indicating decrease.
NOTE 2: The use case of having two or more entries in the NSACF for the same
UE can happen during (a) inter-AMF mobility when the new AMF request update to
the NSACF before the old AMF sends request to deregister the UE; or (b) PDN
connections establishment in the EPC when multiple SMF +PGW-Cs (i.e. used for
different PDN Connections associated with the same S-NSSAI) send update
requests for maximum number of UEs to the NSACF.
NOTE 3: To handle AMF graceful removal, the NSACF can subscribe for
unavailability notifications with the AMF (directly or via NRF) as described
in clause 5.21.2.2 and act accordingly, e.g. update the NF ID with the target
AMF ID.
\- If the UE ID is not in the list of UE IDs registered with the network slice
and the maximum number of UEs registered with the network slice has not been
reached yet, the NSACF adds the UE ID in the list of UEs registered with the
network slice as a new entry associated with this new update and increases the
current number of the UEs registered with the network slice. If the UE ID is
not in the list of UEs registered with that S-NSSAI and the maximum number of
UEs for that S-NSSAI has already been reached, then the NSACF returns a result
parameter indicating that the maximum number of UEs registered with the
network slice has been reached.
If the update flag parameter from the AMF indicates decrease and if there is
only one entry associated with the UE ID, the NSACF removes the UE ID from the
list of UEs registered with the network slice for each of the S-NSSAI(s)
indicated in the request from the AMF and also the NSACF decreases the number
of UEs per network slice that is maintained by the NSACF for each of these
network slices. If there are multiple entries associated with the UE ID, the
NSACF removes the entry associated with the NF ID but the UE ID is kept in the
list of UEs registered with the S-NSSAI.
The NSACF takes access type into account for increasing and decreasing the
number of UEs per network slice as described in clause 5.15.11.1 of TS 23.501
[2].
The NSACF stores the notification endpoint for EAC Notification associated
with the S-NSSAI if it is received from the AMF. The NSACF can use this AMF
notification endpoint to update the EAC mode as described in clause 4.2.11.3.
NOTE 4: This enables the NSACF to maintain up-to-date information about the
AMFs serving the S-NSSAIs.
4\. The NSACF returns the Nnsacf_NSAC_NumOfUEsUpdate_Response message
including Result indication per S-NSSAI. The Result indication includes either
\'maximum number of UEs registered with the network slice reached\' or
\'maximum number of UEs registered with the network slice not reached\'.
At UE Registration procedure, if only some of the S-NSSAIs reached the maximum
number of UEs per S-NSSAI, the AMF sends a Registration Accept message to the
UE in which the AMF includes the rejected S-NSSAI(s) in the rejected NSSAI
list for which the NSACF has indicated that the maximum number of UEs per
network slice has been reached and for each rejected S-NSSAI the AMF includes
a reject cause set to \'maximum number of UEs per network slice reached\' and
optionally a back-off timer.
When for all the Requested S-NSSAI(s) provided in step 2 the NSACF returned
the maximum number of UEs per network slice has been reached and if one or
more subscribed S-NSSAIs are marked as default in the subscription data and
not subject to NSAC, the AMF can decide to include these Default Subscribed
S-NSSAIs in the Allowed NSSAI. Otherwise, the AMF rejects the UE request for
registration. In the Registration Reject message, the AMF includes the
rejected S-NSSAI(s) in the rejected NSSAI parameter and for each rejected
S-NSSAI the AMF includes a reject cause to indicate that the maximum number of
UEs per network slice has been reached and optionally a back-off timer.
NOTE 5: If the use case requires the UE to remain reachable at all times with
at least one slice, it is recommended that at least one of the Subscribed
S-NSSAIs is marked as the default S-NSSAI which is not subject to NSAC. This
will ensure the UE is able to access to services even when maximum number of
UEs per network slice has been reached.
For a centralized architecture the following differences apply:
\- In step 2, the AMF additionally includes the NSAC service area the AMF
belongs to, if available, as an additional parameter in the
Nnsacf_NSAC_NumOfUEsUpdate_Request.
\- In step 3, based on operator configuration, the NSACF performs the
validation against the maximum number of Registered UEs registered per NSAC
service area defined for the network slice if applicable and available, or the
maximum number of Registered UEs in the entire PLMN for the network slice.
Additionally the NSACF stores the NSAC service area of AMF if available.
NOTE 6: When a centralized NSAC architecture is deployed, NSACF does not
perform any readmission at inter-AMF mobility since the UE is already admitted
if the validation of maximum number of Registered UEs against the entire PLMN.
#### 4.2.11.2a Hierarchical NSACF-based Number of UEs per network slice
availability check and update procedure
Figure 4.2.11.2a-1: Hierarchical NSACF-based Number of UEs per network slice
availability check and update procedure
For an S-NSSAIs subject to counting of the number of registered UEs, if
hierarchical NSACF architecture is deployed in the network the enforcement of
maximum number of UEs registered for an S-NSSAI is performed as follows:
1\. Same as the step 1 defined in clause 4.2.11.2.
2\. In addition to the information included in the
Nnsacf_NSAC_NumOfUEsUpdate_Request as described in the step 2 of clause
4.2.11.2, the AMF may provide UE already registered indication to the NSACF if
the registered S-NSSAI has already been registered in another service area
before. The AMF determines the indication based on the received the Allowed
NSSAI information from source AMF (in case of inter AMF handover) or from
SMF+PGW-C (in case of mobility from EPS to 5GS).
3\. The NSACF performs NSAC for the indicated S-NSSAI.
If the update flag parameter from the AMF indicates increase, the following
applies:
\- For NSACF which support UE admission quota based control:
\- If the local maximum number of UEs is not reached yet, the NSACF executes
the same action as the step 3 defined in clause 4.2.11.2. Steps 4-8 are
skipped.
\- If the local maximum number of UEs is reached, the NSACF sends a delegation
request to the Primary NSACF. Steps 4-9 are executed.
\- For NSACF which support UE admission threshold-based control:
\- If the UE admission is below the threshold level, the NSACF executes the
same action as the step 3 defined in clause 4.2.11.2. Steps 4-8 are skipped.
\- If the UE admission is at or above the threshold level and the local
maximum number has not been reached, the NSACF checks whether the UE already
registered indication is present.
\- If the UE already registered indication is not present then the NSACF
immediately rejects the NSAC request. Steps 4-8 are skipped.
\- If the UE already registered indication is present the NSACF executes the
same action as the step 3 defined in clause 4.2.11.2 in order to allow for
service continuity. Steps 4-8 are skipped.
\- If the local maximum number has been reached and the UE already registered
indication is present then the NSACF sends a delegation request of NSAC to the
Primary NSACF in order to allow for service continuity. Steps 4-9 are
executed.
If the update flag parameter from the AMF indicates decrease, the following
applies:
\- If the UE entry to be deleted is stored at the NSACF, the NSACF executes
the same action as the step 3 defined in clause 4.2.11.2. Steps 4-8 are
skipped.
\- If the UE entry to be deleted is not stored at the NSACF, the NSACF sends a
delegation request of NSAC to the Primary NSACF. Steps 4-9 are executed.
4\. If the Primary NSACF has not been discovered before, the NSACF discovers
and selects the Primary NSACF which manages the entire PLMN service area
according to clause 6.3.22 of TS 23.501 [2].
5\. The NSACF invokes Nnsacf_NSAC_NumOfUEsUpdate_Request to the Primary NSACF.
The request includes the NSAC request information received from AMF, which may
include the UE already Registered indication only if it is received from AMF
and the UE admission type is quota-based.
6\. The Primary NSACF performs NSAC for the indicated S-NSSAI.
If the update flag parameter from the NSACF indicates increase, the following
applies:
\- If the Primary NSACF decided to delegate the NSAC update request to the
NSACF, per the applied UE admission type of the network, the Primary NSACF
adjusts the local maximum number for UE quota-based admission or the UE
admission threshold for UE admission-threshold in its response to the NSACF.
The Primary NSACF does not create a new entry associated with the UE ID in the
received NSAC request.
NOTE 1: When NSACF sends a delegation request to the Primary NSACF, the
Primary NSACF either increases local maximum number at NSACF or rejects the
NSAC request.
\- For quota-based admission type and if the Primary NSACF decided not to
delegate the request to the NSACF and the UE already Registered indication is
not included, the Primary NSACF rejects the NSAC request. If the UE already
Registered indication is included and if the Primary NSACF decided to store
the UE entry, it creates a new entry associated with the UE ID within the
received NSAC. If the Primary NSACF is not able to store the UE entry, it
rejects the request. The primary NSACF respond accordingly the NSACF as for
step 7.
\- For threshold-based admission and if the Primary NSACF decided not to
delegate the request to the NSACF, the same action as for step 3 in clause
4.2.11.2 is executed with the replacement of NSACF with Primary NSACF.
NOTE 2: To support the session continuity across different service area, the
Primary NSACF always reserves part of the global maximum number for its own
use, i.e. the whole global maximum number is not distributed to all contacted
NSACF(s).
If the update flag parameter from the NSACF indicates decrease and the UE
entry is managed by the Primary NSACF, the same action as step 3 in clause
4.2.11.2 is executed with the replacement of NSACF with Primary NSAC. This
applies to both admission types.
7\. The Primary NSACF returns the Nnsacf_NSAC_NumOfUEsUpdate_Response message
to the NSACF. The response may include the indication (e.g. rejection).
If the Primary NSACF determines to adjust the configured value stored at the
NSACF, the updated local maximum number of UEs or UE admission threshold is
also included in the response respectively.
8\. The NSACF checks the response from Primary NSACF.
If the response includes the updated configured value,
\- The NSACF, which supports UE admission quota based control, replaces the
existing local maximum number of UEs with the received updated value. The same
action is executed as for step 3 in clause 4.2.11.2 based on the updated
configured value.
\- The NSACF, which supports UE admission threshold based control, replaces
the existing UE admission threshold with the received updated value. The same
action is executed as for step 3 in clause 4.2.11.2 based on the updated
configured value.
If the response does not include the updated configured value, the NSACF
returns the response to AMF based on the received NSAC response from Primary
NSACF.
9\. Same as for step 4 defined in clause 4.2.11.2.
#### 4.2.11.3 Configuration for Early Admission Control (EAC) update procedure
The configuration for Early Admission Control (EAC) update procedure indicates
to the AMF the activation or the deactivation of the EAC mode for the S-NSSAI
subject to NSAC. EAC mode means that the AMF is required to perform the number
of UEs per network slice availability check and update procedure before the
S-NSSAI subject to NSAC is included in the Allowed NSSAI or Partially Allowed
NSSAI and sent to the UE. EAC mode is only applicable in the AMF when the
update flag is set to increase.
The AMF implicitly subscribes to the EAC notification for the S-NSSAI when it
performs the first network slice availability check and update procedure for
the S-NSSAI with the NSACF. The NSACF sends the EAC mode notification towards
all notification endpoints associated with the S-NSSAI.
Figure 4.2.11.3-1: Early Admission Control (EAC) update procedure
1\. The number of UEs registered with a network slice subject to NSAC crosses
a certain operator defined threshold. The NSACF determines whether to activate
or deactivate the EAC mode.
2\. The NSACF triggers Nnsacf_NSAC_EACNotify operation including the
S-NSSAI(s) for which the EAC mode is to be activated or deactivated and a EAC
flag(s) set to activated if the number of UEs registered with the network
slice is above certain threshold or set to deactivated if the number of the
UEs registered with the network slice is below certain threshold which may be
same or different with respect to the activation threshold.
NOTE 1: When the operator set the EAC inactive threshold, the Denial-of-
Service issue due to a potential burst of registration request needs to be
taken into account.
3\. The AMF uses the EAC flag to decide when to trigger the number of UEs per
network slice availability check and update procedure so that delays to the
registration procedure and impact to the already allowed network slices are
avoided.
If the EAC flag indicates EAC mode activated, the AMF triggers the number of
UEs per network slice availability check and update procedure before the
Registration Accept step of the registration procedure or before the UE
Configuration Update message.
If the EAC flag indicates EAC mode deactivated, the AMF triggers the number of
UEs per network slice availability check and update procedure after
Registration Accept step of the registration procedure or after the UE
Configuration Update.
NOTE 2: When the S-NSSAI subject to NSAC and NSSAA, with EAC mode activated or
deactivated, the AMF performs them as described in clause 4.2.11.2.
#### 4.2.11.4 Number of PDU Sessions per network slice availability check and
update procedure
This clause applies to Non-Hierarchical NSAC and centralized NSAC
architectures. The difference between the two architectures for the various
steps, where applicable, is described at the end of the clause.
The number of PDU Sessions per network slice availability check and update
procedure is to update (i.e. increase or decrease) the number of PDU Sessions
established on S-NSSAI which is subject to NSAC. The SMF is configured with
the information indicating which network slice is subject to NSAC.
NOTE 1: EAC mode is not applicable for Number of PDU Sessions per network
slice availability check and update procedure.
Figure 4.2.11.4-1: Number of PDU Sessions per network slice availability check
and update procedure
1\. If the SMF is not aware of which NSACF to communicate, the SMF performs
NSACF discovery as described in clause 6.3.22 of TS 23.501 [2] and in clause
5.2.7.3.2. The SMF anchoring the PDU session triggers the Number of PDU
Sessions per network slice availability check and update procedure for the
network slices that are subject to NSAC at the beginning of a PDU Session
Establishment procedure (clause 4.3.2.2.1 and clause 4.3.2.2.2) only for new
PDU Sessions to be established and as a last step of successful PDU Session
Release procedure (clause 4.3.4.2 and clause 4.3.4.3).
NOTE 2: SMFs handling PDU sessions associated with UE Request Type \"Existing
PDU Session\" for intra access handover purposes do not interact with the
NSACF.
2\. The SMF anchoring the PDU session sends
Nnsacf_NSAC_NumOfPDUsUpdate_Request message to the NSACF. The SMF includes in
the message the UE-ID, the PDU session ID, S-NSSAI for which the number of PDU
Sessions per network slice update is required, Access Type and the update
flag. The update flag may include one of the following values:
\- \'increase\' which indicates that the number of PDUs established on the
S-NSSAI is to be increased when the procedure is triggered at the beginning of
PDU Session Establishment procedure or when a new user plane leg is to be
established for an MA PDU Session;
\- \'decrease\' which indicates that the number of PDU Sessions on the S-NSSAI
is to be decreased when the procedure is triggered at the end of PDU Sessions
Release procedure or when an existing user plane leg is to be released for an
MA PDU Session. In the case of a PDU Session Establishment failure, the anchor
SMF triggers another request to the NSACF with the update flag parameter equal
to decrease in order to re-adjust back the PDU Session counter in the NSACF;
or
\- \'update\' which indicates that for existing PDU Session the Access Type is
to be replaced with a new Access Type during inter access mobility.
NOTE 3: For SSC mode 3 PDU session, the SMF of the new PDU Session invokes the
NSACF to increase the number of PDU Session and adds the new PDU session ID in
the NSACF. When the old PDU session is released the SMF of the old PDU session
invokes the NSACF to decrease the number of PDU Session and remove the old PDU
session ID in the NSACF.
NOTE 4: An SMF anchoring an IPv6 Multi-homed PDU session does not invoke NSACF
for an S-NSSAI subject to NSAC when the PDU session replaces an existing
anchor according to clause 4.3.5.3.
3\. The NSACF updates the current number of PDU Sessions established on the
S-NSSAI, i.e. increase or decrease the number of PDU Sessions per network
slice based on the information provided by the anchor SMF in the update flag
parameter.
If the update flag parameter from the SMF anchoring the PDU session indicates
increase value and the maximum number of PDU Sessions established on the
S-NSSAI has already been reached, then the NSACF returns a result parameter
indicating that the maximum number of PDU Sessions per network slice has been
reached. If the maximum number of PDU Sessions established on the S-NSSAI has
not been reached, the NSACF checks the UE ID. If the UE ID is located, the
NSACF, stores the PDU Session ID and the Access Type and increases the number
of PDU Sessions for that S-NSSAI. If the NSACF did not locate the UE ID, it
creates an entry for the UE ID, stores the PDU Session ID and Access Type and
increases the number of PDU Sessions for that S-NSSAI.
If the update flag parameter from the SMF anchoring the PDU session indicates
decrease value, the current number of PDU Sessions per S-NSSAI, the NSACF
locates the UE ID and decreases the number of PDU Sessions for that S-NSSAI
and removes the related PDU Session ID entry. If the UE ID has no more PDU
sessions, after the decrease, the NSACF removes the UE ID entry.
If the update flag parameter from the SMF anchoring the PDU session indicates
update value, the NSACF locates the existing entry with UE ID and PDU Session
ID and replaces the Access Type in the existing entry.
The NSACF takes the Access Type parameter into account for increasing and
decreasing the number of PDU Sessions per S-NSSAI as described in clause
5.15.11.2 of TS 23.501 [2]. For MA PDU Session, if the SMF received
information that the UE is registered over both accesses, the SMF provides
multiple Access Types to the NSACF. If the NSACF receives a request containing
multiple Access Types, the NSACF provides a Result indication for each Access
Type.
4\. The NSACF acknowledges the update to the anchor SMF with
Nnsacf_NSAC_NumOfPDUsUpdate_Response message including a Result indication. If
the NSACF returns a Result indication including \'maximum number of PDU
Sessions per S-NSSAI reached\', the SMF rejects the PDU Session establishment
request with reject cause set to \'maximum number of PDU Sessions per S-NSSAI
reached\' and optionally a back-off timer and the Access Type.
For MA PDU Session Establishment, the NSACF may accept the MA PDU Session and
may provide to the SMF a Result indicating \'maximum number of PDU Sessions
per S-NSSAI reached\' or \'maximum number of PDU Sessions per S-NSSAI not
reached\' associated with an Access Type. If the NSACF indicates a failure
that is associated with the Access Type over which the UE sent the MA PDU
Session Establishment Request, the SMF sends to the UE a PDU Session
Establishment Reject with a Result indication including \'maximum number of
PDU Sessions per S-NSSAI reached\' ,optionally a back-off timer and the Access
Type. When the SMF rejects the MA PDU Session, the SMF sets the Access Type
parameter as follows:
\- If the UE is registered via both accesses and:
\- If the NSACF indicates failure for both accesses, the Access Type indicates
both accesses;
\- If the NSACF indicates failure for the access over which the MA PDU Session
Establishment Request is received, the Access Type indicates the access over
which the MA PDU Session Request is received.
NOTE 5: If the UE is registered in both accesses and the NSACF indicates
failure for the access different from the access over which the MA PDU Session
Establishment Request is received, the SMF accepts the MA PDU Session Request
and does not provide back-off timer to the UE.
\- If the UE is registered via a single access, the Access Type indicates the
access over which the MA PDU Session Request is received.
\- For MA PDU Session Release over single Access Type, the NSACF locates the
existing entry with PDU Session ID and if founds the entry with both Access
Type then it removes only the received Access Type entry while keeping the PDU
Session ID.
For a centralized architecture the following differences apply:
\- In step 2, the SMF additionally includes the NSAC service area the SMF
belongs to, if available, as an additional parameter in the
Nnsacf_NSAC_NumOfPDUsUpdate_Request.
\- In step 3, based on operator configuration, the NSACF performs the
validation against the maximum number of PDU Sessions established on the
S-NSSAI per NSAC service area, if applicable and available, or maximum number
of PDU Sessions established on the S-NSSAI in the entire PLMN. Additionally
the NSACF stores the NSAC service area of SMF if available.
#### 4.2.11.4a Hierarchical NSACF-based Number of PDU Sessions per network
slice availability check and update procedure
Figure 4.2.11.4a-1: Hierarchical NSAC-based number of PDU Sessions per network
slice availability check and update procedure
For an S-NSSAI subject to counting of the number of PDU sessions, if
hierarchical NSACF architecture is deployed in the network the enforcement of
maximum number of PDU Session established for an S-NSSAI is performed as
follow:
1-2. Same as for steps 1-2 defined in clause 4.2.11.4.
3\. The NSACF performs NSAC for the indicated S-NSSAI.
If the PDU session ID entry update at the NSACF is possible, e.g. create a new
entry associated with the received NSAC request for increase case, the same
action as for step 3 defined in clause 4.2.11.4 is executed. Steps 4-8 are
skipped.
If the PDU session ID entry at the NSACF is not possible, i.e. by admitting
the PDU session the local maximum PDU session number is exceeded, the NSACF
delegates the request to the Primary NSACF for an updated local maximum PDU
sessions from the Primary NSACF.
4\. If the Primary NSACF has not been discovered before, the NSACF discovers
and selects the Primary NSACF, which manages the global service area as for
clause 6.3.22 of TS 23.501 [2].
5\. The NSACF invokes Nnsacf_NSAC_NumOfPDUsUpdate request to the Primary
NSACF. The request message includes the S-NSSAI.
6\. The Primary NSACF checks the global maximum PDU session number and
determines whether to accept or reject the request to update local maximum PDU
session number from NSACF.
NOTE: When NSACF sends a delegation request to the Primary NSACF, the Primary
NSACF either increases local maximum number at NSACF or rejects the NSAC
request.
7\. The Primary NSACF returns the Nnsacf_NSAC_NumOfPDUsUpdate response. The
response includes a new allocated local maximum PDU sessions number or an
indication to reject the request to update local maximum PDU session number.
8\. If the primary NSACF provides an updated local maximum number, the NSACF
replaces the local maximum PDU session number with the received local maximum
PDU sessions number value. The same action is executed as for step 3 in clause
4.2.11.4 based on the updated configured value.
9\. Same as for step 4 of clause 4.2.11.4.
#### 4.2.11.5 Network Slice Admission Control Support for Roaming
##### 4.2.11.5.1 Network Slice Admission Control Support for Roaming by VPLMN
This clause describes the case of VPLMN NSAC admission mode.
For NSAC for roaming UEs, a maximum number of allowed UEs per mapped S-NSSAI
in HPLMN and/or a maximum number of allowed PDU Sessions in LBO mode per
mapped S-NSSAI in HPLMN is allocated to the VPLMN for each S-NSSAI in HPLMN
and stored in one NSCAF in the VPLMN responsible for NSAC for the S-NSSAI in
the HPLMN, subject to NSAC.
Enforcement for the maximum number of UEs registered with a network slice is
done in the VPLMN by the NSACF in the VPLMN as per the description in Figure
4.2.11.2-1 with the following differences:
\- Step 2, in the Nnsacf_NSAC_NumOfUEsUpdate_Request service operation where
the AMF provides both the S-NSSAI in VPLMN and the corresponding mapped
S-NSSAI in HPLMN to the NSACF in the VPLMN.
\- Step 3, the NSACF in the VPLMN performs NSAC for both the S-NSSAI in VPLMN
and the corresponding mapped S-NSSAI in HPLMN based on the SLA between VPLMN
and HPLMN.
For LBO PDU sessions, enforcement for the maximum number of PDU Sessions
established for an S-NSSAI is performed in the VPLMN by the NSACF in the VPLMN
as per the description in Figure 4.2.11.4-1 with the following differences:
\- Step 2, in the Nnsacf_NSAC_NumOfPDUsUpdate_Request service operation where
the V-SMF provides both the S-NSSAI in VPLMN and the corresponding mapped
S-NSSAI in HPLMN to the NSACF in the VPLMN.
\- Step 3, the NSACF in the VPLMN performs NSAC for both the S-NSSAI in VPLMN
and the corresponding mapped S-NSSAI in HPLMN based on the SLA between VPLMN
and HPLMN.
An NSACF at VPLMN can optionally fetch the maximum number of registered UEs to
be enforced and the maximum number of LBO PDU sessions to be enforced rather
than have them pre-configured. In this case, the following is performed:
\- For a centralized NSAC architecture in the VPLMN, the NSACF, being a
centralized NSACF, issues the Nnsacf_NSAC_QuotaUpdate Request to fetch from
the HPLMN centralized NSACF or primary NSACF the maximum number of registered
UEs and the maximum number of LBO PDU sessions to be enforced.
\- For a hierarchical NSAC architecture in the VPLMN, the NSACF issues the
Nnsacf_NSAC_NumOfUEsUpdate_Request or Nnsacf_NSAC_NumOfPDUsUpdate_Request to
the VPLMN primary NSACF for NSAC for the maximum number of registered UEs, or
NSAC for the maximum number of LBO PDU sessions. The VPLMN primary NSACF in
turn issues the Nnsacf_NSAC_QuotaUpdate Request, to fetch from the HPLMN
centralized NSACF or primary NSACF the maximum number of registered UEs, or
the maximum number of LBO PDU sessions to be admitted; this information in
turn may be distributed to the VPLMN NSACF.
The NSACF in VPLMN discovers the primary or central NSACF in HPLMN as defined
in clause 6.3.22 of TS 23.501 [2], or optionally be configured with the needed
information.
##### 4.2.11.5.2 Network Slice Admission Control Support for Roaming by HPLMN
##### 4.2.11.5.2.1 General {#general-10 .H6}
For maximum number of UEs in roaming case, there are two types of NSAC
admission modes requiring interaction with HPLMN for inbound roamers; VPLMN
with HPLMN assistance NSAC admission mode or HPLMN NSAC admission mode.
For PDU sessions in the home-routed roaming case, the SMF in HPLMN performs
NSAC for the S-NSSAI(s) subject to NSAC.
For LBO PDU sessions, there are two types of NSAC admission mode requiring
interaction with HPLMN for LBO PDU sessions; VPLMN with HPLMN assistance NSAC
admission mode or HPLMN NSAC admission mode.
##### 4.2.11.5.2.2 VPLMN with HPLMN assistance NSAC admission mode {#vplmn-
with-hplmn-assistance-nsac-admission-mode .H6}
For inbound roamers, depending on the NSAC architecture deployed in the VPLMN,
enforcement for the maximum number of registered UEs with an S-NSSAI is done
in the VPLMN by an NSACF in the VPLMN per the procedure described in clause
4.2.11.2 or 4.2.11.2a with the following differences:
\- The AMF verifies the applicable NSAC admission mode for the inbound roamer
based on the subscription data from UDM.
\- When the AMF invokes the Nnsacf_NSAC_NumOfUEsUpdate_Request service
operation with the NSACF in the VPLMN, the AMF provides in the Request the
additional NSAC admission mode parameter, i.e. VPLMN with HPLMN assistance
NSAC admission mode.
\- If the maximum number of UEs is not available or the maximum number of UEs
has been reached at the Primary (or Central) NSACF of the VPLMN and the type
of NSAC admission mode is VPLMN with HPLMN assistance NSAC admission mode, the
following is performed:
\- The Primary (or Central) NSACF in the VPLMN invokes
Nnsacf_NSAC_NumOfUEsUpdate_Request to the Primary (or central) NSACF in the
HPLMN for NSAC delegation and to receive an initial or a new allocated maximum
number of UEs for the mapped S-NSSAI in HPLMN for inbound roamers. The request
includes mapped S-NSSAI in HPLMN, PLMN ID and NSAC admission mode.
\- The Primary (or central) NSACF in HPLMN provides
Nnsacf_NSAC_NumOfUEsUpdate_Response message to the Primary (or Central) NSACF
of VPLMN. The response message includes mapped S-NSSAI in HPLMN, the new
allocated maximum number of UEs for the mapped S-NSSAI in HPLMN for inbound
roamers. Alternatively, the Primary (or central) NSACF rejects the request for
the NSAC delegation.
\- The Primary (or central) NSACF in VPLMN updates the previous stored maximum
number of UEs based on the new received allocated maximum UEs number.
\- At any time, the Primary (or central) NSACF in HPLMN may trigger
Nnsacf_NSAC_LocalNumberUpdate Request message to the Primary (or central) NSAC
in VPLMN to provide an updated maximum number of registered UEs for the mapped
S-NSSAI in HPLMN for inbound roamers. Based on the updated maximum UEs number
of the S-NSSAI, where applicable, the Primary NSACF in VPLMN may further
perform distribution of local maximum UEs number to the NSACFs it interacts
with. For more detail refer to clause 4.2.11.6.
The complete procedure of the VPLMN with HPLMN assistance NSAC admission mode
for number of registered UEs is described in clause 4.2.11.5.2.3.
For LBO PDU sessions, depending on the NSAC architecture deployed in the
VPLMN, enforcement for the maximum number of LBO PDU sessions established for
an S-NSSAI is performed by the NSACF in the VPLMN per the procedure described
in clause 4.2.11.4 or 4.2.11.4a with the following differences:
\- The SMF verifies the applicable NSAC admission mode for the S-NSSAI PDU
session associated with the inbound roamer based on the subscription data from
UDM.
\- When the SMF invokes the Nnsacf_NSAC_NumOfPDUsUpdate_Request service
operation to the NSACF in the VPLMN, the SMF provides in the Request the
additional NSAC admission mode parameter, i.e. VPLMN with HPLMN assistance
NSAC admission mode.
\- If the maximum number of PDU Session is not available or the maximum number
of PDU Sessions has been reached at the Primary (or Central) NSACF of the
VPLMN and the type of NSAC admission mode is VPLMN with HPLMN assistance NSAC
admission mode, the following is performed:
\- The Primary (or Central) NSACF in the VPLMN invokes
Nnsacf_NSAC_NumOfPDUsUpdate_Request to the Primary (or central) NSACF in the
HPLMN for the NSAC delegation and to receive an initial or a new allocated
maximum number of LBO PDU Sessions for the mapped S-NSSAI in HPLMN for inbound
roamers. The request includes mapped S-NSSAI in HPLMN, PLMN ID and NSAC
admission mode.
\- The Primary (or central) NSACF in HPLMN provides the
Nnsacf_NSAC_NumOfPDUsUpdate_Response message to the Primary NSACF of VPLMN.
The response message includes mapped S-NSSAI in HPLMN, the allocated maximum
number of LBO PDU Sessions for the mapped S-NSSAI in HPLMN for inbound
roamers. Alternatively, the Primary (or central) NSACF rejects the request for
the NSAC delegation.
\- The Primary (or central) NSACF in VPLMN updates the previous stored maximum
number of PDU Sessions based on the new received allocated maximum number of
LBO PDU Sessions.
\- At any time, the Primary (or central) NSACF in HPLMN may trigger
Nnsacf_NSAC_LocalNumberUpdate Request message to the Primary (or central) NSAC
in VPLMN to provide an updated new allocated maximum number of LBO PDU
Sessions for the mapped S-NSSAI in HPLMN for the roaming UEs. Based on the
updated maximum number of LBO PDU Sessions number of the S-NSSAI, where
applicable, the Primary NSACF in VPLMN may further perform distribution of
local maximum PDU Sessions number to the NSACFs it contacts. For more detail
refer to clause 4.2.11.6.
The complete procedure for the VPLMN with HPLMN assistance NSAC Admission mode
for number of registered UEs and number of LBO PDU Sessions is described in
Clause 4.2.11.5.2.4.
NSACF nodes to be contacted in all the above are either configured or
discovered.
##### 4.2.11.5.2.3 VPLMN with HPLMN assistance NSAC Admission mode for number
of Registered UEs {#vplmn-with-hplmn-assistance-nsac-admission-mode-for-
number-of-registered-ues .H6}
Figure 4.2.11.5.2.3-1: HPLMN Delegated NSAC admission for UE number Procedure
The procedure of NSAC for maximum number of UEs for a roaming UE registration
is performed as follows:
1\. Same as step 1 defined in clause 4.2.11.2. For the inbound roaming UE, the
AMF checks the NSAC admission mode of the registered S-NSSAI based on the
subscription data from UDM.
If the Hierarchical NSAC architecture is deployed in the VPLMN, steps 2a-3a
are executed and step 2b is skipped.
2a. The AMF invokes Nnsacf_NSAC_NumOfUEsUpdate request to the NSACF in VPLMN
same as step 2 of clause 4.2.11.2a with the additional parameter NSAC
admission mode, i.e. VPLMN with HPLMN assistance NSAC admission mode.
3a. Same procedure of steps 3-5 in clause 4.2.11.2a is executed.
If the centralized NSAC architecture is deployed in the VPLMN, step 2b is
executed and steps 2a-3a are skipped.
2b. The AMF invokes Nnsacf_NSAC_NumOfUEsUpdate request to the central NSACF in
VPLMN same as step 2 of clause 4.2.11.2 with the additional parameter NSAC
admission mode, i.e. VPLMN with HPLMN assistance NSAC admission mode.
4\. If there is no allocated maximum number of UEs from HPLMN or the allocated
maximum number of registered UEs has been reached and the type of NSAC
admission mode is VPLMN with HPLMN assistance NSAC admission mode, the Primary
(or central) NSACF in VPLMN interacts with HPLMN. In this case, steps 5-7 are
executed. Otherwise, steps 5-7 are skipped.
The Primary (or central) NSACF in VPLMN discovers the Primary (or central)
NSACF in HPLMN.
NOTE 1: The Primary (or central) NSACF in HPLMN can be configured or be
discovered via NRF.
5\. The Primary (or central) NSACF in the VPLMN invokes
Nnsacf_NSAC_NumOfUEsUpdate Request to the Primary (or central) NSACF in the
HPLMN for NSAC delegation and to receive an initial or an updated maximum
number of registered UEs for the mapped S-NSSAI in HPLMN for the inbound
roamers. The request includes mapped S-NSSAI in HPLMN, PLMN ID and NSAC
admission mode.
6\. The Primary (or central) NSACF in HPLMN invokes Nnsacf_NSAC_NumOfUEsUpdate
Response message to the Primary (or central) NSACF of VPLMN. The response
message includes mapped S-NSSAI in HPLMN, the allocated maximum number of
registered UEs for the mapped S-NSSAI in HPLMN for inbound roamers.
Alternatively, the Primary (or central) NSACF in HPLMN rejects the request for
the NSAC delegation.
7\. The Primary (or central) NSACF in VPLMN updates the previous stored
maximum number of UE based on the received allocated maximum number of UEs.
If the Hierarchical NSAC architecture is deployed in the VPLMN, steps 8a-9a
are executed and steps 8b-9b are skipped.
8a. This step is executed only if the NSACF in VPLMN has interacted with
Primary NSACF in VPLMN at step 3a before. The NSACF with the assistance of
Primary NSACF in VPLMN perform NSAC according to the steps 6-8 in clause
4.2.11.2a.
9a. Based on the response from Primary NSACF in VPLMN, the NSACF in VPLMN
returns the response (i.e. acceptance or rejection) message to the AMF. The
AMF provides the corresponding response to the inbound roaming UE.
If the centralized NSAC architecture is deployed in the VPLMN, steps 8b-9b are
executed and steps 8a-9a are skipped.
8b. Same as the step 3 in clause 4.2.11.2 with the replacement of NSACF with
Central NSACF.
9b. The Central NSACF in VPLMN returns the response (i.e. acceptance or
rejection) message to the AMF. The AMF provides the corresponding response to
the inbound roaming UE.
##### 4.2.11.5.2.4 VPLMN with HPLMN assistance NSAC Admission mode for number
of LBO PDU Sessions {#vplmn-with-hplmn-assistance-nsac-admission-mode-for-
number-of-lbo-pdu-sessions .H6}
Figure 4.2.11.5.2.4-1: HPLMN Delegated NSAC admission for PDU Session number
procedure
The NSAC procedure for maximum number of LBO PDU Sessions for inbound roamers,
is performed as follow:
1\. Same as steps 1 defined in clause 4.2.11.4. For the inbound roaming UE,
the SMF checks the NSAC admission mode of the S-NSSAI for the LBO PDU session
based on the subscription data from UDM.
If the Hierarchical NSAC architecture is deployed in the VPLMN, steps 2a-3a
are executed and step 2b is skipped.
2a. The SMF invokes Nnsacf_NSAC_NumOfsPDUsUpdate request to the NSACF in VPLMN
same as step 2 of clause 4.2.11.4 with the additional parameter NSAC admission
mode, i.e. VPLMN with HPLMN assistance NSAC admission mode.
3a. Same procedure of steps 3-5 in clause 4.2.11.4a is executed.
If the centralized NSAC architecture is deployed in the VPLMN, step 2b is
executed and steps 2a-3a are skipped.
2b. The SMF invokes Nnsacf_NSAC_NumOfsPDUsUpdate request to the central NSACF
in VPLMN same as step 2 of clause 4.2.11.4 with the additional parameter NSAC
admission mode, i.e. VPLMN with HPLMN assistance NSAC admission mode.
4-7. The same procedure as step 4-7 of Figure 4.2.11.5.2.3-1 is applied with
the difference that the maximum number of registered UE parameter is replaced
with the maximum number of LBO PDU Sessions number. Nnsacf_NSAC_NumOfUEsUpdate
service operation is replaced with Nnsacf_NSAC_NumOfPDUsUpdate service
operation.
If the Hierarchical NSAC architecture is deployed in the VPLMN, steps 8a-9a
are executed and steps 8b are skipped.
8a. This step is executed only if the NSACF in VPLMN has interacted with
Primary NSACF in VPLMN at step 3a before. The NSACF with the assistance of
Primary NSACF in VPLMN performs NSAC according to the steps 6-8 in clause
4.2.11.4a.
9a. Based on the response from Primary NSACF in VPLMN, the NSACF in VPLMN
returns the response (i.e. acceptance or rejection) message to the SMF. The
SMF provides the corresponding response to the inbound roaming UE.
If the centralized NSAC architecture is deployed in the VPLMN, steps 8b-9b are
executed and steps 8a-9a are skipped.
8b. Same as the step 3 in clause 4.2.11.4 with the replacement of NSACF with
Central NSACF.
9b. The Central NSACF in VPLMN returns the response (i.e. acceptance or
rejection) message to the SMF. The SMF provides the corresponding response to
the inbound roaming UE.
##### 4.2.11.5.2.5 HPLMN NSAC Admission {#hplmn-nsac-admission .H6}
Monitoring and enforcement for the maximum number of UEs registered with a
network slice monitoring is done by the NSACF in the HPLMN per the procedure
described in clause 4.2.11.2 with the following differences:
\- Step 1, the AMF verifies the applicable NSAC admission mode for the
registered S-NSSAI for the UE based on the subscription data from UDM. The
S-NSSAI is the mapped S-NSSAI in HPLMN.
\- Step 2, in the Nnsacf_NSAC_NumOfUEsUpdate_Request service operation the
V-AMF provides both the S-NSSAI in VPLMN and the corresponding mapped S-NSSAI
in HPLMN to the NSACF in the HPLMN.
\- Step 3, the NSCAF in the HPLMN performs NSAC for the corresponding mapped
S-NSSAI in HPLMN.
Enforcement of the maximum number of LBO PDU Sessions established for an
S-NSSAI is performed by the NSACF in the HPLMN as per the procedure described
in clause 4.2.11.4 with the following differences:
\- Step 1, the SMF verifies the applicable NSAC admission mode for the S-NSSAI
used for the established PDU session based on the subscription data from UDM.
The S-NSSAI is the mapped S-NSSAI in HPLMN.
\- Step 2, in the Nnsacf_NSAC_NumOfPDUsUpdate_Request service operation the
V-SMF provides both the S-NSSAI in VPLMN and the corresponding mapped S-NSSAI
in HPLMN to the NSACF in the VPLMN.
\- Step 3, the NSACF in the HPLMN performs NSAC for the corresponding mapped
S-NSSAI in HPLMN.
NSACF nodes to be contacted in all the above are either configured or
discovered as defined in clause 6.3.22 of TS 23.501 [2].
#### 4.2.11.6 Update of local maximum number in Hierarchical NSAC Architecture
Figure 4.2.11.6-1: Update of local maximum number in hierarchical NSAC
architecture
At any time the Primary NSACF may update the allocated local Maximum number of
UE and/or PDU sessions configured at the NSACFs as follow:
1\. The Primary NSACF decides to update the local maximum number of UE or PDU
session values at the NSACF(s), i.e. the configured value at NSACF(s) based on
the current registered UE/PDU session number at NSACFs and based on operator
policy.
2\. The Primary NSACF invokes Nnsacf_NSAC_LocalNumberUpdate Request to the
NSACF(s). The message includes the new configured value of local Maximum
number of UE or PDU sessions.
NOTE: The new configured value(s) of local maximum number given by the Primary
NSACF can be lower than the existing local maximum number configured at the
NSACF(s).
3\. The NSACF replaces the local maximum number with the received new local
maximum number value.
4\. The NSACF returns the Nnsacf_NSAC_LocalNumberUpdate Response to the
Primary NSACF.
## 4.3 Session Management procedures
### 4.3.1 General
Clause 4.3 defines the Session Management related procedures. It refers to
clause 4.4 for the N4 interactions.
As defined in clause 5.6.3 of TS 23.501 [2], considering the case of Home
Routed PDU Session, the NAS SM information processing by SMF considers
following kind of NAS SM information:
\- Information that both the V-SMF and H-SMF process: indication of the nature
of the NAS SM signalling (e.g. PDU Session Establishment Request), PDU Session
Type, Session-AMBR, UE addressing information (allocated IPv4 address,
interface identifier).
\- Information that is not visible to the V-SMF, only processed by the H-SMF:
SSC mode, Protocol Configuration Options, SM PDU DN Request Container, QoS
Rule(s) and QoS Flow level QoS parameters if any for the QoS Flow(s)
associated with the QoS rule(s).
NOTE 1: \"Information that is not visible to the V-SMF\" refers to information
that the V-SMF is to relay between the UE and the H-SMF (and that it can store
in CDR) but that the V-SMF is not assumed to process otherwise.
The NAS SM information processing split between V-SMF and H-SMF is transparent
to the UE.
Both V-SMF and H-SMF process information interpreted by the AMF as the PDU
Session ID, the DNN, the S-NSSAI (with values for the Serving PLMN and HPLMN
processed by the V-SMF and with a value for the HPLMN processed by the H-SMF).
In the case of Home Routed PDU Session the H-SMF provides also the V-SMF with
the IPv6 Prefix allocated to the PDU Session.
NOTE 2: IPv6 Prefix allocated to the PDU Session is provided to allow the
V-SMF fulfilling regulatory requirements for data storage in the visited
country.
In non roaming and LBO cases the SMF processes all NAS SM information.
In HR roaming scenarios, in order to support SM features only requiring
support from the H-SMF without impacting the V-SMF, as specified in detail in
TS 29.502 [36]:
\- The V-SMF transfers NAS SM information, which is not visible to the V-SMF,
in a container towards the H-SMF;
\- The V-SMF transfers NAS SM information which it does not comprehend
(unknown IEs or IEs with an unknown value not set to \"reserved\" according to
the release to which the V-SMF complies), in a different container towards the
H-SMF;
\- The H-SMF transfers NAS SM information which the V-SMF does not need to
interpret, in one container towards the V-SMF;
\- The V-SMF appends unknown NAS SM information received in the N16 container
at the end of the NAS SM message it sends to the UE.
### 4.3.2 PDU Session Establishment
#### 4.3.2.1 General
A PDU Session establishment may correspond to:
\- a UE initiated PDU Session Establishment procedure.
\- a UE initiated PDU Session handover between 3GPP and non-3GPP.
\- a UE initiated PDU Session handover from EPS to 5GS.
\- a Network triggered PDU Session Establishment procedure. In this case the
network sends the device trigger message to application(s) on the UE side. The
payload included in Device Trigger Request message contains information on
which application on the UE side is expected to trigger the PDU Session
establishment request. Based on that information, the application(s) on the UE
side trigger the PDU Session Establishment procedure. For more detail refer to
clause 4.13.2.
If the UE is simultaneously registered to a non-3GPP access via a
N3IWF/TNGF/W-AGF located in a PLMN different from the PLMN of the 3GPP access,
the functional entities in the following procedures are located in the PLMN of
the access used to exchange NAS with the UE for the PDU Session.
As specified in clause 5.6.1 of TS 23.501 [2], a PDU Session may be associated
either (a) with a single access type at a given time, i.e. either 3GPP access
or non-3GPP access, or (b) simultaneously with multiple access types, i.e. one
3GPP access and one non-3GPP access. A PDU Session associated with multiple
access types is referred to as Multi Access-PDU (MA PDU) Session and it may be
requested by ATSSS-capable UEs.
The following clause 4.3.2.2 specifies the procedures for establishing PDU
Sessions associated with a single access type at a given time. The particular
procedures associated with MA PDU Sessions are specified as part of the ATSSS
procedures in clause 4.22.
#### 4.3.2.2 UE Requested PDU Session Establishment
##### 4.3.2.2.1 Non-roaming and Roaming with Local Breakout
Clause 4.3.2.2.1 specifies PDU Session establishment in the non-roaming and
roaming with local breakout cases. The procedure is used to:
\- Establish a new PDU Session;
\- Handover a PDN Connection in EPS to PDU Session in 5GS without N26
interface;
\- Switching an existing PDU Session between non-3GPP access and 3GPP access.
The specific system behaviour in this case is further defined in clauses 4.9.2
and 4.9.3; or
\- Request a PDU Session for Emergency services.
In the case of roaming, the AMF determines if a PDU Session is to be
established in LBO or Home Routing. In the case of LBO, the procedure is as in
the case of non-roaming with the difference that the AMF, the SMF, the UPF and
the PCF are located in the visited network. PDU Sessions for Emergency
services are never established in Home Routed mode. If Control Plane CIoT 5GS
Optimisation is enabled for the PDU session with LBO, the NEF is not used as
the anchor of this PDU Session.
NOTE 1: UE provides both the S-NSSAIs of the Home PLMN and Visited PLMN to the
network as described in clause 5.15.5.3 of TS 23.501 [2].
Figure 4.3.2.2.1-1: UE-requested PDU Session Establishment for non-roaming and
roaming with local breakout
The procedure assumes that the UE has already registered on the AMF thus
unless the UE is Emergency Registered the AMF has already retrieved the user
subscription data from the UDM.
1\. From UE to AMF: NAS Message (S-NSSAI(s), [Alternative S-NSSAI], UE
Requested DNN, PDU Session ID, Request type, Old PDU Session ID, N1 SM
container (PDU Session Establishment Request, [Port Management Information
Container])).
In order to establish a new PDU Session, the UE generates a new PDU Session
ID.
The UE initiates the UE Requested PDU Session Establishment procedure by the
transmission of a NAS message containing a PDU Session Establishment Request
within the N1 SM container. The PDU Session Establishment Request includes a
PDU session ID, Requested PDU Session Type, a Requested SSC mode, 5GSM
Capability, PCO, SM PDU DN Request Container, [Number Of Packet Filters],
[Header Compression Configuration], UE Integrity Protection Maximum Data Rate,
[Always-on PDU Session Requested], [RSN], [Connection Capabilities] and [PDU
Session Pair ID].
The Request Type indicates \"Initial request\" if the PDU Session
Establishment is a request to establish a new PDU Session and indicates
\"Existing PDU Session\" if the request refers to an existing PDU Session
switching between 3GPP access and non-3GPP access or to a PDU Session handover
from an existing PDN connection in EPC. If the request refers to an existing
PDN connection in EPC, the S-NSSAI is set as described in clause 5.15.7.2 of
TS 23.501 [2]
When Emergency service is required and an Emergency PDU Session is not already
established, a UE shall initiate the UE Requested PDU Session Establishment
procedure with a Request Type indicating \"Emergency Request\".
The Request Type indicates \"Emergency Request\" if the PDU Session
Establishment is a request to establish a PDU Session for Emergency services.
The Request Type indicates \"Existing Emergency PDU Session\" if the request
refers to an existing PDU Session for Emergency services switching between
3GPP access and non-3GPP access or to a PDU Session handover from an existing
PDN connection for Emergency services in EPC.
The 5GSM Core Network Capability is provided by the UE and handled by SMF as
defined in clause 5.4.4b of TS 23.501 [2].
The Number Of Packet Filters indicates the number of supported packet filters
for signalled QoS rules for the PDU Session that is being established. The
number of packet filters indicated by the UE is valid for the lifetime of the
PDU Session. For presence condition, see TS 24.501 [25].
The UE Integrity Protection Maximum Data Rate indicates the maximum data rate
up to which the UE can support UP integrity protection. The UE shall provide
the UE Integrity Protection Data Rate capability independently of the Access
Type over which the UE sends the PDU Session Establishment Request.
If the use of header compression for Control Plane CIoT 5GS optimisation was
negotiated successfully between the UE and the network in the previous
registration procedure, the UE shall include the Header Compression
Configuration, unless \"Unstructured\" PDU Session Type is indicated. The
Header Compression Configuration includes the information necessary for the
header compression channel setup. Optionally, the Header Compression
Configuration may include additional header compression context parameters.
The NAS message sent by the UE is encapsulated by the AN in a N2 message
towards the AMF that should include User location information and Access Type
Information.
The PDU Session Establishment Request message may contain SM PDU DN Request
Container containing information for the PDU Session authorization by the
external DN.
The UE includes the S-NSSAI from the Allowed NSSAI of the current access type
or Partially Allowed NSSAI. If the UE is provided with the mapping of an
S-NSSAI that is replaced by an Alternative S-NSSAI, the UE shall provide both
the Alternative S-NSSAI and the S-NSSAI that is replaced by it. If the Mapping
of Allowed NSSAI or Mapping Of Partially Allowed NSSAI was provided to the UE,
the UE shall provide both the S-NSSAI of the VPLMN from the Allowed NSSAI or
Partially Allowed NSSAI and the corresponding S-NSSAI of the HPLMN from the
Mapping Of Allowed NSSAI or Mapping Of Partially Allowed NSSAI. If the UE is
provided with the mapping of the VPLMN S-NSSAI to a VPLMN Alternative S-NSSAI,
the UE provides both the VPLMN Alternative S-NSSAI and the VPLMN S-NSSAI in
the PDU Session Establishment message. If the UE is provided with the mapping
of the HPLMN S-NSSAI to a HPLMN Alternative S-NSSAI, the UE provides both the
HPLMN Alternative S-NSSAI and the HPLMN S-NSSAI in the PDU Session
Establishment message.
If the procedure is triggered for SSC mode 3 operation, the UE shall also
include the Old PDU Session ID which indicates the PDU Session ID of the on-
going PDU Session to be released, in NAS message. The Old PDU Session ID is
included only in this case.
The AMF receives from the AN the NAS SM message (built in step 1) together
with User Location Information (e.g. Cell Id in the case of the NG-RAN).
The UE shall not trigger a PDU Session establishment for a PDU Session
corresponding to a LADN when the UE is outside the area of availability of the
LADN.
The UE shall not trigger a PDU Session establishment for a PDU Session
associated to an S-NSSAI if the S-NSSAI is not valid as per the S-NSSAI
location availability information.
If the UE is establishing a PDU session for IMS and the UE is configured to
discover the P-CSCF address during connectivity establishment, the UE shall
include an indicator that it requests a Pâ€‘CSCF IP address(es) within the SM
container.
The PS Data Off status is included in the PCO in the PDU Session Establishment
Request message.
The UE capability to support Reliable Data Service is included in the PCO in
the PDU Session Establishment Request message.
If the UE has indicated that it supports transfer of Port Management
Information Containers as per UE 5GSM Core Network Capability and if the PDU
session type is Ethernet, then the UE shall include the MAC address of the DS-
TT Ethernet port used for this Ethernet PDU session. If the UE is aware of the
UE-DS-TT Residence Time, then the UE shall additionally include the UE-DS-TT
Residence Time.
If the UE requests to establish always-on PDU session, the UE includes an
Always-on PDU Session Requested indication in the PDU Session Establishment
Request message.
As described in TS 23.548 [74], a UE that hosts EEC(s) may indicate in the PCO
that it supports the ability to receive ECS address(es) via NAS and to
transfer the ECS Address(es) to the EEC(s).
A UE that hosts the EDC functionality shall indicate in the PCO its capability
to support the EDC functionality (see clause 5.2.1 of TS 23.548 [74]).
The UE may also include PDU Session Pair ID and/or RSN in PDU Session
Establishment Request message as described in clause 5.33.2.1 of TS 23.501
[2].
A UE that supports EAS re-discovery as described in clause 6.2.3.3 of TS
23.548 [74], may indicate so in the PCO.
Port Management Information Container may be received from DS-TT and includes
port management capabilities, i.e. information indicating which standardized
and deployment-specific port management information is supported by DS-TT as
defined in clause 5.28.3 of TS 23.501 [2].
If UE supports to report URSP rule enforcement to network and the URSP rule
that triggered this PDU Session Establishment Request included the Indication
for reporting URSP rule enforcement, the UE may provide Connection
Capabilities as described in clause 6.6.2.4 of TS 23.503 [20].
2\. For NR satellite access, the AMF may decide to verify the UE location as
described in clause 5.4.11.4 of TS 23.501 [2].
The AMF determines that the message corresponds to a request for a new PDU
Session based on that Request Type indicates \"initial request\" and that the
PDU Session ID is not used for any existing PDU Session of the UE. If the NAS
message does not contain an S-NSSAI, the AMF determines an S-NSSAI of the
Serving PLMN for the requested PDU Session from the current Allowed NSSAI for
the UE. If there is only one S-NSSAI in the Allowed NSSAI, this S-NSSAI shall
be used. If there is more than one S-NSSAI in the Allowed NSSAI, the S-NSSAI
selected is either according to the UE subscription, if the subscription
contains only one default S-NSSAI and the corresponding mapped HPLMN S-NSSAI
of the Serving PLMN is included in the Allowed NSSAI, or based on operator
policy (e.g. also ensures any UE Requested DNN is allowed for the selected
S-NSSAI)). When the NAS Message contains an S-NSSAI of the Serving PLMN but it
does not contain a DNN, the AMF determines the DNN for the requested PDU
Session by selecting the default DNN for this S-NSSAI if the default DNN is
present in the UE\'s Subscription Information (or for the corresponding
S-NSSAI of the HPLMN, in the case of LBO); otherwise the serving AMF selects a
locally configured DNN for this S-NSSAI of the Serving PLMN. If the AMF cannot
select an SMF (e.g. the UE requested DNN is not supported by the network, or
the UE requested DNN is not in the Subscribed DNN List for the S-NSSAI (or its
mapped value for the HPLMN in the case of LBO) and wildcard DNN is not
included in the Subscribed DNN list), the AMF shall, based on operator
policies received from PCF, either reject the NAS Message containing PDU
Session Establishment Request from the UE with an appropriate cause or request
PCF to replace the UE requested DNN by a selected DNN. If the DNN requested by
the UE is present in the UE subscription information but indicated for
replacement in the operator policies received from PCF, the AMF shall request
the PCF to perform a DNN replacement to a selected DNN. AMF requests DNN
replacement as specified in clause 4.16.2.1.1. If the DNN requested by the UE
is present in the UE subscription information but not supported by the network
and not indicated for replacement in the operator policies received from PCF,
the AMF shall reject the NAS Message containing PDU Session Establishment
Request from the UE with an appropriate cause value.
The AMF selects an SMF as described in clause 6.3.2 of TS 23.501 [2] and
clause 4.3.2.2.3. If the Request Type indicates \"Initial request\" or the
request is due to handover from EPS or from non-3GPP access serving by a
different AMF, the AMF stores an association of the S-NSSAI(s), the DNN, the
PDU Session ID, the SMF ID as well as the Access Type of the PDU Session. If
the AMF determines to replace the S-NSSAI received from the UE with the
Alternative S-NSSAI or the AMF receives the Alternative S-NSSAI and the
S-NSSAI is by the UE, the AMF selects the SMF based on the Alternative
S-NSSAI.
During registration procedures, the AMF determines the use of the Control
Plane CIoT 5GS Optimisation or User Plane CIoT 5GS Optimisation based on UEs
indications in the 5G Preferred Network Behaviour, the serving operator
policies and the network support of CIoT 5GS optimisations. The AMF selects an
SMF that supports Control Plane CIoT 5GS optimisation or User Plane CIoT 5GS
Optimisation as described in clause 6.3.2 of TS 23.501 [2].
If the Request Type is \"initial request\" and if the Old PDU Session ID
indicating the existing PDU Session is also contained in the message, the AMF
selects an SMF as described in clause 4.3.5.2 and stores an association of the
new PDU Session ID, the S-NSSAI(s), the selected SMF ID as well as Access Type
of the PDU Session.
If the Request Type indicates \"Existing PDU Session\", the AMF selects the
SMF based on SMF-ID received from UDM. The case where the Request Type
indicates \"Existing PDU Session\" and either the AMF does not recognize the
PDU Session ID or the subscription context that the AMF received from UDM
during the Registration or Subscription Profile Update Notification procedure
does not contain an SMF ID corresponding to the PDU Session ID constitutes an
error case. The AMF updates the Access Type stored for the PDU Session.
If the Request Type indicates \"Existing PDU Session\" referring to an
existing PDU Session moved between 3GPP access and non-3GPP access, then if
the Serving PLMN S-NSSAI of the PDU Session is present in the Allowed NSSAI of
the target access type or Partially Allowed NSSAI, the PDU Session
Establishment procedure can be performed in the following cases:
\- the SMF ID corresponding to the PDU Session ID and the AMF belong to the
same PLMN;
\- the SMF ID corresponding to the PDU Session ID belongs to the HPLMN;
Otherwise the AMF shall reject the PDU Session Establishment Request with an
appropriate reject cause.
NOTE 2: The SMF ID includes the PLMN ID that the SMF belongs to.
The AMF shall reject a request coming from an Emergency Registered UE and the
Request Type indicates neither \"Emergency Request\" nor \"Existing Emergency
PDU Session\". When the Request Type indicates \"Emergency Request\", the AMF
is not expecting any S-NSSAI and DNN value provided by the UE and uses locally
configured values instead. The AMF stores the Access Type of the PDU Session.
If the Request Type indicates \"Emergency Request\" or \"Existing Emergency
PDU Session\", the AMF selects the SMF as described in clause 5.16.4 of TS
23.501 [2].
If the AMF is running a slice deregistration inactivity timer for the S-NSSAI
of the PDU Session, the AMF stops the timer.
3\. From AMF to SMF: Either Nsmf_PDUSession_CreateSMContext Request (SUPI,
selected DNN, UE requested DNN, S-NSSAI(s), [Alternative S-NSSAI], PDU Session
ID, AMF ID, Request Type, [PCF ID, Same PCF Selection Indication], Priority
Access, [Small Data Rate Control Status], N1 SM container (PDU Session
Establishment Request), User location information, Access Type, RAT Type, PEI,
GPSI, UE presence in LADN service area, Subscription For PDU Session Status
Notification, DNN Selection Mode, Trace Requirements, Control Plane CIoT 5GS
Optimisation indication, Control Plane Only indicator, Satellite backhaul
category, GEO Satellite ID, [PVS FQDN(s) and/or PVS IP address(es), Onboarding
Indication], Disaster Roaming service indication) or
Nsmf_PDUSession_UpdateSMContext Request (SUPI, DNN, S-NSSAI(s), SM Context ID,
AMF ID, Request Type, N1 SM container (PDU Session Establishment Request),
User location information, Access Type, RAT type, PEI, Serving Network (PLMN
ID, or PLMN ID and NID, see clause 5.18 of TS 23.501 [2]), Satellite backhaul
category, GEO Satellite ID), [PCF binding information, notification of SM
Policy Association establishment Indication].
If the AMF does not have an association with an SMF for the PDU Session ID
provided by the UE (e.g. when Request Type indicates \"initial request\"), the
AMF invokes the Nsmf_PDUSession_CreateSMContext Request, but if the AMF
already has an association with an SMF for the PDU Session ID provided by the
UE (e.g. when Request Type indicates \"existing PDU Session\"), the AMF
invokes the Nsmf_PDUSession_UpdateSMContext Request.
The AMF sends the S-NSSAI of the Serving PLMN from the Allowed NSSAI or
Partially Allowed NSSAI to the SMF. If the AMF determined to replace the
S-NSSAI received from the UE with an Alternative S-NSSAI and the AMF selected
the SMF based on the Alternative S-NSSAI in step 2, the AMF sends both the
S-NSSAI value of the Alternative S-NSSAI and the S-NSSAI value of the S-NSSAI
received from the UE to the SMF. If the Alternative S-NSSAI and the S-NSSAI is
provided by the UE and the AMF selected the SMF based on the Alternative
S-NSSAI in step 2, the AMF sends both the S-NSSAI value of the Alternative
S-NSSAI and the S-NSSAI value of the S-NSSAI received from the UE to the SMF.
For roaming scenario in local breakout (LBO), the AMF also sends the
corresponding S-NSSAI of the HPLMN from the Mapping Of Allowed NSSAI or
Mapping Of Partially Allowed NSSAI to the SMF. If the the AMF determines to
replace the HPLMN S-NSSAI received from the UE with the HPLMN Alternative
S-NSSAI or the AMF receives the HPLMN Alternative S-NSSAI and the HPLMN
S-NSSAI provided by the UE, the AMF sends both HPLMN S-NSSAI and HPLMN
Alternative S-NSSAI to the SMF.
The AMF ID is the UE\'s GUAMI which uniquely identifies the AMF serving the
UE. The AMF forwards the PDU Session ID together with the N1 SM container
containing the PDU Session Establishment Request received from the UE. The
GPSI shall be included if available at AMF.
The AMF determines Access Type and RAT Type, see clause 4.2.2.2.1.
The AMF provides the PEI instead of the SUPI when the UE in limited service
state has registered for Emergency services (i.e. Emergency Registered)
without providing a SUPI. The PEI is defined in clause 5.9.3 of TS 23.501 [2].
If the UE in limited service state has registered for Emergency services (i.e.
Emergency Registered) with a SUPI but has not been authenticated the AMF
indicates that the SUPI has not been authenticated. The SMF determines that
the UE has not been authenticated when it does not receive a SUPI for the UE
or when the AMF indicates that the SUPI has not been authenticated.
If the AMF determines that the selected DNN corresponds to an LADN then the
AMF provides the \"UE presence in LADN service area\" that indicates if the UE
is IN or OUT of the LADN service area. If the AMF enforces the LADN Service
Area per LADN DNN and S-NSSAI, then the AMF also provides an indication that
\"the PDU Session is subject to LADN per LADN DNN and S-NSSAI\".
If the Old PDU Session ID is included in step 1 and if the SMF is not to be
reallocated, the AMF also includes Old PDU Session ID in the
Nsmf_PDUSession_CreateSMContext Request.
DNN Selection Mode is determined by the AMF. It indicates whether an
explicitly subscribed DNN has been provided by the UE in its PDU Session
Establishment Request.
The SMF may use DNN Selection Mode when deciding whether to accept or reject
the UE request.
When the Establishment cause received as part of AN parameters during the
Registration procedure or Service Request procedure is associated with
priority services (e.g. MPS, MCX), or when the AMF determines the UE has
priority subscription (e.g. MPS, MCX) in the UDM, the AMF includes a Message
Priority header to indicate priority information. The SMF uses the Message
Priority header to determine if the UE request is subject to exemption from
NAS level congestion control. Other NFs relay the priority information by
including the Message Priority header in service-based interfaces, as
specified in TS 29.500 [17].
In the local breakout case, if the SMF (in the VPLMN) is not able to process
some part of the N1 SM information that Home Routed Roaming is required and
the SMF responds to the AMF that it is not the right SMF to handle the N1 SM
message by invoking Nsmf_PDUSession_CreateSMContext Response service
operation. The SMF includes a proper N11 cause code triggering the AMF to
proceed with home routed case. The procedure starts again at step 2 of clause
4.3.2.2.2.
In the non-roaming case, for PDU Session with Request Type \"initial
request\", the AMF checks if the PCF Selection Assistance info from the UDM
indicates that the same PCF is required for the requested DNN and S-NSSAI and
if required, the AMF includes in Nsmf_PDUSession_CreateSMContext Request both
the Same PCF Selection Indication and the PCF ID selected by the AMF, this PCF
ID identifies the H-PCF,
If PCF Selection Assistance info is not received from the UDM, the AMF may
include a PCF ID in the Nsmf_PDUSession_CreateSMContext Request based on
operator policies. This PCF ID identifies the H-PCF in the non-roaming case
and the V-PCF in the local breakout roaming case.
The AMF includes Trace Requirements if Trace Requirements have been received
in subscription data.
If the AMF decides to use the Control Plane CIoT 5GS Optimisation or User
Plane CIoT 5GS Optimisation as specified in step 2 or to only use Control
Plane CIoT 5GS Optimisation for the PDU session as described in clause 5.31.4
of TS 23.501 [2], the AMF sends the Control Plane CIoT 5GS Optimisation
indication or Control Plane Only indicator to the SMF.
If the AMF determines that the RAT type is NB-IoT and the number of PDU
Sessions with user plane resources activated for the UE has reached the
maximum number of supported user plane resources (0, 1 or 2) based on whether
the UE supports UP data transfer and the UE\'s 5GMM Core Network Capability as
described in Clause 5.31.19 of TS 23.501 [2], the AMF may either reject the
PDU Session Establishment Request or continue with the PDU Session
establishment and include the Control Plane CIoT 5GS Optimisation indication
or Control Plane Only indicator to the SMF.
The AMF includes the latest Small Data Rate Control Status if it has stored it
for the PDU Session.
If the RAT type was included in the message, then the SMF stores the RAT type
in SM Context.
If the UE supports CE mode B and use of CE mode B is not restricted according
to the Enhanced Coverage Restriction information in the UE context in the AMF,
then the AMF shall include the extended NAS-SM timer indication. Based on the
extended NAS-SM timer indication, the SMF shall use the extended NAS-SM timer
setting for the UE as specified in TS 24.501 [25].
If the identity of an NWDAF is available to the AMF, the AMF informs the SMF
of the NWDAF ID(s) used for UE related Analytics and corresponding Analytics
ID(s).
If the AMF, based on configuration, is aware that the UE is accessing over a
gNB using satellite backhaul as defined in clause 5.43.4 of TS 23.501 [2], the
AMF determines the type of satellite backhaul category and includes Satellite
backhaul category to the SMF.
If the AMF, based on configuration, is aware that the UE is accessing over a
gNB using GEO satellite backhaul, the AMF may, based on configuration, include
the GEO satellite ID as described in clause 5.43.2 of TS 23.501 [2].
The AMF may provide the Disaster Roaming service indication as specified in TS
23.501 [2].
4\. If Session Management Subscription data for corresponding SUPI, DNN and
S-NSSAI of the HPLMN is not available, then SMF retrieves the Session
Management Subscription data using Nudm_SDM_Get (SUPI, Session Management
Subscription data, selected DNN, S-NSSAI of the HPLMN, Serving PLMN ID, [NID])
and subscribes to be notified when this subscription data is modified using
Nudm_SDM_Subscribe (SUPI, Session Management Subscription data, selected DNN,
S-NSSAI of the HPLMN, Serving PLMN ID, [NID]). UDM may get this information
from UDR by Nudr_DM_Query (SUPI, Subscription Data, Session Management
Subscription data, selected DNN, S-NSSAI of the HPLMN, Serving PLMN ID, [NID])
and may subscribe to notifications from UDR for the same data by
Nudr_DM_subscribe. If a S-NSSAI is subject to network slice usage control and
the S-NSSAI is dedicated to a single AF, for a PDU Session for non-roaming
subscribers, the UDM may provide a Slice Usage Policy information including
whether a network slice is on demand and a PDU Session inactivity timer value
as described in clause 5.15.15 of TS 23.501 [2].
The SMF may use DNN Selection Mode when deciding whether to retrieve the
Session Management Subscription data e.g. if the (selected DNN, S-NSSAI of the
HPLMN) is not explicitly subscribed, the SMF may use local configuration
instead of Session Management Subscription data.
If the Request Type in step 3 indicates \"Existing PDU Session\" or \"Existing
Emergency PDU Session\" the SMF determines that the request is due to
switching between 3GPP access and non-3GPP access or due to handover from EPS.
The SMF identifies the existing PDU Session based on the PDU Session ID. In
such a case, the SMF does not create a new SM context but instead updates the
existing SM context and provides the representation of the updated SM context
to the AMF in the response.
If the Request Type is \"Initial request\" and if the Old PDU Session ID is
included in Nsmf_PDUSession_CreateSMContext Request, the SMF identifies the
existing PDU Session to be released based on the Old PDU Session ID.
Subscription data includes the Allowed PDU Session Type(s), Allowed SSC
mode(s), default 5QI and ARP, subscribed Session-AMBR, SMF-Associated external
parameters.
IP Index or Static IP address/prefix may be included in the subscription data
if the UE has subscribed to it.
The SMF checks the validity of the UE request: it checks:
\- Whether the UE request is compliant with the user subscription and with
local policies;
\- (If the selected DNN corresponds to an LADN), whether the UE is located
within the LADN service area based on the \"UE presence in LADN service area\"
indication from the AMF. If the AMF does not provide the \"UE presence in LADN
service area\" indication and the SMF determines that the selected DNN
corresponds to a LADN, then the SMF considers that the UE is OUT of the LADN
service area.
The SMF determines whether the PDU Session requires redundancy and the SMF
determines the RSN as described in clause 5.33.2.1 of TS 23.501 [2]. If the
SMF determines that redundant handling is not allowed or not possible for the
given PDU Session, the SMF shall either reject the establishment of the PDU
Session or accept the establishment of a PDU session without redundancy
handling based on local policy.
If the UE request is considered as not valid, the SMF decides to not accept to
establish the PDU Session.
NOTE 3: The SMF can, instead of the Nudm_SDM_Get service operation, use the
Nudm_SDM_Subscribe service operation with an Immediate Report Indication that
triggers the UDM to immediately return the subscribed data if the
corresponding feature is supported by both the SMF and the UDM.
For a Disaster Roaming service, the UDM provides the Session Management
Subscription data to the SMF based on the local policy and/or the local
configuration as specified in clause 5.40.4 of TS 23.501 [2].
For an S-NSSAI subject to NSAC and if LBO applies, the SMF in supporting VPLMN
stores the applicable NSAC admission mode.
5\. From SMF to AMF: Either Nsmf_PDUSession_CreateSMContext Response (Cause,
SM Context ID or N1 SM container (PDU Session Reject (Cause))) or an
Nsmf_PDUSession_UpdateSMContext Response depending on the request received in
step 3.
If the SMF received Nsmf_PDUSession_CreateSMContext Request in step 3 and the
SMF is able to process the PDU Session establishment request, the SMF creates
an SM context and responds to the AMF by providing an SM Context ID.
If the UP Security Policy for the PDU Session is determined to have Integrity
Protection set to \"Required\", the SMF may, based on local configuration,
decide whether to accept or reject the PDU Session request based on the UE
Integrity Protection Maximum Data Rate.
NOTE 4: The SMF can e.g. be configured to reject a PDU Session if the UE
Integrity Protection Maximum Data Rate has a very low value, if the services
provided by the DN would require higher bitrates.
When the SMF decides to not accept to establish a PDU Session, the SMF rejects
the UE request via NAS SM signalling including a relevant SM rejection cause
by responding to the AMF with Nsmf_PDUSession_CreateSMContext Response. The
SMF also indicates to the AMF that the PDU Session ID is to be considered as
released, the SMF proceeds to step 20 and the PDU Session Establishment
procedure is stopped.
6\. Optional Secondary authentication/authorization.
If the Request Type in step 3 indicates \"Existing PDU Session\", the SMF does
not perform secondary authentication/authorization.
If the Request Type received in step 3 indicates \"Emergency Request\" or
\"Existing Emergency PDU Session\", the SMF shall not perform secondary
authentication\authorization.
If the SMF needs to perform secondary authentication/authorization during the
establishment of the PDU Session by a DN-AAA Server as described in clause
5.6.6 of TS 23.501 [2], the SMF triggers the PDU Session establishment
authentication/authorization as described in clause 4.3.2.3.
7a. If dynamic PCC is to be used for the PDU Session, the SMF performs PCF
selection as described in clause 6.3.7.1 of TS 23.501 [2]. If the Request Type
indicates \"Existing PDU Session\" or \"Existing Emergency PDU Session\", the
SMF shall use the PCF already selected for the PDU Session.
Otherwise, the SMF may apply local policy.
7b. The SMF may perform an SM Policy Association Establishment procedure as
defined in clause 4.16.4 to establish an SM Policy Association with the PCF
and get the default PCC Rules for the PDU Session. The SMF shall include the
3GPP Data Off status if received in step 1. The GPSI, PVS FQDN(s) and/or PVS
IP address(es) and the Onboarding Indication shall be included if available at
SMF in the case of ON-SNPN. If the Request Type in step 3 indicates \"Existing
PDU Session\", the SMF provides information on the Policy Control Request
Trigger condition(s) that have been met by an SMF initiated SM Policy
Association Modification procedure as defined in clause 4.16.5.1. The PCF may
provide policy information defined in clause 5.2.5.4 (and in TS 23.503 [20])
to SMF. The URSP rule enforcement in step 1 may be included if SMF receives
the URSP rule enforcement from UE as described in clause 6.6.2.4 of TS 23.503
[20].
The PCF for the UE subscribes to notifications of event \"UE reporting
Connection Capabilities from associated URSP rule\" as defined in clause
6.1.3.18 in TS 23.503 [20], using Npcf_PolicyAuthorization_Subscribe (EventId
set to \"UE reporting Connection Capabilities from associated URSP rule\",
EventFilter set to at least \"list of Connection Capabilities\") to the PCF
for the PDU Session. The PCF for session may notify the PCF for UE about the
URSP rule enforcement together with the PDU session parameters that this
application associated with by Npcf_PolicyAuthorization_Notify.
During the SM Policy Association Establishment procedure, if the PCF detects
the request relates to SM Policy Association enabling integration with TSN or
TSC or Deterministic Networking (as defined in TS 23.501 [2] clause 5.28)
based on local configuration, the PCF may provide policy control request
trigger for 5GS Bridge/Router Information as defined in clause 6.1.3.5 of TS
23.503 [20].
The PCF, based on the Emergency DNN, sets the ARP of the PCC rules to a value
that is reserved for Emergency services as described in TS 23.503 [20].
NOTE 5: The purpose of step 7 is to receive PCC rules before selecting UPF. If
PCC rules are not needed as input for UPF selection, step 7 can be performed
after step 8.
\- During the SM Policy Association Establishment procedure for a non-roaming
PDU Session, if a S-NSSAI is subject to network slice usage control, the PCF
may provide a Slice Usage Policy information including whether a network slice
is on demand and a PDU Session inactivity timer value as described in clause
5.15.15 of TS 23.501 [2].
8\. If the Request Type in step 3 indicates \"Initial request\", the SMF
selects an SSC mode for the PDU Session as described in clause 5.6.9.3 of TS
23.501 [2]. The SMF also selects one or more UPFs as needed as described in
clause 6.3.3 of TS 23.501 [2]. In the case of PDU Session Type IPv4 or IPv6 or
IPv4v6, the SMF allocates an IP address/prefix for the PDU Session (unless
configured otherwise) as described in clause 5.8.2 of TS 23.501 [2]. In the
case of PDU Session Type IPv6 or IPv4v6, the SMF also allocates an interface
identifier to the UE for the UE to build its link-local address. For
Unstructured PDU Session Type the SMF may allocate an IPv6 prefix for the PDU
Session and N6 point-to-point tunnelling (based on UDP/IPv6) as described in
clause 5.6.10.3 of TS 23.501 [2]. For Ethernet PDU Session Type, neither a MAC
nor an IP address is allocated by the SMF to the UE for this PDU Session.
If the AMF indicated Control Plane CIoT 5GS Optimisation in step 3 for this
PDU session, then,
1) For Unstructured PDU Session Type, the SMF checks whether UE\'s
subscription include a \"NEF Identity for NIDD\" for the DNN/S-NSSAI
combination. When the \"NEF Identity for NIDD\" is present in the UE\'s
subscription data, the SMF will select the NEF identified for the S-NSSAI and
selected DNN in the \"NEF Identity for NIDD\" as the anchor of this PDU
Session. Otherwise, the SMF will select a UPF as the anchor of this PDU
Session.
2) For other PDU Session Types, the SMF will perform UPF selection to select a
UPF as the anchor of this PDU Session.
If the Request Type in Step 3 is \"Existing PDU Session\", the SMF maintains
the same IP address/prefix that has already been allocated to the UE in the
source network.
If the Request Type in step 3 indicates \"Existing PDU Session\" referring to
an existing PDU Session moved between 3GPP access and non-3GPP access the SMF
maintains the SSC mode of the PDU Session, the current PDU Session Anchor and
IP address.
NOTE 6: The SMF may decide to trigger e.g. new intermediate UPF insertion or
allocation of a new UPF as described in step 5 in clause 4.2.3.2.
If the Request Type indicates \"Emergency Request\", the SMF selects the UPF
as described in clause 5.16.4 of TS 23.501 [2] and selects SSC mode 1.
SMF may select a UPF (e.g. based on requested DNN/S-NSSAI) that supports NW-TT
functionality.
SMF may select a PSA UPF that supports PDU Set identification and marking for
a QoS flow with PDU Set based handling capability.
9\. SMF may perform an SMF initiated SM Policy Association Modification
procedure as defined in clause 4.16.5.1 to provide information on the Policy
Control Request Trigger condition(s) that have been met. If Request Type is
\"initial request\" and dynamic PCC is deployed and PDU Session Type is IPv4
or IPv6 or IPv4v6, SMF notifies the PCF (if the Policy Control Request Trigger
condition is met) with the allocated UE IP address/prefix(es).
NOTE 7: If an IP address/prefix has been allocated before step 7 (e.g.
subscribed static IP address/prefix in UDM/UDR) or the step 7 is performed
after step 8, the IP address/prefix can be provided to PCF in step 7 and the
IP address/prefix notification in this step can be skipped.
PCF may provide updated policies to the SMF. The PCF may provide policy
information defined in clause 5.2.5.4 (and in TS 23.503 [20]) to SMF.
The PCF for PDU Session may generate PCC rule based on the URSP rule (e.g.:
Connection Capability) referring to the clause 6.1.6 in TS 23.503 [20].
NOTE 8: Mapping between Connection Capability and SDF templates in the PCC
rule is implementation specific.
10\. If Request Type indicates \"initial request\", the SMF initiates an N4
Session Establishment procedure with the selected UPF(s), otherwise it
initiates an N4 Session Modification procedure with the selected UPF(s):
10a. The SMF sends an N4 Session Establishment/Modification Request to the UPF
and provides Packet detection, enforcement and reporting rules to be installed
on the UPF for this PDU Session. If the SMF is configured to request IP
address allocation from UPF as described in clause 5.8.2 of TS 23.501 [2] then
the SMF indicates to the UPF to perform the IP address/prefix allocation and
includes the information required for the UPF to perform the allocation. If
the selective User Plane deactivation is required for this PDU Session, the
SMF determines the inactivity timer and provides it to the UPF. For a PDU
Session for non-roaming subscribers, if the S-NSSAI of the PDU Session is
subject to network slice usage control, the SMF obtains the PDU Session
inactivity timer value for the PDU Session as described in step 4 or step 7 or
uses preconfigured value and configures the UPF to run the PDU Session
inactivity timer. The SMF provides Trace Requirements to the UPF if it has
received Trace Requirements. If the Reliable Data Service is enabled for the
PDU Session by the SMF as specified in TS 23.501 [2], the RDS Configuration
information is provided to the UPF in this step. The SMF provides Small Data
Rate Control parameters to the UPF for the PDU Session, if required. The SMF
provides the Small Data Rate Control Status to the UPF, if received from the
AMF. If the Serving PLMN intends to enforce Serving PLMN Rate Control (see
clause 5.31.14.2 of TS 23.501 [2]) for this PDU session then the SMF shall
provide Serving PLMN Rate Control parameters to UPF for limiting the rate of
downlink control plane data packets.
For a PDU Session of type Ethernet or IP, the SMF (e.g. for a certain
requested DNN/S-NSSAI for which Time Sensitive Networking, Time Sensitive
Communications, Time Synchronization and Deterministic Networking is
applicable) may include an indication to request UPF to provide a port number.
If SMF decides to perform redundant transmission for one or more QoS Flows of
the PDU session as described in clause 5.33.1.2 of TS 23.501 [2], two CN
Tunnel Info are requested by the SMF from the UPF. The SMF also indicates the
UPF to eliminate the duplicated packet for the QoS Flow in uplink direction.
The SMF indicates the UPF that one CN Tunnel Info is used as the redundancy
tunnel of the PDU session described in clause 5.33.2.2 of TS 23.501 [2].
If SMF decides to insert two I-UPFs between the PSA UPF and the NG-RAN for
redundant transmission as described in clause 5.33.1.2 of TS 23.501 [2], the
SMF requests the corresponding CN Tunnel Info and provides them to the I-UPFs
and PSA UPF respectively. The SMF also indicates the PSA UPF to eliminate the
duplicated packet for the QoS Flow in uplink direction. The SMF indicates the
PSA UPF that one CN Tunnel Info is used as the redundancy tunnel of the PDU
session described in clause 5.33.2.2 of TS 23.501 [2].
NOTE 9: The method to perform elimination and reordering on RAN/UPF based on
the packets received from the two GTP-U tunnels is up to RAN/UPF
implementation. The two GTP-U tunnels are terminated at the same RAN node and
UPF.
If Control Plane CIoT 5GS Optimisation is enabled for this PDU session and the
SMF selects the NEF as the anchor of this PDU Session in step 8, the SMF
performs SMF-NEF Connection Establishment Procedure as described in clause
4.25.2.
If interworking with TSN deployed in the transport network is supported (see
clause 4.4.8 of TS 23.501 [2]), the SMF includes a TL-Container with a get-
request to the N4 Session Establishment or Modification request that is sent
to the UPF, as described in clause 5.28a.2 of TS 23.501 [2].
If SMF decides to enable ECN marking for L4S by PSA UPF, a QoS Flow level ECN
marking for L4S indicator shall be sent by SMF to PSA UPF over N4 as described
in clause 5.37.3.3 of TS 23.501 [2].
10b. The UPF acknowledges by sending an N4 Session Establishment/Modification
Response.
If the SMF indicates in step 10a that IP address/prefix allocation is to be
performed by the UPF then this response contains the requested IP
address/prefix. The requested CN Tunnel Info is provided to SMF in this step.
If SMF indicated the UPF to perform packet duplication and elimination for the
QoS Flow in step 10a, two CN Tunnel Info are allocated by the UPF and provided
to the SMF. If SMF decides to insert two I-UPFs between the PSA UPF and the
NG-RAN for redundant transmission as described in clause 5.33.1.2 of TS 23.501
[2], CN Tunnel Info of two I-UPFs and the UPF (PSA) are allocated by the UPFs
and provided to the SMF. The UPF indicates the SMF that one CN Tunnel Info is
used as the redundancy tunnel of the PDU session as described in clause
5.33.2.2 of TS 23.501 [2].
If SMF requested UPF to provide a port number then UPF includes the port
number and user-plane Node ID in the response according to TS 23.501 [2]. To
support integration with IEEE TSN, the user-plane node ID is Bridge ID.
Besides the network instance, the SMF may also provide DNN/S-NSSAI for the UPF
to respond with user-plane Node ID based on pre-configuration information.
If multiple UPFs are selected for the PDU Session, the SMF initiate N4 Session
Establishment/Modification procedure with each UPF of the PDU Session in this
step.
NOTE 10: If the PCF has subscribed to the UE IP address change Policy Control
Trigger (as specified in clause 6.1.3.5 of TS 23.503 [20]) then the SMF
notifies the PCF about the IP address/prefix allocated by the UPF. This is not
shown in figure 4.3.2.2.1-1.
If interworking with TSN deployed in the transport network is supported and
the UPF supports CN-TL and received a TL-Container with a get-request from the
SMF/CUC in step 10a (see clause 4.4.8 of TS 23.501 [2]), the UPF/CN-TL
includes a TL-Container with a get-response in the N4 Session Establishment or
Modification response, as described in clause 5.28a.2 of TS 23.501 [2]. The
SMF/CUC stores the get-response.
11\. SMF to AMF: Namf_Communication_N1N2MessageTransfer (PDU Session ID, N2 SM
information (PDU Session ID, QFI(s), QoS Profile(s), CN Tunnel Info, S-NSSAI
from the Allowed NSSAI or Partially Allowed NSSAI, Session-AMBR, PDU Session
Type, User Plane Security Enforcement information, UE Integrity Protection
Maximum Data Rate, RSN, PDU Session Pair ID, TL-Container), N1 SM container
(PDU Session Establishment Accept ([QoS Rule(s) and QoS Flow level QoS
parameters if needed for the QoS Flow(s) associated with the QoS rule(s)],
selected SSC mode, S-NSSAI(s), UE Requested DNN, allocated IPv4 address,
interface identifier, Session-AMBR, selected PDU Session Type, [Reflective QoS
Timer] (if available), [P-CSCF address(es)], [Control Plane Only indicator],
[Header Compression Configuration], [Always-on PDU Session Granted], [Small
Data Rate Control parameters], [Small Data Rate Control Status], [Serving PLMN
Rate Control], [PVS FQDN(s) and/or PVS IP address(es)], [Non-3GPP QoS
Assistance Information Container]))). If multiple UPFs are used for the PDU
Session, the CN Tunnel Info contains tunnel information related with the UPFs
that terminate N3.
The SMF may provide the SMF derived CN assisted RAN parameters tuning to the
AMF by invoking Nsmf_PDUSession_SMContextStatusNotify (SMF derived CN assisted
RAN parameters tuning) service. The AMF stores the SMF derived CN assisted RAN
parameters tuning in the associated PDU Session context for this UE.
The N2 SM information carries information that the AMF shall forward to the
(R)AN which includes:
\- The CN Tunnel Info corresponds to the Core Network address(es) of the N3
tunnel corresponding to the PDU Session. If two CN Tunnel Info are included
for the PDU session for redundant transmission, the SMF also indicates the NG-
RAN that one of the CN Tunnel Info used as the redundancy tunnel of the PDU
session as described in clause 5.33.2.2 of TS 23.501 [2].
\- One or multiple QoS profiles and the corresponding QFIs can be provided to
the (R)AN. This is further described in clause 5.7 of TS 23.501 [2]. The SMF
may indicate for each QoS Flow whether redundant transmission shall be
performed by a corresponding redundant transmission indicator.
\- The PDU Session ID may be used by AN signalling with the UE to indicate to
the UE the association between (R)AN resources and a PDU Session for the UE.
\- A PDU Session is associated to an S-NSSAI of the HPLMN and if applicable,
to a S-NSSAI of the VPLMN and a DNN. The S-NSSAI provided to the (R)AN, is the
S-NSSAI with the value for the Serving PLMN (i.e. the HPLMN S-NSSAI or, in LBO
roaming case, the VPLMN S-NSSAI). When Alternative S-NSSAI is received from
AMF in step 3, the S-NSSAI provided to the (R)AN is the Alternative S-NSSAI.
\- User Plane Security Enforcement information is determined by the SMF as
described in clause 5.10.3 of TS 23.501 [2].
\- If the User Plane Security Enforcement information indicates that Integrity
Protection is \"Preferred\" or \"Required\", the SMF also includes the UE
Integrity Protection Maximum Data Rate as received in the PDU Session
Establishment Request.
\- The use of the RSN parameter and the PDU Session Pair ID by NG-RAN are
described in clause 5.33.2.1 of TS 23.501 [2].
\- For each QoS Flow:
\- an ECN marking for L4S indicator to (R)AN in the case of ECN marking for
L4S in RAN as described in clause 5.37.3 of TS 23.501 [2]; or
\- a QoS monitoring configuration for congestion information as described in
clause 5.45.3 of TS 23.501 [2] in the case of ECN marking for L4S by PSA UPF
as described in clause 5.37.3 of TS 23.501 [2] or QoS monitoring for
congestion information as described in clause 5.45.3 of TS 23.501 [2].
\- TL-Container as described in clause 5.28a.2 of TS 23.501 [2]. If
interworking with TSN deployed in the transport network is supported (see
clause 4.4.8 of TS 23.501 [2]), the SMF includes a TL-Container with a get-
request to the N2 SM information, as described in clause 5.28a.2 of TS 23.501
[2].
The N1 SM container contains the PDU Session Establishment Accept that the AMF
shall provide to the UE. If the UE requested P-CSCF discovery then the message
shall also include the P-CSCF IP address(es) as determined by the SMF and as
described in clause 5.16.3.4 of TS 23.501 [2]. The PDU Session Establishment
Accept includes S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI. The
S-NSSAI value of the Alternative S-NSSAI is included in the PDU session
Establishment Accept if the SMF has received the Alternative S-NSSAI from the
AMF. For LBO roaming scenario, the PDU Session Establishment Accept includes
the S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI for the VPLMN
and also it includes the corresponding S-NSSAI of the HPLMN from the Mapping
Of Allowed NSSAI or Mapping Of Partially Allowed NSSAI that SMF received in
step 3. If the SMF has received the VPLMN Alternative S-NSSAI from the AMF,
the PDU Session Establishment Accept includes the VPLMN Alternative S-NSSAI.
If the SMF has received the HPLMN Alternative S-NSSAI from the AMF, the PDU
Session Establishment Accept includes the HPLMN Alternative S-NSSAI.
If the PDU Session being established was requested to be an always-on PDU
Session, the SMF shall indicate whether the request is accepted by including
an Always-on PDU Session Granted indication in the PDU Session Establishment
Accept message. If the PDU Session being established was not requested to be
an always-on PDU Session but the SMF determines that the PDU Session needs to
be established as an always-on PDU Session, the SMF shall include an Always-on
PDU Session Granted indication in the PDU Session Establishment Accept message
indicating that the PDU session is an always-on PDU Session.
If Control Plane CIoT 5GS Optimisation is enabled for this PDU session, the N2
SM information is not included in this step. If Control Plane CIoT 5GS
optimisation is enabled for this PDU session and the UE has sent the Header
Compression Configuration in the PDU Session Establishment Request and the SMF
supports the header compression parameters, the SMF shall include the Header
Compression Configuration in the PDU Session Establishment Accept message. If
the UE has included Header Compression context parameters in Header
Compression Configuration in the PDU Session Establishment Request, the SMF
shall establish the header compression context and may acknowledge the Header
Compression context parameters. If the header compression context is not
established during the PDU Session Establishment procedure, before using the
compressed format for sending the data, the UE and the SMF need to establish
the header compression context based on the Header Compression Configuration.
If the SMF has received the Control Plane Only Indicator in step 3, the SMF
shall include the Control Plane Only Indicator in the PDU Session
Establishment Accept message. The SMF shall indicate the use of Control Plane
only on its CDR. If the Small Data Rate Control is configured in the SMF, the
SMF shall also include Small Data Rate Control parameters and the Small Data
Rate Control Status (if received from the AMF) in the PDU Session
Establishment Accept message as described in clause 5.31.14.3 of TS 23.501
[2]. If the Serving PLMN intends to enforce Serving PLMN Rate Control (see
clause 5.31.14.2 of TS 23.501 [2]) for this PDU session then the SMF shall
include the Serving PLMN Rate Control parameters in the PDU Session
Establishment Accept message. The UE shall store and use Serving PLMN Rate
Control parameters as the maximum allowed limit of uplink control plane user
data.
If the UE indicates the support of RDS in the PCO in the PDU Session
Establishment Request and RDS is enabled for the PDU Session, the SMF shall
inform the UE that RDS is enabled in the PCO in the PDU Session Establishment
Accept (see clause 5.31.6 of TS 23.501 [2]).
If the NIDD parameters (e.g. maximum packet size) were received from NEF
during the SMF-NEF Connection Establishment procedure in step 10, the SMF
shall inform the UE of the NIDD parameters in the PCO in the PDU Session
Establishment Accept (see clause 5.31.5 of TS 23.501 [2]).
If the UE indicated in the PCO that it supports the ability to receive ECS
address(es) via NAS, the SMF may provide the ECS Address Configuration
Information (as described in clause 6.5.2 of TS 23.548 [74]) to the UE in the
PCO. The SMF may derive the ECS Address Configuration Information based on
local configuration and/or UE subscription information. In non-roaming
scenarios, the SMF may also derive the ECS Address Configuration Information
based on the UE\'s location.
If the UE indicated in the PCO that it supports the EDC functionality, the SMF
may indicate to the UE either that the use of the EDC functionality is allowed
for the PDU Session or that the use of the EDC functionality is required for
the PDU Session (see clause 5.2.1 of TS 23.548 [74]).
Multiple QoS Rules, QoS Flow level QoS parameters if needed for the QoS
Flow(s) associated with those QoS rule(s) and QoS Profiles may be included in
the PDU Session Establishment Accept within the N1 SM and in the N2 SM
information.
The Namf_Communication_N1N2MessageTransfer contains the PDU Session ID
allowing the AMF to know which access towards the UE to use.
If the PDU session establishment failed anywhere between step 5 and step 11,
then the Namf_Communication_N1N2MessageTransfer request shall include the N1
SM container with a PDU Session Establishment Reject message (see clause 8.3.3
of TS 24.501 [25]) and shall not include any N2 SM container. The (R)AN sends
the NAS message containing the PDU Session Establishment Reject to the UE. In
this case, steps 12-17 are skipped.
\- Based on S-NSSAI/DNN, the SMF may provide the UE with per QoS-flow Non-3GPP
QoS Assistance Information in the N1 SM container as specified in clause
5.44.3.3 of TS 23.501 [2].
12\. AMF to (R)AN: N2 PDU Session Request (N2 SM information, NAS message (PDU
Session ID, N1 SM container (PDU Session Establishment Accept)), [CN assisted
RAN parameters tuning]). If the N2 SM information is not included in the step
11, an N2 Downlink NAS Transport message is used instead.
The AMF sends the NAS message containing PDU Session ID and PDU Session
Establishment Accept targeted to the UE and the N2 SM information received
from the SMF within the N2 PDU Session Request to the (R)AN.
If the SMF derived CN assisted RAN parameters tuning are stored for the
activated PDU Session(s), the AMF may derive updated CN assisted RAN
parameters tuning and provide them the (R)AN.
13\. (R)AN to UE: The (R)AN may issue AN specific signalling exchange with the
UE that is related with the information received from SMF. For example, in the
case of a NG-RAN, an RRC Connection Reconfiguration may take place with the UE
establishing the necessary NG-RAN resources related to the QoS Rules for the
PDU Session request received in step 12.
(R)AN also allocates (R)AN Tunnel Info for the PDU Session. In the case of
Dual Connectivity, the Master RAN node may assign some (zero or more) QFIs to
be setup to a Master RAN node and others to the Secondary RAN node. The AN
Tunnel Info includes a tunnel endpoint for each involved (R)AN node and the
QFIs assigned to each tunnel endpoint. A QFI can be assigned to either the
Master RAN node or the Secondary RAN node and not to both.
If the (R)AN receives two CN Tunnel Info for a PDU session in step 12 for
redundant transmission, (R)AN also allocates two AN Tunnel Info
correspondingly and indicate to SMF one of the AN Tunnel Info is used as the
redundancy tunnel of the PDU session as described in clause 5.33.2.2 of TS
23.501 [2].
(R)AN forwards the NAS message (PDU Session ID, N1 SM container (PDU Session
Establishment Accept)) provided in step 12 to the UE. (R)AN shall only provide
the NAS message to the UE if the AN specific signalling exchange with the UE
includes the (R)AN resource additions associated to the received N2 command.
If MICO mode is active and the NAS message Request Type in step 1 indicated
\"Emergency Request\", then the UE and the AMF shall locally deactivate MICO
mode.
If the N2 SM information is not included in the step 11, then the following
steps 14 to 16b and step 17 are omitted.
If the AMF is running a slice deregistration inactivity timer for the S-NSSAI
PDU Session, the AMF stops the timer as described in clause 5.15.15 of TS
23.501 [2].
If the UE is running a slice deregistration inactivity timer for the S-NSSAI
of the established PDU Session, the UE stops the timer as described in clause
5.15.15 of TS 23.501 [2].
14\. (R)AN to AMF: N2 PDU Session Response (PDU Session ID, Cause, N2 SM
information (PDU Session ID, AN Tunnel Info, List of accepted/rejected QFI(s),
User Plane Enforcement Policy Notification, TL-Container, established QoS
Flows status (active/not active) for QoS monitoring configuration for
congestion information, established QoS Flows status (active/not active) for
ECN marking for L4S, PDU Set Based Handling Support Indication)).
The AN Tunnel Info corresponds to the Access Network address of the N3 tunnel
corresponding to the PDU Session.
The (R)AN may reject the addition or modification of a QoS Flow, e.g. due to
handling of the UE-Slice-MBR as described in clause 5.7.1.10 of TS 23.501 [2].
If the (R)AN rejects QFI(s) the SMF is responsible of updating the QoS rules
and QoS Flow level QoS parameters associated to the rejected QoS Flow(s) in
the UE accordingly.
The NG-RAN rejects the establishment of UP resources for the PDU Session when
it cannot fulfil User Plane Security Enforcement information with a value of
Required. The NG-RAN notifies the SMF when it cannot fulfil a User Plane
Security Enforcement with a value of Preferred.
If the NG-RAN cannot establish redundant user plane for the PDU Session as
indicated by the RSN parameter and PDU Session Pair ID, the NG-RAN takes the
decision on whether to reject the establishment of RAN resources for the PDU
Session based on local policies as described in TS 23.501 [2].
If interworking with TSN deployed in the transport network is supported and
the NG-RAN supports AN-TL and received a TL-Container with a get-request from
the SMF/CUC in step 12 (see clause 4.4.8 of TS 23.501 [2]), the NG-RAN/AN-TL
includes a TL-Container with a get-response to the N2 SM information, as
described in clause 5.28a.2 of TS 23.501 [2].
NG-RAN includes the PDU Set Based Handling Support Indication in N2 SM
information as defined in clause 5.37.5.3 of TS 23.501 [2].
15\. AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (SM Context ID, N2 SM
information, Request Type).
The AMF forwards the N2 SM information received from (R)AN to the SMF.
If the list of rejected QFI(s) is included in N2 SM information, the SMF shall
release the rejected QFI(s) associated QoS profiles.
If the N2 SM information indicates failure of user plane resource setup, the
SMF shall reject the PDU session establishment by including a N1 SM container
with a PDU Session Establishment Reject message (see clause 8.3.3 of TS 24.501
[25]) in the Nsmf_PDUSession_UpdateSMContext Response in step 17. Step 16 is
skipped in this case and instead the SMF releases the N4 Session with UPF.
If the User Plane Enforcement Policy Notification in the N2 SM information
indicates that no user plane resources could be established and the User Plane
Enforcement Policy indicated \"required\" as described in clause 5.10.3 of TS
23.501 [2], the SMF shall reject the PDU session establishment by including a
N1 SM container with a PDU Session Establishment Reject message (see clause
8.3.3 of TS 24.501 [25]) in the Nsmf_PDUSession_UpdateSMContext Response in
step 17. Step 16 is skipped in this case.
If the N2 SM information includes a TL-Container with a get-response as
described in clause 5.28a.2 of TS 23.501 [2], the SMF/CUC stores the get-
response.
16a. The SMF initiates an N4 Session Modification procedure with the UPF. The
SMF provides AN Tunnel Info to the UPF as well as the corresponding forwarding
rules.
If SMF decides to perform redundant transmission for one or more QoS Flows of
the PDU, the SMF also indicates the UPF to perform packet duplication for the
QoS Flow(s) in downlink direction by forwarding rules.
In the case of redundant transmission with two I-UPFs for one or more QoS
Flows of the PDU, the SMF provides AN Tunnel Info to two I-UPFs and also
indicates the UPF (PSA) to perform packet duplication for the QoS Flow(s) in
downlink direction by forwarding rules. The SMF also provides the UL Tunnel
Info of the UPF (PSA) to the two I-UPFs and the DL Tunnel Info of the two
I-UPFs to the UPF (PSA).
If the N2 SM information includes the PDU Set Based Handling Support
Indication, SMF configures PSA UPF to perform PDU Set information marking for
the QoS flow as defined in clause 5.37.5.3 of TS 23.501 [2].
NOTE 11: If the PDU Session Establishment Request was due to mobility between
3GPP and non-3GPP access or mobility from EPC, the downlink data path is
switched towards the target access in this step.
16b. The UPF provides an N4 Session Modification Response to the SMF.
If multiple UPFs are used in the PDU Session, the UPF in step 16 refers to the
UPF terminating N3.
After this step, the UPF delivers any down-link packets to the UE that may
have been buffered for this PDU Session.
16c. If Request Type in step 3 indicates neither \"Emergency Request\" nor
\"Existing Emergency PDU Session\" and if the SMF has not yet registered for
this PDU Session, then the SMF registers with the UDM using
Nudm_UECM_Registration (SUPI, DNN, S-NSSAI of HPLMN, PDU Session ID, SMF
Identity, Serving Node PLMN ID, [NID]) for a given PDU Session. As a result,
the UDM stores following information: SUPI, SMF identity and the associated
DNN, S-NSSAI of HPLMN, PDU Session ID and Serving Network (PLMN ID, [NID], see
clause 5.18 of TS 23.501 [2]). The UDM may further store this information in
UDR by Nudr_DM_Update (SUPI, Subscription Data, UE context in SMF data). If
the UDM has existing applicable event exposure subscriptions for events
detected in SMF for this UE or any of the groups this UE belongs to (possibly
retrieved from UDR), UDM invokes the Nsmf_EventExposure_Subscribe service for
creating the event exposure subscriptions.
If the Request Type received in step 3 indicates \"Emergency Request\":
\- For an authenticated non-roaming UE, based on operator configuration (e.g.
related with whether the operator uses a fixed SMF for Emergency calls, etc.),
the SMF may register in the UDM using Nudm_UECM_Registration (SUPI, PDU
Session ID, SMF identity, Indication of Emergency Services) for a given PDU
Session that is applicable for emergency services. As a result, the UDM shall
store the applicable PDU Session for Emergency services.
\- For an unauthenticated UE or a roaming UE, the SMF shall not register in
the UDM for a given PDU Session.
17\. SMF to AMF: Nsmf_PDUSession_UpdateSMContext Response (Cause).
The SMF may subscribe to the UE mobility event notification from the AMF (e.g.
location reporting, UE moving into or out of Area Of Interest), after this
step by invoking Namf_EventExposure_Subscribe service operation as specified
in clause 5.2.2.3.2. For LADN, the SMF subscribes to the UE moving into or out
of LADN service area event _notification by providing the LADN DNN as an
indicator for the Area Of Interest (see clause 5.6.5 and 5.6.11 of TS 23.501
[2])._
_If SMF receives the indication in step 3 that \"the PDU Session is subject to
LADN per LADN DNN and S-NSSAI\", the SMF subscribes to the UE moving into or
out of LADN service area event notification by providing the LADN DNN and
S-NSSAI as an indicator for the Area Of Interest._
After this step, the AMF forwards relevant events subscribed by the SMF.
For those scenarios where the PCFs serving the AMF and the SMF are different,
the SMF informs the AMF of the NWDAF ID(s) used for UE related Analytics and
corresponding Analytics ID(s).
18\. [Conditional] SMF to AMF: Nsmf_PDUSession_SMContextStatusNotify (Release)
If during the procedure, any time after step 5, the PDU Session establishment
is not successful, the SMF informs the AMF by invoking
Nsmf_PDUSession_SMContextStatusNotify (Release). The SMF also releases any N4
session(s) created, any PDU Session address if allocated (e.g. IP address) and
releases the association with PCF, if any. In this case, step 19 is skipped.
For a PDU Session for non-roaming subscribers, if the S-NSSAI of the PDU
Session is subject to network slice usage control and there is no other PDU
Session using the S-NSSAI, the AMF starts the slice deregistration inactivity
timer for the S-NSSAI as described in clause 5.15.15.3 of TS 23.501 [2].
19\. SMF to UE: In the case of PDU Session Type IPv6 or IPv4v6, the SMF
generates an IPv6 Router Advertisement and sends it to the UE. If Control
Plane CIoT 5GS Optimisation is enabled for this PDU Session the SMF sends the
IPv6 Router Advertisement via the AMF for transmission to the UE using the
Mobile Terminated Data Transport in Control Plane CIoT 5GS Optimisation
procedures (see clause 4.24.2), otherwise the SMF sends the IPv6 Router
Advertisement via N4 and the UPF.
20\. When the trigger for 5GS Bridge/Router information available is armed,
then the SMF may initiate the SM Policy Association Modification as described
in clause 4.16.5.1.
If the UE has indicated support of transferring Port Management Information
Containers, then SMF informs PCF that 5GS Bridge/Router information is
available. SMF provides the 5GS Bridge/Router information (e.g. 5GS user-plane
Node ID, port number for the PDU session, MAC address of the DS-TT Ethernet
port for Ethernet PDU Session type, UE IP address for IP PDU Session type and
UE-DS-TT Residence Time (if available) as provided by the UE) to PCF. In the
case of Deterministic Networking, the SMF may also provide the MTU size for
IPv4 or the MTU size for IPv6. If the SMF received a Port Management
Information Container from either the UE or the UPF, then the SMF provides the
Port Management Information Container and port number of the related port to
the PCF as described in clause 5.28.3.2 of TS 23.501 [2].
If the SMF has received User Plane Node Management Information from the UPF,
then the SMF provides the User Plane Node Management Information Container to
the PCF as part of 5GS Bridge/Router information and as described in clause
5.28.3.2 of TS 23.501 [2].
To support IEEE TSN, the TSN AF calculates the bridge delay for each port
pair, i.e. composed of DS-TT Ethernet port and NW-TT Ethernet port, using the
UE-DS-TT Residence Time for all NW-TT Ethernet port(s) serving the 5GS Bridge
indicated by the 5GS user-plane Node ID. Additionally, the TSN AF determines
the 5GS bridge delay for port pair composed of two DS-TT ports connecting to
the same 5GS Bridge as sum of bridge delays related to PDU Sessions of the two
DS-TT ports.
21\. If the PDU Session establishment failed after step 4, the SMF shall
perform the following:
The SMF unsubscribes to the modifications of Session Management Subscription
data for the corresponding (SUPI, DNN, S-NSSAI of the HPLMN), using
Nudm_SDM_Unsubscribe (SUPI, Session Management Subscription data, DNN, S-NSSAI
of the HPLMN), if the SMF is no more handling a PDU Session of the UE for this
(DNN, S-NSSAI of the HPLMN). The UDM may unsubscribe to the modification
notification from UDR by Nudr_DM_Unsubscribe (SUPI, Subscription Data, Session
Management Subscription data, S-NSSAI of the HPLMN, DNN).
##### 4.3.2.2.2 Home-routed Roaming
This procedure is used in the case of home-routed roaming scenarios.
Figure 4.3.2.2.2-1: UE-requested PDU Session Establishment for home-routed
roaming scenarios
1\. This step is the same as step 1 in clause 4.3.2.2.1.
2\. For NR satellite access, the AMF may decide to verify the UE location as
described in clause 5.4.11.4 of TS 23.501 [2].
As in step 2 of clause 4.3.2.2.1 except that, if the UE does not include an
S-NSSAI in the PDU Session request, both a Serving PLMN S-NSSAI (in the
Allowed NSSAI or Partially Allowed NSSAI) and its corresponding HPLMN S-NSSAI
values are selected by the AMF. Also, the AMF in the serving PLMN selects both
an SMF in the Serving PLMN using the S-NSSAI of the Serving PLMN mapping to
the S-NSSAIs of the HPLMN used for the PDU Session and additionally, an SMF in
the HPLMN using the S-NSSAI of the HPLMN used for the PDU Session, as
described in clause 4.3.2.2.3. The AMF may also receive alternative H-SMFs
from the NRF. If Control Plane CIoT 5GS Optimisation is enabled for the PDU
Session, the AMF selects V-SMF and H-SMF that supports the Control Plane CIoT
5GS Optimisation (see clause 6.3.2 of TS 23.501 [2]). The AMF stores the
association of the S-NSSAI(s), the DNN, the PDU Session ID, the SMF ID in
VPLMN as well as Access Type of the PDU Session. Whether to perform DNN
replacement is based on operator agreement.
In step 3 of clause 4.3.2.2.1, in local breakout roaming case, if V-SMF
responds to AMF indicating that V-SMF is not able to process some part of the
N1 SM information, the AMF proceeds with home routed case from this step and
may select an SMF in the VPLMN different from the V-SMF selected earlier.
3a. As in step 3 of clause 4.3.2.2.1 with the addition that:
\- the AMF also provides the identity of the H-SMF it has selected in step 2
and both the VPLMN S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI
and the corresponding S-NSSAI of the HPLMN, which is in the mapping the VPLMN
S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI. The H-SMF is
provided when the PDU Session is home-routed. The AMF may also provide the
identity of alternative H-SMFs, if it has received in step 2. If the AMF
determines to replace the HPLMN S-NSSAI received from the UE with the HPLMN
Alternative S-NSSAI or the AMF receives the HPLMN Alternative S-NSSAI and the
HPLMN S-NSSAI provided by the UE, the AMF selects the H-SMF based on the HPLMN
Alternative S-NSSAI.
\- The V-SMF does not use DNN Selection Mode received from the AMF but relays
this information to the H-SMF.
If the AMF is reusing an already established association with a V-SMF for the
PDU Session ID provided by the UE (e.g. when Request Type indicates \"existing
PDU Session\"), the AMF invokes the Nsmf_PDUSession_UpdateSMContext Request.
The AMF may include the H-PCF ID in this step and V-SMF will pass it to the
H-SMF in step 6. This will enable the H-SMF to select the same H-PCF in step
9a.
If Control Plane CIoT 5GS Optimisation is used for the PDU Session and the
\"Invoke NEF indication\" in the subscription data is set for the S-NSSAI /
DNN combination, the AMF includes an \"Invoke NEF\" flag in
Nsmf_PDUSession_CreateSMContext Request.
If Disaster Roaming service indication is received, the V-SMF stores the
indication in PDU session context and includes the indication in charging
data. V-SMF may also apply policy and charging control based on the indication
according to roaming agreement.
3b: This step is the same as step 5 of clause 4.3.2.2.1. If the PDU Session
Type is Unstructured and the V-SMF received an \"Invoke NEF\" flag in step 3a,
then it skips steps 4 and 5.
4\. The V-SMF selects a UPF in VPLMN as described in clause 6.3.3 of TS 23.501
[2].
5\. The V-SMF initiates an N4 Session Establishment procedure with the
selected V-UPF:
5a. The V-SMF sends an N4 Session Establishment Request to the V-UPF. The
V-SMF provides Trace Requirements to the V-UPF if the V-SMF has received Trace
Requirements from AMF.
5b. The V-UPF acknowledges by sending an N4 Session Establishment Response.
The CN Tunnel Info is provided to V-SMF in this step.
6\. V-SMF to H-SMF: Nsmf_PDUSession_Create Request (SUPI, GPSI (if available),
V-SMF SM Context ID, DNN, S-NSSAI with the value defined by the HPLMN, [HPLMN
Alternative S-NSSAI], PDU Session ID, V-SMF ID, V-CN-Tunnel-Info, PDU Session
Type, PCO, Number Of Packet Filters, User location information, Access Type,
RAT Type, PCF ID, [Small Data Rate Control Status], SM PDU DN Request
Container, DNN Selection Mode, Control Plane CIoT 5GS Optimisation Indication,
[Always-on PDU Session Requested], AMF ID, Serving Network, [ECS Address
Configuration Information asscociated with PLMN ID of visited network], the
QoS constraints from the VPLMN, Satellite backhaul category, Disaster Roaming
service indication) or Nsmf_PDUSession_Update Request (V-CN-Tunnel-Info, PCO,
User location information, Access Type, RAT Type, SM PDU DN Request Container,
Control Plane CIoT 5GS Optimisation Indication, [Always-on PDU Session
Requested], Serving Network, Satellite backhaul category). Protocol
Configuration Options may contain information that H-SMF may needs to properly
establish the PDU Session (e.g. SSC mode or SM PDU DN Request Container to be
used to authenticate the UE by the DN-AAA as defined in clause 4.3.2.3). The
H-SMF may use DNN Selection Mode when deciding whether to accept or reject the
UE request. If the V-SMF does not receive any response from the H-SMF due to
communication failure on the N16 interface, depending on operator policy the
V-SMF may create the PDU Session to one of the alternative H-SMF(s) if
additional H-SMF information is provided in step 3a, as specified in detail in
TS 29.502 [36]. The Small Data Rate Control Status is included if received
from the AMF. The Control Plane CIoT 5GS Optimisation Indication is set by the
V-SMF, if the PDU Session is intended for Control Plane CIoT 5GS Optimisation.
The QoS constraints from the VPLMN are specified in clause 5.7.1.11 of TS
23.501 [2]. The Disaster Roaming service indication is included if the
indication is received from AMF in step 3a above.
NOTE 1: The QoS constraints from the VPLMN are provided by the VPLMN to avoid
the risk that V-SMF rejects the PDU Session in step 13 when controlling SLA
with the HPLMN.
V-SMF SM Context ID contains the addressing information it has allocated for
service operations related with this PDU Session. The H-SMF stores an
association of the PDU Session and V-SMF Context ID for this PDU Session for
this UE.
If the H-SMF needs to use V-SMF services for this PDU Session (invoking
Nsmf_PDUSession_Update Request) before step 13, at the first invocation of
Nsmf_PDUSession_Update Request the H-SMF provides the V-SMF with the H-SMF SM
Context ID it has allocated for service operations related with this PDU
Session.
If the RAT type was included in the message, then the H-SMF stores the RAT
type in SM Context.
ECS Address Configuration Information associated with PLMN ID of visited
network is an optional information that may only be provided when HR-SBO is
supported for roamers of HPLMN.
If the V-SMF has an association with the H-SMF for the indicated PDU Session
ID, the V-SMF invokes Nsmf_PDUSession_Update Request. Otherwise the V-SMF
invokes Nsmf_PDUSession_Create Request.
If the V-SMF receives the HPLMN Alternative S-NSSAI and the HPLMN S-NSSAI from
the AMF, the V-SMF sends both the HPLMN Alternative S-NSSAI and the HPLMN
S-NSSAI to the H-SMF.
7-12b. These steps are the same as steps 4-10 in clause 4.3.2.2.1 with the
following differences:
\- These steps are executed in Home PLMN;
\- If the S-NSSAI of this PDU Session is subject to network slice usage
control, the H-SMF configures the PDU Session inactivity timer in the H-UPF as
described in clause 5.15.15 of TS 23.501 [2]. Otherwise, the H-SMF does not
provides the inactivity timer to the H-UPF as described in step 10a in clause
4.3.2.2.1.
\- If the QoS constraints from the VPLMN is provided in step 6 and PCF is
deployed, the H-SMF provides the QoS constraints from the VPLMN to PCF. The
PCF takes this into account when making policy decisions. In case dynamic PCC
is not deployed, the SMF takes this into account when generating the default
QoS rule.
\- Step 5 of clause 4.3.2.2.1 is not executed.
\- If Disaster Roaming service indication is received, the SMF stores the
indication in PDU session context and includes the indication in charging
data. H-SMF may also apply policy and charging control based on the indication
according to roaming agreement.
When PCF is deployed, the SMF shall further report the PS Data Off status to
PCF if the PS Data Off event trigger is provisioned, the additional behaviour
of SMF and PCF for 3GPP PS Data Off is defined in TS 23.503 [20].
12c. This step is the same as step 16c in clause 4.3.2.2.1 with the following
difference:
\- The H-SMF registers for the PDU Session with the UDM using
Nudm_UECM_Registration (SUPI, DNN, S-NSSAI with the value defined by the
HPLMN, PDU Session ID).
13\. H-SMF to V-SMF: Nsmf_PDUSession_Create Response (QoS Rule(s), QoS Flow
level QoS parameters if needed for the QoS Flow(s) associated with the QoS
rule(s), PCO including session level information that the V-SMF is not
expected to understand, selected PDU Session Type and SSC mode, Reliable Data
Service Support, H-CN Tunnel Info, QFI(s), QoS profile(s), Session-AMBR,
Reflective QoS Timer (if available), information needed by V-SMF in the case
of EPS interworking such as the PDN Connection Type, User Plane Policy
Enforcement, [ECS Address Configuration Information for the serving PLMN]).
If the PDU Session being established was requested to be an always-on PDU
Session, the H-SMF shall indicate to the V-SMF whether the request is accepted
or not via the Always-on PDU Session Granted indication in the response
message to V-SMF. If the PDU Session being established was not requested to be
an always-on PDU Session but the H-SMF determines that the PDU Session needs
to be established as an always-on PDU Session, the H-SMF shall indicate it to
the V-SMF by including Always-on PDU Session Granted indication that the PDU
Session is an always-on PDU Session.
The information that the H-SMF may provide is the same than defined for step
11 of Figure 4.3.2.2.1-1.
The H-CN Tunnel Info contains the tunnel information for uplink traffic
towards H-UPF.
Multiple QoS Rules and QoS Flow level QoS parameters for the QoS Flow(s)
associated with the QoS rule(s) may be included in the Nsmf_PDUSession_Create
Response.
The V-SMF may apply VPLMN policies related with the SLA negotiated with the
HPLMN or with QoS values supported by the VPLMN to evaluate the QoS parameters
received from H-SMF; such policies may result in that V-SMF does not accept
the PDU Session or does not accept some of the QoS Flows requested by the
H-SMF. If the V-SMF does not accept the PDU Session, the V-SMF triggers the
V-SMF initiated PDU Session Release procedure from step 1b-3b as defined in
clause 4.3.4.3. When the V-SMF accepts at least one QoS flow, it transfers
(via the AMF) the corresponding N2 (and NAS) request towards the 5G AN (and
the UE) but does not issue requests for the QoS Flow(s) it has rejected due
these policies. The V-SMF notifies the H-SMF about the rejected QoS Flows in
step 23 below.
NOTE 2: QoS enforcement in V-UPF is not expected on the QoS parameters
received from H-SMF.
If Control Plane CIoT 5GS Optimisation is enabled for the PDU Session, certain
information, e.g. H-CN tunnel info, is not provided in the response to V-SMF.
V-SMF stores the indication of Small Data Rate Control applicability on this
PDU Session, if it is received in Nsmf_PDUSession_Create Response.
13a-13b. The V-SMF initiates an N4 Session Modification procedure with the
V-UPF. The V-SMF may provide N4 rules to the V-UPF for this PDU Session,
including rules to forward UL traffic to the H-UPF.
14-18. These steps are the same as steps 11-15 in clause 4.3.2.2.1 with the
following differences:
\- These steps are executed in Visited PLMN;
\- The V-SMF stores an association of the PDU Session and H-SMF ID for this
PDU Session for this UE;
\- If the H-SMF indicates the PDU Session can be established as an always-on
PDU Session, the V-SMF shall further check whether the PDU Session can be
established as an always-on PDU Session based on local policies. The V-SMF
notifies the UE whether the PDU Session is an always-on PDU Session or not via
the Always-on PDU Session Granted indication in the PDU Session Establishment
Accept message.
\- If the N2 SM information indicates failure of user plane resource setup and
the V-SMF rejected the PDU session establishment as described in step 15 in
clause 4.3.2.2.1, step 19 is skipped and instead the V-SMF releases the N4
Session with V-UPF.
\- If an alternative H-SMF is selected for the PDU Session and the
corresponding selected alternative H-SMF ID has not been previously provided
to the AMF, the V-SMF provides the selected alternative H-SMF ID to the AMF.
NOTE 3: The selected alternative H-SMF ID can be provided to AMF earlier, e.g.
in step 8 if PDU Session Authentication/Authorization is performed.
\- If Control Plane CIoT 5GS Optimisation is enabled for the PDU Session,
steps 19, 20 and 23 below are omitted.
19a. The V-SMF initiates an N4 Session Modification procedure with the V-UPF.
The V-SMF may provide N4 rules to the V-UPF for this PDU Session, including
rules to forward DL traffic to the AN.
19b. The V-UPF provides a N4 Session Modification Response to the V-SMF.
After this step, the V-UPF delivers any down-link packets to the UE that may
have been buffered for this PDU Session.
20\. This step is the same as step 17 in clause 4.3.2.2.1 with the following
differences:
\- The SMF is a V-SMF. The H-SMF and V-SMF subscribe to UE reachability event
from AMF.
21\. This step is same as step 18 in clause 4.3.2.2.1. In addition, if during
the procedure, after step 14, the PDU Session establishment is not successful
as specified in step 15 of clause 4.3.2.2.1, the V-SMF triggers the V-SMF
initiated PDU Session Release procedure from step 1b-3b as defined in clause
4.3.4.3.
22\. H-SMF to UE, via H-UPF and V-UPF in VPLMN: In the case of PDU Session
Type IPv6 or IPv4v6, the H-SMF generates an IPv6 Router Advertisement and
sends it to the UE via N4 and the H-UPF and V-UPF. If the Control Plane CIoT
5GS Optimisation is enabled for this PDU session the V-UPF forwards the IPv6
Router Advertisement to the V-SMF for transmission to the UE using the Mobile
Terminated Data Transport in Control Plane CIoT 5GS Optimisation procedures
(see clause 4.24.2).
23\. If the V-SMF received in step18 an indication that the (R)AN has rejected
some QFI(s) or if the V-SMF has rejected some QFI(s) in step 13, the V-SMF
notifies the H-SMF via a Nsmf_PDUSession_Update Request. The H-SMF is
responsible of updating accordingly the QoS rules and QoS Flow level QoS
parameters if needed for the QoS Flow(s) associated with the QoS rule(s) in
the UE.
24\. This step is the same as step 20 in clause 4.3.2.2.1 with the following
differences:
\- this step is executed in the Home PLMN;
\- the SMF also deregisters for the given PDU Session using
Nudm_UECM_Deregistration (SUPI, DNN, PDU Session ID). The UDM may update
corresponding UE context by Nudr_DM_Update (SUPI, Subscription Data, UE
context in SMF data).
NOTE 4: The SMF in HPLMN can initiate H-SMF initiated PDU Session Release
procedure as defined in clause 4.3.4.3, already after step 13.
##### 4.3.2.2.3 SMF selection
##### 4.3.2.2.3.1 General {#general-13 .H6}
The SMF selection function, as described in clause 6.3.2 of TS 23.501 [2], is
supported by the AMF and is used to allocate an SMF that manages the PDU
Session.
The SMF selection function described in this clause does not apply to the
selection of an SMF for Emergency services. For SMF selection for Emergency
services is described in clause 5.16.4.5 of TS 23.501 [2].
Two main branches of deployment scenarios to consider:
\- Non-roaming and roaming with local breakout, see clause 4.3.2.2.3.2
\- Home routed roaming, see clause 4.3.2.2.3.3
In the case of non-roaming and local breakout, there are two operational
scenarios dependent on the configuration of AMF and the deployment option of
NSSF in the serving PLMN.
In the case of home-routed, there are two main options dependent on the
operators\' choices in terms of involvement of NRF, NSSF and configuration of
AMF. The decision of which option to use is part of the roaming agreements.
NOTE: The use of NSI ID and the use of multiple NRFs in the network are
optional and depend on the deployment choices of the operator.
##### 4.3.2.2.3.2 Non-roaming and roaming with local breakout {#non-roaming-
and-roaming-with-local-breakout-1 .H6}
Figure 4.3.2.2.3.2-1: SMF selection for non-roaming and roaming with local
breakout scenarios
This procedure may be skipped altogether if SMF information is available in
the AMF by other means (e.g. locally configured); otherwise:
\- when the serving AMF is aware of the appropriate NRF to be used to select
NFs/services within the corresponding Network Slice instance based on
configuration or based on the Network Slice selection information received
during Registration, only steps 3 and 4 in the following procedure are
executed as described in Figure 4.3.2.2.3.2-1;
\- when the serving AMF is not aware of the appropriate NRF to be used to
select NFs/services within the corresponding Network Slice instance, all steps
in the following procedure are executed as described in Figure 4.3.2.2.3.2-1.
1\. The AMF invokes the Nnssf_NSSelection_Get service operation from the NSSF
in serving PLMN with the S-NSSAI of the Serving PLMN from the Allowed NSSAI or
Partially Allowed NSSAI requested by the UE, PLMN ID of the SUPI, TAI of the
UE and the indication that the request is within a procedure of PDU Session
establishment in either the non-roaming or roaming with local breakout
scenario.
2\. The NSSF in serving PLMN selects the Network Slice instance, determines
and returns the appropriate NRF to be used to select NFs/services within the
selected Network Slice instance and optionally may return a NSI ID
corresponding to the Network Slice instance.
3\. AMF queries the appropriate NRF in serving PLMN by issuing the
Nnrf_NFDiscovery_Request including at least the S-NSSAI of the Serving PLMN
for this PDU Session from the Allowed NSSAI or Partially Allowed NSSAI, PLMN
ID of the SUPI, DNN and possibly NSI ID if the AMF has stored an NSI ID for
the S-NSSAI of the Serving PLMN for this PDU Session from the Allowed NSSAI or
Partially Allowed NSSAI.
NOTE: The list of parameters for SMF selection is defined in clause 6.3.2 of
TS 23.501 [2]. See also clause 5.34.3 of TS 23.501 [2] for I-SMF selection.
4\. The NRF in serving PLMN provides to the AMF, e.g. FQDN or IP address, of a
set of the discovered SMF instance(s) or Endpoint Address(es) of SMF service
instance(s) in Nnrf_NFDiscovery_Request response message and possibly an NSI
ID for the selected Network Slice instance corresponding to the S-NSSAI for
subsequent NRF queries.
##### 4.3.2.2.3.3 Home routed roaming {#home-routed-roaming-1 .H6}
The selection of the SMF in VPLMN is performed in the same way as for non-
roaming and roaming with local breakout (see clause 4.3.2.2.3.2). The
selection of the SMF in HPLMN is performed by means of one of two main
options. Which of these two options to use is decided based on Service Level
Agreements between the operators.
NOTE 1: The procedures described in this clause are not limited to SMF
selection but can be used to discover and select any NF/NF service in the
HPLMN part of a Network Slice instance.
In the first option, requiring the use of NSSF in both the VPLMN and the
HPLMN, the selection of the SMF in HPLMN is performed by means of the
procedure depicted in Figure 4.3.2.2.3.3-1.
Figure 4.3.2.2.3.3-1: Option 1 for SMF selection for home-routed roaming
scenarios
1\. Based on the operator\'s configuration, if the AMF is not aware of the
appropriate NRF to be used to select NFs/services in the HPLMN, the AMF
invokes the Nnssf_NSSelection_Get service operation from the NSSF in VPLMN
with the VPLMN S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI
requested by the UE for this PDU Session, the HPLMN S-NSSAI that maps to the
VPLMN S-NSSAI, PLMN ID of the SUPI, the TAI of the UE and the indication that
the request is within a procedure of PDU Session establishment in the home-
routed roaming scenario.
2\. If slicing configuration information for the S-NSSAI in the HPLMN is not
available (e.g. the NSSF has no cached information), the NSSF of the VPLMN
invokes the Nnssf_NSSelection_Get service operation from NSSF of the HPLMN
according to the PLMN ID of SUPI by including the HPLMN S-NSSAI.
3\. The NSSF in HPLMN may include the NSI ID, if needed, for the Network Slice
instance in HPLMN selected for the corresponding S-NSSAI of the HPLMN in the
Nnssf_NSSelection_Get response. The NSSF in HPLMN also includes the
appropriate hNRF to be used to select NFs/services within HPLMN in the
Nnssf_NSSelection_Get response.
4\. The serving NSSF includes in the Nnssf_NSSelection_Get response all the
information that has been received from the NSSF in HPLMN when responding to
the AMF.
5\. The AMF queries the target vNRF using the Nnrf_NFDiscovery_Request by
including PLMN ID of the SUPI, DNN, HPLMN S-NSSAI, the hNRF and possibly an
HPLMN NSI ID for the selected Network Slice instance corresponding to the
HPLMN S-NSSAI if available in the AMF (obtained from the HPLMN NSSF in steps 3
and 4 or cached from a previous H-NSSF query).
6\. The NRF in serving PLMN identifies NRF in HPLMN (hNRF) based on the
information provided by the NSSF in the serving PLMN and it invokes the
Nnrf_NFDiscovery_Request service from hNRF according the procedure in Figure
4.17.4-1 to get the expected SMF instance(s) deployed in the HPLMN. As the
vNRF in VPLMN triggers the \"NF Discovery\" on behalf of the AMF, the NRF in
the VPLMN shall not replace the information of the NF, i.e. AMF ID, in the
Nnrf_NFDiscovery_Request message it sends to the hNRF.
7-8. The hNRF provides to the AMF, via vNRF, the information e.g. FQDN or IP
address, of a set of the SMF instance(s) in Nnrf_NFDiscovery_Request response
message and possibly an NSI ID for the selected Network Slice instance
corresponding to the S-NSSAI of the HPLMN for subsequent NRF queries.
When the NSSF is not deployed in HPLMN then the AMF in VPLMN relies on either
the configuration to obtain the NRF in HPLMN or on the option below.
The second option for the selection of the SMF in HPLMN is performed by means
of the procedure depicted in Figure 4.3.2.2.3.3-2.
Figure 4.3.2.2.3.3-2: Option 2 for SMF selection for home-routed roaming
scenarios
1\. Based on the operator\'s configuration, the AMF queries the vNRF with PLMN
ID of the SUPI, PLMN ID of the serving PLMN, DNN, the HPLMN S-NSSAI that maps
to the S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI of the
Serving PLMN the UE has requested, the hNRF and if applicable and available,
an HPLMN NSI ID (if the AMF has stored an hNRF and if applicable and
available, an HPLMN NSI ID for the selected Network Slice instance
corresponding to the S-NSSAI of the HPLMN) and DNN.
2\. The vNRF queries, on behalf of the AMF in VPLMN, the hNRF identified by
means of the PLMN ID of the SUPI (if no hNRF is received from the AMF, the
hNRF is locally determined in the vNRF based on information received in step
1). The NRF in VPLMN requests \"NF Discovery\" service from hNRF according the
procedure in Figure 4.17.4-1 to get the expected SMF instance(s) deployed in
the HPLMN. As the NRF in the serving PLMN triggers the \"NF Discovery\" on
behalf of the AMF, the NRF in the VPLMN shall not replace the information of
the NF, i.e. AMF ID, in the Nnrf_NFDiscovery_Request message it sends to the
hNRF.
Depending on the available information and based on configuration, the hNRF
may either execute steps in 3(A) or in 3(B).
3(A) The hNRF provides to the AMF, via vNRF, the information e.g. FQDN or IP
address, of a set of the discovered SMF instance(s) and possibly an NSI ID for
the selected HPLMN part of the Network Slice instance corresponding to the
S-NSSAI of the HPLMN for subsequent NRF queries in Nnrf_NFDiscovery_Request
response message(steps 3a and 3b).
3(B) The hNRF queries, on behalf of the AMF, an appropriate local NRF in HPLMN
(e.g. a slice level NRF); this local NRF provides the IP address or the FQDN
of expected SMF instance(s) and possibly an NSI ID for the selected HPLMN part
of the Network Slice instance corresponding to the S-NSSAI of the HPLMN for
subsequent NRF queries (steps 3a and 3b) that the hNRF returns, via vNRF, to
the AMF (steps 3c and 3d).
##### 4.3.2.2.4 Multiple PDU Sessions towards the same DNN and S-NSSAI
A UE may establish multiple PDU Sessions associated with the same DNN and
S-NSSAI and the AMF may select the same SMF or different SMFs as specified in
clause 6.3.2 of TS 23.501 [2].
During PDU Session establishment, the AMF checks if the SMF selection
subscription data indicates that the same SMF is required for multiple PDU
Sessions and if required, the AMF checks if any SMF is already selected for
the same DNN and S-NSSAI, if so, the same SMF will be used for the additional
PDU Session.
NOTE 1: The SMF ID can be notified from UDM to the AMF when one AMF is
selected for 3GPP access in VPLMN and a different AMF is selected in HPLMN for
non-3GPP access.
NOTE 2: The same SMF is selected for multiple PDU Sessions towards the same
DNN and S-NSSAI to facilitate the selection of the same PCF e.g. for the
purpose of usage monitoring.
#### 4.3.2.3 Secondary authorization/authentication by an DN-AAA Server during
the PDU Session establishment
The PDU Session establishment authentication/authorization is optionally
triggered by the SMF during a PDU Session establishment and performed
transparently via a UPF or directly with the DN-AAA Server without involving
the UPF if the DN-AAA Server is located in the 5GC and reachable directly, as
described in clause 5.6.6 of TS 23.501 [2].
In the case of Home Routed Roaming, unless specified otherwise, the SMF in the
information flow defined in this clause is the H-SMF.
Figure 4.3.2.3-1: PDU Session Establishment authentication/authorization by a
DN-AAA Server
NOTE 1: Steps 2, 3a, 3f and 4 are not defined in this specification. Steps 3
can be repeated depending on the mechanism used.
NOTE 2: When the SMF directly communicates with the DN-AAA Server without
involving the UPF, Step 1 is skipped and Step 2, 3a, 3f, 4 and 6 are executed
without involving the UPF.
0\. The SMF determines that it needs to contact the DN-AAA Server. The SMF
identifies the DN-AAA Server based on local configuration or using the DN-
specific identity (TS 33.501 [15]) provided by the UE inside the SM PDU DN
Request Container provided by the UE in the PDU Session Establishment request
or inside the EAP message in the PDU Session Authentication Complete message
(TS 24.501 [25]).
NOTE 3: The content of the SM PDU DN Request Container is defined in TS 24.501
[25].
NOTE 4: When secondary authentication, using Default UE credentials for
secondary authentication, is used in the context of the UE onboarding
architecture in Figure 5.30.2.10.2.2-3 of TS 23.501 [2], the DCS can act as
the DN-AAA server.
1\. If there is no existing N4 session that can be used to carry DN-related
messages between the SMF and the DN, the SMF selects a UPF and triggers N4
session establishment.
2\. The SMF initiates the authentication procedure with the DN-AAA via the UPF
to authenticate the DN-specific identity provided by the UE as specified in TS
29.561 [63].
When available, the SMF provides the GPSI in the signalling exchanged with the
DN-AAA.
The UPF transparently relays the message received from the SMF to the DN-AAA
Server.
3a. The DN-AAA Server sends an Authentication/Authorization message towards
the SMF. The message is carried via the UPF.
3b. Transfer of DN Request Container information received from DN-AAA towards
the UE.
In non-roaming and LBO cases, the SMF invokes the
Namf_Communication_N1N2MessageTransfer service operation on the AMF to
transfer the DN Request Container information within N1 SM information sent
towards the UE.
In the case of Home Routed roaming, the H-SMF initiates a
Nsmf_PDUSession_Update service operation to request the V-SMF to transfer DN
Request Container to the UE and the V-SMF invokes the
Namf_Communication_N1N2MessageTransfer service operation on the AMF to
transfer the DN Request Container information within N1 SM information sent
towards the UE. In Nsmf_PDUSession_Update Request, the H-SMF additionally
includes the H-SMF SM Context ID.
3c: The AMF sends the N1 NAS message to the UE
3d-3e. Transfer of DN Request Container information received from UE towards
the DN-AAA.
When the UE responds with a N1 NAS message containing DN Request Container
information, the AMF informs the SMF by invoking the
Nsmf_PDUSession_UpdateSMContext service operation. The SMF issues an
Nsmf_PDUSession_UpdateSMContext response.
In the case of Home Routed roaming, the V-SMF relays the N1 SM information to
the H-SMF using the information of PDU Session received in step 3b via a
Nsmf_PDUSession_Update service operation.
3f: The SMF (In HR case it is the H-SMF) sends the content of the DN Request
Container information (authentication message) to the DN-AAA Server via the
UPF.
Step 3 may be repeated until the DN-AAA Server confirms the successful
authentication/authorization of the PDU Session.
4\. The DN-AAA Server confirms the successful authentication/authorization of
the PDU Session. The DN-AAA Server may provide:
\- an SM PDU DN Response Container to the SMF to indicate successful
authentication/authorization;
\- DN Authorization Data as defined in clause 5.6.6 of TS 23.501 [2];
\- a request to get notified with the IP address(es) allocated to the PDU
Session and/or with N6 traffic routing information or MAC address(es) used by
the UE for the PDU Session; and
\- an IP address (or IPV6 Prefix) for the PDU Session.
The N6 traffic routing information is defined in clause 5.6.7 of TS 23.501
[2].
After the successful DN authentication/authorization, a session is kept
between the SMF and the DN-AAA. If the SMF receives a DN Authorization Data,
the SMF uses the DN Authorization Profile Index to apply the policy and
charging control (see clause 5.6.6 of TS 23.501 [2]).
5\. The PDU Session establishment continues and completes. In the step 7b of
the Figure 4.3.2.2.1-1, if the SMF receives the DN Authorization Profile Index
in DN Authorization Data from the DN-AAA, it sends the DN Authorization
Profile Index to retrieve the PDU Session related policy information
(described in clause 6.4 of TS 23.503 [20]) and the PCC rule(s) (described in
clause 6.3 of TS 23.503 [20]) from the PCF. If the SMF receives the DN
authorized Session AMBR in DN Authorization Data from the DN-AAA, it sends the
DN authorized Session AMBR within the Session AMBR to the PCF to retrieve the
authorized Session AMBR (described in clause 6.4 of TS 23.503 [20]). For PDU
Session of Ethernet type, the SMF may instruct the UPF to handle VLAN
information of the Ethernet frames related with the PDU Session received and
sent on N6 or N19 or internal interface, as described in clause 5.6.10.2 of TS
23.501 [2].
6\. If requested so in step 4 or if configured so by local policies, the SMF
notifies the DN-AAA with the IP/MAC address(es) and/or with N6 traffic routing
information allocated to the PDU Session together with the GPSI.
Later on the SMF notifies the DN-AAA if the DN-AAA had requested to get
notifications about:
\- allocation or release of an IPV6 Prefix for the PDU Session of IP type or
addition or removal of source MAC addresses for the PDU Session of Ethernet
type (e.g. using IPV6 multi-homing as defined in clause 5.6.4.3 of TS 23.501
[2]);
\- Change of N6 traffic routing information.
When later on the PDU Session gets released as described in clause 4.3.4, the
SMF notifies the DN-AAA.
The DN-AAA Server may revoke the authorization for a PDU Session or update DN
authorization data for a PDU Session. According to the request from DN-AAA
Server, the SMF may release or update the PDU Session.
At any time after the PDU Session establishment, the DN-AAA Server or SMF may
initiate Secondary Re-authentication procedure for the PDU Session as
specified in clause 11.1.3 of TS 33.501 [15]. Step 3a to step 3f are performed
to transfer the Secondary Re-authentication message between the UE and the DN-
AAA Server. The Secondary Re-authentication procedure may start from step 3a
(DN-AAA initiated Secondary Re-authentication procedure) or step 3b (SMF
initiated Secondary Re-authentication procedure). For the DN-AAA Server
initiated Secondary Re-authentication, the message in step 3a shall include
GPSI, if available and the IP/MAC address(es) of the PDU session, for SMF to
identify the corresponding UE and PDU session. If the Re-authentication result
is unsuccessful then SMF may release the PDU session and notify the DN-AAA
Server.
During Secondary Re-authentication, if the SMF receives an indication from the
AMF that the UE is unreachable then it informs the DN-AAA Server that UE is
not reachable for re-authentication. Based on this indication from SMF, the
DN-AAA Server may decide to keep the PDU Session or request to release the PDU
session.
DN-AAA may initiate DN-AAA Re-authorization without performing re-
authentication based on local policy. DN-AAA Re-authorization procedure may
start from step 4.
During Secondary Re-authentication/Re-authorization, if the SMF receives DN
Authorization Profile Index and/or DN authorized Session AMBR, the SMF reports
the received value(s) to the PCF (as described in TS 23.501 [2]) by triggering
the Policy Control Request Trigger as described in TS 23.503 [20].
#### 4.3.2.4 Support of L2TP
L2TP may be used between UPF and the DN via N6 to carry traffic of a PDU
Session, as defined in TS 23.501 [2]. The corresponding high level end to end
signalling flow is described in this clause and further refined in TS 29.561
[63]. For the procedure described below, it is a prerequisite that the UE is
already registered to the 5GC and both SMF and UPF support the L2TP feature.
NOTE 1: The scenario where the UE sends actual PPP frames/signalling towards
the LAC, which involves back and forth message exchanges between the UE and
LAC, for example for LCP Negotiation, is not in the scope of the present
document.
NOTE 2: The UE does not need to be aware of the L2TP procedure.
Figure 4.3.2.4-1: Support of L2TP
1\. This step is the same as step 1 in clause 4.3.2.2.1 or step 1 in clause
4.3.2.2.2.
The PDU session establishment may include in the PCO information
authentication information for PAP and/or CHAP.
2\. The SMF may determine that an L2TP session is required for the PDU Session
based on local configuration (e.g. related with DNN/S-NSSAI). The SMF may
retrieve the L2TP Tunnel parameters from the DN-AAA Server, as described in
clause 4.3.2.3, or be configured locally with L2TP Tunnel parameters.
The L2TP Tunnel parameters may include information such as the LNS addressing
information (e.g. IP address or hostname), as defined in TS 29.561 [63].
3\. This step is the same as step 8 in clause 4.3.2.2.1 with the following
additions:
If L2TP is required for the PDU Session, the SMF selects a UPF supporting
L2TP.
4\. This step is the same as step 10a in clause 4.3.2.2.1 with the following
additions:
The SMF requests the UPF to setup an L2TP Session towards the L2TP server
(LNS).
The SMF may send to the UPF as part of N4 signalling, L2TP Tunnel Information
and L2TP Session Information to setup a L2TP session.
The L2TP Session Information includes specific information related to the PDU
Session, e.g. a Calling Number which may be set to UE\'s SUPI, the Called
Number for the L2TP Session which may be configured to contain the DNN,
PAP/CHAP related parameters if included by the UE in PCO in step 1 etc. This
information is defined in TS 29.561 [63].
5\. If needed the UPF may decide to setup a new L2TP Tunnel, as described in
TS 29.561 [63].
If the UPF decides to use an already existing L2TP Tunnel for the requested
PDU Session from the SMF, it directly proceeds with step 6 below.
6\. The UPF proceeds with L2TP Session setup towards the LNS, as described in
TS 29.561 [63].
If the SMF has requested the UPF to allocate the UE IP address in step 4, the
UPF may retrieve the UE IP address from the LNS.
7\. This step is the same as step 10b in clause 4.3.2.2.1 with the following
additions:
The status of the L2TP Session setup is sent by the UPF to the SMF in a N4
Session Establishment Response. This may indicate information provided by the
LNS Server for the UE such as the DNS server address, etc.
8\. This step is the same as steps 11 - 13 in clause 4.3.2.2.1.
### 4.3.3 PDU Session Modification
#### 4.3.3.1 General
The procedure is used when one or several of the QoS parameters exchanged
between the UE and the network are modified and/or to send updated ECS Address
Configuration Information as defined in clause 6.5.2 of TS 23.548 [74] to the
UE and/or to send the updated DNS server address as defined in clause
6.2.3.2.3 of TS 23.548 [74].
NOTE 1: The conditions when to use this procedure for QoS change as well as
the QoS parameters exchanged between the UE and the network are defined in
clause 5.7 of TS 23.501 [2].
NOTE 2: The conditions when to use this procedure for the exchange of ECS
Address Configuration Information are described in clause 6.5.2 of TS 23.548
[74].
NOTE 3: The conditions when to use this procedure for the update of DNS server
address are described in clause 6.2.3.2.3 of TS 23.548 [74].
#### 4.3.3.2 UE or network requested PDU Session Modification (non-roaming and
roaming with local breakout)
The UE or network requested PDU Session Modification procedure (non-roaming
and roaming with local breakout scenario) is depicted in figure 4.3.3.2-1.
Figure 4.3.3.2-1: UE or network requested PDU Session Modification (for non-
roaming and roaming with local breakout)
1\. The procedure may be triggered by following events:
1a. (UE initiated modification) The UE initiates the PDU Session Modification
procedure by the transmission of an NAS message (N1 SM container (PDU Session
Modification Request (PDU session ID, Packet Filters, Operation, Requested
QoS, Segregation, 5GSM Core Network Capability, Number Of Packet Filters,
[Connection Capabilities], [Always-on PDU Session Requested], [Requested
Non-3GPP Delay Budget])), PDU Session ID, UE Integrity Protection Maximum Data
Rate, [Port Management Information Container]) message. Depending on the
Access Type, if the UE was in CM-IDLE state, this SM-NAS message is preceded
by the Service Request procedure. The NAS message is forwarded by the (R)AN to
the AMF with an indication of User location Information. The AMF invokes
Nsmf_PDUSession_UpdateSMContext (SM Context ID, N1 SM container (PDU Session
Modification Request)).
When the UE requests specific QoS handling for selected SDF(s), the PDU
Session Modification Request includes Packet Filters describing the SDF(s),
the requested Packet Filter Operation (add, modify, delete) on the indicated
Packet Filters, the Requested QoS and optionally a Segregation indication. The
Segregation indication is included when the UE recommends to the network to
bind the applicable SDF(s) on a distinct and dedicated QoS Flow e.g. even if
an existing QoS Flow can support the requested QoS. The network should abide
by the UE request, but is allowed to proceed instead with binding the selected
SDF(s) on an existing QoS Flow.
NOTE 1: Only one QoS Flow is used for traffic segregation. If UE makes
subsequent requests for segregation of additional SDF(s), the additional
SDF(s) are multiplexed on the existing QoS Flow that is used for segregation.
The UE shall not trigger a PDU Session Modification procedure for a PDU
Session corresponding to a LADN when the UE is outside the area of
availability of the LADN.
The PS Data Off status, if changed, shall be included in the PCO in the PDU
Session Modification Request message.
For a PDU Session which was established in the EPS, when the UE moves from EPS
to 5GS _for the first time, the UE_ includes an Always-on PDU Session
Requested indication in the PDU Session Modification Request message if it
wants to change the PDU Session to an always-on PDU Session.
If UE supports to report URSP rule enforcement to network and the URSP rule
that triggered this PDU Session Establishment Request included the Indication
for reporting URSP rule enforcement, the UE may provide Connection
Capabilities as described in clause 6.6.2.4 of TS 23.503 [20].
When PCF is deployed, the SMF shall further report the PS Data Off status to
PCF if the PS Data Off event trigger is provisioned, the additional behaviour
of SMF and PCF for 3GPP PS Data Off is defined in TS 23.503 [20].
The 5GSM Core Network Capability is provided by the UE and handled by SMF as
defined in clause 5.4.4b of TS 23.501 [2].
The UE Integrity Protection Maximum Data Rate indicates the maximum data rate
up to which the UE can support UP integrity protection. It is set as defined
in TS 23.501 [2].
The Number Of Packet Filters indicates the number of supported packet filters
for signalled QoS rules as described in clause 5.17.2.2.2 of TS 23.501 [2].
When it moves from EPS to 5GS for the first time, a UE that supports EAS re-
discovery as described in clause 6.2.3.3 of TS 23.548 [74], may indicate so in
the PCO.
When it moves from EPS to 5GS for the first time, a UE that hosts the EDC
functionality shall indicate in the PCO its capability to support the EDC
functionality (see clause 5.2.1 of TS 23.548 [74]).
Port Management Information Container may be received from DS-TT and includes
DS-TT port related management information as defined in clause 5.28.3 of TS
23.501 [2].
1b. (PCF initiated SM Policy Association Modification) The PCF performs a PCF
initiated SM Policy Association Modification procedure as defined in clause
4.16.5.2 to notify SMF about the modification of policies. This may e.g. have
been triggered by a policy decision or upon AF requests, e.g. Application
Function influence on traffic routing as described in step 5 in clause 4.3.6.2
or AF to provide Port management information Container.
If QoS Monitoring is requested by the AF, the PCF generates the QoS Monitoring
policy for the corresponding service data flow and provides the policy in the
PCC rules to the SMF in this step.
If Periodicity is provided by the AF, the PCF provides the Periodicity
information in the PCC rules. Based on operator\'s local policies, the PCF
sends to the SMF an indication in the PCC Rule to perform N6 Traffic Parameter
Measurements for N6 Jitter and, if not received from the AF, also UL and/ or
DL Periodicity measurements.
The PCF may provision a PDU Set Control Information as described in clause
6.1.3.27.4 of TS 23.503 [20] within PCC Rules based on the information
provided by the AF and/or the local operator policies.
1c. (SMF requested modification) The UDM updates the subscription data of SMF
by Nudm_SDM_Notification (SUPI, Session Management Subscription Data). The SMF
updates the Session Management Subscription Data and acknowledges the UDM by
returning an Ack with (SUPI).
1d. (SMF requested modification) The SMF may decide to modify PDU Session.
This procedure also may be triggered based on locally configured policy or
triggered from the (R)AN (see clause 4.2.6 and clause 4.9.1). It may also be
triggered if the UP connection is activated (as described in Service Request
procedure) and the SMF has marked that the status of one or more QoS Flows are
deleted in the 5GC but not synchronized with the UE yet. It may also be
triggered to update QoS profile in the NG RAN and PDU Set information marking
in the PSA UPF upon completion of handover procedure as defined in clause
5.37.5.3 of TS 23.501 [2].
If interworking with TSN deployed in the transport network is supported and
either the UPF supports CN-TL or NG-RAN supports AN-TL (see clause 4.4.8 of TS
23.501 [2]), the procedure may be triggered due to reception of Status group
from TN CNC.
The SMF may decide to modify PDU Session to send updated ECS Address
Configuration Information to the UE as defined in clause 6.5.2 of TS 23.548
[74].
The SMF may decide to modify PDU Session to send updated DNS server address to
the UE as defined in clause 6.2.3.2.3 of TS 23.548 [74].
The SMF may decide to modify PDU Session to send the EAS rediscovery
indication to the UE as defined in clause 6.2.3.3 of TS 23.548 [74].
If the SMF receives one of the triggers in step 1b \~ 1d, the SMF starts SMF
requested PDU Session Modification procedure.
1e. (AN initiated modification) (R)AN shall indicate to the SMF when the AN
resources onto which a QoS Flow is mapped are released irrespective of whether
notification control is configured. (R)AN sends the N2 message (PDU Session
ID, N2 SM information) to the AMF. The N2 SM information includes the QFI,
User location Information and an indication that the QoS Flow is released. The
AMF invokes Nsmf_PDUSession_UpdateSMContext (SM Context ID, N2 SM
information).
(AN initiated notification control) If notification control is configured for
a GBR QoS Flow, (R)AN sends a N2 message (PDU Session ID, N2 SM information)
to SMF when the (R)AN decides the QoS targets of the QoS Flow cannot be
fulfilled or can be fulfilled again, respectively. The N2 SM information
includes the QFI and an indication that the QoS targets for that QoS Flow
cannot be fulfilled or can be fulfilled again, respectively. When QoS targets
cannot be fulfilled, the N2 SM information indicates a reference to the
Alternative QoS Profile matching the values of the QoS parameters that the NG-
RAN is currently fulfilling as specified in clause 5.7.2.4 of TS 23.501 [2].
If the QoS Flow has a TSCAI including Capability for BAT adaptation and
without Burst Arrival Time, the N2 SM information can also include a BAT
offset as described in clause 5.27.2.5 of TS 23.501 [2]. The AMF invokes
Nsmf_PDUSession_UpdateSMContext (SM Context ID, N2 SM information). If the PCF
has subscribed to the event, SMF reports this event to the PCF for each PCC
Rule for which notification control is set in step 2.
1f. (AMF initiated modification) If the UE supports CE mode B and use of CE
mode changes from restricted to unrestricted or vice versa in the Enhanced
Coverage Restriction information in the UE context in the AMF and the UE has
already established PDU sessions, then the AMF shall trigger a PDU session
modification to the SMFs serving the UE\'s PDU sessions when the AMF
determines that NAS-SM timer shall be updated due to the change of Enhanced
Coverage Restriction and include the extended NAS-SM indication only if use of
CE mode B is now unrestricted in the Enhanced Coverage Restriction information
in the UE context in the AMF.
If the AMF, based on configuration, is aware that the UE is accessing over a
gNB using GEO satellite backhaul and GEO Satellite ID needs to be updated to
the SMF, the AMF may, based on configuration, include the latest GEO Satellite
ID as described in clause 5.43.2 of TS 23.501 [2].
1g. (AMF initiated modification) the AMF informs the SMF of updates of the
NWDAF ID(s) used for UE related Analytics and corresponding Analytics ID(s).
Also, If the PCF request notification of SM Policy Association and there is
any PDU Session established to that DNN, S-NSSAI [PCF binding information,
notification of SM Policy Association establishment Indication].
1h. (AMF initiated modification) When the AMF determines that the S-NSSAI is
to be replaced with an Alternative S-NSSAI (as described in clause 5.15.19 of
TS 23.501 [2]), the AMF invokes Nsmf_PDUSession_UpdateSMContext Request (SM
Context ID, S-NSSAI, Alternative S-NSSAI) to the SMF of the PDU session
associated with the S-NSSAI.
Based on the extended NAS-SM timer indication, the SMF shall use the extended
NAS-SM timer setting for the UE as specified in TS 24.501 [25].
2\. The SMF may need to report some subscribed event to the PCF by performing
an SMF initiated SM Policy Association Modification procedure as defined in
clause 4.16.5.1. This step may be skipped if PDU Session Modification
procedure is triggered by step 1b or 1d. If dynamic PCC is not deployed, the
SMF may apply local policy to decide whether to change the QoS profile.
Steps 2a to 7 are not invoked when the PDU Session Modification requires only
action at a UPF (e.g. gating).
2a. The SMF may update the UPF with N4 Rules related to new or modified QoS
Flow(s).
NOTE 2: This allows the UL packets with the QFI of a new or modified QoS Flow
to be transferred.
If the SMF initiated the PDU Session Modification procedure in step 1b due to
PCF initiated SM Policy Association Modification that adds one or more PCC
Rule(s) with a TSC Assistance Container and if interworking with TSN deployed
in the transport network is supported and the UPF does not support CN-TL, the
SMF instructs the UPF to assign a distinct N3 tunnel end point address for the
QoS Flow(s) assigned with a TSC Assistance Container.
If the SMF initiated the PDU Session Modification procedure in step 1d due to
reception of Status group from TN CNC, the SMF includes a TL-Container with a
set-request to the N4 Session Modification request that is sent to the UPF, as
described in clause 5.28a.2 of TS 23.501 [2].
If the SMF initiated the PDU Session Modification procedure in step 1b due to
PCF initiated SM Policy Association Modification that adds one or more PCC
Rule(s) with UL and/or DL Periodicity, the SMF composes the TSCAI with the
periodicity information.
If the SMF initiated the PDU Session Modification procedure in step 1b due to
PCF initiated SM Policy Association Modification that adds one or more PCC
Rule(s) with an indication to perform N6 Traffic Parameter measurements (e.g.
the N6 Jitter range associated with the DL Periodicity, and the UL/DL
periodicity), the SMF instructs the UPF to perform N6 Traffic Parameter
measurement associated with the DL Periodicity for the QoS Flow, as described
in clause 5.37.8.2 of TS 23.501 [2].
If N6 Jitter measurements are requested and DL Periodicity is received in the
PCC Rule, the SMF shall include the DL Periodicity in the request to the UPF,
see clause 5.8.5.11 of TS 23.501 [2].
If the PCC Rule includes a Protocol Description, the SMF should provide the
Protocol Description information to the UPF and request the UPF to mark the
PDU Set Information in each PDU belonging to the PDU Sets as described in
clause 5.37.5.2 and 5.8.5.4 of TS 23.501 [2] and to mark the End of Data burst
in the last PDU in downlink based on the protocol header identified by the
Protocol Description information, according to the local operator policies,
see clause 5.37.8.3 of TS 23.501 [2].
If the PDU Set information marking has been activated in the UPF for a QoS
flow, the SMF may request the UPF to stop the marking of the PDU Set
information based on the indication from the RAN or PCF, e.g. if the Target
RAN does not support the PDU Set based handling as described in clause
5.37.5.3 of TS 23.501 [2].
If the PCF initiated SM Policy Association Modification that adds one or more
PCC Rule(s) with PDU Set Control Information, the SMF performs PDU Set based
QoS handling, see clause 5.37.5 of TS 23.501 [2].
If redundant transmission has not been activated to the PDU session and the
SMF decides to perform redundant transmission for the QoS Flow, the SMF
indicates to the UPF to perform packet duplication and elimination for the QoS
Flow.
If redundant transmission has been activated on the PDU Session and the SMF
decides to stop redundant transmission, the SMF indicates the UPF to release
the CN Tunnel Info which is used as the redundancy tunnel of the PDU Session
and also indicates the UPF to stop packet duplication and elimination for the
corresponding QoS Flow(s).
NOTE 3: The method to perform elimination and reordering on RAN/UPF based on
the packets received from the two GTP-U tunnels is up to RAN/UPF
implementation. The two GTP-U tunnels are terminated at the same RAN node and
UPF.
If redundant transmission has not been activated to the PDU Session and the
SMF decides to perform redundant transmission for the QoS Flow with two I-UPFs
between the PSA UPF and the NG-RAN, the SMF sends a N4 Session Establishment
Request message to the I-UPFs including UL CN Tunnel Info of the PSA UPF and a
request to allocate CN Tunnel Info.
SMF may make use of Redundant Transmission Experience analytics provided by
NWDAF, when SMF takes a decision whether to perform redundant transmission, or
stop redundant transmission if it had been activated, as described in clause
6.13 of TS 23.288 [50].
If the AMF initiated the PDU Session Modification procedure in step 1h due to
network slice replacement with the Alternative S-NSSAI and if the SMF
determines that the PDU Session is retained, the SMF sends N4 Session
Modification request message to the UPF to replace the S-NSSAI with the
Alternative S-NSSAI, as described in clause 5.15.19 of TS 23.501 [2].
2b. The UPF(s) respond to the SMF. If redundant transmission has not been
activated to the PDU session and the SMF indicated the UPF to perform packet
duplication and elimination for the QoS Flow in step 2a, the UPF allocates an
additional CN Tunnel Info. The additional CN Tunnel Info is provided to the
SMF.
If redundant transmission has not been activated to the PDU Session and the
SMF decides to perform redundant transmission for the QoS Flow with two I-UPFs
in step 2a, the UPFs allocate CN Tunnel Info. The CN Tunnel Info of each I-UPF
is provided to the SMF.
If interworking with TSN deployed in the transport network is supported and
the UPF supports CN-TL and received a TL-Container with a set-request from the
SMF/CUC in step 2a (see clause 4.4.8 of TS 23.501 [2]), the UPF/CN-TL includes
a TL-Container with a set-response to the N4 Session Modification response, as
described in clause 5.28a.2 of TS 23.501 [2].
If requested by SMF in step 2a, the PSA UPF will initiate N4 Session Level
reporting for N6 Traffic Parameter Measurement Report as described in clause
4.4.2.2. If N6 Traffic Parameter(s) are available then the response to the SMF
in this step may include the N6 Traffic Parameter(s) (e.g., the N6 Jitter
range associated with the DL Periodicity, and the UL/DL periodicity) for the
QoS Flow (see clause 5.37.8.2 of TS 23.501 [2]). The SMF composes the TSCAI
with the received N6 Traffic Parameters.
3a. For UE or AN initiated modification or AMF initiated modification, the SMF
responds to the AMF through Nsmf_PDUSession_UpdateSMContext Response ([N2 SM
information (PDU Session ID, QFI(s), QoS Profile(s), [Alternative QoS
Profile(s)], Session-AMBR], [CN Tunnel Info(s)]), N1 SM container (PDU Session
Modification Command (PDU Session ID, QoS rule(s), QoS rule operation, QoS
Flow level QoS parameters if needed for the QoS Flow(s) associated with the
QoS rule(s), Session-AMBR, [Always-on PDU Session Granted], [Port Management
Information Container], [Non-3GPP QoS Assistance Information Container]))).
See clause 5.7 of TS 23.501 [2] for the QoS Profile, Alternative QoS Profile
and QoS rule and QoS Flow level QoS parameters. Alternative QoS Profile is
only valid for AN initiated modification.
If the PDU Session Modification was requested by the UE to modify a PDU
Session to an always-on PDU Session, the SMF shall include an Always-on PDU
Session Granted indication in the PDU Session Modification Command to indicate
whether the PDU Session is to be changed to an always-on PDU Session or not
via the Always-on PDU Session Granted indication in the PDU Session
Modification Command.
The N2 SM information carries information that the AMF shall provide to the
(R)AN. It may include the QoS profiles and the corresponding QFIs to notify
the (R)AN that one or more QoS flows were added, or modified. It may include
only QFI(s) to notify the (R)AN that one or more QoS flows were removed. The
SMF may indicate for each QoS Flow whether redundant transmission shall be
performed by a corresponding redundant transmission indicator. If the SMF
decides to activate redundant transmission in step 2a, the SMF includes the
allocated additional CN Tunnel Info in the N2 SM information. If the SMF
decides to perform redundant transmission for new QoS Flow with two I-UPFs in
step 2a, the SMF includes the allocated CN Tunnel Info of the two I-UPFs in
the N2 SM information. If the PDU Session Modification was triggered by the
(R)AN Release in step 1e the N2 SM information carries an acknowledgement of
the (R)AN Release. If the PDU Session Modification was requested by the UE for
a PDU Session that has no established User Plane resources, the N2 SM
information provided to the (R)AN includes information for establishment of
User Plane resources. For Network Slice Replacement if the SMF determines that
the PDU Session is to be retained, the S-NSSAI in N2 SM information is set to
Alternative S-NSSAI.
\- If the SMF has received a Requested Non-3GPP Delay Budget for a QoS flow
from the PEGC, based on the combination of S-NSSAI and DNN, SMF increases the
dynamic CN PDB as defined in clause 5.44.3.4 of TS 23.501 [2]. If the dynamic
CN PDB changes in the SMF (e.g. when an I-UPF is inserted by the SMF), SMF
applies the non-3GPP delay budget again as defined in clause 5.44.3.4 of TS
23.501 [2].
If redundant transmission has been activated on the PDU Session and the SMF
decides to stop redundant transmission in step 2a, the SMF indicates the (R)AN
to release the AN Tunnel and stop packet duplication and elimination
associated with the redundancy tunnel of the PDU Session.
The N1 SM container carries the PDU Session Modification Command that the AMF
shall provide to the UE. It may include the QoS rules, QoS Flow level QoS
parameters if needed for the QoS Flow(s) associated with the QoS rule(s) and
corresponding QoS rule operation and QoS Flow level QoS parameters operation
to notify the UE that one or more QoS rules were added, removed or modified.
For the AMF initiated the PDU Session Modification procedure in step 1h due to
network slice replacement, and if the SMF determines that the PDU Session is
to be retained, the SMF includes the Alternative S-NSSAI in the PDU Session
Modification Command to the UE and a cause value indicating that the S-NSSAI
of the PDU Session is replaced with the Alternative S-NSSAI.
If the AMF initiated the PDU Session Modification procedure in step 1h due to
network slice replacement and if the PDU Session is SSC mode 3 and if the SMF
determines that the PDU Session is to be re-established on the Alternative
S-NSSAI, the SMF includes the Alternative S-NSSAI in the PDU Session
Modification Command to the UE and a cause value indicating that a PDU Session
re-establishment on the Alternative S-NSSAI is required. The UE re-establishes
a new PDU Session on the Alternative S-NSSAI, as described in clause 5.15.19
in TS 23.501 [2]. If the PDU Session is SSC mode 1 or SSC mode 2, the SMF may
initiate release of the PDU Session as described in clause 4.3.4.2.
If port number and a Port Management Information Container have been received
from PCF in Step 2 and the port number matches the port number assigned for
the DS-TT port for this PDU session, then SMF includes the Port Management
Information Container in the N1 SM container.
The SMF may need to send transparently through NG-RAN the PDU Session
Modification Command to inform the UE about changes in the QoS parameters
(i.e. 5QI, GFBR, MFBR) that the NG-RAN is currently fulfilling after the SMF
receives QoS Notification Control as defined in clause 5.7.2.4 of TS 23.501
[2]. When the SMF sends on the PDU Session Modification Command transparently
through NG-RAN, the N2 SM information is not included as part of the
Namf_Communication_N1N2MessageTransfer.
If the UE indicated in the PCO that it supports the EDC functionality, the SMF
may indicate to the UE either that the use of the EDC functionality is allowed
for the PDU Session or that the use of the EDC functionality is required for
the PDU Session (see clause 5.2.1 of TS 23.548 [74]).
\- SMF may provide the UE with per QoS-flow Non-3GPP QoS Assistance
Information in the N1 SM container.
3b. For SMF requested modification, the SMF invokes
Namf_Communication_N1N2MessageTransfer ([N2 SM information] (PDU Session ID,
QFI(s), QoS Profile(s), [Alternative QoS Profile(s)], Session-AMBR, [CN Tunnel
Info(s)], QoS Monitoring indication, QoS Monitoring reporting frequency),
[TSCAI(s)], TL-Container, [ECN marking for L4S indicator(s)]), N1 SM container
(PDU Session Modification Command (PDU Session ID, QoS rule(s), QoS Flow level
QoS parameters if needed for the QoS Flow(s) associated with the QoS rule(s),
QoS rule operation and QoS Flow level QoS parameters operation, Session-
AMBR))).
\- For each QoS Flow, an ECN marking for L4S indicator to (R)AN in the case of
ECN marking for L4S in RAN as described in clause 5.37.3 of TS 23.501 [2]; or
a QoS monitoring configuration for congestion information as described in
clause 5.45.3 of TS 23.501 [2] in the case of ECN marking for L4S by PSA UPF
as described in clause 5.37.3 of TS 23.501 [2] or QoS monitoring for
congestion information as described in clause 5.45.3 of TS 23.501 [2].
If the SMF initiated the PDU Session Modification procedure in step 1b due to
PCF initiated SM Policy Association Modification that adds one or more PCC
Rule(s) with a TSC Assistance Container and if interworking with TSN deployed
in the transport network is supported and the NG-RAN does not support AN-TL,
the SMF instructs the NG-RAN to assign a distinct N3 tunnel end point address
for the QoS Flow(s) assigned with a TSC Assistance Container.
The SMF may indicate for each QoS Flow whether redundant transmission shall be
performed by a corresponding redundant transmission indicator. If the SMF
decides to activate redundant transmission in step 2a, the SMF includes the
allocated additional CN Tunnel Info in the N2 SM information. If the SMF
decides to perform redundant transmission for new QoS Flow with two I-UPFs in
step 2a, the SMF includes the allocated CN Tunnel Info of the two I-UPFs in
the N2 SM information.
If redundant transmission has been activated on the PDU Session and the SMF
decides to stop redundant transmission in step 2a, the SMF indicates the (R)AN
to release the AN Tunnel and stop packet duplication and elimination
associated with the redundancy tunnel of the PDU Session.
The SMF indicates the request for QoS Monitoring for the QoS Flow according to
the information received from the PCF in step 1b, or based on SMF local
policy, e.g. when the RAN rejected the creation of a specific QoS Flow. In the
case of receiving the QoS Monitoring indication, the RAN enables the RAN part
of UL/DL packet delay measurement for the QoS Flow and the QoS Monitoring
reporting frequency is used by RAN to determine the packet delay measurement
frequency of the RAN part. In the case of receiving QoS monitoring
configuration for congestion information, RAN initiates reporting of UL and/or
DL QoS Flow congestion information to PSA UPF as defined in clause 5.45.3 of
TS 23.501 [2]. The TSCAI is defined in clause 5.27.2 of TS 23.501 [2].
If the SMF initiated the PDU Session Modification procedure in step 1d due to
reception of Status group from TN CNC, the SMF includes a TL-Container with a
set-request to the N2 SM information, as described in clause 5.28a.2 of TS
23.501 [2].
If the UE is in CM-IDLE state and an ATC is activated, the AMF updates and
stores the UE context based on the Namf_Communication_N1N2MessageTransfer and
steps 4, 5, 6 and 7 are skipped. When the UE is reachable e.g. when the UE
enters CM-CONNECTED state, the AMF forwards the N1 message to synchronize the
UE context with the UE.
3c. For SMF requested modification due to updated SMF-Associated parameters
from the UDM, the SMF may provide the SMF derived CN assisted RAN parameters
tuning to the AMF. The SMF invokes Nsmf_PDUSession_SMContextStatusNotify (SMF
derived CN assisted RAN parameters tuning) towards the AMF. The AMF stores the
SMF derived CN assisted RAN parameters tuning in the associated PDU Session
context for this UE.
3d. For SMF requested modification due to updated NWDAF ID, the SMF informs
the AMF of updates of the NWDAF ID(s) used for UE related Analytics and
corresponding Analytics ID(s).
4\. The AMF may send N2 ([N2 SM information received from SMF], NAS message
(PDU Session ID, N1 SM container (PDU Session Modification Command))) Message
to the (R)AN.
5\. The (R)AN may issue AN specific signalling exchange with the UE that is
related with the information received from SMF. For example, in the case of a
NG-RAN, an RRC Connection Reconfiguration may take place with the UE modifying
the necessary (R)AN resources related to the PDU Session or if only N1 SM
container is received in step 4 from AMF, RAN transports only the N1 SM
container to the UE.
The (R)AN may consider the updated CN assisted RAN parameters tuning to
reconfigure the AS parameters.
As part of this, the N1 SM container is provided to the UE. If the N1 SM
container includes a Port Management Information Container then the UE
provides the container to DS-TT.
If new DNS server address is provided to the UE in the PCO, the UE can refresh
all EAS(s) information (e.g. DNS cache) bound to the PDU Session, based on UE
implementation as described in clause 6.2.3.2.3 of TS 23.548 [74].
6\. The (R)AN may acknowledge N2 PDU Session Request by sending a N2 PDU
Session Ack (N2 SM information (List of accepted/rejected QFI(s), AN Tunnel
Info, PDU Session ID, Secondary RAT usage data, TL-Container, BAT offset,
Periodicity, established QoS Flows status (active/not active) for QoS
monitoring configuration for congestion information, established QoS Flows
status (active/not active) for ECN marking for L4S, PDU Set Based Handling
Support Indication), User location Information) Message to the AMF. In the
case of Dual Connectivity, if one or more QFIs were added to the PDU Session,
the Master RAN node may assign one or more of these QFIs to a NG-RAN node
which was not involved in the PDU Session earlier. In this case the AN Tunnel
Info includes a new N3 tunnel endpoint for QFIs assigned to the new NG-RAN
node. Correspondingly, if one or more QFIs were removed from the PDU Session,
a (R)AN node may no longer be involved in the PDU Session anymore and the
corresponding tunnel endpoint is removed from the AN Tunnel Info. The NG-RAN
may reject QFI(s) if it cannot fulfil the User Plane Security Enforcement
information for a corresponding QoS Profile, e.g. due to the UE Integrity
Protection Maximum Data Rate being exceeded. When receiving the request for
QoS Monitoring, the (R)AN may indicate its rejection to perform QoS
Monitoring, e.g. due to the (R)AN load condition. The (R)AN may reject the
addition or modification of a QoS Flow, e.g. due to handling of the UE-Slice-
MBR as described in clause 5.7.1.10 of TS 23.501 [2]. If the (R)AN rejects the
addition or modification of a QoS Flow, the SMF is responsible of updating the
QoS rules and QoS Flow level QoS parameters associated to that QoS Flow in the
UE accordingly. NG-RAN includes the PDU Set Based Handling Support Indication
in N2 SM information as defined in clause 5.37.5.3 of TS 23.501 [2]
If the PLMN has configured secondary RAT usage reporting, the NG-RAN node may
provide RAN Usage Data Report. The User Location Information shall include the
serving cell\'s ID and if Dual Connectivity is activated for the UE, the
PSCell ID.
If the redundant transmission has not been activated to the PDU session and
the SMF indicates to the RAN that one of the QoS Flow shall perform redundant
transmission, the RAN includes an additional AN tunnel info in N2 SM
information.
If interworking with TSN deployed in the transport network is supported and
the NG-RAN supports AN-TL and received a TL-Container with a set-request from
the SM/CUC in step 3b (see clause 4.4.8 of TS 23.501 [2]), the NG-RAN/AN-TL
includes a TL-Container with a set-response to the N2 SM information, as
described in clause 5.28a.2 of TS 23.501 [2].
If the NG-RAN has determined a BAT offset and optionally a periodicity as
described in clause 5.27.2.5 of TS 23.501 [2], the NG-RAN provides the BAT
offset and optionally the periodicity in the N2 SM information.
7\. The AMF forwards the N2 SM information and the User location Information
received from the AN to the SMF via Nsmf_PDUSession_UpdateSMContext service
operation. The SMF replies with a Nsmf_PDUSession_UpdateSMContext Response.
If the N2 SM information indicates failure of whole N2 SM request (i.e. no
part of the N2 SM request is successful in (R)AN), the SMF assumes that the
NAS PDU, if provided in step 3, was not forwarded by NG-RAN to UE, as
described in TS 38.413 [10]. In this case, if the PDU Session modification is
UE triggered the SMF shall reject the PDU session modification by including a
N1 SM container with a PDU Session Modification Reject message (see clause
8.3.3 of TS 24.501 [25]) in the Nsmf_PDUSession_UpdateSMContext Response in
step 7b. Step 8 is skipped in this case.
Otherwise, the SMF assumes that the NAS PDU was sent to UE successfully. If
the (R)AN rejects QFI(s), the SMF is responsible of updating the QoS rules and
QoS Flow level QoS parameters if needed for the QoS Flow(s) associated with
the QoS rule(s) in the UE accordingly, i.e. the SMF shall trigger a separate
NAS PDU Session Modification procedure after step 11 to align the SM context
of this PDU Session in UE.
8\. The SMF may update N4 session of the UPF(s) that are involved by the PDU
Session Modification by sending N4 Session Modification Request message to the
UPF (see NOTE 3).
The SMF may update the UPF with N4 Rules related to new, modified or removed
QoS Flow(s), unless it was done already in step 2a.
NOTE 4: This allows the DL packets of the new or modified QoS Flow to be
transferred.
If an additional AN Tunnel Info is returned by RAN in step 6, the SMF informs
the UPF about this AN Tunnel Info for redundant transmission. In the case of
redundant transmission with two I-UPFs, the SMF provides AN Tunnel Info to two
I-UPFs. If CN Tunnel Info of two I-UPFs is allocated by the UPFs in step 2b,
the SMF also provides the DL CN Tunnel Info of two I-UPFs to the UPF (PSA).
If the QoS Monitoring is enabled for the QoS Flow, the SMF provides the N4
rules containing the QoS Monitoring policy generated according to the
information received in step 1b to the UPF via the N4 Session Modification
Request message.
If port number and a Port Management Information Container have been received
from PCF in Step 2 and the port number matches the port number of the NW-TT
port for this PDU session, then SMF includes the Port Management Information
Container in the N4 Session Modification Request. If the N4 Session
Modification Request includes a Port Management Information Container, then
UPF also includes a Port Management Information Container in the N4 Session
Modification Response.
If SMF decides to enable ECN marking for L4S by PSA UPF, a QoS Flow level ECN
marking for L4S indicator shall be sent by SMF to PSA UPF over N4 as described
in clause 5.37.3.3 of TS 23.501 [2].
If the N2 SM information includes the PDU Set Based Handling Support
Indication, SMF configures PSA UPF to activate PDU set identification and
marking for the QoS flow.
9\. The UE acknowledges the PDU Session Modification Command by sending a NAS
message (PDU Session ID, N1 SM container (PDU Session Modification Command
Ack, [Port Management Information Container])) message.
10\. The (R)AN forwards the NAS message to the AMF.
11\. The AMF forwards the N1 SM container (PDU Session Modification Command
Ack) and User Location Information received from the AN to the SMF via
Nsmf_PDUSession_UpdateSMContext service operation. The SMF replies with a
Nsmf_PDUSession_UpdateSMContext Response.
If the SMF initiated modification is to delete QoS Flows (e.g. triggered by
PCF) which do not include QoS Flow associated with the default QoS rule and
the SMF does not receive response from the UE, the SMF marks that the status
of those QoS Flows is to be synchronized with the UE.
If interworking with TSN deployed in the transport network is supported, for
any QoS Flow including a TSC Assistance Container, the SMF/CUC derives the
merged stream requirements as described in Annex M of TS 23.501 [2]. If AN-TL
and CN-TL are supported, the SMF/CUC uses the get-responses stored during the
PDU Session Establishment procedure to derive the merged stream requirements.
The SMF/CUC interacts with the CNC deployed in the transport network and
provides the merged stream requirements in the Talker and Listener groups to
the TN CNC. The TN CNC uses the merged stream requirements as input to select
respective path(s) and calculate schedules in TN.
Based on the results, the TN CNC provides a Status group that contains the
merged end station communication-configuration back to the SMF/CUC.
12\. The SMF may update N4 session of the UPF(s) that are involved by the PDU
Session Modification by sending N4 Session Modification Request (N4 Session
ID) message to the UPF. For a PDU Session of Ethernet PDU Session Type, the
SMF may notify the UPF to add or remove Ethernet Packet Filter Set(s) and
forwarding rule(s).
NOTE 5: The UPFs that are impacted in the PDU Session Modification procedure
depends on the modified QoS parameters and on the deployment. For example in
the case of the session AMBR of a PDU Session with an UL CL changes, only the
UL CL is involved. This note also applies to the step 8.
13\. If the SMF interacted with the PCF in step 1b or 2, the SMF notifies the
PCF whether the PCC decision could be enforced or not by performing an SMF
initiated SM Policy Association Modification procedure as defined in clause
4.16.5.1. If the trigger for 5GS Bridge/Router information available is armed
and the SMF received a Port Management Information Container from either UE or
UPF, then SMF provides the Port Management Information Container and the port
number of the related port to the PCF in this step, as described in clause
5.28.3.2 of TS 23.501 [2]. If the trigger for 5GS Bridge/Router information
available is armed and the SMF received the User Plane node Management
Information Container from UPF, then the SMF provides the User Plane node
Management Information Container to the PCF as described in clause 5.28.3.2 of
TS 23.501 [2]. If trigger for Notification on BAT offset is armed and the SMF
received BAT offset and/or Periodicity from the RAN, then the SMF provides the
BAT offset and/or Periodicity to the PCF as described in clause 5.27.2.5 of TS
23.501 [2].
SMF notifies any entity that has subscribed to User Location Information
related with PDU Session change.
If step 1b is triggered to perform Application Function influence on traffic
routing by step 5 in clause 4.3.6.2, the SMF may reconfigure the User Plane of
the PDU Session as described in step 6 in clause 4.3.6.2.
If interworking with TSN deployed in the transport network is supported and if
the Status group from TN CNC to SMF/CUC in step 11 includes
InterfaceConfiguration and if the AN-TL/CN-TL are supported, the SMF/CUC
initiates a PDU Session Modification procedure as in step 1d.
#### 4.3.3.3 UE or network requested PDU Session Modification (home-routed
roaming)
The UE or network requested PDU Session Modification procedure (home-routed
roaming scenario) is depicted in figure 4.3.3.3-1.
Figure 4.3.3.3-1: UE or network requested PDU Session Modification (for home-
routed roaming scenario)
1\. The procedure is triggered by one of the following events:
1a. (UE or serving network requested) As in step 1a of clause 4.3.3.2 with the
addition that:
\- The V-SMF checks whether it can accept the request from the UE;
\- The V-SMF invokes an Nsmf_PDUSession_Update Request (SM Context ID, UE
request for PDU Session Modification or the QoS modification request from the
VPLMN, UE location information, Time Zone, the current Access Type, PCO,
[Always-on PDU Session Requested]) service operation to inform the H-SMF to
update the PDU Session. The H-SMF responds to the request immediately. If the
AMF notified the V-SMF that the access type of the PDU session can be changed,
as described in the UE Triggered Service Request procedure in clause 4.2.3.2,
the V-SMF shall also indicate that the access type can be changed.
The PS Data Off status, if changed, shall be included in PCO (Protocol
Configuration Option) in the PDU Session Modification Request message.
When PCF is deployed, the SMF shall further report the PS Data Off status to
PCF if the PS Data Off event trigger is provisioned, the additional behaviour
of SMF and PCF for 3GPP PS Data Off is defined in TS 23.503 [20].
1b. (HPLMN requested) This step is the same as step 1b in clause 4.3.3.2. If
the H-SMF received the indication that the access type of the PDU session can
be changed, the H-SMF shall indicate the target access type to the PCF in the
Access Type information of the Npcf_SMPolicyControl_Update Request.
1c. (HPLMN requested) This step is the same as step 1c in clause 4.3.3.2.
1d. (HPLMN requested) This step is the same as step 1d in clause 4.3.3.2.
1e. As in step 1e of clause 4.3.3.2 with addition that:
\- The AMF invokes Nsmf_PDUSession_UpdateSMContext (SM context ID, N2 SM
information) and sends it to the V-SMF;
\- The V-SMF invokes an Nsmf_PDUSession_Update Request (SM context ID, ULI, AN
type, QoS Flow to be released) service operation to inform the H-SMF to update
the PDU Session. The H-SMF responds to the request immediately. For AN
initiated notification control in step 1e of clause 4.3.3.2, the V-SMF
includes also QoS Flow notification information as specified in clause 5.7 of
TS 23.501 [2].
NOTE 1: SM Context ID between AMF and V-SMF and between V-SMF and H-SMF are
different. SM Context ID has local significance per SMF instance.
1f. (Slice Replacement) As in step 1h of clause 4.3.3.2 with addition:
\- When the AMF determines as described in clause 5.15.19 of TS 23.501 [2]
that VPLMN S-NSSAI is to be replaced by an Alternative VPLMN S-NSSAI, and/or
HPLMN S-NSSAI is to be replaced by an Alternative HPLMN S-NSSAI, the AMF
invokes Nsmf_PDUSession_UpdateSMContext (SM context ID, VPLMN S-NSSAI,
Alternative VPLMN S-NSSAI, HPLMN S-NSSAI, Alternative HPLMN S-NSSAI) and sends
it to the V-SMF. If the AMF determines that the current PDU Session cannot be
retained (e.g. the current V-SMF cannot support the Alternative VPLMN
S-NSSAI), the AMF includes a release indication.
\- If Alternative HPLMN S-NSSAI is received from the AMF, the V-SMF invokes an
Nsmf_PDUSession_Update Request (SM context ID, HPLMN S-NSSAI, Alternative
HPLMN S-NSSAI) service operation to inform the H-SMF. The H-SMF responds to
the request immediately. The V-SMF forwards the release indication if it is
received from the AMF.
2\. This step is the same as steps 2 in clause 4.3.3.2 with the SMF is H-SMF.
3\. (UE or serving network requested or HPLMN requested) The H-SMF invokes the
Nsmf_PDUSession_Update Request (SM Context ID, QoS profiles, [Alternative QoS
profile(s)], Session-AMBR, information needed to build the SM PDU Session
Modification Command message towards the UE including the QoS rule(s) and QoS
Flow level QoS parameters if needed for the QoS Flow(s) associated with the
QoS rule(s) and QoS rule operation and the QoS Flow level QoS parameters
operation) service operation to the V-SMF.
Based on operator policies and roaming agreements, the V-SMF may decide to
fully accept or reject the QoS information provided by the H-SMF. The V-SMF
shall also be able to accept a subset of the QoS flows requested to be created
or modified within a single H-SMF request i.e. V-SMF can accept some QoS flows
and reject other QoS flows in same response to H-SMF.
If an Always-on PDU Session Granted indication was provided by the H-SMF to
indicate that the PDU Session is to be changed to an always-on PDU Session,
the V-SMF decides whether to accept or reject the request from the H-SMF based
on local policies.
For network slice replacement, based on the information received from the
V-SMF, the H-SMF determines whether to retain the PDU Session as described in
clause 5.15.19 of TS 23.501 [2]. If the H-SMF decides to retain the PDU
Session, the H-SMF includes the Alternative HPLMN S-NSSAI and a cause value
indicating that the PDU Session is to be retained in the
Nsmf_PDUSession_Update Request message. For SSC mode 3 PDU Session if the
H-SMF decides to establish a new PDU Session on the Alternative HPLMN S-NSSAI,
the H-SMF includes Alternative HPLMN S-NSSAI and a cause value indicating that
a new PDU Session re-establishment on the Alternative HPLMN S-NSSAI is
required in the Nsmf_PDUSession_Update Request message. For SSC mode 1 and SSC
mode 2 PDU session if the H-SMF decides to establish a new PDU Session on the
HPLMN Alternative S-NSSAI, the H-SMF initiates release of the PDU Session as
described in clause 4.3.4.3.
3a-3b (HPLMN requested) These steps are executed if new QoS Flow(s) are to be
created. The SMF updates the UPF with UL Packet Detection Rules of the new QoS
Flow. These steps are executed if the HPLMN S-NSSAI is replaced by an
Alternative HPLMN S-NSSAI and the PDU Session is retained. The SMF updates the
UPF with Alternative S-NSSAI.
NOTE 2: This allows the UL packets with the QFI of the new QoS Flow to be
transferred.
4a-4b. These steps are the same as step 3a-3b in clause 4.3.3.2 but controlled
from the V-SMF. The V-SMF uses the information received in step 3 to generate
any N1 and/or N2 signalling to be sent towards the UE and/or the (R)AN.
For network slice replacement in step 1f, the following applies:
\- If the PDU Session is to be retained and only the VPLMN S-NSSAI is to be
replaced by an Alternative VPLMN S-NSSAI, the V-SMF includes Alternative VPLMN
S-NSSAI in the N1 PDU Session Modification Command message and a cause value
to notify the UE that the VPLMN S-NSSAI of the PDU Session is replaced with
the Alternative VPLMN S-NSSAI. The V-SMF also set the S-NSSAI in N2 SM
information to Alternative VPLMN S-NSSAI.
\- If the PDU Session is to be retained and only the HPLMN S-NSSAI is to be
replaced by an Alternative HPLMN S-NSSAI, the V-SMF includes Alternative HPLMN
S-NSSAI in the N1 PDU Session Modification Command message and a cause value
to notify the UE that the HPLMN S-NSSAI is replaced with the Alternative HPLMN
S-NSSAI
\- If the PDU Session is to be retained and both VPLMN S-NSSAI and HPLMN
S-NSSAI are to be replaced, the V-SMF includes Alternative HPLMN S-NSSAI and
VPLMN Alternative S-NSSAI in the N1 PDU Session Modification Command message
and a cause value to notify the UE that the HPLMN S-NSSAI is replaced with the
Alternative HPLMN S-NSSAI and the VPLMN S-NSSAI of the PDU Session is replaced
with Alternative VPLMN S-NSSAI. The V-SMF sets the S-NSSAI in N2 SM
information to Alternative VPLMN S-NSSAI.
\- If a new PDU Session establishment is required, the V-SMF includes
Alternative HPLMN S-NSSAI and/or Alternative VPLMN S-NSSAI in the N1 PDU
Session Modification Command message and a cause value to notify the UE that a
new PDU Session establishment on the HPLMN Alternative S-NSSAI and/or
Alternative VPLMN S-NSSAI is required.
5-7. These steps are the same as step 4-6 in clause 4.3.3.2.
8\. This step is the same as step 7a in clause 4.3.3.2 with the difference
that the SMF is V-SMF.
If the N2 SM information indicates modification failure and the V-SMF rejected
the PDU session modification as described in step 7 in clause 4.3.3.2, step 9
is skipped.
9a-9b are the same as step 8a-8b in clause 4.3.3.2 but executed in Visited
PLMN
10\. This step is the same as step 7b in clause 4.3.3.2 with the difference
that the SMF is V-SMF.
11-12. These steps are the same as steps 8-9 in 4.3.3.2.
13-14. These steps are the same as step 11a-11b in clause 4.3.3.2 but executed
in Visited PLMN.
15\. V-SMF responds to the H-SMF with an Nsmf_PDUSession_Update response
carrying the information like PCO provided by the UE in the SM PDU Session
Modification Command Ack message from the UE to the V-SMF, Secondary RAT usage
data. The H-SMF shall modify the PDU Session context.
If the V-SMF has rejected QFI(s) (step3) or the (R)AN has rejected QFI(s) in
step 6 of Figure 4.3.3.2-1, the H-SMF is responsible of later updating the QoS
rules and QoS Flow level QoS parameters if needed for the QoS Flow(s)
associated with the QoS rule(s) in the UE.
16-17. These steps are the same as steps 12-13 in clause 4.3.3.2 with the
difference that the SMF is H-SMF.
### 4.3.4 PDU Session Release
#### 4.3.4.1 General
The PDU Session Release procedure is used to release all the resources
associated with a PDU Session, including:
\- The IP address/Prefixes allocated for an IP-based PDU Session; this may
include the release of multiple Prefixes in the case of Multi-homing (as
defined in TS 23.501 [2]).
\- Any UPF resource (including N3/N9/N19 termination) that was used by the PDU
Session. For N19 termination, the UPF resource may be released if all the PDU
Sessions associated with the 5G VN group are released.
\- Any access resource that was used by the PDU Session.
The SMF takes care to notify any entity associated with PDU Session: PCF, DN
(e.g. when DN authorization has taken place at PDU Session establishment),
etc. of a PDU Session Release.
#### 4.3.4.2 UE or network requested PDU Session Release for Non-Roaming and
Roaming with Local Breakout
Figure 4.3.4.2-1 captures both the UE Requested PDU Session Release procedure
and the network requested PDU Session Release procedure. The procedure allows
the UE to request the release of one PDU Session. The procedure also allows
the AMF, the SMF or the PCF to initiate the release of a PDU Session. In the
case of LBO, the procedure is as in the case of non-roaming with the
difference that the AMF, the SMF, the UPF and the PCF are located in the
visited network.
Figure 4.3.4.2-1: UE or network requested PDU Session Release for non-roaming
and roaming with local breakout
1\. The procedure is triggered by one of the following events:
1a. (UE requested) The UE initiates the UE Requested PDU Session Release
procedure by the transmission of an NAS message (N1 SM container (PDU Session
Release Request (PDU session ID)), PDU Session ID) message. The NAS message is
forwarded by the (R)AN to the AMF with an indication of User Location
Information. This message is relayed to the SMF corresponding to the PDU
Session ID via N2 and the AMF. The AMF invokes the
Nsmf_PDUSession_UpdateSMContext service operation and provides the N1 SM
container to the SMF together with User Location Information (ULI) received
from the (R)AN.
NOTE 1: Depending on the Access Type, when the UE is in CM-IDLE state, the UE
can trigger a Service Request procedure before being able to release the PDU
Session.
1b. (PDU Session Release initiated by the PCF) The PCF may invoke an SM Policy
Association Termination procedure as defined in clause 4.16.6 to request the
release of the PDU Session.
1c. The AMF may invoke the Nsmf_PDUSession_ReleaseSMContext service operation
to request the release of the PDU Session in the case of mismatch of PDU
Session status between UE and AMF or other cases where neither N1 nor N2 SM
signalling is needed before the releasing of SM context.
1d. (R)AN may decide to indicate to the SMF that the PDU Session related
resource is released, e.g. when all the QoS Flow(s) of the PDU Session are
released.
NOTE 2: In this case, it\'s up to SMF to decide whether to keep the PDU
Session with user plane connection deactivated or release the PDU Session.
1e. (PDU Session Release initiated by the SMF).
The SMF may decide to release a PDU Session under the following scenarios:
\- Based on a request from the DN (cancelling the UE authorization to access
to the DN);
\- Based on a request from the UDM (subscription change) or from the CHF;
\- If the SMF received an event notification from the AMF that the UE is out
of LADN service area;
\- Based on locally configured policy (e.g. the release procedure may be
related with the UPF re-allocation for SSC mode 2 / mode 3);
\- If the SMF is notified by the (R)AN that the PDU Session resource
establishment has failed during mobility procedure;
\- The SMF initiates release of an emergency PDU Session when the UPF reports
detection of PDU Session inactivity for a specified period as specified in
clause 4.4.2.2;
\- Based on PDU Session inactivity report from the UPF if the S-NSSAI of a PDU
Session for non-roaming subscribers is subject to usage control as described
in clause 5.15.15 of TS 23.501 [2]; or
\- If the SMF is notified by the AMF that the S-NSSAI of the PDU Session with
SSC mode 1 or SSC mode 2 is to be replaced with Alternative S-NSSAI, and if
the SMF determines that a new PDU Session is to be established on the
Alternative S-NSSAI, the SMF initiates release of the PDU Session, as
described in clause 5.15.19 of TS 23.501 [2].
1f. The AMF may invoke the Nsmf_PDUSession_UpdateSMContext service operation
with a release indication to request the release of the PDU Session where N1
or N2 SM signalling may be needed before releasing the SM context with
appropriate cause value (e.g. due to a change of the set of network slices for
a UE where a network slice instance is no longer available as described in
clause 5.15.5.2.2 of TS 23.501 [2] or the AAA Server triggered Network Slice-
Specific Re-authentication and Re-authorization procedure fails as specified
in clause 4.2.9.2 or the AAA Server triggered Slice-Specific Authorization
Revocation takes place as specified in clause 4.2.9.4 or AMF determines that
Control Plane Only indication associated with PDU Session is not applicable
any longer as described in clause 5.31.4.1 of TS 23.501 [2]) or the MBSR
authorization state is changed from \"authorized\" to \"not authorized\" as
described in clause 5.35A.4 of TS 23.501 [2] or the Network Slice instance is
congested or not available as described in clause 5.15.5.3 of TS 23.501 [2].
If the SMF receives one of the triggers in step 1a, 1b, 1c, 1e, or 1f, the SMF
starts PDU Session Release procedure. If the cause value in step 1f indicates
the Network Slice instance is congested or not available, the SMF triggers the
impacted UE(s) to establish new PDU session(s) associated with the same
S-NSSAI by using the procedures for PDU Session(s) of SSC mode 2 or SSC mode 3
as defined in clause 4.3.5.
2\. The SMF releases the IP address / Prefix(es) that were allocated to the
PDU Session and releases the corresponding User Plane resources:
2a. The SMF sends an N4 Session Release Request (N4 Session ID) message to the
UPF(s) of the PDU Session. The UPF(s) shall drop any remaining packets of the
PDU Session and release all tunnel resource and contexts associated with the
N4 Session.
2b. The UPF(s) acknowledges the N4 Session Release Request by the transmission
of an N4 Session Release Response (N4 Session ID, [Small Data Rate Control
Status], [APN Rate Control Status]) message to the SMF.
The UPF includes Small Data Rate Control Status if the PDU Session used Small
Data Rate Control.
If a NEF has been selected as anchor of the Control Plane CIoT 5GS
Optimisation enabled PDU session which is Unstructured PDU Session Type as
described in clause 4.3.2.2 and the SMF-NEF Connection is released for this
PDU Session.
NOTE 3: If there are multiple UPFs associated with the PDU Session (e.g. due
to the insertion of UL CL or Branching Point, or redundant I-UPFs if the
redundant I-UPFs are used for URLLC), the Session Release Request procedure
(steps 2a and 2b) is done for each UPF. In order to avoid charging of PDUs
that later get dropped, the SMF performs the N4 Session Release first with the
UPF(s) performing usage reporting, before releasing the other UPF(s) that
forward traffic for the same user plane resources.
3 If the PDU Session Release is initiated by the PCF and SMF and the SMF has
been notified by the AMF that UE is unreachable, e.g. due to the UE is in MICO
mode or periodical registration failure, the procedure continues in step 11 by
SMF notifying the AMF that the PDU Session is released by invoking the
Nsmf_PDUSession_SMContextStatusNotify. The rest of step 3 and the steps 4-10
are skipped.
If the PDU Session Release procedure was triggered by steps 1a, 1b, 1d or 1e
above, the SMF creates an N1 SM including PDU Session Release Command message
(PDU Session ID, Cause, Alternative S-NSSAI). The Cause may indicate a trigger
to establish a new PDU Session with the same characteristics (e.g. when
procedures related with SSC mode 2 are invoked). .If the cause value indicates
that a PDU Session re-establishment on the Alternative S-NSSAI is required the
PDU Session Release Command message also includes the Alternative S-NSSAI. The
UE establishes a new PDU Session on the Alternative S-NSSAI, as described in
clause 5.15.19 of TS 23.501 [2].
If the User Plane connection of the PDU Session is activated, the message sent
by the SMF to the AMF shall include N2 SM Resource Release request. If the
User Plane connection of the PDU Session is not activated, the message sent by
the SMF to the AMF shall not include N2 SM Resource Release request.
NOTE 4: SSC modes are defined in clause 5.6.9 of TS 23.501 [2].
3a. (If the PDU Session Release is initiated by the UE in step 1a or has been
triggered by (R)AN in step 1d) The SMF responds to the AMF with the
Nsmf_PDUSession_UpdateSMContext response (N2 SM Resource Release request, N1
SM container (PDU Session Release Command)). N2 SM Resource Release request is
included if the PDU Session Release is initiated by the UE and if the UP
connection of the PDU Session is active. Neither N2 SM Resource Release
request nor N1 SM container is included if the PDU Session Release is
triggered by (R)AN and the SMF decides to keep the PDU session with user plane
connection deactivated and the subsequent steps are skipped.
3b. If the PDU Session Release is initiated by the SMF or the PCF, the SMF
invokes the Namf_Communication_N1N2MessageTransfer service operation (N1 SM
container (PDU Session Release Command), skip indicator).
If the UP connection of the PDU Session is active, the SMF shall also include
the N2 Resource Release request (PDU Session ID) in the
Namf_Communication_N1N2MessageTransfer, to release the (R)AN resources
associated with the PDU Session.
The \"skip indicator\" tells the AMF whether it may skip sending the N1 SM
container to the UE (e.g. when the UE is in CM-IDLE state). SMF includes the
\"skip indicator\" in the Namf_Communication_N1N2MessageTransfer except when
the procedure is triggered to change PDU Session Anchor of a PDU Session with
SSC mode 2.
If the UE is in CM-IDLE state and \"skip indicator\" is included in the
Namf_Communication_N1N2MessageTransfer service operation or if the UE is in
CM-IDLE state and \"skip indicator\" is not included in the
Namf_Communication_N1N2MessageTransfer service operation but the AMF detects
that the UE context contains Paging Restriction Information indicating that
all paging is restricted, the AMF acknowledges the step 3b by sending an
Namf_Communication_N1N2MessageTransfer Response message (\"N1 SM Message Not
Transferred\") to SMF and steps 4 to 10 are skipped.
3c. If the PDU Session Release is initiated by the AMF in step 1c, i.e. the
SMF received the Nsmf_PDUSession_ReleaseSMContext Request from the AMF, the
SMF responds to the AMF with the Nsmf_PDUSession_ReleaseSMContext response,
optionally including the Small Data Rate Control Status and APN Rate Control
Status.
If the UPF included APN Rate Control Status and/or Small Data Rate Control
Status in step 2 then the SMF includes APN Rate Control and/or Small Data Rate
Control Status and the AMF stores the Small Data Rate Control Status and/or
the APN Rate Control Status in the UE context in AMF.
The AMF and SMF shall remove all contexts (including the PDU Session ID)
associated with the PDU Session which are indicated as released at the UE. The
SMF shall remove any event subscriptions on the AMF by the SMF that becomes no
more needed due to the PDU Session Release. The steps 4 to 11 are skipped.
3d. If the PDU Session Release is initiated by the AMF in step 1f, i.e. the
SMF received the Nsmf_PDUSession_UpdateSMContext Request from the AMF with a
release indication to request the release of the PDU Session, the SMF responds
to the AMF with the Nsmf_PDUSession_UpdateSMContext Response which may contain
the N1 SM container (PDU Session Release Command) to release the PDU session
at the UE.
If the UP connection of the PDU Session is active, the
Nsmf_PDUSession_UpdateSMContext Response shall also include the N2 Resource
Release request (PDU Session ID) to release the (R)AN resources associated
with the PDU Session.
4\. If the UE is in CM-IDLE state and \"N1 SM delivery can be skipped\" is not
indicated, the AMF initiates the network triggered Service Request procedure
to transmit the NAS message (PDU Session ID, N1 SM container) to the UE and
the steps 6, 7 are skipped.
If the message received from the SMF in step 3 does not include N2 SM Resource
Release request, the AMF transmits the NAS message (PDU Session ID, N1 SM
container) to the UE and the steps 6, 7 are skipped.
If the PDU Session is Control Plane CIoT 5GS Optimisation enabled, the SMF
shall not include N2 SM Resource Release request in the message sent to the
AMF, the AMF transmits the NAS message (PDU Session ID, N1 SM container) to
the UE and the steps 6, 7 are skipped.
If the UE is in CM-CONNECTED state and the received message from the SMF in
step 3 includes N2 SM Resource Release request, the AMF transfers the SM
information received from the SMF in step 4 (N2 SM Resource Release request,
N1 SM container) to the (R)AN.
If the message from the SMF includes Small Data Rate Control Status then the
AMF stores it in the UE Context in AMF.
5\. When the (R)AN has received an N2 SM request to release the AN resources
associated with the PDU Session it issues AN specific signalling exchange(s)
with the UE to release the corresponding AN resources.
In the case of a NG-RAN, the NAS message is sent to the UE in an RRC message
which may take place with the UE releasing the NG-RAN resources related to the
PDU Session. If NG-RAN resources do not need to be released (i.e. the User
Plane of the PDU Session is deactivated), the NAS message is sent to the UE in
an RRC message which does not release the NG-RAN resources related to the PDU
Session.
During this procedure, the (R)AN sends any NAS message (N1 SM container (PDU
Session Release Command)) received from the AMF in step 5.
For PDU Session for non-roaming subscribers, if the S-NSSAI of the released
PDU Session is subject to network slice usage control as described in clause
5.15.15 of TS 23.501 [2] and there is no other PDU Session using the S-NSSAI,
the UE starts slice deregistration inactivity timer for the S-NSSAI.
6\. [Conditional] If the (R)AN had received a N2 SM request to release the AN
resources, the (R)AN acknowledges the N2 SM Resource Release Request by
sending an N2 SM Resource Release Ack (User Location Information, Secondary
RAT usage data) Message to the AMF.
If the PLMN has configured secondary RAT usage reporting, the NG-RAN node may
provide RAN Usage Data Report.
7a. The AMF invokes the Nsmf_PDUSession_UpdateSMContext (N2 SM Resource
Release Ack (Secondary RAT usage data), User Location Information) to the SMF.
7b. The SMF responds to the AMF with an Nsmf_PDUSession_UpdateSMContext
response.
8\. The UE acknowledges the PDU Session Release Command by sending a NAS
message (PDU Session ID, N1 SM container (PDU Session Release Ack)) message
over the (R)AN.
9\. [Conditional] The (R)AN forwards the NAS message from the UE by sending a
N2 NAS uplink transport (NAS message (PDU Session ID, N1 SM container (PDU
Session Release Ack)), User Location Information) to the AMF.
10a. The AMF invokes the Nsmf_PDUSession_UpdateSMContext (N1 SM container (PDU
Session Release Ack, User Location Information) to the SMF.
10b. The SMF responds to the AMF with an Nsmf_PDUSession_UpdateSMContext
response.
Steps 8-10 may happen before steps 6-7.
11\. If steps 3a, 3b or 3d were performed, the SMF waits until it has received
replies to the N1 and N2 information provided in step 3, as needed.
The SMF invokes Nsmf_PDUSession_SMContextStatusNotify to notify AMF that the
SM context for this PDU Session is released. If the UPF included Small Data
Rate Control Status and/or APN Rate Control Status in step 2 then the SMF
includes Small Data Rate Control Status and/or APN Rate Control Status in its
request to the AMF in this step. The AMF releases the association between the
SMF ID and the PDU Session ID, DNN, as well as S-NSSAI and stores the Small
Data Rate Control Status and/or the APN Rate Control Status in the UE context
in AMF. The SMF shall remove any event subscriptions on the AMF that becomes
no more needed due to the PDU Session Release.
NOTE 5: The UE and the 5GC will get synchronized about the status of the
(released) PDU Session at the next Service Request or Registration procedure.
For PDU Session for non-roaming subscribers, if the S-NSSAI of the released
PDU Session is subject to network slice usage control and if the SMF indicates
cause of slice inactivity and there is no other PDU Session using the S-NSSAI,
then AMF may remove the S-NSSAI from the Allowed NSSAI or start slice
deregistration inactivity timer for the S-NSSAI as described in clause
5.15.15.3 of TS 23.501 [2].
12\. If Dynamic PCC applied to this session the SMF invokes an SM Policy
Association Termination procedure as defined in clause 4.16.6 to delete the
PDU Session.
13\. SMF notifies any entity that has subscribed to User Location Information
related with PDU Session change.
14\. If it is the last PDU Session the SMF is handling for the UE for the
associated (DNN, S-NSSAI), the SMF unsubscribes from Session Management
Subscription data changes notification with the UDM by means of the
Nudm_SDM_Unsubscribe (SUPI, DNN, S-NSSAI) service operation. The UDM may
unsubscribe the subscription notification from UDR by Nudr_DM_Unsubscribe
(SUPI, Subscription Data, Session Management Subscription data, DNN, S-NSSAI).
15\. The SMF invokes the Nudm_UECM_Deregistration service operation including
the DNN and the PDU Session Id. The UDM removes the association it had stored
between the SMF identity and the associated DNN and PDU Session Id. The UDM
may update this information by Nudr_DM_Update (SUPI, Subscription Data, UE
context in SMF data).
#### 4.3.4.3 UE or network requested PDU Session Release for Home-routed
Roaming
This procedure is used in the case of home-routed roaming scenarios.
Figure 4.3.4.3-1: UE or network requested PDU Session Release for home-routed
roaming
1\. The procedure is triggered by one of the following events:
1a. (UE initiated release) As in step 1a of clause 4.3.4.2 with the addition
that:
\- the V-SMF initiates N4 Session Modification to instruct the V-UPF to stop
forwarding uplink traffic; and
\- the V-SMF invokes the Nsmf_PDUSession_Update Request (SM Context ID,
information from the SM message from the UE e.g. PCO, \"Trigger PDU Session
Release\" indication, Timezone, User Location Information) service operation
to request the H-SMF to release the PDU Session. The H-SMF responds to the
request immediately.
1b. (Serving network initiated release) The serving network initiates the PDU
Session Release during UE or serving network initiated Deregistration
procedure as specified in clause 4.2.2.3. There is no NAS SM message between
the UE and the V-SMF in this case. This step is the same as step 1c in clause
4.3.4.2, with the addition that:
\- the V-SMF initiates N4 Session Modification to instruct the V-UPF to stop
forwarding uplink traffic; and
\- the V-SMF initiates the release of the PDU Session at the H-SMF by invoking
the Nsmf_PDUSession_Release request.
The serving network also initiates the PDU Session Release where neither N1
nor N2 SM signalling is needed before releasing the SM context as in step 1c
in clause 4.3.4.2 if e.g. due to the set of network slices for a UE changes
where a network slice instance is no longer available (e.g. as described in
clause 5.15.5.2.2 of TS 23.501 [2], or the AAA Server triggered Network Slice-
Specific Re-authentication and Re-authorization procedure fails as specified
in clause 4.2.9.2 or the AAA Server triggered Slice-Specific Authorization
Revocation takes place as specified in clause 4.2.9.4).
1c. (HPLMN initiated release) This step is the same as step 1b in clause
4.3.4.2, with the addition that:
\- the H-SMF initiates N4 Session Modification to instruct the H-UPF to stop
forwarding downlink traffic.
1d. This step is the same as step 1d in clause 4.3.4.2, with the addition
that:
\- the V-SMF initiates N4 Session Modification to instruct the V-UPF to stop
forwarding uplink traffic; and
\- the V-SMF invokes the Nsmf_PDUSession_Update Request towards H-SMF.
1e. (HPLMN initiated release) This step is the same as step 1e in clause
4.3.4.2, with the addition that:
\- if the H-SMF is notified by the V-SMF that the HPLMN S-NSSAI of the PDU
Session with SSC mode 1 or SSC mode 2 is to be replaced with Alternative HPLMN
S-NSSAI and if the H-SMF determines that a new PDU Session is to be
established on the Alternative HPLMN S-NSSAI, the H-SMF initiates release of
the PDU Session, as described in clause 5.15.19 of TS 23.501 [2];
\- the H-SMF initiates N4 Session Modification to instruct the H-UPF to stop
forwarding downlink traffic.
1f. This step is the same as step 1f in clause 4.3.4.2, with the addition
that:
\- the V-SMF initiates N4 Session Modification to instruct the V-UPF to stop
forwarding uplink traffic; and
\- the V-SMF invokes the Nsmf_PDUSession_Update Request towards H-SMF.
If the SMF receives one of the triggers in step 1a, 1c, 1e or 1f, the H-SMF
starts PDU Session Release procedure.
When a SMF above initiates N4 Session Modification to instruct the UPF to stop
forwarding traffic this means also to stop taking into account the traffic for
usage monitoring.
2a-2b. (UE-, (R)AN- or Serving network initiated) This step is performed in
case the PDU Session Release is triggered by a message from V-SMF. These steps
are the same as steps 2a-2b in clause 4.3.4.2. The SMF is the SMF in HPLMN.
NOTE 1: This step 2a-2b can correspond to steps 1a, 1b, 1d, 1f.
3a. (UE or HPLMN initiated release) The H-SMF prepares the SM Release PDU
Session Command message and initiates the PDU Session Release towards the UE
by invoking the Nsmf_PDUSession_Update Request service operation towards the
V-SMF. The Nsmf_PDUSession_Update Request contains necessary information to
build the SM Release PDU Session Command by the V-SMF towards the UE (for
example a Release Cause or PCO).
For network slice replacement as in step 1e, the H-SMF includes Alternative
HPLMN S-NSSAI and a cause value indicating that a new PDU Session re-
establishment on the Alternative HPLMN S-NSSAI is required.
3b. (Serving network initiated release) The H-SMF responds to the PDU release
request from the V-SMF with a Nsmf_PDUSession_Release response.
If the UPF included Small Data Rate Control Status in step 2 then the SMF
includes Small Data Rate Control Status in the request to the AMF.
If the Control Plane CIoT 5GS Optimisation is enabled for this PDU Session,
the steps 4a and 4b are skipped.
4a-4b. The V-SMF releases the corresponding User Plane resources. This
includes the same procedure in step 2 but controlled from the SMF in VPLMN.
5-13. These steps are the same as steps 3-10 in clause 4.3.4.2, with the
addition that:
\- In step 5c, for network slice replacement, based on information from H-SMF,
the PDU Session Release Command message may include Alternative HPLMN S-NSSAI
and/or Alternative VPLMN S-NSSAI and a cause value indicating that a PDU
Session re-establishment on the Alternative HPLMN S-NSSAI and/or Alternative
VPLMN S-NSSAI is required.
14\. (UE or HPLMN initiated release) The V-SMF responds to the
Nsmf_PDUSession_Update Request invoked at step 3a and confirms the PDU Session
Release. The Nsmf_PDUSession_Update response may carry information such as PCO
received from the UE in SM PDU Session Release Accept. as well as User
Location Information, Time Zone and Secondary RAT Usage Data.
15a. (UE or HPLMN or Serving network initiated release) The H-SMF releases the
SM policy control association with the PCF by invoking the SM Policy
Association Termination procedure defined in clause 4.16.6. For serving
network initiated PDU Session Release case, this step happens between step 1b
and step 3b.
15b-15c. (HPLMN initiated release) In case the PDU Session Release is HPLMN-
initiated (i.e. triggers in 1c, 1e), the H-SMF releases the corresponding User
Plane resources. This includes the same procedure as in step 2.
15d. As in step 15 of clause 4.3.4.2, the SMF invokes the
Nudm_UECM_Deregistration service operation.
NOTE 2: Step 15d does not necessarily take place after step 15c.
16\. (UE or HPLMN initiated release) The H-SMF shall remove all contexts
associated with the PDU Session:
16a. The H-SMF requests the V-SMF to release all contexts associated with the
PDU Session by invoking the Nsmf_PDUSession_StatusNotify (Release) operation.
16b. The V-SMF requests the AMF to release all contexts associated with the
PDU Session by invoking the Nsmf_PDUSession_SMContexStatusNotify (Release).
The AMF releases the association between the SMF ID and the PDU Session ID.
### 4.3.5 Session continuity, service continuity and UP path management
#### 4.3.5.1 Change of SSC mode 2 PDU Session Anchor with different PDU
Sessions
The following procedure is triggered by SMF in order to change the PDU Session
Anchor serving a PDU Session of SSC mode 2 for a UE when neither multi-homing
nor UL CL applies to the PDU Session. This procedure releases the existing PDU
Session associated with an old PDU Session Anchor (i.e. UPF1 in figure
4.3.5.1-1) and immediately establishes a new PDU Session with a new PDU
Session Anchor (i.e. UPF2 in figure 4.3.5.1-1) to the same DN.
Figure 4.3.5.1-1: Change of SSC mode 2 PSA for a PDU Session
1\. The SMF determines that the serving UPF needs to be changed due to events
that may benefit from such change.
1a. If the UPF (PSA) cannot connect to the target DNAI that SMF received from
SM-PCF, the SMF invokes Nsmf_PDUSession_SMContextStatusNotify Request (target
DNAI information) service operation to the AMF. The SMF also indicates the SMF
selection is expected.
The target DNAI information is used for SMF selection which can control UPF
connecting to that DNAI at next PDU session establishment towards the same DNN
and S-NSSAI. Due to it is for SMF selection, the AMF stores the target DNAI
information received from SMF. The target DNAI information is not transferred
outside, e.g. to support the UE context transfer between AMFs for AMF
relocation.
2\. The PDU Session Release procedure is initiated as described in clause
4.3.4. The SMF sends an N1 SM Information to the UE via the AMF by invoking
Namf_Communication_N1N2MessageTransfer as described in Step 3b of clause
4.3.4.2. The PDU Session Release Command message in N1 SM Information contains
the PDU Session ID and Cause indicating that a PDU Session re-establishment to
the same DN is required.
3\. Upon reception of PDU Session Release Command with Cause indicating that a
PDU Session re-establishment to the same DN is required as sent in step 2, the
UE generates a new PDU Session ID and initiates PDU Session Establishment
procedure as described in clause 4.3.2.2.
Then, the AMF selects an SMF as described in clause 6.4.2 of TS 23.501 [2] and
the SMF can select a new UPF (i.e. UPF2) for the re-established PDU Session of
SSC mode 2.
If the AMF has received target DNAI information from old SMF (i.e. SMF1), for
the PDU Session toward same DNN and S-NSSAI the AMF selects the SMF using the
stored target DNAI information. The AMF includes the target DNAI in the
Nsmf_PDUSession_CreateSMContext Request and deletes the stored target DNAI
information. The SMF selects the new PDU Session Anchor using the target DNAI.
#### 4.3.5.2 Change of SSC mode 3 PDU Session Anchor with multiple PDU
Sessions
The following procedure is triggered by SMF in order to change the PDU Session
Anchor serving a PDU Session of SSC mode 3 for a UE. This procedure releases
the existing PDU Session associated with an old PDU Session Anchor (i.e. UPF1
in figure 4.3.5.2-1) after having established a new PDU Session to the same DN
with a new PDU Session Anchor (i.e. UPF2 in figure 4.3.5.2-1), which is
controlled by the same SMF. The SMF may determine that a new SMF needs to be
reallocated.
Figure 4.3.5.2-1: Change of SSC mode 3 PDU Session Anchor with multiple PDU
Sessions
1\. The SMF determines that the serving UPF or the SMF needs to be changed. If
the \"Indication of application relocation possibility\" attributes in the PCC
rule indicates no DNAI change takes place once selected for this application,
the SMF determines that the SMF can not be changed.
1a. If the UPF (PSA) cannot connect to the target DNAI(s) that SMF received
from SM-PCF, the SMF invokes Nsmf_PDUSession_SMContextStatusNotify Request
(target DNAI information) service operation to the AMF. The SMF also indicate
the SMF selection is expected.
If the runtime coordination between 5GC and AF (Figure 4.3.6.3-1) is enabled,
the SMF includes in the Nsmf_PDUSession_SMContextStatusNotify Request the SM
Context ID as a reference to the SM Context that includes AF Coordination
Information stored in the SMF.
The target DNAI information are used for SMF selection which can control UPF
connecting to that DNAI at next PDU session establishment towards the same DNN
and S-NSSAI. Due to it is for SMF selection, the AMF stores the target DNAI
information received from SMF selection. The target DNAI information is not
transferred outside, e.g. to support the UE context transfer between AMFs for
AMF relocation.
2\. If the SMF had sent an early notification to the AF and the runtime
coordination between 5GC and AF is enabled based on local configuration as
specified in clause 4.3.6.3, according to the indication of \"AF
acknowledgment to be expected\" included in AF subscription to SMF events, the
SMF waits for a notification response from the AF. If the SMF receives a
negative notification response from the AF, the SMF may stop the procedure.
This is defined in Figure 4.3.6.3-1.
The SMF invokes the Namf_Communication_N1N2MessageTransfer (PDU Session ID,
SMF Reallocation requested indication, N1 SM container (PDU Session
Modification Command (Cause, PCO (PDU Session Address Lifetime value)))) where
PDU Session ID indicates the existing PDU Session to be relocated and Cause
indicates that a PDU Session re-establishment to the same DN is required.
The SMF Reallocation requested indication indicates whether the SMF is
requested to be reallocated.
The PDU Session Address Lifetime value is delivered to the UE upper layers in
PCO and indicates how long the network is willing to maintain the PDU Session.
The SMF starts a PDU Session Release timer corresponding to the PDU Session
Address Lifetime value.
3a. The AMF forwards the NAS message to the UE. The UE can provide the release
timer value to the upper layers if received in the PDU Session Modification
Command.
3b. The UE acknowledges the PDU Session Modification Command.
3c. The AMF forwards the N1 SM container (PDU Session Modification Command
ACK) received from the (R)AN to the SMF1 via Nsmf_PDUSession_UpdateSMContext
service operation.
3d. The SMF1 replies with a Nsmf_PDUSession_UpdateSMContext Response.
4\. If the UE receives PDU Session Modification Command, the UE may decide to
initiate the PDU Session Establishment procedure described in clause 4.3.2.2,
to the same DN with the following differences:
In Step 1 of clause 4.3.2.2.1, according to the SSC mode, UE generates a new
PDU Session ID and initiates the PDU Session Establishment Request using the
new PDU Session ID. The new PDU Session ID is included as PDU Session ID in
the NAS request message and the Old PDU Session ID which indicates the
existing PDU Session to be released is also provided to AMF in the NAS request
message.
In Step 2 of clause 4.3.2.2.1, if SMF reallocation was requested in Step 2 of
this clause, the AMF selects a different SMF. Otherwise, the AMF sends the
Nsmf_PDUSession_CreateSMContext Request to the same SMF serving the Old PDU
Session ID.
If target DNAI information has been received from old SMF (i.e. SMF1), for the
PDU Session toward same DNN and S-NSSAI the AMF selects the new SMF using the
stored target DNAI information. The AMF includes the target DNAI in the
Nsmf_PDUSession_CreateSMContext Request and deletes the stored target DNAI
information. If the AMF has received the SM Context ID from the old SMF, the
AMF includes the SM Context ID in the Nsmf_PDUSession_CreateSMContext Request.
In Step 3 of clause 4.3.2.2.1, if the SMF is not to be reallocated, the AMF
include both PDU Session ID and Old PDU Session ID in
Nsmf_PDUSession_CreateSMContext Request. The SMF detects that the PDU Session
establishment request is related to the trigger in step 2 based on the
presence of an Old PDU Session ID in the Nsmf_PDUSession_CreateSMContext
Request.
In Step 3 of clause 4.3.2.2.1, the SMF stores the new PDU Session ID and
selects a new PDU Session Anchor (i.e. UPF2) for the new PDU Session.
If the new SMF receives an SM Context ID in the
Nsmf_PDUSession_CreateSMContext Request, the new SMF retrieves the AF
Coordination Information by sending a Nsmf_PDUSession_ContextRequest to the
old SMF and indicates that \"AF Coordination Information\" part of 5G SM
Context is requested.
If the SMF receives a target DNAI in the Nsmf_PDUSession_CreateSMContext
Request, the SMF selects the new PDU Session Anchor using the target DNAI.
If the AF Coordination Information in the Nsmf_PDUSession_ContextRequest
Response includes a notification correlation id associated with an \"uplink
buffering\" indication, the SMF may also indicate PSA2 to buffer the uplink
data associated with the same notification correlation id in the PCC Rules.
If the PCC Rules received from the PCF as in step 7b or step 9 in clause
4.3.2.2.1 indicate that a late notification is requested by the AF (directly
or via NEF), the SMF sends a late notification to the AF before step 11 of
clause 4.3.2.2.1 in Nsmf_EventExposure_Notify service operation, as in step 4a
or step 4c in Figure 4.3.6.3-1 (directly or via NEF, respectively). The late
notification contains the Source DNAI and the UE IP address in the Source DNAI
included in the AF Coordination Information as received in the
Nsmf_PDUSession_CreateSMContext Response from the old SMF.
If the SMF received a negative notification response from the AF, the SMF may
stop the procedure. This is defined in Figure 4.3.6.3-1. Otherwise the SMF
continue the following procedures to activate the UP path of the new PDU
Session. The SMF may also indicate PSA2 to stop buffering and start forwarding
uplink data.
5\. After the new PDU Session is established the UE starts using the IP
address/prefix associated with the new PDU Session for all new traffic and may
also proactively move existing traffic flow (where possible) from the old PDU
Session to the new PDU Session.
NOTE: The mechanisms used by the UE to proactively move existing traffic flows
from one IP address/prefix to another are outside the scope of 3GPP
specifications.
6\. The old PDU Session is released as described in clause 4.3.4 either by the
UE before the timer provided in step 3 expires (e.g. once the UE has
consolidated all traffic on new PDU Session or if the session is no more
needed) or by the SMF upon expiry of this timer.
#### 4.3.5.3 Change of SSC mode 3 PDU Session Anchor with IPv6 Multi-homed PDU
Session
Clause 4.3.5.3 describes a procedure for service continuity with SSC mode 3
that uses the multi-homed PDU Session described in clause 5.6.4.3 of TS 23.501
[2]. In this case the SMF prepares a new PDU Session Anchor first and then
notifies the UE of the existence of a new IP prefix, as depicted in figure
4.3.5.3-1. This procedure is applicable only to PDU Sessions of IPv6 type.
Figure 4.3.5.3-1: Change of PDU Session Anchor with IPv6 Multi homed PDU
Session
The UE has an established PDU Session with the PDU Session Anchor (i.e. UPF1
in Figure 4.3.5.3-1). The PDU Session\'s User Plane involves at least the
(R)AN and the PDU Session Anchor.
1\. At some point the SMF decides to allocate the PDU Session with a new PDU
Session Anchor.
2\. The SMF selects a new UPF and using N4 configures the UPF as a new PDU
Session Anchor (i.e. UPF2 in Figure 4.3.5.3-1) of the multi-homed PDU Session.
In the process a new IPv6 prefix (IP\@2) is allocated for the PDU Session. If
the PCF has subscribed to the IP allocation/release event, the SMF performs a
Session Management Policy Modification procedure as defined in clause 4.16.5
to provide the new allocated IPv6 prefix to the PCF. The PCF invokes
Nbsf_Management_Update service operation to register the tuple (IPv6 prefix,
PCF id) for the PDU session identified by (SUPI, DNN, S-NSSAI) in the BSF.
If the runtime coordination between 5GC and AF is enabled based on local
configuration, according to the indication of \"AF acknowledgment to be
expected\" included in AF subscription to SMF events, the SMF sends an early
notification to the AF after the new UPF (new PSA) is selected and waits for a
notification response from the AF. If the SMF receives a negative notification
response from the AF, the SMF may stop the procedure. This is further defined
in Figure 4.3.6.3-1.
3\. The SMF selects a Branching Point (BP) UPF as described in Clause of 6.3.3
of TS 23.501 [2]. The selection of BP UPF may consider the location of UPF1
and UPF2 to ensure a suitable location of the BP UPF relative to the UPF1 and
the UPF2.
NOTE 1: If BP UPF is co-located with one of PDU Session Anchors, steps between
SMF and BP UPF can be skipped.
4\. The SMF configures via N4 the UPF selected in step 3 (BP UPF in Figure
4.3.5.3-1) as a Branching Point for the multi-homed PDU Session. It provides
the Branching Point with the necessary UL traffic forwarding rules (related
with the prefix of the IPv6 source address of UL traffic). Also, the SMF
provides AN Tunnel Info for N3 tunnel setup and CN Tunnel Info for N9 tunnel
setup to the BP UPF and obtains CN Tunnel Info from the BP UPF.
5-6. The SMF performs N4 Session Modification procedure with PSAs. During this
procedure, the SMF provides CN Tunnel Info received from the BP UPF to set up
an N9 tunnel between BP and PSAs. The SMF may also indicate local PSA2 to
buffer the uplink data.
7\. The SMF invokes the Namf_Communication_N1N2MessageTransfer service
operation containing N2 SM Information with CN Tunnel Info for the N3 tunnel
setup.
8\. The AMF sends an N2 Request including N2 SM Information received from the
SMF to the (R)AN. The (R)AN acknowledges to the AMF with an N2 Response.
9a. The AMF carries the N2 Response sent by the (R)AN to the SMF by invoking
the Nsmf_PDUSession_UpdateSMContext service operation.
9b. The SMF responds to Nsmf_PDUSession_UpdateSMContext service operation from
the AMF.
10-11. If the runtime coordination between 5GC and AF is enabled based on
local configuration as specified in clause 4.3.6.3, according to the
indication of \"AF acknowledgment to be expected\" is included in AF
subscription to SMF events, the SMF sends a late notification to the AF and
waits for a notification response from the AF. If the SMF receives a negative
notification response from the AF, the SMF may stop the procedure. This is
further defined in Figure 4.3.6.3-1.
The SMF notifies the UE of the availability of the new IP prefix. This is
performed using an IPv6 Router Advertisement message (RFC 4861 [6]). The SMF
sends a Router Advertisement to the UE via the new PSA with a new prefix
(IP\@2) and sends another Router Advertisement to the UE via the old PSA with
the old prefix (IP\@1) and zero value in the preferred lifetime field and a
value in the valid lifetime field according to RFC 4862 [8]. The UE shall
update the valid lifetime of the old prefix (IP\@1) to the signalled value
regardless of the remaining lifetime. The valid lifetime value indicates the
time how long the SMF is willing to keep the old prefix. The valid lifetime
value may be decided by SMF based on local configuration.
The UE starts using IP\@2 for all new traffic and may also proactively move
existing traffic flow (where possible) from IP\@1 to IP\@2.
NOTE 2: The mechanisms used by the UE to proactively move existing traffic
flows from one IP prefix to another are outside the scope of 3GPP
specifications.
12\. After the timer expires, the SMF releases the UE\'s old IPv6 prefix
(IP\@1). At this point the UE implicitly releases the old IP prefix. The SMF
sends an N4 Session Modification Request to the BP to release UP resource for
N9 tunnel between the BP and old PSA.
13\. The SMF releases the old PDU Session context with the old PDU Session
Anchor (UPF1 in Figure 4.3.5.3-1). If the PCF has subscribed to the IP
allocation/release event, the SMF performs a Session Management Policy
Modification procedure as defined in clause 4.16.5 to notify the PCF of the
IPv6 prefix release. The PCF shall invoke Nbsf_Management_Update service
operation to remove the tuple (IPv6prefix, PCF id) for the PDU session
identified by (SUPI, DNN,S-NSSAI) in BSF.
14-18. The SMF may optionally release the Branching Point from the User Plane
path. In step 14, the SMF may also indicate PSA2 to stop buffering and start
forwarding uplink data.
#### 4.3.5.4 Addition of additional PDU Session Anchor and Branching Point or
UL CL
Clause 4.3.5.4 describes a procedure to add a PDU Session Anchor and a
Branching Point or UL CL for an established PDU Session.
Figure 4.3.5.4-1: Addition of additional PDU Session Anchor and Branching
Point or UL CL
1\. UE has an established PDU Session with a UPF including the PDU Session
Anchor 1 (PSA1 in Figure 4.3.5.4-1). The PDU Session User Plane involves at
least the (R)AN and the PDU Session Anchor 1.
2\. At some point the SMF decides to establish a new PDU Session Anchor e.g.
due to UE mobility, new flow detection. The SMF selects a UPF and using N4
establish the new PDU Session Anchor 2 (PSA2 in Figure 4.3.5.4-1) of the PDU
Session. In the case of IPv6 multi-homing PDU Session, the SMF also ensures
that a new IPv6 prefix corresponding to PSA2 is allocated and if the PCF has
subscribed to the IP allocation/release event, the SMF performs the Session
Management Policy Modification procedure as defined in clause 4.16.5 to
provide the new allocated IPv6 prefix to the PCF.
If the runtime coordination between 5GC and AF is enabled based on local
configuration, according to the indication of \"AF acknowledgment to be
expected\" is included in AF subscription to SMF events, the SMF sends an
early notification to the AF after new PSA (PSA2 in Figure 4.3.5.4-1) is
selected and waits for a notification response from the AF before configuring
the new PSA. If the SMF receives a negative notification response from the AF,
the SMF may stop the procedure.
3\. The SMF selects a UPF and using N4 establish the Branching Point (in the
case of IPv6 multi-homing) or a UL CL for the PDU Session. It provides the
necessary uplink forwarding rules towards PSA1 and PSA2 including the PSA1 CN
Tunnel Info and the PSA2 CN Tunnel Info. In addition, the AN Tunnel Info is
provided for downlink forwarding. In the case of IPv6 multi-homing, the SMF
also provides traffic filters for the IPv6 prefixes corresponding to PSA1 and
PSA2 indicating what traffic shall be forwarded towards PSA1 and PSA2
respectively.
In the case of UL CL, the SMF provides traffic filters indicating what traffic
shall be forwarded towards PSA1 and PSA2 respectively. If the runtime
coordination between 5GC and AF is enabled based on local configuration,
according to the indication of \"AF acknowledgment to be expected\" is
included in AF subscription to SMF events, the SMF sends a late notification
to the AF and waits for a notification response from the AF before configuring
the UL CL. If the SMF receives a negative notification response from the AF,
the SMF may stop the procedure.
NOTE 1: If the Branching Point or UL CL and the PSA2 are co-located in a
single UPF then steps 2 and 3 can be merged. If a Branching Point is already
allocated, step 3 is skipped.
4\. The SMF updates the PSA1 via N4. It provides the Branching Point or UL CL
CN Tunnel Info for the downlink traffic.
NOTE 2: If the Branching Point or UL CL and the PSA1 are co-located in a
single UPF then steps 3 and 4 can be merged.
5\. The SMF updates PSA2 via N4. It provides the Branching Point or UL CL CN
Tunnel Info for down-link traffic.
NOTE 3: If the Branching Point or UL CL and the PSA2 are co-located in a
single UPF then step 5 is not needed.
6\. The SMF updates (R)AN via N2 SM information over N11. It provides the new
CN Tunnel Info corresponding to the UPF (Branching Point or UL CL). In the
case of UL CL, if there is an existing UPF between the (R)AN and new inserted
UL CL, the SMF updates the existing UPF via N4 instead of updating the (R)AN.
7\. In the case of IPv6 multi-homing, the SMF notifies the UE of the
availability of the new IP prefix @ PSA2. This is performed using an IPv6
Router Advertisement message (RFC 4861 [6]). Also, the SMF sends IPv6 multi-
homed routing rule along with the IPv6 prefix to the UE using an IPv6 Router
Advertisement message (RFC 4191 [21]) as described in clause 5.8.2.2.2 of TS
23.501 [2].
If the runtime coordination between 5GC and AF is enabled based on local
configuration, according to the indication of \"AF acknowledgment to be
expected\" included in AF subscription to SMF events, the SMF sends a late
notification to the AF and waits for a notification response from the AF
before sending the new IP prefix to the UE. If the SMF receives a negative
notification response from the AF, the SMF may stop the procedure.
8\. In the case of IPv6 multi-homing, the SMF may re-configure the UE for the
original IP prefix @ PSA1,i.e. SMF sends IPv6 multi-homed routing rule along
with the IPv6 prefix to the UE using an IPv6 Router Advertisement message (RFC
4191 [21]) as described in clause 5.8.2.2.2 of TS 23.501 [2].
#### 4.3.5.5 Removal of additional PDU Session Anchor and Branching Point or
UL CL
Clause 4.3.5.5 describes a procedure to remove a PDU Session Anchor and
(optionally) remove Branching Point or UL CL for an established PDU Session.
Figure 4.3.5.5-1: Removal of additional PDU Session Anchor and Branching Point
or UL CL
1\. UE has an established PDU Session with a UPF including the Branching Point
or UL CL, the PDU Session Anchor 1 (PSA1 in Figure 4.3.5.5-1) and the PDU
Session Anchor 2 (PSA2 in Figure 4.3.5.5-1).
At some point the SMF decides to remove the PDU Session Anchor 1 e.g. due to
UE mobility, flow terminated.
2\. In the case of IPv6 multi-homing, the SMF notifies the UE to stop using
the IPv6 prefix corresponding to PSA1. This is performed by IPv6 Router
Advertisement message (RFC 4861 [6] and RFC 4862 [8]). Also, the SMF sends
IPv6 multi-homed routing rule along with the IPv6 prefix corresponding to PSA2
to the UE as described in clause 5.8.2.2.2 of TS 23.501 [2]. Based on the
information provided in the Router Advertisement, the UE starts using the IPv6
prefix (corresponding to PSA2) for all the traffic.
4\. If the Branching Point or UL CL is to be released, the SMF updates the
(R)AN with the PSA2 CN Tunnel Info. In the case of UL CL, if there is an
existing UPF between the (R)AN and the UL CL to be removed, the SMF updates
the existing UPF via N4 instead of updating the (R)AN.
5\. If the Branching Point or UL CL is to be released, the SMF updates via N4
the PSA2 providing the AN Tunnel Info. In the case of UL CL, if there is an
existing UPF between the (R)AN and the UL CL to be removed, the SMF updates
the PSA2 providing the UPF CN tunnel Info.
6\. The SMF releases via N4 the PSA1. In the case of IPv6 multi-homing, the
SMF also releases the corresponding IPv6 prefix and if the PCF has subscribed
to the IP allocation/release event, the SMF performs the Session Management
Policy Modification procedure as defined in clause 4.16.5 to notify the PCF of
the IPv6 prefix release.
7\. If steps 4 and 5 were executed, the SMF releases the Branching Point / UL
CL.
#### 4.3.5.6 Change of additional PDU Session Anchor for IPv6 multi-homing or
UL CL
The following procedure is triggered by an SMF when the SMF needs to modify
IPv6 multi-homing or UL CL rule (i.e. traffic filter in the Branching Point or
the UL CL) in order to move the some or whole traffic flows of the existing
additional PDU Session Anchor which was established by the IPv6 multi-homing
or the UL CL operations (i.e. PSA1 in figure 4.3.5.6-1) to a new additional
PDU Session Anchor (i.e. PSA2 in figure 4.3.5.6-1) which is established under
the same Branching Point or UL CL for a UE where the UE already has a PDU
Session Anchor which was established before the event of Branching Point or UL
CL insertion (i.e. PSA0 in figure 4.3.5.6-1). This procedure establishes a new
additional PDU Session Anchor (i.e. PSA2) and conditionally releases the
existing additional PDU Session Anchor (i.e. PSA1), while modifying IPv6
multi-homing or UL CL rule in the same Branching Point or UL CL under
controlled by the same SMF.
Figure 4.3.5.6-1: Change of additional PSA for a PDU Session in IPv6 multi-
homing or UL CL case
1\. The SMF decides to change one additional PSA of a PDU Session with IPv6
multi-homing or UL CL, due to events that may benefit from such change or upon
request from an Application Function.
2\. If the runtime coordination between 5GC and AF is enabled based on local
configuration, according to the indication of \"AF acknowledgment to be
expected\" included in AF subscription to SMF events, the SMF sends an early
notification to the AF after PSA2 is selected and waits for a notification
response from the AF before configuring the PSA2. If the SMF receives a
negative notification response from the AF, the SMF may stop the procedure.
This is defined in Figure 4.3.6.3-1.
The SMF sends an N4 Session Establishment Request to PSA2 and provides the
tunnel ID of Branching Point or UL CL, Packet detection, enforcement and
reporting rules to be installed on the PSA2 for this PDU Session. The SMF may
also indicate local PSA2 to buffer the uplink data.
The PSA2 acknowledges by sending an N4 Session Establishment Response. The
tunnel ID of PSA2 is provided to the SMF in this step.
In the case of IPv6 multi-homing PDU Session, a new IPv6 prefix corresponding
to PSA2 is allocated (by the SMF or by the UPF depending on the deployment)
and if the PCF has subscribed to the IP allocation/release event, the SMF
performs the Session Management Policy Modification Procedure as defined in
clause 4.16.5 to provide the new allocated IPv6 prefix to the PCF.
3a. In the case of PDU session with UL CL, if the runtime coordination between
5GC and AF is enabled based on local configuration, according to the
indication of \"AF acknowledgment to be expected\" included in AF subscription
to SMF events, the SMF sends a late notification to the AF and waits for a
notification response from the AF. If the SMF receives a negative notification
response from the AF, the SMF may stop the procedure. This is further defined
in Figure 4.3.6.3-1.
The SMF sends an N4 Session Modification Request to the Branching Point or UL
CL to update the UL traffic filter according to new allocated IPv6 prefix
allocated to PSA 2 or the UL CL rules regarding to the traffic flows that the
SMF tries to move from PSA1 to PSA2. The N4 Session Modification Request
message contains the identifications of traffic filter that needs to be
updated and the tunnel ID of PSA2.
NOTE: The identification of a traffic filter can be either the index of the
traffic filter, or a single value of the information field in traffic filter
(e.g. the tunnel ID of next hop), or a combination value of some information
field in the traffic filter (e.g. the tunnel ID of next hop with source port
number).
3b. The Branching Point or the UL CL acknowledges by N4 Session Modification
Response the Branching Point or when the UL CL successfully updates all the
traffic filters that the SMF requests to modify.
3c. The SMF may also indicate PSA2 to stop buffering and start forwarding
uplink data.
4\. In the case of IPv6 multi-homing PDU Session, if the runtime coordination
between 5GC and AF is enabled based on local configuration, according to the
indication of \"AF acknowledgment to be expected\" included in AF subscription
to SMF events, the SMF sends a late notification to the AF and waits for a
notification response from the AF. If the SMF receives a negative notification
response from the AF, the SMF may stop the procedure. This is further defined
in Figure 4.3.6.3-1.
In the case of IPv6 multi-homing PDU Session, The SMF notifies the UE of the
availability of the new IP prefix @ PSA2. This is performed using an IPv6
Router Advertisement message (RFC 4861 [6]). Also, the SMF sends IPv6 multi-
homed routing rule along with the IPv6 prefix to the UE using an IPv6 Router
Advertisement message (RFC 4191 [21]) as described in clause 5.8.2.2.2 of TS
23.501 [2]. The SMF may also indicate PSA2 to stop buffering and start
forwarding uplink data.
5\. In the case of IPv6 multi-homing PDU Session, The SMF may re-configure the
UE for the original IP prefix @ PSA0,i.e. SMF sends IPv6 multi-homed routing
rule along with the IPv6 prefix to the UE using an IPv6 Router Advertisement
message (RFC 4191 [21]) as described in clause 5.8.2.2.2 of TS 23.501 [2].
6\. Step 6 occurs only if the Branching Point or UL CL does not have any
traffic filter on the PDU Session which forwards a traffic flow to PSA1.
6a. The SMF sends an N4 Session Release Request with N4 session ID to PSA1.
The PSA1 shall release all tunnel resources and contexts associated with the
N4 session.
6b. PSA1 sends an N4 Session Release Response with N4 session ID to the SMF at
the same moment that PSA1 successfully releases all tunnel resources and
contexts associated with the N4 session.
#### 4.3.5.7 Simultaneous change of Branching Point or UL CL and additional
PSA for a PDU Session
Simultaneous change of UL CL or Branching Point and additional PSA can be
performed after Xn based handover, N2 based handover and Service Request
procedures.
The following procedure is triggered by SMF in order to change the Branching
Point or the UL CL and additional PSA serving a PDU Session for a UE.
Figure 4.3.5.7-1: Simultaneous change of Branching Point or UL CL and
additional PSA for a PDU Session
UE has an established PDU Session with a UPF including the PDU Session Anchor
(Remote UPF). The PDU Session user plane involves at least the Source (R)AN,
Source Branching Point or Source UL CL, local Source UPF (PSA2) and the Remote
UPF (PDU Session Anchor, PSA1), where Source Branching Point or Source UL CL
and PSA2 can be co-located.
1\. At some point SMF decides to change the Branching Point or the UL CL due
to UE mobility.
2\. The SMF selects a local Target UPF (PSA3) and using N4 establishes the
local Target UPF for the PDU Session.
In the case of IPv6 multi-homing PDU Session, a new IPv6 prefix corresponding
to PSA3 is allocated (by the SMF or by the UPF depending on the deployment)
and if the PCF has subscribed to the IP allocation/release event, the SMF
performs the Session Management Policy Modification procedure as defined in
clause 4.16.5 to provide the new allocated IPv6 prefix to the PCF.
The SMF may send an Early notification to the AF after PSA3 is selected. If
the runtime coordination between 5GC and AF is enabled based on local
configuration as specified in clause 4.3.6.3, according to the indication of
\"AF acknowledgment to be expected\" included in AF subscription to SMF
events, the SMF waits for a notification response from the AF before
configuring the PSA3. If the SMF receives a negative notification response
from the AF, the SMF may stop the procedure. This is defined in Figure
4.3.6.3-1.
3\. The SMF selects a UPF and using N4 establishes the Target Branching Point
or Target UL CL for the PDU Session. SMF provides the necessary uplink
forwarding rules towards the PSA3 and PSA1 including the Tunnel Info for each
UPF. If session continuity upon UL CL relocation is used, the SMF also uses N4
to establish an N9 forwarding tunnel between the Source UL CL and Target UL
CL, including the Tunnel Info for each UPF. In addition, the AN Tunnel Info to
target (R)AN is provided for downlink forwarding. In the case of UL CL, the
SMF provides traffic filters indicating what traffic shall be forwarded
towards PSA3, PSA1 and Source UL CL, respectively. In the case of IPv6 multi-
homing, the SMF also provides traffic filters for the IPv6 prefixes
corresponding to PSA3 and PSA1 indicating what traffic shall be forwarded
towards PSA3 and PSA1 respectively. Target Branching Point or Target UL CL
provides the CN Tunnel Info for downlink traffic.
NOTE 1: If the Target Branching Point or Target UL CL and the PSA3 are co-
located in a single UPF then steps 2 and 3 can be merged.
NOTE 2: When session continuity upon UL CL relocation is used, the downlink
traffic at this point goes through Source UL CL, Target UL CL and Target
(R)AN.
4\. The SMF updates the PSA1 via N4. It provides the PDU Session CN Tunnel
Info for the downlink traffic.
5\. The SMF updates the PSA3 via N4. It provides the CN Tunnel Info for
downlink traffic. The SMF may also indicate PSA3 to buffer uplink data.
NOTE 3: If the Target Branching Point or the Target UL CL and the PSA3 are co-
located in a single UPF then step 5 is not needed.
6\. In the case of PDU session with UL CL, if the runtime coordination between
5GC and AF is enabled based on local configuration, according to the
indication of \"AF acknowledgment to be expected\" included in AF subscription
to SMF events, the SMF sends a late notification to the AF and waits for a
notification response from the AF as described in step 9. If the SMF receives
a negative notification response from the AF, the SMF may stop the procedure
and remove the Target Branching Point or Target UL CL and PSA3. This is
further defined in Figure 4.3.6.3-1.
The SMF updates (R)AN via N2 SM information over N11. It provides the new CN
Tunnel Info corresponding to the Target Branching Point or the Target UL CL.
If there is an existing UPF between the Target (R)AN and Target Branching
Point or Target UL CL, the SMF updates the existing UPF via N4 instead of
updating the (R)AN.
NOTE 4: When session continuity upon UL CL relocation is used, the uplink
traffic destined to PSA2 at this point goes through Target (R)AN, Target UL CL
and Source UL CL.
7\. In the case of IPv6 multi-homing PDU Session, if the runtime coordination
between 5GC and AF is enabled based on local configuration, according to the
indication of \"AF acknowledgment to be expected\" included in AF subscription
to SMF events, the SMF sends a late notification to the AF and waits for a
notification response from the AF as described in step 9. If the SMF receives
a negative notification response from the AF, the SMF may stop the procedure.
This is further defined in Figure 4.3.6.3-1.
In the case of IPv6 multi-homing, the SMF notifies the UE of the availability
of the new IP prefix @ PSA3. This is performed using an IPv6 Router
Advertisement message (RFC 4861 [6]). Also, the SMF sends IPv6 multi-homed
routing rule along with the IPv6 prefix to the UE using an IPv6 Router
Advertisement message (RFC 4191 [21]) as described in clause 5.8.2.2.2 of TS
23.501 [2].
8\. In the case of IPv6 multi-homing, the SMF may re-configure the UE for the
original IP prefix @ PSA1, i.e. SMF sends IPv6 multi-homed routing rule along
with the IPv6 prefix to the UE using an IPv6 Router Advertisement message (RFC
4191 [21]) as described in clause 5.8.2.2.2 of TS 23.501 [2].
9\. The SMF sends a Late Notification to the AF indicating a change of DNAI as
described in clause 4.3.6.3. In cases where target local DN is associated with
another AF instance, SMF also sends notification to target AF as described in
4.3.6.3 and cancels any future notification message to source AF as it is no
longer involved. The SMF may also indicate PSA3 to stop buffering and start
forwarding uplink data based on the positive response for the Late
Notification.
NOTE 5: The message can include routing information to the application located
in the target local DN. Alternatively the routing information to the
application located in the target local DN can be determined by the AF based
on the new DNAI, in which case the AF can invoke the AF triggered influence on
traffic routing procedure targeting single UE as described in clause 4.3.6.4,
which assists the SMF in generation of the routing rule on the Target UL CL
towards PSA3 (i.e. towards the application located in the target local DN). It
is up to network configuration whether the routing information to the
application located in the target local DN is configured in the SMF or in the
AF.
NOTE 6: When session continuity upon UL CL relocation is used the AF can also
trigger mechanisms that are out of the scope of this specification (e.g. IP-
level or HTTP-level redirection) by which the traffic is redirected towards
the application in the target local DN. Based on this redirection the UE
starts using a new destination IP address which leads the Target UL CL to
force the traffic towards PSA3.
10\. When session continuity upon UL CL relocation is used, detection of no
active traffic over the N9 forwarding tunnel is performed during a time
interval provisioned by SMF for User Plane inactivity report in order to
release the N9 forwarding tunnel. The detection can be done by Source UL CL,
which notifies the SMF of no active traffic over the N9 forwarding tunnel.
NOTE 7: It is up to network configuration whether the detection of no active
traffic is performed by the Source UL CL or the Target UL CL. As an
alternative to the detection of no active traffic, the AF can send an explicit
notification to the SMF when traffic to/from this UE ceases to exist, leading
the SMF to release the Source UL CL and the Source UPF (PSA2).
11\. The SMF releases via N4 the PSA2.
12\. The SMF releases the Source Branching Point or the Source UL CL.
NOTE 8: If the Source Branching Point or UL CL and the PSA2 are co-located in
a single UPF then steps 11 and 12 can be merged.
#### 4.3.5.8 Ethernet PDU Session Anchor Relocation
This procedure allows for Ethernet PDU Sessions to change the PDU Session
Anchor (PSA) while the session remains set up. Originally the Ethernet PDU
Session goes via the Source UPF acting as the PSA. The Ethernet context which
contains all Ethernet specific information including the MAC address of the UE
and possibly its VLAN tag(s) is reported from the Source PSA UPF to the SMF.
It is possible to report multiple MAC addresses (with their VLAN tag(s)) if
these are reachable via the UE.
The SMF determines whether and when a serving PDU Session anchor for an
Ethernet PDU Session needs to be changed and selects the Target PSA UPF,
establishes the N4 session at the Target PSA UPF. The information within the
Ethernet context is sent to the Target UPF. Based on the information in the
Ethernet context, the Target PSA UPF may take action to update the Ethernet
forwarding in the data network.
Figure 4.3.5.8-1: Ethernet PDU Session Anchor Relocation
Initially, the Ethernet PDU Session is established with the user data going
via the Source UPF. The Source UPF acts as the PSA.
1\. The Source UPF reports the Ethernet context which contains all Ethernet
specific information including the MAC address of the UE and possibly its VLAN
tag(s) that the UPF has learned from the UE side to the SMF. In the case of
any changes in the Ethernet context, the change is updated to the SMF so that
the SMF maintains an up-to-date state of the Ethernet context. This signalling
is realized based on N4 reporting.
2\. The UPF\'s report is acknowledged.
3-5. In the case of handover, the RAN handover preparation and execution is
followed by path switch signalling to the AMF and corresponding signalling to
SMF, as defined in clause 4.9.1.2.
6\. The SMF decides that the PSA is to be changed for the Ethernet PDU Session
and selects the Target UPF that will act as the new PSA. The decision may be
triggered by a mobility event, such as receiving the message in step 5.
7\. The Target UPF N4 session is established. The SMF provides the N3 tunnel
endpoint used by RAN.
8\. The establishment of the new N4 session is acknowledged from the Target
UPF to the SMF. The UPF provides its N3 tunnel endpoint.
9-10. In the case of handover, the SMF signals to the RAN via the AMF to
provide the Path Switch Request Ack, which includes the update of the uplink
N3 tunnel endpoint to the target UPF. This signalling is defined in clause
4.9.1.2. In steps 9-10, an indication is sent from the SMF via the AMF to the
RAN node indicating that the RAN node should not expect to receive an end
marker packet. The RAN node may skip trying to reorder the downlink packets.
11-12. If there is no handover and the UE is in connected mode, the SMF sends
PDU Session Modify Request message to the RAN via the AMF, which includes the
update of the uplink N3 tunnel endpoint to the target UPF. The RAN
acknowledges the message. The RAN node does not need to to reorder the
downlink packets.
NOTE 1: Due to the change in the end to end path, packet re-ordering can occur
both for the handover and no handover cases. If necessary, upper layer
protocols can ensure in sequence delivery.
After steps 9-10 or 11-12, uplink Ethernet frames pass via the target UPF.
Downlink Ethernet frames may continue to be delivered from the source UPF to
the RAN node. In the case of handover, the Ethernet frames are forwarded from
the source RAN node to the target RAN node.
13-14. The SMF sends an N4 Session Modification Request to the Target UPF
which includes the information in Ethernet context (i.e. MAC address and VLAN
tag(s)) and a trigger for updating the Ethernet forwarding (next step). The
Target UPF acknowledges by an N4 Session Modification Response.
15\. The Target UPF may assist in the update of Ethernet forwarding tables of
Ethernet switches in the DN via a variety of mechanisms, the use of which are
specific to the DN and the specification of which are out-of-scope for 3GPP.
NOTE 2: The UPF acting as a switch in the DN, can for example issue a
Gratuitous ARP (GARP) containing the MAC address(es) of the UE that has
switched to the new anchor, or the UPF can send an unsolicited Neighbor
Discovery Protocol (NDP) Neighbor Advertisement message indicating the UE MAC
addresses, or the UPF can generate a uplink Ethernet frame with the UE\'s MAC
addresses as source MAC addresses (and possibly its VLAN tag(s)) and
configurable payload which will be dropped by endhosts, or the UPF can send
another message or Ethernet frame compatible with DN protocols.
In the case of a central controller in the Ethernet network which sets the
forwarding tables, the central controller can be instructed that the given MAC
address is reachable at the new location.
When multiple MAC addresses are present in the Ethernet context, the update of
the Ethernet forwarding is performed for each MAC address.
16\. The N4 session is released at the Source UPF. The source UPF may wait for
a configurable period before it stops delivering downlink Ethernet frames for
the given PDU Session.
17\. The N4 session release is acknowledged from the Source UPF to the SMF.
### 4.3.6 Application Function influence on traffic routing and service
function chaining
#### 4.3.6.1 General
Clause 4.3.6 describes the procedures between an Application Function and the
SMF to maintain an efficient user plane path and/or to provide N6-LAN service
function chaining for Application Functions that require it.
As described in clauses 5.6.7 and 5.6.16 of TS 23.501 [2], an Application
Function may send requests to influence SMF routeing decisions for User Plane
traffic of PDU Sessions. The AF requests may influence UPF (re)selection and
allow routeing of user traffic to a local access (identified by a DNAI) to a
Data Network and/or influence the steering of user traffic to service function
chain(s) identified by SFC identifier(s). The AF may also provide in its
request subscriptions to SMF events.
The following cases can be distinguished:
NOTE 1: Such requests target an on-going PDU Session.
When receiving an AF request on Application Function influence on traffic
routing targeting an individual UE IP address the NEF needs to determine
whether the target PDU Session is working in HR-SBO mode. If the target PDU
Session is NOT working in HR-SBO mode (non roaming or LBO PDU Session) then
the NEF contacts the PCF of the PDU Session as further defined in the clause
4.3.6.4; If the target PDU Session is working in HR-SBO mode, the NEF does not
contact the PCF of the PDU session but needs to store the AF request in UDR as
defined in clause 4.3.6.5.
The NEF determines whether the PDU Session that the AF requests to influence
is working in HR-SBO mode or not and in the former case determines the HPLMN
of the UE, the DNN/S-NSSAI of the PDU Session as follows:
If the AF has not provided the (H)PLMN ID, DNN, S-NSSAI:
\- If the IP address of the UE in the AF request is a private IP address, the
NEF determines the HPLMN of the UE, the DNN/S-NSSAI of the PDU Session based
on local configuration.
\- If the IP address of the UE in the AF request is a public IP address:
\- if this Public address belongs to a range NOT owned by the PLMN of the NEF,
then the target PDU Session is working in HR-SBO mode and the NEF determines
the HPLMN of UE, the DNN/S-NSSAI of the PDU Session based on that range. The
NEF (that has received the AF request) contacts the NEF of the HPLMN in order
to retrieve the UE IP address of the PDU Session from the PSA UPF in the
HPLMN.
\- Otherwise, if the UE IP Address in the AF request is an IP address NATed by
the PLMN that the NEF belongs to, the NEF invokes steps 3 to 6 of the AF
specific UE ID retrieval procedure defined in clause 4.15.10 to get the
corresponding private UE IP address, an indication that the PDU Session is
working in HR-SBO mode, the HPLMN of UE, the DNN/S-NSSAI of the PDU Session
from the L-PSA UPF in the local PLMN.
NOTE 2: In this Release, the HPLMN allows HR-SBO for a PDU session only if the
UE IP address of the PDU Session has not been allocated in a range that may
overlap with other PDU sessions to the same DNN and S-NSSAI of that HPLMN.
NOTE 3: It is assumed that the NEF is configured with the NATed IP range of
its own PLMN. It is assumed that the NEF is configured based on HR-SBO roaming
agreements for the DNN/S-NSSAI with the association of Public IP address
ranges with an HPLMN ID, a DNN/S-NSSAI.
NOTE 4: Whether the AF needs to use the NEF or not is according to local
deployment. If the AF request is expected to possibly address PDU Sessions in
HR-SBO mode, then the AF sends its requests via the NEF.
When AF requests are routed (by the AF or by the NEF) to an individual PCF
this may use the BSF. This case applies to both AF influence on traffic
routing as well as AF influence on Service Function Chaining. This is
described in clause 4.3.6.4.
\- AF requests described in clause 5.6.7 of TS 23.501 [2] or clause 5.6.16 of
TS 23.501 [2] targeting a group of UE(s), or any UE accessing a combination of
DNN and S-NSSAI, or targeting individual UE(s) by one or more GPSI(s) or
targeting UEs with External Subscriber Category(s) which can be combined with
External Group ID(s) or any UE as described in table 5.6.7-1. These AF
requests may also affect UE(s) with an established PDU session. For such
requests the AF shall contact the NEF and the NEF stores the AF request
information in the UDR. PCF(s) receive a corresponding notification if they
had subscribed to the creation / modification/ deletion of the AF request
information corresponding to UDR Data Keys / Data Sub-Keys. This is defined in
clause 6.3.7.2 of TS 23.501 [2] and further described in clause 4.3.6.2.
NOTE 5: Such requests can target on-going or future PDU Sessions.
If the AF request targets any UE the procedure described in clause 4.3.6.5 may
also be performed. In that case if the HPLMN Id, DNN and S-NSSAI has not been
provided by the AF, the NEF determines the target HPLMN Id, DNN and S-NSSAI
based on local configuration,
This version of the specification does not support the procedure described in
clause 4.3.6.5 if the AF request targets an external group of UE(s), or UE(s)
identified by SUPI.
If the AF request targets a GPSI, the NEF determines the GPSI owner PLMN Id
from the GPSI and invokes the NEF of that PLMN that retrieves the SUPI from
HPLMN. In that case if the DNN and/or S-NSSAI has not been provided by the AF
a preconfigured DNN and/or S-NSSAI is used.
If the AF interacts with 5GC via the NEF, the NEF performs the following
mappings or determinations where needed:
\- Map the AF-Service-Identifier into DNN and S-NSSAI combination, determined
by local configuration.
\- Map the AF-Service-Identifier into a list of DNAI(s) and Routing Profile
ID(s) determined by local configuration.
The NEF can only provide this mapping when the DNAI(s) being used by the
applications are statically defined. When the DNAI(s) where applications are
instantiated may vary dynamically, the AF should provide the target DNAI(s) in
its request together with either Routing Profile ID(s) or with N6 traffic
routing information.
\- Map the GPSI in Target UE Identifier into SUPI, according to information
received from UDM.
\- Map the External Group Identifier in Target UE Identifier into Internal
Group Identifier, according to information received from UDM.
\- Map the External Subscriber Category(s) and any UE, or External Subscriber
Category and External Group ID(s) to, Internal Group ID(s) or Internal Group
ID(s) and Subscriber Category(s).
\- Map the geographical area in Spatial Validity Condition into areas of
validity, determined by local configuration.
\- Determine whether an AF request targeting an UE IP address corresponds to
HR-SBO and if yes determine as defined above the HPLMN of UE, the DNN/S-NSSAI
of the PDU Session based on the AF request, the received UE IP address and its
local configuration,
NOTE 6: As a user can be associated with multiple Subscriber Category(s), some
values of Subscriber Category(s) can correspond to an SLA between an
application provider represented by an AF and the 5GC operator. In the NEF
API, the combination of application identifier and External Subscriber
Category can also be used to refer to this SLA.
#### 4.3.6.2 Processing AF requests to influence traffic routing and/or
Service Function Chaining for Sessions not identified by an UE address
Figure 4.3.6.2-1: Processing AF requests to influence traffic routing and/or
Service Function Chaining for Sessions not identified by an UE address
NOTE 1: The 5GC functions used in this scenario are assumed to all belong to
the same PLMN (HPLMN in non-roaming case or VPLMN in the case of a PDU Session
in LBO mode).
0\. The PCF(s) subscribe to modifications of AF requests (Data Set =
Application Data; Data Subset = AF traffic influence request information, Data
Key = S-NSSAI and/or DNN and/or Internal Group Identifier or SUPI) from the
UDR.
1\. To create a new request, the AF invokes a Nnef_TrafficInfluence_Create
service operation. The content of this service operation (AF request) is
defined in clause 5.2.6.7. The request contains also an AF Transaction Id. If
it subscribes to events related with PDU Sessions the AF indicates also where
it desires to receive the corresponding notifications (AF notification
reporting information).
To update or remove an existing request, the AF invokes a
Nnef_TrafficInfluence_Update or Nnef_TrafficInfluence_Delete service operation
providing the corresponding AF Transaction Id.
The Nnef_TrafficInfluence_Create (initiated by target AF) or
Nnef_TrafficInfluence_Update (initiated by source AF or target AF) service
operation may be used for the case of AF instance change. If
Nnef_TrafficInfluence_Update service operation is invoked, the NEF is required
to update the subscription resource. The Nnef_TrafficInfluence_Update service
operation may include an updated notification target address. The updated
subscription resource is used by the target AF.
NOTE 2: If the source AF transfers the application context to the target AF,
then target AF may create new subscription via Nnef_TrafficInfluence_Create
operation or update existing subscription via Nnef_TrafficInfluence_Update.
However, whether and how the application context transfer is done is out of
this specification.
2\. The AF sends its request to the NEF. If the request is sent directly from
the AF to the PCF, the AF reaches the PCF selected for the existing PDU
Session by configuration or by invoking Nbsf_management_Discovery service.
The NEF ensures the necessary authorization control, including throttling of
AF requests and as described in clause 4.3.6.1, mapping from the information
provided by the AF into information needed by the 5GC.
3\. (in the case of Nnef_TrafficInfluence_Create or Update): The NEF stores
the AF request information in the UDR (Data Set = Application Data; Data
Subset, Data Key = AF Transaction Internal ID, S-NSSAI and DNN and/or Internal
Group Identifier(s) and/or Subscriber Category(s) or SUPI). The Data Subset
identifies whether the information relates to AF traffic influence request
information for traffic routing or AF traffic influence request information
for service function chaining, as described in Table 5.2.12.2.1-1.
NOTE 3: Both the AF Transaction Internal ID and S-NSSAI and DNN and/or
Internal Group Identifier(s) and/or Subscriber Category(s) or SUPI are
regarded as Data Key when the AF request information are stored into the UDR,
see Table 5.2.12.2.1-1. The Subscriber Category(s) is determined by NEF as
described in clause 4.3.6.1.
(in the case of Nnef_TrafficInfluence_delete): The NEF deletes the AF
requirements in the UDR (Data Set = Application Data; Data Subset, Data Key =
AF Transaction Internal ID). The Data Subset identifies whether the
information relates to AF traffic influence request information for traffic
routing or AF traffic influence request information for service function
chaining.
The NEF responds to the AF.
4\. The PCF(s) that have subscribed to modifications of AF requests receive(s)
a Nudr_DM_Notify notification of data change from the UDR. The Data Subset
identifies whether the information relates to AF traffic influence request
information for traffic routing or AF traffic influence request information
for service function chaining.
5\. The PCF determines if existing PDU Sessions are potentially impacted by
the AF request. For each of these PDU Sessions, the PCF updates the SMF with
corresponding new policy information about the PDU Session by invoking
Npcf_SMPolicyControl_UpdateNotify service operation as described in steps 5
and 6 in clause 4.16.5.
The PCF validates whether the SFC identifier (if available) corresponds to an
authorized SFC for the AF based on local configuration. If the validation has
succeeded the PCF maps the SFC identifier to the corresponding Traffic
Steering Policy identifier (i.e. TSP ID).
The PCF includes the Traffic Steering Policy ID(s) in the AF influence on
traffic routing Enforcement Control information and/or N6-LAN Traffic Steering
Enforcement Control information of the relevant PCC rule as defined in clause
6.3.1 of TS 23.503 [20]. The PCF also includes the Metadata in the N6-LAN
Traffic Steering Enforcement Control information of the PCC rule when Metadata
was provided by the AF.
If the AF request includes a notification reporting request for UP path
change, the PCF includes in the PCC rule(s) the information required for
reporting the event, including the Notification Target Address pointing to the
NEF or AF and the Notification Correlation ID containing the AF Transaction
Internal ID.
If the AF request includes an EAS Correlation indication or indication of
traffic correlation, PCF includes in the PCC rule(s) an EAS Correlation
indication or indication of traffic correlation and a Traffic Correlation ID
corresponding to a set of UEs that AF request aims at, also if AF request
includes a common EAS IP address or common DNAI for a set of UEs, PCC rule
includes the common EAS IP address or common DNAI.
In the case of AF influence on traffic routing, the PCF may, optionally, use
service experience analytics per UP path, as defined in clause 6.4.3 of TS
23.288 [50], to provide an updated list of DNAI(s) to the SMF.
The PCF may use the \"Subscriber categories\" as defined in \"PDU Session
policy control subscription information\" in table 6.2-2 of TS 23.503 [20] to
determine whether the PDU Session is impacted by the AF request.
6\. When the updated policy information about the PDU Session is received from
the PCF, the SMF may take appropriate actions to reconfigure the User plane of
the PDU Session.
In the case of AF influence on traffic routing, examples of actions are:
\- The SMF may consider service experience analytics and/or DN Performance
analytics per UP path (i.e. including UPF and/or DNAI and/or AS instance) as
defined in clauses 6.4.3 and 6.14.3, respectively, of TS 23.288 [50] before
taking any actions.
\- Determining a target DNAI.
\- Determining if a common DNAI needs to be used as a target DNAI.
\- Adding, replacing or removing a UPF in the data path to e.g. act as an UL
CL or a Branching Point e.g. as described in clause 4.3.5.
\- Allocate a new Prefix to the UE (when IPv6 multi-Homing applies).
\- Updating the UPF in the target DNAI with AF influence on traffic routing
control parameters as described in clause 5.6.7.1 of TS 23.501 [2].
\- Subscribe to notifications from the AMF for an Area of Interest via
Namf_EventExposure_Subscribe service operation.
\- Determining whether to relocate PSA UPF considering the user plane latency
requirements provided by the AF (see clause 6.3.6 of TS 23.548 [74]).
When the updated policy information about the PDU Session is received from the
PCF, the SMF may take appropriate actions to assist the EAS discovery and re-
discovery for PDU Session with Session Breakout connectivity model such as:
\- Retrieve the EAS deployment information as defined in clause 6.2.3.4.1 of
TS 23.548 [74].
\- Providing DNS message handling rule to forward DNS messages of the UE
and/or report when detecting DNS messages as defined in clause 6.2.3.2.2 of TS
23.548 [74].
In the case of AF influence on Service Function Chaining, the SMF may take
appropriate actions to enforce the N6-LAN traffic steering control:
\- Provide N6-LAN traffic steering control parameters to UPF as described in
clause 5.6.16 of TS 23.501 [2].
7\. The SMF may decide whether it is required to send the target DNAI to the
AMF for triggering SMF/I-SMF (re)selection and then inform the target DNAI
information for the current PDU session or for the next PDU session to AMF via
Nsmf_PDUSession_SMContextStatusNotify service operation.
#### 4.3.6.3 Notification of User Plane Management Events
The SMF may send a notification to the AF if the AF had subscribed to user
plane management event notifications as described in clause 4.3.6.2 and in
clause 5.6.7 of TS 23.501 [2]. The following are the examples of such events:
\- A PDU Session Anchor identified in the AF subscription request has been
established or released.
\- A DNAI has changed.
\- The SMF has received a request for AF notification and the on-going PDU
Session meets the conditions to notify the AF.
\- Ethernet PDU Session Anchor Relocation as defined in clause 4.3.5.8.
\- Candidate DNAI(s) has changed.
\- A common EAS has changed.
The SMF uses notification reporting information received from PCF to issue the
notification either via an NEF (2a, 2b and 4a, 4b) or directly to the AF (2c
and 4c).
In the case of the AF interacting with VPLMN in the HR-SBO case, the NF(s) in
the procedure are located in VPLMN.
NOTE 1: 1a: In HR-SBO case, no PCF in VPLMN is involved.
The following flow depicts the sequence of events:
Figure 4.3.6.3-1: Notification of user plane management event
1\. A condition for an AF notification has been met as described above. The
SMF sends notification to the NF that is subscribed for SMF notifications.
Further processing of the SMF notification depends on the receiving NF, as
shown in steps 2a and 2c.
If immediate reporting flag is included in AF subscription for user plane
management event as described in clause 5.6.7 of TS 23.501 [2], SMF sends
notification, as shown in steps 2a or 2c.
2a. If early notification via NEF is requested by the AF, the SMF notifies the
NEF of the target DNAI or candidate DNAI(s) of the PDU Session or indication
of EAS rediscovery and may indicate capability of supporting EAS IP
replacement in 5GC by invoking Nsmf_EventExposure_Notify service operation.
The SMF may provide the target AF ID if it determines that the target DNAI is
not supported by the source AF as specified in TS 23.548 [74]. The SMF may
consider the UE location and available DNAI list provided by AF to select the
closest available DNAI(s) as candidate DNAI(s). The SMF may also provide the
candidate DNAI(s) in a prioritized order.
NOTE 2: For the reporting of candidate DNAIs from SMF/NEF to AF, only early
notification is used.
2b. When the NEF receives Nsmf_EventExposure_Notify, the NEF performs
information mapping (e.g. AF Transaction Internal ID provided in Notification
Correlation ID to AF Transaction ID, SUPI to GPSI, etc.) as applicable
according to clause 5.6.7 of TS 23.501 [2] and triggers the appropriate
Nnef_TrafficInfluence_Notify message. In this case, step 2c is not applicable.
2c. If early direct notification is requested by the AF, the SMF notifies the
AF of the target DNAI or candidate DNAI(s) of the PDU Session or indication of
EAS rediscovery and may indicate capability of supporting EAS IP replacement
in 5GC by invoking Nsmf_EventExposure_Notify service operation. The SMF may
provide the target AF ID if it determines that the target DNAI is not
supported by the source AF.
2d. The AF replies to Nnef_TrafficInfluence_Notify by invoking
Nnef_TrafficInfluence_AppRelocationInfo service operation either immediately
or after any required application relocation in the target DNAI is completed.
The AF may include N6 traffic routing details corresponding to the target DNAI
and /or the \'uplink buffering\' indication to indicate that buffering of
uplink traffic to the target DNAI is needed. The AF may include Information
for EAS IP Replacement in 5GC. AF may reply in negative e.g. if the AF
determines that the application relocation cannot be completed successfully
and/or on time.
NOTE 3: The maximum time the new PSA is to buffer UL data relates to the
maximum delay between steps 4a-4c and step 4f/4g of Figure 4.3.6.3-1. SMF
local policies can control this maximum time.
NOTE 4: The traffic being buffered is the traffic associated with the PCC rule
that has requested the notification.
2d-a. If information sent via Nnef_TrafficInfluence_Create is to be changed
e.g. N6 traffic routing details corresponding to the target DNAI, the AF
invokes Nnef_TrafficInfluence_update service operation in order for PCF to be
able to include this information in PCC rules sent to SMF.
If the AF includes information such as N6 traffic routing details
corresponding to the target DNAI in Nnef_TrafficInfluence_AppRelocationInfo it
shall include the same information in Nnef_TrafficInfluence_update.
If common DNAI or common EAS is required for set of UEs and AF is used to
select common DNAI or common EAS according to operator\'s configuration, the
AF determines the common DNAI/EAS according to the candidate DNAI(s) of each
UE of the set reported by SMF(s) serving the set of UEs, then informs SMF(s)
of each UE of the selected common DNAI as clause 6.2.3.2.6 of TS 23.548 [74]
or the selected common EAS as clause 6.2.3.2.5 of TS 23.548 [74].
2e. When the NEF receives Nnef_TrafficInfluence_AppRelocationInfo, the NEF
triggers the appropriate Nsmf_EventExposure_AppRelocationInfo message.
2e-a. When the NEF receives Nnef_TrafficInfluence_update, the NEF triggers
step 3a as in Figure 4.3.6.2-1 or step 2 of Figure 4.3.6.4-1 if targeting an
individual UE by a UE address.
2f. The AF replies to Nsmf_EventExposure_Notify by invoking
Nsmf_EventExposure_AppRelocationInfo service operation either immediately or
after any required application relocation in the target DNAI is completed. The
AF may include N6 traffic routing details corresponding to the target DNAI and
/or the \'uplink buffering\' indication to indicate that buffering of uplink
traffic to the target DNAI is needed. The AF may include Information for EAS
IP Replacement in 5GC. AF may reply in negative e.g. if the AF determines that
the application relocation cannot be completed successfully on time.
2f-a. If information sent via Npcf_PolicyAuthorization_Create is to be changed
e.g. N6 traffic routing details corresponding to the target DNAI, the AF
invokes Npcf_PolicyAuthorization_Update service operation in order for PCF to
be able to include this information in PCC rules sent to SMF.
If the AF includes information such as N6 traffic routing details
corresponding to the target DNAI in Nsmf_EventExposure_AppRelocationInfo it
shall include the same information in Npcf_PolicyAuthorization_Update.
3\. The SMF enforces the change of DNAI or addition, change, or removal of a
UPF. This may correspond to the mechanisms described in Figure 4.3.5.6-1 or in
Figure 4.3.5.7-1.
If the runtime coordination between 5GC and AF is enabled based on local
configuration, according to the indication of \"AF acknowledgment to be
expected\" included in AF subscription to SMF events, the SMF may wait for a
response from the AF to the early notification before this step. The SMF does
not perform this step until it receives a positive response from the AF, as
described in clause 5.6.7 of TS 23.501 [2].
4a. If late notification via NEF is requested by the AF, the SMF notifies the
NEF of the target DNAI of the PDU Session or indication of EAS rediscovery and
may indicate capability of supporting EAS IP replacement in 5GC by invoking
Nsmf_EventExposure_Notify service operation. The SMF may provide the target AF
ID if it determines that the target DNAI is not supported by the source AF.
If the runtime coordination between 5GC and AF is enabled based on local
configuration, according to the indication of \"AF acknowledgment to be
expected\" included in AF subscription to SMF events, the SMF may send late
notification and wait for a positive response from the AF before activating
the new UP path, as described in clause 5.6.7 of TS 23.501 [2].
4b. When the NEF receives Nsmf_EventExposure_Notify, the NEF performs
information mapping (e.g. AF Transaction Internal ID provided in Notification
Correlation ID to AF Transaction ID, SUPI to GPSI, etc.) as applicable
according to clause 5.6.7 of TS 23.501 [2] and triggers the appropriate
Nnef_TrafficInfluence_Notify message. In this case, step 4c is not applicable.
4c. If late direct notification is requested by the AF, the SMF notifies the
AF of the target DNAI of the PDU Session or indication of EAS rediscovery may
indicate capability of supporting EAS IP replacement in 5GC by invoking
Nsmf_EventExposure_Notify service operation. The SMF may provide the target AF
ID if it determines that the target DNAI is not supported by the source AF.
4d. When the AF receives either the Nnef_TrafficInfluence_Notify message or
the Nsmf_EventExposure_Notify message, the AF checks whether it can serve the
target DNAI. If the AF instance change is needed, the AF determines the proper
target AF for the target DNAI (e.g. based on locally configured information or
the AF ID provided by the SMF in step 4a or 4c) and performs the AF migration.
NOTE 5: If the source AF is already locally configured with information
associated with the target DNAI, the source AF is assumed to use the locally
configured information, even if it has received from the SMF target AF ID in a
previous step above.
NOTE 6: The determination of the target AF for the target DNAI and the AF
migration to the target AF are out of the scope of this release.
4e. The AF replies to Nnef_TrafficInfluence_Notify by invoking
Nnef_TrafficInfluence_AppRelocationInfo service operation either immediately
or after any required application relocation in the target DNAI is completed.
AF includes N6 traffic routing details corresponding to the target DNAI. AF
may reply in negative e.g. if the AF determines that the application
relocation cannot be completed successfully on time.
Nnef_TrafficInfluence_AppRelocationInfo with positive response may indicate
that buffering of uplink traffic to the target DNAI is no more needed.
If SMF has sent an EAS re-discovery request to the UE as defined in TS 23.548
[74], e.g. due to change of common EAS, the SMF sends an indication to the AF
that an EAS re-discovery request has been sent to the UE.
NOTE 7: The action taken by the AF when receiving such an indication that an
EAS re-discovery request has been sent to the UE is out of scope of 3GPP
specifications.
4e-a. If information sent via Nnef_TrafficInfluence_Create/Update is to be
changed e.g. N6 traffic routing details corresponding to the target DNAI, the
AF invokes Nnef_TrafficInfluence_Create or Nnef_TrafficInfluence_Update
service operation in order for PCF to be able to include this information in
PCC rules sent to SMF. The Nnef_TrafficInfluence_Create shall be used if the
AF is notified (e.g. in step 4b) that the UE IP address is changed and the
initial Nnef_TrafficInfluence_Create was targeted to an individual UE address,
otherwise the Nnef_TrafficInfluence_Update may be used.
If the AF includes information such as N6 traffic routing details
corresponding to the target DNAI in Nnef_TrafficInfluence_AppRelocationInfo it
shall include the same information in Nnef_TrafficInfluence_Create or
Nnef_TrafficInfluence_Update, whichever is appropriate.
4f. When the NEF receives Nnef_TrafficInfluence_AppRelocationInfo, the NEF
triggers the appropriate Nsmf_EventExposure_AppRelocationInfo message.
4f-a. When the NEF receives Nnef_TrafficInfluence_Create/update, the NEF
triggers step 3a as in Figure 4.3.6.2-1 or step 2 of Figure 4.3.6.4-1 if
targeting an individual UE by a UE address.
4g. The AF replies to Nsmf_EventExposure_Notify by invoking
Nsmf_EventExposure_AppRelocationInfo service operation either immediately or
after any required application relocation in the target DNAI is completed. AF
includes N6 traffic routing details corresponding to the target DNAI. AF may
reply in negative e.g. if the AF determines that the application relocation
cannot be completed successfully on time. Nsmf_EventExposure_AppRelocationInfo
with positive response may indicate that buffering of uplink traffic to the
target DNAI is no more needed.
4g-a. If information sent via Npcf_PolicyAuthorization_Create/Update is to be
changed e.g. N6 traffic routing details corresponding to the target DNAI, the
AF invokes Npcf_PolicyAuthorization_Create or Npcf_PolicyAuthorization_Update
service operation in order for PCF to be able to include this information in
PCC rules sent to SMF. The Npcf_PolicyAuthorization_Create shall be used if
the AF is notified (e.g. in step 4c) that the UE IP address is changed,
otherwise the Npcf_PolicyAuthorization_Update may be used.
If the AF includes information such as N6 traffic routing details
corresponding to the target DNAI in Nsmf_EventExposure_AppRelocationInfo it
shall include the same information in Npcf_PolicyAuthorization_Create or
Npcf_PolicyAuthorization_Update, whichever is appropriate.
#### 4.3.6.4 Transferring an AF request targeting an individual UE address to
the relevant PCF
Figure 4.3.6.4-1: Handling an AF request targeting an individual UE address to
the relevant PCF
Depending on the AF deployment (see clause 6.2.10 of TS 23.501 [2]), the AF
may send the AF request to PCF directly, in which case step 1 is skipped, or
via the NEF.
1\. [Conditional] If the AF sends the AF request via NEF, the AF sends
Nnef_TrafficInfluenceCreate/Update/Delete Request targeting an individual UE
address to the NEF. This request corresponds to an AF request to influence
traffic routing to a local network and/or to a service function chain that
targets an individual UE address.
When NEF receives an AF request from AF, the NEF ensures the necessary
authorization control and as described in clause 4.3.6.1, mapping from the
information provided by the AF into information needed by the 5GC. The NEF
responds to the AF.
2\. [Conditional] AF/NEF consumes Nbsf_Management_Discovery service operation
(providing at least the UE address) to find out the address of the relevant
PCF if the PCF address is not available on the NEF based on local
configuration, otherwise step 1 is skipped.
NOTE 1: The AF/NEF finds the BSF based on local configuration or using the
NRF.
3\. BSF provides the PCF address in the Nbsf_Management_Discovery response to
AF/NEF.
4\. If step 1 was performed, NEF invokes the Npcf_PolicyAuthorization service
to the PCF to transfer the AF request. If an AF sends the AF request directly
to the PCF, AF invokes Npcf_PolicyAuthorization service and the PCF responds
to the AF. To support the AF instance change, the
Npcf_PolicyAuthorization_Create (initiated by target AF) or
Npcf_PolicyAuthorization_Update (initiated by source AF or target AF) service
operation may be used.
NOTE 2: If the source AF transfers the application context to the target AF,
then target AF may create new subscription via Npcf_PolicyAuthorization_Create
or update existing subscription via Npcf_PolicyAuthorization_Update. However,
whether and how the application context transfer is done is out of this
specification.
5\. The PCF authorizes the AF request. If the PCF determines that the
requirements can\'t be authorized, it rejects the AF request. Once the PCF
authorizes the AF request, the PCF updates the SMF with corresponding new PCC
rule(s) with PCF initiated SM Policy Association Modification procedure as
described in clause 4.16.5.2.
The PCF includes the Traffic Steering Policy ID(s) for AF influence on traffic
routing Enforcement Control information and/or N6-LAN Traffic Steering
Enforcement Control information in the relevant PCC rule as defined in clause
6.3.1 of TS 23.503 [20].
The PCF may, optionally, use service experience analytics per UP path, as
defined in clause 6.4.3 of TS 23.288 [50], to provide a an updated list of
DNAI(s) to the SMF.
If Npcf_PolicyAuthorization_Update service operation is invoked, the PCF is
required to update the subscription resource. The
Npcf_PolicyAuthorization_Update service operation may include an updated
notification target address. The updated subscription resource is used by the
target AF.
When a PCC rule is received from the PCF, the SMF may take appropriate
actions, when applicable, to reconfigure the User plane of the PDU Session.
In the case of AF influence on traffic routing, examples of actions are:
\- The SMF may consider service experience analytics and/or DN Performance
analytics per UP path (i.e. including UPF and/or DNAI and/or AS instance) as
defined in clauses 6.4.3 and 6.14.3, respectively, of TS 23.288 [50] before
taking any actions.
\- Determining a target DNAI and adding, replacing or removing UPF(s) in the
data path, e.g. to act as UL CL, Branching Point and/or PDU Session Anchor
e.g. as described in clause 4.3.5.
\- Allocate a new Prefix to the UE (when IPv6 multi-Homing applies).
\- Updating the UPF regarding the target DNAI with AF influence on traffic
routing control parameters as described in clause 5.6.7.1 of TS 23.501 [2].
\- Subscribe to notifications from the AMF for an Area of Interest via
Namf_EventExposure_Subscribe service operation.
\- Determining whether to relocate PSA UPF considering the user plane latency
requirements provided by the AF (see clause 6.3.6 of TS 23.548 [74]).
In the case of AF influence on Service Function Chaining, the SMF may take
appropriate actions to enforce the N6-LAN traffic steering control:
\- Provide N6-LAN traffic steering control parameters to UPF as described in
clause 5.6.16 of TS 23.501 [2].
#### 4.3.6.5 Processing AF requests to influence traffic routing for HR-SBO
session
Processing an AF requests to influence traffic routing for HR-SBO session are
based on procedure described in clause 4.3.6.2 and clause 4.3.6.4 with the
following differences:
In step 0 of figure 4.3.6.2-1, V-SMF supporting HR-SBO subscribes to
notification of AF request by invoking Nnef_TrafficInfluenceData_Subscribe
service from V-NEF (Data Set = Application Data; Data Subset = AF traffic
influence request information; Data Key = S-NSSAI and/or DNN and UE IP
address) and (Data Set = Application Data; Data Subset = AF traffic influence
request information; Data Key = S-NSSAI and/or DNN and Any UE) and (Data Set =
Application Data; Data Subset = AF traffic influence request information; Data
Key = S-NSSAI and/or DNN and SUPI).
\- For any UE, the V-SMF supporting HR-SBO performs the above subscription
using S-NSSAI and/or DNN as Data Key.
\- For individual UE or group of UE(s), when a PDU Session is authorized for
HR-SBO as described in clause 6.7 of TS 23.548 [74], the V-SMF serving the PDU
Session performs the above subscription using S-NSSAI and/or DNN and/or
Internal Group Identifier(s) or SUPI as Data Key. The V-NEF subscribes to
notification of AF request from V-UDR.
Steps 4 and 5 of figure 4.3.6.2-1 are replaced with the following steps:
\- Step 4: The V-UDR notifies the subscribed V-NEF of the AF traffic influence
request information.
\- Step 5: The V-NEF notifies the subscribed V-SMF of the AF traffic influence
request information.
### 4.3.7 CN-initiated selective deactivation of UP connection of an existing
PDU Session
The following procedure is used to deactivate UP connection (i.e. data radio
bearer and N3 tunnel) for an established PDU Session of a UE in CM-CONNECTED
state.
For an always-on PDU Session, the SMF should not configure the UPF to report
inactivity.
Figure 4.3.7-1: CN-initiated deactivation of UP connection for an established
PDU Session
1\. The SMF determines that the UP connection of the PDU Session can be
deactivated in following cases:
\- During handover procedure, if all the QoS Flows of a PDU Session are
rejected by the target NG-RAN (as described in clause 4.9.1), or if a PDU
Session is failed to setup indicated by the AMF (see step 7 of clause
4.9.1.3.3). SMF proceeds with step 2 and step 3, the steps 5 to 9 are skipped;
\- The UPF detects that the PDU Session has no data transfer for a specified
Inactivity period as described in clause 4.4.2.2;
\- For PDU sessions belonging to a network slice that is in the Partially
Allowed NSSAI (see clause 5.15.17 in TS 23.501 [2]), or with Network Slice
Area of Service not matching deployed Tracking Areas (see clause 5.15.18 of TS
23.501 [2]) the AMF notifies to the SMF that it has detected that the UE moved
out of the network slice area of support or availability;
\- For a LADN PDU Session, the AMF notifies to the SMF that the UE moved out
of the LADN service area; or
\- The AMF notifies to the SMF that the UE moved out of the Allowed Area.
The SMF may decide to release the UPF of N3 terminating point. In that case
the SMF proceeds with step 2 and step 3. Otherwise, if the SMF decides to keep
the UPF of N3 terminating points, the SMF proceeds with step 4. To assist SMF
in this decision the SMF may make use of UE presence pattern in LADN service
area based on UE mobility analytics from the NWDAF as described in clause
6.7.2 of TS 23.288 [50].
The SMF may make use of UE Communication analytics provided by NWDAF, as
described in clause 6.7.3 of TS 23.288 [50], to determine the value of an
Inactivity Timer for a PDU Session provided to the UPF.
2\. The SMF may initiate an N4 Session Release procedure to release the
intermediate UPF of N3 terminating point. If there are multiple intermediate
UPFs, this step can be performed for each UPFs to be released. The SMF needs
to initiate N4 Session Modification procedure to the UPF (i.e. N9 terminating
point or PDU Session Anchor) connecting to the released UPF in step 3.
3\. If the intermediate UPF(s) of N3 terminating point is released in step 2,
the SMF initiates an N4 Session Modification procedure towards the UPF (PDU
Session Anchor or another intermediate UPF) connecting to the released UPF,
indicating the need to remove CN Tunnel Info for N9 tunnel of the
corresponding PDU Session. In this case, the UPF connecting to the released
UPF buffers the DL packets for this PDU Session or drops the DL packets for
this PDU session or forwards the DL packets for this PDU session to the SMF,
based on buffering instruction provided by the SMF as described in clause
5.8.3.2 or clause 5.8.3.3 of TS 23.501 [2]. If the PDU Session corresponds to
a LADN and the UE moved out of the LADN service area, the SMF may notify the
UPF connecting to the released UPF to discard downlink data for the PDU
Sessions and/or to not provide further Data Notification messages.
Otherwise, N4 Session Modification procedure occurs toward N3 terminating
point.
4\. If the UPF of N3 terminating point is not released in step 2, the SMF
initiates an N4 Session Modification procedure indicating the need to remove
AN Tunnel Info for N3 tunnel of the corresponding PDU Session. In this case,
the UPF buffers the DL packets for this PDU Session or drops the DL packets
for this PDU session or forwards the DL packets for this PDU session to the
SMF, based on buffering instruction provided by the SMF as described in clause
5.8.3.2 or clause 5.8.3.3 of TS 23.501 [2]. If the PDU Session corresponds to
a LADN and the UE moved out of the LADN service area, the SMF may notify the
UPF to discard downlink data for the PDU Sessions and/or to not provide
further Data Notification messages.
5\. The SMF invokes the Namf_Communication_N1N2MessageTransfer service
operation (PDU Session ID, N2 SM Information (N2 Resource Release Request (PDU
Session ID))) to release the NG-RAN resources associated with the PDU Session.
6\. The AMF sends the N2 PDU Session Resource Release Command including N2 SM
information (N2 Resource Release Request (PDU Session ID)) received from the
SMF via N2 to the NG-RAN.
7\. The NG-RAN may issue NG-RAN specific signalling exchange (e.g. RRC
Connection Reconfiguration) with the UE to release the NG-RAN resources
related to the PDU Session received from the AMF in step 5. When a User Plane
connection for a PDU Session is released, the AS layer in the UE indicates it
to the NAS layer.
If the UE is in RRC_INACTIVE state, this step is skipped. When the UE becomes
RRC_CONNECTED state from RRC_INACTIVE state, the NG-RAN and UE synchronize the
released radio resources for the deactivated PDU Session as described in TS
36.331 [16] and TS 38.331 [12].
8\. The NG-RAN acknowledges the N2 PDU Session Resource Release Command to the
AMF including N2 SM Resource Release Ack (User Location Information, Secondary
RAT Usage Data).
9\. The AMF invokes the Nsmf_PDUSession_UpdateSMContext service operation (N2
SM Information(Secondary RAT Usage Data)) to acknowledge the Namf service
received in step 5.
### 4.3.8 Change of Network Slice instance for PDU Sessions
When a Network Slice instance for the existing PDU Session is required to be
changed as described in clause 5.15.5.3 of TS 23.501 [2], the AMF deletes the
old NSI ID corresponding to the Network Slice instance that is congested or no
longer available and informs the SMF of the PDU Session(s) which is selected
by using such old NSI ID to release this PDU session with appropriate cause
value as described in clause 4.3.4.2. If so, the SMF triggers the impacted
UE(s) to establish new PDU session(s) associated with the same S-NSSAI by
using the procedures for PDU Session(s) of SSC mode 2 or SSC mode 3 as defined
in clause 4.3.5.
When UE initiates PDU Session Establishment procedure, the AMF may select a
new Network Slice instance for the given S-NSSAI during PDU Session
Establishment by querying the NSSF as described in the clause 4.3.2.2.3. If
there is no Network Slice instance available, the network may change the
related network slice(s) for the UE as described in clause 5.15.5.2.2 of TS
23.501 [2].
## 4.4 SMF and UPF interactions
### 4.4.1 N4 session management procedures
#### 4.4.1.1 General
N4 session management procedures are used to control the functionality of the
UPF. The SMF can create, update and remove the N4 session context in the UPF,
which is described in clause 5.8.2 of TS 23.501 [2].
The following N4 session management procedures exist: N4 Session Establishment
procedure, N4 session Modification procedure and N4 session release procedure.
All of them are initiated by the SMF.
#### 4.4.1.2 N4 Session Establishment procedure
The N4 Session Establishment procedure is used to create the initial N4
session context for a PDU Session at the UPF. The SMF assigns a new N4 Session
ID and provides it to the UPF. The N4 Session ID is stored by both entities
and used to identify the N4 session context during their interaction. The SMF
also stores the relation between the N4 Session ID and PDU Session for a UE.
Figure 4.4.1.2-1 N4 Session Establishment procedure
1\. SMF receives the trigger to establish a new PDU Session or change the UPF
for an established PDU Session.
2\. The SMF sends an N4 session establishment request message to the UPF that
contains the structured control information which defines how the UPF needs to
behave.
3\. The UPF responds with an N4 session establishment response message
containing any information that the UPF has to provide to the SMF in response
to the control information received.
If the UPF (by configuration or other means) utilizes an NWDAF, UPF adds the
NWDAF serving the UE identified by the NWDAF instance ID. Per NWDAF service
instance the Analytics ID(s) are also included.
NOTE: The SMF can use this NWDAF related information and can forward it to the
PCF using the SMF initiated SM Policy Modification procedure, as a result of a
Policy Control Request Trigger.
4\. The SMF interacts with the network function which triggered this procedure
(e.g. AMF or PCF).
#### 4.4.1.3 N4 Session Modification procedure
The N4 Session Modification procedure is used to update the N4 session context
of an existing PDU Session at the UPF, which is executed between SMF and UPF
whenever PDU Session related parameters have to be modified.
Figure 4.4.1.3-1 N4 Session Modification procedure
1\. SMF receives the trigger to modify the existing PDU Session.
2\. The SMF sends an N4 session modification request message to the UPF that
contains the update for the structured control information which defines how
the UPF needs to behave.
3\. The UPF identifies the N4 session context to be modified by the N4 Session
ID. Then, the UPF updates the parameters of this N4 session context according
to the list of parameters sent by the SMF. The UPF responds with an N4 session
modification response message containing any information that the UPF has to
provide to the SMF in response to the control information received.
4\. The SMF interacts with the network entity which triggered this procedure
(e.g. AMF or PCF).
#### 4.4.1.4 N4 Session Release procedure
The N4 session release procedure is used to remove the N4 session context of
an existing PDU Session at the UPF.
Figure 4.4.1.4-1 N4 Session Release procedure
1\. SMF receives the trigger to remove the N4 session context for the PDU
Session.
2\. The SMF sends an N4 session release request message to the UPF.
3\. The UPF identifies the N4 session context to be removed by the N4 Session
ID and removes the whole session context. The UPF responds with an N4 session
release response message containing any information that the UPF has to
provide to the SMF.
4\. The SMF interacts with the network entity which triggered this procedure
(e.g. AMF or PCF).
### 4.4.2 N4 Reporting Procedures
#### 4.4.2.1 General
The N4 reporting procedure is used by the UPF to report events to the SMF.
#### 4.4.2.2 N4 Session Level Reporting Procedure
This procedure is used by the UPF to report events related to an N4 session
for an individual PDU Session. The triggers for event reporting were
configured on the UPF during N4 Session Establishment/Modification procedures
by the SMF.
Figure 4.4.2.2-1: N4 Session Level Reporting procedure
1\. The UPF detects that an event has to be reported. The reporting triggers
include the following cases:
(1) Measurement information reporting (Usage Report).
Measurement information shall be collected in the UPF and reported to the SMF
as defined in clause 5.8 and clause 5.12 of TS 23.501 [2].
NOTE 1: The Usage Report is also used for the reporting of other events or
information. For details refer to clause 7.5.8.3 of TS 29.244 [69].
(2) Start of traffic detection (Usage Report).
When traffic detection is requested by SMF and the start of traffic is
detected for a Packet Detection Rule (PDR) as described in clause 5.8 of TS
23.501 [2], the UPF shall report the start of traffic detection to the SMF and
indicate the corresponding PDR rule ID.
(3) Stop of traffic detection (Usage Report).
When traffic detection is requested by SMF and the end of traffic is detected
for a PDR as described in clause 5.8 of TS 23.501 [2], the UPF shall report
the stop of traffic detection to the SMF and indicate the corresponding PDR
rule ID.
(4) Detection of 1st downlink packet for a QoS Flow of a PDU Session with UP
Connection deactivated (Downlink Data Report).
When UPF receives the first downlink packet for a QoS Flow but no N3/N9 tunnel
for downlink data transmission exists and the buffering is performed by the
UPF, it shall report the detection of 1st downlink packet to SMF also
indicating the QoS Flow for which the downlink packet was received (for the
purpose of downlink data notification). The UPF shall also report the DSCP of
the packet if the PDU Session type is IP (to support the Paging Policy
Differentiation feature described in clause 5.4.3 of TS 23.501 [2]).
(5) Detection of PDU Session Inactivity for a specified period (User Plane
Inactivity Report).
When an Inactivity Timer for a PDU Session is provided by SMF during N4
Session Establishment/Modification procedure and the UPF detects the PDU
Session has no data transfer for a period specified by the Inactivity Timer,
it shall report PDU Session Inactivity to the SMF.
NOTE 2: As described in clause 4.3.7, an Inactivity Timer to the UPF is not
provided by the SMF for always-on PDU Sessions.
(6) QoS Monitoring Report (Session Report).
When the QoS Monitoring is enabled for the QoS Flow, performs the necessary
actions as described in clause 5.45 of TS 23.501 [2]. The details about when
and how the UPF sends the QoS Monitoring reports are described in clause
5.8.2.18 of TS 23.501 [2]. When receiving the QoS monitoring reports from the
UPF, the SMF sends the reports to the target NF according to the information
for QoS Monitoring received in the PCC rules as described in TS 23.503 [20].
(7) TSC Management Information available (TSC Management Information).
When TSC management information is available, the UPF shall provide the TSC
management information in the TSC Management Information to the SMF as defined
in clause 5.8.5.14 of TS 23.501 [2].
(8) Discard Downlink Traffic detection (Downlink Data Report).
When discarded downlink traffic detection is requested by SMF for a PDR and
the first downlink packet is discarded after being buffered for this PDR as
described in clause 5.8.3.2 of TS 23.501 [2], the UPF shall report the
discarded downlink traffic detection to the SMF and indicate the corresponding
PDR rule ID (for the purpose of downlink data delivery status notification).
(9) Buffered Downlink Traffic detection (Downlink Data Report).
When buffered downlink traffic detection is requested by SMF for a PDR and the
first downlink packet is buffered for this PDR as described in clause 5.8.3.2
of TS 23.501 [2], the UPF shall report the buffered downlink traffic detection
to the SMF and indicate the corresponding PDR rule ID (for the purpose of
downlink data delivery status notification).
(10) N6 Traffic Parameter Measurement Report (Session Report).
When the N6 Traffic Parameters measurement report is requested by SMF for a
QoS Flow as described in clause 5.37.8.2 of TS 23.501 [2], the UPF shall
report to the SMF the N6 Traffic Parameter(s) for the specified QoS Flow (i.e.
the N6 jitter range associated with the DL periodicity and conditionally, the
UL/DL periodicity).
2\. The UPF sends an N4 session report message (N4 Session ID, list of [Usage
Report, Downlink Data Report, Session Report, User Plane Inactivity Report,
TSC Management Information]) to the SMF.
3\. The SMF identifies the N4 session context based on the received N4 Session
ID and applies the reported information for the corresponding PDU Session. The
SMF responds with an N4 session report ACK message.
### 4.4.3 N4 Node Level Procedures
#### 4.4.3.1 N4 Association Setup Procedure
The N4 Association Setup procedure is used to setup an N4 association between
the SMF and the UPF, to enable the SMF to use the resources of the UPF
subsequently to establish N4 Sessions. The SMF and UPF may exchange the
supported functionalities on each side during these procedures.
The setup of an N4 association is initiated by the SMF. SMF and UPF may
additionally support an N4 association initiated by UPF.
The SMF should only establish an N4 association with a UPF that supports
F-TEID allocation at the UPF.
The SMF initiates the N4 Association Setup procedure to request to setup an N4
association towards a UPF prior to establishing a first N4 session on this
UPF.
When receiving an N4 Association Setup Request, the UPF shall send an N4
Association Setup Response.
N4 Association Setup procedure can be used to request the UPF to measure and
report the clock drift between the external time and 5GS time for one or more
external time domains by provisioning External Clock Drift Report and
providing the corresponding Time Domain number(s) as specified in TS 29.244
[69]. The SMF may omit the Time domain number in the request; in this case the
UPF shall report the clock drift for all Time domains the UPF is connected to.
Figure 4.4.3.1-1: N4 association setup procedure initiated by SMF
The UPF may initiate the N4 Association Setup procedure to request to setup an
N4 association towards a SMF prior to establishing a first N4 session on this
UPF.
When receiving an N4 Association Setup Request, the SMF shall send an N4
Association Setup Response.
Figure 4.4.3.1-2: N4 association setup procedure initiated by UPF
#### 4.4.3.2 N4 Association Update Procedure
The N4 Association Update procedure shall be used to modify an existing N4
association between the SMF and the UPF. It may be initiated by the UPF or by
the SMF to update the supported features or available resources of the UP
function.
N4 Association Update procedure can be used by the SMF to update the
provisioning of External Clock Drift Report as specified in clause 4.4.3.1.
Figure 4.4.3.2-1: SMF initiated N4 association update procedure
Figure 4.4.3.2-2: UPF initiated N4 association update procedure
#### 4.4.3.3 N4 Association Release Procedure
The N4 Association Release procedure shall be used to terminate the N4
association between the SMF and the UPF due to e.g. OAM reasons. The N4
Association Release Request may be initiated by the SMF or UPF.
Figure 4.4.3.3-1: SMF initiated N4 association release procedure
Figure 4.4.3.3-2: UPF initiated N4 association release procedure
#### 4.4.3.4 N4 Report Procedure
The N4 Report procedure shall be used by the UPF to report information to the
SMF which is not related to a specific N4 session, e.g. to report a user plane
path failure affecting all the N4 sessions towards a remote GTP-U peer.
N4 Report procedure can be used by the UPF to report the clock drift between
the external time and 5GS time for one or more external working domains as
specified in TS 29.244 [69].
Figure 4.4.3.4-1: N4 report procedure
The UPF detects that an event has to be reported and starts the procedure by
sending an N4 Report message (UPF ID, list of [event, status]) to the SMF. The
SMF responds with an N4 report ACK message (SMF ID). The event parameter
contains the name of the event and UPF ID. The status parameter contains the
actual information the control plane function is interested in. If the UPF
detects clock drifting between 5G time and one or more time working domains,
the UPF reports the corresponding external domain number and the time offset
and cumulative rate Ratio according to the provisioning from the SMF as
defined in clause 5.27.2 of TS 23.501 [2]. The UPF includes the Network
Instance (if available) and the combination of DNN and S-NSSAI (if available)
in the report.
NOTE: When the UPF supports more than one NW-TT, the SMF can use the Network
Instance or DNN/S-NSSAI to associate the report with the corresponding N4
sessions and NW-TT.
#### 4.4.3.5 N4 PFD management Procedure
This N4 procedure is used by the SMF to provision or remove all PFD(s)
belonging to an Application Identifier in the UPF. PFD sets belonging to
different Application Identifiers can be managed with the same PFD management
request message.
The N4 PFD management procedure is a node level procedure, i.e. independent of
any PDU Session.
Figure 4.4.3.5-1: PFD management in the UPF
1\. The SMF is triggered to provision or remove the PFD set belonging to an
Application Identifier in the following cases:
When the caching timer expires and there\'s no active PCC rule that refers to
the corresponding application identifier, the SMF informs the UPF to remove
the PFD(s) identified by the Application Identifier.
When a PCC rule is provided for an Application Identifier corresponding to the
PFD(s) that are not already provided to the UPF, the SMF shall provide the
PFD(s) to the UPF (if there are no PFD(s) cached, the SMF retrieves them from
the NEF (PFDF), as described in TS 23.503 [20]).
When any update of the PFD(s) is received from NEF (PFDF) and there are still
active PCC rules in UPF for the Application Identifier.
2\. The SMF sends a PFD management request to the UPF to provision/remove the
PFD(s) corresponding to the Application Identifier(s).
3\. The UPF updates the PFD(s) according to the request and acknowledges by
responding with a PFD management response message.
### 4.4.4 SMF Pause of Charging procedure
The SMF Pause of Charging procedure aims for the SMF charging and usage
monitoring data to more accurately reflect the downlink traffic actually sent
to the AN.
The following are example triggers for the SMF to enable the pause of charging
\- Operator specified criteria/threshold (e.g. number/fraction of
packets/bytes dropped at UPF in downlink since last time the N3 tunnel towards
the AN was released). The SMF requests the UPF to notify the SMF whenever the
criteria/threshold is met.
\- Indication of \"Radio Link Failure\" (see clause 4.2.6).
Based on operator policies, if the trigger for the SMF to enable the pause of
charging is met, the SMF shall pause the charging. When the SMF pauses
charging the following applies:
\- Towards the UPF(s) where the Usage Reporting is configured, the SMF shall
modify the Usage Reporting Rules for the PDU Session so that the usage
collection for charging is stopped.
\- The SMF may request the UPF to limit the rate of downlink traffic sent to
the downstream UPF or the AN.
NOTE 1: A consequence of using this procedure is that SMF charging data does
not correspond to the volume that traversed the UPF and it is therefore not
possible to count the downlink packets dropped between the PDU Session Anchor
(PSA) UPF and the downstream UPF.
NOTE 2: In this release of the specification, pause of charging procedure does
not address the issue of packets dropped by the NG-RAN.
In home routed roaming scenarios, based on operator\'s policy, the H-SMF may
indicate to the V-SMF if the feature is to be enabled on a per PDU Session
basis. This is indicated to the V-SMF by a \"PDU Session Charging Pause
Enabled\" Indication in the Nsmf_PDUSession_Create Response during the PDU
Session Establishment procedure. This is an indication to the V-SMF that when
the criteria for pause of SMF charging are met at the VPLMN (as described
further down in this clause) charging at the H-SMF can be paused.
The H-SMF shall stop any charging and usage monitoring actions for the PDU
Session upon receiving a \"Start Pause of Charging\" Indication in a
Nsmf_PDUSession_Update request from the V-SMF. When the H-SMF receives a
Nsmf_PDUSession_Update request for a PDU Session with a \"Stop Pause of
Charging\" Indication, then the H-SMF shall resume charging for the PDU
Session.
Regardless of operator policy/configuration, the downlink user plane packets
received at the (V-)UPF shall trigger Data Notifications as described in
clause 4.2.3.3.
When the (V-)SMF receives a Nsmf_PDUSession_UpdateSMContext request or a
Namf_EventExposure_Notify about UE reachability, the (V-)SMF shall consider
the PDU Session charging as being unpaused if it had been paused previously.
Figure 4.4.4-1: SMF Pause of charging procedure
1\. The UPF receives downlink data packets for a PDU Session that does not
have an N3 tunnel and the UPF sends data notification to the SMF. The packets
are buffered or discarded in the UPF based on operator policy.
2\. Based on operator policy/configuration the SMF triggers the procedure to
pause PDU Session charging. Triggering criteria are based on SMF operator
policy/configuration.
3\. SMF sends a N4 Session Modification Request message to the UPF where the
Usage Reporting is configured, modifying the Usage Reporting Rules for the PDU
Session so that the usage collection for charging is stopped. In home routed
roaming scenarios, the V-SMF sends a Nsmf_PDUSession_Update request to the
H-SMF with a \"Start Pause of Charging\" Indication. The H-SMF then requests
the H-UPF to stop usage collection as mentioned before.
4\. UPF confirms with a N4 Session Modification Response message.
## 4.5 User Profile management procedures
### 4.5.1 Subscriber Data Update Notification to AMF
Whenever the user profile is changed for a user in the UDM/UDR and the changes
affect the user profile in the AMF, the UDM shall notify these changes to the
affected AMF by the means of invoking Nudm_SDM_Notification service operation.
Then the AMF adds or modifies the user profile.
The Nudm_SDM_Notification service operation specified in clause 5.2.3.3 is
used by the UDM to update subscriber data stored in the AMF.
The AMF takes appropriate action according to the changed subscriber data as
follows, e.g.:
\- initiating an AMF initiated Deregistration procedure if the updated
subscription data indicates the UE is not allowed to roam in this network; and
\- updating UE context stored at AN to modify the UE-AMBR.
\- updating UE context stored at RAN to modify the UE-Slice-MBR corresponding
to an S-NSSAI.
\- initiating UE Configuration Update procedure as defined in clause 4.2.4.2.
\- initiating UE Parameters Update via UDM Control Plane Procedure as defined
in clause 4.20.
UDM can also use the Nudm_SDM_Notification service operation to update the
Steering of Roaming information stored in the UE via the AMF (i.e. a list of
preferred PLMN/access technology combinations and/or Credentials Holder
controlled prioritized lists of preferred SNPNs and GINs and/or Credentials
Holder controlled prioritized lists of preferred SNPNs and GINs for accessing
Localized Services or HPLMN/Credentials Holder indication that \'no change of
the above list(s) stored in the UE is needed\'). UDM can include an indication
for the UE to send an acknowledgement of the reception of this information.
The AMF provides the acknowledgement sent from the UE to UDM using the
Nudm_SDM_Info service operation. For more details regarding the handling of
Steering of Roaming information refer to TS 23.122 [22].
When the subscribed S-NSSAIs change, UDM provides a Network Slicing
Subscription Change Indication to the UE via the AMF. Once the AMF updates the
UE and obtains an acknowledgment from the UE, the AMF informs the UDM that the
UE received the Network Slicing Subscription Change Indication using the
Nudm_SDM_Info service operation.
When the CAG information in the subscription data changes, or when the SUPI
and PEI association changes, UDM provides a CAG information Subscription
Change Indication to the AMF. Once the AMF updates the UE and obtains an
acknowledgment from the UE, the AMF informs the UDM that the UE received the
CAG information using the Nudm_SDM_Info service operation.
If the AMF received a changed Service Gap Time parameter in the updated
subscription data and if the UE has indicated Service Gap Control capability
the AMF shall provide the new Service Gap Time value to the UE in the next
Registration Accept message, or, if the UE does not send any Registration
Request within a certain time period that shall be longer than any MICO mode
or eDRX interval used by the UE, the AMF may initiate a UE Configuration
Update procedure.
### 4.5.2 Session Management Subscriber Data Update Notification to SMF
Whenever the session management subscriber data is changed for a user in the
UDM/UDR and if the SMF subscribed for the update of the session management
subscriber data to be notified, the UDM shall notify these changes to the
affected SMF by the means of invoking Nudm_SDM_Notification service operation.
Then the SMF modifies the session management subscriber data in the UE SM
context.
The Nudm_SDM_Notification service operation specified in clause 5.2.3.3 is
used by the UDM to update session management subscriber data stored in the
SMF.
The SMF initiates appropriate action according to the changed subscriber data,
e.g. including:
\- initiating an SMF initiated PDU Session Modification procedure; or
\- initiating an SMF initiated PDU Session Release procedure.
### 4.5.3 Purge of subscriber data in AMF
An AMF may, as an implementation option, purge the subscriber data and MM
context of a UE after the implicit or explicit Deregistration of the UE. In
this case, the AMF shall unsubscribe and deregister from the UDM, where UDM
may further do corresponding operation from UDR, by the means of following
\"Purge of subscriber data in AMF\" procedure.
Figure 4.5.3-1: Purge of Subscriber Data in AMF
1\. After purging the subscriber data and MM context of a deregistered UE, the
AMF unsubscribes to changes to subscription data using Nudm_SDM_Unsubscribe
request operation (see clause 5.2.3.3.4), for the data the AMF has previously
subscribed (see clause 4.2.2.2.2, step 14b). The UDM unsubscribes the AMF from
the data indicated.
The UDM may unsubscribe to changes to subscription data from UDR by using
Nudr_DM_Unsubscribe for the data the UDM has previously subscribed (see clause
4.2.2.2.2, step 14b).
2\. The UDM sends a response back using Nudm_SDM_Unsubscribe response
operation.
3\. The AMF deregisters from UDM using Nudm_UECM_Deregistration request (SUPI,
NF ID, Access Type) operation (see clause 5.2.3.2.3). The UDM may update UE
context in UDR by Nudr_DM_Update (SUPI, Subscription Data).
4\. The UDM sets the UE Purged flag associated with the Access Type and
acknowledges with a Nudm_UECM_Deregistration response operation.
## 4.6 Security procedures
Security procedures for the 5GS are specified in 33.501 [15].
## 4.7 ME Identity check procedure
The AMF initiates Mobile Equipment Identity Check procedure by invoking the
N5g-eir_MEIdentityCheck_Get service operation as defined in clause 5.2.4.2.2.
## 4.8 RAN-CN interactions
### 4.8.1 Connection Inactive and Suspend procedure
#### 4.8.1.1 Connection Inactive procedure
This procedure may be initiated by the serving NG-RAN node when the UE is in
CM-CONNECTED with RRC_CONNECTED state and has received the \"RRC Inactive
Assistance Information\" from the AMF as defined in clause 5.3.3.2.5 of TS
23.501 [2]. NG-RAN initiates the transition to RRC_INACTIVE state as defined
in TS 38.300 [9].
#### 4.8.1.1a Connection Inactive procedure with CN based MT communication
handling
This procedure may be initiated by the serving NG-RAN node when CN based
mobile terminating (MT) communication handling is requested for a UE that is
configured with eDRX cycle value longer than 10.24 seconds for RRC_INACTIVE
state and has at least one PDU session with active user plane as defined in
clause 5.31.7 of TS 23.501 [2].
Figure 4.8.1.1a-1: NG-RAN initiated Connection Inactive procedure with CN
based MT communication handling
0\. The UE is registered in the network with negotiated eDRX parameters for
CM-IDLE state and is in CM-CONNECTED with RRC_CONNECTED state. The AMF
provides the eDRX values for CM-IDLE state to NG-RAN as part of the RRC
Inactive Assistance Information as defined in clause 5.3.3.2.5 of TS 23.501
[2].
1\. NG-RAN determines eDRX values for UE in RRC_INACTIVE state and decides to
initiate Connection Inactive with CN based MT communication handling as
specified in clause 5.31.7.2.4 of TS 23.501 [2].
1a. Optionally the NG-RAN may initiate state transition from RRC_CONNECTED to
RRC_INACTIVE with RRC configuring eDRX value as specified in TS 38.300 [9].
The NG-RAN may send the request in step 2 towards CN immediately following
step 1a or the NG-RAN may delay this request towards CN as specified in clause
5.31.7.2.1 of TS 23.501 [2].
2\. Either immediately following step 1a or after having delayed the request
for NG-RAN based on implementation, the NG-RAN sends N2 MT Communication
Handling request message to AMF indicating the UE is transitioning to
RRC_INACTIVE state. The CN takes the NG-RAN request into consideration and
handles MT communication. The NG-RAN also provides the determined eDRX values
for RRC_INACTIVE to AMF.
If the NG-RAN receives DL NAS message and the UE is in RRC_INACTIVE with RRC
configured eDRX and is considered not reachable, NG-RAN indicates to the AMF a
NAS non-delivery and then initiates for the CN to handle mobile terminated
(MT) communication.
3\. For each of the PDU sessions with user plane resources have been
activated, the AMF invokes Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID, Cause, Operation type, User Location Information, Age of Location
Information, N2 SM Information (Secondary RAT usage data), CN based MT
handling indication) towards SMF. The Operation Type is set to a value that
indicates to stop user plane DL data transmissions towards the UE and enable
data buffering. The SMF starts data buffering for MT data if the data
buffering is handled in SMF.
4\. If data buffering is handled in the UPF, the SMF updates the UPF with
proper rules for MT data handling.
5\. The SMF sends the Nsmf_PDUSession_UpdateSMContext response.
6\. The AMF sends N2 MT Communication Handling response message to NG-RAN
acknowledging the NG-RAN request and indicating the AMF has taken the NG-RAN
request into account. The AMF considers the UE is in CM-CONNECTED with
RRC_INACTIVE state.
7\. If the UE connection is not released as specified in step 1a, the NG-RAN
initiates state transition from RRC_CONNECTED to RRC_INACTIVE with RRC
configuring the eDRX values as specified in TS 38.300 [9].
#### 4.8.1.2 Connection Suspend procedure
This procedure may be initiated by the serving NG-RAN node when the UE is in
CM-CONNECTED and has at least one PDU session with active user plane
connection and NG-eNB has received indication from the AMF that User Plane
CIoT 5GS Optimisation, as defined in clause 5.31.18 of TS 23.501 [2], is
supported for the UE.
Figure 4.8.1.2-1: NG-RAN initiated Connection Suspend procedure
1\. NG-RAN to AMF: The NG-RAN sends the N2 Suspend Request message to the AMF,
see TS 38.413 [10]. The AMF enters CM-IDLE with Suspend indicator. Context
information related to the NGAP UE association, UE Context and PDU session
context, necessary to resume the connection is stored in the UE, NG-RAN node
and in the AMF. The NG-RAN may include the Suspend cause and the N2 SM
information.
If the UE is served by an NG-eNB that supports WUS, then the NG-eNB should
include the Information On Recommended Cells And RAN nodes For Paging in the
N2 Suspend Request message; otherwise NG-RAN may include the Information On
Recommended Cells And NG-RAN For Paging in the N2 Suspend Request message. If
available, the AMF shall store this information to be used when paging the UE.
The NG-RAN includes Information for Enhanced Coverage, if available, in the N2
Suspend Request message.
If Service Gap Control is being applied to the UE (see clause 4.3.17.9) and
the Service Gap timer is not already running, the Service Gap timer shall be
started in the AMF when entering CM-IDLE, unless the connection was initiated
after a paging of an MT event, or after a mobility registration procedure
without Follow-on Request indication or after a mobility registration
procedure for regulatory prioritized services like Emergency services or
exception reporting.
2\. AMF to SMF: For each of the PDU Sessions in the N2 Suspend Request, the
AMF invokes Nsmf_PDUSession_UpdateSMContext Request (PDU Session ID, Cause,
Operation type, User Location Information, Age of Location Information, N2 SM
Information (Secondary RAT usage data)). The Operation Type is set to \"UP
Suspend\" to indicate suspend of user plane resources for the PDU Session.
3\. SMF to UPF: N4 Session Modification Request (AN Tunnel Info to be
suspended, Buffering on/off).
The SMF initiates an N4 Session Modification procedure indicating the need to
release the tunnel info of AN terminating N3 between AN and UPF. Buffering
on/off indicates whether the UPF shall buffer incoming DL PDU or not.
The UPF sends N4 Session Modification Response to acknowledge the SMF request.
The SMF shall maintain the N3 tunnel info (including both AN Tunnel Info and
the CN Tunnel Info).
NOTE: The UPF maintains the CN tunnel info as it may receive uplink packets
from the AN.
4\. SMF to AMF: The SMF sends Nsmf_PDUSession_UpdateSMContext response to the
AMF.
5\. AMF to NG-RAN: After response for each PDU session in step 4, the AMF
sends N2 Suspend Response to NG-RAN to successfully terminate the Connection
Suspend procedure initiated by the NG-RAN, see TS 38.413 [10].
6\. The NG-RAN sends RRC message to suspend the RRC Connection towards the UE
including UE Resume ID, see TS 36.300 [46]).
If Service Gap Control is applied for the UE (see clause 5.31.16 of TS 23.501
[2]) and the Service Gap timer is not already running, the Service Gap timer
shall be started in the UE when entering CM-IDLE, unless the connection was
initiated as a response to paging of an MT event, or after a mobility
registration procedure without Follow-on Request Indication set or after a
mobility registration procedure for regulatory prioritized services like
Emergency services or exception reporting.
### 4.8.2 Connection Resume procedure
#### 4.8.2.1 General
The Connection Resume procedure is used by a UE to request the establishment
of a secure connection between a UE and the network when the UE is in CM-
CONNECTED with RRC_INACTIVE state, or in CM-IDLE with Suspend indicator for
the UE supporting User Plane CIoT 5GS Optimisation. The UE initiates the
procedure when upper layers or the AS (when responding to RAN paging or upon
triggering RNA updates) requests the resumption of a suspended RRC connection.
NG-RAN details are specified in TS 38.300 [9] and TS 38.331 [12] for NR and in
TS 36.300 [46] and TS 36.331 [16] for E-UTRA.
#### 4.8.2.2 UE Triggered Connection Resume in RRC_INACTIVE procedure
The Connection Resume procedure is used by the UE in RRC_INACTIVE state, e.g.
to transition to RRC_CONNECTED state or for Small Data Transmission while in
RRC_INACTIVE as specified in TS 38.300 [9]. Triggers for the UE to initiate
this procedure are defined in clause 5.3.3.2.5 of TS 23.501 [2].
Figure 4.8.2.2-1: Connection Resume in RRC_INACTIVE
1\. UE to NG-RAN: RRC message (Resume ID).
The UE initiates connection resume from RRC_INACTIVE state, see TS 38.300 [9].
The UE provides its Resume ID needed by the NG-RAN to access the UE\'s stored
Context.
2\. [Conditional] NG-RAN performs UE Context Retrieval.
UE Context Retrieval is performed when the UE Context associated with the UE
attempting to resume its connection is not locally available at the accessed
NG-RAN. The UE Context Retrieval procedure via NG-RAN is specified in TS
38.300 [9].
3\. NG-RAN to UE: RRC messages.
NG-RAN determines whether the UE shall be transitioned to RRC_CONNECTED state
or kept in RRC_INACTIVE (e.g. the latter in the case of Small Data
Transmission as defined in TS 38.300 [9]).
4a. [Conditional] N2 Path switch procedure.
If the accessed NG-RAN is able to retrieve the UE Context, the accessed NG-RAN
node initiates N2 Path Switch procedure, i.e. steps 1 to 8 of clause 4.9.1.2.2
and including Xn data forwarding.
If the Connection Resume procedure is a response to RAN paging which is
triggered by 5GC due to an N2 interface procedure, NG-RAN and 5GC handle the
N2 interface procedure as a collision described in clause 4.9.1.2.
4b. [Conditional] N2 Notification,
4b.1 If the accessed NG-RAN is the same as the NG-RAN that configured
RRC_INACTIVE and still has the UE context, NG-RAN sends:
\- an N2 Notification to the AMF indicating the UE is in RRC_CONNECTED, if an
AMF requested N2 Notification (see clause 4.8.3); or
\- an MT Communication Handling request to the AMF indicating the UE is now
reachable for downlink data and/or signalling if Connection Inactive procedure
with CN based MT communication handling (see clause 4.8.1.1a) has been
performed previously.
4b.2 The AMF invokes Nsmf_PDUSession_UpdateSMContext Request towards SMF
indicating the Downlink data delivery for each PDU session with active user
plane, if the AMF has requested data buffering as described in clause
4.8.1.1a.
4b.3 N4 session modification procedure is triggered by the SMF. If data
buffering is handled in the UPF, the SMF updates the UPF with appropriate
rules to trigger data delivery.
4b.4 The SMF sends the Nsmf_PDUSession_UpdateSMContext response.
4b.5 The AMF sends the N2 MT Communication Handling response message to NG-
RAN.
If NG-RAN determines that the connection resume is for Small Data Transmission
as defined in TS 38.300 [9] and step 4a or steps 4b.1 to 4b.5 have been
performed, then NG-RAN keeps the UE in RRC_INACTIVE state and the UL/DL Small
Data are transferred via the NG-RAN. Based on the procedures defined in TS
38.300 [9], if the UE is re-configured with RRC Inactive with eDRX>10.24s, the
NG-RAN may send an N2 message to 5GC as described in step 2 in clause 4.8.1.1a
so the CN can then handle mobile terminated (MT) communication.
#### 4.8.2.2a Network Triggered Connection Resume in RRC_INACTIVE procedure
The Network Triggered Connection Resume in RRC_INACTIVE procedure is used when
the NG-RAN needs to send data (e.g. the N1 NAS PDU and/or downlink user plane
PDU) to a UE in the RRC_INACTIVE state. During the procedure, the NG-RAN sends
a RAN Paging to the UE in order to trigger the Connection Resume in
RRC_INACTIVE procedure in clause 4.8.2.2.
Figure 4.8.2.2a-1: Network Triggered Connection Resume for UE in RRC_INACTIVE
1\. The NG-RAN receives downlink data (e.g. the N1 NAS PDU and/or the user
plane PDU) for a UE in RRC_INACTIVE State, the NG-RAN buffers the downlink
data and triggers RAN Paging message.
If the NG RAN supports the Paging Cause Indication for Voice Service feature
and if the UE context in NG-RAN indicates that the UE supports the Paging
Cause Indication for Voice Service feature, the NG RAN shall provide the Voice
Service Indication in the RAN Paging message for the UE when it detects that
the downlink data which triggers the RAN Paging message is related to voice
service, as specified in clause 5.38.3 of TS 23.501 [2].
2\. The NG-RAN sends the RAN Paging message to the UE.
3\. If the UE is in RRC_INACTIVE State, based on the RAN paging and the UE
decides to accept the paging, the UE initiates the UE Triggered Connection
Resume in RRC_INACTIVE procedure (see clause 4.8.2.2).
#### 4.8.2.2b Network Triggered Connection Resume in RRC_INACTIVE with CN
based MT communication handling
When the UE is in CM-CONNECTED with RRC_INACTIVE state with CN based mobile
terminating (MT) communication handling, high latency communication as
described in clause 5.31.8 of TS 23.501 [2] is applied.
This procedure may be triggered by MT data, or a N1 procedure from SMF and UPF
as shown in Figure 4.8.2.2b-1. When the procedure is triggered by other NFs
(e.g. SMSF, LMF, GMLC), the UPF (or SMF) in the following figure should be
replaced by the respective NF (the corresponding service operations used by
other NFs when they communicate with AMF may also be different from the
service operations used by SMF/UPF).
During the procedure, the NG-RAN (i.e. gNB) performs RAN paging towards the UE
based on the N2 message from the AMF in order to trigger the UE triggered
Connection Resume procedure in clause 4.8.2.2.
Figure 4.8.2.2b-1: Network Triggered Connection Resume for UE in RRC_INACTIVE
with CN based MT communication handling
1a. When downlink data is received and the SMF/UPF is requested to perform
buffering as specified in clause 4.8.1.1a, the UPF/SMF checks with AMF for the
possibility of data delivery, similar to step 2 of clause 4.24.2 with the
following differences:
\- In the Namf_MT_EnableUEReachability the SMF may also send the PPI, the ARP
and the 5QI, and/or QFI of the QoS Flow of the PDU Session which triggered the
request for paging policy differentiation as defined in clause 5.4.3.2 of TS
23.501 [2].
If the SMF, while waiting for UE triggered Connection Resume indication or a
reject response (with Estimated Maximum Wait time) from the AMF, receives any
additional Data Notification message due to additional data packets for
another QoS Flow associated with a higher priority (i.e. ARP priority level)
than the priority indicated to the AMF in the previous
Namf_MT_EnableUEReachability, or the SMF derive a different Paging Policy
Indicator according to the additional Data Notification, the SMF invokes a new
Namf_MT_EnableUEReachability indicating the higher priority or different
Paging Policy Indicator to the AMF. The information contained in the new
Namf_MT_EnableUEReachability request overrides the information from the
previous Namf_MT_EnableUEReachability request that is stored in the AMF. If
the SMF receives any additional Data Notification messages due to additional
data packets for another QoS Flow associated with same or lower priority than
the priority indicated to the AMF in the previous Namf_MT_EnableUEReachability
or if the SMF has sent the second Namf_MT_EnableUEReachability message
indicating the higher priority and receives additional downlink data packets
for this UE, the SMF buffers these downlink data packets and does not send a
new Namf_MT_EnableUEReachability meassage.
\- The AMF determines if the UE is reachable based on the stored eDRX values
for RRC_INACTIVE state provided by NG-RAN in clause 4.8.1.1a. If the UE is
unreachable, the AMF stores the information received in the
Namf_MT_EnableUEReachability request and provides the Estimated Maximum Wait
time in the response message based on the eDRX values for RRC_INACTIVE in AMF
(steps 2-5 are postponed until the UE becomes reachable). If the UE is
considered reachable, step 2 is executed immediately.
NOTE: This handling is similar to CM-IDLE with eDRX. When the AMF provides the
Estimated Maximum Wait time, it can consider the time needed for RRC level
procedures (e.g. RRC RNA update procedure) when UE wakes up from the eDRX
cycle.
2\. When the AMF determines that the UE is reachable, the AMF sends an N2 DL
Data Notification message to NG-RAN with the request for the UE\'s RRC
connection to be resumed. The AMF may include the following parameter(s) the
PPI, the ARP and the 5QI, and/or QFI of the QoS Flow of the PDU Session ID in
the N2 DL Data Notification message to trigger and enable RAN paging.
3\. NG-RAN performs RAN paging towards the UE considering the parameters
provided by the AMF.
4\. When the UE receives RAN paging, it initiates the UE triggered Connection
Resume procedure and NG-RAN notifies CN as specified in clause 4.8.2.2
including the N2 Notification in step 3b.
5\. The UPF triggers downlink data delivery if there is any. The AMF sends
downlink NAS messages if there is any.
#### 4.8.2.3 Connection Resume in CM-IDLE with Suspend procedure
For the UE supporting User Plane CIoT 5GS Optimisation, the Connection Resume
procedure is used by the UE to perform RRC_IDLE with Suspend to RRC_CONNECTED
state transition. Triggers for the UE to initiate this procedure are defined
in clause 5.31.18 of TS 23.501 [2].
Figure 4.8.2.3-1: Connection Resume in CM-IDLE with Suspend
1\. UE to NG-RAN: RRC message (Resume ID).
The UE initiates the transition from CM-IDLE and RRC_IDLE state with Suspend
to CM-CONNECTED and RRC_CONNECTED state, see TS 36.300 [46]. The UE provides
its Resume ID needed by the NG-RAN to access the UE\'s stored Context.
2\. [Conditional] NG-RAN performs UE Context Retrieval.
UE Context Retrieval may be performed when the UE Context associated with the
UE attempting to resume its connection is not locally available at the
accessed NG-RAN. The UE Context Retrieval procedure via NG-RAN is specified in
TS 38.300 [9].
3\. NG-RAN and UE continues the resume procedure and access stratum
configuration synchronization is performed between the UE and the network. UE
enters CM-CONNECTED and RRC_CONNECTED.
4\. NG-RAN to AMF:
a) If the NG-RAN is the same as the NG-RAN when UE is suspended, the NG-RAN
sends N2 Resume Request to AMF including Resume cause and N2 SM information
which indicates the PDU sessions successfully resumed and PDU sessions failed
or partially failed to resume the user plane resource.
b) If the NG-RAN is different from the NG-RAN when UE is suspended and the new
NG-RAN is able to retrieve the UE Context from the old NG-RAN, the new NG-RAN
node initiates N2 Path Switch Request towards AMF, i.e. Steps 1b of clause
4.9.1.2.2.
5\. AMF to SMF: For each of the PDU Sessions indicated in step 4, the AMF
invokes Nsmf_PDUSession_UpdateSMContext Request (PDU Session ID, Cause,
Operation type, User Location Information, Age of Location Information, N2 SM
Information). The Operation Type is set to \"UP Resume\" to indicate resume of
user plane resources for the PDU Session.
For PDU Session(s) to be switched to the new NG-RAN, upon receipt of the
Nsmf_PDUSession_UpdateSMContext request, the SMF determines whether the
existing UPF can continue to serve the UE. If the existing UPF cannot continue
to serve the UE, steps 3 to 7 of clause 4.9.1.2.3 or clause 4.9.1.2.4 are
performed depending on whether the existing UPF is a PDU Session Anchor and
flow continues in step 7. Otherwise, step 6 is performed if the existing UPF
can continue to serve the PDU Session.
If the RRC connection is resumed and the UE is accessing via the NB-IoT RAT
with the RRC resume cause set to \"MO exception data\" the AMF updates all
(H-)SMFs. If AMF indicates \"MO exception data\" then it includes the MO
Exception Data Counter. The AMF maintains the MO Exception Data Counter for
Small Data Rate Control purposes as described in clause 5.31.14.3 of TS 23.501
[2]. Each (H-)SMF should be updated for every RRC Connection which is
triggered for \"MO exception data\".
In the home-routed roaming case, if Small Data Rate Control applies, the V-SMF
waits for H-SMF response before proceeding with the N3 establishment.
6\. SMF to UPF: N4 Session Modification Request (AN Tunnel Info to be resumed,
Buffering on/off).
The SMF initiates an N4 Session Modification procedure indicating the resume
of AN tunnel. Buffering on/off indicates whether the UPF shall buffer incoming
DL PDU or not.
If step 4a) is performed, the AN tunnel info is the one maintained by the SMF
during Connection Suspend procedure, step 3 of clause 4.8.1.2. If step 4b) is
performed, the AN tunnel info is part of the N2 SM information received by SMF
in step 5.
The UPF sends N4 Session Modification Response to acknowledge the SMF request.
7\. SMF to AMF: The SMF sends Nsmf_PDUSession_UpdateSMContext response to the
AMF.
If new CN tunnel information is allocated for the PDU session, i.e. in the
case of new AN tunnel is received in step 6, the SMF includes the new CN
tunnel information as part of the N2 SM information.
If the resume for PDU session is unsuccessful, the SMF shall include the
resume failure as part of the N2 SM information.
8\. AMF to NG-RAN: After response for each PDU session in step 7, the AMF
sends N2 Resume Response to NG-RAN and indicates success, including N2 SM
information for PDU session received in step 7, if at least one PDU session is
resumed successfully. If none of the PDU sessions is resumed successfully, AMF
indicates failure to NG-RAN.
The AMF sends N2 Path Switch Acknowledge with PDU session resume information,
if Path Switch Request is received in step 4.
The AMF may provide Extended Connected Time value to the NG-RAN. If the NG-RAN
receives the Extended Connected Time value, the NG-RAN may take this
information into account when determining user inactivity.
9\. [Conditional] NG-RAN to UE: RRC message.
The NG-RAN may reconfigure the RRC connection based on resume result received
from AMF.
10\. If the AMF has paged the UE to trigger the Connection Resume procedure,
the AMF shall initiate the UE configuration update procedure as defined in
clause 4.2.4.2 to assign a new 5G-GUTI.
#### 4.8.2.4 Connection Resume in CM-IDLE with Suspend and MO EDT procedure
The Connection Resume with Early Data Transmission procedure is used by the UE
to optimise sending user data in a single uplink packet and single uplink
followed by single downlink packet cases for a UE in CM-IDLE with Suspend.
Figure 4.8.2.4-1: Connection Resume in RRC_IDLE with Suspend with EDT
1\. UE to NG-eNB: RRC message (Resume ID, AS RAI) with UL EDT.
The UE initiates the transition from RRC_IDLE with Suspend state to
RRC_CONNECTED state, see TS 36.300 [46].
The UE may include AS Release Assistance information indicating:
\- No further Uplink and Downlink Data transmission, or
\- Only a single Downlink Data transmission subsequent to the Uplink
transmission.
2\. The NG-eNB deciphers the EDT UL data received from the UE and forwards it
to the UPF using the N3 UL TEID in the AS context.
3\. The NG-eNB sends N2 Resume Request to AMF including Resume cause and N2
SM.
If the UE included AS Release Assistance information indicating No further
Uplink and Downlink Data transmission in step 1, NG-eNB may request for
immediate transition to RRC_IDLE with Suspend.
If the NG-eNB requests for immediate transition to RRC_IDLE with Suspend, the
NG-eNB should include Paging Assistance Data for CE capable UE in the N2
Resume Request message. If the NG-eNB supports WUS and requests for immediate
transition to RRC_IDLE with Suspend, the NG-eNB should include Information on
Recommended Cells and RAN Nodes for Paging in the N2 Resume Request message.
The AMF stores this information in the UE context for subsequent Paging
procedure.
4\. [Conditional] The AMF interacts with SMF to establish the N3 tunnel,
except for the case:
\- The AMF receives a request for immediate transition to RRC_IDLE with
Suspend in step 3; and
\- the AMF is not aware of any downlink data or signalling pending.
5\. The AMF sends an N2 Resume Response to NG-eNB.
If the AMF received a request for immediate transition to RRC_IDLE with
Suspend in step 3 and there is no downlink data or signalling pending, the AMF
includes a Suspend indication, keeps the UE in CM-IDLE with Suspend and
restarts the Periodic Registration Timer unless the Strictly Periodic
Registration Timer Indication has been provided to the UE during the previous
registration procedure.
Otherwise the AMF sends an N2 Resume Response to NG-eNB after the N3
Connectivity has been established and moves the UE to CM-CONNECTED. If the AMF
knows of mobile terminating data or signalling pending, the AMF may include
the Extended Connected Time value to the RAN
6\. [Conditional] RRC procedure:
6a. If the AMF included the Suspend indication, the NG-eNB releases the RRC
Connection with Suspend. The procedure is complete and following steps are
skipped.
6b. If the AMF did not include the Suspend indication and:
\- The UE did not include AS Release Assistance Indication; or
\- The AMF included the Extended Connected Time value.
the NG-eNB sends an RRC Resume message to the UE and the UE moves to CM-
CONNECTED and RRC_CONNECTED. The procedure is complete and the following steps
are skipped.
6c. Otherwise, if the AMF did not include Extended Connected Time value and
the UE included AS Release Assistance information with only a single Downlink
Data transmission subsequent to the Uplink transmission, the NG-eNB waits for
the DL data to arrive and proceeds to steps 7-10.
7-9. The NG-eNB releases the N3 connectivity by sending an N2 Suspend Request
to AMF including Suspend cause and N2 SM. Steps 2-4 of Connection Suspend
procedure in clause 4.8.1.2 is executed.
10\. [Conditional] NG-eNB to UE: RRC message (with DL data).
The NG-eNB ciphers received DL data.
The NG-eNB releases the RRC Connection with Suspend including the DL EDT data.
### 4.8.3 N2 Notification procedure
This procedure is used by an AMF to request the NG-RAN to report RRC state
information, when the target UE is in CM-CONNECTED state. When AMF has
requested reporting of subsequent state changes, the need for the NG-RAN to
continue reporting ceases when the UE transitions to CM-IDLE or the AMF sends
a cancel indication. This procedure may be used for services that require RRC
state information (e.g. 5GC MT control and paging assistance, O&M and
collection of statistics), or for subscription to the service by other NFs.
See TS 38.413 [10] for details of the procedure.
Reporting of RRC state transitions can be requested per UE by AMF. Continuous
reporting of all RRC state transitions can be enabled by operator local
configuration.
Figure 4.8.3-1: RRC state transition notification
1\. The AMF sends a UE State Transition Notification Request to the NG-RAN as
described in TS 38.413 [10]. The UE State Transition Notification Request
message shall identify the UE for which notification(s) are requested and may
contain a reporting type. The reporting type either indicates subsequent state
transitions shall be notified at every RRC state transition (i.e. from
RRC_CONNECTED state to RRC_INACTIVE state, or from RRC_INACTIVE to
RRC_CONNECTED state), or it indicates Single RRC_CONNECTED state notification.
2\. The NG-RAN sends the UE Notification message to report the current RRC
state for the UE (i.e. RRC_INACTIVE state or RRC_CONNECTED state). The current
UE location information (i.e. TAI + Cell Identity) is always included when RRC
state information is reported.
2b. When the AMF has requested reporting about subsequent state transitions,
the NG-RAN sends subsequent UE Notification messages to the AMF at every RRC
state transition until the UE transitions to CM-IDLE or NG-RAN receives a
Cancel UE State Notification message from the AMF.
When the AMF has requested reporting for Single RRC_CONNECTED state
notification and UE is in RRC_CONNECTED state, the NG-RAN sends one UE
Notification message but no subsequent messages. If UE is in RRC_INACTIVE
state, the NG-RAN sends one UE Notification message plus one subsequent UE
Notification message when RRC state transits to RRC_CONNECTED.
3\. The AMF can send a Cancel UE State Notification message to inform the NG-
RAN that it should terminate notifications for a given UE. This message should
only be used when notification(s) about subsequent state transitions was
requested at every RRC state transition.
## 4.9 Handover procedures
### 4.9.1 Handover procedures in 3GPP access
#### 4.9.1.1 General
These procedures are used to hand over a UE from a source NG-RAN node to a
target NG-RAN node using the Xn or N2 reference points. This can be triggered,
for example, due to new radio conditions, load balancing or due to specific
service e.g. in the presence of QoS Flow for voice, the source NG-RAN node
being NR may trigger handover to E-UTRA connected to 5GC.
As defined in TS 38.413 [10] a generic mechanism exists for the source NG-RAN
node to retrieve information on the level of support for a certain feature at
the target NG-RAN side associated with an NGAP IE. The mechanism makes use of
the Source to Target and Target to Source transparent containers.
The Inter NG-RAN node N2 based handover procedure specified in clause 4.9.1.3
may also be used for intra-NG-RAN node handover.
NOTE: One use case for intra-NG-RAN handover to be performed by the Inter NG-
RAN node N2 based handover procedure is when an NG-RAN node serves a satellite
access system that covers more than one country. In such a situation, the UE
might move from a \"cell\" in one country into a \"cell\" in another country
and the NG-RAN node may need to cause the AMF to change to an AMF serving the
UE\'s new country.
The RRC Inactive Assistance Information is included in N2 Path Switch Request
Ack message for Xn based handover or Handover Request message for N2 based
handover (see clause 5.3.3.2.5 of TS 23.501 [2]).
#### 4.9.1.2 Xn based inter NG-RAN handover
##### 4.9.1.2.1 General
Clause 4.9.1.2 includes details regarding the Xn based inter NG-RAN handover
with and without UPF re-allocation.
Xn handovers are only supported for intra-AMF mobility. New AMF can be
selected by the target NG-RAN node as specified in clause 5.21.2 of TS 23.501
[2].
The handover preparation and execution phases are performed as specified in TS
38.300 [9], in the case of handover to a shared network, source NG-RAN
determines a PLMN or an SNPN to be used in the target network as specified by
TS 23.501 [2]. If the serving PLMN or SNPN changes during Xn-based handover,
the source NG-RAN node shall indicate to the target NG-RAN node (in the
Mobility Restriction List) the selected PLMN ID or SNPN ID to be used in the
target network. During Xn based handover into a shared NG-RAN node the source
NG RAN node shall include the serving NID (if available) in the Mobility
Restriction List to be used by the target NG-RAN node.
If the AMF generates the N2 downlink signalling during the ongoing handover
and receives a rejection to a N2 interface procedure (e.g. Location Reporting
Control; DL NAS message transfer; etc.) from the NG-RAN with an indication
that a Xn based handover procedure is in progress, the AMF may reattempt the
same N2 interface procedure either when the handover is complete or the
handover is deemed to have failed, when possible. The failure is known by
expiry of the timer guarding the N2 interface procedure.
Upon reception for an SMF initiated N1 and/or N2 request(s) with an indication
that the request has been temporarily rejected due to handover procedure in
progress, the SMF starts a locally configured guard timer. Any NF (e.g. the
SMF) should hold any signalling messages targeted towards AMF for a given UE
during the handover preparation phase unless it detects that the handover
execution is completed or handover has failed/cancelled. The NF (e.g. the SMF)
may re-attempt, up to a pre-configured number of times, when either it detects
that the handover is completed or has failed using message reception or at
expiry of the guard timer.
##### 4.9.1.2.2 Xn based inter NG-RAN handover without User Plane function re-
allocation
This procedure is used to hand over a UE from a source NG-RAN to Target NG-RAN
using Xn when the AMF is unchanged and the SMF decides to keep the existing
UPF. The UPF referred in this clause 4.9.1.2.2 is the UPF which terminates N3
interface in the 5GC for non-roaming or local breakout roaming scenario, V-UPF
which terminates N3 interface in 5GC for home routed roaming scenario. The SMF
referred in this clause 4.9.1.2.2 is the V-SMF for home routed roaming
scenario. The presence of IP connectivity between the Source UPF and Target
NG-RAN is assumed.
The call flow is shown in figure 4.9.1.2.2-1.
Figure 4.9.1.2.2-1: Xn based inter NG-RAN handover without UPF re-allocation
1a. If the PLMN has configured secondary RAT usage reporting, the source NG-
RAN node during the handover execution phase may provide RAN usage data Report
(N2 SM Information (Secondary RAT usage data), Handover Flag, Source to Target
transparent container) to the AMF. The source NG-RAN node shall provide this
only when the Target NG-RAN has confirmed handover over Xn interface. The
Handover Flag indicates to the AMF that it should buffer the N2 SM Information
containing the usage data report before forwarding it.
If the source NG RAN and Target NG RAN support RACS as defined in TS 23.501
[2], the source NG-RAN provides the UE\'s UE Radio Capability ID to the Target
NG-RAN. If the source NG-RAN has knowledge that the Target NG-RAN might not
have a local copy of the Radio Capability corresponding to the UE Radio
Capability ID (i.e. because the source NG-RAN had itself to retrieve the UE\'s
Radio Capability from the AMF) then the source NG-RAN may also send some or
all of the UE\'s Radio Capability to the Target NG-RAN (the size limit based
on local configuration) in Xn signalling as defined in TS 38.423 [72] . In the
case of inter-PLMN handover, when the source and Target NG-RAN support RACS as
defined in TS 23.501 [2] and the source NG-RAN determines based on local
configuration that the Target PLMN does not support the UE Radio Capability ID
assigned by the source PLMN, then the source NG-RAN shall provide the UE radio
access capabilities to the Target NG-RAN and shall not send the UE Radio
Capability ID. If, as permitted in TS 38.423 [72], the Target NG-RAN during
the handover preparation received the UE radio access capabilities but did not
receive the UE Radio Capability ID, NG-RAN shall proceed with handover using
the received UE radio access capabilities. If the Target NG-RAN received both
the UE radio access capabilities and the UE Radio Capability ID, then the
Target NG-RAN shall use any locally stored UE radio access capability
information corresponding to the UE Radio Capability ID. If none are stored
locally, the Target NG-RAN may request the full UE radio access capability
information from the core network. If the full UE radio access capability
information is not promptly received from the core network, or the Target NG-
RAN chooses not to request them, then the Target NG-RAN shall proceed with the
UE radio access capabilities sent by the source NG-RAN. The Target NG-RAN
shall not use the UE radio access capability information received from the
source NG-RAN for any other UE with the same the UE Radio Capability ID.
1b. Target NG-RAN to AMF: N2 Path Switch Request (List of PDU Sessions To Be
Switched with N2 SM Information, List of PDU Sessions that failed to be
established with the failure cause given in the N2 SM information element, UE
Location Information, established QoS Flows status (active/not active) for QoS
monitoring configuration for congestion information, established QoS Flows
status (active/not active) for ECN marking for L4S, PDU Set Based Handling
Support Indication included in the N2 SM information).
The Target NG-RAN sends an N2 Path Switch Request message to an AMF to inform
that the UE has moved to a new Target cell and provides a List Of PDU Sessions
To Be Switched. AN Tunnel Info for each PDU Session to be switched is included
in the N2 SM Information.
If redundant transmission is performed for one or more QoS Flows in the PDU
Session, two AN Tunnel Info are provided by the Target NG-RAN and the Target
NG-RAN indicates to the SMF one of the AN Tunnel Info is used as the
redundancy tunnel of the PDU Session as described in clause 5.33.2.2 of TS
23.501 [2]. If only one AN Tunnel Info is provided by the Target NG-RAN for
the PDU session, the SMF may release these QoS Flows by triggering PDU Session
Modification procedure as specified in clause 4.3.3 after the handover
procedure.
The serving PLMN ID is included in the message. The Target NG-RAN shall
include the PDU Session in the PDU Sessions Rejected list:
\- If none of the QoS Flows of a PDU Session are accepted by the Target NG-
RAN; or
\- If the corresponding network slice is not supported in the Target NG-RAN;
or
\- When the NG-RAN cannot set up user plane resources fulfilling the User
Plane Security Enforcement with a value Required, the NG-RAN rejects the
establishment of user plane resources for the PDU Session.
If the NG-RAN cannot set up user plane resources fulfilling the User Plane
Security Enforcement with a value Preferred, the NG-RAN establishes the user
plane resources for the PDU session and shall include the PDU Session in the
PDU Sessions Modified list.
PDU Sessions Rejected contains an indication of whether the PDU session was
rejected because User Plane Security Enforcement is not supported in the
Target NG-RAN. Depending on the type of target cell, the Target NG-RAN
includes appropriate information in this message.
For the PDU Sessions to be switched to the Target NG-RAN, the N2 Path Switch
Request message shall include the list of accepted QoS Flows. For each QoS
Flow accepted with an Alternative QoS Profile as specified in TS 23.501 [2],
the N2 SM Information shall include a reference to the fulfilled Alternative
QoS Profile.
2\. AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (N2 SM information
received from T-RAN in step 1b and N2 SM Information from source NG-RAN
(Secondary RAT usage data), UE Location Information, UE presence in LADN
service area, PDU Set Based Handling Support Indication). The N2 SM
Information here from source NG-RAN is the one buffered at step 1a when
applicable.
The AMF sends N2 SM information by invoking the
Nsmf_PDUSession_UpdateSMContext request service operation for each PDU Session
in the lists of PDU Sessions received in the N2 Path Switch Request.
The Nsmf_PDUSession_UpdateSMContext Request contains either an indication that
the PDU Session Is To Be Switched (together with information on the N3
addressing to use and on the transferred QoS flows) or an indication that the
PDU Session is to be Rejected (together with a rejection cause).
If the AMF, based on configuration, as described in clause 5.43.4 of TS 23.501
[2], is aware that satellite backhaul category has changed due to the handover
and needs to be updated to the SMF, the AMF includes the new satellite
backhaul category and indicates the satellite backhaul category change as
described in clause 5.43.4 of TS 23.501 [2].
If the AMF, based on configuration, as described in clause 5.43.2 of TS 23.501
[2], is aware that the UE is accessing over a gNB using GEO satellite backhaul
and GEO Satellite ID needs to be updated to the SMF, the AMF may include the
latest GEO Satellite ID as described in clause 5.43.2 of TS 23.501 [2].
For a PDU Sessions to be switched to the Target NG-RAN, upon receipt of the
Nsmf_PDUSession_UpdateSMContext request, the SMF determines whether the
existing UPF can continue to serve the UE. If the existing UPF cannot continue
to serve the UE, steps 3-11 of clause 4.9.1.2.3 or 4.9.1.2.4 are performed
depending on whether the existing UPF is a PDU Session Anchor. Otherwise, the
following steps 3 to 6 are performed if the existing UPFs can continue to
serve the PDU Session.
In the case that the AMF determines that the PDU Session is related to a LADN,
then the AMF provides the \"UE presence in LADN service area\" to the SMF. If
the AMF does not provide the \"UE presence in LADN service area\" indication
and the SMF determines that the DNN corresponds to a LADN, then the SMF
considers that the UE is OUT of the LADN service area. The SMF takes actions
for the LADN PDU Session as defined in clause 5.6.5 of TS 23.501 [2] based on
the \"UE presence in LADN service area\" indication.
If a PDU Session is rejected by the Target NG-RAN with an indication that the
PDU session was rejected because User Plane Security Enforcement is not
supported in the Target NG-RAN and the User Plane Enforcement Policy indicates
\"Required\" as described in clause 5.10.3 of TS 23.501 [2], the SMF triggers
the release of this PDU Session. In all other cases of PDU Session rejection,
the SMF can decide whether to release the PDU Session or to deactivate the UP
connection of this PDU Session.
If some of the QoS Flows of a PDU Session are not accepted by the Target NG-
RAN, the SMF shall initiate the PDU Session Modification procedure to remove
the non-accepted QoS Flows from the PDU Session(s) after the handover
procedure is completed.
For the PDU Session(s) that do not have active N3 UP connections before
handover procedure, the SMF(s) keep the inactive status after handover
procedure.
If the UE moves into a non-Allowed Area, the AMF also notifies via
Namf_EventExposure_Notify to each NF Consumer (e.g. SMFs of the established
PDU Sessions) which has subscribed for UE reachability event, that the UE is
only reachable for regulatory prioritized services. The SMF then deactivates
the PDU session if this PDU Session is not for emergency service.
3\. SMF to UPF: N4 Session Modification Request (AN Tunnel Info)
For PDU Sessions that are modified by the Target NG-RAN, the SMF sends an N4
Session Modification Request message to the UPF. The SMF may notify the UPF
that originated the Data Notification to discard downlink data for the PDU
Sessions and/or to not provide further Data Notification messages.
Depending on the network deployment, the CN Tunnel Info of UPF used for
connection to Target NG-RAN and connection to Source NG-RAN may be different,
e.g. due to Source and Target NG-RAN are in different IP domains. In this case
the SMF may ask the UPF to allocate new CN Tunnel Info, providing the target
Network Instance.
4\. UPF to SMF: N4 Session Modification Response (CN Tunnel Info)
For the PDU Sessions that are switched, the UPF returns an N4 Session
Modification Response message to the SMF after requested PDU Sessions are
switched. Tunnel identifiers for UL traffic are included only for PDU Sessions
whose user plane resources are not being released and was requested by the
SMF. If redundant transmission is performed for one or more QoS Flows of a PDU
Session and different CN Tunnel Info were requested by the SMF, the UPF
allocates two different CN Tunnel Info and indicates the SMF that one CN
Tunnel Info is used as the redundancy tunnel of the PDU session as described
in clause 5.33.2.2 of TS 23.501 [2]. For the PDU Sessions that are
deactivated, the UPF returns an N4 Session Modification Response message to
the SMF after the N3 (R)AN tunnel information is released.
5\. In order to assist the reordering function in the Target NG-RAN, the UPF
(as specified in clause 5.8.2.9 of TS 23.501 [2]) sends one or more \"end
marker\" packets for each N3 tunnel on the old path immediately after
switching the path. The UPF starts sending downlink packets to the Target NG-
RAN.
6\. SMF to AMF: Nsmf_PDUSession_UpdateSMContext Response (N2 SM information)
The SMF sends an Nsmf_PDUSession_UpdateSMContext response (N2 SM Information
(CN Tunnel Info, updated CN PDB for the accepted QoS Flows, Updated TSCAIs for
the accepted QoS Flows)) to the AMF for PDU Sessions which have been switched
successfully. The CN Tunnel Info of UPF send to AMF is used to setup N3
tunnel. If redundant transmission is performed for one or more QoS Flows of a
PDU Session, two CN Tunnel Info are sent and the SMF indicates to the Target
NG-RAN one of the CN Tunnel Info is used as the redundancy tunnel of the PDU
Session as described in clause 5.33.2.2 of TS 23.501 [2]. The SMF sends an
Nsmf_PDUSession_UpdateSMContext response without including the CN Tunnel Info
to the AMF for the PDU Sessions for which user plane resources are deactivated
or released and then the SMF releases the PDU Session(s) which is to be
released using a separate procedure as defined in clause 4.3.4. For each
accepted GBR QoS Flow of Delay-critical resource type, the dynamic CN PDB and
TSCAI may be updated and sent to the Target NG-RAN by the SMF. The SMF may
update the CN PDB and TSCAI in the response or using a separate PDU Session
Modification procedure, based on local configuration.
If the Source NG-RAN does not support Alternative QoS Profiles (see TS 23.501
[2]) and the Target NG-RAN supports them, the SMF sends the Alternative QoS
Profiles (see TS 23.501 [2]) to the Target NG-RAN on a per QoS Flow basis, if
available.
NOTE: Step 6 can occur any time after receipt of N4 Session Modification
Response at the SMF.
7\. AMF to NG-RAN: N2 Path Switch Request Ack (N2 SM Information, Failed PDU
Sessions, UE Radio Capability ID).
Once the Nsmf_PDUSession_UpdateSMContext response is received from all the
SMFs, the AMF aggregates received CN Tunnel Info and sends this aggregated
information as a part of N2 SM Information along with the Failed PDU Sessions
in N2 Path Switch Request Ack to the Target NG-RAN. If none of the requested
PDU Sessions have been switched successfully, the AMF shall send an N2 Path
Switch Request Failure message to the Target NG-RAN.
If the UE Radio Capability ID is included in the N2 Path Switch Request Ack
message, when there is no corresponding UE radio capabilities set for UE Radio
Capability ID at the Target NR-RAN, the Target NG-RAN shall request the AMF to
provide the UE radio capabilities set corresponding to UE Radio Capability ID
to the Target NG-RAN.
8\. By sending a Release Resources message to the Source NG-RAN, the Target
NG-RAN confirms success of the handover. It then triggers the release of
resources with the Source NG-RAN.
9\. [Conditional] The UE may initiate Mobility Registration Update procedure
if one of the triggers of registration procedure applies as described in
clause 4.2.2.2.2. In this case, only steps 1, 2, 3, 17 and 21 in clause
4.2.2.2.2 are performed.
For the mobility related events as described in clause 4.15.4, the AMF invokes
the Namf_EventExposure_Notify service operation.
Upon reception of the Namf_EventExposure_Notify with an indication that UE is
reachable only for regulatory prioritized service, the SMF deactivates the PDU
Session if the service of the PDU Session is not regulatory prioritized. For
home routed roaming case, the V-SMF triggers the deactivation of the PDU
Session, in addition, the H-SMF refrains from sending downlink signalling if
the signalling is not related to regulatory prioritized service upon receiving
the notification.
##### 4.9.1.2.3 Xn based inter NG-RAN handover with insertion of intermediate
UPF
This procedure is used to hand over a UE from a Source NG-RAN to a Target NG-
RAN using Xn when the AMF is unchanged and the SMF decides that insertion of a
new additional intermediate UPF is needed. If redundant transmission is
performed for one or more QoS Flows of a PDU Session to be switched to the
Target NG-RAN, the SMF may select two Intermediate UPFs (I-UPFs) and set up
two N3 and N9 tunnels between the Target NG-RAN and the UPF (PSA) via the two
I-UPFs as described in clause 5.33.2.2 of TS 23.501 [2].
In the case of using UL CL, the I-UPF can be regarded as UL CL and additional
PSA providing local access to a DN. In the case of using Branching Point, the
I-UPF can be regarded as BP.
It is assumed that the PDU Session for the UE comprises of only one UPF that
acts as a PDU Session Anchor at the time of this Handover procedure for non-
roaming and local breakout roaming scenario. In the case of home routed
roaming scenario, the PDU Session of the UE comprises of at least one UPF in
the VPLMN and one UPF in the HPLMN at the time of this handover procedure. In
this case, additional insertion of an N3 terminating intermediate UPF will not
have impact on the connectivity between the UPF in VPLMN and UPF in HPLMN. The
presence of IP connectivity between the UPF (PDU Session Anchor) and Source
NG-RAN, between the UPF (PDU Session Anchor) and Target NG-RAN and between the
intermediate UPF (I-UPF) and Target NG-RAN, is assumed. (If there is no IP
connectivity between UPF (PDU Session Anchor) and Target NG-RAN, it is assumed
that the N2-based handover procedure in clause 4.9.1.3 shall be used instead).
The call flow is shown in figure 4.9.1.2.3-1.
Figure 4.9.1.2.3-1: Xn based inter NG-RAN handover with insertion of
intermediate UPF
Steps 1-2 are the same as described in clause 4.9.1.2.2.
3a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
If the SMF selects a new UPF to act as intermediate UPF for the PDU Session
and the different CN Tunnel Info need be used, the SMF sends N4 Session
Modification Request message to UPF (PSA).
3b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response.
The UPF (PSA) sends an N4 Session Establishment Response message to the SMF.
The UPF provides CN Tunnel Info (on N9) to the SMF. If redundant transmission
is performed for one or more QoS Flows of the PDU Session, the UPF (PSA)
provides two CN Tunnel Info (on N9) to the SMF and indicates the SMF that one
CN Tunnel Info is used as redundancy tunnel of the PDU Session as described in
in clause 5.33.2.2 of TS 23.501 [2]. The UPF (PSA) associate the CN Tunnel
Info (on N9) with UL Packet detection rules provided by the SMF.
4a. SMF to I-UPF: N4 Session Establishment Request (Target NG-RAN Tunnel Info,
CN Tunnel Info of the PDU Session Anchor)
For PDU Sessions to be updated, if the UE has moved out of the service area of
UPF connecting to the serving NG-RAN node, the SMF then selects an I-UPF based
on UPF Selection Criteria according to clause 6.3.3 of TS 23.501 [2]. An N4
Session Establishment Request message is sent to the I-UPF. The CN Tunnel Info
of the PDU Session Anchor, which is used to setup N9 tunnel, is included in
the N4 Session Establishment Request message.
4b. I-UPF to SMF: N4 Session Establishment Response.
The I-UPF sends an N4 Session Establishment Response message to the SMF. The
UL and DL CN Tunnel Info of I-UPF is sent to the SMF.
If SMF select two Intermediate UPFs (I-UPFs) to perform redundant transmission
for a PDU session, step 4a and 4b are performed between the SMF and each
I-UPF.
5\. SMF to PDU Session Anchor: N4 Session Modification Request (DL CN Tunnel
Info of the I-UPF).
The SMF sends N4 Session Modification Request message to the PDU Session
Anchor.
If a different CN Tunnel Info is used on N9 in UPF (PSA), the SMF starts a
timer to release the CN Tunnel for N3. Otherwise the SMF does not need to
start a timer to release the CN Tunnel Info used on N3 in UPF(PSA) (i.e. CN
Tunnel Info is common for both N3 and N9).
If redundant transmission is performed for one or more QoS Flows of the PDU
Session, the SMF provides two DL CN Tunnel Info (for N9) to the UPF (PSA) and
indicates to the UPF (PSA) one of the DL CN Tunnel Info is used as redundancy
tunnel of the PDU Session.
6\. PDU Session Anchor to SMF: N4 Session Modification Response.
The PDU Session Anchor responds with the N4 Session Modification Response
message after requested PDU Sessions are switched. At this point, PDU Session
Anchor starts sending downlink packets to the Target NG-RAN via I-UPF.
7\. In order to assist the reordering function in the Target NG-RAN, the PDU
Session Anchor sends one or more \"end marker\" packets for each N3 tunnel on
the old path immediately after switching the path, the source NG-RAN shall
forward the \"end marker\" packets to the Target NG-RAN.
8\. SMF to AMF: Nsmf_PDUSession_UpdateSMContext Response (N2 SM Information
(UL CN Tunnel Info of the I-UPF, updated QoS parameters for accepted QoS
Flows)).
The SMF sends an Nsmf_PDUSession_UpdateSMContext response to the AMF.
Steps 8-11 are same as steps 6-9 defined in clause 4.9.1.2.2.
12\. After the timer set in step 5 expires, the SMF informs the PDU Session
Anchor to remove the CN Tunnel for N3 via N4 Session Modification procedure.
##### 4.9.1.2.4 Xn based inter NG-RAN handover with re-allocation of
intermediate UPF
This procedure is used to hand over a UE from a Source NG-RAN to a Target NG-
RAN using Xn when the AMF is unchanged and the SMF decides that the
intermediate UPF (I-UPF) is to be changed. In the case of using UL CL, the
I-UPF can be regarded as UL CL and additional PSA provides local access to a
DN, the simultaneous change of UL-CL and the additional PSA is described in
clause 4.3.5.7. In the case of using Branching Point, the I-UPF can be
regarded as BP.
It is assumed that the PDU Session for the UE comprises of a UPF that acts as
a PDU Session Anchor and an intermediate UPF at the time of this Handover
procedure for non-roaming and local breakout roaming scenario. In the case of
home routed roaming scenario, the PDU Session of the UE comprises of at least
one UPF in the VPLMN and UPF in the HPLMN which acts as a PDU Session Anchor
at the time of this handover procedure. The Source UPF referred in this clause
4.9.1.2.4 is the UPF which terminates N3 interface in the 5GC. The presence of
IP connectivity between the Source UPF and Source NG-RAN, between the source
UPF and Target NG-RAN and between the Target UPF and Target NG-RAN, is
assumed. (If there is no IP connectivity between source UPF and Target NG-RAN,
it is assumed that the N2-based handover procedure in clause 4.9.1.3 shall be
used instead).
The call flow is shown in figure 4.9.1.2.4-1.
Figure 4.9.1.2.4-1: Xn based inter NG-RAN handover with intermediate UPF re-
allocation
Steps 1-4 are same as steps 1-4 described in clause 4.9.1.2.3 except that the
I-UPF in clause 4.9.1.2.3 is replaced by Target UPF.
5\. [Conditional] The SMF sends N4 Session Modification Request message to the
PDU Session Anchor. The DL CN Tunnel Info of the Target UPF is included in
this message. If redundant transmission is performed for one or more QoS Flows
of the PDU Session, the SMF provides two DL CN Tunnel Info (for N9) to the UPF
(PSA) and indicates to the UPF (PSA) one of the DL CN Tunnel Info is used as
redundancy tunnel of the PDU Session.
In the case of home routed roaming, if the N9 terminating V-UPF, which is
connected to with home UPF, is changed, the V-SMF invokes an
Nsmf_PDUSession_Update Request (DL CN Tunnel Info) service operation toward
the H-SMF.
6\. [Conditional] The SMF associated with the PDU Session Anchor responds with
the N4 Session Modification Response message. In the case of home routed
roaming, the H-SMF responds with the Nsmf_PDUSession_Update Response service
operation toward the V-SMF once H-UPF is updated with the DL Tunnel Info of
the T-UPF. At this point, PDU Session Anchor starts sending downlink packets
to the Target NG-RAN via Target UPF.
Steps 7-11 are same as steps 7-11 described in clause 4.9.1.2.3 except that
the I-UPF in clause 4.9.1.2.3 is replaced by Target UPF.
If the Source UPF acts as a UL CL or BP, the SMF indicates to only one of the
PDU Session Anchors to send the \"end marker\" packets. To ensure the \"end
marker\" is the last user plane packet on the old path, the SMF should modify
the path on other PDU Session Anchors before it indicates the PDU Session
Anchor to send the \"end marker\" packets.
11\. The timer is started in step 4 if the source UPF is not the PSA UPF. When
this timer is expired, the SMF initiates Source UPF(s) Release procedure by
sending an N4 Session Release Request (Release Cause).
12\. The Source UPF(s) acknowledges with an N4 Session Release Response
message to confirm the release of resources.
#### 4.9.1.3 Inter NG-RAN node N2 based handover
##### 4.9.1.3.1 General
Clause 4.9.1.3 includes details regarding the inter NG-RAN node N2 based
handover without Xn interface.
The source NG-RAN decides to initiate an N2-based handover to the target NG-
RAN. This can be triggered, for example, due to new radio conditions or load
balancing, if there is no Xn connectivity to the target NG-RAN, an error
indication from the target NG-RAN after an unsuccessful Xn-based handover
(i.e. no IP connectivity between T-RAN and S-UPF), or based on dynamic
information learnt by the S-RAN. NTN NR supports additional trigger conditions
i.e. time-based trigger condition, upon which UE may execute conditional
handover to a candidate cell, as defined in TS 38.331 [12].
The availability of a direct forwarding path is determined in the source NG-
RAN and indicated to the SMFs. If IP connectivity is available between the
source and target NG-RAN and security association(s) is in place between them,
a direct forwarding path is available.
If a direct forwarding path is not available, indirect forwarding may be used.
The SMFs use the indication from the source NG-RAN to determine whether to
apply indirect forwarding.
If both source NG-RAN and source AMF support DAPS the source NG-RAN may decide
that some of the DRBs are subject for DAPS handover as defined in TS 38.300
[9]; in this case, the source NG-RAN provides the DAPS information indicating
the request concerns a DAPS handover for the DRB as part of the Source to
Target (NG-RAN) Transparent Container. If the target NG-RAN accepts that the
request concerns DAPS handover and both Target NG-RAN and Target AMF support
DAPS, the DAPS handover will be performed and target NG-RAN provides DAPS
response information as part of the Target to Source (NG-RAN) Transparent
Container.
In the case of handover to a shared network, the source NG-RAN determines a
PLMN (or PLMN ID and NID, see clause 5.30 of TS 23.501 [2]) to be used in the
target network as specified by TS 23.501 [2]. The source NG-RAN shall indicate
the selected PLMN ID to be used in the target network to the AMF as part of
the Tracking Area sent, or the selected SNPN ID to be used in the target
network to the AMF, in the HO Required message.
If the AMF generates the N2 downlink signalling during the ongoing handover
and receives a rejection to a N2 interface procedure (e.g. DL NAS message
transfer; Location reporting control; etc.) from the NG-RAN with an indication
that an Inter NG-RAN node handover procedure is in progress, the AMF may
reattempt the same N2 interface procedure either when the handover is complete
or the handover is deemed to have failed if the AMF is still the serving AMF,
when possible. If the Inter NG-RAN node handover changes the serving AMF, the
source AMF shall terminate any other ongoing N2 interface procedures except
the handover procedure.
In order to minimize the number of procedures rejected by NG-RAN, the AMF
should pause non-handover related N2 interface procedures (e.g. DL NAS message
transfer, Location Report Control, etc.) while a handover is ongoing (i.e.
from the time that a Handover Required has been received until either the
Handover procedure has succeeded (Handover Notify) or failed (Handover
Failure)) and continue them once the Handover procedure has completed if the
AMF is still the serving AMF.
If during the handover procedure the AMF detects that the AMF needs be
changed, the AMF shall reject any SMF initiated N2 request received since
handover procedure started and shall include an indication that the request
has been temporarily rejected due to handover procedure in progress.
Upon reception for an SMF initiated N1 and/or N2 request(s) with an indication
either from the NG-RAN (via N2 SM Info) or AMF that the request has been
temporarily rejected due to handover procedure in progress, the SMF starts a
locally configured guard timer. The SMF should hold any signalling messages
targeted towards AMF for a given UE during the handover preparation phase
unless it detects that the handover execution is completed or handover has
failed/cancelled. The SMF may re-attempt, up to a pre-configured number of
times, when either it detects that the handover is completed or has failed
using message reception or at expiry of the guard timer.
In the case of N2 handover within the VPLMN in a home routed roaming scenario,
the SMF in the Inter NG-RAN node N2 based handover procedure (Figure
4.9.1.3.2-1 and Figure 4.9.1.3.3-1) interacting with the S-UPF, T-UPF, S-AMF
and T-AMF is the V-SMF and the SMF (Figure 4.9.1.3.3-1) interacting with the
UPF (PSA) is the H-SMF.
In the case of inter-PLMN N2 handover in a home routed roaming scenario, the
procedures in clause 4.23 apply.
##### 4.9.1.3.2 Preparation phase
Figure 4.9.1.3.2-1: Inter NG-RAN node N2 based handover, Preparation phase
1\. S-RAN to S-AMF: Handover Required (Target ID, Source to Target transparent
container, _SM N2 info list,_ PDU Session IDs, intra system handover
indication).
NOTE 1: When applicable the message includes the selected NID, see TS 38.413
[10] for the IE that includes the selected NID. The T-AMF, ensures that the
selected NID is forwarded to SMF.
_Source to Target transparent container_ includes NG-RAN information created
by S-RAN to be used by T-RAN and is transparent to 5GC. It also contains for
each PDU session the corresponding QoS flows/DRBs information subject to data
forwarding. It may also contain DAPS Information if DAPS handover is supported
by S-RAN and S-AMF and DAPS handover is requested for one or more DRBs as
described in TS 38.300 [9]. It may also contain the time-based handover
parameters when time-based trigger condition is used.
All PDU Sessions handled by S-RAN (i.e. all existing PDU Sessions with active
UP connections) shall be included in the Handover Required message, indicating
which of those PDU Session(s) are requested by S-RAN to handover. The SM N2
info includes Direct Forwarding Path Availability if direct data forwarding is
available.
Direct Forwarding Path Availability indicates whether direct forwarding is
available from the S-RAN to the T-RAN. This indication from S-RAN can be based
on e.g. the presence of IP connectivity and security association(s) between
the S-RAN and the T-RAN.
If the source NG RAN and target NG RAN support RACS as defined in TS 23.501
[2], the Source to Target transparent container need not carry the UE radio
access capabilities (instead the UE Radio Capability ID is supplied from the
CN to the T-RAN). However, if the source NG-RAN has knowledge that the target
NG-RAN might not have a local copy of the Radio Capability corresponding to
the UE Radio Capability ID (i.e. because the source NG-RAN had itself to
retrieve the UE\'s Radio Capability from the AMF) then the source NG-RAN may
also send some (or all) of the UE\'s Radio Capability to the target NG-RAN
(the size limit based on local configuration). In the case of inter-PLMN
handover, when the source and target NG-RAN support RACS as defined in TS
23.501 [2] and the source NG-RAN determines based on local configuration that
the target PLMN does not support the UE Radio Capability ID assigned by the
source PLMN, then the source NG-RAN includes the UE radio access capabilities
in the Source to Target transparent container.
2\. T-AMF Selection: _When the S-AMF can\'t serve the UE anymore, the S-AMF
selects_ the _T-AMF_ as described in clause 6.3.5 on \"AMF Selection
Function\" in TS 23.501 [2].
3\. [Conditional] S-AMF to T-AMF: _Namf_Communication_CreateUEContext Request
(N2 Information (_ Target ID, Source to Target transparent container, _SM N2
information list_ , PDU Session IDs _),_ UE context information (SUPI, Service
area restriction, Allowed NSSAI for each Access Type and Partially Allowed
NSSAI if available, Tracing Requirements, LTE M Indication, the list of PDU
Session IDs along with the corresponding SMF information and the corresponding
S-NSSAI(s), PCF ID(s), DNN, UE Radio Capability ID and UE Radio Capability
Information, N2 Notify URI _). If the subscription information includes
Tracing Requirements, the old AMF provides the target AMF with Tracing
Requirements._
If the old AMF was a consumer of UE related NWDAF services, the old AMF
includes information about active analytics subscriptions, i.e. the
Subscription Correlation ID(s), NWDAF identifier(s) (i.e. Instance ID or Set
ID), Analytics ID(s) and associated Analytics specific data in the
Namf_Communication_UEContextTransfer request. Usage of the analytics
information by the new AMF is specified in TS 23.288 [50].
In inter PLMN handover case, UE context information includes HPLMN S-NSSAIs
corresponding to the Allowed NSSAI for each Access Type and Partially Allowed
NSSAI, without Allowed NSSAI and Partially Allowed NSSAI of source PLMN. The
target AMF may determine the Allowed NSSAI and Partially Allowed NSSAI based
on the HPLMN S-NSSAIs received in step 3, or else the target AMF queries the
NSSF by invoking Nnssf_NSSelection_Get service operation with the HPLMN
S-NSSAIs and PLMN ID of SUPI. Based on the query result returned from the
NSSF, the target AMF determines whether the AMF re-allocation need be
triggered and if needed reselects another target AMF. In this case the target
AMF selected by the S-AMF is the Initial AMF. And another reselected target
AMF is the final target AMF (i.e. T-AMF).
The S-AMF initiates Handover resource allocation procedure by invoking the
Namf_Communication_CreateUEContext service operation towards the target AMF.
When the S-AMF can still serve the UE, this step and step 12 are not needed.
If target AMF re-allocation is needed, e.g. due to the inter PLMN handover,
the initial AMF invokes Namf_Communication_CreateUEContext request (SUPI,
Target 5GAN Node ID, Source to Target Transparent Container, 5GS MM Context,
PDU Session ID and its associated S-NSSAI of the VPLMN value for each PDU
Session, the corresponding S-NSSAI of HPLMN value for home routed PDU
Session(s), Allowed NSSAI, N2 Notify URI) to the selected final target AMF.
The N2 Notify URI is the N2 Notify URI of the source AMF, which is used by the
T-AMF to send N2 handover notify to the S-AMF. If the information about active
analytics subscriptions are received from S-AMF, it is also included them in
the Namf_Communication_CreateUEContext request.
If Service area restrictions are available in the S-AMF, they may be forwarded
to the T-AMF as described in clause 5.3.4.1.2 of TS 23.501 [2].
If both Home and Visited PCF ID(s) are provided by the S-AMF, the T-AMF
contacts the (V-) PCF identified by the (V-)PCF ID. If the (V-)PCF identified
by the (V-)PCF ID is not used or there are no PCF ID(s) received from the
S-AMF, the T-AMF may select the PCF(s) as described in clause 6.3.7.1 of TS
23.501 [2] and according to the V-NRF to H-NRF interaction described in clause
4.3.2.2.3.3. The T-AMF informs the S-AMF that the PCF ID is not used, as
defined in step 12 and then the S-AMF terminates the AM Policy Association
with the PCF identified by the PCF ID.
4\. [Conditional] T-AMF to SMF: _Nsmf_PDUSession_UpdateSMContext (_ PDU
Session ID, Target ID, T-AMF ID, N2 SM Information _)._
For each PDU Session indicated by S-RAN, the AMF invokes the
_Nsmf_PDUSession_UpdateSMContext Request_ to the associated SMF. However, if
the S-NSSAI associated with PDU Session is not available in the T-AMF, the
T-AMF does not invoke Nsmf_PDUSession_UpdateSMContext for this PDU Session.
PDU Session ID indicates a PDU Session candidate for N2 Handover. Target ID
corresponds to Target ID provided by S-RAN in step 1. SM N2 Info includes the
Direct Forwarding Path Availability if the direct data forwarding is available
between the S-RAN and the T-RAN and has been inserted by the S-RAN.
If the (T-)AMF detects that the UE moves into a non-allowed area based on
Service area restrictions, the (Tâ€‘)AMF notifies each NF consumer which has
subscribed for UE reachability event (e.g. SMFs corresponding to the list of
PDU Sessions received in UE Context from (S-)AMF via Namf_EventExposure_Notify
that the UE is only reachable for regulatory prioritized services.
5\. [Conditional] Based on the Target ID, SMF checks if N2 Handover for the
indicated PDU Session can be accepted. The SMF checks also the UPF Selection
Criteria according to clause 6.3.3 of TS 23.501 [2]. If UE has moved out of
the service area of the UPF connecting to NG-RAN, SMF selects a new
intermediate UPF. If redundant transmission is performed for one or more QoS
Flows of the PDU Session, the SMF selects two new Intermediate UPFs to support
the redundant transmission based on two N3 and N9 tunnels between the T-RAN
and the UPF (PSA) as described in clause 5.33.2.2 of TS 23.501 [2]. In this
case, step 6c and 6d are performed between SMF and each T-UPF.
In the case that the SMF fails to find a suitable I-UPF, the SMF decides to
(based on local policies) either:
\- trigger re-establishment of PDU Session. After handover procedure, SMF
sends N1 message to the UE via the AMF by invoking
Namf_Communication_N1N2MessageTransfer containing the cause indicating PDU
Session re-establishment is required for the UE; or
\- keep the PDU Session, but reject the activation request of User Plane
connection for the PDU Session and inform the AMF about it; or
\- release the PDU Session after handover procedure.
6a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
If the SMF selects a new UPF to act as intermediate UPF for the PDU Session
and the different CN Tunnel Info need be used, the SMF sends N4 Session
Modification Request message to UPF (PSA). The SMF provides the CN Tunnel Info
(on N9) if the CN Tunnel Info is allocated by the SMF and UL Packet detection
rules associate the CN Tunnel Info (on N9) to be installed on the UPF (PSA).
If redundant transmission is performed for one or more QoS Flows of the PDU
Session and the different CN Tunnel Info need be used, the SMF provides two CN
Tunnel Info (on N9) to the UPF (PSA) if the CN Tunnel Info is allocated by the
SMF and indicates to the UPF (PSA) one of the CN Tunnel Info is used as
redundancy tunnel of the PDU Session.
6b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response.
The UPF (PSA) sends an N4 Session Modification Response message to the SMF. If
the UPF (PSA) allocates CN Tunnel Info (on N9) of UPF (PSA), it provides CN
Tunnel Info (on N9) to the SMF. If redundant transmission is performed for one
or more QoS Flows of the PDU Session, the UPF (PSA) provides two CN Tunnel
Info (on N9) of UPF (PSA) to the SMF and indicates the SMF that one CN Tunnel
Info is used as redundancy tunnel of the PDU Session as described in in clause
5.33.2.2 of TS 23.501 [2]. The UPF (PSA) associate the CN Tunnel Info (on N9)
with UL Packet detection rules provided by the SMF.
6c. [Conditional] SMF to T-UPF (intermediate): N4 Session Establishment
Request.
If the SMF selects a new intermediate UPF, i.e. the target UPF (T-UPF), for
the PDU Session and if CN Tunnel Info is allocated by the T-UPF, an N4 Session
Establishment Request message is sent to the T-UPF, providing Packet
detection, enforcement and reporting rules to be installed on the T-UPF. The
CN Tunnel Info (on N9) of UPF (PSA) for this PDU Session, which is used to
setup N9 tunnel, is also provided to the T-UPF.
6d. T-UPF (intermediate) to SMF: N4 Session Establishment Response.
The T-UPF sends an N4 Session Establishment Response message to the SMF with
DL CN Tunnel Info and UL CN Tunnel Info (i.e. N3 tunnel info). The SMF starts
a timer to release the resource of S-UPF, which is to be used in step 13a of
the Execution Phase.
7\. SMF to T-AMF: _Nsmf_PDUSession_UpdateSMContext Response (_ PDU Session ID,
N2 SM Information, Reason for non-acceptance _)._
If N2 handover for the PDU Session is accepted, the SMF includes in the
Nsmf_PDUSession_UpdateSMContext response the N2 SM Information containing the
N3 UP address and the UL CN Tunnel ID of the UPF, the QoS parameters, TSCAI
and the User Plane Security Enforcement information for the Target NG-RAN. If
redundant transmission is performed for one or more QoS Flows of the PDU
Session, two UL CN Tunnel Info are included in the N2 SM Information. If the
N2 SM information received at step 4 does not include the Direct Forwarding
Path Availability and the SMF knows that there is no indirect data forwarding
connectivity between source and target, the N2 SM Information includes a Data
forwarding not possible indication. If the SMF indicated that Direct
Forwarding is available in step 4, the SMF should further include a \"Direct
Forwarding Path Availability\" indication in the N2 SM information container.
The SMF sends the Alternative QoS Profiles, QoS monitoring configuration for
congestion information or ECN marking for L4S indicator for QoS Flow (see TS
23.501 [2]) to the Target NG-RAN on a per QoS Flow basis, if available.
If N2 handover for the PDU Session is not accepted as described in step 5, the
SMF does not include an N2 SM Information regarding the PDU Session to avoid
establishment of radio resources at the target NG-RAN. Instead of that, the
SMF provides a reason for non-acceptance. If the SMF has received notification
from (T-)AMF that the UE is only reachable for regulatory prioritized
services, the SMF does not include any N2 SM info regarding the PDU Session
for non-regulatory prioritized services to avoid establishment of radio
resources at the target NG-RAN. If the SMF receives notification from (T-)AMF
that UE is only reachable for regulatory prioritized service after this step
via Namf_EventExposure_Notify, the SMF deactivates the PDU Session after
handover procedure finish if the PDU Session is not for regulatory prioritized
services.
8\. AMF supervises the Nsmf_PDUSession_UpdateSMContext Response messages from
the involved SMFs. The lowest value of the Max delay indications for the PDU
Sessions that are candidates for handover gives the maximum time AMF may wait
for Nsmf_PDUSession_UpdateSMContext Response messages before continuing with
the N2 Handover procedure. At expiry of the maximum wait time or when all
Nsmf_PDUSession_UpdateSMContext Response messages are received, AMF continues
with the N2 Handover procedure (Handover Request message in step 9).
NOTE 2: The delay value for each PDU Session is locally configured in the AMF
and implementation specific.
9\. T-AMF to T-RAN: _Handover Request (_ Source to Target transparent
container, N2 MM Information, N2 SM Information list, Tracing Requirements, UE
Radio Capability ID _). If the subscription information includes Tracing
Requirements, the target AMF provides the target RAN with Tracing Requirements
in the Handover Request._
T-AMF determines T-RAN based on Target ID. T-AMF may allocate a 5G-GUTI valid
for the UE in the AMF and target TAI.
_Source to Target_ transparent container is forwarded as received from S-RAN.
N2 MM Information includes e.g. security information and Mobility Restriction
List if available in the T-AMF.
N2 SM Information list includes N2 SM Information received from SMFs for the
T-RAN in the Nsmf_PDUSession_UpdateSMContext Response messages received within
allowed max delay supervised by the T-AMF mentioned in step 8.
T-AMF provides the UE Radio Capability ID to T-RAN if RACS is supported. If
the UE Radio Capability ID is included in the Handover Request message and no
UE radio access capabilities are provided in the Source to Target transparent
container, when there is no corresponding UE radio capabilities set for UE
Radio Capability ID at T-RAN, T-RAN shall request the T-AMF to provide the UE
radio capabilities set corresponding to UE Radio Capability ID to the T-RAN.
If the Source to Target transparent container contains the UE radio access
capabilities and the T-RAN did not receive the UE Radio Capability ID from the
T-AMF, NG-RAN shall proceed with handover using the received UE radio access
capabilities. If the T-RAN received both the UE radio access capabilities and
the UE Radio Capability ID, then the T-RAN shall use any locally stored UE
radio access capability information corresponding to the UE Radio Capability
ID. If none are stored locally, the T-RAN may request the full UE radio access
capability information from the core network. If the full UE radio access
capability information is not promptly received from the core network, or the
T-RAN chooses not to request them, then the T-RAN shall proceed with the UE
radio access capabilities sent by the source RAN node. The T-RAN shall not use
the UE radio access capability information received from the source RAN node
for any other UE with the same the UE Radio Capability ID.
10\. T-RAN to T-AMF: _Handover Request Acknowledge (_ Target to Source
transparent container, List of PDU Sessions to Hand-over with N2 SM
information, List of PDU Sessions that failed to be established with the
failure cause given in the N2 SM information element, PDU Set Based Handling
Support Indication included in the N2 SM information _)._
_Target to Source transparent container_ includes a UE container with an
access stratum part and a NAS part. The UE container is sent transparently via
T-AMF, S-AMF and S-RAN to the UE. If DAPS handover is supported by the T-RAN
and T-AMF and the DAPS Information for one or more DRBs had been received in
the Source to Target Transparent Container, the T-RAN includes the DAPS
Response information in the Target to Source Transparent Container as
described in TS 38.300 [9].
T-RAN creates List Of PDU Sessions failed to be setup and reason for failure
(e.g. T-RAN decision, S-NSSAI is not available, unable to fulfil User Plane
Security Enforcement) based on T-RAN determination. The information is
provided to the S-RAN.
The N2 SM information in the List Of PDU Sessions to Hand-over, contains per
each PDU Session ID T-RAN N3 addressing information i.e. N3 UP address and
Tunnel ID of T-RAN for the PDU Session.
If redundant transmission is performed for one or more QoS Flows of the PDU
Session, the T-RAN provides two AN Tunnel Info for the PDU Session in the N2
SM information. The T-RAN indicates to the SMF one of the AN Tunnel Info is
used as the redundancy tunnel of the PDU session as described in clause
5.33.2.2 of TS 23.501 [2]. If only one AN Tunnel Info is provided by the
Target NG-RAN for the PDU session, the SMF may release these QoS Flows by
triggering PDU Session Modification procedure as specified in clause 4.3.3
after the handover procedure.
The N2 SM information may also include:
\- an Indication whether UP integrity protection is performed or not on the
PDU Session based on User Plane Security Enforcement information received in
N2 SM information in step 9.
\- if the PDU Session has at least one QoS Flow subject for data forwarding,
N3 UP address and Tunnel ID of T-RAN for receiving forwarded data. The T-RAN
provides data forwarding addresses for each data forwarding tunnel which it
decided to setup.
\- For each QoS Flow accepted with an Alternative QoS Profile (see TS 23.501
[2]), the Target NG-RAN shall include a reference to the fulfilled Alternative
QoS Profile.
\- For each accepted QoS Flow, QoS Flows status (active/not active) for QoS
monitoring configuration for congestion information, established QoS Flows
status (active/not active) for ECN marking for L4S.
11a. AMF to SMF: Nsmf_PDUSession_UpdateSMContext _Request (_ PDU Session ID,
N2 SM response received from T-RAN in step 10 _)._
For each N2 SM response received from the T-RAN (N2 SM information included in
Handover Request Acknowledge), AMF sends the received N2 SM response to the
SMF indicated by the respective PDU Session ID.
If no new T-UPF is selected, SMF stores the N3 tunnel info of T-RAN from the
N2 SM response if N2 handover is accepted by T-RAN.
The SMF/UPF allocates the N3 UP address and Tunnel IDs for indirect data
forwarding corresponding to the data forwarding tunnel endpoints established
by T-RAN.
If a PDU Session is indicated as a rejected PDU Session by the Target NG-RAN
with an indication that the PDU session was rejected because User Plane
Security Enforcement is not supported in the Target NG-RAN and the User Plane
Enforcement Policy indicates \"Required\" as described in clause 5.10.3 of TS
23.501 [2], the SMF triggers the release of this PDU Session. In all other
cases of PDU Session rejection, the SMF can decide whether to release the PDU
Session (possibly triggering the re-establishment of the PDU Session as
described in step 5) or to deactivate the UP connection of this PDU Session.
If some of the QoS Flows of a PDU Session are not accepted by the Target NG-
RAN, the SMF shall initiate the PDU Session Modification procedure to remove
the non-accepted QoS Flows from the PDU Session(s) after the handover
procedure is completed.
11b. [Conditional] SMF to T-UPF: N4 Session Modification Request (T-RAN SM N3
forwarding Information list, indication to allocate DL forwarding tunnel(s)
for indirect forwarding)
If the SMF selected a T-UPF in step 6a, the SMF updates the T-UPF by providing
the T-RAN SM N3 forwarding information list by sending a N4 Session
Modification Request to the T-UPF.
If indirect forwarding applies based on indication from the S-RAN and the UPF
is re-allocated and if the SMF decides to setup the indirect forwarding tunnel
on the same T-UPF, the SMF also requests in the N4 Session Modification
Request message to the T-UPF, to allocate DL forwarding tunnel(s) for indirect
forwarding.
Indirect forwarding may be performed via a UPF which is different from the
T-UPF, in which case the SMF selects a T-UPF for indirect forwarding.
11c. [Conditional] T-UPF to SMF: N4 Session Modification Response (T-UPF SM N3
forwarding Information list).
The T-UPF allocates Tunnel Info and returns an N4 Session Modification
Response message to the SMF.
The T-UPF SM N3 forwarding info list includes T-UPF N3 address, T-UPF N3
Tunnel identifiers for forwarding data
11d. [Conditional] SMF to S-UPF: N4 Session Modification Request (T-RAN SM N3
forwarding Information list or T-UPF SM N3 forwarding Information list,
indication to allocate DL forwarding tunnel(s) for indirect forwarding).
If the UPF is re-allocated, this message includes the T-UPF SM N3 forwarding
info list. If the UPF is not re-allocated, this message includes the T-RAN SM
N3 forwarding info list.
If indirect forwarding applies based on indication from NG-RAN and UPF
allocates tunnel identities, the SMF indicates in the N4 Session Modification
Request message to the S-UPF to allocate DL forwarding tunnel(s) for indirect
forwarding.
Indirect forwarding may be performed via a UPF which is different from the
S-UPF.
11e. [Conditional] S-UPF to SMF: N4 Session Modification Response (S-UPF SM N3
forwarding Information list).
The S-UPF allocates Tunnel Info and returns an N4 Session establishment
Response message to the SMF.
The S-UPF SM N3 forwarding Information list includes S-UPF N3 address, S-UPF
N3 Tunnel identifiers for DL data forwarding.
11f. SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response (N2 SM
Information).
The SMF sends an Nsmf_PDUSession_UpdateSMContext Response message per PDU
Session to T-AMF.
The SMF creates an N2 SM information containing the DL forwarding Tunnel Info
to be sent to the S-RAN by the AMF. The SMF includes this information in the
Nsmf_PDUSession_UpdateSMContext response. The DL forwarding Tunnel Info can be
one of the following information:
\- If direct forwarding applies, then the SMF includes the T-RAN N3 forwarding
information the SMF received in step 11a.
\- If the indirect forwarding tunnel is setup in step 11b or 11d, then the SMF
includes the T-UPF or S-UPF DL forwarding information containing the N3 UP
address and the DL Tunnel ID of the UPF.
12\. [Conditional] T-AMF to S-AMF: Namf_Communication_CreateUEContext Response
(N2 information necessary for S-AMF to send Handover Command to S-RAN
including Target to Source transparent container, PDU Sessions failed to be
setup list, N2 SM information (N3 DL forwarding Information, PCF ID), [Target
AMF ID]).
T-AMF supervises the Nsmf_PDUSession_UpdateSMContext Response message from the
involved SMFs. At expiry of the maximum wait time or when all
Nsmf_PDUSession_UpdateSMContext Response messages are received, T-AMF sends
the Namf_Communication_CreateUEContext Response to the S-AMF.
The PDU Sessions failed to be setup list includes the List Of PDU Sessions
failed to be setup received from target RAN in step 10 and the Non-accepted
PDU session List generated by the T-AMF.
Non-accepted PDU Session List includes following PDU Session(s) with proper
cause value:
\- Non-accepted PDU Session(s) by the SMF(s);
\- Non-accepted PDU Session(s) by the AMF due to no response from the SMF
within maximum wait time; and
\- Non-accepted PDU Session(s) by the AMF due to non-available S-NSSAI in the
T-AMF, which is decided at step 4.
The Target to Source transport container is received from the T-RAN. The N2 SM
Information is received from the SMF in step 11f.
If target AMF re-allocation is executed in step 3, the selected final target
AMF, i.e. T-AMF, invoke Namf_Communication_CreateUEContext Response (Cause, N2
information necessary for S-AMF to send Handover Command to S-RAN including
Target to Source transparent container, N2 SM information (PDU Sessions failed
to setup list, N3 DL forwarding Information), PCF ID, PCF reselected
indication, target AMF ID) to the initial AMF. The cause indicates whether the
Relocate UE Context (hand-Over) succeeded or failed. If the target NG RAN has
rejected the Handover Request in step 10, the cause indicates a failure due to
RAN rejection. The target AMF ID is used for S-AMF to transfer RAN Status to
T-AMF directly. Based on the receiving Namf_Communication_CreateUEContext
Response, the initial AMF invokes Namf_Communication_CreateUEContext Response
towards S-AMF.
##### 4.9.1.3.3 Execution phase
Figure 4.9.1.3.3-1: inter NG-RAN node N2 based handover, execution phase
NOTE 1: Registration of serving AMF with the UDM is not shown in the figure
for brevity.
1\. S-AMF to S-RAN: _Handover Command (_ Target to Source transparent
container, List Of PDU Sessions to be handed-over with N2 SM information
containing information received from T-RAN during the handover preparation
phase, List Of PDU Sessions failed to be setup _)._
Target to Source transparent container is forwarded as received from S-AMF. If
DAPS Response information for one or more DRBs is received by S-RAN and
indicates that DAPS handover is accepted, the execution phase for DAPS
handover procedure as described in clause 4.9.1.3.3a is performed.
The SM forwarding info list includes T-RAN SM N3 forwarding info list for
direct forwarding or S-UPF SM N3 forwarding info list for indirect data
forwarding
S-RAN uses the PDU Sessions failed to be setup list and the indicated reason
for failure to decide whether to proceed with the N2 Handover procedure.
If the S-RAN supports and receives a reference to an Alternative QoS Profile
for an accepted QoS Flow, it shall take it into account for deciding whether
or not to proceed with the N2 Handover procedure (see TS 23.501 [2]).
2\. S-RAN to UE: _Handover Command (_ UE container _)._
UE container is a UE part of the Target to Source transparent container which
is sent transparently from T-RAN via AMF to S-RAN and is provided to the UE by
the S-RAN.
2a0. If the PLMN has configured secondary RAT usage reporting and the source
NG-RAN has Secondary RAT usage data to report, the source NG-RAN node may
provide RAN usage data report message (N2 SM Information (Secondary RAT usage
data), Handover Flag) as in clause 4.21 to the AMF. The Handover Flag
indicates to the AMF that it should buffer the N2 SM Information containing
the usage data report before forwarding it.
NOTE 2: This step is not shown in this figure but the secondary RAT usage data
reporting procedure is shown in figure 4.21-1 in clause 4.21.
2a. - 2c. The S-RAN sends the Uplink RAN Status Transfer message to the S-AMF,
as specified in TS 36.300 [46] and TS 38.300 [9]. The S-RAN may omit sending
this message if none of the radio bearers of the UE shall be treated with PDCP
status preservation. In the case of time-based handover, the S-RAN sends the
Uplink RAN Early Status Transfer message to the S-AMF as specified in TS
38.413 [10].
If there is an AMF relocation, the S-AMF sends this information to the T-AMF
via the Namf_Communication_N1N2MessageTransfer service operation and the T-AMF
acknowledges. The S-AMF or, if the AMF is relocated, the T-AMF, sends the
information to the T-RAN via the Downlink RAN Status Transfer message, as
specified in TS 36.300 [46] and TS 38.300 [9]. In the case of time-based
handover, the T-AMF sends the Downlink RAN Early Status Transfer message to
the T-RAN as specified in TS 38.413 [10].
For Inter PLMN handover, if the target AMF has been relocated in Preparation
phase, e.g. due to the inter PLMN handover, the S-AMF send this information to
the indicated T-AMF, which is derived from the target AMF ID received in step
12 of clause 4.9.1.3.2.
3\. Uplink packets are sent from T-RAN to T-UPF and UPF (PSA). Downlink
packets are sent from UPF (PSA) to S-RAN via S-UPF. The S-RAN should start
forwarding of downlink data from the S-RAN towards the T-RAN for QoS Flows or
DRBs subject to data forwarding. This may be either direct (step 3a) or
indirect forwarding (step 3b).
4\. UE to T-RAN: _Handover Confirm._
After the UE has successfully synchronized to the target cell, it sends a
Handover Confirm message to the T-RAN. Handover is by this message considered
as successful by the UE.
5\. T-RAN to T-AMF: _Handover Notify._
Handover is by this message considered as successful in T-RAN.
6a. [Conditional] T-AMF to S-AMF: Namf_Communication_N2InfoNotify.
The T-AMF notifies to the S-AMF about the N2 handover notify received from the
T-RAN by invoking the Namf_Communication_N2InfoNotify.
A timer in S-AMF is started to supervise when resources in S-RAN shall be
release.
6b. [Conditional] S-AMF to T-AMF: Namf_Communication_N2InfoNotify ACK (N2 SM
Information (Secondary RAT usage data)).
The S-AMF acknowledges by sending the Namf_Communication_N2InfoNotify ACK to
the T-AMF. The N2 SM Information here is the one buffered at step 2a0 when
applicable.
6c. [Conditional] S-AMF to SMF: Nsmf_PDUSession_ReleaseSMContext Request (SM
Context ID, N2 SM Information (Secondary RAT Usage Data))_._
If the PDU Session(s) is not accepted by the T-AMF (e.g. S-NSSAI associated
with the PDU Session is not available in the T-AMF), S-AMF triggers PDU
Session Release procedure as specified in clause 4.3.4.2 after the S-AMF is
notified for the reception of N2 Handover Notify in step 6a.
7\. T-AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (Handover Complete
indication for PDU Session ID, UE presence in LADN service area, N2 SM
Information (Secondary RAT usage data))_. The N2 SM Information here is the
one received at step 6b when applicable._
Handover Complete indication is sent per each PDU Session to the corresponding
SMF to indicate the success of the N2 Handover.
When an Nsmf_PDUSession_UpdateSMContext Response message arrived too late
during the handover preparation phase (see step 8 of clause 4.9.1.3.2), or the
PDU Session with SMF involvement is not accepted by T-RAN,
Nsmf_PDUSession_UpdateSMContext Request (SM Context ID, Operation Type) is
sent to the corresponding SMF allowing the SMF to deallocate a possibly
allocated N3 UP address and Tunnel ID of the selected UPF. A PDU Session
handled by that SMF is considered deactivated and handover attempt is
terminated for that PDU Session.
In the case that the AMF determines that the PDU Session is related to a LADN
then the AMF provides the \"UE presence in LADN service area\". If the AMF
does not provide the \"UE presence in LADN service area\" indication and the
SMF determines that the DNN corresponds to a LADN, then the SMF considers that
the UE is OUT of the LADN service area.
The SMF takes actions for the LADN PDU Session as defined in clause 5.6.5 of
TS 23.501 [2] based on the \"UE presence in LADN service area\" indication.
For each QoS Flow for which the SMF has received a reference to the fulfilled
Alternative QoS Profile in step 10 of clause 4.9.1.3.2, the SMF notifies the
PCF and the UE as described in TS 23.501 [2].
8a. [Conditional] SMF to T-UPF (intermediate): N4 Session Modification
Request.
If new T-UPF is inserted or an existing intermediate S-UPF is re-allocated,
the SMF shall send N4 Session Modification Request indicating DL AN Tunnel
Info of T-RAN to the T-UPF.
8b. [Conditional] T-UPF to SMF: N4 Session Modification Response.
The T-UPF acknowledges by sending N4 Session Modification Response message to
SMF.
9a. [Conditional] SMF to S-UPF (intermediate): N4 Session Modification
Request.
If UPF is not re-allocated, the SMF shall send N4 Session Modification Request
indicating DL AN Tunnel Info of T-RAN to the S-UPF.
9b. [Conditional] S-UPF to SMF: N4 Session Modification Response.
The S-UPF acknowledges by sending N4 Session Modification Response message to
SMF.
10a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
For non-roaming or local breakout roaming scenario, the SMF sends N4 Session
Modification Request message to PDU Session Anchor UPF, UPF (PSA), providing
N3 AN Tunnel Info of T-RAN or the DL CN Tunnel Info of T-UPF if a new T-UPF is
inserted or an existing intermediate S-UPF is re-allocated. If redundant
transmission is performed for one or more QoS Flows of the PDU Session, two N3
AN Tunnel Info of T-RAN or two DL CN Tunnel Info of two T-UPFs are provided
and the SMF indicates to the UPF (PSA) one of the AN/CN Tunnel Info is used as
redundancy tunnel of the PDU Session. If the existing intermediate S-UPF
terminating N9 toward the H-UPF (PDU Session Anchor) is re-allocated for the
home routed roaming scenario, the V-SMF invokes an Nsmf_PDUSession_Update
Request (DL CN Tunnel Info) service operation toward the H-SMF.
In the case of the S-UPF acts as a UL CL or BP, the SMF indicates only one of
the PDU Session Anchors to send the \"end marker\" packets. To ensure the
\"end marker\" is the last user plane packet on the old path, the SMF should
modify the path on other PDU Session Anchors before it indicates the PDU
Session Anchor to send the \"end marker\" packets.
If T-UPF is not inserted or an existing intermediate S-UPF is not re-
allocated, step 10a and step 10b are skipped.
10b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response.
The UPF (PSA) sends N4 Session Modification Response message to SMF. In order
to assist the reordering function in the T-RAN, the UPF (PSA) sends one or
more \"end marker\" packets for each N3 tunnel on the old path immediately
after switching the path, the source NG-RAN shall forward the \"end marker\"
packets to the Target NG-RAN. At this point, UPF (PSA) starts sending downlink
packets to the T-RAN, via T-UPF if a new T-UPF is inserted or an existing
intermediate S-UPF is re-allocated. In the case of home routed roaming
scenario, the H-SMF responds with the Nsmf_PDUSession_Update Response service
operation to V-SMF once the H-UPF (PDU Session Anchor) is updated with the UL
Tunnel Info of the T-UPF.
When there are multiple UPFs(PSA), step 10a and step 10b are performed for
each UPFs(PSA).
11\. SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response (PDU Session ID).
SMF confirms reception of Handover Complete.
If indirect data forwarding applies, the SMF starts an indirect data
forwarding timer, to be used to release the resource of indirect data
forwarding tunnel.
12\. The UE initiates Mobility Registration Update procedure as described in
clause 4.2.2.2.2.
The target AMF knows that it is a Handover procedure and therefore the target
AMF performs only a subset of the Registration procedure, specifically the
steps 4, 5 and 10 in the Registration procedure for the context transfer
between source AMF and target AMF are skipped.
The target AMF, based on the S-NSSAIs subject to Network Slice-Specific
Authentication and Authorization status information from source AMF in step 3
of clause 4.9.1.3.2, may decide to skip step 25 in the Registration procedure
(i.e. NSSAA procedure) or whether to perform it if the status is pending.
13a. [Conditional] SMF to S-UPF (intermediate): N4 Session Release Request.
If there is a source intermediate UPF, the SMF initiates resource release,
after timer in step 6 or indirect data forwarding timer expires, by sending an
N4 Session Release Request (Release Cause) to source UPF. This message is also
used to release the indirect data forwarding resource in S-UPF.
13b. S-UPF to SMF: N4 Session Release Response.
The S-UPF acknowledges with an N4 Session Release Response message to confirm
the release of resources.
In the case of indirect data forwarding, the resource of indirect data
forwarding is also released.
14a. AMF to S-RAN: UE Context Release Command ().
After the timer in step 6a expires, the AMF sends UE Context Release Command.
14b. S-RAN to AMF: UE Context Release Complete ().
The source NG-RAN releases its resources related to the UE and responds with a
UE Context Release Complete () message.
15a. [Conditional] SMF to T-UPF: N4 Session Modification Request.
If indirect forwarding applies and UPF is re-allocated, after timer of
indirect data forwarding expires, the SMF sends N4 Session Modification
Request to T-UPF to release the indirect data forwarding resource.
15b. [Conditional] T-UPF to SMF: N4 Session Modification Response.
The T-UPF acknowledges with an N4 Session Modification Response message to
confirm the release of indirect data forwarding resources.
If the AMF is subscribed to Mobility Event by other NFs, the AMF notifies the
event to the corresponding NFs by invoking the Namf_EventExposure_Notify
service operation as described in clause 4.15.4.2.
Upon reception of the Namf_EventExposure_Notify with an indication that UE is
reachable only for regulatory prioritized service, the SMF deactivates the PDU
Session if the service of the PDU Session is not regulatory prioritized. For
home routed roaming case, the V-SMF triggers the deactivation of the PDU
Session, in addition, the H-SMF refrains from sending downlink signalling if
the signalling is not related to regulatory prioritized service upon receiving
the notification.
##### 4.9.1.3.3a Execution phase for DAPS handover
This procedure applies only if at the end of the Preparation phase it has been
determined that at least one DRB of the UE is subject to a DAPS related
Handover.
Figure 4.9.1.3.3a-1: inter NG-RAN node N2 based DAPS handover, execution phase
1 to 2. Same as step 1 to step 2 in clause 4.9.1.3.3 with the following
difference.
DAPS Response information received in the Target to Source Transparent
Container indicates the DAPS handover is accepted for one or more DRBs.
2a to 2c. The S-RAN sends the Uplink RAN Early Status Transfer message to the
S-AMF as specified in TS 38.413 [10]. For the DRBs not subjecting to DAPS,
steps 2a to 2c in clause 4.9.1.3.3 may be performed.
If there is an AMF change, the S-AMF sends this information to the T-AMF via
the Namf_Communication_N1N2MessageTransfer service operation and the T-AMF
acknowledges. The S-AMF or, if the AMF is relocated, the T-AMF, sends the
information to the T-RAN via the Downlink RAN Early Status Transfer message,
as specified in TS 38.413 [10].
3\. Same as step 3 in clause 4.9.1.3.3.
4\. Same as step 4 in clause 4.9.1.3.3.
5\. T-RAN to T-AMF: same as step 5 in clause 4.9.1.3.3 with the difference
that the Handover Notify includes a Notify Source NG-RAN node information
which is used to notify the S-RAN that the UE has successfully accessed the
T-RAN.
6a. [Conditional] T-AMF to S-AMF: Namf_Communication_N2InfoNotify.
The T-AMF notifies the S-AMF as in step 6a in clause 4.9.1.3.3 with the
difference that Notify Source NG-RAN node information is included.
6b. [Conditional] S-AMF to T-AMF: Namf_Communication_N2InfoNotify ACK.
The S-AMF acknowledges by sending the Namf_Communication_N2InfoNotify ACK to
the T-AMF as in step 6b in clause 4.9.1.3.3.
7\. S-AMF to S-RAN: Handover Success.
The S-AMF informs the S-RAN node that the UE has successfully accessed the
T-RAN as described in TS 38.413 [10], S-RAN stops the UL data transfer for the
UE.
8a to 8c. The S-RAN initiates step 8a. Step 8a to 8c are the same as step 2a
to 2c in clause 4.9.1.3.3 for the DRB(s) subject to DAPS.
9\. Step 6c to step 15 in clause 4.9.1.3.3 are performed.
#### 4.9.1.4 Inter NG-RAN node N2 based handover, Cancel
Prior to sending a Handover Command to the UE, the source NG-RAN node may
attempt cancellation of handover during the handover procedure. The reason for
cancellation may include timer expiration, internal failure within the source
NG-RAN node or UE returned to source cell etc. The handover cancellation is
initiated by sending a Handover Cancel request to the source AMF. This is done
in order to release the resources reserved for the handover in the target
system.
The AMF shall cancel the handover resources as defined in clause 4.11.1.2.3
for case the source RAN is NG-RAN.
### 4.9.2 Handover of a PDU Session procedure between 3GPP and untrusted
non-3GPP access
#### 4.9.2.0 General
The procedures in this clause are used to hand over a PDU Session between 3GPP
access and non-3GPP access. This can be triggered, for example, due to radio
conditions, user interaction, etc. When the UE triggers handover of a PDU
Session between 3GPP access and non-3GPP access and the procedure fails due to
e.g. not allowed by policy or AN rejected resource setup, etc. the network
should not release the PDU Session.
#### 4.9.2.1 Handover of a PDU Session procedure from untrusted non-3GPP to
3GPP access (non-roaming and roaming with local breakout)
Clause 4.9.2.1 specifies how to hand over a UE from a source Untrusted
non-3GPP access to a target 3GPP access and how a UE can handover a PDU
Session from untrusted non-3GPP access to 3GPP access. It is based on the PDU
Session Establishment procedure for 3GPP access as specified in clause 4.3.2.
Figure 4.9.2.1-1: Handover of a PDU Session procedure from untrusted non-3GPP
access to 3GPP access (non-roaming and roaming with local breakout)
1\. If the UE is not registered via 3GPP access, the UE shall initiate
Registration procedure as defined in clause 4.2.2.2.2.
2\. The UE performs a PDU Session Establishment procedure with the PDU Session
ID of the PDU Session to be moved as specified clause 4.3.2.2.1 (PDU Session
Establishment for Non-roaming and Roaming with Local Breakout).
When sending the PDU Session Establishment Accept, within the N1 SM container
and in the N2 SM information, the SMF shall include all QoS information (e.g.
QoS Rule(s) in N1 SM container, QFI(s) and QoS Profile(s) in N2 SM
information) for the QoS Flow(s) that are applicable to the PDU Session for
the target access.
3\. If the User Plane of the PDU Session is activated in non-3GPP access, the
SMF executes the release of resources in non-3GPP access by initiating a
Namf_Communication_N1N2MessageTransfer (to send N2 resource release request)
which triggers performing steps 4 to 7 specified in clause 4.12.7, followed by
step 7a/7b specified in clause 4.3.4.2 in order to release the resources over
the source non-3GPP access. Because the PDU Session shall not be released, the
SMF shall not send the PDU Session Release Command to the UE. Hence, in steps
4 and 7 of clause 4.12.7 as well as in step 7a of clause 4.3.4.2, the messages
do not include the N1 SM container but only the N2 Resource Release Request
(resp. Ack). Since the PDU Session is not to be released, the SMF shall not
execute step 11 of clause 4.3.4.2 and the SM context between the AMF and the
SMF is maintained.
If the User Plane of the PDU Session is deactivated in non-3GPP access, this
step is skipped.
The steps 2 and 3 shall be repeated for all PDU Sessions to be moved from to
untrusted non-3GPP access to 3GPP access.
If the UE is moving to the NB-IoT RAT type of 3GPP access, the PDU Session
Establishment request would be rejected by AMF when the UP resources exceeds
the UE\'s maximum number of supported UP resources as described in clause
5.4.5.2.4 of TS 24.501 [25].
#### 4.9.2.2 Handover of a PDU Session procedure from 3GPP to untrusted
non-3GPP access (non-roaming and roaming with local breakout)
Clause 4.9.2.2 specifies how to hand over a UE from a source 3GPP access to a
target Untrusted non-3GPP access and how a UE can handover a PDU Session from
3GPP access to untrusted non-3GPP access. It is based on the PDU Session
Establishment procedure for non-3GPP access as specified in clause 4.12.5.
Figure 4.9.2.2-1: Handover of a PDU Session from 3GPP access to untrusted
non-3GPP access (non-roaming and roaming with local breakout)
1\. If the UE is not registered via untrusted non-3GPP access, the UE shall
initiate Registration procedure as defined in clause 4.12.2.
2\. The UE performs PDU Session Establishment procedure with the PDU Session
ID of the PDU Session to be moved as specified in clause 4.12.5.
When sending the PDU Session Establishment Accept, within the N1 SM container
and in the N2 SM information, the SMF shall include all QoS information (e.g.
QoS Rule(s) in N1 SM container, QFI(s) and QoS Profile(s) in N2 SM
information) for the QoS Flow(s) that are applicable to the PDU Session for
the target access.
3\. If the User Plane of the PDU Session is activated in 3GPP access, the SMF
executes the release of resource in 3GPP access by performing step 3b, then
steps 4 to 7a/7b specified in clause 4.3.4.2 (UE or network requested PDU
Session Release for Non-Roaming and Roaming with Local Breakout) in order to
release the resources over the source 3GPP access. Because the PDU Session
shall not be released, the SMF shall not send the PDU Session Release Command
to the UE. Hence, in steps 3b, 4, 6 and 7a of clause 4.3.4.2, messages do not
include the N1 SM container but only the N2 Resource Release Request (resp.
Ack). Since the PDU Session is not to be released, the SMF shall not execute
step 11 of clause 4.3.4.2 and the SM context between the AMF and the SMF is
maintained.
If the User Plane of the PDU Session is deactivated in 3GPP access, this step
is skipped.
The steps 2 and 3 shall be repeated for all PDU Sessions to be moved from 3GPP
access to untrusted non-3GPP access.
If the PDU Session is associated with Control Plane Only Indication, the AMF
shall reject the PDU Session establishment request as the Control Plane CIoT
Optimisation feature is not supported over non-3GPP accesses as described in
clause 5.4.5.2.5 of TS 24.501 [25].
#### 4.9.2.3 Handover of a PDU Session procedure from untrusted non-3GPP to
3GPP access (home routed roaming)
##### 4.9.2.3.1 The target AMF is in the PLMN of the N3IWF
Figure 4.9.2.3.1 -1: Handover of a PDU Session procedure from untrusted
non-3GPP access to 3GPP access (home routed roaming)
1\. If the UE is not registered via 3GPP access, the UE shall initiate
Registration procedure as defined in clause 4.2.2.2.2. The NG-RAN selects the
same AMF as the one used via non-3GPP access.
2\. The UE performs a PDU Session Establishment procedure with the PDU Session
ID of the PDU Session to be moved as specified clause 4.3.2.2.2 (PDU Session
Establishment for Home Routed Roaming). The AMF selects the same V-SMF as the
one used via non-3GPP access.
In the Nsmf_PDUSession_Update Response the H-SMF shall include all QoS
information for the QoS Flow(s) applicable to the PDU Session for the target
access so that when sending the PDU Session Establishment Accept, within the
N1 SM container and in the N2 SM information, the V-SMF can include all QoS
information (e.g. QoS Rule(s) in N1 SM container, QFI(s) and QoS Profile(s) in
N2 SM information) for the QoS Flow(s) acceptable according to VPLMN policies.
In case of Handover for a PDU Session eligible to EPS Interworking, the
Nsmf_PDUSession_Update Response should also contain: EPS bearer context(s),
linked EBI.
3\. If the User Plane of the PDU Session is activated in non-3GPP access, the
V-SMF executes the release of resource in non-3GPP access by initiating a
Namf_Communication_N1N2MessageTransfer (to send N2 resource release request)
which triggers performing steps 4 to 7 specified in clause 4.12.7, followed by
step 7a/7b specified in clause 4.3.4.2 in order to release the resources over
the source non-3GPP access. Because the PDU Session shall not be released, the
SMF shall not send the PDU Session Release Command to the UE. Hence, in steps
4 and 7 of clause 4.12.7 as well as in step 7a of clause 4.3.4.2, the messages
do not include the N1 SM container but only the N2 Resource Release Request
(resp. Ack). Since the PDU Session is not to be released, the SMF shall not
execute step 11 of clause 4.3.4.2 and the SM context between the AMF and the
SMF is maintained.
If the User Plane of the PDU Session is deactivated in non-3GPP access, this
step is skipped.
The steps 2 and 3 shall be repeated for all PDU Sessions to be moved from to
untrusted non-3GPP access to 3GPP access.
##### 4.9.2.3.2 The target AMF is not in the PLMN of the N3IWF (i.e. N3IWF in
HPLMN)
Figure 4.9.2.3.2-1: Handover of a PDU Session procedure from untrusted
non-3GPP access with N3IWF in the HPLMN to 3GPP access (home routed roaming)
1\. If the UE is not registered via 3GPP access, the UE shall initiate
Registration procedure as defined in clause 4.2.2.2.2. This includes the
retrieval of the SMF-IDs corresponding to each of the PDU Sessions.
2\. The UE performs a PDU Session Establishment procedure with the PDU Session
ID of the PDU Session to be moved as specified clause 4.3.2.2.2 (PDU Session
Establishment for Home Routed Roaming).
In the Nsmf_PDUSession_Create Response the H-SMF shall include all QoS
information for the QoS Flow(s) applicable to the PDU Session for the target
access so that when sending the PDU Session Establishment Accept, within the
N1 SM container and in the N2 SM information, the V-SMF can include all QoS
information (e.g. QoS Rule(s) in N1 SM container, QFI(s) and QoS Profile(s) in
N2 SM information) for the QoS Flow(s) acceptable according to VPLMN policies.
3\. The H-SMF executes the release of resources in non-3GPP AN by performing
steps 3-12 specified in clause 4.12.7 with the following exceptions:
\- the H-SMF interfaces the source AMF (in the home PLMN). The H-SMF shall not
send the N1 SM Container (PDU Session Release Command) to the UE;
\- The Npcf_SMPolicyControl_Delete service operation to PCF shall not be
performed.
\- Nsmf_PDUSession_SMContexStatusNotify service operation invoked by the H-SMF
to the source AMF indicates the PDU Session is moved to different access.
The steps 2 and 3 shall be repeated for all PDU Sessions to be moved from to
untrusted non-3GPP access to 3GPP access.
#### 4.9.2.4 Handover of a PDU Session procedure from 3GPP to untrusted
non-3GPP access (home routed roaming)
##### 4.9.2.4.1 The selected N3IWF is in the registered PLMN
Figure 4.9.2.4.1-1: Handover of a PDU Session procedure from 3GPP access to
untrusted non-3GPP access (home routed roaming)
1\. If the UE is not registered via untrusted non-3GPP access, the UE shall
initiate Registration procedure as defined in clause 4.12.2. The N3IWF selects
the same AMF as the one used via 3GPP access.
2\. The UE performs PDU Session Establishment procedure with the PDU Session
ID of the PDU Session to be moved as specified in clause 4.12.5. The AMF
selects the same V-SMF as the one used via 3GPP access.
In the Nsmf_PDUSession_Update Response the H-SMF shall include all QoS
information for the QoS Flow(s) applicable to the PDU Session for the target
access so that when sending the PDU Session Establishment Accept, within the
N1 SM container and in the N2 SM information, the V-SMF can include all QoS
information (e.g. QoS Rule(s) in N1 SM container, QFI(s) and QoS Profile(s) in
N2 SM information) for the QoS Flow(s) acceptable according to VPLMN policies.
3\. If the User Plane of the PDU Session is activated in 3GPP access, the
V-SMF executes the release of resources in 3GPP access by performing step 5c
to 10 specified in clause 4.3.4.3 (UE or network requested PDU Session Release
for Home Routed Roaming) in order to release the resources over the source
3GPP access. Because the PDU Session shall not be released, the SMF shall not
send the PDU Session Release Command to the UE. Hence, in steps 5c, 6, 8 and 9
of clause 4.3.4.3, the messages do not include the N1 SM container but only
the N2 Resource Release Request (resp. Ack). Since the PDU Session is not to
be released, the SMF shall not execute step 11 of clause 4.3.4.2 and the SM
context between the AMF and the SMF is maintained.
If the User Plane of the PDU Session is deactivated in 3GPP access, this step
is skipped.
The steps 2 and 3 shall be repeated for all PDU Sessions to be moved from 3GPP
access to untrusted non-3GPP access.
##### 4.9.2.4.2 The UE is roaming and the selected N3IWF is in the home PLMN
Figure 4.9.2.4.2-1: Handover of a PDU Session procedure from 3GPP access to
untrusted non-3GPP access with N3IWF in the HPLMN (home routed roaming)
1\. If the UE is not registered via untrusted non-3GPP access, the UE shall
initiate Registration procedure as defined in clause 4.12.2. This includes the
retrieval of the SMF-IDs corresponding to each of the PDU Sessions.
2\. The UE performs PDU Session Establishment procedure with the PDU Session
ID of the PDU Session to be moved as specified in clause 4.12.5.
In the Nsmf_PDUSession_Create Response the H-SMF shall include all QoS
information for the QoS Flow(s) applicable to the PDU Session for the target
access so that when sending the PDU Session Establishment Accept, within the
N1 SM container and in the N2 SM information, the V-SMF can include all QoS
information (e.g. QoS Rule(s) in N1 SM container, QFI(s) and QoS Profile(s) in
N2 SM information) for the QoS Flow(s) acceptable according to VPLMN policies.
3\. The H-SMF executes the release of resources in source V-SMF, V-UPF, V-AMF
and 3GPP AN by performing steps 3a, 5c to 16b specified in clause 4.3.4.3 with
the following exceptions:
\- the H-SMF indicates in the Nsmf_PDUSession_Update Request that the UE shall
not be notified. This shall result in the V-SMF not sending the N1 Container
(PDU Session Release Command) to the UE;
\- Nsmf_PDUSession_StatusNotify service operation invoked by H-SMF to V-SMF
indicates PDU Session is moved to different access;
\- Nsmf_PDUSession_SMContexStatusNotify service operation invoked by the V-SMF
to the AMF indicates the PDU Session is moved to different access;
\- The Npcf_SMPolicyControl_Delete service operation to PCF shall not be
performed.
The steps 2 and 3 shall be repeated for all PDU Sessions to be moved from 3GPP
access to untrusted non-3GPP access.
### 4.9.3 Handover of a PDU Session procedure between 3GPP and trusted
non-3GPP access
#### 4.9.3.0 General
The handover of a PDU Session between 3GPP access and trusted non-3GPP access
shall be supported as specified in clause 4.9.2 for all types of handover of a
PDU Session between 3GPP access and untrusted non-3GPP access, with the
following modifications and clarifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by the TNGF.
\- The registration via untrusted non-3GPP access is substituted by the
registration via trusted non-3GPP access as specified in clause 4.12a.2.2.
\- A PDU Session is activated over trusted non-3GPP access as specified in
clause 4.12a.5.
## 4.10 NG-RAN Location reporting procedures
This procedure is used by an AMF to request the NG-RAN to report where the UE
is currently located when the target UE is in CM-CONNECTED state. The need for
the NG-RAN to continue reporting ceases when the UE transitions to CM-IDLE or
the AMF sends cancel indication to NG-RAN. This procedure may be used for
services that require accurate cell identification (e.g. emergency services,
lawful intercept, charging), or for subscription to the service by other NFs.
When Dual Connectivity is activated, PSCell information is only reported if
requested by the AMF.
Figure 4.10-1: NG-RAN Location Reporting Procedure
1\. AMF to NG-RAN: Location Reporting Control (Reporting Type, Location
Reporting Level, (Area Of Interest, Request Reference ID)).
The AMF sends a Location Reporting Control message to the NG-RAN. The Location
Reporting Control message shall identify the UE for which reports are
requested and shall include Reporting Type and Location Reporting Level. The
Location Reporting Control message may also include Area Of Interest and
Request Reference ID. Location Reporting Level could be TAI+ Cell Identity.
Reporting Type indicates whether the message is intended to trigger a single
standalone report about the current Cell Identity serving the UE or start the
NG-RAN to report whenever the UE changes cell, or ask the NG-RAN to report
whenever the UE moves out or into the Area Of Interest. If the Reporting Type
indicates to report whenever the UE changes cell and if PScell reporting is
requested and Dual Connectivity is in use, the Master RAN node shall also
report to the AMF whenever the PSCell changes. If the Reporting Type indicates
to start the NG-RAN to report when UE moves out of or into the Area Of
Interest, the AMF also provides the requested Area Of Interest information in
the Location Reporting Control message. The AMF may include a Request
Reference ID in the Location Report Control message to identify the request of
reporting for an Area Of Interest. If multiple Areas Of Interest are included
in the message, the Request Reference ID identifies each Area of Interest.
NOTE 1: Requesting reports whenever the UE changes cell can increase
signalling load on multiple interfaces. Requesting reports for all changes in
PSCell ID can further increase signalling load. Hence it is recommended that
any such reporting is only applied for a limited number of subscribers.
2\. NG-RAN to AMF: Location Report (UE Location, UE Presence in Area Of
Interest, Request Reference ID, Timestamp).
The NG-RAN sends a Location Report message informing the AMF about the
location of the UE which shall be represented as the requested Location
Reporting Level. If PSCell reporting is requested and Dual Connectivity is
activated, then the Master NG-RAN node shall also include the PSCell ID. With
NR satellite access, cell and TAI reporting by NG-RAN refer to a fixed cell
and fixed TA in which a UE is geographically located. As part of the User
Location Information, NG_RAN also reports one or more TACs for the Selected
PLMN as described in TS 38.413 [10], but it is not guaranteed that the UE is
always located in one of these TACs.
When UE is in CM-CONNECTED with RRC_INACTIVE state, if NG-RAN has received
Location Reporting Control message from AMF with the Reporting Type indicating
single stand-alone report, the NG-RAN shall perform NG-RAN paging before
reporting the location to the AMF. The NG-RAN should send the Location Report
promptly and shall not wait to attempt to create a Dual Connectivity
configuration. However, if PSCell reporting is requested and the PSCell ID is
known to the Master RAN node, then it shall be included in the Location
Report. In the case of RAN paging failure, the RAN reports UE\'s last known
location with time stamp.
When UE is in CM-CONNECTED with RRC_INACTIVE state, if NG-RAN has received
Location Reporting Control message from AMF with the Reporting Type indicating
continuous reporting whenever the UE changes cell, the NG-RAN shall send a
Location Report message to the AMF including the UE\'s last known location
with time stamp. If the UE was using Dual Connectivity immediately before
entering CM-CONNECTED with RRC_INACTIVE state and PSCell reporting is
requested, then the Location Report shall also include the PSCell ID.
When UE is in CM-CONNECTED, if NG-RAN has received Location Reporting Control
message from AMF with the Reporting Type of Area Of Interest based reporting,
the NG-RAN shall track the UE presence in Area Of Interest and send a Location
Report message to AMF including the UE Presence in the Area Of Interest (i.e.
IN, OUT, or UNKNOWN) as described in clause D.2 and the UE\'s current location
(including the PSCell ID if PSCell reporting is requested and Dual
Connectivity is activated) when the UE is in RRC_CONNECTED state, or, when the
UE is in RRC_INACTIVE state, the UE\'s last known location (including the
PSCell ID if PSCell reporting is requested and the UE was using Dual
Connectivity immediately before entering CM-CONNECTED with RRC_INACTIVE state)
with time stamp if the NG-RAN perceives that the UE presence in the Area Of
Interest is different from the last one reported. When the NG-RAN detects that
the UE has moved out of or into multiple areas of interest, it sends multiple
pairs of UE Presence in the Area Of Interest and the Request Reference ID in
one Location Report message to AMF. If UE transitions from RRC_INACTIVE state
to RRC_CONNECTED state, NG-RAN shall check the latest location (including the
PSCell ID if PSCell reporting is requested and Dual Connectivity is activated)
of UE and follow the rules when UE is in RRC_CONNECTED.
The AMF may receive Location Report even if the UE presence in Area Of
Interest is not changed. The AMF stores the latest received PSCell ID with its
associated timestamp. The AMF stores the latest received PSCell ID with its
associated timestamp, when available.
In addition to the above, if the AMF receives the Location Report including
the TAI/NR CGI for the MBSR, the AMF shall, if supported, update the
corresponding Warning Area List NG-RAN specified in TS 23.041 [86]
3\. AMF to NG-RAN: Cancel Location Report (Reporting Type, Request Reference
ID).
The AMF can send a Cancel Location Reporting message to inform the NG-RAN that
it should terminate the location reporting for a given UE corresponding to the
Reporting Type or the location reporting for Area Of Interest indicated by
Request Reference ID. This message is needed when the reporting type was
requested for continuously reporting or for the Area Of Interest. The AMF may
include the Request Reference ID which indicates the requested Location
Reporting Control for the Area Of Interest, so that the NG-RAN should
terminate the location reporting for the Area Of Interest.
NOTE 2: Location reporting related information of the source NG-RAN node is
transferred to the target NG-RAN node during Xn handover.
In this release the location reporting procedure is applicable only to 3GPP
access.
## 4.11 System interworking procedures with EPC
### 4.11.0 General
Clause 4.11 includes the following:
\- Procedures for interworking with EPS based on N26 interface (clause 4.11.1)
and interworking without N26 interface (clause 4.11.2);
\- Handover procedures between EPS and 5GC-N3IWF (clause 4.11.3), handover
procedures between EPS and 5GC-TNGF (clause 4.11.3a) and handover procedures
between EPC/ePDG and 5GS (clause 4.11.4);
\- Impact to 5GC procedure due to interworking with EPC (clause 4.11.5);
\- Interworking for common network exposure (clause 4.11.6).
In clause 4.11, UEs are assumed to support both 5GC NAS and EPC NAS unless
explicitly stated otherwise.
The procedures in clause 4.11 are not applicable for Disaster Roaming service
(see clause 5.40 of TS 23.501 [2]).
### 4.11.0a Impacts to EPS Procedures
#### 4.11.0a.1 General
This clause captures changes to procedures in TS 23.401 [13] that are common
to interworking based on N26 and interworking without N26.
#### 4.11.0a.2 Interaction with PCC
When interworking with 5GS is supported and a \"SMF+PGW-C\" is selected for a
PDN connection, policy interactions between PDN GW and PCRF specified in TS
23.401 [13] are replaced by equivalent interactions between SMF+PGW-C and PCF
as follows:
\- IP-CAN Session Establishment procedure defined in TS 23.203 [24] is
replaced by SM Policy Association Establishment Procedure as described in
clause 4.16.4.The SMF+PGW-C includes the information elements received in
Create Session Request message into the Npcf_SMPolicyControl_Create Service as
follows: the SUPI contains the IMSI, the DNN contains the APN, the PEI
contains either the IMEISV or IMEI, the Session AMBR contains the APN-AMBR and
the default QoS information that contains the default EPS bearer QoS, note
that QCI values are mapped into 5QI values. The SMF+PGW-C may receive PCC
Rules and PDU Session Policy Information, 5G QoS information in the PCC Rule
and in PDU Session Policy Information are mapped into EPS QoS information as
defined in clause 4.11.1.1 and Annex C.
\- (PCEF-initiated) IP-CAN Session Modification procedure defined in TS 23.203
[24] is replaced by SM Policy Association Modification procedure as described
in clause 4.16.5.1. The Policy Control Request Triggers are specified in
clause 6.1.3.5 of TS 23.503 [20].
\- The SMF+PGW-C includes the QoS related information elements received in
Modify Bearer Request or Modify Bearer Command message into the
Npcf_SMPolicyControl_Update Service with the following modifications, the
subscribed Session AMBR includes the subscribed APN-AMBR and subscribed
default QoS information includes the default EPS bearer QoS, note that QCI
values are mapped into 5QI values. The SMF+PGW-C may receive PCC Rules and PDU
Session Policy Information, 5G QoS information in the PCC Rule and in PDU
Session Policy Information are mapped into EPS QoS information as defined in
clause 4.11.1.1 and Annex C.
\- The SMF+PGW-C includes the location related information received in Modify
Bearer Request (as specified in clause 5.9.2 of TS 23.401 [13]) into
Npcf_SMPolicyControl_Update if the corresponding Policy Control Request
Triggers (i.e. Location change, Change of UE presence in Presence Reporting
Area) are provisioned.
\- The SMF+PGW-C includes the information elements received in Delete Bearer
Command message into the Npcf_SMPolicyControl_Update Service.
\- (PCRF-initiated) IP-CAN Session Modification procedure defined in TS 23.203
[24] is replaced by SM Policy Association Modification procedure as described
in clause 4.16.5.2. The SMF+PGW-C may receive PCC Rules and PDU Session Policy
Information, 5G QoS information in the PCC Rule and in PDU Session Policy
Information are mapped into EPS QoS information as defined in clause 4.11.1.1
and Annex C.
\- IP-CAN Session Termination procedure defined in TS 23.203 [24] is replaced
by SM Policy Association Termination procedure as described in clause 4.16.6.
The SMF+PGW-C includes the information elements received in Delete Session
Request message by the SMF+PGW-C into the Npcf_SMPolicyControl_Delete Service.
URSP provisioning may be supported in EPS and the procedures are specified in
clause 4.11.0a.2a.
#### 4.11.0a.2a Interaction with PCC for URSP delivery via EPS
##### 4.11.0a.2a.0 General
To Support URSP provisioning in EPS, the SMF+PGW-C receives the Indication of
URSP Provisioning Support in EPS PCO and ePCO support indication from the UE,
if the SMF+PGW-C also supports URSP Provisioning Support in EPS and ePCO, it
selects a PCF which also supports URSP Provisioning in EPS to establish the SM
Policy Association based on the received Indication of URSP Provisioning
Support in EPS PCO and local configuration.
When the SMF+PGW-C receives the UE Policy Container ePCO in Bearer Resource
Command during UE requested bearer resource modification procedure, it
forwards transparently the UE Policy Container to PCF for the PDU Session in
the Npcf_SMPolicyControl_Update Request including indication that \"UE Policy
Container received\" PCRT was met. When the PCF for Session Management
receives UE Policy Container from PCF for the UE, it forwards the UE Policy
Container to SMF+PGW-C in Npcf_SMPolicyControl_UpdateNotify Request. The PCF
for the PDU Session retrieves the PCRTs for UE Policy from PCF for the UE and
subscribe to the applicable PCRTs in EPC to SMF+PGW-C.
When URSP Provisioning is supported in EPS, the PCF for the PDU Session may
establish the UE Policy Association with PCF for the UE:
\- During EPS initial attach with default PDN connection establishment
procedure or during the first request for PDN connectivity in EPS for a UE
when the first UE Policy Container is received from the UE for an SM Policy
association and forwards the UE Policy Container to PCF for the UE in
Npcf_UEPolicyControl_Create Request.
\- During 5GS to EPS mobility with N26 when the SMF+PGW-C notifies the PCF for
the PDU Session about a RAT-Type change via Npcf_SMPolicyControl_Update.
The PCF for the UE generates the URSP and sends it to the PCF for the PDU
Session in the UE Policy Container via Npcf_UEPolicyControl_UpdateNotify
Request. The PCF for the UE triggers the re-evaluation of applicable URSPs and
determines an update of URSP is needed for the UE when an event as described
in clause 6.1.2.2.3 of TS 23.503 [20] occurs in the PCF for the PDU Session.
The procedures for the UE Policy association defined in clauses 4.16.11,
4.16.12 and 4.16.13 apply in general in EPS with the main differences below:
\- AMF is replaced by the PCF for the PDU Session.
\- Delivery of UE Policy Containers from the PCF for the UE to the PCF for the
PDU Session is done via Npcf_UEPolicyControl service instead of via UE
Configuration Update procedure.
URSP delivery via EPS is supported in roaming scenarios, both for a PDN
connection established in Home Routed and for a PDN connection established in
LBO.
This clause captures the enhancement to the interaction with PCC in clause
4.11.0a.2 to support URSP delivery via EPS.
##### 4.11.0a.2a.1
##### 4.11.0a.2a.2 SMF initiated SM Policy Association Modification
##### 4.11.0a.2a.2.1 PDN connection establishment in EPS {#a.2a.2.1-pdn-
connection-establishment-in-eps .H6}
The following enhancements are applicable to clause 4.16.5.1 (SM Policy
Association Modification procedure):
In addition to step 4 in clause 4.16.5.1 if the PCF receives both the
indication that the PCRT \"UE Policy Container received\" was met and the UE
Policy Container, steps 4a to 4d below are executed; otherwise step 5 in
clause 4.16.5.1 is executed.
\- Step 4a: The PCF determines that the SM Policy Association is used to
provision URSP rules to the UE by checking the UE Policy Container received
from SMF+PGW-C in Npcf_SMPolicyControl_Update Request.
NOTE: If the PCF for the PDU Session is the same than the PCF for the UE the
interactions in steps 4b-4d are internal to PCF.
\- Step 4b: The PCF for the PDU Session discovers the PCF for the UE by
querying the BSF and using the SUPI received in Npcf_SMPolicyControl_Create
Request as described. If no result is obtained from the BSF the PCF for the
PDU Session selects the PCF for the UE by querying NRF.
\- Step 4c: The PCF for the PDU Session establishes a UE Policy Association
towards the PCF for the UE as described in clause 4.11.0a.2a.5.
\- Step 4d: If the PCF for the UE provides any Policy Control Request Trigger
parameters in the Npcf_UEPolicyControl Create Response the PCF for the PDU
Session takes them into account for the generation of Policy Control Request
Triggers to the SMF+PGW-C.
##### 4.11.0a.2a.2.2 5GS to EPS mobility {#a.2a.2.2-5gs-to-eps-mobility .H6}
During 5GS to EPS mobility procedure, the PCF for the PDU Session determines
whether to establish a UE Policy Association towards the PCF for the UE for
the purpose of delivery of URSP in EPS. During EPS to 5GS mobility procedure
the PCF for the PDU Session terminates the UE policy association if
established during 5GS to EPS mobility.
The following enhancements are applicable to clause 4.16.5.1 (SMF initiated SM
Policy Association Modification procedure):
In addition to step 4 in clause 4.16.5.1, the PCF determines that 5GS to EPS
or EPS to 5GS mobility applies by checking a change in RAT and Access-Type. If
5GS to EPS mobility applies steps 4a to 4d below are executed; if EPS to 5GS
applies the PCF for the PDU Session checks if a UE Policy association was
created during 5GS to EPS mobility and in that case, it requests the
termination of the UE Policy association as described in clause 4.11.0a.2a.8;
otherwise step 5 in clause 4.16.5.1 is executed.
\- Step 4a: For non-roaming and Home Routed roaming the (H-)PCF for the PDU
Session determines whether the UE supports provisioning of URSP Rules in EPC
by checking the indication that is stored within the UE context Policy
Subscription data in UDR. If the UE supports provisioning of URSP Rules in EPC
the flow continues in step 4b.
For LBO roaming the V-PCF for the PDU Session has no access to UDR and it is
not able to determine whether the UE supports provisioning of URSP rules in
EPC. In this case it determines based on local configuration whether to
establish a UE Policy association towards the V-PCF for the UE.
NOTE: If the PCF for the PDU Session is the same than the PCF for the UE the
interactions in steps 4b-4d are internals to PCF.
\- Step 4b: For the non-roaming and Home Routed roaming the (H-)PCF for the
PDU Session discovers the PCF for the UE by querying the BSF using the SUPI of
the UE as described in clause 6.3.7.4 of TS 23.501 [2].
For LBO roaming the V-PCF for the PDU Session discovers and selects an
instance of the V-PCF for the UE based on the available PCF instances obtained
from the NRF or locally configured information in the V-PCF, depending on
operator\'s policies, as described in clause 6.3.7.1 of TS 23.501 [2].
\- Step 4c: The PCF for the PDU Session establishes a UE Policy Association
towards the PCF for the UE as described in clause 4.11.0a.2a.5. This request
includes an indication about the trigger for the UE Policy Association
Establishment (\"5GS to EPS Mobility\").
\- Step 4d: If the PCF for the UE provides any Policy Control Request Trigger
parameters in the Npcf_UEPolicyControl Create Response the PCF for the PDU
Session takes them into account for the generation of Policy Control Request
Triggers to the SMF+PGW-C in Npcf_SMPolicyControl_Update answer.
##### 4.11.0a.2a.2.3 UE reports URSP update {#a.2a.2.3-ue-reports-ursp-update
.H6}
When the UE reports the result of a URSP update the following enhancements are
applicable to clause 4.16.5.1 (SM Policy Association Modification procedure):
In addition to step 4 in clause 4.16.5.1 if the PCF for the PDU Session
receives the \"UE Policy\" Policy Control Request Trigger and associated UE
Policy Container, steps 4a to 4b below are executed; otherwise step 5 in
clause 4.16.5.1 is executed.
\- Step 4a: The PCF for the PDU Session determines that a UE Policy
association has been already established towards the PCF for the UE for the SM
Policy Association as described in clause 4.11.0a.2a.2.1.
NOTE: If the PCF for the PDU Session is the same than the PCF for the UE the
interactions in steps 4b is internal to PCF.
\- Step 4b: The PCF for the PDU Session forwards the UE Policy Container to
the PCF for the UE in Npcf_UEPolicyControl_Update Request.
##### 4.11.0a.2a.3 PCF initiated SM Policy Association Modification
For the purpose of URSP delivery in EPC a new condition to initiate the SM
Policy Association Modification procedure is added triggered by an interaction
from the PCF for the UE. This interaction applies when the PCF for the PDU
Session has previously established a UE Policy Association towards the PCF for
the UE for the delivery of URSP Rules in EPS as defined in clauses 4.11.0a.5
and 4.11.0a.2a.2.
The following enhancements are applicable to clause 4.16.5.2 (PCF initiated SM
Policy Association Modification procedure):
NOTE: If the PCF for the PDU Session is the same than the PCF for the UE the
interactions in steps below are internals to PCF.
\- Step 1e: Alternatively, the PCF for the UE provides a UE Policy Container
and/or an update in the Policy Control Request Triggers applicable to the UE
by invoking Npcf_UEPolicyControl_UpdateNotify as described in clause
4.16.12.2, steps 3-4.
\- Step 4: If the PCF for the PDU Session receives a UE Policy Container from
the PCF for the UE the PCF for the PDU Session first selects one of the
ongoing PDU Sessions for the related UE in EPC and includes that UE Policy
Container in Npcf_SMPolicyControl_update notify request for that PDN
connection.
If the PCF for the PDU Session receives an update in the Policy Control
Request Triggers applicable to the UE the PCF for the PDU Session determines
whether an update on the current Policy Control Request Triggers needs to be
sent to the SMF+PGW-C in Npcf_SMPolicyControl_UpdateNotify request.
##### 4.11.0a.2a.4
##### 4.11.0a.2a.5 UE Policy Association establishment
To support the delivery of URSP in EPC as described in clause 6.1.2.2.3 of TS
23.503 [20], the PCF for the PDU Session may establish a UE Policy Association
towards the PCF for the UE.
This procedure may be triggered by the following procedures:
1\. Initial Attach to EPC.
2\. PDN Connectivity Request during the first request for PDN connectivity.
3\. 5GS to EPS handover or 5GS to EPS Idle Mode mobility.
Figure 4.11.0a.2a.5-1: UE Policy Association establishment procedure
In the non-roaming case, the V-PCF for the UE is not involved, and the PCF for
the PDU Session interacts with the PCF for the UE. For the Home Routed roaming
scenarios the V-PCF for the UE is not involved and the H-PCF for the PDU
Session interacts with the H-PCF for the UE. For the LBO roaming scenarios,
the V-PCF for the PDU Session interacts with the V-PCF for the UE and the
V-PCF for the UE interacts with the H-PCF for the UE:
The procedure is based on the one defined in clause 4.16.11 for a UE in 5GC
with the following differences:
The PCF for the PDU Session determines the need of establishment of a UE
Policy Association when:
\- A UE Policy Container is received from the UE during SM Policy Association
Update at Initial Attach with default PDN connection establishment to EPC or
at first PDN Connectivity Request as described in clause 4.11.0a.2a.2.1; or
\- During 5GS to EPS mobility as described in clause 4.11.0a.2a.2.2.
2\. Same as step 2 in clause 4.16.11, with the following exceptions:
The PCF for the PDU Session includes the UE Policy Container in case of SM
Policy Association update or 5GS to EPS Mobility indication in case of SM
Policy Association update at 5GS to EPS mobility.
For LBO roaming the V-PCF for the PDU Session discovers and selects an
instance of the V-PCF for the UE based on the available PCF instances obtained
from the NRF or locally configured information in the V-PCF, depending on
operator\'s policies, as described in clause 6.3.7.1 of TS 23.501 [2]. The
V-PCF for the PDU Session contacts the V-PCF for the UE and steps 3 and 4 are
executed.
For non-roaming or Home Routed roaming the (H-)PCF for the PDU Session
contacts the (H-)PCF for the UE and step5 follows.
3\. Same as step 3 in clause 4.16.11, with the following exceptions:
The UE Policy Container is received at SM Policy Association instead of
initial registration. When the UE Policy Association is being established due
to 5GS to EPS mobility as described in clause 4.11.0a.2a.2.2, the V-PCF for a
UE in the VPLMN needs to discover and select the same H-PCF for a UE that is
serving the UE in the H-PLMN for 5GS by querying the BSF in the HPLMN. This is
to be able to recover the information about the list of PSIs in the UE and the
subscribed PCRTs from former UE Policy Association for the UE in 5GS as
described in step 6. Therefore, the V-PCF for a UE in the VPLMN needs first to
discover the BSF in the HPLMN.
NOTE 1: For Home Routed roaming, the V-PCF for a UE is not involved, therefore
in this roaming scenario it is not possible to retrieve the Application
guidance on URSP Rule for inbound roamers of the PLMN and provide it to the
H-PCF for the UE to be used as input for the generation of the URSP rules for
the UE as described in clause 6.6.2.2.3 of TS 23.503 [20].
4\. Same as in clause 4.16.11.
5\. Same than in clause 4.16.11 step 5, with the following exceptions:
The subscription to notification of N1 message delivery of policy information
to the UE using Namf_Communication_N1N2MessageSubscribe service is not
applicable.
6\. The Same as step 6 in clause 4.16.11, with the following exceptions:
If \"5GS to EPS Mobility indication was received in
Npcf_UEPolicyControl_Create in step 2 instead, the (H-)PCF recovers the
information about the list of PSIs in the UE,the subscribed PCRTs in 5GS from
former UE Policy Association for the UE and the indication about the support
of provisioning of URSP rules in EPC. If the UE doesn\'t support the
provisioning of URSPs in EPS, the H-PCF rejects the establishment of the UE
Policy Association.
NOTE 2: In LBO roaming the V-PCF for a UE may trigger the establishment of the
UE Policy Association for a UE that doesn\'t support the provisioning of URSP
in EPS, as described in step 4a in clause 4.11.0a.2a.2.2.
The (H-)PCF provides the UE Policy Container in the Npcf_UEPolicyControl
UpdateNotify Request.
7\. Same as in clause 4.16.11.
NOTE 3: Steps 8 and 9 are executed only in LBO roaming.
8\. The V-PCF for the UE forwards the UE Policy Container to the V-PCF for the
PDU Session by invoking Npcf_UEPolicyControl UpdateNotify Request. The V-PCF
for the UE checks the size limit as described in clause 6.1.2.2.2 of TS 23.503
[20].
9\. The V-PCF for the PDU Session sends a response to the V-PCF for the UE.
10\. If the UE provides a UE Policy Container with the result of the URSP
update to the PCF for the PDU Session as described in clause 4.11.0a.2a.2.3
the PCF for the PDU Session forwards the UE Policy Container to the (V-) PCF
for the UE invoking Npcf_UEPolicyControl_Update Request.
11\. The (V-) PCF for the UE sends a response to the (V-) PCF for the PDU
Session.
NOTE 4: Steps 12 and 13 are executed only in LBO roaming.
12\. The V-PCF for the UE forwards the notification response to the H-PCF by
invoking Npcf_UEPolicyControl_Update Request.
13\. The H-PCF sends a response to the V-PCF for the UE.
##### 4.11.0a.2a.6 UE Policy Association Modification initiated by the PCF for
the UE
The following impacts are applicable to clause 4.16.12.2 (UE Policy
Association Modification initiated by the PCF procedure):
In the non-roaming case, the V-PCF is not involved, the AMF is replaced by the
PCF for the PDU Session, and the role of the H-PCF is performed by the PCF for
the UE.
For the Home Routed roaming scenarios, the V-PCF is not involved, the AMF is
replaced by the H-PCF for the PDU Session, and the role of the H-PCF is
performed by the H-PCF for the UE.
For the LBO roaming scenarios, the AMF is replaced by the V-PCF for the PDU
Session, the role of the V-PCF is performed by the V-PCF for the UE and the
role of the H-PCF is performed by the H-PCF for the UE.
\- Steps 1a, 1c, 2a, 2c and 2d: These steps are not applicable for Home Routed
roaming, since the V-PCF is not involved.
\- Step 3: The (H-)PCF may create the UE policy container including UE policy
information as defined in clause 6.1.2.2.2 of TS 23.503 [20]. The (H-) PCF
checks whether the UE Policy Association for the UE is established for a UE in
EPC by checking the RAT-Type of the UE Policy Association and in this case the
(H-)PCF may send the UE Policy Container in the Npcf_UEPolicyControl
UpdateNotify Request. The (H-)PCF may provide updated PCRTs the UE policy
association.
For Home Routed roaming, the V-PCF for a UE is not involved, therefore the
Service Parameters provided by the AF from the VPLMN are not used by the H-PCF
as input for the generation of the URSP rules.
NOTE: Steps 5 and 6 are executed only in LBO roaming.
\- Step 5: In case the UE Policy Association is for a UE in EPC, the (V-) PCF
for the UE provides the UE Policy Container and/or policy control triggers to
the (V-) PCF for the PDU Session.
\- Step 6: The (V-) PCF for the PDU session sends a response to the (V-) PCF
for the UE.
\- Steps 7, 8 and 9 are replaced by steps 10-13 of procedure UE Policy
Association Establishment in EPC from clause 4.11.0a.2a.5.
##### 4.11.0a.2a.7 UE Policy Association Modification initiated by the PCF for
a PDU Session
This procedure addresses the scenario where a Policy Control Request Trigger
condition is met by the PCF for a PDU Session.
The procedure is based on the one defined in clause 4.16.12.1.1 with the
following differences:
In the non-roaming case, the V-PCF is not involved, the AMF is replaced by the
PCF for the PDU Session, and the role of the H-PCF is performed by the PCF for
the UE.
For the Home Routed roaming scenarios, the V-PCF is not involved, the AMF is
replaced by the H-PCF for the PDU Session, and the role of the H-PCF is
performed by the H-PCF for the UE.
For the LBO roaming scenarios, the AMF is replaced by the V-PCF for the PDU
Session, the role of the V-PCF is performed by the V-PCF for the UE and the
role of the H-PCF is performed by the H-PCF for the UE.
\- Step 1: Same than in clause 4.16.12.1.1 step 1, with the following
exceptions:
In LBO roaming the V-PCF for the PDU Session contacts the V-PCF for the UE and
steps 2 and 3 are executed. The V-PCF for the UE contacts with the H-PCF for
the UE discovered during the establishment of the UE Policy association as
described in clause 4.11.0a.2a.5.
For non-roaming or Home Routed roaming the (H-)PCF for the PDU Session
contacts the (H-)PCF for the UE and step 4 follows.
\- Steps 2, 3,4: Same as in clause 4.16.12.1.1.
\- Step 5: The (H-)PCF may create the UE policy container including UE policy
information as defined in clause 6.6 of TS 23.503 [20]. The (H-) PCF checks
whether the UE Policy Association for the UE is established for a UE in EPC by
checking the RAT-Type of the UE Policy Association and in this case the
(H-)PCF may send the UE Policy Container in the Npcf_UEPolicyControl
UpdateNotify Request.
\- Step 6: Same as in clause 4.16.12.1.1.
\- Steps 7, 8 and 9 are replaced by steps 10-13 of procedure UE Policy
Association Establishment in EPC from clause 4.11.0a.2a.5.
##### 4.11.0a.2a.8 UE Policy Association Termination initiated by PCF for PDU
session
The following case is considered for UE Policy Association Termination:
1\. UE Detach from the EPS.
2\. PDN connection for UE which is used for delivery of UE Policy Container in
EPS is released.
3\. Changing of RAT type from EPS to 5GS, notified by SMF+P-GW-C.
Figure 4.11.0a.2a.8-1: UE Policy Association termination in EPS
This procedure applies for non-roaming scenarios, LBO roaming scenarios and
Home Routed roaming scenario.
In the non-roaming case, the V-PCF for the UE is not involved, the role of the
V-PCF for the PDU session is performed by the PCF for the PDU session and the
role of the H-PCF for the UE is performed by the PCF for the UE. For the LBO
roaming scenarios, the V-PCF for the PDU session interacts with the V-PCF for
the UE and the V-PCF for the UE interacts with the H-PCF for the UE.
In the Home Routed roaming scenario, the V-PCF for the UE is not involved, the
role of the V-PCF for the PDU session is performed by the PCF for the PDU
session in HPLMN and the role of the H-PCF for the UE is performed by the PCF
for the UE in HPLMN.
1\. The (V-)PCF for the PDU session terminates a UE Policy Association with
the (V-)PCF for the UE when:
\- The SMF+P-GW-C notifies the changing of RAT type from EPS to 5GS; or
\- The SMF+P-GW-C terminates the SM policy association with (V-)PCF for the
PDU session due to UE detached from EPS or the PDN connection for UE which is
used for delivery of UE Policy Container in EPS is released.
2\. Same as in clause 4.16.13.1 step 2, replace the AMF to (V-)PCF for the PDU
session.
3\. Same as in clause 4.16.13.1 step 3.
4\. Same as in clause 4.16.13.1 step 4.
5\. Same as in clause 4.16.13.1 step 5.
##### 4.11.0a.2a.9 UE Policy Association termination initiated by the PCF for
a PDU Session
The procedure is based on the one defined in clause 4.16.13.2 (UE Policy
Association Termination initiated by the PCF procedure) with the following
differences:
The following cases are considered for UE Policy Association Termination:
1\. PDN Connection termination.
2\. EPS to 5GS mobility with N26.
This procedure applies for non-roaming scenarios, LBO roaming scenarios and
Home Routed roaming scenario.
In the non-roaming case, the V-PCF is not involved, the AMF is replaced by the
PCF for the PDU Session, and the role of the H-PCF is performed by the PCF for
the UE.
For the LBO roaming scenarios, the AMF is replaced by the V-PCF for the PDU
Session, the role of the V-PCF is performed by the V-PCF for the UE.
In the Home Routed roaming scenario, the V-PCF is not involved. The AMF is
replaced by the PCF for PDU Session in HPLMN, and the role of the H-PCF for
the UE is performed by the PCF for the UE in HPLMN.
NOTE: For both non-roaming and LBO roaming, If the (V-)PCF for the PDU Session
is the same than the\ (V-) PCF for the UE, all the interactions between both
happens internally in the (V-)PCF.
When the UE is in EPC the UE Policy Association has been established by the
(V-) PCF for PDU Session as described in clause 4.11.0a.2a.6.
\- Step 4: Change the AMF to the PCF for PDU Session. The PCF for UE may
notify the PCF for PDU Session of the removal of the UE Policy Association via
Npcf_UEPolicyControl_UpdateNotify service operation.
\- Step 5: Change the AMF to the PCF for PDU Session.
\- Step 6: Change AMF to the PCF for PDU Session and refer to the step 2 to
step 5 in clause 4.11.0a.2a.8.
#### 4.11.0a.3 Mobility Restrictions
The UE\'s subscription may include access restriction for NR in 5GS and
restriction for Core Network Type (5GC). If so, the HSS provides these
restrictions to the MME. The MME includes these restrictions in the Handover
Restriction List to the E-UTRAN. The MME and E-UTRAN use these restrictions to
determine if mobility of the UE to 5GS or NR connected to 5GS should be
permitted.
#### 4.11.0a.4 PGW Selection
When the UE requests to establish a non-emergency PDN connection to an APN,
the MME may use the UE\'s support for 5GC NAS indication included in the UE
Network Capability and/or UE\'s subscription from HSS that includes UE\'s
mobility restriction parameters related to 5GS and/or indication of support
for interworking with 5GS for this APN to determine if SMF+PGW-C or a
standalone PGW-C should be selected. If both PGW-C and SMF+PGW-C is available,
then MME may select SMF+PGW-C when UE\'s subscription from HSS indicate
support for interworking with 5GS for the APN.
NOTE: If restriction for Core Network Type indicates that the UE can access to
5GC, it implies that the UE has 5G subscription data.
When the UE performs emergency attach or requests to establish an emergency
PDN connection, the MME may use the UE\'s support for 5GC NAS indication
included in the UE Network Capability and/or local configuration to determine
if an emergency SMF+PGW-C or a standalone emergency PGW-C should be selected.
An emergency SMF+PGW-C needs to be configured in Emergency Configuration Data
in the MME if it is to be selected.
To enable a differentiation of the emergency gateway based on UEÂ´s support of
5GC NAS, the Emergency Configuration Data in the MME defined in TS 23.401 [13]
is extended with the IE listed in Table 4.11.0a.4-1.
Table 4.11.0a.4-1: MME Emergency Configuration Data Extensions
Field Description
* * *
Emergency SMF+PGW-C identity The statically configured identity of a combined
SMF+PGW-C used for emergency APN. The SMF+PGW-C identity may be either an FQDN
or an IP address. (NOTE) NOTE: The FQDN always resolves to one SMF+PGW-C.
#### 4.11.0a.5 PDN Connection Establishment
During establishment of non-emergency PDN connection in the EPC, the UE and
the SMF+PGW-C exchange information via PCO as described in clause 5.15.7 of TS
23.501 [2]. For UE with 5GC NAS capability disabled (i.e. N1 mode is
disabled), the UE may also allocate a PDU Session ID and send it to the
SMF+PGW-C via PCO. If the SMF+PGW-C supports more than one S-NSSAI and the APN
is valid for more than one S-NSSAI, before the SMF+PGW-C provides an S-NSSAI
to the UE, the SMF+PGW-C should check such that the selected S-NSSAI is among
the UE\'s subscribed S-NSSAIs and that the S-NSSAI is not subject to Network
Slice-Specific Authentication and Authorization, by retrieving the Subscribed
S-NSSAI from UDM using the Nudm_SDM_Get service operation (the SMF+PGW-C
discovers and selects a UDM as described in clause 6.3.8 of TS 23.501 [2]). If
the SMF+PGW-C is in a VPLMN, the SMF+PGW-C uses the Nnssf_NSSelection_Get
service operation to retrieve a mapping of the Subscribed S-NSSAIs to Serving
PLMN S-NSSAI values. If the S-NSSAIs supported by the SMF+PGW-C are all
subject to NSSAA, then the SMF+PGW-C should reject the PDN connection
establishment. If the selected S-NSSAI is subject to NSAC and EPS counting is
required for the S-NSSAI, the SMF+PGW-C uses the Nnsacf_NSAC_NumberOfUEsUpdate
services operation and/or the Nnsacf_NSAC_NumberOfPDUsUpdate services
operation to check if the selected S-NSSAI is available as described in clause
4.11.5.9. The SMF+PGW-C uses the Nudm_SDM_Subscribe service operation to
subscribe the change of the Session Management Subscription data. If the
SMF+PGW-C is notified from UDM with subscription data change, the SMF+ PGW-C
takes actions for the PDN connection as described in clause 5.17.2.1 of TS
23.501 [2].
As described in TS 23.548 [74], during establishment of a PDN connection, a UE
that hosts EEC(s) may indicate to the SMF+PGW-C, in the PCO, that it supports
the ability to receive ECS address(es) via NAS and to transfer the ECS
Address(es) to the EEC(s). If the UE indicated in the PCO that it supports the
ability to receive ECS address(es) via NAS, the SMF+PGW-C may provide the ECS
Address Configuration Information (as described in clause 6.5.2 of TS 23.548
[74]) to the UE in the PCO. The SMF+PGW-C may derive the Edge Configuration
Server Information based on local configuration, the UE\'s location and/or UE
subscription information.
The SMF+PGW-C may use the bearer modification procedure without bearer QoS
update to send the UE a PCO with updated ECS Address Configuration Information
as defined in clause 6.5.2 of TS 23.548 [74] to the UE.
During establishment of non-emergency PDN connection in the EPC, if PGW-C+SMF
is selected for a UE that has 5GS subscription, the SMF may be configured to
obtain the subscribed IP index from UDM as part of subscription data using the
Nudm_SDM_Get service operation (the PGW-C+SMF discovers and selects a UDM as
described in clause 6.3.8 of TS 23.501 [2]).
During establishment of non-emergency PDN connection in EPC, if PGW-C+SMF is
selected for a UE that has 5GS subscription, the SMF may be configured to
obtain the subscribed User Plane Security Policy from UDM as part of
subscription data using the Nudm_SDM_Get service operation (the PGW-C+SMF
discovers and selects a UDM as described in clause 6.3.8 of TS 23.501 [2]).
The SMF uses the subscribed User Plane Security Policy as described in clause
5.10.3 of TS 23.501 [2].
During establishment of non-emergency PDN connection in the EPC, if SMF+PGW-C
is selected for a UE that has 5GS subscription but does not support 5GC NAS
and is accessing via EPC/E-UTRAN and if the SMF+PGW-C supports more than one
S-NSSAI and the APN is valid for more than one S-NSSAI, the SMF+PGW-C+PGW-C
may proceed as specified in first paragraph of this clause or select any
S-NSSAI associated with the APN of the PDN connection. The SMF+PGW-C shall not
provide any 5GS related parameters to the UE.
NOTE 1: The SMF+PGW-C knows that the UE does not support 5GS NAS if the UE
does not provide PDU Session ID in PCO (see clause 5.15.7 of TS 23.501 [2]).
During establishment of emergency PDN connection:
\- The SMF+PGW-C is to be derived from the emergency APN or to be statically
configured in the Emergency Configuration Data in MME.
\- 5GC interworking support with N26 or without N26 is determined based on
UE\'s 5G NAS capability and local configuration (in the Emergency
Configuration Data in MME).
\- The S-NSSAI configured for the emergency APN in SMF+PGW-C is not sent to
the UE by the SMF+PGW-C. One S-NSSAI is configured for the emergency APN.
During establishment of non-emergency PDN connection and emergency PDN
connection, if SMF+PGW-C is selected for a UE that does not support 5GC NAS,
the SMF+PGW-C creates unique PDU Session ID for each PDN connection of the UE.
\- The unique PDU Session ID can be created based on the EPS Bearer IDs
assigned by the MME for the PDN Connections associated with the UE and not be
in the range of PDU Session ID values that can be created by a 5GC NAS capable
UE.
\- If handover between EPS and EPC/ePDG (as specified in clause 8.6 of TS
23.402 [26]) is required, the SMF+PGW-C, based on operator configuration, may
perform the following to ensure the uniqueness of PDU Session ID:
\- the SMF+PGW-C queries the UDM for any PDU Session ID(s) that are already
registered in the UDM for the UE by invoking Nudm_UECM_Get service operation.
\- the SMF+PGW-C creates a PDU session ID that does not collide with the
received PDU session ID(s).
\- When the SMF+PGW-C establishes the PDN connection successfully, the
SMF+PGW-C performs UDM registration using the Nudm_UECM_Registration service
operation.
NOTE 2: If the scenario that a UE handovers a PDN connection with APN1
established via MME to ePDG and then establishes a second PDN connection with
APN2 via MME needs to be supported in a given deployment, then, based on
operator configuration, the SMF+PGW-C can query the UDM to avoid that the same
PDU Session ID value of first PDN connection would be assigned by the
SMF+PGW-C for the second PDN connection.
When the SMF+PGW-C establishes the PDN connection successfully, the SMF+PGW-C
provides the ID of the PCF ID selected for the PDN connection in the UDM using
the Nudm_UECM_Registration service operation.
A SMF+PGW-C may support L2TP as described in clause 4.3.2.4. In this case step
1 and step 7 of Figure 4.3.2.4â€‘1 correspond to a PDN Connection establishment
and a SMF+PGW-C replaces the SMF in that Figure.
To support User Plane Integrity Protection with EPS and policies that Require
User Plane integrity protection to be used, at PDN connection establishment,
the MME shall indicate to the SMF+PGW-C (via the Serving GW) whether the UE,
the current eNB and the MME support User Plane Integrity Protection in EPS. If
the MME and the UE support User Plane Integrity Protection, then the SMF+PGW-C
informs the MME of the User Plane integrity protection policy (Required,
Preferred, Not Needed) applicable to the PDN connection on a per-EPS bearer
basis. In turn, the MME informs the eNB.
To support URSP Provisioning in EPS, during Initial Attach with default PDN
connection establishment procedure in EPS, the UE provides the Indication of
URSP Provisioning Support in EPS PCO in the PDN connectivity request to
SMF+PGW-C. If the SMF+PGW-C supports URSP Provisioning in EPS and ePCO
capability, it provides the Indication of URSP Provisioning Support in EPS PCO
in the Create Session Response. If the UE receives the Indication of URSP
Provisioning Support in EPS PCO from SMF+PGW-C in the PDN Connectivity Accept
message, the UE initiates the UE requested bearer resource modification
procedure and includes the UE Policy Container ePCO in the Request Bearer
Resource Modification message. If the default PDN connection is not
established during Initial Attach procedure, the aforemetioned procedure
happens during the first request for PDN connectivity. When the PCF for the
PDU Session receives the UE Policy Container ePCO from the PCF for the UE, it
forwards the UE Policy Container ePCO to SMF/PGW-C in
Npcf_SMPolicyControl_updateNotifyreq, then it is forwarded to UE in the Update
Bearer Request by SMF/PGW-C.
#### 4.11.0a.6 Network Configuration
To avoid the need for identifier coordination between MMEs, AMFs and SGSNs,
the MME provides to the eNB its served GUMMEIs by separating the values
between native MME GUMMEI values, values mapped from AMF and values mapped
from SGSN.
#### 4.11.0a.7 Interactions with DN-AAA Server
EAP-based secondary authentication and authorization at PDU Session
establishment is supported as defined in clause 4.3.2.3. EAP-based secondary
authentication and authorization at PDN connection establishment is supported
as defined in Annex H.
This clause 4.11.0a.7 defines the support of secondary authorization over EPS
without EAP-based authentication when one of the UE, the 5GC and the DN does
not support (or is configured not to use) the mechanisms defined in Annex H.
NOTE 1: This implies that when data connectivity to the DN is initiated as a
PDU Session over 5GC it can be subject to EAP based secondary authentication
mechanism (see TS 33.501 [15]) whereas, when data connectivity to the same DN
is initiated as a PDN connection over EPC it cannot be subject to EAP based
secondary authentication mechanism. This discrepancy occurs regardless of
whether the data connection is later on moved between EPC and 5GC.
NOTE 2: Secondary authorization without authentication means no signalling
exchange with the UE.
If secondary authentication and authorization has been performed for the PDU
Session while the UE was in 5GS and the UE has moved to EPS, the following
applies:
\- DN-AAA re-authorization (without re-authentication signalling) can be
performed even when the UE is in EPS, e.g. to provide new parameters from the
DN-AAA Server to SMF+PGW-C.
\- Re-authentication cannot be performed while the UE is in EPS because there
is no support of the related signalling in EPS. In case the SMF+PGW-C receives
a re-authentication request from the DN-AAA, the SMF+PGW-C informs the DN-AAA
Server that the UE is not available for re-authentication at the moment. The
SMF+PGW-C should not initiate PDN connection release at this point: the DN-AAA
decides the actions to take, based on the reply from SMF+PGW-C and local
policy which may also trigger a DN-AAA Server request to release the PDU
Session/PDN connection of the UE.
#### 4.11.0a.8 5GC NAS capability (re-)enabled and disabled
When 5G NAS (i.e. N1 mode) capability is (re-)enabled, the UE triggers
Tracking Area Update procedure as specified in clause 5.3.3.0 of TS 23.401
[13].
If the MME determines that interworking with 5GS is changed to Supported and
if the MME has selected a standalone PGW, the MME may initiate PDN
disconnection with reactivation required as specified in clause 5.10.3 of TS
23.401 [13] at the end of the tracking area update procedure.
NOTE 1: MME requesting PDN disconnection with reactivation required is to
allow MME to select a SMF+PGW-C so that session continuity can be achieved
when UE moves to 5GS.
If a UE disables its support of N1 mode and moves from 5GS to EPS, the UE and
the SMF+PGW-C maintain the mapped 5GS parameters for PDU session(s) that are
transferred to EPS.
NOTE 2: The mapped 5GS parameters are used when the UE re-enables N1 mode and
moves back to 5GS.
#### 4.11.0a.9 PDN Connection Release
If the SMF+PGW-C has registered with the UDM, the SMF+PGW-C shall deregister
with UDM (using Nudm_UECM_Deregistration) during the PDN Connection Release
procedure.
NOTE: SMF+PGW-C registration in the UDM is specified in clause 4.11.0a.5 or
clause 4.3.2.
### 4.11.1 N26 based Interworking Procedures
#### 4.11.1.1 General
N26 interface is used to provide seamless session continuity for single
registration mode UE.
Interworking between EPS and 5GS is supported with IP address preservation by
assuming SSC mode 1.
When the UE is served by the 5GC, during PDU Session establishment and GBR QoS
Flow establishment, SMF+PGW-C performs EPS QoS mappings, from the 5G QoS
parameters obtained from the PCF and allocates TFT with the PCC rules obtained
from the PCF if PCC is deployed. Otherwise, EPS QoS mappings and TFT
allocation are mapped by the SMF+PGW-C locally. The PGW+SMF ignores 5G QoS
parameters that are not applicable to EPC (e.g. QoS Notification control). If
a TFT is to be allocated for a downlink unidirectional EPS bearer mapped from
a downlink only QoS Flow, the SMF+PGW-C shall allocate a TFT packet filter
that effectively disallows any useful uplink packet as specified in TS 23.401
[13]. EPS Bearer IDs are allocated by the serving AMF requested by the SMF if
the SMF determines that EPS Bearer IDs need to be assigned to the QoS Flows.
For each PDU Session, EPS bearer IDs are allocated to the default EPS bearer
and dedicated bearers. The SMF shall be able to determine the QoS flows that
require EPS Bearer IDs, based on the QoS profile and operator policies.
NOTE 1: Based on operator policies, an SMF can map all non-GBR QoS flows to
default EPS bearer in which case it requests only one EBI for all the non-GBR
QoS flows. Alternatively, an SMF can also map one non-GBR QoS flow to one
dedicated EPS bearer in which case it requests a dedicated EBI for non-GBR QoS
flow that should be mapped to dedicated EPS bearer. In between these two
extreme cases, the SMF can also map more than one (but not all) non-GBR QoS
Flow to the same EPS bearer (either default EPS bearer or dedicated EPS
bearer).
NOTE 2: To reduce the probability of AMF revoking the EBI corresponding to the
QoS Flow associated with the default QoS rule, ARP priority level of dedicated
QoS Flows can be set to higher value than that of the QoS Flow associated with
the default QoS rule within the same PDU Session.
When a new QoS Flow needs to be mapped to an EPS Bearer ID that has already
been assigned for an existing QoS Flow, the SMF includes the already assigned
EPS Bearer ID in the QoS Flow description sent to the UE.
If there is a possibility to run into a restriction regarding the number of
TFT packet filters that can be allocated for the PDU Session,
\- in the case that PCC is deployed, the PCF may include in the PCC rules the
Precedence for TFT packet filter allocation parameter, which determines the
order of the PCC rules in allocation of TFT packet filter(s) by the SMF+PGW-C.
\- in the case that PCC is deployed but the Precedence for TFT packet filter
allocation parameter is not received, or in the case that PCC is not deployed,
the SMF+PGW-C makes the decision how to allocate TFT packet filter(s) based on
operator policy or implementation.
NOTE 3: An EPS bearer can have up to 16 TFT packet filters.
For Ethernet and Unstructured PDU Session Types, only EPS Bearer ID for the
default EPS Bearer is allocated. The EPS Bearer IDs for these EPS bearers are
provided to the SMF+PGW-C by the AMF and are provided to the UE and NG-RAN by
the SMF+PGW-C using N1 SM NAS message and N2 SM message. The UE is also
provided with the mapped QoS parameters. The UE and the SMF+PGW-C store the
association between the QoS Flow and the corresponding EBI and the EPS QoS
parameters. When the QoS Flow is deleted e.g. due to PDU Session status
synchronization or PDU Session Modification, the UE and the SMF+PGW-C delete
any possibly existing EPS QoS parameters associated with the deleted QoS Flow.
In this release, for a PDU Session for a LADN or for Multi-homed IPv6 PDU
Session, the SMF doesn\'t allocate any EBI or mapped QoS parameters.
For PDU Sessions with UP integrity protection of UP Security Enforcement
Information set to Required, the SMF does not allocate any EBI or mapped QoS
parameters unless the UE support User Plane Integrity Protection with EPS and
the AMF supports the associated functionality.
If the UE supports User Plane Integrity Protection with EPS, as indicated in
the S1 UE network capability and the AMF supports the related functionality,
the AMF indicates the UE support for EPS User Plane Integrity Protection to
SMF. Then, for PDU Sessions with UP integrity protection of UP Security
Enforcement Information set to Required, the SMF may perform the EPS bearer ID
allocation procedure as described in clause 4.11.1.4.
If the MME indicates support for EPS User Plane Integrity Protection to
SMF+PGW-C, the SMF+PGW-C provides User Plane Security Enforcement Information
for the EPS bearer contexts to the MME (via the SGW).
When the UE is served by the EPC, during PDN connection establishment, the UE
allocates the PDU Session ID and sends it to the SMF+PGW-C via PCO. During PDN
Connection establishment and dedicated bearer establishment, SMF+PGW-C
performs EPS QoS mappings, from the 5G QoS parameters obtained from the PCF
and allocates TFT with the PCC rules obtained from the PCF if PCC is deployed.
Otherwise, EPS QoS mappings and TFT allocation are mapped by the SMF+PGW-C
locally. Other 5G QoS parameters corresponding to the PDN connection, e.g.
Session AMBR and QoS rules and QoS Flow level QoS parameters if needed for the
QoS Flow(s) associated with the QoS rule(s), are sent to UE in PCO. The UE and
the SMF+PGW-C store the association between the EPS Context and the PDU
Session Context to use it in the case of handover from EPS to 5GS. During the
EPS bearer establishment/modification procedure, QoS rules corresponding to
the related EPS bearers are allocated and sent to UE in PCO. The 5G QoS
parameters are stored in the UE and are to be used when the UE is handed over
from EPS to the 5GS. The 5G QoS parameters may be provided to SMF+PGW-C by the
PCF, if PCC is deployed. On mobility from EPS to 5GS, the UE sets the SSC mode
of the mapped PDU Session to SSC mode 1. The UE and the SMF+PGW-C store the
association between the EPS bearer and the corresponding 5G QoS Rules and QoS
Flow level QoS parameters if needed for the QoS Flow(s) associated with the
QoS rule(s). When the EPS bearer is deleted e.g. due to EPS bearer status
synchronization or bearer deactivation, the UE and the SMF+PGW-C delete any
possibly existing 5G QoS Rule(s) and QoS Flow level QoS parameters if any for
the QoS Flow(s) associated with the QoS rule(s) associated with the deleted
EPS bearer.
In the roaming case, if the VPLMN supports interworking with N26, the UE shall
operate in Single Registration mode.
During the 5GS-EPS handover, indirect forwarding may apply for the downlink
data forwarding performed as part of the handover. From its configuration data
the AMF knows whether indirect forwarding applies and it requests to allocate
downlink data forwarding paths on UPFs for indirect forwarding. From its
configuration data the MME knows whether indirect forwarding applies and it
requests to allocate downlink data forwarding paths on Serving GWs for
indirect forwarding. It is configured on AMF and MME whether indirect downlink
data forwarding does not apply, applies always or applies only for inter PLMN
inter RAT handovers.
During the 5GS-EPS handover, direct forwarding may apply for the downlink data
forwarding performed as part of the handover. From its configuration data the
source RAN node knows whether direct forwarding applies and indicates to
source CN the direct data forwarding is available.
During 5GS-EPS handover, on the target side, the CN informs the target RAN
node whether data forwarding is possible or not.
During interworking from EPS to 5GS, as the SMF+PGW-C may have different IP
addresses when being accessed over S5/S8 and N11/N16 respectively, the AMF
shall discover the SMF instance by an NF/NF service discovery procedure using
the FQDN for the S5/S8 interface received from the MME as a query parameter.
This is required for both non-roaming and roaming with local breakout, as well
as for home routed roaming.
NOTE 4: As the AMF is not aware of the S-NSSAI assigned for the PDN
Connection, the NF/NF service discovery used to find the SMF instance can use
PLMN level NRF.
During interworking from 5GS to EPS, for QoS Flows without EPS bearer ID(s)
assigned or for QoS Flows with PCC rules that do not have allocated TFT packet
filters, the SMF+PGW-C deletes the PCC rules associated with those QoS Flows
and informs the PCF about the removed PCC rule(s).
During interworking from 5GS to EPS, as a PDU Session may be released while
the UE is served by EPS, if Small Data Rate Control is used the SMF+PGW-C
obtains the Small Data Rate Control Status from the PGW-U+UPF in the N4
Session Modification procedure or from the SCEF+NEF and passes the Small Data
Rate Control Status in the PDU Session Context Response to the AMF, for the
AMF to store. The time to store the Small Data Rate Control Statuses is
implementation specific. If the UE and PGW-U+UPF / SCEF+NEF have stored APN
Rate Control parameters and optionally APN Rate Control Status they are only
applied when the UE is served by EPS.
During interworking from 5GS to EPS, for PDU Sessions with UP integrity
protection of UP Security Enforcement Information set to Required, the
SMF+PGW-C does not provide the EPS bearer context unless both the UE, the
target eNB and the target MME support User Plane Integrity Protection with
EPS.
During interworking from EPS to 5GS the UE and PGW-U+UPF / SCEF+NEF store the
APN Rate Control parameters and APN Rate Control Status while the UE is served
by 5GS, so they can be used if the UE moves back to EPS.
At EPS to 5GS mobility:
\- The UE considers the PDN connections released if those PDN connections were
established over EPS and for which the UE has not received mapped 5GS QoS
parameters from the network.
NOTE 5: UE not receiving mapped 5GS QoS parameters from the network covers the
case that a UE did not provide a PDU Session ID to the network when
establishing a PDN connection while UE\'s N1 mode is disabled and the case
that a UE provided PDU Session ID where the network (SMF+PGW-C) does not
provide mapped 5GS parameters.
\- The MME does not transfer to 5GS a PDN connection that does not support 5GS
interworking, e.g. PDN connection was established on a stand-alone PGW, or 5GS
interworking is restricted by subscription data.
#### 4.11.1.2 Handover procedures
##### 4.11.1.2.1 5GS to EPS handover using N26 interface
Figure 4.11.1.2.1-1 describes the handover procedure from 5GS to EPS when N26
is supported.
In the case of handover to a shared EPS network, the source NG-RAN determines
a PLMN to be used in the target network as specified by TS 23.501 [2]. The
source NG-RAN shall indicate the selected PLMN ID to be used in the target
network to the AMF as part of the TAI sent in the HO Required message.
In the case of handover from a shared NG-RAN, the AMF may provide the MME with
an indication that the 5GS PLMN is a preferred PLMN at later change of the UE
to a 5GS shared networks.
During the handover procedure, as specified in clause 4.9.1.3.1, the source
AMF shall reject any SMF+PGW-C initiated N2 request received since handover
procedure started and shall include an indication that the request has been
temporarily rejected due to handover procedure in progress.
Upon reception of a rejection for an SMF+PGW-C initiated N2 request(s) with an
indication that the request has been temporarily rejected due to handover
procedure in progress, the SMF+PGW-C behaves as specified in TS 23.401 [13].
Figure 4.11.1.2.1-1: 5GS to EPS handover for single-registration mode with N26
interface
The procedure involves a handover to EPC and setup of default EPS bearer and
dedicated bearers for QoS Flows that have EBI assigned, in EPC in steps 1-16
and re-activation, if required, of dedicated EPS bearers for non-GBR QoS Flows
that have no EBI assigned, in step 19. This procedure can be triggered, for
example, due to new radio conditions, load balancing or in the presence of QoS
Flow for normal voice or IMS emergency voice, the source NG-RAN node may
trigger handover to EPC.
For Ethernet and Unstructured PDU Session Types, the PDN Type Ethernet and
non-IP respectively are used, when supported, in EPS.
When EPS supports PDN Type non-IP but not PDN type Ethernet, PDN type non-IP
is used also for Ethernet PDU sessions. The SMF shall also set the PDN Type of
the EPS Bearer Context to non-IP in this case. After the handover to EPS, the
PDN Connection will have PDN Type non-IP, but it shall be locally associated
in UE and SMF to PDU Session Type Ethernet or Unstructured respectively.
In the roaming home routed case, the SMF+PGW-C always provides the EPS Bearer
ID and the mapped QoS parameters to UE. The V-SMF caches the EPS Bearer ID and
the mapped QoS parameters obtained from H-SMF for this PDU session. This also
applies in the case that the HPLMN operates the interworking procedure without
N26.
NOTE 1: The IP address preservation cannot be supported, if SMF+PGW-C in the
HPLMN doesn\'t provide the mapped QoS parameters.
1\. NG-RAN decides that the UE should be handed over to the E-UTRAN. If NG-RAN
is configured to perform Inter RAT mobility due to IMS voice fallback
triggered by QoS flow setup and request to setup QoS flow for IMS voice was
received, NG-RAN responds indicating rejection of the QoS flow establishment
because of mobility due to fallback for IMS voice via N2 SM information and
triggers handover to E-UTRAN. The NG-RAN sends a Handover Required (Target eNB
ID, Direct Forwarding Path Availability, Source to Target Transparent
Container, inter system handover indication) message to the AMF. NG-RAN
indicates bearers corresponding to the 5G QoS Flows for data forwarding in
Source to Target Transparent Container.
If the source NG RAN and target E-UTRAN support RACS as defined in TS 23.501
[2], the Source to Target transparent container need not carry the UE radio
access capabilities (instead the UE Radio Capability ID is supplied from the
CN to the target E-UTRAN). However, if the source NG-RAN has knowledge that
the target E-UTRAN might not have a local copy of the Radio Capability
corresponding to the UE Radio Capability ID (i.e. because the source NG-RAN
had itself to retrieve the UE\'s Radio Capability from the AMF) then the
source NG-RAN may also send some (or all) of the UE\'s Radio Capability to the
target E-UTRAN (the size limit based on configuration). In the case of inter-
PLMN handover, when the source NG-RAN and target E-UTRAN support RACS as
defined in TS 23.501 [2] and TS 23.401 [13] and the source NG-RAN determines
that the target PLMN does not support the UE Radio Capability ID assigned by
the source PLMN based on local configuration, then the source NG-RAN includes
the UE radio access capabilities in the Source to Target transparent
container.
Direct Forwarding Path Availability indicates whether direct forwarding is
available from the NG-RAN to the E-UTRAN. This indication from NG-RAN can be
based on e.g. the presence of IP connectivity and security association(s)
between the NG-RAN and the E-UTRAN.
If the handover is triggered due to Emergency fallback, the NG-RAN may forward
the Emergency indication to the target eNB in the Source to Target Transparent
Container and the target eNB allocates radio bearer resources taking received
indication into account.
2a-2c. The AMF determines from the \'Target eNB Identifier\' IE that the type
of handover is Handover to E-UTRAN. The AMF selects an MME as described in
clause 4.3.8.3 of TS 23.401 [13].
The AMF determines for a PDU Session whether to retrieve context including
mapped UE EPS PDN Connection from the V-SMF (in the case of HR roaming) or the
SMF+PGW-C (in the case of non roaming or LBO roaming) as follows:
\- If the AMF determines that one or more of the EBI(s) can be transferred,
the AMF sends Nsmf_PDUSession_ContextRequest to the V-SMF or SMF+PGW-C and
includes in the message EBI value(s) if any that cannot be transferred.
\- The EBI values(s) that cannot be transferred is determined by the AMF if
the target MME does not support 15 EPS bearers, i.e. the AMF determines the
EBI values in range 1-4 as not to be transferred to EPS and if there are still
more than 8 EBI values associated with PDU Sessions, the AMF then determines
EBI value(s) not to be transferred to EPS based on S-NSSAI and ARP as
specified in clause 5.17.2.2.1 of TS 23.501 [2].
\- The AMF does not retrieve the context for a PDU Session that cannot be
transferred to EPS due to no EBI allocated, or allocated EBIs not
transferrable, or combination of the two.
When the AMF sends Nsmf_PDUSession_ContextRequest the AMF provides also the
target MME capability to the V-SMF or the SMF+PGW-C to allow it to determine
whether to include EPS Bearer context for Ethernet PDN Type or non-IP PDN Type
or not.
When the AMF sends Nsmf_PDUSession_ContextRequest to the V-SMF or the
SMF+PGW-C, the AMF indicates whether the target MME supports User Plane
Integrity Protection with EPS.
NOTE 2: The AMF knows the MME capability to support 15 EPS bearers, Ethernet
PDN type and/or non-IP PDN type or not through local configuration. The AMF
knows the MME capability to support User Plane integrity protection through
local configuration but the actual EPS support may depend on the target
E-UTRAN coverage (see step 14).
When Nsmf_PDUSession_Context Request is received in the V-SMF or the
SMF+PGW-C, the V-SMF or the SMF+PGW-C provides context that includes the
mapped EPS PDN Connection as follows:
\- If there is EBI list not to be transferred and the EBI value of the QoS
Flow associated with the default QoS Rule is included in that list, the V-SMF
or the SMF+PGW-C shall not return the PDN Connection context (which implies
the whole PDU Session is not transferred to EPS), otherwise if the EBI value
of the QoS Flow associated with the default QoS Rule is not included in EBI
list not to be transferred, the V-SMF or PGW C+SMF shall not provide the EPS
bearer context(s) mapped from QoS Flow(s) associated with the EBI list not to
be transferred.
\- For PDU Sessions with PDU Session Type Ethernet, if the UE and target MME
supports Ethernet PDN type, the V-SMF or the PGW C+SMF provides Context for
Ethernet PDN Type, otherwise if the target MME does not support Ethernet Type
but support non-IP Type, the V-SMF or the PGW C+SMF provides Context for non-
IP PDN Type. For PDU Sessions with PDU Session Type Unstructured, the V-SMF or
the SMF+PGW-C provides Context for non-IP PDN Type.
\- If the UP integrity protection policy for the EPS bearer context is set to
\"Required\", the V-SMF or the PGW C+SMF shall not provide the EPS bearer
context unless the MME capability indicates support for User Plane Integrity
Protection with EPS and the UE supports User Plane Integrity Protection with
EPS.
In the case of non roaming or LBO roaming, when Nsmf_PDUSession_ContextRequest
is received in PGW C+SMF, if the SMF+PGW-C determines that EPS Bearer Context
can be transferred to EPS and the CN Tunnel Info for EPS bearer(s) have not
been allocated before, the SMF+PGW-C sends N4 Session modification to the
PGW-U+UPF to establish the CN tunnel for each EPS bearer and provides EPS
Bearer Contexts to AMF, as described in step 8 of clause 4.11.1.4.1. The
PGW-U+UPF is ready to receive the uplink packet from E-UTRAN.
This step is performed with all the SMF+PGW-Cs corresponding to PDU Sessions
of the UE which are associated with 3GPP access and have at leaset one EBI(s)
determined to be transferred to EPS.
NOTE 2: The AMF knows the MME capability to support 15 EPS bearers, Ethernet
PDN type and/or non-IP PDN type or not through local configuration.
In home routed roaming scenario, the UE\'s EPS PDN Contexts are obtained from
the V-SMF. If Small Data Rate Control applies on PDU Session, the V-SMF
retrieves the SM Context, including Small Rate Control Status information from
the H-SMF using Nsmf_PDUSession_Context Request.
3\. The AMF sends a Forward Relocation Request as in step 3 in clause
5.5.1.2.2 (S1-based handover, normal) in TS 23.401 [13], with the following
modifications and clarifications:
\- Parameter \"Return preferred\" may be included. Return preferred is an
optional indication by the MME of a preferred return of the UE to the 5GS PLMN
at a later access change to a 5GS shared network. An MME may use this
information as specified by TS 23.501 [2].
\- The SGW address and TEID for both the control-plane or EPS bearers in the
message are such that target MME selects a new SGW.
\- The AMF determines, based on configuration and the Direct Forwarding Path
Availability, the Direct Forwarding Flag to inform the target MME whether
direct data forwarding is applicable.
\- The AMF includes the mapped SM EPS UE Contexts for PDU Sessions with and
without active UP connections.
\- Subject to operator policy if the secondary RAT access restriction
condition is the same for EPS and 5GS, the AMF may set EPS secondary RAT
access restriction condition based on the UE\'s subscription data.
4-5. Step 4 and 4a respectively in clause 5.5.1.2.2 (S1-based handover,
normal) in TS 23.401 [13].
6\. Step 5 (Handover Request) in clause 5.5.1.2.2 (S1-based handover, normal)
in TS 23.401 [13] with the following modification:
\- Handover Request may contain information Handover Restriction List with
information about PLMN IDs as specified by clause 5.2a of TS 23.251 [35] for
eNodeB functions.
\- The target eNB should establish E-RABs indicated by the list of EPS bearer
to be setup provided by the MME, even if they are not included in the source
to target container.
7-9. Step 5a through 7 in clause 5.5.1.2.2 (S1-based handover, normal) in TS
23.401 [13].
10a. If data forwarding applies, the AMF sends the
Nsmf_PDUSession_UpdateSMContext Request (data forwarding information) to the
SMF+PGW-C. If multiple SMF+PGW-Cs serves the UE, the AMF maps the EPS bearers
for Data forwarding to the SMF+PGW-C address(es) based on the association
between the EPS bearer ID(s) and PDU Session ID(s). In home-routed roaming
case, the AMF requests the V-SMF to create indirect forwarding tunnel if
indirect forwarding applies.
10b. If indirect data forwarding applies, the SMF+PGW-C may select an
intermediate PGW-U+UPF for data forwarding. The SMF+PGW-C maps the EPS bearers
for Data forwarding to the 5G QoS flows based on the association between the
EPS bearer ID(s) and QFI(s) for the QoS flow(s) in the SMF+PGW-C and then
sends the QFIs, Serving GW Address(es) and TEID(s) for data forwarding to the
PGW-U+UPF. The CN Tunnel Info is provided by the PGW-U+UPF to SMF+PGW-C in
this response. In home-routed roaming case, the V-SMF selects the V-UPF for
data forwarding.
10c. The SMF+PGW-C returns an Nsmf_PDUSession_UpdateSMContext Response (Cause,
Data Forwarding tunnel Info, QoS flows for Data Forwarding). Based on the
correlation between QFI(s) and Serving GW Address(es) and TEID(s) for data
forwarding, the PGW-U+UPF maps the QoS flow(s) into the data forwarding
tunnel(s) in EPC.
11\. The AMF sends the Handover Command to the source NG-RAN (Transparent
container (radio aspect parameters that the target eNB has set-up in the
preparation phase), Data forwarding tunnel info, QoS flows for Data
Forwarding). The source NG-RAN commands the UE to handover to the target
Access Network by sending the HO Command. The UE correlates the ongoing QoS
Flows with the indicated EPS Bearer IDs to be setup in the HO command. The UE
locally deletes the PDU Session if the QoS Flow associated with the default
QoS rule in the PDU Session does not have an EPS Bearer ID assigned. If the
QoS Flow associated with the default QoS rule has an EPS Bearer ID assigned,
the UE keeps the PDU Session (PDN connection) and for the remaining QoS
Flow(s) that do not have EPS bearer ID(s) assigned, the UE locally deletes the
QoS rule(s) and the QoS Flow level QoS parameters if any associated with those
QoS Flow(s) and notifies the impacted applications that the dedicated QoS
resource has been released. The UE deletes any UE derived QoS rules. The EPS
Bearer ID that was assigned for the QoS flow of the default QoS rule in the
PDU Session becomes the EPS Bearer ID of the default bearer in the
corresponding PDN connection.
If indirect data forwarding is applied, Data forwarding tunnel info includes
CN tunnel info for data forwarding per PDU session. For the QoS Flows
indicated in the \"QoS Flows for Data Forwarding\", NG-RAN initiate data
forwarding via to the PGW-U+UPF based on the CN Tunnel Info for Data
Forwarding per PDU Session. Then the PGW-U+UPF maps data received from the
data forwarding tunnel(s) in the 5GS to the data forwarding tunnel(s) in EPS
and sends the data to the target eNodeB via the Serving GW.
If direct data forwarding is applied, Data forwarding tunnel info includes
E-UTRAN tunnel info for data forwarding per EPS bearer. NG-RAN initiate data
forwarding to the target E-UTRAN based on the Data Forwarding Tunnel Info for
Data Forwarding per EPS bearer.
12-12c. Step 13 to step 14 from clause 5.5.1.2.2 (S1-based handover, normal)
in TS 23.401 [13] with the following clarification:
\- The AMF requests the release of the PDU Session which is associated with
3GPP access and not expected to be transferred to EPC, i.e. the AMF requests
the release of:
\- PDU Session(s) whose corresponding SMF+PGW-C(s) are not contacted by AMF
for SM context because the AMF determines that none of EBI(s) for the PDU
Session can be transferred to EPS at step 2a; and
\- PDU Session(s) for which the SM context retrieval failed at step 2c.
12d. The AMF acknowledges MME with Relocation Complete Ack message. A timer in
AMF is started to supervise when resource in NG-RAN shall be released.
12e. In the case of home routed roaming, the AMF invokes
Nsmf_PDUSession_ReleaseSMContext Request (V-SMF only indication) to the V-SMF.
This service operation request the V-SMF to remove only the SM context in
V-SMF, i.e. not release PDU Session context in the SMF+PGW-C.
If indirect forwarding tunnel(s) were previously established, the V-SMF starts
a timer and releases the SM context on expiry of the timer. If no indirect
forwarding tunnel has been established, the V-SMF immediately releases the SM
context and its UP resources for this PDU Session in V-UPF locally.
13\. Step 15 from clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401
[13].
14a. Step 16 (Modify Bearer Request) from clause 5.5.1.2.2 (S1-based handover,
normal) in TS 23.401 [13] with the following clarification:
\- If the PDU Session (PDN connection) has QoS Flows that do not have EPS
bearer ID(s) assigned, or QoS Flow(s) for which the mapped EPS bearers are not
included in Modify Bearer Request, the SMF+PGW-C deletes the PCC rule(s)
associated with those QoS Flows and informs the PCF about the removed PCC
rule(s). If there are QoS Flow(s) with PCC rule(s) that do not have allocated
TFT packet filters, the SMF+PGW-C deletes those PCC rule(s) and informs the
PCF about the removed PCC rule(s).
NOTE 4: If the QoS flow is deleted, the IP flows of the deleted QoS rules will
continue flowing on the default EPS bearer if it does not have an assigned
TFT. If the default EPS bearer has an assigned TFT, the IP flows of the
deleted QoS Flow may be interrupted until step 19 when dedicated bearer
activation is triggered by a request from the PCF.
The SMF+PGW-C may need to report some subscribed event to the PCF by
performing an SMF initiated SM Policy Association Modification procedure as
defined in clause 4.16.5.
If the MME does not indicate support of User Plane integrity protection, or
the new eNB does not support User Plane integrity protection, or the UE does
not support User Plane Integrity Protection with EPS and the UP integrity
protection policy is set to \"Required\" then the SMF+PGW-C releases the
bearers associated with the PDN CONNECTION.
15\. The SMF+PGW-C initiates a N4 Session Modification procedure towards the
UPF+PGW-U to update the User Plane path, i.e. the downlink User Plane for the
indicated PDU Session is switched to E-UTRAN. The SMF+PGW-C releases the
resource of the CN tunnel for PDU Session in UPF+PGW-U.
16\. Step 16a (Modify Bearer Response) from clause 5.5.1.2.2 (S1-based
handover, normal) in TS 23.401 [13]. At this stage the User Plane path is
established for the default bearer and the dedicated EPS bearers between the
UE, target eNodeB, Serving GW and the PGW-U+UPF. The SMF+PGW-C uses the EPS
QoS parameters as assigned for the dedicated EPS bearers during the QoS Flow
establishment. SMF+PGW-C maps all the other IP flows to the default EPS bearer
(see NOTE 4).
If indirect forwarding tunnel(s) were previously established, the SMF+PGW-C
starts a timer, to be used to release the resource used for indirect data
forwarding.
17\. Step 17 from clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401
[13].
18\. The UE initiates a Tracking Area Update procedure as specified in step 18
of clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401 [13].
This includes the deregistration of the old AMF for 3GPP access from the
HSS+UDM as specified in clause 4.11.1.5.3. Any registration associated with
the non-3GPP access in the old AMF is not removed (i.e. an AMF that was
serving the UE over both 3GPP and non-3GPP accesses does not consider the UE
as deregistered over non 3GPP access and will remain registered and subscribed
to subscription data updates in UDM).
NOTE 5: The behaviour whereby the HSS+UDM cancels location of CN node of the
another type, i.e. AMF, is similar to HSS behaviour for MME and Gn/Gp SGSN
registration (see TS 23.401 [13]). The target AMF that receives the cancel
location from the HSS+UDM is the one associated with 3GPP access.
When the UE decides to deregister over non-3GPP access or the old AMF decides
not to maintain a UE registration for non-3GPP access anymore, the old AMF
then deregisters from UDM by sending a Nudm_UECM_Deregistration service
operation, unsubscribes from Subscription Data updates by sending an
Nudm_SDM_Unsubscribe service operation to UDM and releases all the AMF and AN
resources related to the UE.
19\. If PCC is deployed, the PCF may decide to provide the previously removed
PCC rules to the SMF+PGW-C again thus triggering the SMF+PGW-C to initiate
dedicated bearer activation procedure. This procedure is specified in clause
5.4.1 of TS 23.401 [13] with modification captured in clause 4.11.1.5.4. This
step is applicable for PDN Type IP or Ethernet, but not for non-IP PDN Type.
20\. Step 21 from clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401
[13].
21\. In the case of home routed roaming, at the expiry of the timer at V-SMF
started at step 12e, the V-SMF locally releases the SM context and the UP
resource for the PDU Session including the resources used for indirect
forwarding tunnel(s) that were allocated at step 10.
In non-roaming or local breakout roaming, if SMF+PGW-C has started a timer in
step 16, at the expiry of the timer, the SMF+PGW-C sends N4 Session
Modification Request to PGW-U+UPF to release the resources used for the
indirect forwarding tunnel(s) that were allocated at step 10.
When the timer set in step 12d expires, AMF also sends a UE Context Release
Command message to the source NG RAN. The source NG RAN releases its resources
related to the UE and responds with a UE Context Release Complete message.
##### 4.11.1.2.2 EPS to 5GS handover using N26 interface
##### 4.11.1.2.2.1 General {#general-27 .H6}
N26 interface is used to provide seamless session continuity for single
registration mode.
The procedure involves a handover to 5GS and setup of QoS Flows in 5GS.
In the home routed roaming case, the PGW-C+ SMF in the HPLMN always receives
the PDU Session ID from UE and provides PDN Connection associated 5G QoS
parameter(s) and S-NSSAI to the UE. This also applies in the case that the
HPLMN operates the interworking procedure without N26.
In the case of handover to a shared 5GS network, the source E-UTRAN determines
a PLMN to be used in the target network as specified by clause 5.2a of TS
23.251 [35] for eNodeB functions. A supporting MME may provide the AMF via N26
with an indication that source EPS PLMN is a preferred PLMN when that PLMN is
available at later change of the UE to an EPS shared network.
NOTE 1: If the UE has active EPS bearer for normal voice or IMS emergency
voice, the source E-UTRAN can be configured to not trigger any handover to
5GS.
If the PDN Type of a PDN Connection in EPS is non-IP and is locally associated
in UE and SMF to PDU Session Type Ethernet or Unstructured, the PDU Session
Type in 5GS shall be set to Ethernet or Unstructured respectively.
NOTE 2: If the non-IP PDN Type is locally associated in UE and SMF to PDU
Session Type Ethernet, it means that Ethernet PDN Type is not supported in
EPS.
NOTE 3: The IP address continuity can\'t be supported, if SMF+PGW-C in the
HPLMN doesn\'t provide the mapped QoS parameters.
In order to support the E-UTRAN NTN enhancements defined in TS 36.300 [46],
for handover from EPS to 5GS, the following applies related to handling of
UE\'s radio capabilities:
\- If the target NG-RAN node knows (e.g. by configuration) that the UE\'s
E-UTRA radio capabilities applicable to the target NG-RAN node may be
different to the E-UTRA radio capabilities stored in the source eNodeB (e.g.
for handover from an eNodeB that supports the NTN enhancements as defined in
TS 36.300 [46]), then the target NG-RAN node shall trigger retrieval of the
E-UTRA radio capability information again from the UE.
In order to support the E-UTRAN NTN enhancements defined in TS 36.300 [46],
for handover from 5GS to EPS, the following applies related to handling of
UE\'s radio capabilities:
\- If the target eNodeB node knows (e.g. by configuration) that the UE\'s
E-UTRA radio capabilities applicable to the target eNodeB may be different to
the E-UTRA radio capabilities stored in the source NG-RAN node (e.g. for
handover to eNodeB that supports the NTN enhancements as defined in TS 36.300
[46]), then the target eNodeB shall trigger retrieval of the E-UTRA radio
capability information again from the UE.
##### 4.11.1.2.2.2 Preparation phase {#preparation-phase-1 .H6}
Figure 4.11.1.2.2.2-1 shows the preparation phase of the Single Registration-
based Interworking from EPS to 5GS procedure.
Figure 4.11.1.2.2.2-1: EPS to 5GS handover using N26 interface, preparation
phase
This procedure applies to the Non-Roaming (TS 23.501 [2] Figure 4.3.1-1),
Home-routed roaming (TS 23.501 [2] Figure 4.3.2-1) and Local Breakout roaming
Local Breakout (TS 23.501 [2] Figure 4.3.2-2) cases.
\- For non-roaming scenario, V-SMF, v-UPF and v-PCF are not present
\- For home-routed roaming scenario, the SMF+PGW-C and UPF+PGW-U are in the
HPLMN. v-PCF are not present
\- For local breakout roaming scenario, V-SMF and v-UPF are not present.
SMF+PGW-C and UPF+PGW-U are in the VPLMN.
In local-breakout roaming case, the v-PCF interacts wit the SMF+PGW-C.
1 - 2. Step 1 - 2 from clause 5.5.1.2.2 (S1-based handover, normal) in TS
23.401 [13].
3\. Step 3 from clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401 [13]
with the following modifications:
An additional optional parameter Return preferred. Return preferred is an
optional indication provided by the MME to indicate a preferred return of the
UE to the last used EPS PLMN at a later access change to an EPS shared
network. Based on the Return Preferred indication, the initial AMF may store
the last used EPS PLMN ID in the UE Context.
The initial AMF converts the received EPS MM Context into the 5GS MM Context.
This includes converting the EPS security context into a mapped 5G security
context as described in TS 33.501 [15]. The MME UE context includes IMSI, ME
Identity, UE security context, UE Network Capability and EPS Bearer context(s)
and may also include LTE-M Indication. The MME EPS Bearer context(s) include
for each EPS PDN connection the IP address and FQDN for the S5/S8 interface of
the SMF+PGW-C and APN and for each EPS bearer the IP address and CN Tunnel
Info at the UPF+PGW-U for uplink traffic. If the AMF received the LTE-M
indication in the EPS MM Context, then it considers that the RAT Type is
LTE-M.
The initial AMF queries the (PLMN level) NRF in serving PLMN by issuing the
Nnrf_NFDiscovery_Request including the FQDN for the S5/S8 interface of the
SMF+PGW-C and the NRF provides the IP address or FQDN of the N11/N16 interface
of the SMF+PGW-C.
If the initial AMF cannot retrieve the address of the corresponding SMF for a
PDN connection, it will not move the PDN connection to 5GS.
NOTE 1: If the initial AMF holds a native 5G security context for the UE, the
initial AMF may activate this native 5G security context by initiating a NAS
SMC upon completing the handover procedure.
4\. The initial AMF invokes the Nsmf_PDUSession_CreateSMContext service
operation (UE EPS PDN Connection, initial AMF ID, data Forwarding information,
Target ID) on the SMF identified by the SMF+PGW-C address and indicates HO
Preparation Indication (to avoid switching the UP path). The initial AMF ID
uniquely identifies the initial AMF serving the UE. This step is performed for
each PDN Connection and the corresponding SMF+PGW-C address/ID in the UE
context the initial AMF received in step 3. The SMF finds the corresponding
PDU Session based on EPS Bearer Context(s).
Based on configuration and the Direct Forwarding Flag received from the MME,
the initial AMF determines the applicability of data forwarding and indicates
to the SMF whether the direct data forwarding or indirect data forwarding is
applicable.
Target ID corresponds to Target ID provided by the MME in step 3.
For home-routed roaming scenario, the initial AMF selects a default V-SMF per
PDU Session and invokes the Nsmf_PDUSession_CreateSMContext service operation
(UE PDN Connection Contexts, initial AMF ID, SMF + PGW-C address, S-NSSAI).
The S-NSSAI is the S-NSSAI configured in initial AMF for interworking, which
is associated with default V-SMF.
The default V-SMF selects the SMF+PGW-C using the received H-SMF address as
received from the initial AMF and initiates a Nsmf_PDUSession_Create service
operation with the SMF+PGW-C and indicates HO Preparation Indication. The
V-SMF provides the QoS constraints of the VPLMN to the H-SMF.
Step 5 and step 6 are skipped if the SMF+PGW-C (H-SMF+PGW-C in the case of
home-routed scenario) determines that session continuity from EPS to 5GS is
not supported for the PDU Session (e.g. PDU Session ID was not received for
the PDN connection in EPS, or PDU Session ID was received but mapped 5GS
parameters were not provided to the UE due to 5GC interworking restricted).
5\. If dynamic PCC is deployed, the SMF+ PGW-C (H-SMF for home-routed
scenario) may initiate SMF initiated SM Policy Modification towards the PCF.
6\. The SMF+PGW-C requests the PGW-U+UPF to allocate the CN Tunnel Info for
PDU Session. The SMF+PGW-C send N4 Session modification to PGW-U+UPF to
establish the CN tunnel for PDU Session at PGW-U+UPF. The PGW-U+UPF is ready
to receive the uplink packets from NG-RAN. The PGW-U+UPF allocates the PGW-U
CN Tunnel Info for PDU Session and sends it to the SMF+PGW-C. This step is
performed at all SMF+PGW-Cs allocated to the UE for each PDU Session of the
UE.
7\. The SMF+PGW-C (default V-SMF in the case of home-routed roaming scenario
only) sends a Nsmf_PDUSession_CreateSMContext Response (PDU Session ID,
S-NSSAI, allocated EBIs, N2 SM Information (QoS Profile(s), EPS Bearer Setup
List, Mapping between EBI(s) and QFI(s), CN Tunnel-Info, cause code)) to the
initial AMF.
For home-routed roaming scenario the step 8 need be executed first. The CN
Tunnel-Info provided to the initial AMF in N2 SM Information is the V-CN
Tunnel-Info.
The SMF includes mapping between EBI(s) and QFI(s) as part of N2 SM
Information container. If the P-GW-C+SMF (H-SMF in the case of home-routed
scenario) determines that seamless session continuity from EPS to 5GS is not
supported for the PDU Session (e.g. PDU Session ID was not received for the
PDN connection in EPS), then it does not provide SM information for the
corresponding PDU Session but includes the appropriate cause code for
rejecting the PDU Session transfer within the N2 SM Information and release
the PDN connection locally in the SMF+PGW-C. If neither indirect forwarding
nor direct forwarding is applicable, the SMF shall further include a \"Data
forwarding not possible\" indication in the N2 SM information container. If
SMF is indicated that Direct Forwarding is applicable in step 4, the SMF shall
further include a \"Direct Forwarding Path Availability\" indication in the N2
SM information container. In home routed roaming case, the S-NSSAI included in
N2 SM Information container is the S-NSSAI received in step 4.
The initial AMF stores an association of the PDU Session ID, S-NSSAI and the
SMF ID. The AMF stores also the allocated EBI(s) associated to the PDU Session
ID.
If the PDN Type of a PDN Connection in EPS is non-IP and is locally associated
in SMF to PDU Session Type Ethernet, the PDU Session Type in 5GS shall be set
to Ethernet. If the PDN type of a PDN Connection in EPS is non-IP and is
locally associated in UE and SMF to PDU Session Type Unstructured, the PDU
Session Type in 5GS shall be set to Unstructured.
NOTE 2: If the non-IP PDN Type is locally associated in SMF to PDU Session
Type Ethernet, it means that Ethernet PDN Type is not supported in EPS.
In the case of PDU Session Type Ethernet, that was using PDN type non-IP in
EPS, the SMF creates QoS rules and QoS Flow level QoS parameters for the QoS
Flow(s) associated with the QoS rule(s) based on the PCC Rules received from
PCF.
In the case of home-routed roaming scenario, the V-SMF may apply VPLMN
policies as described in TS 23.501 [2], clause 5.17.1.3.
The SMF includes the User Plane Security Policy as part of N2 SM Information
container. The SMF determines the User Plane Security Policy as described in
clause 5.10.3 of TS 23.501 [2].
8\. For home-routed roaming scenario only: The default V-SMF selects a default
v-UPF and initiates an N4 Session Establishment procedure with the selected
default v-UPF. The default V-SMF provides the default v-UPF with packet
detection, enforcement and reporting rules to be installed on the UPF for this
PDU Session, including H-CN Tunnel Info.
The default v-UPF acknowledges by sending an N4 Session Establishment Response
message. The V-CN Tunnel Info is allocated by the v-UPF and provided to the
default V-SMF in this step.
8a. Based on the received S-NSSAI from the SMF+PGW-C, the Initial AMF may
reselect a target AMF as described in clause 5.15.5.2.1 of TS 23.501 [2] and
invokes Namf_Communication_RelocateUEContext request (SUPI, Target 5GAN Node
ID, PDU session ID and the S-NSSAI associated with N2 SM Information received
in step 7, Source to Target Transparent Container, 5GS MM Context, MME Tunnel
Endpoint Identifier for Control Plane, MME Address for Control plane, PDU
Session ID and its associated S-NSSAI of the VPLMN value for each PDU Session,
the corresponding S-NSSAI of HPLMN value for home routed PDU Session(s),
SMF+PGW-C ID of each PDU Session, default V-SMF ID and SM Context ID of each
PDU Session, allocated EBIs of each PDU Session, Allowed NSSAI received from
NSSF) to the selected target AMF.
NOTE 3: When there is no need of AMF reallocation, then the target AMF in
following steps is the same as the initial AMF.
NOTE 4: In the case of Home routed PDU Session the S-NSSAI associated with N2
SM information used in steps 8, 8a and 9 is the S-NSSAI configured for
interworking in the initial AMF. Otherwise the S-NSSAI received from the SMF
in step 7 can be used in steps 8, 8a and 9 for the S-NSSAI associated with N2
SM information.
9\. The target AMF sends a Handover Request (Source to Target Transparent
Container, Allowed NSSAI, PDU session ID and the S-NSSAI received from Source
AMF associated with the corresponding N2 SM Information (QFI(s), QoS
Profile(s), EPS Bearer Setup List, V-CN Tunnel Info, Mapping between EBI(s)
and QFI(s)), Mobility Restriction List, UE Radio Capability ID) message to the
NG-RAN.
If available, the target AMF provides NG-RAN with a PLMN list in the Mobility
Restriction List containing at least the serving PLMN, which may also include
the last used EPS PLMN ID if it is the preferred PLMN for subsequent mobility
to EPS. See TS 38.413 [10], clause 9.3.1.85 for details about the Mobility
Restriction List.
NG-RAN can use the source to target transparent container and N2 SM
Information container to determine which QoS flows have been proposed for
forwarding and decide for which of those QoS flows it accepts the data
forwarding or not.
The target AMF provides the UE Radio Capability ID to NG-RAN if RACS is
supported. If the UE Radio Capability ID is included in the Handover Request
message, when there is no corresponding UE radio capabilities set for UE Radio
Capability ID at NG-RAN and no UE radio access capabilities are provided in
the Source to Target transparent container, NG-RAN shall request the T-AMF to
provide the UE radio capabilities set corresponding to UE Radio Capability ID
to the NG-RAN. If the Source to Target transparent container contains the UE
radio access capabilities and the T-RAN did not receive the UE Radio
Capability ID from the T-AMF, NG-RAN shall proceed with handover using the
received UE access radio capabilities. If the T-RAN received both the UE radio
access capabilities and the UE Radio Capability ID, then the T-RAN shall use
any locally stored UE radio access capability information corresponding to the
UE Radio Capability ID. If none are stored locally, the T-RAN may request the
full UE radio access capability information from the core network. If the full
UE radio access capability information is not promptly received from the core
network, or the T-RAN chooses not to request them, then the T-RAN shall
proceed with the UE radio access capabilities sent by the source RAN node. The
T-RAN shall not use the UE radio access capability information received from
the source RAN node for any other UE with the same the UE Radio Capability ID.
10\. The NG-RAN sends a Handover Request Acknowledge (Target to Source
Transparent Container, List of PDU Sessions to Hand-over with N2 SM response
(PDU Session ID, list of accepted QFI(s), AN Tunnel Info, Data Forwarding
Tunnel Info), List of PDU Sessions that failed to be established with the
failure cause given in the N2 SM information element) message to the target
AMF.
If indirect data forwarding is applied, the NG-RAN includes one assigned
TEID/TNL address per PDU Session (for which there is at least one QoS flow for
which it has accepted the forwarding) within the SM Info container. It also
includes the list of QoS flows for which it has accepted the forwarding.
According to the mapping between EBI(s) and QFI(s), if one EPS bearer in EPS
is mapped to multiple QoS flows in 5GS, all such QoS flows need to be accepted
to support indirect data forwarding during EPS to 5GS mobility. Otherwise, the
NG RAN rejects the indirect data forwarding for the QoS flows which are mapped
to the EPS bearer.
If direct data forwarding is applied, the NG-RAN includes one assigned
TEID/TNL per E-RAB accepted for direct data forwarding.
When the target NG-RAN rejects the handover with a Handover Failure, steps
11-13 and step 16 are not executed.
11\. The target AMF sends an Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID, N2 SM response received from NG-RAN in step 10) message to the SMF
for updating N3 tunnel information. In home routed roaming case, the Data
Forwarding Tunnel Info is handled by the default V-SMF and will not be sent to
the SMF+PGW-C.
12\. SMF+PGW-C (default V-SMF in home-routed roaming scenario) performs
preparations for N2 Handover by indicating N3 UP address and Tunnel ID of NG-
RAN to the UPF if N2 Handover is accepted by NG-RAN. If indirect data
forwarding is applied, SMF+PGW-C indicates the mapping between the TEID where
the UPF receives data forwarded by the source SGW and the QFI(s) and N3 Tunnel
Info for data forwarding where the UPF is selected to forward such data (e.g.
an intermediate UPF). If the EPS bearer is mapped to multiple QoS flows and an
intermediate UPF is selected for data forwarding, only one QFI is selected by
the SMF+PGW-C from QFIs corresponding to the QoS flows.
If indirect data forwarding is applied in home routed roaming case, the
default V-SMF sends a default V-UPF for data forwarding the mapping between
the TEID where the UPF receives data forwarded by the source SGW and the QFI
and N3 Tunnel Info for data forwarding. If the EPS bearer is mapped to
multiple QoS flows and an intermediate UPF is selected for data forwarding,
only one QFI is selected by the SMF+PGW-C from QFIs corresponding to the QoS
flows.
If N2 Handover is not accepted by NG-RAN, SMF+PGW-C deallocates N3 UP address
and Tunnel ID of the selected UPF.
The EPS Bearer Setup list is a list of EPS bearer Identifiers successfully
handover to 5GC, which is generated based on the list of accepted QFI(s).
If a PDU Session is rejected by the Target NG-RAN with an indication that the
PDU session was rejected because User Plane Security Enforcement is not
supported in the Target NG-RAN and the User Plane Enforcement Policy indicates
\"Required\" as described in clause 5.10.3 of TS 23.501 [2], the SMF triggers
the release of this PDU Session. In all other cases of PDU Session rejection,
the SMF can decide whether to release the PDU Session or to deactivate the UP
connection of this PDU Session.
If some of the QoS Flows of a PDU Session are not accepted by the Target NG-
RAN, the SMF shall initiate the PDU Session Modification procedure to remove
the non-accepted QoS Flows from the PDU Session(s) after the handover
procedure is completed.
13\. SMF+PGW-C (default V-SMF in home-routed roaming scenario) to target AMF:
Nsmf_PDUSession_UpdateSMContext _Response (_ PDU Session ID, EPS Bearer Setup
List _). The data forwarding information is included in the EPS Bearer Setup
List. In home routed roaming case, the default V-SMF provides the tunnel
information for data forwarding._
This message is sent for each received Nsmf_PDUSession_UpdateSMContext_Request
message.
14\. The target AMF sends the message Forward Relocation Response (Cause,
Target to Source Transparent Container, Serving GW change indication, EPS
Bearer Setup List, target AMF Tunnel Endpoint Identifier for Control Plane,
Addresses and TEIDs) to MME. The EPS Bearer Setup list is the combination of
EPS Bearer Setup list from different SMF+PGW-C(s).
In the case of Handover Failure in step 10, the target AMF provides to the MME
the failure related information such as the Target RAN to Source RAN Failure
Information.
15\. The target AMF invokes Namf_Communication_RelocateUEContext response
(Cause) to the initial AMF if step 8a had been performed. The target AMF
indicates whether the Relocate UE Context (hand-Over) succeeded or failed.
If the target NG RAN has rejected the Handover Request in step 10, the
Namf_Communication_RelocateUEContext response indicates a failure due to RAN
rejection. Then the initial AMF invokes the Nsmf_PDUSession_UpdateSMContext
request towards the SMF+PGW-C(s) contacted at step 4 indicating . The
Nsmf_PDUSession_UpdateSMContext request contains an indication that this is
due to a handover rejected by the target RAN.
16\. Step 8 from clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401
[13] is executed if the source MME determines that indirect data forwarding
applies.
##### 4.11.1.2.2.3 Execution phase {#execution-phase-1 .H6}
Figure 4.11.1.2.2.3-1 shows the Single Registration-based Interworking from
EPS to 5GS procedure.
Figure 4.11.1.2.2.3-1: EPS to 5GS handover using N26 interface, execution
phase
NOTE: Step 6 P-GW-C+SMF Registration in the UDM is not shown in the figure for
simplicity.
1 - 2. Step 9 - 11 from clause 5.5.1.2.2 (S1-based handover, normal) in TS
23.401 [13]. Different from step 9a of clause 5.5.1.2.2 (S1-based handover,
normal) in TS 23.401 [13], upon reception of Handover Command, the UE will
keep the QoS Flow context for which it did not receive the corresponding radio
resources in the NG-RAN until the QoS Flow is released by the network using
PDU Session Modification procedure in clause 4.3.3. If the QoS Flow with a
default QoS Rule of a PDU Session does not have the corresponding radio
resources in the NG-RAN, UE considers that the user plane of this PDU Session
is deactivated.
3\. Handover Confirm: the UE confirms handover to the NG-RAN.
The UE moves from the E-UTRAN and synchronizes with the target NG-RAN. The UE
may resume the uplink transmission of user plane data only for those QFIs and
Session IDs for which there are radio resources allocated in the NG-RAN.
The E-UTRAN sends DL data to the Data Forwarding address received in step 1.
If the indirect data forwarding is applied, the E-UTRAN forward the DL data to
NG-RAN via the SGW and the v-UPF. The v-UPF forwards the data packets to the
NG-RAN using the N3 Tunnel Info for data forwarding, adding the QFI
information. The target NG-RAN prioritizes the forwarded packets over the
fresh packets for those QoS flows for which it had accepted data forwarding.
If Direct data forwarding is applied, the E-UTRAN forwards the DL data packets
to the NG-RAN via the direct data forwarding tunnel.
4\. Handover Notify: the NG-RAN notifies to the target AMF that the UE is
handed over to the NG-RAN.
5\. Then the target AMF knows that the UE has arrived to the target side and
informs the MME by sending a Forward Relocation Complete Notification message.
6\. Step 14 from clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401
[13].
7\. Target AMF to SMF +PGW-C (V-SMF in the case of roaming and Home-routed
case): Nsmf_PDUSession_UpdateSMContext Request (Handover Complete Indication
for PDU Session ID). In the Home-routed roaming case, the V-SMF invokes
Nsmf_PDUSession_Update Request (V-CN Tunnel Info, Handover Complete
Indication) to SMF+PGW-C.
Handover Complete Indication is sent per each PDU Session to the corresponding
SMF +PGW-C (sent by V-SMF in the roaming and Home-routed case) to indicate the
success of the N2 Handover.
If indirect forwarding is used, a timer in SMF+PGW-C (V-SMF in the case of
roaming and Home-routed case) is started to supervise when resources in UPF
(for indirect data forwarding) shall be released.
8\. The SMF + PGW-C updates the UPF + PGW-U with the V-CN Tunnel Info,
indicating that downlink User Plane for the indicated PDU Session is switched
to NG-RAN or V-UPF in the case of roaming in Home-routed case and the CN
tunnels for EPS bearers corresponding to the PDU session can be released.
For each EPS Bearer one or more \"end marker\" is sent to Serving GW by the
UPF+PGW-U immediately after switching the path. The UPF + PGW-U starts sending
downlink packets to the V-UPF.
9\. If PCC infrastructure is used, the SMF + PGW-C informs the PCF about the
change of, for example, the RAT type and UE location.
10\. SMF +PGW-C to target AMF: Nsmf_PDUSession_UpdateSMContext Response (PDU
Session ID).
SMF +PGW-C confirms reception of Handover Complete.
\- If the SMF has not yet registered for this PDU Session ID, then the SMF
registers with the UDM using Nudm_UECM_Registration (SUPI, DNN, PDU Session
ID) for a given PDU Session as in step 4 of PDU Session Establishment
Procedure in clause 4.3.2.
11\. For home-routed roaming scenario: The V-SMF provides to the v-UPF with
the N3 DL AN Tunnel Info. This step is executed after step 7.
12\. The UE performs the EPS to 5GS Mobility Registration Procedure from step
2 in clause 4.11.1.3.3. The UE includes the UE Policy Container containing the
list of PSIs, indication of UE support for ANDSP and OSId if available. If the
UE holds a native 5G-GUTI it also includes the native 5G-GUTI as an additional
GUTI in the Registration Request. The UE shall select the 5G-GUTI for the
additional GUTI as follows, listed in decreasing order of preference:
\- a native 5G-GUTI assigned by the PLMN to which the UE is attempting to
register, if available;
\- a native 5G-GUTI assigned by an equivalent PLMN to the PLMN to which the UE
is attempting to register, if available;
\- a native 5G-GUTI assigned by any other PLMN, if available.
The additional GUTI enables the target AMF to find the UE\'s 5G security
context (if available). The target AMF provides NG-RAN with a PLMN list in the
Handover Restriction List containing at least the serving PLMN, taking into
account of the last used EPS PLMN ID and Return preferred indication as part
of the Registration procedure execution and target AMF signalling to NG-RAN.
The Handover Restriction List contains a list of PLMN IDs as specified by TS
23.501 [2].
13\. Step 19 from clause 5.5.1.2.2 (S1-based handover, normal) in TS 23.401
[13]. Step 20a - 20b from clause 5.5.1.2.2 (S1-based handover, normal) in TS
23.401 [13], with the following modification:
For the PDN connections that are not possible to be transferred to 5GS (e.g.
PDN connections are anchored in a standalone PGW), the MME initiates PDN
connection release procedure as specified in TS 23.401 [13].
14\. If indirect forwarding was used, then the expiry of the timer started at
step 7 triggers the SMF+PGW-C (V-SMF in the case of roaming and Home-routed
case) to release temporary resources used for indirect forwarding that were
allocated at steps 11 to 13 in clause 4.11.1.2.2.2.
##### 4.11.1.2.3 Handover Cancel
Instead of completing the handover procedure, the source RAN node (NG-RAN,
E-UTRAN) may at any time, during the handover procedure, up to the time when a
handover command message is sent to the UE, cancel the handover. The reason
for cancelling may be e.g. due to a timer expiration or due to other events
within the source RAN node and is initiated by sending a handover cancel
message to the source CN node (AMF or MME).
A handover cancel message shall also be sent by the source RAN node after a
handover command message is sent to the UE for the case where the handover
fails and the UE returns to the old cell or radio contact with the UE is lost.
This is done in order to release the resources reserved for the handover in
the target system.
During EPS to 5GS handover when the initial AMF has invoked a target AMF (as
described in step 8a in clause 4.11.1.2.2),
\- when the source MME has received a N26 Forward Relocation Response from the
target AMF, the MME sends N26 Cancel Relocation Request directly to the target
AMF and the initial AMF is not involved at all in the Cancel Relocation
procedure.
\- When the source MME has not received a response from the target AMF, the
MME sends N26 Cancel Relocation Request to the initial AMF:
\- if the initial AMF has already invoked the target AMF, the initial AMF
indicates the Cancel Relocation to the target AMF and the target AMF becomes
responsible of the Handover Cancellation (e.g. the target AMF initiates
Nsmf_PDUSession_UpdateSMContext request indicating Handover Cancel towards the
SMF+PGW-C(s) unless the target AMF has already indicated a Handover failure
due to prior target NG RAN rejection of the Handover);
\- otherwise the initial AMF handles the relocation cancellation.
Figure 4.11.1.2.3-1: Handover Cancel procedure
1\. When the source RAN (NG-RAN, E-UTRAN) decides to cancel the handover to
the target system, the source RAN initiates handover cancel message to the
source CN node (AMF or MME).
2\. After receiving the handover cancel message from the source RAN, if the
source CN node or the target CN node is MME, it sends a Relocation Cancel
Request message to the target CN node (MME or AMF). If both the source CN node
and target CN node are AMF, the source AMF invokes (via initial AMF if AMF re-
allocation is performed during preparation phase) the
Namf_Communication_ReleaseUEContext Request (UE Context ID) toward the target
AMF. During EPS to 5GS handover with AMF reallocation if the initial AMF has
invoked a target AMF, the initial AMF invokes the
Namf_Communication_CancelRelocateUEContext Request (UE Context ID) toward the
target AMF.
3\. The target CN node (MME or AMF) triggers release of resources towards
target RAN node. The target RAN node releases the AN resources allocated for
the handover.
4\. If the target CN node is MME, the MME sends the Delete Session Request to
the SGW/SGW-C (see clause 5.5.2.5.2 of TS 23.401 [13]).
4a. [Conditional] The SGW-C releases the corresponding resource in the SGW-U
if allocated during the handover preparation.
4b. If the target CN node is AMF, the AMF invokes the
Nsmf_PDUSession_UpdateSMContext request (Relocation Cancel Indication) toward
the SMF in non-roaming and local breakout roaming scenarios.
For home-routed roaming scenario, AMF invokes the
Nsmf_PDUSession_UpdateSMContext request (Relocation Cancel Indication) toward
the (target) V-SMF and the V-SMF invokes the Nsmf_PDUSession_Update Request
(Relocation Cancel Indication) towards the H-SMF.
Based on the Relocation Cancel Indication, the SMF(s) deletes the session
resources established during handover preparation phase in SMF(s) and UPF(s).
4c. [Conditional] The (target) V-SMF releases the corresponding resource in
the (target) V-UPF if allocated during the handover preparation.
4d. [Conditional] The (H-)SMF+PGW-C releases the corresponding resource in the
(H-)UPF+PGW-U if allocated during the handover preparation.
5\. The target CN node (MME or AMF) sends Relocation Cancel Response towards
the source CN node (AMF or MME).
6\. The source CN node (AMF or MME) responds with handover cancel ACK towards
the source RAN.
7\. [Conditional] If target CN node is AMF and the source CN is MME and
indirect forwarding tunnel had been set up during handover preparation phase
then cancellation of handover triggers the MME to release the temporary
resources used for indirect forwarding.
7b. [Conditional] If the source CN is AMF and the target CN node is MME and if
indirect forwarding tunnel had been setup during handover preparation phase,
then cancellation of handover triggers the AMF to release the session
resources established during handover preparation phase in SMF(s) and UPF(s).
\- The AMF invokes the Nsmf_PDUSession_UpdateSMContext request (Relocation
Cancel Indication) toward the SMF in non-roaming and local breakout roaming
scenarios.
\- For home-routed roaming scenario, the AMF invokes the
Nsmf_PDUSession_UpdateSMContext request (Relocation Cancel Indication) toward
the V-SMF and the V-SMF invokes the Nsmf_PDUSession_Update Request (Relocation
Cancel Indication) towards the H-SMF.
Based on the Relocation Cancel Indication, the SMF(s) deletes the session
resources established during handover preparation phase in SMF(s) and UPF(s).
7c. [Conditional] In home routed roaming case, the V-SMF releases the
corresponding resource in the target V-UPF if allocated during the handover
preparation.
7d. [Conditional] In non-roaming or LBO case, the SMF+PGW-C releases the
corresponding resource in the UPF+PGW-U if allocated during the handover
preparation.
8\. [Conditional] If target CN node is MME and indirect forwarding tunnel is
setup during handover preparation phase then cancellation of handover triggers
the target MME to release the temporary resources used for indirect
forwarding.
8a. [Conditional] The SGW-C releases the resources for indirect forwarding in
the SGW-U if allocated during the handover preparation.
#### 4.11.1.3 Idle Mode Mobility procedures
##### 4.11.1.3.1 General
When a UE moves from EPC to 5GC, the UE always performs Registration
procedure.
When a UE moves from 5GC to EPC, the UE performs either Tracking Area Update
or Initial Attach.
The UE performs Tracking Area Update procedure if
\- Both the UE and the EPC support \"attach without PDN connectivity\", or
\- The UE has at least one PDU Session for which Session Continuity is
supported during interworking, i.e. the UE has EPS Bearer ID and mapped EPS
QoS parameters received as described in clause 4.11.1.1.
The UE performs an initial attach procedure if
\- The UE is registered without PDU Session in 5GC or the UE is registered
only with PDU Session for which Session Continuity is not supported during
interworking to EPC; and
\- Either the UE or the EPC does not support attach without PDN connectivity.
##### 4.11.1.3.2 5GS to EPS Idle mode mobility using N26 interface
In the case of network sharing the UE selects the target PLMN ID according to
clause 5.18.3 of TS 23.501 [2].
Clause 4.11.1.3.2 covers the case of idle mode mobility from 5GC to EPC. UE
performs Tracking Area Update procedure in E-UTRA/EPS when it moves from NG-
RAN/5GS to E-UTRA/EPS coverage area.
The procedure involves a Tracking Area Update to EPC and setup of default EPS
bearer and dedicated bearers in EPC in steps 1-11 and re-activation, if
required.
Figure 4.11.1.3.2-1: 5GS to EPS Idle mode mobility using N26 interface
The TAU procedure in TS 23.401 [13] is used with the following 5GS
interaction:
1\. Step 1 from clause 5.3.3.1 (Tracking Area Update procedure with Serving GW
change) in TS 23.401 [13].
2\. Step 2 from clause 5.3.3.1 (Tracking Area Update procedure with Serving GW
change) in TS 23.401 [13] with the modification captured in clause 4.11.1.5.3.
3-4. Steps 3-4 from clause 5.3.3.1 (Tracking Area Update procedure with
Serving GW change) in TS 23.401 [13].
5a. The AMF verifies the integrity of the TAU request message:
The AMF determines for a PDU Session whether to retrieve context including
mapped UE EPS connection from V-SMF (in the case of HR roaming) or from the
SMF+PGW-C (in the case of non roaming or LBO roaming) as follows:
\- If the AMF determines that one or more of the EBI(s) can be transferred,
the AMF sends Nsmf_PDUSession_ContextRequest to the V-SMF or SMF+PGW-C and
includes in the message EBI value(s) if any that cannot be transferred.
\- The EBI values(s) that cannot be transferred is determined by the AMF if
the target MME does not support 15 EPS bearers, i.e. the AMF determines the
EBI values in range 1-4 as not to be transferred to EPS and if there are still
more than 8 EBI values associated with PDU Sessions, the AMF then determines
EBI value(s) not to be transferred to EPS based on S-NSSAI and ARP as
specified in clause 5.17.2.2.1 of TS 23.501 [2].
\- The AMF does not retrieve the context for a PDU Session that cannot be
transferred to EPS due to no EBI allocated, or allocated EBIs not
transferrable, or combination of the two.
In non-roaming or LBO roaming, the AMF retrieves context that includes the
mapped EPS Bearer Contexts.
\- The AMF provides in Nsmf_PDUSession_ContextRequest the target MME
capability to the PGW C+SMF in the request to allow the SMF+PGW-C to determine
whether to include EPS Bearer context for Ethernet PDN type or non-IP PDN Type
or not.
\- If the AMF includes in Nsmf_PDUSession_ContextRequest EBI list not to be
transferred and if the EBI value of the QoS Flow associated with the default
QoS Rule is included in that list, the SMF+PGW-C shall not return the PDN
Connection context (which implies the whole PDU Session is not transferred to
EPS), otherwise if the EBI value of the QoS Flow associated with the default
QoS Rule is not included in the EBI list not to be transferred, the V-SMF or
SMF+PGW-C shall not provide the EPS bearer context(s) mapped from QoS Flow(s)
associated with that list.
\- When the AMF sends Nsmf_PDUSession_ContextRequest to the V-SMF or the
SMF+PGW-C, the AMF indicates whether the target MME supports User Plane
Integrity Protection with EPS.
The above steps are performed with all the SMF+PGW-Cs corresponding to PDU
Sessions of the UE which are associated with 3GPP access and have EBI(s)
allocated to them.
In Home Routed roaming, the AMF requests the V-SMF to provide SMF Context by
using Nsmf_PDUSession_ContextRequest.
NOTE 1: The AMF knows the MME capability to support 15 EPS bearers, support
User Plane Integrity Protection with EPS, Ethernet PDN Type and/or non-IP PDN
type or not through local configuration.
5b. For Non-roaming or roaming with local breakout scenario, if the CN Tunnel
Info for EPS bearer(s) have not been allocated before, the SMF sends N4
Session Modification Request to PGW-U+UPF to establish the tunnel for each EPS
bearers and PGW-U+UPF provides the PGW-U Tunnel Info for each EPS bearers to
SMF+PGW-C.
NOTE 2: In home routed roaming case, the CN Tunnel Info for each EPS bearer
has been prepared by the SMF+PGW-C and provided to the V-SMF as specified in
clause 4.11.1.4.1.
5c. For PDU Sessions that are anchored a UPF, in non-roaming or roaming with
local breakout, the SMF+PGW-C returns mapped EPS bearer contexts, which
includes PGW-C control plane tunnel information of the PDN connection
corresponding to the PDU session, EBI for each EPS bearer, PGW-U tunnel
information for each EPS bearer and EPS QoS parameters for each EPS bearer.
For PDU Sessions with PDU Session Type Ethernet, if the UE and target MME
supports Ethernet PDN type, the SMF+PGW-C provides SM Context for Ethernet PDN
Type, otherwise if the UE or target MME does not support Ethernet Type but
support non-IP Type, the SMF+PGW-C provides SM Context for non-IP PDN Type.
For PDU Sessions with PDU Session Type Unstructured, the SMF provides SM
Context for non-IP PDN Type. In home routed roaming, V-SMF provides the SM
Context.
If the UP integrity protection policy for the EPS bearer context is set to
\"Required\", the V-SMF or the PGW C+SMF shall not provide the EPS bearer
context unless the MME supports User Plane Integrity Protection with EPS and
the UE supports User Plane Integrity Protection with EPS.
For PDU Sessions that are anchored at an NEF, the SMF returns an SCEF+NEF ID
and an EBI for each PDN connection corresponding to a PDU Session.
If the SMF+PGW-C has marked that the status of one or more QoS Flows are
deleted in the 5GC but not synchronized with the UE yet according to clause
4.3.3.2, the SMF+PGW-C does not return to the AMF the EPS context(s) if all
its associated QoS Flows are marked as deleted, that is, the SMF+PGW-C returns
to the AMF the EPS bearer contexts mapped from QoS Flows where at least one of
the QoS Flow for the EPS bearer is not marked as deleted.
6\. The AMF responds with a Context Response message as in step 5 in clause
5.3.3.1 of TS 23.401 [13] carrying mapped MM context (including mapped
security context), Return preferred and SM EPS UE Context (default and
dedicated GBR bearers) to the MME. If the verification of the integrity
protection fails, the AMF returns an appropriate error cause. Return preferred
is an optional indication by the AMF of a preferred return of the UE to the
5GS PLMN at a later access change to a 5GS shared network. The AMF may start
an implementation specific (guard) timer for the UE context.
From the received context and the Tracking Area indicated by the RAN, the MME
can determine whether the UE is performing Inter-RAT mobility to or from NB-
IoT.
7 - 14. Steps 6-12 from clause 5.3.3.1 (Tracking Area Update procedure with
Serving GW change) in TS 23.401 [13] are performed with following addition and
modification:
In the step 10, if the PDU Session (PDN connection) has QoS Flows that do not
have EPS bearer ID(s) assigned, the SMF+PGW-C deletes the PCC rule(s)
associated with those QoS Flows and informs the PCF about the removed PCC
rule(s). If there are QoS Flow(s) with PCC rule(s) that do not have allocated
TFT packet filters (due to number exceeding limit), the SMF+PGW-C deletes
those PCC rule(s) and informs the PCF about the removed PCC rule(s).
In the step 10, if the MME does not indicate support of User Plane integrity
protection, or the new eNB does not support User Plane integrity protection,
or the UE does not support User Plane Integrity Protection with EPS and the UP
integrity protection policy is set to \"Required\" then the SMF+PGW-C releases
the bearers associated with the PDN CONNECTION.
In the step 11, the SMF+PGW-C requests the PGW-U+UPF to establish the tunnel
for each EPS bearer by providing SGW-U Tunnel Info.
In step 10, the SMF+PGW-C may need to report some subscribed event to the PCF
by performing an SMF initiated SM Policy Association Modification procedure as
defined in clause 4.16.5. If the mapped EPS bearers are not included in Modify
Bearer Request, the SMF+PGW-C deletes the PCC rule(s) associated with the QoS
Flows corresponding to those mapped EPS bearers.
Step 9a from clause 5.3.3.1 (Tracking Area Update procedure with Serving GW
change) in TS 23.401 [13] with the modification captured in clause 4.11.1.5.3
If the SCEF connection is to be established, the steps 9-13 are replaced with
the steps 2-3 from clause 5.13.1.2 of TS 23.682 [23]. The SCEF+NEF ID and the
EBI received from the AMF are included in the Create SCEF Connection Request.
15-15c. The HSS+UDM invokes Nudm_UECM_DeregistrationNotification to notify the
AMF associated with 3GPP access with reason as 5GS to EPS Mobility. If the
timer started in step 6 is not running, the old AMF removes the UE context.
Otherwise, the AMF may remove UE context when the timer expires.
The AMF requests the release of the PDU Session(s) which is associated with
3GPP access and not expected to be transferred to EPC, i.e. AMF requests the
release of:
\- PDU Session(s) whose corresponding SMF+PGW-C(s) are not contacted by AMF
for SM context because the AMF determines that none of EBI(s) for the PDU
Session can be transferred to EPS at step 5a; and
\- PDU Session(s) for which the SM context retrieval failed at step 5c.
The AMF requests the release of the SM context in the V-SMF only and the V-SMF
releases resource in the V-UPF, for Home Routed PDU Session with EBIs
allocated. The 5GC may also keep UE context to allow the use of native
security parameters when UE moves back from EPS to 5GS later.
If PCC is enabled, the AMF initiates AM Policy Association Termination
procedure as defined in clause 4.16.3.2 and UE Policy Association Termination
procedure as defined in clause 4.16.13.1.
Registration associated with the non-3GPP access in the AMF is not removed
(i.e. an AMF that was serving the UE over both 3GPP and non-3GPP accesses does
not consider the UE as deregistered over non 3GPP access and will remain
registered and subscribed to subscription data updates in UDM).
When the UE decides to deregister over non-3GPP access or the old AMF decides
not to maintain a UE registration for non-3GPP access anymore, the old AMF
then deregisters from UDM by sending a Nudm_UECM_Deregistration service
operation, unsubscribes from Subscription Data updates by sending an
Nudm_SDM_Unsubscribe service operation to UDM and releases all the AMF and AN
resources related to the UE.
16 - 18. Steps 17-21 from clause 5.3.3.1 (Tracking Area Update procedure with
Serving GW change) in TS 23.401 [13] with the following modification:
\- The MME may provide the eNodeB with a PLMN list in the Handover Restriction
List taking into account the last used 5GS PLMN ID and the Return preferred
indication. The Handover Restriction List contains a list of PLMN IDs as
specified by clause 5.2a of TS 23.251 [35] for eNodeB functions.
\- The MME may not release the signalling connection with the UE based on the
indication received in the step 1 that the UE is moving from 5GC.
19\. [conditional] Step 19 from clause 4.11.1.2.1 applies.
If some of the QoS Flow(s) for an EPS bearer were marked as deleted, the
SMF+PGW-C may initiate bearer modification as specified in clause 5.4.3 of TS
23.401 [13] to remove the TFT filter(s) corresponding to the Packet Filter
Set(s) in the QoS rules.
##### 4.11.1.3.2A 5GS to EPS Idle mode mobility using N26 interface with data
forwarding
Figure 4.11.1.3.2A-1 describes the idle mode mobility registration procedure
from 5GS to EPS when N26 is supported with data forwarding.
Figure 4.11.1.3.2A-1: 5GS to EPS Idle mode mobility using N26 interface with
data forwarding
1\. Steps 1-7 from clause 4.11.1.3.2 with the following enhancements:
\- The (V-)SMF includes the Buffered DL Data Waiting indication in the
Nsmf_PDUSession_Response in step 5c of figure 4.11.1.3.2-1, if the Extended
buffering timer is running in (V-)SMF.
\- The AMF forwards the Buffered DL Data Waiting indication to MME in step 6
of figure 4.11.1.3.2-1, if it\'s received from SMF above.
2\. Steps 7-9 from clause 5.3.3.1A of TS 23.401 [13].
3\. Steps 14, 15, 15a and 16 from clause 4.11.1.3.2.
4\. Steps 10-14 from clause 5.3.3.1A of TS 23.401 [13].
5\. Steps 10a, b, c from clause 4.11.1.2.1 with the following enhancements:
\- If data forwarding tunnel information (i.e. Forwarding F-TEID) is received
from MME in step 14 of figure 5.3.3.1A-1 of TS 23.401 [13] in step 4 above,
the AMF provides the data forwarding tunnel info to (V-)SMF in
Nsmf_PDUSession_UpdateSMContext Request. The (V-)SMF provides the data
forwarding tunnel info to (V-)UPF if data is buffered in (V-)UPF.
\- The (V-)SMF and (V-)UPF forwards data using the provided SGW forwarding
tunnel above. The (V-)SMF also initiates a timer to release the SM context or
data forwarding tunnel of the PDU session.
The data received by the Serving GW on the forwarding tunnel is forwarded on
the (newly) established tunnel to eNB.
6\. Step 15b from clause 4.11.1.3.2 with following enhancements:
The (V-)SMF initiates the release of data forwarding tunnel after the timer in
step 5 above is expired.
##### 4.11.1.3.3 EPS to 5GS Mobility Registration Procedure (Idle and
Connected State) using N26 interface
Figure 4.11.1.3.3-1 describes the mobility registration procedure from EPS to
5GS when N26 is supported for idle and connected states.
Figure 4.11.1.3.3-1: EPS to 5GS mobility for single-registration mode with N26
interface
1\. The Registration procedure is triggered, e.g. the UE moves into NG-RAN
coverage. Step 2 to 9 except step 5, 6 and 8 follow the Registration procedure
in clause 4.2.2 with following enhancement.
2\. The UE sends Registration Request with registration type set to \"Mobility
Registration Update\".
The UE includes 5G-GUTI mapped from EPS GUTI as the old GUTI, the native
5G-GUTI (if available) as additional GUTI and indicating that the UE is moving
from EPC. The UE includes the UE Policy Container containing the list of PSIs,
indication of UE support for ANDSP and OSId if available.
When the Registration Request is triggered due to UE mobility from EPS to 5GS,
if the UE has locally deleted the EPS bearer which has allocated 5GS
parameters and the EPS bearer status has not been synchronized with the
network, the UE shall include the EPS bearer status in the Registration
Request. If the UE has not received mapped 5GS QoS parameters from the network
for PDN connection(s), the UE locally releases those PDN connection(s).
The Additional GUTI is provided both in Idle state and Connected state, if
available. The Additional 5G-GUTI enables the AMF to retrieve the UE\'s MM
context from the old AMF (if available). The UE includes the S-NSSAIs
associated with the established PDN connections in the Requested NSSAI in RRC
and NAS (as described in clause 5.15.7 of TS 23.501 [2]). In the case of
Configured NSSAI applicable to this PLMN or an Allowed NSSAI are not present
in the UE, the associated HPLMN S-NSSAI(s) shall be provided in the mapping of
Requested NSSAI in the NAS as described in clause 5.15.5.2.1 TS 23.501 [2].
In the case of idle mode mobility the UE additionally includes a TAU request
message integrity protected using the EPS security context (for further
security verification by the MME) in the Registration Request. If the UE holds
a native 5G-GUTI for this PLMN then the UE also includes the GUAMI part of the
native 5G-GUTI in RRC to enable the NG-RAN to route the Registration Request
to the same AMF (if available) and otherwise the UE provides in RRC signalling
a GUAMI mapped from the EPS GUTI and indicates it as \"Mapped from EPS\".
The UE integrity protects the Registration Request message using a 5G security
context (if available).
3-4. Steps 2-3 of clause 4.2.2.2.2 are performed.
In the case of idle mode mobility, the AMF derives S-NSSAIs values for the
Serving PLMN based on the S-NSSAIs values for the HPLMN, received in NAS
Registration Request, associated with the established PDN connections, the AMF
may send the S-NSSAIs values for the HPLMN to NSSF by invoking
Nnssf_NSSelection_Get service operation and NSSF provides corresponding
S-NSSAIs values for VPLMN to AMF.
NOTE 1: In connected mode mobility, the AMF devices S-NSSAIs values during the
handover procedure.
Steps 5 and 8 are not performed when this procedure is part of EPS to 5GS
handover.
5a. [Conditional] This step is only performed for IDLE mode mobility. The AMF
derives the MME address and 4G GUTI from the old 5G-GUTI and sends Context
Request to MME including EPS GUTI mapped from 5G-GUTI and the TAU request
message according to TS 23.401 [13]. The MME validates the TAU message.
5b. [Conditional] If step 5a is performed, step 5 from clause 5.3.3.1
(Tracking Area Update procedure with Serving GW change) in TS 23.401 [13] is
performed with the modification captured in clause 4.11.1.5.3.
The AMF converts the received EPS MM Context into the 5GS MM Context. The
received EPS UE context includes IMSI, ME Identity, UE EPS security context,
UE Network Capability and EPS Bearer context(s) and may also include LTE-M
Indication. The MME EPS Bearer context includes for each EPS PDN connection
the IP address and FQDN for the S5/S8 interface of the SMF+PGW-C and APN. If
the SCEF connection is invoked, the MME EPS Bearer context includes the
SCEF+NEF ID of the PDN connection, EBI, APN, User Identity. The AMF disregards
any LTE-M Indication received in the EPS UE context and instead takes into
account the LTE M Indication received from NG-RAN, at step 1.
The AMF can determine the whether the UE is performing Inter-RAT mobility to
or from NB-IoT based on the received \"TAI of last TAU\" in the EPC MM Context
and the RAT Type used for the Registration Request.
If the Context Response includes the FQDN for the S5/S8 interface of the
SMF+PGW-C, the AMF queries the NRF in serving PLMN by issuing the
Nnrf_NFDiscovery_Request including the FQDN for the S5/S8 interface of the
SMF+PGW-C and the NRF provides the IP address or FQDN of the N11/N16 interface
of the SMF+PGW-C.
If the Context Response includes an SCEF+NEF ID, the AMF performs the SMF
selection.
The Context Response may include new information Return Preferred. Return
Preferred is an indication by the MME of a preferred return of the UE to the
last used EPS PLMN at a later access change to an EPS shared network. Based on
the Return Preferred indication, the AMF may store the last used EPS PLMN ID
in UE Context.
If the AMF cannot retrieve the address of the corresponding SMF for a PDN
connection, it will not move the PDN connection to 5GS.
Step 6 is performed only if the AMF is different from the old AMF and the old
AMF is in the same PLMN as the AMF.
6a. [Conditional] If the UE includes the 5G-GUTI as Additional GUTI in the
Registration Request message, the AMF sends message to the old AMF. The old
AMF validates the Registration request message.
The AMF retrieves UE\'s SUPI and MM Context, event subscription information by
each consumer NF and the list of SM PDU Session ID/associated SMF ID for the
UE using one of the following three options:
\- AMF may invoke the Namf_Communication_UEContextTransfer to the old AMF
identified by the additional 5G-GUTI; or
\- if the old AMF and the AMF are in the same AMF Set and UDSF is deployed,
AMF may invoke Nudsf_UnstructuredDataManagement_Query service operation for
the UE identified by the additional 5G-GUTI from the UDSF; or
\- if the old AMF and the AMF are in the same AMF Set, AMF may use
implementation specific means to share UE context.
6b. [Conditional] If step 6a is performed, the response is performed as
described in step 5 in clause 4.2.2.2.2. If a native 5G security context for
3GPP access is available in the AMF (or has been retrieved in step 6a), the
AMF may continue to use this security context. Otherwise, the AMF shall either
derive a mapped security context from the EPS security context obtained from
the MME or initiate an authentication procedure to the UE.
If the new AMF determines that the UE has emergency PDU Session and the AMF is
configured to allow emergency services for unauthenticated UE, the new AMF
behaves as follows:
\- If the UE has only an emergency PDU Session, the AMF either skips the
authentication and security procedure in step 7 or accepts that the
authentication may fail and continues the Mobility Registration Update
procedure; or
\- If the UE has both emergency and non emergency PDU Sessions and
authentication fails, the AMF continues the Mobility Registration Update
procedure and deactivates all the non-emergency PDU Sessions as specified in
clause 4.3.4.2.
NOTE 2: The new AMF can determine if a PDU Session is used for emergency
service by checking whether the DNN matches the emergency DNN.
7\. [Conditional] If the AMF determines to initiate the authentication
procedure to the UE in step 6b (e.g. the AMF can not obtain the UE MM context
from AMF or other reasons), steps 8-9 of clause 4.2.2.2.2 are optionally
performed.
7a. In the case of idle mode mobility, the AMF decide whether a new AMF needs
to be selected. If a new AMF is to be selected, the AMF reroute the
Registration request to the new AMF as described in clause 4.11.1.3.4, where
the initial AMF refers to the AMF.
8\. [Conditional] If step 5b is performed and the AMF accepts to serve the UE,
the AMF sends Context Acknowledge (Serving GW change indication) to MME
according to TS 23.401 [13].
9\. Steps 11-12 of clause 4.2.2.2.2 are optionally performed.
10\. Void.
11\. Steps 13-14e of clause 4.2.2.2.2 are performed: This includes that if an
MM context is retrieved from the old AMF in step 6 (i.e. corresponding to an
existing UE registration for non-3GPP access in 5GC), then the AMF indicates
to the UDM that the AMF identity to be registered in the UDM applies to both
3GPP and non-3GPP accesses by sending separate/independent
Nudm_UECM_Registration service operations for \"3GPP Access\" and \"non-3GPP
Access\".
12\. Void.
13\. Void.
14-14f. Step 16 of clause 4.2.2.2.2 (AM Policy Association Establishment) is
optionally performed.
In the home-routed roaming case and connected state mobility, based on the
S-NSSAI value for the Serving PLMN of the PDU Session(s), the AMF decides
whether V-SMF change is needed or not. If the V-SMF reallocation is not needed
and if the two values (i.e. the S-NSSAI value configured in AMF for
interworking and S-NSSAI value for the Serving PLMN) are different, the AMF
invokes Nsmf_PDUSession_UpdateSMContext (PDU Session ID, S-NSSAI value for the
Serving PLMN). The V-SMF updates 5G AN with the new S-NSSAI of VPLMN by
sending a N2 SM message to 5G AN via AMF. If the V-SMF change is needed, the
AMF performs as the case of I-SMF change defined in clause 4.23.4.3 with the
difference that I-SMF in clause 4.23.4.3 is replaced by V-SMF and with
following modifications:
\- In step 3 of clause 4.23.4.3, the AMF sends indication of no NG-RAN change
to the new V-SMF.
\- In step 4a of clause 4.23.4.3, when the new V-SMF retrieves SM context from
the old V-SMF, the new V-SMF sends indication of no NG-RAN change as it is
received in step 3.
\- In step 4b of clause 4.23.4.3, as the old V-SMF receives the indication of
no NG-RAN change, the old V-SMF returns additional N3 tunnel information of
NG-RAN.
\- In step 6 of clause 4.23.4.3, the new I-SMF should reuse the N3 tunnel
information of NG-RAN received from old I-SMF/SMF.
\- In step 9 of clause 4.23.4.3, when the new V-SMF sends a
Nsmf_PDUSession_CreateSMContext Response, the new V-SMF includes PDU Session
Resource Modify in N2 SM information.
In the home-routed roaming case and idle state mobility, the AMF selects a
default V-SMF per PDU Session and invokes Nsmf_PDUSession_CreateSMContext
service operation of the V-SMF to create an association with the AMF. It
includes UE EPS PDN Connection, MSISDN as a GPSI if received from MME, H-SMF
ID, S-NSSAI and indicates all the PDU Session(s) to be re-activated as
received in the Registration request message along with List Of PDU Sessions
To Be Activated. The S-NSSAI is the S-NSSAI configured in AMF for
interworking, which is associated with default V-SMF. The V-SMF creates the
association and based on the received SMF ID, the V-SMF invokes
Nsmf_PDUSession_Create request service operation of the H-SMF and provides the
information received from the AMF. Before invoking PDUSession_Create service
operation, the V-SMF request the V-UPF to provide the CN tunnel info.
In the home-routed roaming case and idle state mobility, the V-SMF provides
the QoS constraints of the VPLMN to the H-SMF.
The subsequent handling is performed as follows:
\- The H-SMF finds the corresponding PDU Session based on the PDN Connection
Context in the request. The H-SMF initiates N4 Session modification procedure
to establish the CN tunnel for the PDU Session. The tunnel info for PDU
Session is allocated by PGW-U+UPF and provided to the SMF+PGW-C. The H-SMF
responds V-SMF with the PDU Session ID corresponding to the PDN Connection
Context in the request, the allocated EBI(s) information, the S-NSSAI of the
PDU Session, S-NSSAI of HPLMN, UE EPS PDN connection(s) and other PDU session
parameters, such as PDU Session Type, Session AMBR in the
Nsmf_PDUSession_Create response.
\- The V-SMF updates its SM contexts and returns a
Nsmf_PDU_Session_CreateSMContextResponse message including the information
received from the H-SMF. The V-SMF updates the V-UPF of the CN tunnel info of
SMF+PGW-C. The V-SMF also includes the N2 SM Context in the response message
sent to the AMF if the corresponding PDU Session is in the received List Of
PDU Sessions To Be Activated. The V-SMF stores an association of the PDU
Session ID and the H-SMF ID. The AMF stores the V-SMF ID and it also stores
S-NSSAI and the allocated EBI(s) associated to the PDU Session ID. Based on
the S-NSSAI value for the Serving PLMN of the PDU Session(s) the AMF decides
whether V-SMF relocation is needed or not. If V-SMF relocation is not needed
and if the two values (i.e. the S-NSSAI value configured in AMF for
interworking and S-NSSAI value for the Serving PLMN) are different, the AMF
sends the S-NSSAI value for the Serving PLMN to V-SMF by invoking
Nsmf_PDUSession_UpdateSMContext service operation. The V-SMF updates NG RAN
with the S-NSSAI value for the Serving PLMN via N2 SM message. If V-SMF
relocation is needed, the AMF performs V-SMF relocation as defined in clause
4.23.4.3.
In the case of home-routed roaming scenario, the V-SMF may apply VPLMN
policies as described in TS 23.501 [2], clause 5.17.1.3.
In non-roaming and LBO cases and idle state mobility, AMF invokes
Nsmf_PDUSession_CreateSMContext Request (UE EPS PDN Connection) service
operation of the SMF+PGW-C and indicates all the PDU Session(s) to be re-
activated as received in the Registration request message along with List Of
PDU Sessions To Be Activated. This step is performed for each PDN Connection
and the corresponding SMF+PGW-C address/ID in the UE context the AMF received
in Step 6.
The SMF+PGW-C finds the corresponding PDU Session based on the PDN Connection
Context in the request.
If the P-GW-C+SMF (H-SMF in the case of home-routed roaming case) determines
that seamless session continuity from EPS to 5GS is not supported for the PDU
Session, (e.g. if PDU Session ID was not received by the SMF+PGW-C for the PDN
connection or PDU Session ID was received but mapped 5GS parameters were not
provided to the UE due to 5GS interworking not supported), then it does not
provide SM information for the corresponding PDU Session but includes the
appropriate cause code for rejecting the PDU Session transfer within the N2 SM
Information. The PDN connection(s) not further transferred to 5GC are locally
released at the SMF+PGW-C.
Otherwise, if session continuity from EPS to 5GS is supported for the PDU
Session, the SMF+PGW-C finds the corresponding PDU Session based on the PDN
Connection Context in the request. The SMF+PGW-C initiates N4 Session
modification procedure to establish the CN tunnel for the PDU Session. If the
SMF+PGW-C has not yet registered for this PDU Session ID, the SMF+PGW-C
registers with the UDM using Nudm_UECM_Registration (SUPI, DNN, PDU Session
ID) for a given PDU Session as in step 4 of PDU Session Establishment
Procedure in clause 4.3.2. The tunnel info for PDU Session is allocated by
PGW-U+UPF and provided to the SMF+PGW-C. The SMF+PGW-C updates its SM contexts
and returns the AMF a Nsmf_PDUSession_CreateSMContext Response message
including the PDU Session ID corresponding to the PDN Connection Context in
the request, the allocated EBI(s) information, the S-NSSAI of the PDU Session
and the N2 SM Context if the corresponding PDU Session is in the received List
Of PDU Sessions To Be Activated. The AMF stores an association of the PDU
Session ID and the SMF ID, S-NSSAI and the allocated EBI(s) associated to the
PDU Session ID. Based on the allocated EBI(s) information received from all
the related SMF+PGW-C for this UE, an EPS bearer status, which reflects all
existing EPS bearer, is generated by the AMF.
NOTE 3: For Connected State mobility registration, the release of CN tunnels
for EPS bearers and UDM registration for the session corresponding to the PDU
session is performed in the handover execution phase.
If the PDN Type of a PDN Connection in EPS is non-IP and it was originally
established as Ethernet PDU Session when UE was camping in 5GS (known based on
local context information that was set to PDU Session Type Ethernet in UE and
SMF), the PDU Session Type in 5GS shall be set to Ethernet by the SMF and UE.
If the PDN type of a PDN Connection in EPS is non-IP and is locally associated
in UE and SMF to PDU Session Type Unstructured, the PDU Session Type in 5GS
shall be set to Unstructured by the SMF and UE.
NOTE 4: If the non-IP PDN Type is originally established as Ethernet PDU
Session, it means that Ethernet PDN Type is not supported in EPS.
If the AMF has received the EPS Bearer Status in the Registration Request from
UE, the AMF shall send the EPS Bearer Status to all corresponding SMF+PGW-Cs.
If the SMF+PGW-C receives the EPS Bearer Status from AMF, the SMF+PGW-C shall
check whether the EPS bearer(s) has been deleted by UE but not notified to
network. If yes, the SMF+PGW-C shall release those EPS bearer(s), the
corresponding 5G QoS Rule(s) and the QoS Flow level QoS parameters locally.
If the SCEF+NEF ID is provided to the SMF, the SMF establishes the SMF-NEF
connection as described in steps 2-3 from clause 4.25.2, the SMF provides the
SCEF+NEF ID, EBI, APN, User Identity to the SCEF+NEF and the SCEF+NEF updates
the SM contexts and returns the NEF ID, PDU Session ID, DNN and User Identity
to the SMF.
If the UE is performing Inter-RAT mobility to or from NB-IoT, the (H-)SMF will
maintain, reconnect, release or leave PDU Session handling to the local VPLMN
policy in the case of roaming for each PDU session according to the \"PDU
Session continuity at inter RAT mobility\" subscription information. If the
(H-)SMF does not have \"PDU Session continuity at inter RAT mobility\" for a
PDU session, the (H-)SMF retrieves it from the UDM before determining any
action. The SMF may use local policy to determine the handling a PDU Session
if \"PDU Session continuity at inter RAT mobility\" cannot be retrieved from
the UDM.
After the step 14a, the SMF+PGW-C receives the SM context create request from
AMF and the SMF+PGW-C awares that the UE returns back from EPS. When the
SMF+PGW-C notifies the PCF for the PDU session of changing RAT from EPS to
5GS, the PCF for the PDU session checks if there exists a UE policy
association in EPS for the UE and in that case, request the termination of
such UE Policy Association to the PCF for a UE.
15 - 16a. HSS+UDM cancels the location of the UE in the MME as defined in
steps 13 - 14 from clause 5.3.3.1 (Tracking Area Update procedure with Serving
GW change) in TS 23.401 [13]. Subsequently, the steps 18 \- 19 from clause
5.3.3.1 (Tracking Area Update procedure with Serving GW change) in TS 23.401
[13] are also executed with the following modification:
According to configuration, for the PDN connections which are anchored in a
standalone PGW, the MME initiates PDN connection release procedure as
specified in TS 23.401 [13].
17-18. These steps follow the steps 21, 21b and 22 of Registration procedure
in clause 4.2.2.2.2.
The Registration Accept message shall include the updated 5G-GUTI to be used
by the UE in that PLMN over any access. If the active flag was included in the
Registration request, The AMF may provide NG-RAN with a Mobility Restriction
List taking into account the last used EPS PLMN ID and the Return preferred
indication. The Mobility Restriction List contains a list of PLMN IDs as
specified by TS 23.501 [2]. The Allowed NSSAI in the Registration Accept
message shall contain at least the S-NSSAIs corresponding to the active PDN
Connection(s) and the corresponding mapping to the HPLMN S-NSSAIs.
The AMF shall include the EPS bearer status, which is generated at step 14, in
the Registration Accept message. Based on the received EPS bearer status
information, the UE shall check whether there are QoS Flow(s) existing locally
but no associated EPS bearer(s) in the received EPS bearer status. The UE
shall locally delete the 5G QoS Rule(s) and QoS Flow level QoS parameters of
the QoS Flow(s) if the associated EPS bearer(s) do not exist in the received
EPS bearer status.
##### 4.11.1.3.3A EPS to 5GS Idle mode mobility using N26 interface with data
forwarding
Figure 4.11.1.3.3A-1 describes the idle mode mobility registration procedure
from EPS to 5GS when N26 is supported with data forwarding.
Figure 4.11.1.3.3A-1: EPS to 5GS Idle mode mobility using N26 interface with
data forwarding
1\. Step 1-7 from clause 4.11.1.3.3 with the following enhancements:
\- In step 5b of the figure 4.11.1.3.3-1, if the old MME indicates Buffered DL
Data Waiting in the Context Response (as specified in step 5 of clause
5.3.3.1A in TS 23.401 [13]).
\- For Control Plane CIoT EPS Optimisation, when the DL data is buffered in
old MME and the DL Data Expiration Time has not expired, the old MME shall
discard the buffered DL data (as specified in step of clause 5.3.3.1A in TS
23.401 [13]).
2\. Steps 9-18 from clause 4.11.1.3.3 with following enhancements:
In step 14a of the figure 4.11.1.3.3-1, the AMF forwards the Buffered DL Data
Waiting indication from above to (V-)SMF in Nsmf_PDUSession_CreateSMContext
service operation.
If the Buffered DL Data Waiting indication is provided by AMF, the (V-)SMF and
(V-)UPF shall allocate the user plane resource and include the N2 SM
information (i.e. the V-CN Tunnel-Info) in the Nsmf_PDUSession_CreateSMContext
Response towards the AMF in step 14d of the figure 4.11.1.3.3-1 to trigger the
user plane setup in NG-RAN.
NOTE: AMF may send NAS message Registration Accept in step 17 of figure
4.11-1.3.3-1 as part of the N2 message in step 3 below.
3\. AMF to NG-RAN: N2 message (N2 MM information, N2 SM information list).
If N2 SM information is received from SMF in step 2 above, the AMF sends a N2
request message to setup the user plane resource.
NG-RAN performs RRC connection Reconfiguration with the UE to setup the user
plane resource and response to AMF with N2 response message with N2 SM
information.
4\. Steps 11-13 from clause 4.11.1.2.2.2 with the following enhancement:
Based on Buffered DL Data Waiting indication received in step 2 above, the
(V-)SMF and (V-)UPF allocate data forwarding tunnel resource and provide the
CN tunnel information for data forwarding from EPS (i.e. Forwarding F TEID) in
Nsmf_PDUSession_UpdateSMContext Response to AMF in step 13 of figure
4.11.1.2.2.2-1. The (V-) SMF also starts a timer for release of resources for
data forwarding.
The (V-) SMF may select a different UPF from the serving (V-)UPF for data
forwarding.
The (V-)SMF shall not provide Charging Enforcement Rules and QoS Enforcement
Rules to the (V-)UPF for DL packets that were received via the forwarding
tunnel.
5\. Steps 14-18 from clause 5.3.3.1A in TS 23.401 [13] with following changes.
The AMF sends the Context Acknowledge message to MME as in step 14 of figure
5.3.3.1A-1 in TS 23.401 [13], including the CN tunnel information (i.e.
Forwarding F TEID) for data forwarding from EPS received from (V-)SMF in step
4 above.
The Serving GW forwards the buffered DL data to the (V-)UPF based on the
Forwarding F-TEID received from MME. The data received by the (V-)UPF on the
forwarding F-TEID is forwarded by the (V-)UPF on the (newly) established N3
tunnel to the NG-RAN.
6\. SMF to UPF: N4 Session Termination/Modification.
At the expiration of the timer started in step 4 above, the (V-) SMF starts
the release of resource established in step 4 for data forwarding and informs
the (V-)UPF.
##### 4.11.1.3.4 EPS to 5GS Mobility Registration Procedure (Idle) using N26
interface with AMF reallocation
During Idle state mobility registration procedure from EPS to 5GS, the initial
AMF may select a new AMF based on S-NSSAIs associated with the established PDU
Session, received in NAS Registration Request.
Figure 4.11.1.3.4-1: EPS to 5GS mobility with AMF re-allocation for single-
registration mode and N26 interface configuration
1\. Step 1 to 7 of clause 4.11.1.3.3 in EPS to 5GS mobility using N26
interface is performed.
2\. Step 3 to 4 of clause 4.2.2.2.3 in Registration with AMF reallocation
procedure is performed with the difference that before the Network Slice
selection the AMF needs to derive the S-NSSAI for the serving PLMN as
described in clause 5.15.5.2.1 of TS 23.501 [2].
3\. [Conditional] Initial AMF to MME: Context Acknowledge (failure cause) to
MME according to TS 23.401 [13].
The initial AMF decides a new AMF needs to be reselected. The initial AMF
sends a Context Acknowledge message with cause code indicating that the
procedure is not successful. The MME shall continue as if Context Request was
never received.
4\. Step 6 to 7 of clause 4.2.2.2.3 in Registration with AMF reallocation
procedure are performed.
5\. After receiving the Registration Request message, the new AMF continues
the registration from step 5 until step 18 of figure 4.11.1.3.3 (EPS to 5GS
mobility using N26 procedure), which includes the UE context retrieved from
old AMF. If the 5G security context is received from the initial AMF, the new
AMF continues using that one instead of the mapped 5G security context
retrieved from MME.
#### 4.11.1.4 Procedures for EPS bearer ID allocation
##### 4.11.1.4.1 EPS bearer ID allocation
Following procedures are updated to allocate EPS bearer ID(s) towards EPS
bearer(s) mapped from QoS flow(s) and provide the EPS bearer ID(s) to the NG-
RAN:
\- UE requested PDU Session Establishment (Non-roaming and Roaming with Local
Breakout (clause 4.3.2.2.1) including Request Types \"Initial Request\",
\"Existing PDU Session\", \"Initial emergency request\" and \"Existing
emergency PDU session\".
\- UE requested PDU Session Establishment (Home-routed Roaming (clause
4.3.2.2.2) including Request Types \"Initial Request\" and \"Existing PDU
Session\".
\- UE or network requested PDU Session Modification (non-roaming and roaming
with local breakout) (clause 4.3.3.2).
\- UE or network requested PDU Session Modification (home-routed roaming)
(clause 4.3.3.3).
\- UE Triggered Service Request (clause 4.2.3.2) to move PDU Session(s) from
non-3GPP access to 3GPP access
EBI allocation shall apply to PDU Session via 3GPP access supporting EPS
interworking with N26. EBI allocation shall not apply to PDU Session via 3GPP
access supporting EPS interworking without N26 and shall not apply to PDU
Session via non-3GPP access supporting EPS interworking.
Figure 4.11.1.4.1-1: Procedures for EPS bearer ID allocation
1\. Procedure as listed in this step is initiated as specified in the relevant
clauses of this specification. The relevant steps of the procedure as
specified in the figure above are executed.
2\. If the SMF+PGW-C (or H-SMF in the case of home routed case), determines,
based on the indication of EPS interworking support with N26 as defined in
clauses 4.11.5.2, 4.11.5.3 and 4.11.5.4 and operator policies e.g. User Plane
Security Enforcement information, Access Type, that EPS bearer ID(s) needs to
be assigned to the QoS flow(s) in the PDU Session, SMF+PGW-C invokes
Namf_Communication_EBIAssignment Request (PDU Session ID, ARP list) (via V-SMF
Nsmf_PDUSession_Update in the case of home routed case). When V-SMF receives
Nsmf_PDUSession_Update request from H-SMF for EPS bearer ID allocation
request, V-SMF needs to invoke Namf_Communication_EBIAssignment Request (PDU
Session ID, ARP list). If the SMF+PGW-C (or H-SMF in the case of home-routed
roaming) serves multiple PDU sessions for the same DNN but different S-NSSAIs
for a UE, then the SMF shall only request EBIs for PDU sessions served by a
common UPF (PSA). If different UPF (PSA) are serving those PDU sessions, then
the SMF chooses one of the UPF (PSA) for this determination based on operator
policy. When the PDU session is established via non-3GPP access, the SMF+PGW-C
shall not trigger EBI allocation procedure.
Steps 3 to 6 apply only when AMF needs to revoke EBI previously allocated for
an UE in order to serve a new SMF request of EBI for the same UE.
3\. [Conditional] If the AMF has no available EBIs, the AMF may revoke an EBI
that was assigned to QoS flow(s) based on the ARP(s) and S-NSSAI stored during
PDU Session establishment, EBIs information in the UE context and local
policies. If an assigned EBI is to be revoked, the AMF takes the ARP pre-
emption vulnerability and the ARP priority level into consideration and
revokes EBIs with a higher value of the ARP priority level first. The AMF
invokes Nsmf_PDUSession_UpdateSMContext (EBI(s) to be revoked) to request the
related SMF (called \"SMF serving the released resources\") to release the
mapped EPS QoS parameters corresponding to the EBI to be revoked. The AMF
stores the association of the assigned EBI, ARP pair to the corresponding PDU
Session ID and SMF address.
4\. The \"SMF serving the released resources\" that receives the request in
step 3 shall evaluate if any of the revoked EBI(s) corresponds to the QoS Flow
associated with the default QoS rule. If the revoked EBI corresponds to the
QoS Flow associated with the default QoS rule, the SMF shall release the
EBI(s) corresponding to all other QoS Flows of the PDU Session and update the
AMF of this release by sending Namf_Communication_EBIAssignment Request (PDU
Session ID, Released EBI List). Next, the SMF shall invoke
Namf_Communication_N1N2Message Transfer (N2 SM information (PDU Session ID,
EBI(s) to be revoked), N1 SM container (PDU Session Modification Command (PDU
Session ID, EBI(s) to be revoked))) to inform the (R)AN and the UE to remove
the mapped EPS QoS parameters corresponding to the EBI(s) to be revoked. In
home routed roaming scenario, the H-SMF includes EBI(s) to be revoked to V-SMF
to inform V-SMF to remove the mapped EPS bearer context corresponding to the
EBI(s) to be revoked.
NOTE 1: The SMF can also decide to remove the QoS flow if it is not acceptable
to continue the service when no corresponding EPS QoS parameters can be
assigned.
For home routed roaming scenario, the \"SMF serving the released resources\"
sends an N4 Session Modification Request to request the PGW-U+UPF to release
N4 Session corresponding to the revoked EBI(s).
In home routed roaming case, the V-SMF starts a VPLMN initiated QoS
modification for the PDU Session and the Namf_Communication_N1N2Message
Transfer is invoked by the V-SMF based on the corresponding QoS modification
message received from H-SMF.
5\. If the UE is in CM-CONNECTED state, the AMF sends N2 PDU Session Resource
Modify Request (N2 SM information received from SMF, NAS message (PDU Session
ID, N1 SM container (PDU Session Modification Command))) Message to the (R)AN.
If the UE is in CM-IDLE state and an ATC is activated, the AMF updates and
stores the UE context based on the Namf_Communication_N1N2MessageTransfer and
step 5-6 are skipped. When the UE is reachable, e.g. when the UE enters CM-
CONNECTED state, the AMF forwards the N1 message to synchronize the UE context
with the UE.
6\. The rest steps of the procedure are executed as specified in the figure
above.
7 If the AMF successfully assigns EBI(s), it responds with the assigned
EBI(s). Otherwise, it responds with a cause indicating EBI assignment failure.
If the PDU Session is associated to an S-NSSAI subject for Network Slice-
Specific Authentication and Authorization the AMF should indicate EBI
assignment failure.
If a PDU Session from another SMF already exists towards the same DNN, the AMF
either rejects the EBI assignment request, or revokes the EBI(s) from the
existing PDU Session(s) to the same DNN but different SMFs if the AMF makes
the decision based on the operator policy, that the existing PDU Session
cannot support EPS interworking N26.
The AMF stores the DNN and SMF+PGW-C in which the PDU Session(s) support EPS
interworking to UDM in clause 4.11.1.6.
NOTE 2: The above applies only when the S-NSSAI(s) for the PDU Sessions are
different, otherwise the same SMF is selected for PDU Sessions to the same
DNN.
8\. The SMF+PGW-C sends an N4 Session Establishment/Modification Request to
the PGW-U+UPF.
For home routed roaming scenario, if the EBI is assigned successfully, the
SMF+PGW-C prepares the CN Tunnel Info for each EPS bearer. For non roaming and
LBO scenario, if the EBI is assigned successfully, the SMF+PGW-C may prepare
the CN Tunnel Info for each EPS bearer.
The PGW-U+UPF allocates the PGW-U tunnel info for the EPS bearer and sends it
to the SMF+PGW-C. The PGW-U+UPF is ready to receive uplink packets from
E-UTRAN.
NOTE 3: In the home routed roaming scenario the SMF+PGW-C prepares the CN
Tunnel Info for each EPS bearer and provide it to V-SMF. Thus when the UE move
to EPC network, the V-SMF does not need interact with the SMF+PGW-C to get the
EPS bearer context(s).
9\. If the SMF+PGW-C receives any EBI(s) from the AMF, it adds the received
EBI(s) into the mapped EPS bearer context(s).
In home routed roaming scenario, the SMF+PGW-C generates EPS bearer context
which includes per EPS bearer PGW-U tunnel information. In addition, if the
default EPS bearer is generated for the corresponding PDN Connection of PDU
Session (i.e. during the PDU Session establishment procedure), the SMF+PGW-C
generates the PGW-C tunnel information of the PDN connection and include it in
UE EPS PDN connection.
9a. [Conditional] In non-roaming or LBO scenario, the SMF+PGW-C includes the
mapped EPS bearer context(s) and the corresponding QoS Flow(s) to be sent to
the UE in the N1 SM container. SMF+PGW-C also indicates the mapping between
the QoS Flow(s) and mapped EPS bearer context(s) in the N1 SM container.
SMF+PGW-C also includes the mapping between the received EBI(s) and QFI(s)
into the N2 SM information to be sent to the NG-RAN. The SMF+PGW-C sends the
N1 SM container and N2 SM information to AMF via the
Nsmf_PDUSession_UpdateSMContext Response in the case of the PDU Session
Modification procedure triggered by UE or AN, or UE Triggered Service Request
procedure that results in session transfer from N3GPP to 3GPP, otherwise, via
the Namf_Communication_N1N2MessageTransfer.
9b [Conditional] In home routed roaming scenario, the SMF+PGW-C sends mapped
EPS bearer context(s), the mapping between the received EBI(s) and QFI(s),
linked EBI and EPS bearer context(s) to V-SMF via Nsmf_PDUSession_Create
Response in the case of PDU Session Establishment, or via
Nsmf_PDUSession_Update Request in the case of PDU Session Modification. The
V-SMF stores the EPS bearer context(s) and generates N1 SM container and N2 SM
information and forwards them to AMF via the Nsmf_PDUSession_UpdateSMContext
Response in the case of the PDU Session Modification procedure triggered by UE
or AN, or UE Triggered Service Request procedure that results in session
transfer from N3GPP to 3GPP, otherwise, via the
Namf_Communication_N1N2MessageTransfer.
10\. The N1 SM container and N2 SM information are sent to the UE and NG-RAN
respectively. The relevant steps of the procedure as specified in the figure
above are executed.
##### 4.11.1.4.2 EPS bearer ID transfer
Following procedures are updated to transfer EPS bearer ID(s) allocation
information to target AMF.
\- step 14d in figure 4.11.1.3.3-1 in EPS to 5GS Idle mode mobility with N26
(clause 4.11.1.3.3).
\- step 7 in figure 4.11.1.2.2.2-1 in EPS to 5GS handover using N26 interface
prepare phase (clause 4.11.1.2.2.2).
Figure 4.11.1.4.2-1: Procedures for EPS bearer IDs transfer
1\. The AMF sends an Nsmf_PDUSession_CreateSMContext Request message to the
SMF in above case;
2\. The SMF+PGW-C to AMF: Nsmf_PDUSession_CreateSMContext Response with the
allocated EBI information.
##### 4.11.1.4.3 EPS bearer ID revocation
Following procedures are updated to revoke the EPS bearer ID(s) assigned to
the QoS flow(s):
\- UE or network requested PDU Session Release for Non-roaming and Roaming
with Local Breakout (clause 4.3.4.2).
\- UE or network requested PDU Session Release for Home-routed Roaming (clause
4.3.4.3).
\- UE or network requested PDU Session Modification (non-roaming and roaming
with local breakout) (clause 4.3.3.2).
\- UE or network requested PDU Session Modification (home-routed roaming)
(clause 4.3.3.3).
\- Handover of a PDU Session procedure from 3GPP to untrusted non-3GPP access
(non-roaming and roaming with local breakout) (clause 4.9.2.2)
\- Handover of a PDU Session procedure from 3GPP to untrusted non-3GPP access
(home routed roaming) (clause 4.9.2.4
When the PDU Session is released as described in clauses 4.3.4.2 or 4.3.4.3,
4.9.2.2, or 4.9.2.4 and the SMF invokes Nsmf_PDUSession_StatusNotify to notify
AMF that the SM context for this PDU Session is released, the AMF releases the
association between the SMF ID and the PDU Session ID and releases the EBIs
assigned for this PDU Session. When all the PDU sessions which are allocated
with EBIs are released in the same SMF, the AMF may revoke DNN and SMF+PGW-C
FQDN for S5/S8 interface in the UDM using Nudm_UECM_Update service operation.
NOTE 1: If the SMF+PGW-C in which the PDU sessions support EPS interworking is
changed for the same DNN, the AMF can update the DNN and new SMF+PGW-C FQDN
for S5/S8 interface in the UDM using Nudm_UECM_Update service operation.
When the UE initiates a PDU Session Modification as described in clauses
4.3.3.2 or 4.3.3.3 and the SMF needs to release the assigned EBI from a QoS
flow (e.g. when the QoS flow is released), the SMF can indicate the Released
EBI list in the Nsmf_PDUSession_UpdateSMContext Response to the AMF. The AMF
releases the corresponding EBI allocation for this PDU Session.
When the AMF decides to revoke some EBI(s), e.g. when the AMF receives a new
EBI allocation request but there is no EBI available, the AMF may decide to
revoke EBI(s) for another PDU Session, the AMF initiates a PDU Session
Modification as described in clauses 4.3.3.2 or 4.3.3.3 and includes EBI list
to be revoked in the Nsmf_PDUSession_UpdateSMContext Request. The SMF releases
the indicated EBI(s) for the PDU Session.
When the AMF initiates a PDU Session Modification as described in clauses
4.3.3.2 or 4.3.3.3 to change the status of EPS interworking with N26 to \"not
supported\", the AMF releases the EBIs assigned for this PDU Session and SMF
release the assigned EBIs from the QoS Flows belonging to this PDU Session.
When the SMF initiates a PDU Session Modification as described in clauses
4.3.3.2 or 4.3.3.3 and the SMF needs to release the assigned EBI from a QoS
flow (e.g. when the QoS flow is released), the SMF invokes
Namf_Communication_EBIAssignment and indicates the Released EBI list to the
AMF. The AMF releases the corresponding EBI allocation for this PDU Session.
When the handover of a PDU Session procedure from 3GPP to untrusted non-3GPP
access is performed in clause 4.9.2.2 or clause 4.9.2.4.1, the AMF, the SMF
and the UE releases locally the EBI(s) allocated for this PDU Session.
When the handover of a PDU Session procedure from 3GPP to untrusted non-3GPP
access is performed in clause 4.9.2.4.2, the H-SMF invokes
Nsmf_PDUSession_StatusNotify to notify V-AMF to release the association
between the SMF ID and the PDU Session ID and as a result, the EBI(s) assigned
for this PDU Session are released. The UE releases locally the EBI(s)
allocated for this PDU Session.
#### 4.11.1.5 Impacts to EPS Procedures
##### 4.11.1.5.1 General
This clause captures changes to procedures in TS 23.401 [13] due to
interworking with 5GS based on N26. The handover procedures between EPS and
5GS captured in clause 4.11.1.2 capture impacts to clause 5.5.1.2.2 of TS
23.401 [13] (S1-based handover, normal).
##### 4.11.1.5.2 E-UTRAN Initial Attach
The E-UTRAN Initial Attach Procedure specified in clause 5.3.2.1 of TS 23.401
[13] is impacted as shown in Figure 4.11.1.5.2-1 when interworking with 5GS
using N26 interface is supported.
Figure 4.11.1.5.2-1: Impacts to E-UTRAN Initial Attach procedure
1\. The UE sends an Attach Request message as specified in TS 23.401 [13] with
the following modifications:
\- If the UE was previously registered in 5GS, the UE provides in Access
Stratum signalling a GUMMEI mapped from the 5G-GUTI and indicates it as a
native GUMMEI and should in addition indicate it as \"Mapped from 5G-GUTI\".
\- If the UE was previously registered in 5GS, the UE provides, in the Attach
Request message, an EPS GUTI mapped from 5G-GUTI sent as old Native GUTI and
indicates that it is moving from 5GC. The UE integrity protects the Attach
Request message using the 5G security context.
\- A UE that supports 5GC NAS procedures shall indicate its support of 5G NAS
as part of its UE Core Network Capability IE.
\- If the UE includes ESM message container for PDN Connection Establishment
and the Request type is \"initial request\", the UE shall allocate a PDU
Session ID and include it in the PCO. The PDU Session ID shall be unique
across all other PDN connections of the UE.
\- MME may steer the UE from EPC by rejecting the Attach request with an
appropriate cause value. If the UE supports any of the CIoT 5GS Optimisations
included in 5GC Preferred Network Behaviour, then the UE shall include its 5GC
Preferred Network Behaviour if it included its EPC Preferred Network Behaviour
in the Attach request. The MME should take into account availability of 5GC to
the UE and the Preferred and Supported Network Behaviour (see clause 5.31.2 of
TS 23.501 [2]) before steering the UE from EPC.
2\. The relevant steps of the procedure as specified in the figure above are
executed with the following modification:
\- The HSS/UDM on receiving Update Location Request from MME, de-register any
old AMF by sending an Nudm_UECM_DeregistrationNotification service operation
to the registered AMF for 3GPP access.
\- Step 7 and step 10 as specified in clause 5.3.2.1 of TS 23.401 [13] (i.e.
IP-CAN Session Termination) is replaced by SM Policy Association Termination
procedure as specified in clause 4.16.6.
\- Step 14 as specified in clause 5.3.2.1 of TS 23.401 [13] (i.e. IP-CAN
Session Establishment/Modification) are replaced by SM Policy Association
Establishment/Modification procedure as specified in clause 4.16.4 and clause
4.16.5.
3\. Step 15 as specified in clause 5.3.2.1 of TS 23.401 [13] with the
following modification:
\- The SMF+PGW-C allocates 5G QoS parameters corresponding to PDN connection,
e.g. Session AMBR, QoS rules and QoS Flow level QoS parameters if needed for
the QoS Flow associated with the QoS rule(s) and then includes them in PCO.
4\. The relevant steps of the procedure as specified in the figure above are
executed.
5\. Step 18 as specified in clause 5.3.2.1 of TS 23.401 [13] with the
following modification:
\- The 5G QoS parameters for the PDU session and for the QoS Flow associated
with the default QoS rule are stored in the UE.
6\. The relevant steps of the procedure as specified in the figure above are
executed.
##### 4.11.1.5.3 Tracking Area Update
The following changes are applied to clause 5.3.3.1 (Tracking area update
procedure with Serving GW change) in TS 23.401 [13]:
\- Step 2: The UE shall in Access Stratum signalling include GUMMEI that is
mapped from 5G-GUTI following the mapping rules specified in TS 23.501 [2] and
the UE indicates it as a native GUMMEI and should in addition indicate it as
\"Mapped from 5G-GUTI\". The UE shall, in the TAU request message, include EPS
GUTI that is mapped from 5G-GUTI following the mapping rules specified in TS
23.501 [2]. The UE indicates that it is moving from 5GC. The UE integrity
protects the TAU request message using the 5G security context. If the UE
supports any of the CIoT 5GS Optimisations included in 5GC Preferred Network
Behaviour, then the UE shall include its 5GC Preferred Network Behaviour if it
included its EPC Preferred Network Behaviour in the TAU request.
MME may steer the UE from EPC by rejecting the TAU request with an appropriate
cause value. The MME should take into account availability of 5GC to the UE
and the Preferred and Supported Network Behaviour (see clause 5.31.2 of TS
23.501 [2]) before steering the UE from EPC.
\- Step 5 and message Context Response may include new information Return
preferred.
Return preferred is an indication by the AMF of a preferred return of the UE
to the last used 5GS PLMN at a later access change to a 5GS shared network.
RFSP in Use Validity Time is provided by the AMF to the MME if the AMF selects
the RFSP Index in use identical to the authorized RFSP Index as specified in
clause 5.4.3.4 of TS 23.501 [2] and validity time is received from PCF as
specified in clause 4.16.2.2 and in clause 6.1.2.1 of TS 23.503 [20]. The MME
handles RFSP Index as specified in clause 4.11.1.5.8.
The MME may store the last used 5GS PLMN ID in UE\'s MM Context.
The MME may provide E-UTRAN with a Handover Restriction List taking into
account the last used 5GS PLMN ID and the Return Preferred indication. The
Handover Restriction List contains a list of PLMN IDs as specified by TS
23.251 [35].
\- Step 9a IPâ€‘CAN Session Modification procedure:
It is replaced by SM Policy Association Modification as specified in clause
4.16.5.
\- Step 13 and HSS use of Cancel Location
The HSS/UDM de-registers any old AMF node by sending an
Nudm_UECM_DeregistrationNotification service operation to the registered AMF
for 3GPP access. The registered AMF for 3GPP access initiates AM Policy
Association Termination procedure as defined in clause 4.16.3.2 and UE Policy
Association Termination procedure as defined in clause 4.16.13.1.
\- Step 17: If the DNN and SMF+PGW-C FQDN for S5/S8 interface association
exist, the HSS/UDM sends APN mapped form DNN and SMF+PGW-C FQDN for S5/S8 to
UE.
\- Step 20 and MME processing of the partial Tracking Area Update (TAU)
procedure.
The MME may use an indication Return preferred from Context Response at step 6
when deciding the PLMN list content.
The MME may provide the eNodeB with a PLMN list. The Handover Restriction List
contains a list of PLMN IDs as specified by TS 23.501 [2].
##### 4.11.1.5.4 Session Management
##### 4.11.1.5.4.1 PDN Connection Request {#pdn-connection-request .H6}
The UE Requested PDN Connectivity Procedure specified in clause 5.10.2 of TS
23.401 [13] is impacted as shown in in Figure 4.11.1.5.4.1-1 when interworking
with 5GS is supported.
Figure 4.11.1.5.4.1-1: Impacts to UE Requested PDN Connectivity Procedure
1\. UE sends a PDN connectivity Request to the MME as specified in Step 1 in
clause 5.10.2 of TS 23.401 [13] with the following modification:
\- If the UE is 5G NAS capable and the Request type is \"initial request\",
the UE shall allocate a PDU Session ID and include it in the PCO. The PDU
Session ID shall be unique across all other PDN connections of the UE.
2\. The relevant steps of the procedure as specified in the figure above are
executed. In step 4 of TS 23.401 [13], IP Session Establishment/Modification
procedure is replaced by SM Policy Association Establishment/Modification
procedure as specified in clauses 4.16.4 and 4.16.5.
3\. Step 6 as specified in clause 5.10.2 of TS 23.401 [13] is executed with
the following modification:
\- If the SMF+PGW-C accepts to provide interworking of the PDN connection with
5GC, the SMF+PGW-C shall allocate 5G QoS parameters corresponding to PDN
connection, e.g. Session AMBR, QoS rules and QoS Flow level QoS parameters if
needed for the QoS Flow(s) associated with the QoS rule(s) and then include
them in PCO.
\- If the SMF+PGW-C accepts to provide interworking of the PDN connection with
5GC, the SMF+PGW-C shall determine the S-NSSAI associated with the PDN
connection based on the operator policy and send the S-NSSAI together with the
PLMN ID to the UE in the PCO.
\- If the SMF+PGW-C accepts to provide interworking of the PDN connection with
5GC the SMF+PGW-C, if Small Data Rate Control is used, provides the Small Data
Rate Control parameters to the UE in the PCO.
4\. The relevant steps of the procedure as specified in the figure above are
executed.
5\. Step 8 as specified in clause 5.10.2 of TS 23.401 [13] with the following
modification:
\- If 5G QoS parameters are included in the PCO, the UE shall store them. If
5G QoS parameters are not included in the PCO, the UE shall note that session
continuity for this PDN connection on mobility to 5G is not provided by the
network.
\- If the S-NSSAI and the PLMN ID associated with the PDN connection are
included in the PCO, the UE shall store them.
\- If the Small Data Rate Control parameters are included in the PCO, the UE
shall store them.
6\. The relevant steps of the procedure as specified in the figure above are
executed.
##### 4.11.1.5.4.2 UE or MME Requested PDN Disconnection {#ue-or-mme-
requested-pdn-disconnection .H6}
The procedure as specified in clause 5.10.3 of TS 23.401 [13] applies with the
following modification:
Step 8. (RRC Connection Reconfiguration): On receiving the NAS Deactivate EPS
Bearer Context Request(LBI) message, if the UE has mapped 5G parameters for
the PDU session, the UE deletes the corresponding mapped 5GS PDU session.
In addition if the SMF+PGW-C has registered to HSS+UDM for this PDN connection
before, the SMF+PGW-C invokes the Nudm_UECM_Deregistration service operation
to notify the UDM to remove the association between the SMF+PGW-C identity and
the associated DNN and PDU Session Id as described in the step 12 of clause
4.3.4.2. If there is no PDN connection for the associated (DNN, S-NSSAI)
handled by the SMF+PGW-C, the SMF+PGW-C unsubscribes from Session Management
Subscription data changes notification with the HSS+UDM by means of the
Nudm_SDM_Unsubscribe (SUPI, DNN, S-NSSAI) service operation as described in
step 12 of clause 4.3.4.2.
##### 4.11.1.5.4.3 Dedicated Bearer Activation, Bearer Modification and Bearer
Deactivation {#dedicated-bearer-activation-bearer-modification-and-bearer-
deactivation .H6}
The procedures specified in clauses 5.4.1 through 5.4.5 of TS 23.401 [13]
apply with the following modifications:
\- PCRF initiated IP-CAN Modification in TS 23.401 [13] is replaced with PCF
initiated SM Policy Association Modification as specified in clause 4.16.5.2.
PCEF initiated IP-CAN Session Modification/Termination TS 23.401 [13] is
replaced with SM Policy Association Modification/Termination as specified in
clauses 4.16.5 and 4.16.6.
\- In the step where the PDN-GW sends a Create Bearer Request, i.e.:
\- Step 2 in clause 5.4.1 of TS 23.401 [13] (Dedicated Bearer Activation).
the PCO includes mapped 5GS QoS parameters for the EPS bearer being created.
\- In the step where the PDN-GW sends an Update Bearer Request, i.e.:
\- Step 2 in clause 5.4.2.1 of TS 23.401 [13] (PDN GW initiated bearer
modification with bearer QoS update).
\- Step 5 in clause 5.4.2.2 of TS 23.401 [13] (HSS Initiated Subscribed QoS
Modification).
\- Step 2 in clause 5.4.3 of TS 23.401 [13] (PDN GW initiated bearer
modification without bearer QoS update) if TFT or APN-AMBR is being modified.
the PCO includes the modification to the mapped 5GS QoS parameters, if
impacted by the modification, corresponding to the EPS bearer being modified.
\- In the step where the UE receives the NAS Session Management message from
the MME which contains the PCO relayed via the MME, i.e.:
\- Step 5 in clause 5.4.1 of TS 23.401 [13] (Dedicated Bearer Activation).
\- Step 5 in clause 5.4.2.1 of TS 23.401 [13] (PDN GW initiated bearer
modification with bearer QoS update).
\- Step 5 in clause 5.4.3 of TS 23.401 [13] (PDN GW initiated bearer
modification without bearer QoS update) if TFT or APN-AMBR is being modified.
the UE updates the mapped 5G QoS parameters as included in the PCO from the
PDN-GW.
\- In the step where the UE receives EPS bearer request message, i.e.:
\- Step 5 in clause 5.4.4.1 of TS 23.401 [13] (PDN GW initiated bearer
deactivation).
the UE also deletes the mapped 5GS QoS flow and its associated parameter.
##### 4.11.1.5.5 5GS to EPS handover using N26 interface
In step 3 of clause 4.11.1.2.1, the Forward Relocation Request may include new
information Return Preferred.
Return Preferred is an indication by the AMF of a preferred return of the UE
to the last used 5GS PLMN at a later access change to a 5GS shared network.
RFSP in Use ValidityTime is provided by the AMF to the MME if the AMF selects
the RFSP Index in use identical to the authorized RFSP Index as specified in
clause 5.4.3.4 of TS 23.501 [2] and validity time is received from PCF as
specified in clause 4.16.2.2 and in clause 6.1.2.1 of TS 23.503 [20]. The MME
handles RFSP Index as specified in clause 4.11.1.5.8.
The MME may store the last used 5GS PLMN ID in UE\'s MM Context.
The MME may provide E-UTRAN with a Handover Restriction List taking into
account the last used 5GS PLMN ID and the Return Preferred indication. The
Handover Restriction List contains a list of PLMN IDs as specified by TS
23.251 [35].
##### 4.11.1.5.6 UE triggered Service Request
The following changes are applied to clause 5.3.4.1 (UE triggered Service
Request) in TS 23.401 [13]:
\- Step 4: MME may steer the UE from EPC by rejecting the service request with
an appropriate cause value. The MME should take into account availability of
5GC to the UE and the Preferred and Supported Network Behaviour (see clause
5.31.2 of TS 23.501 [2]) before steering the UE from EPC.
##### 4.11.1.5.7 Establishment of S1-U bearer during Data Transport in Control
Plane CIoT EPS Optimisation
The following changes are applied to clause 5.3.4B.4 (Establishment of S1-U
bearer during Data Transport in Control Plane CIoT EPS Optimisation) in TS
23.401 [13]:
\- Step 3: MME may steer the UE from EPC by rejecting the Control Plane
Service Request with an appropriate cause value. The MME should take into
account availability of 5GC to the UE and the Preferred and Supported Network
Behaviour (see clause 5.31.2 of TS 23.501 [2]) before steering the UE from
EPC.
##### 4.11.1.5.8 Radio Resource Management functions and Information Storage
The following changes are applied to clause 4.3.6 (Radio Resource Management
functions) in TS 23.401 [13]:
\- At 5GS to EPS mobility or during inter-MME mobility, if RFSP in Use
ValidityTime is received from the AMF or the old MME, the new MME uses the
received RFSP Index in use by the time indicated in RFSP in Use ValidityTime.
Only when RFSP in Use ValidityTime expires, the MME re-evaluates the RFSP
Index in use as in clause 4.3.6 of TS 23.401 [13].
NOTE: RFSP in Use ValidityTime is the validity time that is sent by the AMF to
the MME as specified in clause 5.17.2.2 of TS 23.501 [2].
The following new parameter is to be added in Table 5.7.2-1 of TS 23.401 [13]:
Table 5.7.2-1: MME MM and EPS bearer Contexts
Field Description
* * *
RFSP in Use Validity Time Defines the validity period of RFSP Index in Use.
The MME shall not re-evaluate the RFSP Index in Use before RFSP in Use
Validity Time expires.
#### 4.11.1.6 EPS interworking information storing Procedure
Depending on the operator\'s configuration, the AMF serving the 3GPP access
store DNN and SMF+PGW-C FQDN for S5/S8 interface in the UDM using
Nudm_UECM_Update service operation when N26 is deployed.
### 4.11.2 Interworking procedures without N26 interface
#### 4.11.2.1 General
Clause 4.11.2 defines the procedures to support interworking between 5GS and
EPS without any N26 interface between AMF and MME.
During interworking from EPS to 5GS, as the SMF+PGW-C may have different IP
addresses when being accessed over S5/S8 and N11/N16 respectively, the AMF
shall discover the SMF instance by an NF/NF service discovery procedure using
the FQDN for the S5/S8 interface received from the UDM as a query parameter.
This is required for both non-roaming and roaming with local breakout, as well
as for home routed roaming.
NOTE: As the AMF is not aware of the S-NSSAI assigned for the PDN Connection,
the NF/NF service discovery used to find the SMF instance can use PLMN level
NRF.
#### 4.11.2.2 5GS to EPS Mobility
The following procedure is used by UEs in single-registration or dual
registration mode on mobility from 5GS to EPS.
In the case of network sharing the UE selects the target PLMN ID according to
clause 5.18.3 of TS 23.501 [2].
Figure 4.11.2.2-1: Mobility procedure from 5GS to EPS without N26 interface
The UE operating in single-registration mode can start the procedure from Step
1 or Step 5. The UE operating in dual-registration mode starts the procedure
from Step 5.
NOTE 1: The network has indicated the \" Interworking without N26\" to the UE.
To support IP address preservation, the UE in single-registration mode starts
the procedure from Step 5. If the UE in single-registration mode starts the
procedure from Step 1, the IP address preservation is not provided.
0\. UE is registered in 5GS and established PDU sessions. The FQDN for the
S5/S8 interface of the SMF+PGW-C is also stored in the UDM by the SMF+PGW-C
during PDU Session setup in addition to what is specified in clause 4.3.2.2.1
and clause 4.3.2.2.2.
NOTE 2: At 5GS to EPS mobility, the MME use the FQDN for the S5/S8 interface
of the SMF+PGW-C to find the SMF+PGW-C and when UE moves back from EPS to 5GS,
the AMF uses FQDN for the S5/S8 interface of the SMF+PGW-C to find the
SMF+PGW-C.
1\. Step 1 as in clause 5.3.3.1 (Tracking Area Update) in TS 23.401 [13].
2\. Step 2 as in clause 5.3.3.1 (Tracking Area Update) in TS 23.401 [13] with
the following modifications:
The UE shall provide a EPS-GUTI that is mapped from the 5G-GUTI following the
mapping rules specified in TS 23.501 [2]. The UE indicates that it is moving
from 5GC.
3\. Step 3 as in clause 5.3.3.1 (Tracking Area Update) in TS 23.401 [13].
4\. If the MME determined that the old node is an AMF based on UE\'s GUTI
mapped from 5G-GUTI and the MME is configured to support 5GS-EPS interworking
without N26 procedure, the MME sends a TAU Reject to the UE.
5\. Step 1 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401 [13]
with the modifications captured in clause 4.11.2.4.1.
6\. Step 2 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401 [13].
7\. Steps 4-7 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401 [13],
with the modifications captured in clause 4.11.2.4.1.
8\. Step 8 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401 [13],
with the modifications captured in clause 4.11.2.4.1.
9\. Step 11 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401 [13],
with the following modifications:
The subscription profile the MME receives from HSS+UDM includes per DNN/APN at
most one SMF+PGW-C FQDN as described in in clause 5.17.2.1 of TS 23.501 [2].
10\. Steps 12-24 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401
[13], with the modifications as described in clause 4.11.2.4.1.
11\. Step 25 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401 [13].
12\. Step 26 as in clause 5.3.2.1 (E-UTRAN Initial Attach) in TS 23.401 [13].
13\. If the UE has remaining PDU Sessions in 5GS which it wants to transfer to
EPS and maintain the same IP address/prefix, the UE performs the UE requested
PDN Connectivity Procedure as specified in clause 5.10.2 of TS 23.401 [13] and
sets the Request Type to \"handover\" or \"handover of emergency bearer
services\" in Step 1 of the procedure with modification captured in clause
4.11.2.4.2. UE provides an APN and the PDU Session ID corresponding to the PDU
Session it wants to transfer to EPS. The UE provides the PDU Session ID in PCO
as described in clause 4.11.1.1.
UEs in single-registration mode performs this step for each PDU Session
immediately after completing the E-UTRAN Initial Attach procedure. UEs in
dual-registration mode may perform this step any time after the completing of
E-UTRAN Initial Attach procedure. Also, UEs in dual-registration mode may
perform this step only for a subset of PDU Sessions.
The MME determines the SMF+PGW-C address for the Create Session Request based
on the APN if received from the UE, local Emergency Configuration Data (as in
clause 4.11.0a.4) and the subscription profile which may include the Emergency
Information received from the HSS+UDM in Step 9 or when the HSS+UDM notifies
the MME for the new SMF+PGW-C ID in the updated subscription profile.
The SMF+PGW-C uses the PDU Session ID to correlate the transferred PDN
connection with the PDU Session in 5GC.
As a result of the procedure the PGW-U+UPF starts routing DL data packets to
the Serving GW for the default and any dedicated EPS bearers established for
this PDN connection.
14\. For Non-Roaming case and Roaming with Local Breakout, the SMF+PGW-C
initiates release of the PDU Session(s) in 5GS transferred to EPS as specified
in clause 4.3.4.2 with the following clarification:
\- In step 2, the SMF+PGW-C shall not release IP address/prefix(es) allocated
for the PDU Session;
\- If UP connection of the PDU Session is not active, step 3b is not executed,
thus the steps triggered by step 3b are not executed;
If UP connection of the PDU Session is active, the SMF invokes the
Namf_Communication_N1N2MessageTransfer service operation in step 3b without
including N1 SM container (PDU Session Release Command);
\- In step 11, Nsmf_PDUSession_SMContexStatusNotify service operation invoked
by the SMF to notify AMF that the SM context for this PDU Session is released
due to handover to EPS.
For Home Routed roaming, the SMF+PGW-C initiates release of the PDU Session(s)
in 5GS transferred to EPS as specified in clause 4.3.4.3 with the following
clarification:
\- In step 3a, the H-SMF invokes the Nsmf_PDUSession_Update service operation
without including N1 SM container (PDU Session Release Command);
\- In step 16a, Nsmf_PDUSession_StatusNotify operation invoked by H-SMF to
notify the V-SMF that the PDU session context is released due to handover to
EPS;
\- In step 16b, Nsmf_PDUSession_SMContexStatusNotify service operation invoked
by the V-SMF to notify AMF that the SM context for this PDU Session is
released due to handover to EPS.
#### 4.11.2.3 EPS to 5GS Mobility
The following procedure is used by UEs in single-registration mode on mobility
from EPS to 5GS.
In the case of network sharing the UE selects the target PLMN ID according to
clause 5.18.3 of TS 23.501 [2].
This procedure is also used by UEs in dual-registration mode to perform
registration in 5GS when the UE is also registered in EPC. The procedure is
the General Registration procedure as captured in clause 4.2.2. Difference
from that procedure are captured below.
The UE has one or more ongoing PDN connections including one or more EPS
bearers. During the PDN connection establishment, the UE allocates the PDU
Session ID and sends it to the SMF+PGW-C via PCO, as described in clause
4.11.1.1.
Figure 4.11.2.3-1: Mobility procedure from EPS to 5GS without N26 interface
0\. The UE is attached in EPC as specified in clause 4.11.2.4.1.
1\. Step 1 in clause 4.2.2.2.2 (General Registration) with the following
clarifications:
The UE indicates that it is moving from EPC. The UE in single registration
mode provides the Registration type set to \"mobility registration update\", a
5G-GUTI mapped from the 4G-GUTI and a native 5G-GUTI (if available) as an
Additional GUTI. The UE includes the UE Policy Container containing the list
of PSIs, indication of UE support for ANDSP and OSId if available. The UE
shall select the 5G-GUTI for the additional GUTI as follows, listed in
decreasing order of preference:
\- a native 5G-GUTI assigned by the PLMN to which the UE is attempting to
register, if available;
\- a native 5G-GUTI assigned by an equivalent PLMN to the PLMN to which the UE
is attempting to register, if available;
\- a native 5G-GUTI assigned by any other PLMN, if available.
The UE in dual registration mode provides the Registration type set to
\"initial registration\" and a native 5G-GUTI or SUCI. In single registration
mode, the UE also includes at least the S-NSSAIs (with values for the Serving
PLMN) associated with the established PDN connections in the Requested NSSAI
in RRC Connection Establishment.
2\. Step 2 as in clause 4.2.2.2.
3\. Step 3 as in clause 4.2.2.2.2 (General Registration), with the following
modifications:
If the Registration type is \"mobility registration update\" and the UE
indicates that it is moving from EPC in step 1 and the AMF is configured to
support 5GS-EPS interworking procedure without N26 interface, the AMF treats
this registration request as \"initial Registration\" and the AMF skips the
PDU Session status synchronization.
NOTE 1: The UE operating in single registration mode includes the PDU Session
IDs corresponding to the PDN connections to the PDU Session status.
If the UE has provided a 5G-GUTI mapped from 4G-GUTI in step 1 and the AMF is
configured to support 5GS-EPS interworking procedure without N26 interface,
the AMF does not perform steps 4 and 5 in clause 4.2.2.2 (UE context transfer
from the MME).
4\. Steps 4-13 as in clause 4.2.2.2.2 (General Registration), with the
following modifications:
If the UE has included an additional GUTI in the Registration Request, then
the new AMF attempts to retrieve the UE\'s security context from the old AMF
in steps 4 and 5.
If the UE\'s security context is not available in the old AMF or if the UE has
not provided an additional GUTI then the AMF retrieves the SUCI from the UE in
steps 6 and 7.
5\. Step 14 as in clause 4.2.2.2.2 (General Registration), with the following
modifications:
If the UE indicates that it is moving from EPC and the Registration type is
set to \"initial registration\" or \"mobility registration update\" in step 1
and AMF is configured to support 5GS-EPS interworking without N26 procedure,
the AMF sends an Nudm_UECM_Registration Request message to the HSS+UDM
indicating that registration of an MME at the HSS+UDM, if any, shall not be
cancelled. The HSS+UDM does not send cancel location to the old MME.
NOTE 2: If the UE does not maintain registration in EPC, upon reachability
time-out, the MME can implicitly detach the UE and release the possible
remaining PDN connections in EPC.
The subscription profile the AMF receives from HSS+UDM includes the DNN/APN
and SMF+PGW-C FQDN for S5/S8 interface for each PDN connection established in
EPC. For emergency PDU Session, the AMF receives Emergency Information
containing SMF+PGW-C FQDN from HSS+UDM.
6\. Steps 15-19c as in clause 4.2.2.2.2 (General Registration).
7\. Step 21 as in clause 4.2.2.2.2 (General Registration) with the following
modifications:
The AMF includes an \"Interworking without N26\" indicator to the UE.
If the UE had provided PDU Session Status information in step 1, the AMF Sets
the PDU Session Status to not synchronized.
8\. Step 22 as in clause 4.2.2.2.2 (General Registration)
9\. UE requested PDU Session Establishment procedure as in clause 4.3.2.2.1.
If the UE had setup PDN Connections in EPC which it wants to transfer to 5GS
and maintain the same IP address/prefix and the UE received \"Interworking
without N26\" indicator in step 7, the UE performs the UE requested PDU
Session Establishment Procedure as in clause 4.3.2.2 and sets the Request Type
to \"Existing PDU Session\" or \"Existing Emergency PDU Session\" in step 1 of
the procedure. The UE provides a DNN for non-emergency PDU Session, the PDU
Session ID and S-NSSAI corresponding to the existing PDN connection it wants
to transfer from EPS to 5GS. The S-NSSAI is set as described in clause
5.15.7.2 of TS 23.501 [2].
If the Request Type indicates \"Existing Emergency PDU Session\", the AMF
shall use the Emergency Information received from the HSS+UDM which contains
SMF+PGW-C FQDN for S5/S8 interface for the emergency PDN connection
established in EPS and the AMF shall use the S-NSSAI locally configured in
Emergency Configuration Data.
UEs in single-registration mode performs this step for each PDN connection
immediately after the step 8. UEs in dual-registration mode may perform this
step any time after step 8. Also, UEs in dual-registration mode may perform
this step only for a subset of PDU Sessions. The AMF determines the S5/S8
interface of the SMF+PGW-C for the PDU Session based on the DNN received from
the UE and the SMF+PGW-C ID in the subscription profile received from the
HSS+UDM in step 5 or when the HSS+UDM notifies the AMF for the new SMF+PGW-C
ID in the updated subscription profile. The AMF queries the NRF in serving
PLMN by issuing the Nnrf_NFDiscovery_Request including the FQDN for the S5/S8
interface of the SMF+PGW-C and the NRF provides the IP address or FQDN of the
N11/N16 interface of the SMF+PGW-C. The AMF invokes the
Nsmf_PDUSession_CreateSMContext service with the SMF address provided by the
NRF. The AMF includes the PDU Session ID to the request sent to the SMF+PGW-C.
The SMF+PGW-C uses the PDU Session ID to determine the correct PDU Session.
After step 16a of Figure 4.3.2.2.1-1 in clause 4.3.2.2.1, user plane is
switched from EPS to 5GS.
As specified clause 4.3.2.2, if the SMF has not yet registered for the PDU
Session ID, then the SMF registers with the UDM using Nudm_UECM_Registration
(SUPI, DNN, PDU Session ID) and if Session Management Subscription data for
corresponding SUPI, DNN and S-NSSAI is not available, then SMF retrieves the
Session Management Subscription data using Nudm_SDM_Get (SUPI, Session
Management Subscription data, DNN, S-NSSAI) and subscribes to be notified when
this subscription data is modified using Nudm_SDM_Subscribe (SUPI, Session
Management Subscription data, DNN, S-NSSAI).
NOTE 3: The SMF can, instead of the Nudm_SDM_Get service operation, use the
Nudm_SDM_Subscribe service operation with an Immediate Report Indication that
triggers the UDM to immediately return the subscribed data if the
corresponding feature is supported by both the SMF and the UDM.
10\. The SMF+PGW-C performs release of the resources in EPC for the PDN
connections(s) transferred to 5GS by performing the PDN GW initiated bearer
deactivation procedure as defined in clause 5.4.4.1 of TS 23.401 [13], except
the steps 4-7.
#### 4.11.2.4 Impacts to EPS Procedures
##### 4.11.2.4.1 E-UTRAN Attach
Impact on clause 5.3.2.1 of TS 23.401 [13] from adding support for the
optional network functionality dual registration mode:
\- Step 1:
The UE constructs the Attach Request message according to the following
principles:
\- If UE operates in single-registration mode, the UE indicates that it is
moving from 5GC and provides a native 4G-GUTI or a 4G-GUTI mapped from 5G GUTI
(indicated as native GUTI), if available, otherwise the IMSI, or
\- If the UE operates in dual-registration mode, the UE indicates that it is
moving from 5GC and provides native 4G-GUTI, or
\- If the UE sent a TAU in step 2 and it was rejected because the MME could
not derive the UE identity, the UE provides IMSI.
If the UE wants to transfer a PDU Session to EPC as part of the Attach
procedure, it includes a PDN CONNECTIVITY Request message in the Attach
Request and provides a Request type \"Handover\", DNN/APN and PDU Session ID
of the PDU Session (clause 5.3.2.1 of TS 23.401 [13]). The UE provides the PDU
Session ID in PCO as described in clause 4.11.1.1. For PDU Session of Ethernet
Type, if the UE and the network support Ethernet PDN Type in EPS which is
negotiated during PDU Session Establishment as described in clause 4.11.5, the
UE includes PDN Type Ethernet in PDN CONNECTIVITY Request message.
If the UE supports URSP provisioning in EPS, the UE also includes the
Indication of URSP Provisioning Support in EPS PCO in the first PDN
CONNECTIVITY Request as described in clause 5.17.8 of TS 23.501 [2].
If the TAU was rejected in step 2 the IP address preservation is not provided.
In this case the UE provides IMSI in the Attach Request and does not provide a
Request Type \"Handover\" in the PDN CONNECTIVITY Request if included in the
Attach Request.
The UE provides an EPS bearer ID for all mapped EPS bearers in the EPS bearer
status. For the initial Attach Request the EPS bearer status is empty.
NOTE 1: The UE is aware the network is configured to support 5GS-EPS
interworking without N26 procedure. The UE does not include the EPS bearer IDs
corresponding to the 5G QoS flows to the EPS bearer status.
If the UE supports 5GC NAS procedures (see clause 5.17.2 of TS 23.501 [2]),
then the UE shall indicate its support of 5G NAS in a NAS indicator.
\- Step 3:
If the UE provided a 4G-GUTI mapped from 5G-GUTI and the MME is configured to
support 5GS-EPS interworking without N26 procedure, the MME does not perform
step 3, Identification Request to old MME/SGSN/AMF in clause 5.3.2.1 of TS
23.401 [13].
NOTE 2: As the 4G-GUTI mapped from 5G-GUTI is unknown identity to the MME, the
MME sends an Identity Request to the UE to request the IMSI. The UE responds
with Identity Response (IMSI).
\- Step 8:
If the UE indicates that it is moving from 5GC (Attach Request) and the MME is
configured to support 5GS-EPS interworking without N26 procedure, the MME
sends an Update Location Request message to the HSS+UDM indicating that
registration of an AMF at the HSS+UDM, if any, shall not be cancelled. The
HSS+UDM does not send Nudm_UECM_DeregistrationNotification to the old AMF.
NOTE 3: If the UE does not maintain registration in 5GC, upon reachability
time-out, the AMF can implicitly detach the UE and release the possible
remaining PDU Sessions in 5GC.
\- Step 11:
The HSS+UDM selects one of the SMF+PGW-C FQDN for one APN based on operator\'s
policy. The HSS+UDM sends selected SMF+PGW-C FQDN along with APN to the MME
for the UE.
\- Step 12:
The MME determines the SMF+PGW-C address for the Create Session Request based
on the APN received from the UE and the subscription profile received from the
HSS+UDM.
\- Step 13:
The SMF+PGW-C uses the PDU Session ID received from the UE in PCO to correlate
the transferred PDN connection with the PDU Session in 5GC.
In this release, if the Handover Indication is present in the Create Session
Request and the SMF+PGW-C detects it corresponds to a PDU Session for a LADN
in 5GC, the SMF+PGW-C rejects the request.
\- Step 14:
IP-CAN Session Modification procedure is replaced by SM Policy Association
Modification Procedure as described in clause 4.16.5.
\- Step 17:
If the UE indicated support for 5GC NAS procedures (see clause 5.11.3) and the
MME supports procedures for interworking with 5GC without N26, the MME may
indicate in the Attach Accept, that interworking without N26 is supported. UE
handling of this indicator is defined in TS 23.501 [2].
\- Step 23a:
As a result of the procedure the PGW-U+UPF starts routing DL data packets to
the Serving GW for the default and any dedicated EPS bearers established for
this PDN connection.
\- Step 25:
Notify Request is sent to HSS/UDM if the network supports the procedures for
5GC interworking without N26 and that the UE is allowed to access 5GC
(condition that is identified based on the subscription data). For emergency
attach, Notify Request is sent to HSS/UDM if the network supports the
procedures for 5GC interworking without N26 and operator policy allows
handover of emergency session to 5GS.
##### 4.11.2.4.2 Session Management
##### 4.11.2.4.2.1 PDN Connection Request {#pdn-connection-request-1 .H6}
Same procedure as specified in clause 4.11.1.5.4.1 is used with the following
clarification:
Step 6. The relevant steps of the procedure as specified in the figure above
are executed with the following modification:
\- Additional condition to trigger Notify Request to HSS in step 15 of Figure
5.10.2-1 in TS 23.401 [13] is that the network supports the procedures for 5GC
interworking without N26 and that the UE is allowed to use 5GS in the
subscription data. If the Request Type of the UE requested connectivity
procedure indicates \"Emergency\", MME triggers Notify Request to HSS if the
network supports the procedures for 5GC interworking without N26 and operator
policy allows handover of emergency session to 5GS.
For an unauthenticated or roaming UE, if the Request Type of the UE requested
connectivity procedure indicates \"Emergency\", the MME shall not send any
Notify Request to an HSS.
##### 4.11.2.4.3 Void
### 4.11.3 Handover procedures between EPS and 5GC-N3IWF
#### 4.11.3.1 Handover from EPS to 5GC-N3IWF
Figure 4.11.3.1-1: Handover from EPS to 5GC-N3IWF
0\. Initial status: one or more PDN connections have been established in EPC
between the 5G capable UE and the PGW via E-UTRAN.
1\. The UE initiates Registration procedure on untrusted non-3GPP access via
N3IWF (with 5G-GUTI is available or SUCI if not) per clause 4.12.2.
2\. The UE initiates a UE requested PDU Session Establishment with Existing
PDU Session indication in 5GC via Untrusted non-3GPP Access via N3IWF per
clause 4.12.5.
If the Request Type indicates \"Existing Emergency PDU Session\", the AMF
shall use the Emergency Information received from the HSS+UDM which contains
SMF+PGW-C FQDN for S5/S8 interface for the emergency PDN connection
established in EPS and the AMF shall use the S-NSSAI locally configured in
Emergency Configuration Data.
The combined PGW+SMF/UPF initiates a PDN GW initiated bearer deactivation as
described in clause 5.4.4.1 of TS 23.401 [13] to release the EPC and E-UTRAN
resources.
#### 4.11.3.2 Handover from 5GC-N3IWF to EPS
Figure 4.11.3.2-1: Handover from 5GC-N3IWF to EPS
0\. Initial status: one or more PDU Sessions have been established in 5GC
between the UE and the SMF/UPF via untrusted non-3GPP access and N3IWF. During
PDU Session setup and in addition to what is specified in clause 4.3.2.2.1 and
clause 4.3.2.2.2, the AMF includes an indication that EPS interworking is
supported to the SMF+PGW-C as specified in clause 4.11.5.3 and the SMF+PGW-C
sends the FQDN related to the S5/S8 interface to the HSS+UDM which stores it
as described in clause 4.11.5.
1\. For the UE to move PDU session(s) from 5GC/N3IWF to EPC/E-UTRAN, the UE\'s
behaviour is as follows:
\- If the UE is operating in single-registration mode (as described in clause
5.17.2.1 of TS 23.501 [2]) and the UE is registered via 3GPP access to 5GC;
\- the UE behaves as specified in clause 4.11.1 or 4.11.2 and moves its PDU
session from 5GC/N3IWF to EPC/E-UTRAN using the PDN connection establishment
with \"Handover\" indication procedure as described in TS 23.401 [13].
\- otherwise, i.e. either the UE is operating in single registration mode and
is not registered via 3GPP access to 5GC, or the UE is operating in dual
registration mode; and
\- if the UE is not attached to EPC/E-UTRAN, the UE initiates Handover Attach
procedure in E-UTRAN as described in TS 23.401 [13] for a non-3GPP to EPS
handover with \"Handover\" indication, except note 17.
\- otherwise (i.e. the UE is attached to EPC/E-UTRAN), the UE initiates the
PDN Connection establishment with \"Handover\" indication procedure as
described in TS 23.401 [13].
2\. The combined PGW+SMF/UPF initiates a network requested PDU Session Release
via untrusted non-3GPP access and N3IWF according to Figure 4.12.7-1 steps 3
to 12 to release the 5GC and N3IWF resources with the following exception:
\- the H-SMF indicates in the Nsmf_PDUSession_Update Request that the UE shall
not be notified. This shall result in the V-SMF not sending the N1 SM
Container (PDU Session Release Command) to the UE.
\- Nsmf_PDUSession_StatusNotify service operation invoked by H-SMF to V-SMF
indicates the PDU Session is moved to a different system;
\- Nsmf_PDUSession_SMContexStatusNotify service operation invoked by the
(V-)SMF indicates the PDU Session is moved to another system.
\- The Npcf_SMPolicyControl_Delete service operation to PCF shall not be
performed.
### 4.11.3a Handover procedures between EPS and 5GC-TNGF
#### 4.11.3a.1 Handover from EPS to 5GC-TNGF
The handover procedure from EPS to 5GC-TNGF is supported as specified in
clause 4.11.3.1 for handover procedure from EPS to 5GC-N3IWF with the
following differences:
\- The untrusted non-3GPP access is substituted by trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by TNGF.
\- The registration procedure via trusted non-3GPP access as specified in
clause 4.12a.2 shall be performed in step 1.
\- The UE requested PDU Session Establishment with Existing PDU Session
indication in 5GC via trusted non-3GPP access is performed in step 2 as
specified clause 4.12a.5.
#### 4.11.3a.2 Handover from 5GC-TNGF to EPS
The handover procedure from 5GC-TNGF to EPS is supported as specified in
clause 4.11.3.2 for handover procedure from 5GC-N3IWF to EPS with the
following differences:
\- The untrusted non-3GPP access is substituted by trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by TNGF.
\- The network requested PDU Session Release via TNAP and TNGF shall be
initiated as specified in clause 4.12a.7 from steps 3 to 12.
### 4.11.4 Handover procedures between EPC/ePDG and 5GS
#### 4.11.4.1 Handover from EPC/ePDG to 5GS
Figure 4.11.4.1-1: Handover from EPC/ePDG to 5GS
0\. Initial status: one or more PDN Connections have been established between
the UE and the EPC/ePDG via untrusted non-3GPP access as specified in clauses
7.2.4 and 7.6.3 of TS 23.402 [26] with modification described in clauses
4.11.4.3.3 and 4.11.4.3.5.
1\. For the UE to move its PDU session(s) from EPC/ePDG to 5GC/3GPP access,
the UE\'s behaviour is as follows:
\- If the UE is operating in single-registration mode (as described in clause
5.17.2.1 of TS 23.501 [2]) and the UE is attached to EPC/E-UTRAN:
\- the UE behaves as specified in clause 4.11.1 or clause 4.11.2 and gets
registered to 5GC via 3GPP access.
\- otherwise i.e. either the UE is operating in single registration mode and
is not attached to EPC/E-UTRAN, or the UE is operating in dual registration
mode; and
\- if the UE is already registered in 5GS via 3GPP access, the UE skips to
step 2.
\- otherwise (i.e UE is not registered in 5GS via 3GPP access), the UE
performs Registration procedure of type initial registration in 5GS via 3GPP
access as described in clause 4.2.2.2.
2\. The UE initiates a UE requested PDU Session Establishment via 3GPP Access
acording to clause 4.3.2.2 and includes the \"Existing PDU Session\"
indication or \"Existing Emergency PDU Session\" and the PDU Session ID.
For Request Type \"Existing PDU Session\", the UE provides a DNN, the PDU
Session ID and S-NSSAI corresponding to the existing PDN connection it wants
to transfer from EPC/ePDG to 5GS. The S-NSSAI and PLMN ID sent to the UE are
set in the same way as for EPS to 5GS mobility as specified in clause 5.15.7.1
of TS 23.501 [2].
If the Request Type indicates \"Existing Emergency PDU Session\", the AMF
shall use the Emergency Information containing SMF+PGW-C FQDN for the S2b
interface it has received from the HSS+UDM. The SMF+PGW-C FQDN was sent by
PGW-C when the Emergency PDN connection was established in EPC via ePDG and
the AMF shall use the S-NSSAI locally configured in Emergency Configuration
Data.
3\. The combined PGW+SMF/UPF initiates a PDN GW initiated Resource Allocation
Deactivation with GTP on S2b as described in clause 7.9.2 of TS 23.402 [26] to
release the EPC and ePDG resources when S6b is used. When S6b is not used
between SMF+PGW-C and AAA, impacts to step 5 of TS 23.402 [26] Figure 7.9.2-1
are captured in clause 4.11.4.3.6.
#### 4.11.4.2 Handover from 5GS to EPC/ePDG
Figure 4.11.4.2-1: Handover from 5GS to EPC/ePDG
NOTE: In step 2, the UE can also trigger this procedure when 5G NAS (i.e. N1
mode) capability is disabled while the UE is in 5GS.
0\. Initial status: one or more PDU Sessions have been established between the
UE and the SMF/UPF via NG-RAN.
1\. The UE connects to an untrusted non-3GPP access and the N3IWF-ePDG
selection process results in selecting an ePDG.
2\. The UE initiates a Handover procedure as described in clause 8.6.2.1 of TS
23.402 [26], except step 11 of referenced figure 8.2.3-1 that corresponds to
the release of resources in source system.
3\. The combined PGW+SMF/UPF initiates a network requested PDU Session Release
via 3GPP access according to Figure 4.3.4.2-1 steps 3b to 7b, step 11 or
Figure 4.3.4.3-1 steps 3a-16b to release the 5GC and NG-RAN resources with the
following exception:
\- For non-roaming or local breakout in clause 4.3.4.2, the SMF does not
include N1 SM Container in Namf_Communication_N1N2MessageTransfer service
operation.
\- For home routing roaming in clause 4.3.4.3, the H-SMF indicates in the
Nsmf_PDUSession_Update Request that the UE shall not be notified. This shall
result in the V-SMF not sending the N1 SM Container (PDU Session Release
Command) to the UE.
\- Nsmf_PDUSession_StatusNotify service operation invoked by H-SMF to V-SMF
and Nsmf_PDUSession_SMContexStatusNotify service operation invoked by the
(V-)SMF to the AMF indicate that the PDU Session is moved to a different
system.
\- The Npcf_SMPolicyControl_Delete service operation to PCF shall not be
performed.
#### 4.11.4.3 Impacts to EPC/ePDG Procedures
##### 4.11.4.3.1 General
This clause captures enhancements to procedures in TS 23.402 [26] to support
interworking with 5GS. The architecture for interworking is shown in clause
4.3.4 of TS 23.501 [2]. with the ePDG connected to SMF+PGW-C and UPF+PGW-U
using GTP based S2b.
##### 4.11.4.3.2 ePDG FQDN construction
Clause 4.5.4.2 of TS 23.402 [26] applies with the following modification:
\- Tracking/Location Area Identity FQDN: When the 5GC NAS capable UE uses the
Tracking Area of the NG-RAN when the UE is registered with the 5GC when
constructing the Tracking Area Identity FQDN.
##### 4.11.4.3.3 Initial Attach with GTP on S2b
The procedure in clause 7.2.4 of TS 23.402 [26] applies with the following
modifications:
\- In Step A.1 IKEv2 tunnel establishment procedure, the 5GC NAS capable UE
shall indicate its support of 5GC NAS in IKEv2. The UE allocates a PDU Session
ID and also includes it in IKEv2 signalling sent to the ePDG. For 5GC NAS
capable UE even if the NAS capability is currently disabled (i.e. N1 mode is
disabled), the UE may also allocate a PDU Session ID and include it in IKEv2
signalling sent to the ePDG.
\- In Step A.1, UE\'s mobility restriction parameters related to 5GS or
indication of support for interworking with 5GS for this APN or both as
defined for MME in clause 4.11.0a.3 apply to the ePDG and are obtained by the
ePDG as part of the reply from the HSS via the 3GPP AAA Server. These
parameters and the 5G NAS support indicator from the UE, may be used by the
ePDG to determine if a combined SMF+PGW-C or a standalone PGW should be
selected.
\- In Step B.1, if the PDN connection is not restricted to interworking with
5GS by user subscription and if PDU Session ID is received from the UE, the
ePDG shall send the 5GC Not Restricted Indication, 5GS Interworking Indication
and the PDU Session ID to the SMF+PGW-C.
\- In Step B.1, if the SMF+PGW-C supports more than one S-NSSAI and the APN is
valid for more than one S-NSSAI, the SMF+PGW-C selects S-NSSAI as specified in
clause 4.11.0a.5.
\- In Step D.1 (Create Session Response), if the PDU Session ID is present and
5GC Not Restricted Indication is set, the SMF+PGW-C assigns a S-NSSAI to be
associated with the PDN connection as specified in clause 5.15.7.1 of TS
23.501 [2]. The SMF+PGW-C sends the S-NSSAI to the ePDG together with a PLMN
ID that the S-NSSAI relates to.
\- In Steps B.1 and D.1, if the UE does not support 5GC NAS but has 5GS
subscription and a SMF+PGW-C is selected and interaction with UDM, PCF and UPF
is required, the SMF+PGW-C assigns PDU Session ID as specified in clause
4.11.0a.5. The SMF+PGW-C shall not provide any 5GS related parameters to the
UE.
\- In the IKEv2 Authentication Response message, the ePDG sends S-NSSAI and
the PLMN ID that the S-NSSAI relates to, to the UE. The UE associates the
received S-NSSAI and the PLMN ID that the S-NSSAI relates to, with the PDN
Connection.
\- After step D.1, the SMF+PGW-C provides the PCF ID selected for the PDN
connection in the UDM using the Nudm_UECM_Registration service operation.
##### 4.11.4.3.3a Initial Attach for emergency session (GTP on S2b)
The procedure in clause 7.2.5 of TS 23.402 [26] applies with the following
modification:
\- Step 3 (Create Session Request): ePDG determines if interworking with 5GC
is supported based on UE\'s 5G NAS capability and local configuration. In
SMF+PGW-C, only one S-NSSAI is configured for the emergency APN. An emergency
SMF+PGW-C identity should be configured as part of the Emergency Configuration
Data specified in clause 13.5 of TS 23.402 [26].
\- Step 6 (Create Session Response), compared to step D.1 of clause
4.11.4.3.3, SMF+PGW-C does not include S-NSSAI in PCO for emergency PDN
connection.
##### 4.11.4.3.4 Interaction with PCC
When interworking with 5GS is supported and a SMF+PGW-C is selected by the
ePDG, policy interactions between PDN GW and PCRF specified in TS 23.402 [26]
are replaced by equivalent interactions between SMF+PGW-C and PCF as captured
in clause 4.11.0a.2.
If SMF+PGW-C is selected and interaction with PCF is required for a UE that
does not support 5GC NAS, the SMF+PGW-C determines the PDU Session ID and
S-NSSAI in the same way as for PDN connection via MME as specified in clause
4.11.0a.5.
##### 4.11.4.3.5 UE initiated Connectivity to Additional PDN with GTP on S2b
The procedure in clause 7.6.3 of TS 23.402 [26] references the Initial Attach
procedure with GTP on S2b. Impacts to the initial attach procedure with GTP on
S2b are captured in clause 4.11.4.3.3 above. If the additional PDN connection
is for emergency service, impact as captured in clause 4.11.4.3.3a applies.
##### 4.11.4.3.6 Use of N10 interface instead of S6b
This clause applies to scnearios when ePDG is connected to SMF+PGW-C and S6b
in not used. It is applicable for procedures specified in TS 23.402 [26]
including mobility between EPC/ePDG and EPC/EUTRAN and also for mobility
between EPC/ePDG and 5GS.
When S6b, as specified in TS 23.402 [26], is not deployed between SMF+PGW-C
and AAA and the UE creates and deletes a PDN connection via ePDG connected to
SMF+PGW-C, the registration and de-registration of PDN GW is performed on the
N10 interface instead of the S6b interface.
If SMF+PGW-C is selected for a UE that does not support 5GC NAS, the SMF+PGW-C
determines the PDU Session ID and S-NSSAI in the same way as for PDN
connection via EPC/EUTRAN as specified in clause 4.11.0a.5.
For roaming scenario with local-breakout (TS 23.501 [2], Figure 4.3.4.2.1),
the use of N10 interface instead of S6b interface may be based on support of
this feature from HSS+UDM to SMF+PGW-C on N10 interface.
The specific impacts to procedures in clauses 7 and 8 of TS 23.402 [26] are as
follows:
**7.2.4 Initial Attach with GTP on S2b**
\- Instead of Step C.1 in Figure 7.2.4-1 of TS 23.402 [26], step 16c
(Nudm_UECM_Registration with an optional indication that access is from ePDG)
from Figure 4.3.2.2.1-1 are performed between the SMF+PGW-C and HSS+UDM. Based
on this indication, the HSS+UDM does not send notification of PGW-C assignment
on SWx to AAA.
**7.2.5 Initial Attach for emergency session (GTP on S2b)**
\- Instead of step 5 in Figure 7.2.5-1 of TS 23.402 [26], step 16c
(Nudm_UECM_Registration with an optional indication that access is from ePDG)
from Figure 4.3.2.2.1-1 are performed between the SMF+PGW-C and HSS+UDM. Based
on this indication, the HSS+UDM does not send notification of PGW-C assignment
on SWx to AAA.
The indication of access from ePDG is forwarded on the interface between UDM
and HSS.
**7.4.3 UE/ePDG-initiated Detach Procedure and UE-Requested PDN Disconnection
with GTP on S2b**
**7.4.3.1 Non-Roaming, Home Routed Roaming and Local Breakout Case**
\- Instead of Step A.2 in Figure 7.4.3-1 of TS 23.402 [26], step 12
(Nudm_UECM_Deregistration) from Figure 4.3.4.2-1 is performed between the
SMF+PGW-C and HSS+UDM.
**7.4.4 HSS/AAA-initiated Detach Procedure with GTP on S2b**
**7.4.4.1 Non-Roaming, Home Routed Roaming and Local Breakout Case**
\- Instead of step 3 in Figure 7.4.1-1 of TS 23.402 [26] (referenced by Figure
7.4.4-1 of TS 23.402 [26]), Step 12 (Nudm_UECM_Deregistration) from Figure
4.3.4.2-1 is performed between the SMF+PGW-C and HSS+UDM
**7.9.2 PDN GW initiated Resource Allocation Deactivation with GTP on S2b**
\- Instead of step 5 in Figure 7.9.2-1 of TS 23.402 [26], Step 12
(Nudm_UECM_Deregistration) from Figure 4.3.4.2-1 is performed between the
SMF+PGW-C and HSS+UDM.
**8.6.1.1 General Procedure for GTP based S5/S8 for E-UTRAN Access**
\- Step 18 of clause 8.6.1.1 of TS 23.402 [26] refers to clause 7.9.2 of TS
23.402 [26]. The Nudm_UECM_Deregistration in the impacted referenced clause
7.9.2 above is not performed as resources in the SMF+PGW-C are not released.
**8.6.2.1 3GPP Access to Untrusted Non-3GPP IP Access Handover with GTP on
S2b**
\- In Step B.2 of clause 8.6.2.1 of TS 23.402 [26], if the registration of the
SMF+PGW-C in the HSS+UDM is not already done, step 16c (Nudm_UECM_Registration
with an optional indication that access is from ePDG) from Figure 4.3.2.2.1-1
is performed between the SMF+PGW-C and HSS+UDM.
The impacts to procedure in clause 4.11.4.1 (Handover from EPC/ePDG to 5GS)
are as follows:
\- For step 0, the impacts to clause 7.2.4 of TS 23.402 [26] are captured
above.
\- In step 2, if the Request Type indicates \"Existing Emergency PDU
Session\", the AMF shall use the Emergency Information containing SMF+PGW-C
FQDN for the S2b interface and the S NSSAI locally configured in Emergency
Configuration Data.
\- In step 3, the impacts to clause 7.9.2 of TS 23.402 [26] are captured
above. Nudm_UECM_Deregistration is not performed by SMF+PGW-C, as resources in
the SMF+PGW-C are not released.
The impacts to procedures in clause 4.11.4.2 (Handover from 5GS to EPC/ePDG)
are as follows:
\- For step 2, impacts to clause 8.6.2.1 (3GPP Access to Untrusted Non-3GPP IP
Access Handover with GTP on S2b) of TS 23.402 [26] are captured above and Step
16c of Figure 4.3.2.2.1-1 is not performed as SMF+PGW-C already registered in
the HSS+UDM when the UE is in 5GS.
##### 4.11.4.3.7 5GC NAS capability (re-)enabled and disabled
When 5G NAS (i.e. N1 mode) capability is (re-)enabled, the UE does not report
the UE capability change to ePDG.
NOTE: The ePDG is not aware of the N1 mode Enabled / Disabled status at the
UE. If a standalone PGW was previously selected, the ePDG is not able to
initiate PDN disconnection with reactivation required for the purpose of re-
selecting an SMF+PGW-C.
When N1 is re-enabled, how to handle PDN connection(s) established over
EPC/ePDG and without a mapped S-NSSAI is defined in TS 24.501 [25].
### 4.11.5 Impacts to 5GC Procedures
#### 4.11.5.1 General
This clause captures impacts to 5GC procedures in other clauses of this
specification to support interworking with EPS. These impacts are applicable
to interworking based on N26 and interworking without N26 for PDU Session via
3GPP access and for PDU Session via non-3GPP access.
This clause also captures the impact to 5GC if the UE was previously in
GERAN/UTRAN as specified in clause 5.17.2.4 of TS 23.501 [2].
#### 4.11.5.2 Registration procedure
The following impacts are applicable to clause 4.2.2.2 (Registration
procedure):
\- Step 1: If the Registration type is set to \"Initial Registration\", the UE
is not registered in EPS and the UE provides the 5G-GUTI mapped from EPS GUTI
as the old GUTI, then the UE includes complete EPS Attach Request in the
Registration request message.
\- Step 4: If the Registration type is \"Initial Registration\" as in step 1
of the Registration Procedure captured in clause 4.2.2.2.2, the target AMF may
perform Identification Request towards MME along with complete EPS Attach
Request message for MME to verify it as in step 3 as specified in clause
5.3.2.1 of TS 23.401 [13].
NOTE 1: The steps above apply to interworking with N26.
\- Step 14a:
\- If the AMF does not have event subscription information from the UDM, the
AMF indicates it in Nudm_UECM_Registration. The UDM then provides event
subscriptions (possibly retrieved from UDR) if any.
\- If mobility between GERAN/UTRAN and 5GS is required (as specified in clause
5.17.2.4 of TS 23.501 [2]), at Initial Registration, the AMF serving 3GPP
access shall also register with the Nudm_UECM_Registration even if the AMF has
a valid context.
\- Step 14d: If mobility between GERAN/UTRAN and 5GS is required (as specified
in clause 5.17.2.4 of TS 23.501 [2]), when the UDM stores the associated 3GPP
Access Type together with the serving AMF as indicated in step 14a, it will
also cause cancellation of any other previously registered serving node (e.g.
MME if AMF does not indicate not to cancel or SGSN) via HSS/HLR.
NOTE 2: Upon mobility from GERAN/UTRAN to 5GS as specified in clause 5.17.2.4
of TS 23.501 [2], the previously registered SGSN needs to be cancelled from
HSS/HLR, otherwise the incoming session can fail.
\- Step 15: As described in clause 6.3.7.1 , clause TS 23.501 [2], if the AMF
receives PCF Selection Assistance info and PCF ID(s) from the UDM, the AMF
checks the PCF Selection Assistance info provided by UDM. If a list of
DNN,S-NSSAI combinations are provided in the PCF Selection Info the AMF checks
local configuration to determine which DNN,S-NSSAI to use then selects the PCF
ID included in the corresponding UE Context in the SMF data. If no PCF ID is
received, e.g. EPS interworking is not supported, or no PDN connection and
related PCC association exists , the AMF select the PCF by considering other
criteria, defined in clause 6.3.7.1 TS 23.501 [2].
\- At the end of registration procedure, the AMF may initiate synchronization
of event subscriptions with the UDM if the AMF does not indicate
unavailability of event subscription in step 14a.
NOTE 3: The details how synchronization can be done is left to stage 3.
For PDU Session via 3GPP access the following impacts are applicable to clause
4.2.2.2 (Registration procedure) when the UE has established PDU Session(s):
In clause 4.3.2.2.1 Non-roaming and Roaming with Local Breakout:
\- Step 17: Additional trigger for step 17 Nsmf_PDUSession_UpdateSMContext
are:
\- If status of interworking with EPS for a PDU session changes, e.g. due to
change of 5GMM capability (e.g. \"S1 mode supported\"), the UE subscription
data change (e.g. Core Network Type Restriction to EPC), the AMF invokes
Nsmf_PDUSession_UpdateSMContext (EPS Interworking Indication with N26 or
without N26) to SMF. The SMF determines whether the PDU session supports
interworking with EPS need be changed. If it needs to be changed, the SMF
invokes Nudm_UECM_Update service operation to add or remove the PGW-C FQDN for
S5/S8 interface from the UE context in SMF data stored at the UDM.
For interworking with the N26 interface, if status of interworking with EPS
for a PDU session is changed at SMF+PGW-C, the SMF+PGW-C invokes EBI
allocation or revocation as described in clause 4.11.1.4.1 and clause
4.11.1.4.2 respectively.
For PDU Session via non-3GPP access, the AMF determines if EPS interworking is
supported and sends the indication to the SMF in the same way as for PDU
Session via 3GPP access. The SMF makes the final decision on the EPS
interworking in the same way as for PDU Session via 3GPP access with the
following modification:
If the SMF does not receive the interworking indication, the SMF makes its
decision based on subscription.
#### 4.11.5.3 UE Requested PDU Session Establishment procedure
For PDU Session via 3GPP, the following impacts are applicable to clause
4.3.2.2 (UE Requested PDU Session Establishment procedure) to support
interworking with EPS:
In clause 4.3.2.2.1 Non-roaming and Roaming with local breakout:
\- Step 1: In PDU Session Establishment Request message, the UE includes also
the UE capability of Ethernet PDN type support in EPS to the SMF (or H-SMF in
home routing roaming);
\- Step 3: The AMF determines that a PDU Session supports EPS interworking
with N26 or without N26, based on e.g. 5GMM capability (e.g. \"S1 mode
supported\"), UE subscription data (e.g. Core Network Type Restriction to EPS,
EPC interworking support per (S-NSSAI, subscribed DNN)) and network
configuration if EPS interworking with N26 or without N26 is supported. The
AMF then includes in the Nsmf_PDUSession_CreateSMContext an indication whether
the PDU Session supports EPS Interworking with N26 or without N26.
For PDU Session with Request Type \"initial emergency request\", the AMF
decides the EPS interworking with N26 or without N26 based on 5GMM capability
and local configuration.
For PDU Session with Request Type \"Existing Emergency PDU Session\", the AMF
shall use Emergency Information received from HSS+UDM and the S-NSSAI locally
configured in Emergency Configuration Data.
If the Request Type indicates \"Existing PDU Session\" the AMF selects the SMF
based on SMF-ID or SMF+PGW-C FQDN received from UDM during the Registration or
Subscription Profile Update Notification procedure. The case where the AMF
does not recognize the PDU Session ID or the subscription context that the AMF
received from UDM neither contains an SMF ID nor a SMF+PGW-C FQDN
corresponding to the PDU Session ID constitutes as an error case.
NOTE 1: If the AMF receives from the UDM, for a PDU Session, both a SMF ID and
a SMF+PGW-C FQDN, the SMF ID takes precedence.
If the AMF has stored APN Rate Control Status and the PDU Session is
considered a new first PDU Session to a DNN that is the same as the APN in
stored APN Rate Control Status and interworking with EPC is enabled for this
PDU Session, then the AMF sends the APN Rate Control Status to the SMF.
The AMF indicates to the SMF whether the UE support User Plane Integrity
Protection with EPS and whether the AMF has associated functionality.
\- Step 4: If the EPS Interworking indication received from AMF indicates that
the UE supports EPS interworking and the SMF determines, based on the EPS
interworking support indication from the AMF and additional UE subscription
data (e.g. whether UP integrity protection of UP Security Enforcement
Information is not set to required, EPS interworking is allowed for this DNN
and S-NSSAI), that the PDU Session supports EPS interworking, the SMF+PGW-C
FQDN for S5/S8 interface is included in the Nudm_UECM_Registration Request.
\- Step 10a: If APN Rate Control Status is received from the AMF then the SMF
provides the configured APN Rate Control Status to the PGW-U+UPF.
\- Step 13 In PDU Session Establishment Accept message, the SMF also includes
indication of Ethernet PDN type supported if the Ethernet PDN type is
supported by both the UE and the SMF+PGW-C. The SMF and the UE stores the
information if Ethernet PDN type is supported for later use when UE moves from
5GS to EPS.
\- Step 16c: For PDU Session establishment with Request Type \"initial PDU
Session\", if the SMF+PGW-C selects the same PCF as the PCF ID received from
AMF as specified in clause 4.3.2.2.1 and if the PDU Session supports EPC
interworking, the SMF provide the selected PCF ID in the UDM using the
Nudm_UECM_Registration service operation.
NOTE 2: The subscription data \"EPS interworking support indication\" is used
by AMF when determining the EPS interworking support for the PDU Session.
Therefore, when the UE establishes the PDU Session via the 3GPP access, the
SMF does not need to consider the same subscription data \"EPS interworking
support indication\" again.
In clause 4.3.2.2.2 Home-routed Roaming:
\- Step 3a: Same impact as for step 3 for the non-roaming and roaming with
local breakout case above.
\- Step 5: Same impact as for step 10a for the Non-roaming and Roaming with
Local Breakout case above.
\- Step 6 The V-SMF pass the EPS interworking support indication received from
the AMF to the H-SMF in Nsmf_PDUSession_Create.
\- Step 7: If the EPS interworking indication received from V-SMF indicates
that the PDU Session supports EPS interworking and the H-SMF determines, based
on the EPS interworking support indication from the AMF and additional
information such as UP integrity protection of UP Security Enforcement
Information as described in clause 4.11.1.1, that the PDU Session supports EPS
interworking, the SMF+PGW-C FQDN for S5/S8 interface is included in the
Nudm_UECM_Registration Request.
\- Step 15: Same impact as in step 13 for the non-roaming and roaming with
local breakout case above with the difference that it\'s the home SMF+PGW-C
that includes the indication of Ethernet PDN type supported.
For interworking with the N26 interface, if the PDU Session supports
interworking with EPS, the SMF+PGW-C invokes EBI allocation as described in
clause 4.11.1.4.1.
For non-emergency PDU Session via non-3GPP, the AMF determines if EPS
interworking is supported and sends the indication to the SMF in the same way
as for PDU Session via 3GPP. The SMF makes the final decision on the EPS
interworking in the same way as for PDU Session via 3GPP with the following
modification:
\- If the SMF does not receive the interworking indication, the SMF makes its
decision based on subscription.
For emergency PDU Session via non-3GPP, the AMF determines if EPS interworking
is supported and sends the indication to the SMF in the same way as for
emergency PDU Session via 3GPP supporting EPS interworking.
#### 4.11.5.4 UE or Network Requested PDU Session Modification procedure
For PDU Session via 3GPP, the following impacts are applicable to clause
4.3.3.2 (UE or network requested PDU Session Modification (non-roaming and
roaming with local breakout)) to support interworking with EPS:
\- Step 1: In addition to the triggers listed in step 1 of clause 4.3.3.2, the
procedure may be also triggered by the following event:
\- AMF initiated modification: If the support of EPS Interworking for this PDU
Session has changed, e.g. the change of the UE\'s subscription data (e.g. Core
Network Type Restriction to EPS), or change of 5GMM capability (e.g. \"S1 mode
supported\"), the AMF invokes Nsmf_PDUSession_UpdateSMContext update the
status of EPS interworking support in the to SMF.
\- Step 3a: This step also applies to AMF initiated modification. For AMF
initiated modification, the SMF may determines whether the PDU session
supports EPS interworking need be changed. If it need be changed, the SMF
invokes Nudm_UECM_Update service operation to add or remove the PGW-C FQDN for
S5/S8 interface from the UE context in SMF data stored at the UDM,
For PDU Session via 3GPP, the following impacts are applicable to clause
4.3.3.3 (UE or network requested PDU Session Modification (home-routed
roaming)) to support interworking with EPS:
\- Step 1a (AMF to V-SMF): Same impact as for step 1 of clause 4.3.3.2 above.
\- Step 1a (V-SMF to H-SMF): The V-SMF pass the status of EPS interworking
support to the H-SMF.
\- Step 1a (H-SMF to V-SMF): Same impact as for clause 3a of 4.3.3.2 above.
For interworking with the N26 interface, if status of interworking with EPS
for a PDU session is changed at SMF+PGW-C, the SMF+PGW-C invokes EBI
allocation or revocation as described in clause 4.11.1.4.1 and clause
4.11.1.4.2 respectively.
For PDU Session via non-3GPP access, the AMF determines if EPS interworking is
supported and sends the indication to the SMF in the same way as for PDU
Session via 3GPP access. The SMF makes the final decision on the EPS
interworking in the same way as for PDU Session via 3GPP access with the
following modification:
If the SMF does not receive the interworking indication, the SMF makes its
decision based on subscription.
#### 4.11.5.5 Xn based inter NG-RAN handover
The following impacts are applicable to clause 4.9.1.2.1 (General) to support
interworking with EPS:
\- If there is Mapping between EBI(s) and QFI(s) for the UE in the source NG-
RAN, the source NG-RAN sends the Mapping to target NG-RAN during handover.
#### 4.11.5.6 Inter NG-RAN node N2 based handover
The following impacts are applicable to clause 4.9.1.3.2 (Preparation phase)
to support interworking with EPS:
\- Step 7: If the PDU session supports EPS interworking, the N2 SM information
contains the Mapping between EBI(s) and QFI(s).
#### 4.11.5.7 UE or Network Requested PDU Session Release procedure
The following impacts are applicable to clause 4.3.4.2 (UE or network
requested PDU Session Release for Non-Roaming and Roaming with Local Breakout)
to support interworking with EPS:
\- Step 2b: If the released PDU Session used APN Rate Control in EPC then the
PGW-U+UPF provides the APN Rate Control Status to the SMF if the released PDU
Session supported interworking with EPC and it is the last PDU Session to the
DNN that is the same as the APN identified in the APN Rate Control Status.
\- Step 3: If the PGW-U+UPF provided APN Rate Control Status to the SMF then
the SMF provides the APN Rate Control Status to the AMF.
The following impacts are applicable to clause 4.3.4.3 (UE or network
requested PDU Session Release for Home-routed Roaming) to support interworking
with EPS:
\- Step 2b: Same impact as for step 2b for the Non-roaming and Roaming with
Local Breakout case above.
\- Step 3: Same impact as for step 3 for the Non-roaming and Roaming with
Local Breakout case above.
#### 4.11.5.8 Network Configuration
To avoid the need for identifier coordination between AMFs and MMEs, the AMF
provides to the NG-RAN its served GUAMIs by separating the values between
native AMF values and the values mapped from MME.
#### 4.11.5.9 Network Slice Admission Control
Support of NSAC in conjunction with interworking with EPC is described in
clause 5.15.11.5 of TS 23.501 [2].
If EPS counting is required for a network slice, the SMF+PGW-C performs NSACF
discovery that supports controlling the maximum number of PDU sessions per
network slice as described in clause 6.3.22 of TS 23.501 [2] and in clause
5.2.7.3.2.
If non-Hierarchical NSAC or Centralized NSAC architecture is deployed at the
network, the following impacts are applicable to clause 4.2.11.4 (Number of
PDU Sessions per network slice availability check and update procedure):
\- The SMF+PGW-C invokes this procedure to perform network slice availability
check on the number of PDU Sessions and update for S-NSSAI associated with the
PDN connection during PDN connection establishment and PDN connection release.
In this case the SMF in figure 4.2.11.4-1 is replaced with SMF+PGW-C.
\- Step 3: The NSACF determines whether or not to accept the request as
described in clause 5.15.11.5 of TS 23.501 [2].
If Hierarchical NSAC architecture is deployed at the network, the following
impacts are applicable to clause 4.2.11.4a:
\- The SMF+PGW-C invokes this procedure to perform network slice availability
check on the number of PDU Sessions and update for S-NSSAI associated with the
PDN connection during PDN connection establishment. In this case the SMF in
figure 4.2.11.4a-1 is replaced with SMF+PGW-C.
\- Step 8: The NSACF determines whether or not to accept the request as
described in clause 5.15.11.5 of TS 23.501 [2]. When the local maximum number
is reached, the NSACF may interact with the Primary NSACF before it returns
the response back to the SMF+PGW-C as defined in clause 4.2.11.4a.
The SMF+PGW-C performs NSACF discovery that supports controlling the maximum
number of UEs per network slice as described in clause 6.3.22 of TS 23.501 [2]
and in clause 5.2.7.3.2.
If non-Hierarchical NSAC or Centralized NSAC architecture is deployed at the
network, the following impacts are applicable to clause 4.2.11.2 (Number of
UEs per network slice availability check and update procedure):
\- The SMF+PGW-C invokes this procedure to perform network slice availability
check on the number of UEs and update for S-NSSAI associated with the PDN
connection during PDN connection establishment. In this case the AMF in figure
4.2.11.2-1 is replaced with SMF+PGW-C.
\- Step 2: The SMF+PGW-C includes in the message the S-NSSAI, identity of
SMF+PGW-C, UE ID and update flag. In a centralized NSAC architecture, the
SMF+PGW-C additionally includes the NSAC service area if available.
\- Step 3: The AMF ID is replaced by the SMF + PGW-C ID.
\- Step 3: The NSACF determines whether or not to accept the request as
described in clause 5.15.11.5 of TS 23.501 [2].
If Hierarchical NSAC architecture is deployed at the network, the following
impacts are applicable to clause 4.2.11.2a:
\- The SMF+PGW-C invokes perform network slice availability check on the
number of UEs and update for S-NSSAI associated with the PDN connection during
PDN connection establishment. In this case the AMF in figure 4.2.11.2a-1 is
replaced with SMF+PGW-C.
\- Step 2: The SMF+PGW-C includes in the message the S-NSSAI, identity of
SMF+PGW-C, UE ID and update flag.
\- Step 3: The AMF ID is replaced by the SMF + PGW-C ID.
\- Step 8: The NSACF determines whether or not to accept the request as
described in clause 5.15.11.5 of TS 23.501 [2]. When the local maximum number
is reached the NSACF may interact with the Primary NSACF before it returns the
response back to the SMF+PGW-C as defined in clause 4.2.11.2a.
The SMF+PGW-C shall continue the PDN Connection Establishment procedure only
when the Network Slice subject to NSAC is available based on both numbers of
PDU Sessions and number of UEs.
#### 4.11.5.9a Network Slice Admission Control in 5GS for maximum number of UE
with at least one PDU session and one PDN connection
Support of NSAC in conjunction with interworking with EPC for maximum number
of UE with at least one PDU session/PDN connection is described in clause
5.15.11.5a of TS 23.501 [2].
For option 1, the same mechanisms in clause 4.2.11.2 (Number of UEs per
network slice availability check and update procedure) is used with the
following additions:
\- The SMF+PGW-C invokes this procedure when the UE establishes the first PDU
Session/PDN Connection and when the last PDU Session/PDN Connection associated
with the network slice is released. In this case, the AMF in figure 4.2.11.2-1
is replaced with SMF+PGW-C.
\- Step 2: The SMF+PGW-C includes in the message the S-NSSAI, identity of
SMF+PGW-C, UE ID and update flag. The update flag may include either
\'increase\', \'decrease\' or \'update\' values.
\- Step 2: The AMF ID is replaced by the SMF+PGW-C ID.
\- Step 3: The \'update\' value indicates that for existing UE registration
the Access Type is to be replaced with a new Access Type during inter access
mobility. If the update flag parameter from the SMF+PGW-C indicates update
value, the NSACF locates the existing entry with UE ID and NF ID and replaces
the Access Type in the existing entry. The NSACF may take the Access Type into
account for UE counting based on local policy. If there was one UE entry in
the new Access Type with same NF ID then NSACF may not increase the count
again. If there was one UE entry in the new Access Type with different NF ID
then NSACF may add this new NF ID in the UE entry and not increase the count.
If there was one entry with same NF ID in the old Access Type then NSACF may
remove the UE entry and decrease the count.
Editor\'s note: Step 3 needs to be further discussed/completed to cover both
cases when the access type is considered and not considered.
\- The NSACF determines whether or not to accept the request as described in
clause 5.15.11.5a of TS 23.501 [2]
NOTE 1: EAC mode is not applicable here.
For option 2, the same mechanisms in clause 4.2.11.4 (Number of PDU Sessions
per network slice availability check and update procedure) are used with the
following additions:
\- The NSACF also counts the maximum number UE with at least one PDU
session/PDN connection based on the update value received from SMF+PGW-C.
\- If the update flag parameter from the SMF/SMF+PGW-C anchoring the PDU
session/PDN connections indicates update, the NSACF locates the existing entry
with UE ID and NF ID and replaces the Access Type in the existing entry. The
NSACF may take the Access Type into account for UE counting based on local
policy. If there was one UE entry in the new Access Type with same NF ID then
NSACF may not increase the count again. If there was one UE entry in the new
Access Type with different NF ID then NSACF may add this new NF ID and not
increase the count. If there was one entry with same NF ID in the old Access
Type then NSACF may remove the UE entry and decrease the count.
\- The NSACF determines whether to accept the request as described in clause
5.15.11.5a of TS 23.501 [2].
\- The NSACF performs other actions in addition to the above to keep track of
the last PDU Session/Connection released so as to decrease the count for the
number of Registered UEs with at least one PDU Session/one PDN Connection.
NOTE 2: EAC mode is not applicable here.
If Hierarchical NSAC architecture is deployed in the network, there are the
following additional enhancements:
\- For option 2, the NSAC for number of UEs and NSAC for number of UEs shall
be handled within the same NSACF.
\- For NSAC for number of UEs, when the local maximum number or local
threshold is reached, the NSACF may interact with the Primary NSACF before it
returns the response back to the SMF+PGW-C. For more details on handling
between the NSACF and Primary NSACF see clause 4.2.11.2a.
NOTE 3: For option 2, given that the SMF+PGW-C can not provide the UE already
registered indication to NSACF, hence when the NSACF interacts with Primary
NSACF, the Primary NSACF will not manage the UE entry by itself.
\- For NSAC for number of PDU Sessions, when the local maximum number is
reached, the NSACF may interact with the Primary NSACF before it returns the
response back to the SMF+PGW-C. For more details on handling between the NSACF
and Primary NSACF see clause 4.2.11.4a.
#### 4.11.5.10 UE Policy Association control
##### 4.11.5.10.1 UE Policy Association Establishment for URSP delivery in EPS
The following impacts are applicable to clause 4.16.11 (UE Policy Association
Establishment procedure) during initial registration or during UE registration
with 5GS when the UE moves from EPS to 5GS:
In addition to step 3 in clause 4.16.11, if the indication about the support
of provisioning of URSP rules in EPC is received in step 2 within
Npcf_UEPolicyControl_Create Request, that indication is added in the list of
parameters to be stored in UDR using Nudr_DM_Create.
### 4.11.6 Interworking for common network exposure
#### 4.11.6.1 Subscription and Notification of availability or expected level
of support of a service API
Figure 4.11.6.1 1 represent the information flow subscribing and notifying the
availability or expected level of support of a service API.
For the subscription to Nnef_APISupportCapability service, the subscription
request may include the Duration of Reporting. If the Duration of Reporting is
expired, the SCEF+NEF deletes the subscription without any explicit signalling
interaction.
For the CN type Change Event subscription to the HSS+UDM, the subscription
request may include the Duration of Reporting. If the Duration of Reporting is
expired, the HSS+UDM locally unsubscribe the CN Type Change Event without any
explicit signalling interaction.
The SCEF+NEF informs the AF of the API Indication which indicates list of
available north-bound API(s).
Figure 4.11.6.1-1: Subscription and Notification of availability or expected
level of support of a service API
1\. The AF subscribes to Nnef_APISupportCapability service for a UE or a group
of UEs by sending Nnef_APISupportCapability_Subscribe Request (UE ID or
External Group ID, Report Type, callback URI, Duration of Reporting) message.
The callback URI parameter is optional and is used in step 6 if provided.
The Report Type can be either One-time report or Continuous report. If this is
a subscription for Continuous report type, then the Duration of Reporting may
be included. The Duration of Reporting is optional and is used to indicate
when the subscription is invalid. If the SCEF+NEF has established direct
connection with MME or AMF or SMF, steps 2 - 3 and step 5 are omitted. If this
is a subscription for One-time report type and if the Freshness Timer of last
One-time report type subscribe request is not expired or a direct connection
has been set up with MME or AMF or SMF, the SCEF+NEF determines the CN type
locally, steps 2 - 3 are omitted.
2\. SCEF+NEF subscribes the CN Type Change Event to HSS+UDM by sending
Nudm_EventExposure_Subscribe Request (CN Type Change, Report Type, UE ID or
External Group ID, Duration of Reporting) message.
If Duration of Reporting is received at step 1, it shall include Duration of
Reporting in this message.
3\. The HSS+UDM determines the CN type that is serving the indicated UE or the
indicated group of UEs based on the registered MME or AMF. The HSS+UDM informs
SCEF+NEF of the CN type by sending Nudm_EventExposure_Subscribe Response (CN
Type) message. If the Report Type indicates One-time report, the HSS+UDM
delete the CN Type Change Event subscription after sending the response with
CN Type. The Freshness Timer is set in SCEF+NEF per operator\'s policy, e.g.
based on the statistics of UE activities. If the Report Type indicates
Continuous report, HSS+UDM stores the CN Type Change Event subscription.
4\. According to the CN type received or local stored, the SCEF+NEF determines
the availability or expected level of support of common north-bound APIs for
the indicated UE or the indicated group of UEs. SCEF+NEF responds to AF by
sending Nnef_APISupportCapability_Subscribe Response (API Indication).
If the subscription is for One-time report type, then steps 5 - 6 are omitted.
5\. When HSS+UDM detects that the indicated UE is switching between EPC and
5GC the HSS+UDM determines the CN type that is serving the indicated UE or the
indicated group of UEs. The HSS+UDM informs SCEF+NEF of the CN type by sending
Nudm_EventExposure_Notify (CN type).
The CN type denotes the 5GC or EPC or 5GC+EPC serving the UE or the group of
UEs.
6\. According to the CN type received and local detected, the SCEF+NEF node
determines the availability or expected level of support of common north-bound
APIs for the indicated UE or the indicated group of UEs. SCEF+NEF inform AF of
such API information by sending Nnef_APISupportCapability_Notify (API
Indication) message.
If callback URI is provided at step 1, then SCEF+NEF will send the
Nnef_APISupportCapability_Notify (API Indication) message to the node
addressed by callback URI.
Upon reception of API Indication in step 4 or step 6, the AF obtains the
availability or expected level of support of a given service for the indicated
UE or the indicated group of UEs. If required, the AF can select the valid
north-bound API based on such API information.
#### 4.11.6.2 Unsubscribing to N11otification of availability or expected
level of support of a service API
Figure 4.11.6.2 1 represent the information flow unsubscribing to Continuous
report type subscription of the availability or expected level of support of a
service API.
If the AF invokes Nnef_APISupportCapability_Subscribe service to SCEF+NEF node
with the Duration of Reporting parameter for Continuous report type, the
subscription on the SCEF+NEF and HSS+UDM are implicitly unsubscribed if the
Duration of Reporting timer expires, i.e. the explicit unsubscribe service
operation is not needed.
If the explicit unsubscribe operation is needed, the information flow is as
follows.
Figure 4.11.6.2 1: Unsubscribing to notification of the availability or
expected level of support of a service API
1\. The AF unsubscribes to Nnef_APISupportCapability service for a UE or a
group of UEs by sending APISupportCapability_Unsubscribe Request (UE ID or
External Group ID) message.
2\. If SCEF+NEF has subscribed to CN Type Change Event for the indicated UE or
the indicated group of UEs, SCEF+NEF unsubscribes the CN Type Change Event by
sending Ndum_EventExposure_Unsubscribe Request (CN Type Change, UE ID or
External Group ID) message to HSS+UDM.
3\. HSS+UDM deletes the CN Type Change Event subscription for the indicated UE
or the indicated group of UEs, HSS+UDM responses to the SCEF+NEF by sending
Ndum_EventExposure_Unsubscribe Response (Operation execution result
indication) message.
4\. If result indication indicates the operation is successful, the SCEF+NEF
deletes the subscription to Nnef_APISupportCapability service. SCEF+NEF
acknowledges the operation result by sending
Nnef_APISupportCapability_Unsubscribe Response (Operation execution result
indication) to AF.
#### 4.11.6.3 Configuration of monitoring events for common network exposure
Figure 4.11.6.3-1 represent the information flow to configure monitoring
events applicable to both EPC and 5GC using 5GC procedures towards UDM in
scenarios where interworking between 5GS and EPC is possible.
Figure 4.11.6.3-1: Configuration of monitoring events for common network
exposure
1\. The AF configures a monitoring event via the SCEF+NEF using the
Nnef_EventExposure_Subscribe service operation.
2\. SCEF+NEF configures the monitoring event in the UDM+HSS using the
Nudm_EventExposure_Subscribe service operation.
The combined SCEF+NEF indicates that the monitoring event is also applicable
to EPC (i.e. the event must be reported both by 5GC and EPC). Depending on the
type of event, the SCEF+NEF may include a SCEF address (i.e. if the event
needs to be configured in the MME and the corresponding notification needs to
be sent directly to the SCEF).
3\. The HSS+UDM configures the monitoring event. For events that need to be
reported from a serving node (e.g. location change) the HSS+UDM requests the
configuration of the monitoring event to the corresponding serving node in the
5GC and EPC. The HSS+UDM uses the corresponding Event Exposure Subscribe
service operation to configure monitoring events in 5GC serving NFs (e.g.
Namf_EventExposure_Subscribe or Nsmf_EventExposure_Subscribe). The HSS+UDM
uses the procedures defined in TS 23.682 [23] to configure monitoring events
in MME. The HSS+UDM provides the MME with the SCEF address during the
configuration of the monitoring event in EPC. If the HSS and UDM are deployed
as separate network entities, UDM shall use HSS services to configure the
monitoring event in EPC as defined in TS 23.632 [68].
4\. The HSS+UDM replies the SCEF+NEF with the indication that the monitoring
event was successfully configured in 5GC and EPC by sending the
Nudm_EventExposure_Subscribe Response.
5\. The SCEF+NEF responds to AF by sending Nnef_EventExposure_Subscribe
Response.
6\. The SCEF+NEF is notified when HSS+UDM or the serving node at the 5GC or
EPC detects the corresponding event. The HSS+UDM notifies the SCEF+NEF using
the Nudm_EventExposure_Notify service operation. A serving NF in the 5GC
notifies the SCEF+NEF using the corresponding Event Exposure Notify service
operation (e.g. Namf_EventExposure_Notify or Nsmf_EventExposure_Notify). The
MME notifies the SCEF+NEF using the procedures defined in TS 23.682 [23] using
the SCEF address provided by the HSS+UDM in step 3.
7\. The SCEF+NEF notifies the AF using the Nnef_EventExposure_Notify service
operation.
## 4.12 Procedures for Untrusted non-3GPP access
### 4.12.1 General
Clause 4.12 defines the procedures to support Untrusted non-3GPP access by
describing the differences compared to the defined procedures in other
clauses. The procedures for Untrusted non-3GPP access are also used by a UE
that accesses SNPN services via a PLMN over 3GPP access.
### 4.12.2 Registration via Untrusted non-3GPP Access
#### 4.12.2.1 General
Clause 4.12.2 specifies how a UE can register to 5GC via an untrusted non-3GPP
Access Network. It is based on the Registration procedure specified in clause
4.2.2.2.2 and it uses a vendor-specific EAP method called \"EAP-5G\". The
EAP-5G packets utilize the \"Expanded\" EAP type and the existing 3GPP Vendor-
Id registered with IANA under the SMI Private Enterprise Code registry. The
\"EAP-5G\" method is used between the UE and the N3IWF and is utilized only
for encapsulating NAS messages (not for authentication). If the UE needs to be
authenticated, mutual authentication is executed between the UE and AUSF. The
details of the authentication procedure are specified in TS 33.501 [15].
In Registration and subsequent Registration procedures via untrusted non-3GPP
access, the NAS messages are always exchanged between the UE and the AMF. When
possible, the UE can be authenticated by reusing the existing UE security
context in AMF.
#### 4.12.2.2 Registration procedure for untrusted non-3GPP access
The signalling flow in Figure 4.12.2.2-1 does not show all the details of a
registration procedure via untrusted non-3GPP access. It shows primarily the
steps executed between the UE and N3IWF. All the details of a registration
procedure, including interactions with PCF, UDM, etc. are specified in clause
4.2.2.2.2.
Figure 4.12.2.2-1: Registration via untrusted non-3GPP access
1\. The UE connects to an untrusted non-3GPP Access Network with any
appropriate authentication procedure and it is assigned an IP address. For
example, a non-3GPP authentication method can be used, e.g. no authentication
(in the case of a free WLAN), EAP with pre-shared key, username/password, etc.
When the UE decides to attach to 5GC network, the UE not operating in SNPN
access mode for NWu interface selects an N3IWF in a 5G PLMN, as described in
clause 6.3.6 of TS 23.501 [2]. When the UE decides to attach to 5GC network,
the UE operating in SNPN access mode for NWu interface selects an N3IWF in an
SNPN, as described in clause 6.3.6.2a of TS 23.501 [2].
NOTE 1: The UE Selection of a N3IWF that supports the S-NSSAIs needed by the
UE is enabled based on ANDSP configuration defined in TS 23.501 [2]. The N3IWF
selection based on this information is documented in TS 23.501 [2].
2\. The UE proceeds with the establishment of an IPsec Security Association
(SA) with the selected N3IWF by initiating an IKE initial exchange according
to RFC 7296 [3]. After step 2, all subsequent IKE messages are encrypted and
integrity protected by using the IKE SA established in this step.
3\. The UE shall initiate an IKE_AUTH exchange by sending an IKE_AUTH request
message. The AUTH payload is not included in the IKE_AUTH request message,
which indicates that the IKE_AUTH exchange shall use EAP signalling (in this
case EAP-5G signalling). If the UE supports MOBIKE, it shall include a Notify
payload in the IKE_AUTH request, as specified in RFC 4555 [40], indicating
that MOBIKE is supported. In addition, as specified in TS 33.501 [15], if the
UE is provisioned with the N3IWF root certificate, it shall include the
CERTREQ payload within the IKE_AUTH request message to request the N3IWF\'s
certificate. In the case of WLAN access, if the UE has an MPS subscription,
the UE shall include a Notify payload in the IKE_AUTH request indicating its
MPS subscription.
NOTE 2: Based on operator policy, the N3IWF can use the MPS subscription
indication at this time to handle this UE with priority.
4\. The N3IWF responds with an IKE_AUTH response message, which includes an
EAP-Request/5G-Start packet. The EAP-Request/5G-Start packet informs the UE to
initiate an EAP-5G session, i.e. to start sending NAS messages encapsulated
within EAP-5G packets. If the N3IWF has received a CERTREQ payload from the
UE, the N3IWF shall include the CERT payload in the IKE_AUTH response message
containing the N3IWF\'s certificate. How the UE uses the N3IWF\'s certificate
is specified in TS 33.501 [15].
5\. The UE shall send an IKE_AUTH request, which includes an EAP-
Response/5G-NAS packet that contains the Access Network parameters (AN
parameters) and a Registration Request message. The AN parameters contain
information that is used by the N3IWF for selecting an AMF in the 5G core
network. This information includes e.g. the GUAMI, the Selected PLMN ID (or
PLMN ID and NID, see clause 5.30 of TS 23.501 [2]), the Requested NSSAI and
the Establishment cause. The Establishment cause provides the reason for
requesting a signalling connection with 5GC and the N3IWF may use the
Establishment cause to determine the DSCP value on N2.. Whether and how the UE
includes the Requested NSSAI as part of the AN parameters is dependent on the
value of the Access Stratum Connection Establishment NSSAI Inclusion Mode
parameter, as specified in clause 5.15.9 of TS 23.501 [2]. The registration
request may contain an indication that the UE supports N3IWF selection based
on the slices the UE wishes to use over untrusted non-3GPP access (i.e. that
the UE supports Extended Home N3IWF identifier configuration and Slice-
specific N3IWF prefix configuration). If at step 1 the UE selects the N3IWF
based on Tracking/Location Area of same PLMN as described in clause 6.3.6 of
TS 23.501 [2], the UE may include this TA in the last visited TAI in
registration request in order to help the AMF to determine the target N3IWF as
described in step 17. If the UE in SNPN access mode for NWu interface performs
the Registration procedure for UE onboarding, the UE shall include an
indication in the AN parameters that the connection request is for onboarding.
The Registration Type \"SNPN Onboarding\" indicates that the UE wants to
perform SNPN Onboarding Registration.
NOTE 3: The N3IWF does not send an EAP-Identity request because the UE
includes its identity in the first IKE_AUTH. This is in line with RFC 7296 [3]
clause 3.16.
6\. The N3IWF shall select an AMF based on the received AN parameters and
local policy, as specified in clause 6.3.5 of TS 23.501 [2]. The N3IWF shall
then forward the Registration Request received from the UE to the selected AMF
within an N2 message. This message contains N2 parameters that include the
Selected PLMN ID and optionally the Selected NID and the Establishment cause.
NOTE 4: The Selected NID is present when the UE connects to an SNPN via
Untrusted non-3GPP access.
7\. The selected AMF may decide to request the SUCI by sending a NAS Identity
Request message to UE. This NAS message and all subsequent NAS messages are
sent to UE encapsulated within EAP/5G-NAS packets. The AMF may use the
Establishment cause to determine the Message Priority header and then the DSCP
value for subsequent signalling according to TS 29.500 [17].
8\. The AMF may decide to authenticate the UE by invoking an AUSF. In this
case, the AMF shall select an AUSF as specified in clause 6.3.4 of TS 23.501
[2] based on SUPI or SUCI.
The AUSF executes the authentication of the UE as specified in TS 33.501 [15].
The AUSF selects a UDM as described in clause 6.3.8 of TS 23.501 [2] and gets
the authentication data from UDM. The authentication packets are encapsulated
within NAS authentication messages and the NAS authentication messages are
encapsulated within EAP/5G-NAS packets. After the successful authentication:
\- In step 8h, the AUSF shall send the anchor key (SEAF key) to AMF which is
used by AMF to derive NAS security keys and a security key for N3IWF (N3IWF
key). The UE also derives the anchor key (SEAF key) and from that key it
derives the NAS security keys and the security key for N3IWF (N3IWF key). The
N3IWF key is used by the UE and N3IWF for establishing the IPsec Security
Association (in step 11).
\- In step 8h, the AUSF shall also include the SUPI, if in step 8a the AMF
provided to AUSF a SUCI.
NOTE 5: EAP-AKA\' or 5G-AKA are allowed for the authentication of UE via
non-3GPP access, as specified in TS 33.501 [15]. Figure 4.12.2.2-1 only shows
authentication flow using EAP-AKA\'. Authentication methods other than EAP-
AKA\' or 5G-AKA are also allowed for UE accessing SNPN services via a PLMN, as
specified in TS 33.501 [15], Annex I, as well as for UE accessing SNPN
services directly via Untrusted non-3GPP access.
If the UE in SNPN access mode for NWu interface performs the Registration
procedure for UE onboarding, the interaction between AMF and AUSF (step 8a,
8b, 8g and 8h in Figure 4.12.2.2-1) is replaced with step 9-1 or step 9-2 or
step 9-3 in Figure 4.2.2.2.4-1, depending on the 5GC architecture that is used
for UE onboarding.
9a. The AMF shall send a NAS Security Mode Command to UE in order to activate
NAS security. If an EAP-AKA\' authentication was successfully executed in step
8, the AMF shall encapsulate the EAP-Success received from AUSF within the NAS
Security Mode Command message.
9b. The N3IWF shall forward the NAS Security Mode Command message to UE within
an EAP/5G-NAS packet.
9c. The UE completes the EAP-AKA\' authentication (if initiated in step 8),
creates a NAS security context and an N3IWF key and sends the NAS Security
Mode Complete message within an EAP/5G-NAS packet.
9d. The N3IWF relays the NAS Security Mode Complete message to the AMF.
10a. Upon receiving NAS Security Mode Complete, the AMF shall send an NGAP
Initial Context Setup Request message that includes the N3IWF key.
10b. This triggers the N3IWF to send an EAP-Success to UE, which completes the
EAP-5G session. No further EAP-5G packets are exchanged.
11\. The IPsec SA is established between the UE and N3IWF by using the common
N3IWF key that was created in the UE in step 9c and received by the N3IWF in
step 10a. This IPsec SA is referred to as the \"signalling IPsec SA\". After
the establishment of the signalling IPsec SA, the N3IWF notifies the AMF that
the UE context (including AN security) was created by sending a NGAP Initial
Context Setup Response. The signalling IPsec SA shall be configured to operate
in tunnel mode and the N3IWF shall assign to UE an \"inner\" IP address. The
N3IWF may apply a DSCP value to this signalling IPsec SA, in which case all IP
packets exchanged between the UE and N3IWF via the \"signalling IPsec SA\"
shall be marked with this DSCP value. If the N3IWF has received an indication
that the UE supports MOBIKE (see step 3), then the N3IWF shall include a
Notify payload in the IKE_AUTH response message sent in step 11a, indicating
that MOBIKE shall be supported, as specified in RFC 4555 [40].
NOTE 6: The DSCP value is determined by operator policy, and may e.g., be
based on the DSCP value on N2.
All subsequent NAS messages exchanged between the UE and N3IWF shall be sent
via the signalling IPsec SA and shall be carried over TCP/IP. The UE shall
send NAS messages within TCP/IP packets with source address the \"inner\" IP
address of the UE and destination address the NAS_IP_ADDRESS that is received
in step 11a. The N3IWF shall send NAS messages within TCP/IP packets with
source address the NAS_IP_ADDRESS and destination address the \"inner\" IP
address of the UE. The TCP connection used for reliable NAS transport between
the UE and N3IWF shall be initiated by the UE right after the signalling IPsec
SA is established in step 11a. The UE shall send the TCP connection request to
the NAS_IP_ADDRESS and to the TCP port number specified in TS 24.502 [41].
12\. The AMF determines the allowed subset of the Requested NSSAI that is
allowed by the Subscribed S-NSSAI(s); the AMF may detect that the N3IWF used
by the UE is not compatible with this allowed subset and based on operator\'s
policy configured in the AMF, the AMF determines whether a different N3IWF
should be used. If the UE supports slice-based N3IWF selection and the AMF
determines to use a different N3IWF, then the AMF proceeds with steps 15-19.
Otherwise, i.e. if the AMF determines to use the selected N3IWF that supports
part of the allowed subset, the AMF proceeds with steps 13 and 14. In this
case, steps 15-19 are skipped.
NOTE 7: The AMF considers the subscribed S-NSSAI(s) before determining to
trigger the UE PCF to avoid triggering the UE PCF to update the UE policies
for Requested S-NSSAIs that the UE is not subscribed for.
13\. The AMF sends the NAS Registration Accept message in an N2 message sent
to the N3IWF. The N2 Message includes the Allowed NSSAI for the access type
for the UE. The Allowed NSSAI is a subset of the slices supported by the
selected N3IWF.
14\. The N3IWF forwards the NAS Registration Accept message to UE via the
established signalling IPsec SA. If the NAS Registration Accept message is
received by the N3IWF before the IPsec SA is established, the N3IWF shall
store it and forward it to the UE only after the establishment of the
signalling IPsec SA.
Steps 15 to 19 correspond to the case where the AMF has detected that the
N3IWF used by the UE is not compatible with the subset of the requested NSSAI
that is allowed by the subscribed S-NSSAI(s).
15\. If the UE Registration Request contains an indication that the UE
supports N3IWF selection based on the slices the UE wishes to use over
untrusted non-3GPP access and the AMF is able to select a UE PCF that supports
UE policies for slice specific N3IWF selection, the AMF may trigger UE policy
association establishment if a suitable UE policy association does not exist
yet.
Then the AMF triggers the UE PCF to update the UE policies for slice specific
N3IWF selection by either indicating the request in
Npcf_UEPolicyControl_Create or, if a UE policy already exists, by issuing a
Npcf_UEPolicyControl_Update.
The AMF requests the PCF to receive a notification when the PCF has completed
the update of these UE policies.
NOTE 8: The UE is assumed to inform PCF whether the UE supports Extended Home
N3IWF identifier configuration and Slice-specific N3IWF prefix configuration
as part of the UE policy update procedure. Details will be specified in Stage
3 specifications.
16\. The PCF updates the UE policies for slice specific N3IWF selection per
the procedure defined in figure 4.2.4.3-1. When the update of these UE
policies is completed, the PCF notifies the AMF by invoking
Npcf_UEPolicyControl_UpdateNotify.
17\. The AMF sends via the N3IWF a UE Registration Reject indicating that the
UE selected N3IWF was not appropriate for the requested slices that the UE is
allowed to access to. The AMF optionally may provide target N3IWF information
(FQDN and/or IP address) to the UE within the Registration Reject message.
NOTE 9: The AMF may determine a target N3IWF that supports the subset of the
requested NSSAI that is allowed by the subscribed S-NSSAI(s) based on the list
of supported TAs and the corresponding list of supported slices for each TA
obtained in N2 interface management procedures as specified in TS 38.413 [10].
To determine the target N3IWF, the AMF may take into account UE location
corresponding to last visited TAI included in Registration Request as
described at step 5 when the UE selects N3IWF based on Tracking/Location Area
of same PLMN.
18\. If supported by the UE and if the UE received target N3IWF information in
step 17, the UE connects to the target N3IWF, otherwise the UE may perform
N3IWF selection again using the updated N3IWF selection information received
in step 16. The UE uses the target N3IWF information in the Registration
Reject only for the N3IWF selection directly following the rejected
registration and UE shall not store for future use.
The AMF provides the Access Type set to \"Non-3GPP access\" to the UDM when it
registers with the UDM and the RAT type determined as specified in clause
5.3.2.3 of TS 23.501 [2].
NOTE 10: The Access Type and the RAT type are is set to \"Untrusted Non-3GPP
access\" even when the UE accesses SNPN services via PLMN over 3GPP access.
#### 4.12.2.3 Emergency Registration for untrusted non-3GPP Access
Emergency Registration procedure is used by UEs requiring to perform emergency
services but cannot gain normal services from the network. These UEs are in
limited service state as defined in TS 23.122 [22].
The regular registration procedure described in clause 4.12.2 applies with the
following differences:
\- If the UE has no SUPI and no valid 5G-GUTI, PEI shall be included instead
of its encrypted Permanent User ID (SUCI) in the NAS message.
\- NSSAI shall not be included by the UE. The AMF shall not send the Allowed
NSSAI in the Registration Accept message.
\- If the AMF is not configured to support Emergency Registration, the AMF
shall reject any Registration Request that indicates Registration type
\"Emergency Registration\".
\- If the AMF is configured to support Emergency Registration for
unauthenticated UEs and the UE indicated Registration Type \"Emergency
Registration\", the AMF skips the authentication and security setup or the AMF
accepts that the authentication may fail and continues the Emergency
Registration procedure.
\- If the authentication is performed successfully, the NAS messages will be
protected by the NAS security functions (integrity and ciphering). The AMF
shall derive the N3IWF key, per TS 33.501 [15] and shall provide it to the
N3IWF after the authentication completion using an NGAP Initial Context Setup
Request message as in the regular registration procedure.
\- If the authentication is skipped or authentication fails, the NAS messages
will not be protected by the NAS security functions (integrity and ciphering).
However, the AMF shall create an N3IWF key and shall provide it to the N3IWF
after the authentication completion (whenever authentication has failed or has
been skipped) using an NGAP Initial Context Setup Request message. The N3IWF
shall use it to complete IKE SA establishment and shall acknowledge the AMF by
sending an NGAP Initial Context Setup Response message.
NOTE: According to TS 33.501 [15], the UE and the AMF independently generate
the KAMF (and derived keys) in an implementation defined way and populate the
5G NAS security context with this KAMF to be used when activating a 5G NAS
security context.\"
\- As in step 14 of figure 4.2.2.2.2-1 for Emergency Registration, if the UE
was not successfully authenticated, the AMF shall not update the UDM. Also for
an Emergency Registration, the AMF shall not check for access restrictions,
regional restrictions or subscription restrictions.
\- Steps 16 and 21b of figure 4.2.2.2.2-1 are not performed since AM and UE
policy for the UE are not required for Emergency Registration.
### 4.12.3 Deregistration procedure for untrusted non-3gpp access
Figure 4.12.3-1: Deregistration procedure for untrusted non-3gpp access
1\. The Deregistration procedure is triggered by one of the events:
1a. For UE-initiated Deregistration as in steps from 1 to 7 of Figures
4.2.2.3.2-1.
1b. For network initiated deregistration as in steps from 1 to 6 of Figure
4.2.2.3.3-1.
If the UE is in CM-CONNECTED state either in 3GPP access, non-3GPP access or
both,
\- the AMF may explicitly deregister the UE by sending a Deregistration
request message ( Deregistration type, access type set to non-3GPP) to the UE
as in step 2 of Figure 4.2.2.3.3-1.
\- the UDM may want to request the deletion of the subscribers RM contexts and
PDU Sessions with the reason for removal set to subscription withdrawn to the
registered AMF as in step 1 of Figure 4.2.2.3.3-1.
2\. AMF to N3IWF: The AMF sends a N2 Context UE Release Command message to the
N3IWF with the cause set to Deregistration to release N2 signalling as defined
in step 4 of clause 4.12.4.2.
3\. N3IWF to UE: The N3IWF sends INFORMATIONAL Request (Delete payload)
message to the UE. The Delete payload is included to indicate the release of
the IKE SA.
4\. UE to N3IWF: The UE sends an empty INFORMATIONAL Response message to
acknowledge the release of the IKE SA as described in RFC 7296 [3]. Non-3GPP
access specific resources are released including the IKEv2 tunnel (and the
associated IPSec resources) and the local UE contexts in N3IWF (N3 tunnel Id).
5\. N3IWF to AMF: The N3IWF acknowledges the N2 UE Context Release Command
message by sending N2 UE Context Release Complete message to the AMF as
defined in step 7 of clause 4.12.4.2.
### 4.12.4 N2 procedures via Untrusted non-3GPP Access
#### 4.12.4.1 Service Request procedures via Untrusted non-3GPP Access
The Service Request procedure via Untrusted non-3GPP Access shall be used by a
UE in CM-IDLE state over non-3GPP access to request the re-establishment of
the NAS signalling connection and the re-establishment of the user plane for
all or some of the PDU Sessions which are associated to non-3GPP access.
The Service Request procedure via Untrusted non-3GPP Access shall be used by a
UE in CM-CONNECTED state over non-3GPP access to request the re-establishment
of the user plane for one or more PDU Sessions which are associated to
non-3GPP access.
When the UE is in CM-IDLE state over non-3GPP access, the Service Request
procedure via Untrusted non-3GPP Access is as described in clause 4.2.3.2 (UE
Triggered Service Request) with the following exceptions:
\- The Service Request procedure is never a response to a Paging, i.e. there
is no Network Triggered Service Request procedure via Untrusted non-3GPP
Access.
\- The (R)AN corresponds to an N3IWF.
\- The UE establishes a \"signalling IPsec SA\" with the N3IWF by using the
procedure specified in clause 4.12.2 for the registration via untrusted
non-3GPP access. In particular, the UE includes the Service Request and the AN
parameters in an EAP-5G packet, which is further encapsulated in an IKE_AUTH
request.
\- The AN parameters include the Selected PLMN ID (or PLMN ID and NID, see
clause 5.30 of TS 23.501 [2]) and Establishment cause. The Establishment cause
provides the reason for requesting a signalling connection with the 5GC. The
UE includes GUAMI information in the AN parameters. The N3IWF selects the AMF
according to GUAMI information.
\- The N2 parameters sent from N3IWF to AMF include the Establishment cause.
\- The user plane between the UE and N3IWF is established not with RRC
signalling but with IKEv2 signalling, as specified in clause 4.12.5 (i.e. by
using an IKEv2 Create_Child_SA exchange). The IKEv2 Create Child SA Request
may include the Additional QoS Information to reserve non-3GPP specific QoS
resources as defined in clause 4.12a.5. The user plane of each PDU Session
consists of one or more Child SAs.
When the UE is in CM-CONNECTED state over non-3GPP access, the Service Request
procedure via Untrusted non-3GPP Access is as described in clause 4.2.3.2 (UE
Triggered Service Request) with the following exceptions:
\- All NAS signalling exchanged between the UE and network is transferred
within the established \"signalling IPsec SA\".
\- The (R)AN corresponds to an N3IWF.
\- The user plane between the UE and N3IWF is established not with RRC
signalling but with IKEv2 signalling, as specified in clause 4.12.5 (i.e. by
using an IKEv2 Create_Child_SA exchange). The user plane of each PDU Session
consists of one or more Child SAs.
When the UE is in CM-CONNECTED state over non-3GPP access and the network
receives downlink data for a PDU Session over non-3GPP access that has no user
plane, the steps 1-4a in clause 4.2.3.3 (Network Triggered Service Request)
shall be performed with the following exceptions:
\- The (R)AN corresponds to an N3IWF.
\- The user plane between the UE and N3IWF is established (in step 4a) with
IKEv2 signalling, as specified in clause 4.12.5 (i.e. by using an IKEv2
Create_Child_SA exchange). The user plane of each PDU Session consists of one
or more Child SAs.
#### 4.12.4.2 Procedure for the UE context release in the N3IWF
This procedure is used to release the N2 signalling connection and the N3 User
Plane connection. If the procedure is initiated by the AMF the IKEv2 SA for a
UE is being released. The procedure will move the UE from CM-CONNECTED to CM-
IDLE in AMF and all UE related context information is deleted in the N3IWF.
Both N3IWF-initiated and AMF-initiated UE context release in the N3IWF
procedures are shown in Figure 4.12.4.2-1.
Figure 4.12.4.2-1: Procedure for the UE context release in the N3IWF
1\. The UE has already registered in the 5GC and may have established one or
multiple PDU Sessions.
2\. The N3IWF detects that the UE is not reachable.
3\. The N3IWF sends a N2 UE Context Release Request message to the AMF This
step is equivalent to step 1b of Figure 4.2.6-1.
NOTE: AN Release procedure can also be triggered by an AMF internal event and
in that case step 2 and step 3 do not take place.
4\. AMF to N3IWF: If the AMF receives the N2 UE Context Release Request from
N3IWF or if due to an internal AMF event the AMF wants to release N2
signalling, the AMF sends an N2 UE Context Release Command (Cause) to the
N3IWF. The cause indicated is cause from step 3 or a cause due to internal AMF
event. This step is equivalent to step 2 of Figure 4.2.6-1.
5\. If the IKEv2 tunnel has not been released yet, the N3IWF performs the
release of the IPsec tunnel as defined in RFC 7296 [3] indicating to release
the IKE SA and any Child IPSec SA if existing. The N3IWF sends to the UE the
indication of the release reason if received in step 4.
6\. The UE sends an empty INFORMATIONAL Response message to acknowledge the
release of the IKE SA as described in RFC 7296 [3]. The N3IWF deletes the
UE\'s context after receiving the empty INFORMATIONAL Response message.
7\. N3IWF to AMF: The N3IWF confirms the release of the UE-associated
N2-logical connection by returning N2 UE Release Complete (list of PDU Session
ID(s) with active N3 user plane) to the AMF as in step 4 defined in clause
4.2.6. The AMF marks the UE as CM-IDLE state in untrusted non-3GPP access.
8\. For each of the PDU Sessions in the N2 UE Context Release Complete, the
steps 5 to 7 in clause 4.2.6 are performed (PDU Session Update SM Context).
After the AMF receives the Nsmf_PDUSession_UpdateSMContext Response as in step
7 of clause 4.2.6, the AMF considers the N3 connection as released. If list of
PDU Session ID(s) with active N3 user plane is included in step 3, then this
step is performed before step 4.
#### 4.12.4.3 CN-initiated selective deactivation of UP connection of an
existing PDU Session associated with Untrusted non-3GPP Access
The procedure described in clause 4.3.7 (CN-initiated selective deactivation
of UP connection of an existing PDU Session) is used for CN-initiated
selective deactivation of UP connection for an established PDU Session
associated with non-3GPP Access of a UE in CM-CONNECTED state, with the
following exceptions:
\- The NG-RAN corresponds to an N3IWF.
\- The user plane between the UE and N3IWF, i.e. Child SA(s) for the PDU
Session, is released not with RRC signalling but with IKEv2 signalling, as
specified in clause 4.12.7.
### 4.12.5 UE Requested PDU Session Establishment via Untrusted non-3GPP
Access
Clause 4.12.5 specifies how a UE can establish a PDU Session via an untrusted
non-3GPP Access Network as well as to hand over an existing PDU Session
between 3GPP access and non-3GPP access. The procedure applies in non-roaming,
roaming with LBO as well as in home-routed roaming scenarios.
For non-roaming and LBO scenarios, if the UE is simultaneously registered to a
3GPP access in a PLMN different from the PLMN of the N3IWF, the functional
entities in the following procedures are located in the PLMN of the N3IWF. For
home-routed roaming scenarios, the AMF, V-SMF and associated UPF in VPLMN in
the following procedure is located in the PLMN of the N3IWF.
The procedure below is based on the PDU Session Establishment procedure
specified in clause 4.3.2.2.1 (for non-roaming and roaming with LBO) and the
PDU Session Establishment procedure specified in clause 4.3.2.2.2 (for home-
routed roaming).
Figure 4.12.5-1: PDU Session establishment via untrusted non-3GPP access
1\. The UE shall send a PDU Session Establishment Request message to AMF as
specified in step 1 of clause 4.3.2.2.1. This message shall be sent to N3IWF
via the IPsec SA for NAS signalling (established as specified in clause
4.12.2) and the N3IWF shall transparently forward it to AMF in the 5GC.
2a. In the case of non-roaming or roaming with Local Breakout, steps 2-11
specified in clause 4.3.2.2.1are executed according to the PDU Session
Establishment procedure over 3GPP access. In the case of home-routed roaming,
steps 2-14 specified in clause 4.3.2.2.2 are executed according to the PDU
Session Establishment procedure over 3GPP access.
2b. As described in step 12 of clause 4.3.2.2.1, the AMF shall send a N2 PDU
Session Request message to N3IWF to establish the access resources for this
PDU Session.
3\. Based on its own policies and configuration and based on the QoS profiles
received in the previous step, the N3IWF shall determine the number of IPsec
Child SAs to establish and the QoS profiles associated with each IPsec Child
SA. For example, the N3IWF may decide to establish one IPsec Child SA and
associate all QoS profiles with this IPsec Child SA. In this case, all QoS
Flows of the PDU Session would be transferred over one IPsec Child SA.
4a. The N3IWF shall send to UE an IKE Create_Child_SA request according to the
IKEv2 specification in RFC 7296 [3] to establish the first IPsec Child SA for
the PDU Session. The IKE Create_Child_SA request indicates that the requested
IPsec Child SA shall operate in tunnel mode. This request shall include a
3GPP-specific Notify payload which contains (a) the QFI(s) associated with the
Child SA, (b) the identity of the PDU Session associated with this Child SA,
(c) optionally, a DSCP value associated with the Child SA, (d) optionally a
Default Child SA indication and (e) optionally, the Additional QoS Information
specified in clause 4.12a.5
The IKE Create_Child_SA request shall also include another 3GPP-specific
Notify payload, which contains the UP_IP_ADDRESS that is specified in step 8
below.
If a DSCP value is included, then the UE and the N3IWF shall mark all IP
packets sent over this Child SA with this DSCP value. There shall be one and
only one Default Child SA per PDU session. The UE shall send all QoS Flows to
this Child SA for which there is no mapping information to a specific Child
SA. The IKE Create_Child_SA request also contains other information (according
to RFC 7296 [3]) such as the SA payload, the Traffic Selectors (TS) for the
N3IWF and the UE, etc.
After receiving the IKE Create_Child_SA request, if the Additional QoS
Information is received, the UE may reserve non-3GPP Access Network resources
according to the Additional QoS Information.
4b. If the UE accepts the new IPsec Child SA, the UE shall send an IKE
Create_Child_SA response according to the IKEv2 specification in RFC 7296 [3].
During the IPsec Child SA establishment the UE shall not be assigned an IP
address.
4c-4d. If in step 3 the N3IWF determined to establish multiple IPsec Child SAs
for the PDU Session, then additional IPsec Child SAs shall be established,
each one associated with one or more QFI(s), optionally with a DSCP value,
with a UP_IP_ADDRESS and optionally with the Additional QoS Information
specified in clause 4.12a.5. For each IPsec Child SA, if the Additional QoS
Information is received, the UE may reserve non-3GPP Access Network resources
according to the Additional QoS Information for the IPsec Child SA.
5\. After all IPsec Child SAs are established, the N3IWF shall forward to UE
via the signalling IPsec SA (see clause 4.12.2.2) the PDU Session
Establishment Accept message received in step 2b.
6\. The N3IWF shall send to AMF an N2 PDU Session Response.
7\. In the case of non-roaming or roaming with Local Breakout, all steps
specified in clause 4.3.2.2.1 after step 14 are executed according to the PDU
Session Establishment procedure over 3GPP access. In the case of home-routed
roaming, all steps specified in clause 4.3.2.2.2 after step 18 are executed
according to the PDU Session Establishment procedure over 3GPP access.
8\. On the user-plane:
\- When the UE has to transmit an UL PDU, the UE shall determine the QFI
associated with the UL PDU (by using the QoS rules of the PDU Session), it
shall encapsulate the UL PDU inside a GRE packet and shall forward the GRE
packet to N3IWF via the IPsec Child SA associated with this QFI. The header of
the GRE packet carries the QFI associated with the UL PDU. The UE shall
encapsulate the GRE packet into an IP packet with source address the \"inner\"
IP address of the UE and destination address the UP_IP_ADDRESS associated with
the Child SA.
\- When the N3IWF receives a DL PDU via N3, the N3IWF uses the QFI and the
identity of the PDU Session in order to determine the IPsec Child SA to use
for sending the DL PDU over NWu. The N3IWK encapsulates the DL PDU inside a
GRE packet and copies the QFI in the header of the GRE packet. The N3IWF may
include also in the GRE header a Reflective QoS Indicator (RQI), which shall
be used by the UE to enable reflective QoS. The N3IWF shall encapsulate the
GRE packet into an IP packet with source address the UP_IP_ADDRESS associated
with the Child SA and destination address the \"inner\" IP address of the UE.
### 4.12.6 UE or Network Requested PDU Session Modification via Untrusted
non-3GPP access
The UE or network requested PDU Session Modification procedure via untrusted
non-3GPP access is depicted in figure 4.12.6-1. The procedure applies in non-
roaming, roaming with LBO as well as in home-routed roaming scenarios.
For non-roaming and LBO scenarios, the functional entities in the following
procedures are located in the PLMN of the N3IWF.
The procedure below is based on the PDU Session Modification procedure
specified in clause 4.3.3.2 (for non-roaming and roaming with LBO) and on the
PDU Session Modification procedure specified in clause 4.3.3.3 (for home-
routed roaming).
Figure 4.12.6-1: UE or Network Requested PDU Session Modification via
untrusted non-3GPP access
1\. If the PDU Session Modification procedure is initiated by the UE, the UE
shall send a PDU Session Modification Request message to AMF as specified in
step 1 of clause 4.3.2.2. The message shall be sent to N3IWF via the
established IPsec SA for NAS signalling. The N3IWF shall transparently forward
the PDU Session Modification Request to AMF/SMF.
2\. In the case of non-roaming or LBO, the steps 1a (from AMF) to 1e and steps
2-3 as per the PDU Session Modification procedure in clause 4.3.3.2 are
executed.
In the case of home-routed, the steps 1a (from AMF) to 1d and steps 2-3 as per
the PDU Session Modification procedure in clause 4.3.3.3 are executed.
3\. The AMF sends N2 PDU Session Resource Modify Request (N2 SM information
received from SMF, NAS message) message to the N3IWF. This step is the same as
step 4 in clause 4.3.3.2 (for non-roaming and roaming with Local Breakout) and
step 5 in clause 4.3.3.3 (for home-routed roaming).
4\. The N3IWF may issue IKEv2 signalling exchange with the UE that is related
with the information received from SMF according to the IKEv2 specification in
RFC 7296 [3]. Based on the N2 SM information received from the SMF, the N3IWF
may perform one of the following:
4a. The N3IWF may decide to create a new Child SA for the new QoS Flow(s). In
this case, the N3IWF establishes a new Child SA by sending an
IKE_CREATE_CHILD_SA request message, which includes the SA, the PDU Session
ID, the QFI(s), optionally a DSCP value and optionally the Additional QoS
Information specified in clause 4.12a.5. If the Additional QoS Information is
received, the UE may reserve non-3GPP Access Network resources according to
the Additional QoS Information.
4b. The N3IWF may decide to add or remove QoS Flow(s) to/from an existing
Child SA. In this case, the N3WIF updates the QoS Flow and Child SA mapping
information by sending an INFORMATIONAL request message, which includes the
QFI(s) associated with the Child SA and optionally the Additional QoS
Information specified in clause 4.12a.6, which contains the new QoS
information that should be associated with the existing Child SA. If the
Additional QoS Information is received, the UE may update the reserved
non-3GPP Access Network resources for the existing Child SA according to the
Additional QoS Information.
4c. The N3IWF may decide to delete an existing Child SA, e.g. when there is no
QoS Flow mapped to this Child SA. In this case, the N3IWF deletes the existing
Child SA by sending INFORMATIONAL request message, which includes a Delete
payload.
NOTE: If the N3IWF has included the Default Child SA indication during the
establishment of one of the Child SAs of the PDU Session, the N3IWF may not
update the mapping between QoS Flows Child SAs.
5\. The N3IWF acknowledges N2 PDU Session Request by sending a N2 PDU Session
Response Message to the AMF to acknowledge the success or failure of the
request.
6\. In the case of non-roaming or LBO, step 7 as per the PDU Session
Modification procedure in clause 4.3.3.2 is executed. In the case of home-
routed, the steps 8-10 as per the PDU Session Modification procedure in clause
4.3.3.3 are executed.
7\. The N3IWF sends the PDU Session Modification Command to UE (if received in
step 3) and receives the response message from UE.
Steps 4a/4c and step 7 may happen consecutively. Steps 7b map happen before
step 4b/4d.
8\. The N3IWF forwards the NAS message to the AMF.
9\. For non-roaming and roaming with LBO, all the steps after step 10 in
clause 4.3.3.2 are executed according to the general PDU Session Modification
procedure. For home-routed roaming, all steps after step 13 in clause 4.3.3.3
are executed according to the general PDU Session Modification procedure.
### 4.12.7 UE or network Requested PDU Session Release via Untrusted non-3GPP
access
Clause 4.12.7 specifies how a UE or network can release a PDU Session via an
untrusted non-3GPP Access Network. The UE requested PDU Session Release
procedure via Untrusted non-3GPP access applies in non-roaming, roaming with
LBO as well as in home-routed roaming scenarios.
For non-roaming and LBO scenarios, if the UE is simultaneously registered to a
3GPP access in a PLMN different from the PLMN of the N3IWF, the functional
entities in the following procedures are located in the PLMN of the N3IWF. For
home-routed roaming scenarios, the AMF, V-SMF and associated UPF in VPLMN in
the following procedure is located in the PLMN of the N3IWF.
NOTE: If the UE is simultaneously registered to 3GPP access in the same PLMN
as non-3GPP access, when non-3GPP access is not available to the UE (e.g. due
to out of non-3GPP access coverage) or UE is in CM-IDLE for non-3GPP access,
the UE may perform the PDU Session Release procedure via 3GPP access as
described in clause 4.3.4.
Figure 4.12.7-1: UE Requested PDU Session Release via Untrusted non-3GPP
access
1\. One or more PDU Sessions are already established for the UE using the
procedure described in clause 4.12.2.
2\. The UE sends a NAS message (N1 SM container (PDU Session Release Request),
PDU Session ID) to the AMF via the N3IWF as defined in clause 4.3.4.
3\. For non-roaming and roaming with LBO, the steps 1a (from AMF) to 4
according to the PDU Session Release procedure defined in clause 4.3.4.2 are
executed. For home-routed roaming, the steps 1a (from AMF) to step 7 according
to the PDU Session Release procedure defined in clause 4.3.4.3 are executed.
4\. This step is the same as step 4 in clause 4.3.4.2 (non-roaming and LBO)
and step 6 in clause 4.3.4.3 (home-routed roaming).
If the message received from the SMF does not include N2 SM Resource Release
request, the AMF sends N2 Downlink NAS transport (N1 SM container (PDU Session
Release Command), PDU Session ID,Cause) message to the N3IWF and steps 5 to 8
are skipped.
5\. Upon receiving AN session release request message from the AMF, the N3IWF
triggers the release of the corresponding Child SA by sending INFORMATIONAL
EXCHANGE (Delete Payload) to the UE. Delete payload is included in the message
listing the SPIs of the Child SAs to be deleted to this PDU Session as
described in RFC 7296 [3].
6\. The UE responds with INFORMATIONAL EXCHANGE (Delete Payload) message.
Delete payload is included for the paired SAs going in the other direction as
described in RFC 7296 [3].
7\. This step is the same as step 6 in 4.3.4.2 (non-roaming and LBO) and step
8 in clause 4.3.4.3 (home-routed roaming).
8\. For non-roaming and roaming with LBO, steps 7 according to the PDU Session
Release procedure defined in clause 4.3.4.2 are executed. For home-routed
roaming, step 9-10 according to the PDU Session Release procedure defined in
clause 4.3.4.3 are executed.
9\. The N3IWF delivers the NAS message (N1 SM container (PDU Session Release
Command), PDU Session ID, Cause) to the UE.
10\. The UE sends a NAS message (N1 SM container (PDU Session Release Ack),
PDU Session ID) to the N3IWF.
11\. This step is the same as step 9 in 4.3.4.2 (non-roaming and LBO) and step
11 in clause 4.3.4.3 (home-routed roaming).
Steps 5 and 9 may happen consecutively. Step 10 may happen before step 6.
12\. For non-roaming and roaming with LBO, all steps after step 10 in the PDU
Session Release procedure defined in clause 4.3.4.2 are executed. In the case
of home-routed roaming, all steps after step 12 in the PDU Session Release
procedure defined in clause 4.3.4.3 are executed.
The network requested PDU Session Release procedure via Untrusted non-3GPP
access is the same as the network requested PDU Session Release Procedure
specified in clause 4.3.4.2 (for Non-Roaming and Roaming with Local Breakout)
with the following differences:
\- The (R)AN corresponds to an N3IWF.
\- In step 5 the N3IWF upon receiving N2 SM request to release the AN
resources associated with the PDU Session from the AMF, the N3IWF triggers the
release of the corresponding Child SA to the UE as specified in step 5 and 6,
in Figure 4.12.7-1.
\- User Location Information is not included in the step 6, 7a, 9, 10a and 12
of the procedure.
### 4.12.8 Mobility from a non-geographically selected AMF to a geographically
selected AMF
This procedure describes the AMF change that takes place when an UE initially
served via non-3GPP access by an AMF selected based on non-geographical
criteria (e.g. because the UE had no 3GPP access coverage or because only non-
geographically selectable N3IWF are deployed) gets 3GPP access and is now to
be served by an AMF selected in the same PLMN by the NG-RAN based on
geographical criteria.
Figure 4.12.8-1: Mobility from a non-geographically selected AMF to a
geographically selected AMF
1\. The UE registers over non-3GPP access, as described in clause 4.12.2.
During this procedure:
a An AMF (source AMF) is selected by the N3IWF in step 6a, based on non-
geographical criteria (e.g. because the UE has no 3GPP access coverage or
because only non-geographically selectable N3IWF are deployed).
b The UE receives, within the Registration Accept message, a 5G-GUTI
containing a GUAMI of the non-geographically selected AMF. The UE also
receives an Allowed NSSAI and optionally Mapping Of Allowed NSSAI.
2\. The UE may activate PDU Sessions over non-3GPP access, as described in
clause 4.12.5.
3\. The UE gets 3GPP access and issues a Registration Request over 3GPP access
as defined in step 1 of Figure 4.2.2.2.2-1, providing its 5G-GUTI.
If the 5G-GUTI does not indicate an AMF of the same Region ID as that of the
NG-RAN, the NG-RAN selects an AMF Set and an AMF in the AMF Set as described
in clause 6.3.5 of TS 23.501 [2].
Steps 3 to 22 of Figure 4.2.2.2.2-1 take place including following aspects:
\- step 4 of Figure 4.2.2.2.2-1 takes place i.e. the new AMF invokes the
Namf_Communication_UEContextTransfer service operation on the old AMF to
request the UE\'s SUPI and MM Context.
\- in step 5 of Figure 4.2.2.2.2-1, the old AMF includes information about
active NGAP association to N3IWF.
\- in step 18 of Figure 4.2.2.2.2-1, the new AMF modifies the NGAP association
toward N3IWF.
\- in step 21 of Figure 4.2.2.2.2-1, the Registration Accept message shall
include the updated 5G-GUTI that the UE will use to update its 3GPP and
non-3GPP registration contexts.
## 4.12a Procedures for Trusted non-3GPP access
### 4.12a.1 General
Clause 4.12a defines the procedures to support trusted non-3GPP access by
describing the differences compared to the defined procedures in other
clauses.
### 4.12a.2 Registration via Trusted non-3GPP Access
#### 4.12a.2.1 General
Clause 4.12a.2 specifies how a UE can register to 5GC via a trusted non-3GPP
Access Network. The utilized procedure is very similar with the 5GC
registration procedure over untrusted non-3GPP access in clause 4.12.2.2 and
it is based on the Registration procedure specified in clause 4.2.2.2.2. It
uses the same vendor-specific EAP method (called \"EAP-5G\") as the one
specified in clause 4.12.2.1. In this case, the \"EAP-5G\" method is used
between the UE and the TNGF and is utilized for encapsulating NAS messages.
In Registration and subsequent Registration procedures via trusted non-3GPP
access, the NAS messages are always exchanged between the UE and the AMF. When
possible, the UE can be authenticated by reusing the existing UE security
context in AMF.
#### 4.12a.2.2 Registration procedure for trusted non-3GPP access
The UE connects to a trusted non-3GPP Access Network (TNAN) and it also
registers to 5GC over via this TNAN, by using the EAP-based procedure shown in
the figure 4.12a.2.2. This procedure is very similar with the 5GC registration
procedure over untrusted non-3GPP access in clause 4.12.2.2. The link between
the UE and the TNAN can be any data link (L2) that supports EAP encapsulation,
e.g. PPP, PANA, Ethernet, IEEE 802.3, IEEE 802.11, etc. The interface between
the TNAP and TNGF is an AAA interface.
Figure 4.12a.2.2-1: Registration via trusted non-3GPP access
0\. The UE which is not operating in SNPN access mode for Yt interface selects
a PLMN and a TNAN for connecting to this PLMN by using the Trusted Non-3GPP
Access Network selection procedure specified in clause 6.3.12 of TS 23.501
[2]. During this procedure, the UE discovers the PLMNs with which the TNAN
supports trusted connectivity (e.g. \"5G connectivity\").
The UE operating in SNPN access mode for Yt interface selects an SNPN and a
TNAN for connecting to this SNPN by using the Trusted Non-3GPP Access Network
selection procedure specified in clause 5.30.2.13 of TS 23.501 [2]. During
this procedure, the UE discovers the SNPNs with which the TNAN supports
trusted connectivity (e.g. \"5G connectivity\").
NOTE 1: In this Release, it is assumed that when the trusted non-3GPP access
is a trusted WLAN access, the UE is configured (e.g. with the WLANSP rules
defined in TS 23.503 [20]) to select an TNAN(SSID and TNGF) associated with a
non-3GPP Tracking Area, which supports one or more of the UE\'s subscribed
S-NSSAIs.
1\. A layer-2 connection is established between the UE and the TNAP. In the
case of IEEE Std 802.11 [48], this step corresponds to an 802.11 Association.
In the case of PPP, this step corresponds to a PPP LCP negotiation. In other
types of non-3GPP access (e.g. Ethernet), this step may not be required.
2-3. An EAP procedure is initiated. EAP messages are encapsulated into layer-2
packets, e.g. into IEEE 802.3/802.1x packets, into IEEE 802.11/802.1x packets,
into PPP packets, etc. The NAI provided by the UE not operating in SNPN access
mode for Yt interface indicates that the UE requests \"5G connectivity\" to a
specific PLMN (e.g. NAI = \"\\@nai.5gc.
mnc\.mcc\.3gppnetwork.org\"). In the case of WLAN access, if the UE
has an MPS subscription, the UE shall also include an indication of its MPS
subscription in the username part of the NAI as per TS 23.003 [33]. The NAI
provided by the UE operating in SNPN access mode for Yt interface indicates
that the UE request \"5G connectivity\" to a specific SNPN (e.g. NAI =
\"\\@nai.5gc. nid\.mnc\.mcc\.3gppnetwork.org\").
If the WLANSP rule contains information including TNGF ID to use for specific
slices and the UE supports such information, the UE builds the realm of NAI
taking the TNGF ID into account (e.g. NAI = \"\@ tngfid\. nai.5gc. mnc\.mcc\.3gppnetwork.org\"). This NAI triggers the
TNAP to send an AAA request to a TNGF, which operates as an AAA proxy. Between
the TNAP and TNGF the EAP packets are encapsulated into AAA messages. The AAA
request also include the TNAP identifier, which can be treated as the User
Location Information defined in clause 5.6.2 of TS 23.501 [2]. If a 5G-RG acts
as a TNAP, the 5G-RG may provide its 5G-RG ID in the TNAP identifier.
Editor\'s note: The format of the 5G-RG ID needs to be determined by CT WG4.
NOTE 2: In this Release, it is assumed that when the trusted non-3GPP access
is a trusted WLAN access, the TNAP selects a TNGF based on the realm (e.g.
MCC, MNC and TNGF ID) provided by the UE and also based on the SSID selected
by the UE. In a deployment a TNGF may be reached over different SSID(s) where
the TNGF supports a Tracking Area and be associated with a set of slices, or
an SSID may provide access to one or more TNGF(s), where each of these TNGF(s)
can support a different Tracking Area and a different set of slices.
NOTE 3: Based on operator policy, after receiving the indication of MPS
subscription from the UE, the TNAN can treat this UE with priority.
4-10. An EAP-5G procedure is executed as the one specified in clause 4.12.2.2
for the untrusted non-3GPP access with the following modifications:
\- The registration request may contain an indication that the UE supports
TNGF selection based on the slices the UE wishes to use over trusted non-3GPP
access (i.e. that the UE supports Extended WLANSP rule).
\- A TNGF key (instead of an N3IWF key) is created in the UE and in the AMF
after the successful authentication. The TNGF key is transferred from the AMF
to TNGF in step 10a (within the N2 Initial Context Setup Request). The TNGF
derives a TNAP key, which is provided to the TNAP. The TNAP key depends on the
non-3GPP access technology (e.g. it is a Pairwise Master Key in the case of
IEEE Std 802.11 [48]). How these security keys are created, it is specified in
TS 33.501 [15].
\- In step 5 the UE shall include the Requested NSSAI in the AN parameters
only if allowed, according to the conditions defined in clause 5.15.9 of TS
23.501 [2], for the trusted non-3GPP access. The UE shall also include a UE Id
in the AN parameters, e.g. a 5G-GUTI if available from a prior registration to
the same PLMN or SNPN. If the UE in SNPN access mode for Yt interface performs
the Registration procedure for UE onboarding, the UE shall include an
indication in the AN parameters that the connection request is for onboarding.
\- In the N2 message sent in step 6b, the TNGF includes a UE Location
Information (ULI)including the TNAP ID and the UE IP address based on
information received in step 3. If the ULI includes the IP address, this is
set to a \"null\" IP address (e.g. 0.0.0.0) because the UE is not yet assigned
an IP address. If the TNGF has received the the TNAP ID in step 3 over Ta, the
TNGF includes the TNAP ID within UE Location Information (ULI) sent to AMF.
After the UE is assigned an IP address, the TNGF includes this address in
subsequent N2 messages. This N2 message also includes the Selected PLMN ID and
optionally the Selected NID and the Establishment cause.
NOTE 4: The Selected NID is present when the UE connects to an SNPN via
Trusted non-3GPP access.
\- If the UE in SNPN access mode for Yt interface performs the Registration
procedure for UE onboarding, the interaction between AMF and AUSF (step 8a and
step 8c in Figure 4.12a.2.2-1) is replaced with step 9-1 or step 9-2 or step
9-3 in Figure 4.2.2.2.4-1, depending on the 5GC architecture that is used for
UE onboarding.
\- After receiving the TNGF key from AMF in step 10a, the TNGF shall send to
UE an EAP-Request/5G-Notification packet containing the \"TNGF Contact Info\",
which includes the IP address of TNGF. After receiving an EAP-
Response/5G-Notification packet from the UE in step 10c, the TNGF shall send
message 10d containing the EAP-Success packet.
11\. The TNAP key is used to establish layer-2 security between the UE and
TNAP. In the case of IEEE Std 802.11 [48], a 4-way handshake is executed,
which establishes a security context between the WLAN AP and the UE that is
used to protect unicast and multicast traffic over the air.
12\. The UE receives IP configuration from the TNAN, e.g. with DHCP.
13\. At this point, the UE has successfully connected to the TNAN and has
obtained IP configuration. The UE sets up a secure NWt connection with the
TNGF as follows:
The UE initiates an IKE_INIT exchange using the IP address of TNGF received
during the EAP-5G signalling, in step 10b. Subsequently, the UE initiates an
IKE_AUTH exchange and provides its identity. The identity provided by the UE
in the IKEv2 signalling should be the same as the UE Id included in the AN
parameters in step 5. This enables the TNGF to locate the TNGF key that was
created before for this UE, during the authentication in step 8. The TNGF key
is used for mutual authentication. NULL encryption is negotiated between the
UE and the TNGF, as specified in RFC 2410 [49].
In step 13c, the TNGF provides to UE (a) an \"inner\" IP address, (b) a
NAS_IP_ADDRESS and a TCP port number and (c) a DSCP value. After this step, an
IPsec SA is established between the UE and TNGF. This is referred to as the
\"signalling IPsec SA\" and operates in Tunnel mode. Operation in Tunnel mode
enables the use of MOBIKE [40] for re-establishing the IPsec SAs when the IP
address of the UE changes during mobility events. All IP packets exchanged
between the UE and TNGF via the \"signalling IPsec SA\" shall be marked with
the above DSCP value. The UE and the TNAP may map the DSCP value to a QoS
level (e.g. to an EDCA Access Class [48]) supported by the underlying non-3GPP
Access Network. The mapping of a DSCP value to a QoS level of the non-3GPP
Access Network is outside the scope of 3GPP.
Right after the establishment of the \"signalling IPsec SA\", the UE shall
setup a TCP connection with the TNGF by using the NAS_IP_ADDRESS and the TCP
port number received in step 13c. The UE shall send NAS messages within TCP/IP
packets with source address the \"inner\" IP address of the UE and destination
address the NAS_IP_ADDRESS. The TNGF shall send NAS messages within TCP/IP
packets with source address the NAS_IP_ADDRESS and destination address the
\"inner\" IP address of the UE.
This concludes the setup of the NWt connection between the UE and the TNGF.
All subsequent NAS messages between UE and TNGF are carried over this NWt
connection (i.e. encapsulated in TCP/IP/ESP).
14\. After the NWt connection is successfully established, the TNGF responds
to AMF with an N2 Initial Context Setup Response message.
15\. The AMF determines the allowed subset of the Requested NSSAI that is
allowed by the Subscribed S-NSSAI(s); the AMF may detect that the TNGF used by
the UE is not compatible with this allowed subset and based on operator\'s
policy configured in the AMF, the AMF determines whether a different TNGF
should be used. If the UE supports slice-based TNGF selection and the AMF
determines to use a different TNGF, then the AMF proceeds with steps 17-21.
Otherwise, i.e. if the AMF determines to use the selected TNGF that supports
part of allowed the subset, the AMF proceeds with step 16. In this case, steps
17-21 are skipped.
NOTE 5: The criteria for the AMF to determine that the TNGF used by the UE is
not compatible with the subset of the requested NSSAI that is allowed by the
subscribed S-NSSAI(s) is based on local AMF policies. For example the AMF can
determine that the TNGF used by the UE is compatible as soon as there is one
supported slice in common.
16\. The NAS Registration Accept message is sent by the AMF and is forwarded
to UE via the established NWt connection. Now the UE can use the TNAN (a) to
transfer non-seamless offload traffic and (b) to establish one or more PDU
Sessions.
Steps 17 to 21 correspond to the case where the AMF has detected that TNGF
used by the UE is not compatible with the subset of the requested NSSAI that
is allowed by the subscribed S-NSSAI(s).
17\. If the UE Registration Request contains an indication that the UE
supports TNGF selection based on the slices the UE wishes to use over trusted
non-3GPP access and AMF is able to select a UE PCF that supports UE policies
for slice specific trusted access selection, the AMF may trigger UE policy
association establishment if a suitable UE policy association does not exist
yet.
Then the AMF triggers the UE PCF to update the UE policies for slice specific
trusted access selection by either indicating the request in
Npcf_UEPolicyControl_Create or, if a UE policy already exists, by issuing a
Npcf_UEPolicyControl_Update. The AMF requests the PCF to receive a
notification when the PCF has completed the update of these UE policies.
NOTE 6: The UE is assumed to inform PCF whether the UE supports Extended
WLANSP or ANDSP as part of the UE policy update procedure. Details will be
specified by CT WG1.
18\. The PCF updates the UE policies for slice specific trusted access
selection according to the procedure defined in figure 4.2.4.3-1.
19\. When the update of these policies is completed, the PCF notifies the AMF
by invoking Npcf_UEPolicyControl_UpdateNotify.
20\. The AMF sends via the TNGF a UE Registration Reject indicating that the
selected TNGF was not appropriate for the requested slices that the UE is
allowed to access to. The AMF may provide target TNAN information (SSID, TNGF
ID) to the UE within the Registration Reject message indicating the UE to
build the NAI based on the TNGF ID.
NOTE 7: The AMF may determine a target TNGF that supports the subset of the
requested NSSAI that is allowed by the subscribed S-NSSAI(s) based on the list
of supported TAs and the corresponding list of supported slices for each TA
obtained in N2 interface management procedures as specified in TS 38.413 [10]
and considering UE location.
21\. If supported by the UE and if the UE received target TNAN information in
step 20, the UE connects to the target TNAN, otherwise the UE may perform TNAN
selection again using the updated WLANSP rule received in step 18. If the
target TNAN information includes TNGF ID, the UE shall build the NAI based on
TNGF ID. The UE uses the target TNAN information in the Registration Reject
only for the TNAN selection directly following the rejected registration and
UE shall not store it for future use.
#### 4.12a.2.3 Emergency Registration for trusted non-3GPP Access
Emergency Registration procedure for trusted non-3GPP access shall be
supported as specified in clause 4.12.2.3 for untrusted non-3GPP access with
the following differences:
\- The regular registration shall refer to clause 4.12a.2.
\- The N3IWF is substituted by the TNGF.
\- The N3IWF key is substituted by the TNGF key.
### 4.12a.3 Deregistration procedure for Trusted non-3GPP access
The Deregistration procedure via trusted non-3GPP access shall be supported as
specified in clause 4.12.3 for the untrusted non-3GPP access with the
following modifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by the TNGF.
\- If the UE has reserved QoS resources over non-3GPP access by using the
Additional QoS Information (specified in clause 4.12a.5), then the UE shall
release these resources.
### 4.12a.4 N2 procedures via Trusted non-3GPP Access
#### 4.12a.4.1 Service Request procedures via Trusted non-3GPP Access
The Service Request procedure via trusted non-3GPP access shall be supported
as specified in clause 4.12.4.1 for the untrusted non-3GPP access with the
following modifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access.
\- The N3IWF is substituted by the TNGF.
\- The user plane between the UE and TNGF is established with IKEv2
signalling, as specified in clause 4.12a.5 (i.e. by using an IKEv2
Create_Child_SA exchange). The IKEv2 Create Child SA Request shall include the
Additional QoS Information to reserve non-3GPP specific QoS resources as
defined in clause 4.12a.5.
#### 4.12a.4.2 Procedure for the UE context release in the TNGF
This procedure for releasing the N2 signalling connection and the N3 user
plane connection for a UE connected to 5GC via trusted non-3GPP access, shall
be the same as the procedure specified in clause 4.12.4.2 for the untrusted
non-3GPP access with the following modifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by the TNGF.
\- If the UE has reserved any non-3GPP specific QoS resources, the UE releases
these resources when the IKEv2 Child SA is released.
#### 4.12a.4.3 CN-initiated selective deactivation of UP connection of an
existing PDU Session associated with Trusted non-3GPP Access
The procedure described in clause 4.3.7 (CN-initiated selective deactivation
of UP connection of an existing PDU Session) is used for CN-initiated
selective deactivation of UP connection for an established PDU Session
associated with trusted non-3GPP Access for a UE in CM-CONNECTED state, with
the following exceptions:
\- The NG-RAN corresponds to a TNAN including a TNGF.
\- The user plane between the UE and TNGF, i.e. Child SA(s) for the PDU
Session, is released not with RRC signalling but with IKEv2 signalling, as
specified in clause 4.12a.7.
\- If the UE has reserved any non-3GPP specific QoS resources, the UE releases
these resources when the IKEv2 Child SA is released.
### 4.12a.5 UE Requested PDU Session Establishment via Trusted non-3GPP Access
After the UE registers to 5GC via trusted non-3GPP access, the UE may request
a PDU Session establishment by using the same procedure as the one specified
in clause 4.12.5 for untrusted non-3GPP access, with the following
modifications:
\- The N3IWF in Figure 4.12.5-1 should be substituted with a TNGF and the
Untrusted non-3GPP access should be substituted with a Trusted non-3GPP Access
Point (TNAP).
\- The TNGF may send a TNGF Identities parameter to AMF inside an N2 Uplink
NAS Transport message. The TNGF Identities parameter contains a list of
identifiers (i.e. FQDNs or IP addresses) of N3 terminations supported by the
TNGF. If received by the AMF, it shall forward it to the SMF, which may use it
as input to UPF selection. The AMF provides ULI information received from TNGF
to the SMF which then propagates it to the PCF.
\- The IKEv2 Create Child SA Request message that is sent by the TNGF to UE
(in steps 4a and 4c), in order to establish a child SA for one or more QoS
flows, shall also include Additional QoS Information. The Additional QoS
Information shall contain:
a) If the IPsec child SA carries a GBR flow: QoS Characteristics and GBR QoS
Flow Information:
\- The QoS Characteristics are associated with the 5QI of the GBR flow and are
defined in clause 5.7.3 of TS 23.501 [2]. The TNGF either receives the QoS
Characteristics via the N2 interface (in the case of a dynamically assigned
5QI), or is pre-configured with the QoS Characteristics (in the case of a
standardized 5QI).
\- The GBR QoS Flow Information (defined in TS 38.413 [10]) is part of the QoS
Profile received via the N2 interface and contains: MFBR, GFBR and optionally
Maximum Packet Loss Rate. The Notification Control is not included in the QoS
profile.
b) If the IPsec child SA carries a non-GBR flow: QoS Characteristics:
\- The QoS Characteristics are defined in bullet a) above.
The TNGF may aggregate multiple GBR flows or multiple non-GBR flows into the
same IPsec child SA. In this case, the TNGF derives, in an implementation
specific way, the QoS Characteristics of the aggregated flow by considering
the QoS Characteristics of the individual flows. Similarly, the TNGF derives,
in an implementation specific way, the GBR QoS Flow Information of an
aggregated GBR flow by considering the GBR QoS Flow Information of the
individual GBR flows.
NOTE: The above behaviour of the TNGF does not create any impact on the N2
interface.
\- After receiving an IKEv2 Create Child SA Request message, the UE shall use
the Additional QoS Information contained in this message to determine what QoS
resources to reserve over the non-3GPP access, including e.g. guaranteed bit
rates and delay bounds for UL/DL communication. How the UE determines what QoS
resources to reserve over the non-3GPP access and how these QoS resources are
reserved, is outside the scope of 3GPP specifications.
\- If the UE fails to reserve QoS resources over non-3GPP access for the QoS
flows associated with the child SA (e.g. because the non-3GPP Access Network
rejects the allocation of the requested bit rates), the UE shall reject the
IKEv2 Child SA Request. Based on operator policy, the network may reattempt to
establish the Child SA without the Additional QoS Information.
### 4.12a.6 UE or network Requested PDU Session Modification via Trusted
non-3GPP access
The UE or network requested PDU Session Modification procedure via trusted
non-3GPP access is the same procedure as the one specified in clause 4.12.6
for untrusted non-3GPP access, with the following modifications:
\- The N3IWF in Figure 4.12.6-1 should be substituted with a TNGF and the
Untrusted non-3GPP access should be substituted with a Trusted non-3GPP Access
Point (TNAP).
\- The IKEv2 Create Child SA Request sent by the TNGF in step 4a, in order to
create new QoS flow(s) for the PDU Session, shall include the Additional QoS
Information defined in clause 4.12a.5. If the UE decides to reserve QoS
resources over non-3GPP access for the QoS flows associated with the Child SA
but fails to reserve these resources, the UE shall reject the IKEv2 Child SA
Request. Based on operator policy, the network may reattempt to establish the
Child SA without the Additional QoS Information.
\- The IKEv2 Informational Request sent by the TNGF in step 4b shall include
the Additional QoS Information defined in clause 4.12a.5, when the IKEv2
Informational Request is sent to modify one or more existing QoS flows. If the
UE decides to reserve QoS resources over non-3GPP access for the QoS flows
associated with the Child SA but fails to reserve these resources, the UE
shall indicate the failure in the IKEv2 Informational Response. The TNGF
includes the list of QoS flows which are failed to setup in step 5. Based on
operator policy, the network may reattempt to modify the failed QoS Flows
without the Additional QoS Information.
\- The IKEv2 Informational Request sent by the TNGF in step 4c to release an
existing IKEv2 Child SA shall trigger the UE to release the resources reserved
over non-3GPP access for this IKEv2 Child SA.
\- If, after the PDU Session establishment, the UE determines that the QoS
resources reserved over non-3GPP access for the QoS flows associated with a
Child SA are released, then the UE shall initiate an INFORMATIONAL exchange,
as specified in RFC 7296 [3], to delete the Child SA. After the Child SA is
deleted, the TNGF initiates PDU Session Modification procedure as described in
step 1e, in clause 4.3.3.2, including the list of QoS flows, which are
released.
### 4.12a.7 UE or network Requested PDU Session Release via Trusted non-3GPP
access
The UE or the network can release a PDU Session via a trusted non-3GPP Access
Network as specified in clause 4.12.7 for the untrusted non-3GPP access with
the following modifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by the TNGF.
\- If the UE reserved any non-3GPP specific QoS resources, the UE releases
these resources when the IKEv2 Child SA is released.
### 4.12a.8 Mobility from a non-geographically selected AMF to a
geographically selected AMF
The procedure specified in clause 4.12.8 for untrusted non-3GPP access applies
also to the trusted non-3GPP access with the following modifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by the TNGF.
\- The PDU Session is activated in step 2 as specified in clause 4.12a.5.
### 4.12a.9 Support of mobility from source to target TNAP
In this Release, if the UE moves from a source TNAP to a target TNAP, the UE
shall perform a full authentication via the target TNAP to re-connect to the
5G system.
## 4.12b Procedures for devices that do not support 5GC NAS over WLAN access
### 4.12b.1 General
As specified in clause 4.2.8.5 of TS 23.501 [2], devices that do not support
5GC NAS signalling over WLAN access (referred to as \"Non-5G-Capable over
WLAN\" devices, or N5CW devices for short), may access 5GC in a PLMN or an
SNPN via a trusted WLAN Access Network that supports a Trusted WLAN
Interworking Function (TWIF). The following clause specifies how a N5CW device
can be registered to 5GC and how it can send data via a PDU Session.
A N5CW device may be 5G-capable over 3GPP access, in which case it is also a
5G UE over 3GPP access.
### 4.12b.2 Initial Registration & PDU Session Establishment
Figure 4.12b.2-1 illustrates how the N5CW device can connect to a trusted WLAN
Access Network and simultaneously register to a 5G core network. A single EAP-
based authentication procedure is executed for connecting the N5CW device to
the trusted WLAN Access Network and for registering the N5CW device to the 5G
core network.
Figure 4.12b.2-1: Initial registration and PDU session establishment
0\. The N5CW device selects a PLMN (or SNPN) and a trusted WLAN that supports
\"5G connectivity-without-NAS\" to this PLMN (or SNPN) by using the procedure
specified in clause 6.3.12a and clause 5.30.2.15 of TS 23.501 [2] for access
to PLMN and SNPN, respectively.
Steps 1-10: Initial registration to 5GC.
1\. The N5CW device associates with the selected trusted WLAN and the EAP
authentication procedure is initiated.
2\. The N5CW device provides its Network Access Identity (NAI). The Trusted
WLAN Access Point (TWAP) selects a Trusted WLAN Interworking Function (TWIF),
e.g. based on the received realm and sends an AAA request to the selected
TWIF.
If the N5CW device has not registered over 3GPP access to 5GC of the selected
PLMN or SNPN when the above procedure is initiated, then the NAI includes the
SUCI as specified in clause 28.7.7 of TS 23.003 [33]. For example, when
accessing a PLMN the NAI can have the following format:
NAI=type1.rid678.schid0.useriduser17\@nai.5gc-
nn.mnc\.mcc\.3gppnetwork.org. If the selected PLMN is VPLMN, the
N5CW device should use the decorated NAI format as specified in clause 28.7.9
of TS 23.003 [33] to indicate to TWAN which is the selected VPLMN, for
example, NAI=nai.5gc-
nn.mnc\.mcc\.3gppnetwork.org!type1.rid678.schid0.useriduser17\@nai.5gc-
nn.mnc\.mcc\.3gppnetwork.org.
If the N5CW device has registered to 5GC over 3GPP access to 5GC of the
selected PLMN or SNPN (i.e. it is also a 5G UE) when the above procedure is
initiated, then the NAI includes the 5G-GUTI assigned to N5CW device over 3GPP
access. This enables the TWIF in step 4a below to select the same AMF as the
one serving the N5CW device over 3GPP access.
If the N5CW device accesses to SNPN with the credentials owned by Credentials
Holder, the decorated NAI as specified in clause 28.7.9 of TS 23.003 [33]
should be provided. For example, NAI=nai.5gc-
nn.nid\.mnc\.mcc\.3gppnetwork.org!type1.rid678.schid0.useriduser17\@nai.5gc-
nn.nid\.mnc\.mcc\.3gppnetwork.org.
The NAI provided by the N5CW device in step 2b indicates that the N5CW device
wants \"5G connectivity-without-NAS\" towards a specific PLMN or SNPN (i.e.
the PLMN or SNPN selected in step 0). For example, when accessing a PLMN, the
NAI can have the following format: NAI=\\@nai.5gc-
nn.mnc\.mcc\.3gppnetwork.org or NAI=nai.5gc-
nn.mnc\.mcc\.3gppnetwork.org!type1.rid678.schid0.useriduser17\@nai.5gc-
nn.mnc\.mcc\.3gppnetwork.org, the N5CW device
indicating that it wants \"5G connectivity-without-NAS\" (5gc-nn) to the PLMN
with MCC=\ and MNC=\ and to the PLMN with MCC=\ and
MNC=\.
3\. The TWIF creates a 5GC Registration Request message on behalf of the N5CW
device. The TWIF uses default values to populate the parameters in the
Registration Request message, which are the same for all N5CW devices. The
Registration type indicates \"Initial Registration\".
If the TWIF receives a Decorated NAI, in Registration Request message the TWIF
send the NAI which corresponds to the HPLMN by removing the decoration, for
example NAI=type1.rid678.schid0.useriduser17@ nai.5gc-
nn.mnc\.mcc\.3gppnetwork.org.
4\. The TWIF selects an AMF by using the 5G-GUTI in the NAI, or selects the
AMF of the VPLMN indicates by the realm of the decoration in the Decorated
NAI, for example \"mnc\.mcc\.3gppnetwork.org\" or
selects the AMF by using the local configuration. TWIF sends an N2 message to
the AMF including the Registration Request, the User Location and an AN Type.
If the N5CW device provides a Decorated NAI to the TWIF, the TWIF shall select
the AMF in the visited PLMN/SNPN as per decoration part and remove the
decoration part from the Decorated NAI (i.e. change the format to NAI format
of SUCI as defined in clause 28.7.7 of TS 23.003 [33]) and provides it to AMF
in the Registration Request. For example, if the NAI is \"nai.5gc-
nn.nid\.mnc\.mcc\.3gppnetwork.org!type1.rid678.schid0.useriduser17\@nai.5gc-
nn.nid\.mnc\.mcc\.3gppnetwork.org.\",
the TWIF selects the AMF in the SNPN corresponding to \"nai.5gc-
nn.nid\.mnc\.mcc\.3gppnetwork.org.\"
and provides the AMF in the Registration Request with the NAI of
\"type1.rid678.schid0.useriduser17@ nai.5gc-
nn.nid\.mnc\.mcc\.3gppnetwork.org\".
5\. The AMF triggers an authentication procedure by sending a request to AUSF
indicating the AN type.
6\. An EAP authentication procedure takes place between the N5CW device and
AUSF. Over the N2 interface, the EAP messages are encapsulated within NAS
Authentication messages. The type of EAP authentication procedure is specified
in TS 33.501 [15].
NOTE: The SUPI used for authentication does not take the format of Decorated
NAI.
7\. After a successful authentication, the AUSF sends to AMF the EAP-Success
message and the created SEAF key. The AMF derives an AN key from the received
SEAF key.
8\. The NAS Security Mode Command (SMC) is sent from the AMF to the TWIF. The
selected NAS security algorithms of integrity protection and ciphering are set
to NULL.
9\. The AMF sends an N2 Initial Context Setup Request and provides the AN key
to TWIF. In turn, the TWIF derives a Pairwise Master Key (PMK) from the AN key
and sends the PMK key and the EAP-Success message to the Trusted WLAN Access
Point, which forwards the EAP-Success to the N5CW device. The PMK is the key
used to secure the WLAN air-interface communication according to IEEE Std
802.11 [48]. A layer-2 or layer-3 connection is established between the
Trusted WLAN Access Point and the TWIF for transporting all user-plane traffic
of the N5CW device to TWIF. This connection is later bound to an N3 connection
that is created for this N5CW device.
10\. Finally, the AMF sends a Registration Accept message to TWIF. At this
point, the N5CW device is connected to the WLAN Access Network and is
registered to 5GC.
Steps 20-21: PDU Session Establishment.
20\. The TWIF creates a PDU Session Establishment Request message on behalf of
the N5CW device and sends this message to AMF. This may be triggered by
receiving an IP configuration request (e.g. DHCP Offer/Request) from the N5CW
device. The TWIF may use default values to populate the parameters in the PDU
Session Establishment Request message, but may also skip some PDU session
parameters and let the AMF or the SMF determine these parameters based on the
N5CW device subscription information received during the registration
procedure. This way, default PDU session parameters can be used per N5CW
device.
The value of the PDU Session id provided by TWIF in step 20c shall always be
the same. It will be a value reserved for the PDU sessions requested by the
TWIF and it will be different from the values that can be used by the N5CW
device when requesting a PDU session over 3GPP access. This way, the PDU
session id provided by the TWIF cannot be the same with the PDU Session Id of
any PDU session established by the N5CW device over 3GPP access.
21\. The AMF sends upon request of the SMF an N2 PDU Session Request message
to TWIF in order to reserve the appropriate Access Network resources. This N2
message includes the PDU Session Establishment Accept message. In step 21b,
the TWIF may reserve WLAN access resources for the user-plane communication
between the N5CW device and TWIF. If and how this resource reservation is
performed is outside the scope of 3GPP.
After the establishment of the PDU session, the TWIF assigns IP configuration
data to N5CW device (e.g. with DHCP). The IP address assigned to N5CW device
is the IP address allocated to the PDU session.
Step 25: User plane communication.
The TWIF binds the N5CW device-specific L2/L3 connection created in step 9g
with the N3 connection created in step 21. All user-plane traffic sent by the
N5CW device is forwarded to TWIF via the L2/L3 connection and then to UPF via
the N3 connection. The TWIF operates as a Layer-2 relay.
The TWIF may receive URSP rules (see TS 23.503 [20]), which indicate the
traffic that should be offloaded locally by TWIF (sent outside the PDU
session) and the traffic that should be sent inside the PDU session.
The above procedure supports only one PDU session per N5CW device whose
parameters are either configured for all N5CW devices in the TWIF or are
derived from default values in the N5CW device subscription.
If the TWIF is co-located with one or more local UPFs then:
\- In step 20c (N2 Uplink NAS Transport), the TWIF may send a TWIF Identities
parameter to AMF. The TWIF Identities parameter contains a list of identifiers
(i.e. FQDNs or IP addresses) of N3 terminations supported by the TWIF.
\- If received by the AMF, it shall forward it to the SMF when invoking
Nsmf_PDUSessionCreateSMContext i.e. at the establishment of the PDU Session.
The SMF may use this information to select a local UPF for the PDU Session.
### 4.12b.3 Deregistration procedure
The Deregistration procedure for devices (N5CW devices) that do not support 5G
NAS signalling over WLAN access shall be supported as specified in clause
4.12a.3 for the trusted non-3GPP access with the following modifications:
\- The TNAP is substituted by a trusted WLAN access point (TWAP).
\- The TNGF is substituted by the Trusted WLAN Interworking Function (TWIF).
\- The TWIF sends and receives NAS deregistration request/accept messages on
behalf of N5CW device.
\- For both UE/Network-initiated deregistration procedures, the TWIF may
initiate the release of Yt\' connection between the N5CW device and TWIF.
\- UE-initiated deregistration procedure can be initiated by the TWIF, when it
has lost connectivity to the N5CW device.
### 4.12b.4 N2 procedures
#### 4.12b.4.1 Service Request procedures
The Service Request procedure for devices that do not support 5G NAS
signalling over WLAN access shall be used by a TWIF when the CM state in TWIF
for a N5CW device is CM-IDLE over Trusted WLAN to request the re-establishment
of the NAS signalling connection and the re-establishment of the user plane
for all or some of the PDU Sessions which are associated to non-3GPP access.
The Service Request procedure for N5CW devices shall be used by a TWIF when
the CM state in TWIF for a N5CW device is CM-CONNECTED over trusted WLAN to
request the re-establishment of the user plane for one or more PDU Sessions
which are associated to non-3GPP access.
This Service Request procedure shall be supported as specified in clause
4.12a.4.1 for the trusted non-3GPP access with the following modifications:
\- The trusted non-3GPP access is substituted by a trusted WLAN access point
(TWAP).
\- The TNGF is substituted by the TWIF.
\- The TWIF sends and receives NAS messages on behalf of N5CW device.
\- The user plane between the N5CW device and TWIF is established with Yt\'
connection instead of IKEv2 signalling.
#### 4.12b.4.2 Procedure for the UE context release in the TWIF
This procedure for releasing the N2 signalling connection and the N3 user
plane connection for a N5CW device connected to 5GC via trusted WLAN access,
shall be the same as the procedure specified in clause 4.12a.4.2 for the
trusted non-3GPP access with the following modifications:
\- The trusted non-3GPP access is substituted by a TWAP.
\- The TNGF is substituted by the TWIF.
\- The TWIF may initiate the release of Yt\' connection between the N5CW
device and TWIF.
#### 4.12b.4.3 CN-initiated selective deactivation of UP connection of an
existing PDU Session
The procedure described in clause 4.3.7 (CN-initiated selective deactivation
of UP connection of an existing PDU Session) is used for CN-initiated
selective deactivation of UP connection for an established PDU Session
associated with Trusted WLAN access for a N5CW device in CM-CONNECTED state,
with the following exceptions:
\- The NG-RAN corresponds to a TNAN including a TWIF.
\- The user plane between the N5CW device and TWIF is released without neither
RRC signalling nor IKEv2 signalling.
## 4.13 Specific services
### 4.13.1 General
Clause 4.13 defines the additional procedures or additions to the existing
procedures to support specific services such as SMS over NAS.
### 4.13.2 Application Triggering
#### 4.13.2.1 General
The AF invokes the Nnef_Trigger service to request that the network send an
Application trigger to the UE.
#### 4.13.2.2 The procedure of \"Application Triggering\" Service
Figure 4.13.2.2-1: Device triggering procedure via Nnef
1\. The AF determines the need to trigger the device. If the AF has no contact
details for the NEF, it shall discover and select NEF services.
2\. The AF invokes the Nnef_Trigger_Delivery request service.
3\. The NEF checks that the AF is authorised to send trigger requests and that
the AF has not exceeded its quota or rate of trigger submission over Nnef. If
this check fails, the NEF sends an Nnef_Trigger_Delivery response with a cause
value indicating the reason for the failure condition and the flow stops at
this step. Otherwise, the flow continues with step 4.
4\. The NEF invokes Nudm_SDM_Get (Identifier Translation, GPSI and AF
Identifier) to resolve the GPSI to SUPI when the AF is authorized to trigger
the UE.
NOTE 1: Optionally, mapping from GPSI (External Id) to GPSI (MSISDN) is also
provided for legacy SMS infrastructure not supporting MSISDN-less SMS.
5\. The UDM may invoke the Nudr_DM_Query service to retrieve a list of AF\'s
that are allowed to trigger the UE and determines, based on UDM policy, which
identifier (SUPI or MSISDN) should be used to trigger the UE. The UDM provides
a Nudm_SDM_Get response (SUPI, optionally MSISDN. If the AF is not allowed to
send a trigger message to this UE, or there is no valid subscription
information for this user, the NEF sends an Nnef_Trigger_Delivery response
with a cause value indicating the reason for the failure condition and the
flow stops at this step. Otherwise this flow continues with step 6.
NOTE 2: The presence of an MSISDN in the reply is interpreted as an indication
to the NEF that MSISDN is used (instead of IMSI) to identify the UE when
sending the SMS to the SMS-SC via T4.
6\. The NEF invokes Nudm_UECM_Get (GPSI, SMS) to retrieve the UE SMSF
identities.
7\. The UDM may invoke the Nudr_DM_Query service to retrieve the UE SMSF
identities. The UDM provides a Nudm_UECM_Get response with the corresponding
UE SMSF identities. UDM policy (possibly dependent on the VPLMN ID) may
influence which serving node identities are returned.
NOTE 3: The NEF can cache serving node information for the UE. However, this
can increase the probability of trigger delivery attempt failures when the
cached serving node information is stale.
8\. The NEF selects a suitable SMS-SC based on configured information. The NEF
acts as an MTC-IWF and sends a Submit Trigger (GPSI, SUPI, AF Identifier,
trigger reference number, validity period, priority, SMSF serving node ID(s)
(if available, are obtained from UDM in step 7), SMS Application port ID,
trigger payload, Trigger Indication) message to the SMS-SC.
If the NEF indicates that \"Absent subscriber\" was received from the UDM, the
SMS-SC should not submit the message, but store it directly and send Routing
Information for SM to request the UDM to add the SMS-SC address to the Message
Waiting List.
9\. The SMS-SC sends a Submit Trigger Confirm message to the NEF to confirm
that the submission of the SMS has been accepted by the SMS-SC.
10\. The NEF sends a Nnef_Trigger_Delivery response to the AF to indicate if
the Device Trigger Request has been accepted for delivery to the UE.
11\. The SMS_SC performs MT SMS delivery as defined in clause 4.13.3. The SMS-
SC may provide the routing information that it received in step 6 to SMS-GMSC
to avoid UDM interrogation. The SMS-SC generates the necessary CDR information
and includes the AF Identifier. The SMS Application port ID, which is included
in the SM User Data Header and the Trigger Indication are included in the CDRs
in order to enable differentiated charging. The SMS-SC stores the trigger
payload, without routing information. If the message delivery fails and is
attempted to be delivered again, UDM interrogation will be performed. If the
message delivery fails and the validity period of this trigger message is not
set to zero, the SMS-SC shall send a SM Message Delivery Status Report to
request the UDM to add the SMS-SC address to the Message Waiting list. When
the message delivery is later re-attempted, a new UDM interrogation will be
performed by the SMS-GMSC using SUPI or MSISDN. UDM interrogations using SUPI
shall not be forwarded or relayed to SMS-Router or IP-SM-GWs. The UDM may
include up to four serving node identities (MSC or MME, SGSN, IP-SM-GW, AMF)
in the response to SMS-GMSC.
12\. If the message delivery fails (either directly or when validity period of
the trigger message expires) or when the message delivery succeeds, the SMS-SC
shall send a Message Delivery Report (cause code, trigger reference number, AF
Identifier) to the NEF.
13\. The NEF provides a Nnef_Trigger_DeliveryNotify message to the AF with a
Delivery Report indicating the trigger delivery outcome (e.g. succeeded,
unknown or failed and the reason for the failure). The NEF generates the
necessary CDR information including the GPSI and AF Identifier.
14\. In response to the received device trigger, the UE takes specific actions
and may take into consideration the content of the trigger payload. This
action typically involves initiation of immediate or later communication with
the AF.
### 4.13.3 SMS over NAS procedures
#### 4.13.3.1 Registration procedures for SMS over NAS
Figure 4.13.3.1-1: Registration procedure supporting SMS over NAS
1\. During Registration procedure in 5GS defined in Figure 4.2.2.2.2-1, to
enable SMS over NAS transporting, the UE includes an \"SMS supported\"
indication in Registration Request in step 1-3 indicating the UE\'s capability
for SMS over NAS transport. The \"SMS supported\" indication indicates whether
the UE supports SMS delivery over NAS.
2\. Step 4 to step 14 of the Registration procedure in Figure 4.2.2.2.2-1 are
performed. The AMF may retrieve the SMS Subscription data and UE Context in
SMSF data using Nudm_SDM_Get. This requires that UDM may retrieve this
information from UDR by Nudr_DM_Query. The UDM includes the SMSF information
in the Nudm_SDM_Get response message if the stored SMSF belongs to the same
PLMN of the AMF. After a successful response is received and if SMS service is
allowed, the AMF subscribes to be notified using Nudm_SDM_Subscribe when the
SMS Subscription data is modified and UDM may subscribe to UDR by
Nudr_DM_Subscribe.
The AMF can also receive UE context information containing SMSF Information
from old AMF. When AMF re-allocation happens during the Registration
procedure, the old AMF transfers SMSF Information to the new AMF as part of UE
context in step 5 of Figure 4.2.2.2.2-1.
NOTE 1: The AMF can, instead of the Nudm_SDM_Get service operation, use the
Nudm_SDM_Subscribe service operation with an Immediate Report Indication that
triggers the UDM to immediately return the subscribed data if the
corresponding feature is supported by both the AMF and the UDM.
3\. If the \"SMS supported\" indication is included in the Registration
Request, the AMF checks in the SMS Subscription data that was received in step
2 whether the SMS service is allowed to the UE. If SMS service is allowed and
the UE context received in step 2 includes an available SMSF of the serving
PLMN, the AMF activates this SMSF Address and continues the registration
procedure. If SMS service is allowed but an SMSF of the serving PLMN was not
received in step 2, the AMF discovers and selects an SMSF to serve the UE as
described in clause 6.3.10 of TS 23.501 [2].
4\. Step 15 to step 20 of the Registration procedure in Figure 4.2.2.2.2-1 are
performed.
5\. The AMF invokes Nsmsf_SMService_Activate service operation from the SMSF.
The invocation includes AMF address, Access Type, RAT Type, Trace
Requirements, GPSI (if available) and SUPI. AMF uses the SMSF Information
derived from step 3. Trace Requirements is provided if it has been received by
AMF as part of subscription data.
6\. The SMSF discovers a UDM as described in clause 6.3.8 of TS 23.501 [2].
7a. If the UE context for the current Access Type already exists in the SMSF,
the SMSF shall replace the old AMF address with the new AMF address.
Otherwise, the SMSF considers this a Registration request from a new Access
Type and the SMSF registers with the UDM using Nudm_UECM_Registration with
Access Type. As a result, the UDM stores the following information: SUPI, SMSF
identity, SMSF address, Access Type(s) in UE Context in SMSF data. The UDM may
further store SMSF Information in UDR by Nudr_DM_Update (SUPI, Subscription
Data, UE Context in SMSF data).
If the Nsmsf_SMService_Activate request contains two Access Types and one of
them is already registered in the SMSF, the SMSF shall replace the old AMF
address with the new AMF address for that Access Type. The SMSF shall then
register the other Access Type with the UDM using Nudm_UECM_Registration
request.
7b-7c SMSF retrieves SMS Management Subscription data (e.g. SMS teleservice,
SMS barring list) using Nudm_SDM_Get and this requires that UDM may get this
information from UDR by Nudr_DM_Query (SUPI, Subscription Data, SMS Management
Subscription data). After a successful response is received, the SMSF
subscribes to be notified using Nudm_SDM_Subscribe when the SMS Management
Subscription data is modified and UDM may subscribe to notifications from UDR
by Nudr_DM_Subscribe.
SMSF also creates a UE context to store the SMS subscription information and
the AMF address that is serving this UE.
NOTE 2: The SMSF can, instead of the Nudm_SDM_Get service operation, use the
Nudm_SDM_Subscribe service operation with an Immediate Report Indication that
triggers the UDM to immediately return the subscribed data if the
corresponding feature is supported by both the SMSF and the UDM.
8\. The SMSF responds back to the AMF with Nsmsf_SMService_Activate service
operation response message. The AMF stores the SMSF Information received as
part of the UE context.
9\. The AMF includes the \"SMS allowed\" indication to the UE in the
Registration Accept message of step 21 of Figure 4.2.2.2.2-1 only after step 8
in which the AMF has received a positive indication from the selected SMSF.
The \"SMS allowed\" indication in the Registration Accept message indicates to
the UE whether the network allows the SMS message delivery over NAS.
#### 4.13.3.2 Deregistration procedures for SMS over NAS
If UE indicates to AMF that it no longer wants to send and receive SMS over
NAS (e.g. not including \"SMS supported\" indication in subsequent
Registration Request message) or AMF considers that UE is deregistered on
specific Access Type(s) or AMF receives Deregistration Notification from UDM
for specific Access Type(s) indicating UE Initial Registration, Subscription
Withdrawn or 5GS to EPS Mobility as specified in clause 5.2.3.2.2, then:
\- AMF may, if the UE is not registered at other Access Type at the AMF any
more, unsubscribe from SMS Subscription data changes notification with the UDM
by means of the Nudm_SDM_Unsubscribe service operation.
\- AMF invokes Nsmsf_SMService_Deactivate service operation to trigger the
release of UE Context for SMS on SMSF for the impacted Access Type(s) based on
local configurations.
\- AMF may, if the UE is not registered at other Access Type at the AMF
anymore, delete or deactivate the stored SMSF address in its UE Context.
\- The SMSF unsubscribes from SMS Management Subscription data changes
notification with the UDM by means of the Nudm_SDM_Unsubscribe service
operation if the UE is not registered at other Access Type for SMS over NAS
service at the SMSF anymore.
\- The SMSF shall invoke Nudm_UECM_Deregistration (SUPI, NF ID, Access Type)
service operation from UDM to trigger UDM to delete SMSF address of the UE for
the impacted Access Type(s). The SMSF also removes the UE Context for SMS for
the impacted Access Type(s), including AMF address.
\- The UDM may update UE context in SMSF in UDR by Nudr_DM_Update (SUPI,
Subscription Data, SMS Subscription data, SMSF address). The UDM may remove
the corresponding subscription of data change notification in UDR by
Nudr_DM_Unsubscribe service operation.
#### 4.13.3.3 MO SMS over NAS in CM-IDLE (baseline)
Figure 4.13.3.3-1: MO SMS over NAS
1\. The UE performs domain selection for UE originating SMS as defined in
clause 5.16.3.8 of TS 23.501 [2] if SMS delivery via non 3GPP access is
allowed and possible. If an UE under CM-IDLE state is going to send uplink SMS
message, then UE and network perform the UE Triggered Service Request
procedure firstly as defined in clause 4.2.3.2 to establish a NAS signalling
connection to AMF.
2a. The UE builds the SMS message to be sent as defined in TS 23.040 [7] (i.e.
the SMS message consists of CP-DATA/RP-DATA/TPDU/SMS-SUBMIT parts). The SMS
message is encapsulated in an NAS message with an indication indicating that
the NAS message is for SMS transporting. The UE send the NAS message to the
AMF.
2b. The AMF forwards the SMS message and SUPI to the SMSF serving the UE over
N20 message by invoking Nsmsf_SMService_UplinkSMS service operation. In order
to permit the SMSF to create an accurate charging record, the AMF adds the
IMEISV, the current UE Location Information (ULI) of the UE as defined in
clause 5.6.2 of TS 23.501 [2] and if the UE has sent the SMS via 3GPP access,
the local time zone.
2c. The SMSF invokes Namf_Communication_N1N2MessageTransfer service operation
to forward SMS ack message to AMF.
2d. The AMF forwards the SMS ack message from the SMSF to the UE using
downlink unit data message.
3-5. The SMSF checks the SMS management subscription data. If SMS delivery is
allowed, the procedure defined in TS 23.040 [7] or TS 23.540 [84] applies.
6a-6b. The SMSF forwards the submit report to AMF by invoking
Namf_Communication_N1N2MessageTransfer service operation which is forwarded to
UE via Downlink NAS transport. If the SMSF knows the submit report is the last
message to be transferred for UE, the SMSF shall include a last message
indication in the Namf_Communication_N1N2MessageTransfer service operation so
that the AMF knows no more SMS data is to be forwarded to UE.
NOTE: The behaviour of AMF based on the \"last message indication\" is
implementation specific.
If the UE has more than one SMS message to send, the AMF and SMSF forwards SMS
/SMS ack/submit report the same way as described in step 2a-6b.
6c-6d. When no more SMS is to be sent, UE returns a CP-ack as defined in TS
23.040 [7] to SMSF. The AMF forwards the SMS ack message by invoking
Nsmsf_SMService_UplinkSMS service operation to SMSF.
#### 4.13.3.4 Void
#### 4.13.3.5 MO SMS over NAS in CM-CONNECTED
MO SMS in CM-CONNECTED State procedure is specified by reusing the MO SMS in
CM-IDLE State without the UE Triggered Service Request procedure.
#### 4.13.3.6 MT SMS over NAS in CM-IDLE state via 3GPP access
Figure 4.13.3.6-1: MT SMS over NAS in CM-IDLE state via 3GPP access
1-3 MT SMS interaction between SC/SMS-GMSC/UDM follow the procedure as defined
in TS 23.040 [7] or TS 23.540 [84]. If there are two AMFs serving the UE, one
is for 3GPP access and another is for non-3GPP access, there are two SMSF
addresses stored in UDM/UDR. The UDM shall return both SMSF addresses.
4\. The SMSF checks the SMS management subscription data. If SMS delivery is
allowed, SMSF invokes Namf_MT_EnableUEReachability service operation to AMF.
AMF pages the UE using the procedure defined in clause 4.2.3.3. The UE
responds to the page with Service Request procedure.
If the AMF indicates SMSF that UE is not reachable, the procedure of the
unsuccessful Mobile terminating SMS delivery described in clause 4.13.3.9 is
performed and the following steps are skipped.
If the UE access to the AMF via both 3GPP access and non-3GPP access, the AMF
determines the Access Type to transfer the MT-SMS based on operator local
policy.
5a-5b. SMSF forward the SMS message to be sent as defined in TS 23.040 [7]
(i.e. the SMS message consists of CPâ€‘DATA/RPâ€‘DATA/TPDU/SMSâ€‘DELIVER parts) to
AMF by invoking Namf_Communication_N1N2MessageTransfer service operation. The
AMF transfers the SMS message to the UE.
5c-5d. The UE acknowledges receipt of the SMS message to the SMSF. For uplink
unitdata message toward the SMSF, the AMF invokes Nsmsf_SMService_UplinkSMS
service operation to forward the message to SMSF. In order to permit the SMSF
to create an accurate charging record, the AMF also includes IMEISV, the
current UE Location Information (ULI) of the UE as defined in clause 5.6.2 of
TS 23.501 [2] and if the SMS is delivered to the UE via 3GPP access, the local
time zone.
6a-6b. The UE returns a delivery report as defined in TS 23.040 [7]. The
delivery report is encapsulated in an NAS message and sent to the AMF which is
forwarded to SMSF by invoking Nsmsf_SMService_UplinkSMS service operation.
6c-6d. The SMSF acknowledges receipt of the delivery report to the UE. The
SMSF uses Namf_Communication_N1N2MessageTransfer service operation to send SMS
CP ack message to the AMF. The AMF encapsulates the SMS message via a NAS
message to the UE. If SMSF has more than one SMS to send, the SMSF and the AMF
forwards subsequent SMS /SMS ack/ delivery report the same way as described in
step 4-6c.
If the SMSF knows the SMS CP ack is the last message to be transferred for UE,
the SMSF shall include a last message indication in the
Namf_Communication_N1N2MessageTransfer service operation so that the AMF knows
no more SMS data is to be forwarded to UE.
NOTE: The behaviour of AMF based on the \"last message indication\" is
implementation specific.
7\. In parallel to steps 6c and 6d, the SMSF delivers the delivery report to
SC as defined in TS 23.040 [7] or TS 23.540 [84].
#### 4.13.3.7 MT SMS over NAS in CM-CONNECTED state via 3GPP access
MT SMS in CM-CONNECTED procedure is specified by reusing the MT SMS in CM-IDLE
state with the following modification:
\- There is no need for the AMF to perform Paging of the UE and can immediate
continue with a message to SMSF via N20 to allow the SMSF to start forward the
MT SMS.
\- If the delivery of the NAS PDU containing the SMS fails e.g. if the UE is
in RRC_INACTIVE and NG-RAN paging was not successful, the NG-RAN initiate the
UE context release in the AN procedure and provide notification of non-
delivery to the AMF. The AMF provides an indication of non-delivery to the
SMSF.
#### 4.13.3.8 MT SMS over NAS via non-3GPP access
MT SMS procedure via non-3GPP access is specified by reusing the MT SMS via
3GPP access in CM-CONNECTED state with the following modification:
\- If the UE access to the network via both 3GPP and non-3GPP accesses and the
AMF determines to deliver MT-SMS via non-3GPP access based on operator policy
in step 4, the NAS messages is transferred via non-3GPP Access Network.
#### 4.13.3.9 Unsuccessful Mobile terminating SMS delivery re-attempt
The procedure of Unsuccessful Mobile terminating SMS delivery re-attempt is
defined as follows:
\- For SMS delivery, the SMSF and the UDM support the SMSF and UDM role as
specified in TS 23.040 [7].
\- If the UE is registered over both 3GPP access and non-3GPP access in the
same AMF (i.e. the UE is registered in the same PLMN for both Access Types):
\- if the MT-SMS delivery over one Access Type has failed, the AMF, based on
operator local policy, may re-attempt the MT-SMS delivery over the other
Access Type before indicating failure to SMSF;
\- if the MT-SMS delivery on both Access Types has failed, the AMF shall
inform the SMSF immediately.
\- If the AMF informs the SMSF that it cannot deliver the MT-SMS to the UE,
the SMSF sends a failure report to the first SMS-GMSC (which can be co-located
with IP-SM-GW or SMS Router) as defined in TS 23.040 [7] or TS 23.540 [84]. If
the SMS-GMSC has more than one entity for SMS transport towards the UE, then
upon receiving MT-SMS failure report, the SMS-GMSC, based on operator local
policy, may re-attempt the MT-SMS delivery via the other entity.
\- After the first SMS-GMSC informs the UDM/HSS that the UE is not able to
receive MT-SMS, the UDM shall set the URRP-AMF flag and store the SC address
in the MWD list as defined in TS 23.040 [7] or TS 23.540 [84].
\- If the UE is registered in an AMF and the UDM has not subscribed to UE
Reachability Notification in the AMF yet, the UDM immediately initiates a
subscription procedure as specified in clause 4.2.5.2.
\- When the AMF detects UE activities, it notifies UDM with UE Activity
Notification as described in clause 4.2.5.3. If the UE is registered in an
SMSF, the UDM clears its URRP-AMF flag and the UDM/HSS clears the MWD list and
alerts related SCs to retry MT-SMS delivery. Otherwise, if the UE is not
registered in an SMSF, the UDM clears its URRP-AMF flag but the UDM/HSS keeps
the MWD list to notify the SC upon subsequent SMSF registration for the UE.
\- When the SMS-GMSC requests routing information from UDM/HSS for a UE not
registered in 5GC, or for a registered UE which has not been yet registered
for SMS service, the UDM/HSS responds to the SMS-GMSC that the UE is absent,
stores the SC address in the MWD list (if not yet stored) and indicates that
to the SC as defined in TS 23.040 [7] or TS 23.540 [84].
When the UDM receives an Nudm_UECM_Registration Request from an SMSF for a UE
for which the MWD list is stored and no URRP-AMF flag is set, the UDM/HSS
alerts the related SCs to retry the MT-SMS delivery and clears the MWD list.
NOTE: This scenario assumes that the UE is not in 2G/3G/4G coverage.
### 4.13.4 Emergency Services
#### 4.13.4.1 General
If the 5GS supports Emergency Services, the support is indicated to UE via the
Registration Accept message on per-TA-list and per-RAT basis, as described in
TS 23.501 [2].
If the 5GS supports Emergency Services Fallback, the support is indicated to
UE via the Registration Accept message on per-TA-list and per-RAT basis, as
described in TS 23.501 [2].
The UE shall follow the domain selection rules for emergency session attempts
as described in TS 23.167 [28].
If the 5GC has indicated Emergency Services Fallback support for the TA and
RAT where the UE is currently camping and if the UE supports emergency
services fallback, the UE shall initiate the Emergency Services Fallback
procedure described in clause 4.13.4.2.
At QoS Flow establishment request for Emergency Services, the procedure
described in clause 4.13.6.2 Inter RAT Fallback in 5GC for IMS voice or the
procedure described in clause 4.13.6.1 EPS fallback for IMS voice may be
triggered by the network, when configured.
#### 4.13.4.2 Emergency Services Fallback
The call flow in Figure 4.13.4.2-1 describes the procedure for emergency
services fallback.
Figure 4.13.4.2-1: Emergency Services Fallback
1\. UE camps on E-UTRA or NR cell in the 5GS (in either CM-IDLE or CM-
CONNECTED state).
2\. UE has a pending IMS emergency session request (e.g. voice) from the upper
layers.
3\. If the AMF has indicated support for emergency services using fallback via
the Registration Accept message for the current RAT, the UE sends a Service
Request message indicating that it requires emergency services fallback. The
UE is not required to include the PDU Sessions that are not relevant for the
emergency service in the List Of PDU Sessions to be Activated in the Service
Request for the emergency service.
NOTE 1: If the UE includes PDU Sessions to be Activated in the Service Request
for the emergency service, it will delay the Emergency Services Fallback
procedure.
4\. 5GC triggers a request for Emergency Services Fallback by executing an NG-
AP procedure in which it indicates to NG-RAN that this is a fallback for
emergency services. The AMF based on the support of Emergency Services in EPC
or 5GC may indicate the target CN for the RAN node to know whether inter-RAT
fallback or inter-system fallback is to be performed. When AMF initiates
Redirection for UE(s) that have been successfully authenticated, AMF includes
the security context in the request to trigger fallback towards NG-RAN.
5\. Based on the target CN if indicated in message 4 or otherwise based on the
RAN configuration, one of the following procedures is executed by NG-RAN:
5a. NG-RAN initiates handover (see clause 4.9.1.3) or redirection to a 5GC-
connected E-UTRAN cell, if UE is currently camped on NR.
5b. NG-RAN initiates handover (see clause 4.11.1.2.1) or redirection to
E-UTRAN connected to EPS. NG-RAN uses the security context provided by the AMF
to secure the redirection procedure.
If the redirection procedure is used either in 5a or 5b the target CN type
(EPC or 5GC) is also conveyed to the UE in order to be able to perform the
appropriate NAS procedures (S1 or N1 Mode). The UE uses the emergency
indication in the RRC message as specified in clause 6.2.2 of TS 36.331 [16]
and E-UTRAN provides the emergency indication to AMF (during Registration
triggered by step 5a) and MME (during Tracking Area Update triggered by step
5b). Both the Registration and the Tracking Area Update requests should
contain Follow-on request and active flag respectively to indicate that the UE
has \"user data pending\". For the handover procedure used in step 5b see
clause 4.11.1.2.1, step 1.
In step 5b, if the MME does not support emergency services for that UE, the
MME should act such that the call for emergency service is likely to succeed
promptly, e.g. if the UE successfully completed a combined TA/LA Update with
the network, by using the CSFB procedures specified in TS 23.272 [61].
NOTE 2: If such a combined TA/LA Update is not successful, or the UE did not
request a combined update, then, as specified in TS 23.167 [28], the UE
autonomously selects a RAT that may (but which might not) support the CS
domain.
6\. After handover or redirection to the target cell the UE establishes a PDU
Session / PDN connection for IMS emergency services and performs the IMS
procedures for establishment of an IMS emergency session (e.g. voice) as
defined in TS 23.167 [28].
At least for the duration of the emergency voice call, the E-UTRAN connected
to EPC is configured to not trigger any handover to 5GS and the target NG-RAN
is configured to not trigger inter NG-RAN handover back to source NG-RAN.
### 4.13.5 Location Services procedures
#### 4.13.5.0 General
Location Service procedures are defined in TS 23.273 [51].
#### 4.13.5.1 5GC-NI-LR Procedure
Location Service procedures are defined in TS 23.273 [51].
#### 4.13.5.2 5GC-MT-LR Procedure without UDM Query
Location Service procedures are defined in TS 23.273 [51].
#### 4.13.5.3 5GC-MT-LR Procedure
Location Service procedures are defined in TS 23.273 [51].
#### 4.13.5.4 UE Assisted and UE Based Positioning Procedure
Location Service procedures are defined in TS 23.273 [51].
#### 4.13.5.5 Network Assisted Positioning Procedure
Location Service procedures are defined in TS 23.273 [51].
#### 4.13.5.6 Obtaining Non-UE Associated Network Assistance Data
Location Service procedures are defined in TS 23.273 [51].
#### 4.13.5.7 Location continuity for Handover of an Emergency session from
NG-RAN
Location Service procedures are defined in TS 23.273 [51].
### 4.13.6 Support of IMS Voice
#### 4.13.6.1 EPS fallback for IMS voice
Figure 4.13.6.1-1 describes the EPS fallback procedure for IMS voice.
When the UE is served by the 5G System, the UE has one or more ongoing PDU
Sessions each including one or more QoS Flows. The serving PLMN AMF has sent
an indication towards the UE during the Registration procedure that IMS voice
over PS session is supported, see clause 5.16.3.10 of TS 23.501 [2] and the UE
has registered in the IMS. If N26 is not supported, the serving PLMN AMF sends
an indication towards the UE during the Registration procedure that
interworking without N26 is supported, see clause 5.17.2.3.1 of TS 23.501 [2].
Figure 4.13.6.1-1: EPS Fallback for IMS voice
1\. UE camps on NG-RAN in the 5GS and an MO or MT IMS voice session
establishment has been initiated.
2\. Network initiated PDU Session modification to setup QoS flow for voice
reaches the NG-RAN (see N2 PDU Session Request in clause 4.3.3).
3\. NG-RAN is configured to support EPS fallback for IMS voice and decides to
trigger fallback to EPS, taking into account UE capabilities, indication from
AMF that \"Redirection for EPS fallback for voice is possible\" (received as
part of initial context setup, handover resource allocation or path switch
request acknowledge as defined in TS 38.413 [10]), network configuration (e.g.
N26 availability configuration) and radio conditions. If NG-RAN decides not to
trigger fallback to EPS, then the procedure stops here and following steps are
not executed.
NG-RAN may initiate measurement report solicitation from the UE including
E-UTRAN as target.
NOTE 1: If AMF has indicated that \"Redirection for EPS fallback for voice is
not possible\", then EPS fallback for IMS voice is not performed in step 5. If
NG-RAN has not received indication \"Redirection for EPS fallback for voice\",
the decision to execute EPS fallback for IMS voice or not is based on network
configuration (e.g. based on N26 availability and other criteria).
4\. NG-RAN responds indicating rejection of the PDU Session modification to
setup QoS flow for IMS voice received in step 2 by PDU Session Modification
Response message towards the SMF+PGW-C (or H-SMF+P-GW-C via V-SMF, in the case
of home routed roaming scenario) via AMF with an indication that mobility due
to fallback for IMS voice is ongoing. The SMF+PGW-C maintains the PCC rule(s)
associated with the QoS Flow(s) and reports the EPS Fallback event to the PCF
if PCF has subscribed to this event.
5\. NG-RAN initiates either handover (see clause 4.11.1.2.1), or AN Release
via inter-system redirection to EPS (see clause 4.2.6 and clause 4.11.1.3.2),
taking into account UE capabilities. The SMF+PGW-C reports change of the RAT
type if subscribed by PCF as specified in clause 4.11.1.2.1, or clause
4.11.1.3.2.6. When the UE is connected to EPS, either 6a or 6b is executed
6a. In the case of 5GS to EPS handover, see clause 4.11.1.2.1 and in the case
of inter-system redirection to EPS with N26 interface, see clause 4.11.1.3.2.
In either case the UE initiates TAU procedure and the UE includes active flag
in the request in the case of inter-system redirection to EPS; or
6b. In the case of inter-system redirection to EPS without N26 interface, see
clause 4.11.2.2. If the UE supports Request Type flag \"handover\" for PDN
connectivity request during the attach procedure as described in clause
5.3.2.1 of TS 23.401 [13] and has received the indication that interworking
without N26 is supported, then the UE initiates Attach with PDN connectivity
request with request type \"handover\".
In the case of inter-system redirection for the emergency service, the UE uses
the emergency indication in the RRC message as specified in clause 6.2.2 of TS
36.331 [16] and E-UTRAN provides the emergency indication to MME during
Tracking Area Update or Attach procedure. For the handover procedure see
clause 4.11.1.2.1, step 1.
7\. After completion of the mobility procedure to EPS or as part of the 5GS to
EPS handover procedure, the SMF+PGW-C re-initiates the setup of the dedicated
bearer(s) for the maintained PCC rule(s) in step 4 including of the dedicated
bearer for IMS voice, mapping the 5G QoS to EPC QoS parameters as specified in
clause 4.11.1.2.1. The SMF+PGW-C reports about Successful Resource Allocation
and Access Network Information if subscribed by PCF.
The IMS signalling related to IMS voice call establishment continues after
step 1 as specified in the TS 23.228 [55].
At least for the duration of the voice call in EPS the E-UTRAN is configured
to not trigger any handover to 5GS.
#### 4.13.6.2 Inter RAT Fallback in 5GC for IMS voice
Figure 4.13.6.2-1 describes the RAT fallback procedure in 5GC for IMS voice.
When the UE is served by the 5GC, the UE has one or more ongoing PDU Sessions
each including one or more QoS Flows. The serving PLMN AMF has sent an
indication towards the UE during the Registration procedure that IMS voice
over PS session is supported, see clause 5.16.3.10 of TS 23.501 [2] and the UE
has registered in the IMS.
Figure 4.13.6.2-1: RAT Fallback for IMS voice
1\. UE camps on source NG-RAN in the 5GS and an MO or MT IMS voice session
establishment has been initiated.
2\. Network initiated PDU Session modification to setup QoS flow for IMS voice
reaches the source NG-RAN (see N2 PDU Session Request in clause 4.3.3).
3\. If source NG-RAN is configured to support RAT fallback for IMS voice,
source NG-RAN decides to trigger RAT fallback, taking into account on UE
capabilities, network configuration and radio conditions.
Source NG-RAN may initiate measurement report solicitation from the UE
including target NG-RAN.
4\. Source NG-RAN responds indicating rejection of the PDU Session
modification to setup QoS flow for IMS voice received in step 2 by PDU Session
Response message towards the SMF (or V-SMF, in the case of roaming scenario)
via AMF with an indication that mobility due to fallback for IMS voice is
ongoing. The SMF maintains the PCC rule(s) associated with the QoS Flow(s).
5\. Source NG-RAN initiates Xn based Inter NG-RAN handover (see clause
4.9.1.2) or N2 based inter NG-RAN handover (see clause 4.9.1.3), or
redirection to E-UTRA connected to 5GC (see clause 4.2.6). The SMF reports
change of the RAT type if subscribed by PCF.
6\. After completion of the Inter NG-RAN (inter-RAT) handover or redirection
to E-UTRA connected to 5GC, the SMF re-initiates the PDU Session modification
to setup QoS flow for IMS voice. The SMF reports about Successful Resource
Allocation and Access Network Information if subscribed by PCF.
The IMS signalling related to IMS voice call establishment continues after
step 1 as specified in TS 23.228 [55].
At least for the duration of the IMS voice call the target NG-RAN is
configured to not trigger inter NG-RAN handover back to source NG-RAN.
#### 4.13.6.3 Transfer of PDU session used for IMS voice from non-3GPP access
to 5GS
Figure 4.13.6.3-1: Transfer of PDU session used for IMS voice from non-3GPP
access to 5GS
When the UE has an ongoing IMS voice session via non-3GPP access using ePDG or
N3IWF and the session is transferred to NG-RAN, depending on the selected RAT
in 5GS (NR or E-UTRA) and the support of EPS/inter-RAT fallback in NG-RAN,
either the IMS voice session continues over NG-RAN (E-UTRA) or EPS/inter-RAT
fallback is triggered.
Steps 1, 2 and 3 apply to either of the above two cases.
1\. UE has ongoing IMS voice session via non-3GPP access using ePDG or N3IWF.
UE is triggered to move to 3GPP access and camps in NG-RAN.
2\. If the UE is not registered via 3GPP access, the UE shall initiate
Registration procedure as defined in clause 4.2.2.2.2.
3\. UE initiates PDU session establishment for the PDU session used for IMS
voice service in order to initiate handover from EPC/ePDG to 5GS as defined in
clause 4.11.4.1 step 2 or to initiate handover from N3IWF to 3GPP access in
5GC in step 2 of clauses 4.9.2.1 and 4.9.2.3. The SMF accepts the PDU session
transfer from the UE.
NOTE 1: If the UE is aware (e.g. implementation-dependent mechanisms) that
voice over NR may not be natively supported in the current Registration area,
the UE can attempt to move to E-UTRA to initiate a handover of the IMS PDU
Session to EPC or 5GC to continue the IMS voice session. The remaining steps
are not executed.
4\. NG-RAN may decide to trigger EPS or inter-RAT fallback, taking into
account UE capabilities, indication from AMF that \"Redirection for EPS
fallback for voice is possible\" (received as part of initial context setup as
defined in TS 38.413 [10]), network configuration (e.g. N26 availability
configuration) and radio conditions. NG-RAN may initiate measurement report
solicitation from the UE including E-UTRA as target.
If NG-RAN does not trigger EPS or inter-RAT fallback, then the procedure stops
here and following steps are not executed.
NOTE 2: If the AMF has indicated that \"Redirection for EPS fallback for voice
is not possible\", then EPS fallback for IMS voice is not performed. If NG-RAN
has not received indication \"Redirection for EPS fallback for voice\", the
decision to execute EPS fallback for IMS voice or not is based on network
configuration (e.g. based on N26 availability and other criteria).
5\. NG-RAN responds indicating rejection either to set up the QoS flow for IMS
voice or the entire PDU session used for IMS voice service as received in step
3 towards the SMF+PGW-C (or H-SMF+P-GW-C via V-SMF, in the case of roaming
scenario) via AMF with an indication that mobility due to fallback for IMS
voice is ongoing. The SMF+PGW-C reports the EPS Fallback event to the PCF if
the PCF has subscribed to this event.
If NG-RAN responds indicating rejection to set up the QoS flow for IMS voice,
steps 5-7 from clause 4.13.6.1 are executed if EPS fallback is triggered, or
steps 5-6 from clause 4.13.6.2 are executed if inter-RAT Fallback for IMS
voice is triggered. The SMF+PGW-C executes the release of resources in
non-3GPP AN as specified in step 3 of clauses 4.11.4.1, 4.9.2.1 and 4.9.2.3.
NOTE 3: The timing of executing the release of resources in non-3GPP AN will
depend on whether NG-RAN decides to trigger EPS or inter-RAT fallback but will
take place at least after step 5.
If NG-RAN rejects entire PDU session used for IMS voice service, the SMF
should stop the ongoing procedure and keep the PDN connection / PDU Session at
non-3GPP side. The NG-RAN performs AN release with redirection or handover
procedure.
In both cases, after receiving the AN release with redirection or completion
of the handover procedure the UE initiates TAU procedure. In the case of
inter-system redirection to EPS, if the UE decides to re-initiate handover of
an IMS voice session over non-3GPP access to EPS after inter-system change
from 5GS to EPS is completed, the UE includes active flag in the request.
NOTE 4: Depending on UE implementation, the UE can re-initiate handover of an
IMS voice session over non-3GPP access to EPS if the inter-system change from
5GS to EPS is triggered by the NG-RAN and the UE does not receive a response
to the PDU session establishment request i.e. when the establishment of the
entire PDU session used for voice is rejected by NG-RAN.
### 4.13.7 MSISDN-less MO SMS
#### 4.13.7.1 General
The Nnef_MSISDN-less_MO_SMS service is used by the NEF to send the MSISDN-less
MO SMS to the AF.
#### 4.13.7.2 The procedure of MSISDN-less MO SMS Service
Figure 4.13.7.2-1: MSISDN-less MO SMS procedure via Nnef
1\. The UE uses SMS over NAS procedures in clause 4.13.3 to send an SMS to the
AF.
The service centre address points to the SMS-SC which contains the function
described in this procedure, the destination SME address is set to short/long
code of the AF and the Application Port ID element of the TP-User-Data field
is set to the appropriate value.
For MSISDN-less subscription, the dummy MSISDN is used. This MSISDN and the
IMSI of the UE are sent to SMS-SC.
2\. SMS-SC uses the destination SME address (long/short code of the AF) to
identify the corresponding NEF based on a pre-configured mapping table. SMS-SC
extracts the SMS payload, Application port ID and IMSI of the UE and delivers
them to NEF along with the destination SME address (long/short code of the
AF). The NEF acts as an MTC-IWF in this procedure.
3\. The NEF invokes Nudm_SDM_Get (Identifier Translation, IMSI, Application
Port ID, AF Identifier) to resolve the IMSI and Application Port ID to a GPSI
(External Id).
4\. The UDM provides a Nudm_SDM_Get response (GPSI). If the UE is not allowed
to send an SMS payload to this AF, or there is no valid subscription
information for this user, the flow proceeds to step 6.
5\. The NEF provides a Nnef_MSISDN-less_MO_SMSNotify (SMS payload, GPSI and
Application Port ID) message to the AF. The AF is identified with the
destination SME address (long/short code of the AF) received from step 2. The
payload is delivered directly to the AF, it is not processed by NEF.
6\. The NEF, acting as an MTC-IWF, returns a success or failure delivery
indication to SMS-SC.
7\. SMS-SC indicates success/failure back to UE using existing SMS delivery
report defined in TS 23.040 [7].
### 4.13.8 Support of 5G LAN-type service
#### 4.13.8.1 Support of 5G VN group management
The information of 5G VN group is provided by the AF to the NEF and is stored
in the UDR, by using the NEF service operations information flow procedure
described in clause 4.15.6.2.
#### 4.13.8.2 Support of 5G VN group communication
##### 4.13.8.2.1 General
This clause specifies the procedures for 5G VN group communication.
##### 4.13.8.2.2 group-level N4 session management procedures
The SMF shall create an group-level N4 session on the UPF for a 5G VN group
when N19-based forwarding is applied. The group-level N4 Session management
procedures enable the SMF to create, update or delete the group-level N4
Session, e.g. add or delete N4 rules, allocate or release the N19 tunnel
resources.
In the case of N19-based forwarding is applied, the followings apply for the
PDU Sessions targeting the (DNN, S-NSSAI) associated with a 5G VN group:
\- If the PDU Sessions targeting the same 5G VN group are anchored at
different UPFs, the SMF shall create the group-level N4 Session in each
involved UPF via N4 Session Establishment procedure (clause 4.4.1.2) in order
to establish N19 tunnel(s) between the UPFs and install the N4 rules.
\- If the last PDU Session for this 5G VN group is released on a UPF, the SMF
may delete the group-level N4 Session in the UPF via N4 Session Release
procedure (clause 4.4.1.4) and release the N19 tunnel(s) between this UPF and
other UPF(s) serving the 5G VN group via update of the corresponding N4 rules.
\- If an address of the UE within the 5G VN group is allocated or released,
the SMF may update the N4 rules(e.g. PDRs and FARs) related to the UE address
into the group-level N4 Session context via N4 Session Modification procedure
(clause 4.4.1.3).
## 4.14 Support for Dual Connectivity
### 4.14.1 RAN Initiated QoS Flow Mobility
This procedure is used to transfer QoS Flows to and from Secondary RAN Node.
During this procedure, the SMF and UPF are never re-allocated. The UPF
referred in this clause 4.14.1 is the UPF which terminates N3 interface in the
5GC. The presence of IP connectivity between the UPF and the Master RAN node,
as well as between the UPF and the Secondary RAN node is assumed.
If QoS Flows for multiple PDU Sessions need to be transferred to or from
Secondary RAN Node, the procedure shown in the Figure 4.14.1-1 below is
repeated for each PDU Session.
Figure 4.14.1-1: NG-RAN initiated QoS Flow mobility procedure
1\. The Master RAN node sends a N2 QoS Flow mobility Indication (PDU Session
ID, QFI(s), AN Tunnel Info, User Location Information) message to the AMF. AN
Tunnel Info includes the new RAN tunnel endpoint for the QFI(s) for which the
AN Tunnel Info shall be modified. The User Location Information shall include
the serving cell\'s ID and if Dual Connectivity is activated for the UE, the
PSCell ID.
2\. AMF to SMF: Nsmf_PDUSession_UpdateSMContext reques (N2 QoS Flow mobility
Indication message PDU Session ID).
3\. The SMF sends an N4 Session Modification Request (PDU Session ID(s),
QFI(s), AN Tunnel Info for downlink user plane) message to the UPF.
4\. The UPF returns an N4 Session Modification Response (CN Tunnel Info for
uplink traffic) message to the SMF after requested QFIs are switched.
NOTE: Step 7 can occur any time after receipt of N4 Session Modification
Response at the SMF.
5\. SMF to AMF: Nsmf_PDUSession_UpdateSMContext response (N2 SM information
(CN Tunnel Info for uplink traffic)) for QFIs of the PDU Session which have
been switched successfully. If none of the requested QFIs have been switched
successfully, the SMF shall send an N2 QoS Flow mobility Failure message.
6\. In order to assist the reordering function in the Master RAN node and/or
Secondary RAN node, for each affected N3 tunnel the UPF sends one or more
\"end marker\" packets on the old tunnel immediately after switching the
tunnel for the QFI. The UPF starts sending downlink packets to the Target NG-
RAN.
7\. The AMF relays message 5 to the Master RAN node.
## 4.15 Network Exposure
### 4.15.1 General
The network capability exposure comprises
\- Exposure of network events externally as well as internally towards core
network NFs;
\- Exposure of provisioning capability towards external functions;
\- Exposure of policy and charging capabilities towards external functions;
\- Exposure of core network internal capabilities for analytics.
\- Exposure of analytics to external party.
\- Retrieval of data from external party by NWDAF.
\- Exposure of number of registered UEs and/or established PDU Sessions for a
network slice that is subject to Network Slice Admission Control towards core
network NFs or external party.
\- Exposure of Member UE selection assistance information including list(s) of
candidate UEs based on the UE list provided by the AF and possibly additional
information that fulfil some Member UE filtering criteria provided by the AF.
When subscribing to event reporting the NF consumer(s) provide:
\- One or multiple Event ID(s). An Event ID identifies the type of event being
subscribed to (e.g. PDU Session Release, UE mobility out of an Area of
Interest, etc.).
\- Event Filter Information: Provides Event Parameter Types and Event
Parameter Value(s) to be matched against, in order to meet the condition for
notifying the subscribed Event ID e.g. the Event Parameter Type could be
\"Area of interest\" and Event Parameter Value list could be list of TAs; The
Event Filter depends on the Event ID. The Event Filter Information is provided
per Event ID(s) being subscribed to: within a subscription different Event
ID(s) may be associated with different Event Filter Information.
\- Event Reporting Information described in the Table 4.15.1-1 below. Within a
subscription all Event ID(s) are associated with a unique Event Reporting
Information.
\- Target of Event Reporting: this may indicate a specific UE or PDU Session,
a group of UE(s) or any UE (i.e. all UEs), Within a subscription all Event ID
(s) are associated with the same Target of Event Reporting (possibly
corresponding to multiple UE or multiple PDU Sessions).
\- A Notification Target Address (+ Notification Correlation ID) allowing the
Event Receiving NF to correlate notifications received from the Event provider
with this subscription. A subscription is associated with an unique
Notification Target Address (+ Notification Correlation ID). In the case that
the NF consumer subscribes to the NF producer on behalf of other NF, the NF
consumer includes the Notification Target Address(+Notification Correlation
ID) of other NF for the Event ID which is to be notified to other NF directly
and the Notification Target Address(+Notification Correlation ID) of itself
for the Subscription change related event notification. Each Notification
Target Address(+ Notification Correlation ID) is associated with related (set
of) Event ID(s).
\- An Expiry time represents the time upto which the subscription is desired
to be kept as active. The NF service consumer may suggest an Expiry time and
provide to the NF service producer. Based on the operator\'s policy, the NF
service producer decides whether the subscription can be expired. If the
subscription can be expired, the NF service producer determines the Expiry
time and provide it in the response to the NF service consumer. If the event
subscription is about to expire based on the received Expiry time and the NF
service consumer wants to keep receiving notifications, the NF service
consumer update the subscription with the NF service producer in order to
extend the Expiry time. Once the Expiry time associated with the subscription
is reached, the subscription becomes invalid at the NF service producer. If
the NF service consumer wants to keep receiving notifications, it shall create
a new subscription with the NF service producer.
When the subscription is accepted by the Event provider NF, the consumer NF
receives from the event provider NF an identifier (Subscription Correlation
ID) allowing to further manage (modify, delete) this subscription.
NOTE 1: The Notification Correlation ID is allocated by the consumer NF that
subscribes to event reporting and the Subscription Correlation ID is allocated
by the NF that notifies when the event is met. Both correlation identifiers
can be assigned the same value, although in principle they are supposed to be
different, as they are optimized for finding the subscription related context
within each NF.
The consumer NF may use an operation dedicated to subscription modification to
add or remove Event ID(s) to this subscription or to modify Event Filter
Information.
Events are subscribed by the consumer NF(s) by providing Event Filters. The
contents of the Event Reporting Information along with the presence
requirement of each information element is described in Table 4.15.1-1.
Table 4.15.1-1: Event Reporting Information
+----------------------+----------------------+----------------------+ | Event Reporting | Description | Presence requirement | | Information | | | | Parameter | | | +======================+======================+======================+ | Event reporting mode | Mode of reporting - | mandatory | | | e.g. reporting up to | | | | a maximum number of | (see NOTE 7) | | | reports, periodic | | | | reporting along with | | | | periodicity, | | | | variable reporting | | | | periodicity, | | | | reporting up to a | | | | maximum duration, | | | | reporting when | | | | threshold is | | | | reached. | | +----------------------+----------------------+----------------------+ | Maximum number of | Maximum number of | (see NOTE 1) | | reports | reports after which | | | | the event | | | | subscription ceases | | | | to exist. | | +----------------------+----------------------+----------------------+ | Maximum duration of | Maximum duration | (see NOTE 1) | | reporting | after which the | | | | event subscription | | | | ceases to exist. | | +----------------------+----------------------+----------------------+ | Immediate reporting | The Event provider | | | flag | NF notifies the | | | | current status of | | | | the subscribed | | | | event, if available, | | | | immediately to the | | | | consumer NF. | | +----------------------+----------------------+----------------------+ | Variable reporting | List of variable | (see NOTE 7) | | periodicity | measurement | | | information (0..N) | information. | | +----------------------+----------------------+----------------------+ | > Reporting | Reporting | (see NOTE 7) | | periodicity | periodicity. | | +----------------------+----------------------+----------------------+ | >Condition | The corresponding | (see NOTE 7) | | | condition related to | | | | Reporting | | | | periodicity e.g. | | | | load of NF service | | | | producer. | | +----------------------+----------------------+----------------------+ | Sampling ratio | Percentage of | optional | | | sampling (1%..100%) | | | | among impacted UEs. | (see NOTE 2) | +----------------------+----------------------+----------------------+ | Partitioning | Criteria for | optional | | criteria | partitioning UEs | | | | before applying | (see NOTE 2) | | | sampling ratio. | | +----------------------+----------------------+----------------------+ | Group Reporting | Parameter for | Optional | | Guard Time | group-based | | | | monitoring | | | | configuration to | | | | indicate the time | | | | for which the | | | | Monitoring Event | | | | Reporting(s) related | | | | with the UEs in a | | | | group can be | | | | aggregated before | | | | sending them to the | | | | consumer NF. | | +----------------------+----------------------+----------------------+ | Deactivate | Indicates to the | Optional (see | | notification flag | Event provider NF | NOTE 8) | | | that the | | | | notification of the | | | | available events | | | | shall be muted until | | | | the Event consumer | | | | NF provides the | | | | retrieval | | | | notification flag to | | | | retrieve the events | | | | stored. | | +----------------------+----------------------+----------------------+ | Retrieval | Indicates to the | Optional (see | | notification flag | Event provider NF to | NOTE 8) | | | send the | | | | notification to the | | | | Event consumer NF | | | | with the stored | | | | events and mutes | | | | again the | | | | notification of | | | | future events. | | +----------------------+----------------------+----------------------+ | Muting Exception | Indicates to an | Optional | | Instructions | Event provider NF | | | | instructions for the | (see NOTE 6 and | | | subscription and | NOTE 8) | | | stored events when | | | | an exception (e.g. | | | | full buffer) occurs | | | | at the Event | | | | provider. | | +----------------------+----------------------+----------------------+ | Granularity of | The maximum amount | optional | | dynamics | of dynamics in the | | | | event which allows | (see NOTE 3) | | | to skip an event | | | | notification. | | +----------------------+----------------------+----------------------+ | Reporting type | Event provider NF | optional | | | reports only when | | | | the events differs | (see NOTE 4) | | | from the previously | | | | notified event. | | +----------------------+----------------------+----------------------+ | Reporting Threshold | Threshold values | Optional | | | indicate conditions | | | | on the level to be | (see NOTE 5) | | | reached for the | | | | reporting. | | +----------------------+----------------------+----------------------+ | NOTE 1: The | | | | requester shall | | | | include 2) Maximum | | | | number of reports or | | | | 3) Maximum duration | | | | of reporting, or | | | | both, depending on | | | | 1) Event reporting | | | | mode. | | | | | | | | NOTE 2: Parameter | | | | only applicable to | | | | certain event IDs | | | | reporting metrics | | | | (e.g. Number of UEs | | | | present in a | | | | geographical area) | | | | used and used e.g. | | | | by the NWDAF for | | | | data collection. | | | | | | | | NOTE 3: The | | | | Granularity of | | | | dynamics includes 1) | | | | the range of scalar | | | | value, 2) the list | | | | of events | | | | identification, or | | | | 3) the previous | | | | notification. The | | | | range of scalar | | | | value is only | | | | applicable to the | | | | event depicted as | | | | number (e.g. the | | | | number of UE), the | | | | others is applicable | | | | to the event | | | | depicted as | | | | identification (e.g. | | | | UE location, UE | | | | identification). | | | | | | | | NOTE 4: The | | | | differences in event | | | | includes the events | | | | have been newly | | | | appeared, | | | | disappeared and | | | | changed from the | | | | previous | | | | notification. | | | | | | | | NOTE 5: This | | | | parameter is | | | | included only if the | | | | Event reporting mode | | | | indicates reporting | | | | when threshold is | | | | reached. | | | | | | | | NOTE 6: This | | | | parameter is | | | | included only if the | | | | \"Deactivate | | | | notification flag\" | | | | is set. | | | | | | | | NOTE 7: If the | | | | requester includes | | | | \"variable reporting | | | | periodicity\", then | | | | reporting | | | | periodicity changes | | | | depending on e.g. | | | | load of NF service | | | | producer; otherwise | | | | the reporting | | | | periodicity is | | | | fixed. | | | | | | | | NOTE 8: The support | | | | of this parameter is | | | | only required for | | | | services where NWDAF | | | | and/or DCCF are | | | | among the example | | | | consumers. It is | | | | expected that this | | | | parameter is used | | | | only if the Event | | | | Consumer NF is NWDAF | | | | or DCCF. | | | +----------------------+----------------------+----------------------+
NOTE 2: Explicit unsubscribe by the NF consumer is still possible.
Maximum number of reports is applicable to the subscription to one UE or a
group of UE(s). When the subscription is applied to a group of UE(s), the
initial value of the parameter is applied to each individual member UE. The
count of number of reports is per UE and per Event Type granularity also for
group member UE.
Maximum duration of reporting is applicable to the subscription to one UE, a
group of UE(s) or any UE. When the subscription is applied to a group of
UE(s), this parameter applies to each group member UE. When the subscription
is applied to any UE, this parameter applies to all the impacted UEs.
If for a given subscription Maximum duration of reporting is included then the
subscription is cancelled locally in the NF as soon as Maximum duration of
reporting is reached. If the Maximum number of reports is reached for a given
subscription, the NEF cancels the subscription in the affected NFs. If both
Maximum Number of reports and Maximum duration of reporting are included then
the subscription expires or is cancelled as soon as one of the conditions is
met.
Sampling ratio is applicable to subscription targeting a group of UEs or any
UE. When a sampling ratio is provided, a random subset is selected among the
target UEs according to the sampling ratio and only the events related to this
subset are reported. A UE remains selected until it is no longer managed by
the event provider NF. A UE newly managed by the NF may be selected.
Partitioning criteria are applicable to subscription targeting a group of UEs
or any UE and may be used when sampling ratio is used. These criteria are used
to instruct the NF on how to group the UEs before applying the sampling ratio.
When partitioning criteria are provided, the NF groups the targeted UEs (i.e.
creates sub-populations/strata) based on the partition criteria parameter.
Then, from each sub-population/stratum, the NF selects a subset of UEs by
sampling randomly from each sub-population according to the sampling ratio.
For a given type of partitioning criteria, the UE belongs to a single sub-
population/stratum as long as it is served by the NF. The types of
Partitioning Criteria are described in Table 4.15.1-2:
Table 4.15.1-2: Types of Partitioning Criteria
Types of Partitioning Criteria
* * *
Type Allocation Code Subscriber PLMN ID Geographical area, i.e. list(s) of
TAI(s) S-NSSAI DNN
Group Reporting Guard Time is an optional parameter for group-based monitoring
configuration to indicate the time for which the Monitoring Event Reporting(s)
related with the UEs in a group can be aggregated before sending them to the
consumer NF. The value of the Group Reporting Guard time should be set less
than the Maximum duration of reporting. For the continuous monitoring
reporting, unless the Maximum duration of reporting has been reached, the
Group Reporting Guard timer is restarted when it expires. If the time left
until the Maximum duration of reporting is less than the Group Reporting Guard
Time, then the Group Reporting Guard timer shall be set to expire when the
Maximum duration of reporting expires. If the Maximum duration of reporting is
expired, the Group Reporting Guard Time, if running, shall be considered to
expire and aggregated Monitoring Event Reporting(s) is sent to destination
immediately.
Deactivation notification flag and retrieval notification flag enable the mute
storage of events for a limited size of events at the Event provider NF, thus
reducing the number of notifications and the overall signalling between the
Event provider NF and the Event consumer NF. Usage of these parameters is
further specified in clause 6.2.7 of TS 23.288 [50].
Muting Exception Instructions specify actions to be taken by the Event
provider NF if the Deactivation notification flag is set and an exception
occurs at the Event Producer NF (e.g. the Event provider can no longer buffer
notifications because storage space is no longer available). The actions are
specified in clause 6.2.7 of TS 23.288 [50].
Granularity of dynamics indicates negligible changes in the target event of
the subscription for which notification is not required. The changes in the
Granularity of dynamics are depicted as the range of scalar value (x, y) where
it means [the previously notified scalar value - x, the previously notified
scalar value + y), the list of event identification(s) (e.g. list of SUPI(s)),
or the previous notification. If the Granularity of dynamics is provided, the
provider NF shall send the notification only when the changes in the target
event are not described in the Granularity of dynamics, except for the first
notification.
Reporting type is a parameter to reduce the data volume of notification. If
the Reporting type is provided, the provider NF shall notify the events that
have been newly appeared, disappeared and changed compared to the previous
notification, except for the first notification.
Table 4.15.1-1 indicates the presence requirements for the Event Reporting
Information.
Corresponding notifications contain at least the Notification Correlation ID
together with the Event ID and the individual target (e.g. UE or PDU Session
ID) associated with the notification.
If the NF service consumer decides to terminate the event subscription, it
unsubscribes the event subscription by sending unsubscription request to the
event provider NF. After receiving unsubscription request from the NF service
consumer, the event provider NF terminates the event subscription.
If the NF service consumer has subscribed to group-based monitoring, then the
NF service consumer may subsequently unsubscribe to the whole group or one or
more identified group member UEs. Such partial cancellation of group-based
monitoring does not affect the other group member UEs, but it only cancels the
monitoring event subscription for the identified group member UEs. Partial
cancellation of group-based monitoring can be caused by the following reasons:
\- UE\'s subscription is discontinued in the UDM;
\- UE\'s authorisation to the subscribed event type is revoked;
\- The subscribing NF explicitly unsubscribes to monitoring of selected UE(s);
or
\- UE is removed from the monitoring target group that was identified in
monitoring subscription.
If the NF service consumer has subscribed to group-based monitoring and later
new group member UEs are added to the group, then the NF service consumer may
also subsequently add monitoring event subscription for the new group member
UEs.
The following clauses describe the external exposure of network capabilities
and core network internal event and capability exposure.
When the immediate reporting flag is set, the first corresponding event report
is included in the subscription response message, if corresponding information
is available at the reception of the subscription request of the event.
During Monitoring Event Subscription as in clause 4.15.3, Parameter
Provisioning as in clause 4.15.6, NIDD configuration as in clause 4.25.3 and
Enhanced Coverage Restriction Control as in clause 4.27.1, the optional
parameter MTC Provider Information is a reference parameter that may be
provided by AF or determined by NEF based on which AF it communicates with.
The MTC Provider Information identifies the MTC Service Provider and/or MTC
Application.
NOTE 3: The MTC Provider Information can be used by Service Providers for,
e.g. to distinguish their different customers.
NOTE 4: The MTC Provider Information is an optional parameter. The NEF can
validate the provided MTC Provider Information and override it to a NEF
selected MTC Provider Information based on configuration. How the NEF
determines the MTC Provider Information, if not present, is left to
implementation (e.g. based on the requesting AF).
### 4.15.2 External Exposure of Network Capabilities
The Network Exposure Function (NEF) supports external exposure of capabilities
of network functions. External exposure can be categorized as Monitoring
capability, Provisioning capability, Policy/Charging capability, network
status reporting capability, Analytics reporting capability and Member UE
selection assistance capability. The Monitoring capability is for monitoring
of specific event for UE in 5GS and making such monitoring events information
available for external exposure via the NEF. The Provisioning capability is
for allowing external party to provision of information which can be used for
the UE in 5GS. The Policy/Charging capability is for handling QoS and charging
policy for the UE based on the request from external party. The Analytics
capability is for allowing external party to acquire analytics information
generated by 5G System. The Member UE selection assistance capability enables
the NEF to consolidate information collected from other 5GC NFs, which fulfil
the Member UE filtering criteria requested by the AF, to derive one or more
lists of UE(s) and possibly additional information that assists AF for the
selection of candidate members to participate in the application layer
operation e.g. federated learning operation in the application layer.
The details for the External Exposure of Analytics capabilities as well as
interactions between NEF, external party and NWDAF are described in TS 23.288
[50].
### 4.15.2a Data Collection from an AF
The Network Exposure Function (NEF) supports the capability to collect data
from an AF as specified in TS 23.501 [2].
### 4.15.3 Event Exposure using NEF
#### 4.15.3.1 Monitoring Events
The Monitoring Events feature is intended for monitoring of specific events in
3GPP system and making such monitoring events information reported via the
NEF. It is comprised of means that allow NFs in 5GS for configuring the
specific events, the event detection and the event reporting to the requested
party.
To support monitoring features in roaming scenarios, a roaming agreement needs
to be made between the HPLMN and the VPLMN. If the AMF/SMF in the VPLMN
determine that normalisation of an event report is required, the AMF/SMF
normalises the event report before sending it to the NEF.
The set of capabilities required for monitoring shall be accessible via NEF to
NFs in 5GS. Monitoring Events via the UDM, the AMF, the SMF, the NSACF and the
GMLC enables NEF to configure a given Monitor Event at UDM, AMF, SMF, NSACF or
GMLC and reporting of the event via UDM and/or AMF, SMF, NSACF or GMLC.
Depending on the specific monitoring event or information, it is the AMF,
GMLC, NSACF or the UDM that is aware of the monitoring event or information
and makes it reported via the NEF.
The following table enumerates the monitoring events and their detection
criteria:
Table 4.15.3.1-1: List of events for monitoring capability
+----------------------+----------------------+----------------------+ | Event | Detection criteria | Which NF detects the | | | | event | +======================+======================+======================+ | Loss of Connectivity | Network detects that | AMF | | | the UE is no longer | | | | reachable for either | | | | signalling or user | | | | plane communication | | | | (see NOTE 4). | | | | | | | | The AF may provide a | | | | Maximum Detection | | | | Time, which | | | | indicates the | | | | maximum period of | | | | time without any | | | | communication with | | | | the UE after which | | | | the AF is to be | | | | informed that the UE | | | | is considered to be | | | | unreachable (see | | | | NOTE 7). | | | | | | | | If Unavailability | | | | Period Duration has | | | | been provided by the | | | | UE, the AMF uses the | | | | remaining value of | | | | it to determine the | | | | foreseen Loss of | | | | Connectivity time as | | | | described in | | | | clause 5.4.1.4 of | | | | TS 23.501 [2]. | | +----------------------+----------------------+----------------------+ | UE reachability | Detected when the UE | AMF, UDM | | | transitions to | | | | CM-CONNECTED state | | | | or when the UE will | | | | become reachable for | | | | paging, e.g. | | | | Periodic | | | | Registration Update | | | | timer. It indicates | | | | when the UE becomes | | | | reachable for | | | | sending downlink | | | | data to the UE. | | | | | | | | The AF may provide | | | | the following | | | | parameters: | | | | | | | | 1) Maximum Latency; | | | | | | | | 2) Maximum Response | | | | Time; | | | | | | | | 3) Suggested number | | | | of downlink packets. | | | | (see NOTE 5 and | | | | NOTE 7). | | | | | | | | This event requires | | | | the Reachability | | | | Filter set to UE | | | | reachable for DL | | | | traffic\" (see | | | | clause 5.2.2.3.1-1). | | | | For the usage of | | | | this event, see | | | | clauses 4.2.5.2 and | | | | 4.2.5.3. | | | | | | | | When requesting UE | | | | reachability | | | | monitoring, the AF | | | | may in addition | | | | request Idle Status | | | | Indication to be | | | | included in the UE | | | | reachability event | | | | reporting. | | +----------------------+----------------------+----------------------+ | Location Reporting | This event is | AMF, GMLC | | | detected based on | | | | the Event Reporting | | | | Information | | | | Parameters that were | | | | received in the | | | | Monitoring Request | | | | (one-time reporting, | | | | maximum number of | | | | reports, maximum | | | | duration of | | | | reporting, | | | | periodicity, etc. as | | | | specified in | | | | clause 4.15.1). | | | | | | | | It reports either | | | | the Current Location | | | | or the Last Known | | | | Location of a UE. | | | | | | | | When AMF is the | | | | detecting NF: | | | | | | | | One-time and | | | | Continuous Location | | | | Reporting are | | | | supported. For | | | | Continuous Location | | | | Reporting the | | | | serving node(s) | | | | sends a notification | | | | every time it | | | | becomes aware of a | | | | location change, | | | | with the granularity | | | | depending on the | | | | accepted accuracy of | | | | location (see NOTE | | | | 1). | | | | | | | | For One-time | | | | Reporting with | | | | immediate reporting | | | | flag set, AMF | | | | reports the Last | | | | Known Location | | | | immediately. | | | | | | | | When AMF is the | | | | detecting NF: | | | | | | | | If the immediate | | | | reporting flag is | | | | not set, the AMF | | | | reports the UE | | | | Current Location (In | | | | case the AMF does | | | | not have the UE | | | | current location in | | | | the granularity as | | | | requested by the | | | | location report, the | | | | AMF retrieves the | | | | information via | | | | NG-RAN Location | | | | reporting procedure | | | | as defined in | | | | clause 4.10). | | | | | | | | When GMLC is the | | | | detecting NF: | | | | | | | | Immediate and | | | | Deferred Location | | | | Reporting is | | | | supported. For | | | | Deferred Location | | | | Reporting the event | | | | types UE | | | | availability, Area, | | | | Periodic Location | | | | and Motion are | | | | supported. | | +----------------------+----------------------+----------------------+ | Change of SUPI-PEI | This event is | UDM | | association | detected when the | | | | association between | | | | PEI and subscription | | | | (SUPI) changes (USIM | | | | change). | | +----------------------+----------------------+----------------------+ | Roaming status | This event is | UDM | | | detected based on | | | | the UE\'s current | | | | roaming status (the | | | | serving PLMN and/or | | | | whether the UE is in | | | | its HPLMN) and | | | | notification is sent | | | | when that status | | | | changes. (see NOTE | | | | 2). | | | | | | | | If the UE is | | | | registered via both | | | | 3GPP and N3GPP | | | | Access Type, then | | | | both instances of | | | | Roaming status are | | | | included. | | +----------------------+----------------------+----------------------+ | Communication | This event is | AMF | | failure | detected when RAN or | | | | NAS level failure is | | | | detected based on | | | | connection release | | | | and it identifies | | | | RAN/NAS release | | | | code. | | +----------------------+----------------------+----------------------+ | Availability after | This event is | AMF | | Downlink Data | detected when the UE | | | Notification failure | becomes reachable | | | | again after downlink | | | | data delivery | | | | failure. | | | | | | | | When requesting | | | | Availability after | | | | Downlink Data | | | | Notification failure | | | | monitoring, the AF | | | | may in addition | | | | request Idle Status | | | | Indication to be | | | | included in the UE | | | | reachability event | | | | reporting. | | +----------------------+----------------------+----------------------+ | PDU Session Status | This event is | SMF | | | detected when PDU | | | | session is | | | | established or | | | | released. (see | | | | NOTE 6) | | +----------------------+----------------------+----------------------+ | Number of UEs | This event is | AMF | | present in a | detected based on | | | geographical area | the Event Reporting | | | | Information | | | | Parameters that were | | | | received in the | | | | Monitoring Request | | | | (Level of | | | | aggregation, | | | | Sampling ratio, see | | | | clause 4.15.1). | | | | | | | | It indicates the | | | | number of UEs that | | | | are in the | | | | geographical area | | | | described by the AF. | | | | The AF may ask for | | | | the UEs that the | | | | system knows by its | | | | normal operation to | | | | be within the area | | | | (Last Known | | | | Location) or the AF | | | | may request the | | | | system to also | | | | actively look for | | | | the UEs within the | | | | area (Current | | | | Location). | | +----------------------+----------------------+----------------------+ | CN Type change | The event is | UDM | | | detected when the UE | | | | moves between EPC | | | | and 5GC. It | | | | indicates the | | | | current CN type for | | | | a UE or a group of | | | | UEs when detecting | | | | that the UE switches | | | | between being served | | | | by a MME and an AMF | | | | or when accepting | | | | the event | | | | subscription. (see | | | | NOTE 3) | | +----------------------+----------------------+----------------------+ | Downlink data | It indicates the | SMF | | delivery status | downlink data | | | | delivery status in | | | | the core network. | | | | Events are reported | | | | at the first | | | | occurrence of | | | | packets being | | | | buffered, | | | | transmitted or | | | | discarded, | | | | including: | | | | | | | | - Downlink data in | | | | extended buffering, | | | | including: | | | | | | | | > \- First data | | | | > packet buffered | | | | > event | | | | > | | | | > \- Estimated | | | | > buffering time, as | | | | > per clause 4.2.3.3 | | | | | | | | - First downlink | | | | data transmitted | | | | event | | | | | | | | - First downlink | | | | data discarded event | | +----------------------+----------------------+----------------------+ | UE reachability for | For SMS over NAS, | UDM | | SMS delivery | this event is | | | | detected when an | | | | SMSF is registered | | | | for a UE and the UE | | | | is reachable as | | | | determined by the | | | | AMF and the UDM. | | | | | | | | For SMS over IP, the | | | | event is detected | | | | when the UE is | | | | reachable as | | | | determined by the | | | | AMF and the UDM | | | | regardless of an | | | | SMSF being | | | | registered. | | | | | | | | This enables the UE | | | | to receive an SMS. | | | | See clauses 4.2.5.2 | | | | and 4.2.5.3 (see | | | | NOTE 8). | | +----------------------+----------------------+----------------------+ | UE memory available | This event is | UDM | | for SMS | detected when the | | | | UDM receives UE | | | | memory available for | | | | SMS indication from | | | | the SMSF as part of | | | | Alert procedure as | | | | specified in | | | | clause 5.1.8 of | | | | TS 23.540 [84] | | +----------------------+----------------------+----------------------+ | Number of registered | It indicates the | NSACF | | UEs or established | current number of | | | PDU Sessions | registered UEs or | | | | established PDU | | | | Sessions for a | | | | network slice that | | | | is subject to NSAC. | | | | | | | | For One-time | | | | Reporting with | | | | Immediate Reporting | | | | Flag set, NSACF | | | | reports the number | | | | of registered UEs or | | | | established PDU | | | | Sessions | | | | immediately. | | +----------------------+----------------------+----------------------+ | Area Of Interest | It indicates change | AMF, GMLC | | | of the UE presence | | | | in the Area Of | | | | Interest. | | +----------------------+----------------------+----------------------+ | Group Member List | It indicates the | UDM | | Change | changes on the | | | | members of the | | | | group. | | | | | | | | This event apply to | | | | a group of UEs | | | | (identified by an | | | | External Group ID), | | | | such as 5G VN group | | | | (see NOTE 9) or | | | | other groups. | | +----------------------+----------------------+----------------------+ | Session inactivity | This event is | SMF | | time | detected by the SMF | | | | when the PDU Session | | | | has no data transfer | | | | for a period | | | | specified by the | | | | Inactivity Timer. | | | | via the User plane | | | | status information | | | | event, see | | | | clause 5.2.8.3.1. | | +----------------------+----------------------+----------------------+ | Traffic volume | This event measures | UPF | | | the traffic volume | | | | (UL and DL) | | | | aggregated for the | | | | PDU Session | | | | (NOTE 10). | | +----------------------+----------------------+----------------------+ | UL/DL data rate | This event measures | UPF | | | the data rate (UL | | | | and DL) aggregated | | | | for the PDU Session | | | | (NOTE 10). | | +----------------------+----------------------+----------------------+ | Application | Detection of | PCF | | Detection | application start or | | | | stop | | | | | | | | (See NOTE 11), as | | | | described in | | | | clause 6.1.3.18 of | | | | TS 23.503 [20]. | | +----------------------+----------------------+----------------------+ | NOTE 1: Location | | | | granularity for | | | | event request, or | | | | event report, or | | | | both could be at | | | | cell level (Cell ID) | | | | or TA level. The | | | | granularity can also | | | | be expressed by | | | | other formats such | | | | as geodetic | | | | uncertainty shapes | | | | (e.g. polygons, | | | | circles, etc.) or | | | | civic addresses | | | | (e.g. streets, | | | | districts, etc.) | | | | which can be mapped | | | | by NEF to AMF | | | | specific granularity | | | | levels. | | | | | | | | NOTE 2: Roaming | | | | status means whether | | | | the UE is in HPLMN | | | | or VPLMN based on | | | | the most recently | | | | received | | | | registration state | | | | in the UDM. | | | | | | | | NOTE 3: CN type of | | | | CN Type change event | | | | is defined in | | | | clause 5.17.5.1 of | | | | TS 23.501 [2]. | | | | | | | | NOTE 4: In the case | | | | of UDM service | | | | operation | | | | information flow, | | | | the UDM should set | | | | the subscribed | | | | periodic | | | | registration timer | | | | to a smaller value | | | | than the value of | | | | Maximum Detection | | | | Time, since the | | | | value of the mobile | | | | reachable timer is | | | | larger than the | | | | value of the | | | | periodic | | | | registration timer. | | | | | | | | NOTE 5: Maximum | | | | Latency, Maximum | | | | Response Time and | | | | Suggested number of | | | | downlink packets are | | | | defined in | | | | clause 4.15.6.3a. | | | | | | | | NOTE 6: The NEF | | | | makes a mapping | | | | between the 5GS | | | | internal event \"PDU | | | | Session Status\" and | | | | the T8 API event | | | | \"PDN Connectivity | | | | Status\". | | | | | | | | NOTE 7: The | | | | preferred method for | | | | provisioning Network | | | | Configuration | | | | Parameters is | | | | External Parameter | | | | Provisioning | | | | specified in | | | | clause 4.15.6.3a. | | | | Provisioning event | | | | specific parameters | | | | as part of | | | | Monitoring Request | | | | is expected to be | | | | used only by the AF | | | | that does not | | | | support Parameter | | | | Provisioning | | | | procedure specified | | | | in clause 4.15.6.3a. | | | | | | | | NOTE 8: The NEF maps | | | | between the T8 API | | | | event \"UE | | | | reachability\" with | | | | reachability type | | | | SMS and the 5GS | | | | internal event \"UE | | | | reachability for SMS | | | | delivery\" for SMS | | | | over NAS. | | | | | | | | The event \"UE | | | | reachability for SMS | | | | delivery\" for SMS | | | | over IP is used by | | | | HSS as described in | | | | clause 5.5.6.3 of | | | | TS 23.632 [68]. | | | | | | | | NOTE 9: 5G VN group | | | | management is | | | | defined in the | | | | clause 5.29.2 of | | | | TS 23.501 [2]. | | | | | | | | NOTE 10: NEF | | | | subscribes to the | | | | UPF event applicable | | | | for a PDU session | | | | via SMF and the | | | | result is exposed to | | | | NEF by UPF directly. | | | | The corresponding | | | | procedure for NEF to | | | | trigger the UPF | | | | event can be found | | | | in | | | | clause 4.15.3.2.3. | | | | | | | | NOTE 11: This event | | | | uses bulk | | | | subscr | | | | iption/notification, | | | | which may impact the | | | | PCF/SMF/UPF | | | | performance. | | | +----------------------+----------------------+----------------------+
#### 4.15.3.2 Information flows
##### 4.15.3.2.1 AMF service operations information flow
The procedure is used by the NF to subscribe to notifications and to
explicitly cancel a previous subscription. Cancelling is done by sending
Namf_EventExposure_UnSubscribe request identifying Subscription Correlation
ID. The notification steps 3 and 4 are not applicable in cancellation case.
Figure 4.15.3.2.1-1: Namf_EventExposure_Subscribe, Unsubscribe and Notify
operations
1\. A NEF sends a request to subscribe to a (set of) Event ID(s) in AMF in
Namf_EventExposure_Subscribe request. The NEF could be the same NF subscribing
to receive the event notification reports (i.e. Event Receiving NF) or it
could be a different NF. The NEF subscribes to one or several Event(s)
(identified by Event ID) and provides the associated notification endpoint of
the Event Receiving NF. If the NEF itself is not the Event Receiving NF, the
NEF shall additionally provide the notification endpoint of itself besides the
notification endpoint of Event Receiving NF. Each notification endpoint is
associated with the related (set of) Event ID(s). This is to assure the NEF
can receive the notification of subscription change related event (e.g.
Subscripiont Correlation ID Change).
Event Reporting information defines the type of reporting requested. If the
reporting event subscription is authorized by the AMF, the AMF records the
association of the event trigger and the requester identity.
2\. AMF acknowledges the execution of Namf_EventExposure_Subscribe.
3\. [Conditional - depending on the Event] The AMF detects the monitored event
occurs and sends the event report by means of Namf_EventExposure_Notify
message, to the notification endpoint of the Event Receiving NF.
4\. [Conditional- depending on the Event] The AMF detects the subscription
change related event occurs, e.g. Subscription Correlation ID change due to
AMF reallocation, it sends the event report by means of
Namf_EventExposure_Notify message to the NEF.
##### 4.15.3.2.2 UDM service operations information flow
The procedure is used by the NEF to subscribe to event notifications, to
modify group-based subscriptions to event notifications, including removal or
addition of certain UEs in a UE group and to explicitly cancel a previous
subscription (see clause 4.15.1). Cancelling is done by sending
Nudm_EventExposure_Unsubscribe request identifying the subscription to cancel.
The notification steps 4 and 5 are not applicable in cancellation case.
Figure 4.15.3.2.2-1: Nudm_EventExposure_Subscribe, Unsubscribe and Notify
operations
1\. The NEF subscribes to one or several monitoring events by sending
Nudm_EventExposure_Subscribe request. The NEF subscribes to one or several
Event(s) (identified by Event ID) and provides the associated notification
endpoint of the NEF.
Event Reporting Information defines the type of reporting requested. If the
reporting event subscription is authorized by the UDM, the UDM records the
association of the event trigger and the requester identity.
The subscription may include Maximum number of reports and/or Maximum duration
of reporting IE and optionally MTC Provider Information.
If subscription to group-based event notifications are removed for certain UEs
in a group of UEs for which there is an event notification subscription, the
NEF provides impacted UE information (e.g. SUPI, MSISDN or External Identity)
and operation indication (cancellation) to UDM via
Nudm_EventExposure_Subscribe without cancelling the entire group-based event
notification subscription. If the Maximum Number of Reports applies to the
event subscription, the NEF sets the stored number of reports of the indicated
UE(s) to Maximum Number of Reports.
If subscription to group-based event notifications are added for certain UEs
in a group of UEs for which there is an event notification subscription, the
NEF provides impacted UE information (e.g. SUPI, MSISDN or External Identity)
and operation indication (addition) to UDM via Nudm_EventExposure_Subscribe.
2a. [Conditional] Some events, require that UDM sends
Namf_EventExposure_Subscribe request to the AMF serving that UE. As the UDM
itself is not the Event Receiving NF, the UDM shall additionally provide the
notification endpoint of itself besides the notification endpoint of NEF. Each
notification endpoint is associated with the related (set of) Event ID(s).
This is to assure the UDM can receive the notification of subscription change
related event.
The UDM sends the Namf_EventExposure_Subscribe request to all serving AMF(s)
(if subscription applies to a UE or a group of UE(s)), or to all the AMF(s) in
the same PLMN as UDM (if subscription applies to any UE). The UDM stores the
subscription even if the target UE or group member UE is not registered at the
time of subscription.
NOTE 1: If the single target UE, or group member UE, registers later on with
an AMF which does not have event subscription or group event subscription(s)
for that UE or UE group, then the UDM creates subscriptions to those event(s)
with the AMF during the Registration procedure as specified in clause
4.2.2.2.2.
If the subscription applies to a group of UE(s), the UDM shall include the
same notification endpoint of itself, i.e. Notification Target Address (+
Notification Correlation Id), in the subscriptions to all UE\'s serving
AMF(s).
NOTE 2: The same notification endpoint of UDM is to help the AMF identify
whether the subscription for the requested group event is same or not when a
new group member UE is registered.
If Nudm_EventExposure_Subscribe with update is received in step 1 indicating
removal of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM provides
impacted UE information (e.g. SUPI, MSISDN) and operation indication
(cancellation) to AMF via Namf_EventExposure_Subscribe without cancelling the
entire group-based event notification subscription, for the event monitored by
AMF.
If Nudm_EventExposure_Subscribe with update is received in step 1 indicating
addition of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM provides
impacted UE information (e.g. SUPI, MSISDN) and operation indication
(addition) to AMF via Namf_EventExposure_Subscribe for the event monitored by
AMF.
2b. [Conditional] AMF acknowledges the execution of
Namf_EventExposure_Subscribe.
3\. UDM acknowledges the execution of Nudm_EventExposure_Subscribe.
If the subscription is applicable to a group of UE(s) and the Maximum number
of reports is included in the Event Report information in step 1, the Number
of UEs (including all group member UEs irrespective of their registration
state) within this group is included in the acknowledgement. If AMF provides
the first event report in step 2b, the UDM includes the event report in the
acknowledgement.
4a - 4b. [Conditional - depending on the Event] The UDM detects the monitored
event occurs and sends the event report, by means of Nudm_EventExposure_Notify
message, to the associated notification endpoint of the NEF, along with the
time stamp. NEF may store the information in the UDR along with the time stamp
using either Nudr_DM_Create or Nudr_DM_Update service operation as
appropriate.
If Nudm_EventExposure_Subscribe with update is received in step 1 indicating
removal of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM shall stop the
event notification for the impacted UEs. If Maximum number of Reports is
applied, the UDM shall set the number of reports of the indicated UE(s) to
Maximum Number of Reports for the events monitored by UDM.
If Nudm_EventExposure_Subscribe with update is received in step 1 indicating
addition of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM shall create
subscription to the event notification for the impacted UEs so as to detect
the monitored event and send the event report for such impacted UEs.
4c - 4d. [Conditional - depending on the Event] The AMF detects the monitored
event occurs and sends the event report, by means of Namf_EventExposure_Notify
message, to the associated notification endpoint of the NEF, along with the
time stamp. NEF may store the information in the UDR along with the time stamp
using either Nudr_DM_Create or Nudr_DM_Update service operation as
appropriate.
If the AMF has a maximum number of reports stored for the UE, the AMF shall
decrease its value by one for the reported event.
If Namf_EventExposure_Subscribe with update is received in step 2a indicating
removal of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the AMF shall stop the
event notifications for the impacted UEs. If Maximum number of Reports is
applied, the AMF shall set the number of reports of the indicated UE(s) to
Maximum Number of Reports.
If Namf_EventExposure_Subscribe with update is received in step 2a indicating
addition of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the AMF shall create
subscription to the event notification for the impacted UEs so as to detect
the monitored event and send the event report for such impacted UEs.
For both step 4a and step 4c, when the maximum number of reports is reached
and if the subscription is applied to a UE, The NEF unsubscribes the
monitoring event(s) to the UDM and the UDM unsubscribes the monitoring
event(s) to AMF serving that UE.
For both step 4a and step 4c, when the maximum number of reports is reached
for an individual group member UE, the NEF uses the Number of UEs received in
step 3 and the Maximum number of reports to determine if reporting for the
group is complete. If the NEF determines that reporting for the group is
complete, the NEF unsubscribes the monitoring event(s) to the UDM and the UDM
unsubscribes the monitoring event(s) to all AMF(s) serving the UEs belonging
to that group.
NOTE 3: If an expiry time as specified in clause 6.2.6.2.6 of TS 29.518 [18]
is not included in the event subscription, then the life time of the event
subscription needs to be controlled by other means as there is no time based
cancellation at all even if any group member UEs fail to register.
When the Maximum duration of reporting expires in the NEF, the UDM and the
AMF, then each of these nodes shall locally unsubscribe the monitoring event.
5\. [Conditional - depending on the Event] The AMF detects the subscription
change related event occurs, e.g. Subscription Correlation ID change due to
AMF reallocation or addition of new Subscription Correlation ID due to a new
group UE registered, it sends the event report by means of
Namf_EventExposure_Notify message to the associated notification endpoint of
the UDM.
##### 4.15.3.2.3 NEF service operations information flow
The procedure is used by the AF to subscribe to event notifications, to modify
group-based subscriptions to event notification and to explicitly cancel a
previous subscription (see clause 4.15.1). Cancelling is done by sending
Nnef_EventExposure_Unsubscribe request identifying the subscription to cancel
with Subscription Correlation ID. The notification steps 6 to 8 are not
applicable in cancellation case.
Figure 4.15.3.2.3-1: Nnef_EventExposure_Subscribe, Unsubscribe and Notify
operations
1\. The AF subscribes to one or several Event(s) (identified by Event ID) and
provides the associated notification endpoint of the AF by sending
Nnef_EventExposure_Subscribe request.
Event Reporting Information defines the type of reporting requested (e.g. one-
time reporting, periodic reporting or event based reporting, for Monitoring
Events). If the reporting event subscription is authorized by the NEF, the NEF
records the association of the event trigger and the requester identity. The
subscription may also include Maximum number of reports and/or Maximum
duration of reporting IE and optionally MTC Provider Information.
If subscription to group-based event notifications are removed or added for
certain UEs in a group of UEs for which there is an event notification
subscription, the AF provides impacted UE information (e.g. SUPI, MSISDN or
External Identity) with operation indication which is either cancellation or
addition to NEF via Nnef_EventExposure_Subscribe without cancelling the entire
group-based event notification subscription.
2\. [Conditional - depending on authorization in step 1] The NEF subscribes to
received Event(s) (identified by Event ID) and provides the associated
notification endpoint of the NEF to UDM by sending
Nudm_EventExposure_Subscribe request. The NEF may either receive DNN, S-NSSAI
from AF in step 1 or maps the AF-Identifier into DNN and S-NSSAI combination
based on local configuration and include DNN, S-NSSAI in the request.
If the reporting event subscription is authorized by the UDM, the UDM records
the association of the event trigger and the requester identity. Otherwise,
the UDM continues in step 4 indicating failure.
If Nnef_EventExposure_Subscribe with update is received in step 1 indicating
removal of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the NEF provides
impacted UE information (e.g. SUPI, MSISDN or External Identity) with
operation indication (cancellation) to UDM via Nudm_EventExposure_Subscribe
without cancelling the entire group-based event notification subscription. If
the Maximum Number of Reports applies to the event subscription, the NEF sets
the stored number of reports of the indicated UE(s) to Maximum Number of
Reports.
If Nnef_EventExposure_Subscribe with update is received in step 1 indicating
addition of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the NEF provides
impacted UE information (e.g. SUPI, MSISDN or External Identity) with
operation indication (addition) to UDM via Nudm_EventExposure_Subscribe.
3a. [Conditional] If the requested event (e.g. monitoring of Loss of
Connectivity) requires AMF assistance, then the UDM sends the
Namf_EventExposure_Subscribe to the AMF serving the requested user. The UDM
sends the Namf_EventExposure_Subscribe request to the all serving AMF(s) (if
subscription applies to a UE or a group of UE(s)), or all the AMF in the same
PLMN as the UDM (if subscription applies to any UE).
NOTE 1: If the UE, which is a member of a group, registers with an AMF which
does not have group event subscription(s) for that group, then the UDM creates
subscriptions to those event(s) with the AMF during the Registration procedure
in clause 4.2.2.2.2.
As the UDM itself is not the Event Receiving NF, the UDM shall additionally
provide the notification endpoint of itself besides the notification endpoint
of NEF. Each notification endpoint is associated with the related (set of)
Event ID(s). This is to assure the UDM can receive the notification of
subscription change related event.
If the subscription applies to a group of UE(s), the UDM shall include the
same notification endpoint of itself, i.e. Notification Target Address (+
Notification Correlation Id), in the subscriptions to all UE\'s serving
AMF(s).
NOTE 2: The same notification endpoint of UDM is to help the AMF identify
whether the subscription for the requested group event is same or not when a
new group member UE is registered.
If Nudm_EventExposure_Subscribe with update is received in step 2 indicating
removal of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM provides
impacted UE information (e.g. SUPI, MSISDN) with operation indication
(cancellation) to AMF via Namf_EventExposure_Subscribe without cancelling the
entire group-based event notification subscription, for the event monitored by
AMF.
If Nudm_EventExposure_Subscribe with update is received in step 2 indicating
addition of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM provides
impacted UE information (e.g. SUPI, MSISDN) with operation indication
(addition) to AMF via Namf_EventExposure_Subscribe for the event monitored by
AMF.
3b. [Conditional] AMF acknowledges the execution of
Namf_EventExposure_Subscribe.
3c. [Conditional] If the requested event (e.g. PDU Session Status) requires
SMF assistance, then the UDM sends the Nsmf_EventExposure_Subscribe Request
message to each SMF where at least one UE identified in step 2 has a PDU
session established. The NEF notification endpoint received in step 2 is
included in the message.
NOTE 3: In the home routed case, the UDM sends the subscription to the V-SMF
via the H-SMF.
3d-e. [Conditional] If the requested event (e.g. UserDataUsageMeasures)
requires UPF assistance, the SMF sends the request to the UPF including the
NEF notification endpoint received in step 3c according to step 4 in Figure
4.15.4.5.2-1.
3f. [Conditional] The SMF acknowledges the execution of
Nsmf_EventExposure_Subscribe.
4\. [Conditional] UDM acknowledges the execution of
Nudm_EventExposure_Subscribe.
If the subscription is applicable to a group of UE(s) and the Maximum number
of reports is included in the Event Report information in step 1, the Number
of UEs (including all group member UEs irrespective of their registration
state) is included in the acknowledgement. If AMF or SMF provides the first
event report in step 3b or step 3d, the UDM includes the event report in the
acknowledgement.
5\. NEF acknowledges the execution of Nnef_EventExposure_Subscribe to the
requester that initiated the request. If the NEF has received the first event
report already in step 4, the NEF includes the event report in the
acknowledgement.
6a - 6b. [Conditional - depending on the Event] The UDM (depending on the
Event) detects the event occurs and sends the event report, by means of
Nudm_EventExposure_Notify message to the associated notification endpoint of
the NEF along with the time stamp. NEF may store the information in the UDR
along with the time stamp using either Nudr_DM_Create or Nudr_DM_Update
service operation as appropriate.
If Nudm_EventExposure_Subscribe with update is received in step 2 indicating
removal of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM shall stop the
event notification for the impacted UEs. If Maximum number of Reports is
applied, the UDM shall set the number of reports of the indicated UE(s) to
Maximum Number of Reports for the events monitored by UDM.
If Nudm_EventExposure_Subscribe with update is received in step 2 indicating
addition of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the UDM shall create
subscription to the event notification for the impacted UEs so as to detect
the monitored event and send the event report for such impacted UEs.
6c - 6d. [Conditional - depending on the Event] The AMF detects the event
occurs and sends the event report, by means of Namf_EventExposure_Notify
message to associated notification endpoint of the NEF along with the time
stamp. NEF may store the information in the UDR along with the time stamp
using either Nudr_DM_Create or Nudr_DM_Update service operation as
appropriate.
If the AMF has a maximum number of reports stored for the UE or the individual
member UE, the AMF shall decrease its value by one for the reported event.
If Namf_EventExposure_Subscribe with update is received in step 3a indicating
removal of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the AMF shall stop the
event notification for the impacted UEs. If Maximum number of Reports is
applied, the AMF shall set the number of reports of the indicated UE(s) to
Maximum Number of Reports.
If Namf_EventExposure_Subscribe with update is received in step 3a indicating
addition of event notification subscription for certain UEs in a group of UEs
for which there is an event notification subscription, the AMF shall create
subscription to the event notification for the impacted UEs so as to detect
the monitored event and send the event report for such impacted UEs.
For both step 6a and step 6c, when the maximum number of reports is reached
and if the subscription is applied to a UE, The NEF unsubscribes the
monitoring event(s) to the UDM and the UDM unsubscribes the monitoring
event(s) to AMF serving for that UE.
For both step 6a and step 6c, when the maximum number of reports is reached
for an individual group member UE, the NEF uses the Number of UEs received in
step 4 and the Maximum number of reports to determine if reporting for the
group is complete. If the NEF determines that reporting for the group is
complete, the NEF unsubscribes the monitoring event(s) to the UDM and the UDM
unsubscribes the monitoring event(s) to all AMF(s) serving the UEs belonging
to that group.
NOTE 4: If an expiry time as specified in clause 6.2.6.2.6 of TS 29.518 [18]
is not included in the event subscription, then the life time of the event
subscription needs to be controlled by other means as there is no time based
cancellation at all even if any group member UEs fail to register.
When the Maximum duration of reporting expires in the NEF, the UDM and the
AMF, then each of these nodes shall locally unsubscribe the monitoring event.
6e - 6f. [Conditional - depending on the Event] When the SMF detects a
subscribed event, the SMF sends the event report, by means of
Nsmf_EventExposure_Notify message, to the associated notification endpoint of
the NEF provided in step 3c. NEF may store the information in the UDR along
with the time stamp using either Nudr_DM_Create or Nudr_DM_Update service
operation as appropriate.
6g - 6h. [Conditional - depending on the Event] When the UPF detects a
subscribed event, the UPF sends the event report, by means of
Nupf_EventExposure_Notify message, to the associated notification endpoint of
the NEF provided by the SMF to UPF as part of step 3c. The NEF may store the
information in the UDR along with the time stamp using either Nudr_DM_Create
or Nudr_DM_Update service operation as appropriate.
7\. [Conditional - depending on the Event in steps 6a-6f] The NEF forwards to
the AF the reporting event received by either Nudm_EventExposure_Notify and/or
Namf_EventExposure_Notify. In the case of the PDU Session Status event, the
NEF maps it to an PDN Connectivity Status notification when reporting to the
AF.
8\. [Conditional - depending on the Event] The AMF detects the subscription
change related event occurs, e.g. Subscription Correlation ID change due to
AMF reallocation or addition of new Subscription Correlation ID due to a new
group UE registered, it sends the event report, by means of
Namf_EventExposure_Notify message to the associated notification endpoint of
the UDM.
##### 4.15.3.2.3a Void
##### 4.15.3.2.3b Specific NEF service operations information flow for loss of
connectivity and UE reachability
The procedure is used by the AF to subscribe to notifications and to
explicitly cancel a previous subscription for loss of connectivity and UE
reachability.
Figure 4.15.3.2.3b-1: Nnef_EventExposure_Subscribe, Unsubscribe and Notify
operations or loss of connectivity and UE reachability
1\. Step 1 to step 3b of Figure 4.15.3.2.3-1 are performed with the following
differences:
\- For Loss of Connectivity, the subscription request may include Maximum
Detection Time (see Table 4.15.3.1-1).
\- For UE reachability, the subscription request may include Maximum Latency,
Maximum Response Time and/or Suggested number of downlink packets (see Table
4.15.3.1-1). In step 3a of Figure 4.15.3.2.3-1, the UDM may include Maximum
Response Time in the subscription request to the AMF.
NOTE 1: It is expected that Maximum Latency, Maximum Response Time and/or
Suggested number of downlink packets included in the subscription request is
only used by the AF that does not support Parameter Provisioning procedure
specified in clause 4.15.6.3a.
\- For UE reachability, the AF may include Idle Status Indication request. If
Idle Status Indication request is included, the NEF includes it in
Nudm_EventExposure_Subscribe message. If the UDM receives Idle Status
Indication request, it includes it in Namf_EventExposure_Subscribe message. If
the NEF does not support the requested Idle Status Indication, then depending
on operator policies, the NEF rejects the request.
2\. [Conditional] If the subscribed periodic registration timer has not been
set according to any subscription request, or a Network Configuration as
defined in clause 4.15.6.3a the UDM shall set the subscribed periodic
registration timer using the Maximum Detection Time or Maximum Latency;
otherwise if the subscribed periodic registration timer was previously set by
a different subscription identified by a different Notification Target Address
(+ Notification Correlation ID), or set by a different Network Configuration
identified by a different NEF reference ID for the same UE and if the newly
received Maximum Detection Time or Maximum Latency is lower than the provided
subscribed periodic registration timer, the UDM shall set the subscribed
periodic registration timer using the newly received Maximum Detection Time or
Maximum Latency.
If Nudm_EventExposure_Unsubscribe request is performed in step 1, the UDM
shall recalculate the subscribed periodic registration timer based on the
remaining event subscriptions and/or Network Configurations.
In addition for UE reachability subscription, if the newly received Maximum
Response Time is longer than the provided subscribed Active Time (i.e.
previously provided Maximum Response Time), the UDM shall set the subscribed
Active Time using the newly received Maximum Response Time. If the suggested
number of downlink packets is newly received, the UDM shall add the newly
received suggested number of downlink packets to the currently used value of
suggested number of downlink packets if the aggregated value is within the
operator defined range.
If Nudm_EventExposure_Unsubscribe request is performed in step 1, the UDM
shall recalculate the subscribed Active Time and/or Suggested Number of
Downlink Packets based on the remaining event subscriptions and/or Network
Configurations.
If the subscribed periodic registration timer or the subscribed Active Time
are set or modified, the UDM sends the Nudm_SDM_Notification request to
related serving AMF(s). If the AMF receives a subscribed periodic registration
timer value from the UDM, it allocates the received value to the UE as the
periodic registration timer at subsequent Registration procedure. The AMF
starts monitoring of the expiration of the mobile reachable timer for Loss of
Connectivity (if required) and starts monitoring of the UE entering connected
mode for UE reachability (if required).
If the suggested number of downlink packets are set or modified, the UDM sends
the Nudm_SDM_Notification request to related serving SMF(s). The SMF
configures the data buffer at the SMF/UPF according the suggested number of
downlink packets.
If the provided value is updated by the UDM, the UDM may notify the NEF (which
then notifies the AF) of the actual value that is being applied in the 3GPP
network.
3\. Step 4 to step 5 of Figure 4.15.3.2.3-1 are performed.
4\. Step 6c to step 6d of Figure 4.15.3.2.3-1 are performed with the following
differences:
\- For Loss of Connectivity, the event is detected when the mobile
reachability timer expires or when the UE has provided Unavailability Period
Duration during the Registration procedure without including Start of
Unavailability Period or when unavailability period starts based on Start of
Unavailability Period stored in UE context at AMF or Deregistration procedure
as described in clause 5.4.1.4 of TS 23.501 [2].
\- For UE reachability, the event is detected when the UE changes to connected
mode or when the UE will become reachable for paging.
\- For UE reachability, if Idle Status Indication request was included in step
1 and the AMF supports Idle Status Indication, the AMF includes also the Idle
Status Indication.
5\. Step 8 of Figure 4.15.3.2.3-1 is performed.
##### 4.15.3.2.3c Specific NEF service operations information flow for group
member list change
The procedure is used by the AF to subscribe to notifications and to
explicitly cancel a previous subscription for group member list change.
Step 1, step 2, step 4, step 5, step 6a and step 7 of Figure 4.15.3.2.3-1 are
performed with the differences that the Event ID is set with \"Group Member
List Change\". When a NF consumer subscribes to the group member list change
event, if the request indicates immediate reporting, the group member list is
provided in the Nudm/Nnef_EeventEExposure_Subscribe response,
When the UDM detects the group member list change event occurs, it sends the
event report including the identities of the UE(s) added/removed to/from the
group to the NEF by means of Nudm_EventExposure_Notify message and NEF
forwards the information to the AF by means of Nnef_EventExposure_Notify
message.
##### 4.15.3.2.4 Exposure with bulk subscription
Based on operator configuration NEF may perform bulk subscription with the NFs
that provides necessary services. This feature is controlled by local policies
of the NEF that control which events (set of Event ID(s)) and UE(s) are target
of a bulk subscription.
When the NEF performs bulk subscription (subscribes for any UE (i.e. all UEs),
group of UE(s) (e.g. identifying a certain type of UEs such as IoT UEs)), it
subscribes to all the NFs that provide the necessary services (e.g. In a given
PLMN, NEF may subscribe to all AMFs that support reachability notification for
IoT UEs). Upon receiving bulk subscription from the NEF, the NFs store this
information. Whenever the corresponding event(s) occur for the requested UE(s)
as in bulk subscription request, NFs notify the NEF with the requested
information.
The following call flow shows how network exposure can happen for one UE,
groups of UE(s) (e.g. identifying a certain type of UEs such as IoT UEs) or
any UE.
Figure 4.15.3.2.4-1: NF registration/status notification and Exposure with
bulk subscription
1\. NEF registers with the NRF for any newly registered NF along with its NF
services.
2\. When an NF instantiates, it registers itself along with the supported NF
services with the NRF.
3\. NRF acknowledges the registration
4\. NRF notifies the NEF with the newly registered NF along with the supported
NF services.
5\. NEF evaluates the NF and NF services supported against the pre-configured
events within NEF. Based on that, NEF subscribes with the corresponding NF
either for a single UE, group of UE(s) (e.g. identifying a certain type of UEs
such as IoT UEs), any UE. NF acknowledges the subscription with the NEF.
6 - 7. When the event trigger happens, NF notifies the requested information
towards the subscribing NEF along with the time stamp. NEF may store the
information in the UDR along with the time stamp using either Nudr_DM_Create
or Nudr_DM_Update service operation as appropriate.
8\. Application registers with the NEF for a certain event identified by event
filters. If the registration for the event is authorized by the NEF, the NEF
records the association of the event and the requester identity.
9 - 10. When the event trigger happens, NF notifies the requested information
towards the subscribing NEF. NEF may store the information in the UDR using
either Nudr_DM_Create or Nudr_DM_Update service operation as appropriate.
11a-b. NEF reads from UDR with Nudr_DM_Query and notifies the application
along with the time stamp for the corresponding subscribed events.
##### 4.15.3.2.5 Information flow for downlink data delivery status with SMF
buffering
The procedure is used if the SMF requests the UPF to forward downlink data
packets that are subject of extended buffering in the SMF. The procedure
describes a mechanism for the Application Function to subscribe downlink data
delivery status notifications. The downlink data delivery status notifications
relates to high latency communication, see also clauses 4.24.2 and 4.2.3.3.
Cancelling the subscription is done by sending Nnef_EventExposure_Unsubscribe
request identifying the subscription to cancel with Subscription Correlation
ID in the same order as indicated in figure 4.15.3.2.5-1 for the corresponding
subscribe requests. Step 0 and the notification steps 7 to 9 are not
applicable in cancellation case.
Figure 4.15.3.2.5-1: Information flow for downlink data delivery status with
SMF buffering
0\. The SMF (in the non-roaming case the SMF, in the roaming case the V-SMF,
in the case of PDU session with I-SMF the I-SMF) configures the relevant UPF
to forward downlink data packets towards the SMF as described in clause 5.8.3
in 23.501 [2]. The SMF decides to apply this behaviour based on the \"expected
UE behaviour\". Alternatively, step 0 is triggered by step 3,
1\. The AF sends Nnef_EventExposure_Subscribe Request to NEF requesting
notification for event \"Downlink data delivery status\" with traffic
descriptor (e.g. the source of the downlink IP or Ethernet traffic) for a UE
or group of UEs. If the reporting event subscription is authorized by the NEF,
the NEF records the association of the event trigger and the requester
identity. The Downlink data delivery status events include:
\- First downlink Packet in extended buffering event:
\- This event is triggered when the first new downlink data packet is buffered
with extended buffering matching the traffic descriptor.
\- in notifications about this Downlink data delivery status, the SMF provides
the Extended Buffering time as determined in clause 4.2.3.3.
\- First downlink Packet discarded:
\- This event occurs when the first packet matching the traffic descriptor is
discarded because the Extended Buffering time, as determined by the SMF,
expires or the amount of downlink data to be buffered is exceeded.
\- First Downlink Packet transmitted:
\- This event occurs when the first packet matching the traffic descriptor is
transmitted after previous buffering or discarding of corresponding packet(s)
because the UE of the PDU Session becomes ACTIVE and buffered data can be
delivered to UE according to clause 4.2.3.3.
2\. The NEF sends the Nudm_EventExposure_Subscribe Request to UDM. Identifier
of the UE or group of UEs, the traffic descriptor, monitoring event received
from AF in step 1 and notification endpoint of the NEF are included in the
message. If the reporting event subscription is authorized by the UDM, the UDM
records the association of the event trigger and the requester identity.
Otherwise, the UDM continues in step 5 indicating failure.
3\. The UDM sends the Nsmf_EventExposure_Subscribe Request message to each SMF
where at least one UE identified in step 2 has a PDU session established. If
the UDM is able to derive the applicable DNN and S-NSSAI from the traffic
descriptor via configured information, the UDM may send
Nsmf_EventExposure_Subscribe Request messages only to SMFs with PDU sessions
with that DNN and S-NSSAI for such UEs and includes the Identifier of the UE
or Internal-Group-Id, traffic descriptor, monitoring event and the
notification endpoint of NEF received in step 2 are included in the message.
If the UDM becomes aware that such a UE has a PDU session established with the
DNN and S-NSSAI corresponding to the traffic descriptor at a later time than
when receiving step 2, the UDM then executes step 3.
In the case of home-routed PDU session or PDU session with I-SMF, the UDM
sends the Nsmf_EventExposure_Subscribe Request message to each H-SMF or SMF
and the H-SMF or SMF further sends Nsmf_EventExposure_Subscribe Request
message to each related V-SMF or I-SMF. Steps 7-8 are performed by V-SMF or
I-SMF.
4\. The SMF sends the Nsmf_EventExposure_Subscribe Response message to the
UDM.
5\. The UDM send sends the Nsmf_EventExposure_Subscribe response message to
the NEF.
6\. The NEF sends the Nsmf_EventExposure_Subscribe response to the AF.
7\. The SMF detects a change in Downlink Data Delivery Status event as
described in clause 4.2.3. The SMF becomes aware that Downlink Packet(s)
require extended buffering via a Namf_Communication_N1N2MessageTransfer
service operation with the AMF. If the SMF decides to discard packets, the
\"Downlink Packet(s) discarded event\" is detected. The SMF detects that
previously buffered packets can be transmitted by the fact that the related
PDU session becomes ACTIVE.
8\. The SMF sends the Nsmf_EventExposure_Notify with Downlink Delivery Status
event message to NEF.
9\. The NEF sends Nnef_EventExposure_Notify with Downlink Delivery Status
event message to AF.
##### 4.15.3.2.6 GMLC service operations information flow
The procedure is used by the NF to subscribe to notifications and to
explicitly cancel a previous subscription. The GMLC service operations
information flow is defined in clause 6.1.2 and clause 6.3 of TS 23.273 [51].
##### 4.15.3.2.7 Information flow for Availability after DDN Failure with SMF
buffering
The procedure is used if the SMF requests the UPF to forward packets that are
subject of buffering in the SMF. The procedure describes a mechanism for the
Application Function to subscribe to notifications about availability after
downlink data notification failure. The Availability after Downlink Data
Notification failure event is related to high latency communication, see also
clauses 4.24.2 and 4.2.3.3.
Cancelling the subscription is done by sending EventExposure_Unsubscribe
requests identifying the subscription to cancel with the Subscription
Correlation ID in the same order as indicated in figure 4.15.3.2.7-1 for the
corresponding subscribe requests (the AMF unsubscribes the DDN Failure status
notification by sending the Nsmf_PDUSession_UpdateSMContext Request message to
each SMF in step 5). Step 0 and the notification steps 9 to 13 are not
applicable in the cancellation case.
Figure 4.15.3.2.7-1: Information flow for availability after DDN Failure with
SMF buffering
0\. The SMF (in the no-roaming case the H-SMF. in the roaming case the V-SMF,
in the case of PDU session with I-SMF the I-SMF) configures the relevant UPF
to forward packets to the SMF as described in clause 5.8.3 in 23.501 [2]. The
SMF decides to apply this behaviour based on the \"expected UE behaviour\".
Alternatively, step 0 is triggered by step 5.
1\. The AF sends Nnef_EventExposure_Subscribe Request to the NEF requesting
notifications for \"Availability after DDN Failure\" for a UE or group of UEs
and providing a traffic descriptor identifying the source of the downlink IP
or Ethernet traffic. If the reporting event subscription is authorized by the
NEF, the NEF records the association of the event trigger and the requester
identity.
The AF may include Idle Status Indication request in the
Nnef_EventExposure_Subscribe Request. If Idle Status Indication request is
included, the NEF includes it in Nudm_EventExposure_Subscribe message. If the
NEF does not support the requested Idle Status Indication, then depending on
operator policies, the NEF rejects the request.
2\. The NEF sends the Nudm_EventExposure_Subscribe Request to UDM. Identifier
of the UE or group of UEs, the traffic descriptor, monitoring event received
from AF at step 1 and notification endpoint of the NEF are included in the
message. If the reporting event subscription is authorized by the UDM, the UDM
records the association of the event trigger and the requester identity.
Otherwise, the UDM continues in step 7 indicating failure.
If the UDM receives Idle Status Indication request, it includes it in
Namf_EventExposure_Subscribe message.
3\. The UDM sends Namf_EventExposure_Subscribe messages to the AMF(s) which
serve the UE(s) identified in step2 to subscribe to \"Availability after DDN
Failure\". The UDM includes the DNN and S-NSSAI as well as the Traffic
Descriptor if available A separate subscription is used for each UE. The NEF
notification endpoint received in step 2 is included in the message. If the
UDM becomes aware that such a UE is registered at a later time than when
receiving step 2, the UDM then executes step 3.
4\. The AMF acknowledges the execution of Namf_EventExposure_Subscribe.
5\. If PDU Session exists for the DNN and S-NSSAI, the AMF subscribes to DDN
Failure status notification by sending the Nsmf_PDUSession_UpdateSMContext
Request message to each SMF, requesting the SMF to notify DDN Failure. The AMF
also includes in Nsmf_PDUSession_UpdateSMContext the Traffic Descriptor and
NEF correlation ID if received from the UDM. For new PDU Session establishment
towards a DNN and S-NSSAI, the AMF subscribes to DDN Failure status
notification in Nsmf_PDUSession_CreateSMContext Request message if the UDM has
subscribed to Availability after DDN Failure event.
In the case of home-routed PDU session or PDU session with I-SMF, the AMF
sends Nsmf_PDUSession_UpdateSMContext Request message(s) to the related
V-SMF(s) or I SMF(s). Steps 9-10 are performed by those V-SMF(s) or I-SMF(s).
6\. The (I/V-)SMF sends the Nsmf_PDUSession_UpdateSMContext response message
to the AMF.
NOTE: Step 7 can happen any time after step 4.
7\. The UDM sends the Nudm_EventExposure_Subscribe response to the NEF.
8\. The NEF sends the Nsmf_EventExposure_Subscribe response to the AF.
9-10. The SMF is informed that the UE is unreachable via a
Namf_Communication_N1N2MessageTransfer service operation. The SMF then decides
to discard downlink packets received from the UPF. By comparing those
discarded downlink packets received from the UPF with the Traffic
Descriptor(s) received in the event subscription(s), the SMF determines
whether DDN Failure due to any traffic from an AF is to be notified to the AMF
and if so, the SMF sends the DDN Failure status, by means of
Nsmf_PDUSession_SMContextStatusNotify message including NEF Correlation ID, to
the AMF. If the UE is not reachable after the AMF received the DDN Failure
notification from the SMF, the AMF shall set a Notify-on-available-after-DDN-
failure flag corresponding to the NEF Correlation ID.
11-12. [Conditional] The AMF detects the UE is reachable and sends the event
report(s) based on the Notify-on-available-after-DDN-failure flag, by means of
Namf_EventExposure_Notify message(s), only to the NEF(s) indicated as
notification endpoint(s) identified via the corresponding subscription in step
3. In this way, only the AF(s) for which DL traffic transmission failed are
notified.
If the AMF received Idle Status Indication request in step 3 and the AMF
supports Idle Status Indication, the AMF includes also the Idle Status
Indication.
13\. The NEF sends Nnef_EventExposure_Notify message with the \"Availability
after DDN Failure\" event to AF.
##### 4.15.3.2.8 Information flow for downlink data delivery status with UPF
buffering
The procedure is used if the SMF requests the UPF to buffer packets. The
procedure describes a mechanism for the Application Function to subscribe to
notifications about downlink data delivery status. The downlink data delivery
status notifications relates to high latency communication, see also clauses
4.24.2 and 4.2.3.3.
Cancelling is done by sending Nnef_EventExposure_Unsubscribe request
identifying the subscription to cancel with Subscription Correlation ID. Steps
2 to 5 are not applicable in the cancellation case.
Figure 4.15.3.2.8-1: Information flow for downlink data delivery status with
UPF buffering
1\. AF interacts with NEF to subscribe DDD status event in SMF as described in
steps 0-6 of clause 4.15.3.2.5.
In the case of subscription cancelling and SMF having interacted with the PCF
during event subscription, the SMF reports to the PCF the unsubscribe of the
DDD status event. The PCF updates or removes the PCC rule and this triggers
the SMF to update or remove the corresponding PDR in the UPF. In case of home-
routed PDU Session, the SMF unsubscribes the DDD status event from the V-SMF
which in turn updates the N4 information (deactivating the notifications) in
the V-UPF. In case of PDU Session with I-SMF, the SMF provides updated N4
information (deactivating the notifications) to the I-SMF which in turn
updates the I-UPF.
2\. If the UPF is configured to apply extended buffering, step 2 is executed
immediately after step 1. Otherwise, step 2 is executed when the SMF is
informed that the UE is unreachable via a
Namf_Communication_N1N2MessageTransfer service operation as described in
clause 4.2.3 and the SMF then also updates the PDR(s) for flows requiring
extended buffering to requests the UPF to buffer downlink packets. If the DDD
status event with traffic descriptor has been received in the SMF in step 1,
if extended DL Data buffering in the UPF applies, the SMF checks whether an
installed PDR for the Traffic Descriptor exists and if so, requests the UPF to
provide the requested type(s) of notifications. If PCC is not used and there
is no installed PDR with the exact same traffic descriptor, the SMF copies the
installed PDR that would have previously matched the incoming traffic
described by the traffic descriptor, but provides that traffic descriptor, a
higher priority and the requested type(s) of notifications. If PCC is used and
if the \"DDD Status event subscription with Traffic Descriptor\" PCRT is set
as defined in clause 6.1.3.5 of TS 23.503 [20], the SMF interacts with the PCF
and forwards the traffic descriptor before contacting the UPF; the PCF then
updates an existing PCC rule or provides a new PCC rule taking into
consideration the traffic descriptor for the subscribed DDD status event.
NOTE: If a new PCC rule is provided by the PCF for the DDD status event
detection, the PCF populates the PCC rules as defined in clause 6.1.3.5 of TS
23.503 [20].
In the case of home-routed PDU Session, the V-SMF generates the N4 information
(activating the notifications) for the V-UPF based on local configuration.
In the case of PDU Session with I-SMF, the SMF provides N4 information
(activating the notifications) to the I-SMF based on local policy or the \"DDD
Status event subscription with Traffic Descriptor\" PCRT from PCF. The I-SMF
updates the I-UPF with this N4 information.
For home-routed PDU Session or PDU Session with I-SMF, steps 3-4 below are
performed by V-SMF/V-UPF or I-SMF/I-UPF.
3\. The UPF reports when there is buffered or discarded traffic matching the
received PDR to the SMF. The SMF detects that previously buffered packets can
be transmitted by the fact that the related PDU session becomes ACTIVE.
4\. The SMF sends the Nsmf_EventExposure_Notify with Downlink Delivery Status
event message to NEF.
5\. The NEF sends Nnef_EventExposure_Notify with Downlink Delivery Status
event message to AF.
##### 4.15.3.2.9 Information flow for Availability after DDN Failure with UPF
buffering
The procedure is used if the SMF requests the UPF to buffer packets. The
procedure describes a mechanism for the Application Function to subscribe to
notifications about availability after DDN failure.
Cancelling is done by sending Nnef_EventExposure_Unsubscribe request
identifying the subscription to cancel with Subscription Correlation ID. Steps
2 to 7 are not applicable in the cancellation case.
Figure 4.15.3.2.9-1: Information flow for availability after DDN Failure event
with UPF buffering
1\. AF interacts with NEF to subscribe availability after DDN failure event in
AMF/SMF as described in steps 0-8 of clause 4.15.3.2.7.
In case of subscription cancelling from AMF and SMF having interacted with the
PCF during event subscription, the SMF reports to the PCF for the unsubscribe
of DDN failure event. The PCF updates or removes the PCC rule and this
triggers the SMF to update or remove the corresponding PDR and FAR in the UPF.
In the case of PDU Session with I-SMF or home-routed PDU Session, the AMF
unsubscribes the DDN failure event towards I/V-SMF. In case of home-routed PDU
Session, the V-SMF updates the N4 information (deactivating the notifications)
in the V-UPF. In case of PDU Session with I-SMF, the I-SMF may request N4
information (deactivating the notifications) from the SMF and provides the
Traffic Descriptor to the SMF. The SMF provides updated N4 information
(deactivating the notifications) to the I-SMF which in turn updates the Iâ€‘UPF.
2\. The SMF checks whether an installed PDR for the Traffic Descriptor exists
and if so, requests the UPF to report when the first downlink packet is
received and when it is discarded in the UPF. If PCC is not used and there is
no installed PDR with the exact same traffic descriptor, the SMF copies the
installed PDR that would have previously matched the incoming traffic
described by the traffic descriptor, but provides that traffic descriptor, a
higher priority and requests the UPF to report when the first downlink packet
is received and when it is discarded in the UPF.
If PCC is used and if the \"DDN Failure event subscription with Traffic
Descriptor\" PCRT is set as defined in clause 6.1.3.5 of TS 23.503 [20], the
SMF interacts with the PCF and forwards the traffic descriptor before
contacting the UPF; the PCF then updates an existing PCC rule or provides a
new PCC rule taking into consideration the traffic descriptor for the
subscribed DDN failure event.
NOTE 1: If a new PCC rule is provided by the PCF for the DDN failure event
detection, the PCF populates the PCC rules as defined in clause 6.1.3.5 of TS
23.503 [20].
In the case of PDU Session with I-SMF or home-routed PDU Session, the AMF
subscribes the DDN failure event towards the I/V-SMF. In the case of home-
routed PDU Session, the V-SMF generates the N4 information (activating the
notifications) for the V-UPF based on local configuration.
In the case of PDU Session with I-SMF, the I-SMF may request N4 information
(activating the notifications) from the SMF based on local configuration and
provides the Traffic Descriptor to the SMF. The SMF provides updated N4
information (activating the notifications) to the I-SMF which in turn updates
the I-UPF.
For home-routed PDU Session or PDU Session with I-SMF, steps 3-4 below are
performed by V-SMF/V-UPF or I-SMF/I-UPF.
3-4. When the first downlink packet matching the traffic descriptor is
received in the UPF, if in step 2 the SMF indicated drop notification to the
UPF, the UPF notifies the SMF and the SMF reports the DDN Failure status with
NEF Correlation ID, by means of Nsmf_PDUSession_SMContextStatusNotify message,
to the AMF indicated as notification endpoint.
When the first downlink packet matching the traffic descriptor is received in
the UPF, if in step 2 the SMF indicated buffer notification to the UPF, the
UPF notifies the SMF and the SMF may initiate Network Triggered Service
Request as specified in clause 4.2.3.3. If the AMF responds
Namf_Communication_N1N2MessageTransfer response with failure (e.g. due to UE
not reachable, or paging no response), in addition to what is specified in
clause 4.2.3.3, the SMF reports DDN Failure status with NEF Correlation ID, by
means of Nsmf_PDUSession_SMContextStatusNotify message, to the AMF indicated
as notification endpoint.
When the AMF receives DDN Failure status from the SMF, the AMF shall set a
Notify-on-available-after-DDN-failure flag corresponding to the Notification
Correlation Id and the identifier of the UE if available.
5-6. [Conditional] The AMF detects the UE is reachable and sends the event
report(s) based on the Notify-on-available-after-DDN-failure flag, by means of
Namf_EventExposure_Notify message(s), only to the NEF(s) indicated as
notification endpoint(s) identified via the corresponding subscription in step
1. In this way, only the AF(s) for which DL traffic transmission failed are
notified.
If the AMF received Idle Status Indication request in step 1 and the AMF
supports Idle Status Indication, the AMF includes also the Idle Status
Indication in Namf_EventExposure_Notify message.
7\. The NEF sends Nnef_EventExposure_Notify message with the \"Availability
after DDN Failure\" event to AF.
##### 4.15.3.2.10 Number of UEs and PDU Sessions per network slice
notification procedure
##### 4.15.3.2.10.1 Reported value(s) aggregated at NEF {#reported-values-
aggregated-at-nef .H6}
This procedure depicts the case of an AF subscribing to receive the registered
number of UEs, or the number of PDU sessions in a specific S-NSSAI. The
procedure handles the case when there is a single NSACF in the PLMN
responsible for the S-NSSAI (single Service Area) or when there are multiple
NSACFs responsible for the S-NSSAI in the PLMN (multiple Service Areas).
Figure 4.15.3.2.10.1-1: Reported value(s) aggregated at NEF per network slice
notification procedure
1\. To subscribe or unsubscribe for the number of UEs or the number of PDU
Sessions per network slice notification with the NEF, the AF sends
Nnef_EventExposure Subscribe/Unsubscribe Request (Event ID, Event Filter,
Event Reporting information, S-NSSAI) message to the NEF. The Event ID
parameter defines the subscribed event ID, i.e. Number of Registered UEs or
Number of Established PDU Sessions. The Event Filter parameter defines the
S-NSSAI, in case of a trusted AF or AF-Service-Identifier as defined in TS
29.522 [87] for an untrusted AF, for which reporting is required. The Event
Reporting information parameter defines the mode of reporting, which includes
threshold reporting with a threshold value or periodic reporting with included
periodicity time interval. The S-NSSAI is the slice for which the subscription
is requested
The AF may request one-time reporting or immediate reporting.
NOTE 1: When immediate reporting but not for one-time reporting is requested,
the subscription is maintained after returning the report to the AF. When one-
time reporting is requested, the subscription is terminated right after
returning the report to the AF.
Notifications related to the threshold based subscriptions behave as follows:
\- A single notification is sent only when the number of registered UEs or the
number of established PDU Sessions reaches the threshold. A single
notification is sent every time there is a change from being below the
threshold to reach the threshold.
\- A single notification is sent only once when the number of registered UEs
or the number of established PDU Sessions go below the threshold after
reaching it. A single notification is sent every time there is a change from
reaching the threshold to coming down below the threshold.
2\. The NEF confirms with Nnef_EventExposure_Subscribe/Unsubscribe Response
message to the AF. This message may include the event reporting, if available
in the NEF and immediate reporting or one-time reporting was requested by the
AF. In the case of Untrusted AF, the NEF includes the AF-Service-Identifier
corresponding to the S-NSSAI in the returned notification.
If immediate reporting or one-time reporting is requested, step 2 occurs after
step 5 and the subscription response contains the immediate or one-time
report. For the case of one-time reporting, no subscription is created at the
NEF/NSACF.
3\. The NEF may query the NRF to find the NSACF(s) responsible for the
requested S-NSSAI. If needed, the NEF translates the AF-Service-Identifier to
the corresponding S-NSSAI prior to performing the query.
4\. If the NEF has not already subscribed to the event from the NSACF for the
requested S-NSSAI, the NEF initiates the request
Nnsacf_SliceEventExposure_Subscribe/Unsubscribe Request (Event ID, Event
Filter, Event Reporting information, immediate reporting, S-NSSAI) to all the
NSACFs supporting the requested S-NSSAI. The NEF stores the AF requested Event
Reporting Information. If multiple NSACFs are selected for the requested
S-NSSAI, the NEF may set the Event Reporting Information to periodic in its
request to the NSACFs. If single NSACF is selected, the NEF sets the Event
Reporting Information identical to the received request from the AF. The NEF
also sets the Event ID and Event Filter identical to the received request from
the AF
NOTE 2: The period chosen is selected by the NEF based on its internal logic.
5\. The NSACF(s) confirms with Nnsacf_SliceEventExposure_Subscribe/Unsubscribe
Response message to the NEF. This message may include the event reporting if
available at NSACF and immediate reporting or one-time reporting was requested
by the NEF.
6\. When the reporting condition for a subscribed event is fulfilled, the
NSACF triggers a notification towards the NEF.
7\. The NSACF sends the Nnsacf_SliceEvent Exposure_Notify (Event ID, Event
Reporting information) message to the NEF. If the subscription is for event
based notification (e.g. based on the monitored event reaching a threshold
value), the Event Reporting information parameter contains confirmation for
the event fulfilment. If the subscription is for periodic notification or for
immediate reporting, the Event Reporting information parameter provides
information for the current number of UEs registered with a network slice
(e.g. represented in percentage of the maximum number of the UEs registered
with the network slice) or information for the current number of PDU Sessions
on a network slice (e.g. represented in percentage of the maximum number of
the UEs established on the network slice).
8\. When a single NSACF is returned from the discovery procedure, the NEF
sends the Nnef_EventExposure_Notify (Event ID, Event Reporting information)
message since the reporting condition is fulfilled. In the case of Untrusted
AF, the NEF includes the AF-Service-Identifier corresponding to the S-NSSAI in
the returned notification.
9\. When multiple NSACFs are selected for the requested NSSAI the NEF performs
the aggregation from reporting NSACF(s) and maintain the overall usage of the
S-NSSAI for the selected NSACFs as long as the subscription is active.
NOTE 3: If multiple NSACFs are selected for the requested S-NSSAI, the NEF
continuously updates the aggregated information to be able to fulfil the
incoming subscription request from the AF.
10\. When multiple NSACFs are selected for the requested S-NSSAI and when the
reporting condition for a subscribed event by the AF is fulfilled, the NEF
sends Nnef_EventExposure_Notify (Event ID, Event Reporting information)
message towards the AF. In case of untrusted AF; the NEF includes the AF-
Service-Identifier corresponding to the S-NSSAI in the returned notification.
If the hierarchical NSAC architecture is deployed in the PLMN for the NSAC of
an S-NSSAI and the number of UEs, number of UE with at least one PDU
session/PDN connection, or number of PDU Sessions are aggregated at NEF, the
same procedure as above can be reused. In this case Primary NSACF behaves as a
normal NSACF.
##### 4.15.3.2.10.2 Reported value(s) aggregated at Primary NSACF {#reported-
values-aggregated-at-primary-nsacf .H6}
If the hierarchical NSAC architecture is deployed in the PLMN for the NSAC of
an S-NSSAI, the Primary NSACF needs to be aware of the current status of
registered UEs, UE with at least one PDU session/PDN connection, or
established PDU sessions at all NSACFs with whom it is interacting, so it can
dynamically adapt and adjust the local Maximum number of UEs, local Maximum
number of UE with at least one PDU session/PDN connection, or PDU sessions
configured at the NSACFs. In this case, it is possible to leverage this
capability and provide subscribing AFs to receive the registered number of
UEs, number of UE with at least one PDU session/PDN connection, or the number
of PDU sessions for the requested S-NSSAI without NEF aggregation. Such a
procedure is depicted below.
Figure 4.15.3.2.10.2-1: Reported value(s) aggregated at Primary NSACF per
network slice notification procedure
1\. The AF subscribes (or unsubscribe) to the number of UEs, or the number of
PDU Sessions per network slice notification to the NEF. The NEF finds the
primary NSACF responsible for the requested S-NSSAI. Based on the network
configuration, the NEF does not to do the aggregation. The procedure is same
as steps 1-5 of clause 4.15.3.2.10.1 with the following differences:
\- Based on the network configuration the NEF is aware that one NSACF can
serve entire PLMN for the requested S-NSSAI, i.e. existence of the Primary
NSACF. The NEF queries the NRF to find the corresponding primary NSACF
responsible for the requested S-NSSAI. Besides the requested S-NSSAI, the
Serving Area information of \"Entire PLMN\" is included as querying parameter.
In the case of Trusted AF, the AF can discover and subscribe (or unsubscribe)
directly with the Primary NSACF.
\- The NEF sets the Event Reporting Information identical to the received
request from the AF. The NEF also sets the Event ID and Event Filter identical
to the received request from the AF. The Primary NSACF responsible for the
requested S-NSSAI performs the aggregation per network configuration.
2-6. The Primary NSACF subscribes (or unsubscribes) to the number of UEs, or
the number of PDU Sessions per network slice notification to all the NSACFs
supporting the requested S-NSSAI(s). The procedure is same as steps 4-7 of
clause 4.15.3.2.10.1 for multiple NSACFs case with the Primary NSACF replacing
the NEF and the following differences:
\- Step 2, based on the received event subscription from NEF, the Primary
NSACF triggers the slice event subscription to NSACF(s) if it does not exist
before.
\- Step 6, the Primary NSACF performs the aggregated values from reporting
NSACF(s) including itself (if available) and maintain the overall usage of the
S-NSSAI(s) for the indicated Event ID parameter, i.e. the number of UEs
registered with a network slice, number of UE with at least one PDU
session/PDN connection, or the number of PDU Sessions established on a network
slice, from the selected NSACFs as long as the subscription is active. When
the reporting condition for a subscribed event is fulfilled, the Primary NSACF
triggers a notification for the event towards the NEF. As values from the
NSACF(s) has been aggregated at the Primary NSACF, there is no aggregation to
be performed further at the NEF. NEF forwards the received values to AF.
NOTE: For the number of registered UEs per network slice or number of UE with
at least one PDU session/PDN connection, the aggregated value includes both
the number of registered UE at NSACF(s) and the number of registered UE at
Primary NASCF as described in the clause 5.15.11.1.2 of TS 23.501 [2]. For the
number of established PDU sessions per network slice, the aggregated value
only includes the number of established PDU Sessions at the NSACF(s).
##### 4.15.3.2.11 Network-initiated explicit event notification subscription
cancel procedure
The procedure is used by the UDM to delete an event notification subscription
(see clause 4.15.1).
Figure 4.15.3.2.11-1: Network-initiated event subscription removal procedure
0\. An event notification subscription procedure according to clause
4.15.3.2.2 or clause 4.15.3.2.2 has already executed successfully.
1-1a. If UE subscription is withdrawn in UDM, UE authorisation to the
subscribed monitoring event or UE is removed from the subscribed target group,
the UDM triggers Nudm_EventExposure_Notify towards the associated notification
endpoint indicating the removal of the event notification along with the time
stamp. The NEF may store the information in the UDR along with the time stamp
using either Nudr_DM_Create or Nudr_DM_Update service operation as
appropriate.
In order to remove certain UEs in a group of UEs for which there is an event
notification subscription, the UDM provides impacted UE information (e.g.
SUPI, MSISDN or External Identity) to the NEF and indicates the removal of the
event notification subscription for these UE(s).
2a-2b. If UE subscription information changes (e.g. UE group information
changes), the UDM sends Nudm_SDM_Notification request to related serving
AMF(s) to update event notification subscription information. If the UE was a
group member of a previous accepted group-based event notification
subscription, the AMF shall stop the event notifications for the impacted UEs.
If Maximum number of Reports is applied, the AMF shall set the number of
reports of the indicated UE(s) to Maximum Number of Reports.
If UE subscription data is withdrawn, the UDM sends
Nudm_UECM_DeregistrationNotification request to related serving AMF(s) to
remove UE subscription information. If the UE was a group member of a previous
accepted group-based event notification subscription, the AMF shall keep the
accepted group-based event notification subscription unless all UEs
subscriptions in the group are withdrawn.
3\. The NEF sends Nnef_EventExposure_Nofity to the AF reporting event received
by Nudm_EventExposure_Notify.
If the NEF receives UE Identifier(s) in step 1 for a group-based event
notification subscription and the Maximum Number of Reports applies to the
group-based event notification subscription, the NEF sets the number of
reports of the indicated UE(s) to Maximum Number of Reports. The NEF sends
Nnef_EventExposure_Notify to the AF and includes MSISDN(s) or External
Identifier(s). If NEF determines that the reporting for the group is complete
based on the update above, the NEF deletes the associated event notification
subscription and requests that the UDM deletes the related event notification
subscription for the group.
##### 4.15.3.2.12 Void
##### 4.15.3.2.13 Handling AF requests when the UE is identified via UE
addressing information
An AF may request, via the NEF, the Event Exposure (as defined in clause
4.15.3) or the parameter provisioning (as defined in clause 4.15.6) targeting
an individual UE, identifying the target UE by providing UE addressing
information.
In this case the 5GC first needs to retrieve a UE Identifier based on:
\- the UE addressing information as provided by the AF: this may correspond to
an UE IP address as allocated by 5GC or to a MAC address of the UE (when
Ethernet PDU Sessions are targeted),
\- the corresponding DNN and/or S-NSSAI: this may have been provided by the AF
or, alternatively, determined by the NEF using the identity of the AF.
The NEF retrieves the UE Identifier by executing step 2 to 6 of the AF
specific UE Identifier retrieval procedure described in clause 4.15.10.
Once this is done, the 5GC may carry out the action requested by the AF and
may deliver back to the AF an External Identifier representing an AF specific
UE Identifier (as defined in TS 23.501 [2]). This AF specific UE Identifier
may later be used by the AF to issue further requests about the same UE.
NOTE: The AF can use UE addressing information to identify the UE in a
subscription request, but once received, this UE addressing information is
translated into a GPSI and then the 5GC considers the subscription is
associated with the GPSI and not with the UE address any more.
The AF may have its own means to maintain the AF specific UE Identifier
through, e.g. an AF session. After the retrieval of an AF specific UE
Identifier the AF shall not keep maintaining a mapping between the returned AF
specific UE Identifier and the UE IP address as this mapping may change.
#### 4.15.3.3 Void
### 4.15.4 Core Network Internal Event Exposure
#### 4.15.4.1 General
The exposure of events internally within the 5GC NFs is explained in the
following clauses. Only the event notifications that are independent of the
ongoing system procedure are specified in this clause. For the event
notifications that are part of the system procedure, see the system procedure
descriptions under clause 4.2 to clause 4.14.
#### 4.15.4.2 Exposure of Mobility Events from AMF
The AMF invokes the Namf_EventExposure_Notify to provide mobility related
events to NF consumers that have subscribed for the events by invoking
Namf_EventExposure_Subscribe, in the following scenarios listed below and
after Namf_EventExposure_Subscribe service operation.
\- During Registration procedure, Inter NG-RAN node N2 based handover
procedure, when there is a change of AMF (within the same AMF Set or across
the AMF Set), the new AMF receives all event subscriptions from old AMF or
UDSF. For each event subscription:
if the event subscription only applies to the UE, the new AMF allocates a new
Subscription Correlation ID and notify the NF consumer of the new Subscription
Correlation ID associated with the change of Subscription Correlation ID
event.
if the event subscription applies to a group of UE(s) and there is no
corresponding subscription for this group (identified by the internal group Id
and notification endpoint) at the new AMF, the new AMF shall create
corresponding event subscription, allocate a new Subscription Correlation Id
and send it to the received notification endpoint, i.e. Notification Target
Address (+Notification Correlation Id), associated with the addition of
Subscription Correlation ID event. The new AMF does not need to allocate
another Subscription Correlation ID for any subsequent registrations of the
members of the same group. The initial Maximum number of reports and the
remaining number of reports within the Maximum number of reports quota for the
UE is transferred from the old AMF.
NOTE: For group monitoring, even if the remaining number of reports is zero,
indicating that reporting for the group event has been completed by the old
AMF for this UE, the new AMF uses the received information related to initial
event subscription to create the corresponding group event subscription.
\- During Registration procedure, when there is a change of AMF, the new AMF
notifies each NF that has subscribed for UE reachability event about the UE
reachability status.
\- During Registration, Handover, UE Triggered Service Request procedure in
CM-IDLE state, Location Reporting, N2 Notification and AN Release procedures,
the AMF determines the UE presence in Area Of Interest (i.e. IN, OUT or
UNKNOWN status ) as described in Annex D.1 and notifies the NF Consumers of
the UE presence in an Area Of Interest if the NF consumers (e.g. SMF) had
subscribed for this Area Of Interest and if the UE presence in Area Of
Interest is different from the one reported earlier.
\- During Registration and Handover procedure or during Service Area
Restriction update by UDM or PCF, if the UE is moving from an Allowed Area to
a Non-Allowed Area, then the AMF informs all the NF consumers (e.g. SMF), that
have subscribed for UE reachability event, that the UE is reachable only for
regulatory prioritized service. The SMF shall explicitly subscribe UE
reachability unless the established PDU Session is related to regulatory
prioritized service.
\- If the AMF had notified an SMF of the UE being reachable only for
regulatory prioritized service earlier, the AMF informs the NF consumers (e.g.
SMF), that have subscribed for UE reachability event, that the UE is reachable
if the UE enters into Allowed Area.
\- During Registration procedure and Service Request procedure, if the AMF had
notified an SMF earlier of the UE being unreachable and that SMF need not
invoke Namf_Communication_N1N2MessageTransfer to the AMF due to DL data
notifications, the AMF informs the SMF when the UE becomes reachable.
\- During Registration procedure and Service Request procedure, if the AMF had
notified an SMF earlier that the UE is unreachable together with an Estimated
Maximum Wait time, then the AMF informs the SMF when the UE becomes reachable.
When the SMF learns that the UE is reachable and:
\- if the SMF performs Extended Buffering for a PDU session, the SMF sends the
buffered data to the UPF and invokes the
Namf_Communication_N1N2MessageTransfer service operation to the AMF to
establish the User Plane(s) for the PDU Sessions, or the buffered data is
delivered to the UE as per the procedure in clause 4.24.2 starting from step
2g for a PDU session using Control Plane CIoT 5GS Optimisation;
\- if the UPF performs Extended Buffering for a PDU session, the SMF invokes
the Namf_Communication_N1N2MessageTransfer service operation to the AMF to
establish the User Plane(s) for the PDU Sessions, or the buffered data is
delivered to the UE as per the procedure in clause 4.24.2 starting from step
8a for a PDU session using Control Plane CIoT 5GS Optimisation.
\- If NEF had subscribed for UE reachability event notification for Extend
Buffering, then the AMF informs the NEF when the UE becomes reachable. When
the NEF learns that the UE is reachable, it invokes the Nsmf_NIDD_Delivery
service operation of the corresponding SMF to deliver the buffered data to the
UE as per the procedure in clause 4.25.5 starting from step 2 for a PDU
session using Control Plane CIoT 5GS Optimisation.
\- During Registration procedure, Handover without Registration procedure and
Service Request procedure, if the NF consumers had subscribed for UE
reachability status, the AMF notifies the UE reachability status changes.
\- If the Mobile Reachable Timer expires the AMF notifies the NF consumers
that have subscribed for the corresponding events that the UE is not
reachable.
\- If the UDM had subscribed for UE reachability event notification either to
be reported to the UDM or to an NF consumer directly, then the AMF notifies
the UE reachability event to the UDM or to the NF consumer as specified in
clause 4.2.5.2.
\- If UE\'s TAC is already known by the AMF, then, the AMF notifies UE TAC to
the NF consumers (e.g. to NWDAF). If UE TAC is unknown, then the AMF notifies
the UE TAC when it obtained the UE TAC from the UE.
During Connection, Registration and Mobility Management procedures, the AMF
may store and update the UE access behaviour trends specified in Table
4.15.4.2-1 and the UE location trends specified in Table 4.15.4.2-2. Each
metrics is updated incrementally, e.g. using exponential moving average. This
information is exposed to consumer NFs (e.g. NWDAF) that subscribe for the
event ID \"UE access behaviour trends\" and/or \"UE location trends\",
respectively, by invoking Namf_EventExposure_Subscribe.
Table 4.15.4.2-1: UE access behaviour trends exposed by AMF
+---------------------------+-----------------------------------------+ | Information | Description | +===========================+=========================================+ | UE Identity | SUPI | +---------------------------+-----------------------------------------+ | List of state transitions | | +---------------------------+-----------------------------------------+ | > State transition type | State transition identifier: | | | | | | - \"Access Type change to 3GPP | | | access\", | | | | | | - \"Access Type change to non-3GPP | | | access\", | | | | | | - \"RM state change to | | | RM-DEREGISTERED\", | | | | | | - \"RM state change to RM-REGISTERED | | | \", | | | | | | - \"CM state change to CM-IDLE\", | | | | | | - \"CM state change to CM-CONNECTED\", | | | | | | - \"Handover\", or | | | | | | - \"Mobility Registration Update\". | +---------------------------+-----------------------------------------+ | > Spacing | Average and variance of the time | | | interval separating two consecutive | | | occurrences of the state transition. | +---------------------------+-----------------------------------------+ | > Duration | Average and variance of duration in the | | | resulting state. | +---------------------------+-----------------------------------------+
Table 4.15.4.2-2: UE location trends
Information Description
* * *
UE Identity SUPI List of location information (1..N)  
> UE Location TAI, Cell-ID (if available), non-3GPP access identity. > Spacing
> Average and variance of the time interval separating two consecutive
> arrivals at this location. > Duration Average and variance of duration of
> stay in the location. > Timestamp Timestamp of last arrival in the location.
> NOTE: The maximum size of the list (N) is defined per configuration and only
> the N entries with the highest average value of \"Duration\" are kept in the
> list. The list is ordered by descending order of \"Duration\".
#### 4.15.4.3 Exposure of Communication trends from SMF
During Session Management procedures, the SMF may store and update the UE
access behaviour trends specified in Table 4.15.4.3-1 and the UE communication
trends specified in Table 4.15.4.3-2. Each metrics is updated incrementally,
e.g. using exponential moving average. This information is exposed to consumer
NFs (e.g. NWDAF) that subscribe for the event ID \"UE session behaviour
trends\" and/or \"UE communication trends\", respectively, by invoking
Nsmf_EventExposure_Subscribe.
Table 4.15.4.3-1: UE session behaviour trends exposed by SMF
+---------------------------+-----------------------------------------+ | Information | Description | +===========================+=========================================+ | UE Identity | SUPI | +---------------------------+-----------------------------------------+ | List of state transitions | | +---------------------------+-----------------------------------------+ | > State transition type | State transition identifier: | | | | | | - \"PDU Session Establishment\", | | | | | | - \"PDU Session Release\", | | | | | | - \"Communication failure\", or | | | | | | - \"PLMN change\". | +---------------------------+-----------------------------------------+ | > Spacing | Average and variance of the time | | | interval separating two consecutive | | | occurrences of the state transition. | +---------------------------+-----------------------------------------+
Table 4.15.4.3-2: UE communication trends
Information Description
* * *
UE Identity SUPI List of communication information (1..N)  
> Communication characteristics S-NSSAI and DNN > Spacing Average and variance
> of the time interval separating two consecutive PDU Session Establishment
> procedures corresponding to the communication characteristics. > Duration
> Average and variance of duration of PDU Sessions corresponding to the
> communication characteristics. > Timestamp Timestamp of the last PDU Session
> Establishment procedure corresponding to the communication characteristics.
> NOTE: The maximum size of the list (N) is defined per configuration and only
> the N entries with the highest average value of \"Duration\" are kept in the
> list. The list is ordered by descending order of \"Duration\".
#### 4.15.4.4 Internal Event Exposure Subscription/Unsubscription via UDM
This clause describes an indirect method of event exposure subscription in AMF
and SMF via UDM for a UE or group of UEs. This can be used after the removal
of UE context in the AMF including event exposure subscriptions, or the
creation of new UE context in AMF or SMF. In this case, the UDM is responsible
for (re)creating event exposure subscriptions in AMF and SMF.
Figure 4.15.4.4-1: Internal Event exposure subscription/unsubscription in AMF
or SMF via UDM
1\. A consumer of event exposure for events detected in AMF or SMF (e.g.
NWDAF) sends an Nudm_EventExposure Subscribe/Unsubscribe request to the UDM
for a UE or group of UEs, including the subscription details (Event ID, Event
filters, etc.).
2\. UDM examines the event type and subscription details to determine whether
one or more events are to be detected by the AMF. In this case, for those
applicable events that are detected by the AMF, if an AMF is registered in UDM
for the UE (or for a UE that is member of the group of UEs), UDM creates an
Namf_EventExposure Subscribe/Unsubscribe request and sends it to the AMF of
the UE, including the subscription details.
3\. AMF answers with an Namf_EventExposure Subscribe/Unsubscribe response.
4\. UDM examines the event type and subscription details to determine whether
one or more events are to be detected by the SMF. In this case, for those
applicable events that are detected by the SMF, if one or more SMFs are
registered in UDM for the UE (or for a UE that is member of the group of UEs),
UDM creates an Nsmf_EventExposure Subscribe/Unsubscribe request and sends it
to each applicable SMF of the UE, including the subscription details.
5\. SMF answers with an Nsmf_EventExposure Subscribe/Unsubscribe response.
6\. UDM sends an Nudm_EventExposure Subscribe/Unsubscribe response to the
consumer of event exposure.
#### 4.15.4.5 Exposure of Events from UPF for UPF Data Collection
##### 4.15.4.5.1 General
This clause contains the detailed description and the procedures for how the
UPF event exposure service (see clause 5.2.26.2) is used for UPF data
collection.
The list of NF consumer which may receive UPF event notifications is defined
in clause 5.8.2 of TS 23.501 [2].
To get exposure data from UPF, NF consumer may subscribe to the UPF directly
or indirectly via SMF. This is further defined in clause 5.8.2 of TS 23.501
[2].
The UPF event exposure events are described in clause 5.2.26.2. In this
Release of the specification, the following events are used for UPF Data
collection:
\- **QoS Monitoring.** This event provides QoS Flow performance information.
\- **UserDataUsageMeasures.** This event provides information of user data
usage of the User PDU Session.
\- **UserDataUsageTrends.** This event provides statistics related to user
data usage of the User PDU Session.
A consumer of UPF event exposure can subscribe to QoS monitoring event via SMF
only and UPF sends the QoS Flow Performance information directly to this
consumer. For this event, the interaction between SMF and UPF is over PFCP (TS
29.244 [69]). TS 23.501 [2] describes the QoS parameters that can be measured
by means of QoS monitoring and how to enable the measurements for QoS flows.
When the Subscription request for QoS monitoring event indicates that it is
for the QoS Flow associated to the default QoS rule, based on local
configuration the subscription request may trigger SMF to enable QoS
monitoring.
NOTE 1: Packets from multiple applications may share the QoS Flow associated
with the default QoS Rule which may diminish the relevance of some
measurements like data rate.
The subscription to QoS monitoring event can target the QoS flows bound to an
application by including an application identifier. In this case, SMF
identifies the active PCC Rule that includes that Application identifier. SMF
enables this consumer (e.g. NWDAF) to receive the QoS Monitoring reports
enabled by that PCC Rule. If the identified PCC Rule has no QoS Monitoring
policy or if no PCC rule is identified, SMF rejects the subscription request
for that Application Identifier.
NOTE 2: Extensive usage of QoS Monitoring has significant impact on load and
signalling.
A consumer of UPF event exposure such as NWDAF can subscribe to User Data
Usage events directly to UPF or via SMF and UPF sends the event notifications
directly to this consumer. For this event, the interaction between SMF and UPF
is over SBI. For User Data Usage events, the subscription request may target
specific service data flows (e.g. a specific application traffic) by including
a traffic description (e.g. an Application Id). Else, the scope of the
subscription is all the traffic in the PDU Session. The subscription request
may indicate the granularity requested, that is whether the measurement
reports should be provided per service data flow, application, or the whole
PDU Session.
If the event notification can be delayed, i.e. delay tolerant, Reporting
suggestion information is included. The Reporting suggestion information
includes Report urgency and Reporting time information. Reporting urgency
information indicates whether this event report can be delay tolerant, i.e.
the event report can be delayed. If the Reporting urgency information
indicates \"delay tolerant\", the Reporting time is also provided, which
defines the last valid reporting time and UPF shall report the detected event
before the last valid time.
Table 4.15.4.5.1-1: Input parameters in subscription to UPF event Exposure
events
+------------------------------------------------+--------+----------+ | Information | To SMF | To UPF | | | | | | | | (NOTE 4) | +================================================+========+==========+ | UE ID | Y | Y | +------------------------------------------------+--------+----------+ | GroupID | Y | N | +------------------------------------------------+--------+----------+ | AnyUE | Y | Y | +------------------------------------------------+--------+----------+ | DNN | Y | Y | +------------------------------------------------+--------+----------+ | S-NSSAI | Y | Y | +------------------------------------------------+--------+----------+ | AOI | Y | N | +------------------------------------------------+--------+----------+ | BSSID/SSID | Y | N | +------------------------------------------------+--------+----------+ | DNAI (NOTE 3) | Y | N | +------------------------------------------------+--------+----------+ | UPFId (NOTE 3) | Y | N | +------------------------------------------------+--------+----------+ | Type of Measurement | Y | Y | +------------------------------------------------+--------+----------+ | Granularity of Measurement (NOTE 2) | Y | Y | +------------------------------------------------+--------+----------+ | Application ID (NOTE 1) | Y | Y | +------------------------------------------------+--------+----------+ | Traffic Filtering (NOTE 1), (NOTE 2) | Y | Y | +------------------------------------------------+--------+----------+ | Reporting suggestion information | Y | Y | +------------------------------------------------+--------+----------+ | NOTE 1: Application ID and Traffic Filtering | | | | are exclusive. | | | | | | | | NOTE 2: This parameter does not apply to QoS | | | | monitoring event. | | | | | | | | NOTE 3: This parameter is used to indicate a | | | | UP Path as defined in Table 6.4.1-1 of | | | | TS 23.288 [50]. | | | | | | | | NOTE 4: This column is not applicable to | | | | events where SMF-UPF interactions are using | | | | PFCP (e.g. QoS Monitoring event). That | | | | interaction is described in clause 5.8.5 of | | | | TS 23.501 [2]. | | | +------------------------------------------------+--------+----------+
##### 4.15.4.5.2 Information flow for subscription to UPF event exposure
service for certain UE(s) via SMF
Figure 4.15.4.5.2-1: Subscription to UPF event exposure service for certain
UE(s) via SMF
In the case of a group of UEs, the UPF event consumer (e.g. NWDAF) first
issues an Nnrf_NFDiscovery_Request service operation to find the UDM providing
the target Group ID and gets the NF profile of the UDM serves this group.
Then, NWDAF obtains the list of SUPIs that correspond to the Group ID from UDM
using Nudm_SDM_Get
NOTE 1: It is assumed that all members of a Group ID belong to the same UDM.
Then, for each SUPI:
1\. The UPF event consumer (e.g. NWDAF) invokes Nudm_UECM_Get service
operation to retrieve the appropriate SMF by providing UE ID, DNN, S-NSSAI and
NF type = SMF.
2\. The UDM provides a Nudm_UECM_Get response with the corresponding SMF.
3\. The UPF event consumer sends the Nsmf_EventExposure Subscription request
to the SMF to subscribe to UPF data, including the following information:
\- Notification Target Address (UPF event consumer address), Notification
Correlation Information.
\- Indication of UPF Event Exposure Service and Target subscription UPF Event
Id.
\- Event Filter Information: S-NSSAI, DNN, DNAI,UPF Id, Traffic Description
for the target traffic (e.g. Application Id), Area of Interest, SSID/BSSID.
\- Target of Event Reporting: a UE.
\- Reporting suggestion information.
\- Target Subscription information: Type of Measurement and granularity of the
information requested.
If the consumer is NWDAF and the analytic filter information includes
application server IP address/FQDN, the NWDAF may need to first obtain the
DNAI from NEF as described in steps 2 and 3 in Figure 4.15.4.5.3-1.
4\. The SMF selects the PDU session(s) and the UPFs it has to send the request
to. The SMF sends the request to the UPF including the UPF event consumer
address, Notification Correlation Information, Event Filter Information,
Reporting suggestion information, Target of Event Reporting and Target
Subscription Information as required. Target of Event Reporting is a certain
UE. The interaction mechanism used between SMF and UPF depends on UPF exposure
event and which mechanism applies for each event as described in clause
5.2.26.2.1. For some events, the SMF shall contact UPF (4a) with N4 Session
Modification with PFCP (TS 29.244 [69]), for other events (4b) with Nupf_event
exposure subscribe request (as defined in clause 5.2.26.2.3).
NOTE 2: Some events can require SMF interacts with RAN at this stage.
5\. Per Reporting suggestion information (if available), the UPF sends the
locally collected UPF data by invoking Nupf_EventExposure_Notify service
operation to the UPF event consumer.
##### 4.15.4.5.3 Information flow for UPF event exposure service for any UE
Figure 4.15.4.5.3-1: UPF Information Exposure to the UPF event consumer (e.g.
NWDAF) of any UE scenario
1\. (in the case of NWDAF) The analytics consumer sends a request to the NWDAF
for analytics on any UE. The consumer provides the any UE in the Target of
Analytics Reporting. Analytics Filter Information optionally contains DNN,
S-NSSAI, Area of Interest, Application server IP address/FQDN, APP ID, DNAI,
etc.
2\. (Optional and only when the UPF event consumer is NWDAF) If in the
analytic filter information does not contain DNN/S-NSSAI, but only includes
application server IP address/FQDN, the NWDAF should firstly obtain the DNAI
from NEF. The NWDAF invokes Nnef_DNAIMapping_Subscribe service to request the
DNAI information. The request includes EAS IP/IP range and/or FQDN.
3\. (if step 2 took place) The NEF determines the suitable DNAI(s) and answers
to NWDAF.
4\. The UPF event consumer triggers the SMFs/UPFs discovery to NRF by
Nnrf_NFDiscovery_Request providing the DNN, S-NSSAI, DNAI etc. This procedure
is to discover the related SMFs/UPFs associated with any UE and support the
indicated DNAI. SMF or UPF(s) are discovered depending on whether the
subscription request to UPF events meets the criteria for direct subscription
to UPF as defined in clause 5.8.2 of TS 23.501 [2]).
5\. The NRF provides Nnrf_NFDiscovery_Response that may refer to several
SMFs/UPFs.
6\. (Option 1) If the subscribed UPF events needs the SMFs to do a third-party
subscription onto UPF (as defined in clause 5.8.2 of TS 23.501 [2]), the same
procedure as Indirect subscription via several SMFs (steps 3 - 5 in Figure
4.15.4.6.2-1(for single UE)) takes place via each discovered SMF.
7\. (Option 2) If the subscribed UPF events allows to directly subscribe to
UPF (as defined in clause 5.8.2 of TS 23.501 [2]), the UPF event consumer
(e.g. NWDAF) triggers the Nupf_EventExposure_Subscribe to all discovered UPFs.
The information included in the subscription is the same as step 3 in Figure
4.15.4.5.3-1.
8\. Each of the UPFs invokes Nupf_EventExposure_Notify service operation
directly to the UPF event consumer (e.g. NWDAF).
##### 4.15.4.5.4 Information flow for subscription via SMF to UPF event
exposure service related with AOI
Figure 4.15.4.5.4-1: Subscription to UPF event exposure service for AOI via
SMF
If the subscription is related to AOI, the UPF event consumer (e.g. NWDAF)
firstly get the UE list in the AOI from AMF, then subscribe to UPF via SMF as
described in clause 4.15.4.5.2. If the UPF event consumer (e.g. NWDAF) needs
to subscribe to UPF related to both AOI and certain UE(s), the UPF event
consumer (e.g. NWDAF) locally decide the final UE list.
1\. The UPF event consumer (e.g. NWDAF) determines the AMF(s) based on the
AOI, i.e. TAIs and possibly on the target S-NSSAI and obtains the UE list in
the AoI from AMF(s) by invoking Namf_EventExposure_Subscribe service operation
to get the presence of UE(s) and moving in or out status in Area of Interest
as described in clause 5.2.2.3 and in clause 5.3.4.4 of TS 23.501 [2]. The
target of Namf_EventExposure_Subscribe depends on whether the UPF event
consumer (e.g. NWDAF) targets one UE a group of UE or Any UE.
2\. The UPF event consumer (e.g. NWDAF) locally computes the final UE list by
comparing the UE list from AMF(s) and its own target UE list).
3\. For each UE in the final UE list, the UPF event consumer (e.g. NWDAF)
issues a subscription to UPF event exposure service via SMF
(Nsmf_EventExposure Subscription) to get UPF data as described in clause
4.15.4.5.2. When an AMF reports a change of the list of UE(s) in the AoI
(Namf_EventExposure_Notify), the UPF event consumer (e.g. NWDAF) may need to
cancel the Nsmf_EventExposure Subscription or to issue a new
Nsmf_EventExposure Subscription.
### 4.15.5 Void
### 4.15.6 External Parameter Provisioning
#### 4.15.6.1 General
Provisioning capability allows an external party to provision the information,
such as expected UE behaviour and service specific parameters or the 5G VN
group information to 5G network functions. In the case of provisioning the
expected UE behavioural information, the expected UE behavioural information
consists of information on expected UE movement and communication
characteristics. In the case of provisioning the 5G VN group information the
provisioning information consists of information on 5G VN group. The service
specific information consists of information to support the specific service
in 5G system. Provisioned data can be used by the other NFs.
#### 4.15.6.2 NEF service operations information flow
Figure 4.15.6.2-1: Nnef_ParameterProvision_Create /
Nnef_ParameterProvision_Update / Nnef_ParameterProvision_Delete
request/response operations
0\. NF subscribes to UDM notifications of UE and/or Group Subscription data
updates. In the UDM subscription, the NF may request to be notified about
expected UE behaviour parameter(s) in Table 4.15.6.3-1 or Application-Specific
Expected UE Behaviour parameter(s) in Table 4.15.6.3f-1 that may have been
externally provisioned by an AF.
NOTE 1: The NF can subscribe to Group Subscription data from UDM in this step
and be notified of Group Subscription data updates in step 7 using the Shared
Data feature defined in TS 29.503 [52].
NOTE 2: The external parameters in Table 4.15.6.3-1 may be provisioned by an
AF hosting an AI/ML based application.
If an expected UE behaviour parameter subscription is provided by the NF, the
subscription may include a threshold indicating that certain confidence and/or
accuracy levels must be met for the parameter(s) to be notified by the UDM to
the NF. Meeting the threshold condition may mean that the confidence and/or
accuracy levels of a parameter are equal to certain threshold, or less than
certain threshold, or greater than certain threshold, or less than or equal to
certain threshold, or greater than or equal to certain threshold. The
threshold may be in the form of a range (e.g. minimum value to maximum value,
where each may be inclusive or exclusive) or a specific value.
NOTE 3: The threshold may be used to e.g. prevent certain Expected UE
Behaviour parameters from being stored in the network when certain minimum
level of confidence and/or accuracy are not met.
NOTE 4: Confidence level indicates a probability assertion for the associated
Expected UE Behaviour parameter and accuracy level indicates the performance
of the estimator (e.g. AI/ML model) used for the prediction.
0b. [Conditional, on using NWDAF-assisted values] The AF may subscribe to
NWDAF via NEF in order to learn the UE mobility analytics and/or UE
Communication analytics for a UE or group of UEs by applying the procedure
specified in clause 6.1.1.2 of TS 23.288 [50]. The Analytics ID is set to any
of the values specified in clause 6.7.1 of TS 23.288 [50].
0c. [Conditional, on using NWDAF-assisted values] AF validates the received
data and derives any of the Expected UE behaviour parameters defined in clause
4.15.6.3 for a UE or group of UEs.
1\. The AF provides one or more parameter(s) to be created or updated, or
deleted in a Nnef_ParameterProvision_Create or Nnef_ParameterProvision_Update
or Nnef_ParameterProvision_Delete Request to the NEF. The parameters(s) may
include corresponding confidence and/or accuracy levels.
The AF provides target UE identifier (e.g. GPSI or External Group ID) as
described in clause 5.2.6.4. The Transaction Reference ID identifies the
transaction request between NEF and AF. For the case of
Nnef_ParameterProvision_Create, The NEF assigns a Transaction Reference ID to
the Nnef_ParameterProvision_Create request.
NEF checks whether the requestor is allowed to perform the requested service
operation by checking requestor\'s identifier (i.e. AF Identifier).
NOTE 5: When multiple AF parameter provisioning Create or Update requests with
different values of the same Expected UE Behaviour parameters are received
from different AFs, the network behaviour is unspecified.
For a Create request associated with a 5G VN group, the External Group ID
identifies the 5G VN Group.
The payload of the Nnef_ParameterProvision_Update Request includes one or more
of the following parameters:
\- Expected UE Behaviour parameters (see clause 4.15.6.3); or
\- Network Configuration parameters (see clause 4.15.6.3a); or
\- 5G VN group data (i.e. 5G VN configuration parameters) (see clause
4.15.6.3b), or
\- 5G VN group membership management parameters (see clause 4.15.6.3c); or
\- Location Privacy Indication parameters of the \"LCS privacy\" Data Subset
of the Subscription Data (see clause 5.2.3.3.1 and clause 7.1 of TS 23.273
[51]); or
\- MTC Provider Information; or
\- AF provided ECS Address Configuration Information (see clause 4.15.6.3d);
or
\- DNN and S-NSSAI specific Group Parameters (see clause 4.15.6.3e); or
\- Application-Specific Expected UE Behaviour parameters (see clause
4.15.6.3f).
The AF may request to delete 5G VN configuration by sending
Nnef_ParameterProvision_Delete to the NEF.
2\. If the AF is authorised by the NEF to provision the parameters, the NEF
requests to create, update and store, or delete the provisioned parameters as
part of the subscriber data via Nudm_ParameterProvision_Create,
Nudm_ParameterProvision_Update or Nudm_ParameterProvision_Delete Request
message, the message includes the provisioned data and NEF reference ID and
optionally MTC Provider Information.
If the AF is not authorised to provision the parameters, then the NEF
continues in step 6 indicating the reason to failure in
Nnef_ParameterProvision_Create/Update/Delete Response message. Step 7 does not
apply in this case.
If the NEF did not receive DNN and/or S-NSSAI from the AF and such information
is configured as needed within 5GC, the NEF determines the DNN and/or S-NSSAI
from the AF Identifier.
If the AF provides the DNN and S-NSSAI specific Group Parameters, the AF shall
indicate the External Group ID, targeted DNN and S-NSSAI in the request.
If the AF provides the service area in the form of geographical information,
the NEF maps the geographical information to the list of TAs.
NOTE 6: For non-roaming case and no authorisation or validation by the UDM
required and if the request is not associated with a 5G VN group, the NEF can
directly forward the external parameter to the UDR via Nudr_DM_Update Request
message. And in this case, the UDR responds to NEF via Nudr_DM_Update Response
message.
3\. UDM may read from UDR, by means of Nudr_DM_Query, corresponding
subscription information in order to validate required data updates and
authorize these changes for this subscriber or Group for the corresponding AF.
Based on local configuration, UDM may determine if there is any requirement in
terms of threshold conditions that need to be met by the provisioned parameter
before storing the parameter in UDR. If there are no such requirement(s) or
the requirement(s) are satisfied, UDM may proceed seamlessly. If not
satisfied, step 5 is triggered as a failed procedure and a related cause value
is provided, e.g. \"confidence level not sufficient\". In that case step 4 is
skipped.
4\. If the AF is authorised by the UDM to provision the parameters for this
subscriber, the UDM resolves the GPSI to SUPI and requests to create, update
or delete the provisioned parameters as part of the subscriber data via
Nudr_DM_Create/Update/Delete Request message, the message includes the
provisioned data.
If a new 5G VN group is created, the UDM shall assign a unique Internal Group
ID for the 5G VN group and include the newly assigned Internal Group ID in the
Nudr_DM_Create Request message. If the list of 5G VN group members is changed
or if 5G VN group data has changed, the UDM updates the UE and/or Group
subscription data according to the AF/NEF request.
When the service area is configured or updated for a group, the UDM authorises
the request.
If the Default QoS is configured or updated for a group, the UDM authorises
the request and uses such Default QoS to set 5GS Subscribed QoS profile in
Session Management Subscription data for each UE within the group. The 5GS
Subscribed QoS profile in Session Management Subscription data will be
considered by SMF as described in clause 5.7.2.7 of TS 23.501 [2].
UDR stores the provisioned data as part of the UE and/or Group subscription
data and responds with Nudr_DM_Create/Update/Delete Response message.
If the Maximum Group Data Rate is configured or updated for a 5G VN group, the
UDM authorises the request and the Maximum Group Data Rate is applied as
described in clause 5.29.2 of TS 23.501 [2].
When the 5G VN group data (as described in clause 4.15.6.3b) or 5G VN group
membership is updated, the UDR notifies to the subscribed PCF by sending
Nudr_DM_Notify as defined in clause 4.16.12.2.
If the AF is not authorised to provision the parameters, then the UDM
continues in step 5 indicating the reason to failure in
Nudm_ParameterProvision_Update Response message and step 7 is not executed.
The UDM classifies the received parameters (i.e. Expected UE Behaviour
parameters or Suggested Number of Downlink Packets or the 5G VN configuration
parameters or DNN and S-NSSAI specific Group Parameters or Location Privacy
Indication parameters or ECS Address Configuration Information), into AMF
associated and SMF associated parameters. The UDM may use the AF Identifier
received from the NEF in step 2 to relate the received parameter with a
particular subscribed DNN and/or S-NSSAI. The UDM stores the SMF-Associated
parameters under corresponding Session Management Subscription data type.
Each parameter or parameter set may be associated with a validity time. The
validity time is stored at the UDM/UDR and in each of the NFs, to which
parameters are provisioned (e.g. in AMF or SMF). Upon expiration of the
validity time, each node deletes the parameters autonomously without explicit
signalling.
If the ECS Address Configuration Information is provided to any UE in AF
request, the UDM shall make use of the shared data mechanism defined in TS
29.503 [52] and notify all NFs (SMFs) that have subscribed to receiving such
shared data change notifications.
5\. UDM responds the request with Nudm_ParameterProvision_Create/Update/Delete
Response. If the procedure failed, the cause value indicates the reason.
6\. NEF responds the request with Nnef_ParameterProvision_Create/Update/Delete
Response. If the procedure failed, the cause value indicates the reason.
7\. [Conditional this step occurs only after successful step 4] UDM notifies
the subscribed Network Function of the updated UE and/or Group subscription
data via Nudm_SDM_Notification Notify message.
a) If the subscribed NF is AMF, the UDM performs Nudm_SDM_Notification (SUPI
or Internal Group Identifier, AMF-Associated Expected UE Behaviour parameters,
Subscribed Periodic Registration Timer, subscribed Active Time, 5G VN group
data or DNN and S-NSSAI specific Group Parameters, etc.) service operation. If
the AMF receives confidence and/or accuracy levels along the Expected UE
behaviour parameter(s), the AMF may use the associated confidence level and/or
accuracy level when handling the expected UE behaviour parameter(s). The AMF
uses the received parameters to derive the appropriate UE configuration of the
NAS parameters and to derive Core Network assisted RAN parameters. The AMF may
determine a Registration area based on parameters Stationary indication or
Expected UE Moving Trajectory.
If the AMF obtains service area for a group the AMF configures the DNN for the
group as LADN DNN and applies the LADN per DNN and S-NSSAI taking into account
the service area for the group as described in clause 5.20b.2 of TS 23.501
[2].
b) If the subscribed NF is SMF, the UDM performs Nudm_SDM_Notification (SUPI
or Internal Group Identifier, SMF-Associated Expected UE Behaviour parameter
set, DNN/S-NSSAI, Suggested Number of Downlink Packets, 5G VN group data,
etc.) service operation.
The SMF stores the received parameters and associates them with a PDU Session
based on the DNN and S-NSSAI included in the message from UDM.
If the SMF receives confidence and/or accuracy levels along the Expected UE
behaviour parameter(s), the SMF may use the associated confidence level and/or
accuracy level when handling the expected UE behaviour parameter(s). The SMF
may use the parameters as follows:
\- SMF configures the UPF accordingly. The SMF can use the Scheduled
Communication Type parameter or Suggested Number of Downlink Packets parameter
to configure the UPF with how many downlink packets to buffer. The SMF may use
Communication duration time parameter and/or Expected Inactivity Time
parameter and/or Battery Indication parameter combined with their confidence
and/or accuracy levels to set the inactivity timer for a PDU Session. The SMF
then waits for a UP inactivity report to be received from UPF. Based on the
received UP inactivity report, the SMF may determine to deactivate the
corresponding UP connection associated to the PDU Session of a single UE or
determine a collective pattern of deactivating UP connections for multiple UEs
(e.g. for a group of UEs receiving application AI/ML traffic during FL
operation) and perform CN-initiated selective deactivation of UP connection of
an existing PDU Session.
\- The SMF may derive SMF derived CN assisted RAN information for the PDU
Session. The SMF provides the SMF derived CN assisted RAN information to the
AMF as described in PDU Session establishment procedure or PDU Session
modification procedure.
NOTE 7: The NEF (in NOTE 1) or the UDM (in step 3) can also update the
corresponding UDR data via Nudr_DM_Create/Delete as appropriate.
NOTE 8: The change of AF provided ECS configuration information is not meant
to apply immediately: the UDM interface to the SMF can refer to Shared Data
for the Subscription provided ECS configuration information.
NOTE 9: Specification details of confidence and accuracy levels are left to
Stage 3 work.
#### 4.15.6.3 Expected UE Behaviour parameters
These Expected UE Behaviour parameters characterise the foreseen behaviour of
a UE or a group of UEs. Sets of these parameters may be provided via the NEF
to be stored as part of the subscriber data. Each parameter within the
Expected UE Behaviour shall have an associated validity time. The validity
time indicates when the Expected UE Behaviour parameter expires and shall be
deleted by the related NFs. The validity time may be set to indicate that the
particular Expected UE Behaviour parameter has no expiration time. When the
validity time expires, the related NFs delete their local copy of the
associated Expected UE Behaviour parameter(s). In addition, each parameter
within the Expected UE Behaviour may have a confidence and/or accuracy level
associated with it. The confidence level indicates a probability assertion for
the associated Expected UE Behaviour parameter and the accuracy level
indicates the performance of the estimator (e.g. AI/ML model) used for the
prediction. The provision procedure of the Expected UE Behaviour is realized
by external parameter provision procedure defined in clause 4.15.6.2.
The Expected UE Behaviour parameters stored as AMF-Associated Expected UE
Behaviour parameters which is per UE level and SMF-Associated Expected UE
Behaviour parameters which is per PDU session level in UDM. AMF retrieves the
AMF-Associated Expected UE Behaviour parameters from UDM which may related to
both PDU session(s) and SMS transmission. SMF retrieves the SMF-Associated
Expected UE Behaviour parameters from UDM for the specific PDU session. AMF
and SMF uses the Expected UE Behaviour parameters as described in clause
5.4.6.2 of TS 23.501 [2].
Table 4.15.6.3-1: Description of Expected UE Behaviour parameters
+----------------------------------+----------------------------------+ | Expected UE Behaviour parameter | Description | +==================================+==================================+ | Expected UE Moving Trajectory | Identifies the UE\'s expected | | | geographical movement | | | | | | Example: A planned path of | | | movement | +----------------------------------+----------------------------------+ | Stationary Indication | Identifies whether the UE is | | | stationary or mobile | | | [optional] | +----------------------------------+----------------------------------+ | Communication Duration Time | Indicates for how long the UE | | | will normally stay in | | | CM-CONNECTED for data | | | transmission. | | | | | | Example: 5 minutes. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Periodic Time | Interval Time of periodic | | | communication | | | | | | Example: every hour. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Scheduled Communication Time | Time and day of the week when | | | the UE is available for | | | communication. | | | | | | Example: Time: 13:00-20:00, Day: | | | Monday. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Battery Indication | Identifies power consumption | | | criticality for the UE: if the | | | UE is battery powered with not | | | rechargeable/not replaceable | | | battery, battery powered with | | | rechargeable/replaceable | | | battery, or not battery powered. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Traffic Profile | Identifies the type of data | | | transmission: single packet | | | transmission (UL or DL), dual | | | packet transmission (UL with | | | subsequent DL or DL with | | | subsequent UL), multiple packets | | | transmission | | | | | | [optional] | +----------------------------------+----------------------------------+ | Scheduled Communication Type | Indicates that the Scheduled | | | Communication Type is Downlink | | | only or Uplink only or | | | Bi-directional [To be used | | | together with Scheduled | | | Communication Time] | | | | | | Example: \, DL only. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Expected Time and Day of Week in | Identifies the time and day of | | Trajectory | week when the UE is expected to | | | be at each location included in | | | the Expected UE Moving | | | Trajectory. | | | | | | [optional] | +----------------------------------+----------------------------------+
The Expected UE Moving Trajectory and the Expected Time and Day of Week in
Trajectory may be used by the AMF. All other parameters may be used by the AMF
and by the SMF.
The Scheduled Communication Type and the Traffic Profile should not be used by
the AMF to release the UE when NAS Release Assistance Information from the UE
is available.
In the case of NB-IoT UEs, the parameters may be forwarded to the RAN to allow
optimisation of Uu resource allocation for NB-IoT UE differentiation.
#### 4.15.6.3a Network Configuration parameters
The Network Configuration parameters are the parameters sent from an AF by
invoking the Nnef_ParameterProvision Service as described in clause 4.15.6.2.
The Network Configuration parameters are described in Table 4.15.6.3a-1.
Table 4.15.6.3a-1: Description of Network Configuration parameters
+----------------------------------+----------------------------------+ | Network Configuration parameter | Description | +==================================+==================================+ | Maximum Response Time | Identifies the time for which | | | the UE stays reachable to allow | | | the AF to reliably deliver the | | | required downlink data. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Maximum Latency | Identifies maximum delay | | | acceptable for downlink data | | | transfers. | | | | | | Example: in order of 1 minute to | | | multiple hours. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Suggested Number of Downlink | Identifies the number of packets | | Packets | that the core network is | | | suggested to buffer if the UE is | | | not reachable. | | | | | | Example: 5 packets. | | | | | | [optional] | +----------------------------------+----------------------------------+
The parameters Maximum Response Time and Maximum Latency are stored in the UDM
and the Maximum Response Time is sent to the AMF for event monitoring as
specified in 4.15.3.2.3b.
The AMF may use the Maximum Response Time parameter as guide to configure:
\- Extended Connected time for MICO mode;
\- when to send reachability notifications to AF relative to expected
reachability events (e.g. paging occasions).
If the UDM received multiple Network Configuration requests, the UDM shall
accept the request as long as the Maximum Latency (if received) and/or the
Maximum Response Time (if received) are within the range defined by operator
policies. The UDM shall use the minimum value of Maximum Latency(s) to derive
the subscribed periodic registration timer and use the maximum value of
Maximum Response Time(s) to derive the subscribed Active Time as specified in
step 2 of clause 4.15.3.2.3b. If the newly derived value is changed comparing
to the one last time sent to the AMF, the UDM notify the AMF of the updated
value via Nudm_SDM_Notification message. If there is a deletion of Network
Configuration request, the UDM re-calculates the values (see step 2 in clause
4.15.3.2.3b) and notify the AMF if needed.
The Suggested Number of Downlink Packets is classified as SMF associated
subscription data. If the NEF is providing DNN and S-NSSAI as specified in
clause 4.15.3.2.3, then the UDM is able to associate the parameters with
subscribed DNN and S-NSSAI and provides the Suggested Number of Downlink
Packets consolidated as specified in 4.15.3.2.3b to the SMF for the PDU
Session associated with the specific DNN and S-NSSAI as specified in clause
4.15.6.2. The SMF may use the Suggested Number of Downlink Packets parameter
to configure the number of packets to buffer in the SMF/UPF (in the case of
UPF anchored PDU sessions) or in the NEF (in the case of NEF anchored PDU
session) when the UE is not reachable and extended buffering of downlink data
is activated.
A Validity Time may be associated with any of the Network Configuration
parameters. When the validity time expires, the related NFs delete their local
copy of the associated Network Configuration parameter(s). If the deletion
results in subscribed value change, the UDM shall notify the AMF or SMF of the
changed value.
#### 4.15.6.3b 5G VN group data
The 5G VN group data is described in Table 4.15.6.3b-1.
Table 4.15.6.3b-1: Description of 5G VN group data
+----------------------------------+----------------------------------+ | Parameters | Description | +==================================+==================================+ | DNN | DNN for the 5G VN group. | +----------------------------------+----------------------------------+ | S-NSSAI | S-NSSAI for the 5G VN group. | +----------------------------------+----------------------------------+ | PDU Session Type | PDU Session Types allowed for 5G | | | VN group. | +----------------------------------+----------------------------------+ | Application descriptor | There may be multiple instances | | | of this information; this | | | information may be used to build | | | URSP sent to 5G VN group members | | | (NOTE 1). | +----------------------------------+----------------------------------+ | Information related with | This may indicate: | | secondary authentication / | | | authorization | - the need for secondary | | | authentication/authorization (as | | | defined in clause 5.6 of | | | TS 23.501 [2]); | | | | | | - the need for SMF to request | | | the UE IP address from the | | | DN-AAA Server. | | | | | | If at least one of secondary | | | authentication/authorization or | | | DN-AAA UE IP address allocation | | | is needed, the AF may provide | | | DN-AAA Server addressing | | | information. | +----------------------------------+----------------------------------+ | 5G VN group communication | Indicates that the 5G VN group | | indication | is associated with 5G VN group | | | communication. | +----------------------------------+----------------------------------+ | Maximum Group Data Rate | This limits the total bit rate | | | that is expected to be provided | | | across all sessions of a 5G VN | | | group. | | | | | | [optional]. | +----------------------------------+----------------------------------+ | NOTE 1: As described in | | | TS 23.503 [20], the PCF may be | | | configured with a mapping from | | | Application Descriptor to other | | | information required to | | | construct the URSP rules, e.g. | | | IP filters and SSC mode. | | +----------------------------------+----------------------------------+
The information described in Table 4.15.6.3b-1 corresponds to 5G VN group data
that an AF may provide together with External Group ID.
#### 4.15.6.3c 5G VN Group membership management parameters
5G VN group membership management parameters that an AF may provide are
described in Table 4.15.6.3c-1.
Table 4.15.6.3b-1: Description of 5G VN Group membership management parameters
Parameters Description
* * *
List of GPSI List of 5G VN Group members, each member is identified by GPSI
External Group ID A identifier for 5G VN group
#### 4.15.6.3d ECS Address Configuration Information Parameters
AF provided ECS Address Configuration Information that an AF may provide to
the 5GC is described in Table 4.15.6.3d-1. The AF may associate ECS Address
Configuration Information with a group of UE or with any UE.
Multiple AF may configure 5GC with AF provided ECS Address Configuration
Information.
The Subscription provided ECS Address Configuration Information that a SMF may
receive is described in Table 4.15.6.3d-2
For non-roaming and LBO cases, the ECS Address Configuration Information is
provided to SMF as Session Management Subscription data. The ECS Address
Configuration Information is associated with a DNN and S-NSSAI included in the
message from UDM.
For HR cases, when the HPLMN has the knowledge of EACI in the VPLMN, the ECS
Address Configuration Information is provided to H-SMF as Session Management
Subscription data. The ECS Address Configuration Information is associated
with a DNN, S-NSSAI and PLMN ID included in the message from UDM.
The SMF is not expected to understand the internal structure of ECS Address
Configuration Information.
Table 4.15.6.3d-1: Description of ECS Address Configuration Information
provided by the AF
+----------------------------------+----------------------------------+ | Parameters | Description | +==================================+==================================+ | ECS Address Configuration | One or more ECS Configuration | | Information | Information as defined in | | | clause 8.3.2.1 of | | | TS 23.558 [83]. | +----------------------------------+----------------------------------+ | Target | This may correspond to one of: | | | | | | - a group of UE identified by | | | an external group Id; | | | | | | - any UE. | +----------------------------------+----------------------------------+ | PLMN ID | The ECS Address Configuration | | | Information is applied to the UE | | | roaming in target PLMN. | +----------------------------------+----------------------------------+
Table 4.15.6.3d-2: Description of Subscription provided ECS Address
Configuration Information (as sent to the SMF)
Parameters Description
* * *
ECS Address Configuration Information As defined in Table 4.15.6.3d-1. The SMF
is not expected to understand the internal structure of ECS Address
Configuration Information.
#### 4.15.6.3e DNN and S-NSSAI specific Group Parameters
The DNN and S-NSSAI specific Group Parameters are the parameters sent from an
AF by invoking the Nnef_ParameterProvision Service as described in clause
4.15.6.2.
The DNN and S-NSSAI specific Group Parameters are described in Table
4.15.6.3e-1.
Table 4.15.6.3e-1: Description of DNN and S-NSSAI specific Group Parameters
+----------------------------------+----------------------------------+ | Parameters | Description | +==================================+==================================+ | Default QoS (NOTE 1) | Identifies the requested default | | | QoS parameters (as defined in | | | clause 5.7.2.7 of | | | TS 23.501 [2]) applicable to | | | each UE within a group. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Service Area (NOTE 1) | Identifies the AF-requested | | | Service Area applicable to each | | | UE within a group. | | | | | | [optional] | +----------------------------------+----------------------------------+ | NOTE 1: These parameters are | | | applicable per DNN and S-NSSAI. | | +----------------------------------+----------------------------------+
#### 4.15.6.3f Application-Specific Expected UE Behaviour parameters
The Application-Specific Expected UE Behaviour parameters characterise the
foreseen behaviour of a UE for a specific application. When AF provisions the
Application-Specific Expected UE Behaviour parameters, the AF shall provide
application traffic descriptors (i.e. the corresponding Packet Filters or
Application ID). Each parameter within the Application-Specific Expected UE
Behaviour shall have an associated validity time and may have a confidence
and/or accuracy level associated with it as defined in the clause 4.15.6.2 and
clause 4.15.6.3.
Table 4.15.6.3f-1: Description of Application-Specific Expected UE Behaviour
parameters
Application-Specific Expected UE Behaviour Parameters Description
* * *
Expected PDU session Inactivity Time Identifies the expected PDU Session
Inactivity time during which the UE will not have traffic related to the
application.
#### 4.15.6.3g Network Slice Usage Control parameters for dedicated S-NSSAI to
a single AF
An AF having a S-NSSAI dedicated to it may be authorized, to control the
parameters to remove the S-NSSAI from the Allowed NSSAI or release a PDU
Session associated with the S-NSSAI. In this case, these parameters may be
provided by an authorized AF via the NEF and be stored as part of the
subscriber data. The provision procedure of the Network Slice Usage Control
Parameters is realized by external parameter provision procedure as described
in clause 4.15.6.2. The AMF and SMF use the Network Slice Usage Control
parameter as described in clause 5.15.15 of TS 23.501 [2].
Table 4.15.6.3g-1: Description of Network Slice Usage Control parameters
+----------------------------------+----------------------------------+ | Network Slice Usage Control | Description | | parameter | | +==================================+==================================+ | For each indicated S-NSSAI | | +----------------------------------+----------------------------------+ | S-NSSAI | S-NSSAI for which the | | | inactivity-based slice control | | | applies (NOTE 1) | +----------------------------------+----------------------------------+ | slice deregistration inactivity | For network slice usage control, | | timer value | this timer identifies the wait | | | time before deregistering the UE | | | from the S-NSSAI by removing the | | | S-NSSAI from the Allowed NSSAI | | | when no associated PDU Session | | | is established with the | | | indicated S-NSSAI. | | | | | | [optional] | +----------------------------------+----------------------------------+ | PDU Session inactivity timer | Identifies the wait time to | | value | release the PDU Session | | | associated with the indicated | | | S-NSSAI when there is no data | | | transmission | | | | | | [optional] | +----------------------------------+----------------------------------+ | NOTE 1: This slice is solely | | | dedicated for one authorized AF | | | and not shared with other AFs. | | +----------------------------------+----------------------------------+
According to the received network slice usage control parameter, the UDM
updates all related UE subscription data which includes the indicated S-NSSAI.
Only in this case and for subscribers having such an S-NSSAI a subscribed
S-NSSAI, the slice deregistration inactivity timer value and/or PDU Session
inactivity timer value is obtained by the AMF or SMF as part of the
subscription data respectively as specified in clauses 4.2.2.2.2 and
4.3.2.2.1.
#### 4.15.6.4 Set a chargeable party at AF session setup
Figure 4.15.6.4-1: Set the chargeable party at AF session set-up
1\. When setting up the connection between an ASP sponsoring a session and the
UE, the ASP may communicate with the AF to request to become the chargeable
party for the session to be set up by sending a Nnef_ChargeableParty_Create
request message (AF Identifier, UE address, Flow description information or
External Application Identifier, Sponsor Information, Sponsoring Status,
Background Data Transfer Reference ID, DNN, S-NSSAI) to the NEF. The
Sponsoring Status indicates whether sponsoring is started or stopped, i.e.
whether the 3rd party service provider is the chargeable party or not. The
Background Data Transfer Reference ID parameter identifies a previously
negotiated transfer policy for background data transfer as defined in clause
4.16.7. The NEF assigns a Transaction Reference ID to the
Nnef_ChargeableParty_Create request.
2\. The NEF authorizes the AF request to sponsor the application traffic and
stores the sponsor information together with the AF Identifier and the
Transaction Reference ID. If the authorisation is not granted, step 2 is
skipped and the NEF replies to the AF with a Result value indicating that the
authorisation failed.
NOTE: Based on operator configuration, the NEF may skip this step. In this
case the authorization is performed by the PCF in step 3.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Create request message and provides IP filter
information or Ethernet filter information, sponsored data connectivity
information (as defined in TS 23.503 [20]), Background Data Transfer Reference
ID (if received from the AF) and Sponsoring Status (if received from the AF)
to the PCF.
4\. The PCF determines whether the request is allowed and notifies the NEF if
the request is not authorized. If the request is not authorized, NEF responds
to the AF in step 5 with a Result value indicating that the authorization
failed.
5\. The NEF sends a Nnef_ChargeableParty_Create response message (Transaction
Reference ID, Result) to the AF. Result indicates whether the request is
granted or not.
#### 4.15.6.5 Change the chargeable party during the session
Figure 4.15.6.5-1: Change the chargeable party during the session
1\. For the ongoing AF session, the AF may send a Nnef_ChargeableParty_Update
request message (AF Identifier, Transaction Reference ID, Sponsoring Status,
Background Data Transfer Reference ID) to the NEF. The Sponsoring Status
indicates whether sponsoring is enabled or disabled, i.e. whether the 3rd
party service provider is the chargeable party or not. The Background Data
Transfer Reference ID parameter identifies a previously negotiated transfer
policy for background data transfer as defined in clause 4.16.7. The
Transaction Reference ID provided in the Change chargeable party request
message is set to the Transaction Reference ID that was assigned, by the NEF,
to the a Nnef_ChargeableParty_Create request.
2\. The NEF authorizes the AF request of changing the chargeable party. If the
authorisation is not granted, step 3 is skipped and the NEF replies to the AF
with a Result value indicating that the authorisation failed.
NOTE: Based on operator configuration, the NEF may skip this step. In this
case the authorization is performed by the PCF in step 3.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Update request and provides IP filter information or
Ethernet filter information, sponsored data connectivity information (as
defined in TS 23.503 [20]), Background Data Transfer Reference ID (if received
from the AF) and Sponsoring Status (if received from the AF) to the PCF.
4\. The PCF determines whether the request is allowed and notifies the NEF if
the request is not authorized. If the request is not authorized, NEF responds
to the AF in step 5 with a Result value indicating that the authorization
failed.
5\. The NEF sends a Nnef_ChargeableParty_Update response message (Transaction
Reference ID, Result) to the AF. Result indicates whether the request is
granted or not.
#### 4.15.6.6 Setting up an AF session with required QoS procedure
Figure 4.15.6.6-1: Setting up an AF session with required QoS procedure
1\. The AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message (UE address, AF Identifier, Flow
description information or External Application Identifier, QoS Reference or
individual QoS parameters, Alternative Service Requirements (as described in
clause 6.1.3.22 of TS 23.503 [20]), DNN, S-NSSAI) to the NEF. Optionally, QoS
monitoring requirements, Indication of ECN marking for L4S, Multi-modal
Service ID, PDU Set QoS Parameters (as described in clause 5.7.7 of TS 23.501
[2]) and Protocol Description (as described in clause 5.37.5 of TS 23.501 [2])
can be included in the AF request. Optionally, a period of time or a traffic
volume for the requested QoS can be included in the AF request. The AF may,
instead of a QoS Reference, provide one or more of the following individual
QoS parameters: Requested 5GS Delay (optional), Requested Priority (optional),
Requested Guaranteed Bitrate, Requested Maximum Bitrate, Maximum Burst Size
and Requested Packet Error Rate. The AF may also provide an Averaging Window
value for deriving such parameters for GBR QoS Flows. Regardless of whether
the AF request is formulated using a QoS Reference or individual QoS
parameters, the AF may also provide one or more of the following parameters
that describe the traffic characteristics: flow direction, Burst Arrival Time
at UE (uplink) or UPF (downlink), Periodicity, Time domain, Survival Time,
Capability for BAT adaptation or BAT Window, Periodicity Range. The AF may
also provide an RT Latency Indication. The optional Alternative Service
Requirements provided by the AF shall either contain QoS References or
Requested Alternative QoS Parameter Set(s) in a prioritized order as described
in clause 6.1.3.22 of TS 23.503 [20]. Optionally, Packet Delay Variation
requirements can be included in the AF request as described in clause 6.1.3.26
of TS 23.503 [20]. Optionally, the AF may provide QoS duration and QoS
inactivity interval in order to indicate PCF the time period when the QoS
should be applied.
NOTE 1: For multi-modal flows related to multiple UEs, multiple UE-specific AF
requests are used and the AF provided information to NEF is the same as single
UE case (as defined in clause 5.37.2 of TS 23.501 [2]).
2\. The NEF authorizes the AF request that contains a single UE address and
may apply policies to control the overall amount of QoS authorized for the AF.
If the authorisation is not granted, all steps (except step 5) are skipped and
the NEF replies to the AF with a Result value indicating that the
authorisation failed. The NEF assigns a Transaction Reference ID to the
Nnef_AFsessionWithQoS_Create request.
The NEF determines whether to invoke the TSCTSF or to directly contact the PCF
based on operator configuration. This determination may use the presence of a
QoS Reference or individual QoS parameters in the AF request. The
determination may also use the AF identifier or the presence of AF provided
parameters that describe the traffic characteristics in the AF request.
NOTE 2: The determination can also be based on an SLA between operator and
application provider, e.g. using the DNN/S-NSSAI for the AF session according
to the SLA.
If the NEF determines not to invoke the TSCTSF, then steps 3, 4, 5, 6, 7, 8
are executed, otherwise, steps 3a, 3b, 4a, 4b, 5, 6a, 7a, 7b, 8 are executed.
3\. If the NEF determines to contact the PCF directly without invoking the
TSCTSF, the NEF uses the UE address to discover the PCF from the BSF. The NEF
forwards received parameters to the PCF in the Npcf_PolicyAuthorization_Create
request. Any optionally received period of time or traffic volume mapped and
forwarded as sponsored data connectivity information (as defined in TS 23.503
[20]).
If the AF is considered to be trusted by the operator, the AF uses the
Npcf_PolicyAuthorization_Create request message to interact directly with PCF
to request reserving resources for an AF session.
3a. If the NEF determines to invoke the TSCTSF, the NEF forwards received
parameters in the Ntsctsf_QoSandTSCAssistance_Create request message to the
TSCTSF. Any optionally received period of time or traffic volume is mapped and
forwarded as sponsored data connectivity information (as defined in TS 23.503
[20]).
If the AF is considered to be trusted by the operator, the AF uses the
Ntsctsf_QoSandTSCAssistance_Create request message to interact directly with
TSCTSF to request reserving resources for an AF session.
A TSCTSF address may be locally configured (a single TSCTSF per DNN/S-NSSAI)
in the NEF, PCF and trusted AF. Alternatively, the NEF uses the AF Identifier
to determine the DNN/S-NSSAI and uses the DNN/S-NSSAI to discover the TSCTSF
from the NRF.
3b. The TSCTSF determines whether it has an AF session with a PCF for the
given UE address. In this case the TSCTSF sends a
Npcf_PolicyAuthorization_Update request message to the PCF and forwards the
received parameters after executing the adjustment and mapping actions
described below.
If the TSCTSF does not have an AF-session for a given UE address, the TSCTSF
discovers the PCF and a Npcf_PolicyAuthorization_Create request message to the
PCF.
If the TSCTSF receives a Requested 5GS Delay, the TSCTSF calculates a
Requested PDB by subtracting the UE-DS-TT Residence Time (either provided by
the PCF or pre-configured at TSCTSF) from the Requested 5GS Delay and sends
the Requested PDB to the PCF instead of the Requested 5GS Delay. If the TSCTSF
receives any of the following parameters: flow direction, Burst Arrival Time,
Periodicity, Time domain, Survival Time, Capability for BAT adaptation or BAT
Window, Periodicity Range from the NEF, the TSCTSF determines the TSC
Assistance Container and sends it to the PCF instead of these parameters.
4\. For requests received from the NEF in step 3, the PCF determines whether
the request is authorized and notifies the NEF if the request is not
authorized.
If the request is authorized, the PCF derives the required QoS parameters of
the PCC rule based on the information provided by the NEF and determines
whether this QoS is allowed (according to the PCF configuration) and notifies
the result to the NEF. If the AF is considered to be trusted by the operator,
the PCF sends the Npcf_PolicyAuthorization_Create response message directly to
AF.
If the PCF receives the individual QoS parameters instead of QoS Reference,
the PCF determines a 5QI that matches the individual QoS parameters as
described in clause 6.1.3.22 of TS 23.503 [20]. It also sets the GBR and MBR
for the PCC rule according to the requested values. The PCF may use the
Requested Priority from the AF to determine Priority Level as defined in
clause 5.7.3.3 of TS 23.501 [2]. Requested individual QoS parameter values
supersede default values for the 5QI.
If the PCF receives the RT Latency Indication described in clause 6.1.3.22 of
TS 23.503 [20], the PCF executes Uplink-Downlink Transmission Coordination as
described in clause 5.37.7 of TS 23.501 [2] and the associated QoS monitoring
for the two correlated QoS Flows as described in clause 6.1.3.27.2 of TS
23.503 [20].
If the PCF receives PDU Set QoS parameters described in clause 5.7.7 of TS
23.501 [2], the PDU Set QoS parameters are applied as described in clause
6.1.3.22 of TS 23.503 [20].
If the PCF receives an explicit indication (i.e. Indication of ECN marking for
L4S) as described in clause 6.1.3.22 of TS 23.503 [20], PCF decides that the
service data flow supports ECN marking for L4S. PCF then indicates to the SMF
to enable ECN marking for L4S for that QoS flow.
In addition, if the Alternative Service Requirements are provided, the PCF
derives the Alternative QoS parameter set(s) in the same way from the one or
more QoS Reference parameters or the Requested Alternative QoS Parameter
Set(s) contained in the Alternative Service Requirements keeping the same
prioritized order (as defined in clause 6.1.3.22 of TS 23.503 [20]).
NOTE 3: The PCF derived Alternative QoS parameter set(s) for the PCC rule are
subsequently used to establish Alternative QoS Profile(s). The Alternative QoS
Profile parameters provided to the NG-RAN are specified in clause 5.7.1.2a of
TS 23.501 [2].
For multi-modal flows, the PCF derives the required QoS parameters in the PCC
rules and generates the QoS monitoring requirements policy for each media
flow, based on the information provided by the NEF.
If the PCF determines that the SMF needs updated policy information, the PCF
issues a Npcf_SMPolicyControl_UpdateNotify request with updated policy
information about the PDU Session as described in the PCF initiated SM Policy
Association Modification procedure in clause 4.16.5.2.
4a. For requests received from the TSCTSF in step 3b, the PCF determines
whether the request is authorized and notifies the TSCTSF if the request is
not authorized.
If the request is authorized, the PCF derives the required QoS parameters of
the PCC rule in the same way it is described in step 4 based on the
information provided by the TSCTSF and determines whether this QoS is allowed
(according to the PCF configuration) and notifies the result to the TSCTSF.
If the PCF determines that the SMF needs updated policy information, the PCF
issues a Npcf_SMPolicyControl_UpdateNotify request with updated policy
information about the PDU Session as described in the PCF initiated SM Policy
Association Modification procedure in clause 4.16.5.2.
If the PCF receives a subscription for the 5GS Bridge/Router information from
the TSCTSF, if the PCF does not have the 5GS Bridge/Router information for the
PDU Session, the PCF uses the PCF initiated SM Policy Association Modification
procedure as described in clause 4.16.5.2 to subscribe for 5GS Bridge/Router
information event from the SMF. Once the PCF has the 5GS Bridge/Router
information, the PCF notifies the TSCTSF for the 5GS Bridge/Router information
(including the UE-DS-TT Residence Time).
4b. The TSCTSF sends a Ntsctsf_QoSandTSCAssistance_Create response message
(Transaction Reference ID, Result) to the NEF. Result indicates whether the
request is granted or not.
If the AF is considered to be trusted by the operator, the TSCTSF sends the
Ntsctsf_QoSandTSCAssistance_Create response message directly to AF.
5\. The NEF sends a Nnef_AFsessionWithQoS_Create response message (Transaction
Reference ID, Result) to the AF. Result indicates whether the request is
granted or not.
6\. The NEF shall send a Npcf_PolicyAuthorization_Subscribe message to the PCF
to subscribe to notifications of Resource allocation status and may subscribe
to other events described in clause 6.1.3.18 of TS 23.503 [20].
6a. The TSCTSF shall send a Npcf_PolicyAuthorization_Subscribe message to the
PCF to subscribe to notifications of Resource allocation status and may
subscribe to other events described in clause 6.1.3.18 of TS 23.503 [20].
The TSCTSF that receives Capability for BAT adaptation or BAT Window in step
3a shall subscribe to notification on BAT offset via sending a
Npcf_PolicyAuthorization_Subscribe request message to the PCF.
7\. When the event condition is met, e.g. that the establishment of the
transmission resources corresponding to the QoS update succeeded or failed,
the PCF sends Npcf_PolicyAuthorization_Notify message to the NEF notifying
about the event.
If the AF is considered to be trusted by the operator, the PCF sends the
Npcf_PolicyAuthorization_Notify message directly to AF.
7a. When the event condition is met, e.g. that the establishment of the
transmission resources corresponding to the QoS update succeeded or failed,
the PCF sends Npcf_PolicyAuthorization_Notify message to the TSCTSF notifying
about the event.
7b. The TSCTSF sends Ntsctsf_QoSandTSCAssistance_Notify message with the event
reported by the PCF to the NEF.
If the AF is considered to be trusted by the operator, the TSCTSF sends the
Ntsctsf_QoSandTSCAssistance_Notify message directly to AF.
8\. The NEF sends Nnef_AFsessionWithQoS_Notify message with the event reported
by the PCF to the AF.
The AF may send Nnef_AFsessionWithQoS_Revoke request to NEF in order to revoke
the AF request. The NEF authorizes the revoke request and triggers the
Ntsctsf_QoSandTSCAssistance_Delete/Unsubscribe and/or
Npcf_PolicyAuthorization_Delete and the Npcf_PolicyAuthorization_Unsubscribe
operations for the AF request.
#### 4.15.6.6a AF session with required QoS update procedure
Figure 4.15.6.6a-1: AF session with required QoS update procedure
1\. For an established AF session with required QoS, the AF may send a
Nnef_AFsessionWithQoS_Update request message (AF Identifier, Transaction
Reference ID, [Flow description information], [QoS Reference or individual QoS
parameters], [Alternative Service Requirements (as described in clause
6.1.3.22 of TS 23.503 [20])]) to NEF for updating the reserved resources.
Optionally, updated QoS monitoring requirements, Indication of ECN marking for
L4S, PDU Set QoS Parameters (as described in clause 5.7.7 of TS 23.501 [2])
and Protocol Description (as described in clause 5.37.5 of TS 23.501 [2]) can
be included in the AF request. Optionally, a period of time or a traffic
volume for the requested QoS can be included in the AF request. The
Transaction Reference ID provided in the AF session with required QoS update
request message is set to the Transaction Reference ID that was assigned, by
the NEF, to the Nnef_AFsessionWithQoS_Create request message. The AF may,
instead of a QoS Reference, provide one or more of the following individual
QoS parameters: Requested 5GS Delay (optional), Requested Priority (optional),
Requested Guaranteed Bitrate, Requested Maximum Bitrate, Maximum Burst Size
and Requested Packet Error Rate. The AF may also provide an Averaging Window.
Regardless whether the AF request is formulated using a QoS Reference or
individual QoS parameters, the AF may also provide one or more of the
following parameters that describe the traffic characteristics: flow
direction, Burst Arrival Time at UE (uplink) or UPF (downlink), Periodicity,
Time domain, Survival Time, Capability for BAT adaptation or BAT Window,
Periodicity Range. The optional Alternative Service Requirements provided by
the AF shall either contain QoS References or Requested Alternative QoS
Parameter Set(s) in a prioritized order as specified in clause 6.1.3.22 of TS
23.503 [20]. Optionally, Packet Delay Variation requirements can be included
in the AF request as described in clause 6.1.3.26 of TS 23.503 [20].
2\. The NEF authorizes the AF request of updating AF session with required QoS
and may apply policies to control the overall amount of QoS authorized for the
AF. If the authorisation is not granted, all steps (except step 5) are skipped
and the NEF replies to the AF with a Result value indicating that the
authorisation failed.
3\. The NEF shall contact the same NF type (i.e. TSCTSF or PCF) as with the
initial Nnef_AFsessionWithQoS_Create request during the establishment
procedure in clause 4.15.6.6. If the NEF determined not to invoke the TSCTSF,
then steps 3, 4, 5, 6, 7 are executed, otherwise, steps 3a, 3b, 4a, 4b, 5, 6a,
6b, 7 are executed. If the Nnef_AfsessionWithQoS_Update adds any parameters
that would require the NEF to invoke TSCTSF while the NEF determined not to
invoke the TSCTSF for the initial Nnef_AFsessionWithQoS_Create request, the
NEF shall reject the Nnef_AFsessionWithQoS_Update request with a cause value
indicating the reason of failure.
If the NEF does not invoke the TSCTSF, the NEF interacts with the PCF by
triggering a Npcf_PolicyAuthorization_Update request and forwards received
parameters to the PCF. Any optionally received period of time or traffic
volume is mapped and forwarded as sponsored data connectivity information (as
defined in TS 23.503 [20]).
If the AF is considered to be trusted by the operator, the AF uses the
Npcf_PolicyAuthorization_Update request message to interact directly with PCF
to update the reserving resources for an AF session.
3a. If the NEF decided to contact the TSCTSF when the session was established,
the NEF forwards received parameters in the Ntsctsf_QoSandTSCAssistance_Update
request message to the TSCTSF. Any optionally received period of time or
traffic volume is mapped and forwarded as sponsored data connectivity
information (as defined in TS 23.503 [20]).
If the AF is considered to be trusted by the operator, the AF uses the
Ntsctsf_QoSandTSCAssistance_Update request message to interact directly with
TSCTSF to update the reserving resources for an AF session.
3b. The TSCTSF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Update request and forwards the received parameters
after executing the adjustment and mapping actions described in step 3b of
clause 4.15.6.6.
4\. The PCF processes the Npcf_PolicyAuthorization_Update request according to
the actions described in step 4 of clause 4.15.6.6. If the QoS monitoring
requirements are updated, the PCF updates the PCC rules considering the
updated QoS information provided by the AF.
4a. The PCF processes the Npcf_PolicyAuthorization_Update request according to
the actions described in step 4a of clause 4.15.6.6. If the PCF has received a
request to unsubscribe for 5GS Bridge/Router information Notification, the PCF
uses the PCF initiated SM Policy Association Modification procedure as
described in clause 4.16.5.2 to unsubscribe for 5GS Bridge/Router information
event from the SMF.
4b. The TSCTSF sends a Ntsctsf_QoSandTSCAssistance_Update response message
(Transaction Reference ID, Result) to the NEF. Result indicates whether the
request is granted or not.
If the AF is considered to be trusted by the operator, the TSCTSF sends the
Ntsctsf_QoSandTSCAssistance_Update response message directly to AF.
5\. The NEF sends a Nnef_AFsessionWithQoS_Update response message (Transaction
Reference ID, Result) to the AF. Result indicates whether the request is
granted or not.
6\. The PCF sends Npcf_PolicyAuthorization_Notify message to the NEF when the
modification of the transmission resources corresponding to the QoS update
succeeded or failed, or when an Alternative Service Requirement is being
applied.
If the AF is considered to be trusted by the operator, the PCF sends the
Npcf_PolicyAuthorization_Notify message directly to AF.
6a. The PCF sends Npcf_PolicyAuthorization_Notify message to the TSCTSF when
the modification of the transmission resources corresponding to the QoS update
succeeded or failed, or when an Alternative Service Requirement is being
applied.
6b. The TSCTSF sends Ntsctsf_QoSandTSCAssistance_Notify message with the event
reported by the PCF to the NEF.
If the AF is considered to be trusted by the operator, the TSCTSF sends the
Ntsctsf_QoSandTSCAssistance_Notify message directly to the AF.
7\. The NEF sends Nnef_AFsessionWithQoS_Notify message with the event reported
by the PCF to the AF.
#### 4.15.6.7 Service specific parameter provisioning
##### 4.15.6.7.1 General
This clause describes the procedures for enabling the AF to provide service
specific parameters to 5G system via NEF.
The AF may issue requests on behalf of applications not owned by the PLMN
serving the UE.
NOTE 1: In the case of architecture without CAPIF support, the AF is locally
configured with the API termination points for the service. In the case of
architecture with CAPIF support, the AF obtains the service API information
from the CAPIF core function via the Availability of service APIs event
notification or Service Discover Response as specified in TS 23.222 [54].
The AF request sent to the NEF contains the information as below:
1) Service Description.
Service Description is the information to identify a service the Service
Parameters are applied to. The Service Description in the AF request can be
represented by the combination of DNN and S-NSSAI, an AF-Service-Identifier or
an External Application Identifier.
2) Service Parameters.
Service Parameters are the service specific information which needs to be
provisioned in the Network and delivered to the UE in order to support the
service identified by the Service Description.
When AF provides application guidance for URSP determination for PIN service,
the application traffic descriptor includes PIN ID as specified in Table
6.6.2.1-2 of TS 23.503 [20].
VPLMN ID(s) that indicates the PLMN(s) where the AF guidance on URSP
determination and all its RSD(s), applies.
3) Target UE(s) or a group of UEs or PLMN ID(s) of inbound roamers.
Target UE(s) or a group of UEs or PLMN ID(s) of inbound roamers indicate the
UE(s) who the Service Parameters shall be delivered to. Individual UEs can be
identified by GPSI, or an IP address/Prefix or a MAC address. Groups of UEs
are identified by an External Group Identifiers as defined in TS 23.682 [23].
If identifiers of target UE(s) or a group of UEs or PLMN ID(s) of inbound
roamers are not provided, then the Service Parameters shall be delivered to
any UEs of the PLMN of the NEF using the service identified by the Service
Description.
4) Subscription to events.
The AF may subscribe to notifications about the outcome of the UE Policies
delivery due to service specific parameter provisioning.
The NEF authorizes the AF request received from the AF and stores the
information in the UDR as \"Application Data\". The Service Parameters are
delivered to the targeted UE by the PCF when the UE is reachable.
##### 4.15.6.7.2 Service specific parameter provisioning by AF to HPLMN
Figure 4.15.6.7.2-1 shows procedure for service specific parameter
provisioning. The AF uses Nnef_ServiceParameter service to provide the service
specific parameters to the HPLMN and the UE. In the roaming case, PCF is
replaced by H-PCF, the AMF interacts with the V-PCF which interacts with
H-PCF.
Figure 4.15.6.7.2-1: Service specific information provisioning by AF to HPLMN
0a. The AMF establishes UE Policy Association as specified in clause 4.16.11.
0b. PCF requests notifications from the UDR on changes in UE policy
information.
1\. To create a new request, the AF invokes an Nnef_ServiceParameter_Create
service operation. The request may include subscription information to the
report of the outcome of UE Policy delivery.
To update or remove an existing request, the AF invokes an
Nnef_ServiceParameter_Update or Nnef_ServiceParameter_Delete service operation
together with the corresponding Transaction Reference ID which was provided to
the AF in Nnef_ServiceParameter_Create response message.
When AF provides application guidance for URSP determination for PIN service,
the AF request contains DNN, S-NSSAI allocated for the PIN, and the
application traffic descriptor component includes PIN ID as specified in Table
6.6.2.1-2 of TS 23.503 [20].
The content of this service operation (AF request) includes the information
described in clause 5.2.6.11.
2\. The AF sends its request to the NEF. The NEF authorizes the AF request.
The NEF performs the following mappings:
\- Map the AF-Service-Identifier into DNN and S-NSSAI combination, determined
by local configuration.
\- Map the External Application Identifier into the corresponding Application
Identifier known in the core network.
2a. The NEF may invoke Nudm_SDM_Get service operation to perform the following
mappings:
\- Map the GPSI in Target UE Identifier into SUPI, according to information
received from UDM.
\- Map the External Group Identifier in Target UE Identifier into Internal
Group Identifier, according to information received from UDM.
If the AF subscribed to the outcome of UE Policy delivery, the AF indicates
where the AF receives the corresponding notifications.
(in the case of Nnef_ServiceParameter_Create): The NEF assigns a Transaction
Reference ID to the Nnef_ServiceParameter_Create request.
2b. (in the case of Nnef_ServiceParameter_Create or Update): The NEF may need
to authorize the service specific parameter provisioning request with the UDM
by sending a Nudm_ServiceSpecificAuthorisation_Create service operation as
defined in clause 4.15.6.7a.
NOTE 2: The NEF skips the mapping of GPSI or External Group Identifier in step
2a if it needs to authorize the service specific parameter provisioning
request with the UDM as the response of the authorization request from UDM
includes the SUPI or Internal Group Identifier.
(in the case of Nnef_ServiceParameter_delete): The NEF requests the UDM to
remove the authorization of the service specific parameters provisioned by
sending a Nudm_ServiceSpecificAuthorisation_Remove service operation.
3\. (in the case of Nnef_ServiceParameter_Create or Update): The NEF stores
the AF request information in the UDR as the \"Application Data\" (Data Subset
setting to \"Service specific information\") together with the assigned
Transaction Reference ID.
(in the case of Nnef_ServiceParameter_delete): The NEF deletes the AF request
information from the UDR.
4\. The NEF responds to the AF. In the case of Nnef_ServiceParameter_Create
response message, the response message includes the assigned Transaction
Reference ID.
If the UE is registered to the network and the PCF performs the subscription
to notification to the data modified in the UDR by invoking Nudr_DM_Subscribe
(AF service parameter provisioning information, SUPI, Data Set setting to
\"Application Data\", Data Subset setting to \"Service specific information\")
at step 0, the following steps are performed:
5\. The PCF(s) receive(s) a Nudr_DM_Notify notification of data change from
the UDR.
NOTE 3: PCF does not have to subscribe for each UE the application specific
information, e.g. if PCF has already received the application specific
information for a group of UE or for a DNN by a subscription of other UE. The
same application specific information is delivered to every UE in a group or a
DNN.
For PIN service, PCF generates the URSP rules with PIN ID in the Traffic
Descriptor as specified in Table 6.6.2.1-2 of TS 23.503 [20].
6\. The PCF initiates UE Policy delivery as specified in clause 4.2.4.3.
7\. If the AF subscribed to notifications about the outcome of UE Policies
delivery due to Service specific parameter provisioning and the PCF is
notified of UE Policy Container from the AMF, the PCF notifies the UE Policy
delivery result contained in the UE Policy container as the outcome of the
procedure to NEF by sending Npcf_EventExposure_Notify including the SUPI, the
list of GPSI(s) if available, and if provided in the step 2a, the Internal-
Group-Id.
If the PCF is notified about UE Policy delivery failure from the AMF due to UE
not reachable, the PCF may determine to retry step 6 of this procedure when
the UE becomes reachable. In such a case, the PCF may report the interim
status i.e. UE is temporarily unreachable as the outcome of the procedure to
NEF by sending Npcf_EventExposoure_Notify.
If the PCF determines the failure of the UE Policies delivery procedure, the
PCF notifies the failure with an appropriate cause such as UE is unreachable
as the outcome of the procedure to NEF by sending Npcf_EventExposure_Notify.
If the PCF determines that it cannot yet deliver URSP Rules that are based on
the service parameters from the AF, then the PCF may report in the interim
status that URSP Rules have not yet been delivered by the PCF as the outcome
of the procedure to NEF by sending Npcf_EventExposure_Notify.
The content of event reporting in this step is described in clause 6.1.3.18 of
TS 23.503 [20].
8\. When the NEF receives Npcf_EventExposure_Notify, the NEF performs
information mapping (e.g. AF Transaction Internal ID provided in Notification
Correlation ID to AF Transaction ID, SUPI to GPSI, Internal-Group-Id to
External-Group-Id, etc.) and triggers the appropriate
Nnef_ServiceParameter_Notify message.
##### 4.15.6.7.3 Service specific parameter provisioning by AF to VPLMN
Figure 4.15.6.7.3-1 shows procedure for service specific parameter
provisioning by the AF to VPLMN.
Figure 4.15.6.7.3-1: Service specific information provisioning by AF to VPLMN
0a. Same as in step 0a of Figure 4.15.6.7.2-1.
0b-0c. The V-PCF may request to V-UDR on changes in UE policy information and
H-PCF may subscribe to H-UDR.
1-2. Steps 1-2 of Figure 4.15.6.7.2-1 apply with the following differences:
\- The AF and NEF belong to the VPLMN. The AF may belong to third party with
agreement with VPLMN.
\- When the AF provides application guidance on URSP Rule determination to the
VPLMN, it will target \"PLMN ID(s) of inbound roamers\". The NEF in the VPLMN
rejects any request for a GPSI or an External-Group-ID of a different PLMN.
3-5. Steps 3-5 of Figure 4.15.6.7.2-1 apply with the following differences:
\- AF, NEF and UDR belong to VPLMN. The AF may belong to third party with
agreement with VPLMN.
\- The UDR in the VPLMN notifies the V-PCF(s) that have subscribed to the
reception of application guidance on URSP determination.
\- In step 5, the V-PCF receives updates on application guidance on URSP
determination for the PLMN ID of a SUPI that has a UE Policy Association
established. The PLMN ID of the SUPI is included in the target \"PLMN ID(s) of
inbound roamers\" in step 2. In this case, the V-PCF checks whether
application guidance on URSP determination applies for the SUPI as specified
in clause 6.1.2.2.4 of TS 23.503 [20].
5a. The V-PCF sends the Service Parameters including the mapped HPLMN S-NSSAI
values to the H-PCF and subscribes to the result of the delivery of UE
Policies if the delivery result was requested by the AF, using the event
reporting on \"Notification on outcome of UE Policies delivery\" described in
clause 6.1.3.18 of TS 23.503 [20].
NOTE: The AMF determines whether LBO is allowed and performs SMF selection to
select the SMF in VPLMN for LBO case as described in clause 6.3.2 of TS 23.501
[2].
The H-PCF requests V-PCF to notify the result of UE policy delivery to the UE.
6\. The H-PCF generates new or updated URSP Rules considering the Service
Parameters received from the V-PCF in step 5a as specified in clause 6.1.2.2.4
of TS 23.503 [20].
7-8. Steps 7-8 of Figure 4.15.6.7.2-1 apply with the following differences:
\- Notification is sent from V-PCF to the AF belonging to the VPLMN or third
party with agreement with VPLMN.
#### 4.15.6.7a Authorization of service specific parameter provisioning
Figure 4.15.6.7a-1 shows the procedure to authorize the service specific
parameter provisioning requests (e.g. for Application guidance for URSP
determination as defined in clause 4.15.6.10).
Figure 4.15.6.7a-1: Service Specific Authorization for an individual UE or
group of UEs
1\. The AF initiates the procedure as specified in clause 4.15.6.7.
2\. The NEF sends Nudm_ServiceSpecificAuthorisation_Create Request including
the GPSI or External Group Id, S-NSSAI/DNN, service type, (optional) AF ID,
(optional) MTC Provider Information and notification address to receive
updates of the authorization from UDM.
3\. The UDM maps the GPSI or External Group Id included in the request from
the NEF to SUPI or Internal Group Id.
If the request is for an individual UE, the UDM checks the list of
subscribed/allowed S-NSSAI/DNNs for the UE and other service info (e.g. MTC
provider is authorized for the UE).
If the request is for a group of UEs, the UDM checks whether the group related
data (e.g. DNN/S-NSSAI group related data, see table 4.15.6.3b-1) and other
service info, e.g. MTC provider is authorized for the group.
4\. The UDM responds to the NEF with the service authorization result. If
authorization succeeds, the UDM includes the SUPI or Internal Group Id mapping
the GPSI or External Group Id provided by the NEF.
If authorization fails (e.g. DNN is not subscribed for the UE or it is
different from the group related data, UE subscription or group related data
does not allow to modify URSP rules dynamically by an AF or by such specific
AF or MTC provider), UDM returns a negative response with an appropriate error
code and the NEF rejects the request with the proper error code to inform the
AF about the request not authorized.
NOTE 1: The MTC Provider Information can be used by any type of Service
Providers (MTC or non-MTC) or Corporate or External Parties for, e.g. to
distinguish their different customers.
5\. The procedure continues as specified in clause 4.15.6.7.
Figure 4.15.6.7a-2 illustrates the procedure for updating or revoking an
existing Service Specific Authorization.
Figure 4.15.6.7a-2: Service Specific Authorization Update procedure
0\. UDM provided a successful authorization for a request to provision service
specific parameters as defined in Figure 4.15.6.7a-1. The authorization for
the provisioning of the service specific parameters is modified in UDM (e.g.
due to subscription withdrawal or to the DNN associated to the authorization
being removed from UE subscription).
1\. The UDM sends a Nudm_ServiceSpecificAuthorisation_UpdateNotify Request
(GPSI or External Group Id, SUPI or Internal Group Id, S-NSSAI, DNN, Service
Type, (optional) AF ID, (optional) MTC Provider Information, Status, Cause)
message to the NEF to update a UE\'s or group of UEs\' authorization.
2\. The NEF sends Nudm_ServiceSpecificAuthorisation_UpdateNotify Response
message to the UDM to acknowledge the authorization update.
3\. If the authorization is revoked, the NEF removes the service specific
parameters from the UDR.
4\. The NEF informs the AF that the service parameters authorisation status
has changed by sending Nnef_ServiceParameter_Notify Request (GPSI or External
Group Id, TLTRI, Status, Cause) message to the AF to update the authorization.
5\. The AF responds to the NEF with Nnef_ServiceParameter_Notify Response
message.
#### 4.15.6.8 Set a policy for a future AF session
Figure 4.15.6.8-1: Set a policy for a future AF session
1\. The AF previously negotiated policy for background data transfer using the
Procedure for future background data transfer as described in clause 4.16.7.2.
2\. The AF requests that the previously negotiated policy for background data
transfer be applied to a group of UE(s) or any UE, by invoking the
Nnef_ApplyPolicy_Create service operation (AF Identifier, External Identifier
or External Group Identifier, Background Data Transfer Reference ID). The
Background Data Transfer Reference ID parameter identifies a previously
negotiated transfer policy for background data transfer as defined in clause
4.16.7. The NEF assigns a Transaction Reference ID to the
Nnef_ApplyPolicy_Create request. The NEF authorizes the AF request and stores
the AF Identifier and the Transaction Reference ID.
3\. The NEF invokes Nudm_SDM_Get (Identifier Translation, GPSI) to resolve the
GPSI (External Identifier) to a SUPI or the NEF requests to resolve the
External Group Identifier into the Internal Group Identifier using
Nudm_SDM_Get (Group Identifier Translation, External Group Identifier).
4a. The NEF stores the AF request information in the UDR (Data Set =
Application Data; Data Subset = Background Data Transfer, Data Key = Internal
Group Identifier or SUPI).
4b. The NEF responds to the Nnef_ApplyPolicy_Create Request (Transaction
Reference ID).
5\. The PCF(s) that have subscribed to modifications of AF requests (Data Set
= Application Data; Data Subset = Background Data Transfer, Data Key =
Internal Group Identifier or SUPI) receive(s) a Nudr_DM_Notify notification of
data change from the UDR.
#### 4.15.6.9 Procedures for AF-triggered dynamically changing access and
mobility management policies
##### 4.15.6.9.1 General
Access and mobility management policies may be modified due to several inputs
including the AF as described in clause 4.16.2. Clause 4.15.6.9 describes the
procedures for triggering such modifications in scenarios belonging to \"case
B\" of clause 4.16.2.0 that are initiated by the AF.
The following cases can be distinguished:
\- AF requests targeting an individual UE (identified by its SUPI or GPSI)
without conditions related to the application traffic; these requests are
routed (by the AF or by the NEF) to the PCF for the UE as described in clause
6.2.1.6 of TS 23.503 [20], This case is described in clause 4.15.6.9.2.
\- AF requests targeting an individual UE (identified by its GPSI), a group of
UEs (identified by an Internal Group Identifier or an External Group
Identifier), any UE accessing a combination of DNN and S-NSSAI, or any UE, or
any inbound roaming UEs identified by their home PLMN ID(s) using an
application identified by an External Application Identifier. For such
requests the AF shall contact the NEF and the NEF stores the AF request
information in the UDR. The PCF(s) receive a corresponding notification if
they had subscribed to the creation / modification / deletion of the AF
request information corresponding to UDR Data Keys / Data Sub-Keys. The AF is
not aware if the target UEs are with or without an already established AM
Policy Association and with or without ongoing PDU Sessions. This case is
described in clause 4.15.6.9.3.
NOTE: \"any UE\" refers to the UEs within the PLMN of the NEF.
##### 4.15.6.9.2 Processing AF requests to influence access and mobility
management policies targeting an individual UE
This procedure is used for individual UEs when the request shall be applied
independently of conditions related to the application traffic. Depending on
the AF deployment (see clause 6.2.10 of TS 23.501 [2]), the AF may interact
with NFs of the Core Network either directly or via the NEF. The procedure for
the direct case is described in Figure 4.15.6.9.2â€‘1, while the procedure for
the NEF-mediated case is described in Figure 4.15.6.9.2-2.
Figure 4.15.6.9.2-1: Handling an AF request targeting an individual UE without
using NEF
This procedure concerns only non-roaming scenarios, i.e. to cases where the
involved entities serving the UE (AF, PCF, BSF, AMF) belong to the home PLMN.
1\. An AM Policy Association is established for a UE as described in clause
4.16.1.
2a. The AF searches the PCF for the UE using Nbsf_Management_Subscribe with
SUPI or GPSI as input, indicating that it is searching for the PCF that
handles the AM Policy Association of the UE.
2b. The BSF provides to the AF the identity of the PCF for the UE for the
requested SUPI or GPSI via an Nbsf_Management_Notify operation. If a matching
entry already exists in the BSF when step 2a is performed, this shall be
immediately reported to the AF.
2c. The AF sends to the PCF for the UE its request for influencing the access
and mobility management policy of the UE (identified by SUPI or GPSI) using
Npcf_AMPolicyAuthorization (optionally providing a timer on how long this
policy shall last, in which case the system behaviour upon expiration of this
timer is as specified in TS 23.503 [20]). As part of the
Npcf_AMPolicyAuthorization request, the AF may subscribe (within the Create
and Update operations) or unsubscribe (within the Delete operation) to
relevant events specified in clause 6.1.3.18 of TS 23.503 [20], e.g. events
related to change of service area coverage.
3\. The PCF takes a policy decision and then an AM Policy Association
Modification procedure initiated by the PCF for the UE may be performed as
described in clause 4.16.2.2. If the AF has subscribed to access and mobility
management related events (i.e. request for service area coverage outcome) in
step 2, the PCF reports the event (i.e. outcome of the request for service
area coverage) to the AF.
Figure 4.15.6.9.2-2: Handling an AF request targeting an individual UE using
NEF
This procedure concerns only non-roaming scenarios, i.e. to cases where the
involved entities serving the UE (AF, NEF, PCF, BSF, AMF) belong to the home
PLMN, or the AF belongs to a third party with which the home PLMN has an
agreement.
1\. An AM Policy Association is established for a UE as described in clause
4.16.1.
2a. The AF sends to NEF its request for influencing the access and mobility
management policy of the UE (identified by GPSI) using
Nnef_AMPolicyAuthorization (optionally providing a timer on how long this
policy shall last, in which case the system behaviour upon expiration of this
timer is as specified in TS 23.503 [20]). As part of the
Nnef_AMPolicyAuthorization request, the AF may request to subscribe (within
the Create and Update operations) or unsubscribe (within the Delete operation)
for relevant events specified in clause 6.1.3.18 of TS 23.503 [20], e.g.
events for request for service area coverage outcome. The NEF stores the
request and sends a response to the AF.
2b. The NEF searches the PCF for the UE using Nbsf_Management_Subscribe with
SUPI as input parameter, indicating that it is searching for the PCF that
handles the AM Policy Association of the UE.
2c. The BSF provides to the NEF the identity of the PCF for the UE for the
requested SUPI via an Nbsf_Management_Notify operation. If a matching entry
already exists in the BSF when step 2b is performed, this shall be immediately
reported to the NEF.
2d. The NEF sends to PCF for the UE the request for influencing the access and
mobility management policy of the UE (identified by SUPI) using
Npcf_AMPolicyAuthorization (having potentially translated GPSI to SUPI via
UDM). As part of the Npcf_AMPolicyAuthorization request, the NEF may subscribe
or unsubscribe (according to what the AF requested in step 2a) for relevant
events specified in clause 6.1.3.18 of TS 23.503 [20], e.g. events for change
of service area coverage.
2e. The NEF informs the AF about events to which the AF has potentially
subscribed (i.e. events for change of service area coverage) using
Nnef_AMPolicyAuthorization_Notify.
3\. The PCF takes a policy decision and then an AM Policy Association
Modification procedure initiated by the PCF for the UE may be performed as
described in clause 4.16.2.2. If the AF has subscribed to access and mobility
management related events i.e. request for service area coverage outcome in
step 2, then the PCF reports the event (i.e. outcome of the request for
service area coverage) to the AF as described in clause 4.16.2.2.
##### 4.15.6.9.3 Processing AF requests to influence access and mobility
management policies
With this procedure, the AF can provide its request to influence access and
mobility management policies (for one or multiple UEs) at any time.
Figure 4.15.6.9.3-1: Handling an AF request to influence access and mobility
management policies Policy
This procedure concerns non-roaming scenarios, i.e. to cases where the
involved entities serving the UE (i.e. AF, NEF, PCF, BSF, UDR, AMF) belong to
the home PLMN, or the AF belongs to a third party with which the home PLMN has
an agreement. This procedure concerns also the local breakout roaming case
where the involved entities (i.e. AF, NEF, PCF, BSF, UDR, AMF) serving the UE
belong to the VPLMN or the AF belongs to a third party with which the VPLMN
has an agreement.
The PCF for the UE and the PCF for the PDU Session can be the same entity,
then step 5 is not performed and the PCF itself determines the start/stop of
application traffic or SM policy establishment/termination for a DNN, S-NSSAI
and proceeds with step 6.
1\. AM Policy Association establishment as described in clause 4.16.1.
2\. The PCF for the UE may subscribe to policy data related to AM influence
(Data Set = Application Data; Data Subset = AM influence information, Data Key
= S-NSSAI and DNN and/or (Internal Group Identifier or SUPI or PLMN ID of
inbound roamers)).
3a. To create a new request, the AF provides \"AM influence information\" data
to the NEF using the Nnef_AMInfluence_Create service operation (together with
the AF identifier and potentially further inputs as specified in clause
5.2.6.23.2), including a target (one UE identified by GPSI, a group of UEs
identified by an External Group Identifier, or any UE (for non roaming case),
or any inbound roaming UEs identified by their PLMN ID(s)), a list of (DNN,
S-NSSAI)(s) and optionally a list of External Application Identifier(s) and
requirements related to access and mobility management policies (e.g. service
coverage requirements, throughput requirements). The AF request contains also
an AF Transaction Id and may contain a timer on how long this policy shall
last, in which case the system behaviour upon expiration of this timer is as
specified in TS 23.503 [20]. If with this request the AF subscribes to access
and mobility management related events, the AF indicates also where it desires
to receive the corresponding notifications.
The target \"any UE\" is applicable if an External Application Identifier or
list of (DNN, S-NSSAI) is also provided.
The target \"any inbound roaming UEs identified by their PLMN ID(s)\" is
applicable if an External Application Identifier or list of (DNN, S-NSSAI) is
also provided.
To update or remove an existing request, the AF invokes an
Nnef_AMInfluence_Update or Nnef_AMInfluence_Delete service operation providing
the corresponding AF Transaction Id.
3b. The NEF stores, updates, or removes the policy data of step 3a in the UDR,
having translated any External Group Identifier to an Internal Group
Identifier and any GPSI to a SUPI.
3c. The UDR informs the NEF about the result of the operation of step 3b.
3d. The NEF informs the AF about the result of the Nnef_AMInfluence operation
performed in step 3a.
NOTE 1: Steps 1, 2 and 3 can occur in any order.
4\. The UDR notifies the PCF(s) that have a matching subscription (from step
2) about the data stored, updated, or removed in step 3. If matching entries
already existed in the UDR when step 2 is performed, this shall be immediately
reported to the PCF. The PCF may check that an SM Policy Association is
established for the SUPI, DNN, S-NSSAI then subscribe to the SMF to Policy
Control Request Trigger to detect the application traffic that triggers the
allocation of a service area coverage or an allocation of RFSP index value,
then step 6 follows.
5\. Steps 2 to 10 in Figure 4.16.14.2.1-1 applies if access and mobility
management policies depend on application in use, or steps 2 to 5 in Figure
4.16.14.2.2-1 applies if access and mobility management policies depend on SM
Policy Association establishment and termination for a DNN, S-NSSAI
combination
6\. The PCF for the UE takes a policy decision and then it may initiate an AM
Policy Association Modification procedure as described in clause 4.16.2.2. If
the AF has subscribed to access and mobility management related events, i.e.
request for service area coverage outcome in step 3, then the PCF reports the
event (i.e. outcome of the request for service area coverage) to the AF as
described in clause 4.16.2.2.
NOTE 2: The PCF for the UE can subscribe to the \"start/stop of application
traffic detection\" events for multiple applications with different
application identifiers in the same Npcf_PolicyAuthorization_Subscribe
request. When PCF receives the notifications for multiple applications, the
PCF for the UE can determine which access and mobility management policy to
apply based on local configuration and operator policy.
#### 4.15.6.10 Application guidance for URSP determination
This clause describes the procedures to allow an AF to provide guidance for
URSP determination to 5G system via NEF. The AF may belong to the operator or
to an external party. The PCF may be in the Home PLMN, as it is the PCF that
determines the URSP for the UE, or in the VPLMN and then the Application
guidance for URSP determination is provided to the PCF in the HPLMN via the
PCF of the VPLMN. The PCF in the VPLMN translates the Service Parameters
values provided by the AF for inbound roamer to values applicable to the
HPLMN, e.g. S-NSSAI as described in TS 23.503 [20].
NOTE 1: The operator can negotiate with external party (typically a Corporate
represented by an AF) dedicated DNN(s) and/or S-NSSAI(s) for the traffic of
UE(s) of this external party. UE(s) of the external party can be identified by
a group identifier.
The guidance for URSP determination may be used to provide 5GC with guidance
for the URSPs depending on the UE location. This is further described in TS
23.548 [74].
For providing guidance for URSP determination, the procedure defined in clause
4.15.6.7 is performed with the following considerations:
1) Service Description indicates an AF Identifier.
2) Service Parameters.
Information on the AF guidance for URSP determination which consists of a list
of URSP rules that associate an application traffic descriptor with requested
features for the candidate PDU sessions the application traffic may use:
\- An application traffic descriptor, whose definition corresponds to that of
the URSP Traffic Descriptors (as defined for the URSP rule in TS 23.503 [20]
Table 6.6.2.1-2).
\- one or more sets of Route selection parameters, each parameter may
correspond to:
\- (DNN, S-NSSAI). This may be provided by the AF or determined by the NEF
based on the AF Identifier when it is not provided by the AF and the AF
provides only one instance of AF guidance for URSP determination.
\- Requested PDU session type.
Editor\'s note: It is FFS whether the AF can provide SSC mode.
\- a default Route selection precedence value to be used for the application
traffic when Route selection precedence with a corresponding spatial validity
condition is not provided.
\- Route selection precedence with a corresponding spatial validity condition
that indicates where the Route selection parameters apply. This may correspond
to a geographical area (e.g. a civic address or shapes).
\- VPLMN ID(s) that indicates the PLMN(s) where the AF guidance on URSP
determination and all its RSD(s), applies.
NOTE 2: The different sets of Route selection parameters indicate different
sets of PDU Session information (DNN, S-NSSAI) that can be associated with
applications matching the application traffic descriptor. Each set is meant to
apply for a specific (set of) spatial validity condition. Each set is
associated with a Route selection precedence to cope with the case where
multiple spatial validity conditions overlap.
If the AF provides a geographical area as spatial validity condition, it is up
to the NEF to transform this information into 3GPP identifiers (e.g. TAI(s)).
When AF provides application guidance for URSP determination for PIN service,
the application traffic descriptor includes PIN ID as specified in Table
6.6.2.1-2 of TS 23.503 [20].
NEF may, based on local configuration, complement missing service parameters.
Additionally, based on operator\'s local policy, NEF may request UDM for
service specific authorization for the service parameters for an individual UE
(e.g. to authorize the Corporate or MTC provider represented by the AF and the
requested DNN, S-NSSAI for the related UE) before storing the service
parameters into the UDR. If the request is targeting a group of UEs, NEF may
also request UDM for service specific authorization for the group related data
(see table 4.15.6.3b-1), i.e. the DNN, S-NSSAI associated to the group. If the
request is targeting any UE (all UEs), NEF authorizes the request based on
local policy (e.g. based on AF Id) without requesting for any service specific
authorization from UDM. NEF requests UDM for service specific authorization
for the service parameters provisioned via the
Nudm_ServiceSpecificAuthorisation_Create service operation as defined in
clause 4.15.6.7a.
If a group of UEs or any UE is requested, each individual UE authorization is
performed at a later stage by PCF.
NOTE 3: The operator needs to ensure the consistency between the group related
data and the UE group members subscription data, i.e. if a group is authorized
for a given DNN/S-NSSAI as defined in the group related data, it needs to be
ensured that all UE members of the group are provisioned with such
DNN/S-NSSAI, since no individual UE check is required to be done by NEF
against UDM.
NOTE 4: AF guidance for application traffic is not related with 5G VN group.
3) The Target UE identifier(s) that may be a specific UE, identified by a
GPSI, or a group of UE(s), identified by an External-Group-ID, or any UE of
the PLMN of the NEF, or the PLMN ID(s) of inbound roamers that the AF request
may be associated with.
The information on the AF guidance for URSP determination provided by the AF
may be associated to:
a) UEs of the PLMN (of the NEF) when roaming in other PLMNs. In this case, the
AF guidance for URSP determination targets to a specific UE, a group of UEs or
any UE of the PLMN. In this case, the AF guidance for URSP determination
associated to a specific UE, a group of UEs or any UE of the PLMN shall be
also associated with the corresponding VPLMN(s) where the AF guidance for URSP
determination shall be applied if the UE roams to that VPLMN(s). The list of
VPLMN ID(s) is included in the Service Parameters.
b) An inbound roamer from one or more PLMN(s). In this case, the AF targets
the AF guidance for URSP determination only with the inbound roamers of
corresponding PLMN(s). The PLMN ID is included in the Service Parameters.
NOTE 5: Wildcarding of \"PLMN ID of inbound roamers\" will be handled by stage
3.
4) Subscription to events.
The AF may subscribe to notifications about the outcome of the UE Policies
delivery due to application guidance for URSP determination.
The usage of the AF guidance for application traffic is described in clause
6.6 of TS 23.548 [74].
#### 4.15.6.11 Void
#### 4.15.6.12 Parameter Provisioning when the UE is identified via UE
addressing information
Handling of Parameter Provisioning requests targeting an individual UE when
the UE is identified via UE addressing information is described in clause
4.15.3.2.13. Once this has taken place, the Parameter Provisioning as
described in other (sub)clauses of clause 4.15.6 may apply.
#### 4.15.6.13 Multi-member AF session with required QoS
##### 4.15.6.13.1 General Descriptions
This clause describes the procedure to request QoS and to perform QoS
monitoring for the traffic flows for the communication between an AF and a set
of UEs, identified by the list of UE address(es). For every UE in the set,
this list contains the IP address and the port number that is used by the UE
for the communication with the AF.
The NEF receives the request for a Multi-member AF session with required QoS
for a set of UEs identified by their addresses. The NEF then maps the request
for Multi-member AF session with required QoS to individual requests for AF
session with required QoS (i.e., one request for individual AF session with
required QoS per UE address) and interacts with each of the UE\'s serving PCFs
on a per AF session basis. The interaction follows the AF session with
required QoS procedure as described in clauses 4.15.6.6 and 4.15.6.6a, except
for the involvement of the TSCTSF and the provisioning of TSCTSF related
information.
The NEF receives the outcome of the individual requests for AF session with
required QoS corresponding to each UE\'s IP address and consolidates them into
a single response before forwarding it to the AF based on an NEF configured
time (which could be set to zero).
NOTE 1: The consolidation and the NEF configured time allow the optimization
of the NEF to AF signalling according to the specifics of the Multi-member AF
session with required QoS. Multiple responses could be sent by an NEF (as RAN
nodes may responds late or signalling messages may get lost) and the details
of the NEF behaviour (with respect to the handling of UE addresses for which
no response has been received within the NEF configured time) are to be
defined by stage 3.
The AF can subscribe to QoS Monitoring (as described in clause 5.45 of TS
23.501 [2]) for the Multi-member AF session with required QoS. If so, QoS
monitoring will be activated by the NEF for the whole set of UEs by
interacting with each of the UE\'s serving PCFs on a per AF session basis. If
the AF request contains QoS monitoring information without an indication of
direct event notification, the NEF shall include that indication in the
request to ensure that QoS Monitoring reports shall be sent by the UPF
directly to the NEF. The NEF forwards the QoS Monitoring reports to the AF
together with the respective UE address individually or, optionally, in an
aggregated manner based on an NEF configured time.
When the AF subscribes to QoS Monitoring of UL and/or DL data rate (as
described in clause 5.45 of TS 23.501 [2]) for the set of UEs, the AF may
provide a Consolidated Data Rate threshold that is stored in the NEF. The
Consolidated Data Rate threshold defines the upper bound of the aggregated
data rate across all traffic flows corresponding to the list of UEs addresses
of the Multi-member AF session with required QoS. The AF may provide in
addition a specific list of UE addresses subject to Consolidated Data Rate
monitoring (which has to be the subset of the general list of UE addresses),
if only a part of the UEs participate in the current communication with the AF
and the NEF maintains this list as well. The NEF aggregates the UE\'s QoS
Monitoring reports for Data Rate for those UE addresses that appear in the
specific list of UE addresses subject to Consolidated Data Rate monitoring, if
available, and otherwise, for all UE addresses that appear in the general list
of UE addresses maintained in the NEF for the Multi-member AF session with
required QoS. The respective UE\'s QoS Monitoring reports for Data Rate will
then be sent to the AF by NEF, only if the aggregated data rate exceeds the
Consolidated Data Rate threshold.
The following Table 4.15.6.13.1-1 describes the 4 types of requests for the
Multi-member AF session with required QoS and the corresponding NEF requests
to PCF using Npcf_PolicyAuthorization service. There may be different PCFs
serving the PDU Sessions belonging to the UE addresses in the
Nnef_AFSessionWithQoS Request.
Table 4.15.6.13.1-1: Mapping of requests for Multi-member AF session with
required QoS service to the corresponding Npcf_PolicyAuthorization service
request
+--------------------------------+------------------------------------+ | Nnef_AFSessionWithQoS Request | Npcf_PolicyAuthorization request | +================================+====================================+ | Create | Npcf_PolicyAuthorization Create | | | request for each UE address | | | received in the | | | Nnef_AFSessionWithQoS Request. | | | | | | Npcf_PolicyAuthorization | | | Subscribe to request QoS | | | Monitoring for each QoS Monitoring | | | request received in the | | | Nnef_AFSessionWithQoS Request. | +--------------------------------+------------------------------------+ | Update | Npcf_PolicyAuthorization Update | | | request to update the QoS and/or | | | QoS monitoring which may include | | | the Consolidated Data Rate | | | monitoring received in the | | | Nnef_AFSessionWithQoS_Update | | | Request. | | | | | | Npcf_PolicyAuthorization Create | | | request for each added UE address | | | received in the | | | Nnef_AFSessionWithQoS Request. | | | | | | Npcf_PolicyAuthorization Delete | | | request for each removed UE | | | address received in the | | | Nnef_AFSessionWithQoS Request. | | | | | | Npcf_PolicyAuthorization | | | Subscribe to request QoS | | | Monitoring for each new QoS | | | Monitoring request received in the | | | Nnef_AFSessionWithQoS Request. | | | | | | More than one of the above | | | operations can be requested at the | | | same time. | +--------------------------------+------------------------------------+ | Revoke | Npcf_PolicyAuthorization Delete | | | request for each UE address | | | received in the | | | Nnef_AFSessionWithQoS Request. | +--------------------------------+------------------------------------+ | Notify | Npcf_PolicyAuthorization Notify | | | to report the events that NEF | | | subscribed to. | +--------------------------------+------------------------------------+
NOTE 2: It is expected that the AF requests QoS and QoS monitoring for a
specific traffic flow (used for the communication between a UE address and the
AF) with either the procedure for Multi-member AF session with required QoS
(described in this clause) or the procedure for AF session with required QoS
as described in clause 4.15.6.6 and 4.15.6.6a.
##### 4.15.6.13.2 Procedures for Creating a Multi-member AF session with
required QoS
Figure 4.15.6.13.2-1: Procedures for creating a Multi-member AF session with
required QoS
1\. The AF sends a request to reserve resources for the traffic flows for the
communication between a set of UEs and an AF, using
Nnef_AFsessionWithQoS_Create request message (a list of UE addresses, AF
Identifier, Flow description information or External Application Identifier,
QoS Reference or individual QoS parameters, Alternative Service Requirements
(as described in clause 6.1.3.22 of TS 23.503 [20]), QoS parameter(s) to be
measured, Reporting frequency, Target of reporting, optional an indication of
local event notification, DNN, S-NSSAI) to the NEF. The AF may, instead of a
QoS Reference, provide one or more of the following individual QoS parameters:
Requested 5GS Delay (optional), Requested Priority (optional), Requested
Guaranteed Bitrate, Requested Maximum Bitrate, Maximum Burst Size and
Requested Packet Error Rate. The optional Alternative Service Requirements
provided by the AF shall either contain QoS References or Requested
Alternative QoS Parameter Set(s) in a prioritized order as described in clause
6.1.3.22 of TS 23.503 [20]. The AF may provide QoS parameter(s) to be measured
as defined in clause 5.45 of TS 23.501 [2], Reporting frequency, Target of
reporting, optional an indication of local event notification as described in
clause 6.1.3.21 of TS 23.503 [20].
The AF may also provide the Consolidated Data Rate threshold and optionally, a
list of UE addresses subject to Consolidated Data Rate monitoring. If so, the
AF shall also subscribe to QoS Monitoring of UL and/or DL data rate described
in clause 5.45 of TS 23.501 [2] .
NOTE 1: When the Consolidated Data Rate threshold is provided, it, by default,
applies to the list of UE addresses associated with the Multi-member AF
session with required QoS. However, if the specific list of UE addresses
subject to Consolidated Data Rate monitoring is also provided together with
the Consolidate Data Rate threshold, then such list has to be the subset of
the list of UE addresses.
2\. The NEF authorizes the AF request that contains a list of UE addresses and
may apply policies to control the overall amount of QoS authorized for the AF.
If the authorisation is not granted, all steps (except step 8) are skipped and
the NEF replies to the AF with a Result value indicating that the
authorisation failed. The NEF assigns a Transaction Reference ID to the
Nnef_AFsessionWithQoS_Create request. The NEF activates Consolidated Data Rate
monitoring only when both the Consolidated Data Rate threshold and a request
to do QoS Monitoring of data rate are provided by the AF.
2a. If the NEF recognizes, based on configuration, that the IP address(es)
received in the list of UE addresses are different from the IP address(es)
assigned by 5GC (i.e. the UE(s) are behind a NAT in UPFs), the NEF performs
steps 3 to 6 of the AF specific UE ID retrieval procedure defined in clause
4.15.10 for each UE IP address with port number in order to identify the
corresponding IP address (and IP domain, if necessary) that has been assigned
by the 5GC. The NEF then uses the respective corresponding IP address (and IP
domain, if necessary) in the following steps instead of the UE IP address
provided by the AF.
3-4. The NEF finds BSF serving the UE IP address(es) using NRF and then for
each UE IP address, the NEF uses Nbsf_Management_Discovery service operation,
providing the UE IP address, to discover the responsible PCF for each of the
PDU Sessions.
Steps 5-7 apply for each UE address in the list of UE addresses.
5\. The NEF provides the UE address and the received parameters in step 1 to
the PCF in the Npcf_PolicyAuthorization_Create request. If the request
contains QoS monitoring information without an indication of direct event
notification, the NEF shall include that indication in the request to ensure
that QoS Monitoring reports shall be sent by the UPF directly to the NEF.
6\. Step 4 in Figure 4.15.6.6-1 applies. The PCF generates authorized QoS
Monitoring policy according to the QoS Monitoring information if received from
the NEF in step 5 and provides PCC rules with the policy to the SMF as
described in clause 6.1.3.21 of TS 23.503 [20]. The SMF configures the UPF to
perform QoS Monitoring as described in clause 5.8.2.18 of TS 23.501 [2].
7\. The PCF sends the Npcf_PolicyAuthorization_Create response message to the
NEF.
8\. The NEF aggregates the authorization responses from the PCFs and sends a
Nnef_AFsessionWithQoS_Create response message (Transaction Reference ID,
Result for list of UE addresses) with the aggregated authorization responses
to the AF. Result for list of UE addresses includes whether the authorization
was successful or has failed for every UE address in the list. The NEF stores
the list of UE addresses for which the authorization was successful together
with the Transaction Reference ID, the QoS and the QoS monitoring information.
Steps 9-10 apply for each UE address in the list of UE addresses.
9\. Step 6 in Figure 4.15.6.6-1 applies.
10\. Step 7 in Figure 4.15.6.6-1 applies.
11\. The NEF aggregates the notifications from the PCFs and sends a
Nnef_AFsessionWithQoS_Notify message (Transaction Reference ID, Result for
list of UE addresses) with the aggregated resource allocation status events to
the AF. Result for list of UE addresses includes, for every UE address in the
list, the information whether resources are allocated, resources are not
allocated or resources are allocated while the currently fulfilled QoS matches
an Alternative Service Requirement. The NEF updates the locally stored list of
UE addresses by removing any UEs for which resources could not be allocated.
NOTE 2: For those UE address(es) that did not get any resources, the AF may
request resource reservation again, by adding them to the list of UE
address(es) as described in clause 4.15.6.13.3.
12\. As direct event notification is requested based on the parameters
received in step 5, the QoS Monitoring events are reported by the UPF(s) to
the NEF using Nupf_EventExposure service as described in clause 5.2.26.2.
13\. When the NEF receives QoS Monitoring events, the NEF sends
Nnef_AFsessionWithQoS_Notify message with the individual or aggregated QoS
Monitoring events to the AF as described for the QoS Monitoring and the
Consolidated Data Rate monitoring in clause 4.15.6.13.1.
The AF may send Nnef_AFsessionWithQoS_Revoke request containing the
Transaction Reference ID to the NEF in order to revoke the Multi-member AF
session with required QoS related to the Transaction Reference ID. The NEF
authorizes the revoke request and triggers the Npcf_PolicyAuthorization_Delete
and the Npcf_PolicyAuthorization_Unsubscribe operations towards the respective
PCF(s) for every UE in the list of UE address(es) associated with the
Transaction Reference ID.
##### 4.15.6.13.3 Procedure for updating a Multi-member AF session with
required QoS
Figure 4.15.6.13.3-1: Procedure for updating a Multi-member AF session with
required QoS
1\. The AF which controls the Multi-member AF Session with required QoS
invokes the Nnef_AFSessionWithQoS_Update Request to update the list of UE
addresses and/or to update the QoS and/or to update the QoS monitoring and/or
to update the Consolidated Data Rate monitoring.
The Nnef_AFSessionWithQoS_Update request includes the Transaction Reference ID
and one or more of the parameters that are listed in step 1 of the procedure
for creating a Multi-member AF session with required QoS in clause 4.15.6.13.2
which the AF needs to update (or provide for the first time).
NOTE 1: For example, the AF can subscribe to QoS monitoring or Consolidated
Data Rate monitoring for the Multi-member AF session with required QoS if this
has not been done during the procedure for creating a Multi-member AF session
with required QoS, as described in clause 4.15.6.13.2.
NOTE 2: If AF needs to terminate the Consolidated Data Rate monitoring for the
Multi-member AF session with required QoS, the AF does not include the
Consolidate Data Rate threshold in the AF request.
2\. The NEF authorizes the AF request and may apply policies to control the
overall amount of QoS authorized for the AF. If the authorisation is not
granted, all following steps are skipped and the NEF replies to the AF with a
Result value indicating that the authorisation failed. The NEF performs
Consolidated Data Rate monitoring only when both the Consolidated Data Rate
threshold and a request to do QoS Monitoring of data rate are provided by the
AF.
3-5. When the AF provides an Nnef_AFSessionWithQoS_Update Request in order to
add/update/remove the Consolidated Data Rate threshold or the list of UE
addresses subject to Consolidated Data Rate monitoring, the NEF updates its
local context and does not interact with the PCF(s) (unless required for
reasons described in the following).
When the AF provides an Nnef_AFSessionWithQoS_Update Request in order to
update the list of UE addresses, to update the QoS and/or to update the QoS
monitoring, the NEF refers to the locally stored information (i.e. the list of
UE addresses, the QoS and the QoS monitoring information) and determines which
new UE address is to be added to the list, which of the existing UE address is
to be removed from the list and/or for which of the existing UE address(es)
the QoS or the QoS monitoring (or both) is to be updated. Then, the NEF
continues by invoking one of the following Npcf_PolicyAuthorization procedures
for every affected UE address:
a) If the NEF determines that a new UE is to be added to the list, the NEF
performs steps 2a to 7 of clause 4.15.6.13.2 for the corresponding UE. The NEF
uses the latest information on QoS and QoS monitoring for the interaction with
the PCF. The NEF adds the address of the new UE to the locally stored list of
UE addresses if the authorization was successful.
b) If the NEF determines that an existing UE is to be removed from the list,
the NEF initiates the Npcf_PolicyAuthorization_Delete as described in clause
5.2.5.3.4 excluding TSCTSF related info towards the PCF for the corresponding
UE. The NEF removes the UE address from the locally stored list of UE
addresses.
c) If the NEF determines that an update of the QoS or the QoS monitoring or
both for existing UE addresses is necessary, the NEF initiates the
Npcf_PolicyAuthorization_Update to the respective UE\'s serving PCF(s) on a
per AF session basis and step 4 in Figure 4.15.6.6a-1 applies. The NEF removes
any UE addresses for which the authorization of the update request has failed
from the list of UE addresses. The NEF stores any change to the QoS or the QoS
monitoring information.
6\. When an interaction with PCF(s) has occurred during step 5, the NEF
aggregates the authorization responses from the PCF(s) and sends the
Nnef_AFSessionWithQoS Update response (Transaction Reference ID, Result for
list of UE addresses) with the aggregated authorization results to the AF.
Result for list of UE addresses includes whether the request is granted or not
for every UE address in the list.
When no interaction with PCF(s) has occurred during step 4 and 5, the NEF
sends the Nnef_AFSessionWithQoS Update response (Transaction Reference ID,
Result) with the result of the Consolidated Data Rate monitoring related
change to the AF.
7\. For every UE address that has been added to the locally stored list of UE
addresses, the NEF shall send a Npcf_PolicyAuthorization_Subscribe message to
the respective PCF(s) to subscribe to notifications of Resource allocation
status and may subscribe to other events described in clause 6.1.3.18 of TS
23.503 [20]. If an update of event subscription is requested by the AF, the
NEF updates the event subscription with the respective PCF(s) for every UE
address in the locally stored list of UE addresses.
8\. Step 7 in Figure 4.15.6.6-1 applies, at least for those UE addresses for
which the establishment or update of transmission resources was requested by
the PCF(s).
9\. When the establishment or update of transmission resources occurs, the NEF
receives Npcf_PolicyAuthorization_Notify messages from the UE\'s serving
PCF(s) about the Resource allocation status. The NEF aggregates the
notifications from the respective UEs\' serving PCFs before notifying the AF
with a Nnef_AFSessionWithQoS_Notify message (Transaction Reference ID, Result
for list of UE addresses). Result for list of UE addresses includes, for every
UE address in the list, the information whether resources are allocated,
resources are not allocated or resources are allocated while the currently
fulfilled QoS matches an Alternative Service Requirement. The NEF updates the
locally stored list of UE addresses by removing any UEs for which resources
could not be allocated.
NOTE 3: For those UE address(es) that did not get any resources, the AF may
request resource reservation again, by adding them to the list of UE
address(es) as described in clause 4.15.6.13.3.
10\. As direct event notification is requested, the UPF(s) provide the QoS
Monitoring events to the NEF using Nupf_EventExposure service as described in
clause 5.2.26.2.
11\. When the NEF receives QoS Monitoring events, the NEF sends
Nnef_AFsessionWithQoS_Notify message with the individual or aggregated QoS
Monitoring events to the AF as described for the QoS Monitoring and the
Consolidated Data Rate monitoring in clause 4.15.6.13.1.
##### 4.15.6.13.4 Procedure for Revoking a Multi-member AF session with
required QoS
Figure 4.15.6.13.4-1: Procedure for revoking a Multi-member AF session with
required QoS
1\. The AF sends a request to revoke the allocated resources for the traffic
flows for the communication between a set of UEs and an AF, using
Nnef_AFsessionWithQoS_Revoke request message (Transaction Reference ID).
2\. The NEF authorizes the AF request.
3\. The NEF provides the UE address and the received parameters in step 1 to
the PCF in the Npcf_PolicyAuthorization_Delete request as described in clause
5.2.5.3.4 excluding TSCTSF related info for the corresponding UE.
4\. The PCF requests SMF to proceed the SM Policy Association Modifications
procedure as defined in clause 4.16.5.2.
5\. The PCF sends the Npcf_PolicyAuthorization_Delete response message to the
NEF.
6\. The NEF sends the Nnef_AFsessionWithQoS_Revoke response message
(Transaction Reference ID) to the AF.
#### 4.15.6.14 Procedures for AF requested QoS for a UE or group of UEs not
identified by a UE address
Figure 4.15.6.14-1: Procedure for AF requested QoS for a UE or group of UEs
not identified by a UE address
0\. When a new PDU Session is established, based on local configuration
associated with the DNN/S-NSSAI, the PCF determines if the PDU Session needs
involvement of TSCTSF. If the TSCTSF is used the PCF invokes
Npcf_PolicyAuthorization_Notify service operation to the TSCTSF discovered and
selected as described in clause 6.3.24 of TS 23.501 [2]. The
Npcf_PolicyAuthorization_Notify service operation includes the UE address of
the PDU Session and DNN/S-NSSAI. If the TSCTSF is not used, the PCF subscribes
to notifications for Application Data from UDR.
NOTE: In the case of private IPv4 address being used for the UE, the DNN and
S-NSSAI are required for session binding in the PCF.
The PCF registers to BSF as described in TS 23.503 [20]. When the TSCTSF is
used, the TSCTSF invokes a Npcf_PolicyAuthorization_Create request message to
the PCF and stores the DNN, S-NSSAI and IP address as received from PCF and
SUPI as received from BSF and associates them with the AF-session.
1\. The AF sends a request to reserve resources using
Nnef_AF_Request_QoS_Create request message (GPSI or External Group ID, AF
Identifier, Flow description(s) or External Application Identifier, QoS
reference or individual QoS parameters, Alternative Service Requirements (as
described in clause 6.1.3.22 of TS 23.503 [20]), DNN, S-NSSAI) to the NEF.
Optionally, a period of time or a traffic volume for the requested QoS can be
included in the AF request. The AF may, instead of a QoS Reference, provide
the individual QoS parameters. Regardless, whether the AF request is
formulated using a QoS Reference or Individual QoS paramaters, the AF may also
provide one or more of the parameters that describe the traffic
characteristics as described in clause 6.1.3.23 or 6.1.3.23a of TS 23.503
[20]. The optional Alternative Service Requirements provided by the AF shall
either contain QoS References or Requested Alternative QoS Parameter Set(s) in
a prioritized order as described in clause 6.1.3.22 of TS 23.503 [20].
2\. This step is the same as step 2 in clause 4.15.6.6.
3\. This step is the same as steps 2-4 in clause 4.15.6.10.
The NEF determines whether to invoke the TSCTSF or not, as described in step 3
in clause 4.15.6.6. If the NEF determines to invoke TSCTSF, steps 4-9 are
executed and steps 10-12 are skipped. Otherwise steps 4-9 are skipped and
steps 10-12 are executed. The procedure then continues in step 13.
4\. This step is the same as step 3a in clause 4.15.6.6 with the difference
that Internal Group ID or SUPI is provided instead of UE address.
5\. The TSCTSF determines the individual group members using Nudm SDM Group
Identifier translation service. The TSCTSF also determines which of these
group members have active PDU Sessions matching the DNN/S-NSSAI and determines
the relevant UE address. The TSCTSF manages the AF request QoS information
targeting for a group as defined in TS 23.501 [2].
6\. For each PDU Session, the TSCTSF invokes Npcf_PolicyAuthorization service.
This step is the same as step 3b in clause 4.15.6.6.
7\. The PCF replies to the TSCTSF. This step is the same as step 4a in clause
4.15.6.6.
8\. The TSCTSF replies to the NEF. This step is the same as step 4b in clause
4.15.6.6.
9\. This step is the same as step 6 in clause 4.15.6.6 with the difference
that it is executed for all PDU Sessions identified in step 6 above.
10\. If the NEF determines to not invoke the TSCTSF, the NEF uses the Nudr_DM
service to store the information related to the Internal Group ID or SUPI in
UDR. The information is stored as Application Data in UDR. If the AF requested
for notifications of Resource allocation status or other events, the NEF
includes the information required for reporting the event, including the
Notification Target Address pointing to the NEF or AF and the Notification
Correlation ID containing the AF Transaction Internal ID.
11\. The UDR notifies the PCF(s) that have subscribed.
12\. The PCF(s) identifies the active PDU Sessions associated with the data
received from UDR. The PCF(s) manages the AF request QoS information targeting
for a group as defined in TS 23.503 [20].
13\. The NEF replies to the AF. This step is the same as step 8 in clause
4.15.6.6.
14\. When an event condition is met, e.g. that the establishment of the
transmission resources corresponding to the QoS update succeeded or failed,
the PCF sends a notification to TSCTSF or NEF as applicable. This step is the
same as steps 7-8 in clause 4.15.6.6.
### 4.15.7 Network status reporting
This clause contains the detailed description and the procedures for the
network status reporting capability.
An AF may request for being notified about the network status, in a specific
geographical area or for a specific UE.
The following methods are supported:
\- The AF requests to be informed, one-time, about the network status. This
procedure is referred to as one-time network status request;
\- The AF requests to be informed, continuously, about the network status.
This procedure is referred to as continuous network status request;
The procedure as described in clause 6.1.1.2 or clause 6.1.2.2 of TS 23.288
[50] is used by an AF to retrieve Network Status Result (NSR) from the network
for a specific geographical area or for a specific UE.
After receiving the request for network status notification from the AF, the
NEF retrieves user data congestion analytics information from NWDAF, as
defined in TS 23.288 [50].
Based on the user data congestion analytics information the NEF receives from
the NWDAF, the NEF derives and reports the network status for the geographical
area or for the UE as Network Status Result (NSR) to the AF. When reporting to
the AF, the NSR shall not include any 3GPP location information.
NOTE 1: Either exact values for congestion status, as reported by NWDAF to NEF
or abstracted values e.g. (High, Medium, Low) can be reported by the NEF to
the AF. The calculation and the reporting of the NSR to the AF depends on
operator configuration (e.g. SLAs, usage etc.).
When an AF requests one-time Network Status from the NEF, the NEF can
optionally provide a time interval at which the AF is allowed to re-issue the
same request for network status.
NOTE 2: The time interval provided by NEF can be ignored by the AF if the
subsequent request on network status is considerably different with regards to
the geographical area or the UE.
### 4.15.8 Event exposure controlled by a DCCF
A DCCF can coordinate the subscriptions and notifications to event exposure in
Network Functions. This is further described in TS 23.288 [50].
### 4.15.9 Time Synchronization exposure
#### 4.15.9.1 General
Time synchronization exposure allows an AF to configure time synchronization
in 5GS. For (g)PTP operation, the Time synchronization service allows an AF to
subscribe to the UE and 5GC capabilities and availability for time
synchronization service (as described in clause 4.15.9.2), to configure the
(g)PTP instance in 5GS as described in clause 4.15.9.3 and monitor service
status as described in clause 4.15.9.5. For 5G access stratum based time
distribution, the AF can influence the 5G access stratum time distribution as
described in clause 4.15.9.4 and monitor service status as described in clause
4.15.9.5. The time synchronization exposure is provided by NEF that uses the
service provided by TSCTSF. The AF that is part of operator\'s trust domain
may invoke the services directly with TSCTSF and TSCTSF responds/notifies
directly to the AF, accordingly.
NOTE: The AF can use either the procedure for configuring the (g)PTP instance
in 5GS as described in clause 4.15.9.3 or the procedure for controlling the 5G
access stratum time distribution as described in clause 4.15.9.4 for a
particular UE. The procedures are not intended to be used in conjunction with
each other by the AF. However, the (g)PTP instance activation, modification
and deactivation can influence the 5G AS time distribution for the UEs that
are part of the impacted PTP instance.
#### 4.15.9.2 Exposure of UE availability for Time Synchronization service
The procedure is used by the AF to subscribe to notifications and to
explicitly cancel a previous subscription for UE availability for time
synchronization service. Cancelling is done by sending
Nnef_TimeSynchronization_CapsUnsubscribe request identifying the subscription
to cancel with Subscription Correlation ID.
Figure 4.15.9.2-1: Procedure for exposing 5GS and/or UE availability and
capabilities for Time Synchronization services
1\. Upon PDU Session establishment, the PCF determines if the PDU Session is
potentially impacted by time synchronization service (based on local
configuration or 5GS Bridge/Router information event from SMF as described in
SM Policy Association Establishment procedure in clause 4.16.4). In this case
the PCF invokes Npcf_PolicyAuthorization_Notify service operation to the
TSCTSF discovered and selected as described in clause 6.3.24 of TS 23.501 [2].
The Npcf_PolicyAuthorization_Notify service operation includes the UE address
of the PDU Session and DNN/S-NSSAI.
NOTE: In the case of private IPv4 address being used for the UE, the DNN and
S-NSSAI are required for session binding in the PCF.
The PCF registers to BSF as described in TS 23.503 [20]. TSCTSF invokes a
Npcf_PolicyAuthorization_Create request message to the PCF and stores the DNN,
S-NSSAI and IP address as received from PCF and SUPI as received from BSF and
associates them with the AF-session.
If PMIC/UMIC information from the DS-TT or NW-TT is available at the PCF, the
PCF reports it to the TSCTSF invoking Npcf_PolicyAuthorization_Notify.
2\. The AF subscribes to the UE availability for time synchronization service
and provides the associated Notification Target Address of the AF by sending
Nnef_TimeSynchronization_CapsSubscribe request.
Report Type defines the type of reporting requested (e.g. one-time reporting,
periodic reporting or event based reporting).
The request may include DNN and slicing information (S-NSSAI) and shall
include an AF-Service-Identifier. If the DNN and S-NSSAI are omitted in the
request, the NEF uses the AF-Service-Identifier to determine the target DNN
and slicing information (S-NSSAI).
The Event Filter may include a list of UE identities (GPSIs) or Groups of UEs
identified by an External Group Identifier that further define the subset of
the target UEs. If the request does not include UE identities nor External
Group Identifier, the request is targeted to any UE with a PDU Session using
the DNN and S-NSSAI. The NEF forwards the GPSIs or the External Group
Identifier to the TSCTSF by including them/it inside the
Ntsctsf_TimeSynchronization_CapsSubscribe request.
Additionally, the Event Filter may include one or more of the requested PTP
instance type, requested transport protocol for PTP, or requested PTP Profile
as described in Table 5.2.6.25.6-1.
When the NEF processes the AF request the AF-Service-Identifier may be used to
authorize the AF request.
Depending on the AF-Service-Identifier and/or DNN/S-NSSAI, the NEF may reject
the request if the list of UE identities or External Group Identifier is not
included in the request.
To unsubscribe to the UE availability for time synchronization for a list of
UE(s), the AF invokes Nnef_TimeSynchronization_CapsUnsubscribe service
operation and provides the Subscription Correlation ID.
3\. (In the case of Ntsctsf_TimeSynchronization_CapsSubscribe): The NEF
discovers the TSCTSF as described in clause 6.3.24 of TS 23.501 [2]. The NEF
invokes the Ntsctsf_TimeSynchronization_CapsSubscribe request service
operation to the selected TSCTSF.
(In the case of Ntsctsf_TimeSynchronization_CapsUnsubscribe): The NEF uses the
Subscription Correlation ID to determine the TSCTSF and interacts with the
TSCTSF by triggering a Ntsctsf_TimeSynchronization_CapsUnsubscribe request
message.
The AF that is part of operator\'s trust domain may invoke the services
directly with TSCTSF.
4\. If the Event Filter includes GPSI(s), an External Group Identifier or an
Internal Group Identifier, the TSCTSF uses the Nudm_SDM_Get request to
retrieve the subscription information (SUPI(s)) from the UDM using each GPSI
or the External Group Identifier as received from the NEF or an Internal Group
Identifier as provided directly by the AF (in the case when the AF is within
the operator\'s domain).
The TSCTSF requests the Time Synchronization Subscription data from the UDM.
The TSCTSF may also use stored Time Synchronization Subscription data which it
retrieved from the UDM when the UE established PDU session, see clause
4.28.3.1.
5\. The UDM provides the Nudm_SDM_Get response containing SUPI that are mapped
from each received GPSI or a list of SUPIs mapped from the External/Internal
Group Identifier and identify UEs targeted by the AF request.
6\. (in the case of Ntsctsf_TimeSynchronization_CapsSubscribe): The TSCTSF
uses the parameters received in step 3 and step 5 (i.e. DNN, S-NSSAI and the
list of SUPIs if present) to find matching AF-session(s).
If the Time Synchronization Subscription data is available, the subscription
data returned by the UDM includes the AF request authorization that indicates
whether the AF is allowed to request (g)PTP-based time distribution for
DNN/S-NSSAI. If the subscription data indicates that the AF is not allowed to
request (g)PTP-based time synchronization, the AF-session is excluded from the
list of matching AF-sessions.
For any such matching AF-session, the TSCTSF interacts with the PCF by
triggering a Npcf_PolicyAuthorization_Update request message.
(in the case of Ntsctsf_TimeSynchronization_CapsUnsubscribe): The TSCTSF uses
the Subscription Correlation ID to determine the AF sessions and interacts
with the PCF(s) by triggering a Npcf_PolicyAuthorization_Delete request
message. Steps 10-15 are skipped.
7\. TSCTSF acknowledges the execution of
Ntsctsf_TimeSynchronization_CapsSubscribe to the requester that initiated the
request. The acknowledgement contains a Subscription Correlation ID that the
requester can use to cancel or modify the subscription.
8\. NEF acknowledges the execution of Nnef_TimeSynchronization_CapsSubscribe
to the requester that initiated the request. The acknowledgement contains a
Subscription Correlation ID that the AF can use to cancel or modify the
subscription.
9\. As part of Npcf_PolicyAuthorization_Update request, the TSCTSF uses the
procedures as described in clause K.2.1 of TS 23.501 [2] to determine the
(g)PTP capabilities from the DS-TT. If the TSCTSF has not determined the
(g)PTP capabilities from the NW-TT, the TSCTSF determines the capabilities
using the procedures as described in clause K.2.1 of TS 23.501 [2].
The TSCTSF composes the time synchronization capabilities for the DS-TT/UE(s)
connected to the NW-TT based on the capability information received from the
DS-TT(s) and NW-TT. If the Ntsctsf_TimeSynchronization_CapsSubscribe request
include an Event Filter with one or more of the requested PTP instance type,
requested transport protocol for PTP, or requested PTP Profile, the TSCTSF
considers only the DS-TT(s) and NW-TT(s) with these capabilities as part of
the time synchronization capability set that is reported to the NEF (or AF).
The TSCTSF maintains association between the user-plane Node ID, the time
synchronization capabilities, the reference to the capabilities (as identified
by the Subscription Correlation ID), the Event Filter (if available), the NEF
or AF Notification Target Address and list of the AF sessions with PCFs with
this user-plane Node ID. If the Ntsctsf_TimeSynchronization_CapsSubscribe
request includes one or more Event Filter(s), the TSCTSF considers only the
matching UE identities and the DS-TT(s) and NW-TT(s) with the matching
capabilities to be included in the associated AF sessions.
10\. The TSCTSF sends Ntsctsf_TimeSynchronization_CapsNotify (as described in
clause 5.2.27.2.8) to the NEF. The message includes the time synchronization
capabilities as composed in step 9. The message contains one or more user-
plane Node ID(s) and a list of UE identities associated to each user-plane
Node ID and time synchronization capabilities for each set of DS-TTs connected
to given user-plane Node ID, as described in Table 5.2.6.25.8-1. The user-
plane Node ID identifies the NW-TT to where the UE/DS-TT(s) are connected to.
11\. The NEF sends Nnef_TimeSynchronization_CapsNotify with Time
Synchronization capability event (as described in Table 5.2.6.25.8-1) to the
AF.
12-13. Upon PDU Session Establishment as defined clause 4.3.2.2.1, steps 1, 9,
10 and 11 are repeated for the new PDU Session.
14\. If necessary, e.g. upon PDU Session establishment or release, the TSCTSF
may update the time synchronization capabilities for the DS-TT/UE(s) connected
to the NW-TT(s). The TSCTSF sends Ntsctsf_TimeSynchronization_CapsNotify with
Time Synchronization capability event (as described in Table 5.2.6.25.8-1)
containing the updated capabilities to the NEF.
15\. The NEF sends Nnef_TimeSynchronization_CapsNotify containing the updated
capabilities to the AF.
#### 4.15.9.3 Time Synchronization activation, modification and deactivation
##### 4.15.9.3.1 General
This procedure can be used by the AF to activate, modify or deactivate the
(g)PTP instances in 5GS.
The AF may activate the time synchronization service using the
Nnef_TimeSynchronization_ConfigCreate service operation. The service operation
creates a time synchronization configuration based on the service parameters
as indicated in the create request. The AF may update the time synchronization
configuration using the Nnef_TimeSynchronization_ConfigUpdate service
operation. The AF may deactivate the time synchronization service using the
Nnef_TimeSynchronization_ConfigDelete service operation, which deletes the
corresponding time synchronization service configuration. The AF may subscribe
to time synchronization status report by providing clock quality acceptance
criteria via Nnef_TimeSynchronization_ConfigCreate service operation. The AF
may receive time synchronization service status update via
Nnef_TimeSynchronization_UpdateNotify service operation. 5GS may provide a
time synchronization status report to the AF in case of a PTP port is
activated or deactivated due to a detected failure, degradation, or
improvement of the service.
The Nnef_TimeSynchronization_ConfigCreate and
Nnef_TimeSynchronization_ConfigUpdate request may contain the parameters as
described in Table 4.15.9.3-1.
Table 4.15.9.3-1: Description of Time Synchronization service parameters
+----------------------------------+----------------------------------+ | Time Synchronization Parameter | Description | +==================================+==================================+ | PTP instance type | Identifies the requested PTP | | | instance type as described in | | | clause 5.27.1.4 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | Transport protocol | Identifies the requested | | | transport protocol for PTP | | | instance as described in | | | clause 5.27.1.4 of | | | TS 23.501 [2]. This is | | | applicable for | | | IEEE Std 1588 [76] Boundary | | | Clock and Transparent Clock | | | operation. | +----------------------------------+----------------------------------+ | PTP Profile | Identifies the PTP profile for | | | the PTP instance as requested by | | | AF. | +----------------------------------+----------------------------------+ | Grandmaster enabled | Indicates whether the AF | | | requests the PTP instance in 5GS | | | to be able to act as a | | | grandmaster for PTP or gPTP | | | (depending on the requested PTP | | | instance type). | | | | | | This is applicable for | | | IEEE Std 1588 [76] Boundary | | | Clock or IEEE Std 802.1AS [75] | | | operation. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Grandmaster priority | Indicates a priority used as | | | defaultDS.priority1 when | | | generating Announce message when | | | 5GS acts as (g)PTP GM. | | | Applicable only if the | | | Grandmaster enabled = TRUE. If | | | omitted, the default value as | | | described in the PTP Profile is | | | used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Time Domain | (g)PTP domain of the PTP | | | instance as defined in | | | IEEE Std 1588 [76]. | +----------------------------------+----------------------------------+ | Temporal Validity Condition | Indicates start-time and | | | stop-time attributes that | | | describe the time period when | | | the time synchronization service | | | for a PTP instance is active. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Spatial Validity Condition | Indicates a geographical area | | | (e.g. a civic address or shapes) | | | or a TA list in which time | | | synchronization service is | | | enabled (NOTE 1). | | | | | | [optional] | +----------------------------------+----------------------------------+ | Time synchronization error | Indicates the time | | budget | synchronization budget for the | | | time synchronization service (as | | | described in clause 5.27.1.9 of | | | TS 23.501 [2]). | | | | | | [optional] | +----------------------------------+----------------------------------+ | Clock quality detail level | For (g)PTP services, its value, | | | if provided, shall be set to | | | \"acceptable/not acceptable | | | indication\" (NOTE 2). | | | | | | [optional] | +----------------------------------+----------------------------------+ | Clock quality acceptance | It indicates the acceptable | | criteria | criteria for the UE. It is | | | defined based on the attributes | | | | | | specified in Table 5.27.1.12-1 | | | of TS 23.501 [2]. The | | | parameter shall be included if | | | the \"clock quality detail | | | level\" is present. | | | | | | [conditional] | +----------------------------------+----------------------------------+ | **For each PTP port in the PTP | | | instance** | | +----------------------------------+----------------------------------+ | Either UE identity (for a DS-TT | Identifies the UE/DS-TT which | | port), or \"N6 interface\" | the parameters below apply. \"N6 | | indication | interface\" indicates that the | | | parameters below apply to the N6 | | | interface. | | | | | | If the \"PTP port\" needs to be | | | identified, this field refers to | | | the UE identity (GPSI or SUPI). | | | | | | If the N6 termination needs to | | | be identified, then this field | | | indicates \"N6 interface\" flag, | | | instead of SUPI or GPSI. | +----------------------------------+----------------------------------+ | PTP enabled | TRUE/FALSE. This is used to set | | | the portDS.portEnable. If | | | omitted, the default value as | | | described in the PTP Profile is | | | used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Log Sync Interval | Specifies the mean time interval | | | between successive Sync | | | messages. This is applicable for | | | IEEE Std 1588 [76] Boundary | | | Clock or IEEE Std 802.1AS [75] | | | operation. If omitted, the | | | default value as described in | | | the PTP Profile is used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Use management settable Log Sync | TRUE/FALSE. This is applicable | | Interval | if the PTP Profile is I | | | IEEE Std 802.1AS [75]. | | | | | | When set to FALSE, the Log Sync | | | Interval is used to set the | | | initialLogSyncInterval as | | | described in | | | IEEE Std 802.1AS [75]. When | | | set to TRUE, the Log Sync | | | Interval is used to set the | | | mgtSettableLogSyncInterval as | | | described in | | | IEEE Std 802.1AS [75]. | | | | | | If omitted, the default value as | | | described in the | | | IEEE Std 802.1AS [75] is used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Log Announce Interval | Specifies the mean time interval | | | between successive Announce | | | messages. This is applicable for | | | IEEE Std 1588 [76] Boundary | | | Clock or IEEE Std 802.1AS [75] | | | operation. If omitted, the | | | default value as described in | | | the PTP Profile is used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Use management settable Log | TRUE/FALSE. This is applicable | | Announce Interval | if the PTP Profile is | | | IEEE Std 802.1AS [75]. | | | | | | When set to FALSE, the Log | | | Announce Interval is used to set | | | the initialLogAnnounceInterval | | | as described in IEEE 802.1AS. | | | When set to TRUE, the Log | | | Announce Interval is used to set | | | the | | | mgtSettableLogAnnounceInterval | | | as described in | | | IEEE Std 802.1AS [75]. | | | | | | If omitted, the default value as | | | described in the | | | IEEE Std 802.1AS [75] is used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | NOTE 1: A geographical area | | | requested by an AF includes at | | | least one tracking area (TA), | | | i.e. the granularity is | | | restricted to a TA level in this | | | release of the specifications. | | | | | | NOTE 2: UE/DS-TT retrieves | | | detailed information about | | | (g)PTP services status from | | | Announce messages, i.e. setting | | | Clock Quality Detail Level to | | | \"Acceptable/Not Acceptable\" | | | indication can be used to | | | specify Clock Quality Acceptance | | | Criteria for Timing | | | Synchronization Status (TSS) | | | reporting towards the AF. | | +----------------------------------+----------------------------------+
The AF may use Nnef_TimeSynchronization_CapsSubscribe service operation as
described in clause 4.15.9.2 to learn the UE capabilities for time
synchronization service. The Nnef_TimeSynchronization_CapsNotify service
operation indicates the list of UE identities, User-plane Node ID and the
Subscription Correlation ID. The AF can use the Subscription Correlation ID
and the user-plane node ID received in the Nnef_TimeSynchronization_CapsNotify
service operation as a target of the Nnef_TimeSynchronization_ConfigCreate
request. The NEF uses the Subscription Correlation ID and user-plane node ID
to determine the list of UEs and list of AF-sessions to which the
Nnef_TimeSynchronization_ConfigCreate service operation is targeted to.
##### 4.15.9.3.2 Time synchronization service activation
Figure 4.15.9.3.2-1: Time synchronization service activation
1\. The AF creates a time synchronization service configuration for a PTP
instance by invoking Nnef_TimeSynchronization_ConfigCreate service operation.
The request includes the parameters as described in Table 4.15.9.3-1. The
request contains a Subscription Correlation ID and user-plane node ID as a
reference to the target of the UEs and AF-sessions.
The create request creates also a subscription for the changes in the time
synchronization service configuration. The AF may subscribe to receiving
network time synchronization status report(s) as specified in clause
4.15.9.5.1.
2\. The NEF authorizes the request. After successful authorization, the NEF
invokes the Ntsctsf_TimeSynchronization_ConfigCreate service operation with
the corresponding TSCTSF, with the parameters as received from the AF.
If the request includes a spatial validity condition and if the AF uses a
geographical area as a spatial validity condition, the NEF transforms this
information into 3GPP identifiers (e.g. TAI(s)) based on pre-configuration.
The AF that is part of operator\'s trust domain may invoke the services
directly with TSCTSF.
If the request includes a spatial validity condition and if the AF is within
the operator\'s domain, the spatial validity condition shall comprise of a
list of TA(s).
NOTE 1: It is assumed that AFs within the operator\'s domain is aware of TAs
that can be used to formulate a spatial validity condition for Time
Synchronization Coverage Area (see clause 5.27.1.10 of TS 23.501 [2]).
3\. TSCTSF checks whether the AF requested parameters comply with the stored
Time Synchronization Subscription data as defined in clause 5.27.1.11 of TS
23.501 [2], for that, the TSCTSF retrieves the Time Synchronization
Subscription data from the UDM as defined in clause 4.15.9.2). The TSCTSF
determines the Time Synchronization Coverage Area and responds with the
Ntsctsf_TimeSynchronization_ConfigCreate response as specified in clause
5.27.1.11 of TS 23.501 [2]. The Ntsctsf_TimeSynchronization_ConfigCreate
response includes a PTP instance reference.
4\. The NEF responds with the Nnef_TimeSynchronization_ConfigCreate response,
including a reference to the time synchronization service configuration (PTP
instance reference).
5-6. The TSCTSF uses the Subscription Correlation ID and user-plane node ID in
Ntsctsf_TimeSynchronization_ConfigCreate to determine the target UEs and
corresponding AF-sessions. The TSCTSF uses the parameters (e.g. requested PTP
instance type, transport protocol and PTP profile) in the
Ntsctsf_TimeSynchronization_ConfigCreate request to determine suitable DS-
TT(s) and corresponding AF-sessions among all AF-sessions that are associated
with the Subscription Correlation ID and user-plane node ID in the request.
The TSCTSF maintains association between list of suitable AF-sessions,
corresponding time synchronization configuration, the PTP instance reference
in 5GS, PTP instance references in each involved DS-TT and NW-TT and
Subscription Correlation ID and user-plane node ID as given in step 1.
NOTE 2: The AF-sessions that are not associated with a time synchronization
configuration, are available to be selected as suitable AF-sessions in another
Ntsctsf_TimeSynchronization_ConfigCreate request.
The TSCTSF uses the procedures described in clause K.2.2 of TS 23.501 [2] to
configure and initialize the PTP instance in the DS-TT(s) and NW-TT. The
TSCTSF constructs a PMIC to each DS-TT/UE to activate the time synchronization
service in DS-TT in respect to the service parameters in the request in step
2. The TSCTSF constructs PMIC(s) and UMIC to NW-TT to activate the time
synchronization service in NW-TT in respect to the service parameters in the
request in step 2.
Upon reception of responses from each DS-TT and NW-TT, the TSCTSF determines
the state of the time synchronization configuration.
The TSCTSF constructs a PMIC to each DS-TT/UE to subscribe for the port
management information changes in the DS-TT. The TSCTSF constructs PMIC(s) and
UMIC to NW-TT to subscribe for the port management and user-plane management
information changes in NW-TT. The TSCTSF retrieves the PMIC(s) and UMIC via
means of Npcf_PolicyAuthorization service operations.
The create request creates also a subscription for notifications for the
changes in the time synchronization service configuration. If the AF provided
clock quality acceptance criteria in step 1, the TSCTSF subscribes for
notifications for changes in the NG-RAN and UPF/NW-TT timing synchronization
status, as described in clause 4.15.9.5.1:
\- To determine the impacted UEs due to a timing synchronization status update
reported by the NG-RAN, the TSCTSF follows the operation described in clause
5.27.1.12 of TS 23.501 [2].
\- To determine the impacted UEs due to a timing synchronization status update
reported by the UPF/NW-TT, the TSCTSF verifies if the UPF/NW-TT is configured
to send (g)PTP messages to the UEs/DS-TTs.
If the Ntsctsf_TimeSynchronization_ConfigCreate request contains a temporal
validity condition with a start-time and/or the stop-time that is in the
future, the TSCTSF maintains the start-time and stop-time for the time
synchronization service for the corresponding time synchronization
configuration. If the start-time is in the past, the TSCTSF treats the request
as if the time synchronization service was activated immediately. When the
start-time is reached, the TSCTSF proceeds as described in this step above.
When the stop-time is reached for active time synchronization service
configuration, the TSCTSF proceeds as Ntsctsf_TimeSynchronization_ConfigDelete
was received as described in clause 4.15.9.3.4.
If the Ntsctsf_TimeSynchronization_ConfigCreate request contains a spatial
validity condition, then the TSCTSF performs the following operations:
\- For each target UE, TSCTSF determines whether the TSCTSF has subscribed for
the UE presence in Area of Interest composed by the TA(s) in the Time
Synchronization Coverage Area. If not, the TSCTSF discovers the AMF(s) serving
the TA(s) that comprise the Time Synchronization Coverage Area, using the NRF
discovery service (Nnrf_NFDiscovery_Request) with the list of TA(s). Then the
TSCTSF subscribes to the AMF(s) to receive notifications about the UE presence
in Area of Interest using Namf_EventExposure operation with the corresponding
event filters as described in clause 5.2.2.3. The subscribed area of interest
may be the same as the Time Synchronization Coverage Area or may be a subset
of the Time Synchronization Coverage Area (e.g. a list of TAs) based on the
latest known UE location.
\- In order to ensure that a TAI list specifying the AoI for the AMF is
aligned with UE\'s Registration Area (RA), the following steps shall be
performed:
\- When invoking the subscription with the AMF(s), the TSCTSF may provide an
indication, a new Parameter Type = \"Adjust AoI based on RA\", that the AMF
may adjust the received AoI depending on UE\'s RA.
\- After receiving the Namf_EventExposure_Subscribe request from the TSCTSF
with the Parameter Type = \"Adjust AoI based on RA\" and specified AoI, the
AMF compares TAs from the AoI with the UE\'s Registration Area (RA). If the
AoI includes one or more TA(s) that are part of UE\'s current RA, the AMF
reports the UE is inside the Area Of Interest, otherwise the AMF reports the
UE is outside the Area Of Interest, as described in Annex D.
\- The AMF notifies the TSCTSF about the UE\'s presence in the AoI using the
Namf_EventExposure_Notify service operation.
\- Based on the notification from the AMF and the Time Synchronization
Coverage Area determined in step 3, the TSCTSF determines whether to activate
time synchronization service for this UE:
\- If the UE location is within the Time Synchronization Coverage Area, the
TSCTSF determines to activate time synchronization service for the UE/DS-TT
creating the PTP port in DS-TT and adding it to the PTP instance. The TSCTSF
uses the procedures described in clause K.2.2 of TS 23.501 [2] to configure
and initialize the PTP instance in the DS-TT(s) and NW-TT.
\- If the UE location is outside the Time Synchronization Coverage Area, the
TSCTSF determines not to activate time synchronization service and not to
create a PTP port in a DS-TT.
The TSCTSF uses the procedure in clause 4.15.9.4 to activate or modify the 5G
access stratum time distribution for the UEs that are part of the impacted PTP
instance.
7\. The TSCTSF notifies the NEF (or AF) with the
Ntsctsf_TimeSynchronization_ConfigUpdateNotify service operation, containing
the PTP instance reference and the current state of the time synchronization
service configuration.
If TSCTSF received spatial validity condition as part of the
Ntsctsf_TimeSynchronization_ConfigCreate request, the TSCTSF notifies the NEF
(or AF) with the Ntsctsf_TimeSynchronization_ConfigUpdateNotify service
operation, whenever the UE moves in or out of the Area of Interest. The
notification contains the PTP instance reference and the current state of the
time synchronization service configuration.
8\. The NEF notifies the AF with the
Nnef_TimeSynchronization_ConfigUpdateNotify service operation, containing the
PTP instance reference and the current state of the time synchronization
service configuration.
9\. Upon a change in the PTP instance in the DS-TT or NW-TT, the DS-TT or NW-
TT report the change via PMIC or UMIC to the TSCTSF as described in clause
K.2.2 of TS 23.501 [2].
Upon PDU Session release indication from a PCF, the TSCTSF removes the
corresponding AF-session from the list of AF-sessions associated with the time
synchronization configuration. The TSCTSF uses the procedure in clause
4.15.9.4 to remove the 5G access stratum time distribution parameters for the
UE that is removed from the impacted PTP instance.
Upon PDU Session Establishment as defined clause 4.3.2.2.1, steps 10-13 in
Figure 4.15.9.2-1 are repeated for the new PDU Session and the TSCTSF may
notify the NEF (or AF) for the Time Synchronization capability event,
optionally with the updated time synchronization capabilities, as described in
step 12 in Figure 4.15.9.2-1.
NOTE 3: Upon receiving the notification, the NEF (or AF) can use the
Ntsctsf_TimeSynchronization_ConfigUpdate service operation to add the DS-TT/UE
to the existing PTP instance and corresponding time synchronization service
configuration.
If TSCTSF received spatial validity condition as part of the
Ntsctsf_TimeSynchronization_ConfigCreate request, upon a change in the UE
presence in Area of Interest, the TSCTSF determines if the spatial validity
condition shall trigger an activation or deactivation of the time
synchronization service:
\- If the UE has moved outside the Time Synchronization Coverage Area, then
the TSCTSF temporarily removes the UE/DS-TT port from the PTP instance:
\- If the DS-TT is configured to send Sync, Follow_Up and Announce messages
for the related PTP instance, then TSCTSF deactivates the Grandmaster
functionality in the DS-TT using PMIC (see also clause K.2.2.4 of TS 23.501
[2]).
\- If NW-TT is configured to send Sync, Follow_Up and Announce messages on
behalf of the DS-TT, then TSCTSF deactivates the Grandmaster functionality on
behalf of the DS-TT in NW-TT using UMIC (see also clause K.2.2.4 of TS 23.501
[2]).
\- If the UE has moved inside the Time Synchronization Coverage Area, then the
TSCTSF adds the DS-TT PTP port to the PTP instance and also (re-)activates the
Grandmaster functionality (described in clause K.2.2 of TS 23.501 [2]).
Upon a NG-RAN timing synchronization status update, the NG-RAN report the
change via AMF or provisioned via OAM to the TSCTSF as described in clause
4.15.9.5.1.
Upon a UPF/NW-TT timing synchronization status update, the UPF/NW-TT timing
synchronization status update is reported via UMIC or provisioned via OAM to
the TSCTSF as described in clause 4.15.9.5.1.
If TSCTSF received a NG-RAN or UPF/NW-TT timing synchronization status update
and the time synchronization service has a configured clock quality acceptance
criteria for the UE, the TSCTSF determines whether the clock quality
acceptance criteria can still be met:
\- If the clock quality acceptance criteria can still be met, then TSCTSF may
update the clockQuality information sent in Announce messages for the PTP
instance using PMIC/UMIC reporting. The handling of Announce messages follows
existing procedures as described in TS 23.501 [2].
\- If the clock quality acceptance criteria cannot be met or can be met again,
then TSCTSF informs the AF about the acceptance criteria result (e.g.,
acceptable/not acceptable).
10\. The TSCTSF updates the state of the time synchronization configuration
and may notify the NEF (or AF) with the
Ntsctsf_TimeSynchronization_ConfigUpdateNotify service operation, containing
the PTP instance reference and the updated state of the time synchronization
service configuration, including whether there was a change in the UE\'s
presence in the Time Synchronization Coverage Area (in cases when the AF has
requested the service for a specific spatial validity condition), or the clock
quality acceptance criteria result (in cases when the AF has requested the
service with a clock quality acceptance criteria condition).
11\. The NEF notifies the AF with the
Nnef_TimeSynchronization_ConfigUpdateNotify service operation, containing the
reference to the time synchronization service configuration (PTP instance
reference) and the updated state of the time synchronization service
configuration.
If the AF receives a clock quality acceptance criteria result, the AF may
update the configuration of the PTP instance by updating the PTP instance
sending a Nnef/Ntsctsf_TimeSynchronization_ConfigUpdate or
Nnef/Ntsctsf_TimeSynchronization_ConfigDelete request, as described in clauses
4.15.9.3.3 and 4.15.9.3.4.
##### 4.15.9.3.3 Time synchronization service modification
Figure 4.15.9.3.3-1: Time synchronization service modification
1\. To update an existing time synchronization service configuration of the
PTP instance, the AF invokes a Nnef_TimeSynchronization_ConfigUpdate service
operation providing the corresponding PTP instance reference.
2\. The NEF invokes the Ntsctsf_TimeSynchronization_ConfigUpdate service
operation with the corresponding TSCTSF.
The AF that is part of the operator\'s trust domain may invoke the services
directly with the TSCTSF.
3\. The TSCTSF checks whether the AF requested parameters in the update
request comply with the stored Time Synchronization Subscription data as
defined in clause 5.27.1.11 of TS 23.501 [2], for that, the TSCTSF retrieves
the Time Synchronization Subscription data from UDM as defined in clause
4.15.9.2. If the Ntsctsf_TimeSynchronization_ConfigUpdate request includes or
updates the Spatial validity condition and the Spatial validity condition is
allowed per the subscription, the TSCTSF determines the UE\'s presence in the
updated Spatial validity condition as specified in steps 3-7 of the time
synchronization activation procedure in clause 4.15.9.3.2.
\- If the AF updates the clock quality acceptance criteria in step 1, the
TSCTSF determines the clock acceptance criteria upon a time synchronization
failure/degradation/improvement as specified in step 9 of the time
synchronization activation procedure in clause 4.15.9.3.2. If AF provides
clock quality acceptance criteria in step 1, and it was not available when the
service was activated, the TSCTSF subscribes for notifications for changes in
the NG-RAN and UPF/NW-TT timing synchronization status, as described in clause
4.15.9.5.1:
\- To determine the impacted UEs due to a timing synchronization status update
reported by the NG-RAN, the TSCTSF follows the operation described in clause
5.27.1.12 of TS 23.501 [2].
\- To determine the impacted UEs due to a timing synchronization status update
reported by the UPF/NW-TT, the TSCTSF verifies if the UPF/NW-TT is configured
to send (g)PTP messages to the UEs/DS-TTs.
4\. The TSCTSF responds with the Ntsctsf_TimeSynchronization_ConfigUpdate
response where the AF may include an indication that the UE(s) are (not)
present in the Requested Coverage Area (in cases when the AF has requested the
service for a specific area).
5\. The NEF responds with the Nnef_TimeSynchronization_ConfigUpdate.
6-7. The TSCTSF uses the PTP instance reference included in the
Ntsctsf_TimeSynchronization_ConfigUpdate request to identify the time
synchronization service configuration and the corresponding AF sessions.
If the Ntsctsf_TimeSynchronization_ConfigUpdate request includes updated
service parameters for the PTP instance and if the corresponding DS-TT(s) and
NW-TT are suitable with the parameters (e.g. requested PTP instance type,
transport protocol and PTP profile), the TSCTSF uses the procedures described
in clause K.2.2 of TS 23.501 [2] to update the PTP instance(s) in the DS-TT(s)
and NW-TT.
If the Ntsctsf_TimeSynchronization_ConfigUpdate request includes one or more
UE identities to be added to the PTP instance, if the corresponding DS-TT(s)
are suitable with the parameters (e.g. requested PTP instance type, transport
protocol and PTP profile) in the time synchronization service configuration as
identified by the PTP instance reference in the request:
\- the TSCTSF adds the suitable AF-sessions to the list of AF-sessions that
are associated with the time synchronization service configuration; and
\- the TSCTSF uses the procedures described in clause K.2.2 of TS 23.501 [2]
to initialize and activate the PTP instance(s) in the corresponding DS-TT(s).
\- the TSCTSF uses the procedure in clause 4.15.9.4 to modify or activate the
5G access stratum time distribution for the UEs that are added to the impacted
PTP instance.
If the Ntsctsf_TimeSynchronization_ConfigUpdate request includes one or more
UE identities to be removed to the PTP instance, the TSCTSF removes the
corresponding AF-sessions from the list of AF-sessions associated with the
time synchronization configuration. The TSCTSF uses the procedure in clause
4.15.9.4 to remove the 5G access stratum time distribution parameters for the
UEs that are removed from the impacted PTP instance.
8\. The TSCTSF notifies the NEF (or AF) with the
Ntsctsf_TimeSynchronization_ConfigUpdateNotify service operation, containing
the PTP instance reference and the current state of the time synchronization
service configuration, including and whether there was a change in the UE\'s
presence in the Spatial validity condition (in cases when the AF has requested
the service for a specific area) and/or whether there was a change in
network\'s timing synchronization status as described in clause 5.27.1.12 of
TS 23.501 [2] including the clock quality acceptance criteria result.
9\. The NEF notifies the AF with the
Nnef_TimeSynchronization_ConfigUpdateNotify service operation, containing the
PTP instance reference, the current state of the time synchronization service
configuration, network\'s time synchronization status and clock quality
acceptance criteria result, if provided by
Ntsctsf_TimeSynchronization_ConfigUpdateNotify. Based on the notification, the
AF decides whether to modify the service configured for the UE of a PTP
instance using Ntsctsf_TimeSynchronization_ConfigUpdate service, or whether to
deactivate it using Nnef_TimeSynchronization_ConfigDelete service.
##### 4.15.9.3.4 Time synchronization service deactivation
Figure 4.15.9.3.4-1: Time synchronization service deactivation
1\. To remove an existing time synchronization service configuration of the
PTP instance, the AF invokes a Nnef_TimeSynchronization_ConfigDelete service
operation providing the corresponding PTP instance reference.
2\. The NEF invokes the Ntsctsf_TimeSynchronization_ConfigDelete service
operation with the corresponding TSCTSF.
The AF that is part of operator\'s trust domain may invoke the services
directly with TSCTSF.
The TSCTSF may also invoke the Ntsctsf_TimeSynchronization_ConfigDelete
service operation when it determines (based on notifications from the AMF(s),
see steps 3-7 of clause 4.15.9.3.2) that the UE(s) are outside the Spatial
validity condition.
3\. The TSCTSF responds with the Ntsctsf_TimeSynchronization_ConfigDelete
response.
4\. The NEF responds with the Nnef_TimeSynchronization_ConfigDelete response.
5-6. The TSCTSF uses the PTP instance reference included in the
Ntsctsf_TimeSynchronization_ConfigDelete request to identify the time
synchronization service configuration and the corresponding AF sessions. The
TSCTSF uses the procedures described in clause K.2.2 of TS 23.501 [2] to
disable the corresponding PTP instance(s) in the DS-TT(s) and NW-TT. The
TSCTSF deletes the time synchronization service configuration for the
respective PTP instance.
The TSCTSF uses the procedure in clause 4.15.9.4 to deactivate the 5G access
stratum time distribution for the UEs that are part of the impacted PTP
instance.
#### 4.15.9.4 Procedures for management of 5G access stratum time distribution
The AF can use the procedure to activate, update or delete the 5G access
stratum time distribution for one UE or a group of UEs.
The AF may query the status of the 5G access stratum time distribution using
Nnef_ASTI_Get service operation. The Nnef_ASTI_Create and Nnef_ASTI_Update
request may contain the parameters as described in Table 4.15.9.4-1. The AF
may subscribe to 5G access stratum time synchronization status via
Nnef_ASTI_Subscribe service operation. The AF may receive 5G access stratum
time distribution status updates via Nnef_ASTI_UpdateNotify service operation.
Table 4.15.9.4-1: Description of 5G access stratum time distribution
parameters
+----------------------------------+----------------------------------+ | Parameter | Description | +==================================+==================================+ | 5G access stratum time | Indicates that the access | | distribution indication (enable, | stratum time distribution via Uu | | disable) | reference point should be | | | activated or deactivated for the | | | associated UE identities. | +----------------------------------+----------------------------------+ | Time synchronization error | Indicates the time | | budget | synchronization error budget for | | | the time synchronization service | | | (as described in clause 5.27.1.9 | | | of TS 23.501 [2]). | | | | | | [optional] | +----------------------------------+----------------------------------+ | Temporal Validity Condition | Indicates start-time and | | | stop-time attributes that | | | describe the time period when | | | the time synchronization service | | | is active. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Spatial Validity Condition | Indicates a geographical area | | | (e.g. a civic address or shapes) | | | or a TA list in which time | | | synchronization service is | | | enabled (NOTE 1). | | | | | | [optional] | +----------------------------------+----------------------------------+ | Clock quality detail level | It indicates whether and which | | | clock quality information to | | | provide to the UE and can take | | | one of the following values | | | \"clock quality metrics\" or | | | \"acceptable/not acceptable | | | indication\". | | | | | | [optional] | +----------------------------------+----------------------------------+ | Clock quality acceptance | It indicates acceptance criteria | | criteria | for the UE. It is defined based | | | on the attributes specified in | | | Table 5.27.1.12-1 of | | | TS 23.501 [2]. The parameter | | | shall be included if the \"clock | | | quality detail level\" = | | | \"acceptable/not acceptable\". | | | | | | [conditional] | +----------------------------------+----------------------------------+ | NOTE 1: A geographical area | | | requested by an AF includes at | | | least one tracking area (TA), | | | i.e. the granularity is | | | restricted to a TA level in this | | | release of the specifications. | | +----------------------------------+----------------------------------+
Figure 4.15.9.4-1: Management of 5G access stratum time information
1\. AM Policy Association establishment as described in clause 4.16.1.
2\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
\- To create a new request, the AF provides access stratum time distribution
parameters to the NEF using the Nnef_ASTI_Create service operation (together
with the AF identifier and potentially further inputs as specified in table
4.15.9.4-1), including a target (one UE identified by SUPI or GPSI, a group of
UEs identified by an External Group Identifier. The NEF forwards the GPSI or
the External Group Identifier to the TSCTSF by including it inside the
Ntsctsf_ASTI_Create request.
\- To update or remove an existing request, the AF invokes an Nnef_ASTI_Update
or Nnef_ASTI_Delete service operation providing the corresponding time
synchronization configuration id.
\- To query the status of the access stratum time distribution, the AF invokes
Nnef_ASTI_Get service operation providing the target (a list of UE identities
(SUPI or GPSIs) or an External Group Identifier).
\- If the AF includes clock quality detail level, the request creates a
subscription at the TSCTSF for notifications for the changes in 5G access
stratum time distribution status.
\- To subscribe to NG-RAN timing synchronization status updates, the AF can
subscribe to notifications as described in clause 4.15.9.5.1.
The AF that is part of operator\'s trust domain may invoke the services
directly with the TSCTSF and identifies the targeted UE(s) using SUPI(s) or an
Internal Group Identifier.
If the request includes a spatial validity condition and the AF uses a
geographical area as a spatial validity condition, the NEF transforms this
information into 3GPP identifiers (e.g. TAI(s)) based on pre-configuration.
NOTE 1: Steps 1 and 2 can occur in any order.
NOTE 2: It is assumed that AFs within the operator\'s domain is aware of TAs
that can be used to formulate a spatial validity condition for Time
Synchronization Coverage Area (see clause 5.27.1.10 of TS 23.501 [2]).
3\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
\- The NEF authorizes the request. After successful authorization, the NEF
invokes the Ntsctsf_ASTI_Create/Update/Delete/Get service operation with the
TSCTSF discovered and selected as described in clause 6.3.24 of TS 23.501 [2].
\- The TSCTSF determines whether the targeted UE is part of a PTP instance in
5GS, if so the TSCTSF rejects the request (steps 4-11 are skipped).
\- The TSCTSF checks whether the AF requested parameters comply with the
stored Time Synchronization Subscription Data as defined in clause 5.27.1.11
of TS 23.501 [2].
\- The TSCTSF calculates the Uu time synchronization error budget as described
in clause 5.27.1.9 of TS 23.501 [2]. This does not apply in case of
Ntsctsf_ASTI_Delete service operation.
(When the procedure is triggered by PTP instance activation or modification in
the TSCTSF):
\- The TSCTSF calculates the Uu time synchronization error budget as described
in clause 5.27.1.9 of TS 23.501 [2] for corresponding SUPIs that are part of
the PTP instance.
4\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
If the AF targeted UE(s) are identified by GPSI(s) or an External/Internal
Group Identifier, the TSCTSF uses the Nudm_SDM_Get request to retrieve the
subscription information (SUPI(s)) from the UDM using each GPSI or the
External Group Identifier as received from the NEF, or an Internal Group
Identifier as provided by the AF directly.
5\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
The UDM provides the Nudm_SDM_Get response containing SUPI(s) that are mapped
from each received GPSI or the External/Internal Group Identifier and identify
the targeted UEs.
6a. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
If the Ntsctsf_ASTI_Create request in step 2 contains a spatial validity
condition, then the TSCTSF performs the following operations:
\- For each target UE, TSCTSF checks with the stored Time Synchronization
Subscription data if the spatial validity condition is allowed and determines
whether the TSCTSF has subscribed for the UE presence in Area of Interest
composed by the TAs list in the spatial validity condition. If not, the TSCTSF
discovers the AMF(s), serving in the TAs that comprise the spatial validity
condition, using the NRF discovery service (Nnrf_NFDiscovery_Request) with the
list of TAs. Then the TSCTSF subscribes to the AMF(s) to receive notifications
about the UE presence in Area of Interest using Namf_EventExposure operation
with the corresponding event filters as described in clause 5.2.2.3. The
subscribed area of interest may be the same as the spatial validity condition
or may be a subset of the spatial validity condition (e.g. a list of TAs)
based on the latest known UE location.
\- In order to ensure that a TAI list specifying the AoI for the AMF is
aligned with UE\'s Registration Area (RA), the following steps shall be
performed:
\- When invoking the subscription with the AMF(s), the TSCTSF may provide an
indication, a new Parameter Type = \"Adjust AoI based on RA\", that the AMF
may adjust the received AoI depending on UE\'s RA.
\- After receiving the Namf_EventExposure_Subscribe request from the TSCTSF
with the Parameter Type = \"Adjust AoI based on RA\" and specified AoI, the
AMF compares TAs from the AoI with the UE\'s Registration Area (RA). If the
AoI includes one or more TA(s) that are part of UE\'s current RA, the AMF
reports the UE is inside the Area Of Interest, otherwise the AMF reports the
UE is outside the Area Of Interest, as described in Annex D.
\- The AMF notifies the TSCTSF about the UE\'s presence in the AoI using the
Namf_EventExposure_Notify service operation.
\- Based on the notification from the AMF and spatial validity condition
received in step 1, the TSCTSF determines whether to activate time
synchronization service for this UE:
\- If the UE location is within the spatial validity condition, the TSCTSF
determines to enable access stratum time distribution for the UE.
\- If the UE location is outside the spatial validity condition, the TSCTSF
determines to disable access stratum time distribution for the UE.
If the Ntsctsf_ASTI_Create request in step 2 contains a temporal validity
condition with a start-time and/or the stop-time that is in the future, the
TSCTSF maintains the start-time and stop-time for the time synchronization
service for the corresponding time synchronization configuration. If the
start-time is in the past, the TSCTSF treats the request as if the time
synchronization service was activated immediately. When the start-time is
reached, the TSCTSF proceeds with the subsequent steps. When the stop-time is
reached for active time synchronization service configuration, the TSCTSF
proceeds as if Nnef_ASTI_Delete was received.
6b. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
The TSCTSF checks the AF request with the stored Time Synchronization
Subscription data as described in clause 5.27.1.11 of TS 23.501 [2] for any
targeted UE. If the AF is not authorized, steps 7-11 are skipped.
7\. The TSCTSF searches the PCF for the UE using Nbsf_Management_Subscribe
with a SUPI as an input parameter, indicating that it is searching for the PCF
that handles the AM Policy Association of the UE.
8\. The BSF provides to the TSCTSF the identity of the PCF for the UE for the
requested SUPI via an Nbsf_Management_Notify operation. If matching entries
already existed in the BSF when step 6 is performed, this shall be immediately
reported to the TSCTSF.
9\. The TSCTSF sends to the PCF for the UE its request for the AM policy of
the UE (identified by SUPI) using Npcf_AMPolicyAuthorization request,
containing the 5G access stratum time distribution indication (enable,
disable), optionally the calculated Uu time synchronization error budget,
optionally the clock quality detail level and clock quality acceptance
criteria.
(When the procedure is triggered by PTP instance activation, modification, or
deactivation in the TSCTSF):
The TSCTSF ensures the 5G access stratum time distribution for the UE is
enabled if at least one of the PTP instances the UE is part of is active.
10\. If the PCF receives multiple time synchronization error budgets for a
given UE, then the PCF picks the most stringent budget. The PCF takes a policy
decision and then the PCF may initiate an AM Policy Association Modification
procedure for the UE as described in clause 4.16.2.2 to provide AMF the 5G
access stratum time distribution parameters. As part of this, the AMF shall,
if supported, store the 5G access stratum time distribution indication
(enable, disable), the Uu time synchronization error budget, clock quality
detail level and clock quality acceptance criteria, and the UE reconnection
indication in the UE context in AMF and send the 5G access stratum time
distribution indication (enable, disable), the Uu time synchronization error
budget, clock quality detail level and clock quality acceptance criteria when
they are available, to NG-RAN during mobility registration, AM policy
modification, Service Request, N2 Handover and Xn handover as specified in TS
38.413 [10]. The NG-RAN node shall, if supported, store the information in the
UE Context. Based on this information, the NG-RAN node provides the 5GS access
stratum time to the UE according to the Uu time synchronization error budget
as provided by the TSCTSF (if supported by UE and NG-RAN) and NG-RAN provides
timing synchronization status reports to the UE (as described in clause
4.15.9.5.2).
If the UE has indicated a support for network reconnection due to RAN timing
synchronization status change as described in clause 5.4.4a of TS 23.501 [2],
and if the AMF received \"clock quality detail level\" as part of an AM Policy
Association Modification procedure, the AMF sets the \"UE reconnection
indication\" for the UE to connect to the network in the case when the UE
later detects that the NG-RAN timing synchronization status has changed while
the UE is in CM-IDLE or CM-CONNECTED with RRC_INACTIVE state. The AMF shall
send the UE reconnection indication to the UE updating the UE configuration as
defined in clause 4.2.4.2.
If the AMF receives Uu time synchronization error budget in the Access Stratum
Time Synchronization Service Authorization as part of the Access and Mobility
Subscription data during registration procedure (see clause 4.28.2.1) and in
the AM Policy, the AMF should use the value received from the AM policy.
NOTE 3: This release of the specification assumes that deployments ensure that
the targeted UEs and the NG-RAN nodes serving those UEs support Rel-17
propagation delay compensation as defined in TS 38.300 [9].
11\. The PCF of the UE replies to the TSCTSF with the result of
Npcf_AMPolicyAuthorization operation.
12\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
The TSCTSF responds the AF with the Ntsctsf_ASTI_Create/Update/Delete/Get
service operation response.
13\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
The NEF informs the AF about the result of the
Nnef_ASTI_Create/Update/Delete/Get service operation performed in step 2.
14\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
If TSCTSF received spatial validity condition as part of the
Ntsctsf_ASTI_Create request in step 2, upon the reception of a change in the
UE presence in Area of Interest notification, the TSCTSF determines if the
spatial validity condition shall trigger an activation or deactivation of the
access stratum time distribution:
\- If the UE has moved inside the Time Synchronization Coverage Area, then the
TSCTSF determines to enable access stratum time distribution for the UE.
\- If the UE has moved outside the Time Synchronization Coverage Area, then
the TSCTSF determines to disable access stratum time distribution for the UE.
If TSCTSF received clock quality acceptance criteria as part of the
Ntsctsf_ASTI_Create request in step 2, upon a reception of a UE presence in
Area of Interest notification, the TSCTSF determines if the UE is impacted
correlating UE presence in Area of Interest notifications provided by the
serving AMF and the timing synchronization status received (e.g. degradation,
failure, recovery) as described in clause 5.27.1.12 of TS 23.501 [2].
15-16. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
If TSCTSF determines to modify access stratum time distribution for the UE in
step 14 for which the AF requested access stratum time distribution, the
TSCTSF notifies the service status to AF.
If the TSCTSF determines a change in the support of the clock quality
acceptance criteria for the UE in step 14 for which the AF requested access
stratum time distribution, the TSCTSF includes the clock quality acceptance
criteria result to the notification to the AF. Based on this notification, the
AF decides whether to modify the ASTI service configured for the UE using
Ntsctsf_ASTI_Update service.
17\. If there was a failure/degradation/improvement event in step 14, the NG-
RAN provides timing synchronization status reports to the UE (as described in
clause 4.15.9.5.2).
#### 4.15.9.5 Procedures for subscription and management of network timing
synchronization status monitoring
##### 4.15.9.5.1 Network timing synchronization status
Figure 4.15.9.5.1-1: Procedure for TSCTSF subscription to RAN and/or UPF/NW-TT
timing synchronization status
0\. The AF requests creation or modification of ASTI or PTP based time
synchronization service as described in clauses 4.15.9.4 and 4.15.9.3
including clock quality detail level and clock quality acceptance criteria (if
applicable) in the request.
If the request is received at the NEF, it checks whether the AF is authorized
to send the request and forwards the request to the TSCTSF.
If network timing synchronization status reports are provisioned using node-
level signalling via control plane, the TSCTSF determines the serving AMF(s)
and the UPF/NW-TT nodes (if applicable) for the UE(s) that needs to initiate
network timing synchronization status monitoring.
Otherwise, if network timing synchronizations status reports are provisioned
via OAM, steps 1-3 and 5-7 are skipped.
1-2. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution or by PTP instance activation, modification):
Upon the reception of the clock quality detail level and clock quality
acceptance criteria (if applicable) in the AF request in step 0, the TSCTSF
needs to be subscribed to NG-RAN timing synchronization status updates at the
NG-RAN nodes that may provision access stratum time distribution information
to the target UE. NG-RAN timing synchronization status updates provisioning
may be configured via AMF (with node level signalling as illustrated in steps
1-2).
Namf_Communication_NonUeN2InfoSubscribe in step 2 initiates the subscription
for the NG-RAN timing synchronization status updates in the AMF. Based on
local configuration, AMF may subscribe to some or all NG-RAN nodes.
3\. (When the procedure is triggered by the AF request for PTP instance
activation, modification and if the UPF/NW-TT is involved in providing time
information to DS-TT):
Upon the reception of the clock quality acceptance criteria in the AF request
in step 0, the TSCTSF needs to be subscribed to UPF/NW-TT timing
synchronization status updates at the UPF/NW-TT that may provision time
information via PTP to the target UE. UPF/NW-TT timing synchronization status
updates provisioning may be configured via OAM or via UMIC.
4\. The RAN node is pre-configured for the thresholds for each timing
synchronization status attribute as described in clause 5.27.1.12 of TS 23.501
[2]. When the network timing synchronization status exceeds or meets again any
of the pre-configured thresholds, the NG-RAN node detects a change on its
timing synchronization status (e.g., degradation, failure, improvement).
5-6. If the NG-RAN node detects a change on its timing synchronization status
and timing synchronization status reporting is configured via the AMF in step
1, the NG-RAN node notifies the AMF providing a NG-RAN timing synchronization
status update. The update can contain the information elements listed in Table
5.27.1.12-1 of TS 23.501 [2], and the scope of the timing synchronization
status (as described in clause 5.27.1.12 of TS 23.501 [2]). The AMF forwards
the update to the subscribed TSCTSF.
7\. If the UPF/NW-TT detects a change on its timing synchronization status and
timing synchronization status reporting is configured via UMIC in step 3, the
UPF/NW-TT notifies the TSCTSF providing a UPF/NW-TT timing synchronization
status update via UMIC. The update can contain the information elements listed
in Table 5.28.3.1-2 of TS 23.501 [2].
8\. Upon the reception of a change in the NG-RAN and/or NW-TT timing
synchronization status update, the TSCTSF shall determine if the UE is
impacted and whether the clock quality acceptance criteria can still be met.
For each scope of the timing synchronization status received from the RAN in
step 6, if the status indicates degradation or failure, TSCTSF may set the
Area of Interest to gNB node ID(s) or Cell IDs in the scope of the timing
synchronization status. The TSCTSF uses the resulted Area of Interest to
subscribe for the UE presence in Area of Interest from the AMF that is serving
the gNB node ID as described in clause 5.27.1.12 of TS 23.501 [2]. If the
status indicates recovery, the TSCTSF may remove the corresponding scope from
the subscription.
Upon reception of notification for the UE presence in the Area of Interest, if
the TSCTSF determines that the UE is impacted for ASTI service, the TSCTSF
performs steps 15-16 in clause 4.15.9.4 to notify the AF the acceptance
criteria result.
Upon reception of notification for the UE presence in the Area of Interest, if
the TSCTSF determines that the UE is impacted for PTP service, the TSCTSF
performs steps 9-11 in clause 4.15.9.3.2 to notify the AF the acceptance
criteria result.
##### 4.15.9.5.2 5G access stratum time distribution status reporting to the
UE
Figure 4.15.9.5.2-1: Procedure for reporting RAN timing synchronization status
to subscribed UE
1\. Creation or update of ASTI or PTP based time synchronization service (AF
requested ASTI or PTP based time synchronization service is described in
clauses 4.15.9.4 and 4.15.9.3; subscription based ASTI is described in clause
4.28.2.1) including in the request clock quality detail level indication and
optionally the clock quality acceptance criteria. The clock quality level
indication and optionally the clock quality acceptance criteria are sent to
the NG-RAN and the UE reconnect indication is sent to the UE as described in
clause 4.15.9.4.
2\. The RAN node is pre-configured for the thresholds for each timing
synchronization status attribute as described in clause 5.27.1.12 of TS 23.501
[2]. If there is a change on its primary source so that the thresholds are
exceeded or met again, the NG-RAN node detects a change on its timing
synchronization status (e.g., degradation, failure, recovery). When the
network timing synchronization status exceeds the threshold, the NG-RAN
includes in SIB information as in TS 38.331 [12] a reference report ID. When
the network timing synchronization status meets the thresholds again (i.e.,
status improvement), the NG-RAN broadcasts the reference report ID in SIB
information. Either event serves as a notification for the UEs reading the SIB
that there is new clock quality information available
The reference report ID consists of the scope of the report ID and Event ID
(an integer), as described in clause 5.27.1.12 of TS 23.501 [2].
3\. (When the UE is in RRC_INACTIVE or RRC_IDLE state):
If supported by the UE and If the UE determines, based on the reading of SIB9
information, a clock quality information update is available, and the AMF has
provided the UE reconnection indication in step 0, the UE reconnects to the
network as described in TS 24.501 [25].
4\. (When the UE is in RRC_CONNECTED state):
The NG-RAN node notifies the UE providing clock quality information as
configured in step 0 (i.e. sending clock quality metrics or acceptable/not
acceptable indication) using unicast RRC signalling whenever the UE enters
RRC_CONNECTED state and while the UE remains in RRC_CONNECTED, when any of the
clock quality metrics or the acceptable/not acceptable indication for the UE
changes.
### 4.15.10 AF specific UE ID retrieval
This clause contains the detailed description and the procedures for the AF
specific UE ID retrieval. The AF specific UE Identifier is represented by the
External Identifier as defined in TS 23.003 [33].
NOTE 1: After retrieving AF specific UE ID, the AF can invoke NEF provided
services (e.g. location monitoring).
Figure 4.15.10-1: AF specific UE ID retrieval
1\. AF requests to retrieve UE ID via the Nnef_UEId_Get service operation. The
request message shall include UE address (IP address or MAC address) and AF
Identifier, it may include, Port Number associated with the IP address, MTC
Provider Information, Application Port ID, IP domain. The MTC Provider
Information identifies the MTC Service Provider and/or MTC Application. If
available, the AF may also provide the corresponding DNN and/or S-NSSAI.
NOTE 2: The MTC Provider Information can be used by any type of Service
Providers (MTC or non-MTC) or Corporate or External Parties for, e.g. to
distinguish their different customers.
NOTE 3: The combination of IP address and Port Number can be used by 5GC to
derive the UE private IP address assigned by 5GC if the UE is behind a NAT,
see steps 3-6 below.
NOTE 4: The Application Port ID is as defined in Nnef_Trigger_Delivery.
NOTE 5: The NEF can validate the provided MTC Provider Information and
override it to a NEF selected MTC Provider Information based on configuration.
How the NEF determines the MTC Provider Information, if not present, is left
to implementation (e.g. based on the requesting AF).
2\. The NEF authorizes the AF request. If the authorisation is not granted,
the NEF replies to the AF with a Result value indicating authorisation
failure; otherwise the NEF proceeds with the following steps. The NEF
determines corresponding DNN and/or S-NSSAI information: this may have been
provided by the AF or is determined by the NEF based on the requesting AF
Identifier, MTC Provider Information.
If the NEF has received a Port Number in step 1, based on configuration, the
NEF may recognize the address received is an IP address which is different
from the actual private UE IP address assigned by 5GC, i.e. the UE is behind a
NAT in UPF. If so, the NEF performs steps 3 to 6. Otherwise, steps 3 to 6 are
skipped.
3\. The NEF uses the Nnrf_NFDiscovery service operation to obtain the address
of the UPF implementing NAT functionality for the UE (public) IP address. The
request includes the UE (public) IP address. The NEF may also include the DNN
and S-NSSAI associated with the AF ID, as well as the IP domain.
4\. The NRF responds with a Nnrf_NFDiscovery response message including the
UPF address of the UPF implementing NAT functionality for the UE (public) IP
address.
5\. The NEF uses the Nupf_GetPrivateUEIPaddr_Get service operation to request
UE\'s (private) IP address from the UPF. The request includes the UE (public)
IP address and Port Number and optionally IP domain, DNN and S-NSSAI
associated with the AF ID.
6\. The UPF responds with the Nupf_GetPrivateUEIPaddr_Get response message
including UE\'s IP address and optionally, the IP domain. If the UPF has
applied a NAT functionality, the UE\'s IP address returned by the UPF is the
private UE IP address. If IP domain of UE private IP address is returned from
UPF, it always takes precedence regardless of whether the IP domain
information also provided by AF when it invokes Nnef_UEId_Get service
operation. If UPF has the SUPI of the UE, the UPF may return SUPI, and in this
case steps 7-8 are skipped.
7-8. The NEF uses the Nbsf_Management_Discovery service operation with UE
address and IP domain and /or DNN and/or S-NSSAI to retrieve the session
binding information of the UE. If no SUPI is received in the session binding
information from the BSF, the NEF replies to the AF with a Result value
indicating that the UE ID is not available.
9\. The NEF interacts with UDM to retrieve the AF specific UE Identifier via
the Nudm_SDM_Get service operation. The request message includes SUPI and at
least one of Application Port ID, MTC Provider Information or AF Identifier.
10\. The UDM responds to the NEF with an AF specific UE Identifier represented
as an External Identifier for the UE which is uniquely associated with the
Application Port ID, MTC provider Information and/or AF Identifier.
11\. The NEF further responds to the AF with the information (including the AF
specific UE Identifier represented as an External Identifier) received from
the UDM.
### 4.15.11 Void
### 4.15.12 Event Exposure using Local NEF
This clause contains the description and the procedure for the exposure of QoS
monitoring information via direct interaction between UPF (L-PSA UPF) and
Local NEF/AF.
Editor\'s note: It is FFS whether Local NEF is introduced or NEF is used
instead.
Figure 4.15.12-1: Event exposure using Local NEF
1\. The UPF obtains QoS monitoring information as defined in clauses 5.8.2.18
and 5.45 of TS 23.501 [2].
2\. The UPF sends the notification related with QoS monitoring information
over Nupf_EventExposure_Notify service operation according to the
configuration from SMF as defined in clause 5.8.2.18 of TS 23.501 [2]. The
notification is sent to the Notification Target Address that may correspond
(4a) to the AF or (4b) to the Local NEF.
3\. If the Local NEF is used, it reports the QoS monitoring information to the
AF by invoking Nnef_EventExposure_Notify service operation.
### 4.15.13 Assistance for Member UE selection
#### 4.15.13.0 General
AF provides a list of target UE(s) and at least one Member UE filtering
criterion as part of the service operation parameters to assist the candidate
UEs selection. Upon receiving the AF request, NEF triggers corresponding 5GC
procedures to retrieve the information for the UE in the list of target UE(s)
from 5GC NFs. Before sending the list(s) of candidate UEs to the AF, NEF
consolidates all the information collected from other 5GC NFs and derives one
or more list(s) of candidate UEs and possibly additional information according
to the Member UE filtering criteria requested by the AF.
The Member UE selection assistance capability can be used to assist the AF to
select the group of UEs to support application service (e.g. FL operation) and
it is further defined in clause 5.46.2 of TS 23.501 [2].
Additionally, AF may leverage the 5GC network exposure for Member UE selection
without the NEF assistance as described in clause 5.46.2 of TS 23.501 [2]. An
example of how AF leverages the 5GC network exposure for Member UE selection
is described in (informative) Annex I.
#### 4.15.13.1 Member UE selection general information flow
This clause describes the procedures that are generally applicable
independently of the Member UE filtering criteria sent by the AF.
Figure 4.15.13.1-1: 5GC assistance to Member UE selection and update
1\. AF subscribes the Member UE selection assistance functionality by sending
Nnef_MemberUESelectionAssistance_subscribe request including a list of target
UE(s), one or more member UE filtering criteria listed in the Table
4.15.13.2-1 and optionally, time window(s). Subsequently, the AF may update
the filtering criteria of the subscription by invoking
Nnef_MemberUESelectionAssistance_subscribe and providing a Subscription
Correlation ID.
2a. [OPTIONAL] NEF verifies the authorization of the AF Request and identifies
which information needs to be collected for each UE in the list of target
UE(s) and executes the corresponding service operation based on the Member UE
filtering criteria provided by the AF, e.g. events, analytics and/or
notifications.
2b. [OPTIONAL] The NEF correlates the
Nnef_MemberUESelectionAssistance_Subscribe request to an existing subscription
according to the Subscription Correlation ID. The NEF uses the target UEs
received in step 1 for the Member UE update using the updated filtering
criteria.
3\. NEF interacts with different 5GC network functions to collect the required
information for each UE in the list of target UE(s). The set of interactions
between NEF and among 5GC NFs are dependent on the Member UE filtering
criteria provided by the AF. See Table 4.15.13.2-1 for details.
4\. Based on the collected information from other 5GC NFs, NEF consolidates
all the information collected from other 5GC NFs to derive the list(s) of
candidate UE(s) which fulfil the Member UE filtering criteria in the AF
request. The NEF may derive recommended time window(s) considering the
validity period(s) of the analytics used for Member UE selection criteria,
which are a subset of the time window(s) received from the AF.
5\. NEF sends a Nnef_MemberUESelectionAssistance_Notify request to the AF
including the list(s) of candidate UE(s) and possibly additional information.
See clause 5.2.6.32.4 for details.
#### 4.15.13.2 Member UE Filtering Criteria for 5GS assistance to Member UE
selection
Table 4.15.13.2-1 provides a summary of the Member UE filtering criteria that
the AF may request.
Table 4.15.13.2-1: Description of Member UE filtering criteria
+----------------+----------------+----------------+----------------+ | Member UE | Description of | UE filtering | Detailed | | filtering | filtering | information | description | | criteria | criterion | | clause | +================+================+================+================+ | QoS | The Quality of | Service | 4.15.13.3 | | | Service of the | operation: | | | | selected UEs | Nsmf\ | | | | match or | _EventExposure | | | | exceed the QoS | or | | | | of the | Nudm\ | | | | filtering | _EvenExposure, | | | | criteria | | | | | | Filter: | | | | | target=SUPI, | | | | | Event=QoS | | | | | Monitoring, | | | | | traffic | | | | | descriptor | | | | | (e.g. | | | | | Application | | | | | ID) | | +----------------+----------------+----------------+----------------+ | Access Type | Indicate the | Service | This can be | | and/or RAT | Access Type | operation: | provided by | | Type of the | and/or RAT | Nsmf\ | existing | | PDU Session | Type of the | _EventExposure | service | | | selected UE | | operations, | | | for the PDU | Filter: a list | events and | | | Session used | of GPSI(s) or | procedures. | | | by the | SUPI(s), | | | | application | DNN/S-NSSAI | | | | (e.g. 3GPP/NR, | | | | | Non-3GPP/WLAN, | Event ID: | | | | additional | Change of | | | | Access Type | Access Type | | | | and RAT Type | and/or Change | | | | for MA PDU | of RAT Type | | | | session) | | | +----------------+----------------+----------------+----------------+ | End-to-end | Indicate the | Service | 4.15.13.6 | | data volume | end-to-end | operation: | | | transfer time | data volume | Nn | | | | transfer time | wdaf_Analytic | | | | that refers to | sSubscription/ | | | | a time for | Nnwdaf\ | | | | completing the | _AnalyticsInfo | | | | transmission | | | | | of a specific | Filter: | | | | data volume | Analytics ID = | | | | between UE and | End-to-end | | | | AF, e.g. the | data volume | | | | average and | transfer time, | | | | variance of | target = | | | | End-to-end | GPSI(s) or | | | | data volume | SUPI(s) | | | | transfer time | | | +----------------+----------------+----------------+----------------+ | UE current | Indicate the | Service | 4.15.13.4 | | location | certain area | operation: | | | | that the | Namf\ | | | | selected UE | _EventExposure | | | | currently | | | | | located in. | Filter: a list | | | | | of GPSI(s) or | | | | | SUPI(s) | | +----------------+----------------+----------------+----------------+ | UE historical | Indicate the | Service | 4.15.13.4 | | location | certain area | operation: | | | | that the | | | | | selected UE | N | | | | appeared in a | nwdaf_Analyti | | | | historical | csSubscription | | | | period of time | | | | | | Filter: | | | | | Analytics ID = | | | | | UE mobility, | | | | | | | | | | Filters | | | | | include | | | | | \"Visited AoI | | | | | = Target AOI\" | | | | | and \"target | | | | | period = | | | | | historical | | | | | nomadic period | | +----------------+----------------+----------------+----------------+ | UE direction | Indicate the | Service | 4.15.13.4 | | | selected UEs | operation: | | | | should include | | | | | different | N | | | | moving | nwdaf_Analyti | | | | direction | csSubscription | | | | | | | | | | Filter: | | | | | Analytics ID= | | | | | UE Mobility, | | | | | Direction | | +----------------+----------------+----------------+----------------+ | UE separation | Indicate the | Service | 4.15.13.4 | | distance | selected UEs | operation: | | | | should comply | | | | (NOTE 1) | with a minimum | Nn | | | | separation | wdaf_Analytic | | | | distance | sSubscription/ | | | | between each | | | | | other | Nnwdaf\ | | | | | _AnalyticsInfo | | | | | | | | | | Filter: | | | | | Analytics ID = | | | | | Relative | | | | | Proximity | | | | | | | | | | Filters | | | | | include | | | | | \"Proximity | | | | | Attributes\" | | +----------------+----------------+----------------+----------------+ | Service | Indicates | Service | 4.15.13.5 | | Experience | selected UEs | operation: | | | | fulfilling | Nnwdaf_Anal | | | | ceratin | yticsInfo_Req | | | | Service | uest/Subscribe | | | | Experience | Analytics | | | | criteria e.g., | ID=Service | | | | MOS value | Experience | | | | | | | | | | Filter: | | | | | S-NSSAI, DNN, | | | | | Application | | | | | ID, DNAI, AoI, | | | | | Service | | | | | Experience | | | | | Contribution | | | | | weight | | | | | reporting | | | | | threshold | | | | | (NOTE 2), | | | | | Service | | | | | Experience | | | | | Type (NOTE 3) | | +----------------+----------------+----------------+----------------+ | DNN | Indicate the | Service | 5.2.8.3 | | | DNN of the | operation: | | | | selected UE | Nsmf\ | | | | for the PDU | _EventExposure | | | | Session used | | | | | by the | Filter: a list | | | | application | of GPSI(s) or | | | | | SUPI(s) | | | | | | | | | | Event ID: QFI | | | | | allocation | | +----------------+----------------+----------------+----------------+ | NOTE 1: This | | | | | criterion | | | | | should only be | | | | | applied when | | | | | the number of | | | | | UEs is in the | | | | | range of 10\'s | | | | | or less. | | | | | | | | | | NOTE 2: The | | | | | Service | | | | | Experience | | | | | Contribution | | | | | Weights signal | | | | | the relative | | | | | importance of | | | | | each UE\'s | | | | | Service | | | | | Experience | | | | | value (i.e. | | | | | MOS), as | | | | | defined in | | | | | TS | | | | | 23.288 [50]. | | | | | For example, | | | | | it might be | | | | | that the | | | | | service | | | | | experience of | | | | | a UE in | | | | | relation to | | | | | other UEs may | | | | | not be as | | | | | important e.g. | | | | | because the | | | | | data provided | | | | | by such UE is | | | | | not as | | | | | critical to | | | | | the service. | | | | | | | | | | NOTE 3: | | | | | Indicates the | | | | | type of | | | | | service | | | | | experience | | | | | analytics, | | | | | e.g. AIML | | | | | traffic where | | | | | a customized | | | | | MoS apply. | | | | +----------------+----------------+----------------+----------------+
#### 4.15.13.3 Specific procedure for QoS Member UE filtering criteria
##### 4.15.13.3.1 General
An AF may invoke Nnef_MemberUESelectionAssistance_Subscribe service operation
with a QoS filtering criteria for receiving a list of UEs that match or exceed
such criteria.
In addition to the mandatory parameters, the AF also includes in the request:
\- QoS filtering criteria.
\- Optionally, an Area of Interest: location area of the candidate UEs.
The QoS filtering criteria includes:
\- a traffic descriptor (e.g. Application ID).
And one or more of the QoS parameters subject to QoS monitoring (see list in
clause 5.45 of TS 23.501 [2]).
The current list of UEs that match or exceed the QoS filtering criteria and
are optionally located in the AoI in real time, for the duration of the
subscription, is further described in clause 4.15.13.3.3.
##### 4.15.13.3.2 Void
##### 4.15.13.3.3 Member UE Selection Assistance with QoS filtering criteria
for real-time QoS Monitoring
At the reception of Nnef_MemberUESelectionAsistance_Subscribe request of step
1, in order to detect the list of UEs that fulfil the QoS filtering criteria
in real time, NEF performs real-time QoS monitoring. Unless the QoS flow to be
monitored is associated with a default QoS flow, QoS Monitoring needs to be
activated in SMF for that QoS Flow before (e.g. by AF Session with required
QoS) (see clause 4.15.4.5.1 for details).
Figure 4.15.13.3.3-1: 5GC assistance to Member UE selection for real-time QoS
monitoring
1\. AF subscribes to the Member UE selection assistance functionality by
sending Nnef_MemberUESelectionAssistance_subscribe request including its AF
ID, the traffic descriptors (e.g. Application ID), optionally S-NSSAI/DNN and
the QoS filtering criteria.
2\. NEF uses the AF ID to verify the authorization of the AF request and
identifies which information needs to be collected and executed based on the
QoS filtering criteria provided by the AF.
3\. If an S-NSSAI/DNN are not included in the request from the AF, the NEF
derives the S-NSSAI and DNN to which this e.g. Application ID have access. NEF
discovers querying UDM and NRF the SMFs that are deployed in the Area of
Interest. The NEF may also restrict the discovery to those SMFs that serve
some S-NSSAI and DNN combination.
4\. For each target SMF, NEF sends an Nsmf_EventExposure_Subscribe request
(Event: \'QoS monitoring\', target UEs, optionally a traffic descriptor (e.g.
Application ID), optionally indication for default QoS flows monitoring, ,
S-NSSAI, DNN, Notification Target Address set to NEF, etc.). Alternatively,
NEF may send an Nudm_EventExposure_Subscribe request to the UDM (not shown in
Figure 4.15.13.3.3-1).
5\. The SMF may need to send an N4 Session Modification request to UPF for
requesting the QoS monitoring for certain flows.
6\. UPF sends an Nupf_EventExposure_Notify request to NEF including an Event
Exposure notification, according to the subscription received from SMF.
7\. Based on the Event Exposure reports received from the UPFs, NEF
consolidates the received results and derives the list(s) of candidate UE(s)
and additional information which fulfil the QoS filtering criteria requested
by the AF request.
8\. NEF sends a Nnef_MemberUESelectionAssistance_Notify request to the AF
including the list(s) of candidate UE(s) and additional information.
#### 4.15.13.4 Specific procedure for the 5GC assistance to member UE
selection based on the UE\'s current location, historical location and
direction and UE separation distance
Figure 4.15.13.4-1: 5GC assistance to Member UE selection based on the UE\'s
travel history, direction and separation distance
1\. AF requests 5GS assistance to support the Member UE selection by
considering the UE\'s historical location, UE\'s current location, direction
and UE separation distance. AF includes the UE lists and the following
criteria as part of the FL UE selection request:
\- UE historical location: The Target AoI where the UEs have been roving over
the historical nomadic period before moving into the FL coverage area.
\- UE current location: The current AoI which is the coverage area of the FL
training server where the selected UEs located in to participate in the FL
operation.
\- Direction: Select the UE with the different direction in the FL coverage
Area.
\- UE separation distance: Select UEs that are geographically separated,
fulfilling the separation distance no smaller than the certain predefined
separation distance.
When providing a target area for FL, the AF may provide sub-areas, and provide
a maximum number of UEs that should take part in FL from each sub-area.
2\. NEF translates the GPSIs to SUPIs and maps the filtering criteria into the
corresponding UE filtering information.
3-4. The NEF invokes Namf_EventExposure_Subscribe service operation with the
UE list, the current AoI and event ID = Location report. AMF will provide a
list of UEs that are within the current AoI to the NEF using the
Namf_EventExposure_Notify service operation. The NEF obtains the list of
possible target UEs from AMF within the current AoI.
5\. In order to identify the appropriate NWDAF which can provide analytics
output to derive the visited AOI info and get the UE direction for the
possible target UEs above, the NEF initiates NWDAF discovery request
(Analytics ID = UE mobility, AOI = Target AOI) with UE list received from step
4.
6-7. The NEF invokes NWDAF Analytics Info request (UE list received from step
4, Analytics ID = UE mobility, Relative Proximity, Filters include \"Visited
AoI = Target AOI\", \"target period = historical nomadic period\" and
\"proximity attributes\"). In a response, NWDAF provides a list of UEs that
were ever roving within the target AOI, at the minimum, over the historical
nomadic period. Additionally, NWDAF provides a list of UEs location in the
order of which the UE passes through. Thus, the NEF gets the corresponding
statistics of UE mobility, the UE\'s direction and distance between UEs in the
group/list.
8-9. Based on the information provided by the AMF and NWDAF, the NEF can
determine the FL candidate UEs which are now within the FL coverage area but
were roving within the target AOI over the historical nomadic period and UE
with the different direction and separated from each other fulfilling the
minimum distance threshold as requested by AF. The NEF notifies AF for such UE
candidate list.
10\. The NEF also needs to consider the list of UEs which are now within the
FL coverage area, but may move out of the FL coverage area. Therefore, for
each UE in the candidate list in steps 8-9, the NEF invokes the
Namf_EventExposure_Notify service with UE ID = SUPI, Event ID=UE moving in/out
of AOI in order to keep tracking the movement of the UE(s).
11-12. If step 10 identifies any UE which is moving out of the FL coverage
area, the NEF may further notify AF of the given UE which is moving out the
coverage.
#### 4.15.13.5 Specific procedure for Service Experience Member UE filtering
criteria
##### 4.15.13.5.1 General
An AF may invoke Nnef_MemberUESelectionAssistance_Subscribe service operation
with a Service Experience filtering criteria for receiving a list of UEs that
fulfil such criteria.
In addition to the mandatory parameters, the AF may also include in the
request:
\- Service Experience filtering criteria.
\- An Area of Interest: location area of the candidate UEs.
\- Time windows for selecting the candidate UEs: start time and stop time.
\- Service Experience contribution weights.
\- Service Experience Type.
The AF may provide a Service Experience filtering criteria, including
contribution weights associated to location, e.g. AoI or DNAI, time window,
Application ID and Service Experience type e.g. contribution weight may be
provided to favour Service Experience type relative to AIML traffic in a
particular location.
##### 4.15.13.5.2 Member UE Selection Assistance with Service Experience
filtering criteria
Figure 4.15.13.5.2-1: 5GC assistance to Member UE selection based on Service
Experience
1\. AF subscribes to the Member UE selection assistance functionality by
sending Nnef_MemberUESelectionAssistance_subscribe request including the
Application Identity, AoI, DNAI(s), Service Experience Type and contribution
weights associated to location, time window, Application ID and Service
Experience type.
2\. NEF verifies the authorization of the AF Request and identifies which
information needs to be collected and executed based on the Service Experience
filtering criteria provided by the AF.
3\. If an Application ID is present in the request from the AF, the NEF
derives the S-NSSAI, DNN and DNAI(s) to which this Application ID have access.
Due to the absence of a time window in the request from the AF, NEF discovers
querying UDM, NRF and the SMFs that are deployed in the Area of Interest. The
NEF may also restrict the discovery to those SMFs that serve some S-NSSAI and
DNN combination (this S-NSSAI and DNN combination has been derived from the
Application Id or AF Id).
4\. NEF sends an Analytics request/subscribe to NWDAF by invoking a
Nnwdaf_AnalyticsInfo_Request or a Nnwdaf_AnalyticsSubscription_Subscribe,
including Analytics ID = Service Experience, Application ID, S-NSSAI, AoI,
DNAI(s), and target UEs based on the initial list obtained from the AF.
5-7. Procedures as specified in clause 6.4.6 of TS 23.288 [50] are followed.
8\. The NWDAF provides the data analytics, i.e. the observed Service
Experience (which can be a range of values) to the consumer NF by means of
either Nnwdaf_AnalyticsInfo_Request response or
Nnwdaf_AnalyticsSubscription_Notify, depending on the service used in step 4.
9\. Based on the Analytics report received from the NWDAF, NEF consolidates
results and derives the list(s) of candidate UE(s). For applying that, NEF may
use the Service Experience type provided by the AF consumer in the filtering
information and use operator policies to interpret a customized MoS.
Additionally, NEF may use the contribution weight associated to an application
and a Service Experience Type (e.g. AI/ML traffic) and apply them to a
location and time window, as provided by the AF consumer, to be used as
reporting thresholds when selecting candidate Member UEs, e.g. the NEF may
select a UE with a specific Service Experience Type as a Member UE candidate,
if the associated Service Experience fulfils the threshold for Service
Experience filtering criteria provided by the AF.
10\. NEF sends a Nnef_MemberUESelectionAssistance_Notify request to the AF
including the list(s) of candidate UE(s) and additional information.
#### 4.15.13.6 Specific procedure for end-to-end data volume transfer time
related member UE filtering criteria
##### 4.15.13.6.1 General
An AF may invoke Nnef_MemberUESelectionAssistance_Subscribe service operation
with end-to-end data volume transfer time related filtering criteria for
receiving a list of UEs that fulfil the filtering criteria.
In addition to the mandatory parameters, the AF may also include in the
request:
\- End-to-end data volume transfer time filtering criteria: this may include
the average end-to-end data volume transfer time for a specific data volume
between UE and AF and/or the variance of the end-to-end data volume transfer
time.
\- An Area of Interest: location area of the candidate UEs.
\- Time windows for selecting the candidate UEs: start time and stop time.
##### 4.15.13.6.2 Member UE Selection assistance with end-to-end data volume
transfer time related filtering criteria
Figure 4.15.13.6.2-1: Assistance to member UE selection for end-to-end data
volume transfer time related filtering criteria
1\. AF subscribes to the member UE selection assistance functionality by
invoking Nnef_MemberUESelectionAssistance_subscribe request including the
Application ID, DNN/S NSSAI, AoI, and the end-to-end data volume transfer time
related filtering criteria including the average end-to-end data volume
transfer time and/or the variance of the transfer time.
2\. NEF verifies the authorization of the AF Request and identifies which
information needs to be collected and executed based on the end-to-end data
volume transfer time related filtering criteria provided by the AF.
3\. If an Application ID is present in the request from the AF, the NEF
derives the S-NSSAI, DNN and DNAI(s) to which this Application ID have access.
NEF discovers querying UDM and NRF the SMFs that are deployed in the Area of
Interest. The NEF may also restrict the discovery to those SMFs that serve
some S-NSSAI and DNN combination (this S-NSSAI and DNN combination has been
derived from the Application ID).
4\. NEF sends an Analytics request/subscribe to NWDAF by invoking
Nnwdaf_AnalyticsSubscription_Subscribe / Nnwdaf_AnalyticsInfo_Request
including Analytics ID = end-to-end data volume transfer time, Application ID,
S-NSSAI, AoI, and target UEs based on the initial UE list obtained from the
AF.
5\. The NWDAF collects data from multiple sources for end-to-end data volume
transfer time analytics as specified in clause 6.18.2 of TS 23.288 [50].
6\. The NWDAF provides the required output analytics to the consumer NF as
specified in clause 6.18.4 of TS 23.288 [50] by means of either
Nnwdaf_AnalyticsInfo_Request response or Nnwdaf_AnalyticsSubscription_Notify,
depending on the service used in step 4.
7\. Based on the analytics received from the NWDAF, the NEF consolidates
results and derives the list(s) of candidate UE(s) that fulfil the filtering
criteria requested by the AF. The NEF may use the average end-to-end data
volume transfer time of specific volumes of data and/or the variance to derive
the list(s) of candidate UEs that meet the requirements from the AF.
8\. NEF sends a Nnef_MemberUESelectionAssistance_Notify request to the AF
including the list(s) of candidate UE(s) and additional information.
## 4.16 Procedures and flows for Policy Framework
### 4.16.1 AM Policy Association Establishment
#### 4.16.1.1 General
There are three cases considered for AM Policy Association Establishment:
1\. UE initial registration with the network.
2\. The AMF re-allocation with PCF change in handover procedure and
registration procedure.
3\. EPS to 5GS mobility when there is no existing AM Policy Association
between AMF and PCF for this UE.
#### 4.16.1.2 AM Policy Association Establishment with new Selected PCF
Figure 4.16.1.2-1: AM Policy Association Establishment with new Selected PCF
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the role of the V-PCF is performed by the PCF. For the
roaming scenarios, the V-PCF interacts with the AMF.
1\. Based on local policies, the AMF decides to establish AM Policy
Association with the (V-)PCF then steps 2 to 3 are performed under the
conditions described below.
2\. [Conditional] If the AMF has not yet obtained access and mobility related
policy information for the UE or if the access and mobility related policy
information in the AMF is no longer valid, the AMF requests the PCF to apply
operator policies for the UE from the PCF. The AMF sends
Npcf_AMPolicyControl_Create to the (V-)PCF to establish an AM Policy
Association with the (V-)PCF. The request includes the following information:
SUPI, Internal Group (see clause 5.9.7 of TS 23.501 [2]), subscription
notification indication and if available, Service Area Restrictions, RFSP
index, Subscribed UE-AMBR, List of Subscribed UE-Slice-MBR, the Allowed NSSAI,
Partially Allowed NSSAI, Target NSSAI (see clause 5.3.4.3.3 of TS 23.501 [2]),
GPSI which are retrieved from the UDM during the update location procedure and
may include Access Type and RAT Type, PEI, ULI, UE time zone and Serving
Network (PLMN ID, or PLMN ID and NID, see clause 5.34 of TS 23.501 [2]).
When AMF utilizes an NWDAF, it may add the NWDAF serving the UE identified by
the NWDAF instance ID. Per NWDAF service instance the Analytics ID(s) are also
included.
3\. In non-roaming case, if the PCF determines that the policy decision
depends on the status of the policy counters available at the CHF and such
reporting is not established for the subscriber, the PCF initiates an Initial
Spending Limit Report Retrieval as defined in clause 4.16.8.2. If policy
counter status reporting is already established for the subscriber and the PCF
determines that the status of additional policy counters is required, the PCF
initiates an Intermediate Spending Limit Report Retrieval as defined in clause
4.16.8.3.
The (V)-PCF responds to the Npcf_AMPolicyControl_Create service operation. The
(V)-PCF provides access and mobility related policy information (e.g. Service
Area Restrictions) as defined in clause 6.5 of TS 23.503 [20]. In addition,
(V)-PCF can provide Policy Control Request Trigger of AM Policy Association to
AMF. In the non-roaming case, the PCF may subscribe to Analytics from NWDAF as
defined in clause 6.1.1.3 of TS 23.503 [20].
The AMF is implicitly subscribed in the (V-)PCF to be notified of changes in
the policies.
The (V-)PCF may register to the BSF as the PCF that handles the AM Policy
Association for this UE. This is performed by using the
Nbsf_Management_Register operation, providing as inputs the UE SUPI/GPSI and
the PCF identity.
4\. [Conditional] The AMF deploys the access and mobility related policy
information which includes storing the Service Area Restrictions and Policy
Control Request Trigger(s) of the AM Policy Association, provisioning Service
Area Restrictions to the UE and provisioning the RFSP index, the UE-AMBR, List
of UE-Slice-MBR, Service Area Restrictions to the NG-RAN as defined in TS
23.501 [2] and request for notification of SM Policy association establishment
and termination to a list of (DNN, S-NSSAI)(s) together with PCF for the UE
binding information.
#### 4.16.1.3 Void
### 4.16.2 AM Policy Association Modification
#### 4.16.2.0 General
There are three cases considered for AM Policy Association Modification:
\- Case A: A Policy Control Request Trigger condition is met: the procedure is
initiated by the AMF.
\- Case B: PCF policy decision per local decision or per trigger by other
peers of the PCF (i.e. UDR, AF or NWDAF): the procedure is initiated by the
PCF.
\- Case C: AM Policy Association Modification with the old PCF during AMF
relocation: the procedure is initiated by the AMF.
In the non-roaming case, the PCF may interact with the CHF to make policy
decisions, for Access and Mobility related policies, based on spending limits.
#### 4.16.2.1 AM Policy Association Modification initiated by the AMF
##### 4.16.2.1.1 AM Policy Association Modification initiated by the AMF
without AMF relocation
This procedure is applicable to Case A.
Figure 4.16.2.1.1-1: AM Policy Association Modification initiated by the AMF
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the role of the V-PCF is performed by the PCF. For the
roaming scenarios, the V-PCF interacts with the AMF.
1\. When a Policy Control Request Trigger condition is met the AMF updates the
AM Policy Association and provides information on the conditions that have
changed to the PCF by invoking Npcf_AMPolicyControl_Update.
2\. The (V-)PCF stores the information received in step 1 and makes the policy
decision. In the non-roaming case, the PCF may subscribe to Analytics from
NWDAF as defined in clause 6.1.1.3 of TS 23.503 [20]. If the PCF determines a
change to policy counter status reporting is required, it may alter the
subscribed list of policy counters using the Initial, Intermediate or Final
Spending Limit Report Retrieval procedures as defined in clause 4.16.8.
3\. The (V-)PCF responds to the AMF with the updated access and mobility
related policy information as defined in clause 6.5 of TS 23.503 [20] and the
updated Policy Control Request Trigger parameters. If an AF has previously
subscribed to request for allocation of service area coverage outcome event,
the (V-)PCF checks if reporting is needed, using the Policy Control Request
Trigger that was met (see step 1) as input, then sends a respective
notification to the AF using Npcf_AMPolicyAuthorization_Notify, as defined in
clause 6.1.3.18 of TS 23.503 [20].
4\. The AMF deploys the access and mobility related policy information, which
includes storing the Service Area Restrictions and Policy Control Request
Trigger of AM Policy Association, provisioning the Service Area Restrictions
to the UE and provisioning the RFSP index, UE-AMBR, List of UE-Slice-MBR,
Service Area Restrictions to the NG-RAN as defined in TS 23.501 [2] and
request for notification of SM Policy association establishment and
termination to a list of (DNN, S-NSSAI)(s) together with PCF for the UE
binding information.
##### 4.16.2.1.2 AM Policy Association Modification with old PCF during AMF
relocation
This procedure is applicable to Case C. In this case, AMF relocation is
performed without PCF change in handover procedure and registration procedure.
Figure 4.16.2.1.2-1: AM Policy Association Modification with the old PCF
during AMF relocation
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the role of the V-PCF is performed by the PCF. For the
roaming scenarios, the V-PCF interacts with the AMF:
1\. [Conditional] When the old AMF and the new AMF belong to the same PLMN,
the old AMF transfers to the new AMF the AM Policy Association information
including Policy Control Request Trigger(s) and the PCF ID. For the roaming
case, the new AMF receives V-PCF ID.
2\. Based on local policies, the new AMF decides to establish an AM Policy
Association with the (V-)PCF and contacts the (Vâ€‘)PCF identified by the PCF ID
received in step 1.
3\. The new AMF sends Npcf_AMPolicyControl_Update to the (V-)PCF to update the
AM Policy Association with the (V-)PCF. The request may include the following
information: Policy Control Request Trigger which has been met, Subscribed
Service Area Restrictions (if updated), subscribed RFSP index (if updated)
which are retrieved from the UDM during the update location procedure and may
include access type and RAT, PEI, ULI, UE time zone, service network. The
(V-)PCF updates the stored information provided by the old AMF with the
information provided by the new AMF. In the non-roaming case, the PCF may
subscribe to Analytics from NWDAF as defined in clause 6.1.1.3 of TS 23.503
[20]. If the PCF determines a change to policy counter status reporting is
required, it may alter the subscribed list of policy counters using the
Initial, Intermediate or Final Spending Limit Report Retrieval procedures as
defined in clause 4.16.8.
When AMF utilizes an NWDAF, it may add the NWDAF serving the UE identified by
the NWDAF instance ID. Per NWDAF service instance the Analytics ID(s) are also
included.
4\. The (V-)PCF may update the policy decision based on the information
provided by the new AMF and responds to the Npcf_AMPolicyControl_Update
service operation providing access and mobility related policy information as
defined in clause 6.5 of TS 23.503 [20]. If an AF has previously subscribed to
request for allocation of service area coverage outcome event the (V-)PCF
checks if reporting is needed, using the Policy Control Request Trigger that
was met (see step 1) as input, then sends a respective notification to the AF
using Npcf_AMPolicyAuthorization_Notify, as defined in clause 6.1.3.18 of TS
23.503 [20].
5\. The AMF deploys the access and mobility related policy information, which
includes storing the Service Area Restrictions, provisioning Service Area
Restrictions to the UE and provisioning the RFSP index, UE-AMBR, Service Area
Restrictions to the NG-RAN and request for notification of SM Policy
association establishment and termination to a list of (DNN, S-NSSAI)(s)
together with PCF for the UE binding information.
#### 4.16.2.2 AM Policy Association Modification initiated by the PCF
The AM Policy Association modification procedure may be initiated by an
internal PCF event or by PCF obtaining pertinent analytics information from an
NWDAF.
The following procedure is applicable to AM Policy Association modification
due to Case B.
Figure 4.16.2.2-1: AM Policy Association Modification initiated by the PCF
The procedure driven by a PCF internal event applies to both roaming and non-
roaming scenarios and when driven by NWDAF or CHF, applies only to non-roaming
scenarios.
An AM Policy Association is established, with the V-PCF in case of roaming or
with the PCF in a non-roaming case as described in clause 4.16.1.2 before this
procedure is triggered.
In the non-roaming case the role of the V-PCF is performed by the PCF. For the
roaming scenarios, the V-PCF interacts with the AMF.
NOTE: The V-PCF/PCF stores the access and mobility related policy information
provided to the AMF.
1\. [Conditional] The PCF determines internally that the new status of the UE
context requires new policies, potentially triggered by an AF as described in
clause 4.15.6.9 or by a notification from the UDR or optionally, the CHF
provides a Spending Limit Report to the PCF as described in clause 4.16.8.
This may be triggered by obtaining pertinent analytics information from an
NWDAF as described in clause 6.1.1.3 of TS 23.503 [20].
2\. The (V-)PCF in case of roaming and PCF in a non-roaming case makes a
policy decision. The PCF may also decide to subscribe to a new Analytics ID
from NWDAF as described in clause 6.1.1.3 of TS 23.503 [20].
3\. The (V-)PCF in the roaming case and the PCF in a non-roaming case sends
Npcf_AMPolicyControl_UpdateNotify including AM Policy Association ID
associated with the SUPI defined in TS 29.507 [32]. The policy update may
include Service Area Restrictions, UE-AMBR, RFSP index value and RFSP in Use
Validity Time, access stratum time distribution indication, Uu time
synchronization error budget, clock quality detail level and optionally clock
quality acceptance criteria. If an AF has previously subscribed to event
request for allocation of service area coverage outcome in step 1, the (V-)PCF
checks if the allocated service area coverage was changed and sends a
respective notification to the AF using Npcf_AMPolicyAuthorization_Notify as
defined in clause 6.1.3.18 of TS 23.503 [20].
4\. The AMF deploys and stores the updated access and mobility related policy
information, which includes storing the Service Area Restrictions and Policy
Control Request Trigger of AM Policy Association, provisioning of the Service
Area Restrictions to the UE, provisioning the RFSP index, UE-AMBR, Service
Area Restrictions to the NG-RAN, optionally the access stratum time
distribution indication, Uu time synchronization error budget, clock quality
detail level and optionally clock quality acceptance criteria to the NG-RAN
and request for notification of SM Policy association establishment and
termination to a list of (DNN, S-NSSAI)(s) together with PCF for the UE
binding information.
### 4.16.3 AM Policy Association Termination
#### 4.16.3.1 General
The following case is considered for AM Policy Association Termination:
1\. UE Deregistration from the network.
2\. The mobility with change of AMF (e.g. new AMF is in different PLMN or new
AMF in the same PLMN).
3\. [Optional] 5GS to EPS mobility with N26 if the UE is not connected to the
5GC over a non-3GPP access in the same PLMN.
In the non-roaming case, the PCF may interact with the CHF to make policy
decisions, for Access and Mobility related policies, based on spending limits.
#### 4.16.3.2 AMF-initiated AM Policy Association Termination
Figure 4.16.3.2-1: AMF-initiated AM Policy Association Termination
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the role of the V-PCF is performed by the PCF. For the
roaming scenarios, the V-PCF interacts with the AMF.
1\. The AMF decides to terminate the AM Policy Association during
Deregistration procedure or due to mobility with change of AMF and (V-)PCF in
the registration procedure or handover procedure, then if a AM Policy
Association was established with the (V-)PCF steps 2 to 3 are performed.
2\. The AMF sends the Npcf_AMPolicyControl_Delete service operation including
AM Policy Association ID to the (V-)PCF.
3\. The (V-)PCF removes the policy context for the UE and replies to the AMF
with an Acknowledgement including success or failure. In the non-roaming case,
the PCF may unsubscribes to analytics from NWDAF. The (V-)PCF may deregister
from the BSF as the PCF that handles the AM Policy Association for this UE.
This is performed by using the Nbsf_Management_Deregister service operation,
providing the Binding Identifier that was obtained earlier from the BSF when
performing the Nbsf_Management_Register service operation.
If the PCF has subscribed to the policy counter status to the CHF, it invokes
the procedure defined in clause 4.16.8 to unsubscribe to policy counter status
reporting.
4\. The AMF removes the AM Policy Association for this UE, including the
Access and Mobility Control Policy related to the UE. The AMF deletes the
subscription to AMF detected events requested for that Policy Association.
#### 4.16.3.3 Void
### 4.16.4 SM Policy Association Establishment
Figure 4.16.4-1: SM Policy Association Establishment
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the V-PCF is not involved. In the local breakout
roaming case, the H-PCF is not involved. In the home routed roaming case, the
V-PCF is not involved and the H-PCF interacts with the H-SMF.
This procedure is used in UE requests a PDU Session Establishment as explained
in clause 4.3.2.2.1, for non-roaming and local breakout roaming. For home-
routed roaming, as explained in clause 4.3.2.2.2.
For local breakout roaming, the interaction with HPLMN (e.g. step 3) is not
used. In local breakout roaming, the V-PCF interacts with the UDR of the
VPLMN.
1\. The SMF determines that the PCC authorization is required and requests to
establish an SM Policy Association with the PCF by invoking
Npcf_SMPolicyControl_Create operation, including information about the PDU
Session as specified in clause 5.2.5.4.2.
The SMF provides Trace Requirements to the PCF when it has received Trace
Requirements and it has selected a different PCF than the one received from
the AMF.
If the DNN Selection Mode indicates that the DNN is not explicitly subscribed,
the PCF may use the local configuration instead of PDU Session policy control
data in UDR.
The QoS constraints from the VPLMN are provided by the H-SMF to the H-PCF in
the home routed roaming scenario as defined in clause 4.3.2.2.2.
If the SMF utilizes an NWDAF or in case the SMF has received information from
AMF or UPF that are consumer of analytic services, the SMF includes the IDs of
each of these NWDAFs serving the UE (for SMF, AMF and UPF), identified by the
NWDAF instance Id. The Analytics ID(s) are also included per NWDAF service
instance.
The SMF provides the request for notification of SM Policy Association
establishment and termination to a DNN, S-NSSAI together with PCF for the UE
binding information to the PCF if received from the AMF.
2\. If the PCF does not have the subscriber\'s subscription related
information, it sends a request to the UDR by invoking Nudr_DM_Query (SUPI,
DNN, S-NSSAI, Policy Data, PDU Session policy control data, Remaining allowed
Usage data) service in order to receive the information related to the PDU
Session. The PCF may request notifications from the UDR on changes in the
subscription information by invoking Nudr_DM_Subscribe (Policy Data, SUPI,
DNN, S-NSSAI, Notification Target Address (+ Notification Correlation Id),
Event Reporting Information (continuous reporting), PDU Session policy control
data, Remaining allowed Usage data) service.
NOTE 1: For local breakout roaming, PDU Session policy control subscription
information and Remaining allowed usage subscription information for
monitoring control as defined in clause 6.2.1.3 of TS 23.503 [20] are not
available in V-UDR and V-PCF uses locally configured information according to
the roaming agreement with the HPLMN operator.
3\. If the PCF determines that the policy decision depends on the status of
the policy counters available at the CHF and such reporting is not established
for the subscriber, the PCF initiates an Initial Spending Limit Report
Retrieval as defined in clause 4.16.8.2. If policy counter status reporting is
already established for the subscriber and the PCF determines that the status
of additional policy counters are required, the PCF initiates an Intermediate
Spending Limit Report Retrieval as defined in clause 4.16.8.3.
4\. The PCF makes the authorization and the policy decision. The PCF may
reject Npcf_SMPolicyControl_Create request when Validation condition is not
satisfied. (see clause 6.1.2.4 of TS 23.503 [20]).
The PCF may invoke Nbsf_Management_Register service operation to create the
binding information in BSF.
The PCF may report that a SM Policy Association is established as described in
clause 4.16.14.2.
In the non-roaming case, the PCF may subscribe to Analytics from NWDAF as
defined in clause 6.1.1.3 of TS 23.503 [20].
In the home-routed roaming scenario, the H-PCF ensures that the QoS
constraints provided by the VPLMN are taken into account as described in TS
23.503 [20].
5\. The PCF answers with a Npcf_SMPolicyControl_Create response; in its
response the PCF may provide policy information defined in clause 5.2.5.4 (and
in TS 23.503 [20]). The SMF enforces the decision. The SMF implicitly
subscribes to changes in the policy decisions.
NOTE 2: After this step the PCF can subscribe to SMF events associated with
the PDU Session.
If the PCF determines based on a local policy, that the PDU Session is
potentially impacted by (g)PTP time synchronization service, or the PDU
Session belongs to a 5GS DetNet router, the PCF can include a subscription for
SMF event for \"5GS Bridge/Router information\" associated with the PDU
Session into the Npcf_SMPolicyControl_Create response. In this case, if the
SMF has stored the 5GS Bridge/Router information and has not reported the
event to the PCF, the SMF initiates an SM Policy Association Modification
procedure and notifies the PCF for the event of \"5GS Bridge/Router
information Notification\".
### 4.16.5 SM Policy Association Modification
#### 4.16.5.0 General
The following SM Policy Association Modification procedures concern both
roaming and non-roaming scenarios.
In the non-roaming case the V-PCF is not involved. In the local breakout
roaming case, the H-PCF is not involved. In the home routed roaming case, the
V-PCF is not involved and the H-PCF interacts with the H-SMF.
The SM Policy Association Modification procedure may be initiated either by
the SMF or by the PCF.
#### 4.16.5.1 SMF initiated SM Policy Association Modification
The SMF may initiate the SM Policy Association Modification procedure if a
Policy Control Request Trigger is met.
NOTE 1: When SMF instance is changed within the same SMF set the callback URI
can be updated via this procedure.
Figure 4.16.5.1-1: SMF initiated SM Policy Association Modification
For local breakout roaming, the interaction with HPLMN (e.g. step 2) is not
used. In local breakout roaming, the V-PCF interacts with the UDR of the
VPLMN.
1\. When a Policy Control Request Trigger condition is met the SMF requests to
update (Npcf_SMPolicyControl_Update) the SM Policy Association and provides
information on the conditions that have been met as specified in clause
5.2.5.4.5.
If the SMF is notified by NRF that the stored PCF instance is not reachable,
it should query the NRF for PCF instances within the PCF set and select
another instance (see clause 6.3.1.0 of TS 23.501 [2]).
The QoS constraints from the VPLMN are provided by the H-SMF to the H-PCF in
the home routed roaming scenario as defined in clause 4.3.2.2.2.
2\. When an AF has subscribed to an event that is met due to the report from
the SMF, the PCF reports the event to the AF or TSCTSF by invoking the
Npcf_PolicyAuthorization_Notify service operation.
If the SMF has reported that new 5GS Bridge/Router information has been
detected and no AF session exists for this PDU session yet:
\- If integration with TSN applies (see clause 5.28 of TS 23.501 [2]), then
the PCF informs a pre-configured TSN AF using the
Npcf_PolicyAuthorization_Notify (User-plane Node ID, the port number of the
DS-TT port, MAC address of the DS-TT Ethernet port for the PDU Session and UE-
DS-TT Residence Time (if available)) service operation for the event of \"5GS
Bridge/Router information Notification\" as described in clause 6.1.3.18 of TS
23.503 [20].
\- Otherwise, i.e. if the integration with TSN does not apply, the PCF may
inform discovered and selected TSCTSF (as described in clause 6.3.24 of TS
23.501 [2]) using the Npcf_PolicyAuthorization_Notify (User Plane Node ID, UE-
DS-TT Residence Time (if available), the port number for the PDU session and
MAC address of the DS-TT Ethernet port for Ethernet type PDU Session or IP
address for IP type PDU Session, MTU size for IPv4 or IPv6 (if available))
service operation for the event of \"5GS Bridge/Router information
Notification\" as described in clause 6.1.3.18 of TS 23.503 [20]. In the case
of private IPv4 address being used for IP type PDU Session, the
Npcf_PolicyAuthorization_Notify also contains DNN and S-NSSAI of the PDU
Session.
NOTE 2: For a given DNN and S-NSSAI, it is assumed that the network only needs
to deploy one or TSCTSF Set in this Release of the specification.
When the TSN AF or TSCTSF receives the Npcf_PolicyAuthorization_Notify message
and no AF session exists for this PDU Session, the TSN AF shall use the
Npcf_PolicyAuthorization service described in clause 5.2.5.3 to request
creation of a new AF session specific to the received MAC address of the DS-TT
Ethernet port of the PDU Session, while the TSCTSF shall use the
Npcf_PolicyAuthorization service to request creation of a new AF session
specific to the received MAC address of the DS-TT Ethernet port (if available,
for Ethernet type PDU Session) or IP address (for IP type PDU Session) of the
PDU Session. In the case of private IPv4 address being used for IP type PDU
Session, the TSCTSF shall use the Npcf_PolicyAuthorization service to request
creation of a new AF session specific to the received IP address, DNN and
S-NSSAI of the IP type PDU Session. The TSN AF or TSCTSF shall then use the
Npcf_PolicyAuthorization service to subscribe for notifications for 5GS
Bridge/Router information Notification event over the newly established AF
session. The TSN AF or TSCTSF may provide a Port or User-Plane Management
Information Container for the PDU Session and related port number in the
Npcf_PolicyAuthorization creation request.
If the SMF has reported PMIC with port number or UMIC, then the PCF also
provides these information elements to the TSN AF or TSCTSF.
When integration with TSN applies (see clause 5.28 of TS 23.501 [2]), the TSN
AF calculates the bridge delay for each port pair, using the UE-DS-TT
Residence Time of the DS-TT Ethernet port(s) for the 5GS bridge indicated by
the 5GS user-plane Node ID.
3\. If the PCF determines a change to policy counter status reporting is
required, it may alter the subscribed list of policy counters using the
Initial, Intermediate or Final Spending Limit Report Retrieval procedures as
defined in clause 4.16.8.
4\. The PCF makes a policy decision as described in TS 23.503 [20]. The PCF
may determine that updated or new policy information needs to be sent to the
SMF.
If the SMF reported accumulated usage for the PDU session in step 1 the PCF
deducts the value from the remaining allowed usage for the subscriber, DNN and
S-NSSAI in the UDR by invoking Nudr_DM_Update (SUPI, DNN, S-NSSAI, Policy
Data, Remaining allowed Usage data, updated data) service operation.
If the SMF reported accumulated usage for a MK(s) in step 1 the PCF deducts
the value from the remaining allowed usage for the MK in the UDR by invoking
Nudr_DM_Update (SUPI, DNN, S-NSSAI, Policy Data, Remaining allowed Usage data,
updated data (including MK(s))) service operation.
When new PCF instance is selected in step 1, the new PCF should invoke
Nbsf_Management_Update service operation to update the binding information in
BSF.
In the non-roaming case, the PCF may subscribe to Analytics from NWDAF as
defined in clause 6.1.1.3 of TS 23.503 [20].
In the home-routed roaming scenario, the H-PCF ensures that the QoS
constraints provided by the VPLMN are taken into account as described in TS
23.503 [20].
NOTE 3: For local breakout roaming, PDU Session policy control subscription
information and Remaining allowed usage subscription information for
monitoring control as defined in clause 6.2.1.3 of TS 23.503 [20] are not
available in V-UDR and V-PCF uses locally configured information according to
the roaming agreement with the HPLMN operator.
5\. The PCF answers with a Npcf_SMPolicyControl_Update response with updated
policy information about the PDU Session determined in step 4.
#### 4.16.5.2 PCF initiated SM Policy Association Modification
The PCF may initiate SM Policy Association Modification procedure based on
internal PCF event or triggered by other peers of the PCF (AF, NWDAF, CHF, UDR
and TSCTSF).
Figure 4.16.5.2-1: PCF initiated SM Policy Association Modification
This procedure may be triggered by a local decision of the PCF or based on
triggers from other peers of the PCF (AF, NWDAF, CHF, UDR and TSCTSF):
An SM Policy Association is established, with the PCF as described in clause
4.16.4 before this procedure is triggered.
For local breakout roaming, the interaction with HPLMN (e.g. step 1b and step
2) is not used. In local breakout roaming, the V-PCF interacts with the UDR of
the VPLMN.
1a. Alternatively, optionally, the AF, NEF or TSCTSF provides/revokes service
information to the PCF e.g. due to AF session signalling, by invoking
Npcf_PolicyAuthorization_Create Request or Npcf_PolicyAuthorization_Update
Request or Npcf_PolicyAuthorization_Subscribe Request service operation. The
PCF responds to the AF, NEF or TSCTSF.
1b. Alternatively, optionally, the CHF provides a Spending Limit Report to the
PCF as described in clause 4.16.8. and responds to the CHF.
1c. Alternatively, optionally, the UDR notifies the PCF about a policy
subscription change by invoking Nudr_DM_Notify (Notification correlation Id,
Policy Data, SUPI, updated data, \"PDU Session Policy Control Data\" \|
\"Remaining allowed Usage data\"); The PCF responds to the UDR.
1d. Alternatively, optionally, some internal event (e.g. timer, or local
decision based on analytics information requested and received from NWDAF)
occurs at the PCF. The analytics (i.e. Analytics ID) which can be requested
from NWDAF are described in clause 6.1.1.3 of TS 23.503 [20].
2\. If the PCF determines a change to policy counter status reporting is
required, it may alter the subscribed list of policy counters using the
Initial, Intermediate or Final Spending Limit Report Retrieval procedures as
defined in clause 4.16.8.
NOTE 1: The PCF ensures that information received in step 1 and 2 can be used
by later policy decisions.
NOTE 2: For local breakout roaming, PDU Session policy control subscription
information and Remaining allowed usage subscription information for
monitoring control as defined in clause 6.2.1.3 of TS 23.503 [20] are not
available in V-UDR and V-PCF uses locally configured information according to
the roaming agreement with the HPLMN operator.
3\. The PCF makes a policy decision. The PCF may determine that updated or new
policy information need to be sent to the SMF. In the non-roaming case, the
PCF may also decide to subscribe to a new Analytics ID from NWDAF as described
in clause 6.1.1.3 of TS 23.503 [20].
If the AF provided a Background Data Transfer Reference ID in step 1a, the PCF
may retrieve it from the UDR by invoking the Nudr_DM_Query (BDT Reference Id,
Policy Data, Background Data Transfer) service.
4\. If the PCF has determined that SMF needs updated policy information in
step 3 or if the PCF has received a Port Management Information Container for
the PDU Session and related port number from the AF or TSCTSF in step 1a, the
PCF issues a Npcf_SMPolicyControl_UpdateNotify request with possibly updated
policy information about the PDU Session.
If the PCF has received a subscription for 5GS Bridge/Router information
Notification in Step 1a, the PCF can include a subscription for SMF event for
\"5GS Bridge/Router information\" associated with the PDU Session into the
Npcf_SMPolicyControl_UpdateNotify request. In this case, if the SMF has stored
the 5GS Bridge/Router information and has not reported the event to the PCF,
the SMF notifies the PCF for the event of \"5GS Bridge/Router Information \".
If the PCF has received a Npcf_PolicyAuthorization_Unsubscribe request to
unsubscribe for 5GS Bridge/Router information Notification, the PCF can remove
the subscription for SMF event for \"5GS Bridge/Router information\"
associated with the PDU Session and issue a Npcf_SMPolicyControl_UpdateNotify
request with the updated policy information about the PDU Session.
NOTE 3: If the TSCTSF receives a Requested 5GS delay and the TSCTSF does not
have the 5GS Bridge/Router information for the AF-session, the TSCTSF can
subscribe for the 5GS Bridge/Router information from the PCF by triggering a
Npcf_PolicyAuthorization_Subscribe request.
If the PCF has received a subscription to notification on BAT offset along
with the TSC Assistance Container from TSCTSF in step 1a, the PCF can include
a subscription to notification on BAT offset associated with the PDU Session
into the Npcf_SMPolicyControl_UpdateNotify request.
5\. The SMF acknowledges the PCF request with a
Npcf_SMPolicyControl_UpdateNotify response.
If the Npcf_SMPolicyControl_UpdateNotify request is received from new PCF
instance in the PCF Set, the SMF store the SM policy association towards the
new PCF instance.
### 4.16.6 SM Policy Association Termination
Figure 4.16.6-1: SM Policy Association Termination
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the V-PCF is not involved. In the local breakout
roaming case, the H-PCF is not involved. In the home routed roaming case, the
V-PCF is not involved and the H-PCF interacts only with the H-SMF.
The procedure for Session Management Policy Termination may be initiated by:
\- (Case A) the PCF.
\- (Case B) the SMF.
For local breakout roaming, the interaction with HPLMN (e.g. step 6) is not
used. In local breakout roaming, the V-PCF interacts with the UDR of the
VPLMN.
1\. (Case A) The PCF may invoke the Npcf_SMPolicyControl_UpdateNotify service
operation to request the release of a PDU Session. The SMF acknowledges the
request.
The rest of the procedure corresponds to both Case A &B.
2\. The SMF may invoke the Npcf_SMPolicyControl_Delete service operation to
request the deletion of the SM Policy Association with the PCF. The SMF
provides relevant information to the PCF.
3\. When receiving the request from step2, the PCF finds the PCC Rules that
require an AF to be notified and removes PCC Rules for the PDU Session.
If the SMF reported accumulated usage for the PDU session in step 1 the PCF
deducts the value from the remaining allowed usage for the subscriber, DNN and
S-NSSAI in the UDR by invoking Nudr_DM_Update (SUPI, DNN, S-NSSAI, Policy
Data, Remaining allowed Usage data, updated data) service operation.
If the SMF reported accumulated usage for a MK(s) in step 1 the PCF deducts
the value from the remaining allowed usage for the MK in the UDR by invoking
Nudr_DM_Update (SUPI, DNN, S-NSSAI, Policy Data, Remaining allowed Usage data,
updated data (including MK(s))) service operation.
NOTE: For local breakout roaming, PDU Session policy control subscription
information and Remaining allowed usage subscription information for
monitoring control as defined in clause 6.2.1.3 of TS 23.503 [20] are not
available in V-UDR and V-PCF uses locally configured information according to
the roaming agreement with the HPLMN operator.
4\. The SMF removes all policy information about the PDU Session associated
with the PDU Session.
5\. The PCF notifies the AF as explained in clause 7.3.1 steps 6-7 of TS
23.203 [24].
The PCF may invoke Nbsf_Management_Deregister service operation to delete the
binding created in BSF.
The PCF may report that a SM Policy Association is terminated as described in
clause 4.16.14.2.
In the non-roaming case, the PCF may unsubscribe to analytics from NWDAF.
6\. The PCF may invoke the procedure defined in clause 4.16.8 to unsubscribe
to policy counter status reporting (If this is the last PDU Session for this
subscriber requiring policy counter status reporting) or to modify the
subscription to policy counter status reporting, (if any remaining existing
PDU Sessions for this subscriber requires policy counter status reporting).
7\. The PCF removes the information related to the terminated PDU Session and
acknowledges to the SMF that the PCF handling of the PDU Session has
terminated. This interaction is the response to the SMF request in step 2.
8\. The PCF may (e.g. if it is the last PDU Session on the (DNN, S-NSSAI)
couple) unsubscribe to the notification of the PDU Session related data
modification from the UDR by invoking Nudr_DM_Unsubscribe (Subscription
Correlation Id) if it had subscribed such notification.
### 4.16.7 Negotiations for future background data transfer
#### 4.16.7.1 General
The procedure for future background data transfer as specified in clause
4.16.7.2 enables the negotiation between the NEF and the H-PCF about the
transfer policies for the future background data transfer (as described in
clause 6.1.2.4 of TS 23.503 [20]). The transfer policies consist of a desired
time window for the background data transfer, a reference to a charging rate
for the time window, network area information and optionally a maximum
aggregated bitrate, as described in clause 6.1.2.4 of TS 23.503 [20].
This negotiation is preliminarily conducted (when AF initiates a procedure to
NEF) before the UE\'s PDU Session establishment. When the AF wants to apply
the Background Data Transfer Policy to an existing PDU Session, then at the
time the background data transfer is about to start the AF invokes the
Npcf_PolicyAuthorization_Create service directly with PCF, or via the NEF, to
apply the background data transfer policy for an individual UE. When the AF
wants to apply the Background Data Transfer Policy to a future PDU Session,
then the AF invokes Nnef_ApplyPolicy_Create service to provide, to the NEF,
the Background Data Transfer Reference ID together with the External
Identifier or External Group Identifier of the UE(s) that are subject to the
policy.
The procedure for BDT warning notification as specified in clause 4.16.7.3
enables the PCF to notify the AF that the network performance in the area of
interest goes below the criteria set by the operator as described in clause
6.1.2.4 of TS 23.503 [20].
#### 4.16.7.2 Procedures for future background data transfer
Figure 4.16.7.2-1: Negotiation for future background data transfer
1\. The AF invokes the Nnef_BDTPNegotiation_Create (ASP Identifier, Number of
UEs, Volume per UE, Desired time window and optionally External Group
Identifier, Network Area Information, Request for notification, MAC address or
IP 3-tuple of Application server). The Request for notification is an
indication that BDT warning notification should be sent to the AF.
2a. Based on an AF request, the NEF requests to translate the External Group
Identifier into the Internal Group Identifier using Nudm_SDM_Get (Group
Identifier Translation, External Group Identifier).
2b. The NEF invokes the Npcf_BDTPolicyControl_Create (ASP Identifier, Number
of UEs, Volume per UE, Desired time window and optionally Internal Group
Identifier, the Network Area Information, Request for notification, MAC
address or IP 3-tuple of Application server) with the H-PCF to authorize the
creation of the policy regarding the background data transfer. If the PCF was
provided with Request for notification, then PCF may send BDT warning
notification to the AF as described in clause 4.16.7.3.
3 The H-PCF may request from the UDR the stored Background Data Transfer
policies for all the ASPs using Nudr_DM_Query (Policy Data, Background Data
Transfer) service operation.
NOTE 1: If only one PCF is deployed in the PLMN, the Background Data Transfer
policy can be locally stored and no interaction with UDR is required.
4\. The UDR provides all the stored Background Data Transfer policies and
corresponding related information (i.e. volume of data to be transferred per
UE, the expected amount of UEs) to the H-PCF.
5\. The H-PCF determines, based on information provided by the AF and other
available information one or more Background Data Transfer policies. The PCF
may interact with the NWDAF and request the Network Performance analytics
information for the Desired time window and the Network Area Information as
defined in TS 23.288 [50].
NOTE 2: When the External Group Identifier was provided and the Network Area
Information was not provided by the AF at step 1, the NWDAF derives the
Network Area Information from the Internal Group ID as defined in clause 6.6
of TS 23.288 [50].
NOTE 3: The maximum aggregated bitrate is not enforced in the network.
6\. The H-PCF send the acknowledge message to the NEF with the acceptable
Background Data T Transfer policies and a Background Data Transfer Reference
ID.
7\. The NEF sends a Nnef_BDTPNegotiation_Create response to the AF to provide
one or more background data transfer policies and the Background Data Transfer
Reference ID to the AF. The AF stores the Background Data Transfer Reference
ID for the future interaction with the PCF. If the NEF received only one
background data transfer policy from the PCF, steps 8-11 are not executed and
the flow proceeds to step 12. Otherwise, the flow proceeds to step 8.
NOTE 4: If the NEF receives only one Background Data T Transfer policy, the AF
is not required to confirm.
8\. The AF invokes the Nnef_BDTPNegotiation_Update service to provide the NEF
with Background Data Transfer Reference ID and the selected background data
transfer policy.
9\. The NEF invokes the Npcf_BDTPolicyControl_Update service to provide the
H-PCF with the selected background data transfer policy and the associated
Background Data Transfer Reference ID.
10\. The H-PCF sends the acknowledge message to the NEF.
11\. The NEF sends the acknowledge message to the AF.
12\. The H-PCF stores the Background Data Transfer Reference ID together with
the new Background Data T Transfer policy, the corresponding related
information (i.e. volume of data to be transferred per UE, the expected amount
of UEs), optionally MAC address or IP 3-tuple of Application server the
information of request for notification, together with the relevant
information received from the AF (as defined in clause 6.1.2.4 of TS 23.503
[20]) in the UDR by invoking Nudr_DM_Update (BDT Reference id, Policy Data,
Background Data Transfer). This step is not executed, when the PCF decides to
locally store the Background Data Transfer policy.
13\. The UDR sends a response to the H-PCF as its acknowledgement.
#### 4.16.7.3 Procedure for BDT warning notification
Figure 4.16.7.3-1: The procedure for BDT warning notification
1\. The negotiation for Background Data Transfer (BDT) described in clause
4.16.7.2 is completed. In addition, the PCF has subscribed to analytics on
\"Network Performance\" from NWDAF for the area of interest and time window of
a background data transfer policy following the procedure and services
described in TS 23.288 [50], including a Reporting Threshold in the Analytics
Reporting information. The value for Reporting Threshold is set by the PCF
based on operator configuration.
2\. The PCF is notified with the network performance analytics in the area of
interest from the NWDAF when the NWDAF determines that the network performance
goes below the threshold as described for the Network Performance analytics in
TS 23.288 [50].
3\. The H-PCF may request from the UDR the stored BDT policies using
Nudr_DM_Query (Policy Data, Background Data Transfer) service operation.
4\. The UDR provides all the Background Transfer Policies together with the
relevant information received from the AF (as defined in clause 6.1.2.4 of TS
23.503 [20]) to the H-PCF.
5\. The H-PCF identifies the BDT policies affected by the notification
received from NWDAF. For each of them, the H-PCF determines the ASP of which
the background traffic will be influenced by the degradation of network
performance and which requested the H-PCF to send the notification. The PCF
then performs the following steps for each of the determined ASPs, i.e. Steps
6 - 16 can occur multiple times (i.e. once per ASP).
6\. The PCF decides based on operator policies, whether a new list of
candidate Background Data Transfer policies can be calculated for the ASP. If
the PCF does not find any new candidate BDT policy, the previously negotiated
BDT policy shall be kept, no interaction with that ASP shall occur and the
procedure stops for that BDT policy.
NOTE 1: The BDT policies of an ASP which did not request to be notified are
kept and no interaction with this ASP occurs.
7\. The PCF sets the no longer valid BDT policy in the UDR as invalidated by
invoking Nudr_DM_Update (Background Data Transfer Reference ID, invalidation
flag) service.
NOTE 2: The BDT policies that are applicable for future sessions are checked
by the PCF in step 6.
8\. The UDR sends a response to the H-PCF as acknowledgement.
9\. The PCF sends the notification to the NEF by invoking
Npcf_PolicyControl_Notify (Background Data Transfer Reference ID, list of
candidate Background Data Transfer policies) service operation.
10\. The NEF sends the BDT warning notification to the AF by invoking
Nnef_BDTPNegotiation_Notify (Background Data Transfer Reference ID, list of
candidate Background Data Transfer policies) service operation.
11\. The AF checks the new Background Data Transfer policies included in the
candidate list in the BDT warning notification.
12\. If the AF selects any of the new Background Data Transfer policies, the
steps 8-13 from clause 4.16.7.2 are executed.
13\. If the AF doesn\'t select any of the new Background Data Transfer
policies, the steps 8-11 from clause 4.16.7.2 are executed, with the AF
indicating that none of the candidate Background Data Transfer policies is
acceptable.
14.-15. If the step 13 is executed, the PCF removes the no longer valid BDT
policy from UDR for the corresponding Background Data Transfer Reference ID.
NOTE 3: The PCF can also remove the no longer valid BDT policy after an
operator configurable time for the case that the AF does not respond.
16\. If there is a new Background Data Transfer policy stored in the UDR or a
BDT policy removed from the UDR, the PCFs are notified by the UDR accordingly.
The PCFs check if the corresponding URSP rules need to be updated or removed
and if so, use the procedure defined in clause 4.16.12.2 to update URSP rules
for the relevant UEs.
The AF can send a Stop notification by invoking Nnef_BDTPNegotiation_Update
service, when the AF requests not to receive the BDT warning notification
anymore. Then, the NEF invokes Npcf_BDTPolicyControl_Update service in order
to provide this information for the H-PCF.
### 4.16.8 Procedures on interaction between PCF and CHF
#### 4.16.8.1 General
The PCF may interact with the CHF to make session management policy decisions,
UE policy decisions and Access and Mobility related policy decisions based on
spending limits. For session management policy decisions, in the Home Routed
roaming and Non-roaming case, the H-PCF will interact with the CHF in HPLMN.
For Access and Mobility related policy decisions and UE policy decisions, the
non-roaming case is supported when the PCF interaction with the CHF, both in
the HPLMN.
#### 4.16.8.2 Initial Spending Limit Retrieval
This clause describes the signalling flow for the PCF to retrieve the status
of the policy counters available at the CHF and to subscribe to spending limit
reporting (i.e. to notifications of policy counter status changes) by the CHF.
If the PCF provides the list of policy counter identifier(s), the CHF returns
the policy counter status per policy counter identifier provided by the PCF.
If the PCF does not provide the list of policy counter identifier(s), the CHF
returns the policy counter status of all policy counter(s), which are
available for this subscriber.
The Initial Spending Limit Report Retrieval includes all subscriber
Identifiers associated with the UE available at the PCF.
NOTE: If the CHF returns the status of all available policy counters some of
these might not be relevant for a policy decision (e.g. those used in a policy
decision only when roaming).
Figure 4.16.8.2.1: Initial Spending Limit Report Retrieval
1\. The PCF retrieves subscription information that indicates that policy
decisions depend on the status of policy counter(s) held at the CHF and
optionally the list of policy counter identifier(s).
2\. The PCF sends Nchf_SpendingLimitControl_Subscribe if this is the first
time policy counter status information is requested for the user identified by
a SUPI. It includes: the subscriber ID (e.g. SUPI), the EventId \"policy
counter status change\" and optionally, the list of policy counter
identifier(s) as Event Filter, the Notification Target Address, Event
Reporting Information (continuous reporting).
The CHF responds to the Nchf_SpendingLimitControl_Subscribe service operation
including the Subscription Correlation Id) and as Event Information provides a
policy counter status and optionally pending policy counter statuses and their
activation times, per required policy counter identifier and stores the PCF\'s
subscription to spending limit reports for these policy counters. If no policy
counter identifier(s) was provided the CHF returns the list of the policy
counter status, optionally including pending policy counter statuses and their
activation times, for all policy counter(s), which are available for this
subscriber and stores the PCF\'s subscription to spending limit reports of all
policy counters provided to the PCF.
#### 4.16.8.3 Intermediate Spending Limit Report Retrieval
This clause describes the signalling flow for the PCF to retrieve the status
of additional policy counters available at the CHF or to unsubscribe from
spending limit reporting. If the PCF provides the list of policy counter
identifier(s), the CHF returns the policy counter status per policy counter
identifier provided by the PCF.
NOTE: If the CHF returns the status of all available policy counters some of
these might not be relevant for a policy decision, (e.g. those used in a
policy decision only when roaming).
Figure 4.16.8.3.1: Intermediate Spending Limit Report Retrieval
1\. The PCF determines that policy decisions depend on the status of
additional policy counter(s) held at the CHF or that notifications of policy
counter status changes for some policy counters are no longer required.
2\. The PCF sends Nchf_SpendingLimitControl_Subscribe to the CHF, including
the Subscription Correlation Id, the EventId \"policy counter status change\"
and an updated list of policy counter identifier(s) as EventFilters, that
overrides the previously stored list of policy counter identifier(s).
The CHF responds to the Nchf_SpendingLimitControl_Subscribe service operation
and provides as Event Information the policy counter status and optionally
pending policy counter statuses and their activation times, per required
policy counter identifier and stores or removes the PCF\'s subscription to
spending limit reporting by comparing the updated list with the existing PCF
subscriptions. If no policy counter identifier(s) was provided, the CHF
returns the policy counter status, optionally including pending policy counter
statuses and their activation times, for all policy counter(s), which are
available for this subscriber and stores the PCF\'s subscription to spending
limit reports of all policy counters provided to the PCF.
#### 4.16.8.4 Final Spending Limit Report Retrieval
This clause describes the signalling flow for the PCF to cancel the
subscriptions to status changes for the policy counters available at the CHF.
Figure 4.16.8.4.1: Final Spending Limit Report Retrieval
1\. The PCF decides that notifications of policy counter status changes are no
longer needed.
2\. The PCF sends Nchf_SpendingLimitControl_Unsubscribe including the
SubscriptionCorrelationId to the CHF to cancel the subscription to
notifications of policy counter status changes from the CHF.
3\. The CHF removes the PCF\'s subscription to spending limit reporting and
responds to the Nchf_SpendingLimitControl_Unsubscribe service operation to the
PCF.
#### 4.16.8.5 Spending Limit Report
This clause describes the signalling flow for the CHF to notify the change of
the status of the subscribed policy counters available at the CHF for that
subscriber. Alternatively, the signalling flow can be used by the CHF to
provide one or more pending statuses for a subscribed policy counter together
with the time they have to be applied.
Figure 4.16.8.5.1: Spending Limit Report
1\. The CHF detects that the status of a policy counter(s) has changed and the
PCF subscribed to notifications of changes in the status of this policy
counter. Alternatively, the CHF may detect that a policy counter status will
change at a future point in time and decides to instruct the PCF to apply one
or more pending statuses for a requested policy counter.
2\. The CHF sends Nchf_SpendingLimitControl_Notify with the SUPI, Notification
Target Address and in the Event Information the policy counter status and
optionally pending policy counter statuses and their activation times, for
each policy counter that has changed and for which the PCF subscribed to
spending limit reporting. Alternatively, the CHF sends one or more pending
statuses for any of the subscribed policy counters together with the time they
have to be applied.
3\. The PCF acknowledges sending Nchf_SpendingLimitControl_Notify response and
takes that information into account as input for a policy decision.
#### 4.16.8.6 CHF report the removal of the subscriber
This clause describes the signalling flow for the CHF to report the removal of
the subscriber.
Figure 4.16.8.6-1: CHF report the removal of the subscriber
1\. The CHF decides that a subscriber is removed.
2\. The CHF sends the Nchf_SpendingLimitControl_Notify Request to H-PCF to
notify the removal of the subscriber. The H-PCF removes the subscription to
notification of policy counter status from CHF.
NOTE: Notification on the removing of a subscriber causes the H-PCF to make
the applicable policy decision and act accordingly.
3\. The H-PCF responds to CHF using Nchf_SpendingLimitControl_Notify to
acknowledge the receiving of the notification.
### 4.16.9 Update of the subscription information in the PCF
Figure-4.16.9-1: Procedure for update of the subscription information in the
PCF
NOTE: The V-PCF is not used for session management related policy decisions in
this procedure.
0\. The PCF performs the subscription to notification to the profile modified
in the UDR by invoking Nudr_DM_Subscribe (Policy Data, SUPI, Notification
Target Address (+ Notification Correlation Id), Event Reporting Information
(continuous reporting), one or several of the following: \"PDU Session Policy
Control data\", \"Remaining allowed Usage data\" or \"UE context Policy
Control data\") service.
1\. The UDR detects that the related subscription profile has been changed.
2\. If subscribed by the PCF, the UDR notifies the PCF on the changed profile
by invoking Nudr_DM_Notify (Notification Correlation Id, Policy Data, SUPI,
updated data and one or several of the following data subtypes \"PDU Session
Policy Control Data\" or \"Remaining allowed Usage data\" or \"UE Context
Policy Control data\") service.
3\. The PCF stores the updated profile.
4\. If the updated subscriber profile requires the status of new policy
counters available at the CHF then an Initial/Intermediate Spending Limit
Report Retrieval is initiated by the PCF as defined in clauses 4.16.8,2 and
4.16.8.3. If the updated subscriber profile implies that no policy counter
status is needed an Intermediate Spending Limit Report Request Retrieval is
initiated by the PCF to unsubscribe or, if this is the last policy counter
status, a Final Spending Limit Report Retrieval is initiated by the PCF as
specified in clause 4.16.8.4.
5\. PCF makes an authorization and policy decision.
6\. The PCF provides new session management related policy decisions to the
SMF, using the Policy related interaction in PDU Session Modification
procedure in clause 4.16.6, new access and mobility related policy information
to the AMF using the AM Policy Association Modification procedure in clause
4.16.2 or new UE policy information to the AMF using the UE Policy Association
Modification procedure in clause 4.16.12.
### 4.16.10 Void
### 4.16.11 UE Policy Association Establishment
#### 4.16.11.1 General
The UE Policy Association Establishment procedure, which may be performed for
a UE registered in the same AMF or different AMFs for 3GPP access and non-3GPP
access, concerns the following scenarios:
1\. UE initial registration with the network.
2\. The AMF relocation with PCF change in handover procedure and registration
procedure.
3\. UE registration with 5GS when the UE moves from EPS to 5GS and there is no
existing UE Policy Association between AMF and PCF for this UE.
In Non-roaming case, the H-PCF may interact with the CHF in HPLMN to make a
decision about UE Policies based on spending limits.
Figure 4.16.11-1: UE Policy Association Establishment
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the V-PCF is not involved and the role of the H-PCF is
performed by the PCF. For the roaming scenarios, the V-PCF interacts with the
AMF and the H-PCF interacts with the V-PCF:
1\. The AMF establishes UE Policy Association with the (V-)PCF when a UE
Policy Container is received from the UE. If a UE Policy Container is not
received from the UE, the AMF may establish UE Policy Association with the
(V-)PCF based on AMF local configuration.
NOTE 1: In roaming scenario, the AMF local configuration can indicate whether
UE Policy delivery is needed based on the roaming agreement with home PLMN of
the UE.
2\. The AMF sends a Npcf_UEPolicyControl Create Request with the following
information: SUPI, may include Access Type and RAT, PEI, ULI, UE time zone,
Serving Network (PLMN ID, or PLMN ID and NID, see clause 5.34 of TS 23.501
[2]), the Internal-Group-ID-list and UE Policy Container (the list of stored
PSIs, operating system identifier, Indication of UE support for ANDSP,
indication of UE capability of reporting URSP rule enforcement to network). In
roaming scenario, based on operator policies, the AMF may provide to the V-PCF
the PCF ID of the selected H-PCF. The V-PCF contacts the H-PCF. In roaming
case, steps 3 and 4 are executed, otherwise step 5 follows.
If the AMF, based on configuration, is aware that the UE is accessing over a
gNB using satellite backhaul, the AMF includes the Satellite Backhaul Category
as described in clause 5.43 of TS 23.501 [2].
3\. The V-PCF forwards the information received from AMF in step 2 to the
H-PCF. When a UE Policy Container is received at initial registration, the
H-PCF may store the PEI, the OSId, indication of UE capability of reporting
URSP rule enforcement to network or the indication of UE support for ANDSP in
the UDR using Nudr_DM_Create including DataSet \"Policy Data\" and Data Subset
\"UE context policy control data\".
The V-PCF may retrieve the Application guidance on URSP Rule for inbound
roamers of the PLMN of the SUPI, if not available, using Nudr_DM_Query or
Nudr_DM_Subscribe including the Data Set \"Application Data\" and Data Subset
\"Service Specific Information\" and DataKey set to \"PLMN ID(s) of inbound
roamers\".
The V-PCF may retrieve the Application guidance on URSP Rule for inbound
roamers of the PLMN of the SUPI, if not available, using Nudr_DM_Query or
Nudr_DM_Subscribe including the Data Set \"Application.
4\. The H-PCF sends a Npcf_UEPolicyControl Create Response to the V-PCF. The
H-PCF may provide the Policy Control Request Trigger parameters in the
Npcf_UEPolicyControl Create Response. Before sending the response, the H-PCF
may determine that the decision about UE policy control depends on the status
of the policy counters available at the CHF and if such reporting is not
established for the subscriber, the H-PCF initiates an Initial Spending Limit
Report Retrieval as defined in clause 4.16.8.2. If policy counter status
reporting is already established for the subscriber and the H-PCF determines
that the status of additional policy counters are required, the H-PCF
initiates an Intermediate Spending Limit Report Retrieval as defined in clause
4.16.8.3.
The (H-)PCF in roaming and the PCF in non-roaming may register to the BSF as
the PCF serving this UE, if not already registered at the AM Policy
Association establishment. This is performed by using the
Nbsf_Management_Register operation, providing as inputs the UE SUPI/GPSI and
the PCF identity.
5\. The (V-) PCF sends a Npcf_UEPolicyControl Create Response to the AMF. The
(V-)PCF relays the Policy Control Request Trigger parameters in the
Npcf_UEPolicyControl Create Response.
The (V-)PCF also subscribes to notification of N1 message delivery of policy
information to the UE using Namf_Communication_N1N2MessageSubscribe service
which is not shown in this figure.
6\. The (H-)PCF gets policy subscription related information and the latest
list of PSIs from the UDR using Nudr_DM_Query service operation (SUPI, Policy
Data, UE context policy control data, Policy Set Entry) if either or both are
not available and makes a policy decision. The (H-)PCF may get the PEI, the
OSId, indication of UE capability of reporting URSP rule enforcement to
network or the indication of UE support for ANDSP in the UDR using
Nudr_DM_Query including DataSet \"Policy Data\" and Data Subset \"UE context
policy control data\" if the AMF relocates and the PCF changes. In the roaming
scenario, the H-PCF may provide the indication of UE support for ANDSP to the
V-PCF, if the indication was not present in the Npcf_UEPolicyControl Create
request from V-PCF and the H-PCF gets this information from the H-UDR. The
(H-)PCF may get the 5G VN group data and 5G VN group membership for each
Internal-Group-ID received from the AMF using Nudr_DM_Query (Internal-Group-
Id, Subscription Data, 5G VN Group Configuration). The (H-)PCF may store the
5G VN group data and 5G VN group membership for later use for other SUPIs that
belong to the same Internal-Group-ID. The (H-)PCF may request notifications
from the UDR on changes in the subscription information by invoking
Nudr_DM_Subscribe (Policy Data, SUPI, DNN, S-NSSAI, Notification Target
Address (+ Notification Correlation Id), Event Reporting Information
(continuous reporting), UE context policy control data) service. The (H-)PCF
may request notifications from the UDR on changes in the 5G VN group data or
5G VN group membership associated to each of the Internal-Group-Id provided to
the PCF by invoking Nudr_DM_Subscribe (Subscription Data, 5G VN Group
Configuration, Internal Group ID, Notification Target Address (+ Notification
Correlation Id), Event Reporting Information (continuous reporting)) service.
The (H-)PCF creates the UE policy container including UE policy information as
defined in clause 6.6 of TS 23.503 [20] and in the case of roaming H-PCF
provides the UE policy container in the Npcf_UEPolicyControl UpdateNotify
Request. In the non-roaming case, the PCF may subscribe to Analytics from
NWDAF as defined in clause 6.1.1.3 of TS 23.503 [20].
7\. The V-PCF sends a response to H-PCF using Npcf_UEPolicyControl
UpdateNotify Response.
NOTE 2: Step 6 (and step 7) can be omitted. Then the (H-)PCF creates the UE
policy container including UE polices in step 2 (in the case of non-roaming)
or step 3 (in the case of roaming). This means that the potential interactions
with UDR as in step 6 will have to be executed in step 2 (non-roaming) or step
3 (roaming).
8\. The (V-)PCF triggers UE Configuration Update Procedure in clause 4.2.4.3
to sends the UE policy container including UE policy information to the UE.
The (V-)PCF checks the size limit as described in clause 6.1.2.2.2 of TS
23.503 [20].
9\. If the V-PCF received notification of the reception of the UE Policy
container then the V-PCF forwards the notification response of the UE to the
H-PCF using Npcf_UEPolicyControl_Update Request.
If the V-PCF is notified by the V-UDR about the Service Specific Information
applicable to inbound roamers from the HPLMN of the UE as specified in clause
4.15.6.10, the V-PCF provides the Service Parameters to the H-PCF.
10\. The H-PCF sends a response to the V-PCF. If the V-PCF received a UE
Policy Container step 8 will follow.
### 4.16.12 UE Policy Association Modification
#### 4.16.12.1 UE Policy Association Modification initiated by the AMF
##### 4.16.12.1.1 UE Policy Association Modification initiated by the AMF
without AMF relocation
This procedure addresses the scenario where a Policy Control Request Trigger
condition is met.
Figure 4.16.12.1.1-1: UE Policy Association Modification initiated by the AMF
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the V-PCF is not involved. In the roaming case, the
AMF interacts with the V-PCF and the H-PCF interacts with the V-PCF.
1\. When a Policy Control Request Trigger condition is met the AMF updates UE
Policy Control Association and provides information on the conditions that
have changed to the PCF. The AMF sends a Npcf_UEPolicyControl Update Request
with the following information: UE Policy Association ID associated with the
SUPI defined in TS 29.525 [58] and the Policy Control Request Trigger met. In
roaming scenario, based on operator policies, the AMF may provide to the V-PCF
the PCF ID of the selected H-PCF. The V-PCF contacts the H-PCF.
See clause 6.1.2.5 of TS 23.503 [20] and clause 4.2.3.2 of TS 29.525 [58] for
more details on Policy Control Request Trigger.
In the roaming case, steps 2 and 3 are executed, otherwise step 4 follows.
2\. The V-PCF forwards the information received from AMF in step 1 to the
(H-)PCF.
3\. The H-PCF replies to the V-PCF. In the non-roaming case, the PCF may
subscribe to Analytics from NWDAF as defined in clause 6.1.1.3 of TS 23.503
[20].
4\. The (V-) PCF sends a Npcf_UEPolicyControl Update Response to the AMF.
5\. The (H-)PCF may create the UE policy container including UE policy
information as defined in clause 6.6 of TS 23.503 [20]. In the case of roaming
the H-PCF may include the UE policy container in the Npcf_UEPolicyControl
UpdateNotify Request.
6\. The (V-)PCF sends a response to H-PCF using Npcf_UEPolicyControl
UpdateNotify Response.
Steps 7, 8 and 9 are the same as steps 8, 9 and 10 of procedure UE Policy
Association Establishment in clause 4.16.11.
##### 4.16.12.1.2 UE Policy Association Modification with old PCF during AMF
relocation
This procedure addresses the scenario where a UE Policy Association
Modification with the old PCF during AMF relocation.
Figure 4.16.12.1.2-1: Policy Association Modification with the old PCF during
AMF relocation
This procedure addresses both roaming and non-roaming scenarios.
In the non-roaming case the V-PCF is not involved. In the roaming case, the
AMF interacts with the V-PCF and the V-PCF interacts with the H-PCF.
1\. [Conditional] When the old AMF and the new AMF belong to the same PLMN,
the old AMF transfers to the new AMF the UE Policy Association information
including policy control request trigger(s) and the PCF ID(s). For the roaming
case, the new AMF receives both V-PCF ID and H-PCF ID.
2\. Based on local policies, the new AMF decides to re-use the UE policy
association for the UE Context with the (V-)PCF and contacts the (V)-PCF
identified by the PCF ID received in step 1.
NOTE: The scenario that only the H-PCF is reused by the new AMF but the V-PCF
is not reused is not considered in this Release.
3\. The new AMF sends Npcf_UEPolicyControl_Update to the (V-)PCF to update the
UE policy association with the (V-)PCF. If a Policy Control Request Trigger
condition is met, the information matching the trigger condition may also be
provided by the new AMF.
In the roaming case, step 4 and 5 are executed, otherwise step 6 follows.
4\. The V-PCF forwards the information received from new AMF in step 3 to the
(H-)PCF.
5\. The H-PCF replies to the V-PCF. In non-roaming case, the PCF may subscribe
to Analytics from NWDAF as defined in clause 6.1.1.3 of TS 23.503 [20].
6\. The (V-)PCF updates the stored information provided by the old AMF with
the information provided by the new AMF. The (V-)PCF sends a
Npcf_UEPolicyControl Update Response to the AMF.
7\. The (H-)PCF may create the UE policy container including UE policy
information as defined in clause 6.6 of TS 23.503 [20]. In the case of roaming
the H-PCF may include the UE policy container in the Npcf_UEPolicyControl
UpdateNotify Request.
8\. The V-PCF sends a response to H-PCF using Npcf_UEPolicyControl
UpdateNotify Response.
Steps 9, 10 and 11 are the same as steps 8, 9 and 10 of procedure UE Policy
Association Establishment in clause 4.16.11.
#### 4.16.12.2 UE Policy Association Modification initiated by the PCF
This procedure is used to update UE policy and/or UE policy triggers.
In the non-roaming case, the H-PCF may interact with the CHF in HPLMN to make
a decision about UE Policies based on spending limits.
Figure 4.16.12.2-1: UE Policy Association Modification initiated by the PCF
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case the V-PCF is not involved and the role of the H-PCF is
performed by the PCF. In the roaming case, the H-PCF provides UE policy
decision and provides the policy to the AMF via V-PCF.
1a and 1b. If (H-)PCF subscribed to notification of subscriberÂ´s policy data
change or 5G VN Group Configuration (5G VN group data, 5G VN group membership)
change and a change is detected, the UDR notifies that the subscriberÂ´s policy
data of a UE or 5G VN Group Configuration (5G VN group data, 5G VN group
membership) has been changed.
The UDR notifies the (H-)PCF of the updated policy control subscription
information profile via Nudr_DM_Notify (Notification correlation Id, Policy
Data, either UE context policy control data or Policy Set Entry data or both,
SUPI), or
The UDR notifies the (H-)PCF of the updated 5G VN Group Configuration (5G VN
group data, 5G VN group membership) via Nudr_DM_Notify (Notification
correlation Id, 5G VN Group Configuration, Internal-Group-Identifier), or
The (V-)UDR notifies the (V-)PCF of the updated policy control subscription
information profile via Nudr_DM_Notify (Notification correlation Id, Policy
Data, PolicySetEntry Data. PLMN ID).
The (V-)UDR notifies the (V-)PCF of the updated Service Parameters via
Nudr_DM_Notify.
1c and 1d. PCF determines locally that UE policy information needs to be sent
to the UE.
1e The CHF notifies the (H-)PCF about the change of the status of the
subscribed policy counters available at the CHF for that subscriber.
2a and 2b. The PCF makes the policy decision. If the group data is updated,
the (H-) PCF checks the UE Policy Associations for those SUPIs within the
Internal-Group-Id and may need to perform step 3 to step 9 for each UE Policy
Association that needs to be updated with new UE Policies sent to each UE. In
the non-roaming case, the PCF may subscribe to Analytics from NWDAF as defined
in clause 6.1.1.3 of TS 23.503 [20].
2c and 2d. In the roaming case, the V-PCF may provide the updated Service
Parameters received from the V-UDR as specified in clause 4.15.6.10 to the
H-PCF using the Npcf_UEPolicyControl_Update Request. The H-PCF sends a
response to the V-PCF.
3\. The (H-)PCF may create the UE policy container including UE policy
information as defined in clause 6.1.2.2.2 of TS 23.503 [20]. In the case of
roaming, the H-PCF may send the UE policy container in the
Npcf_UEPolicyControl UpdateNotify Request. The H-PCF may provide updated
policy control triggers for the UE policy association. If there is the
received Service Parameters from the V-PCF in step 2, the H-PCF may take the
Service Parameters obtained from V-PCF to generate URSP rules applicable in
the VPLMN as specified in clause 4.15.6.10.
4\. The V-PCF sends a response to H-PCF using Npcf_UEPolicyControl
UpdateNotify Response.
5\. The (V-)PCF provides the Policy Control Request Trigger parameters in the
Npcf_UEPolicyControl UpdateNotify Request to the AMF. In the case of roaming,
the V-PCF may also provide UE policy information to the UE. The V-PCF may also
provide updated policy control triggers for the UE policy association to the
AMF.
6\. The AMF sends a response to (V-)PCF.
Steps 7, 8 and 9 are the same as steps 8, 9 and 10 of procedure UE Policy
Association Establishment in clause 4.16.11.
### 4.16.13 UE Policy Association Termination
#### 4.16.13.1 AMF-initiated UE Policy Association Termination
The following case is considered for UE Policy Association Termination:
1\. UE Deregistration from the network when the UE is not registered in
another access type.
2\. The mobility with change of AMF (e.g. new AMF is in different PLMN or new
AMF in the same PLMN).
3\. [Optional] 5GS to EPS mobility with N26 if the UE is not connected to the
5GC over a non-3GPP access in the same PLMN.
In the non-roaming case, the H-PCF may interact with the CHF in HPLMN.
Figure 4.16.13.1-1: AMF-initiated UE Policy Association Termination
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case, the V-PCF is not involved and the role of the H-PCF
is performed by the PCF. For the roaming scenarios, the V PCF interacts with
the AMF. The V PCF contacts the H-PCF to request removing UE Policy
Association.
1\. The AMF decides to terminate the UE Policy Association.
2\. The AMF sends the Npcf_UEPolicyControl_Delete service operation including
UE Policy Association ID to the (V-)PCF.
3\. The (V-)PCF removes the policy context for the UE and replies to the AMF
with an Acknowledgement including success or failure. The V-PCF may interact
with the H-PCF. The (V-)PCF may unsubscribe to subscriber policy data changes
with UDR by Nudr_DM_Unsubscribe (Subscription Correlation Id). The AMF removes
the UE Policy Context.
If the PCF has previously registered to the BSF as the PCF that is serving
this UE, the PCF shall deregister from the BSF if no AM Policy Association for
this UE exists anymore. This is performed by using the
Nbsf_Management_Deregister service operation, providing the Binding Identifier
that was obtained earlier from the BSF when performing the
Nbsf_Management_Register service operation.
Step 4 and Step 5 apply only to the roaming case.
4\. The V-PCF sends the Npcf_UEPolicyControl_Delete service operation
including UE Policy Association ID to the H-PCF.
5\. The H-PCF removes the policy context for the UE and replies to the V-PCF
with an Acknowledgement including success or failure. The H-PCF may
unsubscribe to subscriber policy data changes with UDR by Nudr_DM_Unsubscribe
(Subscription Correlation Id) for subscriber policy changes. In the non-
roaming case, the PCF may unsubscribe to analytics from NWDAF.
The H-PCF may invoke the procedure defined in clause 4.16.8 to unsubscribe to
policy counter status reporting or to modify the subscription to policy
counter status reporting (if remaining Policy association for this subscriber
requires policy counter status reporting).
#### 4.16.13.2 PCF-initiated UE Policy Association Termination
Figure 4.16.13.2-1: PCF-initiated UE Policy Association Termination
This procedure concerns both roaming and non-roaming scenarios.
In the non-roaming case, the V-PCF is not involved and the role of the H-PCF
is performed by the PCF. For the roaming scenarios, the H-PCF interacts with
the V-PCF to request removing Policy Association.
The PCF is subscribed to notification of changes in Data Set \"Policy Data\"
for a UE Policy Association ID.
1\. The Policy data is removed, either the Data Set \"Policy Data\" or the
Data Subset \"UE context policy control\".
2\. The UDR sends the Nudr_DM_Notify_Request (Notification correlation Id,
Policy Data, SUPI, UE Context Policy Control data, updated data) including the
SUPI, the Data Set Identifier, the Data Subset Identifier and the Updated Data
including empty \"Policy Data\" or empty \"UE context policy control\".
3\. The PCF sends the Nudr_DM_Notify_Response to confirm reception and the
result to UDR.
4\. The PCF may notify the AMF of the removal of the UE Policy Association via
Npcf_UEPolicyControl_UpdateNotify service operation. Alternatively, the PCF
may decide to maintain the Policy Association if a default profile is applied,
in this case steps 4, 5 and 6 are not executed.
In the non-roaming case, the PCF unsubscribes to analytics from NWDAF if any.
5\. The AMF acknowledges the operation.
6\. Steps 2-5 in clause 4.16.13.1 AMF-initiated UE Policy Association
Termination are performed to remove the UE Policy Association for this UE and
the subscription to Policy Control Request Triggers for that UE Policy
Association.
### 4.16.14 Management of access and mobility related policy information
depending on the application in use
#### 4.16.14.1 General
The procedure for management of access and mobility related policy information
depending on the application in use enables modification of the access and
mobility related policy information on detection of the start and stop of an
application.
The content of this clause applies to non-roaming and LBO roaming scenario
(for any inbound roaming UEs), i.e. to cases where the involved entities (e.g.
PCF, SMF and UPF) belong to the serving PLMN. The PCF shall not apply a change
of access and mobility related policy information for application traffic
detected in PDU Sessions established in Home Routed mode.
If PCF for the UE and PCF for the PDU Session are the same PCF, then steps 3,
5, 6, 9 and 12 in Figure 4.16.14.2-1 are not performed.
If the PCF for the UE and the PCF for the PDU Session are different PCFs, then
the PCF for the UE is informed when a SM Policy Association is established or
released by either:
\- Subscription to the BSF:
= see steps 2, 3, 4, 5a, 11 and 12a in Figure 4.16.14.2.1-1. The BSF notifies
when a PCF is registered or deregistered for the PDU Session to a DNN,
S-NSSAI.
\- see steps 2, 3, 5 and 8 in Figure 4.16.14.2.2-1. The BSF reports the
registration of a PCF for the PDU Session when the first SM Policy Association
is established and the deregistration of the PCF for the PDU Session when the
last SM Policy Association is terminated for a (DNN, S-NSSAI).
\- Request to the PCF for the PDU Session to a DNN, S-NSSAI via AMF and SMF.
See steps 1, 4, 5b, 11 and 12b in Figure 4.16.14.2-1. The PCF for the PDU
Session reports that the SM Policy Association is established as described in
clause 4.16.4 and provides the UE address(es). The SM Policy Association
Termination notifies the PCF for the UE as described in clause 4.16.6.
#### 4.16.14.2 Procedures for management of access and mobility related policy
information
##### 4.16.14.2.1 Management of access and mobility related policy information
at start and stop of application traffic
This procedure applies when the AF provides a service coverage area or the
indication of high throughput associated with the Application Identifer(s).
Figure 4.16.14.2.1-1: Management of access and mobility related policy
information at start and stop of application traffic
1\. The AMF establishes an AM Policy Association for retrieving access and
mobility related policy information, e.g. RFSP index value, as described in
clause 4.16.1.2.
2\. If the access and mobility related policy information depends on the
application in use, then depending on operator policies in the PCF, the PCF
may subscribe to the BSF, then step 3 follows, or provides its PCF binding
information to the AMF in step 1 with the indication to be notified about the
PCF for the PDU Session for a DNN, S-NSSAI, then step 4 follows.
3\. The PCF for the UE determines that access and mobility related policy
information (e.g. RFSP index value) depends on the detection of one or more
application(s) in use, the DNN, S-NSSAI used to access each Application Id is
configured in the PCF or retrieved from the UDR as part of the Application
Data Set, then subscribes to the BSF to be notified when a PCF for the PDU
Session for this SUPI is registered in the BSF, by invoking
Nbsf_Management_Subscribe (SUPI, list of (DNN, S-NSSAI)(s)). Steps 4 and 5 are
repeated for each PCF registered for a PDU Session to a (DNN, S-NSSAI)
included in the Nbsf_Management.
4\. The SMF establishes a SM Policy Association as described in clause 4.16.4.
The allocated UE address/prefix, SUPI, DNN, S-NSSAI and the PCF address is
registered in the BSF, as described in clause 6.1.1.2.2 of TS 23.503 [20].
5a. If the PCF for the UE subscribed to the BSF, then the BSF notifies that a
PCF for the PDU Session is registered in the BSF, by invoking
Nbsf_Management_Notify (DNN, S-NSSAI, UE address(es), PCF address, PCF
instance id, PCF Set ID, level of binding). When there are multiple PDU
Sessions to the same (DNN, S-NSSAI) the BSF provides multiple notification to
the PCF.
5b. If the PCF for the UE sent the request to notify that a PCF for the PDU
Session is available to the AMF in step 1, then the PCF for the PDU Sessions
sends Npcf_PolicyAuthorization_Notify (EventID set to SM Policy Association
established, UE address, PCF address, PCF instance is, PCF Set ID) to the PCF
indicated in the PCF binding information provided by the SMF.
6\. The PCF for the UE subscribes to notifications of event \"start/stop of
application traffic\" as defined in clause 6.1.3.18 of TS 23.503 [20], using
Npcf_PolicyAuthorization_Subscribe (UE address, EventId, EventFilter set to
\"list of Application Identifiers\") to the PCF for the PDU Session to the
DNN, S-NSSAI. The PCF for the PDU Session then generates PCC Rules including
the Application Identifier in the SDF template, if there are multiple
Application Identifiers included in the Npcf_PolicyAuthorization, the PCF
generates PCC Rules for each Application Identifier. The response includes the
NotificationCorrelationId.
7\. The PCF installs PCC Rules and the Policy Control Request Trigger to
detect \"start/stop of application traffic\" in the SMF.
8\. The SMF detects that the Policy Control Request Trigger is met, then
reports the start/stop of application traffic to the PCF serving the PDU
Session.
9\. The PCF for the UE is notified on the start/stop of application traffic by
Npcf_PolicyAuthorization_Notify (NotificationCorrelationId, EventId set to
\"start/stop of application traffic\", EventInformation including the
ApplicationId). When the reporting of start and stop of a list of
Application(s) was requested, the PCF for the PDU Session provides multiple
notification to the PCF for the UE.
10\. The PCF checks operator policies and then may change access and mobility
related policy information (e.g. RFSP index value) based on the reporting of
start/stop of application traffic.
11\. The SM Policy Association is terminated as described in clause 4.16.6.
The allocated UE address/prefix, SUPI, DNN, S-NSSAI and the PCF address are
deregistered in the BSF.
12a. If the PCF for the UE subscribed to the BSF, then the BSF notifies that
the PCF serving a PDU Session is deregistered in the BSF, by invoking
Nbsf_Management_Notify (Binding Identifier for the PDU Session).
12b. If the PCF for the UE sent the request to notify that a PCF for the PDU
Session is available to the AMF in step 1, then the PCF for the PDU Session
sends Npcf_PolicyAuthoritation_Notify ((EventID set to SM Policy Association
termination, Notification Correlation Id).
NOTE: The PCF for the UE may subscribe to the notifications of newly
registered PCF for the PDU Session and subscribe to the \"start/stop of
application traffic detection\" events for multiple applications with
different application identifiers. When PCF receives the notifications for
multiple applications, the PCF for the UE can determine which access and
mobility related policy information to apply based on local configuration and
operator policy.
##### 4.16.14.2.2 Management of access and mobility related policy information
at SM Policy Association establishment and termination with the notification
sent by the BSF
Figure 4.16.14.2.2-1: Management of access and mobility related policy
information at SM Policy Association establishment and termination with the
notification by the BSF
1\. The AMF establishes an AM Policy Association for retrieving access and
mobility related policy information, e.g. RFSP index value, as described in
clause 4.16.1.2.
2\. If the access and mobility related policy information depend on the SM
Policy Association establishment and termination for a DNN, S-NSSAI
combination, then depending on operator policies in the PCF, the PCF may
subscribe to BSF and then step 3 follows, or the PCF may provide its PCF
binding information to the AMF with the indication to be notified about the
PCF for the PDU Session for a DNN, S-NSSAI and then step 4 follows.
3\. The PCF for the UE determines that access and mobility related policy
information (e.g. RFSP index value) depend on the detection of SM Policy
Association establishment associated with the (DNN, S-NSSAI) combinations
configured in the PCF or retrieved from the UDR as part of the Application
Data Set. The PCF for the UE then subscribes to the BSF to be notified when a
PCF for the PDU Session is registered for the first SM Policy Association
establishment and the PCF for the PDU Session is deregistered for the last SM
Policy Association termination to the same (DNN, S-NSSAI) combination in the
BSF, by invoking Nbsf_Management_Subscribe (SUPI, list of (DNN, S-NSSAI)(s),
indication of registration/deregistration per (DNN, S-NSSAI)).
4\. The SMF establishes a SM Policy Association as described in clause 4.16.4.
The allocated UE address/prefix, SUPI, DNN, S-NSSAI and the PCF address are
registered in the BSF, as described in clause 6.1.1.2.2 of TS 23.503 [20].
5\. If the PCF for the UE subscribed to BSF, then the BSF notifies a PCF
registration when the first SM Policy Association corresponding to the (DNN,
S-NSSAI) combination is established, by invoking Nbsf_Management_Notify (DNN,
S-NSSAI, notification of registration).
6\. The PCF checks operator policies and then may change access and mobility
related policy information (e.g. RFSP index value) based on the reporting of
SM Policy Association establishment.
7\. The SM Policy Association is terminated as described in clause 4.16.6 and
the allocated UE address/prefix, SUPI, DNN, S-NSSAI and the PCF address are
deregistered in the BSF.
8\. If the PCF for the UE subscribed to BSF, then BSF notifies of a PCF
deregistration when the last SM Policy Association corresponding to the (DNN,
S-NSSAI) combination is terminated, by invoking Nbsf_Management_Notify (DNN,
S-NSSAI, notification of deregistration).
### 4.16.15 Negotiations for planned data transfer with QoS requirements
#### 4.16.15.1 General
The intent of this clause is to specify generic service procedures to enable
the AF to negotiate viable time window for the planned application data
transfer with specific QoS requirements and operational conditions via the
support of the NEF.
The PDTQ policies are defined for a specific ASP and each PDTQ policy includes
a recommended time window for the traffic transfer for each of the AF sessions
involved.
The Network Performance analytics or DN Performance analytics for NWDAF as
described in TS 23.288 [50] will be subscribed by the PCF in order to assist
its decision to derive the PDTQ policies.
One or more negotiated PDTQ policies could be provided by PCF to AF via NEF
together with the PDTQ Reference ID. If the AF receives more than one PDTQ
policies from the PCF, the AF will select one of them and inform the PCF about
the selected PDTQ policy which will then be stored in the UDR. The selected
PDTQ policy might be renegotiated, i.e. due to the degradation of the network
performance. In this case, the PCF may determine a new list of candidate PDTQ
policies and notify the AF via NEF. The AF may select one of the new PDTQ
polices or not accept any of the PDTQ policies, it then notifies the PCF of
the corresponding decision. Prior to the start of the Desired Time Window for
the planned data transfer, the AF requests the PCF to set up the AF session
with required QoS. The PCF will then determine the appropriate PCC rules
according to the AF request.
#### 4.16.15.2 Procedures
##### 4.16.15.2.1 Procedures for negotiation of planned data transfer with QoS
requirements
This clause describes the PDTQ procedures to negotiate viable time window for
the planned application data transfer via the support of the NEF.
Figure 4.16.15.2.1-1: Negotiation for planned data transfer with QoS
requirements
Prior to the transmission of the Application AI/ML data, the AF negotiates
with the 5G Core for the PDTQ policies to provide assistance for its
application data transfer. The AF discovers its serving NEF, if it has not
done so before, by using the mechanism described in clause 6.3.14 of TS 23.501
[2].
1a. The AF invokes the Nnef_PDTQPolicyNegotiation_Create Request (ASP
Identifier, Number of UEs, list of Desired time windows, QoS Reference or
individual QoS parameters, Alternative Service Requirements (optional),
Network Area Information, Request for notification, Application Identifier).
The Request for notification is an indication that PDTQ warning notification
can be sent to the AF.
NOTE 1: Based on AF\'s internal logic (policy), the AF may determine the
minimum QoS requirements based on the UEs who are expected to participate in
the Desired time window and the network input data and the group application
data transfer trigger conditions.
1b-1c. The NEF may authenticate the AF and authorize the PDTQ request from the
AF. If the authentication/authorization of the AF\'s request has failed, the
NEF will respond to the AF\'s request through the
Nnef_PDTQPolicyNegotiation_Create Response with a failure result and the
following steps are skipped.
The NEF may map the ASP ID into DNN and S-NSSAI to be used in step 2.
NOTE 2: The Application ID provided by the AF and the Application ID provided
to NWDAF can be different, and in such a case, a mapping is performed by the
PCF.
2\. Based on an AF request, the NEF may translate the information provided by
the AF (e.g. Network Area Information, etc.) based on the local policy and
invokes the Npcf_PDTQPolicyControl_Create (ASP Identifier, Number of UEs, list
of Desired time windows, QoS Reference or individual QoS parameters,
Alternative Service Requirements (optional), Network Area Information, Request
for notification, Application Identifier) with the H-PCF to authorize the
creation of the policy regarding the PDTQ. If the PCF was provided with
Request for notification, then PCF will send PDTQ warning notification to the
AF as specified in clause 4.16.15.2.2 to notify the AF when the network
performance or DN Performance in the area of interest reaches the Reporting
Threshold set by the PCF based on operator configuration as described in
clause 6.1.2.7 of TS 23.503 [20].
The PCF may be configured to map the ASP identifier to a target DNN and
S-NSSAI if the NEF did not provide the DNN, S-NSSAI to the PCF.
3\. H-PCF queries the UDR to retrieve all existing PDTQ polices for all the
ASPs using Nudr_DM_Query (Policy Data, Planned Data Transfer with QoS
requirements) service operation.
4\. The UDR provides all the stored PDTQ policies and corresponding related
information (e.g. the Number of UEs, the list of Desired time windows) to the
H-PCF.
5\. Based on information provided by the AF and other available information,
the H-PCF queries or/and subscribes to the NWDAF as defined in clause 6.6.4 or
clause 6.14.4 of TS 23.288 [50] to request the Network Performance analytics
or the DN Performance analytics.
When requesting the Network Performance analytics or the DN performance
analytics, if \"any UE\" is used, then the AoI information is used to identify
the target gNB(s) for the prediction of the availability of the network
resources.
The DNN, S-NSSAI and Application ID may be provided by H-PCF as Analytics
Filter Information when requesting or subscribing to the relevant Analytic ID.
6\. By referring to the outcome of the analytics report as described in clause
6.1.2.7 of TS 23.503 [20], H-PCF determines one or more PDTQ policies. Each
PDTQ policy includes a recommended time window for the traffic transfer for
each of the AF sessions for each of the UEs involved.
7\. The PCF sends one or more PDTQ policies to NEF in
Npcf_PDTQPolicyControl_Create Response including the PDTQ Reference ID.
8\. The NEF sends a Nnef_PDTQPolicyNegotiation_Create response to the AF to
provide one or more PDTQ policies together with the PDTQ Reference ID. If the
NEF received only one PDTQ policy from the PCF, steps 9-12 are not executed
and the flow proceeds to step 13. Otherwise, the flow proceeds to step 9.
9\. If more than one PDTQ policies were provided to the AF, the AF selects one
of the PDTQ policies and notifies NEF for the selected PDTQ policy via
Nnef_PDTQPolicyNegotiation_Update request together with the PDTQ Reference ID.
The AF stores the PDTQ Reference ID for the future interaction with the PCF.
10-12. The NEF notifies H-PCF about the selected PDTQ policy by the AF. The
H-PCF acknowledges NEF. The NEF responds to the AF request with a
Nnef_PDTQPolicyNegotiation_Update Response.
13-14. The H-PCF stores the PDTQ Reference ID together with the new PDTQ
policy in the UDR by invoking Nudr_DM_Update (PDTQ Reference ID, Policy Data,
Planned Data Transfer with QoS requirements). The UDR sends a response to the
H-PCF as acknowledgement.
##### 4.16.15.2.2 Procedure for PDTQ warning notification
Figure 4.16.15.2.2-1: The procedure for PDTQ warning notification
1\. The negotiation for PDTQ policy as described in clause 4.16.15.2.1 is
completed. In addition, the PCF has subscribed to analytics on \"Network
Performance\" or \"DN Performance\" from NWDAF for the area of interest and
time window of a PDTQ policy following the procedures and services described
in TS 23.288 [50], including a Reporting Threshold in the Analytics Reporting
information. The value for Reporting Threshold is set by the PCF based on
operator configuration.
2\. The PCF is notified with the Network Performance analytics or DN
Performance analytics in the area of interest from the NWDAF when the NWDAF
determines that the Network Performance or DN Performance reaches the
Reporting Threshold as described for the Network Performance analytics or DN
Performance analytics in TS 23.288 [50].
3\. The H-PCF requests from the UDR the stored PDTQ policies using
Nudr_DM_Query (Policy Data, Planned Data Transfer with QoS requirements)
service operation.
4\. The UDR provides all the PDTQ Policies together with the relevant
information received from the AFs (as defined in clause 6.1.2.7 of TS 23.503
[20]) to the H-PCF.
5\. The H-PCF identifies the PDTQ Policies affected based on the notification
received from NWDAF. For each of them, the H-PCF determines the ASP of which
the PDTQ traffic will be influenced by the degradation of network Performance
or DN Performance and which requested the H-PCF to send the notification. The
PCF then performs the following steps for each of the determined ASPs, i.e.
Steps 6 - 16 can occur multiple times (i.e. once per ASP).
6\. The PCF decides based on operator policies, whether a new list of
candidate PDTQ policies can be calculated for the ASP. If the PCF does not
find any new candidate PDTQ policy, the previously negotiated PDTQ policy
shall be kept, no interaction with that ASP shall occur and the procedure
stops for that PDTQ policy.
NOTE: The PDTQ policies of an ASP which did not request to be notified are
kept and no interaction with this ASP occurs.
7\. The PCF sets the no longer valid PDTQ policy in the UDR as invalidated by
invoking Nudr_DM_Update (PDTQ Reference ID, invalidation flag) service.
8\. The UDR sends a response to the H-PCF as acknowledgement.
9\. The PCF sends the notification to the NEF by invoking
Npcf_PDTQPolicyControl_Notify (PDTQ Reference ID, list of candidate PDTQ
policies) service operation.
10\. The NEF sends the PDTQ warning notification to the AF by invoking
Nnef_PDTQPolicyNegotiation_Notify (PDTQ Reference ID, list of candidate PDTQ
policies) service operation.
11\. The AF checks the new PDTQ policies included in the candidate list in the
PDTQ warning notification.
12\. If the AF selects any of the new PDTQ policies, the steps 9-14 from
clause 4.16.15.2.1 are executed with the difference that the AF has to respond
as well when only one PDTQ policy was provided by the PCF.
13\. If the AF doesn\'t select any of the new PDTQ policies, the steps 9-12
from clause 4.16.15.2.1 are executed, with the AF indicating that none of the
candidate PDTQ policies is acceptable. In this case, the AF response only
includes PDQT reference ID, but no PDTQ policy.
14-15. If the step 13 is executed, the PCF removes the no longer valid PDTQ
policy from UDR for the corresponding PDTQ Reference ID.
The AF can send a Stop notification by invoking
Nnef_PDTQPolicyNegotiation_Update service, when the AF requests not to receive
the PDTQ warning notification anymore. Then, the NEF invokes
Npcf_PDTQPolicyControl_Update service in order to provide this information for
the H-PCF.
### 4.16.16 Awareness of URSP Rule Enforcement
#### 4.16.16.1 General
Awareness of URSP rule enforcement is specified in clause 6.6.2.4 of TS 23.503
[20].
The content of this clause describes the PCF procedures necessary to realize
this functionality.
#### 4.16.16.1 Forwarding of URSP Rule Enforcement Information
This procedure applies when the PCF serving the PDU session receives URSP rule
enforcement information from the SMF and forwards this information to the PCF
serving the UE (see clause 6.1.3.18 of TS 23.503 [20]).
Figure 4.16.16.1-1: Forwarding of URSP Rule Enforcement Information
1\. The UE Policy Association is established, as described in clause 4.16.11.
2\. If the PCF indicates the UE to send reporting of URSP rule enforcement as
described in clause 6.6.2.4 of TS 23.503 [20], then depending on operator
policies in the PCF, the PCF may subscribe to the BSF, then step 3 follows, or
provides its PCF binding information to the AMF in step 1 with the indication
to be notified about the PCF for the PDU Session for a UE, then step 4
follows.
3\. The PCF for the UE determines that URSP rules depend on the UE reporting
of URSP rule enforcement, it then subscribes to the BSF to be notified when a
PCF for the PDU Session for this SUPI is registered in the BSF, by invoking
Nbsf_Management_Subscribe (SUPI; DNN). Steps 4 and 5 are repeated for each PCF
registered for a PDU Session to a SUPI included in the Nbsf_Management.
4\. The SMF establishes a SM Policy Association as described in clause 4.16.4.
The allocated UE address/prefix, SUPI, DNN, S-NSSAI and the PCF address is
registered in the BSF, as described in clause 6.1.1.2.2 of TS 23.503 [20].
5a. If the PCF for the UE subscribed to the BSF in step 3, then the BSF
notifies that a PCF for the PDU Session is registered in the BSF, by invoking
Nbsf_Management_Notify (UE address(es), PCF address, PCF instance id, PCF Set
ID, level of binding). When there are multiple PDU Sessions to the same UE the
BSF provides multiple notification to the PCF.
5b. If the PCF for the UE sent the request to notify that a PCF for the PDU
Session is available to the AMF in step 1, then the PCF for the PDU Sessions
sends Npcf_PolicyAuthorization_Notify (EventID set to SM Policy Association
established, UE address, PCF address, PCF instance is, PCF Set ID) to the PCF
indicated in the PCF binding information provided by the SMF.
6\. The PCF for the UE subscribes to notifications of event \"UE reporting
Connection Capabilities from associated URSP rule\" as defined in clause
6.1.3.18 of TS 23.503 [20], using Npcf_PolicyAuthorization_Subscribe (EventId
set to \"UE reporting Connection Capabilities from associated URSP rule\",
EventFilter set to at least \"list of Connection Capabilities\") and immediate
reporting flag set to the PCF for the PDU Session. The response includes the
NotificationCorrelationId and any Connection Capabilities if already available
at the PCF for the PDU Session.
7\. If not already installed, the PCF installs the Policy Control Request
Trigger to detect \"UE reporting Connection Capabilities from associated URSP
rule\" in the SMF.
8\. When the SMF receives a UE report of URSP rule enforcement via PDU session
establishment/modification as described in clauses 4.3.2 and 4.3.3 (step 8a)
and the Policy Control Request Trigger is met, it then reports the received
information traffic to the PCF serving the PDU Session, by invoking
Npcf_SMPolicyControl_Update as defined in clause 6.1.3.5 of TS 23.503 [20]
(step 8b).
9\. The PCF for the UE is notified on the \"UE reporting Connection
Capabilities from associated URSP rule\" by Npcf_PolicyAuthorization_Notify
(NotificationCorrelationId, EventId set to \"UE reporting Connection
Capabilities from associated URSP rule\", EventInformation including the
Connection Capabilities) as defined in clause 6.1.3.18 of TS 23.503 [20].
10\. The PCF for the UE checks operator policies and then may make policy
control decisions based on awareness of URSP rule enforcement as described in
clause 6.1.6 of TS 23.503 [20].
11\. The SM Policy Association is terminated as described in clause 4.16.6.
The allocated UE address/prefix, SUPI, DNN, S-NSSAI and the PCF address are
deregistered in the BSF.
12a. If the PCF for the UE subscribed to the BSF, then the BSF notifies that
the PCF serving a PDU Session is deregistered in the BSF, by invoking
Nbsf_Management_Notify (Binding Identifier for the PDU Session).
12b. If the PCF for the UE sent the request to notify that a PCF for the PDU
Session is available to the AMF in step 1, then the PCF for the PDU Session
sends Npcf_PolicyAuthoritation_Notify (EventID set to SM Policy Association
termination, Notification Correlation Id).
## 4.17 Network Function Service Framework Procedure
### 4.17.1 NF service Registration
NOTE 1: The term \"NF service consumer\" in this clause refers to the consumer
of the NRF services and should not be confused with the role of the NF
(consumer or producer).
Figure 4.17.1-1: NF Service Registration procedure
1\. NF service consumer, i. e. an NF instance sends
Nnrf_NFManagement_NFRegister Request message to NRF to inform the NRF of its
NF profile when the NF service consumer becomes operative for the first time.
See clause 5.2.7.2.2 for relevant NF profile parameters
NOTE 2: NF service consumer\'s NF profile is configured by OAM system.
2\. The NRF stores the NF profile of NF service consumer and marks the NF
service consumer available.
NOTE 3: Whether the NF profile sent by NF service consumer to NRF needs to be
integrity protected by the NF service consumer and verified by the NRF is to
be decided by SA3.
3\. The NRF acknowledge NF Registration is accepted via
Nnrf_NFManagement_NFRegister response.
### 4.17.2 NF service update
Figure 4.17.2-1: NF Service Update procedure
1\. NF service consumer i.e. an NF instance sends Nnrf_NFManagement_NFUpdate
Request message (the updated NF profile of NF service consumer) to NRF to
inform the NRF of its updated NF profile (e.g. with updated capacity) when
e.g. triggered after a scaling operation. See clause 5.2.7.2.3 for relevant
input and output parameters.
NOTE: The updated NF profile of NF instance are configured by OAM system.
2\. The NRF updates the NF profile of NF service consumer.
3\. The NRF acknowledge NF Update is accepted via Nnrf_NFManagement_NFUpdate
response.
NOTE 4: When the NF service consumer registers to NRF via the SCP, the NF
Service registration procedure can also be used by the SCP to derive the
relation among NF instances, e.g. whether they belong to a specific NF Set.
### 4.17.3 NF service deregistration
Figure 4.17.3-1: NF Service Deregistration procedure
1\. NF service consumer i.e. an NF instance sends
Nnrf_NFManagement_NFDeregister Request message to NRF to inform the NRF of its
unavailability when e.g. it\'s about to gracefully shut down or disconnect
from the network.
2\. The NRF marks the NF service consumer unavailable. NRF may remove the NF
profile of NF service consumer according to NF management policy.
3\. The NRF acknowledge NF Deregistration is accepted via
Nnrf_NFManagement_NFDeregister response.
### 4.17.4 NF/NF service discovery by NF service consumer in the same PLMN
Figure 4.17.4-1: NF/NF service discovery in the same PLMN
1\. The NF service consumer intends to discover services available in the
network based on service name and target NF type. The NF service consumer
invokes Nnrf_NFDiscovery_Request (Expected NF service Name, NF Type of the
expected NF instance, NF type of the NF consumer) from an appropriate
configured NRF in the same PLMN. The parameter may include optionally producer
NF Set ID, NF Service Set ID, SUPI, Data Set Identifier(s), External Group ID
(for UDM, UDR discovery), UE\'s Routing Indicator and Home Network Public Key
identifier (for UDM and AUSF discovery), S-NSSAI, NSI ID if available and
other service related parameters. In addition, for AMF discovery, the
parameters may include AMF Region ID, AMF Set ID, TAI. The NF service consumer
may indicate a preference for target NF location in the
Nnrf_NFDiscovery_Request. A complete list of parameters is provided in service
definition in clause 5.2.7.3.2.
NOTE 1: The NF service consumer indicates its NF location for preference for
target NF location.
NOTE 2: The use of NSI ID within a PLMN depends on the network deployment.
NOTE 3: The need for other service related parameters depends on the NF type
of the expected NF instance(s) and refer to the clause 6.3 \" Principles for
Network function and Network Function Service discovery and selection\" in TS
23.501 [2]. It is up to NF implementation whether one or multiple NF service
instances are registered in the NRF.
2\. The NRF authorizes the Nnrf_NFDiscovery_Request. Based on the profile of
the expected NF/NF service and the type of the NF service consumer, the NRF
determines whether the NF service consumer is allowed to discover the expected
NF instance(s). If the expected NF instance(s) or NF service instance(s) are
deployed in a certain network slice, NRF authorizes the discovery request
according to the discovery configuration of the Network Slice, e.g. the
expected NF instance(s) are only discoverable by the NF in the same network
slice.
3\. If allowed, the NRF determines a set of NF instance(s) matching the
Nnrf_NFDiscovery_Request and internal policies of the NRF and sends the NF
profile(s) of the determined NF instances. Each NF profile containing at least
the output required parameters (see clause 5.2.7.3.2) to the NF service
consumer via Nnrf_NFDiscovery_Request Response message.
If the target NF is UDR, UDM or AUSF, if SUPI was used as optional input
parameter in the request, the NRF shall provide the corresponding UDR, UDM or
AUSF instance(s) that matches the optional input SUPI. Otherwise, if SUPI is
not provided in the request, the NRF shall return all applicable UDR
instance(s) (e.g. based on the Data Set Id, NF type), UDM instance(s) or AUSF
instance(s) (e.g. based on NF type) and if applicable, the information of the
range of SUPI(s) and/or Data Set Id each UDR instance is supporting.
If the target NF is CHF, if SUPI, GPSI or PLMN ID was used as optional input
parameter in the request, the NRF shall provide the corresponding CHF
instance(s) that matches the optional input SUPI, GPSI or PLMN ID. The NRF
shall provide the primary CHF instance and the secondary CHF instance pair(s)
together, if configured in CHF instance profile. Otherwise, if neither
SUPI/PLMN ID nor GPSI is provided in the request, the NRF shall return all
applicable CHF instance(s) and if applicable, the information of the range of
SUPI(s), GPSI(s) or PLMN ID(s).
If the NF service consumer provided a preferred target NF location, the NRF
shall not limit the set of discovered NF instances or NF service instance(s)
to the target NF location, e.g. the NRF may provide NF instance(s) or NF
service instance(s) for which location is not the preferred target NF location
if no NF instance or NF service instance could be found for the preferred
target NF location.
### 4.17.4a NF/NF service discovery by NF service consumer in the same SNPN
The NF/NF service discovery by NF service consumer in the same SNPN follows
the same principles as NF/NF service discovery by NF service consumer in the
same PLMN, see clause 4.17.4. The following additions apply:
\- If the target NF is AUSF or NSSAAF and the Nnrf_NFDiscovery_Request
includes a Home Network Identifier (HNI) in the form of a realm and the HNI
belongs to a CH with AAA Server or a DCS with AAA Server, the NRF provides the
AUSF or NSSAAF in the same SNPN, based on the NF profile as specified in
clause 6.2.6.2 of TS 23.501 [2].
\- If the target NF is UDM and the Nnrf_NFDiscovery_Request includes a Home
Network Identifier (HNI) in the form of a realm and the HNI belongs to a CH
with AAA Server, the NRF provides the UDM in the same SNPN, based on the NF
profile as specified in clause 6.2.6.2 of TS 23.501 [2].
### 4.17.5 NF/NF service discovery across PLMNs in the case of discovery made
by NF service consumer
In the case that the NF service consumer intends to discover the NF/NF service
in home PLMN, the NRF in serving PLMN needs to request \"NF Discovery\"
service from NRF in the home PLMN. The procedure is depicted in the figure
below:
Figure 4.17.5-1: NF/NF service discovery across PLMNs
1\. The NF service consumer in the serving PLMN invokes
Nnrf_NFDiscovery_Request (Expected Service Name, NF type of the expected NF,
home PLMN ID, serving PLMN ID, NF type of the NF service consumer) to an
appropriate configured NRF in the serving PLMN. The request may also include
optionally producer NF Set ID, NF Service Set ID, S-NSSAI, NSI ID if available
and other service related parameters. A complete list of parameters is
provided in service definition in clause 5.2.7.3.2.
NOTE 1: The use of NSI ID within a PLMN depends on the network deployment.
2\. The NRF in serving PLMN identifies NRF in home PLMN (hNRF) based on the
home PLMN ID and it requests \"NF Discovery\" service from NRF in home PLMN
according the procedure in Figure 4.17.4-1 to get the expected NF profile(s)
of the NF instance(s) deployed in the home PLMN. As the NRF in the serving
PLMN triggers the \"NF Discovery\" on behalf of the NF service consumer, the
NRF in the serving PLMN shall not replace the information of the service
requester NF, i.e. NF consumer ID, in the Discovery Request message it sends
to the hNRF.
The hNRF may further query an appropriate local NRF in the home PLMN based on
the input information received from NRF of the serving PLMN. The FQDN of the
local NRF or Endpoint Address of local NRF\'s NF Discovery service in the home
PLMN may be configured in the hNRF or may need to be discovered based on the
input information.
3\. The NRF in serving PLMN provides same as step 3 in clause 4.17.4 applies.
### 4.17.5a NF/NF service discovery between SNPN and Credentials Holder
hosting AUSF/UDM or between SNPN and DCS hosting AUSF/UDM
Figure 4.17.5a-1: NF/NF service discovery across SNPN and Credentials Holder
In the case of a UE accessing SNPN using credentials from a Credentials Holder
hosting AUSF/UDM, similar procedure can be used for service discovery across
PLMNs as specified in clause 4.17.5 with the difference as below:
\- The Serving PLMN is replaced by SNPN and Home PLMN is replaced by CH;
\- In step 1:
\- the Home PLMN ID in Nnrf_NFDiscovery_Request is replaced by identification
for the Credentials Holder, i.e.:
\- the realm in the case of Network Specific Identifier based SUCI/SUPI; or
\- the MCC and MNC in the case of an IMSI based SUCI/SUPI;
NOTE: When IMSI based SUPI is used for a UE of a CH, the IMSI is assumed to be
globally unique and assigned by the owner of a PLMN ID containing MCC and MNC
of the IMSI as defined in TS 23.501 [2].
\- the Serving PLMN ID is replaced by SNPN ID (i.e. PLMN ID and NID);
\- In step 2, the NRF in SNPN identifies NRF in CH based on the identification
for the Credentials Holder.
In the case of a UE accessing ON-SNPN using Default UE credentials from a DCS
hosting AUSF/UDM, a similar procedure can be used than for service discovery
across PLMNs as specified in clause 4.17.5, with the difference as below:
\- The Serving PLMN is replaced by SNPN and Home PLMN is replaced by DCS;
\- In step 1:
\- the Home PLMN ID in Nnrf_NFDiscovery_Request is replaced by identification
for the DCS, i.e.:
\- the realm in the case of Network Specific Identifier based SUCI/SUPI;
\- the Serving PLMN ID is replaced by SNPN ID (i.e. PLMN ID and NID);
\- In step 2, the NRF in SNPN identifies NRF in DCS based on the
identification for the DCS.
### 4.17.6 SMF Provisioning of available UPFs using the NRF
#### 4.17.6.1 General
This clause describes the provisioning of available UPFs in SMF using the NRF
as documented in clause 6.3.3 of TS 23.501 [2].
This optional node-level step takes place prior to selecting the UPF for PDU
Sessions and may be followed by N4 Node Level procedures defined in clause
4.4.3 where the UPF and the SMF exchange information such as the support of
optional functionalities and capabilities.
As an option, UPF(s) may register in the NRF. This registration phase uses the
Nnrf_NFManagement_NFRegister operation and hence does not use N4.
For the purpose of SMF provisioning of available UPFs, the SMF uses the
Nnrf_NFManagement_NFStatusSubscribe, Nnrf_NFManagement_NFStatusNotify and
Nnrf_NFDiscovery services to learn about available UPFs.
NOTE 1: The protocol used by UPF to interact with NRF is described in TS
29.510 [37]
UPFs may be associated with UPF Provisioning Information in the NRF. The UPF
Provisioning Information consists of:
\- a list of (S-NSSAI, DNN);
\- UE IPv4 Address Ranges and/or IPv6 Prefix Range(s) per (S-NSSAI, DNN); and
NOTE 2: The above information can be used by the SMF for UPF selection when
static IP address/prefix allocation is required for a UE.
\- a SMF Area Identity the UPF can serve. The SMF Area Identity allows
limiting the SMF provisioning of UPF(s) using NRF to those UPF(s) associated
with a certain SMF Area Identity. This can e.g. be used if an SMF is only
allowed to control UPF(s) configured in NRF as belonging to a certain SMF Area
Identity.
\- the supported ATSSS steering functionality, i.e. whether MPTCP
functionality or ATSSS-LL functionality or MPQUIC functionality, or any
combination of them is supported.
\- the supported UPF event exposure service and supported Event IDs, e.g.
local notification of QoS Monitoring to AF or e.g. events for data collection
to NWDAF by Nupf_EventExposure_Notify.
The SMF Area Identity and UE IPv4 Address Ranges and/or IPv6 Prefix Range(s)
are optional in the UPF Provisioning Information.
#### 4.17.6.2 SMF provisioning of UPF instances using NRF
This procedure applies when a SMF wants to get informed about UPFs available
in the network and supporting a list of parameters.
Figure 4.17.6.2-1: SMF provisioning of UPF instances using NRF procedure
The following takes place when an SMF expects to be informed of UPFs available
in the network:
1 The SMF issues a Nnrf_NFManagement_NFStatusSubscribe Service Operation
providing the target UPF Provisioning Information it is interested in.
2 The NRF issues Nnrf_NFManagement_NFStatusNotify with the list of all UPFs
that currently meet the SMF subscription. This notification indicates the
subset of the target UPF Provisioning Information that is supported by each
UPF.
The following takes place when a new UPF instance is deployed:
3 At any time a new UPF instance is deployed.
4 The UPF instance is configured with the NRF identity to contact for
registration and with its UPF Provisioning Information. An UPF is not required
to understand the UPF Provisioning Information beyond usage of this
information to register in step 5.
5 The UPF instance issues an Nnrf_NFManagement_NFRegister Request operation
providing its NF type, the FQDN or IP address of its N4 interface and the UPF
Provisioning Information configured in step 4.
6\. Alternatively (to steps 4 and 5) OAM registers the UPF on the NRF
indicating the same UPF Provisioning Information as provided in step 5. This
configuration mechanism is out of scope of this specification.
7\. Based on the subscription in step 1, the NRF issues
Nnrf_NFManagement_NFStatusNotify to all SMFs with a subscription matching the
UPF Provisioning Information of the new UPF
### 4.17.7 NF/NF service status subscribe/notify in the same PLMN
Figure 4.17.7-1: NF/NF service status subscribe/notify in the same PLMN
1\. The NF service consumer subscribes to be notified of newly
registered/updated/deregistered NF instances along with its NF services. The
NF service consumer invokes Nnrf_NFManagement_NFStatusSubscribe Request from
an appropriate configured NRF in the same PLMN.
2\. The NRF authorizes the Nnrf_NFManagement_NFStatusSubscribe Request. Based
on the profile of the expected NF/NF service and the type of the NF service
consumer, the NRF determines whether the NF service consumer is allowed to
subscribe to the status of the target NF instance(s) or NF service
instance(s).
3\. If allowed, the NRF acknowledges the execution of
Nnrf_NFManagement_NFStatusSubscribe Request.
4\. NRF notifies about newly registered/updated/deregistered NF instances
along with its NF services to the subscribed NF service consumer.
NOTE 1: The NF service consumer unsubscribes to receive NF status
notifications by invoking Nnrf_NFManagement_NFStatusUnSubscribe service
operation.
NOTE 2: When the NF or NF service intance becomes unavailable, the NRF invokes
Nnrf_NFManagement_NFStatusNotify service to notify the NF service consumer
based on the subscription.
### 4.17.8 NF/NF service status subscribe/notify across PLMNs
In the case that the NF service consumer intends to subscribe to the status of
NF/NF service instance(s) in home PLMN, the NRF in serving PLMN needs to
request \"NF status subscribe\" service from NRF in the home PLMN. The
notification is sent from the NRF in the home PLMN to the NF service consumer
in the serving PLMN without the involvement of the NRF in the serving PLMN.
The procedure is depicted in the figure below:
Figure 4.17.8-1: NF/NF service status subscribe/notify across PLMNs
NOTE 1: The NRF in the home PLMN communicates with the NRF and the NF consumer
in the serving PLMN via the SEPPs in the respective PLMNs. For the sake of
clarity, SEPPs are not depicted in the flow.
1\. The NF service consumer in the serving PLMN invokes
Nnrf_NFManagement_NFStatusSubscribe Request from an appropriate configured NRF
in the serving PLMN.
2\. The NRF in serving PLMN identifies NRF in home PLMN (hNRF) based on the
home PLMN ID and it requests Nnrf_NFManagement_NFStatusSubscribe service from
NRF in home PLMN. As the NRF in the serving PLMN triggers the
Nnrf_NFManagement_NFStatusSubscribe service on behalf of the NF service
consumer, the NRF in the serving PLMN shall not replace the information of the
service requester NF, i.e. NF consumer ID, in the status subscribe Request
message it sends to the hNRF.
3\. The NRF in serving PLMN acknowledges the execution of
Nnrf_NFManagement_NFStatusSubscribe Request to the NF consumer in the serving
PLMN.
4\. NRF in the home PLMN notifies about newly registered/updated/deregistered
NF instances along with its NF services to the subscribed NF service consumer
in the serving PLMN.
NOTE 2: The NF service consumer unsubscribes to receive NF status
notifications by invoking Nnrf_NFManagement_NFStatusUnSubscribe service
operation.
NOTE 3: When the NF or NF service intance becomes unavailable, the NRF in the
home PLMN invokes Nnrf_NFManagement_NFStatusNotify service to notify the NF
service consumer in the serving PLMN based on the subscription.
### 4.17.9 Delegated service discovery when NF service consumer and NF service
producer are in same PLMN
Figure 4.17.9-1: Delegated NF service discovery when NF service consumer and
NF service producer are in same PLMN
1\. The NF service consumer intends to communicate with an NF service
producer. The NF service consumer sends the service request to an SCP. The
request may include discovery and selection parameters necessary to discover
and select a NF service producer instance. The discovery and selection
parameters are included in the request by the NF service consumer in a way
that the SCP does not need to parse the request body.
2\. The SCP may perform discovery upon the request either by interacting with
an NRF using Nnrf_NFDiscovery service NRF or may use information collected
during the previous interactions with an NRF (by the Nnrf_NFDiscovery service
or Nnrf_NFManagement_NFStatusNotify service operation). The SCP together with
the NRF authorizes the request. The SCP selects the target NF service
producer.
NOTE 1: If the discovery and selection parameters in the request include a UE
identity, e.g. SUPI or IMPI/IMPU, the SCP can resolve the requested NF\'s
Group ID corresponding to the UE identity and then invoke the Nnrf_NFDiscovery
service, as defined in clause 6.3.1 of TS 23.501 [2].
3\. If the NF service consumer is authorized to communicate with the NF
service producer, the SCP forwards the request to the selected NF service
producer according to the configuration of the Network Slice, e.g. the
expected NF instances are only reachable by NFs in the same network slice.
4\. The NF service producer sends a response to the SCP. If the request in
step 3 creates a resource in the NF service producer, such as depicted in
Figure 4.17.9-1, the NF service producer responds with resource information
identifying the created resource.
5\. The SCP routes the response to the NF service consumer.
If the NF service consumer receives a resource address, it uses it for
subsequent requests regarding the concerned resource. Otherwise, the procedure
ends here.
6\. On a subsequent operation on the created resource, the NF service consumer
addresses the resource via the resource address returned by the NF service
producer at step 4.
7\. The SCP resolves the NF service producer address and selects a target NF
service producer instance. The SCP then routes the request to the selected NF
service producer instance. See the clause 6.3.1.0 of TS 23.501 [2] for the
details of selection of a target NF service producer instance by SCP.
8\. The SCP delivers the request to the NF service producer.
9\. The NF service producer sends a response to the SCP. The NF service
producer may respond with an updated resource information different to the one
received in the previous response.
10\. The SCP sends a response to the NF service consumer. If the resource
information was updated, the NF service consumer uses the received resource
information for subsequent operations (requests) on the resource.
NOTE 2: In the similar manner of handling the resource information, a binding
indication may be also provided by the NF service producer and used for the
subsequent requests of the NF service consumer. See more details in clause
4.17.12.
### 4.17.10 Delegated service discovery when NF service consumer and NF
service producer are in different PLMNs
Figure 4.17.10-1: Delegated NF service discovery when NF service consumer and
NF service producer are in different PLMNs
1\. The NF service consumer intends to communicate with an NF service
producer. The NF service consumer sends the request to an SCP. The request
includes at least the source PLMN ID and the target PLMN ID in the discovery
and selection parameters necessary for the SCP to discover and select a NF
service producer instance. The discovery and selection parameters are included
in the request by the NF service consumer in a way that the SCP does not need
to parse the request body.
2\. The SCP recognises that the request is for a NF service producer in
another PLMN. SCP interacts with NRF using the Nnrf_NFDiscovery service.
3\. NRF in PLMN-1 and NRF in PLMN 2 interact using the Nnrf_NFDiscovery
service. See step 2 in clause 4.17.5.
4\. SCP gets Nnrf_NFDiscovery service response with NF profile(s).
5\. SCP selects a NF service producer instance in PLMN-2.
6\. SCP forwards the request to the selected NF service producer instance in
PLMN-2.
Alternatively, SCP may send the discovery request directly to the NRF in
PLMN-2, if it has the relevant NRF address and is authorized by the NRF in
PLMN-2. Thus step 2 goes from SCP to NRF in PLMN-2 and step 4 goes from NRF in
PLMN-2 to SCP and step 3 is omitted.
### 4.17.11 Indirect Communication without delegated discovery Procedure
This clause provides the call flow for indirect communication model without
delegated discovery.
Figure 4.17.11-1: Procedure for Indirect Communication without delegated
discovery
The NF/NF service discovery procedure is defined in clauses 4.17.4 and 4.17.5.
In a successful discovery the NF service consumer gets the NF profile(s)
matching the search criteria provided in the Nnrf_NFDiscovery_Request message.
1\. When the NF Service Consumer needs to send a Service Request and has
obtained an endpoint address for the appropriate resources of the NF service
producer from the reply to a previous service operation, the NF Service
Consumer should indicate that endpoint address as target for the Service
Request. Otherwise, if the NF Service Consumer has stored results from the
Discovery Procedure, the NF Service Consumer selects an appropriate NF
Producer / NF Service Producer instance from the list of NF profiles provided
by the NRF. The NF Service Consumer considers the NF and NF service parameters
(e.g. TAI, S-NSSAI, locality, priority etc) in the NF profiles. The NF Service
consumer requests service from the NF Service producer by sending a service
request message to the NF service producer via the SCP and the NF Service
Consumer may provide a Routing Binding Indication with the same contents as
the previously received Binding Indication.
2\. If the Routing Binding Indication is provided by the NF Service Consumer,
SCP (re-)selects as specified in Table 6.3.1.0â€‘1 of TS 23.501 [2] and routes
the service request to target accordingly. If the Routing Binding Indication
is not provided by the NF Service Consumer, then the SCP routes the service
request based on routing information available.
3\. The NF Service Producer responds via SCP.
4\. SCP forwards the response.
### 4.17.12 Binding between NF service consumer and NF service producer
#### 4.17.12.1 General
This clause describes the procedures to establish binding between the NF
service consumer and producer.
Direct Communication or Indirect Communication procedures may be used between
the Consumer and Producer. In the case of Indirect Communication, an SCP is
located between the Consumer and Producer.
#### 4.17.12.2 Binding created as part of service response
When the NF service consumer communicates with the NF service producer, the
producer may return a binding indication to the consumer. The consumer stores
the received binding indication and uses it for the subsequent requests
concerning the data context.
Figure 4.17.12.2-1: Binding created as part of service response
1\. If Direct Communication is used, the NF service consumer selects the NF
service producer and sends the request to the selected NF service producer. If
Indirect Communication without delegated discovery is used, the NF service
consumer selects the NF service producer set or instance and sends the request
to the selected NF service producer via the SCP; if the NF serviver consumer
only selects the NF service producer set, it provides the necessary selection
parameters and the SCP selects the NF service producer instance. If Indirect
Communication with delegated discovery is used, the NF service consumer sends
the request to the SCP and provides within the service request to the SCP the
discovery and selection parameters necessary to discover and select a NF
service producer.
2\. The NF service producer sends a response to the NF service consumer. In
the response the NF service producer may include a binding indication. If the
NF service consumer receives a resource information and binding indication as
specified in Table 6.3.1.0-1 of TS 23.501 [2], it uses them for subsequent
requests regarding the concerned resource. Otherwise, the procedure ends here.
3\. The NF service consumer uses the binding indication and resource
information received in the previous step for subsequent requests regarding
the concerned resource. If indirect communication with delegated discovery is
used, the NF service consumer includes a Routing Binding Indication with the
same contents as the received Binding Indication. If indirect communication
without delegated discovery is used, the NF service consumer also includes the
Routing Binding Indication with the same contents as the received Binding
Indication unless the NF service consumer performs a reselection. The SCP
shall route the service request using the Routing Binding Indication and
resource information sent from the NF service consumer.
4\. The NF service producer sends a response to the consumer. The NF service
producer may respond with an updated binding indication, different to the one
received in the previous response.
#### 4.17.12.3 Binding created as part of service request
If the NF service consumer can also be as a NF service producer for later
communication from the contacted producer, a service request sent to the
producer may include binding indication.
NOTE: This clause only applies to an AMF, V-SMF or I-SMF as NF service
consumer sending requests to an SMF and to an AMF as NF service consumer
sending requests to an I-SMF or V-SMF, in step 1 unless further usage has been
defined in stage 3. Implicit subscriptions are not described in this clause.
Figure 4.17.12.3-1: Binding created as part of service request
1\. Instance A, as an NF service consumer sends a service request using either
Direct Communication or Indirect communication via SCP and Instance B is
selected as NF service producer. If Instance A can also be NF service producer
for later communication for the concerned data context, it may include binding
indication referring to NF service instance, NF service set, NF instance or NF
Set as specified in Table 6.3.1.0-1 of TS 23.501 [2] in the request sent to
the NF service producer; the binding indication shall be associated with an
applicability indicating \"other service\" and include the service name. In
this case, if indirect communication is used, the SCP sends to the Instance B
the service request including the binding indication.
2\. Instance B as the NF service producer sends a response to the NF service
consumer.
3\. When Instance B as NF service consumer needs to invoke the service
provided by Instance A, Instance B sends a request using the binding
indication received in step 1 as described in Steps 3-4 in Figure 4.17.12.2-1
with the following difference:
\- Based on the received binding indication, if delegated discovery is not
used, the Instance B may need to discover the corresponding endpoint address
of the Instance A.
#### 4.17.12.4 Binding for subscription requests
Binding for notifications can be created as part of an explicit or implicit
subscription request. In this case, illustrated in Figure 4.17.12.4-1, the
subscription request may include a Binding Indication 1 referring to NF
service instance, NF service Set, NF instance or NF Set and additionally
includes a service name of the NF service consumer as specified in Table
6.3.1.0-1 of TS 23.501 [2]. The NF Service Set ID, NF service instance ID and
service name relate to the service of a NF service consumer that will handle
the notification.
For direct communication, the NF service producer selects the target for the
related notifications using the notification endpoint received in the
subscription request. If the notification endpoint included in the
subscription is not reachable, the Binding Indication received is used to
discover an alternative notification endpoint, as specified in Table 6.3.1.0-1
of TS 23.501 [2].
For indirect communication, the NF service producer includes the notification
endpoint received in the subscription and may include a Routing Binding
Indication with the same contents as the received Binding Indication. If the
notification endpoint included in the subscription is not reachable, the SCP
selects the target for the related notifications using the received Routing
Binding Indication as specified in Table 6.3.1.0-1 of TS 23.501 [2].
If the Binding Indication for Notifications needs to be updated, the NF
service consumer may initiate a new Subscription request to the NF service
producer with an updated Binding Indication or may include the Binding
Indication in the acknowledgment of a Notification. A Subscription request may
also contain updated Notification Correlation ID and Notification Target
Address.
Binding for the subscription resource at the NF service producer can also be
created: The Subscription Response message may contain a Binding Indication 2
referring to NF service instance, NF instance or NF Set of the NF service
producer.
For direct communication, the NF service consumer selects the target for the
related request to the producer, such as the request to update the
subscription shown in Figure 4.17.12.4-1, using the received Binding
Indication 2 as specified in Table 6.3.1.0-1 of TS 23.501 [2].
For indirect communication with delegated discovery, the NF service consumer
includes a Routing Binding Indication with the same contents as the received
Binding Indication 2. For indirect communication without delegated discovery,
the NF service consumer also includes the Routing Binding Indication with the
same contents as the received Binding Indication 2 unless it performs a
reselection. The SCP selects the target for the related request using the
received Routing Binding Indication 2 as specified in Table 6.3.1.0-1 of TS
23.501 [2].
If the Binding Indication for Subscription needs to be updated, the NF service
producer may provide an updated binding indication in a notification request
to the NF service consumer or in the response to a subsequent subscription
update request from the NF service consumer.
Figure 4.17.12.4-1: Binding in a subscription request
Figure 4.17.12.4-2: Binding during subscription via another network function
An NF service consumer may subscribe via another network function. For
example, NF_A may subscribe to NF_B on behalf of NF_C. NF_A additionally
subscribe to subscription related events. In this case, both the binding
indication from NF_C and NF_A are provided to the NF service producer NF_B.
The Binding Indication for notifications to subscription related events shall
be associated with an applicability indicating \"subscription events\".
The NF_C\'s binding indication is used for reselection of a notification
endpoint, which is used for event notification. The NF_A\'s binding indication
is used for reselection of a notification endpoint, which is used for
subscription change event notification.
### 4.17.13 NRF bootstrapping procedure
Figure 4.17.13-1: Bootstrapping procedure
1\. NF service consumer (e.g. v-NRF) sends a Nnrf_Bootstrapping_Get request to
the configured address of the Bootstrapping Service instance.
2\. NRF responds with all the Service Instances of the NRF and their endpoint
addresses. This also contains if the NRF is part of an NF Set.
## 4.18 Procedures for Management of PFDs
### 4.18.1 General
NOTE: The PFDF service is functionality within the NEF.
### 4.18.2 PFD management via NEF (PFDF)
#### 4.18.2.1 PFD management triggered by AF
Figure 4.18.2.1-1 procedure for PFD management via NEF (PFDF) triggered by AF
1\. The AF invokes the Nnef_PFDManagement_Create/Update/Delete service. The
Allowed Delay is an optional parameter. If the Allowed Delay is included, it
indicates that the list of PFDs in this request should be provisioned within
the time interval indicated by the Allowed Delay to the SMF(s) that have
subscribed to the PFD management service using Nnef_PFDManagement_Subscribe
service operation.
2\. NEF checks whether the AF is authorized to perform this request and NEF
(PFDF) checks if the AF is authorised to provision this PFD data based on the
operator policies. Besides the information from the AF, the NEF may subscribe
to the NWDAF to receive PFD Determination analytics defined in clause 6.16.3
of TS 23.288 [50].
3\. The NEF (PFDF) invokes the Nudr_DM_Create/Update/Delete (Application
Identifier, one or more sets of PFDs, Allowed Delay) to the UDR.
4\. The UDR updates the list of PFDs for the Application Identifier.
5\. The UDR sends a Nudr_DM_Create/Update/Delete Response to the NEF (PFDF).
6\. The NEF sends Nnef_PFDManagement_Create/Update/Delete Response to the
Application Function.
#### 4.18.2.2 PFD management based on PFD Determination analytics
Figure 4.18.2.2-1 shows the procedure that NEF (PFDF) determines the PFD
information for the known Application Identifier(s), based on the PFD
Determination analytics information notified/responded from the
subscribed/requested NWDAF. The procedure enables the NEF (PFDF) to determine
whether to create/update/delete PFD information corresponding to the known
Application Identifier(s).
Figure 4.18.2.2-1: Procedure for PFD management based on PFD Determination
analytics
1\. The NWDAF notifies/responds to PFD Determination analytics to the NEF
(PFDF) as Consumer NF with PFD Information defined in clause 6.16.3 of TS
23.288 [50].
2\. The NEF (PFDF) fetches the PFD information currently in use from UDR if
not available in NEF (PFDF) as described from step 2 to step 3 of clause
4.18.3.1.
3\. The NEF (PFDF) compares the PFD information from UDR with PFD information
from the NWDAF to determine whether to create/update/delete PFD information
corresponding to the Application Identifier.
4\. If the NEF (PFDF) has determined in step 3 to create/update/delete PFD
information corresponding to the Application Identifier, the NEF (PFDF)
invokes the Nudr_DM_Create/Update/Delete (Application Identifier, one or more
sets of PFDs) to the UDR to create/update/delete PFD information corresponding
to the Application Identifier, i.e. from step 3 to step 5 of clause 4.18.2.1
are executed. The NEF (PFDF) may forward new/updated PFD information to UPF
via SMF to detect a known application, as defined in clause 6.1.2.3.1 of TS
23.503 [20].
### 4.18.3 PFD management in the SMF
#### 4.18.3.1 PFD Retrieval by the SMF
This procedure enables the SMF to retrieve PFDs for an Application Identifier
from the NEF (PFDF) when a PCC rule with this Application Identifier is
provided/activated and PFDs provided by the NEF (PFDF) are not available at
the SMF.
In addition, this procedure enables the SMF to retrieve PFDs from the NEF
(PFDF)when the caching timer for an Application Identifier elapses and a PCC
Rule for this Application Identifier is still active.
The NEF (PFDF) retrieves the PFDs from UDR unless already available in NEF
(PFDF).
The SMF may retrieve PFDs for one or more Application Identifiers in the same
Request. All PFDs related to an Application Identifier are provided in the
response from the UDR to NEF (PFDF).
Figure 4.18.3.1-1 PFD Retrieval by the SMF
1\. SMF invokes the Nnef_PFDManagement_Fetch (Application Identifier (s)) to
the NEF (PFDF).
2\. NEF (PFDF) checks if the PFDs for the Application Identifier (s) are
available in the NEF (PFDF), if available, the NEF (PFDF) skips to step 4\. If
not, the NEF (PFDF) invokes Nudr_DM_Query (Application Identifier (s)) to
retrieve the PFD(s) from UDR.
3\. The UDR provides a Nudr_DM_Query response (Application Identifier(s),
PFD(s)) to the NEF (PFDF).
4\. The NEF (PFDF) replies to the SMF with Nnef_PFDManagement_Fetch
(Application Identifier(s), PFD(s)).
#### 4.18.3.2 Management of PFDs in the SMF
This procedure enables the provisioning, modification or removal of PFDs
associated with an application identifier in the SMF. Either the complete list
of all PFDs of all application identifiers, the complete list of all PFDs of
one or more application identifiers or a subset of PFDs for individual
application identifiers may be managed.
Each PFD of an application identifier is associated with a PFD id if a subset
of the PFD(s) associated with an application identifier can be provisioned,
updated or removed. If always the full set of PFD(s) for an application
identifier is managed in each transaction, PFD ids do not need to be provided.
Figure 4.18.3.2-1 Management of PFDs in the SMF
1\. As pre-requisite condition to receiving push notifications, the SMF
subscribes to PFD notifications from the NEF (PFDF) by sending
Nnef_PFDManagement_Subscribe message.
2\. The NEF (PFDF) invokes Nnef_PFD_Management_Notify (Application Identifier,
PFDs, PFDs operation) to the SMF(s) to which the PFD(s) shall be provided. The
NEF (PFDF) may decide to delay the distribution of PFDs to the SMF(s) for some
time to optimize the signalling load. If the NEF (PFDF) received an Allowed
Delay for a PFD, the NEF (PFDF) shall distribute this PFD within the indicated
time interval.
## 4.19 Network Data Analytics
The system procedures for Network Data Analytics are defined in clause 6 of TS
23.288 [50].
### 4.19.1 Void
### 4.19.2 Void
## 4.20 UE Parameters Update via UDM Control Plane Procedure
### 4.20.1 General
The purpose of the control plane solution for update of UE parameters is to
allow the HPLMN, SNPN, or CH to update the UE with a specific set of
parameters, generated and stored in the UDM, by delivering protected UDM
Update Data via NAS signalling. The HPLMN, SNPN, or CH updates such parameters
based on the operator policies.
The UDM Update Data that the UDM delivers to the UE may contain:
\- one or more UE parameters including:
\- the updated Default Configured NSSAI (final consumer of the parameter is
the ME);
\- the updated Routing Indicator Data (final consumer of the parameter is the
USIM when the related credential is stored in the USIM, i.e. for PLMN or SNPN
credentials; or final consumer of the parameter is the ME when the related
credential is stored in the ME, i.e. for SNPN credentials);
\- indication of whether disaster roaming is enabled in the UE if UE MINT
support indicator is received or UE is registered for Disaster Roaming service
currently; and
\- indication of \'applicability of \"lists of PLMN(s) to be used in disaster
condition\" provided by a VPLMN\' if UE MINT support indicator is received or
UE is registered for Disaster Roaming service currently.
\- a \"UE acknowledgement requested\" indication.
\- a \"re-registration requested\" indication.
### 4.20.2 UE Parameters Update via UDM Control Plane Procedure
Figure 4.20.2-1: UE Parameters Update via UDM Control Plane Procedure
1\. UDM decides to perform UE parameter update.
2\. From UDM to the AMF: The UDM notifies the changes of the information
related to the UE to the affected AMF by the means of invoking
Nudm_SDM_Notification service operation. The Nudm_SDM_Notification service
operation contains the UDM Update Data that needs to be delivered
transparently to the UE over NAS within the Access and Mobility Subscription
data. The UDM Update Data includes:
\- The updated parameters to be delivered to the UE (see clause 4.20.1 for
parameters possible to deliver).
\- whether the UE needs to send an ack to the UDM.
\- whether the UE needs to re-register after updating the data.
If the UE parameter update is performed due to \"Routing Indicator update
data\" and the updated Routing Indicator value is not supported by the UDM
where the AMF is currently registered, the UDM shall request the UE to re-
register after updating the data.
3\. From AMF to UDM: If AMF determines that the UE is not reachable, then AMF
invokes the Nudm_SDM_Info service operation to UDM indicating that the
transmission of UE Parameters Update data is not successful. The UDM considers
the procedure as UE Parameters Update procedure as pending and subsequent
steps from 4-7 are skipped.
4\. From AMF to the UE: the AMF sends a DL NAS TRANSPORT message to the served
UE. The AMF includes in the DL NAS TRANSPORT message the transparent container
received from the UDM.
The UE verifies based on mechanisms defined in TS 33.501 [15] that the UDM
Update Data is provided by HPLMN, SNPN, or CH; and:
\- If the security check on the UDM Update Data is successful, as defined in
TS 33.501 [15] the UE either stores the information and uses those parameters
from that point onwards, or forwards the information to the USIM; and
\- If the security check on the UDM Update Data fails, the UE discards the
contents of the UDM Update Data.
5\. The UE to the AMF: If the UE has verified that the UDM Update Data is
provided by HPLMN, SNPN, or CH and the UDM has requested the UE to send an ack
to the UDM, the UE sends an UL NAS TRANSPORT message to the serving AMF with a
transparent container including the UE acknowledgement.
6\. The AMF to the UDM: If the AMF receives an UL NAS TRANSPORT message with a
transparent container carrying a UE acknowledgement from the UE, the AMF sends
a Nudm_SDM_Info request message including the transparent container to the
UDM.
6a. If the UE parameter update is performed due to \"Routing Indicator update
data\", the updated Routing Indicator value is also supported by the UDM where
the AMF is currently registered and the UDM requests the UE to send an ack but
does not request the UE to re-register, then upon reception of the transparent
container indicating the acknowledgement of successful reception, the UDM
shall trigger a Nudm_SDM_Notification service operation to update the UE
Context in the AMF with the updated Routing Indicator Data (e.g. to avoid
transmitting an outdated Routing Indicator on UE context transfer to another
AMF).
The UDM shall also notify other NFs registered in UDM (i.e. SMF and SMSF)
about the update of the Routing Indicator value assigned to the SUPI using the
Nudm_SDM_Notification service operation.
7\. If the UDM has requested the UE to re-register, the UE waits until it goes
back to RRC_IDLE and initiates a Registration procedure as defined in TS
24.501 [25].
### 4.20.3 Void
## 4.21 Secondary RAT Usage Data Reporting Procedure
The procedure in Figure 4.21-1 may be used to report Secondary RAT Usage Data
from NG-RAN node to the AMF. It is executed by the NG-RAN node to report the
Secondary RAT Usage Data information towards AMF which is then reported
towards SMF.
The procedure in Figure 4.21-2 may be used to report the Secondary RAT Usage
Data from AMF towards the SMF. Optionally, it is used to report the Secondary
RAT Usage Data from V-SMF to the H-SMF when the reporting to H-SMF is
activated.
Figure 4.21-1: RAN Secondary RAT Usage Data Reporting procedure
1\. The NG-RAN, if it supports Dual Connectivity with Secondary RAT (using NR
radio, E-UTRA radio, or unlicensed spectrum using NR or E-UTRA radio) and it
is configured to report Secondary RAT Usage Data for the UE, depending on
certain conditions documented in this specification, it shall send a RAN Usage
Data Report message to the AMF including the Secondary RAT Usage Data for the
UE. The NG-RAN node will send only one RAN Usage Report for a UE when the UE
is subject to handover by RAN. The RAN Usage Data Report includes a Handover
Flag to indicate when the message is sent triggered by a handover.
Figure 4.21-2: SMF Secondary RAT Usage Data Reporting procedure
The NG-RAN, if it supports Dual Connectivity with Secondary RAT (using NR
radio, E-UTRA radio, or unlicensed spectrum using NR or E-UTRA radio) and it
is configured to report Secondary RAT usage data for the UE, it shall include
the Secondary RAT usage data for the UE to the AMF in certain messages
depending on certain conditions documented elsewhere in this TS.
1\. The AMF forwards the N2 SM Information (Secondary RAT Usage Data) to the
SMF in a Nsmf_PDUSession_UpdateSMContext Request.
2\. The V-SMF sends the Nsmf_PDUSession_Update (Secondary RAT Usage Data)
message to the H-SMF.
3\. The H-SMF acknowledges receiving the Secondary RAT Usage data for the UE.
4\. The V-SMF acknowledges receiving the Secondary RAT Usage data back to the
AMF.
## 4.22 ATSSS Procedures
### 4.22.1 General
This clause specifies the procedures that enable the support of Access Traffic
Steering, Switching and Splitting (ATSSS), as defined in clause 5.32 of TS
23.501 [2]. These procedures can be applied only by ATSSS-capable UEs and 5GC
networks.
The key enabler of ATSSS is the Multi Access-PDU (MA PDU) Session. As
specified in clause 5.32.1 of TS 23.501 [2], a MA PDU Session is a PDU Session
associated with two independent N3/N9 tunnels between the PSA and RAN/AN and
with multiple access types, i.e. with one 3GPP access and one non-3GPP access
both connected to 5GC. A MA PDU Session may also be a PDU Session associated
with one 3GPP access connected to EPC and one non-3GPP access connected to
5GC, or a PDU Session associated with one non-3GPP access connected to EPC and
one 3GPP access connected to 5GC. The traffic of a MA PDU Session can be
transferred over 3GPP access, or over non-3GPP access, or over both accesses.
How the traffic is transferred over the available accesses of a MA PDU Session
is governed by the applicable policy created by the 5GC network.
The UE determines whether ATSSS is supported by the network based on the MA
PDU Session Support indicator provided by the AMF during the Registration
procedures, as specified in clause 4.22.9.1. If the network does not support
ATSSS, the UE shall not initiate the following procedures in this network:
\- establishment of a MA PDU Session (clause 4.22.2);
\- establishment of a PDU Session with \"MA PDU Network-Upgrade Allowed\"
indication (clause 4.22.3);
\- addition of user-plane resources over one access for an existing MA PDU
Session, which has been established over the other access in a different
network (clause 4.22.7); or
\- PDU Session Modification with Request Type of \"MA PDU request\" or with
\"MA PDU Network-Upgrade Allowed\" indication after moving from EPC to 5GC
(clause 4.22.6.3).
### 4.22.2 UE Requested MA PDU Session Establishment
#### 4.22.2.0 Overview
Clauses 4.22.2.1 and 4.22.2.2 specify the MA PDU Session establishment
procedures with both 3GPP access and non-3GPP access connected to 5GC. Clause
4.22.2.3 specifies the MA PDU Session establishment procedure with 3GPP access
connected to EPC and non-3GPP access connected to 5GC. Clause 4.22.2.4
specifies the MA PDU Session establishment procedure with non-3GPP access
connected to EPC and 3GPP access connected to 5GC.
#### 4.22.2.1 Non-roaming and Roaming with Local Breakout
The signalling flow for a MA PDU Session establishment when the UE is not
roaming, or when the UE is roaming and the PDU Session Anchor (PSA) is located
in the VPLMN, is based on the signalling flow in Figure 4.3.2.2.1-1 with the
following differences and clarifications:
\- The PDU Session Establishment Request message may be sent over the 3GPP
access or over the non-3GPP access. In the steps below, it is assumed that it
is sent over the 3GPP access, unless otherwise specified.
\- In step 1, the UE provides Request Type as \"MA PDU Request\" in UL NAS
Transport message and its ATSSS Capabilities as defined in clause 5.32.2 of TS
23.501 [2] in PDU Session Establishment Request message.
The \"MA PDU Request\" Request Type in the UL NAS Transport message indicates
to the network that this PDU Session Establishment Request is to establish a
new MA PDU Session and to apply one or more steering functionalities (defined
in TS 23.501 [2], clause 5.32.6) for steering the traffic of this MA PDU
session over multiple accesses.
If the UE requests an S-NSSAI and the UE is registered over both accesses, it
shall request an S-NSSAI that is allowed on both accesses.
The UE indicates to AMF whether it supports non-3GPP access path switching,
i.e. whether the UE can transfer the non-3GPP access path of the MA PDU
Session from a source non-3GPP access (N3IWF/TNGF) to a target non-3GPP access
(a different N3IWF/TNGF).
\- In step 2, if the AMF supports MA PDU sessions, then the AMF selects an
SMF, which supports MA PDU sessions. If the AMF supports non-3GPP access path
switching and the UE indicated in step 1 that the UE supports non-3GPP access
path switching, the AMF selects a SMF that supports non-3GPP access path
switching, if such an SMF is available.
\- In step 3, the AMF informs the SMF that the request is for a MA PDU Session
by including \"MA PDU Request\" indication and in addition, it indicates to
SMF whether the UE is registered over both accesses. If the AMF determines
that the UE is registered via both accesses, but the requested S-NSSAI is not
allowed on both accesses, then the AMF shall reject the MA PDU session
establishment. If the AMF supports non-3GPP access path switching while
maintaining two N2 connections for non-3GPP access, the selected SMF supports
non-3GPP path switching and UE indicated in step 1 that the UE supports
non-3GPP access path switching, the AMF indicates whether the UE supports
non-3GPP path switching to the SMF.
The AMF shall reject the PDU Session Establishment request if the request is
for a LADN.
\- In step 4, the SMF retrieves, via Session Management subscription data, the
information whether the MA PDU session is allowed or not.
\- In step 7, if dynamic PCC is to be used for the MA PDU Session, the SMF
sends an \"MA PDU Request\" indication to the PCF in the SM Policy Control
Create message and the ATSSS Capabilities of the MA PDU session. The SMF
provides the currently used Access Type(s) and RAT Type(s) to the PCF. The PCF
decides whether the MA PDU session is allowed or not based on operator policy
and subscription data.
The PCF provides PCC rules that include MA PDU session control information, as
specified in TS 23.503 [20]. From the received PCC rules, the SMF derives (a)
ATSSS rules, which will be sent to UE for controlling the traffic steering,
switching and splitting in the uplink direction and (b) N4 rules, which will
be sent to UPF for controlling the traffic steering, switching and splitting
in the downlink direction. If the UE indicates the support of \"ATSSS-LL
Capability\", the SMF may derive the Measurement Assistance Information.
If the SMF receives a UP Security Policy for the PDU Session with Integrity
Protection set to \"Required\" and the MA PDU session is being established
over non-3GPP access, the SMF does not verify whether the access can satisfy
the UP Security Policy.
\- In the remaining steps of Figure 4.3.2.2.1-1, the SMF establishes the user-
plane resources over the 3GPP access, i.e. over the access where the PDU
Session Establishment Request was sent on:
\- In step 10, the N4 rules derived by SMF for the MA PDU session are sent to
UPF and two N3 UL CN tunnels info are allocated by the UPF. If the ATSSS LL
functionality is supported for MA PDU Session, the SMF may instruct the UPF to
initiate performance measurement for this MA PDU Session. If the MPTCP
functionality and/or the MPQUIC functionality is supported for the MA PDU
Session, the SMF may instruct the UPF to activate the MPTCP functionality
and/or the MPQUIC functionality for this MA PDU Session. In step 10a, the UPF
allocates addressing information for the Performance Measurement Function
(PMF) in the UPF. If the UPF receives from the SMF a list of QoS flows over
which access performance measurements may be performed, the UPF allocates
different UDP ports or different MAC addresses per QoS flow per access. In
step 10b, the UPF sends the addressing information for the PMF in the UPF to
the SMF. If UDP ports or MAC addresses are allocated per QoS flow and per
access, the UPF sends the PMF IP address information and UDP ports with the
related QFI to the SMF in the case of IP PDU sessions and sends the MAC
addresses with the related QFI to the SMF in the case of Ethernet PDU
sessions.
In step 10a, if the message from the SMF instructs the UPF to activate MPTCP
functionality, the UPF allocates the UE \"MPTCP link-specific multipath\"
addresses/prefixes. In step 10b, the UPF sends the \"MPTCP link-specific
multipath\" addresses/prefixes and MPTCP proxy information to the SMF. If the
message from the SMF instructs the UPF to activate MPQUIC functionality, the
UPF allocates the UE \"MPQUIC link-specific multipath\" addresses/prefixes. In
step 10b, the UPF sends the \"MPQUIC link-specific multipath\"
addresses/prefixes and MPQUIC proxy information to the SMF. The \"MPTCP link-
specific multipath\" addresses/prefixes and the \"MPQUIC link-specific
multipath\" addresses/prefixes may be the same.
\- In step 11, for the MA PDU session, the SMF includes an \"MA PDU session
Accepted\" indication in the Namf_Communication_N1N2MessageTransfer message to
the AMF and indicates to AMF that the N2 SM Information included in this
message should be sent over 3GPP access. The AMF marks this PDU session as MA
PDU session based on the received \"MA PDU session Accepted\" indication. If
the AMF indicated in step 3 that non-3GPP path switching while maintaining two
N2 connections for non-3GPP access is supported, the SMF indicates support of
non-3GPP path switching in the PDU Session Establishment Accept message.
\- In step 13, the UE receives a PDU Session Establishment Accept message,
which indicates to UE that the requested MA PDU session was successfully
established. This message includes the ATSSS rules for the MA PDU session,
which were derived by SMF. If the ATSSS -LL functionality is supported for the
PDU Session, the SMF may include the addressing information of PMF in the UPF
into the Measurement Assistance Information. If the MPTCP functionality is
supported for the MA PDU Session, the SMF shall include the \"MPTCP link-
specific multipath\" addresses/prefixes of the UE and the MPTCP proxy
information. If the MPQUIC functionality is supported for the MA PDU Session,
the SMF shall include the \"MPQUIC link-specific multipath\"
addresses/prefixes of the UE and the MPQUIC proxy information.
\- After step 18 in Figure 4.3.2.2.1-1, if the SMF was informed in step 2 that
the UE is registered over both accesses, then the SMF initiates the
establishment of user-plane resources over non-3GPP access too. The SMF sends
an Namf_Communication_N1N2MessageTransfer to the AMF including N2 SM
Information and indicates to AMF that the N2 SM Information should be sent
over non-3GPP access. Namf_Communication_N1N2MessageTransfer does not include
an N1 SM Container for the UE because this was sent to UE in step 13. After
this step, the two N3 tunnels between the PSA and RAN/AN are established.
The last step above is not executed when the UE is registered over one access
only, in which case the MA PDU Session is established with user-plane
resources over one access only. How user-plane resources can be added over an
access of the MA PDU Session is specified in clause 4.22.7.
#### 4.22.2.2 Home-routed Roaming
##### 4.22.2.2.1 Home-routed Roaming - UE registered to the same PLMN
When the UE is registered to the same VPLMN over 3GPP access and non-3GPP
access, the MA PDU Session is established as specified in Figure 4.3.2.2.2-1
(\"UE-requested PDU Session Establishment for home-routed roaming scenarios\")
with the differences and clarifications:
\- The PDU Session Establishment Request message may be sent over the 3GPP
access or over the non-3GPP access.
\- In step 1, the UE provides Request Type as \"MA PDU Request\" in UL NAS
Transport message and its ATSSS Capabilities, as defined in clause 5.32.2 of
TS 23.501 [2] in PDU Session Establishment Request message. The UE indicates
to AMF whether it supports non-3GPP access path switching.
\- In step 2, if the AMF supports MA PDU sessions, then the AMF selects a
V-SMF and an H-SMF, which supports MA PDU sessions. The V-SMF serves the UE
over both accesses. If the AMF supports non-3GPP access path switching and the
UE indicated in step 1 that the UE supports non-3GPP access path switching,
the AMF selects a V-SMF and H-SMF supporting non-3GPP access path switching,
if such a V-SMF and H-SMF are available.
\- In step 3, the AMF informs the SMF that the request is for a MA PDU Session
by including an \"MA PDU Request\" indication and in addition, the AMF
indicates to V-SMF that the UE is registered over both accesses. If the AMF
supports non-3GPP access path switching while maintaining two N2 connections
for non-3GPP access, the selected SMFs supports non-3GPP path switching and UE
indicated in step 1 that the UE supports non-3GPP access path switching, the
AMF indicates whether the UE supports non-3GPP path switching to the V-SMF.
\- In step 5, two DL N9 tunnel CN info and two UL N3 tunnel CN info are
allocated by the V-SMF or by the V-UPF.
\- In step 6, the V-SMF informs the H-SMF that the request is for a MA PDU
Session by including an \"MA PDU Request\" indication and indicates to H-SMF
that the UE is registered over both accesses. The V-SMF indicates to H-SMF the
relationship between the DL N9 tunnel CN info and the access type. If the
single CN Tunnel is established by the H-SMF, the DL N9 tunnel info binding to
the access over which the NAS message is received is to be used.
\- In step 7, the H-SMF retrieves, via Session Management subscription data,
the information whether the MA PDU session is allowed or not.
\- In step 9, if dynamic PCC is to be used for the MA PDU Session, the H-SMF
sends an \"MA PDU Request\" indication to H-PCF in the SM Policy Control
Create message and the ATSSS Capabilities of the MA PDU session. The H-SMF
provides the currently used list of Access Type(s) and RAT Type(s) for the MA-
PDU session to the H-PCF. The H-PCF decides whether the MA PDU session is
allowed or not based on operator policy and subscription data.
The H-PCF provides the PCC rules containing MA PDU session control information
and the H-SMF derives the ATSSS rules for the UE and the N4 rules for the
H-UPF.
\- In step 12, two UL N9 tunnel CN info are allocated by the H-SMF or by the
H-UPF. After this step, the two N9 tunnels between the H-UPF and V-UPF are
established.
\- In step 13, the H-SMF sends \"MA PDU session Accepted\" indication to V-SMF
in the Nsmf_PDUSession_Create Response message. The H-SMF indicates to V-SMF
the relationship between the UL N9 tunnel CN info and the access type.
\- In step 14, the V-SMF sends the \"MA PDU session Accepted\" indication in
the Namf_Communication_N1N2MessageTransfer message to the AMF and indicates
the AMF to send the N2 SM Information included in this message over the access
that the UE sent the PDU Session Establishment Request. The AMF marks this PDU
session as MA PDU session based on the received \"MA PDU session Accepted\"
indication.
The V-SMF indicates support of non-3GPP path switching in the PDU Session
Establishment Accept message.
If the V-SMF received two UL N9 tunnel CN info from the H-SMF, the V-SMF also
initiates the establishment of user-plane resources over the other access. The
V-SMF sends an N1N2 Message Transfer to AMF including N2 SM Information and
the other access type to indicate to AMF that the N2 SM Information should be
sent over the other access. The N1N2 Message Transfer does not include an N1
SM Container for the UE which was sent to UE over the access that the UE sent
the PDU Session Establishment Request.
\- In step 16, the UE receives a PDU Session Establishment Accept message,
which indicates to UE that the requested MA PDU session was successfully
established. This message includes the ATSSS rules for the MA PDU session,
which were derived by H-SMF and may include Measurement Assistance
Information.
\- After step 20, if the V-SMF was informed in step 3 that the UE is
registered over both accesses, then the V-SMF initiates the establishment of
user-plane resources over the other access too. The V-SMF sends an N1N2
Message Transfer to the AMF including N2 SM Information and indicates to the
AMF over which access the N2 SM Information should be sent. The N1N2 Message
Transfer does not include an N1 SM Container for the UE because this was sent
to the UE in step 14. After this step, two N9 tunnels between the H-UPF and
the V-UPF as well as two N3 tunnels between the V-UPF and RAN/AN are
established, or, if the H-UPF is connected to two different V-UPFs, the H-UPF
has one N9 tunnel with each V-UPF.
##### 4.22.2.2.2 Home-routed Roaming - UE registered to different PLMNs
When the UE is registered to different PLMNs over 3GPP access and non-3GPP
access, the MA PDU Session is established first over one access as specified
in Figure 4.3.2.2.2-1 (\"UE-requested PDU Session Establishment for home-
routed roaming scenarios\") and then over the other access with the following
differences and clarifications:
\- In step 1, the UE provides Request Type as \"MA PDU Request\" in UL NAS
Transport message and its ATSSS Capabilities, as defined in clause 5.32.2 of
TS 23.501 [2]. The UE indicates to AMF whether it supports non-3GPP access
path switching.
\- In step 2, if the AMF supports MA PDU sessions, then the AMF selects a
V-SMF, which supports MA PDU sessions. If the AMF supports non-3GPP access
path switching and the UE indicated in step 1 that the UE supports non-3GPP
access path switching, the AMF may select a V-SMF and H-SMF supporting
non-3GPP access path switching.
\- In step 3, the AMF informs the V-SMF that the request is for a MA PDU
Session (i.e. it includes an \"MA PDU Request\" indication). If the AMF
supports non-3GPP access path switching while maintaining two N2 connections
for non-3GPP access, the selected SMFs supports non-3GPP path switching and UE
indicated in step 1 that the UE supports non-3GPP access path switching, the
AMF indicates whether the UE supports non-3GPP path switching to the V-SMF.
\- In step 6, the V-SMF informs the H-SMF that the request is for a MA PDU
Session (i.e. it includes an \"MA PDU Request\" indication).
\- In step 7, the H-SMF retrieves, via Session Management subscription data,
the information whether the MA PDU session is allowed or not.
\- In step 9, if dynamic PCC is to be used for the MA PDU Session, the H-SMF
sends an \"MA PDU Request\" indication to PCF in the SM Policy Control Create
message and the ATSSS Capabilities of the MA PDU session. The H-SMF provides
the currently used Access Type(s) and RAT Type(s) for the MA-PDU session to
the PCF. The PCF decides whether the MA PDU session is allowed or not based on
operator policy and subscription data.
\- In step 14, the V-SMF indicates support of non-3GPP path switching in the
PDU Session Establishment Accept message.
\- In step 16, the UE receives a PDU Session Establishment Accept message,
which indicates to UE that the requested MA PDU session was successfully
established. This message includes the ATSSS rules for the MA PDU session,
which were derived by H-SMF and may include Measurement Assistance
Information.
\- After the MA PDU Session is successfully established on the first access,
the UE shall initiate again the MA PDU Session establishment procedure in
Figure 4.3.2.2.2-1 over the other access with the following differences and
clarifications:
\- In step 1, the UE shall send another PDU Session Establishment Request over
the other access containing the same PDU Session ID that was provided over the
first access. The UE also provides Request Type as \"MA PDU Request\" in UL
NAS Transport message. The UE indicates to the AMF whether it supports
non-3GPP access path switching.
\- In step 2, if the AMF supports non-3GPP access path switching while
maintaining two N2 connections for non-3GPP access, the may select a V-SMF
that support non-3GPP access path switching.
\- In step 3, if the AMF supports non-3GPP path switching and the UE indicated
in step 1 that the UE supports non-3GPP access path switching, the AMF
indicates whether the UE supports non-3GPP path switching to the V-SMF.
\- In step 12, new UL N9 tunnel CN info is allocated by the H-SMF or by the
H-UPF.
\- In step 14, the V-SMF indicates support of non-3GPP path switching in the
PDU Session Establishment Accept message.
\- In step 16, the UE receives another PDU Session Establishment Accept
message, which may contain updated ATSSS rules for the MA PDU session.
\- After step 20, two N9 tunnels between the H-UPF and two different V-UPFs as
well as two N3 tunnels between different V-UPF and RAN/AN are established, or
two N3 tunnels, one is between V-UPF and RAN/AN over 3GPP access and the other
is between H-UPF and RAN/AN over non 3GPP access, as well as one N9 tunnel
between H-UPF and V-UPF are established.
#### 4.22.2.3 MA PDU Session establishment with 3GPP access connected to EPC
and non-3GPP access connected to 5GC
##### 4.22.2.3.1 General
This clause applies to the case where, for a PDU Session, multi-access
connectivity via both EPC (over 3GPP access) and 5GC (over non-3GPP access) is
supported and allowed in the UE and network. In this case, multi-access
connectivity using ATSSS via both 3GPP access to EPC and non-3GPP access to
5GC may be provided as described in this clause.
For this scenario, the general principles for ATSSS as described in clause
5.32 of TS 23.501 [2] apply, with the additions provided in this clause
4.22.2.3.
A Multi-Access PDU Session may be extended with user-plane resources via an
associated PDN Connection on 3GPP access in EPC. This enables a scenario where
a MA PDU Session can simultaneously be associated with user-plane resources on
3GPP access network connected to EPC and non-3GPP access connected to 5GC.
Such a PDN Connection in EPS would thus be associated with multi-access
capability in the UE and PGW-C+SMF.
NOTE: To the MME and SGW this is a regular PDN Connection and the support for
ATSSS is transparent to MME and SGW.
The UE may operate in either single-registration mode or dual-registration
mode in 3GPP access. Irrespective of whether the UE operates in single-
registration mode or dual-registration mode in 3GPP access, it is assumed that
the UE supports simultaneous registrations for non-3GPP access in 5GC and 3GPP
access in EPC.
The ATSSS rules are provided from the PGW-C+SMF to the UE via SM NAS
signalling over 5GC, as described in clause 5.32.2 of TS 23.501 [2]. ATSSS
rules are not provided via the EPC.
When a UE establishes a MA PDU Session in 5GS, the UE indicates whether it
supports 3GPP access leg over EPC. Based on the UE capability, the SMF
determines whether the non-3GPP access should be released or not when the MA
PDU Session is moved to EPS as described in clause 4.22.6.2.
After the establishment of a MA PDU Session and setting up user-plane
resources in 3GPP access in EPC and non-3GPP access in 5GC, the UE distributes
the uplink traffic across the two access networks as described in clause
5.32.1 of TS 23.501 [2]. Similarly, the PDU Session Anchor UPF performs
distribution of downlink traffic across the two access networks as described
in clause 5.32.1 of TS 23.501 [2].
The PMF protocol may be used via any user plane connection, i.e. via 3GPP
access in EPC or non-3GPP access in 5GC.
The PCF functionality to support ATSSS, as described in clause 5.32.1 of TS
23.501 [2] and TS 23.503 [20] applies also in the case of interworking with
EPC.
When the 3GPP access leg of a MA PDU Session using both 3GPP and non-3GPP
access connected to 5GC is transferred to EPC, the PDU Session continues to
work as a MA PDU Session using E-UTRAN/EPC and non-3GPP access connected to
5GC, as described in clause 4.22.6.
##### 4.22.2.3.2 PDN Connections and Multi Access PDU Sessions
When the UE wants to request a new PDN Connection in EPC and wants to use this
PDN Connection as user-plane resource associated with a MA PDU Session:
\- The UE requests establishment of a new PDN Connection when the UE is
registered via 3GPP access in EPS using PDN Connection Establishment
procedure. The UE provides via PCO to PGW-C+SMF the following information:
\- An indication that the PDN Connection is requested to be associated with a
MA PDU Session
\- The UE\'s ATSSS capabilities as described in clause 5.32.2 of TS 23.501 [2]
(i.e. whether the UE is capable of supporting the ATSSS-LL functionality, the
MPTCP functionality, the MPQUIC functionality, or any combination of them).
\- The MME may select a PGW-C+SMF as described in TS 23.401 [13] and clause
4.11.0a.4.
NOTE 1: The selection of PGW-C+SMF in the correct 5GC slice requires the same
mapping between EPC and 5GC slices as required for single-access PDU sessions.
In order to select an ATSSS capable PGW-C+SMF it is assumed that the operator
deployment ensures that all PGW-C+SMF(s) configured to support the specific
APN in this network slice are also capable to support ATSSS. There is however
no assumption that all PGW-U+UPFs need to support ATSSS, since PGW-C+SMF can
make a selection of PGW-U+UPF taking the multi-access properties into account.
\- The PGW-C+SMF determines based its capabilities whether the request can be
accepted. The PCF decides whether the multi-access connectivity is allowed or
not based on operator policy and subscription data, as described in clause
4.22.2. The PGW-C+SMF provides the following information in the PCO to the UE:
\- An indication whether the request for using the PDN Connection for MA-PDU
Session is accepted or not.
\- If the UE has indicated that it is capable of supporting the MPTCP
functionality and/or the MPQUIC functionality and the PGW-C+SMF accepts to
activate the MPTCP functionality and/or the MPQUIC functionality, then the
network provides MPTCP proxy information and/or MPQUIC proxy information to
the UE, as described in clause 5.32.2 of TS 23.501 [2].
\- UE Measurement Assistance Information (as described in clause 5.32.2 of TS
23.501 [2]).
After the PDN Connection establishment:
\- If the UE registers to 5GC and wants to add non-3GPP user-plane resources,
then the UE shall send a PDU Session Establishment Request over this access
containing a \"MA PDU Request\" indication as described in clause 5.32.2 of TS
23.501 [2].
NOTE 2: Adding the PDU Session connectivity and user plane resources over
non-3GPP access in 5GS allows the PGW-C+SMF to provide ATSSS rules to the UE.
When the UE wants to request a new MA PDU Session in 5GC/non-3GPP access, the
description in clause 5.32.2 of TS 23.501 [2], applies. After the MA PDU
Session establishment in 5GS/non-3GPP access, the description in clause 5.32.2
of TS 23.501 [2], applies with the following additions:
\- If the UE is registered to EPC and wants to add user-plane resources on
3GPP access over EPC, then the UE shall send a PDN Connection Establishment
Request over this access containing a \"handover\" indication and include a
\"MA PDU Request\" indication in the PCO as well as the PDU Session ID of the
existing MA PDU Session on non-3GPP access over 5GC.
\- When the UE deregisters from the EPC access (but remains registered on the
5GC access), the MME will notify the PGW-C+SMF that the PDN Connection is
released, as described in TS 23.401 [13]. The SMF can then notify the UPF that
the access type has become unavailable.
In order to support EPS interworking when Ethernet type PDN Connection is not
supported in EPS, the UE may use non-IP type PDN Connection when the UE
establishes a PDN Connection in EPS as an added 3GPP access leg of an Ethernet
type MA PDU Session. In this case, the UE and SMF shall locally associate the
PDN Connection as an Ethernet type PDU Session as described in TS 23.501 [2].
When Ethernet type PDN Connection is not supported in EPS, the UE does not
request to establish a PDN Connection with \"MA PDU Request\" indication
before the UE registers to 5GS and establishes MA PDU Session over non-3GPP
access.
A UE that has an established MA-PDU session over non-3GPP access in 5GC and
3GPP access in EPS, may be able to use EN-DC for the 3GPP access leg.
Depending on the RAT types supported by the UE, the PDN connection may also be
handed over to 3GPP access in 5GC. For a UE supporting both E-UTRAN/EPC access
and NG-RAN/5GC access, the user plane resources for 3GPP access may be moved
between E-UTRAN/EPC access and NG-RAN/5GC access as described in clause 5.17.2
of TS 23.501 [2]. The PDU Session and User Plane resources active over
non-3GPP access are not affected by such inter 3GPP access RAT change.
##### 4.22.2.3.3 QoS Support
The general principles for QoS support with ATSSS as described in clause
5.32.4 of TS 23.501 [2], apply, with the clarifications provided in this
clause.
With an MA PDU Session associated to a PDN Connection on EPS there may be
separate user-plane tunnels between the AN and the PGW-U+UPF, one associated
with 3GPP access in EPC and one associated with non-3GPP access in 5GS.
As described in clause 4.11.1.1, the PGW-C+SMF maps the 5G QoS information
received from PCC to EPS QoS parameters. This mapping is e.g. based on
operator configuration and may result in that multiple QoS flows are mapped to
a single EPS bearer. The PGW-C+SMF applies the appropriate QoS signalling in
each access, e.g. to manage dedicated bearers in the access associated with
EPC and QoS flows in the access associated with 5GC. The PGW-C+SMF also
provides N4 rules to UPF for performing QoS enforcement and for mapping
downlink traffic to appropriate GTP-U tunnels.
As described in clause 5.32.4 of TS 23.501 [2], for a GBR QoS flow, the QoS
profile is provided to a single access network at a given time. GBR QoS flows
(and associated MBR, GBR) are thus only enforced in either the access
associated to EPC or the access associated to 5GC. In order to maintain
consistency between QoS information received via AS and NAS layers in each
system, the PGW-C+SMF only provides the GBR QoS information to the UE for the
access where the GBR traffic is enforced.
The UE shall treat the uplink traffic sent via EPC according to the EPS QoS
information received in EPC (e.g. UL TFTs) and the uplink traffic sent via 5GC
according to the 5G QoS rules received in 5GS. The UE thus need to determine
what access to use (3GPP and Non-3GPP) before applying the uplink QoS
treatment.
The UPF shall treat the downlink traffic according to the N4 rules (QER, etc.)
received from PGW-C+SMF.
#### 4.22.2.4 MA PDU Session establishment with non-3GPP access connected to
EPC and 3GPP access connected to 5GC
##### 4.22.2.4.1 General
This clause applies to the case where, for a PDU Session, multi-access
connectivity via both EPC (over non-3GPP access) and 5GC (over 3GPP access) is
supported and allowed in the UE and network. In this case, multi-access
connectivity using ATSSS via both non-3GPP access to EPC and 3GPP access to
5GC may be provided as described in this clause.
For this scenario, the general principles for ATSSS as described in clause
5.32 of TS 23.501 [2] apply, with the additions provided in this clause
4.22.2.3.
A Multi-Access PDU Session may be extended with user-plane resources via an
associated PDN Connection on non-3GPP access in EPC. This enables a scenario
where a MA PDU Session can simultaneously be associated with user-plane
resources on non-3GPP access network connected to EPC and 3GPP access
connected to 5GC. Such a PDN Connection in EPS would thus be associated with
multi-access capability in the UE and PGW-C+SMF.
NOTE: To the MME and SGW this is a regular PDN Connection and the support for
ATSSS is transparent to MME and SGW.
The UE may operate in either single-registration mode or dual-registration
mode in 3GPP access. Irrespective of whether the UE operates in single-
registration mode or dual-registration mode in 3GPP access, it is assumed that
the UE supports simultaneous registrations for 3GPP access in 5GC and non-3GPP
access in EPC.
The ATSSS rules are provided from the PGW-C+SMF to the UE via SM NAS
signalling over 5GC, as described in clause 5.32.2 of TS 23.501 [2]. ATSSS
rules may be provided via the EPC.
After the establishment of a MA PDU Session and setting up user-plane
resources in non-3GPP access in EPC and 3GPP access in 5GC, the UE distributes
the uplink traffic across the two access networks as described in clause
5.32.1 of TS 23.501 [2]. Similarly, the PDU Session Anchor UPF performs
distribution of downlink traffic across the two access networks as described
in clause 5.32.1 of TS 23.501 [2].
The PMF protocol may be used via any user plane connection, i.e. via non-3GPP
access in EPC or 3GPP access in 5GC.
The PCF functionality to support ATSSS, as described in clause 5.32.1 of TS
23.501 [2] and TS 23.503 [20] applies also in the case of interworking with
EPC.
When the 3GPP access leg of a MA PDU Session using one 3GPP access path via
5GC and one non-3GPP access path via ePDG is transferred to EPC, the PDU
Session may continue to work as a MA PDU Session using E-UTRAN/EPC and
non-3GPP access connected to ePDG, as described in clause 4.22.6.
##### 4.22.2.4.2 PDN Connections and Multi Access PDU Sessions
When the UE wants to request a new PDN Connection in EPC and wants to use this
PDN Connection as user-plane resource associated with a MA PDU Session:
\- The UE requests establishment of a new PDN Connection when the UE is
registered via non-3GPP access in EPS using PDN Connection Establishment
procedure. The UE provides the following ATSSS information to ePDG via IKE
signalling:
\- An indication that the PDN Connection is requested to be associated with a
MA PDU Session
\- The UE\'s ATSSS capabilities as described in clause 5.32.2 of TS 23.501 [2]
(i.e. whether the UE is capable of supporting any combination of the ATSSS-LL
functionality, the MPTCP functionality and the MPQUIC functionality).
\- The ePDG may select a PGW-C+SMF as described in TS 23.402 [26]. The ePDG
forwards the ATSSS information to the selected PGW-C+SMF via APCO in Create
Session Request message.
NOTE: The selection of PGW-C+SMF in the correct 5GC slice requires the same
mapping between EPC and 5GC slices as required for single-access PDU sessions.
In order to select an ATSSS capable PGW-C+SMF it is assumed that the operator
deployment ensures that all PGW-C+SMF(s) configured to support the specific
APN in this network slice are also capable to support ATSSS. There is however
no assumption that all PGW-U+UPFs need to support ATSSS, since PGW-C+SMF can
make a selection of PGW-U+UPF taking the multi-access properties into account.
\- The PGW-C+SMF determines based its capabilities whether the request can be
accepted. The PCF decides whether the multi-access connectivity is allowed or
not based on operator policy and subscription data, as described in clause
4.22.2. The PGW-C+SMF provides the following information via the APCO in the
Create Session Response message to the ePDG:
\- An indication whether the request for using the PDN Connection for MA-PDU
Session is accepted or not.
\- If the UE has indicated that it is capable of supporting the MPTCP
functionality and the PGW-C+SMF accepts to activate the MPTCP functionality,
then the network provides MPTCP proxy information to the UE, as described in
clause 5.32.2 of TS 23.501 [2].
\- If the UE has indicated that it is capable of supporting the MPQUIC
functionality and the PGW-C+SMF accepts to activate the MPQUIC functionality,
then the network provides MPQUIC proxy information to the UE, as described in
clause 5.32.2 of TS 23.501 [2].
\- UE Measurement Assistance Information (as described in clause 5.32.2 of TS
23.501 [2]).
\- ATSSS rules
\- The ePDG forwards the received above information to the UE via IKE
signalling.
After the PDN Connection establishment:
\- If the UE registers to 5GC and wants to add 3GPP user-plane resources, then
the UE shall send a PDU Session Establishment Request over this access
containing a \"MA PDU Request\" indication as described in clause 5.32.2 of TS
23.501 [2].
When the UE wants to request a new MA PDU Session in 5GC/3GPP access, the
description in clause 5.32.2 of TS 23.501 [2], applies. After the MA PDU
Session establishment in 5GC/3GPP access, the description in clause 5.32.2 of
TS 23.501 [2], applies with the following additions:
\- If the UE is registered to EPC and wants to add user-plane resources on
non-3GPP access over EPC, then the UE shall send a PDN Connection
Establishment Request over this access containing the IP address of the MA PDU
Session in CFG_REQUEST Configuration Payload and include a \"MA PDU Request\"
indication and UE\'s ATSSS capabilities and the PDU Session ID of the existing
MA PDU Session on 3GPP access over 5GC. The ePDG forwards the ATSSS
information via the APCO in the Create Session Request message to the
PGW-C/SMF.
\- When the UE deregisters from the EPC/non-3GPP access (but remains
registered on the 5GC/3GPP access), the ePDG will notify the PGW-C+SMF that
the PDN Connection is released, as described in TS 23.402 [26]. The SMF can
then notify the UPF that the access type has become unavailable.
A UE that has an established MA-PDU session over 3GPP access in 5GC and
non-3GPP access in EPS, may be able to use Dual Connectivity for the 3GPP
access leg.
Depending on the RAT types supported by the UE, the PDU Session may also be
handed over to 3GPP access in EPC. For a UE supporting both E-UTRAN/EPC access
and NG-RAN/5GC access, the user plane resources for 3GPP access may be moved
between E-UTRAN/EPC access and NG-RAN/5GC access as described in clause 5.17.2
of TS 23.501 [2]. The SMF+PGW-C may keep the MA PDU Session when the user
plane resources of the MA PDU Session is only established in EPS over both
accesses.
### 4.22.3 UE Requested PDU Session Establishment with Network Modification to
MA PDU Session
#### 4.22.3.1 Overview
When an ATSSS-capable UE requests to establish a single-access PDU Session,
but no policy in the UE and no local restrictions mandate a single access, the
5GC network may decide to modify it to a Multi-Access PDU (MA PDU) Session.
This decision may be taken when e.g. the SMF wants to offload some traffic of
the requested PDU Session to non-3GPP access or when the SMF wants to apply
MPTCP and/or MPQUIC to provide bandwidth aggregation for the requested PDU
Session.
#### 4.22.3.2 Non-roaming or roaming with local breakout
In the case of non-roaming or roaming with local breakout, the procedure for
establishing a MA PDU Session when the UE requests a single-access PDU Session
is the same with the procedure specified in clause 4.22.2.1.1, with the
following clarifications and modifications:
\- In step 1, the UE sets Request Type to initial request and it may include
the \"MA PDU Network-Upgrade Allowed\" indication in UL NAS Transport message
and its ATSSS Capabilities in PDU Session Establishment Request message, if
the 5GC is ATSSS capable and no policy in the UE (e.g. no URSP rule) and no
local restrictions mandate a single access for the requested PDU Session. The
\"MA PDU Network-Upgrade Allowed\" indication indicates that the requested
single-access PDU Session may be converted to a MA PDU Session, if the 5GC
network wants to.
\- In step 2, if the AMF receives the \"MA PDU Network-Upgrade Allowed\"
indication, the AMF may select a SMF that supports MA PDU sessions. The AMF
does not send the \"MA PDU Request\" indication to SMF, but it sends the \"MA
PDU Network-Upgrade Allowed\" indication, if received from the UE. If the AMF
determines that the requested S-NSSAI is not allowed on both accesses, the AMF
shall not forward \"MA PDU Network-Upgrade Allowed\" indication to the SMF. If
the AMF sends the \"MA PDU Network-Upgrade Allowed\" indication to SMF, it
shall also indicate to SMF whether the UE is registered over both accesses.
If the PDU Session Establishment request is for a LADN, the AMF shall not
forward \"MA PDU Network-Upgrade Allowed\" indication to the SMF.
\- After step 6, if SMF receives the \"MA PDU Network-Upgrade Allowed\"
indication, the SMF may decide, if dynamic PCC is not to be used, to convert
the single-access PDU Session requested by the UE into a MA PDU Session. The
SMF may take this decision based on local operator policy, subscription data
indicating whether the MA PDU session is allowed or not and/or other
conditions, which are not specified in the present document.
If the SMF receives ATSSS Capabilities from the UE but does not receive \"MA
PDU Network-Upgrade Allowed\" indication from the AMF, the SMF shall not
convert the single-access PDU Session requested by the UE into a MA PDU
Session.
If the SMF receives a UP Security Policy for the PDU Session with Integrity
Protection set to \"Required\" and the MA PDU session is being established
over non-3GPP access, the SMF does not verify whether the access can satisfy
the UP Security Policy.
\- In step 7, if dynamic PCC is to be used for the PDU Session, the SMF
indicates to PCF that the SM policy control information is requested for a MA
PDU Session via \"MA PDU Network-Upgrade Allowed\" indication if the MA PDU
session is allowed based on the subscription data. The SMF provides the
currently used Access Type(s) and RAT Type(s) for the MA-PDU session to the
H-PCF. The SMF also provides the ATSSS Capabilities of the MA PDU session.
\- In step 10, the N4 rules derived by SMF for the MA-PDU session are sent to
UPF and two N3 UL CN tunnels info are allocated by the UPF.
\- In step 11, for the MA PDU Session, the SMF sends an \"MA PDU session
Accepted\" indication in the Namf_Communication_N1N2MessageTransfer message to
the AMF. The AMF marks this PDU session as MA PDU session based on the
received \"MA PDU session Accepted\" indication.
\- The PDU Session Establishment Accept message includes ATSSS rules which
indicate to UE that the requested PDU Session was converted by the network to
a MA PDU Session.
\- The SMF triggers the establishment of user-plane resources in both
accesses, if it was informed in step 2 that the UE is registered over both
accesses.
#### 4.22.3.3 Home-routed, the UE registered to the same VPLMN over both
access
In the case of home-routed roaming, when the UE is registered to the same
VPLMN over 3GPP access and non-3GPP access, the procedure for establishing a
MA PDU Session when the VPLMN is ATSSS capable and the UE requests a single-
access PDU Session but no policy in the UE and no local restrictions mandate a
single access, is the same with the procedure specified in clause 4.22.2.2.1,
with the following clarifications and modifications:
\- In step 1, the UE sets Request Type to initial request and it may include
an \"MA PDU Network-Upgrade Allowed\" indication in UL NAS Transport message
and its ATSSS Capabilities as defined in clause 5.32.2 of TS 23.501 [2] in PDU
Session Establishment Request message.
\- In step 2, if the AMF receives the \"MA PDU Network-Upgrade Allowed\"
indication, the AMF may select a V-SMF and a H-SMF that support MA PDU
sessions. If the AMF determines that the requested S-NSSAI is not allowed on
both accesses, the AMF shall not forward \"MA PDU Network-Upgrade Allowed\"
indication to the V-SMF.
\- In step 3, the AMF sends the \"MA PDU Network-Upgrade Allowed\" indication,
if received from the UE. If the AMF sends the \"MA PDU Network-Upgrade
Allowed\" indication to V-SMF, it shall also indicate to V-SMF whether the UE
is registered over both accesses.
\- In step 5, two DL N9 tunnel CN info and two UL N3 tunnel CN info are
allocated by the V-SMF or by the V-UPF. Additionally, the V-SMF indicates to
H-SMF the relationship between the DL N9 tunnel CN info and the access type.
If the single CN Tunnel is established by the H-SMF, the DL N9 tunnel CN info
binding to the access over which the NAS message is received is to be used.
\- In step 6, the V-SMF provides the \"MA PDU Network-Upgrade Allowed\"
indication, if received from AMF, together with an indication whether the UE
is registered over both accesses.
\- After step 6, if the H-SMF receives the \"MA PDU Network-Upgrade Allowed\"
indication, the H-SMF may decide to convert the single-access PDU Session
requested by the UE into a MA PDU Session, if dynamic PCC is not to be used.
The H-SMF may take this decision based on local operator policy, subscription
data indicating whether the MA PDU session is allowed or not and/or other
conditions, which are not specified in the present document.
If the H-SMF receives ATSSS Capabilities from the UE but does not receive \"MA
PDU Network-Upgrade Allowed\" indication from the AMF, the H-SMF shall not
convert the single-access PDU Session requested by the UE into a MA PDU
Session.
\- In step 9, if dynamic PCC is to be used for the MA PDU Session, the H-SMF
sends an \"MA PDU Network-Upgrade Allowed\" indication instead of \"MA PDU
Request\" indication to H-PCF in the SM Policy Control Create message if the
MA PDU session is allowed based on the subscription data. The H-SMF also
provides the ATSSS Capabilities of the MA PDU session. The H-PCF decides
whether the single-access PDU Session can be converted into an MA PDU session
or not based on operator policy and subscription data.
\- In step 13, the H-SMF sends \"MA PDU session Accepted\" indication to V-SMF
in the Nsmf_PDUSession_Create Response message.
\- In step 14, the V-SMF includes the \"MA PDU session Accepted\" indication
in the Namf_Communication_N1N2MessageTransfer message to the AMF. The AMF mark
this PDU session as MA PDU session based on the received \"MA PDU session
Accepted\" indication.
\- In step 16, the UE receives a PDU Session Establishment Accept message,
which includes ATSSS rules and indicates to UE that the requested single-
access PDU session was established as a MA PDU Session.
\- After step 18, two N9 tunnels between the H-UPF and the V-UPF as well as
two N3 tunnels between the V-UPF and 5G-AN are established, or, if the H-UPF
is connected to two different V-UPFs, the H-UPF has one N9 tunnel with each
V-UPF.
#### 4.22.3.4 Home-routed, the UE registered to different PLMNs over both
access
In the case of home-routed roaming, when the UE is registered to different
PLMNs over 3GPP access and non-3GPP access, the procedure for establishing a
MA PDU Session when the UE requests a single-access PDU Session in an ATSSS
capable PLMN but no policy in the UE and no local restrictions mandate a
single access, is the same with the procedure specified in clause 4.22.2.2.2,
with the following clarifications and modifications:
\- In step 1, the UE sets Request Type to initial request and it may include
an \"MA PDU Network-Upgrade Allowed\" indication in UL NAS Transport message
and its ATSSS Capabilities as defined in clause 5.32.2 of TS 23.501 [2] in PDU
Session Establishment Request message.
\- In step 2, if the AMF receives the \"MA PDU Network-Upgrade Allowed\"
indication, the AMF may select a V-SMF that supports MA PDU sessions.
\- In step 3, the AMF sends the \"MA PDU Network-Upgrade Allowed\" indication,
if received from the UE.
\- In step 6, the V-SMF provides the \"MA PDU Network-Upgrade Allowed\"
indication, if received from AMF.
\- After step 6, if the H-SMF receives the \"MA PDU Network-Upgrade Allowed\"
indication, the H-SMF may decide to convert the single-access PDU Session
requested by the UE into a MA PDU Session, if dynamic PCC is not to be used.
The H-SMF may take this decision based on local operator policy, subscription
data indicating whether the MA PDU session is allowed or not and/or other
conditions, which are not specified in the present document.
\- In step 9, if dynamic PCC is to be used for the MA PDU Session, the H-SMF
sends an \"MA PDU Network-Upgrade Allowed\" indication to H-PCF in the SM
Policy Control Create message if the MA PDU session is allowed based on the
subscription data. The H-SMF also provides the ATSSS Capabilities of the MA
PDU session.
\- In step 13, the H-SMF sends \"MA PDU session Accepted\" indication to V-SMF
in the Nsmf_PDUSession_Create Response message.
\- In step 14, the V-SMF includes the \"MA PDU session Accepted\" indication
in the Namf_Communication_N1N2MessageTransfer message to the AMF. The AMF mark
this PDU session as MA PDU session based on the received \"MA PDU session
Accepted\" indication.
\- In step 16, the UE receives a PDU Session Establishment Accept message,
which includes ATSSS rules and indicates to UE that the requested single-
access PDU session was established as a MA PDU Session.
\- After the MA PDU Session is established over one access, the UE shall send
another PDU Session Establishment Request over the other access containing the
same PDU Session ID that was provided over the first access. The UE also sets
Request Type as \"MA PDU Request\" in UL NAS Transport message.
### 4.22.4 Access Network Performance Measurements
The PMF of UE side or/and UPF side should be able to correlate the measurement
packets with the corresponding access type in order to get the accurate
measurement result for each access. The PMF of UE side correlates the sent
measurement request and received measurement response messages via the same
access type and the PMF of UPF side correlates the sent measurement request
and received measurement response messages via the same N3 or N9 Tunnel. The
PMF of UPF side shall record the relationship between the RTT measurement
result and the N3 or N9 Tunnel.
NOTE: The frequency for RTT measurement for each access is decided by the PMF
of the UE and the UPF respectively.
### 4.22.5 Reporting of Access Availability
After the MA PDU session is established, if Reporting of Access Availability
is required by network, the UE performs detection of the unavailability and
availability of an access as described in clause 5.32.5.3 of TS 23.501 [2]. To
report the availability/unavailability of the access, the UE sends the PMF-
Access Report to the UPF via the user plane of any available access of the MA
PDU session. The UPF shall use this report to decide which access can be used
to deliver the downlink packets.
### 4.22.5A Suspend and Resume Traffic Duplication
After the MA PDU session is established and the Redundant steering mode is
active, the UPF may suspend traffic duplication by sending PMF-Suspend
Duplication Request to the UE via the user plane of any available access of
the MA PDU session as described in clause 5.32.5.6 of TS 23.501 [2]. The UPF
may resume traffic duplication for a UE by sending PMF-Resume Duplication
Request via the user plane of any available access of the MA PDU session as
described in clause 5.32.5.6 of TS 23.501 [2].
### 4.22.6 EPS Interworking
#### 4.22.6.1 General
This clause includes procedures for interworking with EPS.
#### 4.22.6.2 Impacts to EPS interworking procedures
##### 4.22.6.2.1 5GS to EPS handover using N26 interface
Based on the signalling flow in Figure 4.11.1.2.1-1, the procedure is
performed with the following differences and modifications:
\- Step 2 is also performed with all the SMF+PGW-Cs corresponding to MA PDU
Sessions with allocated EBI(s).
\- In step 12e, the AMF requests the release of the 3GPP access of the MA PDU
Session which has resources established for 3GPP access, but not expected to
be transferred to EPC, i.e. no EBI(s) allocated to the MA PDU Session by
triggering Nsmf_PDUSession_UpdateSMContext service operation.
NOTE: When the SMF received the release request from the AMF, the SMF decides
whether the MA PDU Session is completely released or released over a single
access based on its local policy.
\- In step 16, if the MA PDU Session is established in both 3GPP and non-3GPP
accesses and the MA PDU Session is moved to EPS and if the UE or the network
does not supports MA PDU Session with 3GPP access connected to EPC, the SMF
triggers the MA PDU Session Release procedure over non-3GPP access. If UE and
the network support MA PDU Session with 3GPP access connected to EPC, the SMF
should keep the user-plane resources over non-3GPP access in 5GC and use the
PDN Connection as the 3GPP access leg of the MA PDU Session. If the MA PDU
Session is established using one 3GPP access path via 5GC and one non-3GPP
access path via ePDG/EPC and the MA PDU Session is moved to EPS and if the UE
and network supports MA PDU Session with non-3GPP access connected to EPC, the
SMF may keep the MA PDU Session.
##### 4.22.6.2.2 5GS to EPS idle mode mobility using N26 interface
Based on the signalling flow in Figure 4.11.1.3.2-1, the procedure is
performed with the following differences and modifications:
\- Step 5a is also performed with all the SMF+PGW-Cs corresponding to the MA
PDU Sessions with allocated EBI(s).
\- In step 12, if the MA PDU Session is established in both 3GPP and non-3GPP
accesses and the MA PDU Session is moved to EPS and if the UE or the network
does not support MA PDU Session with 3GPP access connected to EPC, the SMF
triggers the MA PDU Session Release procedure over non-3GPP access. If UE and
the network support MA PDU Session with 3GPP access connected to EPC, the SMF
should keep the user-plane resources over non-3GPP access in 5GC and use the
PDN Connection as the 3GPP access leg of the MA PDU Session. If the MA PDU
Session is established using one 3GPP access path via 5GC and one non-3GPP
access path via ePDG/EPC and the MA PDU Session is moved to EPS and if the UE
and network supports MA PDU Session with non-3GPP access connected to EPC, the
SMF may keep the MA PDU Session.
\- In step 15a, the AMF also requests the release of the MA PDU Session which
has resources established for 3GPP access, but not expected to be transferred
to EPS, i.e. no EBI(s) allocated to the MA PDU Session by triggering
Nsmf_PDUSession_UpdateSMContext service operation.
NOTE: When the SMF received the release request from the AMF, the SMF decides
whether the MA PDU Session is completely released or released over a single
access based on its local policy.
##### 4.22.6.2.3 EPS bearer ID allocation
Based on the signalling flow in Figure 4.11.1.4.1-1, additionally for the MA
PDU Session, with the following differences and clarifications:
\- In step 1, the following procedures and relevant steps are also initiated
during the UE Requested MA PDU Session Establishment, the UE Requested PDU
Session Establishment with Network Modification to MA PDU Session and the UE
or network requested MA PDU Session Modification procedures.
\- In step 2, if the QoS Flow(s) of the MA PDU Session is established and the
MA PDU Session is established over 3GPP access and other existing conditions
satisfies EPS interworking, the SMF requests EBI allocation for the QoS
Flow(s) of the MA PDU Session.
##### 4.22.6.2.4 EPS bearer ID revocation
Based on the clause 4.11.1.4.3, additionally the following procedures are
updated to revoke the EPS bearer ID(s) assigned to the QoS Flow(s) in the MA
PDU Session:
\- UE or network requested MA PDU Session Release (non-roaming and roaming
with local breakout) in clause 4.22.10.2.
\- UE or network requested MA PDU Session Release (home-routed roaming) in
clause 4.22.10.3.
\- UE or network requested MA PDU Session Modification (non-roaming and
roaming with local breakout) in clause 4.22.8.2.
\- UE or network requested MA PDU Session Modification (home-routed roaming)
in clause 4.22.8.3.
\- When the MA PDU Session is released over 3GPP access, the UE and the SMF
locally release the EBI(s) for the MA PDU Session. The SMF notifies the AMF of
the released EBI(s) by sending Nsmf_PDUSession_SMContextStatusNotify service
operation if the MA PDU Session is established in the same PLMN. If the MA PDU
Session is established in different PLMNs, the SMF notifies the release of the
MA PDU Session and as a result, the AMF removes associated EBI(s).
##### 4.22.6.2.5 5GS to EPS mobility without N26 interface
Based on the signalling flow in Figure 4.11.2.2-1, the procedure is performed
with the following differences and modifications:
\- In step 10 (and step 13 in clause 4.11.2.4.1), if the MA PDU Session is
established in both 3GPP and non-3GPP accesses and the MA PDU Session is moved
to EPS and if the UE and the network does not support MA PDU Session with 3GPP
access connected to EPC, the PGW-C + SMF triggers the MA PDU Session Release
procedure over non-3GPP access. PGW-C + SMF and UE locally release the context
related to ATSSS operation, e.g. ATSSS rules and Measurement Assistance
Information for the relevant session. If the UE and the network support MA PDU
Session with 3GPP access connected to EPC, the UE includes a \"MA PDU
Request\" indication and the PDU Session ID in the PCO, the SMF should keep
the user-plane resources over non-3GPP access in 5GC and use the PDN
Connection as the 3GPP access leg of the MA PDU Session.
\- In step 13, during the additional PDN Connectivity Procedure, if the MA PDU
Session is established in both 3GPP and non-3GPP accesses and if the UE and
the network support MA PDU Session with 3GPP access connected to EPC, the UE
includes a \"MA PDU Request\" indication and the PDU Session ID in the PCO,
the SMF should keep the user-plane resources over non-3GPP access in 5GC and
use the PDN Connection as the 3GPP access leg of the MA PDU Session. If the UE
and the network does not support MA PDU Session with 3GPP access connected to
EPC and the MA PDU Session is moved to EPS, the PGW-C + SMF triggers the MA
PDU Session Release procedure over non-3GPP access. PGW-C + SMF and UE locally
release the context related to ATSSS operation, e.g. ATSSS rules and
Measurement Assistance Information for the relevant session(s).
\- Step 14 is also performed for the MA PDU session(s) transferred to EPS.
#### 4.22.6.3 Network Modification to MA PDU Session after a UE moving from
EPC
Figure 4.22.6.3-1 describes procedure for Network Modification to MA PDU
Session after a UE is moving from EPS.
Figure 4.22.6.3-1: Network Modification to MA PDU Session after a UE moving
from EPS
1\. When the network supports interworking with N26 interface, a PDN
Connection can be moved from EPS to 5GS as described in clause 4.11.1.2.2 and
clause 4.11.1.3.3.
2\. If the UE requests MA PDU session, or if no policy in the UE (e.g. no URSP
rule) and no local restrictions mandate a single access for the PDU Session,
the UE requests PDU Session Modification over 3GPP access as described in
clause 4.22.8 with following modifications:
\- In step 1a, the UE provides Request Type as \"MA PDU Request\" in UL NAS
Transport message, or, if no policy in the UE (e.g. no URSP rule) and no local
restrictions mandate a single access for the PDU Session, the UE provides an
\"MA PDU Network-Upgrade Allowed\" indication in UL NAS Transport message. The
UE provides its ATSSS Capabilities, as defined in clause 5.32.2 of TS 23.501
[2] in PDU Session Modification Request message. If the AMF receives the \"MA
PDU Network-Upgrade Allowed\" indication from the UE, the AMF may send it to
the SMF. If the AMF determines that the UE is registered via both accesses in
the same PLMN but the current S-NSSAI is not in the Allowed NSSAI for both
accesses, the AMF shall reject the PDU session modification if the UE provides
an \"MA PDU Request\" indication, or the AMF shall not forward \"MA PDU
Network-Upgrade Allowed\" indication to the SMF if received from the UE.
\- In step 3a, if the SMF decides to change the PDU Session to MA PDU Session,
the SMF includes ATSSS rule(s) in the PDU Session Modification Command
message. The SMF may also include Measurement Assistance Information. When the
SMF sends Nsmf_PDUSession_UpdateSMContext response, the SMF includes \"MA PDU
session Accepted\" indication. The AMF marks the PDU Session as MA PDU Session
based on the indication. If the SMF was informed in step 1a that the UE is
registered over both accesses, then the SMF initiates the establishment of
user-plane resources over non-3GPP access too.
\- In step 5, if the UE receives ATSSS rule(s) in the PDU Session Modification
Command message, the UE stores that the PDU Session is MA PDU Session.
3\. If the UE is registered to the different PLMN over 3GPP and non-3GPP
access or the UE is not registered in non-3GPP access, the UE may trigger the
UE requested PDU Session Establishment procedure as described in clause 4.22.7
over non-3GPP access to add second access to the MA PDU Session after the UE
is registered in non 3GPP access.
### 4.22.7 Adding / Re-activating / De-activating User-Plane Resources
If the UE has established a MA PDU Session but the user-plane resources over
one access of the MA PDU Session have not been established, then:
\- If the UE wants to add user-plane resources over this access, the UE shall
initiate the UE Requested PDU Session Establishment procedure over this
access, as specified in clause 4.3.2.2. In the UL NAS Transport message, the
UE sets Request Type as \"MA PDU Request\" and the same PDU Session ID of the
established MA PDU Session. If only one N9 tunnel is established for the Home
Routed roaming case as described in clause 4.22.2.2, additional N9 tunnel is
established during this UE Requested PDU Session Establishment procedure. For
the roaming with home-routed architecture as defined in TS 23.501 [2] figure
4.2.10-3, an N9 tunnel or an N3 tunnel is established during this PDU Session
Establishment procedure, depending on the access for which the UE is
requesting user-plane resources.
\- The PDU Session Establishment Accept message received by the UE may contain
updated ATSSS rules for the MA PDU session.
\- If the SMF receives the PDU Session Establishment request message over an
access and the SMF already has SM Contexts for the access, the SMF shall not
release existing SM Contexts and shall re-activate user plane resources over
the access while providing the PDU Session Establishment Accept message to the
UE.
If the UE has established a MA PDU Session and the user-plane resources over
one access of the MA PDU Session have been established but are currently
inactive (e.g. because the UE is CM-IDLE over this access), then:
\- If the UE wants to re-activate the user-plane resources over this access,
then the UE shall initiate the Registration or UE Triggered Service Request
procedure over this access, as specified in clause 4.22.9.2.
\- If the network wants to re-activate the user-plane resources over 3GPP
access of the MA PDU Session, or over non-3GPP access of the MA PDU Session,
the network shall initiate the Network Triggered Service Request procedure, as
specified in clause 4.22.9.4.
If the UE has established a MA PDU Session and the user plane resources are
activated over either one access or both accesses, then:
\- If the network wants to de-activate the user-plane resources over single
access, then the network shall initiate the CN-initiated deactivation of UP
connection procedure over this access, as specified in clause 4.3.7.
In all cases, if the UP security protection associated with this PDU session
indicates that UP security is required, the SMF shall not establish resources
over the 3GPP access unless the 3GPP Access Network can enforce the required
UP security protection, even if resources were previously established over
non-3GPP access.
### 4.22.8 UE or network requested MA PDU Session Modification
#### 4.22.8.1 General
This procedure is triggered in the following cases:
\- QoS Flow creation / modification (including GBR QoS Flow movement).
\- Update of ATSSS rules and/or N4 rules.
#### 4.22.8.2 UE or network requested MA PDU Session Modification (non-roaming
and roaming with local breakout)
The signalling flow for a MA PDU Session Modification when the UE is not
roaming, or when the UE is roaming and the PDU Session Anchor (PSA) is located
in the VPLMN, is based on the signalling flow in Figure 4.3.3.2-1 with the
following differences and clarifications:
\- In step 1b, the SMF may decide to update ATSSS rules and/or N4 rules based
on updated PCC rules.
\- In step 1d, if the UPF determines that it cannot send GBR traffic over the
current ongoing access e.g. based on the N4 rules and access availability and
unavailability report from the UE, the UPF shall send Access Availability
report to the SMF. When the SMF receives the Access Availability report, the
SMF may decide to move the GBR QoS Flow to the other access as described in
clause 5.32.4 of TS 23.501 [2]. If the SMF decides to move the GBR QoS Flow,
the SMF triggers this procedure and afterwards moves the GBR QoS Flow to the
target access.
\- In step 3, if the SMF decides to move the GBR QoS Flow to the other access,
the SMF sends N2 SM information to the target AN. The PDU Session Modification
Command message is sent to the UE to update ATSSS rule of the UE so that the
UE sends uplink GBR traffic over the target access. The SMF releases AN
resources of the GBR QoS Flow in the source access.
\- In step 3, when the SMF establishes user plane resources for a QoS flows,
the SMF provides QoS profile to the AN as follows:
\- for Non-GBR QoS Flow, steps 3 to 8 are performed over each access for which
the user plane resources are activated.
\- for GBR QoS Flow allowed in a single access, steps 3 to 8 are performed in
the allowed access.
\- for GBR QoS Flow allowed in both accesses, steps 3 to 8 are performed in
the access according to the decision by the SMF (as described in clause 5.32.4
of TS 23.501 [2]).
\- In step 3, if the SMF wants to update ATSSS rules, the SMF includes updated
ATSSS rules in the N1 SM container (PDU Session Modification Command). When
the SMF provides N1 SM container and/or N2 SM information, the SMF includes
access type in the Namf_Communication_N1N2MessageTransfer to provide routing
information to the AMF.
\- In step 8, if the SMF decides to moves GBR QoS Flow to the other access,
the SMF may send updated N4 rules to the UPF.
#### 4.22.8.3 UE or network requested MA PDU Session Modification (home-routed
roaming)
The signalling flow for a MA PDU Session Modification when the UE is
registered to the same VPLMN over 3GPP access and non-3GPP access and the PDU
Session Anchor (PSA) is located in the HPLMN, is based on the signalling flow
in Figure 4.3.3.3-1 with the following differences and clarifications:
\- In step 1b, the H-SMF may decide to update ATSSS rules and/or N4 rules
based on updated PCC rules.
\- In step 1d, if the H-UPF determines that it cannot send GBR traffic over
the current ongoing access e.g. based on the N4 rules and access availability
and unavailability report from the UE, the H-UPF shall send Access
Availability report to the H-SMF. When the H-SMF receives the Access
Availability report, the H-SMF may decide to move the GBR QoS Flow to the
other access as described in clause 5.32.4 of TS 23.501 [2]. If the H-SMF
decides to move GBR QoS Flow, the H-SMF triggers this procedure and afterwards
moves the GBR QoS flow to the target access.
\- In step 3, if the H-SMF decides to move the GBR QoS Flow to the other
access, the H-SMF sends updated GBR QoS Flow information contains associated
access type and ATSSS rule to the V-SMF. Based on the information the V-SMF
establishes AN resources for the GBR QoS Flow to the target access.
\- In step 3, when the H-SMF provides GBR QoS Flow information, the H-SMF
includes associated access type in Nsmf_PDUSession_Update. When the H-SMF
provides non-GBR QoS Flow information, H-SMF provides the information for both
accesses in Nsmf_PDUSession_Update.
\- In step 3, if the H-SMF wants to update ATSSS rules, the H-SMF triggers
Nsmf_PDUSession_Update and includes an updated ATSSS rules.
\- In step 4, if the H-SMF decides to move the GBR QoS Flow to the other
access, the PDU Session Modification Command message is sent to the UE to
update ATSSS rule of the UE so that the UE sends uplink GBR traffic over the
target access. The V-SMF releases AN resources of the GBR QoS Flow in the
source access.
\- In step 4, when the V-SMF establishes user plane resources for a QoS flows,
the V-SMF provides QoS profile to the AN as follows:
\- for Non-GBR QoS Flow, steps 4 to 9 are performed over each access for which
the MA PDU Session is established.
\- for GBR QoS Flow allowed in a single access, steps 4 to 9 are performed in
the allowed access.
\- for GBR QoS Flow allowed in both accesses, steps 4 to 9 are performed in
the access according to the decision by the SMF (as described in clause 5.32.4
of TS 23.501 [2]).
\- In step 4, if the H-SMF provides updated ATSSS rules, the V-SMF includes
the updated ATSSS rules in the N1 SM container (PDU Session Modification
Command). When the V-SMF provides N1 SM container and/or N2 SM information,
the V-SMF includes access type in the Namf_Communication_N1N2MessageTransfer
to provide routing information to the AMF.
The description of signalling flow for a MA PDU Session Modification when the
UE is registered to different PLMNs over 3GPP access and non-3GPP access and
the PDU Session Anchor (PSA) is located in the HPLMN, is based on above
procedure with the following differences and clarifications:
\- The description of (V-)SMF providing QoS profile to the AN is not
applicable and instead the regular procedures for QoS profile provisioning
from (V-)SMF to (R)AN applies.
### 4.22.9 Connection, Registration and Mobility Management procedures
#### 4.22.9.1 Registration procedures
Support for using the Registration procedures for non-3GPP access path
switching is described in clause 4.22.9.5.
The signalling flow for a Registration is based on the signalling flow in
Figure 4.2.2.2.2-1 with the following differences and clarifications:
\- In step 1, if the UE wants to re-activate the user plane of the MA PDU
Session(s) over the access the Registration message is sent to, the UE
indicates PDU Session ID(s) of the MA PDU Session(s) in the List Of PDU
Sessions To Be Activated.
If the UE locally releases the MA PDU Session(s) in both accesses, the UE
indicates it in the PDU Session Status. If the AMF receives the PDU Session
Status and finds mismatch, regardless of roaming mode of the MA PDU Session(s)
(i.e. non-roaming, local breakout roaming, home routed roaming in the same
PLMN or home routed roaming in different PLMNs), the AMF invokes
Nsmf_PDUSession_ReleaseSMContext service towards the SMF(s) in order to
release any network resources related to the MA PDU Session(s).
\- In step 4, the old AMF determines whether the new AMF support ATSSS or not
based on the supported features provided by the new AMF.
\- In step 5, if the old AMF determined in step 4 that the new AMF does not
support ATSSS, the old AMF does not include the PDU Session context of the MA
PDU Session(s) in the UE context transferred to the new AMF.
\- If the old AMF has not included MA PDU Session(s) in the UE context in step
5, the old AMF informs the corresponding SMF(s) to release the MA PDU
Session(s) by invoking the Nsmf_PDUSession_ReleaseSMContext service operation
as described in clause 4.22.10.
\- In step 21, the AMF provides an MA PDU Session Support indicator in
Registration Accept message to inform the UE whether ATSSS is supported or
not. The UE uses this indicator to determine whether an MA PDU session related
procedure can be initiated or not, as described in clause 4.22.1.
In step 17, if the UE indicated to re-activate MA PDU Session(s) in the List
Of PDU Sessions To Be Activated the AMF includes access type which the
Registration Request message is received on when the AMF triggers
Nsmf_PDUSession_UpdateSMContext service operation. The SMF only re-activates
user plane resources of the access type the Registration Request message is
received on.
\- In step 21, the AMF indicates to the UE whether it supports non-3GPP access
path switching.
\- In step 22, if the AMF indicates that the PDU Session(s) has been released
in the PDU Session Status to the UE in Registration Accept message, the UE
removes locally any internal resources related to the MA PDU Session(s) that
are not marked as established.
#### 4.22.9.2 UE Triggered Service Request
The signalling flow for a UE Triggered Service Request is based on the
signalling flow in Figure 4.2.3.2-1 with the following differences and
clarifications:
\- In step 1, if the UE wants to re-activate the user plane of the MA PDU
Session(s) over the access the Service Request message is sent to, the UE
indicates PDU Session ID(s) of the MA PDU Session(s) in the List Of PDU
Sessions To Be Activated.
If the UE locally releases the MA PDU Session(s), the UE indicates it in the
PDU Session Status. If the AMF receives the PDU Session Status and finds
mismatch, regardless of roaming mode of the MA PDU Session (i.e. non-roaming,
local breakout roaming, home routed roaming in the same PLMN or home routed
roaming in different PLMNs), the AMF invokes Nsmf_PDUSession_ReleaseSMContext
service towards the SMF(s) in order to release any network resources related
to the MA PDU Session(s).
In step 4, if the UE indicated to re-activate MA PDU Session(s) in the List Of
PDU Sessions To Be Activated the AMF includes access type which the Service
Request message is received on when the AMF triggers
Nsmf_PDUSession_UpdateSMContext service operation. The SMF only re-activates
user plane resources of the access type the Service Request message is
received on.
\- In step 12, if the AMF indicates that the PDU Session(s) has been released
in the PDU Session Status to the UE in Service Accept message, the UE removes
locally any internal resources related to the MA PDU Session(s) that are not
marked as established.
NOTE: For an MA PDU session established when UE was registered on only one
access, during the registration on the second access, the AMF does not notify
the SMF (for this MA PDU session) that the UE is now registered on the second
access since this will occur later, i.e. when the UE sends the second PDU
Session Establishment Request to add user plane resources.
#### 4.22.9.3 N2 based handover
Inter NG-RAN node N2 based handover, as described in clauses 4.9.1.3.2 and
4.9.1.3.3, is supported for the 3GPP access with the differences and
clarifications described below.
\- In step 2 of clause 4.9.1.3.2, the S-AMF determines whether or not the
T-AMF supports ATSSS based on the supported features of the T-AMF provided by
NRF or based on local configuration.
\- In step 3 of clause 4.9.1.3.2, if the S-AMF determined in step 2 that the
T-AMF does not support ATSSS, the S-AMF does not include the PDU Session
context of the MA PDU Session(s) in the UE context transferred to the T-AMF.
\- After step 6a of clause 4.9.1.3.3, if the S-AMF has not included MA PDU
Session(s) in the UE context in step 3 of clause 4.9.1.3.2, the S-AMF informs
the corresponding SMF(s) to release the MA PDU Session(s) by invoking the
Nsmf_PDUSession_ReleaseSMContext service operation as described in clause
4.22.10.
#### 4.22.9.4 Network Triggered Service Request
The signalling flow for a Network Triggered Service Request is based on the
signalling flow in Figure 4.2.3.3-1 with the following differences and
clarifications:
\- In step 2a, the SMF determines over which access (3GPP access or non-3GPP
access or both accesses) the user plane resources need to be activated for the
MA PDU Session. The SMF may consider Steering Mode to determine the target
access.
\- In step 3a, the SMF indicates to the AMF the access type (3GPP access or
non-3GPP access) over which the user plane resources are to be activated for
the MA PDU Session.
NOTE 1: If the SMF determines to activate both accesses, the SMF performs this
step two times, i.e. one for 3GPP access and the other one for non-3GPP
access.
In the case of DN-AAA or SMF initiated Secondary re-authentication procedure,
when the SMF invokes the Namf_Communication_N1N2MessageTransfer service
operation, SMF may indicate the target access type of sending N1 NAS message
to the UE.
\- In step 4, the AMF considers the MA PDU Session is associated with the
access type the SMF has indicated in step 3a.
The AMF determines the access type of which to send the N1 NAS message to the
UE based on the target access type value if received from the SMF in step 3a.
If the AMF does not receive a target access type value and the UE is CM-
CONNECTED in both accesses, the AMF determines the target access type.
\- In step 5, if the SMF requested to re-activate user-plane resources over
3GPP access and the AMF has determined the UE is unreachable over 3GPP access
(e.g. the AMF receives no response from the UE to the Paging), the AMF shall
notify that the UE is unreachable. The (H-) SMF shall indicate the Anchor UPF
that the user-plane resources on 3GPP access is unavailable by triggering N4
Session Modification procedure. Further action by the UPF is implementation
dependent.
If the SMF requested to re-activate the user-plane resources over non-3GPP
access and the AMF has determined the UE is unreachable over non-3GPP access
(e.g. the UE is in CM-IDLE on non-3GPP access), the AMF shall reject the
request from the SMF. The (H-) SMF shall indicate the Anchor UPF that the
user-plane resources on non-3GPP access is unavailable by triggering N4
Session Modification procedure. Further action by the UPF is implementation
dependent.
NOTE 2: The provision of access availability/unavailability reports via user
plane specified in clause 5.32.5.3 is UE implementation dependent. Such
reporting by UE to UPF, can assist Anchor UPF to decide on handling DL traffic
for the UE.
#### 4.22.9.5 Registration procedures for non-3GPP access path switching
If the UE supports non-3GPP access path switching and the AMF indicates that
the network supports non-3GPP access path switching as described in clause
4.22.2, the UE may trigger a Mobility Registration Update via a new non-3GPP
access to switch traffic from an old non-3GPP access (i.e. TNGF or N3IWF) to
the new non-3GPP access (i.e. TNGF or N3IWF) if the PLMN of the selected new
non-3GPP access is the same PLMN of the old non-3GPP access.
The UE may trigger non-3GPP path switching if the AMF indicated support during
registration as described in clause 4.22.9.1, even if the SMF did not indicate
support to the UE during the MA PDU Session Establishment.
In this case the Registration procedure described in clause 4.22.9.1 applies
with the differences and clarifications described in this clause:
Figure 4.22.9.5-1: Mobility Registration procedure for non-3GPP access path
switching
1\. This is the same as step 1 in clause 4.22.9.1, with the following
additions:
\- If the UE wants to switch the user plane from an old non-3GPP access to a
new non-3GPP access where the Mobility Registration Update is sent, the UE
indicates PDU Session ID(s) of the PDU Session(s) in the List Of PDU Sessions
To Be Activated. This may include both PDU Session ID(s) corresponding to MA
PDU Sessions and single access PDU Sessions.
NOTE 1: The PDU Sessions that are not indicated in the List Of PDU Sessions To
Be Activated by the UE are not released but deactivated during the switching
procedure. The UE or network can re-activate user plane resources by
triggering Service Request procedure after non-3GPP path switching is
completed.
The UE may also provide an (\"Non-3GPP access path switching while using old
AN resources\") indication in the Registration Request to indicate that the UP
connection(s) via the old non-3GPP access can still be used for the MA PDU
Session(s) during the Registration procedure. If the UP connection(s) via the
old non-3GPP access cannot be used by the UE during the Registration
procedure, the UE shall not provide a \"Non-3GPP access path switching while
using old AN resources\" indication.
The UE shall not perform non-3GPP access path switching if the PLMN of the
selected new non-3GPP access is different from the PLMN of the old non-3GPP
access.
2\. This is the same as step 2 in Figure 4.2.2.2.2-1.
3\. This is the same as step 3 in Figure 4.2.2.2.2-1 with the following
additions:
\- If the UE provided an (\"Non-3GPP access path switching while using old AN
resources\") indication in step 1 and the AMF supports to maintain two N2
connections for non-3GPP access during the Registration procedure and the SMF
supports non-3GPP access path switching, the AMF delays the release of the old
N2 connection until the UP connection via the new non-3GPP access is
established. Otherwise, the AMF may trigger AN release towards the old
non-3GPP access before proceeding with the Registration procedure in the new
non-3GPP access, as described in clause 4.12.4.2 for untrusted non-3GPP access
and clause 4.12a.4.2 for trusted non-3GPP access with the following
clarifications:
\- During the AN release procedure, the AMF should notify the SMF to release
the UP resources for the activated PDU Sessions before sending the N2 UE
Context Release Command to the old non-3GPP access.
\- Due to pending downlink data in the UPF, the SMF may requests to establish
user plane resources before non-3GPP path switching is finished. In this case,
the AMF may reject the request with an indication that the
Namf_Communication_N1N2MessageTransfer has been temporarily rejected. Upon
reception of an Namf_Communication_N1N2MessageTransfer response with an
indication that its request has been temporarily rejected, the SMF shall start
a locally configured guard timer and wait for any message to come from an AMF.
Upon reception of a message from an AMF, the SMF shall re-invoke the
Namf_Communication_N1N2MessageTransfer (with N2 SM info and/or N1 SM info) to
the AMF.
4\. This is the same as steps 4-16 in Figure 4.2.2.2.2-1.
5-11. These steps are the same as step 17 in clause 4.22.9.1, with the
following additions:
\- If the Registration procedure is triggered to switch traffic from the old
non-3GPP access to the new non-3GPP access and the UE provided an (\"Non-3GPP
access path switching while using old AN resources\") indication in step 1,
the AMF, if it supports maintaining two N2 connections for non-3GPP access,
forwards this indication to the SMF in case the PDU Session is a MA PDU
Session. If the SMF receives this indication, the SMF does not trigger release
of the UP connection in the old non-3GPP access towards the old N3IWF or TNGF
(if any).
\- In step 7 and 8, the CN Tunnel Info is sent from SMF to the new non-3GPP AN
via AMF. The IPSec child SA(s) between UE and the new non-3GPP AN are
established.
\- In step 10, the SMF updates the N4 rules by replacing the AN Tunnel Info of
the old non-3GPP AN with the AN Tunnel Info of the new non-3GPP AN to instruct
the UPF to switch traffic from the old non-3GPP access path to the new
non-3GPP access path.
NOTE 2: The resource in the old non-3GPP access, i.e. the old N3IWF or TNGF,
will in this case be released by the AMF in step 12.
\- After the UP connection via the new non-3GPP access is established, the UE
and UPF start to send traffic via the new non-3GPP access.
12\. After the UP connection has been established in new non-3GPP access, the
AMF also triggers AN release towards the old non-3GPP access (i.e. old N3IWF
or TNGF), unless done previously with following clarifications:
\- For the PDU Sessions indicated by the old non-3GPP access in the \"List of
PDU Session ID(s) with active N3 user plane\" but not in the List Of PDU
Sessions To Be Activated sent by the UE in step 1, the AMF requests the SMF to
deactivate the PDU Session(s). For other PDU Sessions, the AMF shall not
request the SMF to deactivate the PDU Session(s).
\- When the UE receives Registration Accept over the new non-3GPP access, the
UE considers that the UE is deregistered from the old non-3GPP access.
NOTE 3: In order to support RAT restrictions for non-3GPP access in the above
procedure, it is assumed that UDM has provided restricted non-3GPP RAT types,
if any, in the RAT restriction parameter in AM subscription data. In order to
ensure that RAT restrictions are not violated in case the PDU Session is
established in LBO roaming scenarios, the AMF in VPLMN may be configured to
not indicate support for non-3GPP access path switching for inbound roaming
UEs during MA PDU Session Establishment towards a SMF in VPLMN, unless it has
been agreed in roaming agreements that non-3GPP access path switching can be
supported for such UEs.
### 4.22.10 MA PDU Session Release
#### 4.22.10.1 General
The MA PDU Session Release procedure is used to release the MA PDU Session, or
release the MA PDU Session over a single access. The MA PDU Session Release
over a single access may be triggered by the network due to e.g. when the UE
is deregistered over an access or when the S-NSSAI of the MA PDU Session is no
longer in the Allowed NSSAI over an access.
#### 4.22.10.2 UE or network requested MA PDU Session Release (non-roaming and
roaming with local breakout)
The signalling flow for a MA PDU Session Release when the UE is not roaming,
or when the UE is roaming and the PDU Session Anchor (PSA) is located in the
VPLMN, is based on the signalling flow in Figure 4.3.4.2-1 with the following
differences and clarifications:
\- In step 1, if the AMF needs to release the MA PDU Session over a single
access, the AMF invokes the Nsmf_PDUSession_UpdateSMContext service operation
to request the release of the MA PDU Session over a single access. In this
case, the AMF includes in which access the MA PDU Session should be released.
NOTE: When the SMF received the release request from the AMF, the SMF decides
whether the MA PDU Session is completely released or released over a single
access based on its local policy.
\- In step 1, if the AMF needs to release the MA PDU Session (e.g. locally
released when the UE is CM-IDLE), the AMF invokes the
Nsmf_PDUSession_ReleaseSMContext service operation to request the release of
the MA PDU Session.
\- In step 2a, if the SMF releases the MA PDU Session over a single access,
the SMF sends an N4 Session Modification Request (N4 Session ID) message
instead of N4 Session Release message to the UPF(s) of the MA PDU session.
\- In step 2b, the UPF acknowledges the N4 Session Modification Request by the
transmission of an N4 Session Modification Response (N4 Session ID) message to
the SMF.
\- In step 3, the SMF sends the PDU Session Release Command message to release
the MA PDU session over a single access (either 3GPP access or non-3GPP
access) or both accesses.
\- In step 3, if the SMF releases the MA PDU Session over a single access, the
SMF shall not include \"skip indicator\" in the
Namf_Communication_N1N2MessageTransfer service.
\- In step 3, if the SMF releases the MA PDU Session over both accesses and
user plane resources are established in both accesses, the SMF includes both
N1 SM container (PDU Session Release Command) and N2 SM Resource Release
request together in the Nsmf_PDUSession_UpdateSMContext or
Namf_Communication_N1N2MessageTransfer service so that the UE does not request
to activate user plane resources. The SMF releases user plane resources of the
other access by including N2 SM Resource Release only in
Namf_Communication_N1N2MessageTransfer service.
\- In step 3, when the SMF provides N1 SM container and/or N2 SM information,
the SMF includes access type in the Namf_Communication_N1N2MessageTransfer to
provide routing information to the AMF.
\- In step 11, the SMF triggers Nsmf_PDUSession_SMContextStatusNotify service
only when the MA PDU Session is released in both accesses.
#### 4.22.10.3 UE or network requested MA PDU Session Release (home-routed
roaming)
The signalling flow for a MA PDU Session Release when the UE is registered to
the same VPLMN over 3GPP access and non-3GPP access and the PDU Session Anchor
(PSA) is located in the HPLMN, is based on the signalling flow in Figure
4.3.4.3-1 with the following differences and clarifications:
\- In step 1, if the V-AMF needs to release the MA PDU Session over a single
access, the V-AMF may invoke the Nsmf_PDUSession_UpdateSMContext service
operation to request the release of the MA PDU Session over a single access.
In this case, the AMF shall include in which access the MA PDU Session should
be released. The V-SMF invokes Nsmf_PDUSession_Update service operation to
request the release of the MA PDU Session over a single access. The V-SMF
shall include in which access the MA PDU Session should be released.
NOTE: When the H-SMF received the release request from the V-SMF, the H-SMF
decides whether the MA PDU Session is released or released over a single
access based on its local policy.
\- In step 1, if the V-AMF needs to release the MA PDU Session (e.g. locally
released when the UE is CM-IDLE), the AMF invokes the
Nsmf_PDUSession_ReleaseSMContext service operation to request the release of
the MA PDU Session. The V-SMF invokes Nsmf_PDUSession_Release service
operation to request the release of the MA PDU Session.
\- In steps 2a-2b, if the SMF releases the MA PDU Session over a single
access, these steps are the same as steps 2a-2b in clause 4.22.10.2.
\- In step 3a, the H-SMF invokes Nsmf_PDUSession_Update service operation
towards the V-SMF to release the MA PDU session over a single access (either
3GPP access or non-3GPP access) or both accesses.
\- In step 5, the V-SMF sends the PDU Session Release Command message to
release the MA PDU session over a single access (either 3GPP access or
non-3GPP access) or both accesses.
\- In step 5, if the V-SMF releases the MA PDU Session over a single Access
Network, the V-SMF shall not include \"skip indicator\" in the
Namf_Communication_N1N2MessageTransfer service.
\- In step 5, if the V-SMF releases the MA PDU Session over both accesses and
user plane resources are established in both accesses, the V-SMF includes both
N1 SM container (PDU Session Release Command) and N2 SM Resource Release
request together in the Nsmf_PDUSession_UpdateSMContext or
Namf_Communication_N1N2MessageTransfer service so that the UE does not request
to activate user plane resources. The V-SMF releases user plane resources of
the other access by including N2 SM Resource Release only in
Namf_Communication_N1N2MessageTransfer service.
\- In step 5, when the V-SMF provides N1 SM container and/or N2 SM
information, the V-SMF includes access type in the
Namf_Communication_N1N2MessageTransfer to provide routing information to the
V-AMF.
\- In step 16, the H-SMF triggers Nsmf_PDUSession_StatusNotify service only
when the MA PDU Session is released in both accesses. The V-SMF triggers
Nsmf_PDUSession_SMContextStatusNotify service only when the MA PDU Session is
released in both accesses.
The signalling flow for a MA PDU Session Release when the UE is registered to
the different PLMNs over 3GPP access and non-3GPP access and the PDU Session
Anchor (PSA) is located in the HPLMN, is based on the above procedure with the
following differences and clarifications:
\- In step 1a, the (V-)AMF can trigger the MA PDU session release over a
single access or over both accesses as described in step 1 of clause
4.22.10.2.
\- In step 3a, the H-SMF invokes Nsmf_PDUSession_Update service operation
towards the V-SMF to release the MA PDU Session over a single access (either
3GPP access or non-3GPP access) or both accesses.
If the UE is registered to the HPLMN via an access and the H-SMF releases MA
PDU Session over the access, the H-SMF invokes
Namf_Communication_N1N2MessageTransfer.
\- In step 5, the V-SMF releases the MA PDU Session over the access the H-SMF
indicated in step 3a.
## 4.23 Support of deployments topologies with specific SMF Service Areas
### 4.23.1 General
This clause captures changes to 5GC procedures in other clauses of this
specification and new procedures to support deployments topologies with
specific SMF Service Areas that are defined in clause 5.34 of TS 23.501 [2].
In the case of roaming for a Home Routed PDU Session the following cases may
occur:
\- A UE moves out of V-SMF serving area in the serving PLMN;
\- A UE moves to another (serving) VPLMN;
\- A UE moves between HPLMN and a VPLMN.
In the above cases, the procedures in clauses 4.23.2-16 for I-SMF apply for
the V-SMF insertion/change/removal by replacing the I-SMF with V-SMF and SMF
with H-SMF. When an AMF detects the need to change the V-SMF while the H-SMF
does not support V-SMF change, the AMF shall not trigger the V-SMF change but
shall trigger the release of the PDU Session.
For an established PDU session an I-SMF is inserted if the UE is not in the
SMF Service Area. In this case, when an UE moves from HPLMN to a VPLMN, a
V-SMF is inserted and the I-SMF is removed. For mobility from VPLMN to HPLMN,
an I-SMF is inserted and the V-SMF is removed. The procedures of this clause
apply in this case, i.e. by replacing the target or new I-SMF by a V-SMF for
mobility from HPLMN to VPLMN and by replacing the source or old I-SMF by a
V-SMF for mobility from VPLMN to HPLMN.
For additional consideration for Home-routed PDU sessions see clause 4.23.17.
If at UE mobility the service area of the SMF does not include the location
where the UE camps and the PDU Session is a MA PDU Session, then the AMF
initiates the release of the MA PDU Session over all accesses served by this
AMF. This applies to following procedures:
\- Registration as defined in clause 4.23.3,
\- Service Request as defined in clause 4.23.4,
\- Xn Hand-over as defined in clause 4.23.11, or
\- N2 Hand-Over as defined in clause 4.23.7.
For an established PDU Session supporting mechanisms for redundant
transmission defined in clause 5.33.2 of TS 23.501 [2], or for a PDU Session
supporting Time Sensitive Communications as defined in clauses 5.27 and 5.28
of TS 23.501 [2], if the UE moves out of SMF Service Area, the SMF may, based
on local policy, release the PDU Session after the mobility procedure. This
applies to following procedures: Registration procedure, Service Request
procedure, Xn based handover procedure, N2 based handover procedure.
If dynamic CN PDB needs to be configured by the SMF and the I-SMF is involved
in the PDU session, the I-SMF receives the Dynamic CN PDB value as part of QoS
profile from SMF (over N16a) and forwards it to (R)AN via N2 SM message.
### 4.23.2 I-SMF selection
For non-roaming or LBO roaming case, the AMF selects an SMF serving the PDU
Session as described in clause 4.3.2.2.3. If the service area of the selected
SMF does not control UPF that can serve the UE location, the AMF selects an
I-SMF as described in clause 5.34.3 of TS 23.501 [2].
After the PDU Session is established, if the selected SMF cannot serve the
target DNAI requested by the PCC rule, the SMF issues
Nsmf_PDUSession_SMContextStatusNotify to provide the target DNAI information
to the AMF. Then AMF selects an I-SMF that serves this target DNAI as
described in clause 5.34.3 of TS 23.501 [2].
For home routed roaming case, the AMF selects V-SMF as described in clause
4.3.2.2.3.2 and reselects V-SMF as described in clause 5.34.3 of TS 23.501
[2].
When the delegated discovery is used, the SCP selects the SMF as described in
clause 5.34.3 of TS 23.501 [2] and in Annex E.
### 4.23.3 Registration procedure
The following impacts are applicable to clause 4.2.2.2 (Registration
procedure) when the UE has established PDU Session(s):
\- Step 5: The UE context transferred from old AMF includes SMF information.
If I-SMF is available for the PDU Session(s), the received SMF information
includes I-SMF information and SMF information.
\- Step 10: The (target) AMF determines whether I-SMF insertion/change/removal
is needed. If the (target) AMF does not have the service area of the SMF(s),
the (target) AMF queries the NRF to get service area information of the
received SMF(s). The (target) AMF determines on a per PDU Session basis
whether a (new) I-SMF needs to be selected based on UE location and service
area of the received SMF information. It includes the following cases:
a. if the received SMF information includes only SMF information and service
area of SMF includes the area where the UE camps, new I-SMF selection is not
needed; or
b. if the received SMF information includes both I-SMF information and SMF
information and service area of I-SMF includes the area where the UE camps,
the I-SMF can be reused; or
c. if the received SMF information includes both I-SMF information and SMF
information and the UE moves into the service area of SMF, the I-SMF removal
process is triggered; or
d. if the received SMF information includes only SMF information and the
service area of SMF does not include the area where the UE camps, the (target)
AMF selects an I-SMF. The I-SMF insertion process is triggered; or
e. if the received SMF information includes both I-SMF and SMF information and
the service area of SMF and I-SMF does not include the area where the UE
camps, the (target) AMF selects a new I-SMF. The change of I-SMF process is
triggered.
\- For each PDU Session, if the UE context retrieved from the old AMF includes
an I-SMF and the (target) AMF determines the I-SMF needs to be changed or
removed, the (target) AMF includes a corresponding indication in
Namf_Communication_RegistrationStatusUpdate sent to old AMF
\- Step 17: the (target) AMF contacts the SMF/I-SMF (\"cases\" below are same
as for step 10).
For case a), no additional change to step 17 of clause 4.2.2.2.2 is needed for
the update of the PDU Session.
For case b), the SMF in step 17 of clause 4.2.2.2.2 is changed to I-SMF and in
addition, the reference clause 4.2.3.2 is changed to clause 4.23.4.2. If the
AMF has changed, the new AMF invokes Nsmf_PDUSession_UpdateSMContext (SM
Context ID at SMF) towards the I-SMF.
For case c) i.e. for I-SMF removal, the (target) AMF invokes
Nsmf_PDUSession_CreateSMContext (SM Context ID at SMF) towards the SMF. Steps
from step 10 onwards as described in clause 4.23.4.3 are executed.
For cases d) and e), i.e. for I-SMF insertion or change, the (target) AMF
invokes Nsmf_PDUSession_CreateSMContext (PDU Session ID, SM Context ID at SMF)
towards the new I-SMF. Steps from step 3 onwards as described in clause
4.23.4.3 are executed with the following enhancements:.
\- Step 9 (for cases d and e): The N2 SM information is only provided by the
I-SMF to the AMF when N3 tunnel needs to be established (i.e. due to buffered
DL data in old I-SMF/old-I-UPF or AMF has indicated to I-SMF to active user
plane for the PDU session based on List of PDU Sessions To Be Activated
received from the UE).
\- Step 16 (i.e. case c): The N2 SM information is only provided by the SMF to
the AMF when N3 tunnel need to be established (i.e. due to buffered DL data in
old I-SMF/old-I-UPF or the AMF has indicated to the SMF to active user plane
for the PDU session based on List of PDU Sessions To Be Activated received
from the UE).
\- Step 17 is executed when N3 tunnel needs to be established. The NAS message
Service Accept is replaced with Registration Accept (i.e. step 21 in clause
4.2.2.2).
\- Step 17a and 17b is triggered by old AMF towards the old I-SMF based on the
I-SMF change or removal indication received from target AMF, when the timer
(i.e. started in step 5 of clause 4.2.2.2) in old AMF expires.
NOTE: Step 17a is executed by old AMF together with steps 14d and 14e in
clause 4.2.2.2.
\- Steps 18 to 21 (i.e. cases d and e) and steps 22 to 25 (i.e. case c): These
steps are executed if N2 SM information is provided by the I-SMF/SMF in step 9
or step 16 above.
\- Step 21: This step is omitted if step 17 of clause 4.23.4.3 is executed as
described above.
### 4.23.3a Deregistration procedure
The following impacts are applicable to clause 4.2.2.3 (Deregistration
procedures) when the UE has established PDU Session(s):
The V-SMF is replaced with I-SMF and the H-SMF is replaced with SMF.
In step 2, if ULCL/BP is included in the data path, the I-SMF releases the
local UPF (PSA) and includes N4 information in the Nsmf_PDUSession_Release
request.
### 4.23.4 Service Request procedures
#### 4.23.4.1 General
The following two scenarios are considered:
\- The I-SMF is available for the PDU Session and I-SMF is not changed or
removed during the service request procedure. The procedure to support this
scenario is described in clause 4.23.4.2.
\- The I-SMF is inserted, changed or removed during service request procedure.
The procedure to support this scenario is described in clause 4.23.4.3.
When the AMF receives the service request message, for each PDU Session to be
activated based on the service area information of SMF and the location where
the UE camped the AMF determines which procedure is used.
#### 4.23.4.2 UE Triggered Service Request without I-SMF change/removal
When both I-SMF and SMF are available for a PDU session and no I-SMF change or
removal is needed during the service request procedure, the procedure in this
clause is used. Compared to the procedure in clause 4.2.3.2, the SMF is
replaced with the I-SMF and the impacted intermediate UPF(s) are UPFs that are
controlled by I-SMF. Difference are captured below:
\- Steps 6a-6b, these steps are not needed as the CN Tunnel Info of UPF (PSA)
allocated for N9 is available at the I-SMF when the I-SMF is inserted.
\- Step 7a, if a new intermediate UPF is selected, the I-SMF invokes
Nsmf_PDUSession_Update Request (DN Tunnel Info of the new intermediate UPF.
The I-SMF may also include UE location Information, Time Zone RAT type, Access
Type and Operation Type set to \"UP Activate\", if those information is
changed and need to be notified to SMF. If DL Tunnel Info of new intermediate
UPF is received, the SMF provides the DL Tunnel Info of new intermediate UPF
received from I-SMF to UPF(PSA).
\- Step 10, this step does not apply as in this scenario the I-UPF is always
needed.
\- Step 16, If the I-SMF needs to update SMF with e.g. change of UE location
information, change of Time Zone, change of RAT type and/or change of Access
type, the I-SMF invokes Nsmf_PDUSession_Update Request to send User Location
Information, Time Zone, RAT type and/or Access Type to SMF. If the I-SMF
invoked Nsmf_PDUSession_Update Request in step 7a with Operation Type \"UP
Activate\", the I-SMF also includes an Operation Type set to \"UP Activated\".
If dynamic PCC is deployed and if Policy Control Request Trigger condition(s)
have been met (e.g. change of Access Type, change of UE location), the SMF
performs SMF initiated SM Policy Modification procedure as defined in clause
4.16.5.1 and may get the updated policy.
\- Steps 18a-18b, these steps do not apply as in this scenario the I-UPF is
always needed.
\- Step 21a, this step does not apply as in this scenario the I-UPF is always
needed.
#### 4.23.4.3 UE Triggered Service Request with I-SMF insertion/change/removal
When, as part of a UE Triggered Service Request, I-SMF is to be inserted,
changed or removed, the procedure in this clause is used. It includes the
following cases:
\- the UE moves from SMF service area to new I-SMF service area, a new I-SMF
is inserted (i.e. I-SMF insertion); or
\- the UE moves from old I-SMF service area to new I-SMF service area, the
I-SMF is changed (i.e. I-SMF change); or
\- the UE moves from old I-SMF service area to SMF service area, the old I-SMF
is removed (i.e. I-SMF removal).
If the service request is triggered by network due to downlink data and a new
I-UPF is selected, forwarding tunnel is established between the old I-UPF(if
the old I-UPF is different from PSA) and the new I-UPF to forward buffered
data.
For Home Routed Roaming case, the I-SMF (old and new) and I-UPF (old and new)
are located in Visited PLMN, while the SMF and UPF(PSA) are located in the
Home PLMN. In this HR roaming case only the case of I-SMF change applies
(there is always a V-SMF for the PDU Session).
Figure 4.23.4.3-1: UE Triggered Service Request procedure with I-SMF
insertion/change/removal
1\. Same as the steps 1-3 defined clause 4.2.3.2.
2\. The AMF determines whether new I-SMF needs to be selected based on UE
location and service area of the SMF, if new I-SMF needs to be selected, the
AMF selects a new I-SMF as described in clause 4.23.2.
Case: I-SMF insertion or I-SMF change, steps 3-9 are skipped for I-SMF removal
case.
3\. If the AMF has selected a new I-SMF, the AMF sends a
Nsmf_PDUSession_CreateSMContext Request (PDU Session ID, SM Context ID, UE
location info, Access Type, RAT Type, Operation Type) to the new I-SMF. The SM
Context ID points to the old I-SMF in the case of I-SMF change or to SMF in
the case of I-SMF insertion.
The AMF Set the Operation Type to \"UP activate\" to indicate establishment of
N3 tunnel User Plane resources for the PDU Session(s). The AMF determines
Access Type and RAT Type based on the Global RAN Node ID associated with the
N2 interface.
If the UE Time Zone has changed compared to the last reported UE Time Zone
then the AMF shall include the UE Time Zone IE in this message.
4a. The new I-SMF retrieves SM Context from the old I-SMF (in the case of
I-SMF change) or SMF (in the case of I-SMF insertion) by invoking
Nsmf_PDUSession_Context Request (SM context type, SM Context ID). The new
I-SMF uses SM Context ID received from AMF for this service operation. SM
Context ID is used by the recipient of Nsmf_PDUSession_Context Request in
order to determine the targeted PDU Session. SM context type indicates that
the requested information is all SM context, i.e. PDN Connection Context and
5G SM context.
4b. The old I-SMF in the case of I-SMF change or SMF in the case of I-SMF
insertion responds with the SM context of the indicated PDU Session.
If there is Extended Buffering is applied and the Extended Buffering timer is
still running in old-SMF or old I-UPF, or the service request is triggered by
downlink data, the old I-SMF or SMF includes a forwarding indication in the
response to indicate that a forwarding tunnel is needed for sending buffered
downlink packets. For I-SMF insertion, if I-UPF controlled by SMF was
available for the PDU Session, the SMF includes a forwarding indication.
5\. The new I-SMF selects a new I-UPF: Based on the received SM context, e.g.
S-NSSAI and UE location information, the new I-SMF selects a new I-UPF as
described in clause 6.3.3 of TS 23.501 [2].
6\. The new I-SMF initiates a N4 Session Establishment to the new I-UPF. The
new I-UPF provide tunnel endpoints to the new I-SMF.
If forwarding indication was received, the new I-SMF also requests the new
I-UPF to allocate tunnel endpoints to receive the buffered DL data from the
old I-UPF and to indicate end marker reception on this tunnel via usage
reporting. In this case, the new I-UPF begins to buffer the downlink packet(s)
received from the UPF (PSA).
7a. If the tunnel endpoints for the buffered DL data were allocated, the new
I-SMF invokes Nsmf_PDUSession_UpdateSMContext Request (tunnel endpoints for
buffered DL data) to the old I-SMF in the case of I-SMF change in order to
establish the forwarding tunnel. The new I-SMF uses the SM Context ID received
from AMF for this service operation.
7b. The old I-SMF, in the case of I-SMF change initiates a N4 session
modification to the old I-UPF to send the tunnel endpoints for buffered DL
data to the old I-UPF. After this step, the old I-UPF starts to send buffered
DL data to the new I-UPF.
If the old I-UPF receives end marker packets and there is no associated tunnel
to forward these packets, the old I-UPF discards the received end marker
packets and does not send any Data Notification to SMF.
7c. The old I-SMF, in the case of I-SMF change responds the new I-SMF with
Nsmf_PDUSession_UpdateSMContext response.
8a. In the case of I-SMF change, the new I-SMF invokes Nsmf_PDUSession_Update
Request (SM Context ID, new I-UPF DL tunnel information, SM Context ID at
I-SMF, Access Type, RAT Type, DNAI list supported by the new I-SMF, Operation
Type) towards the SMF. The new I-SMF uses the SM Context ID at SMF received
from old I-SMF for this service operation.
In the case of I-SMF insertion, the new I-SMF invokes Nsmf_PDUSession_Create
Request (new I-UPF DL tunnel information, new I-UPF tunnel endpoint for
buffered DL data, SM Context ID at I-SMF, Access Type, RAT type, DNAI list
supported by the new I-SMF, Operation Type) towards the SMF.
The SM Context ID at I-SMF is to be used by the SMF for further PDU Session
operation, e.g. to notify the new I-SMF of PDU Session Release. If SM Context
ID at the I-SMF exists (i.e. in the case of I-SMF change), the SMF shall
replace the SM Context ID at I-SMF.
The new I-UPF tunnel endpoint for buffered DL data is used to establish the
forwarding tunnel (from old I-UPF controlled by SMF to new I-UPF controlled by
new I-SMF).
If the old I-UPF receives end marker packets and there is no associated tunnel
to forward these packets, the old I-UPF discards the received end marker
packets and does not send any Data Notification to SMF.
The Operation Type is set to \"UP activate\" to indicate that User Plane
resource for the PDU Session is to be established.
8b. The SMF initiates N4 Session Modification toward the PDU Session Anchor
UPF. During this step:
\- The SMF provides the new I-UPF DL tunnel information.
\- If different CN Tunnel Info need be used by PSA UPF, i.e. the CN Tunnel
Info at the PSA for N3 and N9 are different, a CN Tunnel Info for the PDU
Session Anchor UPF is allocated.
\- For I-SMF insertion, if a new I-UPF tunnel endpoint for buffered DL data is
received, the SMF triggers the transfer of buffered DL data to the new I-UPF
tunnel endpoint for buffered DL data.
If the DL tunnel information has changed, the SMF indicates the UPF (PSA) to
send one or more \"end marker\" packets for each N9 tunnel to the old I-UPF
immediately after switching the path to new I-UPF. From now on the PDU Session
Anchor UPF begins to send the DL data to the new I-UPF as indicated in the new
I-UPF DL tunnel information. The UPF (PSA) sends one or more \"end marker\"
packets for each N9 tunnel to the old I-UPF immediately after switching the
path to new I-UPF. If indicated by the new I-SMF in step 6, the new I-UPF
reports to SMF when \"end marker\" has been received. The new SMF initiates N4
Session Modification procedure to indicate the new I-UPF to send the DL
packet(s) received from the UPF (PSA).
8c. The SMF responds to the new I-SMF with Nsmf_PDUSession_Update Response
(the DNAI(s) of interest for this PDU Session in the case of I-SMF change) or
Nsmf_PDUSession_Create Response (the DNAI(s) of interest for this PDU Session,
Tunnel Info at UPF(PSA) for UL data in the case of I-SMF insertion if it is
allocated in step 8b).
In the case of I-SMF insertion and the PDU session corresponds to a LADN, the
SMF shall release the PDU session after the service request procedure is
completed.
In the case of I-SMF insertion the SMF starts a timer to release resource,
i.e. resource for the indirect data forwarding tunnel.
In the case of I-SMF insertion and the CN Tunnel Info at PSA for N9 is
received in the response, I-SMF provides the CN Tunnel Info at the PSA for N9
to I-UPF via N4 Session Modification Request.
9\. The new I-SMF sends a Nsmf_PDUSession_CreateSMContext Response (N2 SM
information (PDU Session ID, QFI(s), QoS profile(s), CN N3 Tunnel Info,
S-NSSAI, User Plane Security Enforcement, UE Integrity Protection Maximum Data
Rate), N1 SM Container, Cause)) to the AMF. The CN N3 Tunnel Info is the UL
Tunnel Info of the new I-UPF.
If the PDU Session has been assigned any EPS bearer ID, the new I-SMF also
includes the mapping between EPS bearer ID(s) and QFI(s) into the N2 SM
information to be sent to the NG-RAN.
The new I-SMF starts a timer to release resource, i.e. resource for the
indirect data forwarding tunnel.
Case: I-SMF removal: steps 10 to 16 are skipped for I-SMF insertion or I-SMF
change cases.
10\. If the UE has moved from service area of old I-SMF into the service area
of SMF, the AMF sends a Nsmf_PDUSession_CreateSMContext Request (SUPI, PDU
Session ID, AMF ID, SM Context ID at I-SMF, UE location info, Access Type, RAT
Type) to the SMF.
If the UE Time Zone has changed compared to the last reported UE Time Zone
then the AMF shall include the UE Time Zone IE in this message.
The AMF Set the Operation Type to \"UP activate\" to indicate establishment of
User Plane resources for the PDU Session(s). The AMF determines Access Type
and RAT Type based, as defined in clause 4.2.3.2.
11a. The SMF retrieves SM Context from the I-SMF by invoking
Nsmf_PDUSession_Context Request (SM context type). The SMF uses SM Context ID
received from AMF for this service operation. SM context type indicates that
the requested SM context is all, i.e. PDN Connection Context and 5G SM
context.
11b. The old I-SMF responds with the SM context of the indicated PDU Session.
If there is Extended Buffering is applied and the Extended Buffering timer is
still running in old-SMF or old I-UPF, or the service request is triggered by
downlink data (i.e. the old I-SMF received downlink data notification from old
I-UPF), the old I-SMF includes a forwarding indication in the response to
indicate that a forwarding tunnel is needed for sending buffered downlink
packets from old I-UPF to new I-UPF or PSA (in the case that new I-UPF is not
selected).
12\. The SMF may select a new I-UPF: If the SMF determines that the service
area of the PSA does not cover the UE location, the SMF selects a new I-UPF
based on S-NSSAI and UE location information as described in clause 6.3.3 of
TS 23.501 [2].
13\. If a new I-UPF is selected by SMF, the SMF initiates a N4 Session
Establishment to the new I-UPF. The new I-UPF provides tunnel endpoints to the
SMF. If forwarding indication was received, the SMF requests the new I-UPF to
allocate tunnel endpoints for forwarding data and to indicate end marker
reception on this tunnel. In this case, the new I-UPF begins to buffer the
downlink packet(s) received from the UPF (PSA).
If the new I-UPF is not selected, i.e. the PSA can serve the UE location, the
SMF may initiate N4 Session Modification to the PSA to allocate UL N3 tunnel
endpoints Info of PSA. The PSA provides the UL N3 tunnel endpoints to SMF. If
the forwarding indication was received, the SMF requests the PSA to allocate
the tunnel endpoints for the buffered DL data from the old I-UPF and indicate
the PSA via usage reporting rule to report end marker to the SMF. In this
case, the UPF (PSA) begins to buffer the DL data it may receive at the same
time from the N6 interface. The UPF (PSA) sends one or more \"end marker\"
packets according to the indication from SMF for each N9 tunnel to the old
I-UPF immediately after switching the path to (R)AN. If indicated by the SMF,
the UPF (PSA) reports to SMF when \"end marker\" packet is received. Then the
SMF initiates N4 Session Modification procedure to indicate the UPF (PSA) to
send the DL data received from the N6 interface.
14a. If the tunnel endpoints for the buffered DL data were allocated, the SMF
invokes Nsmf_PDUSession_UpdateSMContext Request (tunnel endpoints for buffered
DL data) to the old I-SMF in order to establish the forwarding tunnel. The SMF
uses the SM Context ID received from AMF for this service operation.
14b. The old I-SMF initiates a N4 session modification to the old I-UPF and
sends the tunnel endpoints for buffered DL data to the old I-UPF. After this
step, the old I-UPF start to send buffered DL data to the new I-UPF or PSA if
new I-UPF is not selected.
If the old I-UPF receives end marker packets and there is no associated tunnel
to forward these packets, the old I-UPF discards the received end marker
packets and does not send any Data Notification to SMF.
14c. The old I-SMF responds the SMF with Nsmf_PDUSession_UpdateSMContext
response.
15\. If a new I-UPF was selected by SMF, the SMF initiates N4 Session
Modification toward the PDU Session Anchor UPF, providing the new I-UPF DL
tunnel information. The PSA begins to send the DL data to the new I-UPF as
indicated in the new I-UPF DL tunnel information. If the forwarding indication
was received, the SMF indicates the PDU Session Anchor UPF to send one or more
\"end marker\" packets. The UPF (PSA) sends one or more \"end marker\" packets
according to the indication from SMF for each N9 tunnel to the old I-UPF
immediately after switching the path to new I-UPF. If indicated by the SMF in
step 13, the new I-UPF reports to SMF when \"end marker\" packet is received.
The SMF initiates N4 Session Modification procedure to indicate the new I-UPF
to send the DL packet(s) received from the UPF (PSA).
16\. The SMF sends a Nsmf_PDUSession_CreateSMContext Response (N2 SM
information (PDU Session ID, QFI(s), QoS profile(s), CN N3 Tunnel Info,
S-NSSAI), N1 SM Container, Cause)) to the AMF. The CN N3 Tunnel Info is the UL
Tunnel Info of the new I-UPF.
If the PDU Session has been assigned any EPS bearer ID, the SMF also includes
the mapping between EPS bearer ID(s) and QFI(s) into the N2 SM information to
be sent to the NG-RAN.
The SMF starts a timer to release the resource, i.e. resource for indirect
data forwarding tunnel.
17\. These steps are same as steps 12 to 14 in clause 4.2.3.2. After step 16,
the Uplink data is transferred from (R)AN via new I-UPF (if exists) to PSA. If
procedure in clause 4.2.3 is triggered together with this procedure, this step
can be executed together with the corresponding steps in clause 4.2.3.
17a. If the step 9 or step 16 was successful response, in the case of I-SMF
removal or change, the AMF sends Nsmf_PDUSession_ReleaseSMContext Request
(I-SMF only indication) to old I-SMF for the release of resources in old
I-SMF. The I-SMF only indication indicates to old I-SMF not to invoke resource
release in SMF.
The old I-SMF starts a timer to release resources, i.e. resource for indirect
data forwarding tunnel.
17b. The old I-SMF responds to AMF with Nsmf_PDUSession_ReleaseSMContext
response.
Case: I-SMF insertion or I-SMF change: steps 18 to 21 are skipped for the
I-SMF removal case.
18\. The AMF sends an Nsmf_PDUSession_UpdateSMContext Request (N2 SM
information, RAT type, Access type) to the new I-SMF.
If the AMF received N2 SM information (one or multiple) in step 17, then the
AMF shall forward the N2 SM information to the relevant new I-SMF per PDU
Session ID.
19\. The new I-SMF updates the new I-UPF with the AN Tunnel Info and List of
accepted QFI(s). Downlink data is now forwarded from new I-UPF to UE.
20a. The new I-SMF invokes Nsmf_PDUSession_Update request (RAT type, Access
type, Operation Type) to SMF. The SMF updates associated access of the PDU
Session.
The Operation Type is set to \"UP activated\" to indicate User Plane resource
for the PDU Session has been established.
20b. If dynamic PCC is deployed, SMF may initiate notification about new
location information to the PCF (if subscribed) by performing an SMF initiated
SM Policy Modification procedure as defined in clause 4.16.5.1. The PCF may
provide updated policies. If the PCC rule(s) are updated, the SMF may initiate
a N4 Session Modification procedure to UPF (PSA) based on the updated PCC
rule(s).
20c. The SMF responds with Nsmf_PDUSession_Update Response.
21\. The new I-SMF sends a Nsmf_PDUSession_UpdateSMContext Response to AMF.
Case: I-SMF removal: steps 22 to 25 are skipped for the I-SMF insertion or
I-SMF change cases.
22\. The AMF sends a Nsmf_PDUSession_UpdateSMContext Request (N2 SM
information, RAT Type, Access Type) to the SMF. The AMF determines Access Type
and RAT Type based on the Global RAN Node ID associated with the N2 interface.
If the AMF received N2 SM information (one or multiple) in step 17, then the
AMF shall forward the N2 SM information to the relevant new I-SMF per PDU
Session ID.
23\. If dynamic PCC is deployed, SMF may initiate notification about new
location information to the PCF by performing an SMF initiated SM Policy
Modification procedure as defined in clause 4.16.5.1. The PCF may provide
updated policies.
24\. If a new I-UPF was selected by the SMF, the SMF updates the new I-UPF
with the AN Tunnel Info and List of accepted QFI(s), otherwise, the SMF
updates the PSA with the AN Tunnel Info and List of accepted QFI(s).
25\. The SMF sends a Nsmf_PDUSession_UpdateSMContext Response to AMF.
26a. In the case of I-SMF insertion or I-SMF change, upon timer set in step 9
expires and the indirect data forwarding tunnel was established before, the
new I-SMF sends N4 Session Modification request to new I-UPF to release
resources for the forwarding tunnel.
In the case of I-SMF removal, upon timer set in step 16 expires and the
indirect data forwarding tunnel was established before, the SMF sends N4
Session Modification request to the new I-UPF or PSA to release the resource
for the forwarding tunnel.
26b. In the case of I-SMF removal or change, upon timer set in step 17a
expires and the indirect data forwarding tunnel was established before, the
old I-SMF sends N4 Session Release request to the old I-UPF to release
resources for the PDU Session. The old I-SMF releases the SM Context for the
PDU Session. If the old I-UPF acts as UL CL and is not co-located with local
PSA, the old I-SMF also sends N4 Session Release request to the local PSA to
release resources for the PDU Session.
In the case of I-SMF insertion, upon timer set in step 8c expires and the
indirect data forwarding tunnel was established before, the SMF sends N4
Session Release request to the old I-UPF to release the resource for the PDU
Session.
#### 4.23.4.4 Network Triggered Service Request
For network triggered service request procedure, if the procedure is triggered
by downlink packet, the procedure in clause 4.2.3.3 are impacted as following:
\- if the I-SMF is available for the PDU Session, the procedure is triggered
by I-SMF. Correspondingly, the SMF in that procedure is replaced by the I-SMF.
\- The referenced clause 4.4.4 for pause of charging is changed to clause
4.23.14.
\- Step 4a:
\- If I-SMF is not available for the PDU Session and no I-SMF insertion is
needed, no additional change is needed.
\- If I-SMF is available for the PDU Session and no I-SMF change or removal is
needed, steps 12 to 22 in clause 4.23.4.2 is performed where the SMF in that
procedure is replaced by the I-SMF.
\- If I-SMF will be inserted, changed or removed, steps 2 to 25 in clause
4.23.4.3 is performed.
\- Step 6: If the UE is in CM-IDLE state in 3GPP access, upon reception of
paging request for a PDU Session associated to 3GPP access:
\- If I-SMF is not available for the PDU Session and no I-SMF insertion is
needed, no additional change is needed.
\- If I-SMF is available for the PDU Session and no I-SMF change or removal is
needed, UE Triggered Service Request procedure as defined in clause 4.23.4.2
is performed.
\- If I-SMF will be inserted, changed or removed, UE Triggered Service Request
procedure as defined in clause 4.23.4.3 is performed.
### 4.23.5 PDU Session Management procedure
#### 4.23.5.1 PDU Session establishment procedure
For non roaming or LBO roaming, it includes the following cases:
\- If the service area of the selected SMF includes the current UE location,
the UE requested PDU Session Establishment procedure is same as described in
clause 4.3.2.2.1.
\- If the service area of the selected SMF does not include the current UE
location and the UE does not request for a MA PDU Session, the AMF selects an
I-SMF that serves the area where UE camps. The UE requested PDU Session
Establishment procedure for Home-routed Roaming defined in clause 4.3.2.2.2 is
used to establish the PDU Session. Compared to the procedure defined in clause
4.3.2.2.2, the V-SMF and V-UPF are replaced by I-SMF and I-UPF and H-SMF and
H-UPF are replaced by SMF and UPF(PSA) respectively. Also, only the S-NSSAI
with the value defined by the serving PLMN is sent to the SMF. The I-SMF
provides the DNAI list it supports to SMF and the SMF provides the DNAI(s) of
interest for this PDU Session to I-SMF based on the DNAI list information
received from I-SMF as defined in Figure 4.23.9.1-1 step 1.
This may happen e.g. at PDU Session mobility from non-3GPP access to 3GPP
access as defined in clause 4.23.15.
\- If the service area of the selected SMF does not include the current UE
location and the UE requests a MA PDU Session, then the AMF rejects the MA PDU
Session Establishment procedure.
\- When the delegated discovery is used, the SCP selects the SMF as described
in Annex E.
\- If an I-SMF is selected and the PDU Session supports mechanisms for
redundant transmission defined in clause 5.33.2.2 of TS 23.501 [2], the SMF
rejects the PDU Session Establishment Request.
\- If an I-SMF is selected and the PDU Session supports Time Sensitive
Communications (as defined in clauses 5.27 and 5.28 of TS 23.501 [2]), or if
the PDU session supports redundant transmission defined in clauses 5.33.2.1 or
5.33.2.3 of TS 23.501 [2], the SMF may, based on local policy, reject the PDU
Session Establishment Request.
\- If the selected SMF cannot serve the target DNAI requested by the PCC rule,
the SMF issues Nsmf_PDUSession_SMContextStatusNotify to provide the target
DNAI information to the AMF. The procedure of Home-routed Roaming defined in
clause 4.3.2.2.2 is used to establish the PDU Session. Compared to this
procedure, the V-SMF and V-UPF are replaced by I-SMF and I-UPF respectively
and H-SMF and H-UPF are replaced by SMF and UPF(PSA) respectively. The AMF
selects an I-SMF that serves this target DNAI in step 2. Then AMF sends a
Nsmf_PDUSession_CreateSMContext Request to the I-SMF as defined in step 3a and
the target DNAI received from SMF is included in the message.
\- The S-NSSAI registered to UDM by SMF is always the S-NSSAI of HPLMN.
For the Home-Routed roaming case, the UE requested PDU Session Establishment
procedure for Home-routed Roaming in clause 4.3.2.2.2 can be reused with the
following change.
\- If the service area of the selected V-SMF does not include the current UE
location and the UE requests a MA PDU Session, then the AMF rejects the MA PDU
Session Establishment procedure.
#### 4.23.5.2 PDU Session Release procedure
For the non roaming or LBO roaming case, the procedure defined in clause
4.3.4.3 (UE or network requested PDU Session Release for Home-routed Roaming)
is used to release the PDU Session, with the V-SMF and V-UPF are replaced by
I-SMF and I-UPF and H-SMF and H-UPF are replaced by SMF and UPF(PSA)
respectively. Also if the ULCL/BP is included in the data path, in step 1 the
I-SMF releases the local UPF (PSA) and includes N4 information in the
Nsmf_PDUSession_Release or Nsmf_PDUSession_Update Request request
respectively.
For AMF triggers PDU Session Release procedure in Registration procedure (see
step 17 of clause 4.2.2.2.2) and Deregistration procedure (see step 2 of
clause 4.2.2.3.2), if I-SMF is used for the session, the AMF invokes PDU
Session Release operation towards the I-SMF, then I-SMF releases the PDU
Session towards SMF.
#### 4.23.5.3 PDU Session modification procedure
For the non-roaming or LBO roaming case, the procedure defined in clause
4.3.3.3 (UE or network requested PDU Session Modification for Home-routed
Roaming) is used to modify the PDU Session, with the V-SMF and V-UPF are
replaced by I-SMF and I-UPF and H-SMF and H-UPF are replaced by SMF and
UPF(PSA) respectively.
If the QoS Monitoring as defined in clause 5.33.3 of TS 23.501 [2] is
triggered, the following enhancement to clause 4.3.3.3 applies:
\- In step 3, if the SMF determines the need for QoS Monitoring for a QoS flow
according to the information received from the PCF in step 1b, or based on SMF
local policy, SMF includes QoS Monitoring indication and how frequently QoS
Monitoring reporting to be performed, in Nsmf_PDUSession_Update Request
message.
\- In step 3, if, according to the information received from the PCF in step
1b, or based on SMF local policy, the SMF determines the need for GTP-U Path
Monitoring as defined in clause 5.33.3.3 of TS 23.501 [2], the SMF includes
QoS monitoring policy in Nsmf_PDUSession_Update Request message.
\- In step 4b, if in step 3 the I-SMF received QoS Monitoring indication and
may receive how frequently QoS Monitoring reporting to be performed in
Nsmf_PDUSession_Update Request the I-SMF includes the QoS Monitoring
indication and how frequently QoS Monitoring reporting to be performed in N2
SM message sent to the 5G AN.
\- In step 4b, if in step 3 the I-SMF received QoS monitoring policy
indication and may receive how frequently QoS Monitoring reporting to be
performed in Nsmf_PDUSession_Update Request, the I-SMF includes such QoS
monitoring policy also to I-UPF for GTP-U path monitoring.
\- In step 15, the I-SMF sends Nsmf_PDUSession_Update Response to SMF. The SMF
updates N4 session of the UPF PSA as defined for the case where is no I-SMF.
\- If later on the RAN provides over N2 the QoS Monitoring Result with UL
packet delay information comprising the packet delays of RAN and N3 interface,
the I-SMF forwards this information to the SMF in Nsmf_PDUSession_Update
Request message.
\- I-SMF shall forward monitoring report (for QoS monitoring per GTP-U path)
from I-UPF to SMF.
#### 4.23.5.4 SMF triggered I-SMF selection or removal
Figure 4.23.5.4-1: SMF triggered I-SMF selection or removal
1\. The PCF sends to the SMF PCC rule(s) which may include DNAI(s) for the PDU
sessions by invoking Npcf_SMPolicyControl_UpdateNotify service operation.
Based on the received DNAI(s), the SMF may subscribe to UE mobility event
notification from the AMF (e.g. UE moves into or out of Area of Interest
corresponding to the received DNAI(s)).
The SMF may determine the target DNAI(s) which are applicable to the current
UE location and which can be based on common DNAI (if applicable) as described
in TS 23.548 [74]. Then the SMF may decide a target DNAI finally.
NOTE: It is also possible that the SMF determines that there is no any target
DNAI can be used based on PCC rule(s), e.g. when the updated PCC rules removes
previously provided DNAI(s).
2\. The SMF invokes a Nsmf_PDUSession_SMContextStatusNotify service operation
(or Nsmf_PDUSession_StatusNotify) in the following cases:
\- if the SMF (or the associated old I-SMF) cannot serve the target DNAI, or
\- if an I-SMF is used for the PDU Session and the SMF decides that the DNAI
currently served by I-SMF is no longer be used for the PDU Session anymore
hence the existing I-SMF is not needed, or
\- if an I-SMF is used for the PDU Session and the SMF decides that the SMF
itself can serve the target DNAI hence the existing I-SMF is not needed.
The content of the message includes the target DNAI information. The target
DNAI information which indicates that the I-SMF selection or removal is
expected and may include a target DNAI. This is to trigger the AMF to
(re)select a suitable I-SMF, or remove the existing I-SMF (if the AMF decides
that the SMF can serve the Target DNAI, or the AMF receive a target DNAI
information without including target DNAI) for the PDU Session. The target
DNAI is used for selecting (I-)SMF, which controls UPF connecting to that
DNAI.
If there is an I-SMF serving the PDU session, the SMF invokes
Nsmf_PDUSession_StatusNotify and then the I-SMF invokes
Nsmf_PDUSession_SMContextStatusNotify message to send the target DNAI
information for existing PDU session to AMF.
3\. If the I-SMF selection or removal is expected, the AMF selects a new I-SMF
which can serve the target DNAI or remove the existing I-SMF (if the AMF
decides that the SMF can serve the Target DNAI, or if the AMF receiveS a
target DNAI information without including target DNAI) for the existing PDU
Session as described in clause 5.34.3 of TS 23.501 [2].
4\. The AMF sends a Nsmf_PDUSession_CreateSMContext Request to the new I-SMF
as described in step 3 of clause 4.23.4.3, or to the SMF as described in step
10 of clause 4.23.4.3, with the following enhancement:
The AMF includes target DNAI received from SMF in the message. When the UE is
in CONNECTED state the AMF also include indication of no NG-RAN change.
5\. The procedure described in clauses 4.23.4.3 (case: I-SMF insertion or
I-SMF change) starting from step 4 takes place with the following difference:
In step 4a, the (target) new I-SMF sends the indication of no NG-RAN change to
the old I-SMF or SMF as it is received from AMF.
In step 4b, when the old I-SMF or SMF receives indication of no NG-RAN change
it include the additional Downlink Tunnel Info of NG-RAN in the SM context of
the PDU Session.
In step 5, the I-SMF selects the I-UPF based on target DNAI.
In step 6, the target I-SMF should reuse the downlink Tunnel Info of serving
RAN node if received from old I-SMF/SMF as described in clause 4.23.4.3.
In step 9, if the new I-SMF receives the Downlink Tunnel Info of NG-RAN, the
N2 SM information includes PDU Session Resource Modification message.
The procedure described in clause 4.23.4.3 (case: I-SMF removal) starting from
step 11 takes place with the following difference:
In step 11a, the SMF sends an indication of no NG-RAN change to the old I-SMF
as it received from AMF.
In step 11b, when the old I-SMF receives indication of no NG-RAN change it
include the additional Downlink Tunnel Info of NG-RAN in the SM context of the
PDU Session.
In step 12, the SMF selects a new I-UPF based on target DNAI.
In step 16, if the SMF receives the Downlink Tunnel Info of NG-RAN, the N2 SM
information includes PDU Session Resource Modification message.
If the UE is in IDLE state the step 17-21 are skipped. Steps 17a and 17b are
still performed to release the old I-SMF.
6\. [Conditional] In the case that I-SMF insertion or I-SMF change is
performed in step 5, the PSA and UL CL/BP controlled by I-SMF is inserted as
described from steps 2 to 11 in figure 4.23.9.1-1 with the following
difference:
In step 2, the I-SMF selects a new PDU Session Anchor (PSA2) based on the
target DNAI received in step 4.
For the case of I-SMF removal, the PSA and UL CL/BP controlled by SMF is
inserted as described from steps 2 to 8 in Figure 4.3.5.4-1 with the following
difference:
In step 2, the SMF selects a new PDU Session Anchor (PSA2) based on the target
DNAI if received in step 4.
### 4.23.6 I-SMF Related Procedures with PCF
#### 4.23.6.1 General
This clause provides PCC related details for scenarios including an I-SMF.
#### 4.23.6.2 Policy Update Procedures with I-SMF
Figure 4.23.6-1 shows procedures related to provisioning of PCC rules
containing traffic steering information related to an I-SMF.
Figure 4.23.6-1: Policy Update procedure
In cases where step 1a in figure 4.23.6-1 is triggered in response to PCF
receiving AF request, below steps 3 and 4 are applicable, in addition to those
steps as explained in clause 4.3.6.1.
Step 3: SMF provides to I-SMF with DNAI(s) of interest for this PDU Session
for local traffic steering. If PCC rule changes for traffic offloaded via
ULCL/BP due to the AF request, the SMF provides the updated N4 information to
the I-SMF.
Step 4: The procedure described in clauses 4.23.9.1, 4.23.9.2 and 4.23.9.3,
from step 2 is executed.
#### 4.23.6.3 Reporting UP path change to the AF
Figure 4.23.6.3-1 shows procedures related Reporting UP path change to the AF.
Figure 4.23.6.3-1: Reporting UP path change to the AF
1a. I-SMF indicates that UP path change may occur for the PDU Session via
Nsmf_PDUSession_Update Request as described in clause 4.23.9; the SMF responds
to the I-SMF.
2\. If early notification has been requested by a PCC rule on behalf of AF as
described in clause 4.3.6.2, then the SMF notifies the AF accordingly by
invoking Nsmf_EventExposure_Notify service operation as described in clause
4.3.6.3. In this case the SMF may wait for further instructions of the AF.
3\. SMF initiates Nsmf_PDUSession_Update Request with N4 information to
control the local PSA and ULCL/BP as described in clause 4.23.9.
4\. I-SMF enforces the change of DNAI or addition, change, or removal of UPF
as described in clause 4.23.9.
5 I-SMF answers back to the Nsmf_PDUSession_Update from the SMF.
6\. If late notification has been requested by a PCC rule on behalf of AF as
described in clause 4.3.6.2, then the SMF notifies the AF accordingly by
invoking Nsmf_EventExposure_Notify service operation as described in clause
4.3.6.3.
### 4.23.7 Inter NG-RAN node N2 based handover
#### 4.23.7.1 General
The following two scenarios are considered:
\- The I-SMF is available for the PDU Session and I-SMF is not changed or
removed during the inter NG-RAN node N2 based handover procedure. The
procedure to support this scenario is described in clause 4.23.7.2.
\- The I-SMF is inserted, changed or removed during inter NG-RAN node N2 based
handover procedure. The procedure to support this scenario is described in
clause 4.23.7.3.
#### 4.23.7.2 Inter NG-RAN node N2 based handover without I-SMF change/removal
##### 4.23.7.2.1 General
When both I-SMF and SMF are available for a PDU Session and no I-SMF change or
removal is needed during inter NG-RAN node N2 handover procedure, the
procedure defined in clause 4.9.1.3.2, 4.9.1.3.3 are used with the following
differences.
##### 4.23.7.2.2 Preparation phase
Compared to the procedure in clause 4.9.1.3.2, the SMF interacting with the
S-UPF, T-UPF, S-AMF and T-AMF is the I-SMF. The difference is following:
\- Step 3: The N14 context exchanged between S-AMF and T-AMF contains the SM
Context ID at I-SMF, or SM Context ID at SMF if I-SMF is not applicable
before.
\- Step 4: The T-AMF determines whether Target I-SMF needs to be selected
based on UE location and service area of the SMF. In this case no I-SMF change
or removal is needed.
\- Step 5: The I-SMF checks whether I-UPF needs to be reallocated, i.e. select
a T-UPF.
##### 4.23.7.2.3 Execution phase
Compared to the procedure for execution phase in 4.9.1.3.3, the SMF
interacting with the S-UPF, T-UPF, S-AMF and T-AMF is the I-SMF. The
difference is as following:
\- Step 10a: If I-SMF is available for a PDU Session and the existing
intermediate S-UPF is re-allocated, i.e. a new T-UPF is selected, the I-SMF
invokes an Nsmf_PDUSession_Update Request (DL CN Tunnel Info of the T-UPF)
service operation toward the SMF. The SMF sends N4 Session Modification
Request message to PDU Session Anchor UPF, providing DL CN Tunnel Info to the
PDU Session Anchor UPF. The PDU Session Anchor sends one or more \"end
marker\" packets for each N3/N9 tunnel on the old path immediately after
switching the path, the source NG-RAN shall forward the \"end marker\" packets
to the target NG-RAN.
\- Step 10b: The SMF responds with the Nsmf_PDUSession_Update Response service
operation to I-SMF once the PDU Session Anchor UPF is updated with the DL
Tunnel Info of the T-UPF.
##### 4.23.7.2.4 Handover Cancel
The home routed roaming procedure defined in clause 4.9.1.4 is applied, with
V-SMF replaced by I-SMF.
#### 4.23.7.3 Inter NG-RAN node N2 based handover with I-SMF
insertion/change/removal
##### 4.23.7.3.1 General
When I-SMF is inserted or changed or removed during inter NG-RAN node N2
handover, the procedures defined in this clause are used.
To support the EAS session continuity upon UL CL relocation, a N9 forwarding
tunnel to support the EAS session continuity is established and released
between the Source UL CL and Target UL CL as described in clause 4.23.9.4 or
clause 4.23.9.5.
NOTE: This allows the UE to go on exchanging with the source EAS despite the
fact that a new UL CL has been allocated to the PDU Session.
##### 4.23.7.3.2 Preparation phase
Figure 4.23.7.3.2-1: Inter NG-RAN node N2 based handover, preparation phase,
with I-SMF insertion/change/removal
1\. Steps 1-3 in clause 4.9.1.3.2 are performed.
2\. For PDU sessions in the UE context, the Target AMF determines whether a
(new) Target I-SMF needs to be selected based on Target UE location and
service area of the SMF or of the old I-SMF. If Target I-SMF needs to be
selected, the AMF selects a Target I-SMF as described in clause 5.34.3 of TS
23.501 [2]. If the UE moves from the service area of the I-SMF to the service
area of the SMF, the I-SMF will be removed.
The rest of steps are performed for PDU sessions requested to be handed over,
i.e. the PDU Sessions with active UP connections.
Case: I-SMF insertion, or I-SMF change, step 3\~8 are skipped for I-SMF
removal case.
3\. T-AMF to Target I-SMF: Nsmf_PDUSession_CreateSMContext (PDU Session ID,
Target ID, T-AMF ID, SM Context ID).
The SM Context ID points to the source I-SMF in the case of I-SMF change or to
SMF in the case of I-SMF insertion.
Case: I-SMF change, steps 4 are skipped for I-SMF insertion case.
4a. (I-SMF change case) Target I-SMF to Source I-SMF: Target I-SMF retrieves
SM Context from the source I-SMF by invoking Nsmf_PDUSession_Context Request
(SM context type, SM Context ID).
The Target I-SMF uses SM Context ID received from T-AMF for this service
operation. SM context type indicates that the requested information is all SM
context, i.e. PDN Connection Context and 5G SM context. The SM Context ID is
used by the recipient of Nsmf_PDUSession_Context Request in order to determine
the targeted PDU Session.
4b. Source I-SMF to Target I-SMF: Nsmf_PDUSession_Context Response. The source
I-SMF responds with the requested SM context.
Case: I-SMF insertion, steps 5 are skipped for I-SMF change case.
5a. Target I-SMF to SMF: Target I-SMF retrieves SM Context from the SMF by
invoking Nsmf_PDUSession_Context Request (SM context type, SM Context ID).
The Target I-SMF uses SM Context ID received from T-AMF for this service
operation. SM context type indicates that the requested information is all SM
context, i.e. PDN Connection Context and 5G SM context. The SM Context ID is
used by the recipient of Nsmf_PDUSession_Context Request in order to determine
the targeted PDU Session.
5b. Void.
5c. Void.
5d. SMF to Target I-SMF: Nsmf_PDUSession_Context Response.The SMF responds
with the requested SM context.
6\. The Target I-SMF selects a Target I-UPF: Based on the received SM context,
e.g. S-NSSAI and UE location information, the Target I-SMF selects a Target
I-UPF as described in clause 6.3.3 of TS 23.501 [2].
7a. The Target I-SMF to Target I-UPF: N4 Session Establishment Request.
An N4 Session Establishment Request message is sent to the Target I-UPF,
providing Packet detection, enforcement and reporting rules to be installed on
the Target I-UPF. The UL CN Tunnel Info (on N9) of UPF (PSA) for this PDU
Session, which is used to setup N9 tunnel, is also provided to the Target
I-UPF.
7b. Target I-UPF to Target I-SMF or SMF: N4 Session Establishment Response.
The Target I-UPF sends an N4 Session Establishment Response message to the
Target I-SMF with DL CN Tunnel Info (i.e. N9 tunnel info) and UL CN Tunnel
Info (i.e. N3 tunnel info).
Case: I-SMF insertion, step 7c\~7f are skipped for I-SMF change case.
7c. Target I-SMF to SMF: Nsmf_PDUSession_Create Request (PDU Session ID, HO
Preparation Indication).
7d. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
If different CN Tunnel Info need be used by PSA UPF, i.e. the CN Tunnel Info
for N3 and N9 are different, the SMF request CN tunnel information from UPF.
7e. [Conditional] UPF(PSA) to SMF: N4 Session Modification Response.
The UPF (PSA) sends an N4 Session Modification Response message to the SMF
with CN Tunnel Info (on N9).
7f. SMF to Target I-SMF: Nsmf_PDUSession_Create Response (PDU Session ID, CN
Tunnel Info of UPF(PSA) for N9).
The Target I-SMF provides the CN Tunnel Info of UPF(PSA) for N9 to Target
I-UPF via N4 Session Modification.
8\. The Target I-SMF to T-AMF: Nsmf_PDUSession_CreateSMContext Response (PDU
Session ID, N2 SM Information, Reason for non-acceptance).
If N2 handover for the PDU Session is accepted, the Target I-SMF includes in
the Nsmf_PDUSession_CreateSMContext Response the N2 SM Information containing
the N3 UP address and the UL CN Tunnel ID of the UPF and the QoS parameters.
Case: I-SMF removal, step 9\~13 are skipped for I-SMF insertion, or I-SMF
change case.
9\. T-AMF to SMF: Nsmf_PDUSession_CreateSMContext (PDU Session ID, Target ID,
T-AMF ID, SM Context ID). The SM Context ID points to the source I-SMF.
10\. The SMF selects a Target I-UPF if the UE is not in the service area of
the PDU Session Anchor UPF. The SMF selects a Target I-UPF as described in
clause 6.3.3 of TS 23.501 [2].
11a. [Conditional] SMF to UPF(PSA): N4 Session Modification Request.
If the Target I-UPF was not selected (i.e. the service area of PSA covers UE
location) and different CN Tunnel Info (on N3) need to be used by PSA, the SMF
sends N4 Session Modification Request to UPF(PSA).
11b. [Conditional] UPF(PSA) to SMF: N4 Session Modification Response. The PSA
UPF sends UL CN Tunnel Info (i.e. N3 tunnel info) to SMF.
12a: [Conditional] SMF to Target I-UPF: N4 Session Establishment Request.
If a Target I-UPF is selected by SMF in step 10, the SMF sends N4 Session
Establishment Request to Target I-UPF.
An N4 Session Establishment Request message is sent to the Target I-UPF,
providing Packet detection, enforcement and reporting rules to be installed on
the Target I-UPF. The UL CN Tunnel Info (on N9) of UPF (PSA) for this PDU
Session, which is used to setup N9 tunnel, is also provided to the Target
I-UPF.
12b. [Conditional]Target I-UPF to SMF: N4 Session Establishment Response. The
Target I-UPF sends an N4 Session Establishment Response message to the SMF
with DL CN Tunnel Info (i.e. N9 tunnel info) and UL CN Tunnel Info (i.e. N3
tunnel info).
13\. SMF to T-AMF: Nsmf_PDUSession_CreateSMContext Response (PDU Session ID,
N2 SM Information, Reason for non-acceptance).
If N2 handover for the PDU Session is accepted, the Target I-SMF includes in
the Nsmf_PDUSession_CreateSMContext Response the N2 SM Information containing
the N3 UP address and the UL CN Tunnel ID of the UPF and the QoS parameters.
14\. Same as step 8-10 clause 4.9.1.3.2 are performed.
Case: I-SMF insertion, or I-SMF change, step 15\~23 are skipped for I-SMF
removal case.
15\. T-AMF to Target I-SMF: Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID, N2 SM response received from T-RAN).
The Target I-SMF stores the N3 tunnel info of T-RAN from the N2 SM response if
N2 handover is accepted by T-RAN.
16a. [Conditional]Target I-SMF to Target I-UPF: N4 Session modification
request (T-RAN SM N3 forwarding Information list, indication to allocate DL
forwarding tunnel(s) for indirect forwarding).
Indirect forwarding may be performed via a UPF which is different from the
Target I-UPF, in which case the Target I-SMF selects another UPF for indirect
forwarding.
16b. [Conditional]Target I-UPF to Target I-SMF: N4 Session Modification
Response (Target I-UPF N9 forwarding Information list).
The Target I-UPF allocates Tunnel Info and returns an N4 Session Modification
Response message to the Target I-SMF.
The Target I-UPF SM N9 forwarding info list includes Target I-UPF N9 address,
Target I-UPF N9 Tunnel identifiers for forwarding data.
Case: I-SMF change, step 17\~19 are skipped for I-SMF insertion case.
17\. [Conditional]Target I-SMF to Source I-SMF:
Nsmf_PDUSession_UpdateSMContext Request.
Target I-SMF invokes Nsmf_PDUSession_UpdateSMContext Request (Target I-UPF SM
N9 forwarding Information list, Operation type) to the source I-SMF in order
to establish the indirect forwarding tunnel. The Target I-SMF uses the SM
Context ID received from Target AMF for this service operation. The Operation
type indicates the establishment of forwarding tunnel(s) for indirect
forwarding.
18a. [Conditional]The source I-SMF initiates a N4 session modification request
(Target I-UPF SM N9 forwarding Information list, indication to allocate DL
forwarding tunnel(s) for indirect forwarding) to the source I-UPF to establish
indirect forwarding tunnel.
Indirect forwarding may be performed via a UPF which is different from the
Source I-UPF.
18b. [Conditional]The source I-UPF to source I-SMF: N4 Session Modification
Response (source I-UPF SM N3 forwarding Information list).
19\. [Conditional]Source I-SMF to Target I-SMF:
Nsmf_PDUSession_UpdateSMContext response (Source I-UPF SM N3 forwarding
Information list).
Case: I-SMF insertion, step 20\~22 are skipped for I-SMF change case.
20\. [Conditional]Target I-SMF to SMF: Nsmf_PDU Session_UpdateSMContext.
The Target I-SMF invokes Nsmf_PDUSession_UpdateSMContext Request (Target I-UPF
SM N9 forwarding Information list, Operation type) to the SMF in order to
establish the indirect forwarding tunnel. The Target I-SMF uses the SM Context
ID received from Target AMF for this service operation. The Operation type
indicates the establishment of forwarding tunnel(s) for indirect forwarding.
21a. [Conditional]The SMF initiates a N4 session modification request (UPF SM
N9 forwarding Information list, indication to allocate DL forwarding tunnel(s)
for indirect forwarding) to the UPF(PSA) to establish indirect forwarding
tunnel.
Indirect forwarding may be performed via a UPF which is different from the
UPF(PSA).
21b [Conditional] The UPF(PSA) to SMF: N4 Session Modification Response (UPF
SM N3 forwarding Information list).
22\. [Conditional] The SMF to Target I-SMF: Nsmf_PDUSession_UpdateSMContext
response (UPF SM N3 forwarding Information list).
23\. Target I-SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response (N2 SM
Information).
Target I-SMF creates an N2 SM information containing the DL forwarding Tunnel
Info to be sent to the S-RAN by Source AMF via the Target AMF. Target I-SMF
includes this information in the Nsmf_PDUSession_UpdateSMContext response. The
DL forwarding Tunnel Info can be one of the following information:
\- If direct forwarding applies, then Target I-SMF includes the T-RAN N3
forwarding information received in step 15.
\- If the indirect forwarding tunnel is setup, then the SMF includes Source
I-UPF forwarding information containing the N3 UP address and the Tunnel ID of
the Source I-UPF.
Case: I-SMF removal, step 24\~30 are skipped for I-SMF insertion, or I-SMF
change case.
24\. T-AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (PDU Session ID, N2
SM response received from T-RAN).
The SMF stores the N3 tunnel info of T-RAN from the N2 SM response if N2
handover is accepted by T-RAN.
25a. [Conditional] SMF to UPF (PSA): N4 Session modification Request.
If the Target I-UPF is not selected (i.e. the service area of PSA covers UE
location), the SMF sends N4 Session modification request to UPF(PSA) to
allocate DL forwarding tunnel(s).
Indirect forwarding may be performed via a UPF which is different from the
UPF(PSA), in which case the SMF selects another UPF for indirect forwarding.
25b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response (UPF N9
forwarding Information list).
26a. [Conditional] SMF to Target I-UPF:
If the Target I-UPF is selected, the SMF sends N4 Session modification request
to Target I-UPF to allocate DL forwarding tunnel(s) for indirect forwarding;
Indirect forwarding may be performed via a UPF which is different from the
Target I-UPF, in which case the SMF selects another UPF for indirect
forwarding.
26b. [Conditional] Target I-UPF to SMF: N4 Session Modification Response
(Target I-UPF N9 forwarding Information list).
27\. [Conditional] SMF to Source I-SMF: Nsmf_PDUSession_UpdateSMContext.
The SMF invokes Nsmf_PDUSession_UpdateSMContext Request (SM N9 forwarding
Information list, Operation type) to the source I-SMF in order to establish
the indirect forwarding tunnel. The SMF uses the SM Context ID received from
T-AMF for this service operation. The Operation type indicates the
establishment of forwarding tunnel(s) for indirect forwarding.
28a. [Conditional] Source I-SMF to Source I-UPF: N4 Session Modification
Request.
The source I-SMF initiates a N4 session modification request (Target I-UPF SM
N9 forwarding Information list, indication to allocate DL forwarding tunnel(s)
for indirect forwarding) to the source I-UPF to establish indirect forwarding
tunnel.
Indirect forwarding may be performed via a UPF which is different from the
Source I-UPF.
28b. [Conditional]The source I-UPF to source I-SMF: N4 Session Modification
Response (source I-UPF SM N3 forwarding Information list).
29\. [Conditional]The source I-SMF to SMF: Nsmf_PDUSession_UpdateSMContext
response (Source I-UPF SM N3 forwarding Information list).
30\. SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response (N2 SM
Information).
The SMF creates an N2 SM information containing the DL forwarding Tunnel Info
to be sent to the S-RAN by the Source AMF via the Target AMF. The DL
forwarding Tunnel Info can be one of the following information:
\- If direct forwarding applies, then the SMF includes the T-RAN N3 forwarding
information the SMF received in step 24.
\- If the indirect forwarding tunnel is setup, then the SMF includes Source
I-UPF forwarding information containing the N3 UP address and the Tunnel ID of
the Source I-UPF.
31\. Same as step 12 in clause 4.9.1.3.2 is performed.
##### 4.23.7.3.3 Execution phase
Figure 4.23.7.3.3-1: Inter NG-RAN node N2 based handover, execution phase,
with I-SMF insertion/change/removal
1\. Steps 1-6 in clause 4.9.1.3.3 are performed with the following change:
Step 6a: For PDU sessions in the UE context, if the I-SMF is either to be
changed, or to be removed, the T-AMF includes an indication in
Namf_Communication_N2InfoNotify to indicate the I-SMF change/removal.
Step 6c: The SMF in this step is source I-SMF in the case of I-SMF removal or
change, or is SMF in the case of I-SMF insertion.
Case: I-SMF insertion, or I-SMF change, step 2\~9 are skipped for I-SMF
removal case.
2\. T-AMF to Target I-SMF: Nsmf_PDUSession_UpdateSMContext Request (Handover
Complete indication, (N2 SM Information (Secondary RAT usage data))).
Handover Complete indication is sent per each PDU Session to the corresponding
Target I-SMF to indicate the success of the N2 Handover.
If in step 6b of clause 4.9.1.3.3 the source AMF has provided information for
secondary RAT usage reporting the T-AMF propagates this information to the
Target I-SMF.
Case: I-SMF change, step 3 is skipped for I-SMF insertion.
3a. S-AMF to Source I-SMF: Nsmf_PDUSession_ReleaseSMContext Request (I-SMF
only indication).
After received N2 handover notify from T-AMF, if indication of I-SMF
change/removal has been received, the S-AMF invokes
Nsmf_PDUSession_ReleaseSMContext Request to inform the Source I-SMF to release
the SM context of the PDU Session. The I-SMF only indication is used to inform
the Source I-SMF not to invoke resource release in SMF. The Source I-SMF
initiates a timer to release the SM Context of the PDU Session if indirect
forwarding tunnel(s) were previously established, or if the Source I-SMF has
not received request from Target I-SMF to retrieve SM Context. Otherwise, the
Source I-SMF immediately releases the SM Context.
3b. Source I-SMF to S-AMF: Nsmf_PDUSession_ReleaseSMContext Response.
4a. Void.
4b. Void.
5a. Target I-SMF to Target I-UPF: N4 Session Modification Request. The N4
Modification Request indicates DL AN Tunnel Info of T-RAN to UPF.
5b. The Target I-UPF to Target I-SMF: N4 Session Modification Response.
6\. Target I-SMF to SMF:
In the case of I-SMF change, Nsmf_PDUSession_Update Request (PDU Session ID,
DL CN Tunnel Info of Target I-UPF for N9, DNAI(s) supported by the I-SMF,
Secondary RAT usage data).
In the case of I-SMF insertion, Nsmf_PDUSession_Update Request (PDU Session
ID, DL CN Tunnel Info of Target I-UPF for N9, DNAI(s), Secondary RAT usage
data, Handover Complete Indication). The SMF initiates a timer to release the
resource, i.e. resource for indirect data forwarding tunnel.
If the T-AMF has provided information for secondary RAT usage reporting in
step 2, the Target I-SMF propagates this information to the SMF.
7a. SMF to UPF (PSA): N4 Session Modification Request.
The SMF sends N4 Session Modification Request to UPF PSA, providing the DL CN
Tunnel Info of Target I-UPF to the UPF PSA.
7b. UPF (PSA) to SMF: N4 Session Modification Response.
8\. SMF to Target I-SMF: In the case of I-SMF change, Nsmf_PDUSession_Update
Response. In the case of I-SMF insertion, Nsmf_PDUSession_Create Response. The
SMF provides the DNAI(s) of interest for this PDU Session to Target I-SMF.
In the case of I-SMF insertion and the PDU session corresponds to a LADN, the
SMF shall release the PDU session after the handover procedure is completed.
9\. Target I-SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response.
If indirect data forwarding applies, the Target I-SMF starts an indirect data
forwarding timer, to be used to release the resource of indirect data
forwarding tunnel.
Case: I-SMF removal, step 10\~14 are skipped for I-SMF insertion, or I-SMF
change case.
10\. T-AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (Handover Complete
indication, (N2 SM Information (Secondary RAT usage data))).
Handover Complete indication is sent per each PDU Session to the corresponding
SMF to indicate the success of the N2 Handover.
If in step 6b of clause 4.9.1.3.3 the source AMF has provided information for
secondary RAT usage reporting the T-AMF propagates this information to the
SMF.
11a. S-AMF to Source I-SMF: Nsmf_PDUSession_ReleaseSMContext Request I-SMF
only indication.
After received N2 handover notify from T-AMF, if indication of I-SMF
change/removal has been received, the S-AMF invokes
Nsmf_PDUSession_ReleaseSMContext Request to inform the Source I-SMF to release
the SM context of the PDU Session. I-SMF only indication is used to inform the
Source I-SMF not to invoke resource release in SMF. The Source I-SMF initiates
a timer to release the SM Context of the PDU Session if indirect forwarding
tunnel(s) were previously established, otherwise, the Source I-SMF immediately
releases the SM Context.
11b. Source I-SMF to S-AMF: Nsmf_PDUSession_ReleaseSMContext Response.
12a. [Conditional]SMF to Target I-UPF: N4 Session Modification Request.
If the Target I-UPF is selected by SMF, the SMF to Target I-UPF: N4 Session
Modification Request. The N4 Modification Request indicates DL AN Tunnel Info
of T-RAN to Target I-UPF.
12b. [Conditional] Target I-UPF to SMF: N4 Session Modification Response
13a. SMF to UPF (PSA): N4 Session Modification Request.
The SMF sends N4 Session Modification Request to UPF(PSA). The N4 Modification
Request indicates DL AN Tunnel Info of T-RAN to UPF(PSA) if Target I-UPF is
not selected by SMF. The N4 Modification Request indicates DL CN Tunnel Info
of Target I-UPF if Target I-UPF is selected by SMF.
13b. UPF (PSA) to SMF: N4 Session Modification Response. PDU Session Anchor
sends one or more \"end marker\" packets for each N3/N9 tunnel on the old path
immediately after switching the path, the source NG-RAN shall forward the
\"end marker\" packets to the target NG-RAN.
14\. SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response (PDU Session ID).
If indirect data forwarding applies, the SMF starts an indirect data
forwarding timer, to be used to release the resource of indirect data
forwarding tunnel.
15\. Steps 12, 14 in clause 4.9.1.3.3 are performed.
During the UE mobility registration procedure, if required, the T-AMF performs
I-SMF insertion/change/removal for the PDU session which were not handed over,
i.e. the PDU sessions without active UP connections. This takes place as
described in clause 4.23.3 with the exception that there is no UE context
retrieved from the old AMF and that steps 17a and 17b as described in clause
4.23.4.3 are not applicable.
Case: I-SMF insertion, or I-SMF change, step 16\~18 are skipped for I-SMF
removal case.
16a. [Conditional]Target I-SMF to Target I-UPF: N4 Session Modification
Request.
After indirect data forwarding timer set in step 9 expires, the Target I-SMF
sends an N4 Session Modification Request to Target I-UPF to release the
indirect data forwarding resource in Target I-UPF.
16b. [Conditional]Target I-UPF to SMF: N4 Session Modification Response.
Case: I-SMF change, step 17 is skipped for I-SMF insertion.
17a. Source I-SMF to Source I-UPF: N4 Session Release Request.
Upon the timer set in step 3 expires, the Source I-SMF sends N4 Session
Release Request (Release Cause) to Source I-UPF to release the resources for
the PDU Session. This message is also used to release the indirect data
forwarding resource in Source I-UPF.
If the Source I-UPF acts as UL CL and is not co-located with local PSA, the
Source I-SMF also sends N4 Session Release Request to the local PSA to release
the resources for the PDU Session.
17b. Source I-UPF to Source I-SMF: N4 Session Release Response.
The Source I-SMF releases SM Context of the PDU Session.
Case: I-SMF insertion, step 18 is skipped for I-SMF change.
18a. SMF to UPF: N4 Session Modification Request.
Upon the timer set in step 6 expires, if UPF(PSA) is used for indirect
forwarding, the SMF sends an N4 Session Modification Request to UPF(PSA) to
release the indirect data forwarding resource in UPF(PSA). If the UPF (PSA)
uses different Tunnel Info for N3 and N9, this message is also used to release
the N3 Tunnel. If I-UPF is used for indirect forwarding, the SMF sends an N4
Session Modification Request to the I-UPF to release the indirect data
forwarding resource.
18b. UPF to SMF: N4 Session Modification Response.
If UPF(PSA) is used for indirect forwarding, the UPF (PSA) sends N4 Session
Modification Response to SMF.
If I-UPF is used for indirect forwarding, the I-UPF sends N4 Session
Modification Response to SMF.
Case: I-SMF removal, step 19\~20 are skipped for I-SMF insertion, I-SMF change
case.
19a. The Source I-SMF to Source I-UPF: N4 Session Release Request.
Upon the timer set in step 11 expires, the Source I-SMF sends N4 Session
Release Request (Release Cause) to Source I-UPF to release the resources for
the PDU Session. This message is also used to release the indirect data
forwarding resource in Source I-UPF.
19b. Source I-UPF to Source I-SMF: N4 Session Release Response.
The Source I-SMF releases SM Context of the PDU Session.
20a. SMF to UPF: N4 Session Modification Request.
Upon the timer set in step 14 expires, if UPF(PSA) is used for indirect
forwarding, the SMF sends an N4 Session Modification Request to UPF (PSA) to
release the indirect forwarding resource in UPF (PSA). If the UPF (PSA) uses
different Tunnel Info for N3 and N9, this message is also used to release the
N3 Tunnel. If I-UPF is used for indirect forwarding, the SMF sends an N4
Session Modification Request to the I-UPF to release the indirect data
forwarding resource.
20b. UPF to SMF: N4 Session Modification Response.
If UPF(PSA) is used for indirect forwarding, the UPF (PSA) sends N4 Session
Modification Response to SMF.
If I-UPF is used for indirect forwarding, the I-UPF sends N4 Session
Modification Response to SMF.
##### 4.23.7.3.4 Handover Cancel
Figure 4.23.7.3.4-1: Handover Cancel procedure
1\. Step 1\~3 in clause 4.11.1.2.3 are performed.
Case: I-SMF Change, step 4\~9 are skipped for I-SMF Insertion case and I-SMF
Removal case.
4\. T-AMF to Target I-SMF: Nsmf_PDUSession_UpdateSMContext Request (Relocation
Cancel Indication).
The target AMF invokes Nsmf_PDUSession_UpdateSMContext Request (Relocation
Cancel Indication) to the target I-SMF to release the SM Context and all
resources allocated on the target I-SMF during preparation phase.
5a. Target I-SMF to Target I-UPF: N4 Session Release Request.
The target I-SMF invokes N4 Session Release Request to target I-UPF, to
release all resources allocated for the N4 session.
5b. Target I-UPF to Target I-SMF: N4 Session Release Response.
6\. [Conditional] Target I-SMF to Source I-SMF:
Nsmf_PDUSession_UpdateSMContext Request (Relocation Cancel Indication).
If indirect forwarding tunnel is setup during preparation phase, the target
I-SMF initiates Nsmf_PDUSession_UpdateSMContext Request to the source I-SMF,
indicating the source I-SMF to delete the resources temporarily allocated for
indirect forwarding tunnel.
7a. [Conditional] Source I-SMF to Source I-UPF: N4 Session Modification
Request.
The source I-SMF invokes N4 Session Modification Request to source I-UPF, to
delete all resources allocated for indirect forwarding tunnel.
7b. [Conditional] Source I-UPF to Source I-SMF: N4 Session Modification
Response.
8\. [Conditional] Source I-SMF to Target I-SMF:
Nsmf_PDUSession_UpdateSMContext Response.
9\. Target I-SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response.
Case: I-SMF Insertion, step 10\~18 are skipped for I-SMF Change case and I-SMF
Removal case.
10\. T-AMF to Target I-SMF: Nsmf_PDUSession_UpdateSMContext Request
(Relocation Cancel Indication).
The target AMF invokes Nsmf_PDUSession_UpdateSMContext Request (Relocation
Cancel Indication) to the target I-SMF to release the SM Context and all
resources allocated on the target I-SMF during preparation phase.
11a. Target I-SMF to Target I-UPF: N4 Session Release Request.
The target I-SMF invokes N4 Session Release Request to target I-UPF, to
release all resources allocated for the N4 session.
11b. Target I-UPF to Target I-SMF: N4 Session Release Response.
12\. Target I-SMF to SMF: Nsmf_PDUSession_Update Request (PDU Session ID,
Relocation Cancel Indication).
The target I-SMF invokes Nsmf_PDUSession_Update Request (PDU Session ID,
Relocation Cancel Indication) to the SMF, to release the PDU Session resources
allocated during preparation phase, e.g. CN Tunnel for N9.
13a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
If CN Tunnel for N9 is allocated during preparation phase, i.e. the CN Tunnel
for N3 and N9 are different, the SMF asks UPF (PSA) to release the CN Tunnel
on N9.
13b. [Conditional] UPF(PSA) to SMF: N4 Session Modification Response.
14\. SMF to Target I-SMF: Nsmf_PDUSession_Update Response.
15\. [Conditional] Target I-SMF to SMF: Nsmf_PDUSession_UpdateSMContext
Request (Operation Type).
If indirect forwarding tunnel is setup during preparation phase, the target
I-SMF initiates Nsmf_PDUSession_UpdateSMContext Request (Operation Type) to
the SMF, indicating the SMF to delete the resources temporarily allocated for
indirect forwarding tunnel.
16a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
The SMF invokes N4 Session Modification Request to UPF (PSA), to delete all
resources allocated for indirect forwarding tunnel.
16b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response.
17\. [Conditional] SMF to Target I-SMF: Nsmf_PDUSession_UpdateSMContext
Response.
18\. Target I-SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response.
Case: I-SMF Removal, step 19\~24 are skipped for I-SMF Insertion case and
I-SMF Change case.
19\. T-AMF to SMF: Nsmf_PDUSession_UpdateSMContext Request (Relocation Cancel
Indication).
The target AMF invokes Nsmf_PDUSession_UpdateSMContext Request (Relocation
Cancel Indication) to the SMF to release the SM Context and all resources
allocated on the SMF during preparation phase.
20a. [Conditional] SMF to UPF (PSA): N4 Session Modification Request.
If CN Tunnel for N3 is allocated during preparation phase, i.e. the CN Tunnel
for N3 and N9 are different, the SMF asks UPF (PSA) to release the CN Tunnel
on N3.
20b. [Conditional] UPF (PSA) to SMF: N4 Session Modification Response.
21\. [Conditional] SMF to Source I-SMF: Nsmf_PDUSession_UpdateSMContext
Request (Operation Type).
If indirect forwarding tunnel is setup during preparation phase, the SMF
initiates Nsmf_PDUSession_UpdateSMContext Request (Operation Type) to the
source I-SMF, indicating the source I-SMF to delete the resources temporarily
allocated for indirect forwarding tunnel.
22a. [Conditional] Source I-SMF to Source I-UPF: N4 Session Modification
Request.
The source I-SMF invokes N4 Session Modification Request to source I-UPF, to
delete all resources allocated for indirect forwarding tunnel.
22\. [Conditional] Source I-UPF to SMF: N4 Session Modification Response.
23\. [Conditional] Source I-SMF to SMF: Nsmf_PDUSession_UpdateSMContext
Response.
24\. SMF to T-AMF: Nsmf_PDUSession_UpdateSMContext Response.
### 4.23.8 AN Release procedure involving I-SMF
For the AN release procedure, if the PDU Session involves an I-SMF, the
procedure defined in clause 4.2.6 applies with:
\- The SMF and UPF in the procedure replaced by the I-SMF and I-UPF.
### 4.23.9 Branching Point or UL CL controlled by I-SMF
#### 4.23.9.0 Overview
The procedures in this clause describe the Addition, Removal and Change of PDU
Session Anchor (PSA2), Branching Point or UL CL controlled by I-SMF. They all
rely on following principles:
1\. When a (new) I-SMF is inserted (e.g. as described in clause 4.23.7 or
clause 4.23.11), the I-SMF provides the DNAI list it supports to the SMF. This
list is assumed to remain constant during the N16a association between the
I-SMF and the SMF for a PDU Session.
2\. Based on the DNAI list information received from I-SMF, the SMF may then
at any time provide or update the list of DNAI(s) of interest for this PDU
Session to I-SMF. This may take place e.g. when the I-SMF provides the DNAI
list it supports or when new or updated or removed PCC rule(s) is/are received
by the SMF as defined in clause 4.23.6. This list of DNAI(s) of interest for
this PDU Session indicates to the I-SMF the list of DNAI(s) candidate for
local traffic steering within the PDU Session.
An indication of whether Multi-homing is possible is also provided to the
I-SMF and the I-SMF uses this information to decide whether multi-homing can
be used for the PDU Session.
3\. Whenever the I-SMF has inserted or removed or changed a local offload
capability the I-SMF invokes a Nsmf_PDUSession_Update Request to indicate to
the SMF the list of corresponding DNAI(s). Based on this indication the SMF
invokes a Nsmf_PDUSession_Update Request to send the corresponding N4
information to the I-SMF.
4\. Then SMF may then at any time invoke a Nsmf_PDUSession_Update Request to
send N4 information to the I-SMF.
5\. The I-SMF may at any time send a Nsmf_PDUSession_Update Request to forward
to the SMF N4 events received from a local UPF; this may e.g. correspond to
traffic reporting.
6\. When source I-SMF is to be removed from a PDU Session (e.g. at I-SMF
change or removal), the SMF issues the N4 information targeting the UL CL/BP
(s) and L-PSA(s) controlled by this I-SMF, including requests to release the
corresponding N4 Sessions.
If the N9 forwarding tunnel to support the EAS session continuity controlled
by I-SMF(s) is not established between the source ULCL and the target UL CL,
when the Source I-SMF receives a Nsmf_PDUSession_ReleaseSMContext Request from
AMF, it initiates a data forwarding timer (if indirect data forwarding
applies) before releasing the resources of the PDU Session. When the Source
I-SMF has received N4 release from SMF, it releases the UL CL/BP (s) and
L-PSA(s) resources either directly if no data forwarding timer is started, or
at the expiry of the data forwarding timer. Otherwise if the N9 forwarding
tunnel to support the EAS session continuity controlled by I-SMF(s) is
established between the source UL CL and target UL CL, the source I-SMF
releases the UL CL/BP (s) and L-PSA(s) after no active traffic over the N9
forwarding tunnel.
When IPv6 multi-homing is used and an I-SMF is removed, the SMF re-configure
the UE to not use the original IP prefix \@L-PSA(s).
#### 4.23.9.1 Addition of PDU Session Anchor and Branching Point or UL CL
controlled by I-SMF
This clause describes a procedure to add a PDU Session Anchor and Branching
Point or UL CL controlled by I-SMF.
Figure 4.23.9.1-1: Addition of PDU Session Anchor and Branching Point or UL CL
controlled by I-SMF
1\. UE has an established PDU Session with a UPF including the PDU Session
Anchor 1, which is controlled by SMF.The I-SMF and an I-UPF controlled by
I-SMF have already been inserted for the PDU Session. Events described in item
1 and 2 of clause 4.23.9.0 have taken place.
2\. At some point, using the list of DNAI(s) of interest for this PDU Session
received from the SMF, the I-SMF decides to establish a new PDU Session Anchor
e.g. due to UE mobility. The I-SMF selects a UPF and using N4 establishes the
new PDU Session Anchor 2 (PSA2) of the PDU Session. During this step:
\- (if needed) the PSA2 CN Tunnel Info of the local N9 termination on the PSA2
may be determined,
\- In the case of IPv6 multi-homing applies to the PDU Session, a new IPv6
prefix corresponding to PSA2 is allocated by the I-SMF or by the UPF
supporting the PSA2.
3\. The I-SMF may select a UPF that will be acting as UL CL or Branching Point
and replace the current I-UPF.
If a new UPF that will act as UL CL/Branching Point is selected (i.e. the
existing I-UPF is replaced), the I-SMF uses N4 establishment to provide the 5G
AN Tunnel Info, the PSA1 and (where applicable) PSA2 CN Tunnel Info to the new
UPF.
NOTE 1: If the Branching Point or UL CL and the PSA2 are co-located in a
single UPF then steps 2 and 3 can be merged.
4\. The I-SMF invokes Nsmf_PDUSession_Update Request (Indication of UL CL or
Branching Point insertion, IPv6 prefix \@PSA2, DNAI(s) supported by PSA2, DL
Tunnel Info of the new UL CL/Branching Point, if any) to SMF. Whether the UL
CL/Branching Point and PSA2 are supported by the same UPF is transparent to
the SMF. Multiple local PSAs (i.e. PSA2) may be inserted at one time, each
corresponds to a DNAI and/or an IPv6 prefix in the case of multi-homing.
The I-SMF informs the SMF that a UL CL or Branching Point is inserted, the
I-SMF provides DNAI(s) supported by PSA2 to the SMF. The DL Tunnel Info of UL
CL/Branching Point is provided to SMF if a new UPF is selected to replace
I-UPF in step 3.
In the case of IPv6 multi-homing PDU Session, the IPv6 prefix \@PSA2 is also
provided to SMF.
The SMF performs the Session Management Policy Modification procedure as
defined in clause 4.16.5 to provide the new allocated IPv6 prefix to the PCF.
The SMF may also send a notification to the AF, as described in clause
4.3.6.3.
The DNAI(s) supported by PSA2 may be used by the SMF to determine which PCC
rules are to be applied at UPF(s) controlled by the I-SMF. The SMF
acknowledges the Nsmf_PDUSession_Update from the Iâ€‘SMF
5\. If a new DL Tunnel Info of UL CL/ Branching Point has been provided in
step 4, the SMF updates the PSA1 via N4 with the CN Tunnel Info for the
downlink traffic. Now the downlink packets from PSA1 are sent to UE via the
new UPF which will act as Branching Point/UL CL. The SMF may also update the
forwarding rules in PSA1 if some traffic is to be moved to UPFs controlled by
I-SMF.
6\. The SMF provides I-SMF with N4 information for the PSA and for the UL CL
with a SMF initiated Nsmf_PDUSession_Update Request (set of (N4 information,
involved DNAI), Indication of no DNAI change, Indication of no local PSA
change)). The SMF generates N4 information for local traffic handling based on
PCC rules and CHF requests that will be enforced by UPFs controlled by I-SMF.
The N4 information for local traffic handling corresponds to N4 rules (PDR,
FAR, URR, QER, etc.) related with the support of a DNAI. This is described in
clause 5.34.6 of TS 23.501 [2]. N4 information for local traffic handling may
indicate information (as the 5G AN Tunnel Info) that the SMF does not know and
that the I-SMF needs to determine itself to build actual rules sent to the
UPF(s). If the rule is applied to the local PSA, the N4 information includes
the associated DNAI.
If the \"Indication of application relocation possibility\" or \"UE IP address
preservation indication\" attributes are included in the PCC rule, the SMF
includes the corresponding Indication of no DNAI change and Indication no
local PSA change respectively.
If the CN Tunnel Info at the PSA1 has changed, the SMF may also provide its
new value.
The I-SMF uses N4 information for local traffic handling received from the SMF
as well as 5G AN Tunnel Info received from the 5G AN via the AMF and local
configuration to determine N4 rules to send to the UPF(s) it is controlling.
7\. The I-SMF updates the PSA2 via N4 providing N4 rules determined in step 6.
It also provides the Branching Point or UL CL CN Tunnel Info for down-link
traffic if the PSA2 and the UL CL/Branching Point are supported by different
UPF(s).
8\. The I-SMF updates the Branching Point or UL CL via N4 providing N4 rules
determined in step 6.
NOTE 2: If the Branching Point or UL CL and the PSA2 are co-located in a
single UPF then step 7 and step 8 can be merged.
9\. The I-SMF Issues a Nsmf_PDUSession_Update Response to SMF that may include
N4 information received from the local UPF(s).
10\. Steps 6-8 of clause 4.3.5.4 are performed. In the case of IPv6 multi-
homing PDU Session, the SMF notifies the UE of the IPv6 prefix \@PSA2 and
updates the UE with IPv6 multi-homed routing rule via a PSA controlled by the
SMF.
NOTE 3: Step 6 of clause 4.3.5.4 is skipped if the current I-UPF is selected
to act as Branching Point or UL CL.
11\. If a new UPF is selected to replace I-UPF in step 3, the I-SMF uses N4
Release to remove the I-UPF of the PDU Session. The I-UPF releases resources
for the PDU Session.
#### 4.23.9.2 Removal of PDU Session Anchor and Branching Point or UL CL
controlled by I-SMF
This clause describes a procedure to remove a PDU Session Anchor and Branching
Point or UL CL controlled by I-SMF.
Figure 4. 23.9.2-1: Removal of PDU Session Anchor and Branching Point or UL CL
controlled by I-SMF
1\. UE has an established PDU Session with a UPF including the PDU Session
Anchor 1 (controlled by SMF) and the UL-CL/BP and the PDU Session Anchor 2
(controlled by I-SMF). Events described in item 1 and 2 of clause 4.23.9.0
have taken place.
At some point the I-SMF decides to remove the PDU Session Anchor 2 and UL-
CL/BP function, e.g. due to UE mobility.
2\. The I-SMF may select a new UPF acting as new I-UPF and replace the
existing I-UPF which was acting as UL-CL/BP before.
If a new UPF acting as new I-UPF is selected, the I-SMF uses N4 establishment
to provide the PSA1 CN Tunnel Info and (R)AN Tunnel Info to the new I-UPF.
3\. The I-SMF invokes Nsmf_PDUSession_Update Request (Indication of Removal of
traffic offload, Removal of IPv6 prefix \@PSA2, DNAI associated with the PSA2,
DL Tunnel Info of new I-UPF, if any) to SMF. Multiple local PSAs may be
removed, in this case, the I-SMF provides for each local PSA to be removal,
the associated DNAI and an IPv6 prefix in the case of multi-homing.
The I-SMF informs the SMF that local traffic offload is removed. In the case
of IPv6 multi-homing, the I-SMF also notifies the SMF with the removal of the
IPv6 prefix \@PSA2.
The SMF issues a SM Policy Association Modification (clause 4.16.5)
corresponding to the IP address allocation/release PCRT(Policy Control Request
Trigger). The SMF may also send a notification to the AF, as described in
clause 4.3.6.3.
4\. If a new UPF that replaces existing I-UPF is selected in step 2, the SMF
updates the PSA1 via N4. It provides the CN Tunnel Info of the new I-UPF for
the downlink traffic. The SMF may update the packet handling rules in PSA1 as
now all traffic is to be moved to PSA1.
5\. In the case of IPv6 multi-homing, the SMF notifies the UE to stop using
the IPv6 prefix corresponding to PSA2. Also the SMF sends IPv6 multi-homed
routing rule along with the IPv6 prefix corresponding to PSA1 to the UE. Based
on the information provided in the Router Advertisement, the UE starts using
the IPv6 prefix (corresponding to PSA1) for corresponding traffic.
7\. The SMF provides I-SMF with N4 information for the local UPF(s) with a SMF
initiated Nsmf_PDUSession_Update Request; The N4 information indicates the
removal of the traffic offload rules.
8\. If a new UPF that replaces existing I-UPF is selected in step 2, the I-SMF
releases the old I-UPF. Otherwise the I-SMF updates the existing I-UPF with
new rules in order to remove the UL-CL/BP functionality from that I-UPF.
If a new UPF that replaces existing I-UPF is selected in step 2, the SMF
updates the (R)AN with the new I-UPF CN Tunnel Info.
If the PSA2 is not collocated with UL-CL/BP function, the I-SMF releases it
via N4.
9\. The I-SMF answers to the SMF with a Nsmf_PDUSession_Update Response SMF
that may include N4 information received from the local UPF(s).
#### 4.23.9.3 Change of PDU Session Anchor for IPv6 multi-homing or UL CL
controlled by I-SMF
This clause describes a change of UL-CL/BP function, e.g. addition of a new
PDU Session Anchor (i.e. PSA2) and release of the existing additional PDU
Session Anchor (i.e. PSA0), via modifying IPv6 multi-homing or UL CL rule in
the same Branching Point or UL CL under controlled by the same I-SMF.
Figure 4.23.9.3-1: Change of PDU Session Anchor for Branching Point or UL CL
controlled by I-SMF
1\. The UE has an established PDU Session with a UPF including the PDU Session
Anchor 1(controlled by SMF) and the PDU Session Anchor 0 (PSA0) and an I-UPF
acting as UL CL or BP (controlled by I-SMF). Events described in item 1 and 2
of clause 4.23.9.0 have taken place.
2\. At some point the I-SMF decides to establish a new PDU Session Anchor and
release the existing PDU Session Anchor e.g. due to UE mobility. The I-SMF
selects a UPF and using N4 establishes the new PDU Session Anchor 2 of the PDU
Session.
In the case of IPv6 multi-homing PDU Session, the I-SMF ensures allocation of
a new IPv6 prefix corresponding to PSA2.
3\. The I-SMF invokes Nsmf_PDUSession_Update Request (Indication of Change of
traffic offload, (new allocated IPv6 prefix \@PSA2, DNAI(s) supported by
PSA2), (Removal of IPv6 prefix \@PSA0, DNAI(s) supported by PSA0)) to SMF.
The I-SMF informs the SMF that a change of traffic offload may occur. Multiple
local PSAs may be changed. The I-SMF provides:
\- for each local PSA to be added, the DNAI now reachable and in the case of
multi-homing: the new allocated IPv6 prefix \@PSA2;
\- for each local PSA no more reachable, the DNAI no more reachable and in the
case of multi-homing, the old IPv6 prefix \@PSA0.
4\. The SMF may issue a SM Policy Association Modification (clause 4.16.5)
corresponding to the IP address allocation/release PCRT. The SMF may also send
an \"early\" notification to the AF, as described in clause 4.23.6.3.
5\. The SMF generates the N4 information based on DNAI(s) information received
in step 3.The SMF provides I-SMF with N4 information for the PSA and for the
UL CL with a SMF initiated Nsmf_PDUSession_Update Request (set of (N4
information, involved DNAI), Indication of no DNAI change, Indication of no
local PSA change)). The information includes N4 information to remove the
traffic offload related to the DNAI(s) that are no more reachable and to
enable the traffic offload related to the DNAI(s) that are now reachable.
6-7. Same as step 7-8 of clause 4.23.9.1
8\. The I-SMF releases via N4 the PSA0 if PSA0 is not collocated with UL
CL/BP, or updates the UL CL/BP to remove corresponding rules if PSA0 is
collocated with UL CL/BP.
9\. The I-SMF issues a Nsmf_PDUSession_Update Response to SMF that may include
N4 information received from the local UPF(s) including the PSA0.
10\. Same as step 7-8 of clause 4.3.5.4 are performed.
#### 4.23.9.4 Simultaneous change of Branching Point or UL CL and additional
PSA controlled by I-SMF
This clause describes simultaneous change of UL-CL/BP function and additional
PSA, e.g. addition of a new UL CL/BP and PDU Session Anchor (i.e. PSA2) and
release of the existing UL CL/BP and additional PDU Session Anchor (i.e.
PSA0), with target UPF(s) and source UPF(s) are all controlled by I-SMF.
This procedure may be triggered after N2 handover or Xn based handover
procedure.
Figure 4.23.9.4-1: Simultaneous change of Branching Point or UL CL and
additional PSA controlled by I-SMF
Comparing to the clause 4.23.9.3, this procedure in addition changes the
source UL-CL/BP by a target UL-CL/BP.
1-2. These steps are the same steps 1-2 in clause 4.23.9.3.
3\. The I-SMF selects a UPF and using N4 establishes the target UL CL or BP of
the PDU Session.
4\. The I-SMF invokes Nsmf_PDUSession_Update Request (Indication of Change of
traffic offload, (new allocated IPv6 prefix \@PSA2, DNAI(s) supported by
PSA2), (Removal of IPv6 prefix \@PSA0, DNAI(s) supported by PSA0), DL Tunnel
Info of the new UL CL/Branching Point) to SMF.
The DL Tunnel Info of target UL CL/Branching Point is provided to SMF.
5\. The SMF updates the remote PSA (PSA1) via N4 with the DL Tunnel Info of
the Target UL CL/BP for the downlink traffic.
6-8. These steps are the same as steps 4-6 in clause 4.23.9.3.
If EAS session continuity upon UL CL relocation is required, in step 7 the SMF
provides the I-SMF additionally with an indication that a N9 forwarding tunnel
to support the EAS session continuity is required, UL traffic filter for N9
forwarding by the target UL CL and the value of the timer to detect the end of
activity on the N9 forwarding tunnel to support the EAS session continuity.
Based on the received information, the I-SMF uses N4 to establish between the
source UL CL and target UL CL the N9 forwarding tunnel to support the EAS
session continuity. The I-SMF configures the source UL CL to forward traffic
received from source L-PSA related to that PDU session toward the target UL CL
via the N9 forwarding tunnel.
9\. Same as steps 6-8 of clause 4.3.5.4. The I-SMF updates (R)AN for uplink
traffic.
10-11. If a N9 forwarding tunnel to support the EAS session continuity is not
established between the source UL CL and target UL CL, the I-SMF releases via
N4 the source UL-CL/BP as the source UL-CL/BP is replaced by the target UL-
CL/BP. The I-SMF also releases via N4 the PSA0 if PSA0 is not collocated with
source UL CL/BP ;
12\. This step is the same as step 9 in clause 4.23.9.3.
12a. If a N9 forwarding tunnel to support the EAS session continuity is
established between the source UL CL and target UL CL, the I-SMF releases the
source UL-CL/BP and PSA0 and the N9 forwarding tunnel in target UL CL when
detection of no active traffic over the N9 forwarding tunnel takes place per
the value of the timer to detect the end of activity on the N9 forwarding
tunnel to support the EAS session continuity received from SMF. The detection
can be done by Source UL CL, which notifies the I-SMF of no active traffic
over the N9 forwarding tunnel.
The I-SMF invokes Nsmf_PDUSession_Update Request to inform the SMF of the
release of the resource in UL CL/BP and PSA0 for the PDU Session.
#### 4.23.9.5 Simultaneous change of Branching Points or UL CLs controlled by
different I-SMFs
This clause describes simultaneous change of UL-CL/BP function and additional
PSA, e.g. addition of a new UL CL/BP and PDU Session Anchor (i.e. PSA2) and
release of the existing UL CL/BP and PDU Session Anchor (i.e. PSA0), with
target UPF(s) and source UPF(s) are all controlled by different I-SMF(s).
This procedure may be triggered after N2 handover or Xn based handover
procedure.
Figure 4.23.9.5-1: Simultaneous change of Branching Point or UL CL and
additional PSA controlled by different I-SMFs
1\. UE has established PDU Session with Source Branching Point or UL CL and
Source UPF (PSA0) controlled by source I-SMF and Remote PSA. The UE has
mobility with I-SMF change, e.g. handed over from a source RAN to a target
RAN. After mobility, the path between Target I-UPF and Remote PSA (PSA1) has
been established.
2\. This step is the same as steps 2 in clause 4.23.9.3.
3\. Same as in step 3 of Figure 4.23.9.4-1.
4\. Same as in step 4 of Figure 4.23.9.4-1.
5\. Same as in step 5 of Figure 4.23.9.4-1..
6-8. These steps are the same as steps 4-6 in clause 4.23.9.3 with the
following enhancement:
In step 7, to support EAS session continuity upon UL CL relocation the SMF
provides the target I-SMF with an indication that a N9 forwarding tunnel to
support the EAS session continuity is required, UL traffic filter for N9
forwarding by the target UL CL and the value of the timer to detect the end of
activity on the N9 forwarding tunnel to support the EAS session continuity.
Based on the received information, the target I-SMF installs corresponding N4
rules in the target UL CL for forwarding of uplink traffics via the N9
forwarding tunnel. The time interval for User Plane inactivity report is also
provisioned to UL CL per the timer value received from SMF.
9\. Same as in step 9 of Figure 4.23.9.4-1.
10\. This step is the same as step 9 in clause 4.23.9.3.
The SMF triggers the procedure from step 11 onwards to support EAS session
continuity upon UL CL relocation.
11\. If N9 forwarding tunnel to support the EAS session continuity is required
based on indication received from SMF in step 7, the target I-SMF request
target UL CL to allocate N9 forwarding tunnel info via N4 session modification
procedure.
12\. The target I-SMF invokes Nsmf_PDUSession_UpdateSMContext Request (N9
forwarding tunnel required, target UL CL N9 forwarding tunnel info, value of
the timer to detect the end of activity on the N9 forwarding tunnel to support
the EAS session continuity) toward the source I-SMF.
13\. The source I-SMF triggers N4 modification procedure to request the source
UL CL to establish the N9 forwarding tunnel to support the EAS session
continuity. The source I-SMF provides the target UL CL N9 forwarding tunnel
info to the source UL CL and receives the source UL CL N9 forwarding tunnel
info from the source UL CL. The source I-SMF configures the source UL CL to
forward traffic received from source L-PSA related to that PDU session toward
the target UL CL via the N9 forwarding tunnel.
The source I-SMF configures a time interval for the source ULCL for the
detection of no active traffic over the N9 forwarding tunnel, which is based
on the value of the timer to detect the end of activity on the N9 forwarding
tunnel to support the EAS session continuity as received from target I-SMF.
After this step, the downlink data can be forwarded via N9 forwarding tunnel
from the source L-PSA (PSA0).
14\. The source I-SMF sends Nsmf_PDUSession_UpdateSMContext Response (source
UL CL N9 forwarding to support the EAS session continuity tunnel info).
15\. Based on the traffic filter information received from SMF at step 7 and
source UL CL N9 forwarding tunnel to support the EAS session continuity info,
the target I-SMF request the target UL CL to forward related UL traffic via N9
forwarding tunnel to support the EAS session continuity.
The target I-SMF configures a time interval for the target ULCL for the
detection of no active traffic over the N9 forwarding tunnel, which is based
on the value of the timer to detect the end of activity on the N9 forwarding
tunnel to support the EAS session continuity received from SMF.
After this step, the uplink data can be forwarded via N9 forwarding tunnel
toward the source L-PSA (PSA0).
16-17. Upon detection of no active traffic over the N9 forwarding tunnel to
support the EAS session continuity, the source I-SMF releases via N4 the
source UL-CL/BP The Source I-SMF also releases via N4 the PSA0 if PSA0 is not
collocated with source UL CL/BP.
17a. The source I-SMF invokes Nsmf_PDUSession_Update Request to inform the SMF
of the release of the resource in the UL CL/BP and the PSA0 for this PDU
Session.
18\. Upon detection of no active traffic over the N9 forwarding tunnel to
support the EAS session continuity, the Target I-SMF releases the N9
forwarding tunnel in Target UL CL and remove the related filter.
### 4.23.9a Void
### 4.23.10 CN-initiated selective deactivation of UP connection of an
existing PDU Session involving I-SMF
For the CN-initiated selective deactivation of UP connection of an existing
PDU Session procedure, if the PDU Session involved I-SMF, the procedure
defined in clause 4.3.7 are impacted as following:
\- The SMF and UPF in the procedure are replaced by the I-SMF and I-UPF.
### 4.23.11 Xn based handover
#### 4.23.11.1 General
This clause describes the Xn based handover with the insertion, reallocation
and removal of I-SMF.
To support the EAS session continuity upon UL CL relocation (allowing the UE
to go on exchanging with the source EAS despite the fact that a new UL CL has
been allocated to the PDU Session), the N9 forwarding tunnel between the
Source UL CL and Target UL CL is established and released as described in
clause 4.23.9.4 or clause 4.23.9.5.
#### 4.23.11.2 Xn based handover with insertion of intermediate SMF
This procedure is used to hand over a UE from a Source NG-RAN to a Target NG-
RAN using Xn interface (in this case the AMF is unchanged) and the AMF decides
that insertion of a new intermediate I-SMF is needed. This procedure is used
for non-roaming or local breakout roaming scenario.
The call flow is shown in figure 4.23.11.2-1.
Figure 4.23.11.2-1: Xn based inter NG-RAN handover with insertion of
intermediate SMF
1\. Step 1 is the same as described in clause 4.9.1.2.2.
2\. For each PDU Session Rejected in the list of PDU Sessions received in the
N2 Path Switch Request, the AMF perform same step as step 2 in clause
4.9.1.2.2.
The rest of this procedure applies for each PDU Session To Be Switched.
3a. The AMF checks if an I-SMF needs to be selected as described in clause
5.34.3 of TS 23.501 [2].
3b. If a new I-SMF is selected the AMF sends Nsmf_PDUSession_CreateSMContext
Request (SUPI, AMF ID, SMF ID, SM Context ID, PDU Session To Be Switched with
N2 SM Information (Secondary RAT usage data), UE Location Information, UE
presence in LADN service area) to the new selected I-SMF.
4\. The new I-SMF sends Nsmf_PDUSession_Context Request (SM context type, SM
Context ID) to SMF to retrieve the SM Context.
The new I-SMF uses SM Context ID received from AMF for this service operation.
SM context type indicates that the requested information is all SM context,
i.e. PDN Connection Context and 5G SM context. The SM Context ID is used by
the recipient of Nsmf_PDUSession_Context Request in order to determine the
targeted PDU Session.
5a. I-SMF to I-UPF: N4 Session Establishment Request (Target NG-RAN Tunnel
Info).
The I-SMF then selects a I-UPF based on UPF Selection Criteria according to
clause 6.3.3 of TS 23.501 [2]. An N4 Session Establishment Request message is
sent to the I-UPF. The target NG-RAN Tunnel Info is included in the N4 Session
Establishment Request message.
5b. I-UPF to I-SMF: N4 Session Establishment Response.
The I-UPF sends an N4 Session Establishment Response message to the I-SMF. The
UL CN Tunnel Info and DL CN Tunnel Info of I-UPF are sent to the I-SMF.
6\. I-SMF to SMF: Nsmf_PDUSession_Create Request to the SMF (SUPI, PDU Session
ID, Secondary RAT usage data, UE Location Information, UE presence in LADN
service area, DL CN Tunnel Info of the I-UPF, DNAI list supported by the
I-SMF).
The I-SMF provides the DNAI list it supports to the SMF as defined in Figure
4.23.9.1-1 step 1.
Secondary RAT usage data is extracted from N2 SM Information within PDU
Session To Be Switched received from NG RAN.
7a. SMF to UPF (PSA): N4 Session Modification Request (DL CN Tunnel Info of
the I-UPF).
The SMF provides the DL CN Tunnel Info of the I-UPF to the UPF(PSA).
If old I-UPF controlled by SMF does not exist and if different CN Tunnel Info
need to be used by PSA UPF, i.e. the CN Tunnel Info at the PSA for N3 and N9
are different, the CN Tunnel Info at the PSA for N9 needs to be allocated. The
CN Tunnel Info is provided from UPF to SMF in the response.
7b. UPF (PSA) to SMF: N4 Session Modification Response.
The PDU Session Anchor responds with the N4 Session Modification Response
message after requested PDU Sessions are switched. At this point, PDU Session
Anchor starts sending downlink packets to the Target NG-RAN via I-UPF.
PDU Session Anchor sends one or more \"end marker\" packets for each N3/N9
tunnel on the old path immediately after switching the path, the source NG-RAN
shall forward the \"end marker\" packets to the target NG-RAN.
8\. In order to assist the reordering function in the Target NG-RAN, the PDU
Session Anchor sends one or more \"end marker\" packets for each N3/N9 tunnel
on the old path immediately after switching the path, the source NG-RAN shall
forward the \"end marker\" packets to the target NG-RAN.
9\. SMF to I-SMF: Nsmf_PDUSession_Create Response(Information for local
traffic steering location, CN Tunnel Info at the PSA for N9, updated CN PDB in
the QoS parameters for accepted QoS Flows).
The SMF may update the CN PDB in the response or using a separate PDU Session
Modification procedure, based on local configuration.
9a. If the CN Tunnel Info at PSA for N9 is allocated, it is included in the
response and the I-SMF provides the CN Tunnel Info at the PSA for N9 to I-UPF
via N4 Session Modification Request.
In the case of I-SMF insertion and the PDU session corresponds to a LADN, the
SMF shall release the PDU session after the handover procedure is completed.
10\. I-SMF to AMF: Nsmf_PDUSession_CreateSMContext Response (UL CN Tunnel Info
of the I-UPF, updated CN PDB in the QoS parameters for accepted QoS Flows).
The SMF sends an Nsmf_PDUSession_CreateSMContext response to the AMF.
11-13. Steps 11-13 are same as steps 7-9 defined in clause 4.9.1.2.2 with the
following addition:
If a Source I-UPF controlled by SMF was serving the PDU Session, the SMF
initiates Source I-UPF Release procedure by sending an N4 Session Release
Request toward the Source I-UPF.
#### 4.23.11.3 Xn based handover with re-allocation of intermediate SMF
This procedure is used to hand over a UE from a Source NG-RAN to a Target NG-
RAN using Xn interface (in this case the AMF is unchanged) and the AMF decides
that the intermediate SMF(I-SMF) is to be changed. This procedure is used for
non-roaming or local breakout roaming scenario. In the case of home routed
roaming scenario, this procedure is also used except the I-SMF is replaced by
V-SMF.
The call flow is shown in figure 4.23.11.3 -1.
Figure 4.23.11.3-1: Xn based inter NG-RAN handover with intermediate I-SMF re-
allocation
1-3. Steps 1-3 are same as steps 1-3 described in clause 4.23.11.2 except that
in step 2 the AMF sends Nsmf_PDUSession_UpdateSMContext Request to source
I-SMF and then the source I-SMF sends the Nsmf_PDUSession_Update Request to
SMF.
4\. The target I-SMF sends Nsmf_PDUSession_Context Request to Source I-SMF to
retrieve 5G SM Context.
5a-11. Steps 5a-11 are same as steps 5a-11 described in clause 4.23.11.2 with
the following difference:
In step 6, the target I-SMF invokes Nsmf_PDUSession_Update Request (Secondary
RAT usage data, UE Location Information, UE presence in LADN service area, DL
CN Tunnel Info of the I-UPF, DNAI list supported by target I-SMF) toward the
SMF;
In step 9, the SMF respond with Nsmf_PDUSession_Update Response. The SMF may
provide the DNAI(s) of interest for this PDU Session to I-SMF as described in
step 1 of Figure 4.23.9.1-1. The SMF may update the CN PDB in the response or
using a separate PDU Session Modification procedure, based on local
configuration.
Secondary RAT usage data is extracted from PDU Session To Be Switched with N2
SM Information received from NG RAN.
12a. The AMF sends Nsmf_PDUSession_ReleaseSMContext Request (I-SMF only
indication) to source I-SMF. The source I-SMF removes the SM context of this
PDU session. An indication is included in this message to avoid invoking
resource release in SMF.
12b. The source I-SMF sends N4 Session Release to release the resource in
source I-UPF. If the source I-UPF acts as UL CL and is not co-located with
local PSA, the source I-SMF also sends N4 Session Release to the local PSA to
release the resource for the PDU Session.
13-14. Steps 13-14 are same as steps 12-13 described in clause 4.23.11.2.
#### 4.23.11.4 Xn based handover with removal of intermediate SMF
This procedure is used to hand over a UE from a Source NG-RAN to a Target NG-
RAN using Xn interface(in this case the AMF is unchanged) and the AMF decides
that removal of intermediate I-SMF is needed. This procedure is used for non-
roaming or local breakout roaming scenario.
The call flow is shown in figure 4.23.11.4-1.
Figure 4.23.11.4-1: Xn based inter NG-RAN handover with removal of
intermediate SMF
1\. Step 1 is the same as described in clause 4.9.1.2.2.
2\. For each PDU Session Rejected in the list of PDU Sessions received in the
N2 Path Switch Request, the AMF sends Nsmf_PDUSession_UpdateSMContext Request
to source I-SMF and then the source I-SMF sends the Nsmf_PDUSession_Update
Request to SMF forwarding the failure cause. The SMF decides whether to
release the PDU Session.
The rest of this procedure applies for each PDU Session To Be Switched.
3a. The AMF performs I-SMF selection as described in clause 5.34.3 of TS
23.501 [2] and the AMF decides to remove I-SMF in this case.
3b. The AMF sends Nsmf_PDUSession_CreateSMContext Request (SUPI, PDU Session
ID, AMF ID, PDU Session To Be Switched with N2 SM Information (Secondary RAT
usage data), UE Location Information, UE presence in LADN service area, Target
NG-RAN Tunnel Info) to the SMF.
4a. [Conditional] SMF to I-UPF: N4 Session Establishment Request (Target NG-
RAN Tunnel Info, UL CN Tunnel Info of the UPF (PSA)).
The SMF may select an I-UPF based on UPF Selection Criteria according to
clause 6.3.3 of TS 23.501 [2]. If an I-UPF is selected, an N4 Session
Establishment Request message is sent to the I-UPF. The target NG-RAN Tunnel
Info is included in the N4 Session Establishment Request message.
4b. I-UPF to SMF: N4 Session Establishment Response.
The I-UPF sends an N4 Session Establishment Response message to the I-SMF. The
UL and DL CN Tunnel Info of I-UPF is sent to the I-SMF.
5a. SMF to UPF (PSA): N4 Session Modification Request (DL CN Tunnel Info of
the I-UPF if I-UPF is selected, or Target NG-RAN Tunnel Info if I-UPF is not
selected).
The SMF provides the DL CN Tunnel Info of the I-UPF to the UPF (PSA) if I-UPF
is selected.
If an I-UPF is not selected, the SMF provides the target NG-RAN Tunnel Info to
the UPF (PSA). If different CN Tunnel Info need to be used by PSA UPF, i.e.
the CN Tunnel Info for N3 and N9 are different, the SMF retrieves the new CN
Tunnel Info from UPF.
5b. UPF (PSA) to SMF: N4 Session Modification Response.
If different CN Tunnel Info needs to be used by PSA UPF, i.e. the CN Tunnel
Info for N3 and N9 are different, the CN Tunnel Info is allocated by the UPF
and provided to the SMF.
The PDU Session Anchor responds with the N4 Session Modification Response
message after requested PDU Sessions are switched. PDU Session Anchor sends
one or more \"end marker\" packets for each N3/N9 tunnel on the old path
immediately after switching the path, the source NG-RAN shall forward the
\"end marker\" packets to the target NG-RAN. At this point, PDU Session Anchor
starts sending downlink packets to the Target NG-RAN via I-UPF.
6a. [Conditional] SMF to I-UPF: N4 Session Modification Request (UL CN Tunnel
Info of the UPF (PSA)).
If the UL CN Tunnel Info of the UPF (PSA) has been changed, the SMF provides
the UL CN Tunnel Info of the UPF (PSA) to I-UPF.
6b. I-UPF to SMF: N4 Session Modification Response.
The I-UPF responds with the N4 Session Modification Response message.
7\. In order to assist the reordering function in the Target NG-RAN, the PDU
Session Anchor sends one or more \"end marker\" packets for each N3/N9 tunnel
on the old path immediately after switching the path, the source NG-RAN shall
forward the \"end marker\" packets to the target NG-RAN.
8\. SMF to AMF: Nsmf_PDUSession_CreateSMContext Response (UL CN Tunnel Info of
the I-UPF if I-UPF is selected, or CN Tunnel Info (on N3) of UPF (PSA) if
I-UPF is not selected, updated CN PDB in the QoS parameters for accepted QoS
Flows). The SMF may update the CN PDB in the response or using a separate PDU
Session Modification procedure, based on local configuration.
The SMF sends an Nsmf_PDUSession_CreateSMContext response to the AMF.
9\. Step 9 is same as step 7 defined in clause 4.9.1.2.2.
10a. AMF to source I-SMF: Nsmf_PDUSession_ReleaseSMContext request (I-SMF only
Indication).
The AMF sends Nsmf_PDUSession_ReleaseSMContext request to source I-SMF. The
I-SMF only indication is included in this message to avoid invoking resource
release in SMF.
10b. Source I-SMF to source I-UPF: N4 Session Release Request/Response.
The source I-SMF sends N4 Session Release Request to source I-UPF in order to
release resources for the PDU Session.
10c. Source I-SMF to AMF: Nsmf_PDUSession_ReleaseSMContext Response.
The source I-SMF responds to AMF with Nsmf_PDUSession_ReleaseSMContext
response.
11-12. Steps 11-12 are same as steps 8-9 defined in clause 4.9.1.2.2.
#### 4.23.11.5 Xn based handover without change of intermediate SMF
When both I-SMF and SMF are available for a PDU Session and no I-SMF change or
removal is needed during Xn based handover procedure, compared to the
procedure defined in clause 4.9.1.2.2 and clause 4.9.1.2.4 the SMF is replaced
with the I-SMF.
### 4.23.12 N26 based Interworking Procedures with I-SMF
#### 4.23.12.1 General
When UE moves from EPS to 5GS, for a each PDU Session, the AMF determines
whether I-SMF needs to be inserted based on UE location and service area of
the SMF+PGW-C.
This clause describes the N26 based Interworking Procedures with I-SMF
insertion when UE move from EPS to 5GS and removal when UE moves from 5GS to
EPS.
#### 4.23.12.2 5GS to EPS Idle mode mobility using N26 interface with I-SMF
removal
For 5GS to EPS Idle mode mobility using N26 with I-SMF removal, the procedure
\"5GS to EPS Idle mode mobility using N26 interface\" defined in clause
4.11.1.3.2 for the home routed-roaming case are re-used, with the following
change:
\- The V-SMF is replaced by I-SMF, H-SMF is replaced by SMF and V-UPF is
replaced by I-UPF.
\- The V-CN Tunnel Info is replaced by Tunnel Info at I-UPF, H-CN Tunnel Info
is replaced by Tunnel Info at UPF (PSA).
#### 4.23.12.2A 5GS to EPS Idle mode mobility using N26 interface with Data
forwarding and I-SMF removal
For 5GS to EPS Idle mode mobility using N26 with data forwarding and I-SMF
removal, the procedure \"5GS to EPS Idle mode mobility using N26 interface
with data forwarding\" defined in clause 4.11.1.3.2A for the home-routed
roaming case is re-used, with the following change:
\- The V-SMF is replaced by I-SMF, V-UPF is replaced by I-UPF and H-SMF is
replaced by SMF.
\- Data forwarding tunnel resource is established and the tunnel information
is exchanged through N26 interface. Data buffered in I-SMF/I-UPF is forwarded
to UE via Serving GW.
#### 4.23.12.3 EPS to 5GS mobility registration procedure (Idle and Connected
State) using N26 interface with I-SMF insertion
For EPS to 5GS Mobility registration procedure using N26 with I-SMF insertion,
the procedure \"EPS to 5GS Mobility Registration Procedure (Idle and Connected
State) using N26 interface\" defined in clause 4.11.1.3.3 for the home routed-
roaming case are re-used, with the following change:
\- The V-SMF is replaced by I-SMF and H-SMF is replaced by SMF, V-UPF is
replaced by I-UPF.
\- The V-SMF selection is replaced by the I-SMF selection.
\- The V-CN Tunnel Info is replaced by Tunnel Info at I-UPF, H-CN Tunnel Info
is replaced by Tunnel Info at UPF(PSA).
#### 4.23.12.3A EPS to 5GS Idle mode mobility using N26 interface with Data
forwarding and I-SMF insertion
For EPS to 5GS Mobility registration procedure using N26 with data forwarding
and I-SMF insertion, the procedure \"EPS to 5GS Idle Mobility using N26
interface with data forwarding\" defined in clause 4.11.1.3.3A for the home
routed-roaming case is re-used, with the following change:
\- The V-SMF is replaced by I-SMF and H-SMF is replaced by SMF, V-UPF is
replaced by I-UPF.
\- The V-SMF selection is replaced by the I-SMF selection.
\- The V-CN Tunnel Info is replaced by Tunnel Info at I-UPF, H-CN Tunnel Info
is replaced by Tunnel Info at UPF(PSA).
\- Data forwarding tunnel resource is established and the tunnel information
is exchanged through N26 interface. Data buffered in Serving GW is forwarded
to UE via I-SMF/I-UPF.
#### 4.23.12.4 Procedures for EPS bearer ID allocation
The EPS Bearer ID allocation procedure, EPS Bearer ID transfer procedure and
EPS Bearer ID revocation procedure are perfomed as described for the home-
routed roaming case in clause 4.11.1.4, with the following differences:
\- H-SMF is replaced by SMF.
\- V-SMF is replaced by I-SMF.
\- In step 8 of clause 4.11.1.4.1, in addition to home routing roaming
scenario, for scenario of deployments topologies with specific SMF Service
Areas, if EBI is assigned successfully, the SMF+PGW-C also prepares CN Tunnel
Info for each EPS bearer and provides this information to the I-SMF.
#### 4.23.12.5 EPS to 5GS mobility registration procedure (Idle) using N26
interface with AMF reallocation and I-SMF insertion
For EPS to 5GS Mobility registration procedure using N26 with AMF reallocation
and I-SMF insertion, the procedure \"EPS to 5GS Mobility Registration
Procedure (Idle) using N26 interface with AMF reallocation\" defined in clause
4.11.1.3.4 are re-used, with the following change:
\- The V-SMF is replaced by I-SMF and H-SMF is replaced by SMF, V-UPF is
replaced by I-UPF.
\- The V-SMF selection is replaced by the I-SMF selection.
\- The V-CN Tunnel Info is replaced by Tunnel Info at I-UPF, H-CN Tunnel Info
is replaced by Tunnel Info at UPF(PSA).
#### 4.23.12.6 5GS to EPS handover using N26 interface with I-SMF removal
The procedure \"5GS to EPS handover using N26 interface\" in clause 4.11.1.2.1
for the home routed-roaming case is applied to handover from 5GS to EPS using
N26 interface with I-SMF removal with the following changes:
\- The V-SMF is replaced by I-SMF and H-SMF is replaced by SMF, V-UPF is
replaced by I-UPF.
#### 4.23.12.7 EPS to 5GS handover using N26 interface with I-SMF insertion
##### 4.23.12.7.1 Preparation phase
For handover from EPS to 5GS using N26 interface, if I-SMF needs to be
inserted, the preparation procedure defined in clause 4.11.1.2.2.1 for the
home routed-roaming case are re-used, with the following changes:
\- The V-SMF is replaced by I-SMF and H-SMF is replaced by SMF, V-UPF is
replaced by I-UPF.
\- The V-SMF selection is replaced by the I-SMF selection.
\- The V-CN Tunnel Info is replaced by Tunnel Info at I-UPF, H-CN Tunnel Info
is replaced by Tunnel Info at UPF(PSA).
##### 4.23.12.7.2 Execution phase
For handover from EPS to 5GS using N26 interface, if I-SMF needs to be
inserted, the execution procedure defined in clause 4.11.1.2.2.2 for the home
routed-roaming case are re-used, with the following change:
\- The V-SMF is replaced by I-SMF and H-SMF is replaced by SMF, V-UPF is
replaced by I-UPF.
\- The V-SMF selection is replaced by the I-SMF selection.
\- The V-CN Tunnel Info is replaced by Tunnel Info at I-UPF, H-CN Tunnel Info
is replaced by Tunnel Info at UPF(PSA).
#### 4.23.12.8 Impact to 5GC procedures
##### 4.23.12.8.1 General
This clause captures impact to 5GC procedures in other clauses of clause 4.23
to support interworking with N26.
##### 4.23.12.8.2 UE Triggered Service Request with I-SMF
insertion/change/removal
The following impact is applicable for UE triggered Service Request with I-SMF
insertion in clause 4.23.4.3:
\- In step 8a, when an I-SMF is inserted, if EBI(s) have been allocated before
but the SMF+PGW-C has not prepared the CN Tunnel Info for each EPS bearer, the
SMF+PGW-C requests the PGW-U+UPF to allocate the CN Tunnel for each EPS bearer
for PDU Session(s). PGW-U+UPF allocates the PGW-U tunnel info for the EPS
bearer and sends it to the SMF+PGW-C.
\- In step 8c, the SMF+PGW-C provides also CN Tunnel Info for each EPS bearer
to the I-SMF.
NOTE: The CN Tunnel Info for each EPS bearer provided to the I-SMF is to
prepare for UE mobility to EPC network so that the I-SMF does not need
interact with the SMF+PGW-C to get the EPS bearer context(s) at mobility to
EPC.
##### 4.23.12.8.3 PDU Session establishment procedure
The following impact is applicable for PDU Session establishment in clause
4.23.5.1:
\- If I-SMF is involved in the PDU Session establishment, after EBI has been
successfully allocated, the SMF+PGW-C also prepares CN tunnel info for each
EPS bearer and provides it to the I-SMF, see clause 4.23.12.4.
##### 4.23.12.8.4 PDU Session modification procedure
The following impact is applicable for PDU Session modification in clause
4.23.5.3:
\- If I-SMF is involved in the PDU Session modification, if EBI needs to be
allocated and the allocation is successful, the SMF+PGW-C also prepares CN
tunnel info for each EPS bearer and provides it to the I-SMF, see clause
4.23.12.4.
##### 4.23.12.8.5 Inter NG-RAN node N2 based handover with I-SMF
insertion/change/removal
The following impact is applicable for Inter NG-RAN node N2 based handover
with I-SMF insertion in clause 4.23.7.3.2:
\- In step 7c, at I-SMF insertion, if EBI(s) have been allocated before but
the SMF+PGW-C has not prepared the CN Tunnel Info for each EPS bearer, the
SMF+PGW-C requests the PGW-U+UPF to allocate the CN Tunnel for each EPS bearer
for PDU Session(s). PGW-U+UPF allocates the PGW-U tunnel info for the EPS
bearer and sends it to the SMF+PGW-C.
\- In step 7f, the SMF+PGW-C provides also the CN Tunnel Info for each EPS
bearer to the I-SMF.
##### 4.23.12.8.6 Xn based handover with insertion of I-SMF
The following impact is applicable Xn based handover with insertion of I-SMF
in clause 4.23.11.2:
\- In step 6, at I-SMF insertion, if EBI(s) have been allocated before but the
SMF+PGW-C has not prepared the CN Tunnel Info for each EPS bearer, the
SMF+PGW-C requests the PGW-U+UPF to allocate the CN Tunnel for each EPS bearer
for PDU Session(s). PGW-U+UPF allocates the PGW-U tunnel info for the EPS
bearer and sends it to the SMF+PGW-C.
\- In step 9, the SMF+PGW-C provides also the CN Tunnel Info for each EPS
bearer to the I-SMF.
### 4.23.13 Non N26 based Interworking Procedures with I-SMF
#### 4.23.13.1 General
When UE moves a PDU Session from EPS to 5GS, the AMF determines whether I-SMF
needs to be inserted based on the UE location and the service area of the
SMF+PGW-C.
This clause describes the non N26 based Interworking Procedures with I-SMF
insertion when UE move a PDU Session from EPS to 5GS and I-SMF removal when UE
moves a PDU Session from 5GS to EPS.
This may happen e.g. when the UE moves a PDU Session between an ePDG (over
EPC) and 3GPP access over 5GC;
#### 4.23.13.2 Mobility procedure without N26 interface from EPS to 5GS
At Mobility procedure from EPS to 5GS without N26 interface the procedure
described in Figure 4.11.2.3-1 takes place, with following difference:
\- During step 9 of Figure 4.11.2.3-1 \"UE requested PDU Session Establishment
according to clause 4.3.2.2\", the mechanisms described in clause 4.23.5.1
apply
#### 4.23.13.3 Mobility procedure without N26 interface from EPC/ePDG to 5GS
At Handover from EPC/ePDG to 5GS, the procedure described in Figure 4.11.4.1-1
takes place, with following difference:
\- During step 2 of Figure 4.11.4.1-1 \"UE requested PDU Session Establishment
according to clause 4.3.2.2\", the mechanisms described in clause 4.23.5.1
apply
#### 4.23.13.4 Mobility procedure without N26 interface from 5GS to EPS
At Mobility procedure from 5GS to EPS without N26 interface, the procedure
described in Figure 4.11.2.2-1 takes place, with following difference:
\- During step 14 of Figure 4.11.2.2-1 (SMF+PGW-C initiates release of the PDU
Session(s) in 5GS transferred to EPS), if an I-SMF was involved in the PDU
Session, the same mechanisms than in Home Routed roaming apply (release
according to Figure 4.3.4.3-1) with the SMF playing the role of the H-SMF and
the I-SMF playing the role of the V-SMF.
#### 4.23.13.5 Mobility procedure without N26 interface from 5GS to EPC/ePDG
At Handover from 5GS to EPC/ePDG, the procedure described in Figure 4.11.4.2-1
takes place, with following difference:
\- During step 3 of Figure 4.11.4.2-1 (5GC and NG-RAN resource release), if an
I-SMF was involved in the PDU Session, the same mechanisms than in Home Routed
roaming apply (Figure 4.3.4.3-1 steps 3a-16b) with the SMF playing the role of
the H-SMF and the I-SMF playing the role of the V-SMF.
### 4.23.14 Pause of charging
When I-SMF is involved for a PDU Session, the procedure for pause of charging
in home routed roaming case defined in clause 4.4.4 is applied by replacing
the H-SMF with SMF and V-SMF with I-SMF.
When a Local UPF (PSA) is involved, the SMF stops or starts the usage
reporting including usage reporting at the Local UPF (PSA) via the I-SMF.
For a PDU Session, if charging has been paused previously, in addition to the
conditions for stopping pause of charging as described in clause 4.4.4, the
charging is unpaused in the following case:
\- When the SMF receives Nsmf_PDUSession_Create Request from a new I-SMF or
Nsmf_PDUSession_CreateSMContext request from AMF.
### 4.23.15 PDU Session mobility between 3GPP and non-3GPP access
In this Release of the specification, deployments topologies with specific SMF
Service Areas apply only for 3GPP access.
At PDU Session mobility from 3GPP to non-3GPP access, an I-SMF may need to be
removed because an I-SMF had been inserted when the PDU Session was served
over 3GPP access.
At PDU Session mobility from non-3GPP to 3GPP access, an I-SMF may need to be
inserted because the TA associated with the UE location over 3GPP requires the
AMF to insert an I-SMF.
### 4.23.16 Handover of a PDU Session procedure between 3GPP and untrusted
non-3GPP access
#### 4.23.16.1 Handover of a PDU Session procedure from untrusted non-3GPP to
3GPP access (non-roaming and roaming with local breakout)
The following impacts are applicable to clause 4.9.2.1 when a PDU Session is
handover from untrusted non-3GPP to 3GPP access (non-roaming and roaming with
local breakout):
\- Step2: The UE performs a PDU Session Establishment procedure with the PDU
Session ID of the PDU Session to be moved as specified clause 4.23.5.1 and an
I-SMF and an I-UPF may be selected and inserted for this PDU. If I-SMF is
selected, in the Nsmf_PDUSession_Create Response the SMF shall include all QoS
information for the QoS Flow(s) applicable to the PDU Session for the target
access so that when sending the PDU Session Establishment Accept, within the
N1 SM container and in the N2 SM information, the I-SMF can include all QoS
information (e.g. QoS Rule(s) in N1 SM container, QFI(s) and QoS Profile(s) in
N2 SM information) for the QoS Flow(s).
#### 4.23.16.2 Handover of a PDU Session procedure from 3GPP to untrusted
non-3GPP access (non-roaming and roaming with local breakout)
When a PDU Session is handover from 3GPP access with an I-SMF to untrusted
non-3GPP access (non-roaming and roaming with local breakout), the following
steps take place:
1) Step 1 of clause 4.9.2.2.
2) Step 2 of clause 4.9.2.2.
3) The step 3 in clause 4.9.2.4.2 is executed involving I-SMF instead of
V-SMF, with following differences:
\- Figure 4.3.4.3-1 step 14 involving I-SMF instead of V-SMF.
\- Figure 4.3.4.3-1 step 16a: The SMF invokes Nsmf_PDUSession_StatusNotify
(Release) indicating the release is due to a PDU Session Handover out of the
I-SMF.
\- Figure 4.3.4.3-1 step 16b: the I-SMF invoke the
Nsmf_PDUSession_SMContexStatusNotify (Release) indicating the Release is due
to a PDU Session Handover out of the I-SMF: the AMF determines that only the
SMcontext with the I-SMF is to be released but that the PDU Session is not
released.
The steps 2 to 3 above shall be repeated for all PDU Sessions to be moved from
3GPP access to untrusted non-3GPP access.
#### 4.23.16.3 Handover of a PDU Session procedure from untrusted non-3GPP to
3GPP access (home routed roaming)
##### 4.23.16.3.1 The target AMF is in the PLMN of the N3IWF
The following impacts are applicable to clause 4.9.2.3.1 when a PDU Session is
handover from untrusted non-3GPP to 3GPP access (home routed roaming) and
target AMF is in the PLMN of the N3IWF:
\- Step2: The UE performs a PDU Session Establishment procedure with the PDU
Session ID of the PDU Session to be moved as specified clause 4.23.5.1. A
different V-SMF and a different V-UPF may be selected for the PDU Session.
If a new V-SMF is selected, in the Nsmf_PDUSession_Create Response the H-SMF
shall include all QoS information for the QoS Flow(s) applicable to the PDU
Session for the target access so that when sending the PDU Session
Establishment Accept, within the N1 SM container and in the N2 SM information,
the V-SMF can include all QoS information (e.g. QoS Rule(s) in N1 SM
container, QFI(s) and QoS Profile(s) in N2 SM information) for the QoS Flow(s)
acceptable according to VPLMN policies.
\- (additional) Step 4: If a new V-SMF and a new V-UPF are selected for the
PDU Session, the step 3a and 14 in clause 4.3.4.3 are performed to release the
resource in the old V-SMF and old V-UPF.
The steps 2 to 4 shall be repeated for all PDU Sessions to be moved from to
untrusted non-3GPP access to 3GPP access.
### 4.23.16a Handover of a PDU Session procedure between 3GPP and trusted
non-3GPP access
#### 4.23.16a.1 General
The handover of a PDU Session between 3GPP access and trusted non-3GPP access
shall be supported as specified in clause 4.23.16 for all types of handover of
a PDU Session between 3GPP access and untrusted non-3GPP access, with the
following modifications and clarifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by the TNGF.
\- The reference to clause 4.9.2 is substituted by clause 4.9.3 specifying
handover of a PDU Session procedure between 3GPP and trusted non-3GPP access.
### 4.23.17 Additional considerations for Home-routed roaming
As described in clause 4.23.1, the procedures in clause 4.23 apply for home-
routed roaming scenarios with V-SMF insertion/removal/change (i.e. by
replacing the I-SMF with V-SMF and SMF with H-SMF). Differences compared to
the procedures for I-SMF are described below:
\- The Registration procedure as defined in clause 4.23.3 with the following
additions:
\- Step 8a of clause 4.23.4.3 (for cases d and e): the new V-SMF provides the
QoS constraints of the VPLMN to H-SMF.
\- Step 8c of clause 4.23.4.3 (for cases d and e): the new V-SMF may apply
VPLMN QoS policies as described in TS 23.501 [2], clause 5.7.1.11.
\- Inter NG-RAN node N2 based handover with V-SMF insertion/change as defined
in clause 4.23.7.3 (i.e. by replacing the I-SMF with V-SMF) with the following
additions:
\- Preparation phase, step 4b (for case V-SMF change): the target V-SMF may
apply VPLMN QoS policies as described in TS 23.501 [2], clause 5.7.1.11.
\- Preparation phase, step 5d (for case V-SMF insertion): the target V-SMF may
apply VPLMN QoS policies as described in TS 23.501 [2], clause 5.7.1.11.
\- Execution phase, step 6 (for case V-SMF change/insertion): the target V-SMF
provides the QoS constraints of the VPLMN to H-SMF.
## 4.24 Procedures for UPF Anchored Data Transport in Control Plane CIoT 5GS
Optimisation
### 4.24.1 UPF anchored Mobile Originated Data Transport in Control Plane CIoT
5GS Optimisation
This clause describes the procedures for Mobile Originated Transport in
Control Plane CIoT 5GS Optimisation where the PDU Session is terminated at a
UPF.
Figure 4.24.1-1: UPF anchored Mobile Originated Data Transport in Control
Plane CIoT 5GS Optimisation
1\. If the UE is CM-CONNECTED it sends a NAS message carrying the ciphered PDU
session ID and ciphered uplink data as payload. If the UE is in CM-IDLE, the
UE first establishes an RRC connection or sends the RRCEarlyDataRequest
message and sends a NAS message as part of this.
The UE may also send NAS Release Assistance Information (NAS RAI) included in
the NAS message. NAS RAI indicates that no further Uplink and Downlink Data
transmissions are expected, or that only a single Downlink data transmission
(e.g. Acknowledgement or response to Uplink data) subsequent to this Uplink
Data transmission is expected.
1a. In the NB-IoT case, during step 1 the NG-RAN, based on configuration, may
retrieve the NB-IoT UE Priority and the Expected UE Behaviour Parameters from
the AMF, if not previously retrieved. Based on such parameters, the NG-RAN may
apply prioritisation between requests from different UEs before triggering
step 2 and throughout the RRC connection. The NG-RAN may retrieve additional
parameters (e.g. UE Radio Capabilities).
2\. NG-RAN forwards the NAS message to the AMF using the Initial NAS message
procedure (if the UE was in CM-IDLE before step 1) or using the Uplink NAS
transport procedure (if the UE was in CM-CONNECTED before step 1). If
RRCEarlyDataRequest message was received in step 1, the NG-RAN includes \"EDT
Session\" indication in the N2 Initial UE message.
The RAI signalled by MAC based on the Buffer Status Report (BSR), see TS
36.321 [56], shall not be used when using Control Plane CIoT 5GS
Optimisations.
3\. AMF checks the integrity of the incoming NAS message and deciphers the PDU
session ID and uplink data.
If a NAS RAI is received from the UE and it conflicts with the Expected UE
Behaviour, the NAS RAI takes precedence.
3a. If the AMF received \"EDT Session\" indication from the NG-RAN in step 2,
the AMF sends an N2 message to the NG-RAN.
a) In the case of NAS RAI with Uplink data and it indicated that Downlink data
was not expected and the AMF does not expect any other signalling with the UE,
the AMF shall
\- either send a NAS service accept in the N2 Downlink NAS Transport message
and include End Indication to indicate that no further data or signalling is
expected with the UE; or
\- alternatively, the AMF sends an N2 Connection Establishment Indication
message including End Indication to indicate that no further data or
signalling is expected with the UE.
b) If the AMF determines more data or signalling may be pending, the AMF sends
an N2 Downlink NAS Transport message or Initial Context Setup Request message
without End Indication.
3b. If 3a was executed, the NG-RAN completes the RRC early data procedure as
follows.
a) For the case of 3a.a) the NG-RAN proceeds with RRCEarlyDataComplete
message. The procedure is completed in step 5.
b) For the case of 3a.b) the NG-RAN proceeds with RRC connection establishment
procedure. In that case, all steps up to step 13 apply.
4\. AMF determines the (V-)SMF handling the PDU session based on the PDU
session ID contained in the NAS message and passes the PDU Session ID and the
data to the (V-)SMF by invoking Nsmf_PDUSession_SendMOData service operation.
If NG-RAN forwarded the NAS message to the AMF using the Initial NAS message
procedure in step 2 and the UE is accessing via NB-IoT RAT then the AMF may
inform the (H-)SMFs whether the RRC establishment cause is set to \"MO
exception data\", as described in clause 5.31.14.3 of TS 23.501 [2]. The AMF
may immediately send the MO Exception Data Counter to the (H-)SMF.
If no Downlink Data is expected based on the NAS RAI from the UE in step 1 and
if the AMF is not aware of pending MT traffic, then AMF does not wait for step
7 and continues with step 12.
5\. The (V-)SMF decompresses the header if header compression applies to the
PDU session and forwards the data to the UPF.
The UPF forwards the data to the DN based on data forwarding rule, e.g. in the
case of unstructured data, tunnelling may be applied according to clause
5.6.10.3 of TS 23.501 [2].
6\. [Conditional] In the non-roaming and LBO case, the UPF forwards available
downlink data to the (V-)SMF, in the home-routed roaming case, the H-UPF
forwards the data to the V-UPF then to the V-SMF.
7\. [Conditional] The (V-)SMF compresses the header if header compression
applies to the PDU session. The (Vâ€‘)SMF forwards the downlink data and the PDU
session ID to the AMF using the Namf_Communication_N1N2MessageTransfer service
operation.
8\. [Conditional] The AMF creates a DL NAS transport message with the PDU
session ID and the downlink data. The AMF ciphers and integrity protects the
NAS transport message
9\. [Conditional] The AMF sends the DL NAS transport message to NG-RAN. If NAS
RAI indicated for single uplink and single downlink packets (e.g.
acknowledgment expected) and AMF has determined the data transmission is for
single uplink and single downlink packets, the AMF includes an End Indication
in the DL NAS transport message to indicate that no further data or signalling
is expected with the UE.
10\. [Conditional] NG-RAN delivers the NAS payload over RRC to the UE.
11\. If no further data or signalling is pending and AMF received NAS RAI
indicating single downlink data transmission, then AMF triggers the AN release
procedure (clause 4.2.6) and the procedure stops after this step.
12\. [Conditional] If no further activity is detected by NG-RAN, then NG-RAN
triggers the AN release procedure.
13\. [Conditional] The UE\'s logical NG-AP signalling connection and RRC
signalling connection are released according to clause 4.2.6.
NOTE: The details of the NGAP messages to be used for this procedure are
specified in TS 38.413 [10].
### 4.24.2 UPF anchored Mobile Terminated Data Transport in Control Plane CIoT
5GS Optimisation
This clause describes the procedures for Mobile Terminated Data Transport in
Control Plane CIoT 5GS Optimisation where the PDU Session is terminated at a
UPF.
Figure 4.24.2-1: Mobile Terminated Data Transport in Control Plane CIoT 5GS
Optimisation
1\. Downlink data is received by the UPF. If buffering is configured in the
UPF, then the flow continues in step 2a, otherwise the flow continues in step
2f.
2a. [conditional] If this is the first downlink packet to be buffered and SMF
has instructed the UPF to report the arrival of first downlink packet to be
buffered, then the UPF sends a Data Notification to the SMF.
2b. [conditional] The SMF sends a Data Notification ACK to the UPF.
2c. [conditional] The SMF sends a Namf_MT_EnableUEReachability request to the
AMF.
The SMF determines whether Extended Buffering applies based on local policy
and the capability of the UPF. If Extended Buffering applies, the SMF includes
\"Extended Buffering support\" indication in Namf_MT_EnableUEReachability
request.
2d. [conditional] If AMF determines the UE is unreachable (e.g. if the UE is
in MICO mode or the UE is configured for extended idle mode DRX), then the AMF
rejects the request from the SMF with an indication that the UE is not
reachable. If the SMF included Extended Buffering support indication, the AMF
indicates the Estimated Maximum Wait time in the response message. If the UE
is in MICO mode, the AMF determines the Estimated Maximum Wait time based on
the next expected periodic registration timer update expiration or by
implementation. If the UE is configured for extended idle mode DRX, the AMF
determines the Estimated Maximum Wait time based on the start of next
PagingTime Window. The AMF stores an indication that the SMF has been informed
that the UE is unreachable.
If the AMF detects that the UE context contains Paging Restriction
Information, the AMF may block the paging for this UE based on the stored
Paging Restriction Information (see clause 5.38.1 of TS 23.501 [2]). If the
AMF blocks paging, the AMF sends MT_EnableUEReachability response to the SMF
with an indication that its request has been rejected due to restricted
paging.
2e. [conditional] If the SMF receives an \"Estimated Maximum Wait time\" from
the AMF and Extended buffering applies, the SMF sends a failure indication to
the UPF with an Extended Buffering time and optionally a DL Buffering
Suggested Packet Count. The Extended Buffering time is determined by the SMF
and should be larger or equal to the Estimated Maximum Wait time received from
the AMF. The DL Buffering Suggested Packet Count parameter is determined by
the SMF and if available, the Suggested Number of Downlink Packets parameter
may be considered. The procedure stops after this step.
2f. [conditional] If buffering is not configured in the UPF, then the UPF
forwards the downlink data to the (Vâ€‘)SMF in non-roaming and LBO cases. In the
home-routed roaming case, the H-UPF forwards the data to the V-UPF and then to
the V-SMF.
2g. [conditional] The SMF determines whether Extended Buffering applies based
on local policy and the capability of the SMF.
If user data is received in step 2f and Extended buffering is not configured
for the SMF, then (V-)SMF compresses the header if header compression applies
to the PDU session and creates the downlink user data PDU that is intended as
payload in a NAS message. The (V-)SMF forwards the downlink user data PDU and
the PDU session ID to the AMF using the Namf_Communication_N1N2MessageTransfer
service operation. If Extended Buffering applies, then (V-)SMF keeps a copy of
the downlink data.
If user data is received in step 2f and Extended Buffering applies, the SMF
includes \"Extended Buffering support\" indication in
Namf_Communication_N1N2Message Transfer.
2h. [conditional] AMF responds to SMF.
If AMF determines that the UE is reachable for the SMF, then the AMF informs
the SMF. Based on this, the SMF deletes the copy of the downlink data.
If AMF determines the UE is unreachable for the SMF (e.g. if the UE is in MICO
mode or the UE is configured for extended idle mode DRX), then the AMF rejects
the request from the SMF. The AMF may include in the reject message an
indication that the SMF need not trigger the
Namf_Communication_N1N2MessageTransfer Request to the AMF, if the SMF has not
subscribed to the event of the UE reachability.
If the AMF detects that the UE context contains Paging Restriction
Information, the AMF may block the paging for this UE, based on the stored
Paging Restriction Information (see clause 5.38.1 of TS 23.501 [2]). If the
AMF blocks paging, the AMF sends Namf_Communication_N1N2MessageTransfer
response to the SMF with an indication that its request has been rejected due
to restricted paging.
If the SMF included Extended Buffering support indication, the AMF indicates
the Estimated Maximum Wait time, in the reject message, for the SMF to
determine the Extended Buffering time. If the UE is in MICO mode, the AMF
determines the Estimated Maximum Wait time based on the next expected periodic
registration timer update expiration or by implementation. If the UE is
configured for extended idle mode DRX, the AMF determines the Estimated
Maximum Wait time based on the start of next PagingTime Window. The AMF stores
an indication that the SMF has been informed that the UE is unreachable.
If the SMF receives an \"Estimated Maximum Wait time\" from the AMF and
Extended Buffering in SMF applies, the SMF store the DL Data for the Extended
Buffering time. The Extended Buffering time is determined by the SMF and
should be larger or equal to the Estimated Maximum Wait time received from the
AMF. The SMF does not send any additional
Namf_Communication_N1N2MessageTransfer message if subsequent downlink data
packets are received.
3\. [Conditional] If the UE is in CM-IDLE, the AMF sends a paging message to
NG-RAN. If available, the AMF may include the WUS Assistance Information in
the N2 Paging message(s).
4\. [Conditional] If NG-RAN received a paging message from AMF and UE and NG-
RAN support WUS, then:
\- if the NGAP Paging message contains the _Assistance Data for Recommended
Cells_ IE (see TS 38.413 [10]), then NG-RAN shall only broadcast the UE\'s
Wake Up Signal in the last used cell;
\- else (i.e. the _Assistance Data for Recommended Cells_ IE is not included
in the NGAP Paging message) NG-RAN should not broadcast the UE\'s Wake Up
Signal.
NG-RAN performs paging. If the WUS Assistance Information is included in the
N2 Paging message, the NG-eNB takes it into account when paging the UE (see TS
36.300 [46]).
5\. [Conditional] If the UE receives paging message, it responds with a NAS
message sent over RRC Connection Establishment.
If the UE is in CM-IDLE state in 3GPP access and is using the Multi-USIM
Paging Rejection feature (see clause 5.38 of TS 23.501 [2]), upon reception of
paging request and if the UE determines not to accept the paging, the UE
attempts to send a Reject Paging Indication via the UE Triggered Service
Request procedure (clause 4.2.3.2) unless it is unable to do so, e.g. due to
UE implementation constraints.
5a. [Conditional] In the NB-IoT case, during Step 5, the NG-RAN, based on
configuration, may retrieve the NB-IoT UE Priority and the Expected UE
Behaviour Parameters from the AMF, if not previously retrieved. Based on such
parameters, the NG-RAN may apply prioritisation between requests from
different UEs before triggering step 6 and throughout the RRC connection. The
NG-RAN may retrieve additional parameters (e.g. UE Radio Capabilities).
6\. [Conditional] The NAS message is forwarded to the AMF. If the AMF receives
any Paging Restrictions information in the Control Plane Service Request, the
AMF updates the UE context with the received Paging Restrictions information.
If no Paging Restriction information is provided, no paging restrictions
apply.
7a. [Conditional] AMF to SMF: Namf_MT-EnableUEReachability Response.
If the SMF used the MT_EnableUEReachability request in step 2c and the UE has
not responded to paging then the AMF sends a response to the SMF indicating
that the request failed.
If the SMF used the MT_EnableUEReachability service operation in step 2c and
the UE has responded with a Control Plane Service Request NAS message
including Reject Paging Indication in step 5, the AMF notifies the SMF using
the MT_EnableUEReachability response that the UE rejected the page and no user
plane connection will be established. The UE remains reachable for future
paging attempts.
7b. [Conditional] SMF to UPF: If the SMF has received a Namf_MT-
EnableUEReachability response from the AMF indicating that the request failed
or the UE rejected the paging, the SMF indicates to the UPF to discard the
buffered data. . If the AMF indicated that the UE rejected the paging, steps
7c-12 are skipped. Otherwise the procedure stops after this step.
7c. [Conditional] AMF to SMF: Namf_Communication_N1N2Transfer Failure
Notification.
If the SMF used the Namf_Communication_N1N2MessageTransfer service operation
in step 2g and the UE has not responded to paging, the AMF sends a failure
notification to the SMF based on which the SMF discards the buffered data. The
procedure stops after this step.
If the SMF used the Namf_Communication_N1N2MessageTransfer service operation
in step 2g and the UE has responded with a Control Plane Service Request NAS
message including Reject Paging Indication in step 5, the AMF notifies the SMF
using the Namf_Communication_N1N2MessageTransfer Failure Notification that the
UE rejected the page and no user plane connection will be established. The UE
remains reachable for future paging attempts. Steps 9-12 are skipped.
8a. [Conditional] AMF to SMF: Namf_MT-EnableUEReachability Response.
If the SMF used the MT_EnableUEReachability request in step 2c, then the AMF
indicates to the SMF that the UE is reachable.
8b. [Conditional] SMF to UPF: N4 Session Modification Request.
If the SMF received an indication from the AMF that the UE is reachable, then
the SMF indicates to the UPF to deliver buffered data to the SMF.
8c. [Conditional] UPF to SMF: N4 Session Modification Response.
8d. [Conditional] Buffered data is delivered to the SMF.
8e. [Conditional] (V-)SMF compresses the header if header compression applies
to the PDU session and creates the downlink user data PDU that is intended as
payload in a NAS message. The (V-)SMF forwards the downlink user data PDU and
the PDU session ID to the AMF using the Namf_Communication_N1N2MessageTransfer
service operation.
9\. The AMF creates a DL NAS transport message with the PDU session ID and the
downlink user data PDU received from the SMF. The AMF ciphers and integrity
protects the NAS transport message.
10\. The AMF sends the DL NAS transport message to NG-RAN.
11\. NG-RAN delivers the NAS payload over RRC to the UE.
12\. While the RRC connection is established further uplink and downlink data
can be exchanged. In order to send uplink data, the procedure continues as per
steps 1-10 of the UPF anchored Mobile Originated Data Transport in Control
Plane CIoT 5GS Optimisation procedure (clause 4.24.1).
13\. If the AMF has paged the UE to trigger the NAS procedure as in step 3-6,
the AMF shall initiate the UE configuration update procedure as defined in
clause 4.2.4.2 to assign a new 5G-GUTI. If the UE response in the Control
Plane Service Request NAS message includes a Reject Paging Indication, the AMF
triggers the release of the UE as specified in clause 4.2.3.2.
14\. [Conditional] If no further activity is detected by NG-RAN, then NG-RAN
triggers the AN release procedure.
15\. [Conditional] The UE\'s logical NG-AP signalling connection and RRC
signalling connection are released according to clause 4.2.6.
NOTE: The details of the NGAP messages to be used for this procedure are
specified in TS 38.413 [10].
## 4.25 Procedures for NEF based Non-IP Data Delivery
### 4.25.1 General
Non-IP Data Delivery (NIDD) it is a means for delivering data via a PDU
Sessions of type \"Unstructured\". The subsequent clauses describe the
procedures necessary to support NEF based NIDD.
### 4.25.2 SMF-NEF Connection Establishment
When the UE performs the PDU Session establishment with PDU Session type of
\"Unstructured\" and the subscription information corresponding to the UE
requested DNN includes the \"NEF Identity for NIDD\" (NEF ID), then the SMF
initiates a SMF-NEF Connection establishment procedure towards the NEF
corresponding to the \"NEF ID\" for that DNN / S-NSSAI Combination.
Figure 4.25.2-1: SMF-NEF Connection procedure
1\. Steps 1-7 and step 9 of clause 4.3.2.2.1 for UE-requested PDU Session
Establishment Procedure for non-roaming scenarios or steps 1-9 of clause
4.3.2.2.2 for UE-requested PDU Session Establishment Procedure for home-routed
roaming scenarios. The (H-)SMF receives the Session Management Subscription
data for the corresponding SUPI, DNN and S-NSSAI that is associated with NEF
Identity for NIDD and NIDD information such GPSI and AF Identifier.
2\. If the subscription information corresponding to DNN and S-NSSAI includes
the \"NEF Identity for NIDD\" (NEF ID), the SMF shall create a PDU session
towards the NEF. The SMF invokes Nnef_SMContext_Create Request (User Identity,
PDU Session ID, SMF ID, NIDD information, S-NSSAI, DNN, [RDS support
indication], [Small Data Rate Control parameters], [Small Data Rate Control
Status], [Serving PLMN Rate Control parameters]) message towards the NEF. The
RDS support indication is included if the UE capability to support Reliable
Data Service (RDS) is included in the PCO in the PDU Session Establishment
Request message. The SMF provides Small Data Rate Control parameters to the
NEF for PDU Session, if required. The SMF provides the Small Data Rate Control
Status to the NEF, if received from the AMF. If the Serving PLMN intends to
enforce Serving PLMN Rate Control (see clause 5.31.14.2 of TS 23.501 [2]) for
this PDU session then the SMF shall provide Serving PLMN Rate Control
parameters to NEF for limiting the rate of downlink control plane data
packets.
If no AF has previously performed the NIDD Configuration procedure with the
NEF for the User Identity received in step 2, then the NEF initiates the NIDD
Configuration procedure (see clause 4.25.3) before step 3.
3\. The NEF creates an NEF PDU session Context and associates it with User
Identity and PDU session ID. The NEF invokes Nnef_SMContext_Create Response
(Cause, [RDS support indication], [Extended Buffering Support indication],
[NIDD parameters]) towards the SMF confirming establishment of the PDU session
to the NEF for the UE. If NEF supports and allows use of RDS, it includes the
RDS support indication to SMF and the SMF includes it in the PCO. If NEF
supports Extended Buffering, NEF includes Extended Buffering Support
indication in the response and subscribes for mobility-related events with the
AMF to receive an indication when the UE becomes reachable. The NIDD
parameters (e.g. maximum packet size) are sent to the SMF, if available.
4\. Steps 11-13 of clause 4.3.2.2.1 for UE-requested PDU Session Establishment
Procedure for non-roaming scenarios or steps 13-16 of clause 4.3.2.2.2 for UE
requested PDU Session Establishment Procedure for home-routed roaming
scenarios.
### 4.25.3 NIDD Configuration
Figure 4.25.3-1 illustrates the procedure for configuring necessary
information for data delivery via the NIDD API.
The NIDD Configuration procedure can be NEF initiated or AF triggered: in the
former case the procedure starts at step 1, in the latter case it starts at
step 2.
Figure 4.25.3-1: NIDD Configuration procedure
1\. [Optional] If the NEF requires a NIDD configuration with a given AF, then
the NEF sends a Nnef_NIDDConfiguration_TriggerNotify (GPSI, AF Identifier, NEF
ID) message to the AF for asking the Nnef_NIDDConfiguration_Create Request for
the UE identified by the GPSI.
2\. The AF sends a Nnef_NIDDConfiguration_Create Request message (GPSI or
External Group Identifier, AF Identifier, NIDD Duration, T8 Destination
Address, Requested Action, TLTRI, Reliable Data Service Configuration, MTC
Provider Information) to the NEF.
Reliable Data Service Configuration is an optional parameter that is used to
configure the Reliable Data Service (as defined in clause 5.31.6 of TS 23.501
[2]) including port numbers for originator application(s) and receiver
application(s). TLTRI is included in the request if the Requested Action is
set to \"Update\" or \"Cancel\", otherwise TLTRI is not included in the
request and the NEF assigns a TLTRI to the NIDD Configuration. If Reliable
Data Service Configuration is present, the Reliable Data Service Configuration
may include the mobile terminated and mobile originated serialization
format(s) that are supported by the AF for each port number.
NOTE 1: It is up to the AF to determine whether and if NIDD Duration can be
set to never expire.
NOTE 2: The AF is expected to be configured to use the same NEF as the one
selected by the SMF during the UE\'s establishment of the PDU Session used for
NEF based NIDD.
NOTE 3: When more than one AF is associated with a PDU Session, the parameters
that are provided in step 2 can be provisioned in the NEF based on operator
policy or configuration. In which case, any parameters that are provided in
step 2 that conflict with the provisioned values are ignored.
NOTE 4: If the AF does not indicate a serialization format, it is assumed that
the UE application is provisioned to know what serialization format will be
used for MT traffic or that the AF will use the same format that is used by
the associated MO traffic.
3\. If the Requested Action is set to \"Cancel\" it indicates that the purpose
of the request is to cancel the transaction identified by TLTRI and the flow
proceeds to step 7. If the Requested Action is set to \"Update\", the purpose
of the transaction is to update the parameters associated with the
configuration (i.e. Reliable Data Service). Otherwise, the request is for a
new NIDD configuration and the NEF stores the received GPSI or External Group
Identifier, AF Identifier, T8 Destination Address and NIDD Duration. If either
the AF is not authorised to perform this request (e.g. based on policies, if
the SLA does not allow for it) or the Nnef_NIDDConfiguration_Create Request is
malformed, the NEF performs step 7 and provides a Cause value appropriately
indicating the error. Depending on the configuration, the NEF may change the
NIDD Duration.
4\. The NEF sends an Nudm_NIDDAuthorisation_Get Request (GPSI or External
Group Identifier, S-NSSAI, DNN, AF Identifier, MTC Provider Information, NIDD
Duration, Update Notification Address) message to the UDM to authorise the
NIDD configuration request for the received External Group Identifier or GPSI.
NOTE 5: The NEF uses the AF Identifier, External Group Identifier or GPSI that
was obtained in step 2 to determine what DNN will be used to enable transfer
of unstructured data between the UE and the AF. This determination is based on
local policies.
NOTE 6: The MTC Provider Information in step 2 is an optional parameter. The
NEF should validate the provided MTC Provider Information and may override it
to a NEF selected MTC Provider Information based on configuration. How the NEF
determines the MTC Provider Information, if not present in step 2, is left to
implementation (e.g. based on the requesting AF).
5\. The UDM examines the Nudm_NIDDAuthorisation_Get Request message.
If the authorisation is successful and if an External Group Identifier was
included in step 4, the UDM maps the External Group Identifier to an Internal-
Group Identifier and a list of GPSIs and maps GPSIs to SUPIs.
NOTE 7: If External Group Identifier was included in step 4, how the UDM
selects a GPSI when multiple GPSIs are associated with the same SUPI is left
to implementation, e.g. based on the MTC Provider Information (if received) or
the default GPSI (if not received).
6\. The UDM sends an Nudm_NIDDAuthorisation_Get Response (single value or list
of (SUPI and GPSI), Result) message to the NEF to acknowledge acceptance of
the Nudm_NIDDAuthorisation_Get Request. If the UDM determines that the list
size exceeds the message capacity, the UDM shall segment the list and send it
in multiple messages (for details on segmentation, see TS 29.503 [52]). The
SUPI(s) and if available, the GPSI(s) (when Nnef_NIDDConfiguration_Create
Request contains an GPSI) are returned by the UDM in this response. This
allows the NEF to correlate the AF request received in step 2 of this
procedure with the SMF-NEF Connection to be established for each UE or each
group member UE. Depending on the configuration (e.g. based on DNN), the UDM
may change the NIDD Duration and include the updated value of the NIDD
Duration in the response to the NEF.
7\. The NEF sends a Nnef_NIDDConfiguration_Create Response (TLTRI, Maximum
Packet Size, Reliable Data Service Indication and Cause) message to the AF to
acknowledge acceptance of the Nnef_NIDDConfiguration_Create Request. If the
NIDD Configuration was accepted, the NEF assigns a TLTRI to the NIDD
Configuration and sends it to the AF. The NEF creates an association between
the TLTRI, GPSI or External Group Identifier, SUPI and PDU session ID which is
received from the SMF in step 2 of the SMF-NEF Connection procedure in clause
4.25.1. In the MT NIDD procedure, the NEF will use TLTRI and either GPSI or
External Group Identifier to determine the SUPI(s) and PDU session ID(s) of
PDU Session(s) for delivering unstructured data. In the MO NIDD procedure, the
NEF will use the SUPI(s) and PDU session ID(s) to obtain the TLTRI, GPSI. The
Reliable Data Service Indication indicates if the Reliable Data Service is
enabled in the NIDD configuration. The Maximum Packet Size is the maximum NIDD
packet size. The response may include an updated value of the NIDD Duration.
### 4.25.4 NEF Anchored Mobile Originated Data Transport
Figure 4.25.4-1 illustrates the NEF Anchored Mobile Originated Data Transport
procedure.
Figure 4.25.4-1: NEF Anchored Mobile Originated Data Transport procedure
1\. The UE sends a NAS message with unstructured data according to steps 1-4
of the procedure for UPF anchored Mobile Originated Data Transport in Control
Plane CIoT 5GS Optimisation (see clause 4.24.1). The Reliable Data Service
header is included if the Reliable Data Service is enabled.
2\. [Conditional] In the case of home-routed roaming the V-SMF sends the
Nsmf_PDUSession_TransferMOData request to the H-SMF including MO small data.
3\. The (H-)SMF sends the Nnef_SMContext_Delivery Request (User Identity, PDU
session ID, unstructured data) message to the NEF.
4\. When the NEF receives the unstructured data and finds an NEF PDU Session
context and the related T8 Destination Address, then it sends the unstructured
data to the AF that is identified by the T8 Destination address in a
Nnef_NIDD_DeliveryNotify Request (GPSI, unstructured data, Reliable Data
Service Configuration). If no T8 Destination address is associated with the
UE\'s PDN connection, the data is discarded, the Nnef_NIDD_DeliveryNotify
Request is not sent and the flow continues at step 6. The Reliable Data
Service Configuration is used to provide the AF with additional information
such as indicate if an acknowledgement was requested and port numbers for
originator application and receiver application, when the Reliable Data
Service is enabled.
Editor\'s note: It is left to Stage 3 whether or not the NEF aggregates
Nnef_NIDD_DeliveryNotify Request messages to the AF.
5\. The AF responds to the NEF with a Nnef_NIDD_DeliveryNotify Response
(Cause).
6\. The NEF sends Nnef_SMContext_Delivery Response to the SMF. If the NEF
cannot deliver the data, e.g. due to missing AF configuration, the NEF sends
an appropriate error code to the SMF.
7\. [Conditional] In the case of home-routed roaming, the H-SMF responds to
the V-SMF with a Nsmf_PDUSession_TransferMOData (Result Indication) Response.
### 4.25.5 NEF Anchored Mobile Terminated Data Transport
Figure 4.25.5-1 illustrates the procedure using which the AF sends
unstructured data to a given user as identified via External Identifier or
MSISDN.
Figure 4.25.5-1: NEF Anchored Mobile Terminated Data Transport
1a. If AF has already activated the NIDD service for a given UE and has
downlink unstructured data to send to the UE, the AF sends a
Nnef_NIDD_Delivery Request (GPSI, TLTRI, unstructured data, Reliable Data
Service Configuration) message to the NEF. Reliable Data Service Configuration
is an optional parameter that is used to configure the Reliable Data Service,
it may be used to indicate if a Reliable Data Service acknowledgement is
requested and port numbers for originator application and receiver
application.
1b. AMF indicates to NEF that the UE has become reachable. Based on this the
NEF re-starts delivering buffered unstructured data to the UE.
2\. The NEF determines the 5GS QoS Flow Context based on the DNN associated
with the NIDD configuration and the User Identity. If an NEF 5GS QoS Flow
Context corresponding to the GPSI included in step 1 is found, then the NEF
checks if the AF is authorised to send data and if it does not exceed its
quota or rate. If these checks fail, then steps 3-15 are skipped and an
appropriate error code is returned in step 17.
3\. The NEF forwards the unstructured data to the (H-)SMF using
Nsmf_NIDD_Delivery Request. If NEF has indicated support of Extended Buffering
in Nnef_SMContext_Create Response during SMF-NEF connection establishment,
then NEF keeps a copy of the data.
4\. In the roaming case, the H-SMF sends the Nsmf_PDUSession_TransferMTData to
the V-SMF including MT small data.
5\. The (V-)SMF determines whether Extended Buffering applies based on local
policy and based on whether NEF has indicated support of Extended Buffering in
Nnef_SMContext_Create Response during SMF-NEF connection establishment.
(V-)SMF compresses the header if header compression applies and forwards the
data and the PDU session ID to the AMF using the
Namf_Communication_N1N2MessageTransfer service operation. If Extended
Buffering applies, then (V-SMF) includes \"Extended Buffering support\"
indication in Namf_Communication_N1N2Message Transfer.
6\. If AMF determines the UE is unreachable for the SMF (e.g. if the UE is in
MICO mode or the UE is configured for extended idle mode DRX), then the AMF
rejects the request from the SMF. The AMF may include in the reject message an
indication that the SMF need not trigger the
Namf_Communication_N1N2MessageTransfer Request to the AMF, if the SMF has not
subscribed to the event of UE reachability.
If the SMF included Extended Buffering support indication, the AMF indicates
the Estimated Maximum Wait time, in the reject message, for the SMF to
determine the Extended Buffering time. If the UE is in MICO mode, the AMF
determines the Estimated Maximum Wait time based on the next expected periodic
registration timer update expiration or by implementation. If the UE is
configured for extended idle mode DRX, the AMF determines the Estimated
Maximum Wait time based on the start of next PagingTime Window. The AMF stores
an indication that the SMF has been informed that the UE is unreachable.
7\. In the roaming case V-SMF sends Nsmf_PDUSession_TransferMTData (Result
Indication) response to H-SMF. If the V-SMF receives an \"Estimated Maximum
Wait time\" from the AMF and Extended Buffering applies, the V-SMF also passes
the \"Estimated Maximum Wait time\" to the H-SMF.
8\. If the (H-)SMF receives a failure indication, (H-)SMF also sends a failure
indication to NEF. If (H-)SMF has received the \"Estimated Maximum Wait time\"
and Extended Buffering applies, the (H-)SMF includes Extended Buffering time
in the failure indication. The Extended Buffering time is determined by the
(H-)SMF and should be larger or equal to the Estimated Maximum Wait time. The
NEF stores the DL data for the Extended Buffering time. The NEF does not send
any additional Nsmf_NIDD_Delivery Request message if subsequent downlink data
packets are received. The procedures stop at this step.
9\. If the AMF determines the UE to be reachable in Step 5, then Steps 3 to 6
of the UPF anchored Mobile Terminated Data Transport in Control Plane CIoT 5GS
Optimisation procedure (clause 4.24.2) apply.
If the Reliable Data Service header indicates that the acknowledgement is
requested, then the UE shall respond with an acknowledgement to the DL data
that was received.
10\. If the AMF has paged the UE to trigger the NAS procedure in step 9, the
AMF shall initiate the UE configuration update procedure as defined in clause
4.2.4.2 to assign a new 5G-GUTI.
11\. If the UE has not responded to paging, the AMF sends a failure
notification to the (V-)SMF. Otherwise the procedure continues at step 13.
12\. In the roaming case, if V-SMF has received a failure notification from
AMF, then V-SMF sends Nsmf_PDUSession_TransferMTData (Result Indication)
response to H-SMF.
13\. If (H-)SMF receives a failure notification, then SMF indicates to the NEF
that the requested Nsmf_NIDD_Delivery has failed. If Extended Buffering
applies, then NEF purges the copy of the data. The procedure continues at step
17.
14\. Steps 9 to 11 of the UPF anchored Mobile Terminated Data Transport in
Control Plane CIoT 5GS Optimisation procedure (clause 4.24.2) apply.
15\. AMF informs (V-)SMF that data has been forwarded.
16\. In the roaming case, V-SMF sends Nsmf_PDUSession_TransferMTData (Result
Indication) response to H-SMF that the data has been forwarded.
17\. (H-)SMF indicates to NEF that the data has been forwarded. If Extended
Buffering applies then NEF purges the copy of the data.
18\. The NEF sends a Nnef_NIDD_Delivery Response (cause) to the AF.
The Reliable Data Service Acknowledgement Indication is used to indicate if an
acknowledgement was received from the UE for the MT NIDD. If the Reliable Data
Service was requested in step 1, then the Nnef_NIDD_Delivery Response is sent
to the AF after the acknowledgement is received from the UE or, if no
acknowledgment is received, then the Nnef_NIDD_Delivery Response is sent to
the AF with a cause value indicating that no acknowledgement was received.
### 4.25.6 NIDD Authorization Update
Figure 4.25.6-1 illustrates the procedure for updating or revoking an existing
NIDD Authorization.
The UDM may initiate the NIDD Authorization Update procedure with the NEF to
send updated Authorization information to the NEF.
Figure 4.25.6-1: NIDD Authorization Update procedure
0\. UDM provided a successful authorization for a NIDD configuration request
as defined in clause 4.25.3. The NIDD authorization is modified in UDM (e.g.
subscription withdrawal, DNN used for NIDD service is removed from the UE
subscription) before expiration of the NIDD Duration previously authorized.
1\. The UDM sends an NIDD Authorization Update information using
Nudm_NIDDAuthorisation_UpdateNotify Request (SUPI, GPSI, S-NSSAI, DNN, Result,
Cause, NIDD Duration) message to the NEF to update an user\'s NIDD
authorization.
2\. The NEF sends Nudm_NIDDAuthorisation_UpdateNotify Response message to the
UDM to acknowledge the authorization update.
3\. If the authorization is removed, the NEF should initiate the SMF-NEF
Connection release procedure as specified in clause 4.25.8.
4\. The NEF informs the AF that the user\'s authorisation status has changed
by sending Nnef_NIDDConfiguration_UpdateNotify Request (GPSI, TLTRI, Result,
Cause, NIDD Duration) message to the AF to update a user\'s NIDD
authorization.
5\. The AF responds to the NEF with Nnef_NIDDConfiguration_UpdateNotify
Response message.
### 4.25.7 SMF Initiated SMF-NEF Connection Release procedure
When the PDU Session Release is initiated and if a NEF has been selected as
anchor of the Control Plane CIoT 5GS Optimisation enabled PDU session which is
Unstructured PDU Session Type as described in clause 4.3.4.2, then the SMF
initiates a SMF-NEF Connection Release procedure towards the NEF corresponding
to the \"NEF ID\" for that DNN / S-NSSAI Combination.
Figure 4.25.7-1: SMF Initiated SMF-NEF Connection Release procedure
1\. The SMF performs Step 1 of PDU Session Release Procedure as described in
clause 4.3.4.2.
2\. If a NEF has been selected as anchor of the Control Plane CIoT 5GS
Optimisation enabled PDU session which is Unstructured PDU Session Type as
described in clause 4.3.2.2, the SMF initiates the SMF-NEF Connection release
for this PDU Session by sending Nnef_SMContext_Delete Request (User Identity,
PDU Session ID, S-NSSAI, DNN, Release Cause) message to the NEF.
3\. The NEF deletes the NEF PDU Session Context associated with the User
Identity and the PDU session ID. The NEF sends Nnef_SMContext_Delete Response
(Cause, [Small Data Control Rate Status], [APN Rate Control Status]) to the
SMF confirming release of the SMF-NEF session for the UE. The NEF includes
Small Data Rate Control Status if PDU Session used Small Data Rate Control.
4\. Steps 3-15 of PDU Session Release Procedure as described in clause
4.3.4.2.
### 4.25.8 NEF Initiated SMF-NEF Connection Release procedure
NEF initiates a SMF-NEF connection release procedure in the following cases:
\- when a NIDD Authorization Update Request from the UDM indicates that the
User is no longer authorized for NIDD, or
\- failure of AF or failure of AF connection, or
\- based on a request from the AF.
Figure 4.25.8-1 illustrates the NEF Initiated SMF-NEF Connection Release
procedure based on a request from AF.
Figure 4.25.8-1: NEF Initiated SMF-NEF Connection Release procedure on the AF
request
1\. AF may indicate that a User\'s NIDD SMF-NEF connection is no longer needed
by invoking Nnef_NIDDConfiguration_Delete Request (TLTRI) toward NEF.
2\. The NEF deletes the NEF PDU session Context associated with the TLTRI and
acknowledges the deletion of the NIDD configuration by invoking
Nnef_NIDDConfiguration_Delete Response to the AF.
3\. The NEF notifies the deletion of the SM context information by invoking
Nnef_SMContext_DeleteNotify Request toward the SMF.
4\. The SMF acknowledges the notification by invoking
Nnef_SMContext_DeleteNotify Response to the NEF.
5\. If the PDU session is not longer needed, the SMF performs steps 2-11 of
PDU Session Release Procedure (see clause 4.3.4.2).
Figure 4.25.8-2 illustrates the NEF Initiated SMF-NEF Connection Release
procedure based on the NIDD Authorization Update.
Figure 4.25.8-2: NEF Initiated SMF-NEF Connection Release procedure on the
NIDD Authorization Update
1\. On NIDD Authorization Update by UDM, NEF may determine that it needs to
release the corresponding SMF-NEF Connection.
2\. The NEF deletes the corresponding NEF PDU session Context and notifies the
deletion of the SM context information by invoking Nnef_SMContext_DeleteNotify
Request toward the SMF.
3\. The SMF acknowledges the notification by invoking
Nnef_SMContext_DeleteNotify Response to the NEF.
4\. If the PDU session is not longer needed, the SMF performs steps 2-11 of
PDU Session Release Procedure (see clause 4.3.4.2).
### 4.25.9 NEF Anchored Group NIDD via NEF anchored unicast MT data
Figure 4.25.9-1 illustrates the procedure by which the AF can send a Group
NIDD addressed to External Group Identifier. It is a pre-requisite assumption
that the NEF has already resolved the mapping of External Group Identifier to
individual SUPIs with the help of UDM during NIDD Configuration procedure as
specified in clause 4.25.3. Standalone MT NIDD procedure specified in clause
4.25.5 is re-used by NEF to unicast the MT data to each UE.
Figure 4.25.9-1: NEF Anchored Group NIDD via NEF anchored unicast data
1\. If AF has already used the NIDD Configuration procedure of clause 4.25.3
to activate the NIDD service for a group of UEs and has unstructured data to
send to the group identified by an External Group Identifier, the AF sends a
Nnef_NIDD_Delivery Request (External Group Identifier, TLTRI, unstructured
data, Reliable Data Service Configuration) message to the NEF. Reliable Data
Service Configuration is an optional parameter that is used to configure the
Reliable Data Service. When unstructured data is sent to an External Group
Identifier, the AF shall not request acknowledgement in the Reliable Data
Service Configuration.
2\. Based on the existing NIDD configuration of the UE Group (see clause
4.25.3), the NEF sends a single Nnef_NIDD_Delivery Response to AF to
acknowledge the acceptance of the Group NIDD delivery request in step 1.
3\. The NEF uses the NEF anchored Mobile Terminated Data Transport procedure
that is specified in steps 2-16 in clause 4.25.5 to send the same MT NIDD to
each UE in the group.
4\. After executing step 3 for all UEs in the group, the NEF sends aggregated
response in Nnef_NIDD_GroupDeliveryNotify message. If some target UEs were not
reachable due to UE power saving, then the NEF does not buffer the MT NIDD,
but it may include indication on the expected reachability of those UEs in its
response to AF in this step. If the delivery towards certain UE failed, the
NEF may include the cause value.
## 4.26 Network Function/NF Service Context Transfer Procedures
### 4.26.1 General
Network Function/NF Service Context Transfer Procedures allow transfer of
Service Context of a NF/NF Service from a Source NF/NF Service Instance to the
Target NF/NF Service Instance, e.g. before the Source NF/NF Service can
gracefully close its NF/NF Service. If SMF sets are deployed this applies from
an SMF instance within an SMF set to an SMF instance of another SMF set.
A request (push procedure, see clause 4.26.2) or response (pull procedure, see
clause 4.26.3) from a Source NF/NF Service Instance to a Target NF/NF Service
Instance contains either
\- the context being transferred, e.g. SM context (direct mode); or
\- optionally, an endpoint address from which Target NF/NF Service Instance
can retrieve the context, see TS 29.501 [62] (indirect mode).
It assumes that access to a given context endpoint address can be restricted
to single Target NF/NF Service Instance.
NOTE: Which procedures need to be executed for indirect mode is part of the
specific context transfer procedures as specified in clause 4.26.5.
### 4.26.2 NF/NF Service Context Transfer Push Procedure
Figure 4.26.2-1: NF/NF Service Context Push procedure
1\. When triggered, the Source NF/NF Service acting as NF Service Consumer
sends its Context (e.g. UE Context or SM context) to the Target NF/NF Service
acting as NF Service producer. This may trigger several other procedures that
ensure all necessary NF/NF Services are being updated and set up with
necessary information about the new context location.
2\. The NF Service Consumer receives the response indicating the result of the
operation (successful or not successful). When all procedures have been
executed successfully the Target NF/NF Service can continue to serve the
original NF Service Consumers of the Source NF/NF Service, which e.g. can be
shut down gracefully.
NOTE: After resumption of a new service transaction, it may be necessary to
contact the UE using existing procedures.
### 4.26.3 NF/NF Service Context Transfer Pull procedure
Figure 4.26.3-1: NF/NF Service Context Pull procedure
1\. When triggered, the Target NF/NF Service as an NF Service Consumer
requests a Context (e.g. UE context or SM context) from the Source NF as a NF
Service Producer. This may trigger several other procedures that ensure all
necessary NF/NF services are being updated and set up with necessary
information about the new context location.
NOTE 1: Which procedures need to be executed and what information needs to be
updated is part of the specific context transfer procedures as specified in
clause 4.26.5.
2\. The NF Service Consumer receives the Context and the operation was
successful. When all procedures have been executed successfully the Target
NF/NF Service can continue to serve the original NF Service Consumers of the
Source NF/NF Service, which e.g. can be shut down gracefully.
NOTE 2: After resumption of a new service transaction, it may be necessary to
contact the UE using existing procedures.
### 4.26.4 Context Transfer due to decommissioning
In the case of decommissioning, the Old NF may inform NRF that it is about to
be decommissioned. NRF will in this case not include the NF profile of the Old
NF in any discovery result from the NF/NF service discovery procedure. The NRF
will also notify any consumers subscribed to changes to this resource.
### 4.26.5 SMF Service Context Transfer procedures
#### 4.26.5.1 General
This clause lists the context-specific transfer procedures between different
SMF Sets supporting the same DNN/S-NSSAI pair supported for SM Contexts (i.e.
SMF contexts).
#### 4.26.5.2 I-SMF Context Transfer procedure
Old I-SMF triggered from O&M procedure sends
Nsmf_PDUSession_SMContextStatusNotify (I-SMF transfer indication, New SMF ID
or SMF set ID) to AMF.
Steps 2-25 in clause 4.23.4.3 follows, where in step 2 AMF selects the
indicated I-SMF, or selects the I-SMF from the indicated SMF set.
#### 4.26.5.3 SMF Context Transfer procedure, LBO or no Roaming, no I-SMF
In the case of dynamic IP address assignment (IPv4 address and/or IPv6
prefix), the procedure in figure 4.26.4.1.1-1 assumes that, if the UE IP
address is received from Old SMF, the control of the IP address(es) assigned
by Old SMF is moved to New SMF by O&M procedures. New SMF is in full control
of the concerned IP address(es) when the transfer is complete.
NOTE 1: If UPF has the IP point of presence from the DNN, the same UPF is
used.
Figure 4.26.4.1.1-1: Context transfer of a PDU session
1\. SM context transfer is triggered, e.g. by OAM to Old SMF including SUPI,
PDU session ID and New SMF ID or SMF set ID. The SMF selection by using SMF
set ID not applicable when the IP range is managed by SMF.
2\. [Conditional - depending on current subscription] Old SMF subscribes to
events when UE status becomes CM-IDLE or CM-CONNECTED with RRC_INACTIVE state
(Namf_EventExposure_Subscribe).
3\. [Conditional - depending on the event] The AMF detects the monitored event
occurs and sends the event report by means of Namf_EventExposure_Notify
message, to Old SMF.
4\. From Old SMF to AMF Nsmf_PDUSession_SMContextStatusNotify (SMF transfer
indication, Old SMF ID, New SMF ID or SMF set ID from Step 1, PDU Session ID,
SUPI, SM Context ID).
5\. AMF, or SCP if delegated discovery is used, uses New SMF ID or SMF set ID
to select New SMF and sends Nsmf_PDUSession_CreateSMContext request (PDU
Session ID, Old SMF ID, SM Context ID in Old SMF, UE location info, Access
Type, RAT Type, Operation Type, SMF transfer indication). The same PDU Session
ID as received in step 4 is used. If the AMF receives the service request from
the UE for the PDU session(s) affected by this procedure the AMF delays the
transaction with the SMF until the step 13 completes. If the AMF receives the
UE context transfer request from the other AMF due to the UE mobility, the AMF
defers the response until the step 13 completes. Also, to avoid infinite
waiting time, the AMF starts a locally configured guard timer upon sending the
request to the SMF and the AMF decides the procedure has failed at expiry of
the guard timer.
NOTE 2: Either delay or failure of the SM Context transfer may incur timeout
or failure in UE procedure(s).
6\. From New SMF to Old SMF SMF Nsmf_PDUSession_ContextRequest request (SM
Context type, SM Context ID, SMF transfer indication). If New SMF is not
capable to transfer this SM Context (e.g. it is not responsible for the IP
range), steps 9 to 12 are skipped.
7\. Old SMF releases the N4 session with the UPF by sending a flag notifying
the UPF about the expected re-establishment of the N4 session for the same PDU
session. Based on this, if supported, the UPF should delay the release of the
N4 session up to step 10.2 to allow for uninterrupted packet handling until
the N4 session is re-established by New SMF.
8\. From Old SMF to New SMF Nsmf_PDUSession_ContextRequest response (SM
Context or endpoint address where New SMF can retrieve SM Context). The SM
Context includes the IP address(es) if the PDU session is of type IPv4, IPv6
or IPv4v6, or the Ethernet MAC address(es) if the PDU session if of type
Ethernet as well as the UPF to be selected by New SMF. Old SMF starts a timer
to monitor the SMF context transferring process.
9\. [Conditional] If dynamic PCC is used for the PDU Session, New SMF sets up
a new policy association towards PCF.
10.1. UPF receives a N4 session establishment request for the same PDU session
from step 7. The parameters from step 8 and if applies, step 9 are used.
10.2. New SMF performs a full re-establishment of the N4 session, establishing
a new N4 session. All information related to the N4 session of Old SMF that is
not used by the N4 session of New SMF is removed from UPF if not already done.
11\. New SMF registers to UDM. The information stored at the UDM includes
SUPI, SMF identity and the associated DNN and PDU Session ID.
12\. New SMF subscribes to subscription changes for the UE.
13\. From New SMF to AMF: Nsmf_PDUSession_CreateSMContext response. If this
response indicates a redirect (e.g. another SMF in the set), the procedure
moves to step 5 with the indicated endpoint address as target.
14\. UDM notifies Old SMF that it is deregistered for the PDU Session by
sending Nudm_UECM_DeregistrationNotification, optionally including New SMF ID
15\. [Conditional] If 14 was not received and the timer from step 8 expires,
Old SMF re-establishes the N4 session. The UPF may for the purpose use the
information stored in step 7. In this case, the procedure ends here.
16\. [Conditional] If Nudm_UECM_DeregistrationNotification in step 14 was
received, Old SMF removes its policy association with PCF. Any changes to the
QoS rules need to be sent to the UE when it becomes active.
17\. Old SMF releases any internal resources corresponding to the indicated
PDU session. Subscribers to SMContextStatusNotify for the transferred SM
context are notified of the context transfer and optionally of the new
location of the transferred SM context.
## 4.27 Procedures for Enhanced Coverage Restriction Control via NEF
### 4.27.1 General
The support for Enhanced Coverage Restriction Control via NEF enables AF to
query status of Enhanced Coverage Restriction or enable/disable Enhanced
Coverage Restriction per individual UEs. Figure 4.27.1-1 shows the procedure
for Enhanced Coverage Restriction Control via NEF.
Figure 4.27.1-1: Enhanced Coverage Restriction Control via NEF
1\. The AF may enable or disable Enhanced Coverage Restriction or query the
status of Enhanced Coverage Restriction by sending the
Nnef_ECRestriction_Update Request or Nnef_ECRestriction_Get Request
respectively. Both the service operations require GPSI and AF Identifier as
required input and optionally MTC Provider Information.
2\. Based on operator policies, if the AF is not authorized to perform the
request (e.g. if the SLA does not allow for it) or if the AF has exceeded its
quota or rate of submitting Enhanced Coverage Requests, the NEF performs Step
8 and provides a cause value appropriately indicating the failure result.
3\. The NEF sends the Nudm_ParameterProvision_Update Request to update the
subscription data for Enhanced Coverage Restriction. The NEF sends the
Nudm_SDM_Get Request service operation to query the status of Enhanced
Coverage Restriction.
4\. The UDM checks the GPSI and examines whether any included parameters are
in the range acceptable by the operator, whether Enhanced Coverage Restriction
is supported by the serving NF (i.e. AMF in this case). If this check fails,
the UDM provides a cause value indicating the reason for failure condition to
the NEF in step 7
In the case of Nudm_ParameterProvision_Update Request, the UDM sets the
Enhanced Coverage Restriction information to the appropriate value and
procedure continues to step 5.
In the case of Nudm_SDM_Get Request, the UDM may retrieve the status of
Enhanced Coverage Restriction information from UDR using Nudr_DM_Query Request
and skip steps 5 and 6.
5\. The UDM sends Nudm_SDM_Notification and provide AMF with updates Enhanced
Coverage Restriction information.
6\. The AMF updates the Enhanced Coverage Restriction information stored in
the UE context. The AMF will transfer Enhanced Coverage Restriction
information stored as part of its UE context during AMF change.
NOTE: UE is informed of the updated Enhanced Coverage Restriction information
at the next Registration procedure or based on the local policy the network
can de-register the UE indicating re-registration is required.
7\. The UDM sends the Nudm_ParameterProvision_Update Response or Nudm_SDM_Get
Response to the NEF.
8\. The NEF sends the Nnef_ECRestriction_Update Response or
Nnef_ECRestriction_Get Response to the AF.
## 4.28 Subscription-based distribution of timing information
### 4.28.1 General
The distribution of 5G Clock (5G Access Stratum-based Time Distribution) and
the (g)PTP domain synchronization ((g)PTP-based Time Distribution) may be
controlled based on subscription data.
### 4.28.2 5G Access Stratum-based Time Distribution
#### 4.28.2.1 Control of access stratum time synchronization service without
AF request
The control of 5G Access Stratum-based Time Distribution for a UE is performed
by the AMF according to parameters retrieved in the Access and Mobility
Subscription data.
Figure 4.28.2.1-1: Subscription-based control of 5G access stratum-based time
distribution
1\. The UE performs the registration procedure as described in clause
4.2.2.2.2. The AMF retrieves the Access and Mobility Subscription data
including the Access Stratum Time Synchronization Service Authorization. The
Access and Mobility Subscription data may further include the Uu time
synchronization error budget, one or more periods of start and stop times
defining active times, a coverage area, clock quality detail level, and the
acceptance criteria for the UE, as described in clause 5.27.1.11 of TS 23.501
[2].
As part of this, the AMF shall, if supported, store the 5G access stratum time
distribution indication (enable, disable), the Uu time synchronization error
budget, clock quality detail level and clock quality acceptance criteria, and
the UE reconnection indication in the UE context in AMF.
2\. The AMF performs the control according to the subscription data as
follows.
If the AMF receives start and stop times then the AMF sends the message to the
NG-RAN to enable or disable the 5G access stratum time distribution according
to the expiry of start and stop times if the UE is in CM-CONNECTED state. If
the UE is in CM-IDLE state when a Start time condition is met, then the AMF
pages the UE and provides the 5G access stratum distribution indication to NG-
RAN as part of the subsequent service request procedure initiated by the UE in
the response to the paging.
If the AMF received Time Synchronization Coverage Area information as part of
the Access and Mobility Subscription data including the Access Stratum Time
Synchronization Service Authorization, the AMF determines if the Coverage Area
information shall trigger an activation or deactivation of the access stratum
time distribution:
\- If the UE has moved inside the Coverage Area, then the AMF determines to
enable access stratum time distribution for the UE.
\- If the UE has moved outside the Coverage Area, then the AMF determines to
disable access stratum time distribution for the UE.
The AMF determines whether the UE moves inside/outside of the Coverage Area
specified in the clause 5.27.1.11 of TS 23.501 [2]
The AMF shall send the UE reconnection indication to the UE updating the UE
configuration as defined in clause 4.2.2 or clause 4.2.4.2.
3\. The AMF sends N2 message (UE Context Modification Request) to the NG-RAN.
The AMF sends the 5G access stratum time distribution indication (enable,
disable), the Uu time synchronization error budget, clock quality detail level
and clock quality acceptance criteria when they are available, to NG-RAN
during mobility registration, AM policy modification, Service Request, N2
Handover and Xn handover as specified in TS 38.413 [10]. The NG-RAN node
shall, if supported, store the information in the UE Context. Based on this
information, the NG-RAN node provides the 5GS access stratum time to the UE
according to the Uu time synchronization error budget as provided by the
TSCTSF (if supported by UE and NG-RAN) and NG-RAN provides timing
synchronization status reports to the UE (as described in clause 4.15.9.5.2).
### 4.28.3 (g)PTP-based Time Distribution
#### 4.28.3.1 Control of (g)PTP time synchronization service without AF
request
The TSCTSF may use the subscription data to control the (g)PTP-based time
distribution without AF request.
Figure 4.28.3.1-1: Subscription based control of (g)PTP time synchronization
service without AF request
1\. The UE performs the UE-requested PDU Session Establishment.
2\. The PCF determines if the PDU Session is potentially impacted by time
synchronization service and invokes Npcf_PolicyAuthorization_Notify service
operation to the TSCTSF discovered and selected for time synchronization to
indicate there is a UE connected to a specific DNN/S-NSSAI configured for
(g)PTP-based time distribution. The TSCTSF retrieves the UE SUPI using IP
address and /or DNN/S-NSSAI from BSF as specified in the clause 4.15.10.
3\. The TSCSTF uses the SUPI to retrieve the Time Synchronization Subscription
Data available at the UDM.
4\. The TSCTSF controls the (g)PTP-based time synchronization service based on
the Time Synchronization Subscription Data as defined in clause 5.27.1.11 of
TS 23.501 [2]. If the Time Synchronization Subscription Data contains:
a) one or more Subscribed Time Synchronization Service ID(s) that can be
mapped to PTP instance configuration(s), the TSCTSF determines if one or more
of the PTP instance configurations match with the DNN/S-NSSAI of the given PDU
Session. The TSCTSF stores information that the time-synchronization service
cannot be controlled by an AF for the given SUPI.
b) An indication that an AF-requested (g)PTP time synchronization service is
allowed for the given UE and DNN/S-NSSAI, the TSCTSF adds the given SUPI to
the list of SUPIs for which the time-synchronization service can be controlled
by an AF.
c) If TSCTSF receives neither a) nor b), the TSCTSF assumes that the time-
synchronization service cannot be controlled by an AF for the given SUPI. The
TSCTSF releases the AF-session with the PCF.
5\. For each matching PTP instance configuration determined in step 4, if no
PTP instance exists for the given PTP instance configuration, the TSCTSF
initializes the PTP instance in 5GS as described in clause K.2.2 of TS 23.501
[2]. The TSCTSF configures a PTP port in DS-TT and adds it to the
corresponding PTP instance in NW-TT as described in clause K.2.2 of TS 23.501
[2]. The TSCTSF uses the procedure in clause 4.15.9.4 to activate or modify
the 5G access stratum time distribution for the UE.
If the PTP instance configuration referenced by the Time Synchronization
Subscription data for the UE contains start and stop times or a coverage area,
the TSCTSF updates the PTP port for the corresponding PTP instance as defined
in clause 5.27.1.11 of TS 23.501 [2]. The TSCTSF uses the procedure in clause
4.15.9.4 to activate or deactivate the 5G access stratum time distribution for
the UEs that are part of the impacted PTP instance.
6\. If a coverage area is included in the subscription data for UE related to
the PTP instance, TSCTSF discovers the AMF(s) serving the TA(s) defined for
the time synchronization coverage area (Area of Interest) and subscribe to
receive notifications in UEs presence in the Area of Interest. Based on the
outcome the TSCTSF determines whether to activate or deactivate the time
synchronization service for the impacted PTP instance. The TSCTSF will
activate/deactivate the service by modifying the PTP instance configuration as
described in clause K.2.2 of TS 23.501 [2].
# 5 Network Function Service procedures
## 5.1 Network Function Service framework procedures
### 5.1.1 Network Function Service Discovery
The network function (NF) within the core network may expose its capability as
service via its service based interfaces, which can be re-used by other NFs.
Unless the expected NF information is locally configured on requester NF, e.g.
the expected NF is in the same PLMN, the NF service discovery is implemented
via the NF discovery.
## 5.2 Network Function services
### 5.2.1 General
### 5.2.2 AMF Services
#### 5.2.2.1 General
The following table shows the AMF Services and AMF Service Operations.
Table 5.2.2.1-1: List of AMF Services
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Known | | | Operations | | Consumer(s) | | | | Semantic | | +================+================+================+================+ | Namf\ | UEC | Re | Peer AMF | | _Communication | ontextTransfer | quest/Response | | +----------------+----------------+----------------+----------------+ | | C | Re | Peer AMF | | | reateUEContext | quest/Response | | +----------------+----------------+----------------+----------------+ | | Rel | Re | Peer AMF | | | ocateUEContext | quest/Response | | +----------------+----------------+----------------+----------------+ | | CancelReloc | Re | Peer AMF | | | ationUEContext | quest/Response | | +----------------+----------------+----------------+----------------+ | | Re | Re | Peer AMF | | | leaseUEContext | quest/Response | | +----------------+----------------+----------------+----------------+ | | Registrati | Re | Peer AMF | | | onStatusUpdate | quest/Response | | +----------------+----------------+----------------+----------------+ | | N | Su | PCF, LMF, Peer | | | 1MessageNotify | bscribe/Notify | AMF | +----------------+----------------+----------------+----------------+ | | N1N2Me | | PCF | | | ssageSubscribe | | | +----------------+----------------+----------------+----------------+ | | N1N2Mess | | PCF | | | ageUnSubscribe | | | +----------------+----------------+----------------+----------------+ | | N1N2M | Re | SMF, SMSF, | | | essageTransfer | quest/Response | PCF, LMF | +----------------+----------------+----------------+----------------+ | | N1N | Su | SMF, SMSF, | | | 2TransferFailu | bscribe/Notify | PCF, LMF | | | reNotification | | | +----------------+----------------+----------------+----------------+ | | N | Su | NOTE 1 | | | 2InfoSubscribe | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | N2I | | NOTE 1 | | | nfoUnSubscribe | | | +----------------+----------------+----------------+----------------+ | | N2InfoNotify | | AMF, LMF | +----------------+----------------+----------------+----------------+ | | EBIAssignment | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | AMFStatusC | Su | SMF, PCF, NEF, | | | hangeSubscribe | bscribe/Notify | SMSF, UDM | +----------------+----------------+----------------+----------------+ | | AMFStatusCha | Su | SMF, PCF, NEF, | | | ngeUnSubscribe | bscribe/Notify | SMSF, UDM | +----------------+----------------+----------------+----------------+ | | AMFStat | Su | SMF, PCF, NEF, | | | usChangeNotify | bscribe/Notify | SMSF, UDM | +----------------+----------------+----------------+----------------+ | | NonUeN2M | Re | Peer AMF, | | | essageTransfer | quest/Response | CBCF, PWS-IWF, | | | | | LMF, TSCTSF | +----------------+----------------+----------------+----------------+ | | NonUeN | Su | CBCF, PWS-IWF, | | | 2InfoSubscribe | bscribe/Notify | TSCTSF | +----------------+----------------+----------------+----------------+ | | NonUeN2I | | CBCF, PWS-IWF, | | | nfoUnSubscribe | | TSCTSF | +----------------+----------------+----------------+----------------+ | | Non | | CBCF, PWS-IWF, | | | UeN2InfoNotify | | LMF, TSCTSF | +----------------+----------------+----------------+----------------+ | Namf\ | Subscribe | Su | NEF, SMF, UDM, | | _EventExposure | | bscribe/Notify | NWDAF, LMF, | | | | | GMLC, TSCTSF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | Su | NEF, SMF, UDM, | | | | bscribe/Notify | NWDAF, LMF, | | | | | GMLC, TSCTSF | +----------------+----------------+----------------+----------------+ | | Notify | Su | NEF, SMF, UDM, | | | | bscribe/Notify | NWDAF, LMF, | | | | | GMLC, TSCTSF | +----------------+----------------+----------------+----------------+ | Namf_MT | Enable | Re | SMSF, SMF | | | UEReachability | quest/Response | | +----------------+----------------+----------------+----------------+ | | ProvideDomai | Re | UDM | | | nSelectionInfo | quest/Response | | +----------------+----------------+----------------+----------------+ | | EnableGro | Re | SMF | | | upReachability | quest/Response | | +----------------+----------------+----------------+----------------+ | | UEReachabi | Su | SMF | | | lityInfoNotify | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | Namf_Location | ProvideP | Re | GMLC | | | ositioningInfo | quest/Response | | +----------------+----------------+----------------+----------------+ | | EventNotify | Su | GMLC | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Provi | Re | UDM | | | deLocationInfo | quest/Response | | +----------------+----------------+----------------+----------------+ | | CancelLocation | Re | GMLC | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | NOTE 1: In | | | | | this Release | | | | | of the | | | | | specification | | | | | no known | | | | | consumer is | | | | | identified to | | | | | use this | | | | | service | | | | | operation. | | | | +----------------+----------------+----------------+----------------+
#### 5.2.2.2 Namf_Communication service
##### 5.2.2.2.1 General
**Service description:** This service enables an NF to communicate with the UE
through N1 NAS messages or with the AN (both UE and non UE specific). The
service operations defined below allow the NF to communicate with the UE and
the AN. The following are the key functionalities of this NF service.
\- Provide service operations for transporting N1 messages to the UE;
\- Allow NFs to subscribe and unsubscribe for notifications of specific N1
messages from the UE;
\- Allow NFs to subscribe and unsubscribe for notifications about specific
information from AN;
\- Provide service operations for initiating N2 messages towards the AN;
\- Security Context Management; and
\- UE information management and transfer (including its security context).
##### 5.2.2.2.2 Namf_Communication_UEContextTransfer service operation
**Service operation name:** Namf_Communication_UEContextTransfer
**Description:** Provides the UE context to the consumer NF.
**Input, Required:** 5G-GUTI or SUPI, Access Type, Reason.
**Input, Optional:** Integrity protected message from the UE that triggers the
context transfer.
**Output, Required:** The UE context of the identified UE or only the SUPI and
an indication that the Registration Request has been validated. The UE context
is detailed in table 5.2.2.2.2-1.
**Output, Optional:** Mobile Equipment Identifier (if available), Allowed
NSSAI, Mapping Of Allowed NSSAI.
See clause 4.2.2.2.2 for example of usage of this service operation. If the
consumer NF sent an integrity protected message from the UE, the AMF uses it
to verify whether this request is permitted to retrieve the UE context of the
UE. If it is permitted, the AMF provides UE context to the consumer NF in the
Namf_Communication_UEContextTransfer response. The following table illustrates
the UE Context:
Table 5.2.2.2.2-1: UE Context in AMF
+----------------------------------+----------------------------------+ | Field | Description | +==================================+==================================+ | SUPI | SUPI (Subscription Permanent | | | Identifier) is the subscriber\'s | | | permanent identity in 5GS. | +----------------------------------+----------------------------------+ | Routing Indicator | UE\'s Routing Indicator that | | | allows together with SUCI/SUPI | | | Home Network Identifier to route | | | network signalling to AUSF and | | | UDM instances capable to serve | | | the subscriber. | +----------------------------------+----------------------------------+ | Home Network Public Key | UE\'s Network Public Key | | identifier | identifier that may be used | | | together with SUCI/SUPI Home | | | Network Identifier and Routing | | | Indicator to route network | | | signalling to AUSF and UDM | | | instances capable to serve the | | | subscriber. | +----------------------------------+----------------------------------+ | AUSF Group ID | The AUSF Group ID for the given | | | UE. | +----------------------------------+----------------------------------+ | UDM Group ID | The UDM Group ID for the UE. | +----------------------------------+----------------------------------+ | PCF Group ID | The PCF Group ID for the UE. | +----------------------------------+----------------------------------+ | SUPI-unauthenticated-indicator | This indicates whether the SUPI | | | is unauthenticated. | +----------------------------------+----------------------------------+ | GPSI | The GPSI(s) of the UE. The | | | presence is dictated by its | | | storage in the UDM. | +----------------------------------+----------------------------------+ | 5G-GUTI | 5G Globally Unique Temporary | | | Identifier. | +----------------------------------+----------------------------------+ | PEI | Mobile Equipment Identity. | +----------------------------------+----------------------------------+ | Internal Group ID-list | List of the subscribed internal | | | group(s) that the UE belongs to. | +----------------------------------+----------------------------------+ | UE Specific DRX Parameters | UE specific DRX parameters for | | | E-UTRA and NR. | +----------------------------------+----------------------------------+ | UE Specific DRX Parameters for | UE Specific DRX Parameters for | | NB-IoT | NB-IoT. | +----------------------------------+----------------------------------+ | UE MM Network Capability | Indicates the UE MM network | | | capabilities. | +----------------------------------+----------------------------------+ | 5GMM Capability | Includes other UE capabilities | | | related to 5GCN or interworking | | | with EPS. | +----------------------------------+----------------------------------+ | Events Subscription | List of the event subscriptions | | | by other CP NFs. Indicating the | | | events being subscribed as well | | | as any information on how to | | | send the corresponding | | | notifications. | +----------------------------------+----------------------------------+ | LTE-M Indication | Indicates if the UE is a | | | Category M UE. This is based on | | | indication provided by the | | | NG-RAN or by the MME at EPS to | | | 5GS handover. | +----------------------------------+----------------------------------+ | NR RedCap Indication | Indicates if the UE is a NR | | | RedCap UE. This is based on | | | indication provided by the | | | NG-RAN as specified in | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | MO Exception Data Counter | MO Exception Data Counter used | | | for Small Data Rate Control | | | purposes, see clause 5.31.14.3 | | | of TS 23.501 [2]. | +----------------------------------+----------------------------------+ | AMF-Associated Expected UE | Indicates per UE the Expected UE | | Behaviour parameters | Behaviour Parameters and their | | | corresponding validity times as | | | specified in clause 4.15.6.3. | +----------------------------------+----------------------------------+ | Disaster Roaming | Indicates the UE is registered | | | for Disaster Roaming service. | +----------------------------------+----------------------------------+ | PLMN with disaster condition | This is the PLMN of the UE which | | | has faced disaster condition. | +----------------------------------+----------------------------------+ | SNPN Onboarding indication | Indicates that the UE is | | | registered for onboarding in an | | | SNPN. | +----------------------------------+----------------------------------+ | **For the AM Policy | | | Association:** | | +----------------------------------+----------------------------------+ | AM Policy Information | Information on AM policy | | | provided by PCF. It includes the | | | Policy Control Request Triggers | | | and Access and mobility related | | | policy information as described | | | in clauses 6.1.2.5 and 6.5 of | | | TS 23.503 [20] except RFSP | | | Index in Use Validity Time. | +----------------------------------+----------------------------------+ | PCF ID | The identifier of the PCF for AM | | | Policy. In roaming, the | | | identifier of V-PCF (NOTE 2). | +----------------------------------+----------------------------------+ | **For the UE Policy | | | Association:** | | +----------------------------------+----------------------------------+ | Trigger Information | The Policy Control Request | | | Triggers on UE policy provided | | | by PCF. | +----------------------------------+----------------------------------+ | PCF ID(s) | The identifier of the PCF for UE | | | Policy. In roaming, the | | | identifiers of both V-PCF and | | | H-PCF (NOTE 1) (NOTE 2). | +----------------------------------+----------------------------------+ | **For the UE NWDAF | | | association:** | | +----------------------------------+----------------------------------+ | NWDAF ID(s) | Indicating the NWDAF ID(s) | | | (instance ID(s) or Set ID(s)) | | | used for the UE specific | | | Analytics. | +----------------------------------+----------------------------------+ | Subscription Correlation ID(s) | Active UE-related analytics | | | subscription(s) for each given | | | NWDAF ID. | +----------------------------------+----------------------------------+ | Analytics ID(s) | Analytics ID(s) per NWDAF ID. | +----------------------------------+----------------------------------+ | Analytics specific data | Additional information on the | | | Analytics ID(s) the AMF is | | | subscribed related to the UE | | | specific Analytics, i.e. per | | | Analytics ID it contains the | | | following parameters: Analytics | | | Filter Information, Target of | | | Analytics reporting, Analytics | | | Reporting Info. | +----------------------------------+----------------------------------+ | **Other information** | | +----------------------------------+----------------------------------+ | Subscribed RFSP Index | An index to specific RRM | | | configuration in the NG-RAN that | | | is received from the UDM. | +----------------------------------+----------------------------------+ | RFSP Index in Use | An index to specific RRM | | | configuration in the NG-RAN that | | | is currently in use. | +----------------------------------+----------------------------------+ | 5G access stratum time | The 5G access stratum time | | distribution indication | distribution indication to be | | | provided to RAN based on the 5G | | | access stratum time distribution | | | indication received from the | | | PCF. | +----------------------------------+----------------------------------+ | Uu time synchronization error | The Uu time synchronization | | budget | error budget to be provided to | | | RAN based on the Uu time | | | synchronization error budget | | | received from the PCF. | +----------------------------------+----------------------------------+ | Clock quality detail level | It indicates whether and which | | | clock quality information to | | | provide to the UE and can take | | | one of the following values | | | \"clock quality metrics\" or | | | \"acceptable/not acceptable | | | indication\". | +----------------------------------+----------------------------------+ | Clock quality acceptance | Indicates acceptable criteria | | criteria | for the UE based on the | | | attributes defined in Table | | | 5.27.1.12-1 of TS 23.501 [2]. | +----------------------------------+----------------------------------+ | UE reconnection indication | Indicates to the UE to reconnect | | | to the network in the case the | | | UE determines that the reference | | | report ID has changed as | | | described in clause 5.27.1.12 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | UE-AMBR in serving network | The UE-AMBR that has been sent | | | to RAN (e.g. based on subscribed | | | UE-AMBR from UDM or UE-AMBR | | | received from PCF) | +----------------------------------+----------------------------------+ | List of UE-Slice-MBR(s) | The list of UE-Slice-MBR if | | | applicable. There is a single | | | uplink and a single downlink | | | value per S-NSSAI. | +----------------------------------+----------------------------------+ | MICO Mode Indication | Indicates the MICO Mode for the | | | UE. | +----------------------------------+----------------------------------+ | Extended idle mode DRX | Negotiated extended idle mode | | Parameters | DRX parameters. | +----------------------------------+----------------------------------+ | Active Time Value for MICO mode | UE specific Active Time value | | | allocated by AMF for MICO mode | | | handling. | +----------------------------------+----------------------------------+ | Strictly Periodic Registration | An indication that UE shall | | Timer Indication | perform the Periodic | | | Registration Update in a | | | strictly periodic time, see | | | clause 5.31.7.5 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | Voice Support Match Indicator | An indication whether the UE | | | radio capabilities are | | | compatible with the network | | | configuration. The AMF uses it | | | as an input for setting the IMS | | | voice over PS Session Supported | | | Indication over 3GPP access. | +----------------------------------+----------------------------------+ | Homogenous Support of IMS Voice | Indicates per UE if \"IMS Voice | | over PS Sessions | over PS Sessions\" is | | | homogeneously supported in all | | | TAs in the serving AMF or | | | homogeneously not supported, or, | | | support is | | | non-homogeneous/unknown, see | | | clause 5.16.3.3 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | UE Radio Capability for Paging | Information used by the NG-RAN | | Information | to enhance the paging towards | | | the UE (see clause 5.4.4.1 of | | | TS 23.501 [2]). | +----------------------------------+----------------------------------+ | Information On Recommended Cells | Information sent by the NG-RAN | | And RAN nodes For Paging | and used by the AMF when paging | | | the UE to help determining the | | | NG-RAN nodes to be paged as well | | | as to provide the information on | | | recommended cells to each of | | | these NG-RAN nodes, in order to | | | optimize the probability of | | | successful paging while | | | minimizing the signalling load | | | on the radio path. | +----------------------------------+----------------------------------+ | UE Radio Capability Information | Information sent by the NG-RAN | | | node and stored in the AMF. The | | | AMF sends this information to | | | the NG-RAN node within the UE | | | context during transition to | | | CM-CONNECTED state, except for | | | NB-IoT when NB-IoT specific UE | | | Radio Access Capability are sent | | | instead. | +----------------------------------+----------------------------------+ | UE Radio Capability ID | Pointer that uniquely identifies | | | a set of UE Radio Capabilities | | | in UCMF as defined in | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | NB-IoT specific UE Radio Access | NB-IoT specific UE radio access | | Capability Information | capabilities. | +----------------------------------+----------------------------------+ | WUS Assistance Information | Assistance information for | | | determining the WUS group (see | | | TS 23.501 [2]). | +----------------------------------+----------------------------------+ | Paging Subgrouping Support | UE indication of its capability | | Indication | to support NR paging | | | subgrouping. | +----------------------------------+----------------------------------+ | AMF PEIPS Assistance Information | AMF assigned NR paging subgroup | | | information for use in NR paging | | | subgrouping (see | | | TS 23.501 [2]). | +----------------------------------+----------------------------------+ | SMSF Identifier | The Identifier of the SMSF | | | serving the UE in RMâ€‘REGISTERED | | | state. | +----------------------------------+----------------------------------+ | SMSF Address | The Address of the SMSF serving | | | the UE in RM-REGISTERED state. | | | (see clause 4.13.3.1). | +----------------------------------+----------------------------------+ | SMS Subscription | Indicates subscription to any | | | SMS delivery service over NAS | | | irrespective of access type. | +----------------------------------+----------------------------------+ | SEAF data | Master security information | | | received from AUSF. | +----------------------------------+----------------------------------+ | Last used EPS PLMN ID | The identifier of the last used | | | EPS PLMN. | +----------------------------------+----------------------------------+ | Paging Assistance Data for CE | Paging Assistance Data for | | capable UE | Enhanced Coverage level and cell | | | ID provided by the last NG-RAN | | | the UE was connected to. | +----------------------------------+----------------------------------+ | Enhanced Coverage Restricted | Specifies per PLMN whether CE | | Information | mode B is restricted for the UE, | | | or both CE mode A and CE mode B | | | are restricted for the UE, or | | | both CE mode A and CE mode B are | | | not restricted for the UE. | +----------------------------------+----------------------------------+ | NB-IoT Enhanced Coverage | Specifies per PLMN whether the | | Restricted Information | Enhanced Coverage is restricted | | | or not for the UE. | +----------------------------------+----------------------------------+ | Service Gap Time | Used to set the Service Gap | | | timer for Service Gap Control | | | (see clause 5.31.16 of | | | TS 23.501 [2]). | +----------------------------------+----------------------------------+ | Running Service Gap expiry time | The time of expiry of a | | | currently running Service Gap | | | Timer (see clause 5.31.16 of | | | TS 23.501 [2]). | +----------------------------------+----------------------------------+ | NB-IoT UE Priority | Numerical value used by the | | | NG-RAN to prioritise between UEs | | | accessing via NB-IoT. | +----------------------------------+----------------------------------+ | List of Small Data Rate Control | List of Small Data Rate Control | | Statuses | Statuses by DNN and S-NSSAI for | | | the released PDU Sessions, see | | | clause 5.31.14.3 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | List of APN Rate Control | Indicates for each APN, the APN | | Statuses | Rate Control Status (see | | | clause 4.7.7.3 of | | | TS 23.401 [13]) received from | | | an MME when mobility from EPC to | | | 5GC occurs. This information is | | | provided to the MME during 5GC | | | to EPC mobility. | +----------------------------------+----------------------------------+ | UE positioning capability | Information sent by the LMF and | | | stored in the AMF. The AMF sends | | | this information along with the | | | location request to the LMF. | +----------------------------------+----------------------------------+ | **For each access type level | | | context within the UE access and | | | mobility context:** | | +----------------------------------+----------------------------------+ | Access Type | Indicates the access type for | | | this context. | +----------------------------------+----------------------------------+ | RM State | Registration management state. | +----------------------------------+----------------------------------+ | UUAA-MM Status | Indicates the status of UUAA-MM | | | if the AMF is configured to | | | perform the UAV | | | authentication/authorization at | | | 5GS registration as described in | | | clause 5.2.2 of | | | TS 23.256 [80]. Possible | | | states are \"PENDING\", | | | \"SUCCESS\", \"FAILED\". | | | | | | For status \"PENDING\" and | | | \"FAILED\" the AMF rejects any | | | PDU session establishment | | | request from the UE for DNN and | | | S-NSSAI that are used for UAS | | | services. | +----------------------------------+----------------------------------+ | Registration Area | Current Registration Area (a set | | | of tracking areas in TAI List). | +----------------------------------+----------------------------------+ | TAI of last Registration | TAI of the TA in which the last | | | Registration Request was | | | initiated. | +----------------------------------+----------------------------------+ | User Location Information | Information on user location. | +----------------------------------+----------------------------------+ | Mobility Restrictions | Mobility Restrictions restrict | | | mobility handling or service | | | access of a UE. It consists of | | | RAT restriction, Forbidden area, | | | Service area restrictions and | | | Core Network type restriction. | | | It may also contain an Allowed | | | CAG list and optionally an | | | indication whether the UE is | | | only allowed to access 5GS via | | | CAG cells. Each entry in the | | | Allowed CAG list may also be | | | associated with validity | | | conditions (NOTE 4). | +----------------------------------+----------------------------------+ | Security Information for CP | As defined in TS 33.501 [15]. | +----------------------------------+----------------------------------+ | Security Information for UP | As defined in TS 33.501 [15]. | +----------------------------------+----------------------------------+ | Allowed NSSAI | Allowed NSSAI consisting of one | | | or more S-NSSAIs for serving | | | PLMN in the present Registration | | | Area. | +----------------------------------+----------------------------------+ | Mapping Of Allowed NSSAI | Mapping Of Allowed NSSAI is the | | | mapping of each S-NSSAI of the | | | Allowed NSSAI to the S-NSSAIs of | | | the Subscribed S-NSSAIs. | +----------------------------------+----------------------------------+ | Partially Allowed NSSAI | Partially Allowed NSSAI | | | consisting of one or more | | | S-NSSAIs for serving PLMN. | | | | | | An associated TA-list for each | | | of the S-NSSAIs in the Partially | | | Allowed NSSAI defines in which | | | TAs the S-NSSAI may be used. | +----------------------------------+----------------------------------+ | Mapping Of Partially Allowed | Mapping Of Partially Allowed | | NSSAI | NSSAI is the mapping of each | | | S-NSSAI of the Partially Allowed | | | NSSAI to the S-NSSAIs of the | | | Subscribed S-NSSAIs. | +----------------------------------+----------------------------------+ | S-NSSAIs subject to Network | Subscribed S-NSSAIs which are | | Slice-Specific Authentication | subject to NSSAA procedure. | | and Authorization | | | | Also including the status, i.e. | | | result, of the NSSAA if already | | | executed or whether the S-NSSAI | | | is pending the completion of an | | | NSSAA procedure. | +----------------------------------+----------------------------------+ | Inclusion of NSSAI in RRC | [Only for 3GPP access] it | | Connection Establishment Allowed | defines whether the UDM has | | by HPLMN | indicated that the UE is allowed | | | to include NSSAI in the RRC | | | connection Establishment in | | | clear text. | +----------------------------------+----------------------------------+ | Access Stratum Connection | Defines what NSSAI, if any, to | | Establishment NSSAI Inclusion | include in the Access Stratum | | Mode | connection establishment as | | | specified in clause 5.15.9 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | CM state for UE connected via | Identifies the UE CM state | | N3IWF/TNGF | (CM-IDLE, CM-CONNECTED) for UE | | | connected via N3IWF/TNGF | +----------------------------------+----------------------------------+ | N2 address information for | Identifies the N3IWF/TNGF to | | N3IWF/TNGF | which UE is connected. Exists | | | only if CM state for UE | | | connected via N3IWF/TNGF is | | | CM-CONNECTED. | +----------------------------------+----------------------------------+ | AMF UE NGAP ID | Identifies the UE association | | | over the NG interface within the | | | AMF as defined in | | | TS 38.413 [10]. This parameter | | | exists only if CM state for the | | | respective Access Type is | | | CM-CONNECTED. | +----------------------------------+----------------------------------+ | RAN UE NGAP ID | Identifies the UE association | | | over the NG interface within the | | | NG-RAN node as defined in | | | TS 38.413 [10]. This parameter | | | exists only if CM state for the | | | respective Access Type is | | | CM-CONNECTED. | +----------------------------------+----------------------------------+ | Network Slice Instance(s) | The Network Slice Instances | | | selected by 5GC for this UE. | +----------------------------------+----------------------------------+ | URRP-AMF information | UE Reachability Request | | | Parameter contains a list of | | | URRP-AMF flags and associated | | | authorised NF IDs. Each URRP-AMF | | | flag indicates whether direct UE | | | reachability notification has | | | been authorised by the HPLMN | | | towards the associated NF ID or | | | not. | +----------------------------------+----------------------------------+ | SoR Update Indicator for Initial | An indication whether the UDM | | Registration | requests the AMF to retrieve SoR | | | information when the UE performs | | | NAS Registration Type \"Initial | | | Registration\". | +----------------------------------+----------------------------------+ | SoR Update Indicator for | An indication whether the UDM | | Emergency Registration | requests the AMF to retrieve SoR | | | information when the UE performs | | | NAS Registration Type | | | \"Emergency Registration\". | +----------------------------------+----------------------------------+ | Charging Characteristics | The Charging Characteristics as | | | defined in Annex A of | | | TS 32.256 [71]. | +----------------------------------+----------------------------------+ | **For each PDU Session level | | | context:** | | +----------------------------------+----------------------------------+ | S-NSSAI(s) | The S-NSSAI(s) associated to the | | | PDU Session. | +----------------------------------+----------------------------------+ | DNN | The associated DNN for the PDU | | | Session. | +----------------------------------+----------------------------------+ | Network Slice Instance id | The network Slice Instance | | | information for the PDU Session | +----------------------------------+----------------------------------+ | PDU Session ID | The identifier of the PDU | | | Session. | +----------------------------------+----------------------------------+ | SMF Information | The associated SMF identifier | | | and SMF address for the PDU | | | Session. | | | | | | When an I-SMF is used, this | | | additionally include the | | | information correspond to an | | | I-SMF. | +----------------------------------+----------------------------------+ | Access Type | The current access type for this | | | PDU Session (for a MA PDU | | | Session this may correspond to | | | information indicating 2 Access | | | Type). | +----------------------------------+----------------------------------+ | EBI-ARP list | The allocated EBI and associated | | | ARP pairs for this PDU session. | +----------------------------------+----------------------------------+ | 5GSM Core Network Capability | The UEs 5GSM Core Network | | | Capability as defined in | | | clause 5.4.4b of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | SMF derived CN assisted RAN | These are PDU Session specific | | parameters tuning | parameters received from the SMF | | | and used by the AMF to derive | | | the Core Network assisted RAN | | | parameters tuning. | +----------------------------------+----------------------------------+ | NOTE 1: The AMF transfers the | | | PCF ID to the SMF during PDU | | | Session Establishment. The SMF | | | may select the PCF identified by | | | the PCF ID as described in | | | clause 6.3.7.1 of | | | TS 23.501 [2]. In HR roaming | | | case, the AMF transfers the | | | identifier of H-PCF as described | | | in clause 4.3.2.2.2. In LBO | | | roaming case, the AMF transfers | | | the identifier of V-PCF as | | | described in clause 4.3.2.2.1. | | | | | | NOTE 2: The PCF ID in AM Policy | | | Association information and the | | | PCF ID in UE Policy Association | | | Information should be the same | | | in non-roaming case. The V-PCF | | | ID in AM Policy Association | | | information and the V-PCF ID in | | | UE Policy Association | | | Information should be the same | | | in roaming case. | | | | | | NOTE 3: Not all the parameters | | | stored at AMF are required to be | | | transferred between AMFs during | | | the inter-AMF mobility. The | | | parameters which are required to | | | be transferred between AMFs are | | | defined in TS 29.518 [18]. | | | | | | NOTE 4: The validity information | | | is not provided to the NG-RAN. | | | The AMF shall determine the CAG | | | Identifier(s) to be provided to | | | the NG-RAN in Allowed CAG list, | | | by taking into consideration the | | | validity information associated | | | with the CAG Identifier(s), as | | | described in clause 5.30.3 of | | | TS 23.501 [2]. | | +----------------------------------+----------------------------------+
##### 5.2.2.2.3 Namf_Communication_RegistrationStatusUpdate service operation
**Service operation name:** Namf_Communication_RegistrationStatusUpdate
**Description:** This service operation is used by the consumer NF to inform
the AMF that a prior UE context transfer has resulted in the UE successfully
registering with it. The UE context is marked inactive in the AMF.
**Input, Required:** 5G-GUTI, Status.
**Input, Optional:** PDU Session ID(s) (indicates the PDU Session(s) to be
released), PCF reselected indicator (indicates that new AMF has selected a new
PCF to handle the AM Policy association and/or the UE Policy association).
**Output, Required:** None.
**Output, Optional:** None.
See clause 4.2.2.2.2 step 10 for example usage of this service operation. When
the AMF receives this request, it marks the UE context information as inactive
since the UE context has been successfully transferred to the peer NF and the
UE has successfully registered there. The AMF receives information about
whether the AM Policy Association Information and/or the UE Policy Association
Information in the UE context will be used or not (i.e. new AMF may select a
different PCF and then create a new AM Policy Association and/or a new UE
Policy Association). The AMF sends a
Namf_Communication_RegistrationStatusUpdate response to the consumer NF.
NOTE 2: Whether notification Ack need a separate message or be realized in the
transport layer will be determined in TS 29.518 [18].
##### 5.2.2.2.4 Namf_Communication_N1MessageNotify service operation
**Service operation name:** Namf_Communication_N1MessageNotify
**Description:** AMF notifies the N1 message received from the UE to a
destination CN NF.
**Input, Required:** AMF ID (GUAMI), N1 Message(s)
**Input, Optional:** local time zone, UE\'s current location, AN access
information (e.g. AN type AN N2 terminating point, CAG Identifier(s) of the
CAG cell), Allowed NSSAI, Mapping Of Allowed NSSAI, SUPI, MM Context, LMF
identification, PRU subscription verification result.
**Output, Required:** None _._
**Output, Optional:** None _._
The destination NF type to be notified is determined based on one of the
following:
\- The N1 message type is always known to be consumed by one particular NF
type; or
\- An NF had explicitly subscribed for the particular N1 message type to be
notified towards it.
NOTE: Whether notification Ack need a separate message or be realized in the
transport layer will be determined in TS 29.518 [18].
The optional AN access information (if available), SUPI, MM Context, Allowed
NSSAI and Mapping Of Allowed NSSAI parameters are included if the service
operation is invoked towards a peer AMF.
##### 5.2.2.2.5 Namf_Communication_N1N2MessageSubscribe service operation
**Service operation name:** Namf_Communication_N1N2MessageSubscribe.
**Description:** An NF can subscribe with the AMF to get notified of a
particular N1 message type or a specific N2 information type about the UE.
**Input, Required:** CN NF ID, N1 Message Type
**Input, Optional:** SUPI.
**Output, Required:** None _._
**Output, Optional:** None _._
The consumer NF invokes the Namf_Communication_N1MessageSubscribe service
operation (NF ID, N1 message type or N2 information type to subscribe) on the
AMF. The consumer NF shall provide a SUPI for UE associated N1 message
subscriptions. If the consumer NF is allowed to subscribe for the type of
N1/N2 message requested, the AMF creates a binding for the consumer NF to
deliver subsequent Namf_Communication_N1MessageNotify or
Namf_Communication_N2InfoNotify towards that NF.
NOTE: Whether Subscription Ack need a separate message or be realized in the
transport layer will be determined in TS 29.518 [18].
##### 5.2.2.2.6 Namf_Communication_N1N2MessageUnSubscribe service operation
**Service operation name:** Namf_Communication_N1N2MessageUnSubscribe.
**Description:** An NF can unsubscribe with the AMF to stop notifying a
particular N1 message type or a specific N2 information type about the UE.
**Input, Required:** CN NF ID, N1 Message Type
**Input, Optional:** None.
**Output, Required:** None _._
**Output, Optional:** None _._
The consumer NF invokes the Namf_Communication_N1MessageUnSubscribe service
operation (NF ID, N1 message type or N2 information type to subscribe) on the
AMF. The AMF deletes the binding for the consumer NF for the requested N1
message type.
NOTE: Whether UnSubscribe Ack need a separate message or be realized in the
transport layer will be determined in TS 29.518 [18].
##### 5.2.2.2.7 Namf_Communication_N1N2MessageTransfer service operation
**Service operation name:** Namf_Communication_N1N2MessageTransfer.
**Description:** CN NF request to transfer downlink N1 and/or N2 message to
the UE and/or AN through the AMF.
**Input, Required:** CN NF ID, Message type (N1 or N2 or both), Message
Container (s) where at least one of the message containers (N1 or N2) is
required.
**Input, Optional:** last message indication, Session ID, Paging Policy
Indicator, ARP, Area of validity for the N2 SM information, 5QI,
N1N2TransferFailure Notification Target Address, type of N2 SM information,
type of N2 NRPPa information, Extended Buffering Support. MA PDU session
Accepted indication, target access type (3GPP access or non-3GPP access),
selected alternative H-SMF ID.
Namf_Communication_N1N2MessageTransfer supports the transfer of only one N2
message. N2 SM information and N2 NRPPa information are mutually exclusive.
**Output, Required:** Result indication _._
**Output, Optional:** Redirection information, Estimated Maximum wait time _._
If the UE is in CM-IDLE state, the AMF initiates the network triggered Service
Request procedure as specified in clause 4.2.3.3 and responds to the consumer
NF with a result indication, \"attempting to reach UE\". Otherwise, the AMF
responds to the consumer NF, with a Namf_Communication_N1N2MessageTransfer
response, providing a result indication of whether the AMF was able to
successfully transfer the N1 and/or the N2 message towards the UE and/or the
AN. A result indication of \"N1/N2 transfer success\" does not mean that N1
message is successfully received by the UE. It only means that the AMF is able
to successfully send the N1 or N2 message towards the AN.
The \"Area of validity for the N2 SM information\", if included is used by the
AMF to determine whether the N2 SM information provided by the consumer NF can
be used towards the AN based on the current location of the UE. If the
location of the UE is outside the \"Area of validity for the N2 SM
information\" indicated, the AMF shall not send the N2 SM information to the
AN.
If the consumer NF knows that a specific downlink N1 message is the last
message to be transferred in this transaction, the consumer NF shall include
the last message indication in the Namf_Communication_N1N2MessageTransfer
service operation so that the AMF knows that the no more downlink N1 message
need to be transferred for this transaction.
The CN NF is implicitly subscribed to be notified of N1N2TransferFailure by
providing the N1N2TransferFailure Notification Target Address. When AMF
detects that the UE fails to respond to paging, or the UE responds to paging
with a Reject Paging Indication, or the AMF determines the UE is temporarily
unreachable e.g. due to extended idle mode DRX or MICO mode, the AMF invokes
the Namf_Communication_N1N2TransferFailureNotification to provide the failure
notification to the location addressed by N1N2TransferFailure Notification
Target Address.
The \"Extended Buffering applies\" indication, if included, is used by the AMF
to include \"Estimated Maximum Wait time\" in Namf_Communication_N1N2
TransferFailureNotification if invoked due to the UE being unreachable.
If the result of the service operation fails, the AMF shall set the
corresponding cause value in the result indication which can be used by the NF
consumer for further action. If the related UE is not served by AMF and the
AMF knows which AMF is serving the UE, the AMF provides redirection
information which can be used by the consumer NF to resend UE related message
to the AMF that serves the UE.
If the consumer NF is a SMF and he request includes N2 SM information, the SMF
indicates the type of N2 SM information. If the consumer NF is a LMF and the
request includes N2 NRPPa information, the LMF indicates the type of N2 NRPPa
information.
NOTE: The actual N2 SM information or N2 NRPPa information is not interpreted
by the AMF.
The selected alternative H-SMF ID information may be provided as described in
clause 4.3.2.2.2.
The Small Data Rate Control Status is included if a PDU Session is being
released and the UPF or NEF provided Small Data Rate Control Status when the
PDU Session was released for the AMF to store.
For the usage of MA PDU session Accepted indication and target access type
(3GPP access or non-3GPP access) see clauses 4.22.2, 4.22.3, 4.22.6.3 and
4.22.9.4.
##### 5.2.2.2.7A Namf_Communication_N1N2TransferFailureNotification service
operation
**Service operation name:**
Namf_Communication_N1N2TransferFailureNotification.
**Description:** The AMF uses this notification to inform the NF service
consumer that initiated an earlier Namf_Communication_N1N2MessageTransfer,
that the AMF failed to deliver the N1 message to the UE as the UE failed to
respond to paging, or the UE responded with a Reject Paging Indication.
**Input, Required:** Cause, N1N2MessageTransfer Notification Target Address.
**Input, Optional:** Estimated Maximum wait time.
**Output, Required:** None.
**Output, Optional:** None.
##### 5.2.2.2.8 Namf_Communication_N2InfoSubscribe service operation
**Service operation name:** Namf_Communication_N2InfoSubscribe.
**Description:** An NF invokes this service operation to subscribe for the
delivery of information contained in a specific N2 message type.
**Input, Required:** CN NF ID, N2 information type to be subscribed.
**Input, Optional:** None.
**Output, Required:** None _._
**Output, Optional:** None _._
##### 5.2.2.2.9 Namf_Communication_N2InfoUnsubscribe service operation
**Service operation name:** Namf_Communication_N2InfoUnSubscribe.
**Description:** An NF can invoke this service operation to unsubscribe for
the delivery of information contained in a specific N2 message type.
**Input, Required:** CN NF ID, N2 information type to unsubscribe.
**Input, Optional:** None.
**Output, Required:** None _._
**Output, Optional:** None _._
The consumer NF invokes the Namf_Communication_N2InfoUnSubscribe service
operation (CN NF ID, N2 information type to unsubscribe) on the AMF. The AMF
deletes the binding for the consumer NF to for the requested information to
unsubscribe.
##### 5.2.2.2.10 Namf_Communication_N2InfoNotify service operation
**Service operation name:** Namf_Communication_N2InfoNotify.
**Description:** The AMF uses this service operation to notify a particular N2
message information towards the NFs that have subscribed (implicitly or
explicitly) for the specific information. This service operation is also used
to redirect the N2 message to the AMF that are serving the UE.
**Input, Required:** AMF ID (GUAMI), N2 information.
**Input, Optional:** Indication of the I-SMF change/removal.
**Output, Required:** None _._
**Output, Optional:** None _._
##### 5.2.2.2.11 Namf_Communication_CreateUEContext service operation
**Service operation name:** Namf_Communication_CreateUEContext
**Description:** This service operation is used by a source AMF to create the
UE context in a target AMF during handover procedures or an initial AMF to
relocate the UE context to a target AMF during inter PLMN handover procedure.
**Input, Required:** 5G-GUTI, UE context of the identified UE. As described in
Table 5.2.2.2.2-1, the UE context may include the SUPI, DRX parameters, AM
policy information, UE Radio Capability ID, PCF ID, UE network capability,
used N1 security context information, event subscriptions by other consumer NF
and the list of SM PDU Session IDs along with the SMF handling the PDU
Session, N2 information including source to target RAN transparent container,
Endpoint information of S-AMF to receive N2 information notification about
handover complete (i.e. N2 notify URI).
**Input, Optional:** allocated EBI information, PCF ID, MS Classmark 2, STN-
SR, C MSISDN, the Supported Codec IE, NWDAF ID(s) (i.e. Instance ID or Set
ID)with the corresponding Subscription Correlation ID(s), Analytics ID (s) and
Analytics specific data as defined in Table 5.2.2.2.2-1.
**Output, Required:** Cause, N2 information including Target to Source
transparent container, N2 SM information (PDU Sessions failed to be setup list
and the N3 DL forwarding information), handle for the UE context created, PCF
ID.
**Output, Optional:** Target AMF ID.
##### 5.2.2.2.12 Namf_Communication_ReleaseUEContext service operation
**Service operation name:** Namf_Communication_ReleaseUEContext
**Description:** This service operation is used by a source AMF to release the
UE context in a target AMF during handover cancel procedures.
**Input, Required:** Handle of the UE context.
**Input, Optional:** None.
**Output, Required:** Cause.
**Output, Optional:** None.
##### 5.2.2.2.13 Namf_Communication_EBIAssignment service operation
**Service operation name:** Namf_Communication_EBIAssignment.
**Description:** The consumer NF uses this service operation to request a
bunch of EPS Bearer IDs for a PDU Session and optionally indicate to the AMF
the list of EBI(s) to be released.
**Inputs, Required:** SUPI, PDU Session ID, ARP list.
**Input, Optional:** Released EBI list.
**Outputs, Required:** None _._
**Outputs, Optional:** a list of \ pair, \ pair _._
The consumer NF invokes the Namf_Communication_EBIAssignment service operation
when it determines that one or more EPS Bearer IDs are required for EPS QoS
mapping for a PDU Session. The ARP list indicates the number of the requested
EBIs and the corresponding ARP. The AMF uses the ARP list (including ARP
priority level, the pre-emption capability and the pre-emption vulnerability)
and the S-NSSAI to prioritize the EBI request, AMF can revoke the EBI from an
ongoing lower priority PDU Session, if the maximum number of EBIs have been
reached and a session with a higher priority requests an EBI. The AMF responds
the consumer NF with a cause which indicates whether the assignment is
successful or not. If the assignment is successful, the AMF provides a list of
\ pair to the consumer NF.
If the consumer NF determines that some EBIs are not needed, the consumer NF
indicates the EBI(s) that can be released in the Released EBI list.
##### 5.2.2.2.14 Namf_Communication_AMFStatusChangeSubscribe service operation
**Service operation name:** Namf_Communication_AMFStatusChangeSubscribe
**Description:** This service operation is used by an NF to subscribe for AMF
Status Change notification.
**Input, Required:** GUAMI(s).
**Input, Optional:** None.
**Output, Required:** None.
**Output, Optional:** None.
See clause 5.21.2.2 of TS 23.501 [2] for the example usage of this service
operation. The GUAMI(s) is used to identify the AMF.
##### 5.2.2.2.15 Namf_Communication_AMFStatusChangeUnSubscribe service
operation
**Service operation name:** Namf_Communication_AMFStatusChangeUnSubscribe
**Description:** This service operation is used by an NF to unsubscribe for
AMF Status Change notification.
**Input, Required:** GUAMI(s).
**Input, Optional:** None.
**Output, Required:** None.
**Output, Optional:** None.
See clause 5.21.2.2 of TS 23.501 [2] for the example usage of this service
operation. The GUAMI(s) is used to identify the AMF.
##### 5.2.2.2.16 Namf_Communication_AMFStatusChangeNotify service operation
**Service operation name:** Namf_Communication_AMFStatusChangeNotify
**Description:** Report AMF Status change (e.g. AMF unavailable) notification
to subscribed NFs.
**Input, Required:** GUAMI(s).
**Input, Optional:** Target AMF(s) Name associated with the indicated GUAMI.
**Output, Required:** None.
**Output, Optional:** None.
See clause 5.21.2.2 of TS 23.501 [2] for the example usage of this service
operation. The GUAMI(s) is used to identify the AMF. For network deployment
without UDSF case, the target AMF Name which is to serve the user of the
indicated GUAMI is also included.
##### 5.2.2.2.17 Namf_Communication_NonUeN2MessageTransfer service operation
**Service operation name:** Namf_Communication_NonUeN2MessageTransfer
**Description:** NF Service Consumer requests to transfer a non-UE specific
message to NG-RAN node(s) via N2.
**Input, Required:** N2 Message Container.
**Input, Optional:** TAI List, RAT Selector (ng-eNB or gNB), Global RAN Node
List, Send Write-Replace-Warning-Indication, Send Stop-Warning-Indication.
**Output, Required:** N2 Information Transfer Result.
**Output, Optional:** PWS Result Data.
PWS Result Data is included when parts of a PWS received message have not been
comprehended or were missing, or if the message contained logical errors. It
may contain the Unknown Tracking Area List which may be present in the
associated PWS response message.
##### 5.2.2.2.18 Namf_Communication_NonUeN2InfoSubscribe service operation
**Service operation name:** Namf_Communication_NonUeN2InfoSubscribe
**Description:** The NF Service Consumer invokes this service operation to
subscribe to the delivery of non-UE specific information from the NG-RAN node
sent via N2 to the AMF.
**Input, Required:** Notification Target Address, Notification Correlation ID,
N2 information type to be subscribed.
**Input, Optional:** Timing synchronization status reporting indication.
**Output, Required:** Subscription Correlation ID.
**Output, Optional:** None.
##### 5.2.2.2.19 Namf_Communication_NonUeN2InfoUnSubscribe service operation
**Service operation name:** Namf_Communication_NonUeN2InfoUnSubscribe
**Description:** The NF Service Consumer invokes this service operation to
unsubscribe to stop notifying non-UE specific N2 information.
**Input, Required:** Subscription Correlation Id.
**Input, Optional:** None.
**Output, Required:** None.
**Output, Optional:** None.
##### 5.2.2.2.20 Namf_Communication_NonUeN2InfoNotify service operation
**Service operation name:** Namf_Communication_NonUeN2InfoNotify
**Description:** The AMF uses this service operation to notify a particular
event towards the NF Service Consumer that has subscribed for the specific
information. The AMF receives messages for such events from NG-RAN via N2.
**Input, Required:** Notification Correlation Information, N2 information.
**Input, Optional:** None.
**Output, Required:** None.
**Output, Optional:** None.
##### 5.2.2.2.21 Namf_Communication_RelocateUEContext service operation
**Service operation name:** Namf_Communication_RelocateUEContext
**Description:** This service operation is used by an initial AMF to relocate
the UE context in a target AMF during EPS to 5GS handover (per N26)
procedures.
**Input, Required:** UE context of the identified UE, Source to Target RAN
Transparent Container and the identification of target RAN, PDU Session ID and
its associated S-NSSAI of the VPLMN value for each PDU Session, the
corresponding S-NSSAI of HPLMN value for home routed PDU Session(s), content
for EPS to 5GS handover (information to reach the MME about this UE (MME
Control Plane F-TEID, MME addressing information), PDU Session ID and the
S-NSSAI associated with corresponding N2 SM Information received from SMF). As
described in Table 5.2.2.2.2-1, the UE context may include the SUPI, DRX
parameters, AM policy information, UE Radio Capability ID, PCF ID, UE network
capability, used N1 security context information, event subscriptions by other
consumer NF, Allowed NSSAI received from NSSF and the list of SM PDU Session
IDs with the corresponding SMF handling the PDU Session, the S-NSSAI of the
VPLMN and the S-NSSAI of HPLMN for home routed PDU Session(s).
**Input, Optional:** This may contain following optional information within
the UE context: allocated EBI information, MS Classmark 2, STN-SR, C MSISDN
and the Supported Codec IE.
**Output, Required:** Cause, handle for the UE context created.
**Output, Optional:** None.
##### 5.2.2.2.22 Namf_Communication_CancelRelocateUEContext service operation
**Service operation name:** Namf_Communication_CancelRelocateUEContext
**Description:** This service operation is used by an initial AMF to cancel
the relocation of the UE context in a target AMF during EPS to 5GS handover
(per N26) with AMF reallocation procedures.
**Input, Required:** Handle of the UE context.
**Input, Optional:** None.
**Output, Required:** Cause.
**Output, Optional:** None.
#### 5.2.2.3 Namf_EventExposure service
##### 5.2.2.3.1 General
**Service description:** This service enables an NF to subscribe and get
notified about an Event ID.
Following UE access and mobility information event are considered (Event ID is
defined in clause 4.15.1 and Table 4.15.3.1-1):
\- Location Report (TAI, Cell ID, N3IWF/TNGF node, UE local IP address and
optionally UDP source port number);
\- UE moving in or out of a subscribed \"Area Of Interest\" as described in
clauses 5.3.4.4 and 5.6.11 of TS 23.501 [2];
\- Number of UEs served by the AMF and located in \"Area Of Interest\";
\- Time zone changes (UE Time zone);
\- Access Type changes (3GPP access or non-3GPP access);
\- Registration state changes (Registered or Deregistered);
\- Connectivity state changes (IDLE or CONNECTED);
\- UE loss of communication;
\- UE reachability status;
\- UE indication of switching off SMS over NAS service;
\- Subscription Correlation ID change (implicit subscription);
\- UE Type Allocation code (TAC);
\- Frequent mobility re-registration;
\- Subscription Correlation ID addition (implicit subscription);
\- User State Information in 5GS, as described in clause 5.4.4 of TS 23.632
[68];
\- UE access behaviour trends (see clause 4.15.4.2);
\- UE location trends (see clause 4.15.4.2); and
\- Total number of Mobility Management transactions:
\- The Total number of Mobility Management transactions is used to collect the
number of MM transactions of a SUPI or Internal Group ID, for example
Dispersion Analytics as specified in TS 23.288 [50]. The Total number of
transactions is incremented when the NAS signalling transactions from
Authentication, Registration, De-Registration, Service Request and UE
Configuration Update procedures is completed. Only the periodic reporting mode
applies.
In addition to UE access and mobility information event, AMF exposes the
\"S-NSSAIs per TAI mapping\" event providing, per TAI, the related access type
and list of supported S-NSSAIs (including indication of S-NSSAIs restricted by
AMF). The Event Consumer may use as target of event reporting a list of TAIs,
or \"any TAI\" and may use event filter information including a list of
\"S-NSSAIs\". Whenever there is a change in supported S-NSSAIs (including
indication of S-NSSAIs restricted by AMF) for a TAI, the event notification is
generated with the updated information.
Event Filters are used to specify the conditions to match for notifying the
event (i.e. \"List of Parameter values to match\"). If there are no conditions
to match for a specific Event ID, then the Event Filter is not provided. The
following table provides some examples on how the conditions to match for
event reporting can be specified for various Event IDs for AMF exposure.
NOTE: The conditions to match can be set based on AMF-associated expected UE
Behaviour parameter(s) to only notify the event when the UE\'s behaviour
deviates from its expected UE behaviour as described in TS 23.288 [50].
Table 5.2.2.3.1-1: Example of Event Filters for AMF exposure events
+----------------------------------+----------------------------------+ | Event ID | Event Filter (List of Parameter | | | Values to Match) | +==================================+==================================+ | Location Report | \ | +----------------------------------+----------------------------------+ | UE moving in or out of Area of | \ | | | | | | \ | | | | | | \ | | | | | | \ | | | | | | \ | | | | | | \ | | | | | | \ | | | | | | (NOTE 1) | | | | | | \ | | | to indicate that AMF may adjust | | | the received AoI depending on | | | UE\'s current Registration Area. | | | Absence of this parameter in the | | | request is interpreted as \"AoI | | | remains unchanged\" | +----------------------------------+----------------------------------+ | Access Type | \ | +----------------------------------+----------------------------------+ | Location | \ (to report any | | | TAI change) | +----------------------------------+----------------------------------+ | Location | \ (to report only | | | when the TAI deviates from | | | expected values based on | | | Expected UE Moving Trajectory). | +----------------------------------+----------------------------------+ | Reachability Filter | Applicable to the event UE | | | reachability. Value = UE | | | reachability status change or UE | | | reachable for DL traffic. | | | Absence of this parameter in UE | | | reachability event request is | | | interpreted as \"UE reachability | | | status change\". | +----------------------------------+----------------------------------+ | Total number of Transactions | \ | | | | | | \ | +----------------------------------+----------------------------------+ | Number of UEs present in a | \ | | | | | | \ | +----------------------------------+----------------------------------+ | NOTE 1: The Parameter Type = RAN | | | timing synchronization status | | | change event can be present with | | | Parameter Type defining a RAN | | | Node ID. The use of parameter is | | | described in clause 5.3.4.4 of | | | TS 23.501 [2]. | | +----------------------------------+----------------------------------+
The following service operations are defined for the Namf_EventExposure
service:
\- Namf_EventExposure_Subscribe.
\- Namf_EventExposure_UnSubscribe.
\- Namf_EventExposure_Notify.
##### 5.2.2.3.2 Namf_EventExposure_Subscribe service operation
**Service operation name:** Namf_EventExposure_Subscribe.
**Description:** The consumer NF uses this service operation to subscribe to
or modify event reporting for one UE, a group of UE(s) or any UE.
**Input, Required:** NF ID, Target of Event Reporting: UE(s) ID (SUPI or
Internal Group Identifier or indication that any UE is targeted), ((set of)
Event ID(s) defined in clause 5.2.2.3.1, Notification Target Address (+
Notification Correlation ID))s, Event Reporting Information defined in Table
4.15.1-1.
**Input, Optional:** (Event Filter (s) associated with each Event ID; Event
Filter (s) are defined in clause 5.2.2.3.1, Subscription Correlation ID (in
the case of modification of the event subscription), Expiry time, list of
group member UE(s) whose subscription to event notification(s) are removed or
added for a group-based event notification subscription, operation indication
(cancellation or addition), Idle Status Indication request (if UE reachability
or Availability after DDN failure reporting is requested).
**Output, Required:** When the subscription is accepted: Subscription
Correlation ID (required for management of this subscription), Expiry time
(required if the subscription can be expired based on the operator\'s
policy)_._
**Output, Optional:** First corresponding event report is included, if
available (see clause 4.15.1).
The NF consumer subscribes to the event notification by invoking
Namf_EventExposure to the AMF. The AMF allocates an Subscription Correlation
ID for the subscription and responds to the consumer NF with the Subscription
Correlation ID. UE ID identifies the UE, SUPI and/or GPSI. Event ID (see
clause 4.15.1) identifies the events that the NF consumer is interested in.
The Subscription Correlation ID is unique within the AMF Set.
The ((set of) Event ID(s), Notification Target Address (+ Notification
Correlation ID)) helps the Event Receiving NF to co-relate a notification
against a corresponding event subscription for the indicated Event ID.
In the case that the NF consumer subscribes to the AMF on behalf of other NF,
the NF consumer include the Notification Target Address(+Notification
Correlation ID) of other NF for the Event ID which is to be notified to other
NF directly and the Notification Target Address(+Notification Correlation ID)
of itself for the Subscription Correlation ID change event. Each Notification
Target Address(+ Notification Correlation ID) is associated with the related
(set of) Event ID(s).When the Subscription Correlation ID change due to the
AMF reallocation, the notification is sent to NF consumer which triggers this
subscription.
Event filter may include \"AN type(s)\" as part of the list of parameter
values to match and it indicates to subscribe the event per Access Type.
Event receiving NF ID identifies the NF that shall receive the event
reporting.
When the consumer NF needs to modify an existing subscription previously
created by itself in the AMF, it invokes Namf_EventExposure_Subscribe service
operation which contains the Subscription Correlation ID and the new Event
Filters with Event ID to the AMF.
##### 5.2.2.3.3 Namf_EventExposure_UnSubscribe service operation
**Service operation name:** Namf_EventExposure_UnSubscribe.
**Description:** The NF consumer uses this service operation to unsubscribe
for a specific event for one UE, group of UE(s), any UE.
**Input, Required:** Subscription Correlation ID.
**Input, Optional:** None.
**Output, Required:** Operation execution result indication _._
**Output, Optional:** None _._
The NF consumer unsubscribes the event notification by invoking
Namf_EventExposure_Unsubscribe (Subscription Correlation ID) to the AMF.
##### 5.2.2.3.4 Namf_EventExposure_Notify service operation
**Service operation name** : Namf_EventExposure_Notify.
**Service operation description:** Provides the previously subscribed event
information to the NF Consumer which has subscribed to that event before.
**Input, Required:** AMF ID (GUAMI), Notification Correlation Information,
Event ID, corresponding UE(s) (SUPI(s) and if available GPSI(s)), time stamp.
**Input, Optional:** Event specific parameter list, Idle Status Indication
(time when UE returned to Idle, Active Time, Periodic Update Timer, eDRX
cycle, suggested number of DL packets).
**Output, Required:** None _._
**Output, Optional:** None _._
When the AMF detects a UE access and mobility event corresponding to a
Subscription, it invokes Namf_EventExposure_Notify service operation to the NF
consumer(s) which has subscribed to the UE mobility event before. The event is
notified towards the consumers for which the Event filters (which may include
\"AN type(s)\") match. The Notification Target Address (+ Notification
Correlation ID) indicates to the Event Receiving NF the specific event
notification subscription. The event specific parameter indicates the type of
mobility event and related information, e.g. Registration Area Update/new
Registration Area.
For Subscription Correlation ID changes due to the AMF reallocation, the AMF
can send a list of additional subscriptions to UDM in order to trigger an
event resynchronization.
The optional event specific parameter list provides the values that matched
for generating the event notification. The parameter values to match are
specified during the event subscription (see clause 5.2.2.3.2). For example,
if the event type reported is \"AN change\", the event specific parameter list
contains the value of the new AN.
#### 5.2.2.4 Namf_MT service
##### 5.2.2.4.1 General
**Service description:** It provides a NF the service to request information
related to capabilities that make sure UE is reachable to send MT signalling
or data to a target UE or toward UEs in a multicast session. The following are
the key functionalities of this NF service
\- paging UE if UE is in IDLE state and respond other NF after the UE enters
CM-CONNECTED state.
\- response to the requester NF if UE is in CONNECTED state.
\- providing the terminating domain selection information for IMS voice to the
consumer NF.
\- requesting paging towards a group of UEs as defined in TS 23.247 [78].
##### 5.2.2.4.2 Namf_MT_EnableUEReachability service operation
**Service operation name:** Namf_MT_EnableUEReachability.
**Description:** The consumer NF uses this service operation to request
enabling UE reachability.
**Inputs, Required:** NF ID, UE ID.
**Inputs, Optional:** Extended Buffering Support, PPI, ARP, 5QI, QFI, PDU
Session ID.
**Outputs, Required:** Result indication _._
**Outputs, Optional:** Redirection information, Estimated Maximum wait time
_._
See clause 4.13.3.6 and clause 4.24.2 for details on the usage of this service
operation.
The consumer NF does not need to know UE state. The AMF accepts the request
and respond the consumer NF immediately if UE is in CM-CONNECTED state. If the
UE is in CM-IDLE state, the AMF may page the UE and respond to the consumer NF
after the UE enters CM-CONNECTED state.
If the result of the service operation fails, the AMF shall set the
corresponding cause value in the result indication which can be used by the NF
consumer for further action. If the related UE is not served by the AMF and
the AMF knows which AMF is serving the UE, the AMF provides redirection
information which can be used by the NF consumer to resend UE related message
to the AMF that serves the UE.
##### 5.2.2.4.3 Namf_MT_ProvideDomainSelectionInfo
**Service operation name:** Namf_MT_ProvideDomainSelectionInfo.
**Description:** Provides the UE information for terminating domain selection
of IMS voice to the consumer NF.
**Input, Required:** SUPI.
**Input, Optional:** None.
**Output, Required:** Success/Failure indication.
**Output, Optional:** Indication of supporting IMS voice over PS Session or
not, Time stamp of the last radio contact with the UE, Current RAT type.
##### 5.2.2.4.4 Namf_MT_EnableGroupReachability service operation
**Service operation name:** Namf_MT_EnableGroupReachability.
**Description:** NF Service Consumer use this service operation to request
paging towards a group of UEs.
**Inputs, Required:** Multicast Session ID, UE list, Associated PDU Session ID
list, UE reachability Notification Address.
**Inputs, Optional:** MBS service area.
**Outputs, Required:** None.
**Outputs, Optional:** List of UEs in connected state (out of the input list).
This service operation is used in 5G MBS as specified in TS 23.247 [78].
##### 5.2.2.4.5 Namf_MT_UEReachabilityInfoNotify
**Service operation name:** Namf_MT_UEReachabilityInfoNotify
**Description:** Provided the UE reachability information and user location
information by the AMF to NF consumers.
**Inputs, Required:** Notification Correlation ID
**Inputs, Optional:** list of reachable UE (UE ID, User Location Information),
list of unreachable UE (UE ID).
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.2.5 Namf_Location service
##### 5.2.2.5.1 General
**Service description:** This service enables an NF to request location
information for a target UE. The following are the key functionalities of this
NF service.
\- Allow NFs to request the current or last known geodetic and optionally
local and/or civic location of a target UE.
\- Allow NFs to be notified of event information related to emergency sessions
or deferred UE location.
\- Allow NFs to request Network Provided Location Information (NPLI) and/or
local time zone corresponding to the location of a target UE.
\- Allow NFs to request a deferred geodetic and optionally local and/or civic
location of a target UE for Periodic, Triggered and UE Available Location
Events.
\- Allow NFs to cancel an ongoing session for periodic or triggered location
of a target UE.
##### 5.2.2.5.2 Namf_Location_ProvidePositioningInfo service operation
**Service operation name:** Namf_Location_ProvidePositioningInfo
**Description:** Provides UE positioning information to the consumer NF.
**Input, Required:** UE Identification (SUPI or PEI), Client Type.
**Input, Optional:** required Location QoS instance(s), Supported GAD shapes,
UE Privacy Requirements, LCS Client Identification, Deferred location type,
Deferred location parameters, Notification Target address, Notification
Correlation ID, Scheduled Location Time, service type, LMF ID, UE unaware
indication, request for user plane reporting to an LCS Client or AF, user
plane address of an LCS Client or AF, user plane security information for an
LCS Client or AF, cumulative event report timer, maximum number of user plane
event reports to an LCS Client or AF.
**Output, Required:** Success/Failure indication
**Output, Optional:** Geodetic Location, Local Location including Coordinate
ID, Civic Location, Indoor/Outdoor indication, Position Methods Used, Failure
Cause, achieved Location QoS Accuracy.
See steps 4 and 10 of clause 6.1.1, steps 5, 14, 18 and 22 of clause 6.1.2 and
steps 5 and 6 of clause 6.3.1 of TS 23.273 [51], for examples of usage of this
service operation.
##### 5.2.2.5.3 Namf_Location_EventNotify service operation
**Service operation name:** Namf_Location_EventNotify
**Description:** Provides UE location related event information related to
emergency sessions or deferred location to the consumer NF.
**Input, Required:** Type of location related event (e.g. emergency session
initiation, deferred location for the UE available event, activation of
location for periodic or triggered location, mobility of a target UE to a new
AMF or MME for a deferred location), UE Identification (SUPI or PEI).
**Input, Optional:** GPSI, Geodetic Location, Local Location including
Coordinate ID, Civic Location, Indoor/Outdoor indicatio, Position methods
used, Notification Target address, Notification Correlation ID, address of a
new AMF or MME or MSC server Identity for 5G-SRVCC as specified in TS 23.216
[81], achieved Location QoS Accuracy.
**Output, Required:** None.
**Output, Optional:** None**.**
See steps 5 and 8 of clause 6.10.1 and step 19 of clause 6.3.1 of TS 23.273
[51] and clause 6.5.4 of TS 23.216 [81] for examples of usage of this service
operation.
##### 5.2.2.5.4 Namf_Location_ProvideLocationInfo service operation
**Service operation name:** Namf_Location_ProvideLocationInfo
**Description:** Provides Network Provided Location Information (NPLI) of a
target UE to the consumer NF.
**Input, Required:** UE Identification (SUPI).
**Input, Optional:** 5GS Location Information Request, Current Location
Request, RAT type Requested, Local Time Zone Request.
**Output, Required:** Success/Failure indication.
**Output, Optional:** 5GS Location Information (Cell Identity, Tracking Area
Identity, Geographical/Geodetic Information, Current Location Retrieved, Age
of Location Information, Current RAT Type), Local Time Zone, Failure Cause. In
the case of non-3GPP access: a UE local IP address (used to reach the
N3IWF/TNGF) and optionally UDP source port number (if NAT is detected).
##### 5.2.2.5.5 Namf_Location_CancelLocation service operation
**Service operation name:** Namf_Location_CancelLocation
**Description:** Cancels an ongoing deferred location of a target UE to the
consumer NF.
**Input, Required:** UE Identification (SUPI), Notification Target address,
Notification Correlation ID.
**Input, Optional:** None.
**Output, Required:** Success/Failure indication.
**Output, Optional:** None.
See steps 4 and 10 of clause 6.3.3 of TS 23.273 [51] for examples of usage of
this service operation.
### 5.2.3 UDM Services
#### 5.2.3.1 General
The following table illustrates the UDM Services and Service Operations.
Table 5.2.3.1-1: NF services provided by UDM
NF service Service Operations Operation Semantics Example Consumer(s)
* * *
Subscriber Data Get Request/Response AMF, SMF, SMSF, NEF, 5G DDNMF, TSCTSF,
NWDAF Management Subscribe Subscribe/Notify AMF, SMF, SMSF, NEF, 5G DDNMF,
NWDAF (SDM) Unsubscribe Subscribe/Notify AMF, SMF, SMSF, NEF, 5G DDNMF, NWDAF
**Notification** Subscribe/Notify AMF, SMF, SMSF, NEF, GMLC, 5G DDNMF, NWDAF
ModifySubscription Subscribe/Notify AMF, SMF, SMSF, NEF, 5G DDNMF, NWDAF
**Info** Request/Response AMF, NEF UE Context **Registration**
Request/Response AMF, SMF, SMSF Management Deregistration**Notification**
Subscribe/Notify AMF (UECM) Deregistration Request/Response AMF, SMF, SMSF
**Get** Request/Response NEF, SMSF, GMLC, NWDAF, SMF, TSCTSF Update
Request/Response AMF, SMF, SMSF PCscfRestoration Subscribe/Notify AMF, SMF
SendRoutingInfoForSM Request/Response SMS-GMSC UE **Get** Request/Response
AUSF Authentication **ResultConfirmation** Request/Response AUSF EventExposure
**Subscribe** Subscribe/Notify NEF (NOTE), NWDAF, SMS-GMSC **Unsubscribe** NEF
(NOTE), NWDAF, SMS-GMSC **Notify** NEF (NOTE), NWDAF, SMS-GMSC
**ModifySubscription** NEF (NOTE), NWDAF, SMS-GMSC Parameter Update
Request/Response NEF, AMF Provision **Create** Request/Response NEF **Delete**
Request/Response NEF Get Request/Response NEF NIDDAuthorisation Get
Request/Response NEF UpdateNotify Subscribe/Notify NEF
ServiceSpecificAuthorisation **Create** Request/Response NEF UpdateNotify
Subscribe/Notify NEF ReportSMDeliveryStatus Request Request/Response SMS-GMSC
NOTE: Other NFs are allowed to consume the service based on roaming agreement
or operator policy.
#### 5.2.3.2 Nudm_UECM (UECM) service
##### 5.2.3.2.1 Nudm_UECM_Registration service operation
**Service operation name:** Nudm_UECM_Registration
**Description:** Register UE\'s serving NF (if NF Type is AMF, SMSF, or NWDAF)
or Session\'s serving NF (if NF Type is SMF) on the UDM. This operation
implies the following:
\- The authorization, if applicable, to register the NF service consumer in
UDM for the UE (e.g. based on UE roaming/RAT restrictions applicable when NF
type is AMF). If this is successful, the NF service consumer is set as a
serving NF for the corresponding UE/Session context.
\- When the consumer is AMF or SMF, it is implicitly subscribed to be notified
when it is deregistered in UDM. This notification is done by means of
Nudm_UECM_DeregistrationNotification operation.
\- When the consumer is AMF or SMF, it may optionally use this operation to
subscribe to be notified of the need for P-CSCF Restoration. This notification
is done by means of Nudm_UECM_PCscfRestoration operation. For more information
regarding P-CSCF restoration procedures see TS 23.380 [38].
**Inputs, Required:** NF ID, SUPI, NF Type, Access Type (if NF Type is AMF,
SMSF), RAT Type and GUAMI (if NF Type is AMF), PDU Session ID (if NF Type is
SMF), Analytics ID(s) (if NF Type is NWDAF). If NF Type is SMF: DNN or
Indication of Emergency Services, S-NSSAI, SMF+PGW-C FQDN for S5/S8 if the PDU
Session supports EPS interworking, Serving Node PLMN ID. If NF type is AMF and
Access Type is 3GPP access: Registration type. If NF type is SMSF: SMSF MAP
address and/or Diameter address, Serving PLMN ID.
NOTE: The GUAMI includes the MNC+MCC of the serving PLMN. In home routed
roaming, the H-SMF provides the PLMN ID of the HPLMN as Serving Node PLMN ID.
In LBO roaming, the SMF in the VPLMN provides the PLMN ID of the serving PLMN
in the VPLMN as Serving Node PLMN ID.
**Inputs, Optional:** PEI (conditional, condition stated below), P-CSCF
Restoration notification information, NID (e.g. if NF Type is AMF; see clause
5.18 of TS 23.501 [2]), backup AMF(s) (if NF Type is AMF), \"Homogeneous
Support of IMS Voice over PS Sessions\" indication (if NF Type is AMF), UE
SRVCC capability (if NF Type is AMF), indication that access is from ePDG
(shall be sent if NF Type is SMF and PDU Session is setup via S2b), VGMLC ID
(if NF type is AMF and information is available in AMF). Backup AMF(s) sent
only once by the AMF to the UDM in its first interaction with the UDM,
indication of no event exposure subscription information available (if NF Type
is AMF). PCF ID selected for the PDN connection/PDU Session (If NF type is
SMF), UE MINT support indicator, Disaster Roaming indicator indicating that
Disaster Roaming service is applied.
**Outputs, Required:** Result indication _._
**Outputs, Optional:** None.
If the PEI was retrieved by the AMF (either from the UE or another AMF), AMF
shall provide it to the UDM using Nudm_UECM_Registration in order to ensure
that the UDM always has the latest PEI available e.g. for reporting event
Change of SUPI-PEI association.
See step 14a of clause 4.2.2.2.2 for an example usage of this service
operation.
##### 5.2.3.2.2 Nudm_UECM_DeregistrationNotification service operation
**Service operation name:** Nudm_UECM_DeregistrationNotification.
**Description:** UDM notifies the NF consumer which has previously registered
(using Nudm_UECM_Registration operation) has been deregistered in the UDM. As
a result, the consumer is no longer registered in UDM as a serving NF for that
UE.
NOTE: This notification corresponds to an implicit subscription.
**Inputs, Required:** SUPI, Access Type, PDU Session ID, serving NF
deregistration reason.
**Inputs, Optional:** NF ID in the case of SM Context Transfer _._
**Outputs, Required:** None.
**Outputs, Optional:** None.
See step 14d of clauses 4.2.2.2.2 and 4.26.5.3 for an example usage of this
service operation. The serving NF deregistration reason tells the reason for
sending the deregistration notification to the consumer NF.
The reason for AMF deregistration can be one of the following:
\- UE Initial Registration.
\- UE Registration area change.
\- Subscription Withdrawn.
\- 5GS to EPS Mobility.
The reason for SMF deregistration can be one of the following:
\- SMF Context Transfer.
\- Removal of duplicated PDU Sessions in the old SMF.
\- PDU session being released requested to be re-activated.
\- Other UDM determined reason as specified in TS 29.503 [52].
##### 5.2.3.2.3 Nudm_UECM_Deregistration service operation
**Service operation name:** Nudm_UECM_Deregistration.
**Description:** The NF consumer requests the UDM to delete the information
related to the NF in the UE context. When the consumer is AMF, this implies
that the subscriptions to be notified when the NF is deregistered in UDM (i.e.
Nudm_UECM_DeregistrationNotification) are also removed.
**Inputs, Required:** SUPI, NF type, Access Type, PDU Session Id (if NF Type
is SMF), Analytics ID(s) (if NF Type is NWDAF).
\- Access Type is included only when the NF type indicates AMF or SMSF.
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.3.2.4 Nudm_UECM_Get service operation
**Service operation name:** Nudm_UECM_Get.
**Description:** The NF consumer requests the UDM to get the NF ID or SMS
address of the NF serving the UE.
**Inputs, Required:** UE ID, NF Type.
**Inputs, Optional:** Access Type, Analytics ID(s) (if NF Type is NWDAF),
indication to retrieve PDU Session ID information.
\- Access Type is included when the NF type indicates SMSF.
**Outputs, Required:** NF ID or SMS address of the NF corresponding to the NF
type requested by NF consumer. If the NF Type requested by NF consumer is AMF,
the Access Type corresponding to the AMF is also included. Analytics ID(s), if
NF Type is NWDAF.
**Outputs, Optional:** SUPI or GPSI or both, PDU Session ID(s) already
registered in the UDM for the UE.
For more information on retrieving PDU Session information, refer to clause
4.11.0a.5.
##### 5.2.3.2.5 Nudm_UECM_Update service operation
**Service operation name:** Nudm_UECM_Update.
**Description:** Consumer updates some UE related information (e.g. UE
capabilities, Intersystem continuity context, SMF+PGW-C FQDN for S5/S8
interface, Analytics ID(s) in the case of NWDAF).
**Inputs, Required:** NF ID, SUPI, NF type, UE context information.
**Inputs, Optional:** \"Homogeneous Support of IMS Voice over PS Sessions\"
indication (if NF Type is AMF), UE MINT support indicator (if NF Type is AMF),
SMF+PGW-C FQDN for S5/S8 interface (if NF Type is SMF), UE memory available
for SMS indication (if NF Type is SMSF).
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.3.2.6 Nudm_UECM_PCscfRestoration service operation
**Service operation name:** Nudm_UECM_PCscfRestoration.
**Description:** UDM notifies the AMF and/or SMF(s) which indicated during
registration in UDM to be notified of the need for P-CSCF Restoration.
**Inputs, Required:** SUPI.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.3.2.7 Nudm_UECM_SendRoutingInfoForSM service operation
**Service operation name:** Nudm_UECM_SendRoutingInfoForSM.
**Description:** This service operation is used to get SMS Routing Info for MT
SMS.
**Inputs, Required:** GPSI.
**Inputs, Optional:** None.
**Outputs, Required:** Result indication, SMS Routing Info.
**Outputs, Optional:** None.
#### 5.2.3.3 Nudm_SubscriberDataManagement (SDM) Service
##### 5.2.3.3.1 General
Subscription data types used in the Nudm_SubscriberDataManagement Service are
defined in Table 5.2.3.3.1-1 below.
Table 5.2.3.3.1-1: UE Subscription data types
+----------------------+----------------------+----------------------+ | Subscription data | Field | Description | | type | | | +======================+======================+======================+ | Access and Mobility | GPSI List | List of the GPSI | | Subscription data | | (Generic Public | | (data needed for UE | | Subscription | | | | Identifier) used | | | | _both inside and | | | | outside of the 3GPP | | | | system_ to address a | | | | 3GPP subscription | | | | (see NOTE 9). | +----------------------+----------------------+----------------------+ | Registration and | Internal Group | List of the | | Mobility Management) | ID-list | subscribed internal | | | | group(s) that the UE | | | | belongs to. | +----------------------+----------------------+----------------------+ | | Subscribed UE-AMBR | The maximum | | | | aggregated uplink | | | | and downlink MBRs to | | | | be shared across all | | | | Non-GBR QoS Flows | | | | according to the | | | | subscription of the | | | | user. | +----------------------+----------------------+----------------------+ | | Subscribed | List of maximum | | | UE-Slice-MBR(s) | aggregated uplink | | | | and downlink MBRs to | | | | be shared across all | | | | GBR and Non-GBR QoS | | | | Flows related to the | | | | same S-NSSAI | | | | according to the | | | | subscription of the | | | | user. There is a | | | | single uplink and a | | | | single downlink | | | | value per S-NSSAI. | +----------------------+----------------------+----------------------+ | | Subscribed S-NSSAIs | The Network Slices | | | | that the UE | | | | subscribes to. In | | | | the roaming case, it | | | | indicates the | | | | subscribed Network | | | | Slices applicable to | | | | the Serving PLMN | | | | (NOTE 11). | | | | | | | | For a subscribed | | | | S-NSSAI subject to | | | | NSAC for the | | | | registered number of | | | | UE, the applicable | | | | NSAC admission mode | | | | is included as | | | | described in | | | | clause 4.2.11.5.2. | +----------------------+----------------------+----------------------+ | | Default S-NSSAIs | The Subscribed | | | | S-NSSAIs marked as | | | | default S-NSSAI. In | | | | the roaming case, | | | | only those | | | | applicable to the | | | | Serving PLMN | | | | (NOTE 12). | +----------------------+----------------------+----------------------+ | | Slice Usage Policy | Includes: | | | information | | | | | - indication the | | | | S-NSSAI is on | | | | demand; and | | | | | | | | - slice | | | | deregistration | | | | inactivity timer | | | | value. | | | | | | | | The AMF uses this | | | | information as | | | | described in | | | | clause 5.15.15 of | | | | TS 23.501 [2]. | | | | | | | | (NOTE 22) | +----------------------+----------------------+----------------------+ | | S-NSSAIs subject to | The Subscribed | | | Network | S-NSSAIs marked as | | | Slice-Specific | subject to NSSAA. | | | Authentication and | When present, the | | | Authorization | GPSI list shall | | | | include at least one | | | | GPSI. | +----------------------+----------------------+----------------------+ | | Network Slice | Optionally, for each | | | Simultaneous | S-NSSAI in the | | | Registration Group | Subscribed S-NSSAIs, | | | Information | one or more value of | | | | Network Slice | | | | Simultaneous | | | | Registration | | | | Group(s) (NOTE 11) | | | | associated with the | | | | S-NSSAI. | +----------------------+----------------------+----------------------+ | | UE Usage Type | As defined in | | | | clause 5.15.7.2 of | | | | TS 23.501 [2]. | +----------------------+----------------------+----------------------+ | | RAT restriction | 3GPP and non-3GPP | | | | Radio Access | | | | Technology(ies) not | | | | allowed the UE to | | | | access. | +----------------------+----------------------+----------------------+ | | Forbidden area | Defines areas in | | | | which the UE is not | | | | permitted to | | | | initiate any | | | | communication with | | | | the network. | +----------------------+----------------------+----------------------+ | | Service Area | Indicates Allowed | | | Restriction | Areas in which the | | | | UE is permitted to | | | | initiate | | | | communication with | | | | the network and | | | | Non-allowed areas in | | | | which the UE and the | | | | network are not | | | | allowed to initiate | | | | Service Request or | | | | SM signalling to | | | | obtain user | | | | services. | +----------------------+----------------------+----------------------+ | | Core Network type | Defines whether UE | | | restriction | is allowed to | | | | connect to 5GC | | | | and/or EPC for this | | | | PLMN. | +----------------------+----------------------+----------------------+ | | CAG information | The CAG information | | | | includes Allowed CAG | | | | list and optionally | | | | an indication | | | | whether the UE is | | | | only allowed to | | | | access 5GS via CAG | | | | cells and each entry | | | | in the Allowed CAG | | | | list may also be | | | | associated with | | | | validity conditions | | | | as defined in | | | | clause 5.30.3 of | | | | TS 23.501 [2]. | +----------------------+----------------------+----------------------+ | | CAG information | When present, | | | Subscription Change | indicates to the | | | Indication | serving AMF that the | | | | CAG information in | | | | the subscription | | | | data changed and the | | | | UE must be updated. | +----------------------+----------------------+----------------------+ | | RFSP Index | An index to specific | | | | RRM configuration in | | | | the NG-RAN. | +----------------------+----------------------+----------------------+ | | Subscribed Periodic | Indicates a | | | Registration Timer | subscribed Periodic | | | | Registration Timer | | | | value, which may be | | | | influenced by e.g. | | | | network | | | | configuration | | | | parameter as | | | | specified in | | | | clause 4.15.6.3a. | +----------------------+----------------------+----------------------+ | | Subscribed Active | Indicates a | | | Time | subscribed active | | | | time value, which | | | | may be influenced by | | | | e.g. network | | | | configuration | | | | parameter as | | | | specified in | | | | clause 4.15.6.3a. | +----------------------+----------------------+----------------------+ | | MPS priority | Indicates the user | | | | is subscribed to MPS | | | | as indicated in | | | | clause 5.16.5 of | | | | TS 23.501 [2]. | +----------------------+----------------------+----------------------+ | | MCX priority | Indicates the user | | | | is subscribed to MCX | | | | as indicated in | | | | clause 5.16.6 of | | | | TS 23.501 [2]. | +----------------------+----------------------+----------------------+ | | AMF-Associated | Information on | | | Expected UE | expected UE movement | | | Behaviour parameters | and communication | | | | characteristics. See | | | | clause 4.15.6.3 | +----------------------+----------------------+----------------------+ | | Steering of Roaming | List of preferred | | | | PLMN/access | | | | technology | | | | combinations and/or | | | | Credentials Holder | | | | controlled | | | | prioritized lists of | | | | preferred SNPNs and | | | | GINs and/or | | | | Credentials Holder | | | | controlled | | | | prioritized lists of | | | | preferred SNPNs and | | | | GINs for accessing | | | | Localized Services | | | | (see NOTE 21) or | | | | HPLMN/Credentials | | | | Holder indication | | | | that no change of | | | | the above list(s) | | | | stored in the UE is | | | | needed (see NOTE 3). | | | | | | | | Optionally includes | | | | an indication that | | | | the UDM requests an | | | | acknowledgement of | | | | the reception of | | | | this information | | | | from the UE. | +----------------------+----------------------+----------------------+ | | SoR Update Indicator | An indication | | | for Initial | whether the UDM | | | Registration | requests the AMF to | | | | retrieve SoR | | | | information when the | | | | UE performs | | | | Registration with | | | | NAS Registration | | | | Type \"Initial | | | | Registration\". | +----------------------+----------------------+----------------------+ | | SoR Update Indicator | An indication | | | for Emergency | whether the UDM | | | Registration | requests the AMF to | | | | retrieve SoR | | | | information when the | | | | UE performs | | | | Registration with | | | | NAS Registration | | | | Type \"Emergency | | | | Registration\". | +----------------------+----------------------+----------------------+ | | Network Slicing | When present, | | | Subscription Change | indicates to the | | | Indicator | serving AMF that the | | | | subscription data | | | | for network slicing | | | | changed and the UE | | | | configuration must | | | | be updated. | +----------------------+----------------------+----------------------+ | | Provide the UE with | Indicates the AMF to | | | the full set of | provide the UE with | | | subscribed S-NSSAIs | the full set of | | | | subscribed S-NSSAIs | | | | even if they do not | | | | share a common | | | | NSSRG. | +----------------------+----------------------+----------------------+ | | Tracing Requirements | Trace requirements | | | | about a UE (e.g. | | | | trace reference, | | | | address of the Trace | | | | Collection Entity, | | | | etc.) is defined in | | | | TS 32.421 [39]. | +----------------------+----------------------+----------------------+ | | Inclusion of NSSAI | When present, it is | | | in RRC Connection | used to indicate | | | Establishment | that the UE is | | | Allowed | allowed to include | | | | NSSAI in the RRC | | | | connection | | | | Establishment in | | | | clear text for 3GPP | | | | access. | +----------------------+----------------------+----------------------+ | | Service Gap Time | Used to set the | | | | Service Gap timer | | | | for Service Gap | | | | Control (see | | | | clause 5.31.16 of | | | | TS 23.501 [2]). | +----------------------+----------------------+----------------------+ | | Subscribed DNN list | List of the | | | | subscribed DNNs for | | | | the UE (NOTE 1). | | | | Used to determine | | | | the list of LADN | | | | available to the UE | | | | as defined in | | | | clause 5.6.5 of | | | | TS 23.501 [2]. | +----------------------+----------------------+----------------------+ | | UDM Update Data | Includes a set of | | | | parameters see | | | | clause 4.20.1 for | | | | parameters possible | | | | to deliver) to be | | | | delivered from UDM | | | | to the UE via NAS | | | | signalling as | | | | defined in | | | | clause 4.20 | | | | (NOTE 3). | | | | | | | | Optionally includes | | | | an indication that | | | | the UDM requests an | | | | acknowledgement of | | | | the reception of | | | | this information | | | | from the UE and an | | | | indication for the | | | | UE to re-register. | +----------------------+----------------------+----------------------+ | | NB-IoT UE priority | Numerical value used | | | | by the NG-RAN to | | | | prioritise between | | | | UEs accessing via | | | | NB-IoT. | +----------------------+----------------------+----------------------+ | | Enhanced Coverage | Specifies whether CE | | | Restriction | mode B is restricted | | | | for the UE, or both | | | | CE mode A and CE | | | | mode B are | | | | restricted for the | | | | UE, or both CE mode | | | | A and CE mode B are | | | | not restricted for | | | | the UE. | +----------------------+----------------------+----------------------+ | | NB-IoT Enhanced | Indicates whether | | | Coverage Restriction | Enhanced Coverage | | | | for NB-IoT UEs is | | | | restricted or not. | +----------------------+----------------------+----------------------+ | | IAB-Operation | Indicates that the | | | allowed | subscriber is | | | | allowed for | | | | IAB-operation as | | | | specified in | | | | clause 5.35.2 of | | | | TS 23.501 [2]. | +----------------------+----------------------+----------------------+ | | MBSR Operation | Indicates whether | | | allowed | the subscriber is | | | | allowed for MBSR | | | | operation as | | | | specified in | | | | clause 5.35A.4 of | | | | TS 23.501 [2], | | | | optionally, with | | | | corresponding | | | | location and time | | | | period. | +----------------------+----------------------+----------------------+ | | Charging | It contains the | | | Characteristics | Charging | | | | Characteristics as | | | | defined in Annex A | | | | of TS 32.256 [71]. | | | | | | | | This information, | | | | when provided, shall | | | | override any | | | | corresponding | | | | predefined | | | | information at the | | | | AMF. | +----------------------+----------------------+----------------------+ | | Extended idle mode | Indicates a | | | DRX cycle length | subscribed extended | | | | idle mode DRX cycle | | | | length value. | +----------------------+----------------------+----------------------+ | | PCF Selection | list of combination | | | Assistance info | of DNN and S-NSSAI | | | | that indicates that | | | | the same PCF needs | | | | to be selected for | | | | AM Policy Control | | | | and SM Policy | | | | Control (NOTE 10). | +----------------------+----------------------+----------------------+ | | Aeri | Aerial UE | | | alUESubscriptionInfo | Subscription | | | | Information. It | | | | contains an | | | | Indication on | | | | whether Aerial | | | | service for the UE | | | | is allowed or not. | +----------------------+----------------------+----------------------+ | | 5G Access | Includes the Access | | | Stratum-based Time | Stratum Time | | | Synchronization | Synchronization | | | Service Data | Service | | | | Authorization to | | | | indicate whether the | | | | UE should be | | | | provisioned with 5G | | | | system internal | | | | clock timing | | | | information over | | | | access stratum. | | | | | | | | Optionally includes | | | | an Uu time | | | | synchronization | | | | error budget. | | | | | | | | Optionally includes | | | | one or more periods | | | | of start and stop | | | | times defining the | | | | times when the UE | | | | should be | | | | provisioned with 5G | | | | system internal | | | | clock timing | | | | information. | | | | | | | | Optionally includes | | | | a Time | | | | Synchronization | | | | Coverage Area | | | | comprising a list of | | | | TAs where the UE | | | | shall be provisioned | | | | with 5G system | | | | internal clock | | | | timing information | | | | (NOTE 19). | | | | | | | | Optionally includes | | | | a clock quality | | | | detail level to | | | | indicate whether and | | | | which clock quality | | | | information to | | | | provide to the UE. | | | | It comprises one of | | | | the following | | | | values: clock | | | | quality metrics or | | | | acceptable/not | | | | acceptable | | | | indication. | | | | | | | | Optionally includes | | | | the clock quality | | | | acceptance criteria | | | | for the UE. It may | | | | be defined based on | | | | one or more of the | | | | following | | | | attributes: time | | | | source, traceability | | | | to UTC and to GNSS, | | | | synchronization | | | | state, clock | | | | accuracy, frequency | | | | stability. | +----------------------+----------------------+----------------------+ | | Routing Indicator | Routing Indicator | | | | assigned to the | | | | SUPI. | +----------------------+----------------------+----------------------+ | Slice Selection | Subscribed S-NSSAIs | The Network Slices | | Subscription data | | that the UE | | (data needed for | | subscribes to. In | | | | roaming case, it | | | | indicates the | | | | subscribed network | | | | slices applicable to | | | | the serving PLMN | | | | (NOTE 11). | +----------------------+----------------------+----------------------+ | Slice Selection as | Default S-NSSAIs | The Subscribed | | described in | | S-NSSAIs marked as | | clause 4.2.2.2.3 and | | default S-NSSAI. In | | | | the roaming case, | | | | only those | | | | applicable to the | | | | Serving PLMN | | | | (NOTE 12). | +----------------------+----------------------+----------------------+ | in clause 4.11.0a.5) | S-NSSAIs subject to | The Subscribed | | | Network | S-NSSAIs marked as | | | Slice-Specific | subject to NSSAA. | | | Authentication and | | | | Authorization | | +----------------------+----------------------+----------------------+ | | Network Slice | Optionally, for each | | | Simultaneous | S-NSSAI in the | | | Registration Group | Subscribed S-NSSAIs, | | | (NSSRG) Information | the one or more | | | | value of Network | | | | Slice Simultaneous | | | | Registration | | | | Group(s) (NOTE 11) | | | | associated with the | | | | S-NSSAI. | +----------------------+----------------------+----------------------+ | SMF Selection | SUPI | Key | +----------------------+----------------------+----------------------+ | Subscription data | **SMF Selection | | | (data needed for SMF | Subscription data | | | | contains one or more | | | | S-NSSAI level | | | | subscription data:** | | +----------------------+----------------------+----------------------+ | Selection as | S-NSSAI | Indicates the value | | described | | of the S-NSSAI. | +----------------------+----------------------+----------------------+ | in clause 6.3.2 of | Subscribed DNN list | List of the | | | | subscribed DNNs for | | | | the UE (NOTE 1). | +----------------------+----------------------+----------------------+ | TS 23.501 [2]) | Default DNN | The default DNN if | | | | the UE does not | | | | provide a DNN | | | | (NOTE 2). | +----------------------+----------------------+----------------------+ | | DNN(s) subject to | List of DNNs that | | | aerial services | are used for aerial | | | | services (e.g. UAS | | | | operations or C2, | | | | etc.) as described | | | | in TS 23.256 [80]. | | | | (see NOTE 13). | +----------------------+----------------------+----------------------+ | | LBO Roaming | Indicates whether | | | Information | LBO roaming is | | | | allowed per DNN, or | | | | per (S-NSSAI, | | | | subscribed DNN). | | | | (NOTE 16) | +----------------------+----------------------+----------------------+ | | HR-SBO allowed | Indicates whether | | | indication | Session Breakout for | | | | HR Session in VPLMN | | | | is allowed per DNN, | | | | or per (S-NSSAI, | | | | subscribed DNN). | | | | | | | | (NOTE 17) | +----------------------+----------------------+----------------------+ | | Interworking with | Indicates whether | | | EPS indication list | EPS interworking is | | | | supported per | | | | (S-NSSAI, subscribed | | | | DNN). | +----------------------+----------------------+----------------------+ | | Same SMF for | Indication whether | | | Multiple PDU | the same SMF for | | | Sessions to the same | multiple PDU | | | DNN and S-NSSAI | Sessions to the same | | | | DNN and S-NSSAI is | | | | required. | +----------------------+----------------------+----------------------+ | | Invoke NEF | When present, | | | indication | indicates, per | | | | S-NSSAI and per DNN, | | | | that NEF based | | | | infrequent small | | | | data transfer shall | | | | be used for the PDU | | | | Session (see | | | | NOTE 8). | +----------------------+----------------------+----------------------+ | | SMF information for | When static IP | | | static IP | address/prefix is | | | address/prefix | used, this may be | | | | used to indicate the | | | | associated SMF | | | | information per | | | | (S-NSSAI, DNN). | +----------------------+----------------------+----------------------+ | UE context in SMF | SUPI | Key. | +----------------------+----------------------+----------------------+ | data | PDU Session Id(s) | List of PDU Session | | | | Id(s) for the UE. | +----------------------+----------------------+----------------------+ | | **For emergency PDU | | | | Session Id:** | | +----------------------+----------------------+----------------------+ | | Emergency | The SMF+PGW-C FQDN | | | Information | for emergency | | | | session used for | | | | interworking with | | | | EPC. | +----------------------+----------------------+----------------------+ | | **For each | | | | non-emergency PDU | | | | Session Id:** | | +----------------------+----------------------+----------------------+ | | DNN | DNN for the PDU | | | | Session. | +----------------------+----------------------+----------------------+ | | SMF | Allocated SMF for | | | | the PDU Session. | | | | Includes SMF IP | | | | Address and SMF NF | | | | Id. | +----------------------+----------------------+----------------------+ | | SMF+PGW-C FQDN | The S5/S8 SMF+PGW-C | | | | FQDN used for | | | | interworking with | | | | EPS (see NOTE 5). | +----------------------+----------------------+----------------------+ | | PCF ID | The PCF ID serving | | | | the PDU Session/PDN | | | | Connection. | +----------------------+----------------------+----------------------+ | SMS Management | SMS parameters | Indicates SMS | | Subscription data | | parameters | | (data needed by | | subscribed for SMS | | | | service such as SMS | | | | teleservice, SMS | | | | barring list | +----------------------+----------------------+----------------------+ | SMSF for SMSF | Trace Requirements | Trace requirements | | Registration) | | about a UE (e.g. | | | | trace reference, | | | | address of the Trace | | | | Collection Entity, | | | | etc.) is defined in | | | | TS 32.421 [39]. | | | | | | | | This information is | | | | only sent to a SMSF | | | | in HPLMN. | +----------------------+----------------------+----------------------+ | | Routing Indicator | Routing Indicator | | | | assigned to the | | | | SUPI. | +----------------------+----------------------+----------------------+ | SMS Subscription | SMS Subscription | Indicates | | data | | subscription to any | | | | SMS delivery service | | | | over NAS | | | | irrespective of | | | | access type. | +----------------------+----------------------+----------------------+ | (data needed in AMF) | | | +----------------------+----------------------+----------------------+ | UE Context in SMSF | SMSF Information | Indicates SMSF | | data | | allocated for the | | | | UE, including SMSF | | | | address and SMSF NF | | | | ID. | +----------------------+----------------------+----------------------+ | | Access Type | 3GPP or non-3GPP | | | | access through this | | | | SMSF | +----------------------+----------------------+----------------------+ | Session Management | GPSI List | List of the GPSI | | Subscription data | | (Generic Public | | (data needed for PDU | | Subscription | | | | Identifier) used | | | | _both inside and | | | | outside of the 3GPP | | | | system_ to address a | | | | 3GPP subscription. | +----------------------+----------------------+----------------------+ | Session | Internal Group | List of the | | Establishment) | ID-list | subscribed internal | | | | group(s) that the UE | | | | belongs to. | +----------------------+----------------------+----------------------+ | | Trace Requirements | Trace requirements | | | | about a UE (e.g. | | | | trace reference, | | | | address of the Trace | | | | Collection Entity, | | | | etc...) is defined | | | | in TS 32.421 [39]. | | | | | | | | This information is | | | | only sent to a SMF | | | | in the HPLMN or one | | | | of its equivalent | | | | PLMN(s). | +----------------------+----------------------+----------------------+ | | Routing Indicator | Routing Indicator | | | | assigned to the | | | | SUPI. | +----------------------+----------------------+----------------------+ | | **Session Management | | | | Subscription data | | | | contains one or more | | | | S-NSSAI level | | | | subscription data:** | | +----------------------+----------------------+----------------------+ | | S-NSSAI | Indicates the value | | | | of the S-NSSAI. | | | | | | | | For a subscribed | | | | S-NSSAI subject to | | | | NSAC for the | | | | established PDU | | | | session number, the | | | | applicable NSAC | | | | admission mode is | | | | included as | | | | described in | | | | clause 4.2.11.5.2. | +----------------------+----------------------+----------------------+ | | Subscribed DNN list | List of the | | | | subscribed DNNs for | | | | the S-NSSAI | | | | (NOTE 1). | +----------------------+----------------------+----------------------+ | | Slice Usage Policy | Includes: | | | information | | | | | - indication the | | | | S-NSSAI is on | | | | demand; and | | | | | | | | - PDU Session | | | | inactivity timer | | | | value. | | | | | | | | The SMF uses this | | | | information as | | | | described in | | | | clause 5.15.15 of | | | | TS 23.501 [2]. | | | | | | | | (NOTE 22) | +----------------------+----------------------+----------------------+ | | **For each DNN in | | | | S-NSSAI level | | | | subscription data:** | | +----------------------+----------------------+----------------------+ | | DNN | DNN for the PDU | | | | Session. | +----------------------+----------------------+----------------------+ | | Aerial service | Indicates whether | | | indication | the DNN is used for | | | | aerial services | | | | (e.g. UAS operations | | | | or C2, etc.) as | | | | described in | | | | TS 23.256 [80]. | +----------------------+----------------------+----------------------+ | | Framed Route | Set of Framed | | | information | Routes. A Framed | | | | Route refers to a | | | | range of IPv4 | | | | addresses / IPv6 | | | | Prefixes to | | | | associate with a PDU | | | | Session established | | | | on this (DNN, | | | | S-NSSAI). | | | | | | | | See NOTE 4. | +----------------------+----------------------+----------------------+ | | IP Index information | Information used for | | | | selecting how the UE | | | | IP address is to be | | | | allocated (see | | | | clause 5.8.2.2.1 of | | | | TS 23.501 [2]). | +----------------------+----------------------+----------------------+ | | Allowed PDU Session | Indicates the | | | Types | allowed PDU Session | | | | Types (IPv4, IPv6, | | | | IPv4v6, Ethernet and | | | | Unstructured) for | | | | the DNN, S-NSSAI. | | | | See NOTE 6. | +----------------------+----------------------+----------------------+ | | Default PDU Session | Indicates the | | | Type | default PDU Session | | | | Type for the DNN, | | | | S-NSSAI. | +----------------------+----------------------+----------------------+ | | Allowed SSC modes | Indicates the | | | | allowed SSC modes | | | | for the DNN, | | | | S-NSSAI. | +----------------------+----------------------+----------------------+ | | Default SSC mode | Indicate the default | | | | SSC mode for the | | | | DNN, S-NSSAI. | +----------------------+----------------------+----------------------+ | | Interworking with | Indicates whether | | | EPS indication | interworking with | | | | EPS is supported for | | | | this DNN and | | | | S-NSSAI. | +----------------------+----------------------+----------------------+ | | 5GS Subscribed QoS | The QoS Flow level | | | profile | QoS parameter values | | | | (5QI and ARP) for | | | | the DNN, S-NSSAI | | | | (see clause 5.7.2.7 | | | | of TS 23.501 [2]). | +----------------------+----------------------+----------------------+ | | Charging | It contains Charging | | | Characteristics | Characteristics as | | | | defined in Annex A | | | | clause A.1 of | | | | TS 32.255 [45]. | | | | This information, | | | | when provided, shall | | | | override any | | | | corresponding | | | | predefined | | | | information at the | | | | SMF. | +----------------------+----------------------+----------------------+ | | Sub | The maximum | | | scribed-Session-AMBR | aggregated uplink | | | | and downlink MBRs to | | | | be shared across all | | | | Non-GBR QoS Flows in | | | | each PDU Session, | | | | which are | | | | established for the | | | | DNN, S-NSSAI. | +----------------------+----------------------+----------------------+ | | Static IP | Indicate the static | | | address/prefix | IP address/prefix | | | | for the DNN, | | | | S-NSSAI. | +----------------------+----------------------+----------------------+ | | User Plane Security | Indicates the | | | Policy | security policy for | | | | integrity protection | | | | and encryption for | | | | the user plane. | +----------------------+----------------------+----------------------+ | | PDU Session | Provides for this | | | continuity at inter | DDN, S-NSSAI how to | | | RAT mobility | handle a PDU Session | | | | when UE the moves to | | | | or from NB-IoT. | | | | Possible values are: | | | | maintain the PDU | | | | session; disconnect | | | | the PDU session with | | | | a reactivation | | | | request; disconnect | | | | PDU session without | | | | reactivation | | | | request; or to leave | | | | it to local VPLMN | | | | policy. | +----------------------+----------------------+----------------------+ | | NEF Identity for | When present, | | | NIDD | indicates, per | | | | S-NSSAI and per DNN, | | | | the identity of the | | | | NEF to anchor | | | | Unstructured PDU | | | | Session. When not | | | | present for the | | | | S-NSSAI and DNN, the | | | | PDU session | | | | terminates in UPF | | | | (see NOTE 8). | +----------------------+----------------------+----------------------+ | | NIDD information | Information such as | | | | External Group | | | | Identifier, External | | | | Identifier, MSISDN, | | | | or AF Identifier | | | | used for SMF-NEF | | | | Connection. | +----------------------+----------------------+----------------------+ | | SMF-Associated | Parameters on | | | Expected UE | expected | | | Behaviour parameters | characteristics of a | | | | PDU Session their | | | | corresponding | | | | validity times as | | | | specified in | | | | clause 4.15.6.3. | +----------------------+----------------------+----------------------+ | | SMF-Associated | Parameters | | | Application-Specific | characterise the | | | Expected UE | foreseen behaviour | | | Behaviours | of a UE for a | | | parameters | specific application | | | | as specified in | | | | clause 4.15.6.3f. | +----------------------+----------------------+----------------------+ | | Suggested number of | Parameters on | | | downlink packets | expected PDU session | | | | characteristics as | | | | specified in clauses | | | | 4.15.3.2.3b and | | | | 4.15.6.3a. | +----------------------+----------------------+----------------------+ | | ATSSS information | Indicates whether MA | | | | PDU session | | | | establishment is | | | | allowed. | +----------------------+----------------------+----------------------+ | | Secondary | Indicates that | | | authentication | whether the | | | indication | Secondary | | | | authenti | | | | cation/authorization | | | | (as defined in | | | | clause 5.6 of | | | | TS 23.501 [2]) is | | | | required for PDU | | | | Session | | | | Establishment or PDN | | | | Connection | | | | Establishment as | | | | specified in | | | | clause 4.3.2.3 and | | | | clause H.2. (see | | | | NOTE 14) | +----------------------+----------------------+----------------------+ | | DN-AAA Server UE IP | Indicates that | | | address allocation | whether the SMF is | | | indication | required to request | | | | the UE IP address | | | | from the DN-AAA | | | | Server (as defined | | | | in clause 5.6 of | | | | TS 23.501 [2]) for | | | | PDU Session | | | | Establishment or or | | | | PDN Connection | | | | Establishment as | | | | specified in | | | | clause 4.3.2.3 and | | | | clause H.2. | +----------------------+----------------------+----------------------+ | | DN-AAA Server | If at least one of | | | addressing | secondary DN-AAA | | | information | authentication, | | | | DN-AAA authorization | | | | or DN-AAA UE IP | | | | address allocation | | | | is required by | | | | subscription data, | | | | the subscription | | | | data may also | | | | contain DN-AAA | | | | Server addressing | | | | information. | +----------------------+----------------------+----------------------+ | | Edge Configuration | Consists of one or | | | Server Address | more ECS | | | Configuration | Configuration | | | Information | Information as | | | | defined in | | | | clause 8.3.2.1 of | | | | TS 23.558 [83]. | | | | The ECS | | | | Configuration | | | | Information sent by | | | | UDM to SMF is | | | | associated with the | | | | PLMN ID where the UE | | | | is roaming on. (see | | | | NOTE 20) | +----------------------+----------------------+----------------------+ | | API based secondary | Indicates that | | | authentication | whether the API | | | indication | based Secondary | | | | authenti | | | | cation/authorization | | | | (as defined in | | | | clause 5.2.3 of | | | | TS 23.256 [80]) is | | | | required for PDU | | | | Session | | | | Establishment or PDN | | | | Connection | | | | Establishment as | | | | specified in | | | | clause 4.3.2.3 and | | | | clause H.2 (see | | | | NOTE 14). | +----------------------+----------------------+----------------------+ | | UE authorization for | Indicates whether | | | EAS discovery via | the UE is authorized | | | EASDF | to use 5GC assisted | | | | EAS discovery via | | | | EASDF (as defined in | | | | TS 23.548 [74]). | +----------------------+----------------------+----------------------+ | | HR-SBO authorization | Indicates whether | | | indication | the VPLMN is | | | | authorized for Home | | | | Routed Session | | | | Breakout (HR-SBO) | | | | (see NOTE 17 and | | | | NOTE 18). | +----------------------+----------------------+----------------------+ | Identifier | SUPI | Corresponding SUPI | | translation | | for input GPSI. | +----------------------+----------------------+----------------------+ | | (Optional) MSISDN | Corresponding GPSI | | | | (MSISDN) for input | | | | GPSI (External | | | | Identifier). This is | | | | optionally provided | | | | for legacy SMS | | | | infrastructure not | | | | supporting | | | | MSISDN-less SMS. The | | | | presence of an | | | | MSISDN should be | | | | interpreted as an | | | | indication to the | | | | NEF that MSISDN | | | | shall be used to | | | | identify the UE when | | | | sending the SMS to | | | | the SMS-SC via T4. | +----------------------+----------------------+----------------------+ | | GPSI | Corresponding GPSI | | | | for input SUPI and | | | | associated | | | | application | | | | information (e.g. | | | | Application Port ID) | | | | (NOTE 15). | +----------------------+----------------------+----------------------+ | Intersystem | (DNN, PGW FQDN) list | For each DNN, | | continuity Context | | indicates the | | | | SMF+PGW-C which | | | | support interworking | | | | with EPC. | +----------------------+----------------------+----------------------+ | LCS privacy | LCS privacy profile | Provides information | | | data | for LCS privacy | | (data needed by | | classes and Location | | GMLC) | | Privacy Indication | | | | (LPI) as defined in | | | | clause 5.4.2 of | | | | TS 23.273 [51] | +----------------------+----------------------+----------------------+ | LCS mobile | LCS Mobile | When present, | | origination | Originated Data | indicates to the | | | | serving AMF which | | (data needed by AMF) | | LCS mobile | | | | originated services | | | | are subscribed as | | | | defined in | | | | clause 7.1 of | | | | TS 23.273 [51]. | +----------------------+----------------------+----------------------+ | User consent (see | User consent for UE | Indicates whether | | TS 23.288 [50]) | data collection | the user has given | | | | consent for | | | | collecting, | | | | distributing and | | | | analysing UE related | | | | data. User consent | | | | is provided per | | | | purpose (e.g. | | | | analytics, model | | | | training). | +----------------------+----------------------+----------------------+ | UE reachability | UE reachability | Provides, per PLMN, | | | information | the list of NF IDs | | | | or the list of NF | | | | sets or the list of | | | | NF types authorized | | | | to request | | | | notification for | | | | UE\'s reachability | | | | (NOTE 7). | +----------------------+----------------------+----------------------+ | V2X Subscription | NR V2X Services | Indicates whether | | data (see | Authorization | the UE is authorized | | TS 23.287 [73]) | | to use the NR | | | | sidelink for V2X | | | | services as Vehicle | | | | UE, Pedestrian UE, | | | | or both. | +----------------------+----------------------+----------------------+ | | LTE V2X Services | Indicates whether | | | Authorization | the UE is authorized | | | | to use the LTE | | | | sidelink for V2X | | | | services as Vehicle | | | | UE, Pedestrian UE, | | | | or both. | +----------------------+----------------------+----------------------+ | | NR UE-PC5-AMBR | AMBR of UE\'s NR | | | | sidelink (i.e. PC5) | | | | communication for | | | | V2X services. | +----------------------+----------------------+----------------------+ | | LTE UE-PC5-AMBR | AMBR of UE\'s LTE | | | | sidelink (i.e. PC5) | | | | communication for | | | | V2X services. | +----------------------+----------------------+----------------------+ | A2X Subscription | NR A2X Services | Indicates whether | | data (see | Authorization | the UE is authorized | | TS 23.256 [80]) | | to use the NR | | | | sidelink for A2X | | | | services. | +----------------------+----------------------+----------------------+ | | LTE A2X Services | Indicates whether | | | Authorization | the UE is authorized | | | | to use the LTE | | | | sidelink for A2X | | | | services. | +----------------------+----------------------+----------------------+ | | NR UE-PC5-AMBR for | AMBR of UE\'s NR | | | A2X | sidelink (i.e. PC5) | | | | communication for | | | | A2X services. | +----------------------+----------------------+----------------------+ | | LTE UE-PC5-AMBR for | AMBR of UE\'s LTE | | | A2X | sidelink (i.e. PC5) | | | | communication for | | | | A2X services. | +----------------------+----------------------+----------------------+ | ProSe Subscription | ProSe Service | Indications for | | data (see | Authorization | whether the UE is | | TS 23.304 [77]) | | authorised to use | | | | the 5G ProSe | | | | service(s), | | | | including: | | | | | | | | - use 5G ProSe | | | | Direct Discovery; | | | | | | | | - use 5G ProSe | | | | Direct | | | | Communication; | | | | | | | | - act as a 5G ProSe | | | | Remote UE; | | | | | | | | - serve as a 5G | | | | ProSe UE-to-Network | | | | Relay; | | | | | | | | - use multi-path | | | | communication via | | | | direct Uu path and | | | | via 5G ProSe Layer-2 | | | | UE-to-Network Relay | | | | as a 5G ProSe | | | | Layer-2 Remote UE; | | | | | | | | - act as a 5G ProSe | | | | End UE; and | | | | | | | | - serve as a 5G | | | | ProSe UE-to-UE | | | | Relay. | +----------------------+----------------------+----------------------+ | | ProSe NR UE-PC5-AMBR | AMBR of UE\'s NR | | | | sidelink (i.e. PC5) | | | | communication for | | | | ProSe services. | +----------------------+----------------------+----------------------+ | MBS Subscription | MBS Service | Indicates whether | | data (see | Authorization | the UE is authorized | | TS 23.247 [78]) | | to use Multicast MBS | | | | service. May also | | | | indicate the | | | | multicast MBS | | | | Session which the UE | | | | is allowed to join | | | | if the UE is | | | | authorized to use | | | | multicast MBS | | | | Service. | +----------------------+----------------------+----------------------+ | | MBS Assistance | Include MBS | | | Information | assistance | | | | information for a UE | | | | that joins a | | | | multicast group. | +----------------------+----------------------+----------------------+ | Time Synchronization | AF Request | Includes the AF | | Subscription data | Authorization | Request | | (see | Information | Authorization to | | clause 5.27.1.11 of | | indicate whether the | | TS 23.501 [2]) | | UE is authorized for | | | | an AF-requested 5G | | | | access stratum-based | | | | time distribution | | | | and (g)PTP-based | | | | time distribution | | | | services. The | | | | indication is | | | | provided separately | | | | for each service. | | | | | | | | Optionally includes | | | | a list of TA(s) | | | | which specifies the | | | | Authorized Time | | | | Synchronization | | | | Coverage Area in | | | | which an AF may | | | | request time | | | | synchronization | | | | services (NOTE 19). | | | | | | | | Optionally, one or | | | | more periods of | | | | authorized start and | | | | stop times, which | | | | indicates the | | | | allowed time period | | | | during which an AF | | | | may request time | | | | synchronization | | | | services. | | | | | | | | Optionally, | | | | authorized Uu time | | | | synchronization | | | | error budget, which | | | | indicates the limit | | | | the AF may request. | +----------------------+----------------------+----------------------+ | | Subscribed Time | Each containing the | | | Synchronization | DNN/S-NSSAI and a | | | Service ID(s) | reference to a PTP | | | | instance | | | | configuration | | | | pre-configured at | | | | the TSCTSF. | | | | | | | | Optionally, for each | | | | PTP instance | | | | configuration, one | | | | or more periods of | | | | start and stop times | | | | defining active | | | | times of time | | | | synchronization | | | | service for the PTP | | | | instance. | | | | | | | | Optionally, for each | | | | PTP instance | | | | configuration, a | | | | Time Synchronization | | | | Coverage Area | | | | defining a list of | | | | TAs where the | | | | (g)PTP-based time | | | | synchronization is | | | | available for the | | | | UEs in the PTP | | | | instance (NOTE 19). | | | | | | | | Optionally, for each | | | | PTP instance | | | | configuration, Uu | | | | time synchronization | | | | error budget. | +----------------------+----------------------+----------------------+ | Ranging/Sidelink | Ranging/SL | Indicates whether | | Positioning | Positioning Service | the UE is authorized | | Subscription data | Authorization | to use Ranging/SL | | (see | | Positioning Service. | | TS 23.586 [88]) | | | +----------------------+----------------------+----------------------+ | NOTE 1: The | | | | Subscribed DNN list | | | | can include a | | | | wildcard DNN. | | | | | | | | NOTE 2: The default | | | | DNN shall not be a | | | | wildcard DNN. | | | | | | | | NOTE 3: The Steering | | | | of Roaming | | | | information and UDM | | | | Update Data are | | | | protected using the | | | | mechanisms defined | | | | in TS 33.501 [15]. | | | | | | | | NOTE 4: Framed Route | | | | information and | | | | Framed Route(s) are | | | | defined in | | | | TS 23.501 [2]. | | | | | | | | NOTE 5: Depending on | | | | the scenario PGW-C | | | | FQDN may be for | | | | S5/S8, or for S2b | | | | (ePDG case). | | | | | | | | NOTE 6: The Allowed | | | | PDU Session Types | | | | configured for a DNN | | | | which supports | | | | interworking with | | | | EPC should contain | | | | only the PDU Session | | | | Type corresponding | | | | to the PDN Type | | | | configured in the | | | | APN that corresponds | | | | to the DNN. | | | | | | | | NOTE 7: Providing a | | | | list of NF types or | | | | a list of NF sets | | | | may be more | | | | appropriate for some | | | | deployments, e.g. in | | | | highly dynamic NF | | | | lifecycle management | | | | deployments. | | | | | | | | NOTE 8: For a | | | | S-NSSAI and a DNN, | | | | the \"Invoke NEF | | | | Indication\" shall | | | | be present in the | | | | SMF selection | | | | subscription data if | | | | and only if the | | | | \"NEF Identity for | | | | NIDD\" Session | | | | Management | | | | Subscription Data | | | | includes a NEF | | | | Identity. When the | | | | \"NEF Identity for | | | | NIDD\" Session | | | | Management | | | | Subscription Data | | | | includes a NEF | | | | Identity for a | | | | S-NSSAI and DNN, the | | | | \"Control Plane Only | | | | Indicator\" will | | | | always be set for | | | | PDU Sessions to this | | | | S-NSSAI and DNN (see | | | | clause 5.31.4.1 of | | | | TS 23.501 [2]). | | | | | | | | NOTE 9: When | | | | multiple GPSIs are | | | | included in the GPSI | | | | list, any GPSI in | | | | the list can be used | | | | in NSSAA procedures. | | | | | | | | NOTE 10: The same | | | | PCF can be selected | | | | to serve the UE and | | | | to serve one or | | | | multiple PDU | | | | sessions, each of | | | | them is indicated in | | | | the list of S-NSSAI, | | | | DNN combinations in | | | | the PCF Selection | | | | Assistance Info. | | | | Providing one | | | | combination of DNN | | | | and S-NSSAI in the | | | | PCF Selection | | | | Assistance Info is | | | | assumed if | | | | interworking with | | | | EPS is needed. In | | | | case multiple PDU | | | | sessions to one DNN, | | | | S-NSSAI are | | | | established in EPS, | | | | it is appropriate to | | | | select same PCF by | | | | configuration or by | | | | using existing | | | | method, e.g. same | | | | PCF selection in | | | | usage monitoring. | | | | | | | | NOTE 11: If Network | | | | Slice Simultaneous | | | | Registration Group | | | | information is | | | | present and the | | | | VPLMN does not | | | | support the | | | | subscription-based | | | | restrictions to | | | | simultaneous | | | | registration of | | | | network slices, the | | | | subset of the | | | | Subscribed S-NSSAIs | | | | defined in | | | | clause 5.15.12 of | | | | TS 23.501 [2], are | | | | included, without | | | | providing the NSSRG | | | | information. | | | | | | | | NOTE 12: The Default | | | | S-NSSAIs (if more | | | | than one is present) | | | | are associated with | | | | common NSSRG values | | | | if NSSRG information | | | | is present. At least | | | | one Default S-NSSAI | | | | shall be present in | | | | a subscription | | | | including NSSRG | | | | information. | | | | | | | | NOTE 13: When UUAA | | | | is performed in the | | | | AMF (as in | | | | clause 5.2.2 of | | | | TS 23.256 [80]) | | | | and UUAA-MM status | | | | is FAILED or | | | | PENDING, the AMF | | | | shall reject PDU | | | | session | | | | establishment | | | | requests from the UE | | | | for a DNN that is | | | | subject to aerial | | | | services. | | | | | | | | NOTE 14: For a DNN | | | | in S-NSSAI either a | | | | DN-AAA based | | | | secondary | | | | authentication, or | | | | an API based | | | | secondary | | | | authentication can | | | | be configured. When | | | | API based | | | | authentication of | | | | the PDU session is | | | | required, Secondary | | | | authentication | | | | indication shall not | | | | be present. | | | | | | | | NOTE 15: A GPSI may | | | | be associated with | | | | Application Port ID, | | | | MTC Provider | | | | Information and/or | | | | AF Identifier. | | | | | | | | NOTE 16: For | | | | non-roaming UE (e.g. | | | | accessing SNPN with | | | | CH credentials), LBO | | | | roaming information | | | | does not apply. | | | | | | | | NOTE 17: This | | | | information applies | | | | only for HR PDU | | | | Session. | | | | | | | | NOTE 18: This | | | | information is only | | | | valid for the | | | | current serving | | | | network. When | | | | Session Breakout for | | | | HR Session is | | | | authorized, usage of | | | | corresponding EAS | | | | Deployment | | | | Information and AF | | | | traffic influence in | | | | VPLMN is also | | | | authorized. | | | | | | | | NOTE 19: The | | | | subscribed Time | | | | Synchronization | | | | Coverage Area shall | | | | be inside of the | | | | Allowed Areas as per | | | | UE\'s service area | | | | restriction. | | | | | | | | NOTE 20: For roaming | | | | UE in a visited | | | | PLMN, the | | | | corresponding PLMN | | | | ID is provided with | | | | Edge Configuration | | | | Server (ECS) Address | | | | Configuration | | | | Information. | | | | | | | | NOTE 21: The entries | | | | in the Credentials | | | | Holder controlled | | | | prioritized lists of | | | | preferred SNPNs and | | | | GINs for accessing | | | | Localized Services | | | | are associated with | | | | a time validity | | | | indicating the | | | | conditions allowing | | | | the UE to access to | | | | localized services | | | | in the SNPN or/and | | | | location assistance | | | | information used to | | | | aid the UE where to | | | | search for the SNPN | | | | as specified in | | | | clause 5.30.2.3 of | | | | TS 23.501 [2]. | | | | | | | | NOTE 22: Only for an | | | | S-NSSAI dedicated to | | | | a single AF is | | | | associated with | | | | Slice Usage Policy | | | | information. For | | | | roaming UE, Slice | | | | Usage Policy | | | | information does not | | | | apply. | | | +----------------------+----------------------+----------------------+
Table 5.2.3.3.1-2: Group Subscription data types
+----------------------+----------------------+----------------------+ | Subscription data | Field | Description | | type | | | +======================+======================+======================+ | Group Identifier | External Group | Identifies external | | translation | Identifier | group of UEs that | | | | the UE belongs to as | | | | defined in TS | | | | 23.682 [23]. | +----------------------+----------------------+----------------------+ | | Internal Group | Identifies internal | | | Identifier | group of UEs that | | | | the UE belongs to as | | | | defined in TS | | | | 23.501 [2]. | +----------------------+----------------------+----------------------+ | | SUPI list | Corresponding SUPI | | | | list for input | | | | External Group | | | | Identifier. | +----------------------+----------------------+----------------------+ | Group Data | Internal Group | Internal identifiers | | | Identifier | of the group of UEs | | (NOTE 1) | | that the Group Data | | | | belongs to. | +----------------------+----------------------+----------------------+ | | Group data | In the case of 5G VN | | | | related groups the | | | | content of this | | | | information contains | | | | parameters defined | | | | in clause 4.15.6.3b. | | | | | | | | In the case of DNN | | | | and S-NSSAI specific | | | | parameters in the | | | | Groups, the content | | | | of this information | | | | contains parameters | | | | defined in | | | | clause 4.15.6.3e. | +----------------------+----------------------+----------------------+ | NOTE 1: Group Data | | | | within Group | | | | Subscription Data | | | | can be managed using | | | | the Shared Data | | | | feature defined in | | | | TS 29.503 [52]. In | | | | that case, Shared | | | | Data is identified | | | | using Shared Data | | | | identifier and can | | | | contain additional | | | | information than the | | | | one defined in this | | | | table. | | | +----------------------+----------------------+----------------------+
At least a mandatory key is required for each Subscription Data Type to
identify the corresponding data. Depending on the use case, for some
Subscription Data Types it is possible to use one or multiple sub keys to
further identify the corresponding data, as defined in Tables 5.2.3.3.1-3 and
5.2.3.3.1-4 below.
Table 5.2.3.3.1-3: UE Subscription data types keys
Subscription Data Types Data Key Data Sub Key
* * *
Access and Mobility Subscription data SUPI Serving PLMN ID and optionally NID
SMF Selection Subscription data SUPI Serving PLMN ID and optionally NID UE
context in SMF data SUPI S-NSSAI SMS Management Subscription data SUPI Serving
PLMN ID and optionally NID SMS Subscription data SUPI Serving PLMN ID and
optionally NID UE Context in SMSF data SUPI - Session Management Subscription
data SUPI S-NSSAI DNN Serving PLMN ID and optionally NID Identifier
translation GPSI - SUPI Application Port ID, MTC Provider Information, AF
Identifier Slice Selection Subscription data SUPI Serving PLMN ID and
optionally NID Intersystem continuity Context SUPI DNN LCS privacy SUPI - LCS
mobile origination SUPI - User consent SUPI Purpose UE reachability SUPI - V2X
Subscription data SUPI - ProSe Subscription data SUPI - MBS Subscription data
SUPI - A2X Subscription data SUPI - Ranging/Sidelink Positioning Subscription
data SUPI -
Table 5.2.3.3.1-4: Group Subscription data types keys
Subscription Data Types Data Key Data Sub Key
* * *
Group Identifier translation External Group Identifier - Internal Group
Identifier - Group Data Internal Group Identifier -
Wireline access specific subscription data parameters are specified in TS
23.316 [53].
##### 5.2.3.3.2 Nudm_SDM_Get service operation
**Service Operation name** : Nudm_SDM_Get
**Description** : Consumer NF gets the subscription data indicated by the
subscription data type input from UDM. The UDM shall check the requested
consumer is authorized to get the specific subscription data requested. In the
case of NF consumer is SMF, the subscriber data may contain e.g. Allowed PDU
Session Type(s), Allowed SSC mode(s), default 5QI/ARP, Subscribed S-NSSAI(s).
**Inputs, Required:** NF ID, Subscription data type(s), Key for each
Subscription data type(s).
**Inputs, Optional:** Data Sub Key(s), SoR Update Indicator, AF Identifier
(for AF authorisation by the UDM), Disaster Roaming Indicator indicating that
Disaster Roaming service is applied, Serving PLMN ID.
NOTE: Some subscription data subsets can be specific to the Serving PLMN where
the UE is registered (e.g. access and mobility subscription data) as defined
in clause 5.2.12.2.1. If the corresponding NF consumer does not include the
Serving PLMN ID, the UDM provides the subscription data for the SUPI
associated to the HPLMN.
If the AMF already has subscription data for the UE but the SoR Update
Indicator in the UE context requires the AMF to retrieve SoR information
depending on the NAS Registration Type (\"Initial Registration\" or
\"Emergency Registration\"), the AMF shall include SoR update indicator in the
Nudm_SDM_Get depending on the NAS Registration type.
**Outputs, Required:** The consumer NF gets the requested subscription data.
**Outputs, Optional:** None.
##### 5.2.3.3.3 Nudm_SDM_Notification service operation
**Service or service operation name:** Nudm_SDM_Notification
**Description:** The UDM notifies NF consumer of the updates of Subscription
Data indicated by the \"subscription data Type\" input and additional UDM-
related parameters.
**Inputs, Required:** Subscription data type(s), Key for each Subscription
data type(s).
**Inputs, Optional:** None _._
**Outputs, Required:** Result Indication.
The UDM invokes this service operation under the following cases:
\- When the subscription data is updated at the UDM, the updated subscription
information is notified to the serving NF that has subscribed for the specific
subscription data type to be notified.
\- When the UDM needs to deliver Steering of Roaming information to a UE.
\- When the UDM needs to deliver UDM Update Data to a UE (e.g. a new Routing
Indicator or Default Configured NSSAI to the UE).
If the updated subscription information is related to session management the
subscriber data may contain e.g. Allowed PDU Session Type(s), Allowed SSC
mode(s), default 5QI/ARP.
**Outputs, Optional:** Redirection information.
If the NF consumer is AMF and if the result of the service operation fails,
AMF shall set corresponding cause value in result indication which can be used
by the UDM for further action. If the related UE is not served by the AMF and
the AMF knows which AMF is serving the UE, the AMF provides redirection
information which can be used by the UDM to resend UE related message to the
AMF that serves the UE.
##### 5.2.3.3.4 Nudm_SDM_Subscribe service operation
**Service operation name:** Nudm_SDM_Subscribe
**Description:** The NF consumer subscribes for updates to Subscription Data
indicated by the \'subscription data type\' input. The UDM shall check the
requested consumer is authorized to subscribe to requested updates.
**Inputs, Required:** Subscription data type(s), Key for each Subscription
data type(s).
**Inputs, Optional:** Data Sub Key(s), Immediate Report Indication, Disaster
Roaming Indicator indicating that Disaster Roaming service is applied.
**Outputs, Required:** None.
**Outputs, Optional:** Subscription Data.
##### 5.2.3.3.5 Nudm_SDM_Unsubscribe service operation
**Service operation name:** Nudm_SDM_Unsubscribe
**Description:** The NF consumer unsubscribes from updates to Subscription
Data indicated by the \'subscription data type input.
**Inputs, Required:** Subscription data type(s), Key for each Subscription
data type(s).
**Inputs, Optional:** If the NF type is SMF: DNN, S-NSSAI.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.3.3.6 Nudm_SDM_Info service operation
**Service Operation name:** Nudm_SDM_Info
**Description:** Consumer NF provides UDM with information about the status of
the subscription data management procedures. This service operation is used
for:
\- providing acknowledgement from the UE to UDM about successful delivery of
Steering of Roaming information via the AMF as defined in TS 23.122 [22].
\- providing acknowledgement from the UE to UDM about successful Network
Slicing Configuration subsequent to delivery of the Network Slicing
Subscription Change Indication via the AMF.
\- providing acknowledgement from the UE to UDM about successful delivery of
UDM Update Data via the AMF as defined in clause 4.20.
\- providing acknowledgement from the AMF to UDM that the delivery of the UDM
Update Data has failed as defined in clause 4.20.
**Inputs, Required:** SUPI, Info (e.g. UE acknowledgment of SoR information
from UDM via AMF, UE acknowledgement of successful Network Slicing
Configuration subsequent to delivery of the Network Slicing Subscription
Change Indication via the AMF, UE acknowledgment of UDM Update Data from UDM
via AMF, failed transmission of UDM Update Data from UDM via AMF, failed
transmission of SoR information from UDM via AMF).
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.3.3.7 Void
##### 5.2.3.3.8 Nudm_SDM_ModifySubscription service operation
**Service operation name:** Nudm_SDM_ModifySubscription
**Description:** The NF consumer requests to modify an existing subscription
to notifications of data changes.
**Inputs, Required:** Subscription Correlation ID, SUPI.
**Inputs, Optional:** Expiry time, Monitored resource URIs.
**Outputs, Required:** None.
**Outputs, Optional:** Subscription Data.
#### 5.2.3.4 Nudm_UEAuthentication Service
##### 5.2.3.4.1 General
This service is used by the requester NF to get authentication data and
provide UDM with the result of the authentication procedure success. In the
case of SNPN, this service may be used to instruct the AUSF to execute
authentication towards AAA-S.
##### 5.2.3.4.2 Nudm_UEAuthentication_Get service operation
See TS 33.501 [15].
##### 5.2.3.4.3 Nudm_UEAuthentication_ResultConfirmation service operation
See TS 33.501 [15].
#### 5.2.3.5 Nudm_EventExposure service
##### 5.2.3.5.1 General
See clause 4.15.3.1.
##### 5.2.3.5.2 Nudm_EventExposure_Subscribe service operation
**Service operation name:** Nudm_EventExposure_Subscribe
**Description:** The NF consumer subscribes to receive an event.
**NF Consumers:** NEF, SMS-GMSC**.**
**Inputs, Required:** Target of Event Reporting: UE(s) ID (SUPI or GPSI,
Internal Group Identifier or External Group Identifier, or indication that any
UE is targeted), Event filter containing the Event Id(s) (see clause 4.15.3.1)
and Event Reporting Information defined in Table 4.15.1-1.
**Inputs, Optional:** Expiry time, DNN, S-NSSAI, traffic descriptor
identifying the source of the downlink IP or Ethernet traffic (for
Availability after DDN Failure and downlink data delivery status events), MTC
Provider Information, list of group member UE(s) whose subscription to event
notification(s) are removed or added for a group-based event notification
subscription, operation indication (cancellation or addition), Idle Status
Indication request (if UE reachability or Availability after DDN failure
reporting is requested).
For configuration of monitoring events applicable to both EPC and 5GC, a
combined SCEF+NEF indicates that the monitoring event is also applicable to
EPC (i.e. the event must be reported both by 5GC and EPC) and may include a
SCEF address (i.e. if the event needs to be configured in a serving node in
the EPC and the corresponding notification needs to be sent directly to the
SCEF).
**Outputs, Required:** Operation execution result indication _._ When the
subscription is accepted: Subscription Correlation ID, Expiry time (required
if the subscription can be expired based on the operator\'s policy).
**Outputs, Optional:** First corresponding event report is included, if
corresponding information is available (see clause 4.15.1), Number of UE if
the External Group Identifier and Maximum Number of Reports are included in
the inputs.
Number of UEs indicates the number of UEs within the group identified by the
External Group Identifier. The NEF uses this value to determine whether the
monitoring event has been reported for all group member UEs.
##### 5.2.3.5.3 Nudm_EventExposure_Unsubscribe service operation
**Service operation name:** Nudm_EventExposure_Unsubscribe
**Description:** the consumer deletes the subscription of an event if already
defined in UDM.
**Inputs, Required:** Subscription Correlation ID.
**Outputs, Required:** Operation execution result indication _._
##### 5.2.3.5.4 Nudm_EventExposure_Notify service operation
**Service operation name:** Nudm_EventExposure_Notify
**Description:** UDM reports the event to the consumer that has previously
subscribed.
**Inputs, Required:** Event ID, Notification Correlation Information, time
stamp.
**Inputs, Optional:** Event specific parameters list, Event Removal
Indication, list of group member UE(s) whose subscription to event
notification(s) are removed from a group-based event notification
subscription, UE(s) added/removed to/from the group.
**Outputs, Required:** None _._
##### 5.2.3.5.5 Nudm_EventExposure_ModifySubscription service operation
**Service operation name:** Nudm_EventExposure_ModifySubscription
**Description:** The NF consumer requests to modify an existing subscription
to event notifications.
**NF Consumers:** NEF, SMS-GMSC.
**Inputs, Required:** UE(s) ID (SUPI or GPSI, Internal Group Identifier or
External Group Identifier, or any UE), Subscription Correlation ID,
Modifications to the Event Subscription.
**Inputs, Optional:**
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
#### 5.2.3.6 Nudm_ParameterProvision service
##### 5.2.3.6.1 General
This service is for allowing NEF to provision of information which can be used
for the UE in 5GS.
Parameter Provision data types used in the Nudm_ParameterProvision Service are
defined in Table 5.2.3.6.1-1 below.
Table 5.2.3.6.1-1: Parameter Provision data types
+----------------------------------+----------------------------------+ | Parameter Provision data type | Description | +==================================+==================================+ | Expected UE Behaviour parameters | See clause 4.15.6.3 | +----------------------------------+----------------------------------+ | Network Configuration parameters | See clause 4.15.6.3a | +----------------------------------+----------------------------------+ | 5G VN group configuration data | 5G VN Group Data and 5G VN Group | | | membership management parameters | | | for the 5G VN Group. See | | | clause 4.15.6.3b and | | | clause 4.15.6.3c. | +----------------------------------+----------------------------------+ | Location Privacy Indication | Location Privacy Indication | | parameters | parameters of the \"LCS | | | privacy\" Data Subset of the | | | Subscription Data. | | | | | | See clause 5.2.3.3.1 and | | | clause 7.1 of TS 23.273 [51]. | +----------------------------------+----------------------------------+ | Enhanced Coverage Restriction | See clause 4.27.1 and | | Information | clause 5.31.12 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | ECS Address Configuration | See clause 4.15.6.3d. | | Information | | +----------------------------------+----------------------------------+ | Multicast MBS group membership | See clause 7.2.9 of | | management parameters | TS 23.247 [78]. | +----------------------------------+----------------------------------+ | MBS Session Authorization | See clause 7.2.9 of | | information | TS 23.247 [78]. | +----------------------------------+----------------------------------+ | MBS Session Assistance | See clause 7.2.9a of | | Information | TS 23.247 [78]. | +----------------------------------+----------------------------------+ | DNN and S-NSSAI specific Group | See clause 4.15.6.3.e. | | Parameters | | +----------------------------------+----------------------------------+ | Application-Specific UE | See clause 4.15.6.3f. | | Behaviour parameters | | +----------------------------------+----------------------------------+
At least a mandatory key is required for each Parameter Provision Data Type to
identify the corresponding data as defined in Table 5.2.3.6.1-2.
Table 5.2.3.6.1-2: Parameter Provision data types keys
Parameter Provision Data Types Data Key Data Sub Key
* * *
Expected UE Behaviour parameters GPSI or External Group ID - Network
Configuration parameters GPSI - 5G VN group data External Group Identifier -
5G VN group membership management parameters External Group Identifier -
Location Privacy Indication parameters. GPSI - Enhanced Coverage Restriction
Information GPSI - ECS Address Configuration Information GPSI or External
Group ID or any UE - Multicast MBS group membership management parameters
External Group Identifier - MBS Session Authorization information External
Group ID - MBS Session Assistance Information External Group ID (NOTE)  
DNN and S-NSSAI specific Group Parameters External Group ID  
Application-Specific UE Behaviour parameters GPSI or External Group ID  
NOTE: MBS Session Assistance Information can contain a subset list of UEs
represented by GPSI associated with the External Group ID.
##### 5.2.3.6.2 Nudm_ParameterProvision_Update service operation
**Service operation name:** Nudm_ParameterProvision_Update.
**Description:** The consumer updates the UE related information (e.g.
Expected UE Behaviour, Network Configuration parameters, Location Privacy
Indication parameters, Enhanced Coverage Restriction Information, ECS Address
Configuration Information), 5G VN group related information (5G VN group data,
5G VN membership management), Multicast MBS group related information, or
Application-Specific UE Behaviour.
**Inputs, Required:** AF Identifier, Transaction Reference ID(s).
**Inputs, Optional:** GPSI or SUPI, External Group ID, DNN, S-NSSAI, at least
one of the Expected UE Behaviour parameters or at least one of the Network
Configuration parameters or 5G VN group related information, MTC Provider
Information, Validity Time or Location Privacy Indication parameters or
Enhanced Coverage Restriction Information or ECS Address Configuration
Information, Multicast MBS related information, or Application-Specific UE
Behaviour.
**Outputs, Required:** Transaction Reference ID(s), Operation execution result
indication, or DNN and S-NSSAI specific Group Parameters.
**Outputs, Optional:** Transaction specific parameters, if available.
For Multicast MBS related information, refer to TS 23.247 [78].
##### 5.2.3.6.3 Nudm_ParameterProvision_Create service operation
**Service operation name:** Nudm_ParameterProvision_Create
**Description:** The consumer creates a Network Configuration with one or more
parameters, a 5G VN group related information (e.g. 5G VN group data, 5G VN
membership management), or Multicast MBS related information.
**Inputs, Required:** AF Identifier, Transaction Reference ID(s).
**Inputs, Optional:** GPSI, External Group ID, DNN, S-NSSAI, one or multiple
Network Configuration parameters, or ECS Address Configuration Information, or
for 5G VN group creation, External Group ID and 5G VN group related
information, MTC Provider Information, for Multicast MBS related information,
or DNN and S-NSSAI specific Group Parameters.
**Outputs, Required:** Transaction Reference ID(s), Operation execution result
indication.
**Outputs, Optional:** Transaction specific parameters, if available; Internal
Group ID if the inputs include a new 5G VN configuration.
For Multicast MBS related information, refer to TS 23.247 [78].
##### 5.2.3.6.4 Nudm_ParameterProvision_Delete service operation
**Service operation name:** Nudm_ParameterProvision_Delete
**Description:** The consumer deletes one or more previously created Network
Configuration parameters, or a 5G VN group, or ECS Address Configuration
Information, or Multicast MBS related information.
**Inputs, Required:** AF Identifier, Transaction Reference ID(s).
**Inputs, Optional:** GPSI, External Group ID, for 5G VN group deletion or for
Multicast MBS deletion or Network Configuration of Parameters.
**Outputs, Required:** Transaction Reference ID(s), Operation execution result
indication.
**Outputs, Optional:** None.
For Multicast MBS related information, refer to TS 23.247 [78].
##### 5.2.3.6.5 Nudm_ParameterProvision_Get service operation
**Service operation name:** Nudm_ParameterProvision_Get
**Description:** The consumer gets the UE related information (e.g. Expected
UE Behaviour, Network Configuration parameters).
**Inputs, Required:** GPSI, AF Identifier, requested information (e.g.
Expected UE Behaviour, Network Configuration parameters).
**Inputs, Optional:** None.
**Outputs, Required:** Requested data, Operation execution result indication.
**Outputs, Optional:** None.
#### 5.2.3.7 Nudm_NIDDAuthorisation service
##### 5.2.3.7.1 General
See clause 4.25.3.
##### 5.2.3.7.2 Nudm_NIDDAuthorisation_Get service operation
**Service operation name:** Nudm_NIDDAuthorisation_Get
**Description:** The consumer requests authorisation for NIDD Configuration.
**Inputs, Required:** GPSI or External Group Identifier, DNN, S-NSSAI, MTC
Provider Information, Update Notification Address.
**Inputs, Optional:** NIDD Duration.
**Outputs, Required:** Single value or list of (SUPI, GPSI), Result.
**Outputs, Optional:** NIDD Duration.
##### 5.2.3.7.3 Nudm_NIDDAuthorisation_UpdateNotify service operation
**Service operation name:** Nudm_NIDDAuthorisation_UpdateNotify
**Description:** This service operation is used by the UDM to notify the NIDD
Authorization Update to NF consumer.
**Inputs, Required:** SUPI, GPSI, DNN, S-NSSAI, Result.
**Inputs, Optional:** Cause (e.g. subscription withdrawal, DNN used for NIDD
service is removed from the UE subscription), NIDD Duration.
**Outputs, Required:** None.
##### 5.2.3.7.4 Void
##### 5.2.3.7.5 Void
#### 5.2.3.8 Nudm_ServiceSpecificAuthorisation service
##### 5.2.3.8.1 General
**Service description:** This service is for authorisation of a specific
service configuration.
##### 5.2.3.8.2 Nudm_ServiceSpecificAuthorisation_Create service operation
**Service operation name:** Nudm_ServiceSpecificAuthorisation_Create
**Description:** The consumer requests authorisation for a specific service
configuration.
**Inputs, Required:** GPSI or External Group Id, DNN, S-NSSAI, Service Type
(e.g. AF guidance for URSP), Update Notification address.
**Inputs, Optional:** MTC Provider Information, AF ID.
**Outputs, Required:** Authorisation result indication, SUPI or Internal Group
Id, Service Specific Authorization Id.
**Outputs, Optional:** None.
##### 5.2.3.8.3 Nudm_ServiceSpecificAuthorisation_UpdateNotify service
operation
**Service operation name:** Nudm_ServiceSpecificAuthorisation_UpdateNotify
**Description:** This service operation is used by the UDM to notify a Service
Specific Authorisation Update to NF consumer.
**Inputs, Required:** GPSI or External Group Id, SUPI or Internal Group Id,
Status, Cause (e.g. subscription withdrawal, DNN associated to the
authorization is removed from UE subscription).
**Inputs, Optional:** DNN, S-NSSAI, Service Type (e.g. AF guidance for URSP),
MTC Provider Information, AF ID.
**Outputs, Required:** None.
##### 5.2.3.8.4 Nudm_ServiceSpecificAuthorisation_Remove service operation
**Service operation name:** Nudm_ServiceSpecificAuthorisation_Remove
**Description:** The consumer requests the removal of the authorisation for a
specific service configuration.
**Inputs, Required:** Service Specific Authorisation Id.
**Outputs, Required:** None.
#### 5.2.3.9 Nudm_ReportSMDeliveryStatus service
##### 5.2.3.9.1 General
**Service description:** This service is to report the SM-Delivery Status to
UDM.
##### 5.2.3.9.2 Nudm_ReportSMDeliveryStatus_Request service operation
**Service operation name:** Nudm_ReportSMDeliveryStatus_Request
**Description:** Reports the SM-Delivery Status to UDM.
**Inputs, Required:** GPSI, SM-Delivery status.
**Inputs, Optional:** None.
**Outputs, Required:** Report SM-Delivery status result.
**Outputs, Optional:** None.
### 5.2.4 5G-EIR Services
#### 5.2.4.1 General
The following table illustrates the 5G-EIR Service.
Table 5.2.4-1: NF services provided by 5G-EIR
NF service Service Operations Operation Semantics Example Consumer(s)
* * *
N5g-eir_Equipment Identity Check Get Request/Response AMF
#### 5.2.4.2 N5g-eir_EquipmentIdentityCheck service
##### 5.2.4.2.1 General
Service Description: This service is provided by the 5G-EIR to check the PEI
and check whether the PEI is in the prohibited list or not. The service can be
consumed by AMF. The service operations provided within this service are
depicted as below.
##### 5.2.4.2.2 N5g-eir_EquipmentIdentityCheck_Get service operation
**Service operation name:** N5g-eir_EquipmentIdentityCheck_Get
**Description:** Check the PEI and determine whether the subscriber is allowed
to use the equipment.
**Inputs, Required:** PEI, SUPI.
**Inputs, Optional:** none
**Outputs, Required:** PEI checking result
**Outputs, Optional:** none
### 5.2.5 PCF Services
#### 5.2.5.1 General
The following table illustrates the PCF Services.
Table 5.2.5.1-1: NF services provided by PCF
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer (s) | | | | Semantics | | +================+================+================+================+ | Npcf_A | Create | Re | AMF | | MPolicyControl | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | UpdateNotify | Su | AMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | Npcf_Policy | Create | Re | AF, NEF, | | Authorization | | quest/Response | TSCTSF | +----------------+----------------+----------------+----------------+ | (NOTE) | Update | Re | AF, NEF, | | | | quest/Response | TSCTSF | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF, NEF, | | | | quest/Response | TSCTSF | +----------------+----------------+----------------+----------------+ | | Notify | Su | AF, NEF, | | | | bscribe/Notify | NWDAF, PCF, | | | | | TSCTSF | +----------------+----------------+----------------+----------------+ | | Subscribe | | AF, NEF, | | | | | NWDAF, PCF, | | | | | TSCTSF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AF, NEF, | | | | | NWDAF, PCF, | | | | | TSCTSF | +----------------+----------------+----------------+----------------+ | Npcf_S | Create | Re | SMF | | MPolicyControl | | quest/Response | | +----------------+----------------+----------------+----------------+ | | UpdateNotify | Su | SMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Update | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | Npcf_BD | Create | Re | NEF | | TPolicyControl | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | NEF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | | NEF | +----------------+----------------+----------------+----------------+ | Npcf_U | Create | Re | AMF, PCF | | EPolicyControl | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AMF, PCF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | UpdateNotify | Su | AMF, PCF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AMF, PCF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | Npcf\ | Subscribe | Su | AF, NEF, NWDAF | | _EventExposure | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | * | | | | | _Unsubscribe_ _| | | +----------------+----------------+----------------+----------------+ | |__Notify_ * | | | +----------------+----------------+----------------+----------------+ | Npcf_AMPolic | Create | Re | AF, NEF, | | yAuthorization | | quest/Response | TSCTSF | +----------------+----------------+----------------+----------------+ | | Update | Re | AF, NEF, | | | | quest/Response | TSCTSF | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF, NEF, | | | | quest/Response | TSCTSF | +----------------+----------------+----------------+----------------+ | | Notify | Su | AF, NEF, 5G | | | | bscribe/Notify | DDNMF | +----------------+----------------+----------------+----------------+ | | Subscribe | | AF, NEF, 5G | | | | | DDNMF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AF, NEF, 5G | | | | | DDNMF | +----------------+----------------+----------------+----------------+ | Npcf_PDT | Create | Re | NEF | | QPolicyControl | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | NEF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | | NEF | +----------------+----------------+----------------+----------------+ | NOTE: In the | | | | | Npcf_Polic | | | | | yAuthorization | | | | | operations, | | | | | PCF is a | | | | | consumer when | | | | | the PCF for | | | | | the UE and the | | | | | PCF for the | | | | | PDU session | | | | | are different. | | | | +----------------+----------------+----------------+----------------+
#### 5.2.5.2 Npcf_AMPolicyControl service
##### 5.2.5.2.1 General
**Service description:** NF Service Consumer, e.g. AMF, can create and manage
an AM Policy Association in the PCF through which the NF Service Consumer
receives access and mobility related policy information for a UE identified by
a SUPI.
As part of this service, the PCF may provide the NF Service Consumer, e.g.
AMF, with AM policy information for a SUPI that may contain:
\- Access and mobility related policy information as defined in clause 6.5 of
TS 23.503 [20]. In the case of roaming, this information is provided by V-PCF;
\- Policy Control Request Trigger of AM Policy Association as defined in
clause 6.1.2.5 of TS 23.503 [20]. In the case of roaming, the V-PCF may
subscribe to AMF.
At Npcf_AMPolicyControl_Create, the NF Service Consumer, e.g. AMF requests the
creation of a corresponding AM Policy Association with the PCF
(Npcf_AMPolicyControl_Create) and provides relevant parameters about the UE
context to the PCF. When the PCF has created the AM Policy Association, the
PCF may provide access and mobility related policy information in the
response.
When a Policy Control Request Trigger condition is met the NF Service
Consumer, e.g. AMF requests the update (Npcf_AMPolicyControl_Update) of the AM
Policy Association by providing information on the condition(s) that have been
met as defined in clause 6.1.2.5 of TS 23.503 [20]. The PCF may provide
updated access and mobility related policy information to the NF Service
Consumer in the response.
The PCF may at any time provide updated access and mobility related policy
information (Npcf_AMPolicyControl_UpdateNotify);
At UE deregistration the NF Service Consumer, e.g. AMF requests the deletion
of the corresponding AM Policy Association (Npcf_AMPolicyControl_Delete).
##### 5.2.5.2.2 Npcf_AMPolicyControl_Create service operation
**Service operation name:** Npcf_AMPolicyControl_Create
**Description:** NF Service Consumer can request the creation of an AM Policy
Association and by providing relevant parameters about the UE context to the
PCF.
**Inputs, Required:** SUPI.
**Inputs, Optional:** Information provided by the AMF, such as Access Type,
Permanent Equipment Identifier, GPSI, User Location Information, UE Time Zone,
Serving Network identifier (PLMN ID, or PLMN ID and NID, see clause 5.34 of TS
23.501 [2]), RAT type, List of subscribed Service Area Restrictions,
subscribed RFSP Index, the Allowed NSSAI, Partially Allowed NSSAI, Target
NSSAI, GUAMI, Subscribed UE-AMBR, Internal Group (see clause 5.9.7 of TS
23.501 [2]), subscription notification indication, backup AMF(s) (if NF Type
is AMF). Backup AMF(s) are sent only once by the AMF to the PCF in its first
interaction with the PCF, list of NWDAF instance Ids and corresponding
Analytics ID(s).
**Outputs, Required:** AM Policy Association ID _._
**Outputs, Optional:** The requested access and mobility related policy
information as defined in clause 6.5 of TS 23.503 [20] and Policy Control
Request Trigger(s) of AM Policy Association as defined in clause 6.1.2.5 of TS
23.503 [20].
See clause 4.2.2.2.2 (step 16) for the detail usage of this service operation
for AMF. In step 16, the AMF requests the PCF to apply operator policies for
the UE.
See clause 4.16.1.2 (steps 2 and 3) for the detail usage of this service
operation for AMF. In step 2, the AMF requests the PCF to apply operator
policies for the UE; in step 3, the PCF acknowledges AMF with requested
policy.
##### 5.2.5.2.3 Npcf_AMPolicyControl_UpdateNotify service operation
**Service operation name:** Npcf_AMPolicyControl_UpdateNotify
**Description:** Provides to the NF Service Consumer, e.g. AMF, updated AM
related Policy information for the AM Policy Association as defined in clause
6.5 of TS 23.503 [20].
NOTE: This notification corresponds to an implicit subscription.
**Inputs, Required:** AM Policy Association ID.
**Inputs, Optional:** Access and Mobility related information or indication of
AM Policy Association termination.
**Outputs, Required:** Success or failure.
**Outputs, Optional:** None.
See clause 4.16.2.2 for the usage of this service operation.
##### 5.2.5.2.4 Npcf_AMPolicyControl_Delete service operation
**Service operation name:** Npcf_AMPolicyControl_Delete
**Description:** Provides means for the NF Consumer to delete the AM Policy
Association.
**Inputs, Required:** AM Policy Association ID.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
See clause 4.16.3.2 (step 2 and 3) for the detail usage of this service
operation for AMF. In step 2, the AMF initiates the AM Policy Association
Termination procedure; in step 3 the PCF deletes the AM Policy Association for
this AM Policy Association ID.
##### 5.2.5.2.5 Npcf_AMPolicyControl_Update service operation
**Service operation name:** Npcf_AMPolicyControl_Update.
**Description:** NF Service Consumer, e.g. AMF can request the update of the
AM Policy Association to receive updated access and mobility related policy
information for the UE context when the Policy Control Request Trigger is met
or the AMF is relocated due to the UE mobility and the old PCF is selected.
**Inputs, Required:** AM Policy Association ID.
**Inputs, Optional:** Information on the Policy Control Request Trigger
condition that has been met as defined in clause 6.1.2.5 of TS 23.503 [20],
GUAMI(s) (if NF Type is AMF), list of NWDAF instance Ids and corresponding
Analytics ID(s), Target NSSAI.
**Outputs, Required:** Success or not.
**Outputs, Optional:** Access and mobility related policy information for the
UE context as defined in clause 6.5 of TS 23.503 [20] and Policy Control
Request Trigger(s) of AM Policy Association as defined in clause 6.1.2.5 of TS
23.503 [20].
See clause 4.16.2.1 for the usage of this service operation.
#### 5.2.5.3 Npcf_PolicyAuthorization Service
##### 5.2.5.3.1 General
**Service description:** This service is to authorise an AF request and to
create policies as requested by the authorized AF for the PDU Session to which
the AF session is bound. Additionally, this service allows an AF or TSCTSF to
exchange port management information with DS-TT and NW-TT. This service allows
the NF consumer to subscribe/unsubscribe the notification of events, which are
defined in clause 6.1.3.18 of TS 23.503 [20].
##### 5.2.5.3.2 Npcf_PolicyAuthorization_Create service operation
**Service operation name:** Npcf_PolicyAuthorization_Create
**Description:** Authorize the request and optionally determines and installs
SM Policy Control Data according to the information provided by the NF
Consumer or provides Port Management Information Container for ports on DS-TT
or NW-TT, or User plane node Management Information Container.
**Inputs, Required:** UE (IP or MAC) address, identification of the
application session context.
**Inputs, Optional:** GPSI(s) or SUPI(s) if available, Internal Group
Identifier, DNN if available, S-NSSAI if available, Media type, Media format,
bandwidth requirements, sponsored data connectivity information if applicable,
flow description information as described in clause 6.1.3.6 of TS 23.503 [20],
AF Application Identifier, AF Communication Service Identifier, AF Record
Identifier, Flow status, Priority indicator, emergency indicator, ASP
Identifier, resource allocation outcome, AF Application Event Identifier, a
list of DNAI(s) and corresponding routing profile ID(s) or N6 traffic routing
information, AF Transaction Id, Early and/or late notifications about UP path
management events, temporal validity condition, spatial validity condition,
Information for EAS IP Replacement in 5GC, Indication for EAS Relocation, AF
indication for simultaneous connectivity over source and target PSA at edge
relocation, EAS Correlation indication, Common EAS IP address, Traffic
Correlation ID, FQDN(s) as described in clause 5.6.7 in 23.501 [2], Background
Data Transfer Reference ID, priority sharing indicator as described in clause
6.1.3.15 of TS 23.503 [20], pre-emption control information as described in
clause 6.1.3.15 of TS 23.503 [20], Port Management Information Container and
related port number, User plane node Management Information Container, TSN AF
parameters provided by the TSN AF to the PCF as described in clause 6.1.3.23
of TS 23.503 [20], TSCTSF parameters provided by the TSCTSF to the PCF as
described in clause 6.1.3.23a and clause 6.1.3.23b of TS 23.503 [20], QoS
parameter(s) to be measured, Reporting frequency, Target of reporting and
optional an indication of local event notification as described in clause
6.1.3.21 of TS 23.503 [20], QoS Reference or individual QoS parameters as
described in clause 6.1.3.22 of TS 23.503 [20], RT Latency Indication as
described in clause 6.1.3.22 of TS 23.503 [20], Alternative Service
Requirements (containing one or more QoS Reference parameters or Requested
Alternative QoS Parameter Sets in a prioritized order), TSC Assistance
Container, MPS for Data Transport Service indicator as described in clause
6.1.3.11 of TS 23.503 [20], Packet Delay Variation requirements as described
in clause 6.1.3.26 of TS 23.503 [20], SFC Identifier(s), Metadata, Periodicity
as described clauses 6.1.3.22 and 6.3.1 of TS 23.503 [20], PDU Set QoS
Parameters as described in clause 5.7.7 of TS 23.501 [2], Protocol Description
as described in clause 5.37.5 of TS 23.501 [2], Indication of ECN marking for
L4S as described in clause 6.1.3.22 of TS 23.503 [20], Notification Target
Address for PMIC/UMIC UPF event, Correlation ID for PMIC/UMIC UPF event.
NOTE 1: When only one DNAI and corresponding routing profile ID(s) and the
Indication for EAS Relocation are available, the presented DNAI is the target
DNAI as defined in clause 6.3.7 of TS 23.548 [74].
NOTE 2: A dedicated Notification Target Address for PMIC/UMIC UPF event and
Correlation ID for PMIC/UMIC UPF event are provided by the event consumer over
Npcf_PolicyAuthorization as the corresponding events are reported by the UPF
and not by the PCF. Providing such information indicates that the consumer of
the Npcf_PolicyAuthorization (TSN AF, TSCTSF) suppots PMIC/UMIC via Nupf event
reporting.
**Outputs, Required:** Success or Failure (reason for failure, e.g. as defined
in clauses 6.1.3.16 and clause 6.1.3.10 of TS 23.503 [20]).
**Outputs, Optional:** The service information that can be accepted by the
PCF.
##### 5.2.5.3.3 Npcf_PolicyAuthorization_Update service operation
**Service operation name:** Npcf_PolicyAuthorization_Update
**Description:** Provides updated information to the PCF.
**Inputs, Required:** Identification of the application session context.
**Inputs, Optional:** Media type, Media format, bandwidth requirements,
sponsored data connectivity information if applicable, flow description
information as described in clause 6.1.3.6 of TS 23.503 [20], AF Application
Identifier, AF Communication Service Identifier, AF Record Identifier, Flow
status, Priority indicator, resource allocation outcome, AF Application Event
Identifier, a list of DNAI(s) and corresponding routing profile ID(s) or N6
traffic routing information, AF Transaction Id, Early and/or late
notifications about UP path management events, temporal validity condition,
spatial validity condition, Information for EAS IP Replacement in 5GC,
Indication for EAS Relocation, AF indication for simultaneous connectivity
over source and target PSA at edge relocation as described in clause 5.6.7 of
TS 23.501 [2], Background Data Transfer Reference ID, priority sharing
indicator as described in clause 6.1.3.15 of TS 23.503 [20], pre-emption
control information as described in clause 6.1.3.15 of TS 23.503 [20], Port
Management Information Container and related port number, User plane node
Management Information Container, TSN AF parameters provided by the TSN AF to
the PCF as described in clause 6.1.3.23 of TS 23.503 [20], TSCTSF parameters
provided by the TSCTSF to the PCF as described in clause 6.1.3.23a and clause
6.1.3.23b of TS 23.503 [20], QoS Reference or individual QoS parameters as
described in clause 6.1.3.22 of TS 23.503 [20], Alternative Service
Requirements (containing one or more QoS Reference parameters or Requested
Alternative QoS Parameter Sets in a prioritized order), TSC Assistance
Container, QoS parameter(s) to be measured, Reporting frequency, Target of
reporting and optional an indication of local event notification as described
in clause 6.1.3.21 of TS 23.503 [20], MPS for Data Transport Service indicator
as described in clause 6.1.3.11 of TS 23.503 [20], Packet Delay Variation
requirements as described in clause 6.1.3.26 of TS 23.503 [20], SFC
Identifier(s), Metadata, Periodicity as described clauses 6.1.3.22 and 6.3.1
of TS 23.503 [20], PDU Set QoS Parameters as described in clause 5.7.7 of TS
23.501 [2], Protocol Description as described in clause 5.37.5 of TS 23.501
[2], Notification Target Address for PMIC/UMIC UPF event, Correlation ID for
PMIC/UMIC UPF event.
NOTE: When only one DNAI and corresponding routing profile ID(s) and the
Indication for EAS Relocation are available, the presented DNAI is the target
DNAI as defined in clause 6.3.7 of TS 23.548 [74].
**Outputs, Required:** Success or Failure (reason for failure, e.g. as defined
in clause 6.1.3.16 of TS 23.503 [20]).
**Outputs, Optional:** The service information that can be accepted by the
PCF.
Provides updated application level information and communicates with
Npcf_SMPolicyControl service to determine and install the policy according to
the information provided by the NF Consumer. Updates an application context in
the PCF.
##### 5.2.5.3.4 Npcf_PolicyAuthorization_Delete service operation
**Service operation name:** Npcf_PolicyAuthorization_Delete
**Description:** Provides means for the NF Consumer to delete the context of
application level session information.
**Inputs, Required:** Identification of the application session context.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.5.3.5 Npcf_PolicyAuthorization_Notify service operation
**Service operation name:** Npcf_PolicyAuthorization_Notify
**Description:** provided by the PCF to notify NF consumers of the subscribed
events.
**Inputs, Required:** Event ID.
The events that can be subscribed are defined in clause 6.1.3.18 of TS 23.503
[20].
**Inputs, Optional:** Event information (defined on a per Event ID basis) are
defined in clause 6.1.3.18 of TS 23.503 [20], Notification Correlation
Information (information to identify the application session), DNN, S-NSSAI.
Notification Correlation Information is mandatory except in the case of the
new 5GS Bridge/Router information detected event if no AF session exists
between the PCF and the AF.
DNN and S-NSSAI are required in the case of private IPv4 address being used
for the IP type PDU Session that are potentially impacted by time sensitive
communication and time synchronization service.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.5.3.6 Npcf_PolicyAuthorization_Subscribe service operation
**Service operation name:** Npcf_PolicyAuthorization_Subscribe
**Description:** provided by the PCF for NF consumers to explicitly subscribe
the notification of events.
**Inputs, Required:** (Set of) Event ID(s) as specified in
Npcf_PolicyAuthorization_Notify service operation, target of PCF event
reporting (defined below), NF ID, Event Reporting Information defined in Table
4.15.1-1 (only the Event Reporting mode and the immediate reporting flag when
applicable), Notification Target Address (+ Notification Correlation ID).
The target of PCF event reporting the subscription for an individual AF
session: An UE IP address (IPv4 address or IPv6 prefix) optionally together
with a (DNN, S-NSSAI) or with a UE ID (SUPI or GPSI).
**Inputs, Optional:** Event Filter, Subscription Correlation ID (in the case
of modification of the event subscription), Notification Target Address for
PMIC/UMIC UPF event, Correlation ID for PMIC/UMIC UPF event.
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID.
**Outputs, Optional:** None _._
##### 5.2.5.3.7 Npcf_PolicyAuthorization_Unsubscribe service operation
**Service operation name:** Npcf_PolicyAuthorization_Unsubscribe
**Description:** Enable NF consumers to explicitly unsubscribe the
notification of PCF events related to Npcf_PolicyAuthorization_Subscribe
operation.
**Inputs, Required:** Subscription Correlation.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None _._
#### 5.2.5.4 Npcf_SMPolicyControl service
##### 5.2.5.4.1 General
**Service description:** NF Service Consumer, e.g. SMF, can create and manage
a SM Policy Association in the PCF through which the NF Service Consumer
receives policy information for a PDU Session.
As part of this service, the PCF may provide the NF Service Consumer, e.g.
SMF, with policy information for the PDU Session that may contain:
\- PDU Session related policy information as defined in clause 6.4 of TS
23.503 [20].
\- PCC rule information as defined in clause 6.3 of TS 23.503 [20].
\- Policy Control Request Trigger information i.e. a set of Policy Control
Request Trigger(s) as defined in clause 6.1.3.5 of TS 23.503 [20].
At PDU Session establishment the NF Service Consumer, e.g. SMF, requests the
creation of a corresponding SM Policy Association with the PCF
(Npcf_SMPolicyControl_Create) and provides relevant parameters about the PDU
Session to the PCF.
When the PCF has created the SM Policy Association, the PCF may provide policy
information for the PDU Session in the response.
When a Policy Control Request Trigger condition is met the NF Service
Consumer, e.g. SMF requests the update(Npcf_SMPolicyControl_Update) of the SM
Policy Association by providing information on the condition(s) that have been
met as defined in clause 6.1.3.5 of TS 23.503 [20]. The PCF may provide
updated policy information for the PDU Session to the NF Service Consumer in
the response.
The PCF may at any time provide updated policy information for the
(Npcf_SMPolicyControl_UpdateNotify).
At PDU Session Release the NF Service Consumer, e.g. SMF requests the deletion
of the corresponding SM Policy Association (Npcf_SMPolicyControl_Delete).
##### 5.2.5.4.2 Npcf_SMPolicyControl_Create service operation
**Service operation name:** Npcf_SMPolicyControl_Create.
**Description:** The NF Service Consumer can request the creation of a SM
Policy Association and provides relevant parameters about the PDU Session to
the PCF.
**Inputs, Required:** SUPI (or PEI in the case of emergency PDU Session
without SUPI), PDU Session id, DNN, S-NSSAI and RAT Type.
**Inputs, Optional:** Information provided by the SMF, such as PDU Session
Type, Request Type, Access Type, the IPv4 address and/or IPv6 prefix, PEI,
GPSI, User Location Information, UE Time Zone, Serving Network identifier
(PLMN ID, or PLMN ID and NID, see clause 5.34 of TS 23.501 [2]), Charging
Characteristics information, Session-AMBR, subscribed default QoS information
(5QI, 5QI Priority Level, ARP), UE support of reflective QoS (see TS 23.501
[2], clause 5.7.5.1), Number of supported packet filters for signalled QoS
rules for the PDU Session (see TS 23.501 [2], clause 5.7.1.4), 3GPP PS Data
Off status, Trace Requirements and Internal Group Identifier (see clause 5.9.7
of TS 23.501 [2]), DN Authorization Profile Index, DN authorized Session AMBR,
Framed Route information (as defined in Table 5.2.3.3.1-1), MA PDU Request
indication, MA PDU Network-Upgrade Allowed indication, ATSSS capabilities of
the MA PDU Session, QoS constraints from the VPLMN (as defined in clause
5.7.1.11 of TS 23.501 [2]), Satellite Backhaul Category information, list of
NWDAF instance Ids (used by AMF, SMF, UPF) and corresponding Analytics ID(s),
PVS IP address(es) and/or PVS FQDN(s) and Onboarding Indication in the case of
ON-SNPN (see clause 5.30.2.10.4.2 of TS 23.501 [2]), URSP rule enforcement
that including Connection Capability, HR-SBO support indication (see clause
6.2.1.2 of TS 23.503 [20]).
NOTE: If SMF receives the DN authorized Session AMBR from the DN-AAA at PDU
Session establishment, it includes the DN authorized Session AMBR within the
Session-AMBR, instead of the subscribed Session-AMBR received from the UDM, in
the request.
W-5GAN specific PDU Session information provided by the SMF is specified in TS
23.316 [53].
**Outputs, Required:** SM Policy Association ID defined in TS 29.512 [57].
Success or Failure.
**Outputs, Optional:** Policy information for the PDU Session as defined in TS
23.503 [20] and Policy Control Request Trigger(s) of SM Policy Association as
defined in clause 6.1.3.5 of TS 23.503 [20].
See clause 5.8.2.2 of TS 23.501 [2] for allocation of IPv4 address and IPv6
prefix. The IPv6 prefix length is /64, or is shorter than /64 when Prefix
Delegation applies.
See clause 4.16.4 for the detail usage of this service operation.
See clauses 4.22.2.1 and 4.22.3 for detailed usage of this service operation
for ATSSS.
##### 5.2.5.4.3 Npcf_SMPolicyControl_UpdateNotify service operation
**Service operation name:** Npcf_SMPolicyControl_UpdateNotify
**Description:** Provides to the NF Service Consumer, e.g. SMF, updated Policy
information for the PDU Session.
**Inputs, Required:** SM Policy Association ID.
**Inputs, Optional:** Policy information for the PDU Session as defined in TS
23.503 [20] and Policy Control Request Trigger(s) of SM Policy Association as
defined in clause 6.1.3.5 of TS 23.503 [20].
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
See clause 4.16.5.2 for the usage of this service operation.
##### 5.2.5.4.4 Npcf_SMPolicyControl_Delete service operation
**Service operation name:** Npcf_SMPolicyControl_Delete
**Description:** The NF Service Consumer can request the deletion of the SM
Policy Association and of the associated resources.
**Inputs, Required:** SM Policy Association ID.
**Inputs, Optional:** 5G SRVCC indication.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
See clause 4.16.6 for the usage of this service operation.
When the PDU session for IMS is released due to PS to CS handover for 5G
SRVCC, SMF indicate the 5G SRVCC indication received from AMF to PCF.
##### 5.2.5.4.5 Npcf_SMPolicyControl_Update service operation
**Service operation name:** Npcf_SMPolicyControl_Update.
**Description:** The NF Service Consumer can request the update of the SM
Policy Association to receive updated Policy information for the PDU Session.
**Inputs, Required:** SM Policy Association ID.
**Inputs, Optional:** Information on the Policy Control Request Trigger
condition that has been met, as defined in clause 6.1.3.5 of TS 23.503 [20].
W-5GAN specific PDU Session information provided by the SMF is specified in TS
23.316 [53].
**Outputs, Required:** Success or not.
**Outputs, Optional:** Policy information for the PDU Session as defined in TS
23.503 [20] and Policy Control Request Trigger(s) of SM Policy Association as
defined in clause 6.1.3.5 of TS 23.503 [20] and UE Policy Container.
See clause 4.16.5.1 for the usage of this service operation.
NOTE: When this service operation is invoked by SMF, race conditions apply,
which are defined in TS 29.513 [47].
#### 5.2.5.5 Npcf_BDTPolicyControl Service
##### 5.2.5.5.1 General
**Service description:** This service provides background data transfer
policy, which includes the following functionalities:
\- Get background data transfer policies based on the request via NEF from AF;
and
\- Update background data transfer based on the selection provided by AF.
##### 5.2.5.5.2 Npcf_BDTPolicyControl_Create service operation
**Service operation name:** Npcf_BDTPolicyControl_Create
**Description:** This service is to create the background data transfer
policy.
**Inputs, Required:** ASP identifier, Volume per UE, Number of UEs, Desired
time window.
**Inputs, Optional:** S-NSSAI, DNN, Internal Group Identifier, Network Area
Information, Request for notification, MAC address or IP 3-tuple of
Application server.
**Outputs, Required:** one or more background data transfer policies,
Background Data Transfer Reference ID _._
**Outputs, Optional:** None _._
##### 5.2.5.5.3 Npcf_BDTPolicyControl_Update service operation
**Service operation name:** Npcf_BDTPolicyControl_Update
**Description:** This service is to update the background data transfer policy
to the PCF.
**Inputs, Required:** ASP identifier, background data transfer policy,
Background Data Transfer Reference ID.
**Inputs, Optional:** Stop notification.
**Outputs, Required:** None
**Outputs, Optional:** None _._
##### 5.2.5.5.4 Npcf_BDTPolicyControl_Notify service operation
**Service operation name:** Npcf_BDTPolicyControl_Notify
**Description:** This service operation sends the BDT warning notification to
the NF consumer.
**Inputs, Required:** Background data transfer reference ID.
**Inputs, Optional:** Network Area Information, Time window, list of candidate
Background Data Transfer policies.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.5.6 Npcf_UEPolicyControl Service
##### 5.2.5.6.1 General
**Service description:** NF Service Consumer, e.g. AMF, or the PCF serving the
PDU Session when a UE attaches in EPS, may create and manage a UE Policy
Association in the PCF through which the NF Service Consumer receives Policy
Control Request Trigger of UE Policy Association.
The association allows (V-)PCF to provide UE policy information to the UE
transparently through the NF Service Consumer using NAS TRANSPORT message to
carry:
\- UE policy information as defined in clause 6.6 of TS 23.503 [20]. In the
case of roaming, the URSP rules are provided by H-PCF and the ANDSP rules may
be provided by V-PCF or H-PCF or both.
As part of this service, the PCF may provide the NF Service Consumer, e.g.
AMF, with policy information about the UE that may contain:
\- Policy Control Request Trigger of UE Policy Association. When such a Policy
Control Request Trigger condition is met, the NF Service Consumer, e.g. AMF,
shall contact PCF and provide information on the Policy Request Trigger
condition that has been met. In the case of roaming, the V-PCF may subscribe
to AMF or the H-PCF may subscribe to AMF via V-PCF.
At Npcf_UEPolicyControl_Create, the NF Service Consumer, e.g. AMF, requests
the creation of a corresponding \"UE Policy Association\" with the PCF
(Npcf_UEPolicyControl_Create) and provides relevant parameters about the UE
context to the PCF. When the PCF has created the UE Policy Association, the
PCF may provide policy information as defined above.
When a Policy Control Request Trigger condition is met, the NF Service
Consumer, e.g. AMF, requests the update (Npcf_UEPolicyControl_Update) of the
UE Policy Association by providing information on the condition(s) that have
been met. The PCF may provide updated policy information to the NF Service
Consumer.
During the AMF relocation, if the target AMF receives the PCF ID from source
AMF and the target AMF decides to contact with the PCF identified by the PCF
ID based on the local policies, the target AMF requests the update
(Npcf_UEPolicyControl_Update) of the UE Policy Association. If a Policy
Control Request Trigger condition is met, the information matching the trigger
condition may also be provided by the target AMF. The PCF may provide updated
policy information to the target AMF.
The PCF may at any time provide updated policy information
(Npcf_UEPolicyControl_UpdateNotify).
At UE deregistration the NF Service Consumer, e.g. AMF, or the PCF serving the
PDU Session when a UE detaches from EPS, requests the deletion of the
corresponding UE Policy Association.
##### 5.2.5.6.2 Npcf_UEPolicyControl_Create service operation
**Service operation name:** Npcf_UEPolicyControl_Create
**Description:** NF Service Consumer can request the creation of a UE Policy
Association by providing relevant parameters about the UE context to the PCF.
**Inputs, Required:** Notification endpoint, SUPI.
**Inputs, Optional:** H-PCF ID (if the NF service producer is V-PCF and AMF is
NF service consumer), information provided by the AMF as define in clause
6.2.1.2 of TS 23.503 [20], such as Access Type, Permanent Equipment
Identifier, GPSI, User Location Information, UE Time Zone, Serving Network
(PLMN ID, or PLMN ID and NID, see clause 5.34 of TS 23.501 [2]), RAT type, LBO
Information (see clause 6.1.2.2.4 of TS 23.503 [20]), UE policy information
including the list of PSIs, OS id, UE capability of reporting URSP rule
enforcement to network (see clause 6.6.2.4 of TS 23.503 [20]) and Internal
Group (see TS 23.501 [2]), Satellite Backhaul Category (see clause 5.43 of TS
23.501 [2]), \"5GS to EPS Mobility\" indication, request to update the UE
policies, request to be notified when updated UE policies have been provided
to the UE.
**Outputs, Required:** Success or Failure, UE Policy Association ID.
**Outputs, Optional:** Policy Control Request Trigger of UE Policy
Association. In the case of H-PCF is producer, UE policy information (see
clause 5.2.5.6.1).
##### 5.2.5.6.3 Npcf_UEPolicyControl_UpdateNotify service operation
**Service operation name:** Npcf_UEPolicyControl_UpdateNotify
**Description:** Provides to the NF Service Consumer updated Policy
information for the UE context evaluated based on the information previously
provided by the PCF.
NOTE: This notification corresponds to an implicit subscription.
**Inputs, Required:** Notification endpoint, UE Policy Association ID.
**Inputs, Optional:** Policy Control Request Trigger of UE Policy Association.
In the case of H-PCF is producer, UE Access and PDU session related
information as defined in clause 5.2.5.1, indication of successful delivery of
UE policies.
NOTE: The indication of successful delivery of UE policies is used, e.g. as
defined in clauses 4.12.2.2 and 4.12a.2.2.
**Outputs, Required:** Success or failure.
**Outputs, Optional:** None.
##### 5.2.5.6.4 Npcf_UEPolicyControl_Delete service operation
**Service operation name:** Npcf_UEPolicyControl_Delete
**Description:** Provides means for the NF Consumer to delete the UE policy
control association.
**Inputs, Required:** UE Policy Association ID.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
##### 5.2.5.6.5 Npcf_UEPolicyControl_Update service operation
**Service operation name:** Npcf_UEPolicyControl_Update
**Description:** NF Service Consumer, e.g. AMF can request the update of the
UE Policy Association to receive updated Policy information for the UE
context.
**Inputs, Required:** UE Policy Association ID.
**Inputs, Optional:** Information on the UE policy related Policy Control
Request Trigger condition that has been met, as defined in Table 6.1.2.5-1 of
TS 23.503 [20].
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** Policy Control Request Trigger of UE Policy
Association. In the case of H-PCF is producer, UE related policy information.
#### 5.2.5.7 Npcf_EventExposure service
##### 5.2.5.7.1 General
**Service description:** This service enables an NF to subscribe and get
notified about PCF events for a group of UE(s) or any UE accessing a
combination of (DNN, S-NSSAI).
The events can be subscribed by a NF consumer are described in clause 6.1.3.18
of TS 23.503 [20].
The following service operations are defined for the Npcf_EventExposure
service:
\- Npcf_EventExposure_Subscribe.
\- Npcf_EventExposure_UnSubscribe.
\- Npcf_EventExposure_Notify.
##### 5.2.5.7.2 Npcf_EventExposure_Subscribe service operation
**Service operation name:** Npcf_EventExposure_Subscribe.
**Description:** The consumer NF uses this service operation to subscribe to
or modify event reporting for a group of UE(s) or any UE accessing a
combination of (DNN, S-NSSAI).
**NF Consumers:** NEF**.**
**Inputs, Required:** NF ID, Target of Event Reporting (Internal Group
Identifier or indication that any UE accessing a combination of (DNN,
S-NSSAI)is targeted, (set of) Event ID(s) defined in clause 5.2.5.7.1,
Notification Target Address (+ Notification Correlation ID) and Event
Reporting Information defined in Table 4.15.1-1.
**Inputs, Optional:** Event Filter (s) associated with each Event ID, Expiry
time.
**Outputs, Required:** Operation execution result indication _._ When the
subscription is accepted: Subscription Correlation ID, Expiry time (required
if the subscription can be expired based on the operator\'s policy).
**Outputs, Optional:** First corresponding event report is included, if
corresponding information is available (see clause 4.15.1).
The NF consumer subscribes to the event notification by invoking
Npcf_EventExposure to the PCF. The PCF allocates a Subscription Correlation ID
for the subscription and responds to the consumer NF with the Subscription
Correlation ID. Event receiving NF ID identifies the NF that shall receive the
event reporting.
##### 5.2.5.7.3 Npcf_EventExposure_Unsubscribe service operation
**Service operation name:** Npcf_EventExposure_Unsubscribe.
**Description:** The NF consumer uses this service operation to unsubscribe
for a specific event for a group of UE(s) or any UE accessing a combination of
(DNN, S-NSSAI).
**Inputs, Required:** Subscription Correlation ID.
**Input, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Output, Optional:** None _._
##### 5.2.5.7.4 Npcf_EventExposure_Notify service operation
**Service operation name:** Npcf_EventExposure_Notify.
**Description:** This service operation reports the event to the consumer that
has previously subscribed either using Npcf_EventExposure_Subscribe service
operation or provided as part of the Data Set Application Data and Data Subset
Service Parameters stored in UDR.
**Inputs, Required:** Event ID, corresponding UE IDs (GPSI(s), SUPI),
Notification Correlation Information, time stamp.
The PCF reports the SUPI and if available GPSI(s) for each of the events. The
PCF may report the reports multiple events when those happen at the same time
and as indicated in the time stamp.
**Inputs, Optional:** Internal-Group-Id, Event specific information.
**Outputs, Required:** None _._
When the PCF detects the event subscribed by the NF consumer, the PCF reports
the subscribed event together with the Notification Target Address (+
Notification Correlation ID) to the Event Receiving NF.
The optional event specific parameter list provides the values that matched
for generating the event notification. The parameter values to match are
specified during the event subscription (see clause 6.1.3.18 of TS 23.503 [20]
and clauses 5.2.5.7.2 and 5.2.5.7.1).
See clause 4.15.6.7 and 4.1.5.6.10 for details on usage of this service
operation toward Application Function.
The PCF provides, in addition to the SUPI and if available GPSI(s), the
Internal-Group-Id if provided as Target UE in the Service Parameters stored in
UDR.
#### 5.2.5.8 Npcf_AMPolicyAuthorization Service
##### 5.2.5.8.1 General
Service description: This service is to authorise an AF request and
potentially create or change access and mobility management policies of a UE
based on the request of the authorized AF or TSCTSF. This service allows the
NF consumer to subscribe/unsubscribe the notification of events for related to
a user (i.e. a SUPI) that has an AM or UE Policy Association established, or
both, the list of events are defined in clause 6.1.3.18 of TS 23.503 [20]. The
description of the Throughput requirements, service coverage requirements and
policy duration are defined in clause 6.1.2.6.1 of TS 23.503 [20].
##### 5.2.5.8.2 Npcf_AMPolicyAuthorization_Create service operation
**Service operation name:** Npcf_AMPolicyAuthorization_Create
**Description:** Authorizes the request and optionally determines and installs
AM influence data according to the information provided by the NF Consumer.
**Inputs, Required:** SUPI.
**Inputs, Optional:** GPSI, Throughput requirements, service coverage
requirements, policy duration, subscribed events(s), 5G access stratum time
distribution indication (enable, disable), Uu time synchronization error
budget, clock quality detail level, clock quality acceptance criteria.
The subscribed event includes Event ID as specified in
Npcf_AMPolicyAuthorization_Notify service operation, Event Reporting
Information defined in Table 4.15.1-1 (only the Event Reporting mode and the
immediate reporting flag when applicable), Notification Target Address.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** Identification of the created application context, the
inputs that can be accepted by the PCF.
##### 5.2.5.8.3 Npcf_AMPolicyAuthorization_Update service operation
**Service operation name:** Npcf_AMPolicyAuthorization_Update
**Description:** Provides updated information to the PCF.
**Inputs, Required:** Identification of the application context.
**Inputs, Optional:** Throughput requirements, service coverage requirements,
policy duration, 5G access stratum time distribution indication (enable,
disable), Uu time synchronization error budget, clock quality detail level,
clock quality acceptance criteria.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** The inputs that can be accepted by the PCF.
##### 5.2.5.8.4 Npcf_AMPolicyAuthorization_Delete service operation
**Service operation name:** Npcf_AMPolicyAuthorization_Delete
**Description:** Provides means for the NF Consumer to delete an application
context.
**Inputs, Required:** Identification of the application context.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
##### 5.2.5.8.5 Npcf_AMPolicyAuthorization_Notify service operation
**Service operation name:** Npcf_AMPolicyAuthorization_Notify
**Description:** provided by the PCF to notify NF consumers of the subscribed
events.
**Inputs, Required:** Subscription Correlation ID, Event ID.
The event that can be subscribed is the event for request for allocation of
service area coverage defined in clause 6.1.3.18 of TS 23.503 [20].
**Inputs, Optional:** Event information as defined in clause 6.1.3.18 of TS
23.503 [20].
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.5.8.6 Npcf_AMPolicyAuthorization_Subscribe service operation
**Service operation name:** Npcf_AMPolicyAuthorization_Subscribe
**Description:** provided by the PCF for NF consumers to explicitly subscribe
the notification of events.
**Inputs, Required:** Event ID as specified in
Npcf_AMPolicyAuthorization_Notify service operation, Event Reporting
Information defined in Table 4.15.1-1 (only the Event Reporting mode and the
immediate reporting flag when applicable), Notification Target Address.
**Inputs, Optional:** target of PCF event reporting (SUPI or GPSI) in the case
of initial event subscription, Subscription Correlation ID (in the case of
modification of the event subscription).
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID.
**Outputs, Optional:** None.
##### 5.2.5.8.7 Npcf_AMPolicyAuthorization_Unsubscribe service operation
**Service operation name:** Npcf_AMPolicyAuthorization_Unsubscribe
**Description:** Enable NF consumers to explicitly unsubscribe the
notification of PCF events related to Npcf_AMPolicyAuthorization_Subscribe
operation.
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
#### 5.2.5.9 Npcf_PDTQPolicyControl Service
##### 5.2.5.9.1 General
**Service description:** This service provides functionality for negotiation
and management of planned data transfer with QoS requirements policies (PDTQ
policies), which includes the following functionalities:
\- Determine PDTQ policies based on the request via NEF from AF; and
\- Update PDTQ policies based on the selection provided by AF.
##### 5.2.5.9.2 Npcf_PDTQPolicyControl_Create service operation
**Service operation name:** Npcf_PDTQPolicyControl_Create
**Description:** This service is to create the PDTQ policy.
**Inputs, Required:** ASP identifier, Number of UEs, list of Desired time
windows, QoS reference or individual QoS parameters as described in clause
6.1.3.22 of TS 23.503 [20].
**Inputs, Optional:** S-NSSAI, DNN, Network Area Information, Request for
notification, Alternative Service Requirements.
**Outputs, Required:** One or more PDTQ policies, PDTQ Reference ID.
**Outputs, Optional:** None.
##### 5.2.5.9.3 Npcf_PDTQPolicyControl_Update service operation
**Service operation name:** Npcf_PDTQPolicyControl_Update
**Description:** This service is to update the PDTQ policy to the PCF.
**Inputs, Required:** PDTQ Reference ID.
**Inputs, Optional:** Stop notification, one PDTQ policy.
NOTE: PDTQ policy is only indicated if the AF selects one of the PDTQ policies
provided by the PCF.
**Outputs, Required:** None
**Outputs, Optional:** None.
##### 5.2.5.9.4 Npcf_PDTQPolicyControl_Notify service operation
**Service operation name:** Npcf_PDTQPolicyControl_Notify
**Description:** This service operation sends the PDTQ policy warning
notification to the NF consumer.
**Inputs, Required:** PDTQ reference ID, list of candidate PDTQ policies.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
### 5.2.6 NEF Services
#### 5.2.6.1 General
The following table shows the NEF Services and Service Operations:
Table 5.2.6.1-1: NF Services provided by the NEF
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | **Nnef_E | Subscribe | Su | AF, NWDAF | | ventExposure** | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AF, NWDAF | +----------------+----------------+----------------+----------------+ | | Notify | | AF, NWDAF | +----------------+----------------+----------------+----------------+ | **Nnef_P | Fetch | Re | SMF | | FDManagement** | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Subscribe | Su | SMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Notify | | SMF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | SMF | +----------------+----------------+----------------+----------------+ | | Create | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | **Nnef_E | Create | Re | AF | | ASDeployment** | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Subscribe | Su | SMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | SMF | +----------------+----------------+----------------+----------------+ | | Notify | | SMF | +----------------+----------------+----------------+----------------+ | **Nnef | Create | Re | AF | | _ECSAddress** | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Subscribe | Su | SMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | SMF | +----------------+----------------+----------------+----------------+ | | Notify | | SMF | +----------------+----------------+----------------+----------------+ | ** | Subscribe | Su | SMF | | Nnef_TrafficI | | bscribe/Notify | | | nfluenceData**| | | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | SMF | +----------------+----------------+----------------+----------------+ | | Notify | | SMF | +----------------+----------------+----------------+----------------+ |** Nnef_Parame | Update | Re | AF | | terProvision**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Create | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Get | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** N | Delivery | Re | AF | | nef_Trigger**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | DeliveryNotify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ |** Nnef_BDT | Create | Re | AF | | PNegotiation**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | | AF | +----------------+----------------+----------------+----------------+ |** Nnef_Traf | Create | Re | AF | | ficInfluence**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Get | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | App | Su | AF | | | RelocationInfo | bscribe/Notify | | +----------------+----------------+----------------+----------------+ |** Nnef_Cha | Create | Re | AF | | rgeableParty**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** Nnef_AFse | Create | Re | AF | | ssionWithQoS**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Revoke | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | ** | Notify | Notify | AF | | Nnef_MSISDN-l | | | | | ess_MO_SMS** | | | | +----------------+----------------+----------------+----------------+ | **Nnef_Serv | Create | Re | AF | | iceParameter** | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Get | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | ** | Subscribe | Su | AF | | Nnef_APISuppo | | bscribe/Notify | | | rtCapability**| | | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Notify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ |** Nnef_NIDDC | Create | Re | AF | | onfiguration**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | TriggerNotify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | UpdateNotify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** Nnef_NIDD**| Delivery | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | DeliveryNotify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Group | Notify | AF | | | DeliveryNotify | | | +----------------+----------------+----------------+----------------+ |** Nne | Create | Re | SMF | | f_SMContext**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | DeleteNotify | Su | SMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Delivery | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** Nnef_Analy | Subscribe | Su | AF | | ticsExposure**| | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AF | +----------------+----------------+----------------+----------------+ | | Notify | | AF | +----------------+----------------+----------------+----------------+ | | Fetch | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** Nnef_UCMF | Create | Re | AF | | Provisioning**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** Nnef_E | Get | Re | AF | | CRestriction**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** Nnef\ | Create | Re | AF | | _ApplyPolicy**| | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ |** Nn | Locati | Notify | AF | | ef_Location**| onUpdateNotify | | | +----------------+----------------+----------------+----------------+ | * | ConfigUpdate | Re | AF | | *Nnef_TimeSyn | | quest/Response | | | chronization** | | | | +----------------+----------------+----------------+----------------+ | | ConfigCreate | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | ConfigDelete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Conf | Su | AF | | | igUpdateNotify | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | CapsSubscribe | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | C | Su | AF | | | apsUnsubscribe | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | CapsNotify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | **Nnef_ASTI** | Create | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Get | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | UpdateNotify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Subscribe | | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | | +----------------+----------------+----------------+----------------+ | **N | Create | Re | AF | | nef_AMPolicyA | | quest/Response | | | uthorization** | | | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Subscribe | | AF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AF | +----------------+----------------+----------------+----------------+ | **Nnef\ | Create | Re | AF | | _AMInfluence** | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Delete | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | Su | AF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | **Nnef_UEId** | Get | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | **Nne | MoForwardSm | Re | SMS-SC | | f_SMService** | | quest/Response | | +----------------+----------------+----------------+----------------+ | **N | Create | Re | AF | | nef_PDTQPolic | | quest/Response | | | yNegotiation** | | | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | | AF | +----------------+----------------+----------------+----------------+ | **Nnef_M | Subscribe | Su | AF | | emberUESelecti | | bscribe/Notify | | | onAssistance** | | | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AF | +----------------+----------------+----------------+----------------+ | | Notify | | AF | +----------------+----------------+----------------+----------------+ | **N | Create | Re | AF | | nef_AF_reque | | quest/Response | | | st_for_QoS** | | | | +----------------+----------------+----------------+----------------+ | | Notify | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Revoke | Re | AF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | **Nnef\ | Subscribe | Su | AF, NWDAF | | _DNAIMapping** | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AF, NWDAF | +----------------+----------------+----------------+----------------+ | | UpdateNotify | | AF, NWDAF | +----------------+----------------+----------------+----------------+ | **Nne | Get | Re | AF | | f_UEAddress** | | quest/Response | | +----------------+----------------+----------------+----------------+
#### 5.2.6.2 Nnef_EventExposure service
##### 5.2.6.2.1 General
See clause 4.15.3.1 and clause 4.15.2a.
In order to support the NWDAF to collect data from the AF via the NEF, the
Event IDs associated with available data to be collected from the AF are
defined in clause 5.2.19.2.1, which can be subscribed by the NWDAF. The Event
filters for the specific Event IDs as defined in clause 5.2.19.2.1 can also be
used for collecting data from the AF via the NEF.
##### 5.2.6.2.2 Nnef_EventExposure_Subscribe operation
**Service operation name:** Nnef_EventExposure_Subscribe
**Description:** the consumer subscribes to receive an event, or if the event
is already defined in NEF, then the subscription is updated.
**Inputs, Required:** (Set of) Event ID(s) as specified in clause 4.15.3.1 or
Npcf_PolicyAuthorization_Notify and Naf_EventExposure_Subscribe service
operation, Target of Event Reporting (GPSI, SUPI, UE IPv4 address(es), UE IPv6
prefix(es), External Group Identifier, S-NSSAI, Internal Group Identifier, UE
addressing information (IP or MAC address), or indication that any UE is
targeted), Event Reporting Information defined in Table 4.15.1-1, Notification
Target Address (+ Notification Correlation ID), MTC Provider Information.
**Inputs, Optional:** Event Filter, (set of) External Application
Identifier(s), Subscription Correlation ID (in the case of modification of the
event subscription), Expiry time, list of group member UE(s) whose
subscription to event notification(s) are removed or added for a group-based
event notification subscription, operation indication (cancellation or
addition), DNN, S-NSSAI, Idle Status Indication request (if UE reachability or
Availability after DDN failure reporting is requested).
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID, Expiry time (required if the subscription can be expired based
on the operator\'s policy)_._
**Outputs, Optional:** First corresponding event report is included, if
available (see clause 4.15.1). External Identifier (representing an AF
specific UE Identifier).
##### 5.2.6.2.3 Nnef_EventExposure_Unsubscribe service operation
**Service operation name:** Nnef_EventExposure_Unsubscribe
**Description:** the NF consumer deletes an event if already defined in NEF.
**Inputs, Required:** Subscription Correlation ID.
**Outputs, Required:** Operation execution result indication _._
##### 5.2.6.2.4 Nnef_EventExposure_Notify service operation
**Service operation name:** Nnef_EventExposure_Notify
**Description:** NEF reports the event to the consumer that has previously
subscribed.
**Inputs, Required:** Event ID, Notification Correlation Information, time
stamp.
**Inputs, Optional:** Event information (defined on a per Event ID basis),
Event Removal Indication, list of group member UE(s) whose subscription to
event notification(s) are removed from a group-based event notification
subscription, UE(s) added/removed to/from the group.
**Outputs, Required:** Operation execution result indication _._
#### 5.2.6.3 Nnef_PFDManagement service
##### 5.2.6.3.1 General
The service provides the capability to create, update or remove PFDs via the
NEF (PFDF). See clause 4.18 for the detailed procedures.
##### 5.2.6.3.2 Nnef_PFDManagement_Fetch service operation
**Service operation name:** Nnef_PFDManagement_Fetch
**Description:** Provides the PFDs for Application Identifier to the NF
Consumer.
**Inputs, Required:** Application Identifier(s).
**Inputs, Optional:** None.
**Outputs, Required:** Application Identifier, PFDs _._
##### 5.2.6.3.3 Nnef_PFDManagement_Subscribe service operation
**Service operation name:** Nnef_PFDManagement_Subscribe
**Description:** provided by the NEF (PFDF) for NF consumers to explicitly
subscribe the notification of changes of PFDs for Application Identifier.
**Inputs, Required:** Application Identifier(s).
**Inputs, Optional:** None.
**Outputs, Required:** None _._
##### 5.2.6.3.4 Nnef_PFDManagement_Notify service operation
**Service operation name:** Nnef_PFDManagement_Notify
**Description:** Provides Update PFDs for Application Identifier to the NF
Consumer.
**Inputs, Required:** Application Identifier(s), PFDs.
**Inputs, Optional:** None.
**Outputs, Required:** None _._
##### 5.2.6.3.5 Nnef_PFDManagement_Unsubscribe service operation
**Service operation name:** Nnef_PFDManagement_Unsubscribe
**Description:** Provides by the NEF (PFDF) for NF Consumer to explicitly
unsubscribe the notification of events.
**Inputs, Required:** Application Identifier(s).
**Inputs, Optional:** None.
**Outputs, Required:** None
##### 5.2.6.3.6 Nnef_PFDManagement_Create service operation
**Service operation name:** Nnef_PFDManagement_Create
**Description:** The consumer requests PFD management to create PFDs.
**Inputs, Required:** AF Identifier, External Application Identifier and one
or more sets of PFDs.
**Inputs, Optional:** Allowed Delay.
**Outputs, Required:** Transaction Reference ID.
##### 5.2.6.3.7 Nnef_PFDManagement_Update service operation
**Service operation name:** Nnef_PFDManagement_Update
**Description:** The consumer requests PFD management to update PFDs.
**Inputs, Required:** Transaction Reference ID, one or more sets of PFDs.
**Inputs, Optional:** Allowed Delay.
**Outputs, Required:** None.
##### 5.2.6.3.8 Nnef_PFDManagement_Delete service operation
**Service operation name:** Nnef_PFDManagement_Delete
**Description:** The consumer requests PFD management to delete the PFDs.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** None.
**Outputs, Required:** None.
#### 5.2.6.4 Nnef_ParameterProvision service
##### 5.2.6.4.1 General
This service is for allowing external party to provision of information which
can be used for the UE in 5GS.
In all operations UE addressing information may correspond either to an UE IP
address or to a UE MAC address.
##### 5.2.6.4.2 Nnef_ParameterProvision_Update service operation
**Service operation name:** Nnef_ParameterProvision_Update
**Description:** The consumer updates the UE related information (e.g.
Expected UE Behaviour, Network Configuration parameters, Location Privacy
Indication parameters, ECS Address Configuration Information) or 5G VN Group
related information (e.g. 5G VN group data, 5G VN membership management), or
for Multicast MBS related information or DNN and S-NSSAI specific Group
Parameters, DNN, S-NSSAI.
**Inputs, Required:** AF Identifier, Transaction Reference ID.
**Inputs, Optional:** GPSI or UE addressing information, External Group ID at
least one of the Expected UE Behaviour parameters or at least one of the
Network Configuration parameters or 5G VN related information or ECS Address
Configuration Information, Validity Time or Location Privacy Indication
parameters, MTC Provider Information, or Multicast MBS related information,
DNN and S-NSSAI specific Group Parameters, DNN, S-NSSAI.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** Transaction specific parameters, if available. External
Identifier (representing an AF specific UE Identifier).
For Multicast MBS related information, refer to TS 23.247 [78].
##### 5.2.6.4.3 Nnef_ParameterProvision_Create service operation
**Service operation name:** Nnef_ParameterProvision_Create
**Description:** The consumer creates a 5G VN group, or Multicast MBS related
information group.
**Inputs, Required:** AF Identifier, Transaction Reference ID.
**Inputs, Optional:** GPSI or UE addressing information, External Group ID for
5G VN group creation or for multicast MBS group creation, External Group ID,
5G VN group related information (e.g. 5G VN group data, 5G VN membership
management), MTC Provider Information, Multicast MBS related information, DNN
and S-NSSAI specific Group Parameters, DNN, S-NSSAI.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** Transaction specific parameters, if available. External
Identifier (representing an AF specific UE Identifier).
For Multicast MBS related information, refer to TS 23.247 [78].
##### 5.2.6.4.4 Nnef_ParameterProvision_Delete service operation
**Service operation name:** Nnef_ParameterProvision_Delete
**Description:** The consumer deletes a 5G VN group or deletes a Multicast MBS
related information.
**Inputs, Required:** AF Identifier, Transaction Reference ID.
**Inputs, Optional:** External Group ID.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
For Multicast MBS related information, refer to TS 23.247 [78].
##### 5.2.6.4.5 Nnef_ParameterProvision_Get service operation
**Service operation name:** Nnef_ParameterProvision_Get
**Description:** The consumer gets the UE related information (e.g. Expected
UE Behaviour, Network Configuration parameters, ECS Address Configuration
Information).
**Inputs, Required:** GPSI or UE addressing information, AF Identifier,
requested information (e.g. Expected UE Behaviour, Network Configuration
parameters, ECS Address Configuration Information).
**Inputs, Optional:** None.
**Outputs, Required:** Requested data, Operation execution result indication.
**Outputs, Optional:** External Identifier (representing an AF specific UE
Identifier).
#### 5.2.6.5 Nnef_Trigger service
##### 5.2.6.5.1 General
See clause 4.13.2.
##### 5.2.6.5.2 Nnef_Trigger_Delivery service operation
**Service operation name:** Nnef_Trigger_Delivery
**Description:** the consumer requests that a trigger be sent to an
application on a UE and subscribes to be notified about result of the trigger
delivery attempt.
**Inputs, Required:** GPSI, AF Identifier, Trigger Reference Number,
Application Port ID
**Inputs, Optional:** Validity Period, Priority, Trigger Payload.
**Outputs, Required:** Transaction Reference ID, Cause _._
##### 5.2.6.5.3 Nnef_Trigger_DeliveryNotify service operation
**Service operation name:** Nnef_Trigger_DeliveryNotify
**Description:** NEF reports the status of the trigger delivery to the
consumer (failure or success).
NOTE: This notification corresponds to an implicit subscription by
Nnef_Trigger_Delivery service operation.
**Inputs, Required:** Transaction Reference ID, Delivery Report.
**Inputs, Optional:** None.
**Outputs, Required:** None.
#### 5.2.6.6 Nnef_BDTPNegotiation service
##### 5.2.6.6.1 General
See clause 4.16.7.
##### 5.2.6.6.2 Nnef_BDTPNegotiation_Create service operation
**Service operation name:** Nnef_BDTPNegotiation_Create.
**Description:** The consumer requests a background data transfer policy.
**Inputs, Required:** ASP Identifier, Volume per UE, Number of UEs, Desired
time window.
**Inputs, Optional:** External Group Identifier, Network Area Information,
Request for notification, MAC address or IP 3-tuple of Application server.
**Outputs, Required:** Background Data Transfer Reference ID, one or more
background data transfer policies.
**Output, Optional:** None.
##### 5.2.6.6.3 Nnef_BDTPNegotiation_Update service operation
**Service operation name:** Nnef_BDTPNegotiation Update.
**Description:** the consumer requests the selected background data transfer
policy to be set.
**Inputs, Required:** Background Data Transfer Reference ID, background data
transfer policy.
**Inputs, Optional:** Stop notification.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.6.6.4 Nnef_BDTPNegotiation_Notify service operation
**Service operation name:** Nnef_BDTPNegotiation_Notify
**Description:** NEF sends the BDT warning notification to the NF consumer.
**Inputs, Required:** Background data transfer reference ID.
**Inputs, Optional:** Network Area Information, Time window, list of candidate
Background DataTransfer policies.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.6.7 Nnef_TrafficInfluence service
##### 5.2.6.7.1 General
**Service description:** This service provides:
\- Request authorization of NF Service Consumer requests.
\- Request parameter mapping from NF Service Consumer requests to 5GC
parameters and vice versa as described in clause 5.6.7 of TS 23.501 [2].
\- NF Service Consumer request routing (forwarding) to actual NF Service
Producer to influence traffic routing decisions as described in clause 5.6.7
of TS 23.501 [2].
##### 5.2.6.7.2 Nnef_TrafficInfluence_Create operation
**Service operation name:** Nnef_TrafficInfluence_Create
**Description:** Authorize the request and forward the request for traffic
influence.
**Inputs, Required:** AF Transaction Id, AF Identifier.
The AF Transaction Id refers to the request.
**Inputs, Optional:** The address (IP or Ethernet) of one or more UE(s) if
available, one or more GPSIs if available, DNN if available, S-NSSAI if
available, External Group Identifier(s) if available, External Application
Identifier or traffic filtering information, AF-Service-Identifier, a list of
DNAI(s) and corresponding routing profile ID(s) or N6 traffic routing
information, Indication of traffic correlation, Indication of application
relocation possibility, Indication of UE IP address preservation, Early and/or
late notifications about UP path management events, Notification Target
Address, immediate reporting flag, Temporal validity condition, Spatial
validity condition, User Plane Latency Requirements, Information for EAS IP
Replacement in 5GC, Indication for EAS Relocation and AF indication for
simultaneous connectivity over source and target PSA at edge relocation, EAS
Correlation indication, External Subscriber Category(s), SFC Identifier(s),
Metadata, Common EAS IP address, Traffic Correlation ID, FQDN(s) as described
in clause 5.6.7 of TS 23.501 [2], HPLMN of the UE. If an IP address of one or
more UE(s) is provided, a corresponding port number (e.g. TCP or UPDP) for
each IP address.
The IP address of one or more UE(s) may be provided together with the
corresponding port number allowing to support the case where the PSA UPF is
carrying out NAT on the traffic exchanged with the EAS.
NOTE 1: When only one DNAI and corresponding routing profile ID(s) and the
Indication for EAS Relocation are available, the presented DNAI is the target
DNAI as defined in clause 6.3.7 of TS 23.548 [74].
NOTE 2: In this Release the following cannot be used by AFs in VPLMN
influencing traffic on Home Routed PDU sessions:
\- External Group Identifier;
\- External Subscriber Category.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.7.3 Nnef_TrafficInfluence_Update operation
**Service operation name:** Nnef_TrafficInfluence_Update
**Description:** Authorize the request and forward the request to update the
traffic influence.
**Inputs, Required:** AF Transaction Id.
The AF Transaction Id identifies the NF Service Consumer request to be
updated.
**Inputs, Optional:** Same optional information as in
Nnef_TrafficInfluence_Create Input, AF Identifier.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.7.4 Nnef_TrafficInfluence_Delete operation
**Service operation name:** Nnef_TrafficInfluence_Delete
**Description:** Authorize the request and forward the request to delete(s)
request for traffic influence.
**Inputs, Required:** AF Transaction Id.
The AF Transaction Id identifies the NF Service Consumer request for traffic
influence to be deleted.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.7.4A Nnef_TrafficInfluence_Get operation
**Service operation name:** Nnef_TrafficInfluence_Get
**Description:** Get the current traffic influence parameters.
**Inputs, Required:** AF Transaction Id.
The AF Transaction Id refers to the request.
**Inputs, Optional:** The address (IP or Ethernet) of the UE if available,
GPSI if available, DNN if available, S-NSSAI if available, External Group
Identifier if available, External Application Identifier or traffic filtering
information, AF-Service-Identifier, a list of DNAI(s) and corresponding
routing profile ID(s) or N6 traffic routing information.
**Outputs, Required:** Operation execution result indication, requested data.
**Outputs, Optional:** None.
##### 5.2.6.7.5 Nnef_TrafficInfluence_Notify operation
**Service operation name:** Nnef_TrafficInfluence_Notify
**Description:** Forward the notification of UP path management event report
to AF.
**Known NF Service Consumers:** AF.
**Inputs, Required:** AF Transaction Id, Event ID.
The AF Transaction Id identifies the AF request for traffic influence that the
event report is related to. The event may be the UP path management event
defined in clause 5.6.7 of TS 23.501 [2].
**Inputs, Optional:** Event information (defined on a per Event ID basis),
capability of supporting EAS IP replacement in 5GC.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.7.6 Nnef_TrafficInfluence_AppRelocationInfo operation
**Service operation name:** Nnef_TrafficInfluence_AppRelocationInfo
**Description:** Forward the acknowledgement to the notification of UP path
management event report to SMF.
**Inputs, Required:** Notification Correlation Information, cause code.
Cause code indicates whether the acknowledgement is a positive response or a
negative response.
**Inputs, Optional:** N6 traffic routing information as described in clause
5.6.7 of TS 23.501 [2], Indication that buffering of uplink traffic should
start, Information for EAS IP Replacement in 5GC.
**Outputs, Required:** None.
**Outputs, Optional:** None.
See clause 4.3.6.3 for details on usage of this service operation for example
for the usage of the Indication that buffering of uplink traffic should start.
#### 5.2.6.8 Nnef_ChargeableParty service
##### 5.2.6.8.1 General
See clauses 4.15.6.4 and 4.15.6.5.
##### 5.2.6.8.2 Nnef_ChargeableParty_Create service operation
**Service operation name:** Nnef_ChargeableParty Create
**Description:** The consumer requests to become the chargeable party for a
data session for a UE.
**Inputs, Required:** AF Identifier, UE address (i.e. IP address or MAC
address), Flow description information as described in clause 6.1.3.6 of TS
23.503 [20] or External Application Identifier, ASP Identifier, Sponsor
Information, Sponsoring Status.
**Inputs, Optional:** Time period, traffic volume, Background Data Transfer
Reference ID, DNN if available, S-NSSAI if available.
**Outputs, Required:** Transaction Reference ID, result.
**Output (optional):** None.
##### 5.2.6.8.3 Nnef_ChargeableParty_Update service operation
**Service operation name:** Nnef_ChargeableParty Update
**Description:** The consumer can change the chargeable party of a data
session for a UE.
**Inputs, Required:** AF Identifier, Transaction Reference ID, Sponsoring
Status.
**Inputs, Optional:** Time period, traffic volume, Background Data Transfer
Reference ID.
**Outputs, Required:** Transaction Reference ID, result.
**Output (optional):** None.
##### 5.2.6.8.4 Nnef_ChargeableParty_Notify service operation
**Service operation name:** Nnef_ChargeableParty Notify
**Description:** NEF reports the bearer level event(s) to the consumer.
**Inputs, Required:** Event reports.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Output (optional):** None.
#### 5.2.6.9 Nnef_AFsessionWithQoS service
##### 5.2.6.9.1 General
See clauses 4.15.6.6, 4.15.6.13, 4.15.6.14.
This service is also used to support subscription and notification of QoS
Monitoring for the QoS parameter(s) to be measured defined in clause 5.45 of
TS 23.501 [2].
This service is also used to support subscription and notification of BAT
offset for the AF that supports adjusting burst sending time based on RAN
feedback, as described in clause 5.27.2.5 of TS 23.501 [2].
This service is also used to support the QoS resource allocation for a list of
UEs.
This service is also used to support subscription and notification of QoS
Monitoring event for Data Rate Monitoring for a list of QoS flows, as
described in clause 5.2.26.
##### 5.2.6.9.2 Nnef_AFsessionWithQoS_Create service operation
**Service operation name:** Nnef_AFsessionWithQoS Create
**Description:** The consumer requests the network to provide a specific QoS
for an AF session for a UE or a list of UEs.
**Inputs, Required:** AF Identifier, UE address (i.e. IP address or MAC
address and only applicable for a single UE AF session), a list of UE
addresses (as described in clause 4.15.6.13, and only applicable for a Multi-
member AF session). Flow description information(s) as described in clause
6.1.3.6 of TS 23.503 [20] or External Application Identifier, QoS Reference or
individual QoS parameters as described in clause 6.1.3.22 of TS 23.503 [20].
**Inputs, Optional:** Multi-Model Service ID, Multi-modal Service
Requirements, time period, traffic volume, Alternative Service Requirements
(containing one or more QoS Reference parameters or Requested Alternative QoS
Parameter Sets in a prioritized order), QoS parameter(s) to be measured as
defined in clause 5.45 of TS 23.501 [2], Reporting frequency, Target of
reporting and optional an indication of local event notification as described
in clause 6.1.3.21 of TS 23.503 [20], DNN if available, S-NSSAI if available.
Only applicable for a single UE AF session: flow direction, Burst Arrival Time
at UE (uplink) or UPF (downlink), Periodicity, Time domain, Survival Time, BAT
Window or Capability for BAT adaptation, Packet Delay Variation requirements
as described in clause 6.1.3.26 of TS 23.503 [20], Periodicity Range, RT
Latency Indication as described in clause 6.1.3.22 of TS 23.503 [20], PDU Set
QoS Parameters as described in clause 5.7.7 of TS 23.501 [2], Protocol
Description (as described in clause 5.37.5 of TS 23.501 [2]), Indication of
ECN marking for L4S as described in clause 6.1.3.22 of TS 23.503 [20], QoS
duration, QoS inactivity interval.
Only applicable for a Multi-member AF session: Consolidated Data Rate
Threshold, a list of UE addresses subject to Consolidated Data Rate
monitoring.
NOTE 1: If Consolidated Data Rate Threshold is provided, the QoS parameter(s)
to be measured indicates the Guaranteed Bitrate shall be provided.
NOTE 2: When the AF request is for Consolidated Data Rate monitoring is set
for event reporting, the QoS Flow data rate reporting for the list of UEs
provided to the AF by the NEF only when the Consolidated Data Rate threshold
is exceeded.
NOTE 3: When the Consolidated Data Rate threshold is provided, it applies to
the list of UE addresses by default. However, if the list of UE addresses
subject for Consolidated Data Rate monitoring is also provided, then such list
has to be the subset of the list of UE addresses.
**Outputs, Required:** Transaction Reference ID, result (result as described
in clause 4.15.6.13 if a list of UE is targeted).
**Output (optional):** None.
##### 5.2.6.9.3 Nnef_AFsessionWithQoS_Notify service operation
**Service operation name:** Nnef_AFsessionWithQoS Notify
**Description:** NEF reports the QoS Flow level event(s) to the consumer.
**Inputs, Required:** Reports of the events as defined in clause 6.1.3.18 of
TS 23.503 [20], Transaction Reference ID if a list of UE is targeted.
NOTE: When the event report is for Consolidated Data Rate monitoring, the QoS
Flow data rate reporting for the list of UEs provided to the AF by the NEF
only when the Consolidated Data Rate threshold is exceeded.
**Inputs, Optional:** When the event report is for QoS Monitoring, includes
QoS Monitoring report for the QoS parameter(s) to be measured defined in
clause 5.45 of TS 23.501 [2], e.g. UL packet delay, DL packet delay, or round
trip packet delay, UL and/or DL data rate of the single UP path or two UP
paths in the case of redundant transmission, as defined in clause 5.33.3.2 of
TS 23.501 [2]. When the AF has provided Capability for BAT Adaptation or BAT
Window, can include BAT offset as described in clause 5.27.2.5 of TS 23.501
[2]. When the delivery report is for Consolidated Data Rate Monitoring,
includes Consolidated Data Rate Monitoring report.
**Outputs, Required:** None.
**Output (optional):** None.
##### 5.2.6.9.4 Nnef_AFsessionWithQoS_Revoke service operation
**Service operation name:** Nnef_AFsessionWithQoS Revoke
**Description:** The consumer requests the network to revoke the AF session
with requested QoS or the AF session with requested QoS including Alternative
Service Requirements for a UE or a list of UEs.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** None.
**Outputs, Required:** Transaction Reference ID, result (result as described
in clause 4.15.6.3 if a list of UE is targeted).
**Output (optional):** None.
##### 5.2.6.9.5 Nnef_AFsessionWithQoS_Update service operation
**Service operation name:** Nnef_AFsessionWithQoS Update
**Description:** The consumer requests the network to update the parameters
for an AF session for a UE or a list of UEs.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** Flow description information (as described in clause
6.1.3.6 of TS 23.503 [20]) or External Application Identifier, QoS Reference
or individual QoS parameters as described in clause 6.1.3.22 of TS 23.503
[20], time period, traffic volume, Alternative Service Requirements
(containing one or more QoS Reference parameters or Requested Alternative QoS
Parameter Sets in a prioritized order), QoS parameter(s) to be measured as
defined in clause 5.45 of TS 23.501 [2], Reporting frequency, Target of
reporting and optional an indication of local event notification as described
in clause 6.1.3.21 of TS 23.503 [20].
Only applicable for a single UE AF session: flow direction, Burst Arrival Time
at UE (uplink) or UPF (downlink), Periodicity, Time domain, Survival Time,
Packet Delay Variation requirements as described in clause 6.1.3.26 of TS
23.503 [20], BAT Window or Capability for BAT adaptation, Periodicity Range,
PDU Set QoS Parameters as described in clause 5.7.7 of TS 23.501 [2], Protocol
Description (as described in clause 5.37.5 of TS 23.501 [2]).
Only applicable for a Multi-member AF session: a list of UE addresses (as
described in clause 4.15.6.13), Consolidated Data Rate Threshold, a list of UE
addresses subject to Consolidated Data Rate monitoring.
NOTE 1: If Consolidated Data Rate Threshold is provided, the QoS parameter(s)
to be measured indicates the Guaranteed Bitrate shall be provided.
NOTE 2: When the AF request is for Consolidated Data Rate monitoring is set
for event reporting, the QoS Flow data rate reporting for the group of UEs
provided to the AF by the NEF only when the Group Data Rate threshold is
exceeded.
NOTE 3: When the Consolidated Data Rate threshold is provided, it applies to
the list of UE addresses by default. However, if the list of UE addresses
subject for Consolidated Data Rate monitoring is also provided, then such list
has to be the subset of the list of UE addresses.
NOTE 4: If AF wants to terminate the Consolidated Data Rate monitoring, AF
does not include the Consolidated Data Rate threshold in the AF request.
**Outputs, Required:** Success or Failure. Failure Cause in case of Failure.,
Transaction Reference ID if a list of UE is targeted.
**Output (optional):** None.
#### 5.2.6.10 Nnef_MSISDN-less_MO_SMS service
##### 5.2.6.10.1 General
See clause 4.13.7.
##### 5.2.6.10.2 Nnef_MSISDN-less_MO_SMSNotify service operation
**Service operation name:** Nnef_MSISDN-less_MO_SMSNotify
**Description:** NEF delivers to the SMS Payload to the AF. The NEF shall
determine the notification destination URL of the AF based on configured
information on the mapping of SME addresses to destination URLs.
**Inputs, Required:** SMS payload, GPSI and Application Port ID.
**Inputs, Optional:** None.
**Outputs, Required:** None.
#### 5.2.6.11 Nnef_ServiceParameter service
##### 5.2.6.11.1 General
This service is for allowing external party to provision of service specific
parameters which can be used for the UE in 5GS. The detailed information is
described in clause 4.15.6.7.
##### 5.2.6.11.2 Nnef_ServiceParameter_Create operation
**Service operation name:** Nnef_ServiceParameter_Create
**Description:** The consumer stores service specific parameters in the UDR
via the NEF.
**Inputs, Required:** Service Descriptor (e.g. the combination of DNN and
S-NSSAI, an AF-Service-Identifier or an External Application Identifier)
**Inputs, Optional:** Service Parameters and Target UE identifiers (e.g. the
address (IP or Ethernet) of the UE if available, GPSI if available, External
Group Identifier if available), \"PLMN ID(s) of inbound roamers\",
subscribedEvents, notificationDestination.
If identifiers of target UE(s) or a group of UEs or \"PLMN ID(s) of inbound
roamers\" are not provided, then the Service Parameters shall correspond to
any UEs of the PLMN of the NEF using the service identified by the Service
Description.
**Outputs, Required:** Transaction Reference ID, operation execution result
indication.
**Outputs, Optional:** None.
##### 5.2.6.11.3 Nnef_ServiceParameter_Update operation
**Service operation name:** Nnef_ServiceParameter_Update
**Description:** The consumer updates service specific parameters in the UDR
via the NEF.
**Inputs, Required:** Service Descriptor (e.g. the combination of DNN and
S-NSSAI, an AF-Service-Identifier or an External Application Identifier),
Transaction Reference ID.
**Inputs, Optional:** Service Parameters and Target UE identifiers (e.g. the
address (IP or Ethernet) of the UE if available, GPSI if available, External
Group Identifier if available), or \"PLMN ID(s) of inbound roamers\".
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.11.4 Nnef_ServiceParameter_Delete operation
**Service operation name:** Nnef_ServiceParameter_Delete
**Description:** The consumer deletes service specific parameters from the UDR
via the NEF.
**Inputs, Required:** Service Descriptor (e.g. the combination of DNN and
S-NSSAI, an AF-Service-Identifier or an External Application Identifier),
Transaction Reference ID.
**Inputs, Optional:** Target UE identifiers (e.g. the address (IP or Ethernet)
of the UE if available, GPSI if available, External Group Identifier if
available) or \"PLMN ID(s) of inbound roamers\".
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.11.5 Nnef_ServiceParameter_Get operation
**Service operation name:** Nnef_ServiceParameter_Get
**Description:** The consumer retrieves service specific parameters in the UDR
via the NEF.
**Inputs, Required:** Service Descriptor (e.g. the combination of DNN and
S-NSSAI, an AF-Service-Identifier or an External Application Identifier).
**Inputs, Optional:** Service Parameters and Target UE identifiers (e.g. the
address (IP or Ethernet) of the UE if available, GPSI if available, External
Group Identifier if available), or \"PLMN ID(s) of inbound roamers\".
**Outputs, Required:** Transaction Reference ID, operation execution result
indication, requested data.
**Outputs, Optional:** None.
##### 5.2.6.11.6 Nnef_ServiceParameter_Notify operation
**Service operation name:** Nnef_ServiceParameter_Notify
**Description:** This service operation is used by the NEF to notify a Service
Parameter Authorisation Update (e.g. to revoke an authorization) to AF, see
clause clause 4.15.6.7a or to forward a notification for a subscribed event by
the AF, see clause 4.15.6.7, e.g. the notification of outcome of UE Policies
Delivery to AF.
**Inputs, Required:** Transaction Reference ID, Target UE (i.e. GPSI) or
External Group Id, Result.
The Transaction Reference ID identifies the AF request for service specific
parameter provisioning that the notification (i.e. notification of an
authorization update or reporting a subscribed event) is related to. The GPSI
is the identifier of the UE for which the notification is related to.
**Inputs, Optional:** DNN, S-NSSAI, PLMN ID(s) of inbound roamers, Event
Information (defined on a per Event ID basis, for UE Policies delivery outcome
it may include the result of the UE Policies delivery procedure and for
unsuccessful results, an identifier of the reason), authorization update
information (e.g. authorization revocation cause).
The Event ID may be the UE Policies delivery outcome defined in clause
4.15.6.7. The GPSI is the identifier of the UE for which the event report is
related to.
The NEF provides, in addition to the SUPI and if available GPSI(s), the
External-Group-Id if provided as Target UE in the
Nnef_ServiceParameter_Subscribe operation.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.6.12 Nnef_APISupportCapability service
##### 5.2.6.12.1 General
In order to support interworking with EPC, the NEF is integrated with SCEF as
a combined SCEF+NEF node for network exposure as defined in clause 5.17.5 of
TS 23.501 [2].
The common services provided by SCEF+NEF may become unavailable because the UE
is now being served by a node (e.g. MME) or NF (e.g. AMF) that does not
support that service. If the availability or expected level of support of a
service API associated with a UE changes, for example due to a mobility
between 5GC and EPC, the AF can be made aware of the change via this service.
This service consists of Subscribe, Unsubscribe, Notify service operations. It
supports informing AF of the availability or expected level of support of a
given service via a response to the One-time report type subscribe request of
the AF or via a notification to the Continuous report type subscription of the
AF.
##### 5.2.6.12.2 Nnef_APISupportCapability_Subscribe service operation
**Service operation name:** Nnef_APISupportCapability_Subscribe
**Description:** The AF subscribes to receive notification about the
availability or expected level of support of a service API for a UE or a group
of UEs.
**Inputs, Required:** UE ID or External Group ID, Report Type (One-time report
or Continuous report).
**Inputs, Optional:** Duration of Reporting, callback URI.
**Outputs, Required:** Operation execution result indication. When the
subscription is accepted: Subscription Correlation ID, API indication.
##### 5.2.6.12.3 Nnef_APISupportCapability_Notify service operation
**Service operation name:** Nnef_APISupportCapability_Notify
**Description:** The AF is notified about the availability or expected level
of support of a service API for a UE or a group of UEs if it has subscribed to
receive it.
**Inputs, Required:** API Indication, UE ID or External Group ID.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
##### 5.2.6.12.4 Nnef_APISupportCapability_Unsubscribe service operation
**Service operation name:** Nnef_APISupportCapability_Unsubscribe
**Description:** The AF unsubscribes to receive notification about the
availability or expected level of support of a service API for a UE or a group
of UEs.
**Inputs, Required:** UE ID or External Group ID.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
#### 5.2.6.13 Nnef_NIDDConfiguration service
##### 5.2.6.13.1 General
See clause 4.25.3.
##### 5.2.6.13.2 Nnef_NIDDConfiguration_Create service operation
**Service operation name:** Nnef_NIDDConfiguration_Create
**Description:** This service operation is used by the consumer to request
NIDD Configuration between NF consumer and NEF to support NIDD via NEF.
**Inputs, Optional:** Reliable Data Service Configuration, Requested Action,
TLTRI, NIDD Duration.
**Inputs, Required:** GPSI or External Group Identifier, AF Identifier, T8
Destination Address, MTC Provider Information).
**Outputs, Required:** TLTRI, Reliable Data Service Indication, Maximum Packet
Size, Cause.
**Outputs, Optional:** NIDD Duration.
##### 5.2.6.13.3 Nnef_NIDDConfiguration_TriggerNotify service operation
**Service operation name:** Nnef_NIDDConfiguration_TriggerNotify
**Description:** NEF triggers NIDD Configuration Create Request if there is no
NIDD Configuration between NF consumer and NEF.
**Inputs, Required:** GPSI, AF Identifier, NEF ID.
**Outputs, Required:** None.
##### 5.2.6.13.4 Nnef_NIDDConfiguration_UpdateNotify service operation
**Service operation name:** Nnef_NIDDConfiguration_UpdateNotify
**Description:** This service operation is used by the NEF to notify NF
consumer the NIDD Configuration Update due to NIDD Authorization Update.
**Inputs, Required:** GPSI, TLTRI, Result.
**Inputs, Optional:** Cause, NIDD Duration.
**Outputs, Required:** None.
##### 5.2.6.13.5 Nnef_NIDDConfiguration_Delete service operation
**Service operation name:** Nnef_NIDDConfiguration_Delete
**Description:** This service operation is used by the NF consumer to request
NIDD Configuration delete between NF consumer and NEF to support NIDD via NEF.
**Inputs, Required:** TLTRI.
**Outputs, Required:** Cause.
#### 5.2.6.14 Nnef_NIDD service
##### 5.2.6.14.1 General
See clauses 4.25.4, 4.25.5 and 4.25.9.
##### 5.2.6.14.2 Nnef_NIDD_Delivery service operation
**Service operation name:** Nnef_NIDD_Delivery
**Description:** This service operation is used by the NF consumer to deliver
the unstructured data between NF consumer and NEF to support NIDD via NEF.
**Inputs, Required:** User Identity or External Group Identifier, unstructured
data, TLTRI (Optional), Reliable Data Service Configuration (Optional), MO
Exception Data Counter.
**Outputs, Required:** Cause.
##### 5.2.6.14.3 Nnef_NIDD_DeliveryNotify service operation
**Service operation name:** Nnef_NIDD_DeliveryNotify
**Description:** This service operation is used by the NEF to forward the
unstructured data to NF consumer to support NIDD via NEF.
**Inputs, Required:** User Identity, unstructured data, TLTRI (Optional),
Reliable Data Service Configuration (Optional).
**Outputs, Required:** Cause.
##### 5.2.6.14.4 Nnef_NIDD_GroupDeliveryNotify service operation
**Service operation name:** Nnef_NIDD_GroupDeliveryNotify
**Description:** This service operation is used by the NEF to inform the AF of
the aggregated response of Group MT NIDD operation.
**Inputs, Required:** The TLTRI that was provided when the Nnef_NIDD_Delivery
operation was invoked with an External Group Identifier, External Identifier
list with associated with the External Group Identifier and cause values.
**Inputs, Optional:** Re-transmission Time(s).
**Outputs, Required:** None.
#### 5.2.6.15 Nnef_SMContext service
##### 5.2.6.15.1 General
The service provides the capability to create, update or release the SMF-NEF
Connection. See clause 4.25.2 for the detailed procedure.
##### 5.2.6.15.2 Nnef_SMContext_Create service operation
**Service operation name:** Nnef_SMContext_Create
**Description:** This service operation is used by the consumer to request
connection establishment between NF consumer and NEF to support NIDD via NEF.
**Inputs, Required:** User Identity, PDU session ID, NIDD information,
S-NSSAI, DNN.
**Inputs, Optional:** RDS support indication, Serving PLMN Rate Control
parameters, Small Data Rate Control parameters and Small Data Control Status.
**Outputs, Required:** Cause.
**Outputs, Optional:** Extended Buffering Support, NIDD Parameters, RDS
support indication.
##### 5.2.6.15.3 Nnef_SMContext_Delete service operation
**Service operation name:** Nnef_SMContext_Delete
**Description:** This service operation is used by the NF consumer to request
SMF-NEF Connection release between NF consumer and NEF to support NIDD via
NEF.
**Inputs, Required:** User Identity, PDU Session ID, NEF ID, S-NSSAI, DNN,
Release Cause.
**Outputs, Required:** Cause.
**Outputs, Optional:** Small Data Rate Control Status, APN Rate Control
Status.
##### 5.2.6.15.4 Nnef_SMContext_DeleteNotify service operation
**Service operation name:** Nnef_SMContext_DeleteNotify
**Description:** This service operation is used by the NEF to notify NF
consumer that the SMF-NEF Connection for NIDD via NEF is no longer valid.
**Inputs, Required:** User Identity, PDU session ID, S-NSSAI, DNN, Reason of
the SMF-NEF connection release
**Inputs, Optional:** Small Data Rate Control Status, APN Rate Control Status.
**Outputs, Required:** Cause.
##### 5.2.6.15.5 Nnef_SMContext_Delivery service operation
**Service operation name:** Nnef_SMContext_Delivery
**Description:** This service operation is used by the NF consumer to deliver
the unstructured data between NF consumer and NEF to support NIDD.
**Inputs, Required:** User Identity, PDU session ID, unstructured data.
**Outputs, Required:** Cause.
#### 5.2.6.16 Nnef_AnalyticsExposure service
##### 5.2.6.16.1 General
This service is for allowing NF Service Consumer to ask analytics information
as specified in TS 23.288 [50].
##### 5.2.6.16.2 Nnef_AnalyticsExposure_Subscribe operation
**Service operation name:** Nnef_AnalyticsExposure_Subscribe
**Description:** The NF consumer subscribes or modifies an existing
subscription on analytics information.
**Inputs, Required:** (Set of) Analytics ID(s), Analytic Filter Information,
Target of Analytic Reporting (UEs (e.g. GPSI), External Group Identifier, any
UEs), Analytic Reporting Information, Notification Target Address (+
Notification Correlation ID). These input parameters are detailed in TS 23.288
[50].
**Inputs, Optional:** Subscription Correlation ID (in the case of modification
of the analytics subscription), Expiry time, slice specific information,
Geographical area, Analytics feedback information.
NOTE 1: When the Analytics ID is set to \"User Data Congestion\", the input
parameters are defined in TS 23.288 [50].
NOTE 2: The Geographical area could be provided as e.g. shapes (e.g. polygons,
circles, etc.) or civic addresses (e.g. streets, districts, etc.) as
referenced by OMA Presence API.
NOTE 3: The Analytics feedback information only can be included in
modification request for the existing analytics subscription as described in
TS 23.288 [50].
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID, Expiry time (required if the subscription can be expired based
on the operator\'s policy).
**Outputs, Optional:** First corresponding analytics report is included, if
available.
##### 5.2.6.16.3 Nnef_AnalyticsExposure_Unsubscribe service operation
**Service operation name:** Nnef_AnalyticsExposure_Unsubscribe
**Description:** The NF consumer unsubscribes to an existing subscription on
analytics information.
**Inputs, Required:** Subscription Correlation ID.
**Outputs, Required:** Operation execution result indication.
##### 5.2.6.16.4 Nnef_AnalyticsExposure_Notify service operation
**Service operation name:** Nnef_AnalyticsExposure_Notify
**Description:** NEF reports the analytics to the NF consumer that has
previously subscribed.
**Inputs, Required:** Analytics ID(s), Notification Correlation Information,
Analytic information (defined on a per Analytics ID basis). These input
parameters are detailed in TS 23.288 [50].
**Inputs, Optional:** Timestamp of analytics generation, Probability
assertion, Termination Request specified in TS 23.288 [50].
**Outputs, Required:** Operation execution result indication.
##### 5.2.6.16.5 Nnef_AnalyticsExposure_Fetch service operation
**Service operation name:** Nnef_AnalyticsExposure_Fetch
**Description:** The NF consumer requests analytics information.
**Inputs Required:** Analytics ID, Analytic Filter Information, Target of
Analytic Reporting (UE (e.g. GPSI), External Group Identifier, any UEs),
Analytic Reporting Information. These input parameters are detailed in TS
23.288 [50].
**Inputs, Optional:** Slice specific information, Geographical area.
NOTE 1: When the Analytics ID is set to \"User Data Congestion\", the input
parameters are defined in TS 23.288 [50].
NOTE 2: The Geographical area could be provided as e.g. shapes (e.g. polygons,
circles, etc.) or civic addresses (e.g. streets, districts, etc.) as
referenced by OMA Presence API.
**Outputs Required:** Analytic information (defined on a per Analytics ID
basis) specified in TS 23.288 [50].
**Outputs, Optional:** Timestamp of analytics generation, Probability
assertion, specified in TS 23.288 [50].
#### 5.2.6.17 Nnef_UCMFProvisioning service
##### 5.2.6.17.1 General
This service is for allowing external party to provision the UCMF with UCMF
dictionary entries for Manufacturer-assigned UE Radio Capability IDs.
##### 5.2.6.17.2 Nnef_UCMFProvisioning_Create operation
**Service operation name:** Nnef_UCMFProvisioning_Create
**Description:** The consumer creates a UCMF dictionary entry (or more
entries) for a Manufacturer-assigned UE Radio Capability ID via the NEF. For
each UE Radio Capability ID the following inputs are provided:
a) a UE radio access capability set with respective Coding format or the UE
radio access capability set in both TS 36.331 [16] and TS 38.331 [12] coding
formats and each RATs\' UE Radio Capability for Paging; and
b) the related UE model(s) IMEI/TAC value(s) the UE radio capability ID
applies to.
**Inputs, Required:** (list of) [UE Radio Capability ID, set(s) of UE Radio
Access Capability set and UE Radio Capability for Paging and respective Coding
format(s), (List of) IMEI/TAC value(s)].
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
The Coding format(s) indicates the format of the respective UE radio access
capabilities as defined in TS 36.331 [16] or TS 38.331 [12].
##### 5.2.6.17.3 Nnef_UCMFProvisioning_Delete operation
**Service operation name:** Nnef_UCMFProvisioning_Delete
**Description:** The consumer deletes a UCMF dictionary entry for a
Manufacturer-assigned UE Radio Capability ID via the NEF. The consumer
provides a (list of) UE radio capability ID value(s) to be deleted or it may
provide the IMEI/TAC values for which the associated UE radio capability ID
entries shall be no longer used.
**Inputs, Required:** UE Radio Capability ID(s) of the UCMF dictionary
entry(ies) to be deleted or IMEI/TAC(s) that no longer use associated UE radio
Capability ID(s).
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.6.17.4 Nnef_UCMFProvisioning_Update operation
**Service operation name:** Nnef_UCMFProvisioning_Update
**Description:** The consumer updates the list of IMEI/TAC values a UCMF
dictionary entry(or a list of entries) applies to for a Manufacturer-assigned
UE Radio Capability ID via the NEF. For each UE Radio Capability ID provided,
(a list of) UE model(s) IMEI/TAC value(s) to be added or removed to the
related UCMF entry is provided.
**Inputs, Required:** Update Type (one of \"Add IMEI/TAC Values\" or \"Remove
IMEI/TAC Values\") and:
\- If Update Type is \"Add IMEI/TAC Values\", the (list of) UE Radio
Capability ID(s) of the UCMF dictionary entry(ies) to be updated and the
related additional (list of) IMEI/TAC(s); or
\- If Update Type is \"Remove IMEI/TAC Values\", the (list of) UE Radio
Capability ID(s) of the UCMF dictionary entry(ies) to be updated and the
related (list of) IMEI/TAC(s) to be removed.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.6.18 Nnef_ECRestriction service
##### 5.2.6.18.1 General
This service is for allowing the AF to query status of Enhanced Coverage
Restriction or enable/disable Enhanced Coverage Restriction per individual UE.
##### 5.2.6.18.2 Nnef_ECRestriction_Get service operation
**Service operation name:** Nnef_ECRestriction_Get
**Description:** The consumer query the status of Enhanced Coverage
Restriction information.
**Inputs, Required:** GPSI, AF Identifier.
**Inputs, Optional:**
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** Enhanced Coverage Restriction information.
##### 5.2.6.18.3 Nnef_ECRestriction_Update service operation
**Service operation name:** Nnef_ECRestriction_Update
**Description:** The consumer enables or disables the Enhanced Coverage
Restriction.
**Inputs, Required:** GPSI, AF Identifier, Enhanced Coverage Restriction
information.
**Inputs, Optional:** MTC Provider Information.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:**
#### 5.2.6.19 Nnef_ApplyPolicy service
##### 5.2.6.19.1 General
The service provides the capability to apply a previously negotiated
Background Data Transfer Policy to a UE or a group of UEs. See clause 4.15.6.8
for the detailed procedure.
##### 5.2.6.19.2 Nnef_ApplyPolicy_Create service operation
**Service operation name:** Nnef_ApplyPolicy Create
**Description:** The consumer requests to apply a policy to the UE.
**Inputs, Required:** AF Identifier, External Identifier or External Group ID,
Background Data Transfer Reference ID for a previously negotiated policy of a
background data transfer.
**Inputs, Optional:** None.
**Outputs, Required:** Transaction Reference ID, result.
**Output (optional):** None.
##### 5.2.6.19.3 Nnef_ApplyPolicy_Update service operation
**Service operation name:** Nnef_ApplyPolicy Update
**Description:** The consumer requests to update a policy to the UE.
**Inputs, Required:** Transaction Reference ID, Background Data Transfer
Reference ID for a previously negotiated policy of a background data transfer.
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Output (optional):** None.
##### 5.2.6.19.4 Nnef_ApplyPolicy_Delete service operation
**Service operation name:** Nnef_ApplyPolicy Delete
**Description:** The consumer requests to delete a policy to the UE.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Output (optional):** None.
#### 5.2.6.20 Void
#### 5.2.6.21 Nnef_Location service
##### 5.2.6.21.1 General
The service provides the capability to deliver UE location to AF.
##### 5.2.6.21.2 Nnef_Location_LocationUpdateNotify service operation
**Service operation name:** Nnef_Location_LocationUpdateNotify
**Description:** Provides UE location information to the consumer NF.
**Inputs, Required:** Identity of the AF, UE identifier (GPSI), event causing
the location estimate (5GC-MO-LR), location estimate, age of location
estimate, accuracy indication, LCS QoS class.
**Inputs, Optional:** Service identity.
**Outputs, Required:** Success/Failure indication.
**Output (optional):** Failure Cause (in the case of failure indication
provided).
#### 5.2.6.22 Nnef_AMPolicyAuthorization Service
##### 5.2.6.22.1 General
**Service description:** This service is to authorise an AF request and
trigger a respective Npcf_AMPolicyAuthorization request. This service allows
the NF consumer to subscribe/unsubscribe the notification of events for
reporting change of service coverage defined in clause 6.1.3.18 of TS 23.503
[20]. The description of the Throughput requirements, service coverage
requirements and policy duration are defined in clause 6.1.2.6.1 of TS 23.503
[20].
##### 5.2.6.22.2 Nnef_AMPolicyAuthorization_Create service operation
**Service operation name:** Nnef_AMPolicyAuthorization_Create
**Description:** Authorizes the request and triggers an
Npcf_AMPolicyAuthorization_Create, potentially translating GPSI to SUPI.
**Inputs, Required:** GPSI.
**Inputs, Optional:** Throughput requirements, service coverage requirements,
policy duration, subscribed event(s).
The subscribed event includes Event ID as specified in
Nnef_AMPolicyAuthorization_Notify service operation, Event Reporting
Information defined in Table 4.15.1-1 (only the Event Reporting mode and the
immediate reporting flag when applicable), Notification Target Address.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** Identification of the created application context, the
inputs that can be accepted by the PCF.
##### 5.2.6.22.3 Nnef_AMPolicyAuthorization_Update service operation
**Service operation name:** Nnef_AMPolicyAuthorization_Update
**Description:** Provides updated information about an application context to
the NEF and triggers an Npcf_AMPolicyAuthorization_Update.
**Inputs, Required:** Identification of the application context.
**Inputs, Optional:** Throughput requirements, service coverage requirements,
policy duration.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** The inputs that can be accepted by the PCF.
##### 5.2.6.22.4 Nnef_AMPolicyAuthorization_Delete service operation
**Service operation name:** Nnef_AMPolicyAuthorization_Delete
**Description:** Provides means for the NF Consumer to delete an application
context by triggering an Npcf_AMPolicyAuthorization_Delete.
**Inputs, Required:** Identification of the application context.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
##### 5.2.6.22.5 Nnef_AMPolicyAuthorization_Notify service operation
**Service operation name:** Nnef_AMPolicyAuthorization_Notify
**Description:** provided by the NEF to notify NF consumers when the NEF
receives from the PCF notifications about subscribed events.
**Inputs, Required:** Subscription Correlation ID, Event ID.
The event that can be subscribed is the event for reporting change of coverage
defined in clause 6.1.3.18 of TS 23.503 [20].
**Inputs, Optional:** Event information as defined in clause 6.1.3.18 of TS
23.503 [20].
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.22.6 Nnef_AMPolicyAuthorization_Subscribe service operation
**Service operation name:** Nnef_AMPolicyAuthorization_Subscribe
**Description:** provided by the NEF for NF consumers to explicitly subscribe
the notification of events, triggering an
Npcf_AMPolicyAuthorization_Subscribe.
**Inputs, Required:** Event ID as specified in
Nnef_AMPolicyAuthorization_Notify service operation, SUPI, Event Reporting
Information defined in Table 4.15.1-1 (only the Event Reporting mode and the
immediate reporting flag when applicable), Notification Target Address.
**Inputs, Optional:** Subscription Correlation ID (in the case of modification
of the event subscription).
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID.
**Outputs, Optional:** None.
##### 5.2.6.22.7 Nnef_AMPolicyAuthorization_Unsubscribe service operation
**Service operation name:** Nnef_AMPolicyAuthorization_Unsubscribe
**Description:** Enable NF consumers to explicitly unsubscribe the
notification of events related to Nnef_AMPolicyAuthorization_Subscribe
operation.
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
#### 5.2.6.23 Nnef_AMInfluence service
##### 5.2.6.23.1 General
**Service description:** This service is to authorize the request and store in
the UDR application data that can be retrieved by relevant PCFs in order to
influence access and mobility management policies of one or multiple UEs. This
service allows the NF consumer to subscribe/unsubscribe the notification of
events about service coverage (defined in clause 6.1.3.18 of TS 23.503 [20]).
The description of the Throughput requirements, service coverage requirements
and policy duration are defined in clause 6.1.2.6.1 of TS 23.503 [20].
##### 5.2.6.23.2 Nnef_AMInfluence_Create operation
**Service operation name:** Nnef_AMInfluence_Create
**Description:** Authorize the request and store the AM influence data in the
UDR, potentially translating GSPI to SUPI and External Group Identifier to
Internal Group Identifier.
**Inputs, Required:** AF Transaction Id.
The AF Transaction Id refers to the request.
**Inputs, Optional:** List of (DNN, S-NSSAI)(s), Target (GPSI, or External
Group Identifier(s), or any UE, or any inbound roaming UEs identified by their
PLMN ID(s)), throughput requirements, service coverage requirements, policy
duration, List of External Application Identifiers, subscribed event(s).
The subscribed event(s) includes Event ID(s) as specified in
Nnef_AMInfluence_Notify service operation, Event Reporting Information defined
in Table 4.15.1-1 (only the Event Reporting mode and the immediate reporting
flag when applicable), Notification Target Address.
When a list of External Application Identifiers is provided, the throughput
requirement, service coverage requirements, policy duration and subscribed
event(s) are assigned the same value for all External Application Identifiers.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
NOTE: \"any UE\" refers to the UEs within the PLMN of the NEF.
##### 5.2.6.23.3 Nnef_AMInfluence_Update operation
**Service operation name:** Nnef_AMInfluence_Update
**Description:** Authorize the request and forward the request to update the
AM influence data, potentially translating GSPI to SUPI and External Group
Identifier to Internal Group Identifier.
**Inputs, Required:** AF Transaction Id.
The AF Transaction Id identifies the NF Service Consumer request to be
updated.
**Inputs, Optional:** Same as in Nnef_AMInfluence_Create.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.23.4 Nnef_AMInfluence_Delete operation
**Service operation name:** Nnef_AMInfluence_Delete
**Description:** Authorize the request and forward the request to delete the
AM influence data.
**Inputs, Required:** AF Transaction Id.
The AF Transaction Id identifies the NF Service Consumer request for AM
influence data to be deleted.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.23.6 Nnef_AMInfluence_Notify operation
**Service operation name:** Nnef_AMInfluence_Notify
**Description:** Forward the notification of change of service coverage event
report to the AF.
**Inputs, Required:** AF Transaction Id, Event ID.
The AF Transaction Id identifies the AF request for AM influence data that the
event report is related to.
The event that can be subscribed is the event for reporting change of coverage
defined in clause 6.1.3.18 of TS 23.503 [20]
**Inputs, Optional:** Event information (as defined in clause 6.1.3.18 of TS
23.503 [20]).
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
#### 5.2.6.24 Void
#### 5.2.6.25 Nnef_TimeSynchronization service
##### 5.2.6.25.1 General
**Service description:** This service provides:
\- authorization of NF Service Consumer requests;
\- time synchronization service exposure as described in clause 5.27.1.8 of TS
23.501 [2] when the NF Service Consumer requests to create or update time
synchronization configuration as well as to activate and deactivate the time
synchronization service, for which the NEF uses service operations provided by
TSCTSF as described in clause 5.2.27.
##### 5.2.6.25.2 Nnef_TimeSynchronization_ConfigCreate operation
**Service operation name:** Nnef_TimeSynchronization_ConfigCreate
**Description:** The consumer requests to create a time synchronization
configuration and activate the time synchronization service with the
configuration, for which the NEF authorizes the request and invokes the
corresponding service operation with TSCTSF (clause 5.2.27.2.2).
**Inputs, Required:** As specified in clause 5.2.27.2.2.
**Inputs, Optional:** As specified in clause 5.2.27.2.2.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.2.2.
**Outputs, Optional:** As specified in clause 5.2.27.2.2.
##### 5.2.6.25.3 Nnef_TimeSynchronization_ConfigUpdate operation
**Service operation name:** Nnef_TimeSynchronization_ConfigUpdate
**Description:** The consumer requests to update the time synchronization
configuration, for which the NEF authorizes the request and invokes the
corresponding service operation with TSCTSF (clause 5.2.27.2.3).
**Inputs, Required:** As specified in clause 5.2.27.2.3.
**Inputs, Optional:** As specified in clause 5.2.27.2.3.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.2.3.
**Outputs, Optional:** As specified in clause 5.2.27.2.3.
##### 5.2.6.25.4 Nnef_TimeSynchronization_ConfigDelete operation
**Service operation name:** Nnef_TimeSynchronization_ConfigDelete
**Description:** The consumer requests to delete the time synchronization
configuration and deactivate the corresponding time synchronization service,
for which the NEF authorizes the request and invokes the corresponding service
operation with TSCTSF (clause 5.2.27.2.4).
**Inputs, Required:** As specified in clause 5.2.27.2.4.
**Inputs, Optional:** As specified in clause 5.2.27.2.4.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.2.4.
**Outputs, Optional:** As specified in clause 5.2.27.2.4.
##### 5.2.6.25.5 Nnef_TimeSynchronization_ConfigUpdateNotify operation
**Service operation name:** Nnef_TimeSynchronization_ConfigUpdateNotify
**Description:** Forward the notification for the time synchronization
configuration or (g)PTP time distribution status change. When the NEF receives
a notification of a change corresponding to a time synchronization
configuration or (g)PTP time distribution status from the TSCTSF, it forwards
the notification by invoking a Nnef_TimeSynchronization_ConfigUpdateNotify
service operation to the NF consumer(s) that has subscribed for the event. The
event parameters are described in Table 5.2.27.2.5-1.
**Known NF Service Consumers:** AF.
**Inputs, Required:** As specified in clause 5.2.27.2.5.
**Inputs, Optional:** As specified in clause 5.2.27.2.5.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.25.6 Nnef_TimeSynchronization_CapsSubscribe operation
**Service operation name:** Nnef_TimeSynchronization_CapsSubscribe
**Description:** The AF requests the subscription to receive notifications
about time synchronization capabilities for a list of UE(s) or a group of UEs
or any UEs using DNN/S-NSSAI combination, for which the NEF authorizes the
request and invokes the corresponding service operation with TSCTSF (clause
5.2.27.2.6).
Event Filters are used to specify the conditions to match for notifying the
event. If there are no conditions to match then the Event Filter is not
provided. The Event Filters supported by the service are described in Table
5.2.27.2.6-1.
**Inputs, Required:** As specified in clause 5.2.27.2.6.
**Inputs, Optional:** As specified in clause 5.2.27.2.6.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.2.6.
**Outputs, Optional:** As specified in clause 5.2.27.2.6.
##### 5.2.6.25.7 Nnef_TimeSynchronization_CapsUnsubscribe operation
**Service operation name:** Nnef_TimeSynchronization_CapsUnsubscribe
**Description:** The AF requests to unsubscribe from receiving notifications
about time synchronization capabilities for a list of UE(s) or a group of UEs
or any UE using a DNN/S-NSSAI combination, for which the NEF authorizes the
request and invokes the corresponding service operation with TSCTSF (clause
5.2.27.2.7).
**Inputs, Required:** As specified in clause 5.2.27.2.7.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.2.7.
**Outputs, Optional:** As specified in clause 5.2.27.2.7.
##### 5.2.6.25.8 Nnef_TimeSynchronization_CapsNotify operation
**Service operation name:** Nnef_TimeSynchronization_CapsNotify
**Description:** Forward the notification for the time synchronization
configuration.
When the NEF receives a notification of a change corresponding to a
Subscription from the TSCTSF, it forwards the notification by invoking a
Nnef_TimeSynchronization_CapsNotify service operation to the NF consumer(s)
that has subscribed for the event. The event parameters are described in Table
5.2.27.2.8-1.
**Known NF Service Consumers:** AF.
**Inputs, Required:** As specified in clause 5.2.27.2.8.
**Inputs, Optional:** As specified in clause 5.2.27.2.8.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.25.9 Void
##### 5.2.6.25.10 Void
##### 5.2.6.25.11 Void
##### 5.2.6.25.12 Void
#### 5.2.6.26 Nnef_EASDeployment service
##### 5.2.6.26.1 General
**Service description:** The EAS Deployment information management in the NEF
provides functions for Node Level EAS Deployment information provision from AF
and for subscribing and retrieving EAS Deployment Information in the UDR and
providing EAS Deployment Information to the SMF. For related procedures see
clause 6.2.3.4 of TS 23.548 [74].
##### 5.2.6.26.2 Nnef_EASDeployment_Create service operation
**Service operation name:** Nnef_EASDeployment_Create
**Description:** The NF consumer requests to create EAS Deployment
Information.
**Inputs, Required:** EAS Deployment Information.
**Inputs, Optional:** AF-service-identifier.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.26.3 Nnef_EASDeployment_Update service operation
**Service operation name:** Nnef_EASDeployment_Update
**Description:** The NF consumer requests to Update EAS Deployment
Information.
**Inputs, Required:** EAS Deployment Information.
**Inputs, Optional:** AF-service-identifier.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.26.4 Nnef_EASDeployment_Delete service operation
**Service operation name:** Nnef_EASDeployment_Delete
**Description:** The NF consumer requests to delete EAS Deployment
Information.
**Inputs, Required:** Either:
\- AF-identifier;
\- S-NSSAI and DNN;
\- EDI.
**Inputs, Optional:** Application Identifier, External Group Identifier.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.26.5 Void
##### 5.2.6.26.6 Nnef_EASDeployment_Subscribe service operation
**Service operation name:** Nnef_EASDeployment_Subscribe
**Description:** provided by the NEF for NF consumers to explicitly subscribe
the notification of changes of EAS Deployment Information.
**Inputs, Required:** Event ID, Notification Target Address(+Notification
Correlation ID).
**Inputs, Optional:** DNN, S-NSSAI, Application Identifier, Internal Group
Identifier.
**Outputs, Required:** Result Indication. When the subscription is accepted:
Subscription Correlation ID (reference of the subscription).
**Outputs, Optional:** None.
##### 5.2.6.26.7 Nnef_EASDeployment_Unsubscribe service operation
**Service operation name:** Nnef_EASDeployment_Unsubscribe
**Description:** provided by the NEF for NF consumers to explicitly
unsubscribe the notification of changes of EAS Deployment Information.
**Inputs, Required:** Subscription Correlation ID (reference of the
subscription).
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.26.8 Nnef_EASDeployment_Notify service operation
**Service operation name:** Nnef_EASDeployment_Notify
**Description:** Provides subscribed event information, e.g. updated EAS
Deployment Information of Application Identifier, to the NF Consumer.
**Inputs, Required:** Event ID, Notification Correlation ID, EAS Deployment
Information.
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
#### 5.2.6.27 Nnef_UEId service
##### 5.2.6.27.1 General
See clause 4.15.10 and clause 4.3.6.5.
##### 5.2.6.27.2 Nnef_UEId_Get operation
**Service operation name:** Nnef_UEId_Get
**Description:** Get the UE identifier.
**Inputs, Required:** GPSI or UE address (i.e. IPv4/IPv6 address or MAC
address) or External Group Identifier(s).
**Inputs, Optional:** DNN, S-NSSAI, Port number (e.g. TCP or UDP port), IP
domain, Application port ID, MTC Provider Information, AF Identifier.
**Outputs, Required:** Result, AF specific UE Identifier represented as an
External Identifier or SUPI or Internal Group Identifier(s).
NOTE: SUPI and Internal Group Identifier can only be exposed to roaming
partners.
**Outputs, Optional:** None.
#### 5.2.6.28 Nnef_ASTI service
##### 5.2.6.28.1 General
**Service description:** This service provides:
\- authorization of NF Service Consumer requests;
\- time synchronization service exposure as described in clause 5.27.1.8 of TS
23.501 [2] when a NF Service Consumer requests to control the 5G access
stratum time distribution configuration, for which the NEF uses service
operations provided by TSCTSF as described in clause 5.2.27.
##### 5.2.6.28.2 Nnef_ASTI_Create operation
**Service operation name:** Nnef_ASTI_Create
**Description:** The consumer requests to activate the 5G access stratum time
distribution, for which the NEF authorizes the request and invokes the
corresponding service operation with TSCTSF (clause 5.2.27.4.2).
**Inputs, Required:** As specified in clause 5.2.27.4.2.
**Inputs, Optional:** As specified in clause 5.2.27.4.2.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.4.2.
**Outputs, Optional:** As specified in clause 5.2.27.4.2.
##### 5.2.6.28.3 Nnef_ASTI_Update operation
**Service operation name:** Nnef_ASTI_Update
**Description:** The consumer requests to update the 5G access stratum time
distribution configuration, for which the NEF authorizes the request and
invokes the corresponding service operation with TSCTSF (clause 5.2.27.4.3).
**Inputs, Required:** As specified in clause 5.2.27.4.3.
**Inputs, Optional:** As specified in clause 5.2.27.4.3.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.4.3.
**Outputs, Optional:** As specified in clause 5.2.27.4.3.
##### 5.2.6.28.4 Nnef_ASTI_Delete operation
**Service operation name:** Nnef_ASTI_Delete
**Description:** The consumer requests to delete the 5G access stratum time
distribution configuration and deactivate the corresponding 5G access stratum
time distribution service, for which the NEF authorizes the request and
invokes the corresponding service operation with TSCTSF (clause 5.2.27.4.4).
**Inputs, Required:** As specified in clause 5.2.27.4.4.
**Inputs, Optional:** As specified in clause 5.2.27.4.4.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.4.4.
**Outputs, Optional:** As specified in clause 5.2.27.4.4.
##### 5.2.6.28.5 Nnef_ASTI_Get operation
**Service operation name:** Nnef_ASTI_Get
**Description:** The consumer makes a query about the status of the access
stratum time distribution, for which the NEF authorizes the request and
invokes the corresponding service operation with TSCTSF (clause 5.2.27.4.5).
**Inputs, Required:** As specified in clause 5.2.27.4.5.
**Inputs, Optional:** As specified in clause 5.2.27.4.5.
**Outputs, Required:** Operation execution result indication and in the case
of successful operation, any outputs as specified in clause 5.2.27.4.5.
**Outputs, Optional:** As specified in clause 5.2.27.4.5.
##### 5.2.6.28.6 Nnef_ASTI_UpdateNotify operation
**Service operation name:** Nnef_ASTI_UpdateNotify
**Description:** Forward the notification for the 5G access stratum time
distribution status change. When the NEF receives a notification of a change
from the TSCTSF, it forwards the notification by invoking a
Nnef_ASTI_UpdateNotify service operation to the NF consumer(s) that has
subscribed for the event.
**Inputs, Required:** As specified in clause 5.2.27.4.6.
**Inputs, Optional:** As specified in clause 5.2.27.4.6.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.6.28.7 Nnef_ASTI_Subscribe operation
**Service operation name:** Nnef_ASTI_Subscribe
**Description:** Subscribe 5G access stratum time distribution status change.
**Inputs, Required:** As specified in clause 5.2.27.4.7.
**Inputs, Optional:** As specified in clause 5.2.27.4.7.
**Outputs, Required:** Transaction Reference ID, result.
**Outputs, Optional:** None.
##### 5.2.6.28.8 Nnef_ASTI_Unsubscribe operation
**Service operation name:** Nnef_ASTI_Unsubscribe
**Description:** Unsubscribe to 5G access stratum time distribution status or
NG_RAN timing synchronization status change (see clause 5.2.6.28.7).
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
#### 5.2.6.29 Nnef_SMService service
##### 5.2.6.29.1 General
**Service description:** This service can be used for SBI-based MO SM transmit
through NEF for MSISDN-less MO SMS.
##### 5.2.6.29.2 Nnef_SMService_MoForwardSm service operation
**Service operation name:** Nnef_SMService_MoForwardSm.
**Description:** Transmit MO SMS message from consumer NF to NEF.
**Inputs, Required:** SMS payload, Application port ID, SUPI, destination SME
address (long/short code of the AF).
**Inputs, Optional:** None.
**Outputs, Required:** SMS message transmission result.
**Outputs, Optional:** None.
#### 5.2.6.30 Nnef_PDTQPolicyNegotiation service
##### 5.2.6.30.1 General
**Service description:** This service provides functionality for negotiation
and management of planned data transfer with QoS requirements policies (PDTQ
policies), which includes the following functionalities:
\- Determine PDTQ policies based on the request from AF; and
\- Update PDTQ policies based on the selection provided by AF.
##### 5.2.6.30.2 Nnef_PDTQPolicyNegotiation_Create service operation
**Service operation name:** Nnef_PDTQPolicyNegotiation_Create
**Description:** The consumer requests to create a PDTQ policy.
**Inputs, Required:** ASP Identifier, Number of UEs, list of Desired time
windows, QoS reference or individual QoS parameters as described in clause
6.1.3.22 of TS 23.503 [20].
**Inputs, Optional:** Network Area Information, Request for notification,
Alternative Service Requirements.
**Outputs, Required:** PDTQ Reference ID, one or more PDTQ policies.
**Output, Optional:** None.
##### 5.2.6.30.3 Nnef_PDTQPolicyNegotiation_Update service operation
**Service operation name:** Nnef_PDTQPolicyNegotiation Update
**Description:** The consumer requests the selected PDTQ policy to be set.
**Inputs, Required:** PDTQ Reference ID.
**Inputs, Optional:** Stop notification, one PDTQ policy.
NOTE: PDTQ policy is only indicated if the AF selects one of the PDTQ policies
provided by the PCF.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.6.30.4 Nnef_PDTQPolicyNegotiation_Notify service operation
**Service operation name:** Nnef_PDTQPolicyNegotiation_Notify
**Description:** NEF sends the PDTQ policy warning notification to the NF
consumer.
**Inputs, Required:** PDTQ reference ID, list of candidate PDTQ policies.
**Inputs, Optional:** None.
**Outputs, Required:** None.
#### 5.2.6.31 Void
#### 5.2.6.32 Nnef_MemberUESelectionAssistance service
##### 5.2.6.32.1 General
The service provides the capability to subscribe, unsubscribe or notify the
Member UE selection assistance information from the NEF. See Table 4.15.13.2-1
for the Member UE filtering criteria.
##### 5.2.6.32.2 Nnef_MemberUESelectionAssistance_Subscribe service operation
**Service operation name:** Nnef_MemberUESelectionAssistance_Subscribe
**Description:** The NF consumer subscribes to receive the Member UE selection
assistance information, or the subscription is updated if the same
subscription is already defined in NEF.
**Inputs, Required:** Notification Target Address (+ Notification Correlation
ID), at least one filtering criteria shown in Table 4.15.13.2-1.
**Inputs, Conditional Required:**
If no Subscription Correlation ID is provided in the subscription, Target of
Member UE Selection Assistance Reporting (GPSI or a list of GPSIs) is
required.
**Inputs, Optional:** Application ID, Subscription Correlation ID (in the case
of modification of the existing subscription), Expiry time, a set of Member UE
filtering criteria shown in the Table 4.15.13.2-1, time window(s) for
selecting the candidate UEs, specific parameters depending on the Member UE
filtering criteria, Periodicity (the periodicity of member update), maximum
number of UEs (indicates the maximum number of candidate UEs that need to be
fed back).
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID, Expiry time (required if the subscription can be expired based
on the operator\'s policy).
##### 5.2.6.32.3 Nnef_MemberUESelectionAssistance_Unsubscribe service
operation
**Service operation name:** Nnef_MemberUESelectionAssistance_Unsubscribe
**Description:** The NF consumer deletes a subscription for Member UE
selection assistance information that is already created in NEF.
**Inputs, Required:** Subscription Correlation ID.
**Outputs, Required:** Operation execution result indication.
##### 5.2.6.32.4 Nnef_MemberUESelectionAssistance_Notify service operation
**Service operation name:** Nnef_MemberUESelectionAssistance_Notify
**Description:** NEF reports the Member UE selection assistance information to
the consumer that has previously subscribed.
**Inputs, Required:** Notification Correlation Information.
**Inputs, Conditional Required:**
At least one of the following inputs is required:
\- One or more list(s) of candidate UE(s).
**Inputs, Optional:** Recommended time window for performing the application
operation per list of candidate UE(s) as described in clause 4.15.13.1,
specific value of the parameters that NEF gathered for the Member UE filtering
criteria per candidate UE a number for each filtering criterion that indicates
the of UEs in the initial list which do not meet the criterion (provided if
there are multiple filtering criteria in the subscribe request).
NOTE: This number can be an indication for AF to revise the corresponding
filtering criterion.
**Outputs, Required:** Operation execution result indication.
#### 5.2.6.33 Nnef_AF_request_for_QoS service
##### 5.2.6.33.1 General
See clause 4.15.6.14.
This service is also used to support subscription and notification of QoS
Monitoring, as described in clause 5.33.3.2 of TS 23.501 [2].
##### 5.2.6.33.2 Nnef_AF_request_for_QoS_Create service operation
**Service operation name:** Nnef_AF_request_for_QoS Create
**Description:** The consumer requests the network to provide a specific QoS
for a traffic flow for a UE or a group of UEs.
**Inputs, Required:** AF Identifier, Target UE identifier (GPSI or External
Group Identifier), Flow description(s) or External Application Identifier, QoS
Reference or individual QoS parameters as described in clause 6.1.3.22 of TS
23.503 [20].
**Inputs, Optional:** time period, traffic volume, Alternative Service
Requirements (containing one or more QoS reference parameters or Requested
Alternative QoS Parameter Sets in a prioritized order), QoS parameter(s) to be
measured, Reporting frequency, Target of reporting and optional an indication
of local event notification as described in clause 6.1.3.21 of TS 23.503 [20],
DNN if available, S-NSSAI if available, traffic characteristics as described
in clause 6.1.3.23 or 6.1.3.23a of TS 23.503 [20].
**Outputs, Required:** Transaction Reference ID, result.
**Output (optional):** None.
##### 5.2.6.33.3 Nnef_AF_request_for_QoS_Notify service operation
**Service operation name:** Nnef_AF_request_for_QoS Notify
**Description:** NEF reports the QoS Flow level event(s) to the consumer.
**Inputs, Required:** Reports of the events as defined in clause 6.1.3.18 of
TS 23.503 [20].
**Inputs, Optional:** When the event report is for QoS Monitoring, includes
Packet delay for UL, DL, or round trip of the single UP path or two UP paths
in the case of redundant transmission, as defined in clause 5.33.3.2 of TS
23.501 [2].
**Outputs, Required:** None.
**Output (optional):** None.
##### 5.2.6.33.4 Nnef_AF_request_for_QoS_Revoke service operation
**Service operation name:** Nnef_AF_request_for_QoS Revoke
**Description:** The consumer requests the network to revoke the Service
Requirement(s) and/or additional Alternative Service Requirement(s) for a UE
or a group of UEs.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** None.
**Outputs, Required:** Transaction Reference ID, result.
**Output (optional):** None.
##### 5.2.6.33.5 Nnef_AF_request_for_QoS_Update service operation
**Service operation name:** Nnef_AF_request_for_QoS Update
**Description:** The consumer requests the network to update the Service
Requirement(s) and/or additional Alternative Service Requirement(s) for a UE
or a group of UEs.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** Flow description information (as described in clause
6.1.3.6 of TS 23.503 [20]), QoS reference or individual QoS parameters as
described in clause 6.1.3.22 of TS 23.503 [20], time period, traffic volume,
Alternative Service Requirements (containing one or more QoS reference
parameters or Requested Alternative QoS Parameter Sets in a prioritized
order), QoS parameter(s) to be measured, Reporting frequency, Target of
reporting and optional an indication of local event notification as described
in clause 6.1.3.21 of TS 23.503 [20], traffic characteristics as described in
clause 6.1.3.23 or 6.1.3.23a of TS 23.503 [20].
**Outputs, Required:** Result.
**Output (optional):** None.
#### 5.2.6.34 Nnef_DNAIMapping service
##### 5.2.6.34.1 General
The service is allowing AF and NWDAF to obtain DNAI.
##### 5.2.6.34.2 Nnef_DNAIMapping_Subscribe service operation
**Service operation name:** Nnef_DNAIMapping_Subscribe
**Description:** This service operation is used by the consumer to subscribe
for DNAI information by providing specific information of AF and NWDAF.
**Inputs, Required:** EAS address information i.e. IP address/IP address range
or FQDN.
**Inputs, Optional:** DNN, S-NSSAI, AF identifier, Event Reporting Information
defined in Table 4.15.1-1.
NOTE: If consumer wants, one-time reporting can be done by setting the Event
Reporting Information as follows: event reporting mode to maximum number of
reports, maximum number of reports=1 and Immediate reporting flag set.
**Outputs, Required:** When the subscription is accepted and not one-time
reporting: Subscription Correlation ID, Expiry time (required if the
subscription can be expired based on the operator\'s policy).
**Outputs, Optional:** DNAI, if available.
##### 5.2.6.34.3 Nnef_DNAIMapping_Unsubscribe service operation
**Service operation name:** Nnef_DNAIMapping_Unsubscribe
**Description:** The NF consumer terminates a subscription.
**Inputs, Required:** if not one-time reporting, Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication result.
**Outputs, Optional:** None.
##### 5.2.6.34.4 Nnef_DNAIMapping_UpdateNotify service operation
**Service operation name:** Nnef_DNAIMapping_UpdateNotify
**Description:** This service operation is used by the NEF to notify NF
consumer about the update of DNAI - EAS address(es) mapping information.
**Inputs, Required:** One or more pairs of DNAI(s) and EAS address(es).
**Inputs, Optional:** Cause.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.6.35 Nnef TrafficInfluenceData service
##### 5.2.6.35.1 General
This service is used by SMF in VPLMN to subscribe AF traffic influence request
information from the AF via the NEF in VPLMN.
##### 5.2.6.35.2 Nnef_TrafficInfluenceData_Subscribe operation
**Service operation name:** Nnef_TrafficInfluenceData_Subscribe
**Description:** The NF consumer subscribes for the notifications of AF
traffic influence request information.
**Inputs, Required:** Data Set Identifier (i.e. Application data), Data Subset
Identifier (i.e. AF traffic influence request information), Data Key(s),
Notification Target Address, Event Reporting Information defined in Table
4.15.1-1.
**Inputs, Optional:** None.
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID.
**Outputs, Optional:** None.
##### 5.2.6.35.3 Nnef_TrafficInfluenceData_Unsubscribe service operation
**Service operation name:** Nnef_TrafficInfluenceData_Unsubscribe
**Description:** Provided by the NEF for NF consumers to explicitly
unsubscribe the notification of AF traffic influence request information.
**Inputs, Required:** Subscription Correlation ID (reference of the
subscription).
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.35.4 Nnef_TrafficInfluenceData_Notify service operation
**Service operation name:** Nnef_TrafficInfluenceData_Notify
**Description:** NEF notifies NF consumer(s) about AF traffic influence
request information, when receives notification of AF traffic influence
request information from UDR.
**Inputs, Required:** Notification Correlation ID, Data Set Identifier as
defined in clause 5.2.12.2.1, Target of Event Reporting as defined in clause
5.2.12.2, AF traffic influence request information.
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
#### 5.2.6.36 Nnef_UEAddress service
##### 5.2.6.36.1 General
See clause 6.2.8.2.4.3 of TS 23.288 [50].
##### 5.2.6.36.2 Nnef_UEAddress_Get operation
**Service operation name:** Nnef_UEAddress_Get
**Description:** Get the UE IP address (i.e. IPv4 address or IPv6 prefix).
**Inputs, Required:** GPSI, AF Identifier.
**Inputs, Optional:** None.
**Outputs, Required:** Result, UE address (i.e. IPv4 address or IPv6 prefix).
**Outputs, Optional:** None.
#### 5.2.6.37 Nnef_ECSAddress service
##### 5.2.6.37.1 General
**Service description:** The ECS Address service in the V-NEF provides
functions for ECS Address Configuration Information provision for a group of
UE or any UE from AF and for subscribing and retrieving ECS Address
Configuration Information and providing ECS Address Configuration Information
to the V-SMF to support. For related procedures see clauses 6.5.2.6.2 and
6.5.2.6.3 of TS 23.548 [74].
This procedure is defined only for the support of HR-SBO, i.e. where the ECS
Address is not associated with the subscription of an user of the PLMN
operating the V-NEF and V-SMF.
NOTE: There is thus no conflict with the usage of External Parameter
Provisioning procedure to configure ECS Address Configuration Information for
users of the PLMN operating the NEF and SMF.
##### 5.2.6.37.2 Nnef_ECSAddress_Create service operation
**Service operation name:** Nnef_ECSAddress_Create
**Description:** The NF consumer requests to create ECS Address Configuration
Information.
**Inputs, Required:** ECS Address Configuration Information.
**Inputs, Optional:** AF-service-identifier.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.37.3 Nnef_ECSAddress_Update service operation
**Service operation name:** Nnef_ECSAddress_Update
**Description:** The NF consumer requests to update ECS Address Configuration
Information.
**Inputs, Required:** ECS Address Configuration Information.
**Inputs, Optional:** AF-service-identifier, External Group Identifier.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.37.4 Nnef_ECSAddress_Delete service operation
**Service operation name:** Nnef_ECSAddress_Delete
**Description:** The NF consumer requests to delete ECS Address Configuration
Information.
**Inputs, Required:** Either:
\- AF-identifier;
\- S-NSSAI and DNN;
\- ECS Address Configuration Information.
**Inputs, Optional:** External Group Identifier.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.37.5 Nnef_ECSAddress_Subscribe service operation
**Service operation name:** Nnef_ECSAddress_Subscribe
**Description:** Provided by the NEF for NF consumers to explicitly subscribe
the notification of changes of ECS Address Configuration Information.
**Inputs, Required:** Event ID, Notification Target Address (+Notification
Correlation ID).
**Inputs, Optional:** DNN, S-NSSAI, Internal Group Identifier.
**Outputs, Required:** Result Indication. When the subscription is accepted:
Subscription Correlation ID (reference of the subscription).
**Outputs, Optional:** None.
##### 5.2.6.37.6 Nnef_ECSAddress_Unsubscribe service operation
**Service operation name:** Nnef_ECSAddress_Unsubscribe
**Description:** Provided by the NEF for NF consumers to explicitly
unsubscribe the notification of changes of ECS Address Configuration
Information.
**Inputs, Required:** Subscription Correlation ID (reference of the
subscription).
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
##### 5.2.6.37.7 Nnef_ECSAddress_Notify service operation
**Service operation name:** Nnef_ECSAddress_Notify
**Description:** Provides subscribed event information, e.g. updated ECS
Address Configuration Information to the NF Consumer.
**Inputs, Required:** Event ID, Notification Correlation ID, ECS Address
Configuration Information.
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
#### 5.2.6.38 Void
##### 5.2.6.38.1 General
**Service description:** This service allows SMF to notify 5GC determined
information for a set of UEs identified by Traffic Correlation ID to be,
stored in the UDR together with AF requests to influence traffic routing
information.
### 5.2.6A Void
### 5.2.7 NRF Services
#### 5.2.7.1 General
The following table shows the NRF Services and Service Operations:
Table 5.2.7.1-1: NF services provided by the NRF
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Nnrf | NFRegister | Re | AMF, SMF, UDM, | | _NFManagement | | quest/Response | AUSF, NEF, | | | | | PCF, SMSF, | | | | | NSSF, UPF, | | | | | BSF, CHF, | | | | | NWDAF, P-CSCF, | | | | | HSS, UDR, SCP, | | | | | 5G DDNMF, | | | | | DCCF, NSACF, | | | | | MB-SMF, AF | | | | | (NOTE 2), | | | | | TSCTSF, EASDF, | | | | | MFAF, ADRF, | | | | | DCSF, DCMF, | | | | | MRF, MRFP | +----------------+----------------+----------------+----------------+ | | NFUpdate | Re | AMF, SMF, UDM, | | | | quest/Response | AUSF, NEF, | | | | | PCF, SMSF, | | | | | NSSF, UPF, | | | | | BSF, CHF, | | | | | NWDAF, P-CSCF, | | | | | HSS, UDR, SCP, | | | | | 5G DDNMF, | | | | | DCCF, NSACF, | | | | | MB-SMF, | | | | | TSCTSF, EASDF, | | | | | MFAF, ADRF, | | | | | DCSF, DCMF, | | | | | MRF, MRFP | +----------------+----------------+----------------+----------------+ | | NFDeregister | Re | AMF, SMF, UDM, | | | | quest/Response | AUSF, NEF, | | | | | PCF, SMSF, | | | | | NSSF, UPF, | | | | | BSF, CHF, | | | | | NWDAF, P-CSCF, | | | | | HSS, UDR, SCP, | | | | | 5G DDNMF, | | | | | DCCF, NSACF, | | | | | MB-SMF, | | | | | TSCTSF, EASDF, | | | | | MFAF, ADRF, | | | | | DCSF, DCMF, | | | | | MRF, MRFP | +----------------+----------------+----------------+----------------+ | | NFS | Su | AMF, SMF, PCF, | | | tatusSubscribe | bscribe/Notify | NEF, NSSF, | | | | | SMSF, AUSF, | | | | | CHF, NRF, | | | | | NWDAF, I-CSCF, | | | | | S-CSCF, | | | | | IMS-AS, SCP, | | | | | UDM, TSCTSF, | | | | | DCCF | +----------------+----------------+----------------+----------------+ | | NFStatusNotify | | AMF, SMF, PCF, | | | | | NEF, NSSF, | | | | | SMSF, AUSF, | | | | | CHF, NWDAF, | | | | | I-CSCF, | | | | | S-CSCF, | | | | | IMS-AS, SCP, | | | | | UDM, TSCTSF, | | | | | DCCF | +----------------+----------------+----------------+----------------+ | | NFSta | | AMF, SMF, PCF, | | | tusUnSubscribe | | NEF, NSSF, | | | | | SMSF, AUSF, | | | | | CHF, NRF, | | | | | NWDAF, I-CSCF, | | | | | S-CSCF, | | | | | IMS-AS, SCP, | | | | | UDM, TSCTSF, | | | | | DCCF | +----------------+----------------+----------------+----------------+ | Nnr | Request | Re | AMF, SMF, PCF, | | f_NFDiscovery | | quest/Response | NEF, NSSF, | | | | | SMSF, AUSF, | | | | | CHF, NRF, | | | | | NWDAF, I-CSCF, | | | | | S-CSCF, | | | | | IMS-AS, SCP, | | | | | UDM, AF | | | | | (NOTE 2), | | | | | DCCF, MBSF, 5G | | | | | DDNMF, TSCTSF, | | | | | MRF | +----------------+----------------+----------------+----------------+ | Nnr | Get | Re | AMF, SMF, PCF, | | f_AccessToken | | quest/Response | NEF, NSSF, | | | | | SMSF, AUSF, | | | | | UDM, NWDAF, | | | | | I-CSCF, | | | | | S-CSCF, | | | | | IMS-AS, HSS, | | | | | DCCF | +----------------+----------------+----------------+----------------+ | Nnrf\ | Get | Re | NRF, any NF or | | _Bootstrapping | | quest/Response | SCP | +----------------+----------------+----------------+----------------+
NOTE 1: HSS_IMS services are defined in TS 23.228 [55].
NOTE 2: The AF is a trusted AF by an operator.
#### 5.2.7.2 Nnrf_NFManagement service
##### 5.2.7.2.1 General
**Service description:** This service enables one NF to manage its NF profile
in NRF (i.e. register, update, deregister). This service also allows a
consumer NF or SCP to subscribe in NRF to receive notifications regarding
changes in the NF profile of other NFs.
##### 5.2.7.2.2 Nnrf_NFManagement_NFRegister service operation
**Service Operation name:** Nnrf_NFManagement_NFRegister.
**Description:** Registers the consumer NF in the NRF by providing the NF
profile of the consumer NF to NRF and NRF marks the consumer NF available.
**Inputs, Required:** NF type, NF instance ID, FQDN or IP address of NF, Names
of supported NF services (if applicable) and PLMN ID e.g. if NF needs to be
discovered by other PLMNs/SNPNs.
NOTE 1: for the UPF, the addressing information within the NF profile
corresponds to the N4 interface.
NOTE 2: For the purpose of the Nnrf_NFManagement service, the SCP is treated
by the NRF in the same way as NFs. Specifically, the SCP is designated with a
specific NF type and NF instance ID. However, the SCP does not support
services and related NF profile parameters do not apply (e.g. NF Set ID, NF
service set ID, Endpoint Address(es) of instance(s) of supported service(s)),
see clause 6.2.6.3 of TS 23.501 [2].
**Inputs, Optional:**
\- If the consumer NF stores Data Set(s) (e.g. UDR): Range(s) of SUPIs,
range(s) of GPSIs, range(s) of external group identifiers, Data Set
Identifier(s).
\- If the consumer is BSF: Range(s) of SUPIs, range(s) of GPSIs, Range(s) of
(UE) IPv4 addresses or Range(s) of (UE) IPv6 prefixes, IP domain list as
described in clause 6.1.6.2.21 of TS 29.510 [37], Range(s) of SUPIs, range(s)
of GPSIs.
NOTE 3: Range of SUPI(s) is limited in this release to a SUPI type of IMSI as
defined in TS 23.003 [33].
\- If the consumer is UDM, UDR, PCF, BSF or AUSF, they can include UDM Group
ID, UDR Group ID, PCF Group ID, BSF Group ID, AUSF Group ID respectively.
\- For UDM and AUSF, Routing Indicator, or Routing Indicator and Home Network
Public Key identifier; Home Network Identifier: PLMN ID in the case of PLMN,
PLMN ID + NID in the case of SNPN. Optionally, some NFs may additionally
include a Home Network Identifier (including the identification of the CH with
AAA Server or DCS with AAA Server) in the form of a realm e.g. in the case of
access to an SNPN using credentials owned by CH with AAA Server or in the case
of SNPN Onboarding using a DCS with AAA Server.
\- For NSSAAF, Home Network Identifier in the form of a realm e.g. in the case
of access to an SNPN using credentials owned by CH with AAA Server or in the
case of SNPN Onboarding using credentials from a DCS with AAA Server.
\- If the consumer is AMF, it includes list of GUAMI(s). In addition, AMF may
include list of GUAMI(s) for which it can serve as backup for
failure/maintenance.
\- If the consumer is CHF, it may include Range(s) of SUPIs, Range(s) of
GPSIs, or Range(s) of PLMNs as defined in TS 32.290 [42].
\- If the consumer is CHF, primary CHF instance and the secondary CHF instance
pair. If the CHF does not provide NF set ID or NF Service Set ID, it shall
provide a primary CHF instance and the secondary CHF instance pair and
otherwise it may do so.
\- If the consumer is P-CSCF, the P-CSCF IP address(es) to be provided to the
UE by SMF.
\- If the consumer is HSS, IMPI range, IMPU range, HSS Group ID (as defined in
TS 23.228 [55]) can be used as optional input parameters.
\- For the UPF Management: UPF Provisioning Information as defined in clause
4.17.6.
\- S-NSSAI(s) and the associated NSI ID(s) (if available).
\- DNN(s) if the consumer is PCF or BSF. DNN(s) per S-NSSAI if the consumer is
SMF, UPF or TSCTSF.
\- If the consumer is a trusted AF it may include one or multiple
combination(s) of S-NSSAI and DNN corresponding to the AF. In addition, it may
include supported Application Id(s), Event ID(s) and Internal-Group
Identifier. It may include an indication whether it supports mapping between
UE IP address (IPv4 address or IPv6 prefix) and UE ID (i.e. SUPI).
\- Information about the location of the NF consumer (operator specific
information, e.g. geographical location, data centre).
\- TAI(s).
\- NF Set ID.
\- NF Service Set ID.
\- If the consumer is PCF or SMF, it includes the MA PDU Session capability to
indicate if the NF instance supports MA PDU session or not.
\- If the consumer is PCF, it includes the DNN replacement capability to
indicate if the NF instance supports DNN replacement or not.
\- If the consumer is PCF or SMF, it includes the slice replacement capability
to indicate if the NF instance supports slice replacement or not.
\- If the consumer is PCF, it may include the 5G ProSe Capability as specified
in TS 23.304 [77].
\- If the consumer is PCF, it may include the V2X capability as specified in
TS 23.287 [73].
\- If the consumer is PCF, it may include the A2X capability as specified in
TS 23.256 [80].
\- If the consumer is NWDAF, it may include:
\- Analytics ID(s) (possibly per service).
\- NWDAF Serving Area information and Supported Analytics Delay per Analytics
ID(s) (if available).
\- Analytics aggregation capability and/ or Analytics metadata provisioning
capability if such capability is provided by the NWDAF.
\- Roaming exchange capability if such capability is provided by NWDAF.
\- If the consumer NWDAF contains MTLF, it may also include the ML model
Filter information parameters S-NSSAI(s) and Area(s) of Interest for the
trained ML model(s) per Analytics ID(s) and ML Model Interoperability
indicator per Analytics ID(s), if available (see clause 5.2 of TS 23.288
[50]).
\- If the consumer is NWDAF containing MTLF with Federated Learning (FL)
capability, it includes FL capability information per analytics ID containing
FL capability type (i.e. FL client, FL server, if available) and Time interval
supporting FL, if available (see clause 5.2 of TS 23.288 [50]).
\- If the consumer is NWDAF containing MTLF with ML Model Accuracy checking
capability, it includes ML Model Accuracy checking capability for ML model
accuracy monitoring (see clause 5.2 of TS 23.288 [50]).
\- If the consumer is NWDAF containing AnLF with Analytics Accuracy checking
capability, it includes Analytics Accuracy checking capability for Analytics
Accuracy Monitoring (see clause 5.2 of TS 23.288 [50]).
\- It may also include NF Set ID and NF Type of the NF data sources, if data
management service is available.
Details about NWDAF specific information are described in clause 6.3.13 of TS
23.501 [2].
\- If the consumer is ADRF, it may include:
\- Data and analytics storage and retrieval capability if available.
\- ML model storage and retrieval capability if available.
Details about ADRF specific information are described in clause 6.3.20 of TS
23.501 [2].
\- If the consumer is NEF, it may include Event ID(s) supported by AFs, the
S-NSSAI and DNN corresponding to the untrusted AF served by the NEF,
Application Identifier(s) supported by AFs, range(s) of External Identifiers,
or range(s) of External Group Identifiers, or the domain names served by the
NEF. It may also include an indication whether the untrusted AF supports
mapping between UE IP address (IPv4 address or IPv6 prefix) and external UE ID
(i.e. GPSI). If the consumer is local NEF, it may include parameters of list
of supported TAI or list of supported DNAI additionally.
\- If the consumer is NSACF, it includes S-NSSAI(s) of the NSACF located
network and served by NSACF for which it manages the NSAC NSACF Serving Area
information and NSACF service capabilities. Details about NSACF Service Area
information and NSACF service capabilities are described in clause 6.3.22 of
TS 23.501 [2].
\- Notification endpoint for default subscription for each type of
notification that the NF is interested in receiving.
\- Endpoint Address(es) of instance(s) of supported service(s).
\- NF capacity information.
\- NF priority information.
\- If consumer is NF, SCP domain the NF belongs to.
\- If the consumer is SCP, it may include:
\- SCP domain(s) the SCP belongs to.
\- Remote PLMNs reachable through SCP.
\- Endpoint addresses or Address Domain(s) (e.g. IP Address or FQDN ranges)
accessible via the SCP.
\- NF sets of NFs served by the SCP.
\- If the consumer NF is MB-SMF, it may include MB-SMF service area and the
MBS Session ID(s), Area Session ID(s), the corresponding MBS service area(s)
if available, as specified in TS 23.247 [78].
\- If the consumer is DCCF, the request may include DCCF Serving Area
information, NF type of the NF data source, NF Set ID of the NF data sources,
support for relocation of data subscription. Details about DCCF discovery and
selection are described in clause 6.3.19 of TS 23.501 [2].
\- If the consumer is EASDF, it may include S-NSSAI, DNN, N6 IP address of the
PSA UPF, location as per NF profile and DNAI (if exists).
\- For ON-SNPN, if the consumer is AMF, Capability to support SNPN Onboarding,
or, if the consumer is SMF, Capability to support User Plane Remote
Provisioning.
\- If the consumer is NEF, it may include the support for UAS NF
functionality, the capability to support Multi-member AF session with required
QoS and the capability to support member UE selection assistance
functionality.
\- If the consumer is UPF and UPF can expose NAT information, it may include
the range of IP addresses the NAT uses towards the DN (e.g. public IP
addresses). This IP address range may be on a per IP domain, DNN and S-NSSAI.
\- If the consumer is DCSF, it may include an IMS domain name or a list of IMS
domain names it serves, IMPU range of calling identity or called identity it
serves, or IMPI range it serves.
\- If the consumer is MF, it includes the data channel media capabilities it
supports. It may also include MF location information as specified in TS
23.228 [55].
\- If the consumer is MRF or MRFP, it includes the list of supported IMS media
services (as defined in TS 23.228 [55]).
**Outputs, Required:** Result indication.
**Outputs, Optional:** None.
See clause 5.21.2.1 of TS 23.501 [2], the AMF registers itself to NRF.
##### 5.2.7.2.3 Nnrf_NFManagement_NFUpdate service operation
**Service Operation name:** Nnrf_NFManagement_NFUpdate.
**Description:** Provides the updated NF profile of NF consumer to NRF.
**Inputs, Required:** NF instance ID.
**Inputs, Optional:** If replacing the full NF profile, the full NF profile
shall be provided. If updating parts of the NF profile, the NF profile
elements that needs to be updated shall be provided.
**Outputs, Required:** Result indication.
**Outputs, Optional:** None.
See clause 5.21.2.1 of TS 23.501 [2], the AMF adds or updates the associated
GUAMI(s).
##### 5.2.7.2.4 Nnrf_NFManagement_NFDeregister service operation
**Service Operation name:** Nnrf_NFManagement_NFDeregister
**Description:** Inform the unavailability of NF consumer to NRF.
**Inputs, Required:** NF Instance ID, Reason indication.
**Inputs, Optional:** None.
**Outputs, Required:** Result indication.
**Outputs, Optional:** None.
See clause 5.21.2.2 of TS 23.501 [2], the AMF deregister itself from NRF.
##### 5.2.7.2.5 Nnrf_NFManagement_NFStatusSubscribe service operation
**Service Operation name:** Nnrf_NFManagement_NFStatusSubscribe.
**Description:** Consumer can subscribe to be notified of the following:
\- Newly registered NF along with its NF services.
\- Updated NF profile.
\- Deregistered NF.
**Inputs, Required:** callback URI.
**Inputs, Optional:**
\- PLMN ID of the target NF/NF service, in the case of the subscription to the
status of NF/NF service instance(s) in home PLMN from the serving PLMN, or
PLMN ID and NID in the case of SNPN (see clause 5.30.2.9.3 of TS 23.501 [2]).
\- Home Network Identifier: PLMN ID in the case of PLMN, PLMN ID + NID in the
case of SNPN. Optionally, some NFs may additionally include a Home Network
Identifier (including the identification of the CH with AAA Server or DCS with
AAA Server) in the form of a realm e.g. in the case of access to an SNPN using
credentials owned by CH with AAA Server or in the case of SNPN Onboarding
using a DCS with AAA Server.
\- Validity Time, in case to indicate the time instant after which the
subscription becomes invalid.
\- For updated NF profile subscription, conditions that trigger a notification
from NRF. Includes monitored attributes in the NF profile (changes trigger a
notification) or unmonitored attributes in the NF profile (changes do not
trigger a notification)
\- The following parameters are mutually exclusive:
\- NF Type (if NF status of a specific NF type is to be monitored).
\- NF Instance ID or NF Instance ID list (if NF status of a specific NF
instance or a list of NF instance is to be monitored).
\- NF Service name (if NF status for NF which exposes a given NF service is to
be monitored).
\- NF Set (if NF status of a set of NF Instances belonging to a certain NF Set
is to be monitored).
\- NF Service Set (if the status of a set of NF Service Instances belonging to
a certain NF Service Set is to be monitored).
\- NF Group (if the NF status of NF Instances identified by a NF (UDM, AUSF,
PCF, BSF, CHF, HSS or UDR) Group Identity is to be monitored).
\- SCP Domain (if the status of NF or SCP instances belonging to a certain SCP
domain is to be monitored).
\- For the UPF Management defined in clause 4.17.6: UPF Provisioning
Information as defined in that clause.
\- For AMF, Consumer may include list of GUAMI(s), or AMF Set or AMF Region,
or TAIs.
\- For SMF, Consumer may include list of TAIs.
\- S-NSSAI(s) and the associated NSI ID(s) (if available).
\- For NWDAF, Consumer may include:
\- Analytics ID(s) (possibly per service).
\- TAI(s).
\- NF Set ID, NF Type of NF data sources.
\- Analytics aggregation capability and/or Analytics metadata provisioning
capability.
\- ML Model Accuracy checking capability.
\- Analytics Accuracy checking capability.
\- Roaming exchange capability.
\- For NWDAF containing MTLF, Consumer may also include the ML model Filter
information parameters S-NSSAI(s) and Area(s) of Interest for the trained ML
model(s) per Analytics ID(s) and ML Model Interoperability indicator per
Analytics ID(s), if available (see clause 5.2 of TS 23.288 [50]).
\- For NWDAF containing MTLF with Federated Learning (FL) capability, Consumer
may include FL capability type (i.e. FL client, FL server, if available), Time
Period of Interest, if available (see clause 5.2 of TS 23.288 [50]).
Details about NWDAF discovery and selection are described in clause 6.3.13 of
TS 23.501 [2].
\- For ADRF, Consumer may include:
\- Data and analytics storage and retrieval capability.
\- ML model storage and retrieval capability.
\- For NEF, Consumer may include Event ID(s) provided by AF.
\- For DCCF, Consumer may include:
\- TAI(s).
\- NF type of the NF data sources.
\- NF Set ID of the NF data sources.
\- Support for relocation of data subscription.
Details about NWDAF discovery and selection are described in clause 6.3.19 of
TS 23.501 [2].
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID (required for management of this subscription), Validity Time.
**Outputs, Optional:** None.
NOTE: Alternatively, other means such as OA&M can also be used to subscribe
for NF status.
##### 5.2.7.2.6 Nnrf_NFManagement_NFStatusNotify service operation
**Service Operation name:** Nnrf_NFManagement_NFStatusNotify.
**Description:** NRF notifies subscribed consumers of the following:
\- Newly registered NF along with its NF services.
\- Updated NF profile.
\- Deregistered NF.
**Inputs, Required:** Notification Event type; NF instance ID; for newly
registered NF, NF profile; for updated NF, NF profile or NF profile changes.
NOTE: See clause 6.1.6.3.6 of TS 29.510 [37] for the detailed use of
Notification Event type.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.7.2.7 Nnrf_NFManagement_NFStatusUnsubscribe service operation
**Service Operation name:** Nnrf_NFManagement_NFStatusUnsubscribe
**Description:** Consumer can unsubscribe from being notified of newly
registered NF along with its NF services and other events types described in
the Nnrf_NFManagement_NFStatusSubscribe service operation (see clause
5.2.7.2.5).
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
NOTE: Alternatively, other means such as OA&M can also be used to unsubscribe
for NF status.
#### 5.2.7.3 Nnrf_NFDiscovery service
##### 5.2.7.3.1 General
**Service description:** This service enables one NF or SCP to discover a set
of NF instances with specific NF service or a target NF type or one or more
SCPs. The service also enables one NF service or SCP to discover a specific NF
service. The service operations defined below allow the NF/NF services or SCP
to communicate with NRF.
This service also enables an SCP to discover SCPs.
NOTE: For the purpose of the Nnrf_NFDiscovery service, the SCP is treated in
the same way as NFs. It is designated with a specific NF type. However, the
SCP does not support services.
##### 5.2.7.3.2 Nnrf_NFDiscovery_Request service operation
**Service operation name:** Nnrf_NFDiscovery_Request
**Description:** provides the IP address or FQDN of the expected NF
instance(s) and if present in NF profile, the Endpoint Address(es) of NF
service instance(s) to the NF service consumer or SCP.
**Inputs, Required:** one or more target NF service Name(s), NF type of the
target NF, NF type of the NF service consumer.
If the NF service consumer intends to discover an NF service producer
providing all the standardized services, it provides a wildcard NF service
name.
**Inputs, Optional:**
\- S-NSSAI and the associated NSI ID (if available), DNN, target NF/NF service
PLMN ID (or realm in the case of network specific identifier type SUCI/SUPI,
see clause 4.17.5a), NRF to be used to select NFs/services within HPLMN or
Credentials Holder, Serving PLMN ID (or PLMN ID and NID in the case of SNPN,
see clause 4.17.5a), the NF service consumer ID, preferred target NF location,
TAI.
NOTE 1: For network slicing the NF service consumer ID is a required input.
\- FQDN for the S5/S8 interface of the SMF+PGW-C, to discover the N11/N16
interface of the SMF+PGW-C in the case of EPS to 5GS mobility.
\- If the target NF stores Data Set(s) (e.g. UDR, BSF): SUPI, GPSI, IMPI,
IMPU, Data Set Identifier(s). (UE) IPv4 address, IP domain or (UE) IPv6
Prefix.
NOTE 2: GPSI is relevant for BSF.
NOTE 3: If the request includes a subscriber identifier the NRF may need to
use the association between the supplied subscriber identifier and the
appropriate NF Group ID as described in clause 6.3.1 of TS 23.501 [2] to
determine the applicable set of NF instances for the response.
NOTE 4: The (UE) IPv4 address or (UE) IPv6 Prefix is provided for BSF
discovery: in that case the NRF looks up for a match within one of the
Range(s) of (UE) IPv4 addresses or Range(s) of (UE) IPv6 prefixes provided by
BSF(s) as part of the invocation of Nnrf_NFManagement_NFRegister operation.
The NRF is not meant to store individual (UE) IPv4 addresses or (UE) IPv6
prefixes.
\- If the target NF is UDM or AUSF, the request may include the UE\'s Routing
Indicator, or the UE\'s Routing Indicator and Home Network Public Key
identifier.
\- If the target UDM or NF is AUSF, the request may include the UE\'s HNI:
PLMN ID in the case of PLMN, PLMN ID + NID in the case of SNPN. Optionally,
some NFs may additionally include a Home Network Identifier in the form of a
realm e.g. in the case of access to an SNPN using credentials owned by CH with
AAA Server or in the case of SNPN Onboarding using a DCS with AAA Server.
\- If the target NF is NSSAAF, the request may include Home Network Identifier
in the form of a realm e.g. in the case of access to an SNPN using credentials
owned by CH with AAA Server or in the case of SNPN Onboarding using
credentials from a DCS with AAA Server.
\- If the target NF is AMF and the consumer NF is MB-SMF for broadcast
service, the request includes TAI(s) (see clause 7.3 of TS 23.247 [78]).
\- If the target NF is AMF and the consumer NF is other than MB-SMF, the
request may include:
\- AMF region, AMF Set, GUAMI and Target TAI(s).
\- If the target NF is UDR or UDM or AUSF or PCF or BSF, the request may
include UDR Group ID or UDM Group ID or AUSF Group ID or PCF Group ID or BSF
Group ID respectively.
NOTE 5: It is assumed that the corresponding NF service consumer is either
configured with the corresponding Group ID or it received it via earlier
Discovery output.
\- If the target NF is UDM, the request may include SUPI, GPSI, Internal Group
ID and External Group ID.
\- If the target NF is UPF, the request may include SMF Area Identity, UE IPv4
Address/IPv6 Prefix, supported ATSSS steering functionality, the supported UPF
event exposure service and the supported Event IDs that can be subscribed. And
if UPF can expose NAT information, the UE IPv4 address/IPv6 Prefix seen by the
DN (e.g. a Public IP address).
NOTE 6: If UE\'s IPv4 address or IPv6 Prefix is provided for UPF discovery,
then the NRF looks up for a match within one of the Range(s) of IPv4 addresses
or IPv6 prefixes provided by UPF in the NF profile at the invocation of
Nnrf_NFManagement_NFRegister operation. The NRF is not meant to store the
UE\'s individual IPv4 addresses or IPv6 prefixes.
NOTE 7: Discovering UPF at PDU Session Establishment time and creating the N4
association assumes full connectivity between SMF and UPFs.
\- If the target NF is CHF, the request may include SUPI or GPSI as specified
in TS 32.290 [42].
\- If the target NF is PCF or SMF, the request may include the MA PDU Session
capability to indicate that a NF instance supporting MA PDU session capability
is requested.
\- If the target NF is PCF, the request may include the DNN replacement
capability to indicate that a NF instance supporting DNN replacement
capability is preferred.
\- If the target NF is PCF or SMF, the request may include the slice
replacement capability to indicate that a NF instance supporting slice
replacement capability is preferred.
\- If the target NF is PCF, the request may include the 5G ProSe Capability as
specified in TS 23.304 [77].
\- If the target NF is PCF, the request may include the V2X capability as
specified in TS 23.287 [73].
\- If the target NF is PCF, the request may include the A2X capability as
specified in TS 23.256 [80].
\- If the target NF is NWDAF, the request may include:
\- Analytics ID(s) (possibly per service).
\- TAI(s).
\- Analytics aggregation capability and/or Analytics metadata provisioning
capability.
\- A Real-Time Communication Indication per Analytics ID, NF Set ID and NF
Type of the NF data sources.
\- Roaming exchange capability if data/analytics exchange between PLMNs is
needed.
\- The S-NSSAI(s), Area(s) of Interest of the Trained ML Model required and NF
consumer information when the target is an NWDAF containing MTLF.
\- Required FL capability type (i.e. FL server, FL client, if available) and
Time period of interest when the target is an NWDAF containing MTLF with FL
capability.
\- If the target NF is NWDAF containing MTLF with ML Model Accuracy checking
capability, it includes ML Model Accuracy checking capability for ML model
Accuracy Monitoring (see clause 5.2 of TS 23.288 [50]).
\- If the target NF is NWDAF containing AnLF with Analytics Accuracy checking
capability, it includes Analytics Accuracy checking capability for Analytics
Accuracy Monitoring (see clause 5.2 of TS 23.288 [50]).
Details about NWDAF discovery and selection are described in clause 6.3.13 of
TS 23.501 [2].
NOTE 8: Analytics metadata provisioning capability is only applicable when NF
service consumer is NWDAF.
NOTE 9: NF consumer information such as vendor ID is defined in stage 3.
\- If target NF is ADRF, the request may include:
\- Data and analytics storage and retrieval capability.
\- ML model storage and retrieval capability.
Details about ADRF discovery and selection are described in clause 6.3.20 of
TS 23.501 [2].
\- If the target NF is HSS, the request may include IMPI and/or IMPU and/or
HSS Group ID.
\- If the NF service consumer needs to discover NF service producer
instance(s) within an NF instance, the request includes the target NF Instance
ID and NF Service Set ID of the producer.
\- If the NF service consumer needs to discover NF service producer
instance(s) in an equivalent NF Service Set within an NF Set, the request
includes the identification of the equivalent NF service Set and NF Set ID of
producer.
NOTE 10: TS 29.510 [37] specifies the mechanism to identify equivalent NF
Service Sets.
\- If the NF service consumer needs to discover NF service producer
instance(s) in the NF Set, the request includes the target NF Set ID of the
producer.
\- If the target NF is SMF, the request may include:
\- the UE location (TAI); or
\- TAI list.
\- If the target NF is P-CSCF, the request may include UE location
information, UE IP address/IP prefix, Access Type.
\- If the target NF is NEF, the request may include Event ID(s) provided by AF
and optional AF identification as described in clause 6.2.2.3 of TS 23.288
[50]. When the consumer is an AF, the request may include an External
Identifier, External Group Identifier, or a domain name. If the target NF is
local NEF, the request may include the parameters of list of supported TAI or
list of supported DNAI additionally.
\- If the target NF is SMF, the request may include the Control Plane CIoT 5GS
Optimisation Indication or User Plane CIoT 5GS Optimisation Indication.
\- If the target NF is NSACF, the request may include S-NSSAI(s) of the NSACF
located network and served by NSACF, NSACF Serving Area information and NSACF
service capability. Details about NSACF discovery and selection are described
in clause 6.3.22 of TS 23.501 [2].
\- If the target NF is SCP, the request may include information about:
\- SCP domain(s).
\- Remote PLMN reachable through SCP.
\- Endpoint addresses or Address Domain(s) (e.g. IP Address or FQDN ranges)
accessible via the SCP.
\- NF sets of NFs served by the SCP.
\- If the target NF is MB-SMF, the request may include UE location (i.e. TAI),
MBS Session ID and Area Session ID. Details about MB-SMF discovery and
selection are described in TS 23.247 [78].
\- If the target NF is 5G DDNMF, the request may include SUPI, IP Address or
FQDN of 5G DDNMF.
\- If the target NF is DCCF, the request may include TAI(s), NF type of the NF
data sources, NF Set ID of the NF data sources, support for relocation of data
subscription. Details about DCCF discovery and selection are described in
clause 6.3.19 of TS 23.501 [2].
\- If the target NF is EASDF, the request may include S-NSSAI, DNN, N6 IP
address of the PSA UPF, location as per NF profile and DNAI(if exist). Details
about EASDF discovery and selection are described in clause 6.3.23 of TS
23.501 [2].
\- If the target NF is AMF, the request may include the support of SNPN
Onboarding to indicate whether the target NF instance supports SNPN Onboarding
or not.
\- If the target NF is SMF, the request may include the support of User Plane
Remote Provisioning to indicate whether the target NF instance supports User
Plane Remote Provisioning or not as described in clause 5.30.2.10.4.3 of TS
23.501 [2].
\- If the target NF is NEF, the request may include the support of UAS NF
functionality, the capability to support Multi-member AF session with required
QoS and the capability to support member UE selection assistance
functionality.
\- If the target NF is NSSAAF, the request may include SUPI or Internal Group
ID.
\- If the target NF is DCSF, the request may include IMPU of calling party,
SIP URI or Tel URI of called party.
\- If the target NF is MF, the request may include the list of required data
channel media capabilities or MF location information as specified in TS
23.228 [55].
\- If the target NF is MRF or MRFP, it includes the list of required IMS media
services (as defined in TS 23.228 [55]).
**Outputs, Required:** A set of NF instances, a validity period for the
discovery result, containing per NF Instance: NF type, NF instance ID, FQDN or
IP address(es) of the NF instance and if applicable, a list of services
instances, where each service instance has a service name, a NF service
instance ID and optionally Endpoint Address(es)
Endpoint Address(es) may be a list of IP addresses or an FQDN for the NF
service instance.
NOTE 11: SCPs does not have any service instances.
**Outputs, Optional:** Per NF instance, other information in the NF profile
listed in clause 6.2.6 of TS 23.501 [2] related to the NF instance, such as:
\- NF load information.
\- NF capacity information.
\- NF priority information.
\- If the target NF stores Data Set(s) (e.g. UDR): Range(s) of SUPIs, range(s)
of GPSIs, range(s) of external group identifiers, Data Set Identifier(s). If
the target NF is BSF or P-CSCF: Range(s) of (UE) IPv4 addresses or Range(s) of
(UE) IPv6 prefixes, Range(s) of SUPIs, range(s) of GPSIs.
NOTE 12: Range of SUPI(s) is limited in this release to a SUPI type of IMSI as
defined in TS 23.003 [33].
\- If the target NF is UDM, UDR, PCF, BSF or AUSF, they can include UDM Group
ID, UDR Group ID, PCF Group ID, BSF Group ID, AUSF Group ID respectively.
\- If the target NF is HSS, it can include HSS Group ID.
\- For UDM and AUSF, Routing Indicator, or Routing Indicator and Home Network
Public Key identifier.
\- If the target NF is AMF, it includes list of GUAMI(s). In addition, it may
include list of GUAMI(s) for which it can serve as backup for
failure/maintenance.
\- If the target NF is CHF, it includes primary CHF instance and the secondary
CHF instance pair(s), if configured in CHF instance profile.
\- For the UPF Management: UPF Provisioning Information as defined in clause
4.17.6.
\- S-NSSAI(s) and the associated NSI ID(s) (if available).
\- Information about the location of the target NF (operator specific
information, e.g. geographical location, data centre).
\- TAI(s).
\- PLMN ID.
\- If the target is PCF or SMF, it includes the MA PDU Session capability to
indicate if the NF instance supports MA PDU session or not.
\- If the target is PCF, it includes the DNN replacement capability to
indicate if the NF instance supports DNN replacement or not.
\- If the target NF is NWDAF, it may include:
\- Analytics ID(s) (possibly per service).
\- NF Set ID and NF Type of the NF data sources, if available, NWDAF Serving
Area information.
\- Analytics aggregation capability and/ or Analytics metadata provisioning
capability, if such capability is provided by the NWDAF.
\- Supported Analytics Delay per Analytics ID.
\- If the target NF is NWDAF, it may also include the ML model Filter
information parameters S-NSSAI(s) and Area(s) of Interest for the trained ML
model(s) per Analytics ID(s) and ML Model Interoperability indicator per
Analytics ID(s), if available (see clause 5.2 of TS 23.288 [50]).
\- If the target NF is NWDAF with FL capability, it may also include FL
capability information per analytics ID containing FL capability type (i.e. FL
server, FL client, if available) and Time interval supporting FL, if available
(see clause 5.2 of TS 23.288 [50]).
Details about NWDAF specific information are described in clause 6.3.13 of TS
23.501 [2].
NOTE 13: The Supported Analytics Delay is provided for an Analytics ID only
when the NRF had received Real-Time Communication Indication for this
Analytics ID in the NWDAF discovery request.
\- If the target is a trusted AF, it includes one or multiple combination(s)
of the S-NSSAI and DNN corresponding to the AF. In addition, it may include
supported Application Id(s), Event ID(s) supported by the AF and Internal-
Group Identifier.
\- NF Set ID.
\- NF Service Set ID.
\- If the target NF is SMF, it may include the SMF(s) Service Area.
NOTE 14: If no SMF Service Area is provided, the AMF assumes that a SMF can
serve the whole PLMN.
\- If the target NF is P-CSCF, it includes P-CSCF FQDN(s) or IP address(es)
and optional Access Type(s) associated with each P-CSCF.
\- If the target NF is NEF, it may include Event ID(s) provided by AF and/or
it includes one or multiple combination(s) of the S-NSSAI and DNN
corresponding to the untrusted AF served by the NEF.
\- SCP domain the NF belongs to.
NOTE 15: Only one SCP domain is registered in NF profile for an NF.
\- If the target is SCP:
\- SCP domain(s).
\- Remote PLMNs reachable through SCP.
\- Endpoint addresses or Address Domain(s) (e.g. IP Address or FQDN ranges)
accessible via the SCP.
\- NF sets of NFs served by the SCP.
\- If the target NF is 5G DDNMF, it may include IP Address or FQDN of 5G
DDNMF.
\- If the target NF is MB-SMF, it may include the MBS Session ID(s), Area
Session ID(s), corresponding MBS service area(s) as described in TS 23.247
[78].
\- If the target NF is DCCF, it includes DCCF serving area information, NF
type of the NF data sources, NF Set ID of the NF data sources, support for
relocation of data subscription. Details about DCCF specific information are
described in clause 6.3.19 of TS 23.501 [2].
See clause 4.17.4 and 4.17.5 for details on the usage of this service
operation.
#### 5.2.7.4 Nnrf_AccessToken_service
##### 5.2.7.4.1 General
This service provides OAuth2 2.0 Access Tokens for NF to NF authorization as
defined in TS 33.501 [15].
##### 5.2.7.4.2 Nnrf_AccessToken_Get Service Operation
See TS 33.501 [15].
#### 5.2.7.5 Nnrf_Bootstrapping service
##### 5.2.7.5.1 General
Service Description: The Nnrf_Bootstrapping service lets NF Service Consumers
of the NRF know about the services endpoints it supports, the NRF Instance ID
and NRF Set ID if the NRF is part of an NRF set, by using a version-
independent URI endpoint that does not need to be discovered by using a
Discovery service
##### 5.2.7.5.2 Nnrf_Bootstrapping_Get service operation
**Service operation name:** Nnrf_Bootstrapping_Get
**Description:** Get the NRF service instances, their addresses and associated
data.
**Inputs, Required:** None.
**Inputs, Optional:** None.
**Outputs, Required:** NRF service instances and their endpoint addresses.
**Outputs, Optional:** NF Set ID, NFR instance ID, Oath2 requirement for
authorization, NFR status.
### 5.2.8 SMF Services
#### 5.2.8.1 General
The following table shows the SMF Services and SMF Service Operations.
Table 5.2.8.1-1: NF services provided by the SMF
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Ns | Create | Re | V-SMF/I-SMF | | mf_PDUSession | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | V-SMF/I-SMF, | | | | quest/Response | H-SMF | +----------------+----------------+----------------+----------------+ | | Release | Re | V-SMF/I-SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | C | Re | AMF | | | reateSMContext | quest/Response | | +----------------+----------------+----------------+----------------+ | | U | Re | AMF | | | pdateSMContext | quest/Response | | +----------------+----------------+----------------+----------------+ | | Re | Re | AMF | | | leaseSMContext | quest/Response | | +----------------+----------------+----------------+----------------+ | | SMConte | Su | AMF | | | xtStatusNotify | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | StatusNotify | Su | V-SMF/I-SMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | ContextRequest | Re | AMF, | | | | quest/Response | V-SMF/I-SMF, | | | | | SMF | +----------------+----------------+----------------+----------------+ | | ContextPush | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | SendMOData | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | TransferMOData | Re | V-SMF/I-SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | TransferMTData | Re | SMF, H-SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | Nsmf\ | Subscribe | Su | NEF, AMF, | | _EventExposure | | bscribe/Notify | NWDAF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | NEF, AMF, | | | | | NWDAF | +----------------+----------------+----------------+----------------+ | | Notify | | NEF, AMF, | | | | | NWDAF | +----------------+----------------+----------------+----------------+ | | App | | AF | | | RelocationInfo | | | +----------------+----------------+----------------+----------------+ | Nsmf_NIDD | Delivery | Re | NEF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | Nsmf_Traf | Notify | Su | NEF | | ficCorrelation | | bscribe/Notify | | +----------------+----------------+----------------+----------------+
#### 5.2.8.2 Nsmf_PDUSession Service
##### 5.2.8.2.1 General
**Service description:** This service operates on the PDU Sessions. The
following are the key functionalities of this NF service:
\- (between AMF and SMF) Creation / Deletion / Modification of AMF-SMF
interactions for PDU Sessions;
The resource handled between AMF and SMF via Create / Update / Release SM
context operations corresponds to the AMF-SMF association for a PDU Session;
When the AMF has got no association with an SMF to support a PDU Session, the
AMF creates such association via the Nsmf_PDUSession_CreateSMContext
operation. The context created is identified via the SM Context ID. Otherwise
(e.g. at hand-over between 3GPP and Non 3GPP access) the AMF uses the
Nsmf_PDUSession_UpdateSMContext operation.
NOTE 1: In TS 29.502 [36] SM Context ID is referred to as smContextRef for N11
and pduSessionRef and pduSessionUri for N16.
When the UE is handed-over from an (old) AMF towards another (new) AMF, the
old AMF provides the new AMF with the SMF addressing information corresponding
to the AMF-SMF association related with each PDU Session of that UE. The new
AMF can thus further act upon the association with the SMF via
Nsmf_PDUSession_UpdateSMContext and Nsmf_PDUSession_ReleaseSMContext
operations. This may take place:
\- at inter AMF change due to AMF planned maintenance or due to AMF failure
described in clause 5.21.2 of TS 23.501 [2];
\- at inter AMF mobility in CM-CONNECTED state described in clause 4.9.1.3;
\- at inter AMF mobility in CM-IDLE state described in clause 4.2.2.2.
\- (between AMF and SMF) Passing MO Small Data from AMF to SMF in clause
4.24.1.
\- (between V-SMF and H-SMF) Creation / Deletion / Modification of PDU
Sessions;
\- (between V-SMF/I-SMF and (H-)SMF) Transferring MO Small Data from
V-SMF/I-SMF to (H-)SMF in clause 4.25.4.
\- (between V-SMF/I-SMF and (H-)SMF) Transferring MT Small Data from (H-)SMF
to V-SMF/I-SMF in clause 4.24.5.
Even though the V-SMF creates the PDU Session resource onto the H-SMF, each of
the V-SMF and of the H-SMF needs to be able to modify a PDU Session and/or to
ask for PDU Session Release. Thus, at Nsmf_PDUSession_Create, V-SMF informs
the H-SMF about addressing information for its corresponding PDU Session
resource, allowing H-SMF to use later on the Nsmf_PDUSession_Update and
Nsmf_PDUSession_Release and Nsmf_PDUSession_StatusNotify operations.
NOTE 2: The PDU Session resource in V-SMF is created when the AMF requests to
create SM context of this PDU Session
NOTE 3: H-SMF also informs the consumer (V-SMF) about addressing information
about its PDU Session resource, but this is part of normal resource creation
operation in REST and not specific to this service.
##### 5.2.8.2.2 Nsmf_PDUSession_Create service operation
**Service operation name:** Nsmf_PDUSession_Create.
**Description:** Create a new PDU Session in the H-SMF or SMF or create an
association with an existing PDN connection in the home SMF+PGW-C.
**Input, Required:** SUPI, V-SMF ID or I-SMF ID, V-SMF SM Context ID or I-SMF
SM Context ID, DNN, V-CN Tunnel Info or I-UPF Tunnel Info, addressing
information allowing the H-SMF to request the V-SMF to issue further
operations about the PDU Session or addressing information allowing the SMF to
request the I-SMF to issue further operations about the PDU Session, Serving
Network (PLMN ID, or PLMN ID and NID, see clause 5.18 of TS 23.501 [2]).
**Input, Optional:** S-NSSAI, Alternative S-NSSAI, PCO, Requested PDU Session
Type, 5GSM Core Network Capability, Requested SSC mode, PDU Session ID, Number
Of Packet Filters, UE location information, subscription get notified of PDU
Session status change, PEI, GPSI, AN type, PCF ID, PCF Group ID, DNN Selection
Mode, UE\'s Routing Indicator optionally with Home Network Public Key
identifier or UDM Group ID for the UE, Always-on PDU Session Requested,
Control Plane CIoT 5GS Optimisation Indication, information provided by V-SMF
related to charging in home routed scenario (see TS 32.255 [45]), AMF ID, EPS
Bearer Status, extended NAS-SM timer indication, DNAI list supported by I-SMF
(from I-SMF to SMF), HO Preparation Indication. MA PDU request indication, MA
PDU Network-Upgrade Allowed indication, Indication on whether the UE is
registered in both accesses; QoS constraints from the VPLMN (as defined in
clause 5.7.1.11 of TS 23.501 [2]), Satellite backhaul category, Notification
of the SM Policy Association Establishment and Termination, PCF binding
information, Disaster Roaming service indication, HR-SBO request indication,
VPLMN EASDF address, [ECS Address Configuration Information associated with
PLMN ID of visited network], Indication of UE supports non-3GPP access path
switching.
**Output, Required:** Result Indication and if success a SM Context ID and in
addition: QFI(s), QoS Profile(s), Session-AMBR, QoS Rule(s), QoS Flow level
QoS parameters if any for the QoS Flow(s) associated with the QoS rule(s),
H-CN Tunnel Info or PSA UPF Tunnel Info, Enable pause of charging indication,
Selected PDU Session Type and SSC mode.
**Output, Optional:** PDU Session ID, S-NSSAI, Cause, PCO, UE IP address, IPv6
Prefix allocated to the PDU Session, information needed by V-SMF in the case
of EPS interworking such as the PDN Connection Type, EPS bearer context(s),
linked EBI, Reflective QoS Timer, Always-on PDU Session Granted, information
provided by H-SMF related to charging in home routed scenario (see TS 32.255
[45]), DNAI(s) of interest for this PDU Session (from SMF to I-SMF),
indication of multi-homing support (from SMF to I-SMF). MA PDU session
Accepted indication, Indication on whether Small Data Rate Control applies or
not, HR-SBO authorization result, VPLMN Specific Offloading Information for
HR-SBO, HPLMN DNS Server address, HPLMN address information (e.g. H-UPF IP
address on N6), Internal Group Identifier(s).
The V-SMF SM Context ID in the Input provides addressing information allocated
by the V-SMF (to be used for service operations towards the V-SMF for this PDU
Session).
The I-SMF SM Context ID in the Input provides addressing information allocated
by the I-SMF (to be used for service operations towards the I-SMF for this PDU
Session).
See clause 4.3.2.2.2 clause 4.11.1.2.2 clause 4.11.1.3.3 and clause 4.24 for
details on the usage of this service operation.
See clauses 4.22.2.2 and 4.22.3 for detailed usage of this service operation
for ATSSS.
See clause 6.7 of TS 23.548 [74] for HR-SBO request indication, HR-SBO
authorization result, VPLMN EASDF address, VPLMN Specific Offloading
Information for HR-SBO, HPLMN DNS Server address, HPLMN address information.
##### 5.2.8.2.3 Nsmf_PDUSession_Update service operation
**Service operation name:** Nsmf_PDUSession_Update.
**Description:** Update the established PDU Session.
This service operation is invoked by the V-SMF towards the H-SMF in the case
of UE or serving network requested PDU Session Modification in order for the
V-SMF to transfer the PDU Session Modification request. It can also be invoked
by the V-SMF to indicate to the H-SMF that the access type of the PDU session
can be changed. This service operation is also invoked by the V-SMF to insert
or remove UL CL or BP controlled by the V-SMF.
This service operation is invoked by the I-SMF towards the SMF in the case of
UE or serving network requested PDU Session Modification in order for the
I-SMF to transfer the PDU Session Modification request. It can also be invoked
by the I-SMF to indicate to the SMF that the access type of the PDU session
can be changed. This service operation is also invoked by the I-SMF towards
the SMF to insert or remove ULCL or BP controlled by the I-SMF or to report
usage offloaded via UL CL or BP controlled by I-SMF.
This service operation is invoked by the H-SMF towards the V-SMF for both UE
initiated and HPLMN initiated PDU Session Modification and PDU Session Release
cases in order to have the SM PDU Session Modification request or SM PDU
Session Release request sent to the UE. It can also be invoked by the H-SMF
towards the V-SMF to release the 5GC and 5G-AN resources in e.g. handover from
5GC-N3IWF to EPS and from 5GS to EPC/ePDG, wherein the UE is not notified.
This service operation is invoked by the SMF towards the I-SMF for both UE
initiated and SMF/PCF initiated PDU Session Modification and PDU Session
Release cases in order to have the SM PDU Session Modification request or SM
PDU Session Release request sent to the UE. It can also be invoked by the SMF
towards the I-SMF to release the 5GC and 5G-AN resources in e.g. handover from
5GC-N3IWF to EPS and from 5GS to EPC/ePDG, wherein the UE is not notified.
This service operation is also invoked by the SMF towards the I-SMF to provide
updated N4 information or updated DNAI list of interest for this PDU Session
when SMF receives updated PCC rules.
This service operation is invoked by the V-SMF or I-SMF and the H-SMF or SMF
in the case of PDU Session Establishment authentication/authorization by a DN-
AAA Server defined in clause 4.3.2.3: it is used to carry DN Request Container
information between the DN-AAA Server and the UE.
**Input, Required:** SM Context ID.
**Input, Optional:** UE location information (ULI), UE Time Zone, AN type,
indication of PDU Session Release, H-SMF SM Context ID (from H-SMF to V-SMF)
or SMF SM Context ID (from SMF to I-SMF), QoS Rule and QoS Flow level QoS
parameters if any for the QoS Flow associated with the QoS rule (from H-SMF to
V-SMF or from SMF to I-SMF), EPS bearer context(s) and Linked EBI (from H-SMF
to V-SMF or from SMF to I-SMF), N9 Tunnel Info (from V-SMF to H-SMF or from
I-SMF to SMF), Information requested by UE for e.g. QoS (from V-SMF to H-SMF
or from I-SMF to SMF), 5GSM Core Network Capability, Information necessary for
V-SMF or I-SMF to build SM Message towards the UE (from H-SMF to V-SMF or from
SMF to I-SMF), Trigger PDU release indication (V-SMF to H-SMF or from I-SMF to
SMF), Start Pause of Charging indication, Stop Pause of Charging indication,
DN Request Container information, indication that the UE shall not be
notified, EBI Allocation Parameters (ARP list), Secondary RAT usage data,
indication that the access type of the PDU session can be changed (V-SMF to
H-SMF or from I-SMF to SMF) or from SMF to I-SMF), extended NAS-SM timer
indication, DNAI list supported by I-SMF (from I-SMF to SMF), indication of
multi-homing support (from SMF to I-SMF), indication of ULCL or BP insertion
(from I-SMF to SMF), indication of ULCL or BP removal (from I-SMF to SMF),
IPv6 prefix \@local PSA (from I-SMF to SMF), DNAI(s) supported by local PSA
(from I-SMF to SMF), Tunnel info of ULCL or BP (from I-SMF to SMF), N4
information (from I-SMF to SMF or from SMF to I-SMF), Handover Complete
Indication, Relocation Cancel Indication. MA PDU request indication, MA PDU
Network-Upgrade Allowed indication, Indication on whether the UE is registered
in both accesses, MA PDU session Accepted indication, access for MA PDU
Session Release, access type for GBR QoS flow, Indication of access
unavailability (with access type), QoS Monitoring Indication (from SMF to
I-SMF), QoS Monitoring reporting frequency(from SMF to I-SMF), QoS monitoring
policy (from SMF to I-SMF), QoS Monitoring Result from (I-SMF to SMF),
Notification of the SM Policy Association Establishment and Termination, PCF
binding information, Satellite backhaul category, N9 forwarding tunnel to
support the EAS session continuity required (from SMF to I-SMF), traffic
filter for N9 forwarding (from SMF to I-SMF), value of the timer to detect the
end of activity on the N9 forwarding tunnel to support the EAS session
continuity (from SMF to I-SMF), EAS rediscovery indication, EAS information to
be refreshed for EAS re-discovery, IP address of V-EASDF, ECS Address
Configuration Information, Alternative HPLMN S-NSSAI, HR-SBO authorization
result, VPLMN Specific Offloading Information for HR-SBO, HPLMN address
information, DNS Server address provided by HPLMN, Indication of UE supports
non-3GPP access path switching.
**Output, Required:** Result indication, \ pair _._
**Output, Optional:** UE location information, AN Type, SM information from UE
(from V-SMF to H-SMF or from I-SMF to SMF), list of Rejected QoS Flows (from
V-SMF to H-SMF or from I-SMF to SMF), a list of \ pair, Secondary
RAT Usage Data, DNAI(s) of interest for this PDU Session (from SMF to I-SMF),
N4 Information (from SMF to I-SMF), QFI(s), QoS Profile(s), Session-AMBR, QoS
Rule(s), QoS Flow level QoS parameters if any for the QoS Flow(s) associated
with the QoS rule(s), EPS bearer context(s), linked EBI, DNAI(s) of interest
for this PDU Session, HR-SBO authorization result, VPLMN Specific Offloading
Information for HR-SBO, HPLMN address information, DNS Server address provided
by HPLMN, Internal Group Identifier(s)_._
The H-SMF SM Context ID in the Input provides addressing information allocated
by the H-SMF (to be used for service operations towards the H-SMF for this PDU
Session).
The SMF SM Context ID in the Input provides addressing information allocated
by the SMF (to be used for service operations towards the SMF for this PDU
Session).
See clause 4.3.3.3 for an example usage of this service operation.
See clauses 4.22.6.3, 4.22.7, 4.22.8.3 and 4.22.10.3 for detailed usage of
this service operation for ATSSS.
See clause 6.7.3 of TS 23.548 [74] for detailed usage of this service for EAS
re-discovery.
##### 5.2.8.2.4 Nsmf_PDUSession_Release service operation
**Service operation name:** Nsmf_PDUSession_Release.
**Description:** It causes the immediate and unconditional deletion of the
resources associated with the PDU Session. This service operation is used by
V-SMF to request the H-SMF or used by I-SMF to request the SMF to release the
resources related to a PDU Session for the serving network initiated PDU
release case (e.g. implicit De-registration of UE in the serving network).
**Input, Required:** SM Context ID.
**Input, Optional:** Secondary RAT Usage Data, N4 information.
**Output, Required:** Result Indication _._
**Output, Optional:** Small Data Rate Control Status, APN Rate Control Status
_._
See clause 4.3.4.3 for an example usage of this service operation.
##### 5.2.8.2.5 Nsmf_PDUSession_CreateSMContext service operation
**Service operation name:** Nsmf_PDUSession_CreateSMContext.
**Description:** It creates an AMF-SMF association to support a PDU Session.
**Input, Required:** SUPI or PEI, DNN, AMF ID (AMF Instance ID), RAT Type,
Serving Network (PLMN ID, or PLMN ID and NID, see clause 5.18 of TS 23.501
[2]).
**Input, Optional:** PEI, S-NSSAI(s), Alternative S-NSSAI, PDU Session Id, N1
SM container, UE location information, UE Time Zone, AN type, H-SMF
identifier/address, list of alternative H-SMF(s) if available, old PDU Session
ID (if the AMF also received an old PDU Session ID from the UE as specified in
clause 4.3.5.2), Subscription For PDU Session Status Notification,
Subscription for DDN Failure Notification, NEF Correlation ID, indication that
the SUPI has not been authenticated, PCF ID, PCF Group ID, Same PCF Selection
Indication, DNN Selection Mode, UE PDN Connection Context, GPSI, UE presence
in LADN service area, indication that \"the PDU Session is subject to LADN per
LADN DNN and S-NSSAI\", GUAMI, backup AMF(s) (if NF Type is AMF), Trace
Requirements, Control Plane CIoT 5GS Optimisation indication, Small Data Rate
Control Status, APN Rate Control Status. Backup AMF(s) sent only once by the
AMF to the SMF in its first interaction with the SMF, UE\'s Routing Indicator
optionally with Home Network Public Key identifier or UDM Group ID for the UE,
EPS Bearer Status. Target ID (for EPS to 5GS handover), \"Invoke NEF\" flag,
target DNAI, additional following for SM context transfer: SMF transfer
indication, Old SMF ID, SM context ID in old SMF (see clause 4.26.5.3), HO
Preparation Indication, indication of no NG-RAN change. MA PDU request
indication, MA PDU Network-Upgrade Allowed indication, Indication on whether
the UE is registered in both accesses, Satellite backhaul category, GEO
Satellite ID, PVS FQDN(s) and/or PVS IP address(es) and Onboarding Indication
in the case of ON-SNPN, Disaster Roaming service indication, HR-SBO allowed
indication, Indication of UE supports non-3GPP access path switching.
**Output, Required:** Result Indication and if successful SM Context ID.
**Output, Optional:** Cause, PDU Session ID, N2 SM information, N1 SM
container, S-NSSAI(s).
When the PDU Session is for Emergency services for a UE without USIM, the AMF
provides the PEI and not the SUPI as identifier of the UE. When the PDU
Session is for Emergency services of an unauthenticated UE with an USIM, the
AMF shall provide both the SUPI and the PEI and shall provide an indication
that the SUPI has not been authenticated.
See clause 4.3.2.2.1 clause 4.3.2.2.2 clause 4.11.1.2.2 and clause 4.11.1.3.3
for details on the usage of this service operation.
See clauses 4.22.2.1 and 4.22.3 for detailed usage of this service operation
for ATSSS.
See clause 6.7 of TS 23.548 [74] for HR-SBO allowed indication.
##### 5.2.8.2.6 Nsmf_PDUSession_UpdateSMContext service operation
**Service operation name:** Nsmf_PDUSession_UpdateSMContext.
**Description:** It allows to update the AMF-SMF association to support a PDU
Session and/or to provide SMF with N1/N2 SM information received from the UE
or from the AN, or allows to establish forwarding tunnel between UPFs
controlled by different SMFs (e.g. by UPF controlled by old I-SMF and UPF
controlled by new I-SMF).
**Input, Required:** SM Context ID.
**Input, Optional:** N1 SM container received from the UE, N2 SM information
received from the AN (e.g. N3 addressing information, notification indicating
that the QoS targets cannot be fulfilled for a QFI, Secondary RAT Usage Data),
Operation Type (e.g. UP activate, UP deactivate, UP To Be Switched), Serving
GW Address(es) and Serving GW DL TEID(s) for data forwarding during HO from
5GS to EPS, UE location information, AN type, UE Time Zone, H-SMF
identifier/address, EBI(s) to be revoked, PDU Session(s) to be re-activated,
Direct Forwarding Flag, ARP list, S-NSSAI, Data Forwarding Tunnel
(setup/release), UE presence in LADN service area, Target ID, Target AMF ID,
GUAMI, backup AMF(s) (if NF Type is AMF), Indication of Access Type can be
changed, RAT Type. Backup AMF(s) sent only once by the AMF to the SMF in its
first interaction with the SMF. Release indication and release cause,
forwarding tunnel information, Handover Complete Indication, Relocation Cancel
Indication. MA PDU request indication, MA PDU Network-Upgrade Allowed
indication, Indication on whether the UE is registered in both accesses,
access on which signalling was received, Subscription to DDN Failure
Notification, NEF Correlation ID, MO Exception Data Counter, access for MA PDU
Session Release, list of NWDAF IDs and corresponding Analytics ID(s),
Satellite backhaul category, GEO Satellite ID, N9 forwarding tunnel to support
the EAS session continuity required, target UL CL tunnel info for N9
forwarding tunnel to support the EAS session continuity, value of the timer to
detect the end of activity on the N9 forwarding tunnel to support the EAS
session continuity, CN based MT handling indication, Alternative S-NSSAI,
Indication of UE supporting non-3GPP access path switching, Indication of
non-3GPP access path switching while using old AN resources.
**Output, Required:** Result Indication.
**Output, Optional:** PDU Session ID, Cause, released EBI list, allocated EBI
information, N2 SM information (e.g. QFI, UE location information,
notification indication indicating that the QoS targets cannot be fulfilled),
N1 SM container to be transferred to the AN/UE, type of N2 SM information. MA
PDU session Accepted indication, list of NWDAF IDs and corresponding Analytics
ID(s), source UL CL tunnel info for N9 forwarding tunnel info to support the
EAS session continuity.
See clause 4.3.3.2 and clause 4.3.3.3 for an example usage of this service
operation.
See clause 4.9.1.2.2 for the usage of the \"UP To Be Switched\" Operation
Type.
For the use of the \"EBI(s) to be revoked\" information, see clause
4.11.1.4.1.
For the use of the \"Direct Forwarding Flag\", see clause 4.11.1.2.2.2.
For the use of the \"Indication of Access Type can be changed\", see clause
4.2.3.2.
For the use of \"release indication and release cause\", see clause 4.3.4.2.
For the use of the \"forwarding tunnel information\", see clause 4.23.4.3.
If the consumer NF is AMF and the SMF determines that some EBIs are not
needed, the SMF will put the EBIs back in the released EBI list.
If the consumer NF is AMF and Inter-system mobility happens, the SMF sends
allocated EBI information to AMF.
If the ARP of QoS flow is changed, the SMF uses this operation to update EBI-
ARP information in the AMF.
If the AMF does not have PDU Session ID, the PDU Session ID is not required
for Input and is required for Output.
If consumer NF is AMF and SMF includes N2 SM information in the Output, the
SMF indicates type of N2 SM information.
The Small Data Rate Control Status is included if a PDU Session is being
released and the UPF or NEF provided Small Data Rate Control Status for the
AMF to store. APN Rate Control Status is included if a PDU Session is being
released and the UPF or NEF provided APN Rate Control Status for the AMF to
store.
NOTE: The N2 SM information is not interpreted by the AMF.
See clauses 4.22.6.3, 4.22.9 and 4.22.10.2 for detailed usage of this service
operation for ATSSS.
##### 5.2.8.2.7 Nsmf_PDUSession_ReleaseSMContext service operation
**Service operation name:** Nsmf_PDUSession_ReleaseSMContext.
**Description:** It allows to release the AMF-SMF association for a certain
PDU Session because the PDU Session has been released.
**Input, Required:** SM Context ID.
**Input, Optional:** UE location information, AN type, UE Time Zone, N2 SM
Info (Secondary RAT Usage Data), V-SMF only, I-SMF only.
**Output, Required:** Result Indication.
**Output, Optional:** Cause, Small Data Rate Control Status, APN Rate Control
Status.
See clause 4.3.4.2 and clause 4.3.4.3 for an example usage of this service.
If the consumer NF is AMF and the PDU Session indicated by the PDU Session ID
had been assigned some EBIs, the AMF locally determines that the corresponding
EBI(s) are released.
For the use of the \"V-SMF only\" indication, see clause 4.11.1.2.
For the use of the \"I-SMF only\" indication, see clause 4.23.7.3.
##### 5.2.8.2.8 Nsmf_PDUSession_SMContextStatusNotify service operation
**Service operation name:** Nsmf_PDUSession_SMContextStatusNotify.
**Description:** This service operation is used by the SMF to notify its
consumers about the status of an SM context related to a PDU Session (e.g. PDU
Session Release due to local reasons within the SMF, PDU Session handover to a
different system or access type, SMF context transfer, triggering I-SMF
selection for the PDU Session). The SMF may use this service operation to
update the SMF derived CN assisted RAN parameters tuning in the AMF. The SMF
may report the DDN Failure with NEF Correlation ID to the AMF.
**Input, Required:** Status information.
**Input, Optional:** Cause, SMF derived CN assisted RAN parameters tuning, New
SMF ID for SM Context Transfer (see clause 4.26.5.3) or SMF set ID, Small Data
Rate Control Status, APN Rate Control Status, DDN Failure detected in
(I-/V-)SMF, target DNAI information, list of NWDAF IDs and corresponding
Analytics ID(s).
**Output, Required:** Result Indication.
**Output, Optional:** None.
The target DNAI information indicates the target DNAI for the current PDU
session or target DNAI for next PDU session.
##### 5.2.8.2.9 Nsmf_PDUSession_StatusNotify service operation
**Service operation name:** Nsmf_PDUSession_StatusNotify.
**Description:** This service operation is used by the SMF to notify its
consumers about the status of a PDU Session (e.g. PDU Session is released due
to local reasons within the H-SMF, PDU Session handover to a different system
or access type, triggering I-SMF reselection for the PDU Session).
**Input, Required:** Status information.
**Input, Optional:** Cause, Small Data Rate Control Status, APN Rate Control
Status, target DNAI information.
**Output, Required:** Result Indication.
**Output, Optional:** None.
##### 5.2.8.2.10 Nsmf_PDUSession_ContextRequest service operation
**Service operation name:** Nsmf_PDUSession_ContextRequest.
**Description:** This service operation is used by the NF Consumer to request
for SM Context (e.g. during EPS IWK, HO, SM Context transfer indication), or
during mobility procedure with I-SMF (or V-SMF) changes or may be triggered by
OAM.
**Input, Required:** SM Context ID, SM context type.
**Input, Optional:** Target MME Capability, EBI list not to be transferred,
PDU Session ID (include PDU Session ID when available), SMF transfer
indication, indication of no NG-RAN change.
**Output, Required:** One of the following:
\- SM Context Container.
\- Endpoint where SM Context can be retrieved.
**Output, Optional:** Small Data Rate Control Status.
The SM context type indicates the type of SM context to be requested, e.g. PDN
Connection Context, 5G SM Context or both. The SM context type may also
indicate that only a specific part of 5G SM Context is requested, e.g. only
the AF Coordination Information part. If the SM context type is PDN Connection
Context, the SM Context included in the SM Context container is the PDN
Connection Context. If the SM context type is all, the SM Context included in
the SM Context container includes both the PDN Connection Context and the 5G
SM Context.
Table 5.2.8.2.10-1 illustrates the SM Context that may be transferred between
I-SMF(s) or between V-SMF(s) in home-routed roaming case.
Table 5.2.8.2.10-1: SM Context of a PDU Session transferred between I-SMF(s)
or between V-SMF(s) or between I/V-SMF and (H-)SMF
Field Description
* * *
SUPI SUPI (Subscription Permanent Identifier) is the subscriber\'s permanent
identity in 5GS. Trace Requirements Trace reference: Identifies a record or a
collection of records for a particular trace. Trace type: Indicates the type
of trace OMC identity: Identifies the OMC that shall receive the trace
record(s). S-NSSAI The S-NSSAI of the PDU Session for the serving PLMN. HPLMN
S-NSSAI The S-NSSAI of the PDU Session for the HPLMN (Home-Routed PDU Session)
Network Slice Instance id The network Slice Instance information for the PDU
Session DNN The associated DNN for the PDU Session. AMF Information The
associated AMF instance identifier and GUAMI. Access Type The current access
type for this PDU Session. RAT Type RAT Type for this PDU Session. PDU Session
ID The identifier of the PDU Session. H-SMF Information or SMF Information The
associated H-SMF identifier and H-SMF address for the HR PDU Session ( applies
only for a V-SMF), or the SMF identifier and SMF address for PDU Session
(applies for I-SMF). Context ID of the PDU Session in H-SMF or Context ID of
the PDU Session in SMF The context ID of the PDU Session in H-SMF or in SMF.
Forwarding Indication An indication on whether forwarding tunnel needs be
established in order to forward buffered DL data. Uplink Tunnel Info of UPF
controlled by the SMF / H-SMF The Tunnel Information to be used to send UL
traffic towards the UPF controlled by the SMF / H-SMF that interfaces the UPF
controlled by the I-SMF. Tunnel Info of NG-RAN The N3 Tunnel Information in
the NG-RAN for the PDU Session. This information is transferred if the target
I/V-SMF indicates no NG-RAN change. Disaster Roaming An indication that the UE
is registered for Disaster Roaming service. EAS information to be refreshed
for EAS re-discovery Identifies EAS(s) which needs to be refreshed
corresponding to the old target DNAI if available. See details in clause 6.7.3
of TS 23.548 [74]. This applies only for a V-SMF (for V-SMF change case) or
H-SMF (for V-SMF insertion case). Authorization Result for HR-SBO Indicates
whether HR-SBO is authorized. See details in clause 6.7.3 of TS 23.548 [74].
This applies only for a V-SMF (for V-SMF change within same PLMN case). VPLMN
Specific Offloading Information Includes traffic description information
authorized for HR-SBO in VPLMN and the corresponding policy for the traffic.
See details in clause 6.7.3 of TS 23.548 [74] (for V-SMF change within same
PLMN case). HPLMN address information Identifies the address information in
HPLMN (e.g. H-UPF IP address on N6). See details in clause 6.7.3 of TS 23.548
[74]. This applies for a V-SMF (for V-SMF change case), H-SMF (for V-SMF
insertion). DNS Server address provided by HPLMN Identifies the DNS Server
provided by HPLMN to VPLMN for HR-SBO. See details in clause 6.7.3 of TS
23.548 [74]. This applies for a V-SMF (for V-SMF change case), H-SMF (for
V-SMF insertion). **AF Coordination Information:**  
Source DNAI The DNAI from where the UE is moving. UE IP address in Source DNAI
The UE IP address in the Source DNAI. List of Notification Correlation IDs
Notification Correlation IDs for UP path change event as received in the PCC
Rules For each notification correlation ID: Uplink buffering indication Uplink
buffering indication as received from the AF for this notification correlation
id during Early Notification. **For each QoS Flow in the PDU Session:**  
5G QoS Identifier (5QI) Identifier for the authorized QoS parameters for the
service data flow. ARP The Allocation and Retention Priority for the service
data flow consisting of the priority level, the pre-emption capability and the
pre-emption vulnerability. GFBR Guaranteed Flow Bit Rate (GFBR) - UL and DL.
MFBR Maximum Flow Bit Rate (MFBR) - UL and DL. Priority Level Indicates a
priority in scheduling resources among QoS Flows. Averaging Window Represents
the duration over which the guaranteed and maximum bitrate shall be
calculated. Maximum Data Burst Volume Denotes the largest amount of data that
is required to be transferred within a period of 5G-AN PDB. Reflective QoS
Control Indicates to apply reflective QoS for the SDF in the TFT. QoS
Notification Control (QNC) Indicates whether notifications are requested from
3GPP RAN when the GFBR can no longer (or can again) be guaranteed for a QoS
Flow during the lifetime of the QoS Flow. Maximum Packet Loss Rate Maximum
Packet Loss Rate - UL and DL. **Mapped EPS Bearer Context for Each QFI to
support interworking with EPS:**  
EPS Bearer Id An EPS bearer identity uniquely identifies an EPS bearer for one
UE accessing via E-UTRAN. TI The GERAN/UTRAN Transaction ID (if any) that is
associated with the EPS Bearer ID which is part of the Bearer Context received
from the MME. BSS Container The GERAN BSS Container (if any) that is
associated with the EPS Bearer ID which is part of the Bearer Context received
from the MME. Mapped EPS Bearer QoS ARP, GBR, MBR, QCI. PGW-U tunnel
Information PGW-U S5/S8 GTP-U tunnel IP address and TEID information. TFT
Traffic Flow Template.
##### 5.2.8.2.11 Nsmf_PDUSession_ContextPush service operation
**Service operation name:** Nsmf_PDUSession_ContextPushRequest
**Description:** This service operation is used by the SMF as Service Consumer
to push one SM Context to a another SMF as NF Service Producer. It may be
triggered by OAM.
**Input, Required:** One of the following:
\- SM Context of identified PDU session.
\- Endpoint where SM Context of identified PDU session can be retrieved.
The SM context includes SM context in I-SMF(or V-SMF) and SM context in SMF
(or H-SMF) separately.
See Table 5.2.8.2.10-1 for single SM Context stored in I-SMF or V-SMF that may
be transferred to another SMF instance.
Editor\'s note: The SM context stored in SMF(or H-SMF) is to be defined.
**Output, Required:** Result Indication.
**Output, Optional:** Cause.
See clause 4.26.2 for an example usage of this service operation.
##### 5.2.8.2.12 Nsmf_PDUSession_SendMOData service operation
**Service operation name:** Nsmf_PDUSession_SendMOData
**Description:** When the AMF has received MO Small Data from the UE in NAS
procedure, this service operation allows the AMF to send the MO Small Data to
the SMF.
**Input, Required:** SM Context ID, N1 container received from the UE.
**Input, Optional:** AN type, MO Exception Data Counter.
**Output, Required:** Result Indication.
**Output, Optional:** Cause.
See clause 4.24.1 for an example usage of this service operation.
##### 5.2.8.2.13 Nsmf_PDUSession_TransferMOData service operation
**Service operation name:** Nsmf_PDUSession_TransferMOData
**Description:** When the V-SMF/I-SMF has received MO Small Data from AMF,
this service operation allows the V-SMF/I-SMF to forward the MO Small Data to
the (H-)SMF.
**Input, Required:** SM Context ID, MO Small Data.
**Input, Optional:** MO Exception Data Counter.
**Output, Required:** Result Indication.
**Output, Optional:** Cause.
See clause 4.25.4 for an example usage of this service operation.
##### 5.2.8.2.14 Nsmf_PDUSession_TransferMTData service operation
**Service operation name:** Nsmf_PDUSession_TransferMTData
**Description:** When the (H-)SMF has received MT Small Data from the NEF,
this service operation allows the (H-)SMF to send the MT Small Data to the
V-SMF/I-SMF.
**Input, Required:** SM Context ID, MT Small Data.
**Input, Optional:** None.
**Output, Required:** Result Indication.
**Output, Optional:** Cause, Estimated Maximum Wait time.
See clause 4.24.5 for an example usage of this service operation.
#### 5.2.8.3 Nsmf_EventExposure Service
##### 5.2.8.3.1 General
**Service description:** This service provides events related to PDU Sessions
towards consumer NF. The service operations exposed by this service allow
other NFs to subscribe and get notified of events happening on PDU Sessions.
The following are the key functionalities of this NF service.
\- Allow consumer NFs to Subscribe and unsubscribe for an Event ID on PDU
Session(s);
\- Allow the NWDAF to collect data for network data analytics from SMF as
specified in TS 23.288 [50] and from UPF as specified in clause 4.15.4.5;
\- Notifying events on the PDU Session to the subscribed NFs; and
\- Allow consumer NFs to acknowledge or respond to an event notification.
The following events can be subscribed by a NF consumer (Event ID is defined
in clause 4.15.1):
\- UE IP address / Prefix allocation/change: The event notification may
contain a new UE IP address / Prefix or an indication of which UE IP address /
Prefix has been released.
\- PDU Session Establishment and/or PDU Session Release.
The event notification may contain following information:
\- PDU Session Type.
\- DNN.
\- UE IP address/Prefix.
\- UP path change: a notification corresponding to this event is sent when the
UE IP address / Prefix and / or DNAI and /or the N6 traffic routing
information has changed.
The event notification may contain following information:
\- the type of notification (\"EARLY\" or \"LATE\").
\- for both the source and target UP path between the UE and the DN, the
corresponding information is provided when it has changed:
\- DNAI.
\- UE IP address / Prefix.
\- N6 traffic routing information.
\- Candidate DNAI(s) for the PDU Session.
\- Change of common EAS.
NOTE 1: UP path change notification, DNAI and N6 traffic routing information
are further described in clause 5.6.7 of TS 23.501 [2].
\- QoS Monitoring: the event notification may contain the QoS Monitoring
report for the QoS parameter(s) to be measured defined in clause 5.45 of TS
23.501 [2]. Implicit subscription of the PCF on behalf of the NEF/AF as part
of setting PCC rule(s) may trigger SMF to send this event notification.
\- Change of Access Type; The event notification contains the new Access Type
for the PDU Session.
\- Change of RAT Type; the event notification contains the new RAT Type for
the PDU Session.
\- PLMN change; The event notification contains the new PLMN Identifier for
the PDU Session.
\- Change of satellite backhaul category; The event notification contains the
new satellite backhaul category for the PDU session.
\- Downlink data delivery status. The event notification contains the status
of downlink data buffering in the core network including:
\- First downlink packet per source of the downlink IP traffic in extended
buffering and Estimated maximum wait time.
\- First downlink packet per source of the downlink IP traffic discarded.
\- First downlink packet per source of the downlink IP traffic transmitted
after previous buffering and/or discarding of corresponding packet(s).
\- QFI allocation: The event notification is sent when a new QoS flow is
established within a PDU session and contains:
\- If the Target of Event Reporting is a PDU session, both the allocated QFI
and either one of the following (Application Identifier or IP Packet Filter
Set or Ethernet Packet Filter Set). The 5QI corresponding to the QoS flow and
the DNN, S-NSSAI corresponding to the PDU session are also sent.
\- If the Target of Event Reporting is a SUPI, both the allocated QFI and
either one of the following (Application Identifier or IP Packet Filter Set or
Ethernet Packet Filter Set) for each PDU session ID established for this SUPI.
The 5QI corresponding to the QoS flow and the DNN, S-NSSAI corresponding to
each PDU session are also sent.
\- If the Target of Event Reporting is an Internal-Group-Id or any UE,
multiple instances of the tuple (allocated QFI and either one of the following
(Application Identifier or IP Packet Filter Set or Ethernet Packet Filter
Set). PDU session ID, SUPI). The 5QI corresponding to the QoS flow and the
DNN, S-NSSAI corresponding to each PDU session are also sent.
\- Total number of Session Management transactions:
\- The total number of Session Management transaction is used to collect the
number of SM transactions of a SUPI or Internal Group ID, for example
Dispersion Analytics as specified in TS 23.288 [50]. The transaction count is
incremented when the NAS transactions from PDU Session Establishment, PDU
Session Authentication, PDU Session Modification and PDU Session Release
procedures is concluded. Only the periodic reporting mode applies.
\- Information on PDU Session for WLAN (i.e. Access Type is Non-3GPP and RAT
Type is TRUSTED_WLAN).
NOTE 2: When the consumer NF is the NWDAF, the event QFI allocation is used to
collect data for Observed Service Experience analytics, UE communication
analytics, QoS Sustainability analytics and end-to-end data volume transfer
time analytics as specified in TS 23.288 [50].
\- User plane status information: The event notification contains:
\- PDU Session ID.
\- User Plane Inactivity Timer (as specified in TS 29.244 [69]).
\- PDU Session status (activated, deactivated).
NOTE 3: When the consumer NF is the NWDAF, the event user plane status
information is used to collect data for UE Communication analytics as
specified in TS 23.288 [50].
\- Session Management Congestion Control Experience for PDU Session: The event
notification contains the data related to Session Management Congestion
Control experience per PDU Session as described in TS 23.288 [50].
\- UE session behaviour trends (see clause 4.15.4.3);
\- UE communications trends (see clause 4.15.4.3);
\- UP with redundant transmission: the event notification indicates if
redundant transmission (see clause 5.33.2.2 of TS 23.501 [2]) has been
activated or not for the PDU session;
\- User Data Usage Measures (see clause 4.15.4.5): SMF conveys the
subscription to UPF on behalf of the consumer. Consumer receives the events
directly from UPF; and
\- User Data Usage Trends (see clause 4.15.4.5): SMF conveys the subscription
to UPF on behalf of the consumer. Consumer receives the events directly from
UPF.
When the consumer NF is the NWDAF, the event Information on PDU Session for
WLAN is used to collect data for WLAN performance analytics as specified in TS
23.288 [50].
When the consumer NF is the NWDAF, the event Session Management Congestion
Control Experience for PDU Session is used to collect data for Session
Management Congestion Control Experience analytics as specified in TS 23.288
[50].
When the consumer NF is the NWDAF, the events QoS Monitoring, User Data Usage
Measures and User Data Usage Trends are used to collect data from UPF for
analytics as specified in clause 4.15.4.5 and in TS 23.288 [50]. SMF conveys
the subscription to UPF on behalf of the NWDAF.
The consumer NF may request to subscribe the UPF exposure events (including
event ID of exposed UPF event of QoS monitoring, User Data Usage Measures and
User Data Usage Trends) via SMF indirectly by Nsmf_EventExposure. After
receiving this subscription request, the SMF does a third-party subscription
onto UPF on behalf of this consumer. The consumer should also provide the
subscribed UPF event to SMF.
Event Filters are used to specify the conditions to match for notifying the
events (i.e. \"List of Parameter values to match\"). If there are no
conditions to match for a specific Event ID, then the Event Filter is not
provided. The following table provides as an example how the conditions to
match for event reporting can be specified for various Event IDs for SMF
exposure.
Table 5.2.8.3.1-1: Example of Event Filters for SMF exposure events
+----------------------------------+----------------------------------+ | Event ID for SMF exposure | Event Filter (List of Parameter | | | Values to Match) | +==================================+==================================+ | DNAI Change | None | +----------------------------------+----------------------------------+ | Candidate DNAI(s) has changed | None | +----------------------------------+----------------------------------+ | PDU Session Release | \ | +----------------------------------+----------------------------------+ | PDU Session Establishment | \ | +----------------------------------+----------------------------------+ | QoS Monitoring | \ | | | | | | \ | | | | | | \ | | | | | | \ | | | | | | \ | | | | | | \ | +----------------------------------+----------------------------------+ | QFI allocation | \ | | | | | | \ | +----------------------------------+----------------------------------+ | QFI allocation | \ | +----------------------------------+----------------------------------+ | Transaction Count | \ (NOTE) | | | | | | \ | +----------------------------------+----------------------------------+ | User plane status information | \ | | | | | | \ | +----------------------------------+----------------------------------+ | Information on PDU Session for | \ && | | | \ | +----------------------------------+----------------------------------+ | Session Management Congestion | \ | | Session | | | | \ | +----------------------------------+----------------------------------+ | UP with redundant transmission | \ | +----------------------------------+----------------------------------+ | User Data Usage Measures | \ | | | | | | \ | | | | | | \ (NOTE 2) | | | | | | \ | | | (NOTE 2) | | | | | | \ | | | | | | \ | +----------------------------------+----------------------------------+ | User Data Usage Trends | \ | | | | | | \ | | | | | | \ (NOTE 2) | | | | | | \ | | | (NOTE 2) | | | | | | \ | +----------------------------------+----------------------------------+ | NOTE 1: Optionally the SMF can | | | fetch the location information | | | from the AMF but transaction | | | information correlation at the | | | location can also be achieved | | | without it and through | | | transaction information | | | associated with the requested | | | time period, which corresponds | | | to the UE\'s time span at the | | | location of interest. | | | | | | NOTE 2: These Parameters are | | | exclusive and only one of them | | | can be provided. | | +----------------------------------+----------------------------------+
The target of SMF event reporting may correspond to a PDU Session ID, an UE ID
(SUPI), an Internal Group Identifier, an indication that any UE is targeted
(e.g. on a specific DNN), or an indication that any PDU session is the target.
When acknowledgment is expected the SMF also provides Notification Correlation
Information to the consumer NF in the event notification.
The consumer NF may provide the following event-specific information when
acknowledging an event notification:
\- For UP path change event:
\- N6 traffic routing information related to the target DNAI.
NOTE 4: Acknowledgement to a UP path change event notification is further
described in clause 5.6.7 of TS 23.501 [2].
##### 5.2.8.3.2 Nsmf_EventExposure_Notify service operation
**Service operation name:** Nsmf_EventExposure_Notify
**Description:** Report UE PDU Session related event(s) to the NF which has
subscribed to the event report service.
**Input Required:** Event ID, Notification Correlation Information, UE ID(s)
(SUPI(s) and if available GPSI(s)), PDU Session ID(s), time stamp.
SMF reports multiple PDU Sessions events when those happen at the same time
and as indicated in the time stamp. The SMF reports the PDU Session ID, SUPI
and if available GPSI(s) per each PDU Session event.
**Input, Optional:** Event specific parameter list as described in clause
5.2.8.3.1, capability of supporting EAS IP replacement in 5GC.
**Output Required:** Result Indication.
**Output, Optional:** Redirection information _._
When the SMF detects the event subscribed by the NF consumer, the SMF reports
the subscribed event together with the Notification Target Address (+
Notification Correlation ID) to the Event Receiving NF.
The optional event specific parameter list provides the values that matched
for generating the event notification. The parameter values to match are
specified during the event subscription (see clause 5.2.8.3.3).
See clause 4.3.6.3 for details on usage of this service operation toward
Application Function.
If the NF consumer is AMF and the result of the service operation fails, the
AMF shall set corresponding cause value in result indication which can be used
by the SMF for further action. If the related UE is not served by the AMF and
the AMF knows which AMF is serving the UE, the AMF provides redirection
information which can be used by the SMF to resend UE related message to the
AMF that serves the UE.
NOTE: In the case of UP plane path, as described in clause 4.3.6.2, this
notification can be the result of an implicit subscription of the NEF/AF by
the PCF as part of setting PCC rule(s) via the Npcf_SMPolicyControl service
(see clause 5.2.5.4).
##### 5.2.8.3.2A Nsmf_EventExposure_AppRelocationInfo service operation
**Service operation name:** Nsmf_EventExposure_AppRelocationInfo
**Description:** Acknowledge the notification from the SMF regarding UE PDU
Session related event(s).
**Input Required:** Notification Correlation Information, cause code.
The Notification Corrrelation Information is provided by the SMF in the event
notification.
Cause code indicates this acknowledgement is positive or negative.
**Input, Optional:** Event specific parameter list as described in clause
5.2.8.3.1, Indication that buffering of uplink traffic should start,
Information for EAS IP Replacement in 5GC.
**Output Required:** None.
**Output, Optional:** None.
See clause 4.3.6.3 for details on usage of this service operation for example
for the usage of the Indication that buffering of uplink traffic should start.
##### 5.2.8.3.3 Nsmf_EventExposure_Subscribe service operation
**Service operation name:** Nsmf_EventExposure_Subscribe.
**Description:** This service operation is used by an NF to subscribe or
modify a subscription for event notifications on a specified PDU Session or
for all PDU Sessions of one UE, group of UE(s) or any UE.
**Input, Required:** NF ID, Target of Event Reporting as defined in clause
5.2.8.3.1, (set of) Event ID(s) defined in clause 5.2.8.3.1, Notification
Target Address (+ Notification Correlation ID), Event Reporting Information
defined in Table 4.15.1-1 _._
**Input, Optional:** Event Filter(s) associated with each Event ID; Event
Filter(s) are defined in clause 5.2.8.3.1, Subscription Correlation ID (in the
case of modification of the event subscription), Expiry time, DNN, S-NSSAI,
DNAI, UPFId, UPF event exposure information (Type of measurement, granularity
of measurement, reporting suggestion information, etc. associated with the UPF
Event IDs as described in clause 4.15.4.5)_._
NOTE: The SMF is generally meant to determine the UPF to contact for a
subscription related to UPF event exposure. UPF ID is only provided to
indicate a UP Path as defined in Table 6.4.1-1 of TS 23.288 [50], i.e. when
the NWDAF has received the target UPF as part of statistics of observed
service experience on an UP path involving that UPF.
**Output, Required:** When the subscription is accepted: Subscription
Correlation ID (required for management of this subscription), Expiry time
(required if the subscription can be expired based on the operator\'s
policy)_._
**Output, Optional:** First corresponding event report is included, if
available (see clause 4.15.1)_._
Notification Target Address (+ Notification Correlation ID) is used to
correlate Notifications sent by SMF or UPF with this subscription.
##### 5.2.8.3.4 Nsmf_EventExposure_UnSubscribe service operation
**Service operation name:** Nsmf_EventExposure_UnSubscribe.
**Description:** This service operation is used by an NF to unsubscribe event
notifications.
**Input, Required:** Subscription Correlation ID _._
**Input, Optional:** None _._
**Output, Required:** None _._
**Output, Optional:** None _._
#### 5.2.8.4 Nsmf_NIDD Service
##### 5.2.8.4.1 General
This service is used for NIDD transfer between SMF and another NF. See clause
4.25.5.
##### 5.2.8.4.2 Nsmf_NIDD_Delivery service operation
**Service operation name:** Nsmf_NIDD_Delivery
**Description:** This service operation is used by the NF consumer to deliver
the unstructured data between NF consumer and SMF to support NIDD via NEF.
**Inputs Required:** User Identity, PDU Session ID, unstructured data,
Reliable Data Service Configuration (Optional).
**Inputs, Optional:** None.
**Outputs Required:** Cause.
**Outputs, Optional:** Extended Buffering Time.
#### 5.2.8.5 Nsmf_TrafficCorrelation service
##### 5.2.8.5.1 General
**Service description:** This service allows SMF to notify NF Consumer (NEF)
about 5GC determined information for a set of UEs identified by Traffic
Correlation ID.
NOTE: The NEF stores this in the UDR together with AF requests to influence
traffic routing information.
##### 5.2.8.5.2 Nsmf_TrafficCorrelation_Notify service operation
**Service operation name:** Nsmf_TrafficCorrelation_Notify
**Description:** The NF notifies with 5GC determined information.
**Inputs, Required:** SMF ID, number of PDU sessions for the traffic
correlation ID, traffic correlation ID.
**Inputs, Optional:** EAS ID, DNAI(s).
NOTE At least one of EAS ID or DNAI(s) needs to be included in the Input.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
### 5.2.9 SMSF Services
#### 5.2.9.1 General
The following table illustrates the SMSF Services.
Table 5.2.9.1-1: List of SMSF Services
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Ns | Activate | Re | AMF | | msf_SMService | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Deactivate | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | UplinkSMS | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | MtForwardSm | Re | SMS-GMSC, | | | | quest/Response | IP-SM-GW, SMS | | | | | Router | +----------------+----------------+----------------+----------------+
#### 5.2.9.2 Nsmsf_SMService service
##### 5.2.9.2.1 General
This service allows AMF to authorize SMS and activate SMS for the served user
on SMSF. This service allows downlink SMS message transmit from consumer NF to
SMSF.
##### 5.2.9.2.2 Nsmsf_SMService_Activate service operation
**Service operation name:** Nsmsf_SMService_Activate.
**Description:** Authorize whether the specified UE is allowed to activate SMS
service, or add connectivity for SMS over new Access Type.
**Concurrent use:** None.
**Inputs, Required:** SUPI, NF ID, RAT Type.
**Inputs, Optional:** GPSI, Time Zone, one or more Access Type(s), GUAMI,
backup AMF(s) (if NF Type is AMF). Backup AMF(s) sent only once by the AMF to
the SMSF in its first interaction with the SMSF, UE\'s Routing Indicator
optionally with Home Network Public Key identifier or UDM Group ID for the UE.
**Outputs, Required:** SMS service activation result.
**Outputs, Optional:** None.
##### 5.2.9.2.3 Nsmsf_SMService_Deactivate service operation
**Service operation name:** Nsmsf_SMService_Deactivate.
**Description:** Remove SMS service authorization from SMSF for a given
service user, or with Access Type included, remove connectivity for SMS over
the affected Access Type.
**Concurrent use:** None.
**Inputs, Required:** SUPI.
**Inputs, Optional:** Access Type.
**Outputs, Required:** SMS service deactivation result.
**Outputs, Optional:** None.
##### 5.2.9.2.4 Nsmsf_SMService_UplinkSMS service operation
**Service operation name:** Nsmsf_SMService_UplinkSMS.
**Description:** transmit uplink SMS message from consumer NF to SMSF.
**Concurrent use:** None.
**Inputs, Required:** SUPI, SMS payload.
**Inputs, Optional:** GPSI, UE Time Zone, UE Location Information (ULI).
**Outputs, Required:** SMS message transmission result.
**Outputs, Optional:** None.
##### 5.2.9.2.5 Nsmsf_SMService_MtForwardSm service operation
**Service operation name:** Nsmsf_SMService_MtForwardSm.
**Description:** Transmit downlink SMS message from consumer NF to SMSF.
**Inputs, Required:** GPSI, SMS payload.
**Inputs, Optional:** None.
**Outputs, Required:** SMS message transmission result.
**Outputs, Optional:** None.
### 5.2.10 AUSF Services
#### 5.2.10.1 General
The following table illustrates the AUSF Services.
Table 5.2.10.1-1: List of AUSF Services
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Nausf_UE | Authenticate | Re | AMF | | Authentication | | quest/Response | | +----------------+----------------+----------------+----------------+ | Nausf\ | Protect | Re | UDM | | _SoRProtection | | quest/Response | | +----------------+----------------+----------------+----------------+ | Nausf\ | Protect | Re | UDM | | _UPUProtection | | quest/Response | | +----------------+----------------+----------------+----------------+
#### 5.2.10.2 Nausf_UEAuthentication service
##### 5.2.10.2.1 General
**Service Description:** the AUSF provides UE authentication service to the
requester NF. For AKA based authentication, this operation can be also used to
recover from synchronization failure situations.
##### 5.2.10.2.2 Nausf_UEAuthentication_Authenticate service operation
See TS 33.501 [15].
##### 5.2.10.2.3 Void
#### 5.2.10.3 Nausf_SoRProtection service
##### 5.2.10.3.1 General
**Service Description:** The AUSF provides the Steering of Roaming information
protection service to the requester NF.
##### 5.2.10.3.2 Nausf_SoRProtection Protect service operation
See TS 33.501 [15].
#### 5.2.10.4 Nausf_UPUProtection service
##### 5.2.10.4.1 General
**Service Description:** The AUSF provides the UE Parameters Update protection
service to the requester NF.
##### 5.2.10.4.2 Nausf_UPUProtection Protect service operation
See TS 33.501 [15].
#### 5.2.10.5 Void
### 5.2.11 NWDAF Services
The NWDAF services are defined in TS 23.288 [50].
#### 5.2.11.1 Void
#### 5.2.11.2 Void
#### 5.2.11.3 Void
### 5.2.12 UDR Services
#### 5.2.12.1 General
The following Data Set Identifiers shall be considered in this release:
Subscription Data, Policy Data, Application data and Data for Exposure. The
corresponding Data Subset Identifiers and Data (Sub)Key(s) are defined in
Table 5.2.12.2.1-1.
The set of Data Set Identifiers shall be extensible to cater for new
identifiers as well as for operator specific identifiers and related data to
be consumed.
The following table illustrates the UDR Services.
Table 5.2.12.1-1: NF services provided by UDR
NF service Service Operations Operation Semantics Example Consumer(s)
* * *
Data Management (DM) Query Request/Response UDM, PCF, NEF Create
Request/Response NEF Delete Request/Response NEF Update Request/Response UDM,
PCF, NEF Subscribe Subscribe/Notify UDM, PCF, NEF Unsubscribe UDM, PCF, NEF
Notify UDM, PCF, NEF GroupIDmap Query Request/Response NRF, SCP
The following table shows the Exposure data that may be stored in the UDR
along with a time stamp using Data Management (DM) Service:
NOTE: When the data in Table 5.2.12.1-2 need to be monitored in real time,
they should be monitored directly at the originating NF (e.g. registration
state changes may be monitored via the Namf_EventExposure service) and not use
the stored information from UDR if it is not the latest. It is expected that
such dynamically changing information (e.g. UE reachability status) is used
for statistical purpose and analytics.
Table 5.2.12.1-2: Exposure data stored in the UDR
+-------------+-------------+-------------+-------------+-------------+ | Category | Information | Description | Data key | Data Sub | | | | | | key | +=============+=============+=============+=============+=============+ | **Access | UE location | Gives the | SUPI or | | | and | | Location or | GPSI | | | mobility | | the last | | | | in | | known | | | | formation** | | location of | | | | | | a UE (e.g. | | | | | | Tai, Cell | | | | | | Id... both | | | | | | 3GPP and | | | | | | non-3GPP | | | | | | access | | | | | | location) | | | +-------------+-------------+-------------+-------------+-------------+ | | UE time | Current | SUPI or | | | | zone | time zone | GPSI | | | | | for the UE | | | +-------------+-------------+-------------+-------------+-------------+ | | UE Access | 3GPP access | SUPI or | | | | type | or non-3GPP | GPSI | | | | | access | | | +-------------+-------------+-------------+-------------+-------------+ | | UE RAT type | Determined | SUPI or | | | | | as defined | GPSI | | | | | in | | | | | | cla | | | | | | use 5.3.2.3 | | | | | | of | | | | | | TS 23 | | | | | | .501 [2]. | | | | | | | | | | | | The values | | | | | | are defined | | | | | | in | | | | | | TS 29 | | | | | | .571 [70] | | | +-------------+-------------+-------------+-------------+-------------+ | | UE | Registered | SUPI or | | | | r | or | GPSI | | | | egistration | D | | | | | state | eregistered | | | +-------------+-------------+-------------+-------------+-------------+ | | UE | IDLE or | SUPI or | | | | c | CONNECTED | GPSI | | | | onnectivity | | | | | | state | | | | +-------------+-------------+-------------+-------------+-------------+ | | UE | It | SUPI or | | | | r | indicates | GPSI | | | | eachability | if the UE | | | | | status | is | | | | | | reachable | | | | | | for sending | | | | | | either SMS | | | | | | or downlink | | | | | | data to the | | | | | | UE, which | | | | | | is detected | | | | | | when the UE | | | | | | transitions | | | | | | to | | | | | | C | | | | | | M-CONNECTED | | | | | | state or | | | | | | when the UE | | | | | | will become | | | | | | reachable | | | | | | for paging, | | | | | | e.g. | | | | | | Periodic | | | | | | R | | | | | | egistration | | | | | | Update | | | | | | timer | | | +-------------+-------------+-------------+-------------+-------------+ | | UE SMS over | SMS over | SUPI or | | | | NAS service | NAS | GPSI | | | | status | supported | | | | | | or not in | | | | | | the UE | | | +-------------+-------------+-------------+-------------+-------------+ | | UE Roaming | It | SUPI or | | | | status | indicates | GPSI | | | | | UE\'s | | | | | | current | | | | | | roaming | | | | | | status (the | | | | | | serving | | | | | | PLMN and/or | | | | | | whether the | | | | | | UE is in | | | | | | its HPLMN) | | | +-------------+-------------+-------------+-------------+-------------+ | | UE Current | Current | SUPI or | | | | PLMN | PLMN for | GPSI | | | | | the UE | | | +-------------+-------------+-------------+-------------+-------------+ | **Session | UE IP | UE IP | SUPI or | PDU session | | m | address | address | GPSI | ID or DNN | | anagement** | | | | | +-------------+-------------+-------------+-------------+-------------+ | **in | PDU session | Active / | SUPI or | PDU session | | formation** | status | released | GPSI | ID or DNN | | | | | | or UE IP | | | | | | address | +-------------+-------------+-------------+-------------+-------------+ | | DNAI | DNAI | SUPI or | PDU session | | | | | GPSI | ID or DNN | | | | | | or UE IP | | | | | | address | +-------------+-------------+-------------+-------------+-------------+ | | N6 traffic | N6 traffic | SUPI or | PDU session | | | routing | routing | GPSI | ID or DNN | | | information | information | | or UE IP | | | | | | address | +-------------+-------------+-------------+-------------+-------------+ | **DNAI | DNAI | DNAI | DNN and/or | | | mapping | | mapping | S-NSSAI | | | in | | information | | | | formation** | | | | | +-------------+-------------+-------------+-------------+-------------+
#### 5.2.12.2 Nudr_DataManagement (DM) service
##### 5.2.12.2.1 General
The operations defined for Nudr_DM service use following set of parameters
defined in this clause:
\- Data Set Identifier: uniquely identifies the requested set of data within
the UDR (see clause 4.2.5).
\- Data Subset Identifier: it uniquely identifies the data subset within each
Data Set Identifier. As specified in the procedures in clause 4, e.g.
subscription data can consist of subsets particularised for specific
procedures like mobility, session, etc.
\- Data Keys defined in Table 5.2.12.2.1-1
For Nudr_DM_Subscribe and Nudr_DM_Notify operations:
\- The Target of Event Reporting is made up of a Data Key and possibly a Data
Sub Key both defined in Table 5.2.12.2.1-1. When a Data Sub Key is defined in
the table but not present in the Nudr_DM_Subscribe this means that all values
of the Data Sub Key are targeted.
\- The Data Set Identifier plus (if present) the (set of) Data Subset
Identifier(s) corresponds to a (set of) Event ID(s) as defined in clause
4.15.1
An NF Service Consumer may include an indicator when it invokes Nudr_DM
Query/Create/Update service operation to subscribe the changes of the data, to
avoid a separate Nudr_DM_Subscribe service operation.
Depending on the use case, it is possible to use a Data Key and/or one or
multiple Data sub keys to further identify the corresponding data, as defined
in Table 5.2.12.2.1-1 below.
Table 5.2.12.2.1-1: Data keys
+----------------+----------------+----------------+----------------+ | Data Set | Data Subset | Data Key | Data Sub Key | +================+================+================+================+ | | Access and | SUPI | Serving PLMN | | | Mobility | | ID and | | | Subscription | | optionally NID | | | data | | | +----------------+----------------+----------------+----------------+ | | SMF Selection | SUPI | Serving PLMN | | | Subscription | | ID and | | | data | | optionally NID | +----------------+----------------+----------------+----------------+ | | UE context in | SUPI | PDU Session ID | | | SMF data | | or DNN | +----------------+----------------+----------------+----------------+ | Subscription | SMS Management | SUPI | Serving PLMN | | Data (see | Subscription | | ID and | | cla | data | | optionally NID | | use 5.2.3.3.1) | | | | +----------------+----------------+----------------+----------------+ | | SMS | SUPI | Serving PLMN | | | Subscription | | ID and | | | data | | optionally NID | +----------------+----------------+----------------+----------------+ | | Session | SUPI | S-NSSAI | | | Management | | | | | Subscription | | | | | data | | | +----------------+----------------+----------------+----------------+ | | | | DNN | +----------------+----------------+----------------+----------------+ | | | | Serving PLMN | | | | | ID and | | | | | optionally NID | +----------------+----------------+----------------+----------------+ | | Slice | SUPI | Serving PLMN | | | Selection | | ID and | | | Subscription | | optionally NID | | | data | | | +----------------+----------------+----------------+----------------+ | | Group Data | Internal Group | - | | | | Identifier or | | | | (NOTE 5) | | | | | | External Group | | | | | Identifier | | +----------------+----------------+----------------+----------------+ | | Identifier | GPSI | | | | translation | | | +----------------+----------------+----------------+----------------+ | | | SUPI | Application | | | | | Port ID, MTC | | | | | Provider | | | | | Information, | | | | | AF Identifier | +----------------+----------------+----------------+----------------+ | | Intersystem | SUPI | DNN | | | continuity | | | | | Context | | | +----------------+----------------+----------------+----------------+ | | LCS privacy | SUPI | - | +----------------+----------------+----------------+----------------+ | | LCS mobile | SUPI | - | | | origination | | | +----------------+----------------+----------------+----------------+ | | UE | SUPI | - | | | reachability | | | +----------------+----------------+----------------+----------------+ | | Group | Internal Group | - | | | Identifier | Identifier or | | | | Translation | | | | | | External Group | | | | | Identifier | | +----------------+----------------+----------------+----------------+ | | UE context in | SUPI | - | | | SMSF data | | | +----------------+----------------+----------------+----------------+ | | V2X | SUPI | - | | | Subscription | | | | | data | | | +----------------+----------------+----------------+----------------+ | | A2X | SUPI | - | | | Subscription | | | | | data | | | +----------------+----------------+----------------+----------------+ | | ProSe | SUPI | - | | | Subscription | | | | | data | | | +----------------+----------------+----------------+----------------+ | | User consent | SUPI | Purpose | +----------------+----------------+----------------+----------------+ | | ECS Address | SUPI, Internal | DNN, S-NSSAI, | | | Configuration | group | (Serving) PLMN | | | Information | identifier or | ID (NOTE 7) | | | (See Table | external group | | | | 4.15.6.3d-1) | identifier or | | | | | any UE | | +----------------+----------------+----------------+----------------+ | | MBS | SUPI | - | | | Subscription | | | | | data | | | | | | | | | | (see | | | | | clause 6.4.3 | | | | | of | | | | | TS | | | | | 23.247 [78]) | | | +----------------+----------------+----------------+----------------+ | | Ra | SUPI | - | | | nging/Sidelink | | | | | Positioning | | | | | Subscription | | | | | data | | | +----------------+----------------+----------------+----------------+ | | Shared data | Shared Data ID | - | +----------------+----------------+----------------+----------------+ | Application | Packet Flow | Application | - | | data | Descriptions | Identifier | | | | (PFDs) | | | +----------------+----------------+----------------+----------------+ | | AF traffic | AF transaction | | | | influence | internal ID | | | | request | | | | | information | | | | | for traffic | | | | | routing | | | +----------------+----------------+----------------+----------------+ | | (See | S-NSSAI and | | | | clause 5.6.7 | DNN | | | | and | | | | | clause 6.3.7.2 | accompanied | | | | of | with | | | | TS | | | | | 23.501 [2]) | Internal Group | | | | | Identifier(s) | | | | | and/or | | | | | Subscriber | | | | | Category(s) or | | | | | SUPI or \"any | | | | | UE\" | | | | | indication | | | | | (NOTE 4) | | | | | (NOTE 6) | | +----------------+----------------+----------------+----------------+ | | AF traffic | AF transaction | | | | influence | internal ID | | | | request | | | | | information | | | | | for service | | | | | function | | | | | chaining | | | +----------------+----------------+----------------+----------------+ | | (See | S-NSSAI and | | | | clause 5.6.16 | DNN | | | | and | | | | | clause 6.3.7.2 | and | | | | of | | | | | TS | Internal Group | | | | 23.501 [2]) | Identifier or | | | | | SUPI or \"any | | | | | UE\" | | | | | indication | | | | | (NOTE 4) | | +----------------+----------------+----------------+----------------+ | | Background | Internal Group | | | | Data Transfer | Identifier or | | | | | SUPI | | | | (NOTE 3) | | | +----------------+----------------+----------------+----------------+ | | Service | S-NSSAI and | | | | specific | DNN | | | | information | | | | | (See | or | | | | cl | | | | | ause 4.15.6.7) | Internal Group | | | | | Identifier or | | | | | SUPI or \"any | | | | | UE\" | | | | | indication | | | | | (NOTE 4) or | | | | | \"PLMN ID(s) | | | | | of inbound | | | | | roamer\" | | +----------------+----------------+----------------+----------------+ | | EAS Deployment | DNN and/or | Application | | | Information | S-NSSAI | Identifier | | | | | and/or | | | (See | | Internal Group | | | clause 7.1 of | | Identifier | | | TS | | | | | 23.548 [74]) | | | +----------------+----------------+----------------+----------------+ | | AM influence | AF transaction | | | | information | internal ID | | | | (See | | | | | clau | | | | | se 4.15.6.9.3) | | | +----------------+----------------+----------------+----------------+ | | | S-NSSAI and | | | | | DNN | | | | | | | | | | and/or | | | | | | | | | | Internal Group | | | | | Identifier or | | | | | SUPI or \"any | | | | | UE\" | | | | | indication or | | | | | any inbound | | | | | roaming UEs | | | | | (NOTE 4, | | | | | NOTE 8) | | +----------------+----------------+----------------+----------------+ | | AF request for | AF transaction | | | | QoS | internal ID | | | | information | | | | | (See | | | | | cla | | | | | use 4.15.6.14) | | | +----------------+----------------+----------------+----------------+ | | | S-NSSAI and | | | | | DNN | | | | | | | | | | and/or | | | | | | | | | | Internal Group | | | | | Identifier or | | | | | SUPI or \"any | | | | | UE\" | | | | | indication | | | | | (NOTE 4) | | +----------------+----------------+----------------+----------------+ | Policy Data | UE context | SUPI | | | | policy control | | | | | data | | | | | | | | | | (See | | | | | clause 6.2.1.3 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | PDU Session | SUPI | S-NSSAI | | | policy control | | | | | data | | | +----------------+----------------+----------------+----------------+ | | (See | | DNN | | | clause 6.2.1.3 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | Policy Set | SUPI (for the | | | | Entry data | UDR in HPLMN) | | | | | | | | | (See | | | | | clause 6.2.1.3 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | | PLMN ID (for | | | | | the UDR in | | | | | VPLMN) | | +----------------+----------------+----------------+----------------+ | | Remaining | SUPI | S-NSSAI | | | allowed Usage | | | | | data | | | +----------------+----------------+----------------+----------------+ | | (See | | DNN | | | clause 6.2.1.3 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | Sponsored data | Sponsor | | | | connectivity | Identity | | | | profiles (See | | | | | clause 6.2.1.6 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | Background | Background | | | | Data Transfer | Data Transfer | | | | data | Reference ID. | | | | | (NOTE 2) | | | | (See | | | | | clause 6.2.1.6 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | | None. (NOTE 1) | | +----------------+----------------+----------------+----------------+ | | Network Slice | S-NSSAI | | | | Specific | | | | | Control Data | | | | | | | | | | (See | | | | | clause 6.2.1.3 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | Operator | SUPI or GPSI | | | | Specific Data | | | +----------------+----------------+----------------+----------------+ | | Planned Data | PDTQ Reference | | | | Transfer with | ID. (NOTE 10) | | | | QoS | | | | | requirements | | | | | data | | | | | | | | | | (See | | | | | clause 6.2.1.6 | | | | | of | | | | | TS | | | | | 23.503 [20]) | | | +----------------+----------------+----------------+----------------+ | | | None. (NOTE 9) | | +----------------+----------------+----------------+----------------+ | Exposure Data | Access and | SUPI or GPSI | PDU Session ID | | | Mobility | | or | | | Information | | | +----------------+----------------+----------------+----------------+ | (see | Session | SUPI or GPSI | UE IP address | | cl | Management | | or DNN | | ause 5.2.12.1) | information | | | +----------------+----------------+----------------+----------------+ | | DNAI mapping | DNN and/or | | | | information | S-NSSAI | | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Retrieval of | | | | | the stored | | | | | Background | | | | | Data Transfer | | | | | data for all | | | | | ASP | | | | | identifiers in | | | | | the UDR | | | | | requires Data | | | | | Subset but no | | | | | Data Key or | | | | | Data | | | | | Subkey(s). | | | | | | | | | | NOTE 2: Update | | | | | of a | | | | | Background | | | | | Data Transfer | | | | | data in the | | | | | UDR requires a | | | | | Data key to | | | | | refer to a | | | | | Background | | | | | Data Transfer | | | | | data as input | | | | | data. | | | | | | | | | | NOTE 3: The | | | | | Background | | | | | Data Transfer | | | | | includes the | | | | | Background | | | | | Data Reference | | | | | ID and the ASP | | | | | Identifier | | | | | that requests | | | | | to apply the | | | | | Background | | | | | Data Reference | | | | | ID to the | | | | | UE(s). | | | | | Furthermore, | | | | | the Background | | | | | Data Transfer | | | | | includes the | | | | | relevant | | | | | information | | | | | received from | | | | | the AF as | | | | | defined in | | | | | clause 6.1.2.4 | | | | | of | | | | | TS | | | | | 23.503 [20]. | | | | | | | | | | NOTE 4: When | | | | | the Data Key | | | | | targets \"any | | | | | UE\", then the | | | | | request to UDR | | | | | applies on | | | | | Application | | | | | data that | | | | | applies on all | | | | | subscribers of | | | | | the PLMN. For | | | | | encoding, see | | | | | TS | | | | | 29.519 [82]. | | | | | | | | | | NOTE 5: Group | | | | | Data includes | | | | | 5G VN group | | | | | configuration, | | | | | DNN and | | | | | S-NSSAI | | | | | specific Group | | | | | Parameters and | | | | | any other data | | | | | related to a | | | | | group stored | | | | | in the UDR. | | | | | | | | | | NOTE 6: If a | | | | | list of | | | | | Internal Group | | | | | IDs is used, | | | | | the AF traffic | | | | | influence | | | | | request | | | | | information | | | | | request | | | | | applies to the | | | | | UEs that | | | | | belong to | | | | | every one of | | | | | these groups, | | | | | i.e. a single | | | | | UE needs to be | | | | | a member of | | | | | every group in | | | | | the list of | | | | | Internal Group | | | | | IDs. | | | | | | | | | | NOTE 7: When | | | | | the Data Key | | | | | targets \"PLMN | | | | | ID\", then the | | | | | request to UDR | | | | | applies on | | | | | subscription | | | | | data about | | | | | subscribers | | | | | roaming in | | | | | this PLMN. | | | | | | | | | | NOTE 8: In LBO | | | | | roaming | | | | | scenarios, | | | | | when the AF | | | | | request | | | | | targets \"any | | | | | inbound | | | | | roaming UEs\", | | | | | the AM | | | | | influence | | | | | information | | | | | applies to the | | | | | roaming | | | | | subscribers | | | | | from a PLMN or | | | | | from any PLMN. | | | | | | | | | | NOTE 9: | | | | | Retrieval of | | | | | the stored | | | | | Planned Data | | | | | Transfer with | | | | | QoS | | | | | requirements | | | | | data for all | | | | | ASP | | | | | identifiers in | | | | | the UDR | | | | | requires Data | | | | | Subset but no | | | | | Data Key or | | | | | Data | | | | | Subkey(s). | | | | | | | | | | NOTE 10: | | | | | Update of a | | | | | Planned Data | | | | | Transfer with | | | | | QoS | | | | | requirements | | | | | data in the | | | | | UDR requires a | | | | | Data key to | | | | | refer to a | | | | | Planned Data | | | | | Transfer with | | | | | QoS | | | | | requirements | | | | | data as input | | | | | data. | | | | +----------------+----------------+----------------+----------------+
The content of the UDR storage for (Data Set Id= Application Data, Data Subset
Id = AF TrafficInfluence request information) is specified in clause 5.6.7,
Table 5.6.7-1 of TS 23.501 [2]. This information is written by the NEF and
read by the PCF(s). PCF(s) may also subscribe to changes onto this
information.
##### 5.2.12.2.2 Nudr_DM_Query service operation
**Service operation name:** Nudr_DM_Query.
**Description:** NF service consumer requests a set of data from UDR.
**Inputs, Required:** Data Set Identifier, Data Key(s).
**Inputs, Optional:** Data Subset Identifier(s), Data Sub Key(s) (for each
Data Subset, see clause 5.2.12.2.1).
**Outputs, Required:** Requested data.
**Outputs, Optional:** None.
##### 5.2.12.2.3 Nudr_DM_Create service operation
**Service operation name:** Nudr_DM_Create.
**Description:** NF service consumer intends to insert a new data record into
the UDR, e.g. a NF service consumer intends to insert a new application data
record into the UDR.
**Inputs, Required:** Data Set Identifier, Data Key(s).
**Inputs, Optional:** Data Subset Identifier(s), Data Sub Key(s) (for each
Data Subset, see clause 5.2.12.2.1).
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.12.2.4 Nudr_DM_Delete service operation
**Service operation name:** Nudr_DM_Delete.
**Description:** NF service consumer intends to delete user data stored in the
UDR, e.g. a NF service consumer intends to delete an application data record.
**Inputs, Required:** Data Set Identifier, Data Key(s).
**Inputs, Optional:** Data Subset Identifier(s), Data Sub Key(s) (for each
Data Subset, see clause 5.2.12.2.1).
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.12.2.5 Nudr_DM_Update service operation
**Service operation name:** Nudr_DM_Update.
**Description:** NF service consumer intends to update stored data in the UDR.
**Inputs, Required:** Data Set Identifier, Data Key(s), Data.
**Inputs, Optional:** Data Subset Identifier(s), Data Sub Key(s) (for each
Data Subset, see clause 5.2.12.2.1).
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.12.2.6 Nudr_DM_Subscribe service operation
**Service operation name:** Nudr_DM_Subscribe.
**Description:** NF service consumer performs the subscription to notification
to data modified in the UDR. The events can be changes on existing data,
addition of data.
**Inputs, Required:** Data Set Identifier as defined in clause 5.2.12.2.1,
Notification Target Address (+ Notification Correlation ID).
**Inputs, Optional:** Target of Event Reporting as defined in clause
5.2.12.2.1, Data Subset Identifier(s) as defined in clause 5.2.12.2.1, Data
Key(s), Subscription Correlation ID (in the case of modification of the event
subscription).
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID.
**Outputs, Optional:** None.
##### 5.2.12.2.7 Nudr_DM_Unsubscribe service operation
**Service operation name:** Nudr_DM_Unsubscribe
**Description:** NF service consumer performs the un-subscription to
notification to data modified in the UDR. The events can be changes on
existing data, addition of data.
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.12.2.8 Nudr_DM_Notify service operation
**Service operation name:** Nudr_DM_Notify.
**Description:** UDR notifies NF service consumer(s) about modification of
data, when data in the UDR is added, modified or deleted and an NF needs to be
informed about this, due to a previous subscription to notifications procedure
or due to a local configuration policy in the UDR.
**Inputs, Required:** Notification Correlation Information, Data Set
Identifier as defined in clause 5.2.12.2.1, Target of Event Reporting as
defined in clause 5.2.12.2, Updated Data.
**Inputs, Optional:** Data Subset Identifier as defined in clause 5.2.12.2.1.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
#### 5.2.12.3 Nudr_GroupIDmap service
##### 5.2.12.3.1 General
The Nudr_GroupIDmap service allows an NF consumer to retrieve a NF group ID
corresponding to a subscriber identifier.
##### 5.2.12.3.2 Nudr_GroupIDmap_query service operation
**Service Operation name:** Nudr_GroupIDmap_query
**Description:** Provides towards the invoking NF the NF Group ID
corresponding to the supplied subscriber identifier.
**Inputs, Required:**
\- NF Type (e.g. HSS).
\- Subscriber Identifier.
\- Subscriber Identifier Type (at least one of {IMPI, IMPU, SUPI, GPSI}).
**Inputs, Optional:** None.
**Outputs, Required:** NF Group ID.
**Outputs, Optional:** None.
### 5.2.13 BSF Services
#### 5.2.13.1 General
The following table shows the BSF Services and Service Operations:
Table 5.2.13.1-1: NF services provided by the BSF
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Nb | Register | Re | PCF | | sf_Management | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Deregister | Re | PCF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Discovery | Re | NEF, AF, | | | | quest/Response | NWDAF, TSCTSF | +----------------+----------------+----------------+----------------+ | | Update | Re | PCF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Subscsribe | Su | NEF, PCF, AF, | | | | bscribe/Notify | TSCTSF, 5G | | | | | DDNMF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | Su | NEF, PCF, AF, | | | | bscribe/Notify | TSCTSF, 5G | | | | | DDNMF | +----------------+----------------+----------------+----------------+ | | Notify | Su | NEF, PCF, AF, | | | | bscribe/Notify | TSCTSF, 5G | | | | | DDNMF | +----------------+----------------+----------------+----------------+
#### 5.2.13.2 Nbsf_Management service
##### 5.2.13.2.1 General
The Nbsf provides the Nbsf_Management_Register, the Nbsf_Management_Deregister
and the Nbsf_Management_Discovery services, the Nbsf_Management_Update, the
Nbsf_Management_Subscribe, the Nbsf_Management_Unsubscribe and the
Nbsf_Management_Notify operations.
##### 5.2.13.2.2 Nbsf_Management_Register service operation
**Service Operation name:** Nbsf_Management_Register
**Description:** Registers the tuple (UE address(es), SUPI, GPSI, MBS session
ID, DNN, S-NSSAI, PCF address(es), PCF instance id, PCF Set ID, level of
Binding) for a PDU Session or for a UE.
NOTE 1: In some cases only subset of these parameters may be registered (e.g.
UE address(es) will be registered only if PCF registration is for a PDU
Session and for MBS sessions SUPI and GPSI are also not available).
**Inputs, Required:** [Required, if PCF registration is for a PDU Session], UE
address(es), PCF address(es), DNN [Required, if PCF registration is for a PDU
Session], S-NSSAI [Required, if PCF registration is for a PDU Session], MBS
session ID as defined in TS 23.247 [78] [Required, if PCF registration is for
a MBS Session].
UE address can contain IP address/prefix or MAC address as defined in TS
23.501 [2]. It can optionally include Framed Route information. W-5GAN
specific UE IP address information is specified in TS 23.316 [53].
Framed Route information is defined in Table 5.2.3.3.1-1.
NOTE 2: For support of time sensitive communication and time synchronization
(as described in clause 5.28.3.2 of TS 23.501 [2]) the UE address contains the
DS-TT port MAC address for Ethernet type PDU Session.
**Inputs, Conditional:** SUPI [Required, if PCF registration is for a UE or
required by the local policy in PCF if the registration is for a PDU session,
otherwise it is optional].
NOTE 3: The PCF can be configured to always provide a SUPI to the BSF, e.g. to
support UE ID retrieval from the BSF.
**Inputs, Optional:** GPSI, PCF instance ID and PCF Set ID, level of Binding
(see clause 6.3.1.0 of TS 23.501 [2]).
NOTE 4: DNN and S-NSSAI are not applicable when the PCF registration is for a
UE.
NOTE 5: It is up to stage3 to ensure an unambiguous error proof way for the
BSF to differentiate between PCF for a PDU Session and PCF for a UE. This may
or may not require providing the BSF additional parameter(s) when a PCF
registers itself with the BSF.
**Outputs, Required:** Result indication, Binding Identifier for a PDU
Session, or for a UE, or for an MBS session.
**Outputs, Optional:** None.
##### 5.2.13.2.3 Nbsf_Management_Deregister service operation
**Service Operation name:** Nbsf_Management_Deregister
**Description:** Removes the binding information for a PDU Session or for a
UE.
**Inputs, Required:** Binding Identifier for a PDU Session, or for a UE, or
for an MBS session.
W-5GAN specific UE IP address information are specified in TS 23.316 [53].
**Inputs, Optional:**
**Outputs, Required:** Result indication.
**Outputs, Optional:** None.
##### 5.2.13.2.4 Nbsf_Management_Discovery service operation
**Service Operation name:** Nbsf_Management discovery
**Description:** Discovers the PCF and PCF set selected for a PDU Session
identified by the tuple (UE address(es), SUPI, GPSI, DNN, S-NSSAI), or
discovers the PCF and PCF set selected for the UE identified by the tuple
(SUPI, GPSI). This operation may also be used to determine the SUPI from the
tuple (UE address, DNN, S-NSSAI).
**Inputs, Required:** UE address (i.e. IP address or MAC address), [Required,
for a PDU Session and for a UE], DNN [Conditional], S-NSSAI [Conditional], if
the target PCF is for a PDU Session, MBS session ID as defined in TS 23.247
[78], [Required, for an MBS Session].
SUPI and/or GPSI, if the target PCF is for a UE.
NOTE: For support of time sensitive communication and time synchronization (as
described in clause 5.28.3.2 of TS 23.501 [2]) the UE address contains the DS-
TT port MAC address for Ethernet type PDU Session.
**Inputs, Optional:** If the target PCF is for a PDU Session, SUPI, GPSI.
**Outputs, Required:** PCF address(es), PCF instance ID [Conditional, if
available] and PCF Set ID [Conditional, if available], level of Binding
[Conditional, if available] (see clause 6.3.1.0 of TS 23.501 [2]).
**Outputs, Optional:** SUPI, if available.
##### 5.2.13.2.5 Nbsf_Management_Update service operation
**Service Operation name:** Nbsf_Management_Update
**Description:** Replaces the list of UE address(es) for a PDU Session or
replace PCF id or PCF address(es) for a PDU Session or for a UE..
NOTE 1: For example, PCF-2 may update its PCF id when level of binding is NF
Instance and PCF-1 fails and PCF-2 is the new NF Instance handling the PDU
Session or the UE.
**Inputs, Required:** Binding Identifier for the PDU Session.
UE address can contain IP address/prefix or Ethernet address as defined in TS
23.501 [2].
NOTE 2: For support of time sensitive communication and time synchronization
(as described in clause 5.28.3.2 of TS 23.501 [2]) the UE address contains the
DS-TT port MAC address for Ethernet type PDU Session.
**Inputs, Optional:** UE address(es), PCF id, PCF address(es).
**Outputs, Required:** Result indication.
**Outputs, Optional:** None.
##### 5.2.13.2.6 Nbsf_Management_Subscribe service operation
**Service Operation name:** Nbsf_Management_Subscribe
**Description:** NEF, AF, TSCTSF or PCF for a UE can subscribe to be notified
of newly registered or deregistered PCF for a PDU Session. In addition, NEF or
AF can subscribe to be notified of newly registered or deregistered PCF for a
UE.
NOTE 1: If BSF has already the requested information at the time of the
subscription, it will accept the subscription request and will immediately
provide the results in the Outputs parameters.
**Inputs, Required:** SUPI, DNN(s) [Required, if PCF subscription is for a PDU
Session], S-NSSAI(s) [Required, if PCF subscription is for a PDU Session],
callback URI.
**Inputs, Optional:** GPSI, indication of registration/deregistration per
(DNN, S-NSSAI).
Indication of registration/deregistration per (DNN, S-NSSAI) indicates to the
BSF to report when the first SM policy association is established and when the
last SM policy association is terminated to the same (DNN, S-NSSAI)
combination.
NOTE 2: It is up to stage3 to ensure an unambiguous error proof way for the
BSF to differentiate between PCF for a PDU Session and PCF for a UE. This may
or may not require providing the BSF additional input parameter(s).
**Outputs, Required:** When the subscription is accepted: Subscription
Correlation ID.
**Outputs, Conditional:** One or more instance per (DNN, S-NSSAI) of (UE
address(es) [If available], PCF address(es) [If available], PCF instance ID
[If available], PCF Set ID [If available], level of Binding [If available]
(see clause 6.3.1.0 of TS 23.501 [2])) or notification of
registration/deregistration per (DNN, S-NSSAI).
NOTE 3: The parameter UE address(es) is not applicable in the case of PCF for
a UE.
##### 5.2.13.2.7 Nbsf_Management_Unsubscribe service operation
**Service Operation name:** Nbsf_Management_Unsubscribe
**Description:** NEF, AF, TSCTSF or PCF for a UE can undo a previous
subscription.
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** result.
**Outputs, Optional:** None.
##### 5.2.13.2.8 Nbsf_Management_Notify service operation
**Service Operation name:** Nbsf_Management_Notify
**Description:** BSF can notify NEF, AF, TSCTSF or PCF for a UE of newly
registered PCF for a PDU Session or of deregistered PCF for a PDU Session.
**Inputs, Required:** Notification Correlation Information, One or more
instance per (DNN, S-NSSAI) of (UE address(es) [Required, if PCF notification
is for a PDU Session], PCF address(es), PCF instance ID [Conditional, if
available] and PCF Set ID [Conditional, if available]), level of Binding
[Conditional, if available] (see clause 6.3.1.0 of TS 23.501 [2]) or
notification of registration/deregistration per (DNN, S-NSSAI).
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
### 5.2.14 UDSF Services
#### 5.2.14.1 General
The following table illustrates the UDSF Services.
Table 5.2.14-1: NF Services provided by UDSF
NF service Service Operations Operation Semantics Example Consumer(s)
* * *
UnstructuredData Query Request/Response Any NF Management Create
Request/Response Any NF Delete Request/Response Any NF Update Request/Response
Any NF Subscribe Subscribe/Notify Any NF Unsubscribe Subscribe/Notify Any NF
Notify Subscribe/Notify Any NF Nudsf_Timer Start Request/Response Any NF Stop
Request/Response Any NF Update Request/Response Any NF Search Request/Response
Any NF Notify Subscribe/Notify Any NF
NOTE: Nudsf is different compared to other service-based interfaces due to
dynamic data access performance requirements.
#### 5.2.14.2 Nudsf_UnstructuredDataManagement service
##### 5.2.14.2.1 General
##### 5.2.14.2.2 Nudsf_UnstructuredDataManagement_Query service operation
**Service operation name:** Nudsf_UnstructuredDataManagement_Query.
**Description:** NF service consumer intends to query data from UDSF.
**Inputs, Required:** Data Identifier.
Data Identifier uniquely identifies the data to be retrieved from the UDSF
**Inputs, Optional:** None.
**Outputs, Required:** Requested data.
**Outputs, Optional:** None.
##### 5.2.14.2.3 Nudsf_UnstructuredDataManagement_Create service operation
**Service operation name:** Nudsf_UnstructuredDataManagement_Create.
**Description:** NF service consumer intends to insert a new user data record
into the UDSF, e.g. AMF stores the context for registered UE(s) in the UDSF.
**Inputs, Required:** Data Identifier, Data.
Data Identifier uniquely identifies the data, which is created in the UDSF.
**Inputs, Optional:** Validity time, Notification Endpoint.
Validity time tells for how long the created data is valid. When validity time
has expired, NF service consumer is notified and data is removed.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.2.4 Nudsf_UnstructuredDataManagement_Delete service operation
**Service operation name:** Nudsf_UnstructuredDataManagement_Delete.
**Description:** NF service consumer intends to delete user data stored in the
UDSF, e.g. when AMF deletes the context for unregistered UE(s) in the UDSF.
**Inputs, Required:** Data Identifier.
**Inputs, Optional:** None.
Data Identifier uniquely identifies the data to be deleted within the UDSF.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.2.5 Nudsf_UnstructuredDataManagement_Update service operation
**Service operation name:** Nudsf_UnstructuredDataManagement_Update.
**Description:** NF service consumer intends to update stored data in the
UDSF.
**Inputs, Required:** Data Identifier, Data.
Data Identifier uniquely identifies the data, which is updated in the UDSF.
**Inputs, Optional:** Validity time.
Validity time tells for how long the created data is valid. When validity time
has expired, NF service consumer is notified and data is removed.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.2.6 Nudsf_UnstructuredDataManagement_Subscribe
**Service operation name:** Nudsf_UnstructuredDataManagement_Subscribe
**Description:** NF service consumer subscribes to notifications of data
change in the UDSF.
**Inputs, Required:** Identity of data to be monitored, Notification endpoint.
**Inputs, Optional:** None.
**Outputs, Required:** Subscription ID.
**Outputs, Optional:** None.
##### 5.2.14.2.7 Nudsf_UnstructuredDataManagement_Unsubscribe
**Service operation name:** Nudsf_UnstructuredDataManagement_Unsubscribe
**Description:** NF service consumer un-subscribes to notifications of data
change in the UDSF.
**Inputs, Required:** Subscription ID.
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.2.8 Nudsf_UnstructuredDataManagement_Notify
**Service operation name:** Nudsf_UnstructuredDataManagement_Notify
**Description:** NF is notifications of data change or if validity time for
created data has expired in the UDSF.
**Inputs, Required:** Data Identifier, Data.
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
#### 5.2.14.3 Nudsf_Timer service
##### 5.2.14.3.1 General
Any NF may use the UDSF to run timer(s), search for timer(s) and get
notifications on expiry.
##### 5.2.14.3.2 Nudsf_Timer_Start service operation
**Service operation name:** Nudsf_Timer_Start
**Description:** NF service consumer starts a timer in the UDSF.
**Inputs, Required:** Timer ID, Time of expiry.
**Inputs, Optional:** Notification Endpoint, Associated data.
Associated data is data that can be used by the consumer to identify for what
purpose the timer is for, e.g. a subscription that has timed out.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.3.3 Nudsf_Timer_Update service operation
**Service operation name:** Nudsf_Timer_Update
**Description:** NF service consumer updates a timer in the UDSF.
**Inputs, Required:** Timer Identity.
**Inputs, Optional:** Notification Endpoint, Associated data, Time of expiry.
Associated data is data that can be used by the consumer to identify for what
purpose the timer is for, e.g. a subscription that has timed out.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.3.4 Nudsf_Timer_Notify service operation
**Service operation name:** Nudsf_Timer_Notify
**Description:** The UDSF notifies the NF service consumer about a timer
expiry.
**Inputs, Required:** Timer Identity.
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.3.5 Nudsf_Timer_Stop service operation
**Service operation name:** Nudsf_Timer_Stop
**Description:** NF service consumer intends to stop timer(s) in the UDSF.
**Inputs, Required:** Timer Identity/Identities.
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Outputs, Optional:** None.
##### 5.2.14.3.6 Nudsf_Timer_Search service operation
**Service operation name:** Nudsf_Timer_Search
**Description:** NF service consumer intends to search and retrieve timers
matching a filter in the UDSF.
**Inputs, Required:** Search filter (see TS 29.598 [85]).
**Inputs, Optional:** Filter.
**Outputs, Required:** Result.
**Outputs, Optional:** Timer Identity/Identities.
### 5.2.15 LMF Services
LMF services are defined in clause 8.3 of TS 23.273 [51].
### 5.2.16 NSSF Services
#### 5.2.16.1 General
The following table illustrates the NSSF Services.
Table 5.2.16.1-1: NF Services provided by NSSF
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Nnss | Get | Re | AMF, NSSF in a | | f_NSSelection | | quest/Response | different | | | | | PLMN, SMF, | | | | | NWDAF | +----------------+----------------+----------------+----------------+ | Nnssf_NSS | Update | Re | AMF | | AIAvailability | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Subscribe | Su | AMF, NSSF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | AMF, NSSF | +----------------+----------------+----------------+----------------+ | | Notify | | AMF, NSSF | +----------------+----------------+----------------+----------------+ | | Delete | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+
NOTE: The SMF uses the Nnssf_NSSelection_Get service operation during EPS
interworking.
#### 5.2.16.2 Nnssf_NSSelection service
##### 5.2.16.2.1 Nnssf_NSSelection_Get service operation
**Service operation name:** Nnssf_NSSelection_Get
**Description:** This service operation enables Network Slice selection in
both the Serving PLMN and HPLMN. It also enables the NSSF to provide to the
AMF the Allowed NSSAI and the Configured NSSAI for the Serving PLMN. It allows
also to provide the NSAG information which is applicable (clause 5.15.14 of TS
23.501 [2]).
It may be invoked during Registration procedure, during inter-PLMN mobility
procedure, during PDU Session Establishment procedure or during UE
Configuration Update procedure. When invoked during Registration procedure it
may possibly trigger AMF re-allocation. When invoked during PDU Session
Establishment procedure it may be invoked in the VPLMN or in the HPLMN; if
invoked in the VPLMN it returns the hNRF selected by the hNSSF and if
applicable, the value of the HPLMN NSI ID. When invoked during UE
Configuration Update procedure or inter-PLMN mobility procedure it may be
invoked in the Serving PLMN.
NOTE 1: The list of events, which trigger invoking of the
Nnssf_NSSelection_Get service operation, is not exhaustive.
NOTE 2: The NSSF can determine the serving network and Access Type from the
TAI, as described in TS 29.571 [70].
**Inputs, Required:** None.
**Inputs, Conditional Required:**
If this service operation is invoked during Registration procedure for Network
Slice selection or UE Configuration Update procedure, then the following
inputs are required:
\- Subscribed S-NSSAI(s) with the indication if marked as default S-NSSAI,
PLMN ID of the SUPI, TAI, NF type of the NF service consumer, Requester ID.
If this service operation is invoked to derive the S-NSSAI for the serving
PLMN (as described in clause 4.11.1.3.3), the following inputs are required:
\- S-NSSAIs for the HPLMN associated with established PDN connection, PLMN ID
of the SUPI, NF type of the NF service consumer, Requester ID.
If this service operation is invoked by target AMF during inter-PLMN mobility
procedure, the following inputs are required:
\- S-NSSAIs for the HPLMN, PLMN ID of the SUPI, TAI.
If this service operation is invoked during PDN Connection Establishment in
the Serving PLMN in EPS by a SMF+PGW-C, the following inputs are required:
\- Subscribed S-NSSAIs for the UE, PLMN ID of the SUPI, NF type of the NF
service consumer, Requester ID.
If this service operation is invoked during PDU Session Establishment
procedure in the Serving PLMN then the following inputs are required:
\- S-NSSAI, non-roaming/LBO roaming/HR roaming indication, PLMN ID of the
SUPI, TAI, NF type of the NF service consumer, Requester ID.
**Inputs, Optional:**
If this service operation is invoked during Registration procedure for Network
Slice selection or UE Configuration Update procedure, then the following
inputs are provided if available:
\- Requested NSSAI, Mapping Of Requested NSSAI, Default Configured NSSAI
Indication, NSSRG Information, UE support of subscription-based restrictions
to simultaneous registration of network slice feature Indication, UDM
indication to provide all subscribed S-NSSAIs for UEs not indicating support
of subscription-based restrictions to simultaneous registration of network
slices, Allowed NSSAI for current Access Type, Allowed NSSAI for the other
Access Type and the corresponding Mapping Of Allowed NSSAIs for current Access
Type and other Access Type, Rejected S-NSSAI(s) for RA, UE support of NSAG
Information.
If this service operation is invoked during PDU Session Establishment
procedure, then the following input is optional:
\- HPLMN S-NSSAI that maps to the S-NSSAI from the Allowed NSSAI of the
Serving PLMN.
**Outputs, Conditional Required:**
If this service operation is invoked during Registration procedure for Network
Slice selection or UE Configuration Update procedure, then one or more of the
following outputs are required:
\- Allowed NSSAI, Configured NSSAI; Target AMF Set or, based on configuration,
the list of candidate AMF(s).
If this service operation is invoked during inter-PLMN mobility procedure,
then one or more of the following outputs are required:
\- Allowed NSSAI.
If this service operation is invoked to derive the S-NSSAI for the serving
PLMN (as described in clause 4.11.1.3.3), the following output is required:
\- S-NSSAIs for the HPLMN associated with established PDN connection, Mapping
of S-NSSAIs associated with established PDN connection in the Serving PLMN.
If this service operation is invoked during PDN Connection Establishment in
the Serving PLMN in EPS by a SMF+PGW-C, the following outputs are required:
\- Subscribed S-NSSAIs for the UE, Mapping of S-NSSAIs associated with the
subscribed S-NSSAIs for the UE in the Serving PLMN.
If this service operation is invoked during PDU Session Establishment
procedure, then the following outputs are required:
\- The NRF to be used to select NFs/services within the selected Network Slice
instance.
**Outputs, conditional Optional:**
If this service operation is invoked during UE Registration procedure or UE
Configuration Update procedure, then one or more of the following outputs are
optional:
\- Mapping Of Allowed NSSAI, Mapping Of Configured NSSAI, NSI ID(s) associated
with the Network Slice instances of the Allowed NSSAI, NRF(s) to be used to
select NFs/services within the selected Network Slice instance(s) and NRF to
be used to determine the list of candidate AMF(s) from the AMF Set, rejected
S-NSSAI with cause of rejection, Target NSSAI, the NSAG information (defined
in clause 5.15.14 of TS 23.501 [2]).
If this service operation is invoked during inter-PLMN mobility procedure,
then the following output is optional:
\- Mapping Of Allowed NSSAI.
If this service operation is invoked during PDU Session Establishment
procedure, then the following output is optional:
\- NSI ID associated with the S-NSSAI provided in the input.
#### 5.2.16.3 Nnssf_NSSAIAvailability service
##### 5.2.16.3.1 General
**Service description:** This service enables to update the AMFs and the NSSF
on the availability of S-NSSAIs and NSAGs on a per TA basis. This service also
enables updates for Network Slice Replacement and Network Slice Instance
Replacement to the NF Service Consumer (e.g. AMF or NSSF in the VPLMN) when
the NSSF determines that an S-NSSAI has to be replaced with an Alternative
S-NSSAI or a Network Slice instance is replaced as described in clause 5.15.19
[2].
NOTE: The NSSF can determine the serving network and Access Type from the TAI,
as described in TS 29.571 [70].
When this service is used by the NSSF for Network Slice Replacement, i.e. to
provide to the NF Service Consumer an Alternative S-NSSAI to the S-NSSAI to be
replaced, the following cases are possible:
\- in non-roaming and in roaming case, NSSF in the Serving PLMN provides to
the AMF the Alternative S-NSSAI of the Serving PLMN; or
\- in roaming case, the NSSF in the HPLMN provides to the NSSF in the VPLMN
the Alternative HPLMN S-NSSAI; and the NSSF in the VPLMN provides to the AMF
the Alternative HPLMN S-NSSAI.
Following NSSF event subscriptions are supported:
\- NSSAI availability status change;
\- Network Slice Replacement (see clause 5.15.19 of TS 23.501 [2]);
\- Network Slice Instance Replacement (see clause 5.15.20 of TS 23.501 [2]).
##### 5.2.16.3.2 Nnssf_NSSAIAvailability_Update service operation
**Service operation name:** Nnssf_NSSAIAvailability_Update
**Description:** This service operation enables the AMF to update the NSSF
with the S-NSSAIs the AMF supports per TA and get the availability of the
S-NSSAIs and optionally NSI IDs per TA for the S-NSSAIs the AMF supports.
**Inputs, Required:** Supported S-NSSAIs per TAI.
The supported S-NSSAIs per TAI, is a list of TAIs and for each TAI the
S-NSSAIs supported by the AMF.
**Inputs, Optional:** Supported NSAGs per TAI..
The supported NSAGs per TAI, is a list of TAIs and for each TAI the NSAGs and
the associated S-NSSAIs supported by the AMF.
**Outputs, Required:** A list of TAIs and for each TAI, the S-NSSAIs and
optionally NSI IDs supported by the AMF and 5G-AN and authorized by the NSSF
for the TAI.
**Outputs, Conditional Required:** A list of TAIs and for each TAI, the NSAGs
authorized by the NSSF for the TAI.
The authorized NSAGs per TAI, is a list of TAIs and for each TAI the NSAGs and
the associated S-NSSAIs.
**Outputs, Optional:** For each TAI, a list of S-NSSAIs restricted per PLMN
for the TAI _._
##### 5.2.16.3.3 Nnssf_NSSAIAvailability_Notify service operation
**Service operation name:** Nnssf_NSSAIAvailability_Notify
**Description:** This service operation enables the NSSF to update a NF
Service Consumer (e.g. AMF) with any S-NSSAIs restricted per TA and if needed,
subsequently lift any restriction per TA. This service operation also enables
the NSSF to notify to the NF Service Consumer (e.g. AMF or NSSF in the VPLMN)
that an S-NSSAI has to be replaced by an Alternative S-NSSAI or a Network
Slice instance should be replaced.
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Conditional Required:**
If this service operation is invoked by subscription for changes in the status
of the NSSAI availability information, then the following inputs are required:
\- a list of TAIs and the S-NSSAIs for which the status is changed
(restricted/unrestricted) per each TAI.
If this service operation is invoked by subscription for event notification
for Network Slice Replacement, then the following inputs are required:
\- For replacement of an S-NSSAI of the serving PLMN: an Alternative S-NSSAI
and the corresponding mapping to the S-NSSAI to be replaced.
\- For replacement of an HPLMN S-NSSAI: an Alternative S-NSSAI and the
corresponding mapping to the S-NSSAIs of the HPLMN, PLMN ID.
\- For termination of the Network Slice replacement:
1) indication to stop the Network Slice replacement for new UEs; or
2) indication to terminate the Network Slice replacement and move back the UEs
and PDU Sessions from the Alternative S-NSSAI to the S-NSSAI.
If this service operation is invoked by subscription for event notification
for Network Slice Instance Replacement, then the following inputs are
required:
\- The S-NSSAI(s) and NSI ID(s) for which the status is changed (e.g.
congested or no longer available).
**Inputs, Optional:**
\- NSI IDs in the S-NSSAI for which the status is changed
(restricted/unrestricted) per each TAI.
If this service operation is invoked by subscription for event notification
for Network Slice Replacement or Network Slice Instance Replacement, then the
following inputs are optional:
\- For replacement due to congestion: congestion mitigation information.
**Outputs, Required:** None.
**Outputs, Optional:** None _._
##### 5.2.16.3.4 Nnssf_NSSAIAvailability_Subscribe service operation
**Service operation name:** Nnssf_NSSAIAvailability_Subscribe
**Description:** This service operation enables a NF Service Consumer (e.g.
AMF) to subscribe to a notification of any changes in status of the NSSAI
availability information (e.g. S-NSSAIs and optionally NSI IDs available per
TA and the restricted S-NSSAI(s) and optionally NSI IDs per PLMN in that TA in
the serving PLMN of the UE) upon this is updated by another AMF. This service
also enables the NF Service Consumer (e.g. AMF or NSSF in the VPLMN) to
subscribe to a notification of Network Slice Replacement and Network Slice
Instance Replacement.
**Inputs, Required:** Callback URI of the NF Service Consumer:
**Inputs, Conditional Required:**
If this service operation is invoked to subscribe for changes in status of the
NSSAI availability information, then the following inputs are required:
\- list of TAIs supported by the NF service consumer, event to be subscribed.
If this service operation is invoked to subscribe to a notification for
Network Slice Replacement, then the following inputs are required:
\- for the S-NSSAI of the serving PLMN: set of S-NSSAIs served by the NF
Service Consumer that may be replaced, NF type of the NF Service Consumer
(e.g. AMF), Requester ID, event to be subscribed.
\- for HPLMN S-NSSAI: S-NSSAIs for the HPLMN, NF type of the NF Service
Consumer (e.g. AMF or NSSF), Requester ID and PLMN ID, event to be subscribed.
If this service operation is invoked to subscribe to a notification when the
Network Slice instance is congested or no longer available, then the following
inputs are required:
\- The S-NSSAIs, NSI IDs, event to be subscribed.
**Inputs, Optional:** Expiry time.
**Outputs, Required:** Subscription Correlation ID.
**Outputs, Conditional Required:**
If this service operation is invoked to subscribe for changes in status of the
NSSAI availability information, then the following outputs are required:
\- Expiry time (if present in the request, may be included in the response
based on operator\'s policy and taking into account the expiry time present in
the request (i.e. should be less than or equal to that value); if not present
in the request, may be included in the response based on operator\'s policy.
Whatever the case, if not included in the response, this means that the
subscription is valid without an expiry time).
**Outputs, Optional:**
If this service operation is invoked to subscribe for changes in status of the
NSSAI availability information, then the following outputs are optional:
\- A list of TAIs and for each TAI, the S-NSSAIs and optionally NSI IDs
supported by the AMF and 5G-AN and authorized by the NSSF for the TAI and a
list of S-NSSAIs and optionally NSI IDs restricted per PLMN for the TAI. The
NSSS indicates to the AMF that the S-NSSAI(s) are not available in the
corresponding TAIs.
##### 5.2.16.3.5 Nnssf_NSSAIAvailability_Unsubscribe service operation
**Service operation name:** Nnssf_NSSAIAvailability_Unsubscribe
**Description:** This service operation enables a NF Service Consumer (e.g.
AMF) to unsubscribe to a notification of any previously subscribed changes to
the NSSAI availability information. This service operation also enables the NF
Service Consumer (e.g. AMF, NSSF) to unsubscribe to a notification for Network
Slice Replacement or for Network Slice Instance Replacement.
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.16.3.6 Nnssf_NSSAIAvailability_Delete service operation
**Service operation name:** Nnssf_NSSAIAvailability_Delete
**Description:** This service operation enables a NF service consumer (e.g.
AMF) to delete the NSSAI availability information stored for the NF service
consumer in the NSSF.
**Inputs, Required:** NfId.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.16.4 Void
### 5.2.17 CHF Spending Limit Control Service
#### 5.2.17.1 General
The following table illustrates the CHF Services defined in this
specification. The other services of CHF are defined in clause 6.2 of TS
32.290 [42].
Tale 5.2.17.1-1: CHF Services
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
Nchf_SpendingLimitControl Subscribe Subscribe/Notify PCF Unsubscribe PCF
Notify PCF
#### 5.2.17.2 Nchf_SpendingLimitControl service
##### 5.2.17.2.1 General
**Service description:** This service enables transfer of policy counter
status information relating to subscriber spending limits from CHF to the NF
consumer.
##### 5.2.17.2.2 Nchf_SpendingLimitControl Subscribe service operation
**Service operation name:** Nchf_SpendingLimitControl_Subscribe
**Description:** Subscribe to notification of changes in the status of the
policy counters available at the CHF and retrieval of the status of the policy
counters for which subscription is accepted by CHF.
**Inputs, Required:** SUPI (for the Initial Spending Limit request),
SubscriptionCorrelationId (for the Intermediate Spending Limit report), Event
Id \"policy counter status change\", Event Filter Information \"List of policy
counter identifier (s)\".
**Inputs, Optional:** Notification Correlation Target (required for the
Initial Spending Limit request), Event Filter Information \"List of policy
counter identifier (s)\", Event Reporting Information (continuous reporting).
**Outputs, Required:** Status of the requested subscribed policy counters to
the subscriber in the Event Information.
**Outputs, Optional:** Pending policy counter statuses and their activation
times, for all policy counter(s) available for this subscriber. If list of
policy counter identifier(s) was provided, the CHF returns only the pending
policy counter statuses and their activation times, per required policy
counter identifier in the Event Information, SubscriptionCorrelationId.
##### 5.2.17.2.3 Nchf_SpendingLimitControl Unsubscribe service operation
**Service operation name:** Nchf_SpendingLimitControl_Unsubscribe
**Description:** Cancel the subscription to status changes for all the policy
counters available at the CHF.
**Inputs, Required:** SubscriptionCorrelationId.
**Inputs, Optional:** None.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
##### 5.2.17.2.4 Nchf_SpendingLimitControl Notify service operation
**Service operation name:** Nchf_SpendingLimitControl_Notify
**Description:** Notify the change of the status of the subscribed policy
counters available at the CHF. Alternatively, it can be used by the CHF to
provide one or more pending statuses for a subscribed policy counter together
with the time they have to be applied. Alternatively, it is also used by the
CHF to notify the removal of a subscriber from the CHF system, so that the NF
consumer can terminate the subscriptions of all the policy counters of the
subscriber.
**Inputs, Required:** Notification Target Address, SUPI.
**Inputs, Optional:** policy counter status as Event Information, Pending
policy counter statuses and their activation times as Event Information.
Subscriber removal from the CHF system as Event Information.
**Outputs, Required:** Success or Failure.
**Outputs, Optional:** None.
### 5.2.18 UCMF Services
#### 5.2.18.1 General
The following table illustrates the UCMF Services.
Table 5.2.18.1-1: NF services provided by UCMF
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
Nucmf_Provisioning Create Request/Response AF, NEF Delete Request/Response AF,
NEF Update Request/Response AF, NEF Nucmf_UECapabilityManagement Resolve
Request/Response AMF Assign Request/Response AMF Subscribe Subscribe/Notify
AMF Unsubscribe Subscribe/Notify AMF Notify Subscribe/Notify AMF
#### 5.2.18.2 Nucmf_Provisioning service
##### 5.2.18.2.1 Nucmf_Provisioning_Create service operation
**Service operation name:** Nucmf_Provisioning_Create
**Description:** The consumer creates a UCMF dictionary entry (or more
entries) for a Manufacturer-assigned UE Radio Capability ID(s). For each UE
Radio Capability ID the following inputs are provided:
a) a UE radio access capability set with respective coding format or the UE
radio access capability set in both TS 36.331 [16] and TS 38.331 [12] coding
formats and each RATs\' UE Radio Capability for Paging; and
b) the related UE model(s) IMEI/TAC value(s) the UE radio capability ID
applies to.
**Inputs, Required:** (list of) [UE Radio Capability ID(s), set(s) of UE radio
access capability set and UE Radio Capability for Paging and respective Coding
format(s), (list of) IMEI/TAC value(s)].
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
The Coding format(s) indicates the format of the respective UE radio access
capabilities as defined in TS 36.331 [16] or TS 38.331 [12]. The UCMF
dictionary entry shall not contain UTRAN radio capabilities.
##### 5.2.18.2.2 Nucmf_Provisioning_Delete service operation
**Service operation name:** Nucmf_Provisioning_Delete
**Description:** The consumer deletes a UCMF dictionary entry(s) for a
Manufacturer-assigned UE Radio Capability ID(s). The consumer provides a (list
of) UE radio capability ID value(s) to be deleted or it may provide the
IMEI/TAC values for which the associated UE radio capability ID entries shall
be no longer used.
**Inputs, Required:** UE Radio Capability ID(s) of the UCMF dictionary
entry(s) to be deleted or IMEI/TAC that no longer use associated UE radio
Capability ID(s).
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.18.2.3 Nucmf_Provisioning_Update service operation
**Service operation name:** Nucmf_Provisioning_Update
**Description:** The consumer updates the list of IMEI/TAC values a UCMF
dictionary entry (or a list of entries) applies to for a Manufacturer-assigned
UE Radio Capability ID. For each UE Radio Capability ID provided, (a list of)
UE model(s) IMEI/TAC value(s) to be added or removed to the related UCMF entry
is provided.
**Inputs, Required:** Update Type (one of \"Add IMEI/TAC Values\" or \"Remove
IMEI/TAC Values\") and:
\- If Update Type is \"Add IMEI/TAC Values\", the (list of) UE Radio
Capability ID(s) of the UCMF dictionary entry(ies) to be updated and the
related additional (list of) IMEI/TAC(s); or
\- If Update Type is \"Remove IMEI/TAC Values\", the (list of) UE Radio
Capability ID(s) of the UCMF dictionary entry(ies) to be updated and the
related (list of) IMEI/TAC(s) to be removed.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 5.2.18.3 Nucmf_UECapabilityManagement Service
##### 5.2.18.3.1 Nucmf_UECapabilityManagement Resolve service operation
**Service Operation name:** Nucmf_UECapabilityManagement_Resolve
**Description: Consumer** NF gets the UE Radio Access Capability and one or
more UE Radio Capability for Paging corresponding to a specific UE Radio
Capability ID (either Manufacturer-assigned or PLMN-assigned) and Coding
Format.
**Inputs, Required:** UE Radio Capability ID, Coding format, one or more UE
Radio Capability for Paging.
**Inputs, Optional:** None.
**Outputs, Required:** UE Radio Access Capability, UE Radio Capability for
Paging.
**Outputs, Optional:** None.
The Coding format indicates the format as defined in TS 36.331 [16] or TS
38.331 [12] of the UE Radio Access Capability expected by the NF in output.
When the Coding Format is TS 36.331 [16], the UCMF shall provide the UE Radio
Capability for Paging for E-UTRA. When the Coding Format is TS 38.331 [12],
the UCMF shall provide the UE Radio Capability for Paging for NR and if the
PLMN supports E-UTRA connected to 5GC, shall provide the UE Radio Capability
for Paging for E-UTRA.
##### 5.2.18.3.2 Nucmf_UECapabilityManagement_Assign service operation
**Service or service operation name:** Nucmf_UECapabilityManagement_Assign
**Description:** The NF consumer sends to the UCMF:
\- the UE Radio Access Capability (and its Coding Format); or
\- the UE Radio Access Capability and UE Radio Capability for Paging in both
TS 36.331 [16] and TS 38.331 [12] coding formats;
and obtains a PLMN-assigned UE Radio Capability ID in return.
**Inputs, Required:** UE Radio Access Capability(s), UE Radio Capability for
Paging(s), Coding format(s), IMEI/TAC.
**Inputs, Optional:** One or more UE Radio Capability for Paging.
**Outputs, Required:** UE Radio Capability ID.
**Outputs, Optional:** None.
The AMF does not send NB-IoT Radio Access Capability to the UCMF.
The Coding format indicates the format of the UE Radio Access Capability as
defined in TS 36.331 [16] or TS 38.331 [12].
##### 5.2.18.3.3 Nucmf_UECapabilityManagement_Subscribe service operation
**Service operation name:** Nucmf_UECapabilityManagement_Subscribe
**Description:** The NF consumer subscribes for updates to UCMF dictionary
entries and provides the coding format in which UE Radio Access Capability is
expected by NF. The UCMF shall check the requested consumer is authorized to
subscribe to requested updates.
**Inputs, Required:** Coding format.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
The Coding format indicates the format of the UE Radio Access Capability as
defined in TS 36.331 [16] or TS 38.331 [12].
##### 5.2.18.3.4 Nucmf_UECapabilityManagement_Unsubscribe service operation
**Service operation name:** Nucmf_UECapabilityManagement_Unsubscribe
**Description:** The NF consumer unsubscribes from updates to UCMF dictionary
entries.
**Inputs, Required:** None.
**Inputs, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
##### 5.2.18.3.5 Nucmf_UECapabilityManagement_Notify service operation
**Service Operation name:** Nucmf_UECapabilityManagement_Notify
**Description:** Producer NF provides notifications about changes in UCMF to
subscribed consumer NF.
**Inputs, Required:** Notification Type (\"creation\", \"deletion\", \"Added
IMEI/TAC in Manufacturer Assigned operation requested list\", \"Removed
IMEI/TAC from Manufacturer Assigned operation requested list\", \"Removed UE
Radio Capability ID from Manufacturer Assigned operation requuested list\").
**Inputs, Optional:** If Notification Type is set to \"creation\": One or more
UCMF dictionary entries, each UCMF dictionary entry consisting of a UE Radio
Capability ID and the corresponding UE Radio Access Capability. If
Notification Type is set to \"deletion\": One or more UE Radio Capability IDs.
If Notification Type is set to \"Added IMEI/TAC in Manufacturer Assigned
operation requested list\" or \"Removed IMEI/TAC from Manufacturer Assigned
operation requested list\", one or more IMEI/TACs, if Notification type is
\"Removed UE Radio Capability ID from Manufacturer Assigned operation
requested list, one or more PLMN assigned UE radio Capability IDs.
**Outputs, Required:** None.
**Outputs, Optional:** None.
The Manufacturer Assigned operation requested list is defined in clause
5.11.3a of TS 23.401 [13] and clause 5.4.4.1a of the present document.
### 5.2.19 AF Services
#### 5.2.19.1 General
The following table illustrates the AF Services.
Table 5.2.19.1-1: Services provided by AF
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
Naf_EventExposure Subscribe Subscribe/Notify NEF, NWDAF Unsubscribe NEF, NWDAF
Notify NEF, NWDAF
NOTE: In this release of the specification, Naf_EventExposure service is only
used for analytics as described in TS 23.288 [50].
#### 5.2.19.2 Naf_EventExposure service
##### 5.2.19.2.1 General
**Service description:** This service enables consumer NF to subscribe and get
notified of events.
The events can be subscribed by a NF consumer are described in TS 23.288 [50].
The following service operations are defined for the Naf_EventExposure
service:
\- Naf_EventExposure_Subscribe.
\- Naf_EventExposure_Unsubscribe.
\- Naf_EventExposure_Notify.
The following events can be subscribed by a NF consumer (Event ID is defined
in clause 4.15.1):
\- Service Experience information, as defined in clause 6.4.2 of TS 23.288
[50].
\- Performance Data information, as defined in clauses 6.4.2 and clause 6.14.2
of TS 23.288 [50].
\- Collective Behaviour information, as defined in clause 6.5.2 of TS 23.288
[50].
\- UE Mobility information, as defined in clause 6.7.2.2 of TS 23.288 [50].
\- UE Communication information, as defined in clause 6.7.3.2 of TS 23.288
[50].
\- Exceptions information, as defined in clause 6.7.5.2 of TS 23.288 [50].
\- User Data Congestion information, as defined in clause 6.8.2 of TS 23.288
[50].
\- UE Data volume Dispersion information, as defined in clause 6.10.2 of TS
23.288 [50].
\- DN Performance information, as defined in clause 6.14.2 of TS 23.288 [50].
\- E2E data volume transfer time information, as defined in clause 6.18.2 of
TS 23.288 [50].
Event Filters are used to specify the conditions to match for notifying the
event (i.e. \"List of Parameter values to match\"). If there are no conditions
to match for a specific Event ID, then the Event Filter is not provided. The
following table provides some examples on how the conditions to match for
event reporting can be specified for various Event IDs for AF exposure.
Table 5.2.19.2.1-1: Example of Event Filters for AF exposure events
+----------------------------------+----------------------------------+ | Event ID for AF exposure | Event Filter (List of Parameter | | | Values to Match) | +==================================+==================================+ | Exceptions information | \ | +----------------------------------+----------------------------------+ | Service Experience information | \ | +----------------------------------+----------------------------------+ | Service Experience information | \ | +----------------------------------+----------------------------------+ | Collective Behaviour information | \ | +----------------------------------+----------------------------------+ | Collective Behaviour information | \ | +----------------------------------+----------------------------------+
##### 5.2.19.2.2 Naf_EventExposure_Subscribe service operation
**Service operation name:** Naf_EventExposure_Subscribe
**Description:** The consumer NF subscribes the event to collect AF data for
UE(s), group of UEs, or any UE, or updates the subscription which is already
defined in AF.
**Input, Required:** Target of Event Reporting (either UE ID(s), or UE IPv4
address(es), or UE IPv6 prefix(es), or Internal/External Group Identifier, or
indication that any UE is targeted), (set of) Event ID(s), Notification Target
Address (+ Notification Correlation ID) and Event Reporting Information as
defined in Table 4.15.1-1.
NOTE 1: UE ID includes GPSI or SUPI.
**Input, Optional:** NF ID, Event Filter(s) associated with each Event ID,
(set of) External Application Identifier(s), Subscription Correlation ID (in
the case of modification of the existing subscription), Expiry time.
NOTE 2: In the case of untrusted AF, NEF ID is used as NF ID.
**Output, Required:** Operation execution result indication. When the
subscription is accepted: Subscription Correlation ID, Expiry time (required
if the subscription can be expired based on the local policy).
**Output, Optional:** First corresponding event report is included, if
corresponding information is available (see clause 4.15.1).
##### 5.2.19.2.3 Naf_EventExposure_Unsubscribe service operation
**Service operation name:** Naf_EventExposure_Unsubscribe
**Description:** The consumer NF unsubscribes for a specific event.
**Input, Required:** Subscription Correlation ID.
**Input, Optional:** None.
**Output, Required:** Operation execution result indication.
**Output, Optional:** None.
##### 5.2.19.2.4 Naf_EventExposure_Notify service operation
**Service operation name:** Naf_EventExposure_Notify
**Description:** The AF provides the previously subscribed event information
to the consumer NF which has subscribed to that event before.
**Input, Required:** Notification Correlation Information, Event ID,
corresponding UE ID(s) (either external UE ID(s), or Internal/External Group
Identifier, or UE IP v4 address(es) or UE IP v6 prefix(es), time stamp.
NOTE: UE ID includes GPSI or SUPI.
**Input, Optional:** Event specific parameter list.
**Output, Required:** None.
**Output, Optional:** None.
#### 5.2.19.3 Void
### 5.2.20 NSSAAF services
#### 5.2.20.1 General
The following table illustrates the NSSAAF Services.
Table 5.2.20-1: List of NSSAAF Services
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
Nnssaaf_NSSAA Authenticate Request/Response AMF Re-AuthenticationNotification
Notify AMF RevocationNotification Notify AMF Nnssaaf_AIW Authenticate
Request/Response AUSF
#### 5.2.20.2 Nnssaaf_NSSAA service
##### 5.2.20.2.1 General
**Service Description:** The NSSAAF provides Network Slice- Specific
Authentication and Authorization (NSSAA) service to the requester NF by
relaying EAP messages towards a AAA-S or AAA-P and performing related protocol
conversion as needed. It also provides notification to the current AMF where
the UE is of the need to re-authenticate and re-authorize the UE or to revoke
the UE authorization. The AMF to receive the notification is implicitly
subscribed and it is found in the UDM by providing the UE GPSI.
##### 5.2.20.2.2 Nnssaaf_NSSAA_Authenticate service operation
See TS 33.501 [15].
##### 5.2.20.2.3 Nnssaaf_NSSAA_Re-AuthenticationNotification service operation
See TS 33.501 [15].
##### 5.2.20.2.4 Nnssaaf_NSSAA_RevocationNotification service operation
See TS 33.501 [15].
#### 5.2.20.3 Nnssaaf_AIW service
##### 5.2.20.3.1 General
Service Description: The NSSAAF provides Authentication and Authorization
service to the requester NF by relaying EAP messages towards a AAA-S or AAA-P
and performing related protocol conversion as needed.
##### 5.2.20.3.2 Nnssaaf_AIW_Authenticate service operation
See TS 33.501 [15].
### 5.2.21 NSACF services
#### 5.2.21.1 General
The following table illustrates the NSACF services.
Table 5.2.21.1-1: List of NSACF services
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | Semantics | Consumer(s) | +================+================+================+================+ | Nnsacf_NSAC | NumOfUEsUpdate | Re | AMF, SMF | | | | quest/Response | (NOTE 1) | +----------------+----------------+----------------+----------------+ | | N | | SMF | | | umOfPDUsUpdate | | | +----------------+----------------+----------------+----------------+ | | EACNotify | | AMF | +----------------+----------------+----------------+----------------+ | | QuotaUpdate | | NSACF | | | | | | | | | | (NOTE 3) | +----------------+----------------+----------------+----------------+ | | Loc | | Primary NSACF | | | alNumberUpdate | | | +----------------+----------------+----------------+----------------+ | Nnsacf_Slic | Subscribe | Su | NEF, NWDAF, AF | | eEventExposure | | bscribe/Notify | (NOTE 2), | | | | | Primary NSACF | +----------------+----------------+----------------+----------------+ | | Unsubscribe | | NEF, NWDAF, | | | | | AF, Primary | | | | | NSACF | +----------------+----------------+----------------+----------------+ | | Notify | | NEF, NWDAF, | | | | | AF, Primary | | | | | NSACF | +----------------+----------------+----------------+----------------+ | NOTE 1: If EPS | | | | | counting is | | | | | required for | | | | | the S-NSSAI, | | | | | the SMF+PGW-C | | | | | uses the | | | | | Nnsac | | | | | f_NumberOfUEs | | | | | Update | | | | | services | | | | | operation and | | | | | Nnsacf_Numb | | | | | erOfPDUsUpdate | | | | | at PDN | | | | | connection | | | | | establishment | | | | | procedure. | | | | | | | | | | NOTE 2: The AF | | | | | can access | | | | | NSACF services | | | | | via NEF to | | | | | NSACF or to | | | | | Primary NSACF | | | | | depending on | | | | | the NSAC | | | | | deployment | | | | | architecture | | | | | in the case of | | | | | untrusted AF | | | | | or directly in | | | | | the case of | | | | | trusted AF. | | | | | | | | | | NOTE 3: This | | | | | request is | | | | | only invoked | | | | | by a VPLMN | | | | | Primary (or | | | | | Central) NSACF | | | | | for inbound | | | | | roamers to | | | | | fetch the | | | | | maximum number | | | | | of Registered | | | | | UEs and | | | | | maximum number | | | | | of LBO PDU | | | | | Sessions | | | | | enforced by | | | | | the NSACF in | | | | | the VPLMN for | | | | | HPLMN inbound | | | | | roamers. This | | | | | applies only | | | | | to VPLMN NSAC | | | | | admission mode | | | | | see | | | | | clau | | | | | se 4.2.11.5.1. | | | | +----------------+----------------+----------------+----------------+
#### 5.2.21.2 Nnsacf_NSAC services
##### 5.2.21.2.1 General
**Service Description:** The Nnsacf_NSAC services control the number of UEs
registered with a network slice and the number of PDU Sessions associated with
a network slice for the network slices subject to NSAC. The consumer NF (e.g.
AMF) can request the NSACF to check whether the number of UEs registered with
a network slice has reached the maximum number of UEs per network slice and
the consumer NF can also request the NSACF to update the number of UEs
registered with a network slice. The SMF can request the NSACF to check
whether the number of PDU Sessions established on a network slice has reached
the maximum number of PDU Sessions per network slice and the SMF can also
request the NSACF to update the number of PDU Sessions established on a
network slice.
While roaming, for a centralized NSAC architecture and/or a Hierarchical NSAC
architecture, the VPLMN Primary (or Central) NSACF can fetch the local maximum
number of Registered UEs and/or number of LBO PDU sessions.
##### 5.2.21.2.2 Nnsacf_NSAC_NumOfUEsUpdate service operation
**Service Operation name:** Nnsacf_NSAC_NumOfUEsUpdate
**Description:** Updates the number of UEs registered with a network slice
(e.g. increase or decrease) when the UE registration status for a network
slice subject to NSAC has changed. Also, if the number of the UEs registered
with the network slice is to be increased and the Early Admission Control
(EAC) mode in the NSACF is activated for that network slice (see
Nnsacf_NSAC_EACNotify service operation), the NSACF first checks whether the
number of UEs registered with the network slice has reached the maximum number
of UEs per network slice threshold. If the maximum number of UEs registered
with the network slice has already been reached, the UE registration for that
network slice via the same Access Type configured in the NSACF is rejected. If
the EAC is not activated, the NSACF increases or decreases the number of UEs
per network slice as per the input parameters below.
**Inputs, Required:** S-NSSAI(s), UE ID (SUPI), NF ID, Access Type, update
flag.
**Inputs, Optional:** None.
**Inputs, Conditional:** Notification endpoint for EAC Notification for the
S-NSSAI, NSAC admission mode, PLMN ID, UE already registered indication, AMF
NSAC service area.
The S-NSSAI(s) parameter is a list of one or more network slices for which the
number of UEs registered with a network slice is to be updated and checked if
the maximum number of UEs per network slice threshold has already been
reached. In the roaming case, the corresponding mapped S-NSSAI(s) of the HPLMN
is also included.
The UE ID parameter is used by the NSACF to maintain a list of UE IDs
registered with the network slice. The NSACF also takes Access Type into
account for increasing and decreasing the number of UEs per network slice as
described in clause 5.15.11.1 of TS 23.501 [2].
The NF ID parameter is the NF instance ID of the NF (e.g. AMF or SMF + PGW-C)
sending the request to the NSACF.
The update flag input parameter indicates whether the number of UEs registered
with a network slice is to be:
\- increased when the UE registers to a new network slice subject to NSAC. If
the UE ID is already in the list of UEs registered with the network slice, the
number of UEs registered with the network slice is not increased as the UE has
already been counted as registered with the network slice. If the UE ID is not
in the list of UE IDs registered with the network slice and the maximum number
of UEs registered with the network slice has not been reached yet, the NSACF
adds the UE ID in the list of UEs registered with the network slice and
increases the number of the UEs registered with the network slice. If the
UE_ID is not in the list of UEs registered with that S-NSSAI and the maximum
number of UEs per network slice for that S-NSSAI has already been reached,
then the NSACF returns maximum number of UEs per network slice reached result;
\- decreased when the UE deregisters for a network slice that is subject to
NSAC. The NSACF decreases the number of the UEs registered with the network
slice and removes the UE ID from the list of UEs registered with the network
slice;
\- updated when the UE moves the PDU sessions across Access Types as described
in the clause 4.11.5.9a.
NSAC admission mode applies to inbound roamers. It is included by NF consumer
to indicate applicable NSAC admission mode in VPLMN. Its values can be VPLMN
NSAC admission mode, or VPLMN with HPLMN assistance NSAC admission mode.
The PLMN ID is the serving PLMN of the UE.
The UE already registered parameter indicates that the UE has already been
registered in another NSACF service area.
The AMF NSAC service area is included in a centralized NSAC architecture, if
available.
The NSACF may optionally return the current status of the network slice
availability (e.g. a percentage out of the maximum number of UEs registered
with a network slice) in the availability status parameter. This information
may be used for NSACF signalling and load balancing in case multiple NSACFs
are serving the same network slice.
**Outputs, Required:** Result indication.
The Result indication parameter contains the outcome of the update and check
operation in the NSACF and may indicate one of the values \'maximum number of
UEs for the S-NSSAI not reached\' or \'maximum number of UEs for the S-NSSAI
reached\'.
**Outputs, Optional:** Updated local maximum number of registered UEs, or
Updated UE admission threshold.
These parameters can only be returned by a primary NSACF.
##### 5.2.21.2.3 Nnsacf_NSAC_EACNotify service operation
**Service Operation name:** Nnsacf_NSAC_EACNotify
**Description:** The NSACF is configured with the information about which
network slices are subject to NSAC. The NSACF may trigger notification to the
consumer NF (e.g. AMF) to indicate the activation of the Early Admission
Control (EAC) mode for a certain network slice which is subject to NSAC when
the number of the UEs registered with the network slice is above certain
operator defined threshold (e.g. a percentage of the maximum number of UEs
allowed to register with the network slice) and the deactivation of the EAC
mode when the number of the UEs registered with the network slice is below
certain operator defined threshold which may be same or different from the
activation threshold.
**Inputs, Required:** S-NSSAI(s), EAC flag(s).
The S-NSSAI input parameter is the network slice for which the NSACF activates
or deactivates the EAC mode.
The EAC flag input parameter indicates whether the Slice EAC mode is activated
or deactivated.
**Inputs, Optional:** None.
**Output, Required:** None.
**Output, Optional:** None.
##### 5.2.21.2.4 Nnsacf_NSAC_NumOfPDUsUpdate service operation
**Service Operation name:** Nnsacf_NSAC_NumOfPDUsUpdate
**Description:** Updates the number of PDU Sessions established on a network
slice (e.g. increase or decrease). Also, if the number of PDU Sessions on the
network slice is to be increased, the NSACF first checks whether the number of
the PDU Sessions on that network slice has reached the maximum number of PDU
Sessions per network slice. If the maximum number of PDU Sessions on the
network slice has already been reached, the PDU Session Establishment
procedure is rejected.
**Inputs, Required:** S-NSSAI, UE ID, PDU Session ID, Access Type, update
flag.
The S-NSSAI parameter is the network slice for which the number of PDU
Sessions established on a network slice is to be updated. In the LBO roaming
case, the corresponding mapped S-NSSAI of the HPLMN is also included.
The UE ID parameter is used by the NSACF to maintain a list of UE IDs that has
established PDU sessions with the network slice.
PDU Session ID parameter is used by the NSACF to maintain for each UE ID, the
PDU Session ID(s) for established PDU Sessions.
The Access Type parameter indicates over which access network type the PDU
Session is established. In the case of MA PDU Session, one or multiple Access
Types may be included for a PDU Session ID.
The update flag input parameter indicates \'increase\', \'decrease\' or
\'update\' as specified in clause 4.2.11.4.
**Inputs, Optional:** NSAC admission mode, PLMN ID.
NSAC admission mode applies to inbound roamers. It is included by NF consumer
to indicate applicable NSAC admission mode in VPLMN. Its values can be VPLMN
NSAC admission mode, or VPLMN with HPLMN assistance NSAC admission mode.
The PLMN ID is the serving PLMN of the UE.
**Inputs, Conditional:** The SMF NSAC service area is included in a
centralized NSAC architecture, if applicable.
**Outputs, Required:** Result indication, Access Type.
The Result indication parameter contains the outcome of the update and check
operation in the NSACF and may indicate one of the values \'maximum number of
PDU Sessions for the S-NSSAI not reached\' or \'maximum number of PDU Sessions
for the S-NSSAI reached\'.
The Access Type parameter is associated with the Result indication parameter.
**Outputs, Optional:** Updated local maximum number of PDUs.
This parameter is returned only by a primary NSACF.
##### 5.2.21.2.5 Nnsacf_NSAC_QuotaUpdate service operation
**Service Operation name:** Nnsacf_NSAC_QuotaUpdate
**Description:** Updates the NSACF at the VPLMN with the maximum number of
Registered UEs to be enforced and/or the maximum number of LBO PDU sessions to
be admitted.
**Inputs, Required:** S-NSSAI, PLMN ID, Requested Quota attribute type.
The S-NSSAI parameter is the network slice subject to NSAC, which is the
mapped S-NSSAI in HPLMN.
The PLMN ID is the serving PLMN of the UE.
The Requested Quota attribute type indicates if the requested quota is for
local maximum number of Registered UEs and/or local maximum number of PDU
sessions.
**Inputs, Optional:** None.
**Outputs, Required:** Result indication.
The Result indication parameter includes the outcome of the operation.
**Outputs, Optional:** A maximum number of allowed Registered UEs per S-NSSAI
subject to NSAC and/or a maximum number of allowed PDU sessions per S-NSSAI
subject to NSAC.
##### 5.2.21.2.6 Nnsacf_NSAC_LocalNumberUpdate service operation
**Service Operation name:** Nnsacf_NSAC_LocalNumberUpdate
**Description:** The Primary NSACF uses this service operation to update local
maximum number of registered UEs and/or number of PDU sessions of the network
slice at NSACFs.
**Inputs, Required:** S-NSSAI, Updated local number (s).
**Inputs, Optional:** None.
The S-NSSAI is the network slice for which the NSACF is applying the updated
local number update.
The updated local number indicates the updated local maximum number of
registered UEs, or the updated local maximum number of PDU Sessions of the
S-NSSAI.
**Output, Required:** Result indication.
**Outputs, Optional:** None.
#### 5.2.21.3 Void
#### 5.2.21.4 Nnsacf_SliceEventExposure services
##### 5.2.21.4.1 General
**Service Description:** The Nnsacf_SliceEventExposure services provide event
based notifications to the consumer NF related to the current number of UEs
registered for a network slice or/and the current number of PDU Sessions
established on a network slice.
##### 5.2.21.4.2 Nnsacf_SliceEventExposure_Subscribe service operation
**Service operation name:** Nnsacf_SliceEventExposureSubscribe
**Description:** This service operation is used by the consumer NF to
subscribe or modify a subscription with the NSACF for event based
notifications of the current number of UEs registered for a network slice or
the current number of PDU Sessions established on a network slice.
**Inputs, Required:** Event ID, Event Filter, Event Reporting information.
The Event ID parameter defines whether to notify the number of UEs registered
with a network slice or the number of PDU Sessions established on a network
slice.
The Event Filter parameter is the S-NSSAI for which the current number of UEs
registered for a network slice or the current number of PDU Sessions
established on a network slice or both are to be notified to the consumer NF.
The Event Reporting information parameter defines whether the notification is
threshold based (e.g. the notification is triggered when the current number of
UEs or PDU Sessions with a network slice reaches a defined threshold value) or
the notification is periodical (e.g. the notification is triggered at expiry
of a periodic timer) and optionally the Immediate reporting flag.
**Inputs, Optional:** Notification threshold, Notification periodicity.
The Notification threshold parameter is optional. It is provided when the
Notification is threshold base. The notification threshold parameter may be a
numeric value or a percentage of the maximum number of the UEs or PDU Sessions
per network slice.
The Notification periodicity parameter is optional. It is provided when the
Notification is periodical. The Notification periodicity parameter defines the
time between the notification periodicity.
**Outputs, Required:** Operation execution result response, Subscription
Correlation Id.
##### 5.2.21.4.3 Nnsacf_SliceEventExposure_Unsubscribe service operation
**Service operation name:** Nnsacf_SliceEventExposure_Unsubscribe
**Description:** This service operation is used by the consumer NF to
unsubscribe from the event notification.
**Inputs, Required:** Subscription Correlation Id.
**Outputs, Required:** Operation execution result response.
##### 5.2.21.4.4 Nnsacf_SliceEventExposure_Notify service operation
**Service operation name:** Nnsacf_SliceEventExposure_Notify
**Description:** This service operation is used by the NSACF to report the
current number of UEs registered with a network slice or the current number of
PDU Sessions established on a network slice in numbers or in percentage from
the maximum allowed numbers, based on threshold or at expiry of periodic
timer.
**Inputs, Required:** Event ID, Event Filter, Event Reporting information,
Notification Correlation Information.
The Event ID parameter defines the type of the reported information, i.e. the
number of UEs registered with a network slice or the number of PDUs Sessions
established on a network slice.
The Event Filter parameter is the S-NSSAI for which the Notification applies.
The Event Reporting information parameter provides the network slice status
information in terms of the current number of UEs registered with a network
slice or the current number of PDU Sessions established on a network slice. If
the Notification is threshold based where the threshold is a certain number of
UEs registered with a network slice or PDU Sessions established on a network
slice or the threshold is a percentage of the maximum number of UEs registered
with a network slice or the maximum number of PDU Sessions established on a
network slice, the Event Reporting information parameter contains confirmation
for reaching this threshold value. If the Notification is periodical, the
Event Reporting information parameter provides information for the current
number of UEs registered with a network slice (e.g. represented in percentage
of the maximum number of the UEs registered with the network slice) or
information for the current number of PDU Sessions established on a network
slice (e.g. represented in percentage of the maximum number of the PDU
Sessions established on the network slice) with periodicity provided during
the subscription. For current number of UEs registered with a network slice,
the network slice status information may include information to indicate
whether this is number of UE with at least one PDU Session/PDN Connection.
**Outputs, Required:** None.
#### 5.2.21.5 Void
### 5.2.22 DCCF Services
The DCCF services are defined in TS 23.288 [50].
### 5.2.23 MFAF Services
The MFAF services are defined in TS 23.288 [50].
### 5.2.24 ADRF Services
The ADRF services are defined in TS 23.288 [50].
### 5.2.25 EASDF Services
EASDF services are defined in clause 7.1 of TS 23.548 [74].
### 5.2.26 UPF Services
#### 5.2.26.1 General
The following table shows the UPF Services and UPF Service Operations.
Table 5.2.26.1-1: NF services provided by the UPF
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
Nupf_EventExposure Notify Subscribe/Notify NEF, AF, NWDAF,
TSNAF/DCCF/MFAF/TSCTSF Subscribe Subscribe/Notify NWDAF/DCCF, SMF Unsubscribe
Subscribe/Notify NWDAF/DCCF, SMF Nupf_GetPrivateUEIPaddr Get Request/Response
NEF
#### 5.2.26.2 Nupf_EventExposure Service
##### 5.2.26.2.1 General
**Service description:** This service can expose UPF related information to
other NFs. There are several operations for this service:
\- Notifying events on the PDU Session to the NFs.
\- Allow consumer NFs to subscribe and unsubscribe for an Event ID on UPF.
The following events can be notified to a NF consumer:
\- QoS Monitoring. This event provides QoS Flow level performance information
and can be used for direct event notification of QoS Monitoring reports to a
different NF than the SMF as defined in clause 5.8.2.18 of TS 23.501 [2], or
it may be for UPF Data collection by NWDAF for analytics (see TS 23.288 [50])
as described in clause 4.15.4.5.
Subscription to this event is always indirect via SMF. The subscription
specifies the type of measurement that is being requested. A combination of
the information listed below can be requested.
UPF and SMF interact using Session Reporting Rules as defined in clause
5.8.5.11 of TS 23.501 [2].
The event notification may contain following information:
\- QoS monitoring result for the QoS parameter(s) to be measured defined in
clause 5.45 of TS 23.501 [2], e.g. UL packet delay, DL packet delay, or round
trip packet delay.
\- UserDataUsageMeasures. This event provides information of user data usage
of the User PDU Session. It can be used for UPF Data Collection by NWDAF for
analytics (see TS 23.288 [50]) as described in clause 4.15.4.5.
SMF and other allowed direct consumers shall use Service Based Interface
subscription service operation to subscribe this UPF event. The subscription
request specifies type of measurement that is being requested and for which
target traffic, which is either the whole PDU Session or traffic identified by
either Application Id or traffic filter information and the required
granularity for the information reported. A combination of the information
listed below can be requested.
The event notification may contain following information:
\- Volume Measurement: measures of data volume exchanged (UL, DL and/or
overall) and/or number of packets exchanged (UL, DL and/or overall) with or
without application granularity.
\- Throughput Measurement: measures of data throughput (UL and DL) measures
aggregated for the PDU Session or per application.
\- Application related Information: URL/s and/or Domain information (domain
name and protocol) detected for the target traffic.
When the subscription requests that information is provided per data flow, the
notification includes the packet filter set and the Applications Identifier if
available.
\- UserDataUsageTrends. This event provides statistical measurements. It can
be used for UPF Data Collection by NWDAF for analytics (see TS 23.288 [50]) as
described in clause 4.15.4.5.
SMF and other allowed direct consumers shall use SBI subscription operation to
subscribe this UPF event. The subscription specifies for which target traffic
the information is requested, which is either the whole PDU Session or traffic
identified by either Application Id or traffic filter information and the
required granularity for the information reported.
The event notification may contain following information:
\- Throughput Statistic Measurement (average and/or peak throughput) over the
measurement period for the PDU Session or per application.
When the subscription requests that information is provided per data flow, the
notification includes the packet filter set and the Applications Identifier if
available.
\- TSC management information (UMIC, PMIC, NW-TT port number) as defined in
clause 5.8.5.14 of TS 23.501 [2].
TSC management information event can be the result of an implicit subscription
of the PCF on behalf of the TSNAF/TSCTSF via the Npcf_SMPolicyControl service
as described in clause 5.28 of TS 23.501 [2].
If the consumer of UPF service is NWDAF and the target of UE is any UE,
according to the Analytic ID from consumer, the NWDAF can decide which kind of
information should be collect from UPF and event ID to use. Subscription may
be performed directly towards UPF or via SMF as described in clause 4.15.11.
The UPF collects the data according to the event ID and exposes the related
information directly regardless of whether the subscription has ben relayed by
the SMF.
##### 5.2.26.2.2 Nupf_EventExposure_Notify service operation
**Service operation name:** Nupf_EventExposure_Notify
**Description:** This service operation reports the event and information to
the consumer that has subscribed implicitly.
**Input Required:** Event ID, UE address (i.e. IP address or MAC address).
Notification Correlation Information.
**Input, Optional:** UE ID, Event specific parameter as described in clause
5.2.26.2.1, time stamps for the measures, Application Id and Packet Filter
Set.
**Output Required:** Result Indication.
**Output, Optional:** None.
##### 5.2.26.2.3 Nupf_EventExposure_Subscribe service operation
**Service operation name:** Nupf_EventExposure_Subscribe
**Description:** This service operation is used by an NF to subscribe or
modify a subscription to UPF event exposure notifications e.g. for the purpose
of UPF data collection on a specified PDU Session or for all PDU Sessions of
one UE or any UE.
**Input, Required:** NF ID, Target of Event Reporting, (set of) Event ID(s)
defined in clause 5.2.26.2.1, Notification Target Address (+ Notification
Correlation ID), Event Reporting Information defined in Table 4.15.1-1.
**Input, Optional:** Subscription Correlation ID (in the case of modification
of the event subscription), Expiry time, DNN, S-NSSAI, Application ID(s),
traffic filtering information, Type of measurement, granularity of
measurement, Reporting suggestion information.
**Output, Required:** When the subscription is accepted: Subscription
Correlation ID (required for management of this subscription), Expiry time
(required if the subscription can be expired based on the operator\'s policy).
**Output, Optional:** First corresponding event report is included, if
available (see clause 4.15.1). Notification Target Address (+ Notification
Correlation ID) is used to correlate Notifications sent by UPF with this
subscription.
##### 5.2.26.2.4 Nupf_EventExposure_UnSubscribe service operation
**Service operation name:** Nupf_EventExposure_UnSubscribe
**Description:** The NF consumer uses this service operation to unsubscribe
for a specific event.
**Input, Required:** Subscription Correlation ID.
**Input, Optional:** None.
**Output, Required:** Operation execution result indication.
**Output, Optional:** None.
The NF consumer or the SMF on behalf of other NF unsubscribes the event
notification by invoking Nupf_EventExposure_Unsubscribe (Subscription
Correlation ID) to the UPF.
#### 5.2.26.3 Nupf_GetPrivateUEIPaddr service
##### 5.2.26.3.1 General
This service provides the UE IP address translation information.
##### 5.2.26.3.2 Nupf_GetPrivateUEIPaddr_Get service operation.
**Service operation name:** Nupf_GetPrivateUEIPaddr_Get
**Description:** NF service consumer gets the UE private IP address and IP
domain assigned by 5GC.
**Inputs, Required:** IP address and port, (e.g. a public IP address).
The provided IP address and port uniquely identifies the UE IP address behind
a NAT.
**Inputs, Optional:** IP domain, DNN, S-NSSAI.
**Outputs, Required:** UE private IP address.
**Outputs, Optional:** IP domain of UE private IP address, SUPI.
### 5.2.27 TSCTSF Services
#### 5.2.27.1 General
The following table shows the TSCTSF Services and Service Operations:
Table 5.2.27.1-1: NF Services provided by the TSCTSF
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
**Ntsctsf_TimeSynchronization** ConfigUpdate Request/Response AF, NEF
ConfigCreate Request/Response AF, NEF ConfigDelete Request/Response AF, NEF
ConfigUpdateNotify Subscribe/Notify AF, NEF CapsSubscribe Subscribe/Notify AF,
NEF CapsUnsubscribe Subscribe/Notify AF, NEF CapsNotify Subscribe/Notify AF,
NEF **Ntsctsf_ASTI** Create Request/Response AF, NEF Update Request/Response
AF, NEF Delete Request/Response AF, NEF Get Request/Response AF, NEF
UpdateNotify Subscribe/Notify AF, NEF Subscribe Subscribe/Notify AF, NEF
UnSubscribe Subscribe/Notify AF, NEF **Ntsctsf_QoSandTSCAssistance** Create
Request/Response AF, NEF Update Request/Response AF, NEF Delete
Request/Response AF, NEF Notify Subscribe/Notify AF, NEF Subscribe
Subscribe/Notify AF, NEF Unsubscribe Subscribe/Notify AF, NEF
#### 5.2.27.2 Ntsctsf_TimeSynchronization service
##### 5.2.27.2.1 General
**Service description:** This service provides:
\- Request authorization of NF Service Consumer requests.
\- NF Service Consumer request to create update and delete time
synchronization configuration and to activate and deactivate the time
synchronization service as described in clause 5.27.1.8 of TS 23.501 [2].
##### 5.2.27.2.2 Ntsctsf_TimeSynchronization_ConfigCreate operation
**Service operation name:** Ntsctsf_TimeSynchronization_ConfigCreate
**Description:** Authorize the request, create a time synchronization
configuration and activate the time synchronization service with the
configuration.
**Inputs, Required:** Reference to time synchronization capability set (i.e.
the Subscription Correlation ID as in the response to
Ntsctsf_TimeSynchronization_CapsSubscribe request), user plane node ID,
mandatory service parameters as described in Table 4.15.9.3-1, Notification
Target Address.
**Inputs, Optional:** Optional service parameters as described in Table
4.15.9.3-1.
**Outputs, Required:** Operation execution result indication, in successful
operation the PTP instance reference.
**Outputs, Optional:** None.
##### 5.2.27.2.3 Ntsctsf_TimeSynchronization_ConfigUpdate operation
**Service operation name:** Ntsctsf_TimeSynchronization_ConfigUpdate
**Description:** Authorize the request and forward the request to update the
time synchronization configuration.
**Inputs, Required:** PTP instance reference.
**Inputs, Optional:** List of UE identities (SUPIs) to be added to the time
synchronization configuration. List of UE identities (SUPIs) to be removed
from the time synchronization configuration. (g)PTP grandmaster enabled,
grandmaster priority, Time Domain, Temporary Validity Condition, clock quality
detail level, clock quality acceptance criteria as described in Table
4.15.9.3-1.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.2.4 Ntsctsf_TimeSynchronization_ConfigDelete operation
**Service operation name:** Ntsctsf_TimeSynchronization_ConfigDelete
**Description:** Authorize the request, delete the time synchronization
configuration and deactivate the corresponding time synchronization service.
**Inputs, Required:** PTP instance reference.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.2.5 Ntsctsf_TimeSynchronization_ConfigUpdateNotify operation
**Service operation name:** Ntsctsf_TimeSynchronization_ConfigUpdateNotify
**Description:** Forward the notification for the time synchronization
configuration. When the TSCTSF detects a change corresponding to a time
synchronization configuration, it invokes
Ntsctsf_TimeSynchronization_ConfigUpdateNotify service operation to the NF
consumer(s) which has subscribed for the event. The following table describes
the parameters in the event.
Table 5.2.27.2.5-1: Time Synchronization configuration event parameters
+----------------------------------+----------------------------------+ | Event filter | Description | +==================================+==================================+ | **For each PTP port in the PTP | | | instance** | | +----------------------------------+----------------------------------+ | Either UE identity (for a DS-TT | Identifies the UE/DS-TT which | | port), or \"N6 interface\" | the parameters below apply. \"N6 | | indication | interface\" indicates that the | | | parameters below apply to the N6 | | | interface. | | | | | | If the \"PTP port\" needs to be | | | identified, this field refers to | | | the UE identity (GPSI or SUPI). | | | | | | If the N6 termination needs to | | | be identified, then this field | | | indicates \"N6 interface\" flag, | | | instead of SUPI or GPSI. | +----------------------------------+----------------------------------+ | PTP port state | Active or Inactive. | | | | | | Active = PTP port state is in | | | Leader, Follower or Passive | | | state. | | | | | | Inactive = PTP port is in any | | | other state. | | | | | | If any of the PTP ports in NW-TT | | | are in Leader, Follower, or | | | Passive, then \"active\" is | | | reported for N6 interface, | | | otherwise \"passive\" is | | | reported for N6 interface. | +----------------------------------+----------------------------------+ | Clock quality acceptance | Indicates if the clock quality | | criteria result | acceptance criteria for the | | | service can be met or not. | | | | | | Acceptable = PTP port meets the | | | clock quality acceptance | | | criteria. | | | | | | Non acceptable = PTP port does | | | not meet the clock quality | | | acceptance criteria. | +----------------------------------+----------------------------------+
NOTE: Leader and Follower terms in this specification are aligned with NOTE 2
in clause 5.27.1.2.2.1 of TS 23.501 [2].
**Inputs, Required:** PTP instance reference, current state of the time
synchronization configuration (i.e. whether the time synchronization
configuration is active or not for the PTP ports of the PTP instance).
**Inputs, Optional:** Time synchronization information as described in Table
5.2.27.2.5-1.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.2.6 Ntsctsf_TimeSynchronization_CapsSubscribe operation
**Service operation name:** Ntsctsf_TimeSynchronization_CapsSubscribe
**Description:** The AF subscribes to receive notification about time
synchronization capabilities for a list of UE(s) or a group of UEs or any UE
using DNN/S-NSSAI combination.
Event Filters are used to specify the conditions to match for notifying the
event. If there are no conditions to match then the Event Filter is not
provided. The following table describes the Event Filters supported by the
service:
Table 5.2.27.2.6-1: Time Synchronization capability event filters
Event filter Description
* * *
List of UE identities or External Group Identifier or Internal Group
Identifier Only the included UE identities (GPSI or SUPI) or Groups of UEs
identified by an External Group Identifier/Internal Group Identifier are
considered for the notification. PTP instance types Supported PTP instance
types as described in clause 5.27.1.4 of TS 23.501 [2]. Transport protocols
Supported transport protocols for PTP as described in clause 5.27.1.4 of TS
23.501 [2]. Supported PTP Profiles Identifies the PTP profiles supported by
5GS for the reported UE.
**Inputs, Required:** Either a combination of (DNN, S-NSSAI) or an AF-Service-
Identifier and Notification Target Address.
**Inputs, Optional:** Event Filter(s) as described in Table 5.2.27.2.6-1,
Report Type (can be either one-time reporting, periodic reporting or event
based reporting).
**Outputs, Required:** Operation execution result indication. When the
subscription is accepted: Subscription Correlation ID, Expiry time.
**Outputs, Optional:** None.
##### 5.2.27.2.7 Ntsctsf_TimeSynchronization_CapsUnsubscribe operation
**Service operation name:** Ntsctsf_TimeSynchronization_CapsUnsubscribe
**Description:** The AF unsubscribes to receive notification about time
synchronization for a UE or a group of UEs or any UE using a DNN/S-NSSAI
combination.
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.2.8 Ntsctsf_TimeSynchronization_CapsNotify operation
**Service operation name:** Ntsctsf_TimeSynchronization_CapsNotify
**Description:** Forward the notification for the time synchronization
configuration.
When the TSCTSF detects an event corresponding to a Subscription, it invokes
Ntsctsf_TimeSynchronization_CapsNotify service operation to the NF
consumer(s), e.g. a NEF or an AF within the operator\'s domain, that has
subscribed for the event. The following table describes the parameters in the
event.
Table 5.2.27.2.8-1: Time Synchronization capability event parameters
+----------------------------------+----------------------------------+ | Time Synchronization event | Description | | parameter | | +==================================+==================================+ | List of User-Plane Node IDs | Identifies the applicable NW-TT | | | (NOTE). | +----------------------------------+----------------------------------+ | **For each User-Plane Node ID** | | +----------------------------------+----------------------------------+ | (g)PTP grandmaster capable | Indicates separately whether | | | User-Plane Node ID supports | | | acting as a gPTP and/or PTP | | | grandmaster. | +----------------------------------+----------------------------------+ | 5G Access Stratum Time source | Indicates the 5G clock quality | | | supported (i.e. the source of | | | time used by the 5GS). | | | | | | Allowed values: Atomic clock, | | | GNSS, terrestrial radio, serial | | | time code, PTP, NTP, hand set, | | | internal oscillator, other. | +----------------------------------+----------------------------------+ | List of UEs associated with the | A list of UEs associated to each | | User-Plane Node ID | user-plane Node ID. | +----------------------------------+----------------------------------+ | **For each UE** | | +----------------------------------+----------------------------------+ | UE identity (GPSI or SUPI) | Identifies the UE to which the | | | reported parameters below apply. | +----------------------------------+----------------------------------+ | PTP instance types | Supported PTP instance types as | | | described in clause 5.27.1.4 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | Transport protocols | Supported transport protocols | | | for PTP as described in | | | clause 5.27.1.4 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | Supported PTP Profiles | Identifies the PTP profiles | | | supported by 5GS for the | | | reported UE. | +----------------------------------+----------------------------------+ | NOTE: This is needed to limit | | | the PTP instance into a single | | | NW-TT. In this way the AF can | | | know e.g. UE1/UE2/UE3 are served | | | by NW-TT1, UE4/UE5/UE6 are | | | served by NW-TT2. The AF can | | | control the PTP instances per | | | NW-TT. | | +----------------------------------+----------------------------------+
**Inputs, Required:** Subscription Correlation ID.
**Inputs, Optional:** Time synchronization capabilities as described in Table
5.2.27.2.8-1.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.2.9 Void
##### 5.2.27.2.10 Void
##### 5.2.27.2.11 Void
##### 5.2.27.2.12 Void
#### 5.2.27.3 Ntsctsf_QoSandTSCAssistance
##### 5.2.27.3.1 General
**Service description:** This service provides:
\- Request authorization of NF Service Consumer requests.
\- NF Service Consumer request specific QoS and provide assistance for
handling traffic characterized by TSC QoS parameters as described in clause
6.1.3.22 of TS 23.503 [20].
##### 5.2.27.3.2 Ntsctsf_QoSandTSCAssistance_Create operation
**Service operation name:** Ntsctsf_QoSandTSCAssistance_Create
**Description:** The consumer requests the network to provide a specific QoS
for an AF session or a UE or a group of UEs.
**Inputs, Required:** AF Identifier, Target UE identifier (UE address, or GPSI
or External Group Identifier), Flow description(s) or External Application
Identifier, QoS Reference or individual QoS parameters as described in clause
6.1.3.22 of TS 23.503 [20].
**Inputs, Optional:** sponsored data connectivity information if applicable,
Alternative Service Requirements (containing one or more QoS Reference
parameters or Requested Alternative QoS Parameter Set(s) in a prioritized
order), QoS parameter(s) to be measured as defined in clause 5.45 of TS 23.501
[2], Reporting frequency, Target of reporting as described in clause 6.1.3.21
of TS 23.503 [20], DNN if available, flow direction, Burst Arrival Time at UE
(uplink) or UPF (downlink), Periodicity, Time domain, Survival Time, BAT
Window or Capability for BAT adaptation, Periodicity Range.
**Outputs, Required:** Transaction Reference ID, result.
**Output (optional):** None.
##### 5.2.27.3.3 Ntsctsf_QoSandTSCAssistance_Update operation
**Service operation name:** Ntsctsf_QoSandTSCAssistance_Update
**Description:** The consumer requests the network to update the QoS and/or
additional Alternative QoS for an AF session or a UE or a group of UEs.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** Flow description, QoS Reference or individual QoS
parameters as described in clause 6.1.3.22 of TS 23.503 [20], sponsored data
connectivity information if applicable, Alternative Service Requirements
(containing one or more QoS Reference parameters or Requested Alternative QoS
Parameter Set(s) in a prioritized order), QoS parameter(s) to be measured as
defined in clause 5.45 of TS 23.501 [2], Reporting frequency, Target of
reporting as described in clause 6.1.3.21 of TS 23.503 [20], flow direction,
Burst Arrival Time at UE (uplink) or UPF (downlink), Periodicity, Time domain,
Survival Time, BAT Window or Capability for BAT adaptation, Periodicity Range.
**Outputs, Required:** Result.
**Output (optional):** None.
##### 5.2.27.3.4 Ntsctsf_QoSandTSCAssistance_Delete operation
**Service operation name:** Ntsctsf_QoSandTSCAssistance_Delete
**Description:** The consumer requests the network to delete the AF session
with requested QoS or the AF session with requested QoS including Alternative
Service Requirements to revoke the Service Requirement(s) and/or additional
Alternative Service Requirement(s) for a UE or a group of UEs.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** None.
**Outputs, Required:** Transaction Reference ID, result.
**Output (optional):** None.
##### 5.2.27.3.5 Ntsctsf_QoSandTSCAssistance_Notify operation
**Service operation name:** Ntsctsf_QoSandTSCAssistance_Notify
**Description:** TSCTSF reports the QoS Flow level event(s) to the consumer.
**Inputs, Required:** Notification Correlation ID, Reports of the events as
defined in clause 6.1.3.18 of TS 23.503 [20].
**Inputs, Optional:** When the event report is for QoS Monitoring, includes
QoS Monitoring report for the QoS parameter(s) to be measured defined in
clause 5.45 of TS 23.501 [2], e.g. UL packet delay, DL packet delay, or round
trip packet delay of the single UP path or two UP paths in the case of
redundant transmission, as defined in clause 5.33.3.2 of TS 23.501 [2]. When
the AF has provided Capability for BAT Adaptation or BAT Window, can include
BAT offset as described in clause 5.27.2.5 of TS 23.501 [2].
**Outputs, Required:** None.
**Output (optional):** None.
##### 5.2.27.3.6 Ntsctsf_QoSandTSCAssistance_Subscribe operation
**Service operation name:** Ntsctsf_QoSandTSCAssistance_Subscribe
**Description:** The consumer requests the network to subscribe to receive an
event about the AF session with requested QoS or the AF session with requested
QoS including Alternative Service Requirements.
**Inputs, Required:** Notification Target Address, Notification Correlation
ID, (Set of) Event ID(s) as specified in clause 6.1.3.18 of TS 23.503 [20].
**Inputs, Optional:** None.
**Outputs, Required:** Subscription Correlation Id, result.
**Output (optional):** None.
##### 5.2.27.3.7 Ntsctsf_QoSandTSCAssistance_Unsubscribe operation
**Service operation name:** Ntsctsf_QoSandTSCAssistance_unsubscribe
**Description:** The consumer requests the network to unsubscribe to receive
an event about the AF session with requested QoS or the AF session with
requested QoS including Alternative Service Requirements.
**Inputs, Required:** Subscription Correlation Id, (Set of) Event ID(s) as
specified in clause 6.1.3.18 of TS 23.503 [20].
**Inputs, Optional:** None.
**Outputs, Required:** Result.
**Output (optional):** None.
#### 5.2.27.4 Ntsctsf_ASTI service
##### 5.2.27.4.1 General
**Service description:** This service provides:
\- Request authorization of NF Service Consumer requests.
\- NF Service Consumer request to control the 5G access stratum time
distribution configuration as described in clause 5.27.1.8 of TS 23.501 [2].
##### 5.2.27.4.2 Ntsctsf_ASTI_Create operation
**Service operation name:** Ntsctsf_ASTI_Create
**Description:** Authorize the request, activate the 5G access stratum time
distribution.
**Inputs, Required:** Target for 5G access stratum time distribution (one UE
identified by a SUPI or a GPSI, a group of UEs identified by an Internal Group
Identifier or an External Group Identifier), AF identifier, mandatory service
parameters as described in Table 4.15.9.4-1.
**Inputs, Optional:** Optional service parameters as described in Table
4.15.9.4-1, subscription for 5G access stratum time distribution status,
Notification Target Addess.
**Outputs, Required:** Operation execution result indication, in successful
operation the time synchronization configuration id.
**Outputs, Optional:** None.
##### 5.2.27.4.3 Ntsctsf_ASTI_Update operation
**Service operation name:** Ntsctsf_ASTI_Update
**Description:** Authorize the request and forward the request to update the
5G access stratum time distribution configuration.
**Inputs, Required:** Time synchronization configuration id.
**Inputs, Optional:** service parameters as in Ntsctsf_ASTI_Create input.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.4.4 Ntsctsf_ASTI_Delete operation
**Service operation name:** Ntsctsf_ASTI_Delete
**Description:** Authorize the request, delete the 5G access stratum time
distribution configuration, deactivate the corresponding 5G access stratum
time distribution service.
**Inputs, Required:** Time synchronization configuration id.
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.4.5 Ntsctsf_ASTI_Get operation
**Service operation name:** Ntsctsf_ASTI_Get
**Description:** Authorize the request and query the status of the access
stratum time distribution.
**Inputs, Required:** List of UE identities (GPSI or SUPI).
**Inputs, Optional:** None.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** Status of the access stratum time distribution (active,
optionally with requested time synchronization error budget or inactive).
##### 5.2.27.4.6 Ntsctsf_ASTI_UpdateNotify operation
**Service operation name:** Ntsctsf_ASTI_UpdateNotify
**Description:** Forward the notification for the 5G access stratum time
distribution status change. When the TSCTSF detects a change, it invokes
Ntsctsf_ASTI_UpdateNotify service operation to the NF consumer(s) which has
subscribed for the event.
**Inputs, Required:** Notification Correlation ID, Status of the access
stratum time distribution (active or inactive).
**Inputs, Optional:** If the Status of the access stratum time distribution is
inactive due to acceptance criteria, Clock quality acceptance criteria result,
impacted UE list.
**Outputs, Required:** Operation execution result indication.
**Outputs, Optional:** None.
##### 5.2.27.4.7 Ntsctsf_ASTI_Subscribe operation
**Service operation name:** Ntsctsf_ASTI_Subscribe
**Description:** Subscribe 5G access stratum time distribution status change.
**Inputs, Required:** Target for 5G access stratum time distribution (one UE
identified by a SUPI or a GPSI, a group of UEs identified by an Internal Group
Identifier or an External Group Identifier), AF identifier.
**Inputs, Optional:** Clock quality detail level, Clock quality acceptance
criteria.
**Outputs, Required:** Transaction Reference ID, result.
**Outputs, Optional:** None.
##### 5.2.27.4.8 Ntsctsf_ASTI_Unsubscribe operation
**Service operation name:** Ntsctsf_ASTI_Unsubscribe
**Description:** Unsubscribe to 5G access stratum time distribution status or
NG_RAN timing synchronization status change.
**Inputs, Required:** Transaction Reference ID.
**Inputs, Optional:** None.
**Outputs, Required:** Result Indication.
**Outputs, Optional:** None.
###### ## Annex A (informative): Drafting rules and conventions for NF
services
# A.1 General
This informative Annex provides drafting rules and conventions followed in
this technical specification (and TS 23.501 [2]) for the definition of NF
services offered over the service-based interfaces.
# A.2 Naming
## A.2.1 Service naming
Each NF service provided by a service-based interface shall be named and
referred to according to the following nomenclature:
_\- Nnfname_ServiceName_ , where _Nnfname_ is the service-based interface
where the NF service is invoked. See clause 4.2.5 of TS 23.501 [2] for the
list of service-based interfaces in the 5GS Architecture.
Example (illustrative): _Namf_Registration._
## A.2.2 Service operation naming
If a service contains multiple independent operations, each operation shall be
named and referred to according to the following nomenclature:
_\- Nnfname_ServiceName_ServiceOperation[Method]_ , where the _ServiceName_
represents the actual NF service. The _ServiceOperation_ itself defines the
available service functionality which can be addressed by a specific
operation. The _Method(s)_ is/are the action(s), how the ServiceOperation can
be used. It can be created, read, updated or deleted.
Example (illustrative): _Namf_Session_Registration[Create]_ ,
_Namf_Session_Registration[Delete]_
In general, this operation naming structure for the given example is depicted
in a tree-structure diagram:
Figure A.2.2-1: Service Operation Naming and its Methods
# A.3 Representation in an information flow
Invoking a service or service operation within an information flow is
represented using a disaggregated representation (see figure A.3-1).
The disaggregated representations on figure A.3-1 shall be used as follows:
\- The \ represents the actual step number in the information flow e.g.
â€³7.â€³.
\- Representation a) shall be used when the step is required.
\- Representation b) shall be used when the step is optional or conditional.
Figure A.3-1: Disaggregated representation of a NF service or service
operation in information flows
NOTE: Depending on the information flow, the order of NF Producer and NF
Consumer can be reversed.
# A.4 Reference to services and service operations in procedures
Whenever a procedure needs to refer to the service or service operation of a
service-based interface, the naming in clause A.2 shall be used, using italic
font. Unless otherwise obvious in the text, the NF Consumer of the service or
service operation shall be indicated within parenthesis after the service or
service operation name.
\- \> (\)
Example: e.g. _Namf_Registration_RelocationRequest (AMF)_
# A.5 Service and service operation description template
The description of a service or service operation in this specification shall
be done according to the following template.
NOTE: The heading level should follow that of the actual clause where the
service is specified.
**X.x \ >**
**X.x.1 Description**
**Service or service operation name:**
\>.
**Description:** \.
**Known NF Consumers:** \.
**Inputs, Required:** \ _\-- Parameters required from NF
Consumer for successful completion of the service or service operation.
Parameters required for the operation of the underlying protocol shall not be
listed._
**Inputs, Optional:** \ _\-- Additional parameters that
may be provided by NF Consumer for execution of the service or service
operation. Parameters required for the operation of the underlying protocol
shall not be listed._
**Outputs, Required:** \, \>, \ _\-- Parameters provided to
NF Consumer and/or service triggered upon successful completion of the service
and/or other (e.g. procedure triggered). Parameters required for the operation
of the underlying protocol shall not be listed._
**Outputs, Optional:** \ \-- _Additional parameters
provided to NF Consumer upon successful completion of the service or service
operation. Parameters required for the operation of the underlying protocol
shall not be listed._
**X.x.2 Service/service operation information flow**
\.
NOTE: This information flow can require invoking other services. In this case,
the invoked services are represented as described in clause A.3.
# A.6 Design Guidelines for NF services
Clause 7.1.1 of TS 23.501 [2] defines the criteria for defining the NF
services. The following clauses identify the design guidelines that shall be
considered for identifying the NF services.
## A.6.1 Self-Containment
The following design guidelines are used for identifying self-contained NF
services.
\- Each NF service operates on its own set of context(s). A context refers to
a state or a software resource or an internal data storage. The NF service
operations can create, read, update or delete the context(s).
\- Any direct access of a context(s) owned by a NF service is be made by the
service operations of that NF service. Services provided by the same NF can
communicate internally within the NF.
## A.6.2 Reusability
The following design guidelines are used for specifying NF services to be
reusable.
\- NF service operations are specified such that other NF can potentially
invoke them in future, if required.
\- The service operations may be usable in multiple system procedures
specified in clause 4 of this specification.
\- Using clause 4 of the current document, the system procedures in which the
NF service operations can be used are considered and based on that the
parameters for the NF service operations are clearly listed.
NOTE: It is possible that, when mapping an end to end call flow to service
based architecture, one step in the call flow may map to multiple NF service
operation invocations. This specification clearly identifies each NF service
operation invocation in the call flow. Protocol optimization of multiple NF
service operation invocations are left for TS 29.500 [17] consideration.
## A.6.3 Use Independent Management Schemes
The mechanisms for independent management schemes are not in scope of this
specification.
###### ## Annex B (informative): Drafting Rules for Information flows
The following drafting rules are recommended for information flows specified
in this specification in order to ensure that the Control Plane network
functions can be supported with service based interfaces:
1\. Information flows should describe the end to end functionality. NF
services in clause 5 shall only be derived from the information flows in
clause 4.
2\. Information flows should strive to use type of interactions such as
REQUEST/RESPONSE (e.g. location request, location response), SUBSCRIBE/NOTIFY
between Core CP NFs. Any other type of interactions described should have
justifications for its use.
3\. Information flows should also ensure readability thus the semantics of the
REQUEST/RESPONSE should still be maintained (for instance, we need to indicate
PDU Session request, PDU Session response and Subscribe for UE location
reporting/Notify UE location reporting) for readers and developers to
understand the need for a certain transaction.
NOTE: As stated in TS 23.501 [2], service based interface is not supported for
N1, N2, N4. Thus, the rules are not meant for those interfaces.
###### ## Annex C (informative): Generating EPS PDN Connection parameters from
5G PDU Session parameters
This annex specifies how to generate the EPS PDN connection parameters from
the 5G PDU Session parameters in SMF+PGW-C.
When the SMF+PGW-C is requested to set up/modify either a PDN connection or a
PDU session supporting interworking between EPS and 5GS, the SMF+PGW-C
generates the PDN Connection parameters from the PDU session parameters.
When the SMF+PGW-C generates the PDN Connection parameters based on the PDU
Session parameters, the following rules hold:
\- PDN type: the PDN type is set to IPv4, IPv6 or IPv4v6 if the PDU Session
Type is IPv4, IPv6 or IPv4v6, respectively. The PDN Type is set to Ethernet if
the MME, SGW and UE support Ethernet PDN Type, otherwsie the PDN type is set
to Non-IP for Ethernet and Unstructured PDU Session Types
\- EPS bearer ID: the EBI is requested from the AMF during the establishment
of a QoS Flow as described in clause 4.11.1.4.1 for PDU Sessions supporting
interworking between EPS and 5GS. The EBI is obtained from MME during the
establishment of an EPS Bearer (that is triggered by an establishment of a QoS
Flow) as defined in TS 23.401 [13] for PDN Connections hosted by SMF+PGW-C.
The association between EBI and QoS Flow is stored by the SMF.
\- APN-AMBR: APN-AMBR is set according to operator policy (e.g. taking the
Session AMBR into account).
\- EPS QoS parameters (including ARP, QCI, GBR and MBR):
If QoS Flow is mapped to one EPS bearer, ARP, GBR and MBR of the EPS Bearer is
set to the ARP, GFBR and MFBR of the corresponding QoS Flow, respectively. For
standardized 5QIs, the QCI is one to one mapped to the 5QI. For non-
standardized 5QIs, the SMF+PGW-C derives the QCI based on the 5QI and operator
policy.
A GBR QoS Flow is mapped 1 to 1 to a GBR dedicated EPS Bearer if an EBI has
been assigned. After mobility to EPS traffic flows corresponding to GBR QoS
Flow for which no EBI has been assigned will continue flowing on the default
EPS bearer if it does not have assigned TFT.
If multiple QoS Flows are mapped to one EPS bearer, the EPS bearer parameters
are set based on operator policy, e.g. EPS bearer QoS parameters are set
according to the highest QoS of all mapped QoS Flows.
After mobility to EPS traffic flows corresponding to Non-GBR QoS Flows for
which no EBI has been assigned will continue flowing on the default EPS Bearer
if it does not have assigned TFT.
###### ## Annex D (normative): UE Presence in Area of Interest
# D.1 Determination of UE presence in Area of Interest by AMF
If the AMF has requested NG-RAN location reporting as specified in clause 4.10
for the Area Of Interest and UE is in CM-CONNECTED state, including
RRC_CONNECTED and RRC_INACTIVE state, the AMF determines the UE presence in
the Area of Interest as the reported value from the NG-RAN, as specified in
clause D.2.
If the AMF has requested N2 Notification as specified in clause 4.8.3, the AMF
determines the UE presence in Area Of Interest as follows, taking N2
Notification from NG-RAN into consideration:
\- IN:
\- if the UE is in CM-CONNECTED with RRC_CONNECTED state and if the last
received User Location Information for the UE is inside the Area Of Interest
service area; or
NOTE 1: The above is valid e.g. under the condition that Area Of Interest
border coincides with NG-RAN node service area border(s).
\- if the UE is in CM-CONNECTED and if the UE is inside a Registration Area
which is completely contained within the Area Of Interest.
\- OUT:
\- if the UE is in CM-CONNECTED with RRC_CONNECTED state and if the last
received User Location Information for the UE is outside the Area Of Interest;
or
NOTE 2: The above is valid e.g. under the condition that Area Of Interest
border coincides with NG-RAN node service area border(s).
\- if the UE is in CM-CONNECTED and if UE is inside a Registration Area which
does not contain any part of Area Of Interest.
\- UNKNOWN:
if none of above conditions for IN or OUT is met.
Otherwise, AMF determines the UE presence of Area Of Interest as follows:
\- IN:
\- if the UE is inside the Area Of Interest service area and if the UE is in
CM-CONNECTED state; or
\- if the Area Of Interest service area is indicated as a RAN node identity
and the Parameter Type with value \"RAN timing synchronization status change
event\" is included and the UE has indicated a support for registration update
procedure due to RAN timing synchronization status as described in clause
5.3.4.4 of TS 23.501 [2] and the most recent N2 connection for the UE is via a
RAN Node that is included in the Area Of Interest service area; or
\- if the Parameter Type with value \"Adjust AoI based on RA\" is included and
the UE is inside a Registration Area which contains at least one Tracking Area
that is contained within the Area Of Interest; or
\- if the UE is inside a Registration Area which is contained within the Area
Of Interest.
\- OUT:
\- if the UE is outside the Area Of Interest in CM-CONNECTED and the Parameter
Type with value \"Adjust AoI based on RA\" is not included; or
\- if the Area Of Interest service area is indicated as a RAN node identity
and the Parameter Type with value \"RAN timing synchronization status change
event\" is included and the UE has indicated a support for registration update
procedure due to RAN timing synchronization status as described in clause
5.3.4.4 of TS 23.501 [2] and the most recent N2 connection for the UE is via a
RAN Node that is not included in the Area Of Interest service area; or
\- if UE is inside a Registration Area which does not contain any part of Area
Of Interest.
\- UNKNOWN:
if none of above conditions for IN or OUT is met.
# D.2 Determination of UE presence in Area of Interest by NG-RAN
If the AMF has requested for the Area of Interest, NG-RAN determines the UE
presence of Area Of Interest as follows:
\- IN:
\- if the UE is inside the Area Of Interest and the UE is in RRC_CONNECTED
state; or
\- if the UE is inside an RNA which is completely contained within the Area Of
Interest.
\- OUT:
\- if the UE is outside the Area Of Interest in RRC_CONNECTED state; or
\- if UE is inside an RNA which does not contain any part of Area Of Interest.
\- UNKNOWN:
\- if none of above conditions for IN or OUT is met.
###### ## Annex E (normative): Delegated SMF and PCF discovery in the Home
Routed and specific SMF Service Areas scenarios
# E.0 Overview
This Annex describes the option where the SCP is involved in the SMF and PCF
selection for following cases:
\- PDU Session to be established in Home Routed mode,
\- PDU Session requiring an I-SMF as defined in clause
\- PCF discovery in the Roaming scenario
NOTE: No similar Annex is foreseen to describe the discovery and selection of
other NF involving the SCP.
# E.1 Delegated SMF discovery in the Home Routed scenario
Figure E.1: Delegated Discovery of SMF in the Home Routed Scenario
1\. The AMF sends Nnrf_NFDiscovery Request to the V-NRF. The AMF may indicate
the maximum number of H-SMF instances to be returned by the NRF.
2\. The NRF in VPLMN and NRF in HPLMN interact using the Nnrf_NFDiscovery
service. See step 2 in clause 4.17.5.
3\. The AMF gets Nnrf_NFDiscovery service response with one or more profile(s)
of SMF(s) in HPLMN.
4\. The AMF selects an SMF instance in HPLMN (H-SMF endpoint).
5\. The AMF builds a Nsmf_PDUSession_CreateSMContext Request that includes the
endpoint (e.g. URI) of the selected H-SMF in the body of the request. If the
AMF supports delegated SMF discovery and is configured to apply it, the AMF
sends the Nsmf_PDUSession_CreateSMContext Request with Discovery & Selection
parameters to the selected SCP in the VPLMN. Discovery & Selection parameters
include S-NSSAI, UE location (TAI), i.e. parameter for V-SMF selection.
6\. [Optional] The SCP in VPLMN sends Nnrf_NFDiscovery Request to the V-NRF
using Discovery & Selection parameters received from AMF.
7\. [Optional] The SCP in VPLMN gets Nnrf_NFDiscovery service response with
profile(s) of SMF(s) in VPLMN.
8\. The SCP in VPLMN selects an SMF instance in VPLMN (V-SMF), which supports
the Discovery & Selection parameters received earlier from the AMF.
9\. The SCP in VPLMN forwards the Nsmf_PDUSession_CreateSMContext Request
received from the AMF to the selected SMF instance in VPLMN.
10\. If the V-SMF does not support delegated SMF discovery or is not
configured to apply it (Case A), the V-SMF sends Nsmf_PDUSession_Create
Request directly to the H-SMF. Otherwise (Case B), the V-SMF sends the
Nsmf_PDUSession_Create Request to the SCP in VPLMN but adds Discovery &
Selection parameter set to H-SMF endpoint received from the AMF. In both
cases, the V-SMF uses the received endpoint (e.g. URI) of the selected H-SMF
to construct the target destination to be addressed.
NOTE: The Nsmf_PDUSession_Create Request sent by the V-SMF in Case A and in
Case B is the same apart from the Discovery & Selection parameter. The
Nsmf_PDUSession_Create Request received by the H-SMF in Case A and in Case B
is the same.
11\. The SCP in VPLMN sends a Nsmf_PDUSession_Create Request to the selected
SMF instance in HPLMN indicated in step 10.
When the V-SMF responds to AMF with Nsmf_PDUSession_CreateSMContext Response
as in clause 4.3.2.2.2 in step 3b, if the AMF has not stored the SMF Service
Area for the V-SMF, the AMF shall obtain the SMF Service Area for the
concerned V-SMF from the NRF using the Nnrf_NFManagement_NFStatusSubscribe
service operation.
# E.2 Delegated I-SMF discovery
Figure E.2: Delegated Discovery of I-SMF
The following impacts are applicable to clause 4.23.5 (PDU Session
Establishment procedure) to support delegated SMF discovery:
1\. If the AMF supports delegated SMF discovery and is configured to apply it,
the AMF sends an Nsmf_PDUSession_CreateSMContext Request together with
discovery and selection parameters to a SCP. The discovery and selection
parameters include S-NSSAI, DNN, TAI that corresponds to the UE location
required SMF capability (e.g. support of ATSSS).
2\. [Optional] The SCP sends an Nnrf_NFDiscovery Request to the NRF. The
request includes discovery and selection parameters received from AMF in step
1.
3\. [Optional] The SCP gets Nnrf_NFDiscovery service response. The response
may include one or more profile(s) of SMF(s).
Depending on the available information, the SCP may either execute steps in
Case A or in Case B.
Case A There are, either in the NRF response or discovered by the SCP, one or
more SMF instances that support Discovery and selection crireria set by the
AMF.
4\. The SCP selects an SMF instance.
5\. The SCP forwards the Nsmf_PDUSession_CreateSMContext Request to the
selected SMF instance.
Case B There is, either in the NRF response or discovered by the SCP, no SMF
instance that supports Discovery and selection criteria set by the AMF.
6\. The SCP returns an Nsmf_PDUSession_CreateSMContext Response to the AMF
with an error \'NF not found\'
7\. The AMF sends Nnrf_NFDiscovery Request to the NRF. The AMF may indicate
the maximum number of SMF instances to be returned by the NRF.
8\. The AMF gets Nnrf_NFDiscovery service response with one or more profile(s)
of SMF(s).
9\. The AMF selects an SMF instance endpoint.
10\. The AMF builds a Nsmf_PDUSession_CreateSMContext Request that contains
the endpoint (e.g. URI) of the selected SMF in the body of the request. If the
AMF supports delegated SMF discovery and is configured to apply it, the AMF
sends the Nsmf_PDUSession_CreateSMContext Request to a SCP together with
Discovery and selection parameters that include S-NSSAI, TAI that corresponds
to the UE location, i.e. parameter for I-SMF selection.
11\. [Optional] The SCP sends an Nnrf_NFDiscovery Request to the NRF. The
request includes Discovery and selection parameters received from AMF
(including the TAI that corresponds to the UE location).
12\. [Optional] The SCP gets Nnrf_NFDiscovery service response. The response
may include one or more profile(s) of I-SMF(s).
13\. The SCP selects an I-SMF instance that supports the TAI.
14\. The SCP forwards the Nsmf_PDUSession_CreateSMContext Request received
from the AMF to the selected I-SMF instance.
15\. If the I-SMF does not support delegated SMF discovery or is not
configured to apply it (Case A), the I-SMF sends Nsmf_PDUSession_Create
Request directly to the SMF. Otherwise (Case B), the I-SMF sends the
Nsmf_PDUSession_Create Request to the SCP but adds Discovery & Selection
parameter set to the SMF endpoint received from AMF. In both cases the I-SMF
uses the received endpoint (e.g. URI) of the selected SMF to construct the
target destination to be addressed.
NOTE: The Nsmf_PDUSession_Create Request sent by the I-SMF in Case A and in
Case B is the same apart from the Discovery & Selection parameter. The
Nsmf_PDUSession_Create Request received by the SMF in Case A and in Case B is
the same.
16\. The SCP forwards the Nsmf_PDUSession_Create Request to the selected SMF
instance indicated in step 15.
The procedure continues as described in clause 4.3.2.2.2 from Step 7.
Difference comparing to procedure defined in clause 4.3.2.2.2, the V-SMF and
V-UPF are replaced by I-SMF and I-UPF and H-SMF and H-UPF are replaced by SMF
and UPF(PSA) respectively. Also only the S-NSSAI with the value defined by the
serving PLMN is sent to the SMF.
When the I-SMF responds to AMF with Nsmf_PDUSession_CreateSMContext Response
as in clause 4.3.2.2.2 in Step 3b, if the AMF has not stored the SMF Service
Area for the I-SMF, the AMF shall obtain the SMF Service Area for the
concerned I-SMF from the NRF using the Nnrf_NFManagement_NFStatusSubscribe
service operation.
# E.3 Delegated PCF discovery in the Roaming scenario
Figure E.3: Delegated Discovery of PCF in the Home Routed Scenario
1\. The AMF sends Nnrf_NFDiscovery Request to the V-NRF in order to discover a
PCF in HPLMN. The AMF may indicate the maximum number of H-PCF instances to be
returned by the NRF.
2\. The NRF in VPLMN and NRF in HPLMN interact using the Nnrf_NFDiscovery
service. See step 2 in clause 4.17.5.
3\. The AMF gets Nnrf_NFDiscovery service response with one or more profile(s)
of PCF(s) in HPLMN.
4\. The AMF selects a PCF instance in HPLMN.
5\. The AMF builds a Npcf_UEPolicyControl Request that contains the H-PCF ID
in the body of the request. If the AMF supports delegated PCF discovery and is
configured to apply it, the AMF forwards the Npcf_UEPolicyControl Request to
the selected SCP in VPLMN.together with Discovery & Selection parameter set to
V-PCF instance ID.
6\. The SCP in VPLMN selects the corresponding (V-)PCF instance for UE policy
association based on Discovery & Selection parameter received from the AMF.
7\. The SCP in VPLMN forwards the Npcf_UEPolicyControl Request to the selected
PCF instance in VPLMN.
8\. If the V-PCF does not support delegated PCF discovery or is not configured
to apply it (Case A), the V-PCF sends Npcf_UEPolicyControl Request to the
selected PCF instance. Otherwise (Case B), the V-PCF sends the
Npcf_UEPolicyControl Request to a SCP in VPLMN but adds Discovery & Selection
parameter set to H-PCF ID.
9\. The SCP in VPLMN sends an Npcf_UEPolicyControl Request to the selected PCF
instance in HPLMN indicated in step 8.
###### ## Annex F (informative): Information flows for 5GS integration with
TSN or with Deterministic Networking
This annex defines the procedures for 5GS integration with TSN fully-
centralized model as defined in IEEE Std 802.1Q [66], it includes 5GS Bridge
information reporting and 5GS Bridge configuration.
The annex defines also the procedures for 5GS interworking with the TSN
deployed in the transport network, as described in clause 5.28a of TS 23.501
[2].
# F.1 5GS Bridge information reporting
Figure F.1-1: 5GS Bridge information reporting
Identities of 5GS Bridge and UPF/NW-TT ports are pre-configured on the UPF
based on deployment. The SMF requests the UPF/NW-TT to measure and report the
clock drift between the TSN GM time and 5GS GM time for one or more TSN time
domains.
1\. PDU Session Establishment as defined clause 4.3.2.2.1-1 is used to
establish a PDU Session serving for TSC.
During this procedure, the SMF selects a UPF, which supports functions as
defined in clause 5.28.1 of TS 23.501 [2], for the PDU Session.
During this procedure, the SMF receives the UE-DS-TT residence time, DS-TT MAC
address for this PDU Session and port management capabilities from the DS-
TT/UE in PDU Session Establishment request and receives the allocated port
number for DS-TT Ethernet port and user-plane Node ID in N4 Session
Establishment Response message. The UPF allocates the port number for DS-TT,
user-plane Node ID after receiving N4 Session Establishment Request message.
2\. The SMF sends the information received in step 1 to the TSN AF via PCF to
establish/modify the 5GS Bridge. The Npcf_PolicyAuthorization_Notify message
in step 2b is delivered via the pre-configured AF session as described in
clause 4.16.5.1. The TSN AF stores the binding relationship between 5GS user-
plane Node ID, MAC address of the DS-TT Ethernet port and also updates 5GS
bridge delay as defined in clause 5.27.5 of TS 23.501 [2] for future
configuration. The TSN AF requests creation of a new AF session associated
with the MAC address of the DS-TT Ethernet port using the
Npcf_PolicyAuthorization_Create operation (step 2c) and subscribes for TSN
events over the newly created AF session using the
Npcf_PolicyAuthorization_Subscribe operation (step 2d).
In the case of TSN AF support for direct notification from UPF for PMIC and
UMIC, the subscription in step 2d has following additional information:
\"Notification Target Address for PMIC/UMIC UPF event\" and \"Correlation ID
for PMIC/UMIC UPF event\".
Using the 5GS user-plane Node ID received in step 2b the TSN AF subscribes
with the NW-TT for receiving user plane node management information changes
for the 5GS bridge indicated by the 5GS user-plane Node ID as described in
clause 5.28.3.1 of TS 23.501 [2].
After receiving a User plane node Management Information Container (UMIC)
containing the NW-TT port numbers, the TSN AF subscribes with the NW-TT for
receiving NW-TT port management information changes for the NW-TT port
indicated by each of the NW-TT port numbers as described in clause 5.28.3.1 of
TS 23.501 [2].
The TSN AF can use any PDU Session to subscribe with the NW-TT for bridge or
port management information notifications. Similarly, the UPF can use any PDU
Session to send bridge or port management information notifications.
3\. If DS-TT has indicated support for the TSN Time domain number in the port
management capabilities, TSN AF provides the TSN Time domain number to DS-TT.
Optionally, TSN AF provides the TSN Time domain number to NW-TT.
4\. If supported according to the port management capabilities received from
DS-TT, TSN AF retrieves txPropagationDelay and Traffic Class table from DS-TT.
TSN AF also retrieves txPropagationDelay and Traffic Class table from NW-TT.
NOTE: It is assumed that distribution of TSN GM time towards NW-TT and DS-TT
for the TSN time domain is activated before TSN AF retrieves
txPropagationDelay so that DS-TT and NW-TT can convert txPropagationDelay from
5GS time to TSN time before reporting txPropagationDelay to TSN AF.
5\. If DS-TT supports neighbor discovery according to the port management
capabilities received from DS-TT, then TSN AF:
\- provides DS-TT port neighbor discovery configuration to DS-TT to configure
and activate the LLDP agent in DS-TT;
\- subscribes to receive Neighbor discovery information for each discovered
neighbor of DS-TT (see Table 5.28.3.1-1 in TS 23.501 [2].
If DS-TT does not support neighbor discovery, then TSN AF:
\- provides DS-TT port neighbor discovery configuration to NW-TT to configure
and activate the LLDP agent in NW-TT to perform neighbor discovery on behalf
of DS-TT;
\- subscribes to receive Neighbor discovery information for each discovered
neighbor of DS-TT from NW-TT (see Table 5.28.3.1-1 in TS 23.501 [2].
TSN AF:
\- writes NW-TT port neighbor discovery configuration to NW-TT to configure
and activate the LLDP agent in NW-TT;
\- subscribes to receive Neighbor discovery information for each discovered
neighbor of NW-TT (see Table 5.28.3.1-1 in TS 23.501 [2]).
6\. TSN AF receives notifications from DS-TT (If DS-TT supports neighbour
discovery) and NW-TT on discovered neighbors of DS-TT and NW-TT.
7\. The TSN AF constructs the above received information as 5GS Bridge
information and sends them to the CNC to register a new TSN Bridge or update
an existing TSN Bridge.
# F.2 5GS Bridge configuration
For 5GS integrating with fully-centralized model TSN network, the CNC provides
TSN information to the AF.
Figure F.2-1: 5GS Bridge information configuration
1\. CNC provides per-stream filtering and policing parameters according to
clause 8.6.5.2.1 of IEEE Std 802.1Q [66] to AF and the AF uses them to derive
TSN QoS information and related flow information. The CNC provides the
forwarding rule to AF according to clause 8.8.1 of IEEE Std 802.1Q [66]. The
TSN AF uses this information to identify the DS-TT MAC address of
corresponding PDU session.
The AF determines if the stream is UE-UE TSC and divides the stream into UL
and DL streams for PDU Sessions corresponding to ingress DS-TT Ethernet port
and egress DS-TT port(s) as specified in clause 5.28.2 of TS 23.501 [2] and
separately triggers following procedures for the UL and DL streams.
2\. The AF determines the MAC address of a PDU Session based on the previous
stored associations, then triggers an AF request procedure. The AF request
includes the DS-TT MAC address of the PDU session.
Based on the information received from the CNC, 5GS bridge delay information
and the UE-DS-TT residence time, the TSN AF determines the TSN QoS information
and TSC Assistance Container for one or more TSN streams and sends them to the
PCF. The TSN AF also provides Service Data Flow Filter containing Flow
description also includes Ethernet Packet Filters.
3\. When PCF receives the AF request, the PCF finds the correct SMF based on
the DS-TT MAC address of the PDU session and notifies the SMF via
Npcf_SMPolicyControl_UpdateNotify message.
After mapping the received TSN QoS parameters for TSN streams to 5GS QoS, the
PCF triggers Npcf_SMPolicyControl_UpdateNotify message to update the PCC rule
to the SMF. The PCC rule includes the Ethernet Packet Filters, the 5GS QoS
profile along with TSC Assistance Container.
4\. SMF may trigger the PDU Session Modification procedure to establish/modify
a QoS Flow to transfer the TSN streams. During this procedure, the SMF
provides the information received in PCC rules to the UPF via N4 Session
Modification procedure.
Upon reception of the TSC Assistance Container, the SMF determine the TSCAI
for QoS flow and sends the TSCAI along with the QoS profile to the NG RAN.
5\. If needed, the CNC provides additional information (e.g. the gate control
list as defined in clause 8.6.8.4 of IEEE Std 802.1Q [66]) to the TSN AF.
6\. The AF determines the MAC address of a PDU Session for the configured port
based on the previous stored associations, this is used to deliver the Port
Management information to the correct SMF that manages the port via PCF. The
AF triggers an AF request procedure. The AF request includes the DS-TT MAC
address (i.e. the MAC address of the PDU Session), TSN QoS Parameters, Port
Management information Container and the related port number as defined in
clause 5.28.3 of TS 23.501 [2]. The port number is used by SMF to decide
whether the configured port is in DS-TT or NW-TT.
NOTE: When TSN AF needs to convey 5GS Bridge- or NW-TT port-specific
information to the NW-TT/UPF, the TSN AF chooses an arbitrary AF Session
related to the corresponding 5GS bridge and sends the 5GS Bridge-specific
information inside a User plane node Management Information Container (UMIC)
or NW-TT Port Management Information Container (NW-TT PMIC) as specified in TS
23.501 [2].
7\. The PCF determines the SMF based on the MAC address received in the AF
request, the PCF maps the TSN QoS information provided by the AF to PCC rules
as described in clause 5.28.4 of TS 23.501 [2]. The PCF includes the TSC
Assistance Container received from the AF with the PCC rules and forwards it
to the SMF. The PCF transparently transports the received Port Management
information Container and related port number to SMF via
Npcf_SMPolicyControl_UpdateNotify message.
8a. If the SMF decides the port is on DS-TT based on the received port number,
the SMF transports the received Port Management information Container to the
UE/DS-TT in PDU Session Modification Request message.
8b. If the SMF decides the port is on NW-TT based on the received port number,
the SMF transports the received Port Management information Container to the
UPF/NW-TT in N4 Session Modification Request message. SMF provides the
Ethernet Packet Filters as part of the N4 Packet Detection rule to the UPF/NW-
TT.
If the UPF sends a Clock Drift Report to the SMF as described in clause 5.27.2
of TS 23.501 [2], the SMF adjusts the Burst Arrival Time, Periodicity and
Survival Time (if present) from a TSN grandmaster clock to the 5G clock and
sends the updated TSCAI to NG-RAN.
# F.3 BMCA procedure
Figure F.3-1: BMCA procedure
1\. PDU Session Establishment is performed as shown in F.1-1 step 1 and 2 for
an Ethernet or IP type PDU Session to carry the UMIC or PMIC.
2\. The TSN AF or TSCTSF may subscribe to notifications for the PTP port state
changes from UPF/NW-TT.
3\. The UPF/NW-TT receives the Announce message via User -plane from DS-TT
connectivity established using PDU session, or via NW-TT port over N6.
As Announce message is a periodic message, after step 3, the UPF/NW-TT will
receive Announce messages regularly.
4\. The NW-TT runs the BMCA algorithm in order to determine the PTP port state
for the DS-TT port(s) and NW-TT port(s).
BMCA will be triggered after receiving the Announce message.
5\. If the BMCA procedure in NW-TT determines to use Announce message from the
external grandmaster PTP instance, the UPF/NW-TT regenerates the Announce
message based on the received Announce message for each Leader PTP port on the
NW-TT and DS-TT(s) port for this PTP domain. The NW-TT/UPF forwards the
regenerated Announce messages to the PDU session(s) related to the Leader PTP
ports on the DS-TT(s).
NOTE: Leader and Follower terms in this specification are aligned with NOTE 2
in clause 5.27.1.2.2.1 of TS 23.501 [2]..
6\. If the TSN AF or TSCTSF has subscribed for notifications for the PTP port
state changes, the UPF/NW-TT reports any changes to the PTP port states to the
TSN AF or TSCTSF via UMIC (for DS-TT ports) or PMIC (for NW-TT ports).
7\. Based on the notification for the PTP port state changes, the TSN AF or
TSCTSF may request appropriate QoS treatment and PDU Session modification may
then be triggered to modify the QoS Flow carrying the gPTP messages over user
plane in order to be compliant with the IEEE Std 802.1AS [75] delay
recommendation for carrying gPTP messages as in clause 5.27.1.6 of TS 23.501
[2].
# F.4 5GS interworking with TSN deployed in the transport network
For 5GS to control the IEEE TSN features deployed in the transport network,
the SMF/CUC interacts with the CNC in the transport network (TN CNC).
Figure F.4-1: 5GS Bridge information configuration
1\. The UE establishes a PDU Session as described in clause 4.3.2.2.1.
2\. During the PDU Session Establishment procedure, the SMF/CUC requests the
UPF to assign the N3 tunnel information via N4 Session Establishment or
Modification procedure. The SMF/CUC includes a TL-Container to the N4 Session
Establishment or Modification request including a get-request to the TL-
Container, as described in clause 5.28a.2 of TS 23.501 [2].
The UPF responds with a N4 Session Establishment or Modification response. If
the UPF supports CN-TL, the UPF includes a TL-Container to the response. The
TL-Container includes a get-response as described in clause 5.28a.2 of TS
23.501 [2]. The SMF/CUC stores the get-response.
3\. During the PDU Session Establishment procedure, the SMF/CUC requests the
NG-RAN to assign the N3 tunnel information by invoking the
Namf_Communication_N1N2MessageTransfer request. The SMF/CUC includes a TL-
Container to the N2 SM information in the request, the TL-Container contains a
get-request as described in clause 5.28a.2 of TS 23.501 [2].
The NG-RAN responds with a N2 SM information. If the NG-RAN supports AN-TL,
the NG-RAN includes a TL-Container to the N2 SM information. The TL-Container
includes a get-response as described in clause 5.28a.2 of TS 23.501 [2]. The
SMF/CUC stores the get-response.
4\. The AF (TSCTSF, AF, NEF or TSN AF) invokes the
Npcf_PolicyAuthorization_Create/Update request. This may be due to reception
of Ntsctsf_QoSandTSCAssistance_Create/Update request by the TSCTSF as
described in clause 4.15.6.6 or clause 4.15.6.6.a, or due to reception of 5GS
Bridge configuration by the TSN AF as described in clause F.2. The TSN AF or
TSCTSF determines the TSC Assistance Container for one or more TSC streams and
sends them to the PCF.
5-6.When PCF receives the request, the PCF initiates an SM Policy Association
Modification procedure. The PCF notifies the corresponding SMF/CUC via
Npcf_SMPolicyControl_UpdateNotify message as described in clause 4.16.5.2. The
PCF updates the PCC rule to the SMF/CUC. The PCC rule includes the 5GS QoS
profile along with TSC Assistance Container.
SMF/CUC triggers the PDU Session Modification procedure as described in clause
4.3.3.2 to establish a QoS Flow to transfer the TSC streams.
7\. During the PDU Session Modification procedure, the SMF/CUC provides the
information received in PCC rules to the UPF via N4 Session Modification
procedure. If the UPF does not support CN-TL, the SMF/CUC instructs the UPF to
assign a distinct N3 tunnel end point address for the QoS Flow.
The UPF responds with a N4 Session Modification response.
8\. During the PDU Session Modification procedure, the SMF/CUC provides the
information received in PCC rules to the NG-RAN by invoking the
Namf_Communication_N1N2MessageTransfer request. The SMF also determines the
TSCAI for the QoS Flow(s) and sends the TSCAI along with the QoS profile(s) to
the NG-RAN. If the NG-RAN does not support AN-TL, the SMF/CUC instructs the
NG-RAN to assign a distinct N3 tunnel end point address for the QoS Flow.
The NG-RAN responds with a N2 SM information.
9\. The SMF/CUC determines the merged stream requirements in the TSN UNI
towards the TN CNC as described in Annex M of TS 23.501 [2]. The TN CNC uses
the merged stream requirements as input to select respective path(s) and
calculate schedules in TN.
10\. Based on the results, the TN CNC provides a Status group that contains
the merged end station communication-configuration back to the SMF/CUC.
11\. [Optional] If the response from TN CNC includes InterfaceConfiguration,
the SMF/CUC triggers the PDU Session Modification procedure as described in
clause 4.3.3.2 to modify the QoS Flow to transfer the TSC streams.
12\. [Optional] During the PDU Session Modification procedure, if the UPF
supports CN-TL, the SMF/CUC invokes N4 Session Modification procedure and
includes a TL-Container to the N4 Session Modification request including a
set-request to the TL-Container as described in clause 5.28a.2 of TS 23.501
[2].
The UPF responds with a N4 Session Modification response. If the UPF supports
CN-TL, the UPF includes a TL-Container to the response. The TL-Container
includes a set-response as described in clause 5.28a.2 of TS 23.501 [2].
13\. [Optional] During the PDU Session Modification procedure, if the NG-RAN
supports AN-TL, the SMF/CUC invokes the Namf_Communication_N1N2MessageTransfer
request. The SMF/CUC includes a TL-Container to the N2 SM information in the
request, the TL-Container contains a set-request as described in clause
5.28a.2 of TS 23.501 [2]. The SMF/CUC may also update the TSCAI in the NG-RAN
for the BAT in DL direction as described in Annex M, clause M.1 of TS 23.501
[2], if the SMF/CUC received a TimeAwareOffset or AccumulatedLatency from TN
CNC for a downlink stream (i.e. for a Talker in the UPF/CN-TL) in step 7.
The NG-RAN responds with a N2 SM information. If the NG-RAN supports AN-TL,
the NG-RAN includes a TL-Container to the N2 SM information. The TL-Container
includes a set-response as described in clause 5.28a.2 of TS 23.501 [2].
# F.5 5GS DetNet node information reporting
The TSCTSF collects the information for Deterministic Networking from the
UPF/NW-TT and the SMF as shown in Figure F.5-1, with the addition of new
parameters as shown in Figure F.5-1.
Figure F.5-1: 5GS DetNet node information reporting
1\. PDU Session Establishment as defined clause 4.3.2.2.1-1 is used to
establish a PDU Session. When Framed Routes applies, the SMF reports to the
PCF Framed Route information.
2\. SMF reports device port related information to PCF. When prefix delegation
applies, the SMF reports to the PCF prefixes delegated to the UE by IPv6
prefix delegation. The PCF notifies TSCTSF of the Bridge/Router information.
The TSCTSF subscribes for notifications on the Bridge/Router information and
also subscribes for notifications on Reporting of extra addresses, so that the
TSCTSF is notified when the SMF has reported to the PCF the Framed Route
information or prefixes delegated to UE via IPv6 prefix delegation
corresponding to the PDU Session.
3-4. Using the 5GS user-plane Node ID received in step 2b the TSCTSF can
subscribe with the NW-TT for receiving user plane node management information
changes for the 5GS router indicated by the 5GS user-plane Node ID in case it
does not yet have such a subscription, as described in clause 5.28.3.1 of TS
23.501 [2].
After receiving a User plane node Management Information Container (UMIC)
containing the NW-TT port numbers, the TSCTSF can subscribe with the NW-TT for
receiving NW-TT port management information changes for the NW-TT port
indicated by each of the NW-TT port numbers as described in clause 5.28.3.1 of
TS 23.501 [2].
The TSCTSF can use any PDU Session to subscribe with the NW-TT for node or
port management information notifications. Similarly, the UPF can use any PDU
Session to send bridge or port management information notifications.
5\. The TSCTSF may provide collected exposure information to the DetNet
controller. The information being reported to the DetNet controller is defined
in clause 5.28.5.2 of TS 23.501 [2].
# F.6 5GS DetNet node configuration
The DetNet controller triggers the procedure to provide Deterministic
Networking specific parameters to 5GS.
Figure F.6-1: Deterministic Networking specific parameter provisioning
1\. The DetNet controller provides YANG data model configuration to the
TSCTSF. The TSCTSF uses the identifier of the incoming and outgoing interfaces
to determine the affected PDU Session(s) and flow direction, whether it is
uplink or downlink as described in more detail in clause 5.28.5 of TS 23.501
[2]. The TSCTSF also determines if the flow is UE to UE in which case two PDU
Sessions will be affected for the flow and the TSCTSF breaks up the
requirements to individual requirements for the PDU Sessions.
2\. The TSCTSF uses the traffic requirements in the YANG configuration as
described in clause 6.1.3.23b of TS 23.503 [20]. The TSCTSF also constructs
the TSCAC for each flow description.
3\. The TSCTSF provides the mapped parameters and the flow description to the
PCF(s) on a per AF Session basis.
4\. The PCF authorizes the request from TSCTSF. If the PCF determines that the
requirements can\'t be authorized, it rejects the request. Once the PCF
authorizes the request, the PCF updates the SMF with corresponding new PCC
rule(s) with PCF initiated SM Policy Association Modification procedure as
described in clause 4.16.5.2.
The SMF applies the received PCC rules. This can induce creating a new QoS
flow to the PDU session and triggers the resource allocation in the RAN.
5\. PCF provides response to the TSCTSF.
6\. The TSCTSF provides response to the DetNet controller.
###### ## Annex G (normative): Support of GERAN/UTRAN access by SMF+PGW-C
This annex applies when the SMF+PGW-C is enhanced to support GERAN/UTRAN
access via Gn/Gp interface as specified in Annex L of TS 23.501 [2].
NOTE 1: For the interface with the serving node of the UE, the SMF+PGW-C is
assumed to behave as the Control Plane of the PGW described in Annex D of TS
23.401 [13].
SMF+PGW-C is selected by the SGSN using existing mechanism as specified in
Annex A of TS 23.060 [79].
NOTE 2 If network deployment requires both SMF+PGW-C and legacy PGW, selection
of SMF+PGW-C by SGSN can be achieved based on e.g. APN and optionally APN-OI
Replacement as specified Annex A of TS 23.060 [79].
When a SMF+PGW-C is used for GERAN/UTRAN access, at PDP context activation,
the SMF+PGW-C allocates a PDU Session ID (in the network range) and uses this
PDU Session ID over SBI interface (e.g. N7).
The following procedures from TS 23.060 [79] are not supported when SMF+PGW-C
is used for GERAN/UTRAN access:
\- Network requested PDP Context Activation Procedure (clause 9.2.2.2 of TS
23.060 [79]).
\- Secondary PDP Context Activation Procedure (clause 9.2.2.1.1 of TS 23.060
[79]).
\- Network Requested Secondary PDP Context Activation Procedure using Gn
(clause 9.2.2.1.3 of TS 23.060 [79]).
When SMF+PGW-C is used for GERAN/UTRAN access and interacts with PCF, the
SMF+PGW-C uses SM policy association procedures as specified in clause
4.11.0a.2 with the following modification:
\- The SMF+PGW-C performs mapping of QoS parameters as follows:
\- The SMF+PGW-C maps the Release 99 QoS parameters received from Gn/Gp
interface to EPS QoS parameters as specified in Annex E of TS 23.401 [13],
which is then used to derive QoS parameters over N7 interface as specified in
clause 4.11.0a.2.
\- the SMF+PGW-C uses QoS parameters over N7 interface to derive EPS QoS
parameters as specified in clause 4.11.0a.2, which is then mapped to Release
99 QoS parameters for Gn/Gp interface as specified in Annex E of TS 23.401
[13].
\- For SM Policy Association Establishment Procedure, the SMF+PGW-C invokes
Npcf_SMPolicyControl_Create Service operation taking input from the
information elements received in Create PDP Context Request message (specified
in TS 23.060 [79]), including mapping of QoS parameters as mentioned above as
well as GERAN/UTRAN location management related information.
\- For SM Policy Association Modification procedure initiated by the
SMF+PGW-C, the SMF+PGW-C invokes Npcf_SMPolicyControl_Update Service operation
taking input from the information elements received in Update PDP Context
Request message (specified in TS 23.060 [79]), including mapping of QoS
parameters as mentioned above, as well as GERAN/UTRAN location management
related information.
\- For SM Policy Association Modification procedure initiated by the PCF, the
SMF+PGW-C may receive PCC Rules and PDU Session Policy Information. The
SMF+PGW-C performs mapping of QoS parameters as mentioned above.
\- For SM Policy Association Termination procedure, the SMF+PGW-C invokes
Npcf_SMPolicyControl_Delete service operation (including GERAN/UTRAN location
management related information) when receiving Delete PDP Context Request
message (specified in TS 23.060 [79]).
\- Even though N7 supports Ethernet PDU Session Type, as Ethernet PDN Type is
not supported in GERAN/UTRAN, it is assumed that if the UE moves from E-UTRAN
to GERAN/UTRAN, Ethernet PDN connections are released and thus no information
related with Ethernet PDU Session Type shall be exchanged over N7 when a UE is
served by GERAN/UTRAN.
\- Even though GERAN/UTRAN specifications foresee other alternatives, the
Bearer Binding is performed by the SMF+PGW-C acting as a PGW.
\- Access Network Information reporting with a granularity of GERAN/UTRAN cell
is supported over N7 and N5.
When the UE moves between E-UTRAN and GERAN/UTRAN, the SMF+PGW-C may invoke SM
Policy Association Modification procedure based on the Policy Control Request
Triggers as specified in TS 23.503 [20].
NOTE 3: Support for IP address preservation upon indirect mobility between 5GS
and GERAN/UTRAN for PDN sessions established in EPC is described in clause
5.17.2.4 of TS 23.501 [2]. IP address preservation is not supported for direct
mobility between 5GS and GERAN/UTRAN, nor for indirect mobility cases when the
PDN session is established in 5GS or in GERAN/UTRAN.
NOTE 4: Usage of SMF+PGW-C to serve a PDP context requires no change to
SGSN(s) (and thus to roaming partners in Home Routed roaming) as it is assumed
that DNS records are properly configured to map APN to SMF+PGW-C acting as
PGW.
###### ## Annex H (normative): Support of EAP-based secondary authentication
and authorization by DN-AAA over EPC
# H.1 Introduction
Secondary authentication/authorization by a DN-AAA Server during the
establishment of a PDN connection over 3GPP access to EPC, is supported based
on following principles:
\- A SMF+PGW-C shall be used to serve DNN(s) requiring secondary
authentication/authorization by a DN-AAA Server.
\- For secondary authentication/authorization by a DN-AAA Server, the
SMF+PGW-C runs the same procedures with PCF, UDM and DN-AAA and uses the same
corresponding interfaces, as defined in clause 4.3.2, regardless of whether
the UE is served by EPC or 5GC.
\- If the UE has included the PDU Session ID in PCO, the UE may indicate in
the PCO within the PDN connection establishment request its support for EAP-
based secondary authentication and authorization by DN-AAA over EPC. The UE
may also include the DN-specific identity in the PCO. The SMF+PGW-C may reject
the PDN connection establishment if the UE does not support EAP-based
secondary authentication and authorization by DN-AAA over EPC while local
policies tell that secondary authentication and authorization by DN-AAA is
mandatory to access to the DN. When a PDU Session is established, the UE may
also indicate via 5GSM capability parameter that it supports secondary DN
authentication and authorization over EPC.
\- The interface towards the UE is different (usage of EPC NAS instead of 5GC
NAS) between the EPC and 5GC cases.
\- The MME and SGW are not impacted by the procedure. Specific exchanges
between the UE and the SMF+PGW-C for secondary authentication/authorization by
a DN-AAA Server are carried via PCO. This includes the support of EAP
exchanges between the UE and the DN-AAA Server.
\- As it is only possible to exchange PCO once between the UE and the PGW
during PDN connection establishment, the PDN connection is established before
EAP-based secondary authentication/authorization by a DN-AAA Server takes
place.
\- When secondary authentication/authorization by a DN-AAA Server has
successfully taken place, the SMF+PGW-C allows traffic exchange at the UPF and
indicates to the UE that User plane traffic is now possible.
# H.2 Procedures
## H.2.1 Secondary authentication and authorization by DN-AAA at PDN
Connection Establishment
In the figure H.2.1-1, the execution of the secondary authentication and
authorization by DN-AAA is specified. The procedure assumes that:
\- The APN is associated with the selection of a SMF+PGW-C to serve APN(s)
that require secondary authentication and authorization by DN-AAA at PDN
connection establishment.
\- The SMF+PGW-C is configured with local policies indicating that the APN
requires secondary authentication and authorization by DN-AAA at PDN
connection establishment.
Figure H.2.1-1: EAP-based secondary authentication and authorization by DN-AAA
at PDN connection establishment
0\. As steps 1 - 13 of Figure 5.3.2.1-1 in TS 23.401 [13] (Attach Request) or
as steps 1 to 3 of Figure 5.10.2 in TS 23.401 [13] (UE requested PDN
connectivity) with following modifications: The UE may indicate in PCO its
capability to support EAP-based secondary DN authentication over EPC if the UE
included the PDU Session Id in PCO. The UE may also include the DN-specific
identity.
1\. The SMF+PGW-C gets subscription data from UDM as defined in step 4 of
Figure 4.3.2.2.1-1 (not shown in Figure H.2.1-1). The procedure assumes that
SMF configuration or subscription data from UDM require EAP-based secondary
authentication and authorization by DN-AAA.
Secondary DN authorization may be invoked as described in TS 29.561 [63].
During this step the DN-AAA may provide an IP address for the UE and other DN
authorization data as described in clause 5.6.6 of TS 23.501 [2].
2a. If dynamic PCC is to be used for the PDU Session, the SMF+PGW-C performs
an SM Policy Association Establishment procedure as defined in clause 4.16.4
and if Secondary DN authorization has been invoked in step 1, provides to the
PCF the PDN Connection parameters received from the DN AAA at step 1 as
described in step 5 of Figure 4.3.2.3-1. In this step the SMF+PGW-C may
retrieve the PDU Session related policy information and the PCC rule(s) from
the PCF, e.g. the authorized Session AMBR.
2b. UPF selection and N4 session establishment is executed with the difference
that the SMF+PGW-C configures the UPF+PGW-U to block any UE traffic over the
PDN Connection (until the Secondary DN authentication and authorization has
been done and is successful).
3\. Steps 15-24 in Figure 5.3.2.1-1 of TS 23.401 [13] or steps 5-16 in Figure
5.10.2 of TS 23.401 [13].
During the Attach procedure, at step 15 in Figure 5.3.2.1-1 of TS 23.401 [13]
or during UE requested PDN connectivity in step 5 in Figure 5.10.2 of TS
23.401 [13], the SMF+PGW-C includes in PCO, an Indication to the UE that
\"UpLink Data is NOT ALLOWED\" on the PDN connection. The UE shall not send
Uplink data to the network, until it receives an indication further from the
network that \"UpLink Data is ALLOWED\".
NOTE: How the Indication that Uplink data allowed/not allowed is carried in
PCO is defined in TS 24.501 [25].
4\. [Conditional] The PGW-C+SMF initiates EAP-based authentication by sending
EAP-Request as described in step 2 of Figure 4.3.2.3-1.
5\. Multiple round-trip messages as required by the authentication method used
by DN-AAA may follow. The PCO including the authentication message from the
DN-AAA is transferred to the UE by the SMF+PGW-C in Update Bearer Request and
then over S1 by Downlink NAS Transport (steps 4b-4d). The response from the UE
is transferred to the SMF+PGW-C in an Uplink NAS Transport over S1 and Update
Bearer Response (steps 4e-4g) over EPS.
6\. Secondary authentication and authorization by DN-AAA procedure continues
as described in step 4 of Figure 4.3.2.3-1.
7\. The SMF+PGW-C updates the N4 rules in the UPF+PGW-U to allow traffic over
the PDN Connection. If dynamic PCC is to be used for the PDU Session and the
SMF+PGW-C received DN Authorization information from the DN-AAA as part of
step 5 or 6 that is different compared to the value received in step 2, the
SMF+PGW-C contacts the PCF to update the PDN Connection as described in step 5
of Figure 4.3.2.3-1
8\. The SMF+PGW-C updates the UE by invoking the PDN GW initiated bearer
modification without QoS update procedure (figure 5.4.3-1 of TS 23.401 [13])
initiated by sending an Update Bearer Request message to the SGW. The PCO
includes an indication that \"UpLink Data is ALLOWED\". The UE confirms the
update (see clause 5.4.3 of TS 23.401 [13]).
If the UE IP address is to be delivered to the UE over user plane (via Router
advertisement or DHCP) then the UE IP address is only delivered to the UE
after step 8.
9\. As in step 6 of Figure 4.3.2.3-1.
The DN-AAA Server may revoke the authorization for a PDN connection or update
DN authorization data for a PDN connection. According to the request from DN-
AAA Server, the SMF+PGW-C may release or update the PDN connection.
At any time after the PDN connection establishment, the DN-AAA Server or
SMF+PGW-C may initiate Secondary Re-authentication procedure for the PDN
connection as described in clause 4.3.2.3. Steps 4a-4h are performed to
transfer the Secondary Re-authentication message between the DN-AAA Server and
the UE. The Secondary Re-authentication procedure may start from step 4a (DN-
AAA initiated Secondary Re-authentication procedure) or step 4b (SMF+PGW-C
initiated Secondary Re-authentication procedure).
During Secondary Re-authentication, if the SMF+PGW-C receives an indication
from the MME that the UE is unreachable then it informs the DN-AAA Server that
UE is not reachable for re-authentication. Based on this indication from
SMF+PGW-C, the DN-AAA Server may decide to keep the PDN connection or request
to release it.
DN-AAA may initiate DN-AAA Re-authorization without performing re-
authentication based on local policy. DN-AAA Re-authorization procedure may
involve steps 5 and 6 of Figure H.2.1-1 above.
During Secondary Re-authentication/Re-authorization, if the SMF+PGW-C receives
DN Authorization Profile Index and/or DN authorized Session AMBR, the
SMF+PGW-C reports the received value(s) to the PCF (as described in TS 23.501
[2]) by triggering the Policy Control Request Trigger as described in TS
23.503 [20].
###### ## Annex I (informative): Member UE selection without the NEF
assistance at the AF
This informative Annex describes an example of the procedure that AF selects
the FL members by collecting network exposure information in case that no NEF
is present in the 5GS. In this example, QoS Monitoring is used for FL Member
UE selection.
Network exposure information as described in clause 4.15 of TS 23.502 [4],
e.g. UE location reporting from the AMF, user plane information from the UPF
and data analytics from NWDAF may be collected and used to assist the AF in
application layer Member UE selection e.g. assist in the selection of Member
UEs participating in a federating learning operation.
Figure I-1: Example of Procedure for Member UE selection without the NEF
assistance
1\. [Optional] The AF requests the location reporting of the UEs from the AMF
by invoking existing Namf_EventExposure_Subscribe (Location Reporting).
2\. [Optional] The AF initiates direct notification of QoS Monitoring
procedure for delay information for the UEs in the candidate list, as defined
in steps 1a-5 of clause 6.4.2.1 of TS 23.548 [74].
3\. [Optional] The AF requests user plane information, e.g. Throughput UL/DL,
Packet transmission, Packet retransmission, for the UEs in the candidate list
from UPF.
4\. [Optional] The AF requests analytics from NWDAF by invoking the
Nnwdaf_AnalyticsSubscription_Subscribe service operation, such as UE
Communication, User Data Congestion Analytics, WLAN performance analytics per
UE, etc. as defined in TS 23.288 [50].
NOTE 1: In Steps 1-4, the AF maintains the candidate list itself and collects
the Member UE selection information directly from the 5GC and includes the
Target UE Identifier(s) for the UEs in the candidate list in the request.
5\. The AF selects members, e.g. for application layer Member UE selection for
FL, based on the information collected in steps 1-4.
NOTE 2: What information needs to be collected by the AF to perform Member UE
selection is decided by the AF itself.
NOTE 3: AF may keep monitoring the information from AMF/UPF/SMF/NWDAF to
update the members.
###### ## Annex J (informative): Support for Personal IoT Networks
# J.1 Procedure for PIN service
Figure J.1-1: Procedure for PIN service
PIN is a subscribed service, and a user needs to coordinate with the Mobile
Network Operator to subscribe for PIN service. When a user subscribes for a
PIN, the subscription data includes the DNN and S NSSAI allocated by the MNO
for the PIN service. The PIN user\'s PEGC UE(s) are then provisioned with
appropriate URSP rules to enable the PEGC UE to route the PIN traffic using
the DNN and S NSSAI allocated for the PIN. Figure J.1-1 provides a high level
procedure for PIN service.
Step 1: Step 1 is performed using O&M.
A user subscribes to the Mobile Network Operator (MNO) for PIN service. The
user provides the list of PEGC UE(s) that are part of the PIN. The MNO
verifies the request, performs necessary checks e.g. whether the UEs are
allowed to act as PEGC, whether all the requested PEGC UEs are part of the
same UDM group etc. If the request is authorized by the MNO, the MNO:
\- allocates a dedicated DNN, S NSSAI for the PIN;
\- if the PIN has a single PEGC UE, then updates the PEGC UE subscription with
the DNN, S NSSAI allocated for the PIN;
\- if the PIN has more than one PEGC UE, then creates a group subscription
following the 5G VN group management principles as specified in clause 5.29.2
of TS 23.501 [2]. The information on the External Group ID and associated DNN
and S-NSSAI is provided to the AF for PIN;
\- if local switching is required, configures in the SMF set and/or in the NRF
that the DNN allocated for the PIN is served by a specific SMF set.
NOTE: It is assumed that all PEGC UEs that are members of a PIN are part of
the same UDM Group ID. If the PEGC UEs requested by the user for PIN creation
are not part of the same UDM Group ID, the MNO migrates all the PEGC UEs into
a single UDM Group ID for creating the group subscription.
Step 2: For routing PIN traffic by the PEGC UE, the AF provides guidance for
URSP generation to the 5GC. The AF uses a UE ID (i.e. GPSI) as the target UE
if the PIN contains a single PEGC UE. If the PIN contains more than one PEGC
UE, then the AF uses External Group ID as the target UEs for providing URSP
guidance to the 5GC. The AF request contains DNN, S NSSAI allocated to the
user for the PIN service and the traffic descriptor components in the URSP
rule request from the AF contains the PIN ID.
The NEF authorizes the request received from the AF and stores the information
in the UDR as \"Application Data\".
The NEF can use the procedure for authorization of service specific parameter
provisioning as specified in clause 4.15.6.7a to authorize the AF request by
the UDM. In this case:
\- if the request is for an individual UE, the UDM checks if the DNN and S
NSSAI in the AF request is allowed for the UE;
\- if the request is for a group of UEs, the UDM checks whether the group
related data (e.g. DNN/S NSSAI group related data, see table 4.15.6.3b-1) is
authorized for the group.
If the AF request is authorized, the NEF stores the AF requested information
in the UDR as the \"Application Data\" (Data Subset setting to \"Service
specific information\").
Step 3: The PCF receives a Nudr_DM_Notify notification of data change from the
UDR, generates the URSP rules and initiates UE Policy delivery as specified in
clause 4.2.4.3 to provision the URSP rules in the PEGC UE(s). For routing of
PIN traffic by the PEGC UE(s), the URSP policies provided to the PEGC UE(s)
contain URSP rule with PIN ID as traffic descriptor.
Step 4: The AF provides QoS requirements for the PIN traffic following
procedures for AF requested QoS for a UE or group of UEs not identified by a
UE address as specified in clause 4.15.6.14.
Step 5: When the PEGC UE(s) detect PIN traffic, it uses the provisioned URSP
rules to identify PDU session to route the traffic as specified in clause
6.6.2.3 of TS 23.503 [20]. The 5GC further performs session management and
user plane management as described in Annex P, clause P.2 of TS 23.501 [2].
When 5G VN Group is not used for a PIN and if the PIN contains more than one
PEGCs, then the AF request for URSP guidance and QoS requirements is targeted
to each individual PEGC UEs that are part of the PIN.
#
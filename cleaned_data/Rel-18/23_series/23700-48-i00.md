# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document describes key issues and solutions for the phase 2 of the
system enhancements for Edge Computing in 5GS.
Edge Computing is supported in 5GS since Rel-15. During Rel-17 FS_enh_EC study
described in TR 23.748 [4] , further enhancements for supporting Edge
Computing have been studied, including discovery and re-discovery of EAS, edge
relocation etc. 4 key issues from FS_enh_EC study have been concluded and
progressed in TS 23.548 [3]. Some other issues were raised during the Rel-17
study but not studied due to the time limitation in Rel-17.
This technical report will document the study of potential system enhancements
for enhanced edge computing support, including:
\- improvements to roaming, to support access to EHE in a VPLMN (WT#1);
\- defining use cases that may benefit from exposure of additional data via
the Local UPF/NEF including describing (on a high level) the characteristics
of the data and data delivery to fulfil the use cases; investigating the
solutions and their feasibility and suitability for improved network exposure
of UE traffic related information to common Edge Application Server via Local
UPF/NEF, such as network congestion status (WT#3);
NOTE 1: XR/media and AI/ML services specific QoS information exposure are to
be studied in corresponding study items with considering the same exposure
framework as defined by this study.
NOTE 2: This objective will look at the use cases and the data to be exposed
but not at the actual UPF exposure mechanism or UPF-originated data, if/when
already covered by FS_UPEAS.
\- investigating the potential need and solutions for supporting offload
policies to match more granular sets of UE(s) without exposing operator-
internal configurations to 3rd party AFs (WT#5);
\- investigating the potential need and solutions to influence of PSA-UPF and
EAS (re)location for collection of UEs, e.g. in scenarios when UE(s) should
use the same EAS and are not members of a pre-defined group (WT#6);
\- investigating potential impacts related to the GSMA Operator Platform Group
work, and potential improvements related with 5GC and EHE being operated by
different organizations (WT#7);
\- investigating the potential need and solutions to avoid the UE to switch
the EC traffic away from the EC PDU Session and 5GS altogether, due to
conflicting connectivity preferences in the device (e.g. via means outside of
3GPP connectivity, e.g. non-integrated Wifi) (WT#8);
\- investigating the potential solutions for the AF to be able to
obtain/determine the DNAI that is associated to a certain selected EAS, for
subsequent use with already defined services provided to the AF (WT#9).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System architecture for the 5G System (5GS)\".
[3] 3GPP TS 23.548: \"5G System Enhancements for Edge Computing; Stage 2\".
[4] 3GPP TR 23.748: \"Study on enhancement of support for Edge Computing in 5G
Core network (5GC)\".
[5] GSMA OPG.02: \"Operator Platform Telco Edge Requirements\",
https://www.gsma.com/futurenetworks/wp-content/uploads/2021/07/GSMA-OPG-Telco-
Edge-Requirements-2021.pdf.
[6] SP-210583: \"Reply LS to GSMA Operator Platform Group on edge computing
definition and integration\", SA#92e.
[7] IETF RFC 5681: \"TCP Congestion Control\".
[8] 3GPP TS 26.247: \"Transparent end-to-end Packet-switched Streaming Service
(PSS); Progressive Download and Dynamic Adaptive Streaming over HTTP (3GP-
DASH)\".
[9] 3GPP TS 23.502: \"Procedures for the 5G System (5GS)\".
[10] 3GPP TR 23.700-85: \"Study on enhancement of 5G User Equipment (UE)
policy\".
[11] 3GPP TS 24.526: \"User Equipment (UE) policies for 5G System (5GS); Stage
3\".
[12] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station (MS) in idle mode\".
[13] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS)\".
[14] 3GPP TS 38.415: \"NG-RAN; PDU session user plane protocol\".
[15] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[16] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[17] 3GPP TS 29.519: \"Usage of the Unified Data Repository Service for Policy
Data, Application Data and Structured Data for Exposure\".
[18] 3GPP TS 29.503: \"Unified Data Management Services\".
[19] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
support network data analytics services\".
[20] S2-2203633: \"LS on UPF selection based on DNAI\", SA2#151e.
[21] 3GPP TR 23.700-60: \"Study on XR (Extended Reality) and media services\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1], TS
23.501 [2], TS 23.548 [3] and the following apply. A term defined in the
present document takes precedence over the definition of the same term, if
any, in TR 21.905 [1].
## 3.2 Void
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1], TS 23.501 [2], TS 23.548 [3] and the following apply. An abbreviation
defined in the present document takes precedence over the definition of the
same abbreviation, if any, in TR 21.905 [1].
EACI ECS Address Configuration Information
EDI Edge Deployment Information
# 4 Architectural assumptions and principles
## 4.1 Architectural Assumptions
Existing solutions defined in Rel-15, Rel-16 and Rel-17 will be considered as
baseline in this study.
The architecture for support of Edge Computing in 5GC shall be based on the
following architecture assumptions:
\- the architecture for Edge computing specified in Release 17 is used as
basis for further potential enhancement;
\- the Edge Hosting Environment (EHE) can be under the control of the serving
network operator or a 3rd party;
\- interconnectivity between EHEs of different operators cannot be assumed to
be available for all deployments.
## 4.2 Architectural Requirements
\- The solutions should minimize the impact on the application layer.
# 5 Key issues
## 5.1 KI#1: Accessing EHE in a VPLMN when roaming
### 5.1.1 Description
The purpose of this key issue is to define 5GS improvements to support the UE
access to an EHE in a VPLMN.
Two scenarios (i.e. UE accessing EHE in VPLMN via an LBO PDU Session and UE
accessing EHE in VPLMN via a PDU Session established as HR) are described in
clause 5.1.2.
For the scenario using LBO PDU Session, potential solutions should address the
following:
\- how to establish the LBO PDU Session towards the correct S-NSSAI/DNN pair
in order to access an EHE in the VPLMN;
\- how to support Rel-17 edge computing related procedures, such as EAS
(re-)discovery, as specified in clause 6 of TS 23.548 [3].
For the scenario using a PDU Session with a PSA in the HPLMN, potential
solutions should address the following:
\- how to authorize the PDU Session to support local traffic routing to access
an EHE in the VPLMN;
\- whether and how to support charging for the local traffic of a PDU Session
that supports local traffic routing to access an EHE in the VPLMN;
\- how to support Rel-17 edge computing related procedures, such as EAS
(re-)discovery, as specified in clause 6 of TS 23.548 [3];
\- how to ensure proper policy control and QoS enforcement;
\- potential impact on Policy and QoS control;
\- how to configure the VPLMN ECS address to UE in roaming scenarios;
\- how to support the edge relocation in roaming scenarios.
NOTE 1: Interaction with SA5 is expected regarding charging aspects where
needed.
NOTE 2: Latency needs to be considered and addressed for all scenarios.
NOTE 3: In Rel-17, the ECS address is provided by UDM, which requires further
consideration in scenarios with ECS in a VPLMN. This may need some
coordination with SA WG6.
### 5.1.2 Scenarios
For a roaming UE, accessing to EHE in VPLMN might be needed to fulfil use
cases requiring edge computing. Two main scenarios should be considered:
1) UE accessing V-EHE via a Local Breakout (LBO) PDU Session:
The scenario supports all connectivity models and assumes that an LBO PDU
Session is used to access an EHE in VPLMN for EC applications.
With a LBO PDU Session, the UE can access an EHE in VPLMN.
NOTE 1: Two different PDU Sessions are required to access an EHE in VPLMN and
Home DN in HPLMN simultaneously.
2) UE accessing V-EHE via a Home Routed (HR) PDU Session (i.e. with PSA in
HPLMN):
This scenario assumes the session breakout for the HR PDU Session is used to
access EHE in VPLMN for EC application.
With a single PDU Session, UE can access an EHE in VPLMN and also the DN in
HPLMN.
NOTE 2: With a single PDU Session and (DNN+S-NSSAI), it can support both EC
and non-EC applications in either roaming or non-roaming case.
To support such PDU Session, it needs to be studied how the UE can access the
V-EHE via a HR PDU Session. Two sub-scenarios may be considered:
2.1) HPLMN has the knowledge of EAS deployment information in VPLMN for
specific services. The HPLMN triggers EAS discovery and local traffic routing
in VPLMN.
2.2) HPLMN does not have the knowledge of EAS deployment information in VPLMN.
The VPLMN triggers EAS discovery and local traffic routing in VPLMN.
### 5.1.3 Assumptions
The solutions do not have to restrict any deployment option or solution
options allowed in the previous releases for both for VPLMN and HPLMN. In
other words, all deployment options or solution options that are allowed in
the previous releases can be assumed. Also, VPLMN and HPLMN may have different
deployment options, for example, various EAS (re-)discovery options specified
in clause 6 of TS 23.548 [3] or whether to deploy the dynamic PCC.
## 5.2 KI#2: Fast and efficient network exposure improvements
### 5.2.1 Description
This key issue addresses improvements to fast and efficient network exposure
of UE traffic related information to Edge Application Server via Local UPF/NEF
to support additional information, such as network congestion status.
This key issue defines use cases that may benefit from exposure of additional
data via the Local UPF/NEF including describing (on a high level) the
characteristics of the data and data delivery to fulfil the use cases.
Based on the use cases, this key issue investigates solutions and their
feasibility and suitability for improved network exposure of UE traffic
related information to common Edge Application Server via Local UPF/NEF, such
as network congestion status. In this case, the following issues should be
studied:
\- which information and at which level (e.g. per QoS Flow, per cell) needs to
be provided to AF via local UPF/NEF?
\- how the above information is obtained?
NOTE 1: XR/media and AI/ML services specific QoS information exposure are to
be studied in corresponding study items with considering the same exposure
framework as defined by this study.
NOTE 2: This key issue will look at the use cases and the data to be exposed
but not at the actual UPF exposure mechanism or UPF-originated data, if/when
already covered by the FS_ UPEAS. UPF exposure mechanism to be discussed in
FS_UPEAS is possibly reused.
NOTE 3: The aim is to, whenever possible, re-use information already defined
in existing 3GPP specifications.
### 5.2.2 Use cases and scenarios
Observation of the link characteristics is widely used to adjust the
transmission behaviour in different scenarios. For example:
\- For some transport layer protocols, e.g. TCP, QUIC, congestion control
algorithms can be used to control packets transmission via 5GS based on e.g.
observing packet loss and take it as indication of network congestion. For
example, TCP congestion control algorithm defined in RFC 5681 [7] uses
different ways to adjust congestion window, perform slow start, congestion
avoidance, fast retransmit, and fast recovery, which leads to classic
\"sawtooth\" congestion window.
\- Media based services can benefit by low and consistent latency. This can be
achieved by rate adaptation by the endpoints.
For Edge computing scenarios, most applications, e.g. autonomous automotive
vehicles, real-time mobile gaming, cloud gaming, robotic applications,
interactive video, are sensitive to the change of network latency and
throughput. When network congestion happens, if the application can be
notified in a fast and efficient way (e.g. within a RTT of user packet
transmission), these services can react to the change of network congestion
status more agilely.
NOTE: The solution in the following clause 6 will use the use case(s) in this
clause as guidance to judge the feasibility and suitability.
## 5.3 KI#3: Policies for finer granular sets of UEs
### 5.3.1 Description
This key issue investigates the potential need and solutions for supporting
offload policies for more granular sets of UE(s).
This key issue will study the following aspects:
\- how to identify set of UEs at a finer granularity that are associated with
a dedicated offload policy, and how to express the set of UE in the offload
policy;
\- impacts to 5GS needed to support providing traffic offload policy for such
a set of UEs.
### 5.3.2 Scenarios
Considering limited or expensive EC resources, the application service
provider or the operator may consider to provide EC services for certain users
only under certain conditions, e.g. within a specific geographical area, or at
specific time, etc. The AFs can provide the request to support some offload
policies only for certain set of UE(s) following a set of specific criteria.
There are cases that traffic offload policy aims at a finer sets of UE(s), for
instance, UEs satisfying a combination of criteria:
Case a: UEs within a specific geographical area and have been associated with
specific service provided by operator or application service provider;
Case b: UEs that have been associated with a combination of services provided
by operator or application service provider;
Case c: UEs within a specific geographical area and have been associated with
a combination of services provided by operator or application service
provider;
Case d: at specific time, UEs that have been associated with specific service
or a combination of services provided by operator or application service
provider;
Case e: UEs belongs to both group-A and group-B, or UEs belongs to group-A and
associated with specific service. It is possible that these users belong to
pre-defined groups or do not belong to any pre-defined groups.
### 5.3.3 Assumptions
Operator-internal configurations shall not be exposed to 3rd party AFs.
The application can be deployed in both central location(s) and edge cloud(s).
The application service provider is expected to be able to interact with the
operator regarding setting the offload policies.
Solutions for this KI will identify their support for the following:
\- AF under operator control;
\- AF under 3rd party control.
## 5.4 KI#4: Influencing UPF and EAS (re)location for collections of UEs
### 5.4.1 Description
Investigate the potential need and solutions to influence of PSA-UPF and EAS
(re)location for collection of UEs, e.g. in scenarios when UE(s) should use
the same EAS and are not members of a pre-defined group.
In particular, the key issue will study the following aspects:
\- whether and how to define a collection of UEs forming a dynamic ad-hoc
group that should use the same EAS and/or same local part of DN and/or same
DNAI and how the collection is identified;
\- whether and how to influence UPF and EAS (re)location for a collection of
UEs that should use the same EAS and/or same local part of DN and/or same
DNAI;
\- how to decide on a common local part of DN for the collection of UEs;
\- for a given collection of UEs defined in the above, whether and how to
determine if any UE in this collection have no access to EAS or local part of
DN, and whether and how to define any specific treatments for such UE if any;
\- how to handle coordination of the UPF(s) and EAS (re)location for
collections of UEs;
\- whether and how existing mechanisms suffice;
\- whether and what improvements are required for EAS discovery and re-
discovery for UEs belonging to a collection of UEs.
### 5.4.2 Scenarios
There are use cases that UEs belonging to a non-predefined dynamic group
should be treated the same way, and members of the dynamic group is likely to
change dynamically, e.g. UE could join/leave the group randomly. For example:
\- Multi-user low latency Gaming: In such use cases, the Application client
running on the UE are served by a particular application server which is the
corresponding game hosting server i.e. Edge Application Server (EAS). This EAS
provides gaming services and maintains individual UEs gaming profile, user
level registration details, etc. These members could change dynamically over
period of time. Also, due to maintenance purposes or due to overload situation
EAS would require to be relocated to another one, thus moving all registered
users to the new EAS.
\- Platooning: In case of platooning use case, all the member UEs involved
have similar attributes and requirements, for example, all UEs in a particular
platoon have similar mobility characteristics i.e. moving in the same
direction and with similar speed, located in proximity to each other, and so
on.
\- XR application which consists of a group of application components on
multiple UEs: In the use case, the XR application consists of multiple
application components running on different UEs for different purposes e.g.
recognizing, modelling, rendering of a group of objects. The application
components processing for the group of UEs should be run on a single EAS
instance.
### 5.4.3 Assumptions
For the dynamic group management, coordination between FS_EDGE_Ph2 and FS_GMEC
might be needed.
## 5.5 KI#5: GSMA OPG impacts and improvements for EHE operated by separate
party
### 5.5.1 Description
As indicated in the LS out to GSMA Operator Platform Group (OPG) in SP-210583
[6], the ongoing GSMA OPG work may have impacts on 5G architecture.
GSMA OPG introduced the concept of Federation of Operator Platforms introduced
in GSMA OPG.02 [5], to allow Application Providers to reach a wider
geographical area and user base. The following aspects shall be studied:
\- investigate potential impacts related to the GSMA Operator Platform Group
work, and potential improvements related with 5GC network and EHE being
operated by different organizations;
\- investigate potential impacts related to the GSMA Operator Platform Group
work on EAS discovery;
\- how the 5GS facilitates edge relocation between an EAS deployed by a source
EHE provider to another EHE deployed by a target EHE provider, even in
scenarios when EHEs are operated by different service providers.
### 5.5.2 Scenarios
Clause 3.3.5 of the GSMA OPG.02 [5] requirement document introduces the Edge
Node Sharing scenario in which EAS A (hosted by one partner, e.g. 3rd party or
another Operator) is to be accessed by the other partners, e.g. Operator B\'s
network (see figure 2 in clause 3.3.5 of GSMA OPG.02 [5]). The same modelling
and solutions of a 3rd party provider hosting the EHE are considered. Under
such circumstances, mechanisms should be available to allow a PLMN to use EHE
resources shared by another MNO appropriately, i.e. allow a UE in PLMN B to
access efficiently the EAS in PLMN A located in close proximity and to route
the UE traffic to the identified EAS.
The following terms defined in the GSMA OPG.02 [5] requirement document are
used:
E/WBI East/Westbound Interface
OP Operator Platform
SBI-CR Southbound Interface -- Cloud Resources
SBI-NR Southbound Interface -- Network Resources
UNI User to Network Interface
### 5.5.3 Assumptions
Edge Node Sharing is a deployment option based on agreements between two or
more parties (the operator providing the connectivity and one or more 3rd
parties or other operators providing the Edge Cloud Compute Resources.
To support the Edge Node Sharing scenario in which EAS\'s are hosted by one or
more partners (3rd party or another Operator), the East/Westbound interface
(defined by GSMA OPG) can be used to provide the serving operator with
application instance access information. This approach allows the serving
Operator to performing service discovery and delivery as when the application
was delivered from an EHE in the serving Operator\'s own network.
The Edge Node sharing allows the Home and Visited PLMN to incorporate EASs
that are hosted on Edge Node sharing partners Edge compute resources without
impact on the roaming solutions.
## 5.6 KI#6: Avoiding UE to switch away from EC PDU Session
### 5.6.1 Description
This key issue investigates the potential need and solutions to avoid the UE
to switch the EC traffic away from the EC PDU Session and 5GS altogether, due
to conflicting connectivity preferences in the device (e.g. via means outside
of 3GPP connectivity, e.g. non-integrated Wi-Fi).
In particular, this key issue will address:
\- how to determine what traffic is using the 5G System to access edge
computing resources, and specifically in what granularity the traffic can be
identified (e.g. Flow and/or PDU Session);
\- what actions might be taken when some application traffic is currently
using the 5G System to access edge computing resources and connectivity
outside of 5GS becomes available.
### 5.6.2 Scenarios
5GS may provide a number of enablers for Edge Computing, those for 3GPP Rel-17
being specified in TS 23.548 [3]. For example:
\- EAS (Re-)discovery for Distributed Anchor and Multiple PDU Sessions
Connectivity Model;
\- EAS (Re-)discovery over Session Breakout Connectivity Model;
\- Edge Relocation Involving AF Change.
In some scenarios, these Edge Computing enablers cannot be used if the UE
switches to an access for all UP traffic that is not integrated with 5GS or
does not provide the expected characteristics. Problematic cases include:
\- non-integrated access, where re-connecting to the 5GS is not possible, e.g.
because lack of UE support or an N3IWF could not be discovered or connected to
and these Edge Computing enablers can only be reached via the 5GS;
\- re-connecting to the 5GS is possible but results in long UP paths because
of e.g. a centralized N3IWF;
\- session breakout scenarios where an UL-CL and L-PSA is used to obtain EC
connectivity and switching to an access that is not integrated with 5GS would
therefore break the EC connectivity.
A UE may use a PDU Session to access Edge Computing Services. When non-
integrated connectivity becomes available for the UE, the UE\'s connectivity
preferences may dictate that the UE use the non-integrated connectivity for
traffic that is currently accessing Edge Computing Services via the 5G System.
### 5.6.3 Assumptions
This key issue should consider all of the connectivity models that are
described in clause 4.3 of TS 23.548 [3] (i.e. Distributed Anchor Point,
Session Breakout, and Multiple PDU Session).
## 5.7 KI#7: Obtain and maintain mapping table between IP address/IP range
with DNAI
### 5.7.1 Description
For edge computing scenarios, it is important for AF to obtain target DNAI in
order to determine the target new EAS for edge relocation. Up to Rel-17, it
has been assumed that the AF has been provisioned with the proper DNAI
information if it is required to use it during its interactions with the 5GC.
This key issue will investigate the potential solutions for the AF to be able
to obtain/determine the DNAI that is associated to a certain selected EAS, for
subsequent use with already defined services provided to the AF.
The following aspects shall be studied:
\- what information the AF should provide to 5GC (e.g. IP address or range
thereof (i.e.IPv4 subnetwork and IPv6 prefixes) , FQDN) and how it should
provide it to help determine proper DNAI if the AF does not have knowledge of
the DNAI information;
\- whether and how the 5GC can provide a DNAI to AF to help the subsequent AF
influence/request.
### 5.7.2 Scenarios
What we have met in the real network is that the AF does not understand the
DNAI information. All the DNAIs are created by operators and transmitted to AF
based on offline configuration. The DNAI information has been supported since
Rel-15 by TS 23.501 [2] AF influence procedure.
However, there still existing the scenario that the AF has not been provided
beforehand with DNAI information and needs to know the DNAI(s) associated with
the EAS(s) in the EHE under its responsibility.
### 5.7.3 Assumptions
The existing service operations used by the AF and making use of DNAI shall
not be impacted by this new functionality.
# 6 Solutions
## 6.0 Solution-Key issue matrix
The solutions in clause 6 can apply to one or more key issues described in
clause 5 of this report. Table 6.0-1 describes the relationship between
solutions and key issues.
Table 6.0-1: Solution-Key issue matrix
Solution Key issues
* * *
Title KI#1 KI#2 KI#3 KI#4 KI#5 KI#6 KI#7 01: EAS discovery in Home Routed
roaming scenario X  
02: Session Breakout in Visited PLMN X  
03: EAS (re)discovery procedure in roaming scenario X  
04: Support EAS (re-)discovery in VPLMN via HR PDU Session X  
05: Accessing V-EHE via HR PDU Session X  
06: URSP solution to support roamers access to EHE in a VPLMN X  
07: Using URSP Rules to Establish an LBO PDU Session X  
08: V-ECS Discovery during Steering of Roaming X  
09: PDU Session configuration from EASDF X  
10: LBO PDU Session establishment using PLMN criteria in RSD X  
11: Exposure of Network Congestion X  
12: Efficient exposure of RAN information X  
13: Fast and efficient network exposure improvements X  
14: Group Management X  
15: Selection of common DNAI X  
16: Selecting the same EAS/DNAI for collection of UEs X  
17: Application layer EAS selection for collections of UEs X  
18: Discovery of the same EAS for collections of UEs X  
19: Influencing UPF and EAS (re)location for collections of UEs X  
20: Global EASDF X  
21: EAS Deployment information differentiated by PLMN ID X  
22: EAS discovery Edge Node Sharing X  
23: Improvements for EHE operated by separate party X  
24: Reuse Option D after UL-CL insertion X  
25: EAS discovery in VPLMN via V-EASDF for a HR PDU Session X  
26: SM Policy for HR Session Breakout in VPLMN X  
27: EAS discovery with dynamic setup of a LBO PDU Session X  
28: Support edge computing in Roaming X  
29: Use of Internal Group ID and constraints in EDI X  
30: Policies referring to \"Allowed services\" and/or \"Subscriber
categories\" X  
31: Providing traffic offload policy for a set of UEs with service information
X  
32: Offload policy for finer granular set of UEs X  
33: AF requests offload policy for sets of UEs X  
34: Selecting the same EAS/DNAI for collection of UEs X  
35: Providing dedicated (re)location information as traffic routing
information X  
36: Providing dedicated (re)location information as EAS Deployment information
X  
37: (Re)location of same EAS and coordination across UEs X  
38: EAS Discovery for EHE shared with other PLMN X  
39: Support EAS relocation of inter-PLMN X X  
40: EAS discovery for shared EHE X  
41: Controlling non-3GPP access of EC traffic via URSP and ATSSS X  
42: Network-guided EC traffic switching X  
43: Network-based solution for keeping EC traffic on 3GPP Access X  
44: EAS traffic switching avoidance X  
45: Application selected PDU Session X X  
46: Avoid UE switching on-going EC traffic away from 3GPP access X  
47: Avoiding Switch Away Based on an SMF Indication X  
48: Avoiding Switch Away Based on an Indication in the URSP X  
49: URSP based solution to avoid UE to switch away from Edge PDU Session X  
50: Obtain and maintain mapping table between IP address/IP range with DNAI X
51: EDI holding the IP address to DNAI mapping X 52: AF obtaining target DNAI
provided by NEF X 53: EDC-based EAS discovery for HR PDU Session with Session
Breakout X  
54: PCF controlling common DNAI X  
55: Access the shared EAS via N9 tunnel X
## 6.1 Solution 01 (KI#1): EAS discovery in Home Routed roaming scenario
### 6.1.1 Description
This solution is for Key Issue #1, which addresses 5GS improvements to support
the UE access to an EHE in a VPLMN using a PDU Session with a PSA in the HPLMN
including aspects related to:
\- How to authorize the PDU Session to support local traffic routing to access
an EHE in the VPLMN;
\- How to support Rel-17 edge computing related procedures, such as EAS
(re-)discovery, as specified in clause 6 of TS 23.548 [3].
The current standards only depict 5GS architecture for non-roaming and LBO
roaming scenario supporting with UL-CL/BP. For Home Routed roaming scenario,
the data flow of the UE needs to pass through the UPF of the VPLMN to the UPF
of the HPLMN, the routing is controlled by SMF of the HPLMN, therefore the
local traffic routing in the VPLMN cannot be achieved.
This solution proposes several ways to support UE access to VPLMN EHE in HR
roaming scenarios according to different scenarios.
When H-AF has the knowledge of V-AF request, it creates a new request with
carrying V-AF application requirement, and the H-AF configures it to the H-SMF
according to the AF requests to influence traffic routing procedure defined in
clause 4.3.6.2 of TS 23.502 [9]. H-SMF will send the PCC rule related with the
AF request about the HR PDU Session to V-SMF, H-SMF also sends the VPLMN ECS
address and local traffic routing indication to V-SMF, and V-SMF will perform
the EAS discovery and local traffic routing in VPLMN as described in clause
6.2.3.2.3 of TS 23.548 [3].
When HPLMN does not have the knowledge of EAS deployment information in VPLMN,
after the H-SMF authorizes the V-SMF to perform local traffic routing, V-SMF
retrieves the EAS deployment information of the VPLMN from the V-NEF and
performs EAS discovery according to the EAS discovery procedure described in
TS 23.548 [3].
In addition, the V-AF can also configure the V-SMF according to the AF
influence on traffic routing procedure. In this case, during the HR PDU
Session establishment, the V-SMF needs to select a PCF in the VPLMN to
establish the SM Policy Association. V-PCF may send the VPLMN ECS address
obtained from V-AF to V-SMF.
The charging at VPLMN can be applied by V-UPF reporting usage information to
V-SMF to V-CHF, and the usage information also needs to be reported by V-UPF
to H-SMF via V-SMF, and H-SMF reports the usage to H-CHF for charging at
HPLMN.
### 6.1.2 Procedures
#### 6.1.2.1 EAS discovery when HPLMN has the knowledge of EAS deployment
information in VPLMN
Figure 6.1.2.1-1: HPLMN triggered EAS discovery in HR roaming scenario
1\. H-AF creates a new request with carrying V-AF application requirement and
invokes a Nnef_TrafficInfluence_Create service operation and influences the
traffic as described in steps 1-4 in clause 4.3.6.2 of TS 23.502 [9]. It is
assumed that EAS deployment information of VPLMN is not contained in AF
request.
NOTE 1: How V-AF sends application related information to H-AF is in SA6
scope. As an alternative, the V-AF may, depending on operator agreement, act
as a non-trusted AF of the HPLMN (using NEF).
2\. 5GS establishes a Home Routed PDU Session. During PDU Session
establishment, H-SMF retrieves the PCC rules for which PDU Session may be
impacted by the H-AF request for VPLMN from H-PCF using Rel-17 Npcf
mechanisms, and sends Nsmf_PDUSession_Create response to V-SMF, which also
includes an indication to authorize V-SMF to perform local traffic routing in
VPLMN and VPLMN ECS address. The indication and VPLMN ECS address are obtained
by H-SMF from H-UDM.
NOTE 2: The PCC rules are sent from H-SMF to V-SMF over N16.
3\. Steps 1-6 in clause 6.2.3.2.3 of TS 23.548 [3] are performed. In step 1 of
clause 6.2.3.2.3, UL-CL will be inserted by V-SMF.
NOTE 3: The local DNS server IP address will be configured to UE by V-SMF as
described in Option C in clause 6.2.3.2.3 of TS 23.548 [3] based on the
information provided in the AF request in step 1.
#### 6.1.2.2 EAS discovery when HPLMN does not have the knowledge of EAS
deployment information in VPLMN
Figure 6.1.2.2-1: VPLMN triggered EAS discovery in HR roaming scenario
1\. EAS deployment Information provisioned from AF via NEF as described in
clause 6.2.3.4.2 of TS 23.548 [3].
2-3. It is assumed that V-SMF has subscribed to EAS Deployment Information
Change Notification from the V-NEF. The V-NEF invokes
Nnef_EASDeployment_Notify to the SMF to provide the EAS Deployment
Information.
4\. If V-AF related information changes, V-AF creates a new request and
invokes a Nnef_TrafficInfluence_Create service operation and influences the
traffic as described in steps 1-4 in clause 4.3.6.2 of TS 23.502 [9].
5\. UE establishes Home Routed PDU Session. During the HR PDU Session
establishment, UE uses a DNN which supports local traffic routing in VPLMN for
Home Routed PDU Sessions. When V-SMF recognises the DNN, it will select a PCF
in VPLMN and establish a SM Policy Association with it. The PCC instructions
sent by V-PCF to V-SMF and PCC instructions sent by H-PCF to H-SMF will be
translated into QoS rules respectively and both stored in V-SMF until being
updated by new policy such as when step 10 happens.
6\. UE sends DNS Query message to V-UPF.
7\. V-UPF will detect the DNS query based on the V-SMF configured data
forwarding rule to the V-UPF for the traffic to be offloaded and notify V-SMF.
8\. V-SMF requests to do the local traffic routing in VPLMN and V-SMF selects
V-EASDF before the authorization, in order to support including V-EASDF/Local
DNS address information in PCO generated from HPLMN.
9- V-SMF sends the request of local traffic routing in VPLMN to H-SMF via
Nsmf_PDUSession_Update request, with including V-EASDF/Local DNS address
information, and also sends the capability of supporting EASDF indication to
H-SMF. According to the feature and principle of Home Routed PDU Session,
H-SMF should have the control of PDU Session, so V-SMF should request local
traffic routing from H-SMF first and then request the policy from V-PCF as
described in step 10. This requires operators in VPLMN to enhance the control
of V-SMF and optimize the protocol with operator in HPLMN.
10\. H-SMF sends the indication to authorize V-SMF to perform local traffic
routing in VPLMN and the H-DNS for the traffic to be routed to HPLMN via or
Nsmf_PDUSession_Update response. The indication is obtained by H-SMF from
H-UDM. H-SMF also includes V-EASDF/Local DNS address information in PCO via
Nsmf_PDUSession_Update response.
11-12. V-SMF sends Npcf_SMPolicyControl_Create request to V-PCF to retrieve
the new policy impacted by the AF request. After this step, V-SMF gets two
kinds of policies, one is from V-PCF and one is from H-PCF.
13\. The V-SMF invokes Neasdf_DNSContext_Create Request to the selected
V-EASDF. The DNS messages for the EC service to be offloaded to the VPLMN are
configured to be handled as step 15a-16a. For other DNS messages, they are
configured to be forwarded to the DNS server related to the HPLMN.
14\. The EASDF invokes the service operation Neasdf_DNSContext_Create
Response.
15a. If V-SMF has received the EAS deployment information in steps 2-3, V-SMF
sends the PCO generated by H-SMF to UE and indicates UE to resend the DNS
Query message to V-EASDF.
16a. Steps 7-19 in clause 6.2.3.2.2 of TS 23.548 [3] are performed.
15b. If V-SMF did not receive the EAS deployment information in steps 2-3, and
V-SMF received the application related information (e.g. DNAI, local DNS
server address), V-SMF sends the PCO generated by H-SMF to UE and indicates UE
to resend the DNS Query message to local DNS server.
16b. Steps 1-6 in clause 6.2.3.2.3 of TS 23.548 [3] are performed.
After the whole above procedure, if the UE sends out a DNS query which intends
for Home PLMN DNS processing, while using the V-EASDF or Local DNS server
address as the target IP address (since in step 15a and 15b the UE PCO is
updated with V-EASDF or Local DNS server address), the V-UL-CL and V-UPF
should identify the FQDN and decide whether the DNS query should be sent to
Home PLMN network. If yes, V-UPF should send the DNS query to H-UPF, and H-UPF
should change the target IP address in the DNS query into Home PLMN DNS
address, based on the N4 rule from H-SMF.
### 6.1.3 Impacts on services, entities and interfaces
**For 6.1.2.1**
H-SMF:
\- obtains the indication to authorize V-SMF to perform local traffic routing
in VPLMN and VPLMN ECS address from UDM;
\- Sends the indication and VPLMN ECS address to V-SMF
H-UDM:
\- In the UE subscription data, the indication and VPLMN ECS address are
configured.
V-SMF:
\- obtains the indication to perform local traffic routing in VPLMN from
H-SMF;
\- obtains VPLMN ECS address from H-SMF;
\- supports to insert UL-CL and local PSA UPF for local traffic routing in
VPLMN.
**For 6.1.2.2**
V-SMF:
\- When V-SMF recognises the DNN, it will select a PCF in VPLMN and establish
a SM Policy Association with the V-PCF;
\- V-SMF sends the V-PCF related PCC rules to V-UPF through N4;
\- interacts with V-EASDF by reusing the interface between SMF and EASDF
defined in TS 23.548 [3];
\- requests local traffic routing from H-SMF;
\- sends the V-EASDF address/local DNS address to H-SMF.
V-PCF:
\- involved with the HR PDU Session and provides PCC instructions to V-SMF.
V-UPF:
\- detects the DNS query and notifies the V-SMF.
H-SMF:
\- sends the indication to authorize V-SMF to perform local traffic routing in
VPLMN;
\- H-SMF gets this indication from H-UDM.
\- creates the PCO including V-EASDF/Local DNS address;
\- configures the H-UPF with changing the target IP address of the DNS query
into Home PLMN DNS address.
H-UPF:
\- changes the target IP address of the DNS query into Home PLMN DNS address.
## 6.2 Solution 02 (KI#1): Session Breakout in Visited PLMN
### 6.2.1 Description
This solution corresponds to KI#1 and addresses the scenario 2.2, that is, UE
accessing V-EHE via a Home Routed (HR) PDU Session (i.e. with PSA in HPLMN)
where HPLMN does not have the knowledge of EAS deployment information in VPLMN
as described in clause 5.1.2.
This solution corresponds to KI#1 and addresses the following aspects for the
scenario using a PDU Session with a PSA in the HPLMN:
\- how to authorize the PDU Session to support local traffic routing to access
an EHE in the VPLMN;
\- how to support Rel-17 edge computing related procedures, such as EAS
(re-)discovery, as specified in clause 6 of TS 23.548 [3].
When roaming, the UE establishes a Home Routed Session that is capable of
supporting session breakout in V-PLMN based on the subscription. In this
scenario, the Home PLMN and Visited PLMN have an agreement on the support of
the session breakout for the home routed session.
1) During the establishment of Home Routed PDU Session, Home PLMN allows the
roaming UE to access the local part of DN identified by DNN based on its HPLMN
subscription.
2) V-SMF in V-PLMN executes the session breakout procedure for the UE to
access the local part of DN where the EAS in EHE is located in VPLMN. This can
be triggered by the EAS discovery procedure using V-EASDF.
3) Through a Home Routed Session, the UE can access EAS deployed in EHE in
VPLMN while the UE can also access the Home DN in the Home PLMN.
NOTE: The companion solution #26 in clause 6.26 explains the policy and
charging aspect of this solution.
Figure 6.2.1-1: Architecture for Home Routing Session Breakout in Visited PLMN
### 6.2.2 Procedure
Figure 6.2.2-1: PDU Session Establishment Procedure for HR Session Breakout in
VPLMN
1-4. During the registration procedure, the UDM sends the Home Routed Visited
SBO (HR-VSBO) allowed indication to the AMF.
5-8. During the PDU Session establishment procedure, if the AMF receives the
HR-VSBO allowed indication and AMF selects V-SMF supporting UL-CL with V-EASDF
interaction, the AMF sends the HR VSBO allowed indication to the V-SMF.
9\. If the V-SMF decides to create HR VSBO session, V-SMF sends the VSBO
request and V-EASDF/DNS server address of VPLMN to the H-SMF. The HPLMN
allowed local DN configuration is configured with the V-SMF per DNN/S-NSSAI.
10-11. The H-SMF checks whether the HR-VSBO is allowed based on its local
configuration or subscription.
12\. The H-SMF establishes N4 session with H-UPF.
13\. H-SMF checks whether the HR VSBO is allowed for the UE. If allowed, the
H-SMF sends the VSBO grant indication with DNS server address set to the
V-EASDF in PCO and Home DNS Server address to the V-SMF. The H-SMF may send
the HPLMN allowed V-SBO information to the V-SMF. The HPLMN allowed V-SBO
information includes the IP address ranges and DNS domain name range within
which the V-SMF is allowed to route traffic.
NOTE 1: If the H-SMF grants the HR-VSBO request, the V-SMF is allowed to
offload for accessing the EHE in VPLMN without further control from HPLMN.
14-15. The V-SMF may perform the Local UPF insertion (or UL-CL insertion)
procedure. The V-SMF determines the UL-CL filters based on the V-SBO
information provided by the H-SMF in step 13. Steps 14 and 15 show how local
UPF insertion can be performed in the middle of the PDU Session Establishment.
16\. After the V-SMF performs Local UPF insertion for the local part of DN,
the V-SMF performs the DNSContext creation procedure to send the DNS Message
Handling Rules and Home DNS Server Address to the V-EASDF.
NOTE 2: With configured DNS Message Handling Rules configured to V-EASDF, all
the DNS Queries using this PDU Session go to the V-EASDF, and DNS resolution
for the local routed traffic is handled based on the Rel-17 mechanism for EAS
discovery using EASDF. DNS Queries that do not match the rule configured by
V-SMF go to the Home DNS Server.
NOTE 3: Step 12 can be performed when the Local UPF insertion procedure after
the PDU Session Establishment.
NOTE 4: V-SMF can use the EAS Deployment Information provisioned from the AF
using the existing procedures described in the clauses 6.2.3.4.2, 6.2.3.4.3 of
TS 23.548 [3] to determine DNS Message Handling Rules. V-SMF also uses the
V-SBO information provided by H-SMF for DNS Message Handling Rules.
17-18. The AMF forwards the PDU Session Establishment Accept/Reject to the UE.
19-21. The EAS (re)-discovery over Session Breakout Connectivity Model as
specified in clause 6.2.3 of TS 23.548 [3] can be performed among the UE,
V-SMF and V-EASDF based on the UE DNS Query so the UE can access EHE in VPLMN.
With the same PDU Session, the UE can still access DN in HPLMN at the same
time. Receiving the DNS Query from the UE, the V-EASDF checks whether FQDN can
be locally served. If FQDN is for visited network, the V-EASDF exchanges DNS
Query and Response with Visited DNS server. Otherwise, the V-EASDF exchanges
DNS Query and DNS Response with Home DNS server.
### 6.2.3 Impacts on services, entities and interfaces
AMF:
\- The AMF is required to select the V-SMF supporting Visited Session Breakout
for Home Routed Session and forward the Home Routed Session Breakout
indication to the V-SMF.
V-SMF:
\- The V-SMF is required to request the Visited Session Breakout with the
V-EASDF/DNS server address of VPLMN to the H-SMF.
\- The V-SMF is required to interact with V-EASDF by reusing the interface
between SMF and EASDF defined in TS 23.548 [3], including creating DNS message
handling Rules using the received DNS server address using the DNS server
address of HPLMN provided by the H-SMF.
H-SMF:
\- The H-SMF is required to authorize the V-SMF request for Visited Session
Breakout.
\- The H-SMF is required to send the V-SMF provided V-EASDF/DNS server address
to the UE via V-SMF.
\- The H-SMF is required to provide the DNS Server address of HPLMN to the
V-SMF.
\- The H-SMF is required to provide HPLMN allowed Visited Session Breakout
information including the range of IP addresses and FQDN during the
establishment of the Home Routed Session to the V-SMF.
UDM:
\- The subscription information of UDM is required to support the indication
for Home Routed Session Breakout.
V-EASDF:
\- The V-EASDF is required to support the DNS message rule including the
default DNS server address indicating all DNS Queries that do not match other
rules should be forwarded.
NOTE: It is assumed that the functionalities of SMF and EASDF in Rel-17 to
support edge computing in home network for non-roaming scenario are also
required to be supported by V-SMF and V-SMF in VPLMN for roaming scenario.
## 6.3 Solution 03 (KI#1): EAS (re)discovery procedure in roaming scenario
### 6.3.1 Description
KI#1 proposes the scenario: Accessing EHE in a VPLMN when roaming. This
solution addresses one of these specific scenarios, i.e. UE accessing V-EHE
for a PDU Session with a PSA in HPLMN and assumes that HPLMN does not have the
knowledge of EAS deployment information in VPLMN.
This solution proposes EAS (re)discovery procedure in V-EHE by transmitting a
newly defined EC enabling indicator between V-SMF and H-SMF and using the
V-EASDF. The UL-CL functionality is used to combine the features of HR and LBO
roaming and steer local traffic to the local V-PSA. To minimize the impact of
UE, UE is not aware of DNS server changing in HR roaming scenario.
NOTE 1: According to the roaming agreement between HPLMN and VPLMN, DNS
security issue (i.e. using EASDF IP replacement mechanism) can be resolved
based on mutual trust between operators.
NOTE 2: This EC enabling indicator means that VPLMN can apply the traffic
offload related to EC service (e.g. UL-CL insertion for EC traffic) without
any further HPLMN control.
### 6.3.2 Procedures
#### 6.3.2.1 EAS discovery procedure in roaming scenario
When a UE that has established an HR PDU Session expects to use edge computing
service, the UE may send a DNS query to the DNS server, the corresponding EAS
discovery procedure is shown in figure 6.3.2.1-1:
Figure 6.3.2.1-1: EAS discovery procedure accessing V-EHE in roaming scenario
1\. UE requests PDU Session establishment for HR roaming as described in
clause 4.3.2.2.2 of TS 23.502 [9]. During the PDU Session Establishment
procedure, the H-SMF may consider the UE subscription information to select a
H-DNS server for the PDU Session. H-SMF sends H-DNS server IP address included
in PCO to UE via V-SMF.
H-SMF may indicate to the UE either that for the PDU Session the use of the
EDC functionality is allowed or that for the PDU Session the use of the EDC
functionality is required.
If V-SMF does not store the EC enabling indicator per PDU Session level, V-SMF
sends an EC enabling indicator request to H-SMF.
H-SMF respond with a positive EC enabling indicator to V-SMF to indicate that
the HPLMN authorizes VPLMN to manage the EC service according to the roaming
agreement between these two operators and UE is unaware of potential DNS
server changing. H-SMF also sends the IP address of H-DNS server to V-SMF.
According to the roaming agreement, a FQDN list for EC service in VPLMN is
preconfigured on the V-SMF. And V-SMF selects V-EASDF based on the local
configuration. V-SMF drives related DNS message handling rule based on EAS
deployment information provided by V-PLMN AF and/or local configuration and
sends this DNS message handling rule to V-EASDF via Neasdf_DNSContext_Create
request.
NOTE 1: V-EASDF selection is triggered in HR PDU Session establishment
procedure based on the roaming agreement and the positive EC enabling
indicator.
V-SMF uses the FQDN list to derive a traffic routing rule. This traffic
routing rule is provided to V-UPF (with UL-CL functionality), e.g. V-UPF
routes DNS Queries for an FQDN (range) query to V-EASDF, and routes other
traffic to H-PSA.
V-SMF configures V-UPF with EASDF IP replacement information (i.e. H-DNS
server IP address and port number, V-EASDF IP address and port number). In
uplink direction, V-UPF replaces the destination address of the DNS query with
corresponding FQDN from H-DNS server to V-EASDF; in downlink direction, V-UPF
replaces the source address of the DNS response with corresponding FQDN from
V-EASDF to H-DNS server so that the UE is not aware of the change of DNS
server.
NOTE 2: This configuration refers to the option D of session breakout
connectivity model in TS 23.548 [3] and assumes that V-UPF (with UL-CL
functionality) steering is based on L4 information (i.e. DNS port number) and
that V-UPF (with UL-CL functionality) has visibility of the DNS traffic (i.e.
FQDN in the DNS Query message).
2\. UE sends DNS query to H-DNS server.
3a. If the DNS query does not match the FQDN list, V-UPF delivers the DNS
query to H-PSA via N9 tunnel and H-PSA delivers the DNS query to H-DNS server.
3b. If the DNS query matches the FQDN list, V-UPF delivers the DNS query to
V-EASDF using EASDF IP replacement. The following EAS discovery procedure is
based on step 3b.
4\. If the DNS Query message matches a DNS message detection template of DNS
message handling rule for reporting, the V-EASDF sends the DNS message report
to V-SMF by invoking Neasdf_DNSContext_Notify Request.
5\. V-SMF responds with Neasdf_DNSContext_Notify Response.
6\. V-SMF updates DNS message handling rule if needed. V-SMF sends this DNS
message handling rule to V-EASDF via Neasdf_DNSContext_Update request.
7\. V-EASDF responds with Neasdf_DNSContext_Update response.
8\. V-EASDF handles the DNS query according to the DNS message handling rule
and sends the DNS query to the DNS server in VPLMN, the V-DNS server returns
the DNS response including EAS IP address and FQDN to V-EASDF.
9\. V-EASDF sends the DNS response to the V-SMF by invoking
Neasdf_DNSContext_Notify request including EAS information if the EAS IP
address or the FQDN in the DNS response matches the DNS message detection
template provided by the V-SMF as described in clause 6.2.3.2.2 of TS 23.548
[3], and V-EASDF buffers this DNS response.
10\. V-SMF responds with Neasdf_DNSContext_Notify Response.
11\. Based on EAS information received from the V-EASDF in
Neasdf_DNSContext_Notify and other UPF selection criteria, V-SMF may determine
the DNAI and determine the associated N6 traffic routing information for the
DNAI based on local configuration. V-SMF may perform V-UL-CL and V-PSA
selection and insertion as described in TS 23.502 [9].
V-SMF configures the V-UL-CL with CN tunnel info provided by V-UPF and V-PSA
and with AN tunnel info provided by serving AN. The traffic routing rules are
provided to V-UL-CL based on EAS information, e.g. V-UL-CL routes the traffic
to V-PSA if the IP packet has a destination address of V-EAS and routes other
traffic to V-UPF.
V-SMF configures the Usage Report Rule on V-PSA for traffic charging. V-PSA
collects and reports the charging information between UE and V-EAS based on
the corresponding URR.
12\. V-SMF invokes Neasdf_DNSContext_Update Request (DNS message handling
rule). The DNS message handling rule with the Control Action \"Send the
buffered DNS response(s) message to UE\" indicates the V-EASDF to send the DNS
response buffered in step 9 to UE via V-UPF.
13\. V-EASDF responds with Neasdf_DNSContext_Update response.
14\. If it is indicated to send the buffered DNS response to UE in step 12,
the V-EASDF sends the DNS response to the V-UPF. V-UPF replaces the source
address from V-EASDF to H-DNS server in the DNS response based on the V-SMF
instructions and sends this DNS response to the UE via V-UL-CL.
15\. For traffic charging between UE and V-EAS, V-PSA collects and reports the
charging information based on the corresponding URR.
#### 6.3.2.2 EAS rediscovery procedure in roaming scenario
The support for EAS rediscovery indication procedure enables the UE to refresh
stale EAS information stored locally so that the UE can trigger EAS discovery
procedure to discover new EAS information as described in clause 6.2.3.3 of TS
23.548 [3]. The corresponding EAS rediscovery procedure is shown in figure
6.3.2.2-1:
Figure 6.3.2.2-1: EAS rediscovery procedure accessing V-EHE in roaming
scenario
0\. The procedure in clause 6.3.2.1 executes with following difference to
apply to EAS rediscovery:
In step 1, the UE may indicate its support for refreshing stale EAS
information stored locally corresponding to the impact field per the EAS
rediscovery indication from network to the V-SMF during the HR PDU Session
Establishment procedure.
NOTE 1: If the UE indicates such support, V-SMF may store this indication in
the PDU Session context.
1a. Due to the UE mobility the V-SMF triggers V-PSA insertion, change or
removal for the PDU Session. The insertion, change or removal of V-PSA
triggers EAS rediscovery.
NOTE 2: This solution does not cover EAS rediscovery scenario triggered by AF.
2\. V- SMF sends PDU Session Modification Command (EAS rediscovery indication,
[impact field]) to UE as described in step 2 of clause 6.2.3.3 of TS 23.548
[3], with the following differences:
V-SMF sends the impact field with the EAS rediscovery indication if the UE
supports this indication.
If V-SMF chooses new V-EASDF for the PDU Session, it does not provide the
V-EASDF IP address to UE. V-SMF may configure V-UPF with the updated traffic
routing rule (e.g. V-UPF routes DNS Queries for an FQDN (range) query to the
new V-EASDF) and with corresponding EASDF IP replacement information (i.e.
H-DNS server IP address and port number, new V-EASDF IP address and port
number) as described in step 1 of clause 6.3.2.1.
UE refreshes DNS record according to EAS rediscovery indication received from
V-SMF.
3\. UE may trigger EAS discovery procedure to get new EAS information. This
DNS query is sent to corresponding DNS server using IP address replacement in
VPLMN.
### 6.3.3 Impacts on existing entities and interfaces
H-SMF:
\- sends H-DNS server IP address and an EC enabling indicator to V-SMF in the
HR PDU Session establishment procedure.
V-SMF:
\- identifies the EC enabling indicator and manages the EC service for UE in
VPLMN;
\- selects and inserts the V-UL-CL and V-PSA based on local policy and does
not need to interact with H-SMF;
\- stores the indication which indicates that UE supports to refresh stale EAS
information stored locally corresponding to the impact field per the EAS
rediscovery indication from network in the PDU Session context;
\- sends the EAS rediscovery indication including the impact field to UE.
## 6.4 Solution 04 (KI#1): Support EAS (re-)discovery in VPLMN via HR PDU
Session
### 6.4.1 Description
This solution corresponds to KI#1. The scenarios 2.1 and 2.2 are described in
clause 5.1.2.
As described in clause 5.1.2, a roaming UE may access V-EHE via an established
HR PDU Session. To support such scenario, session breakout to access EHE in
VPLMN is used. The following aspects are included:
\- The H-PCF provides authorization policy which indicates local traffic
routing in VPLMN is authorized for the UE accessing the VPLMN.
\- UL-CL/BP and local PSA insertion.
The V-SMF performs selection and insertion of UL-CL/BP and local PSA based on
UE location when receiving the authorization policy from H-SMF without
considering EAS deployment information in VPLMN. In this case, UL-CL/BP is
selected based on UE location.
For scenario 2.1, the V-SMF may select and insert UL-CL/BP and local PSA based
on UE location and target DNAI after PDU Session is established. The V-SMF
selects target DNAI based on DNAIs received from H-SMF. The DNAIs are
determined by H-SMF based on EAS IP report from H-EASDF. In this case, UL-
CL/BP is selected based on UE location and selected EAS IP address.
\- EAS discovery using H-EASDF.
For scenario 2.1, the H-SMF obtains ECS option/local DNS server from V-SMF
during DNS based EAS discovery procedure and send it to H-EASDF. The H-EASDF
handles DNS queries including FQDNs deployed in VPLMN based on the ECS
option/local DNS server as defined in TS 23.548 [3]. In this case, different
FQDNs may use different ECS option/local DNS Server.
For scenario 2.2, the H-SMF obtains ECS option/local DNS server from V-SMF
during PDU Session Establishment and send it to H-EASDF. The H-EASDF handles
all DNS queries of the UE based on this ECS option/local DNS server. In this
case, all DNS queries requested by the UE will share same ECS option/local DNS
server.
### 6.4.2 Procedures
#### 6.4.2.1 EAS discovery
Figure 6.4.2.1-1 shows the procedure of EAS discovery in VPLMN via HR PDU
Session.
Figure 6.4.2.1-1: EAS discovery in VPLMN via HR PDU Session
1\. UE sends PDU Session establishment request to V-SMF.
2\. The V-SMF sends Nsmf_PDUSession_Create Request to H-SMF.
For scenario 2.2 where HPLMN does not have the knowledge of EAS deployment in
VPLMN, the V-SMF may, based on UE location, send information to build ECS
option/local DNS server for the VPLMN from V-SMF to H-SMF.
3\. The H-SMF receives authorization policy which indicates whether local
traffic routing in the VPLMN is authorized from H-PCF.
The content of authorization policy includes the following information:
\- Local Traffic Routing Authorization Indication. The indication is used to
indicate whether local traffic routing in VPLMN is authorized.
\- Traffic description information, e.g. FQDN(s), EAS IP(s). The traffic
description information is used to indicate the corresponding specific traffic
is authorized to perform local traffic routing in VPLMN.
4\. H-SMF invokes Neasdf_DNSContext_Create Request including DNS handling rule
to H-EASDF.
For scenario 2.2, the H-SMF may send the information to build ECS option/local
DNS server as described in step 2 to the H-EASDF.
5\. The H-SMF sends Nsmf_PDUSession_Create Response including authorization
policy to the V-SMF.
The H-SMF sends H-EASDF address to the V-SMF.
6\. [Conditional] The V-SMF performs UL-CL/BP and local PSA selection and
insertion if the authorization policy indicates local traffic routing in the
VPLMN is authorized for the traffic indicated by Traffic description
information in the authorization policy. In this case, the V-SMF selects DNAI
for the UL-CL/BP insertion based on UE location.
The V-SMF also interacts with H-SMF to establish N9 tunnel between the UL-
CL/BP and PSA controlled by H-SMF. Details can be found in steps 4-5 in clause
4.23.9.1 of TS 23.502 [9] by replacing I-SMF with V-SMF and SMF with H-SMF.
To support charging in both PLMNs, the V-SMF provides Usage Reporting Rules to
the UL-CL/BP and local PSA to collect Usage Report for charging in VPLMN.
NOTE 1: The interactions between H/V-SMF and H/V-CHF are not in the scope of
SA2.
The V-SMF forwards the Usage Report to the H-SMF. The H-SMF aggregates and
constructs usage reports towards H-CHF.
7\. The V-SMF sends PDU Session Establishment accept message including the
H-EASDF address to UE.
8\. UE sends DNS query which includes FQDN deployed in the VPLMN to the
H-EASDF.
For scenario 2.1, H-SMF may obtain ECS option/local DNS server from V-SMF by
performing steps 9-12:
9\. The H-EASDF reports the FQDN to H-SMF by invoking Neasdf_DNSContext_Notify
Request.
H-SMF determines candidate DNAIs of VPLMN corresponding the FQDN based on the
EAS deployment information in the VPLMN. H-SMF may consider UE location to
select the candidate DNAIs of VPLMN in this step. (steps 10-12)
10\. The H-SMF initiates Nsmf_PDUSession_Update Request service including FQDN
to the V-SMF.
11\. V-SMF determines the target DNAI based on UE location and provides
information to build ECS option or local DNS server to H-SMF based on the
target DNAI.
12\. H-SMF invokes Neasdf_DNSContext_Update Request to H-EASDF including
updated DNS handling rule, e.g. information to build ECS option or local DNS
server.
13\. The H-EASDF adds ECS option into the DNS query and sends it to C-DNS
server, or sends the DNS query to the local DNS server if the DNS query
matches the DNS handling rule as described in clause 6.2.3 of TS 23.548 [3].
H-EASDF receives the DNS Response including EAS IP address which is determined
by the DNS system.
For scenario 2.1, H-SMF may trigger V-SMF selecting and inserting UL-CL/BP and
local PSA by performing steps 14-16:
14\. The H-EASDF invokes Neasdf_DNSContext_Notify Request including EAS IP to
the H-SMF based on DNS handling rule.
15\. The H-SMF triggers the V-SMF to perform UL-CL/BP and local PSA selection
and insertion as described in step 6 of clause 4.23.9.1 in TS 23.502 [9] by
replacing I-SMF as V-SMF and SMF as H-SMF.
H-SMF determines target DNAI of VPLMN corresponding the EAS IP based on the
EAS deployment information in the VPLMN.
The H-SMF initiates Nsmf_PDUSession_Update Request service including target
DNAI of VPLMN to the V-SMF.
The V-SMF selects and inserts UL-CL/BP and local PSA based on the target DNAI.
The V-SMF also interacts with H-SMF to establish N9 tunnel between the UL-
CL/BP and PSA controlled by H-SMF. Details can be found in steps 4-5 in clause
4.23.9.1 of TS 23.502 [9] by replacing I-SMF with V-SMF and SMF with H-SMF.
The V-SMF sends Nsmf_PDUSession_Update Response to H-SMF.
16\. The H-SMF invokes Neasdf_DNSContext_Update Request to trigger the H-EASDF
sending DNS response to UE.
17\. The H-EASDF sends the DNS response including the EAS IP to UE.
#### 6.4.2.2 EAS re-discovery
Figure 6.4.2.2-1 shows the procedure of EAS rediscovery in VPLMN via HR PDU
Session.
Figure 6.4.2.2-1: EAS rediscovery in VPLMN via HR PDU Session
When UE moves with V-SMF insertion/change/remove, the procedure is performed
from step 1. When UE moves without V-SMF change, the procedure is performed
from step 2.
1\. The procedure described in clause 4.23.7 (N2 based handover) or 4.23.11
(Xn based handover) of TS 23.502 [9] is performed by replacing I-SMF with
V-SMF and SMF with H-SMF.
1a1. (V-SMF insertion) The (target) V-SMF retrieves SM context requests SM
context from H-SMF.
1a2. (V-SMF change) The target V-SMF retrieves SM context from the source
V-SMF.
1b. SMF (H-SMF / source V-SMF) to target V-SMF: Nsmf_PDUSession_Context
Response including the N9 FTEID/IP address of the H-UPF. The SMF responds with
the requested SM context which includes authorization policy from H-SMF. The
SM context also includes impact field corresponding to the old target DNAI if
it has been inserted by H-SMF. Additionally, in case the PLMN ID received from
the V-SMF in Nsmf_PDUSession_Context Request is different from H-SMF\'s own
PLMN ID, the H-SMF provides the N9 FTEID/IP address of the H-UPF to the Target
V-SMF.
1c. The target V-SMF selects a target V-UPF: based on the received SM context,
e.g. S-NSSAI and UE location information, and the N9 FTEID/IP address of the
H-UPF, the target V-SMF selects a target V-UPF complying with the QoS/delay
requirements.
For the V-SMF remove case, step 2 and steps 4-5 are skipped, only steps 3 and
6 are performed.
After the handover procedure, the (target) V-SMF performs UL-CL/BP and local
PSA insertion/change/removal as described in clause 4.23.9 of TS 23.502 [9] by
replacing I-SMF with V-SMF and SMF and H-SMF. Differences are shown as steps 2
to 5:
2\. The (target) V-SMF invokes Nsmf_PDUSession_Update Request (new target DNAI
if available and corresponding information to build ECS option) to SMF.
For the case of local PSA removal, the request message is sent to SMF without
including any DNAI.
3\. The H-SMF determines DNAI is changed and updates DNS handling rules
towards the H-EASDF by invoking Neasdf_DNSContext_Update service.
4\. The H-SMF initiates Nsmf_PDUSession_Update Request towards the (target)
V-SMF.
5\. The V-SMF initiates PDU Session Modification command (EAS rediscovery
indication and impact field) to UE.
The impact field corresponds to the new target DNAI and old target DNAI.
For the case of local PSA insertion/change, the (target) V-SMF determines the
impact field based on the new target DNAI. Based on the received impact field
in step 1 corresponding to old target DNAI, the target V-SMF determines the
final impact field corresponding to the new target DNAI and old target DNAI.
For the case of local PSA removal, as there is no new target DNAI, there is no
impact field corresponding to the new target DNAI.
6\. (V-SMF removal case) The H-SMF initiates PDU Session Modification command
to UE.
For scenario 2.1, as the H-SMF has the knowledge of EAS deployment information
in VPLMN, the H-SMF determines the impact field corresponding to old target
DNAI inserted by the removed V-SMF. Then the H-SMF sends EAS rediscovery
indication and the impact field to the UE.
For scenario 2.2, as the H-SMF does not have the knowledge of EAS deployment
information in VPLMN, the H-SMF only sends EAS rediscovery indication to the
UE.
For EAS rediscovery triggered by AF, if the AF can interact with the HPLMN via
H-NEF, the EAS re-discovery procedure is performed from step 4.
NOTE: For the AF that cannot interact with HPLMN via H-NEF, the EAS
rediscovery triggered by AF is not supported in this Release.
### 6.4.3 Impacts on services, entities and interfaces
**EAS discovery:**
H-PCF:
\- retrieves and sends authorization policy to H-SMF which indicates local
traffic routing in VPLMN is authorized.
H-SMF:
\- sends H-EASDF address to V-SMF;
\- sends authorization to V-SMF;
\- receives information to build ECS option/local DNS server from V-SMF;
\- receives Usage Report corresponds to local routed traffic in VPLMN from
V-SMF;
\- in case the PLMN ID sent by V-SMF is different from H-SMF\'s own PLMN ID,
the H-SMF provides in Nsmf_PDUSession_Context Response the N9 FTEID/IP address
of the H-UPF to the target V-SMF;
\- for scenario 2.1:
\- sends FQDN to V-SMF.
\- for scenario 2.2:
\- configured with information to build ECS option/local DNS server.
V-SMF:
\- receives H-EASDF address from H-SMF;
\- receives authorization policy from H-SMF;
\- sends Usage Report corresponds to local routed traffic in VPLMN;
\- the target V-SMF selects a target V-UPF based on the received SM context,
e.g. S-NSSAI and UE location information, and the N9 FTEID/IP address of the
H-UPF;
\- for scenario 2.1:
\- receives FQDN from H-SMF;
\- determines information to build ECS option/local DNS server based on
candidate DNAIs and UE location;
\- sends information to build ECS option/local DNS server to H-SMF;
\- receives target DNAI from H-SMF and perform UL-CL/BP insertion.
\- for scenario 2.2:
\- sends ECS Option/local DNS server of the VPLMN to H-SMF;
\- determines DNAI and perform UL-CL/BP insertion based on the UE location and
authorization policy.
V-NRF:
\- additionally receives the N9 IP address of the H-UPF in NRF discovery
request from target V-SMF;
\- provides candidate list of V-UPFs to target V-SMF based on S-NSSAI and UE
location information, and the N9 IP address of the H-UPF.
**EAS rediscovery:**
V-SMF:
\- (V-SMF insertion/change) receives SM context including authorization policy
and impact field corresponding to old target DNAI from source V-SMF/H-SMF;
\- (V-SMF insertion/change) determines impact field based on new target DNAI
and impact field received from V-SMF/H-SMF.
H-SMF:
\- (V-SMF insertion) sends SM context including authorization policy and
impact field corresponding to old target DNAI to V-SMF;
\- (V-SMF removal) initiates PDU Session modification procedure for EAS
rediscovery.
## 6.5 Solution 05 (KI#1): Accessing V-EHE via HR PDU Session
### 6.5.1 Description
The following solution corresponds to the key issue #1 on Accessing EHE in a
VPLMN when roaming as specified in clause 5.1.
The UE establishes a Home Routed PDU Session using session breakout to access
the EHE in VPLMN. The V-SMF determines the HR PDU Session for V-EHE should be
activated based on the EAS information and roaming offload policy received
from H-PCF via H-SMF, and configures the traffic routing rule and Usage Report
Rule to assist traffic offload to V-EAS and usage information report from UL-
CL V-UPF or BP V-UPF to H-SMF via V-SMF for offline and online charging.
Figure 6.5.1-1: UP traffic and CP signalling for scenario of accessing V-EHE
via a HR PDU Session
### 6.5.2 Procedures
#### 6.5.2.1 EAS discovery
Figure 6.5.2.1-1: Accessing V-EHE via a HR PDU Session
1\. The UE initiates a Home Routed PDU Session establishment procedure with
V-SMF.
2\. The V-SMF sends Nsmf_PDUSession_Create Request to H-SMF.
3\. The H-PCF may provide the authorized roaming offload policy to V-SMF via
H-SMF. The roaming offload policy includes the specific Application
Identifier(s) or FQDN set or IP range, and indicates if the Application
Identifier or FQDN or EAS IP is satisfied, the HR PDU Session for V-EHE is
activated (e.g. inserts a V-UPF accessing EAS). The H-SMF may also send the IP
address of Home DNS server to V-SMF.
4\. The V-SMF selects a V-EASDF, and the EAS Deployment Information in VPLMN
is provisioned as specified in clause 6.2.3 of TS 23.548 [3]. The V-SMF
includes the IP address of the V-EASDF as DNS server/resolver for the UE in
the PDU Session Establishment Accept message. According to the roaming offload
policy and the EAS Deployment Information, the V-SMF configures DNS message
handling rules to V-EASDF. The V-EASDF handles all DNS queries based on the
DNS message handling rules. If the requested FQDN matches the DNS message
handling rule for VPLMN traffic routing, the V-EASDF decides to send the DNS
Query to Local DNS server or C-DNS server (adding EDNS Client Subnet option).
If the requested FQDN matches the DNS message handling rule for HPLMN traffic
routing, the V-EASDF may send it to Home DNS server. The Home DNS server could
be locally configured at V-SMF or received from H-SMF in step 3.
5\. The UE sends a DNS Query message to the V-EASDF, and the V-EASDF performs
EAS discovery as specified in clause 6.2.3 of TS 23.548 [3]. The discovered
EAS information is reported to V-SMF.
6\. Based on the received EAS information (e.g. EAS IP address) and the
roaming offload policy, the V-SMF decides to insert or relocate UL-CL/BP V-UPF
and PSA V-UPF for traffic offload to the V-EAS.
7\. The V-SMF configures traffic routing rule and Usage Report Rule on the UL-
CL V-UPF or the BP V-UPF. The traffic routing rule includes EAS IP (for UL-CL)
or IP prefix \@local PSA (for BP) to route traffic towards the V-EAS. The
Usage Report Rule is to request the report of the relevant usage information
via monitoring traffic from UE to V-EAS, which is used for offline and online
charging.
8\. UL and DL traffic routed between UE and V-EAS via UL-CL V-UPF or BP V-UPF.
The UL-CL V-UPF or V-UPF collects and reports the usage information to V-SMF.
9\. The V-SMF sends usage information received from V-UPF to the H-SMF, and
the H-SMF generates charging information. Alternatively, the V-SMF may
generate the charging information, and sends both usage information and
charging information to H-SMF.
#### 6.5.2.2 EAS re-discovery
Figure 6.5.2.2-1 shows the procedure of EAS rediscovery in VPLMN via HR PDU
Session.
Figure 6.5.2.2-1: EAS rediscovery in VPLMN via HR PDU Session
1a. Due to the UE mobility, the V-SMF insertion/change/remove is triggered,
the procedure is performed as described in step 1 of clause 6.4.2.2 (solution
#04).
1b. If the AF triggers EAS relocation, the H-AF provides the EAS deployment
information and IP address of target EAS to network.
The H-SMF determines the target DNAI based on the EAS deployment information
and IP address of target EAS. The H-SMF sends the target DNAI to the H-AMF by
invoking Nsmf_PDUSession_SMContextStatusNotify service operation. The H-AMF
selects V-SMF based on the target DNAI as described in clause 4.23.5.4 of TS
23.502 [9].
In the case of V-SMF insertion, the target V-SMF retrieves SM context which
includes roaming offload policy and the information for EAS relocation from
H-SMF. In case of V-SMF change, the target V-SMF retrieves SM context which
includes roaming offload policy and the information for EAS relocation from
the source V-SMF.
2\. The procedure is performed as described in step 2 of clause 6.2.3.3 of TS
23.548 [3], with the following differences:
\- In the case of V-PSA insertion/change, the (target) V-SMF determines the
impact field based on the new target DNAI.
According to the roaming offload policy and new target DNAI, the V-SMF may
select a new V-EASDF and configures DNS message handling rules to (new)
V-EASDF. The (new) V-EASDF handles all DNS queries based on the DNS message
handling rules as described in clause 6.5.2.1.
3\. The V-SMF sends PDU Session Modification Command (EAS rediscovery
indication, [impact field]) to UE.
### 6.5.3 Impacts on services, entities and interfaces
V-SMF:
\- receives the roaming offload policy included in PCC rule from H-PCF via
H-SMF;
\- generates the DNS message handling rules according to the roaming offload
policy and the EAS Deployment Information;
\- generates traffic routing rule and Usage Report Rule according to EAS
information and roaming offload policy;
\- sends usage information (and charging information, if it is generated by
V-SMF) to H-SMF;
\- interacts with V-EASDF using the interface defined between SMF and EASDF in
TS 23.548 [3], including configuring DNS message handling rules to EASDF
according to the roaming offload policy;
\- receives the information for EAS relocation from source V-SMF/H-SMF.
V-PCF:
\- creates PCC rule that includes roaming offload policy.
H-SMF:
\- sends the roaming offload policy to V-SMF;
\- sends the information for EAS relocation to V-SMF;
\- receives usage information (and charging information, if it is generated by
V-SMF) from V-SMF.
## 6.6 Solution 06 (KI#1): URSP solution to support roamers access to EHE in a
VPLMN
### 6.6.1 Description
UE not served by their home network should where possible (when allowed by
their home network) benefit from traffic offload and Edge Computing
capabilities deployed by their serving network.
A solution is to leverage clause 6.6 of TS 23.548 [3] \"Support of AF Guidance
to PCF Determination of Proper URSP Rules\" and clause 4.15.6.10 of TS 23.502
[9] \"Application guidance for URSP rules determination mechanisms\" as
defined for Rel-17. This is to guide UE for traffic to be offloaded in the
VPLMN to use a specific DNN and slice deployed in LBO mode while the rest of
he traffic can use HR PDU Session(s).
An AF belonging to the VLMN reaching the NEF of the HPLMN (a roaming partner)
indicates the (VPLMN) DNN and slices related with traffic offload / EC that it
supports (according to clause 6.6 of TS 23.548 [3] and clause 4.15.6.10 of TS
23.502 [9]) this indication can be leveraged by the PCF of the HPLMN to (if
authorized by HPLMN policies) provide dedicated URSP rules applicable to
relevant users of the HPLMN when they are roaming in that VPLMN. These URSP
may have a validity condition corresponding to the VPLMN location but should
refer to S-NSSAI(s) defined by the HPLMN.
NOTE 1: The interaction from AF in VPLMN to the NEF in HPLMN does not involve
the SEPP.
This interaction between the AF belonging to the VPLMN and the HPLMN NEF is
not related to a specific UE, but is meant to cover all UEs matching the VPLMN
related location criteria.
The AF belonging to the VPLMN provides HPLMN S-NSSAI(s) (that are determined
from the VPLMN S-NSSAI(s)).
NOTE 2: As the VPLMN has the translation between HPLMN S-NSSAI(s) and the
VPLMN S-NSSAI(s), translation is needed in the VPLMN to serve the HPLMN users.
The H-PCF may, based on local policies, determine whether to always send the
URSP rules immediately to the UE or to send these rules only when the UE is
served by the corresponding serving PLMN, e.g. waiting to be triggered from a
V-PCF of that PLMN in step 3 of clause 4.6.11 of TS 23.502 [9].
The PCF of the HPLMN when it sends such URSP update to a UE, needs, as for
Rel-17, to ensure that the DNN, S-NSSAI provided in the URSP rules sent to the
UE is allowed in LBO mode in the user subscription (in UDM/UDR) even when the
UE is roaming in that VPLMN.
NOTE 3: This solution can also apply for UEPO (see TR 23.700-85 [10]).
The VPLMN may provide Geographical or VPLMN location (e.g. VPLMN TAI or cells)
related validity conditions for the URSP to apply. When the AF belonging to
the VPLMN provides the HPLMN with VPLMN validity conditions, the VPLMN
location information (e.g. VPLMN TAI or cells) contains a VPLMN ID that may be
used by the H-PCF to understand that this information is specific for a VPLMN.
Depending on H-PCF policies (on when to deliver URSP(s) valid in remote
PLMN(s)) and on the situation (e.g. UE arriving rapidly in a new PLMN when for
example the user arrives by plane in a remote country), it may take some time
before URSP rules take effect in UE: it may happen that the UE gets URSP(s)
applicable to the VPLMN while HR PDU Sessions have already been established.
As defined in TS 23.503 [13], \"For every newly detected application the UE
evaluates the URSP rules in the order of Rule Precedence and determines if the
application is matching the Traffic descriptor of any URSP rule.\" Thus, it
may happen that some traffic has started using HR PDU Sessions, but as soon as
new application interactions start, corresponding traffic will gradually be
moved to LBO PDU Sessions in the serving PLMN while already started IP flows
may go on using the H-UPF.
It can happen that traffic that used to be served by a unique PDU Session
while the UE was served by its HPLMN becomes served by 2 PDU Sessions when the
UE roams in a VPLMN for which URSP guides it to use a LBO PDU Session for an
application while it should use the initial PDU Session in HR mode for the
rest of the traffic.
NOTE 4: This can happen regardless of Edge Computing.
NOTE 5: Before concluding this solution for normative work, alignment check
with FS_eUEPO shall be done in order to avoid any conflict with the conclusion
of KI#1 in TR 23.700-85 [10]. Final decision on generic URSP enhancement for
supporting LBO roaming case should be made within FS_eUEPO study.
### 6.6.2 Procedures
The solution reuses existing procedures.
### 6.6.3 Impacts on Existing Nodes and Functionality
\- The VPLMN and the HPLMN as part of the roaming agreement need to ensure
that an AF belonging to the VPLMN can contact the NEF of the HPLMN to use the
API defined in clause 4.15.6.10 of TS 23.502 [9].
\- Potential UDM impact to ensure that the DNN, S-NSSAI provided in the URSP
rules sent to the UE is allowed in LBO mode in the user subscription (in
UDM/UDR) even when the UE is roaming in that VPLMN.
## 6.7 Solution 07 (KI#1): Using URSP Rules to Establish an LBO PDU Session
### 6.7.1 Description
#### 6.7.1.1 General
This solution addresses that part of Key Issue #1 that considers how to
establish the LBO PDU Session towards the correct S-NSSAI/DNN pair in order to
access an EHE in the VPLMN.
The principles of this solution are:
\- In Rel-17, a URSP rule can already be configured with Location Criteria
that indicates to the UE that the route (i.e. PDU Session) should only be
established, or used, when the UE served by certain cell(s), RAN node(s), or
TAIs. This feature can be used to cause the UE to select a DNN/S-NSSAI
combination that is appropriate for the PLMN where the UE is registered (e.g.
an LBO Session). Location criteria is defined in TS 24.526 [11] and may be a
list of cell(s), RAN node(s), or TAI(s). This solution proposes that Location
Criteria can also include PLMN ID(s).
NOTE: Whether a PLMN ID can be encoded as part of Location Criteria or encoded
as a new validation criteria information element is left to stage 3.
\- When a route includes Location Criteria, a \"Revaluation Suggested\"
indication can be added to the RSD. A \"Revaluation Suggested\" indication in
the RSD indicates to the UE that the UE should re-evaluate URSP rules for
traffic that uses the PDU Session if the Location Criteria becomes invalid and
release the PDU Session no traffic is using the PDU Session after re-
evaluation. In other words, the PDU Session may be released when the UE leaves
the PLMN, cell(s), RAN node(s), or TAI(s) where the location criteria is valid
and all traffic is moved to a different PDU Session (e.g. an LBO PDU Session).
\- Triggering re-evaluation will cause the UE to select a new route. The new
route may include location criteria for the UE\'s new location and a PDU
Session will be established with a DNN/S-NSSAI combination that is better
suited for the UE\'s new location (e.g. for the PLMN where the UE is now
registered).
NOTE: It is a UE implementation decision when to re-evaluate URSP rules. The
indication is used to by the UE to help determine if it should re-evaluate.
#### 6.7.1.2 Procedure
The UE receives URSP rules. Some URSP rules may have Traffic Descriptors that
are associated with edge services. The RSDs of these URSP rules may include
Location Criteria. By including Location Criteria, the URSP rule can be
configured such that the UE will select a DNN/S-NSSAI combination for PDU
Session Establishment based on the UE\'s cell, RAN Node, TAI or PLMN ID. Thus,
the UE will use a DNN/S-NSSAI combination based on the PLMN that the UE is
registered with. For example, the route will only be considered valid if the
PLMN ID in the Location Criteria matches the PLMN ID of the PLMN where the UE
is currently registered or if the PLMN ID in the Location Criteria is an
equivalent PLMN of the PLMN where the UE is currently registered.
Existing Rel-17 behaviour is that when the UE leaves the cell, RAN Node, or
tracking area, the UE will continue to use the PDU Session until URSP Rules
are re-evaluated. However, the UE is not required to re-evaluate URSP rules
for the traffic.
This solution proposes that the RSD(s) also include a \"Revaluation
Suggested\" indication. When a change of cell, RAN node, TAI, or PLMN occurs,
the existing PDU Session will be released if no longer needed and the UE will
re-evaluate URSP rules. URSP re-evaluation will cause the UE to choose a new
RSD for the traffic. The location criteria in the new RSD will cause the UE to
select a DNN/S-NSSAI that is associated with the PLMN where the UE is
currently registered.
NOTE: Before concluding this solution for normative work, alignment check with
FS_eUEPO shall be done in order to avoid any conflict with the conclusion of
KI#1 in TR 23.700-85 [10]. Final decision on generic URSP enhancement for
supporting LBO roaming case should be made within FS_eUEPO study.
### 6.7.2 Impacts on services, entities and interfaces
PCF:
\- can include the \"Revaluation Suggested\" indication in RSDs or URSPs;
\- can include PLMN ID(s) in location criteria.
UE:
\- can receive the \"Revaluation Suggested\" indication in RSDs or URSPs;
\- can use the \"Revaluation Suggested\" indication to decide when to trigger
URSP re-evaluation;
\- can receive PLMN ID(s) in location criteria.
## 6.8 Solution 08 (KI#1): V-ECS Discovery during Steering of Roaming
### 6.8.1 Description
#### 6.8.1.1 General
This solution addresses that part of Key Issue #1 that considers how to how to
configure the VPLMN ECS address to UE in roaming scenarios.
The principle of this solution is that the Steering of Roaming framework that
is specified in TS 23.122 [12] can be extended to provide information to the
UE so that the EEC can communicate with an ECS in VPLMN (i.e. a V-ECS). This
solution explains how the SoR transparent container can be used to provide
information to the UE that can be used to establish an LBO PDU Session that is
used to reach a V-ECS.
NOTE: CT1 has stage 2 and stage 3 responsibility for the Steering of Roaming
feature. If this solution is selected for normative work, coordination with
CT1 would be required.
#### 6.8.1.2 Procedure
As one option, the SoR transparent container can be used to provide an FQDN or
an IP Address of a V-ECS to the UE. When the UE accesses the provided FQDN or
IP Address, URSP rules may steer the UE to use a DNN/S-NSSAI combination that
can be used to reach the ECS (e.g. an LBO Session).
As a second option, the SoR transparent container can be used to provide a
DNN/S-NSSAI combination to the EEC. In this case, the DNN/S-NSSAI combination
may be used to send a PDU Session Establishment Request in the VPLMN that will
result in an LBO PDU Session. The SMF in the VPLMN may then send ECS Address
Configuration Information to the UE as described in TS 23.548 [3]. The EEC may
then use the ECS FQDN or IP Address from the ECS Address Configuration
Information.
Figure 6.8.1.2-1 procedure illustrates a procedure for this solution.
Figure 6.8.1.2-1: V-ECS Discovery during Steering of Roaming
1\. The UE receives the SoR Transparent Container. The SoR Transparent
Container may include a new information element called ECS Discovery
Information. The ECS Discovery Information may include ECS Contact Information
(O), ECS Provider ID (O), DNN (O), and S-NSSAI (O). The network may have been
pre-provisioned with the ECS Discovery information (e.g. via OAM) and what ECS
Discovery information is sent to the UE may be based on roaming agreement
(e.g. the roaming agreement may allow the HPLMN to point the UE to an ECS in
the EHE of the VPLMN).
2\. As described in TS 23.122 [12], the reception of the SoR Transparent
Container triggers the UE to perform PLMN Selection.
3\. The UE registers with a PLMN that was provided in the SoR Transparent
Container.
4\. The UE establishes an LBO PDU Session that will be used to communicate
with the V-ECS and/or to obtain ECS Contact Information from the VPLMN.
Option A: The ECS Discovery Information from step 1 may have included only ECS
Contact Information (i.e. an FQDN of an ECS in the VPLMN). In this case, URSP
rules may steer the UE to use a DNN/S-NSSAI combination that can be used to
reach the ECS (e.g. an LBO Session).
Option B: The ECS Discovery Information from step 1 may have included only a
DNN / S-NSSAI combination. In this case, the combination may be used to send a
PDU Session Establishment Request that will result in an LBO session. The SMF
in the VPLMN may then send ECS Address Configuration Information to the UE as
described in TS 23.548 [3].
5\. The EEC sends a Service Provisioning Request to an ECS in the visited
network. The ECS address was obtained in step 1 or step 4.
6\. The EEC receives a Service Provisioning Response.
### 6.8.2 Impacts on services, entities and interfaces
SoR-AF:
\- can provide ECS Discovery Information.
UE:
\- can receive the ECS Discovery Information in the SoR Transparent Container.
## 6.9 Solution 09 (KI#1): PDU Session configuration from EASDF
### 6.9.1 Description
This solution addresses KI#1: Accessing EHE in a VPLMN when roaming.
In this solution, the UE uses a predefined FQDN to the EASDF that is shared
between operators. For example, GSMA could host the root entry for this Global
EASDF. This solution is based on that the Global EASDF supports either
configuration for a local EASDF or configuration for the UE to set up a new
PDU Session.
For a specific VPLMN, if the HPLMN requires the UE to use a new (LBO) PDU
Session to access the V-PLMN\'s EHE, then the HPLMN will configure the Global
EASDF with configuration for the UE to use to set up a new PDU Session. When
the UE initiates the new PDU Session, then the UE will receive all needed
configuration from the V-SMF for EAS discovery in the V-PLMN\'s network. If
the HPLMN instead uses HR PDU Session, then it will configure the Global EASDF
with the IP address of the EASDF in the V-PLMNs network. The UE will then use
that one to discover EAS(s) in the V-PLMN. This allows the V-PLMN to utilize
local traffic routing to the V-PLMNs EHE according to the agreement between
them.
The Global EASDF acts as a DNS server to provide the UE with either the IP
address of the EASDF that the UE should use in the V-PLMN or the S-NSSAI/DNN
combination that the UE will use to set up a PDU Session.
This solution does not utilize URSP rules for the UE to retrieve and set up
new PDU Session.
### 6.9.2 Procedures
#### 6.9.2.1 PDU Session configuration from EASDF
Figure 6.9.2-1: PDU Session configuration from EASDF
0\. Pre-requisites: The UE has a Home Routed PDU Session and the HPLMN has
configured the Global EASDF with appropriate configuration for supported
Visitors EHE(s).
1\. The UE performs a DNS query to the Global EASDF. Since this is a public
FQDN to the Global EASDF, the UE may use any locally configured DNS Server
that in turn will use next DNS server in the DNS hierarchy until it goes to
the Global EASDF.
2\. The Global EASDF responds with either the configuration the UE needs to
set up a PDU Session in the V-PLMN or the IP address of the local EASDF.
If the V-PLMN uses existing PDU Session (HR PDU Session with local traffic
routing) then the Global EASDF is configured with the V-PLMN\'s EASDF. If the
operators require a new LBO PDU Session, then the Global EASDF is only
configured with the configuration the UE needs to set up the new PDU Session.
NOTE: When the HR PDU Session with local traffic routing is used, the V-EASDF
sent to the UE via DNS response applies to the DNS query being handled. The
subsequent DNS queries are sent to the Global EASDF for further handling,
which may repeat step 2.
3\. If PDU Session configuration was received, then the UE initiates a PDU
Session Establishment procedure with the configuration received in previous
step. The V-SMF initiates and configures the EASDF selection and related DNS
handling rules when the UE initiates the PDU Session Establishment procedure
to the V-PLMN. The SMF may indicate to the UE the EASDF that the UE shall use
for this PDU Session according to steps 1 and 2 in clause 6.2.3.2.2 of TS
23.548 [3].
4\. The UE performs EAS Discovery, same as step 7 in clause 6.2.3.2.2 of TS
23.548 [3]. If the UE received an EASDF address during step 2 above, then the
UE uses that address instead of the one provided by the PDU Session
establishment.
5\. EASDF sends the DNS Response(s) to the UE, same as step 19 in clause
6.2.3.2.2 of TS 23.548 [3].
6\. The UE application starts to utilize the provided EAS.
#### 6.9.2.2 DNS structure
The DNS structure uses the following format:
easdf.cmnc\.cmcc\.mnc\.mcc\.\
The \ is replaced by the UE with the Mobile Network Code from the
subscription.
The \ is replaced by the UE with the Mobile Country Code from the
subscription.
The \ is replaced by the UE with the (Current) Mobile Network Code the
UE is roaming into.
The \ is replaced by the UE with the (Current) Mobile Country Code the
UE is roaming into.
The MNC/MCC pair represents the H-PLMN
The CMNC/CMCC pair represents the V-PLMN
With this structure, each H-PLMN decides and manages what configuration should
be included for each roaming partner since all configuration for each V-PLMN
is encoded as sub-domain for the H-PLMN.
The following DNS record types is used:
CNAME OR A Record:
This type is used by the operator to configure which local EASDF the UE should
use when the H-PLMN utilises HR PDU Session with local traffic routing in that
specific V-PLMN.
SRV Record:
This type should be used by the operator to configure the UE with the PDU
Session configuration to set up a local PDU Session that terminates in V-PLMN.
The following syntax is used for the SRV record:
\"_dnn._tcp.\.\"
The \ is replaced with any domain name that the
operator owns. The SRV Record target syntax is \.\.
The SD (Slice Differentiator) should always be included and according to
clause 28.4.2 of TS 23.003 [16] a reserved value is defined (\"FFFFFF\") when
no SD is defined. The SST shall be set as port number.
### 6.9.3 Impacts on services, entities and interfaces
UE:
\- configured with the FQDN of the Global EASDF;
\- needs to receive PDU Session configuration in an SRV record and use
information from the record to establish a PDU Session;
\- when existing PDU Session should be used, then the UE uses the IP Address
from the Global EASDF instead of the one provided in the ePCO from the PDU
Session establishment procedure for the EASDF.
Global EASDF:
\- acts as a DNS Server and responds to the DNS Queries from the UE. The DNS
is configured with standard DNS SRV records that contains PDU Session
configuration.
## 6.10 Solution 10 (KI#1): LBO PDU Session establishment using PLMN criteria
in RSD
### 6.10.1 Description
This solution corresponds to KI#1, and addresses the scenario which UE
accessing EHE in VPLMN using LBO PDU Session.
For better illustration, it is assumed that Service 1 is deployed in both
HPLMN and EHE in VPLMN, and Service 2 is deployed only in HPLMN (or deployed
in EHE in VPLMN, but the UE is not allowed to access to EHE in VPLMN for
Service 2).
When UE accesses to VPLMN, UE may access to EHE in VPLMN via a LBO PDU
Session, and access to HPLMN via a HR PDU Session. That means URSP rules with
different RSDs shall be used for Service 1 accessing to EHE in VPLMN and
Service 2 accessing to HPLMN.
When UE access to HPLMN, it is unnecessary to access to Service 1 and Service
2 via different PDU Sessions. That means URSP rules with same RSD shall be
used for Service 1 and Service 2.
Adding Route Selection Validation Criteria related to PLMN(s) is a way to meet
both requirements on S-NSSAI/DNN pair mentioned above. Table 6.10.1-1
illustrates the enhanced RSD, and Table 6.10.1-2 gives an example of the
enhanced RSD for Service 1.
Table 6.10.1-1: Route Selection Descriptor with PLMN criteria
+-------------+-------------+-------------+-------------+-------------+ | Information | Description | Category | PCF | Scope | | name | | | permitted | | | | | | to modify | | | | | | in URSP | | +=============+=============+=============+=============+=============+ | Route | Determines | Mandatory\ | Yes | UE context | | Selection | the order | (NOTE 1) | | | | Descriptor | in which | | | | | Precedence | the Route | | | | | | Selection | | | | | | Descriptors | | | | | | are to be | | | | | | applied. | | | | +-------------+-------------+-------------+-------------+-------------+ | **Route | *This part | Mandatory\ | | | | selection | defines the | (NOTE 2) | | | | c | route | | | | | omponents** | selection | | | | | | components _| | | | +-------------+-------------+-------------+-------------+-------------+ | Network | Either a | Optional | Yes | UE context | | Slice | single | | | | | Selection | value or a | (NOTE 3) | | | | | list of | | | | | | values of | | | | | | S-NSSAI(s). | | | | +-------------+-------------+-------------+-------------+-------------+ | DNN | Either a | Optional | Yes | UE context | | Selection | single | | | | | | value or a | | | | | | list of | | | | | | values of | | | | | | DNN(s). | | | | +-------------+-------------+-------------+-------------+-------------+ |__Route |_ This part | Optional | | | | Selection | defines the | | | | | Validation | Route | | | | | Criteria**| Validation | | | | | | Criteria | | | | | (NOTE 6) | components* | | | | +-------------+-------------+-------------+-------------+-------------+ | Time Window | The time | Optional | Yes | UE context | | | window when | | | | | | the | | | | | | matching | | | | | | traffic is | | | | | | allowed. | | | | | | The RSD is | | | | | | not | | | | | | considered | | | | | | to be valid | | | | | | if the | | | | | | current | | | | | | time is not | | | | | | in the time | | | | | | window. | | | | +-------------+-------------+-------------+-------------+-------------+ | Location | The UE | Optional | Yes | UE context | | Criteria | location | | | | | | where the | | | | | | matching | | | | | | traffic is | | | | | | allowed. | | | | | | The RSD | | | | | | rule is not | | | | | | considered | | | | | | to be valid | | | | | | if the UE | | | | | | location | | | | | | does not | | | | | | match the | | | | | | location | | | | | | criteria. | | | | +-------------+-------------+-------------+-------------+-------------+ |** PLMN | **The | * |** Yes**|** UE | | Criteria | PLMN(s) | _Optional_ _| | context_ _| | (new)__| where the | | | | | | matching |__(NOTE | | | | | traffic is | 1)__| | | | | allowed. | | | | | | The RSD is | | | | | | not | | | | | | considered | | | | | | to be valid | | | | | | if the | | | | | | serving | | | | | | PLMN does | | | | | | not match | | | | | | the PLMN | | | | | | criteria.__| | | | +-------------+-------------+-------------+-------------+-------------+ |__NOTE 1: | | | | | | If PLMN | | | | | | Criteria is | | | | | | not | | | | | | included in | | | | | | a RSD, the | | | | | | RSD shall | | | | | | be | | | | | | considered | | | | | | as valid in | | | | | | all | | | | | | PLMNs._ * | | | | | +-------------+-------------+-------------+-------------+-------------+
Table 6.10.1-2: An example of RSDs with PLMN criteria
              Information name     Content
* * *
              Traffic Descriptor   Service 1                 
                                   Network Slice Selection   S-NSSAI 1
URSP rule RSD 1 DNN Selection DNN 1 **PLMN Criteria** **HPLMN** Network Slice
Selection S-NSSAI 1 RSD 2 DNN Selection DNN 2 **PLMN Criteria** **VPLMN 1,
VPLMN 2, etc.**
NOTE: Before concluding this solution for normative work, alignment check with
FS_eUEPO shall be done in order to avoid any conflict with the conclusion of
KI#1 in TR 23.700-85 [10]. Final decision on generic URSP enhancement for
supporting LBO roaming case should be made within FS_eUEPO study.
### 6.10.2 Procedure
The provision of the enhanced URSP with PLMN criteria re-uses the procedure in
current specification TS 23.502 [9], or UE may be pre-configured the URSP. In
order to determine PLMN criteria, H-PCF shall get the information related to
PLMN(s) which the service deployed. The information can be either pre-
configured in H-PCF or provisioned by AF. When UE triggers PDU Session
selection or PDU Session establishment based on URSP, the UE takes the serving
PLMN into consideration.
### 6.10.3 Impacts on services, entities and interfaces
PCF:
\- controls the UE to use different DNN+S-NSSAI in different PLMN by including
PLMN Criteria in URSP RSDs.
UE:
\- shall consider the serving PLMN when it determines whether to re-use or
establish PDU Session, if PLMN Criteria is included in the selected Route
Selection Descriptor.
## 6.11 Solution 11 (KI#2): Exposure of Network Congestion
### 6.11.0 General
This solution corresponds to KI#2 on Fast and efficient network exposure
improvements.
Based on the use cases and scenarios in clause 5.2.2, the following network
congestion information needs to be exposed to AF via local UPF/NEF:
\- QoS Notification Control. For GBR QoS Flow, RAN exposes \"GFBR can no
longer be guaranteed\" (or \"GFBR can be guaranteed\"), as well as the
reference to the matching Alternative QoS Profile to AF via local UPF/NEF.
\- Network Congestion indication. For non-GBR QoS Flow, RAN exposes network
congestion indication that indicates network congestion occurrence or recovery
to AF via local UPF/NEF.
\- Network Congestion Level. This indicates the degree of RAN congestion. RAN
exposes network congestion level to AF via local UPF/NEF.
NOTE 1: How to determine the network congestion level of a RAN node is up to
RAN implementation.
NOTE 2: This solution targets services with user plane packet transmission.
### 6.11.1 Procedure
Figure 6.11.1-1 shows the call flow for exposing network congestion
information to AF via local UPF/NEF.
Figure 6.11.1-1: Network Congestion Information Exposure to AF via local
UPF/NEF
The procedure is based on the Network exposure to Edge Application Server
procedure in clause 6.4.2.1 of TS 23.548 [3].
0\. The UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS
23.502 [9]. A local PSA UPF is selected for this PDU Session.
1\. AF initiates setting up an AF session with required QoS procedure as
defined in clause 6.4.2.1 of TS 23.548 [3].
The AF may subscribe to direct notification of network congestion for the
service data flow to PCF.
The AF may also send a report updating threshold to the PCF. When the
difference between latest and previous reported network congestion information
exceeds the report updating threshold, the local PSA exposes the latest
network congestion information to the AF.
If QoS notification control trigger is provisioned and the Alternative QoS
parameter set(s) are authorized within the PCC rule, the PCF shall include the
reference to the Alternative QoS requirement within each corresponding
Alternative QoS parameter set.
NOTE 1: The need for this optional Report updating threshold to the PSA UPF is
to be decided during conclusion phase.
2\. The PCF makes policy information based on the AF request and/or local
configuration and initiates PDU Session Modification procedure as described in
clause 4.3.3.2 of TS 23.502 [9], steps 1b, 3b, 4-8b. The PCF sends policy
information to SMF. The policy information may include a report updating
threshold which is received from AF or determined by the PCF.
If the SMF receives the indication of direct notification of network
congestion, the SMF invokes Namf_Communication_N1N2MessageTransfer service of
AMF, and AMF sends N2 PDU Session Request to RAN to indicate the RAN to expose
network congestion information via local UPF. Based on local configuration,
the SMF can further determine whether to enable direct notification of network
congestion for this QoS Flow to NG-RAN. The SMF provisions the target local
NEF or local AF address to the local PSA included in the PCC rule.
If QoS notification control trigger is provisioned and the Alternative QoS
parameter set(s) are authorized within the PCC rule, the SMF shall also
provision the mapping between the reference to the Alternative QoS Profile and
the reference to the Alternative QoS requirement to the local PSA.
NOTE 2: With this enhancement, the PCF can be configured to only enable the
Notification control over User Plane for the QoS Flow subject to edge
computing.
The SMF sends network congestion detection indication to UPF to enable network
congestion notification detection. A report updating threshold may be informed
to the UPF.
The N2 SM information also includes measure frequency, report threshold.
If there is no corresponding UL service data flow template for the service
data flow, e.g. the service data flow has different QoS requirements for
uplink and downlink, the SMF also indicates a different QoS Flow with
corresponding UL service data flow template to the RAN for the reporting. The
RAN exposes network congestion information via UL packets corresponding to the
indicated QoS Flow.
3\. Based on local configuration and step 2, the RAN determines network
congestion information when network congestion occurs. The network congestion
information can be any information listed in clause 6.11.0.
4\. In case the reporting condition is met, the RAN sends the network
congestion information to the local PSA via the GTP-U header of corresponding
UL packet.
If the RAN is requested to report the network congestion information via a
different QoS flow, the RAN sends the network congestion information via UL
packets corresponding to the QoS Flow indicated by the SMF.
If no UL packet can be used when report is needed, RAN generates a dummy UL
packet for the report.
As described in clause 6.11.0, the network congestion information includes QoS
Notification Control information (for GBR QoS Flow) and network congestion
level/indication (for non-GBR QoS Flow).
NOTE 3: In order to avoid a too frequent report to the Local PSA, it is
assumed that NG-RAN implementation can apply hysteresis (e.g. via a
configurable update condition) before notifying a changed network congestion
information to the local PSA.
NOTE 4: RAN can repeat the network congestion information to the local PSA
multiple times to avoid loss of the report.
5\. The local PSA exposes/updates the network congestion information to AF as
described in step 4 of Figure 6.4.2.1-1 of TS 23.548 [3].
If a report updating threshold is informed by the SMF in step 2, local PSA
updates the latest network congestion information to the AF when the
difference between latest and previous reported network congestion information
exceeds the report updating threshold.
The local PSA sends the notification to the target local NEF or local AF
address corresponding to the QoS flow. If the reference to the Alternative QoS
Profile is also received within the notification, the local PSA shall also
include the reference to the Alternative QoS requirement corresponding to the
reference in the notification sent to the target local NEF or local AF
address.
NOTE 5: The AF logic after receiving the network congestion information is not
in the scope of this study.
### 6.11.2 Impacts on services, entities and interfaces
AF:
\- subscribes direct notification of network congestion information from 5GC.
PCF:
\- includes the reference to the Alternative QoS requirement within each
corresponding Alternative QoS parameter set.
SMF:
\- indicates RAN to expose network congestion information via local UPF;
\- indicates a UL QoS Flow for RAN to be used to expose network congestion
information when there is no UL QoS Flow of the service data flow;
\- provisions the associated target local NEF or local AF address for this
network congestion information reporting;
\- provisions the mapping between the reference to the Alternative QoS Profile
and the reference to the Alternative QoS requirement to the local UPF.
UPF:
\- receives the mapping between the reference to the Alternative QoS Profile
and the reference to the Alternative QoS requirement;
\- exposes the reference to the Alternative QoS requirement to local NEF/AF.
RAN:
\- supports exposing network congestion information via local UPF.
## 6.12 Solution 12 (KI#2): Efficient exposure of RAN information
### 6.12.1 Key Issue mapping
The solution applies to KI#2: Fast and efficient network exposure
improvements.
### 6.12.2 Description
In general, the application server support monitoring the data rate of the
link between the client and server. The application server uses the monitored
result to adjust service data throughput and the handling within the server.
There are many factors impacting on the data rate of the link, e.g. the
congestion of the transport network. The 5GS link is partial segment of the
link between the client and server. Reporting network resource congestion of
the 5GS can help the application server to estimate the bottle neck is in 5GS
or other part between the server and the client, when the link data rate
decreases outstandingly.
Hence, it is proposed to expose the network congestion of the 5GS to the
application server.
In general, the bottleneck of the network congestion is the RAN congestion
since the time-frequency resource is limited. However, the RAN does not
support service-based interface and it is not efficient to expose RAN\'s
congestion from RAN to AF via AMF-SMF-PCF-NEF.
In order to support efficient exposure of RAN\'s congestion, it is proposed to
considered to expose RAN\'s congestion via user plane, as shown in figure
6.12.2-1.
Figure 6.12.2-1: exposure RAN\'s congestion
The solution is based on the existing Network Exposure functionality with the
following enhancement:
\- The AF subscribes the network congestion with a UE address.
\- The PCF generates a PCC rule for RAN to report RAN\'s congestion.
\- The SMF generates a QoS flow\'s QoS profile for RAN report.
\- The RAN reports RAN Congestion Start, RAN Congestion End, RAN\'s congestion
level from the UL data in the QoS flow for RAN report.
\- The UPF detects the RAN Congestion Start, RAN Congestion End, RAN\'s
congestion level from the UL data in the QoS flow for RAN report.
### 6.12.3 Procedures
#### 6.12.3.1 Subscribing information
Figure 6.12.3.1-1: Subscribing Normal Data Transmission Interruption event and
Date Rate
1\. The AF subscribes the Network Congestion (e.g. RAN congestion) by sending
Nnef_EventExposure_Subscribe request (UE address, event ID(s)).
2\. The NEF authorizes the AF request.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Subscribe request to the Network Congestion (e.g. RAN
congestion).
4\. Upon reception of the subscribe request of Network Congestion for a UE
address, the PCF generates a QoS rule for RAN to report RAN\'s congestion. The
PCC rule includes an indication that the PCC rule is used for RAN report
information.
The PCF also generates a QoS monitoring policy for network congestion
measurement.
5\. The PCF responds to the NEF a Npcf_Policy Authorization_Create response.
6\. The NEF sends a Nnef_AFsessionWithQoS_Create response message to the AF.
7\. The PCF initiates SM Policy Association Modification Request (PCC rule) to
the SMF.
The SMF maps a QoS flow for the PCC rule from the PCF. The QoS flow\'s QoS
profile includes the indication that the QoS flow is used for RAN report
information.
The SMF generates the QoS Monitoring configuration for UPF: RAN congestion
detection indication.
The SMF generates the QoS Monitoring configuration for RAN: RAN congestion
measurement indication, measure frequency, report threshold.
8\. The SMF replies SM Policy Association Modification Response to the PCF.
9\. The SMF initiates N4 Session Modification Request (QoS Monitoring
configuration, QoS rule) to the UPF.
Upon reception of QoS Monitoring configuration, the UPF enables the RAN\'s
congestion detection and report.
10\. The UPF(s) respond to the SMF.
11\. For SMF requested modification, the SMF invokes
Namf_Communication_N1N2MessageTransfer ([N2 SM information] (PDU Session ID,
QFI(s), QoS Profile(s), QoS Monitoring configuration), N1 SM container)).
12\. The AMF may send N2 ([N2 SM information received from SMF], NAS message
(PDU Session ID, N1 SM container (PDU Session Modification Command))) Message
to the (R)AN.
Upon reception of QoS flow\'s QoS profile and the indication that the QoS flow
is used for RAN report information, the RAN skips to map DRB for the QoS flow
and makes the QoS flow terminated between the RAN and the UPF.
Upon reception of QoS Monitoring configuration, the RAN enables the RAN
congestion measurement and report.
14\. The (R)AN may acknowledge N2 PDU Session Request by sending a N2 PDU
Session Ack Message to the AMF.
15-16. The AMF forwards the N2 SM information and the User location
Information received from the AN to the SMF via
Nsmf_PDUSession_UpdateSMContext service operation. The SMF replies with a
Nsmf_PDUSession_UpdateSMContext Response.
17-18. The SMF may update N4 session of the UPF(s) that are involved by the
PDU Session Modification by sending N4 Session Modification Request message to
the UPF.
#### 6.12.3.2 Information report
Figure 6.12.3.2-1: Normal Data Transmission Interruption event and measured
Date Rate
1&2\. When the RAN congestion starts or congestion level reaches the report
threshold, the NG-RAN indicates the RAN Congestion Start and RAN congestion
level in the GTP-U header of the UL data.
3\. Upon detection of the RAN Congestion Start and RAN congestion level from
the UL data, the UPF triggers the Nupf_EventExposure_Notify message to report
the RAN Congestion Start and RAN congestion level.
4\. The NEF sends a Nnef_Nnef_EventExposure_Notify (RAN Congestion Start and
RAN congestion level) message to the AF.
5&6\. When the RAN congestion ends, the NG-RAN indicates the RAN Congestion
End in the GTP-U header of the UL data.
7\. Upon detection of the RAN Congestion End from the UL data, the UPF
triggers the Nupf_EventExposure_Notify message to report the RAN Congestion
End.
8\. The NEF sends a Nnef_Nnef_EventExposure_Notify (RAN Congestion End) to the
AF.
### 6.12.4 Impacts on services, entities and interfaces
AF:
\- subscribes network congestion information from 5GC.
PCF:
\- generates a PCC rule for RAN to report RAN\'s congestion. The PCC rule
includes an indication that the QoS rule is used for RAN report information;
\- generates a QoS monitoring policy for RAN congestion information
measurement.
SMF:
\- indicates RAN to expose RAN congestion information via UPF;
\- sets up a QoS flow between the RAN and UPF for RAN to report RAN congestion
information.
RAN:
\- sets up a QoS flow between the RAN and UPF for RAN to report RAN congestion
information;
\- detects and reports RAN congestion information to UPF.
UPF:
\- detects and exposes RAN congestion information to AF/NEF.
## 6.13 Solution 13 (KI#2): Fast and efficient network exposure improvements
### 6.13.1 Introduction
This solution addresses the KI#2: Fast and efficient network exposure
improvements. This solution reuses mechanism defined to establish QoS
Monitoring as specified in clause 5.33.3 of TS 23.501 [2], clause 4.3.3 of TS
23.502 [9] and support of network exposure with low latency to local AF as
specified in clause 6.4.2 of TS 23.548 [3].
The solution is based on following principles:
\- The local AF subscribes the low latency exposure of cell ID, etc. from the
PCF via a local NEF.
\- NG-RAN provides information such as cell ID(s) as requested by the SMF.
\- UPF exposes received information as defined in clause 5.2.26 of TS 23.502
[9] and further enhanced in FS_UPEAS to local NEF/AF.
\- The local AF may use received information about the cell(s) currently
serving a UE to retrieve current and predicted UE and cell radio conditions
from RAN. Such information may be used by local AF and applications, for
instance, to trigger video codec rate adaption and prevent user experience
degradation.
### 6.13.2 Functional Description
This solution addresses KI#2 and the following principles are used:
1\. The local AF subscribes using Nnef_AFSessionWithQoS /
Npcf_PolicyAuthorization_Subscribe service the low latency exposure of cell
ID(s), etc. from the PCF via a local NEF as defined in clause 6.4.2.1 of TS
23.548 [3]. The local AF may also subscribe direct event notification from the
UPF to the local AF as defined in clause 6.4.2.1 of TS 23.548 [3].
2\. PCF sends this subscription to SMF as defined in clause 6.4.2.1 of TS
23.548 [3], together with requested information.
3\. The SMF configures NG-RAN via AMF, and the UPF over N4 for the UPF, with
the requested to notify AF.
4\. NG-RAN node sends the requested information e.g. cell ID(s) in NG-RAN UL
(Uplink) over GTP-u to UPF. Requested information may be sent, e.g. using UL
PDU Session Information as defined in TS 38.415 [14] for QoS Monitoring
information.
NOTE: AF may use e.g. Cell ID to obtain additional information e.g. using APIs
defined by ETSI MEC, etc. but these are outside the scope of this solution.
5\. This SMF provided configuration is transferred to the new/target NG-RAN
node when the UE has been handed over to a the new/target NG-RAN node.
6\. If the serving cell Id(s) has changed (and upon receiving the SMF
request), the NG-RAN provides the latest/new serving cell Id(s).
7\. The UPF exposes received information to local NEF/AF as defined in clause
5.2.26 of TS 23.502 [9] and further enhanced in FS_UPEAS.
### 6.13.3 Procedures
This procedure is based on clause 6.4.2.1 of TS 23.548 [3] for Network
Exposure to Edge Application Server and further enhanced in FS_UPEAS as
follows:
Figure 6.13.3-1: Reporting information by the NG-RAN to local AF.
0\. The UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS
23.502 [9]. A L-PSA UPF is assigned for this PDU Session.
1\. The AF initiates setting up an AF session with required QoS procedure as
defined in clause 4.15.6.6 of TS 23.502 [9].
In the request, the AF may subscribe to direct notification of requested
information such as Cell ID(s), for the service data flow to PCF possibly via
Local NEF or NEF.
The AF may also first initiate an AF Session with PCF and later subscribe to
direct notification of requested information to PCF by invoking
Npcf_PolicyAuthorization_Subscribe service operation.
The local AF or NEF may discover a local NEF as specified in step 1 in clause
6.4.2.1 of TS 23.548 [3].
2\. The PCF makes the policy decision and initiates the PDU Session
modification procedure as defined in clause 4.3.3.2 of TS 23.502 [9], steps
1b, 3b, 4-8b.
If the direct notification is subscribed, the PCF includes the indication of
direct event notification (including target local NEF or local AF address) for
the service data flow within the PCC rule.
If the SMF receives (2a) the indication of direct event notification from the
PCF and the SMF determines that the L-PSA UPF supports such reporting, the SMF
sends (2b) requested information indication and associates the indication with
the target local NEF or local AF address to the L-PSA UPF via N4 rules.
The SMF sends (2c) via N2 to NG-RAN within a PDU Session resource
Create/Modify (defined in TS 38.413 [15]) a request to send to the UPF
requested information that contains e.g. the cell(s) currently serving a PDU
Session, etc.
3\. The L-PSA UPF obtains requested information sent in GTP-u by NG-RAN.
If the SMF had beforehand requested that the NG-RAN sends an indication and
the PDU Session resources have been released in the NG-RAN, the NG-RAN needs
to send to the UPF an indication that the cell(s) currently serving the PDU
Session and /or the UE identity as handled by the NG-RAN are no longer valid.
If there is no UL traffic, the NG-RAN may send a GTP-u packet with no user
plane traffic (dummy UL packet).
The NG-RAN may send updated serving cell Id(s) and/or UE identity as handled
by the NG-RAN in multiple UL packet sent over 5GS N3 interface (in order to
not lose the information if some UL traffic was discarded between the NG-RAN
and the UPF responsible of the reporting to the EC AF).
4\. The L-PSA UPF sends the notification related requested information over
Nupf_EventExposure_Notify service operation as specified in step 4 (a, b) in
clause 6.4.2.1 of TS 23.548 [3].
5-8. may follow as specified in clause 6.4.2.1 of TS 23.548 [3].
### 6.13.4 Impacts on services, entities and interfaces
Proposed information exposure impacts the same entities and interfaces as QoS
monitoring defined in Rel-16.
NG-RAN:
\- should support exposing of requested information such as Cell ID(s) in
GTP-u packets.
UPF:
\- should support exposing of requested information such as Cell ID(s) in
GTP-u packets;
\- should support exposing requested information which includes cell ID(s) in
Nupf_Event_Exposure_Notify.
NEF, PCF, SMF:
\- should support indication of RAN assistance information in
Nnef_AFSessionWithQoS / Npcf_PolicyAuthorization_Subscribe.
SMF and UPF:
\- N4 should support indication of requested information.
## 6.14 Solution 14 (KI#4): Group Management
### 6.14.1 Introduction
This solution addresses the Key Issue #4, and in particular how to define a
collection of UEs forming a dynamic ad-hoc group. This dynamic ad-hoc group
may be then used to identify the users that should use the same EAS and/or
same local part of DN and/or same DNAI.
This solution makes the following assumptions:
\- AF determines the identities of the UEs that should be part of the
collection and creates an ad-hoc group for this collection to the 5GC. The AF
includes an External Group ID in the group creation request. The AF can add or
remove users in the group in dynamic manner. 5GC stores the group members with
associated Internal and External Group IDs.
\- The AF uses the Traffic Influence and EAS Deployment services to submit
edge service related data for the given ad-hoc group as identified by the
External Group ID. No impact to Rel-17 is foreseen.
\- The 5GC is responsible to determine and select a common local part of the
DN for the group members. This step is not in the scope of this solution
proposal.
### 6.14.2 Functional Description
The solution is based on the following principles:
\- In this solution, the AF is responsible to create and maintain the ad-hoc
group data in 5GC. NEF provides a generic Group Management service for the AF
to create, modify and delete ad-hoc groups in 5GC. Generic here means that the
group data does not contain any service specific data, but instead any service
data can be associated with the corresponding group identifier. This solution
proposal describes how the traffic influence service data and EAS Deployment
Information data can be associated with the group data, but the same principle
could be used with any other service data.
\- Upon receiving a request to include a user into a group (i.e. when the
group is created or a new user is added to the group), the UDM ensures that
the group data and individual subscription data are aligned; i.e. the UDM
updates the individual user subscription data for the group member to contain
the Internal Group ID of the group. In similar manner, when the AF requests a
user to be removed from a group, the UDM removes the corresponding Internal
Group ID from the individual user subscription data. A user may belong to more
than one group.
\- Nnef_TrafficInfluence service as specified in Rel-17 is used to store the
DNN/S-NSSAI and the Internal Group ID. The service data may contain an
\"Indication of traffic correlation\" parameter as defined in clause 5.6.7 in
TS 23.501 [2] to indicate that a common local part of DN should be selected.
The service data is applicable for all members of the given group using the
given DNN/S-NSSAI.
\- Nnef_EASDeployment service as specified in clause 6.2.3.4 in TS 23.548 [3]
is used to store the EAS Deployment Information in the NEF and UDR. The SMF
retrieves the EAS Deployment Information from the NEF and configures the DNS
handling rules to EASDF correspondingly. EAS Deployment Information can
contain an Internal Group ID as described in Table 6.2.3.4-1 in TS 23.548 [3].
The service data is applicable for all members of the given group using the
given DNN/S-NSSAI.
\- A single DNN/S-NSSAI may be used by multiple ad-hoc groups. In this case
the groups may be controlled by the same or different AFs, each submitting a
different traffic influence service data containing the same DNN/S-NSSAI.
NOTE: The solution assumes that the principle in Rel-17 holds, where multiple
AFs that manage different services can submit traffic influence data for the
same user with the same DNN/S-NSSAI.
The figure 6.14.2-1 illustrates the overall structure of the Group management
data, Traffic Influence data, and EAS Deployment Information data.
Figure 6.14.2-1: Overall structure of the Group management data and Traffic
Influence data
The NEF provides three distinct services: 1) generic Group Management service,
2) Traffic Influence service, and 3) EAS Deployment service.
For the Group Management service, either a new service needs to be specified,
or the existing Nnef_ParameterProvision service is used as specified in clause
5.29.2 in TS 23.501 [2]. In the latter case, the Nnef_ParameterProvision
service shall be generalized so that it can be used also for groups that are
not specific for 5G VN group communication service. This means that the group
data should not be required to contain any service specific data, as the group
data can be referenced from any service.
As specified in clause 5.29.2 in TS 23.501 [2], the UDM ensures that the group
data and user subscription data are aligned, i.e. the user who is listed as a
member in the group data should have the same group identity in the user
subscription data.
For the Traffic Influence and EAS deployment services, the existing procedures
are used to store the traffic influence data and EAS Deployment Information
data into UDR. The traffic influence data and EAS Deployment Information data
can contain a DNN/S-NSSAI and Internal Group ID that the service data is
applicable for.
The figure 6.14.2-2 illustrates how the UDMs can align the group data and
individual subscription data in a case where the group data and individual
user subscription data are served by different UDMs.
Figure 6.14.2-2: Different UDMs serving the user(s) and group
AF invokes a group creation or update request to the NEF (not shown in the
figure). The NEF discovers the UDM-1 based on the External Group ID. The UDM-1
receives the group creation request from the NEF. UDM-1 discovers the UDR
based on External Group ID and stores the group data into UDR-1. UDM-1 uses
the SUPI to discover the UDR for each member (UDR-2). UDM-1 updates the user
subscription data for the member\'s SUPI and adds the Internal Group ID of the
group to the user subscription data. If the user subscription data is updated
via OAM, the UDM-2 updates the user subscription data in UDR-2 and UDR-2
notifies the UDM-1 for the data change.
### 6.14.3 Procedures
Figure 6.14.3-1 describes an overview of the procedure to create an ad-hoc
group that is used to determine the collection of users that should have a
common local part of DN.
Figure 6.14.3-1: Creation of a group and using it for selecting the local part
of DN
1\. Group Management:
The AF invokes a group creation request to the NEF. The group creation request
contains an External Group ID and list of GPSIs that are members in the group.
NEF uses an UDM service to create the group. The group data contains the
members (SUPIs) and External Group ID. The UDM discovers an UDR based on the
External Group ID and stores the group data into UDR. The UDR assigns an
Internal Group ID for the group and stores it to the group data.
Upon receiving a request to include a user into a group, the UDM updates the
individual user subscription data for the group members in the corresponding
UDR(s) to contain the Internal Group ID of the group.
NOTE: A single UDR should serve the group data for a particular External Group
ID. How the UDR ensures that the Internal Group ID is unique is left up to
implementation, as long as the format defined in clause 19.9 in TS 23.003 [16]
is followed.
2\. Edge service management (no impact):
AF uses the Nnef_TrafficInfluence service as specified in clause 4.3.6.2 in TS
23.502 [9] to influence SMF routeing decisions for User Plane traffic of PDU
Sessions. AF uses the Nnef_EASDeployment service as specified in clause
6.2.3.4 in TS 23.548 [3]. The AF may include an External Group ID to the
service requests. If the AF requires that the same local part of DN is used
for the group members when they access the given DNN/S-NSSAI, the AF includes
the \"Indication of traffic correlation\" parameter to the
Nnef_TrafficInfluence service request.
The NEF uses the Nudm_SDM_Get (Group Identifier Translation, External Group
ID) service to resolve the External Group ID to Internal Group ID, as
specified in Rel-17. The NEF stores the TrafficInfluence service information
and EAS Deployment Information in the UDR. The service data contains the
DNN/S-NSSAI and Internal Group ID as specified in Rel-17. The PCF(s) that have
subscribed for the Traffic Influence data for the matching DNN/S-NSSAI and
Internal Group ID receive a notification from the UDR.
3\. PDU Session establishment (not in the scope of this solution):
Upon PDU Session establishment, the SMF retrieves the user subscription data
from the UDM. The user subscription data may contain one or more Internal
Group IDs. The SMF passes the DNN/S-NSSAI and Internal Group ID(s) to the PCF
as specified in clause 4.16.4 in TS 23.502 [9]. If the PCF does not have the
traffic influence service data for the given DNN/S-NSSAI and Internal Group
ID, the PCF retrieves it from the UDR.
The SMF retrieves the EAS Deployment Information for the given DNN/S-NSSAI and
Internal Group ID(s) from the NEF as described in clause 6.2.3.4 in TS 23.548
[3].
4\. Selecting the common local part of DN (not in the scope of this solution):
If the traffic influence service data contains the \"Indication of traffic
correlation\" parameter, 5GC determines and selects a common local part of the
DN for all PDU Sessions that use the given DNN/S-NSSAI where the user is a
member in the given group.
### 6.14.4 Impacts on services, entities and interfaces
Assuming that the existing Nnef_ParameterProvision service is used as
specified in clause 5.29.2 in TS 23.501 [2] to provide a generic Group
Management service, the impacts are limited to the generalization of the
Nnef_ParameterProvision service as described below.
NEF:
\- Nnef_ParameterProvision service is enhanced to remove a requirement to
provide any service specific data in group creation. At least DNN and S-NSSAI
are currently mandatory parameters in the Nnef_ParameterProvision_Create
service operation when a 5G VN group is created.
UDM:
\- Nudm_ParameterProvision service is enhanced to remove a requirement to
provide any service specific data in group creation. At least DNN and S-NSSAI
are currently mandatory parameters in the Nudm_ParameterProvision_Create
service operation when a 5G VN group is created.
UDR:
\- Nudr_DataManagement service is used to manage the group data in the UDR.
The service is enhanced to remove a requirement to provide any service
specific data when the group data is stored in UDR. At least DNN and S-NSSAI
are currently mandatory parameters in the Group Data Subset in subscription
dataset for a 5G VN group. The UDR stores the Internal/External Group IDs and
the member list (list of SUPIs).
## 6.15 Solution 15 (KI#4): Selection of common DNAI
### 6.15.1 Introduction
This solution aims to address the KI#4 created for WT#6 related to the
influence on UPF and EAS (re)location for a collection of UEs in scenarios
when the UEs should use the same EAS and are not members of a pre-defined
group.
As addressed under the key issue description, the UPF selection and
relocation, and deciding on a common local part of DN are the focus of this
solution. In practice, an optimal common local part of DN would be needed to
make the service experience best for all UEs in the group.
How to define a collection of UEs forming a dynamic ad-hoc group is not in the
scope of this solution proposal.
### 6.15.2 Functional Description
The solution is based on the following principles:
\- Session Collection Management Function (SCMF) entity is introduced to
determine the location of the common local part of DN (L-DN) and used for
common DNAI selection.
\- Individual SMFs one by one add more sessions to the collection of PDU
Sessions that is managed by the SCMF, and SCMF selects the common DNAI for
this collection of PDU Sessions. SCMF can re-consider the common DNAI whenever
a new PDU Session \"joins\" to an existing collection of PDU Sessions.
\- The interface between SMF and SCMF can be based on subscribe/notify model,
so even if the SCMF fails to select the common DNAI in some error case, the
individual SMFs can proceed as with regular UPF/DNAI selection as a fallback.
\- SCMF can make the decision on the common DNAI based on the information it
receives from individual SMFs. Then, each SMF selects the location of the UPF
based on the common DNAI and relocates the UPF on PDU Session basis.
\- For selecting the common DNAI, SCMF may further use Analytics services from
NWDAF for determining service experience between the gNB and candidate UPFs.
\- Nnef_TrafficInfluence service as specified in TS 23.501 [2] is used to
store the DNN/S-NSSAI, Internal Group ID, and a list of DNAIs. The traffic
influence data may contain an \"Indication of traffic correlation\" parameter
as defined in clause 5.6.7 in TS 23.501 [2] to indicate that a common DNAI
should be selected. PCF retrieves the traffic influence data from UDR and
constructs the PCC Rules accordingly. No impact to Nnef_TrafficInfluence
service is foreseen.
\- Nnef_EASDeployment service as specified in clause 6.2.3.4 in TS 23.548 [3]
is used to store the EAS Deployment Information in the NEF and UDR. The SMF
retrieves the EAS Deployment Information from the NEF and configures the DNS
handling rules to EASDF correspondingly. EAS Deployment Information can
contain an Internal Group ID as described in Table 6.2.3.4-1 in TS 23.548 [3].
No impact to Nnef_EASDeployment service is foreseen.
\- The solution proposes to enhance the PCC Rules by adding a new identifier
\"influence-id\", which is associated with the list of DNAIs in the PCC Rules.
UDR assigns the \"influence-id\" for each entry in the traffic influence data
in the UDR when the entry is created as specified in Rel-17. In this solution,
the PCF retrieves the \"influence-id\" from the UDR as part of the traffic
influence data and includes it to the PCC Rules. This is necessary when the
same DNN/S-NSSAI is used by multiple ad-hoc groups (Internal Group IDs), where
each group has different traffic influence service data (e.g. list of DNAIs)
containing the same DNN/S-NSSAI. In this case the PCC Rules will contain
multiple lists of DNAIs and the \"influence-id\" is used to determine the
lists of DNAIs in different PDU Sessions that are related to each other.
### 6.15.3 Procedures
#### 6.15.3.1 General
The overall procedure is described in figure 6.15.3.1-1.
Figure 6.15.3.1-1: Overall procedure
1\. Prerequisite: AF has created an ad-hoc group in 5GC. AF submits the
traffic influence data and EAS Deployment Information data for the group to
5GC. This step is out of scope of this solution.
2\. Upon PDU Session establishment, the SMF retrieves the user subscription
data from the UDM. The user subscription data may contain one or more Internal
Group IDs. The SMF passes the DNN/S-NSSAI and Internal Group ID(s) to the PCF
as specified in clause 4.16.4 in TS 23.502 [9]. If the PCF does not have the
traffic influence service data for the given DNN/S-NSSAI and Internal Group
ID(s), the PCF retrieves the data from the UDR. The PCF creates or updates the
PCC Rules to the SMF.
The PCC Rules contain a list of DNAIs associated with the \"Indication of
traffic correlation\" and with \"influence-id\". The PCF retrieves the
\"influence-id\" from the UDR, thus the value of \"influence-id\" remains the
same across all PDU Sessions that use the same traffic influence data.
NOTE: SMF indicates the Internal Group ID(s) and DNN/S-NSSAI to PCF, and PCF
uses these to retrieve the corresponding traffic influence data from UDR, as
specified in Rel-17, clause 6.4.2.2 of TS 29.519 [17].
[Optional] If the DNS queries are to be used to influence to the EAS address
selection as described in clauses 6.15.3.2 and 6.15.3.3, the SMF retrieves the
EAS Deployment Information as described in TS 23.548 [3].
3\. SMF(s) invoke the SCMF for selection of the common DNAI. This is described
in clause 6.15.3.2.
Depending on the variation of the procedure, the SMF(s) may invoke the SCMF
either based on the user subscription and service data as received in steps 1
and 2, or alternatively the SMF(s) invoke SCMF in dynamic manner based on DNS
Query from the UE.
Rest of the clauses describes the following procedures:
\- Clause 6.15.3.2 \"Selection of the common DNAI\" describes the core
procedure in the solution how SCMF selects the common DNAI. This procedure is
part of all solution variants.
\- Clause 6.15.3.3 \"EAS selection and re-selection using ECS option,
preconfigured\" describes a solution variant where SMF(s) invoke the SCMF
based on the preconfigured user subscription and service data before any DNS
Query from the UE. ECS option in DNS request is used to indicate the common
DNAI to the DNS server.
\- Clause 6.15.3.4 \"EAS selection and re-selection using ECS option, dynamic
invoke of SCMF\" describes a solution variant where SMF(s) invoke the SCMF
based on a DNS Query from the UE. ECS option in DNS request is used to
indicate the common DNAI to the DNS server.
\- Clause 6.15.3.5 \"EAS selection and re-selection via application layer\"
describes a solution variant where SMF(s) invoke the SCMF based on the user
subscription and service data. Early/late UP path change notifications are
used to indicate the common DNAI to the application layer.
#### 6.15.3.2 Selection of the common DNAI
Figure 6.15.3.2-1 describes a procedure for selection of common DNAI for the
collection of UEs that should use a common local part of DN and common EAS.
Figure 6.15.3.2-1: Selection of the common DNAI
1\. SMF receives the user subscription data and PCC Rules as described in step
2 in clause 6.15.3.1. Based on the \"Indication of traffic correlation\" and
\"influence-id\" associated with a list of DNAIs in the PCC Rules, SMF knows
that it needs to discover a SCMF for a selection of a common DNAI. SMF
discovers the SCMF from NRF. SMF discovers one SCMF for each \"influence-id\"
associated with a list of DNAIs in the PCC Rules.
BSF can be used to ensure that the same SCMF is selected for all PDU Sessions
with the same \"influence-id\"; SMF uses the \"influence-id\" to retrieve the
SCMF identity from the BSF. If the registration in BSF for the given
\"instance-id\" does not exist, the SMF discovers the SCMF from NRF, using
e.g. the DNN/S-NSSAI as a discovery factor. SCMF registers the \"influence-
id\" to BSF after SCMF has been selected for the first PDU Session for an
\"influence-id\".
2\. The SMF invokes the SCMF and indicates the \"influence-id\", SUPI,
DNN/S-NSSAI, and a list of DNAIs for the given \"influence-id\" as received in
the PCC Rules to the SCMF. The SMF invokes the SCMF for each \"influence-id\"
associated with a list of DNAIs in the PCC Rules.
3\. For the selection of the common DNAI for a collection of PDU Sessions
associated with the same \"influence-id\", the SCMF may consider the UE
locations, network topology, or the current Analytics from NWDAF for service
experience between the gNB and candidate UPFs. SCMF can subscribe for UE
location info (UE mobility events) for the SUPI from the AMF. Based on the
current Rel-17 procedures, there are two options for the SCMF to subscribe the
mobility event for a UE:
\- the SCMF uses Nudm_EventExposure_Subscribe service operation from UDM for a
SUPI, and UDM continues the rest, i.e. knows the AMF for the SUPI;
\- the SCMF manages a certain area and subscribes mobility events for any UE
from all AMFs serving this area.
If the SCMF uses Analytics services from NWDAF, the SCMF invokes the NWDAF on
PDU Session and \"influence-id\" basis.
4\. SCMF determines the common DNAI per each \"influence-id\" and notifies the
SMF(s) of the corresponding \"influence-id\" for the result. Based on the
notification from the NWDAF, or any internal trigger, SCMF can reselect a new
common DNAI, and notify the SMF(s) for the change of the common DNAI
accordingly.
5\. The SMF(s) select and relocate the UPF based on the notifications from
SCMF. The SMF configures the UPF to route the UL traffic towards the EAS in
the L-DN. The details depend on how the EAS is discovered and is described in
clause 6.15.3.2.
6\. Whenever a new UE that belongs to the same Internal Group ID initiates a
PDU Session with the given DNN/S-NSSAI, the steps 2-5 are performed for the
new PDU Session.
If the SCMF determines a new common DNAI for the group, the SMF(s) of the
existing PDU Sessions are notified by the SCMF for a new common DNAI. This may
be done e.g. due to a new PDU Session joining to the group, or one of the
existing PDU Sessions are released, or one or more of the UEs in the group are
moving and the SCMF finds a more optimal DNAI.
#### 6.15.3.3 EAS selection and re-selection using ECS option, preconfigured
Figure 6.15.3.3-1 describes a procedure for EAS selection and re-selection for
a group of UEs when DNS queries from the UE influence to the EAS selection.
EDNS Client Subnet option in the DNS Query is used to indicate the common DNAI
to the DNS server. The SMF subscription for the common DNAI from SCMF is done
based on the pre-configured edge service data that is applicable for the PDU
Session, i.e. traffic influence data and EAS Deployment Information as
described in TS 23.548 [3].
The flow is applicable for all connectivity models described in TS 23.548 [3].
UPF in the figure corresponds to PSA UPF in the local site (L-PSA UPF). In
case of Session Breakout connectivity model, the UL-CL or BP is used although
not shown in the figure. In case of Distributed Anchor connectivity model,
instead of EASDF a DNS resolver that is preconfigured with the ECS Option may
be used.
Figure 6.15.3.3-1: EAS (re-)selection using ECS option, preconfigured
Pre-requisite: SMF receives the user subscription data and PCC Rules as
described in step 2 in clause 6.15.3.1. SMF has invoked the SCMF as described
in clause 6.15.3.2. SCMF notifies the SMF for the common DNAI.
1\. The SMF uses the common DNAI to select the UPF. The SMF configures the
EASDF for the DNS message handling rules using the EAS Deployment Information
as described in TS 23.548 [3]. The SMF may notify the AF for UP path change
events via early and/or late notifications as described in clause 4.3.6.3 in
TS 23.502 [9], based on subscriptions in the PCC Rules. The notifications
indicate the common DNAI as a target DNAI.
2\. When the UE initiates a DNS Query, the EASDF matches it against the rules
it has received from the SMF. Based on the DNS message handling rules from
SMF, the EASDF inserts an EDNS Client Subnet option to the DNS Query. The EDNS
Client Subnet option refers to a location that is topologically close to the
common DNAI. The DNS server may resolve the EAS IP address considering the
EDNS Client Subnet option and sends the DNS Response via the EASDF and UPF1 to
the UE.
3\. Application client and EAS transmit data via the user plane via UPF.
4\. If the SCMF determines a new common DNAI as described in step 6 in clause
6.15.3.2, the SCMF notifies all SMF(s) that have subscribed for the given
\"instance-id\". The SMF(s) reselect the UPF accordingly. SMF(s) notify the AF
as in step 2.
The SMF(s) trigger an EAS rediscovery procedure with the UE(s). In case of
Distributed Anchor Point connectivity model as described in TS 23.548 [3],
when the SMF relocates the UPF, the UE detects that the PDU Session is
released or new IP prefix is allocated within the PDU Session, and the UE
removes the old DNS cache related to old/removed IP address/prefix as
described in clause 6.2.2. in TS 23.548 [3].
In case of Session Breakout connectivity model as described in TS 23.548 [3],
the SMF sends PDU Session Modification Command (EAS rediscovery indication,
[impact field]) to UE as described in in clause 6.2.3.3 in TS 23.548 [3]. The
EAS rediscovery indication indicates to refresh the cached EAS information.
The UE behaves as described in TS 23.548 [3].
The UE(s) resolve the new EAS address as in step 2. Application client and the
new EAS transmit data via the user plane via new UPF.
If the PCC Rules indicate multiple \"influence-ids\" with Session Breakout
connectivity model, the SMF(s) may assign a separate local PSA for each common
DNAI, if necessary. In Distributed Anchor connectivity model, the SMF(s) can
assign a local PSA that is most optimal for any of the common DNAIs.
#### 6.15.3.4 EAS selection and re-selection using ECS option, dynamic invoke
of SCMF
Figure 6.15.3.4-1 describes a procedure for EAS selection and re-selection for
a group of UEs when DNS queries from the UE influence the EAS selection. EDNS
Client Subnet option in the DNS Query is used to indicate the common DNAI to
the DNS server. The invoke of the SCMF is done in dynamic manner based on the
DNS Queries from the UE, in addition to edge service data that is applicable
for the PDU Session, i.e. traffic influence data and EAS Deployment
Information as described in TS 23.548 [3].
The flow is applicable for all connectivity models described in TS 23.548 [3].
In case of Session Breakout connectivity model the UL-CL or BP is used
although not shown in the figure.
Figure 6.15.3.4-1: EAS (re-)selection using ECS option, dynamic model
Pre-requisite: SMF receives the user subscription data and PCC Rules as
described in step 2 in clause 6.15.3.1.
1\. The SMF configures the EASDF for the DNS message handling rules using the
EAS Deployment Information as described in TS 23.548 [3].
2\. The SMF assigns a central UPF (C-UPF) for the PDU Session.
3\. When the UE initiates a DNS Query, the EASDF matches it against the rules
it has received from the SMF.
4\. Based on the DNS message handling rules from SMF, the EASDF reports the
FQDN to the SMF. The SMF uses the user subscription data and edge service data
as described in clause 6.15.3.1 step 3 to determine that the FQDN is related
to a group service where a SCMF needs to be invoked.
The SMF invokes the SCMF as described in clause 6.15.3.2. The SMF selects the
UPF based on the common DNAI as described in clause 6.15.3.2.
In case of Session Breakout connectivity model, the SMF configures the EASDF
to insert an EDNS Client Subnet option to the DNS Query, as described in step
2 in clause 6.15.3.3.
In case of Distributed Anchor connectivity model, the SMF triggers an EAS
rediscovery procedure with the UE as described in step 4 in clause 6.15.3.3.
5\. In case of Distributed Anchor connectivity model, the UE re-initiates a
DNS Query as in step 4 in clause 6.15.3.3. The EASDF matches it against the
rules it has received from the SMF.
Based on the DNS message handling rules from SMF, the EASDF inserts an EDNS
Client Subnet option to the DNS Query. The DNS server returns the EAS address
to the UE.
6\. Application client and EAS transmit data via the user plane via L-UPF.
7\. If the SCMF determines a new common DNAI as described in step 6 in clause
6.15.3.2, the SCMF notifies all SMF(s) that have subscribed for the given
\"instance-id\". The SMF(s) reselect the UPF accordingly. UE(s) perform an EAS
reselection as described in step 4 in clause 6.15.3.2.
NOTE: Signalling storm can be avoided especially at race conditions by
implementing a threshold so that common DNAI does not change back and forth
frequently among a group of DNAIs.
If the PCC Rules indicate multiple \"influence-ids\" with Session Breakout
connectivity model, the SMF(s) may assign a separate local PSA for each common
DNAI, if necessary. In Distributed Anchor connectivity model, the SMF(s) can
assign a local PSA that is most optimal for any of the common DNAIs.
#### 6.15.3.5 EAS selection and re-selection via application layer
Figure 6.15.3.5-1 describes a procedure for EAS selection and re-selection for
a group of UEs when application layer protocols are used to redirect the
application client in the UE to an EAS serving the group. In this case, DNS
queries from the UE do not influence to the EAS selection. The flow is
applicable for all connectivity models described in TS 23.548 [3]. In case of
Session Breakout model, the UPFs in the figure correspond to PSA UPF in the
local site (L-PSA UPF).
In this procedure, the EASDF is not involved and the Nnef_EASDeployment
service is not used.
Figure 6.15.3.5-1: EAS (re-)selection via application layer
Pre-requisite: SMF receives the user subscription data and PCC Rules as
described in step 2 in clause 6.15.3.1. SMF has invoked the SCMF as described
in clause 6.15.3.2. SCMF notifies the SMF for the common DNAI.
1\. The SMF uses the common DNAI to select the UPF. The SMF notifies the AF
for UP path change events via early and/or late notifications as described in
clause 4.3.6.3 in TS 23.502 [9]. The notifications indicate the common DNAI as
a target DNAI.
2\. The application layer informs the UE for the group FQDN that corresponds
to the current common DNAI. The UE resolves the EAS address via DNS Query.
Alternatively, the application layer can inform the EAS IP address(es)
directly via application layer. This step is out of scope of 3GPP.
3\. Application client and EAS transmit data via the user plane via UPF.
4\. If the SCMF determines a new common DNAI, the SCMF notifies all SMF(s)that
have subscribed for the given \"instance-id\". The SMF(s) reselect the UPF
accordingly. SMF(s) notify the AF as in step 1. The UE(s) resolve the new EAS
address as in step 2. Application client and new EAS transmit data via the
user plane via new UPF.
If the PCC Rules indicate multiple \"influence-ids\" with Session Breakout
connectivity model, the SMF(s) may assign a separate local PSA for each common
DNAI, if necessary. In Distributed Anchor connectivity model, the SMF(s) can
assign a local PSA that is most optimal for any of the common DNAIs.
### 6.15.4 Impacts on services, entities and interfaces
SCMF:
\- a new function;
\- determines the common DNAI for a collection of UEs;
\- notifies the SMF(s) that have subscribed for the common DNAI;
\- has similar information about the network topology and DNAIs as the SMF
has;
\- registers to the BSF using the Nbsf_Management_Register service operation;
\- implements a threshold so that the common DNAI does not change back and
forth between the same DNAIs;
\- delays the individual notifications it generates to the SMFs if the group
is big.
BSF:
\- Nbsf_Management_Register is enhanced for the SCMF to be able to register
the SCMF ID and the influence-id to the BSF;
\- Nbsf_Management_Discovery service operations is enhanced to be able to
discover the SCMF ID based on the influence-id.
SMF:
\- discovers and invokes the SCMF;
\- discovers the SCMF from BSF using the Nbsf_Management_Discovery service
operation;
\- selects the UPF based on the common DNAI as notified by the SCMF.
PCF:
\- receives the \"influence-id\" from UDR and includes it into PCC Rules as
part of traffic influence data.
UDR:
\- indicates the \"influence-id\" to the PCF in Nudm_DataManagement service
response for each entry in the traffic influence data in the UDR.
## 6.16 Solution 16 (KI#4): Selecting the same EAS/DNAI for collection of UEs
### 6.16.1 Description
This solution corresponds to KI#4:
\- whether and how to define a collection of UEs forming a dynamic ad-hoc
group that should use the same EAS and/or same local part of DN and/or same
DNAI and how the collection is identified;
\- whether and what improvements are required for EAS discovery and re-
discovery for UEs belonging to a collection of UEs.
### 6.16.2 Procedures
#### 6.16.2.1 EAS discovery procedure
The following is the procedure for selecting the same EAS for collection of
UEs accessing the same application. The procedures defined in figure 4.3.6.2-1
in TS 23.502 [9] and figure 6.2.3.2.2-1 in TS 23.548 [3] are reused.
There could be only one SMF for serving the collection of UEs that connecting
to the same EAS/DNAI for accessing the same application, or there could be
multiple SMFs for different UEs in the collection. AF could provide the common
EAS/DNAI in AF request, in which case, SMF(s) select the common EAS/DNAI
provided by AF. If AF does not provide the common EAS/DNAI, then SMF selects
the common EAS/DNAI and stores it in the corresponding AF traffic influence
request information in UDR.
Figure 6.16.2.1-1: Discovery procedure for selecting the same EAS/DNAI for
collection of UEs
1\. The AF request in step 1 of figure 4.3.6.2-1 in TS 23.502 [9] is used to
request selecting the same EAS or same DNAI for UEs accessing the application
as identified in the AF Request.
An eas_correlation indication or dnai_correlation indication is provided for
indicating selecting the same EAS or the same DNAI (i.e. selecting EAS
corresponding to the same DNAI) for collection of UEs accessing the same
application (e.g. FQDN), Spatial Validity Condition could be provided for
limiting the location of the UEs, and also \"any UE\" or an UE list or group
ID will be provided for defining UE collection accessing the same EAS or the
same DNAI.
\- In the case of selecting the same DNAI, the DNAI could be determined and
provided by AF to PCF and then to SMF.
\- In the case of selection the same EAS, the EAS could be determined and
provided by AF to PCF and then to SMF.
A Correlation ID is included in AF Request for identifying the UE collection.
In step 5 of figure 4.3.6.2-1 of TS 23.502 [9], PCF determines the UEs
influenced by the AF Request, and based on AF request, PCF creates PCC rule
with FQDN, Correlation ID, and eas_correlation indication or dnai_correlation
indication to SMF.
2\. The same as steps 1\~9 in figure 6.2.3.2.2-1 of TS 23.548 [3].
3\. If FQDN in Neasdf_DNSContext_Notify Request is for the application (e.g.
FQDN) indicated in AF request, and if eas_correlation indication is set, SMF
determines the UE belongs to collection of UEs accessing the application and
determines the UE needs to select the same EAS as UEs in the UE collection; or
if dnai_correlation indication is set, SMF determines the UE belongs to
collection of UEs accessing the application and determines the UE needs to
select EAS corresponding to the same DNAI as UEs in the UE collection.
4\. If EAS IP/DNAI has not been determined, or SMF could not make sure the
selected EAS IP/DNAI is the one that is stored in UDR, then SMF synchronizes
with UDR and receives EAS IP or DNAI for the UE collection, as defined in
clause 6.16.2.2. UDR maintains EAS IP or DNAI for the UE collection.
5\. Based on steps 10\~19 in figure 6.2.3.2.2-1 of TS 23.548 [3]:
For selecting the same EAS case: if the same EAS for the UE collection has not
been determined yet, steps 10\~15 are used for discovering an EAS, and between
step 14 and step 16, SMF could send the selected EAS IP to UDR; When the same
EAS for the UE collection has been determined, in step 17, SMF sends DNS
message handling rule with IP address for the EAS instructing EASDF to return
the IP address for the EAS to UE in step 19, steps 10\~15 are skipped;
For selecting EAS corresponding to the same DNAI case: if no DNAI for the UE
collection has been determined, in step 10 SMF determines DNAI for the UE
collection and selects information to build ECS option or Local DNS server
based on the DNAI. When DNAI for the UE collection has been determined, in
step 10 SMF determines information to build ECS option or local DNS server
related to the DNAI, and sends DNS message handling rule with the information
to build ECS option or local DNS server.
6\. If EAS IP/DNAI has not been determined, or SMF could not make sure the
selected EAS IP/DNAI is the one that stored in UDR, then SMF synchronizes EAS
IP/DNAI with UDR via NEF, as defined in clause 6.16.2.2.
#### 6.16.2.2 Synchronization procedure for EAS IP/DNAI
Figure 6.16.2.2-1: Synchronization Procedure for EAS IP/DNAI
1-4. In case a new EAS/DNAI has been determined, SMF sends the EAS/DNAI,
Resource URI to PCF by invoking Npcf_SMPolicyControl_Update Request,
triggering the PCF to update the corresponding AF traffic influence request
information with common EAS/DNAI in UDR and UDR will lock the data to prevent
the data to be modified to other EAS/DNAI by other PCF providing different
EAS/DNAI for the same UE collection. PCF updates PCC rule to SMF including the
common EAS/DNAI of AF traffic influence request information in UDR.
In case SMF decides to trigger EAS rediscovery for UE collection, SMF removes
the common EAS/DNAI from AF traffic influence request information, UDR
notifies PCF, and then PCF updates SMF with updated PCC rule removing the
common EAS/DNAI, and triggers other SMF for EAS rediscovery.
NOTE 1: Npcf_SMPolicyControl_Update is proposed to be used for updating
EAS/DNAI in UDR, but a new service or operation, instead of reusing
Npcf_SMPolicyControl_Update could also be a candidate.
NOTE 2: The common EAS/DNAI for collection of UEs could be deleted in case the
AF traffic influence request information is removed by AF.
5-7. In case the common EAS/DNAI for collection of UEs is created/deleted, UDR
notifies PCFs and then PCF will update PCC rules.
### 6.16.3 Impacts on services, entities and interfaces
AF:
\- to be updated with eas_correlation indication/ dnai_correlation indication
for indicating selecting the same EAS/DNAI for collection of UEs accessing the
application;
\- providing UE ID list, Correlation ID in AF Request.
NEF:
\- Nnef_TrafficInfluence service is impacted to include \"eas_correlation
indication\" or \"dnai_correlation indication\", list of FQDNs and list of UE
identitities.
SMF:
\- to be updated for storing and retrieving the EAS/DNAI from UDR;
\- using the retrieved EAS/DNAI when selecting the same EAS/DNAI for
collection of UEs;
\- when deciding to trigger EAS rediscovery, SMF requests to remove the common
EAS/DNAI from AF traffic influence request information;
\- initializes EAS rediscovery when receiving updated PCC rule removing the
common EAS/DNAI.
UDR:
\- to be updated for maintaining common EAS/DNAI for the collection of UEs in
AF traffic influence request information for the application.
EASDF:
\- to be updated for create and send DNS response to UE.
PCF:
\- Npcf_SMPolicyControl_UpdateNotify service is to be updated to transmit PCC
rule with eas_correlation indication/ dnai_correlation indication, Correlation
ID, common EAS/common DNAI, Resource URI and FQDN(s);
\- receiving EAS/DNAI from SMF.
## 6.17 Solution 17 (KI#4): Application layer EAS selection for collections of
UEs
### 6.17.1 Introduction
This solution corresponds to KI #4. This solution assumes that the AF is
responsible for generating the collection of the UEs and select the same EAS
for the collection of the UEs. The SMF(s) selects the candidate DNAI(s) for
the UE(s) and exposes them to the AF. The AF determines the common DNAI
considering the candidate DNAI(s) from different SMFs, then the AF can select
the proper EAS with the common DNAI for the collection of the UEs.
### 6.17.2 Functional Description
This solution is based on the following principles:
\- The AF can determine the user list and sends the UE list and available DNAI
list to 5GC to query the candidate DNAI(s) for the UEs.
\- SMF decides the candidate DNAI(s) for the UE(s) in the UE list served by
the SMF according to the location of the UE(s) and the DNAI topology.
NOTE: The UEs of the group may be served by multiple SMFs.
\- The AF can determine the common DNAI based on candidate DNAIs from SMF(s)
and then discover an EAS and notify the UEs about the selected EAS via the
application layer.
### 6.17.3 Procedures
#### 6.17.3.1 EAS selection for multiple UE based application layer
This solution focuses on the EAS selection for multiple UE based application
layer.
Figure 6.17.3.1-1: Application layer implementation for EAS selection
1\. The AF groups the UEs and generates the UE list (UE addresses) of the
collection of UEs according to its application logic. The AF sends
Nbsf_management_Discovery request(s) to the BSF to retrieve the PCF(s) for
each UE in the UE list.
2 For each UE, AF sends AF retrieve request to the PCF to query the candidate
DNAI(s). The AF request may include the available DNAI list where EAS
instances are deployed. The AF request may also include the UE list. The AF
may send the AF request to PCF directly, or via the NEF.
3\. PCF sends the DNAI retrieve request to SMF.
4\. SMF selects the candidate DNAI(s). The SMF may consider the UE location
and available DNAI list provided by AF to select the closest available DNAI(s)
as candidate DNAI(s). The SMF may also provide the DNAI(s) in a prioritized
order.
5\. SMF notifies the AF (optionally via NEF) about the candidate DNAI(s) of
the UE.
6\. After receiving the candidate DNAI(s) of each UE in the list, the AF
selects a proper EAS and a common DNAI according to the DNAI(s).
7\. AF initiates AF influence on traffic routing procedure as defined in
clause 4.3.6.4 of TS 23.502 [9] for each UE in the UE list to route the
application traffic to the common DNAI.
8\. The AF notifies the UEs about the selected EAS via application layer.
9\. The users connect to the same EAS via the common DNAI and start the
service.
### 6.17.4 Impacts on services, entities and interfaces
AF/NEF:
\- supports sending new AF retrieve request to query the candidate DNAI(s) of
a list of UEs.
PCF:
\- supports handling the AF retrieve request and sending corresponding DNAI
retrieve request to SMF.
SMF:
\- supports selecting the candidate DNAI(s) for the UE according to the
location of the UE(s) and the DNAI topology;
\- supports notifying the AF about the candidate DNAI(s) of the UE.
## 6.18 Solution 18 (KI#4): Discovery of the same EAS for collections of UEs
### 6.18.1 Description
In order to realize the discovering the same EAS to collections of UEs, the
following conditions should be satisfied:
\- The same FQDN in DNS query or a group of FQDNs that can be resolved to a
certain EAS IP address by DNS server. The same EAS can be mapped to one FQDNs
or a group of FQDNs. Only the collections of the UEs request the same DNS
query with these FQDNs, that the DNS server can provide the same EAS IP
address.
\- The collections of the UEs have the similar UE location. For example, in a
stadium, some of the players can access the 5GC by the same gNB or a group of
gNBs, UEs are located in a specific location area. According to the UE
location information, the 5GC can identify that these UEs should be served by
the same EAS.
\- The collections of the UEs are identified by UE Identifiers, e.g. UEs
belong to an Ad-hoc group.
An AF request may be created to include indication of EAS correlation and pre-
conditions as defined in step 1 of figure 4.3.6.2-1 of TS 23.502 [9], which is
used to request selecting the same EAS for a collection of UEs. The pre-
conditions indicate the conditions whether a UE belongs to a collection of
UEs. The pre-conditions may reuse the information elements as defined in
clause 5.6.7 of TS 23.501 [2], which includes Spatial Validity Condition (e.g.
Area of Interest(s)), FQDN(s)/Application Identifier(s), Target UE
Identifier(s). The PCF creates the PCC rule based on information provided in
AF request, and sends the PCC rule to SMF.
The pre-conditions may also be a local policy preconfigured on SMF. The SMF
determines whether the pre-conditions are satisfied, and which UE collection
the UE belongs to, according to the pre-conditions and received information
(e.g. UE location is in the Area of Interest, requested FQDN in DNS query).
If the Spatial Validity Condition is provided in AF request as the pre-
condition, the PCF subscribes to the SMF to receive notifications about change
of UE location in an area of interest. The SMF is aware the UE location is in
or out of the subscribed area of interest and sends notifications to the PCF,
as specified in clause 5.6.7.1 of TS 23.501 [2]. If the FQDN(s)/Application
Identifier(s) is provided in AF request as the pre-condition, it is carried in
the PCC rule as Service data flow template. If the indication of EAS
correlation is included in the PCC rule, then SMF determines which UE
collection the UE belongs to, accordingly.
NOTE 1: Target UE Identifier(s) can be group identifier and stored in UDR as
current mechanism.
NOTE 2: For multiple SMFs situation, the updated information (e.g. common
EAS/DNS server) are stored in UDR and synchronize the data to other SMFs.
When the pre-conditions above are guaranteed, that for the 5GC side, the
following procedures can be used to realize to discover the same EAS for these
UEs:
\- Use the same DNS server to resolve the FQDN. It needs the 5GC to deliver
the same DNS server IP address to these UEs, for example, the EASDF or local
DNS server.
\- If the same local DNS server is selected, that whether the EAS will be
resolved depends on the DNS server\'s mechanism that is out of scope.
\- If the same EASDF is selected, that all these DNS query should be treated
with the same way, that applied to the same DNS message handling rules.
Whether and how the C-DNS or L-DNS to resolve the same EAS depends on the DNS
server\'s mechanism that is out of scope.
\- Directly responds to the DNS query to UE. This way only applies to the
EASDF. That if the EASDF identifies that the UE\'s DNS query should be replied
with the same EAS that other UEs use, the EASDF can directly respond with the
DNS query without having the DNS related procedure to DNS server. The SMF may
determine a timer to update the IP address of EAS in DNS message handling rule
using the Neasdf_DNSContext_Update Service. How the SMF determines the timer
is by implementation.
Table 6.18.1-1: Example of pre-conditions of configured the same EAS
+-------------------------------+-------------------------------------+ | Pre-condition | Actions to configured the same EAS | | | to the UEs which satisfies the | | | pre-condition | +===============================+=====================================+ | UE location: | Action 1: DNS message handling | | | rules | | - Cell ID: from XXX1 to XXX9 | | | | - Local DNS server = 10.1.1.1 | | - DNAI: from XXA to XXE | | | | - ECS option = X.X.X.X | | - TAI | | | | Action 2: EAS IP address | | Area(s) of Interest | | | | - 192.168.1.1 | | FQDN: | | | | | | FQDN = ABC.com | | | | | | UE Identifiers | | +-------------------------------+-------------------------------------+
### 6.18.2 Procedures
#### 6.18.2.1 EASDF-related procedure
Figure 6.18.2.1-1: EASDF related procedure to discover the same EAS
0\. The AF may request the indication of EAS correlation and pre-conditions
and the PCF creates the PCC rule correspondingly as described in clause
6.18.1.
0\. The SMF determines the pre-conditions of the UEs that should be configured
with the same EAS. The pre-conditions may be a local policy or derived based
on PCC rule received from PCF. The pre-conditions are defined below:
\- The same FQDN in DNS query or range of FQDNs that can be resolved to a
certain EAS IP address by DNS server. The same EAS can be mapped to one FQDNs
or a group of FQDNs. Only the collections of the UEs request the same DNS
query with these FQDNs, that the DNS server can provide the same EAS IP
address(es).
\- The collections of the UEs have the similar UE location, for example, the
same UE location or the UE location in the Area of Interest. According to the
UE location information or UE is IN/OUT of Area(s) of Interest, the 5GC can
identify that these UEs should be served by the same EAS. The UE location
includes: Cell ID, range of Cell ID, TAI lists, DNAI, range of DNAI, gNB ID,
range of gNB ID, DNN, S-NSSAI.
NOTE 1: If the pre-conditions are provided by AF and include location
information, then the SMF is aware the UE location is in or out of the
subscribed area of interest and sends notifications to the PCF, and the SMF
determines which UE collection the UE belongs to, as described in clause
6.18.1.
0\. The 5GC can deliver the same DNS server IP address to these UEs that
satisfy the pre-conditions, for example, the EASDF.
1\. The UE sends a DNS Query message to the EASDF.
2\. The same procedure as step 8 defined in figure 6.2.3.2.2-1 of TS 23.548
[3]. The EASDF provides the FQDN in DNS query to SMF.
3\. The same procedure as step 9 defined in figure 6.2.3.2.2-1 of TS 23.548
[3].
4\. [Conditional] The SMF determines the Area(s) of Interest and subscribes to
UE mobility event notification from the AMF (e.g. location reporting, UE
moving into or out of Area of Interest), or the UE location from AMF by
Namf_EventExposure_Subscribe (event ID = UE moving in or out of Area of
Interest, UE location). The UE location information and UE presence IN or OUT
of Area of Interest can be used by SMF to identify whether this UE should be
configured with the same EAS.
5\. [Conditional] The AMF responds to SMF.
6\. [Conditional] The AMF notifies the SMF of UE(s) presence (IN, OUT, or
UNKNOWN) in the Area(s) of Interest or the UE location information, including:
TAI, Cell ID and etc.
7\. SMF determines whether the UE is satisfied with the pre-conditions,
according to UE location information and/or FQDN(s). If the UE location
information is in the scope of UE location that defined in pre-conditions, and
the FQDN is also in the scope of pre-defined scope, the SMF determines:
\- use the same DNS server to resolve the FQDN. The DNS query should be
treated with the same way, that applied to the same DNS message handling
rules, e.g. the same DNS server address or information of EDNS Client Subnet
option is indicated in the Forwarding Action.
\- directly responds to the DNS query to UE. This way only applies to the
EASDF. That if the SMF identifies that the UE\'s DNS query should be replied
with the same EAS that other UEs use, the SMF can set the DNS message handling
rules to EASDF to directly respond with the DNS query without having the DNS
related procedure to DNS server, e.g. add a new action for Forwarding Action:
forward the DNS response with specific EAS IP address to UE. The SMF should
update the IP address of EAS in DNS message handling rule using the
Neasdf_DNSContext_Update Service based on the timer retrieved by
implementation.
NOTE 2: For the load balance of service, the DNS server can reply different IP
address of EAS. But, these IP addresses still stay in the same IP range or in
the similar IP range.
8\. The SMF updates the DNS message handling rule to guarantee the same EAS
discovery for this UE. The SMF invokes Neasdf_DNSContext_Update Request (DNS
message handling rules) to EASDF, and the DNS message handling rules are the
same as pre-defined of other UEs.
For Option A, the DNS handling rule includes the same corresponding IP address
to be used to build the EDNS Client Subnet option. For Option B, the DNS
handling rule includes corresponding Local DNS Server IP address which is also
the same as other UEs.
9-15. The same procedure from step 11 to step 19 as defined in figure
6.2.3.2.2-1 of TS 23.548 [3].
According to the enhancement from SMF, this UE can receive the same EAS IP
address as other UEs which satisfies the pre-condition.
#### 6.18.2.2 Direct DNS response to UE
Figure 6.18.2.2-1: Direct DNS response to UE
0-6. The same procedure as indicated in Figure 6.18.2.1-1 from step 0 to step
6.
7\. SMF determines whether the UE is satisfied with the pre-conditions,
according to UE location information and/or FQDN. The SMF can also recover the
DNAI, PSA ID, DNN, S-NSSAI of the UE or the UE\'s PDU Sessions. If the UE
location information in the scope of pre-defined UE location, and the FQDN is
also in the scope of pre-defined scope, the SMF determines to discover the
same EAS to this UE as other UEs in group. SMF decides to have a direct DNS
response to the UE.
8-9. The same procedure as indicated in Figure 6.18.2.1-1 from step 8 to step
9. But SMF invokes Neasdf_DNSContext_Update Request (DNS message handling
rules) to EASDF to directly respond to the UE DNS query with the same EAS IP
address that other UEs are served. The SMF should update the IP address of EAS
in DNS message handling rule using the Neasdf_DNSContext_Update Service based
on the timer retrieved by implementation.
10\. The EASDF sends the DNS Response(s) to the UE with the same EAS IP
address that other UEs are served.
#### 6.18.2.3 EAS Discovery Procedure with Local DNS Server/Resolver
Figure 6.18.2.3-1: EAS Discovery Procedure with Local DNS Server/Resolver
1\. The UE sends a PDU Session establishment request to SMF.
2\. SMF determines whether the UE is satisfied with the pre-conditions,
according to UE location information and FQDN. The SMF can also recover the
DNAI, PSA ID, DNN, S-NSSAI of the UE or the UE\'s PDU Sessions. If the UE
location information in the scope of pre-defined UE location, and the FQDN is
also in the scope of pre-defined scope, the SMF determines to discover the
same EAS to this UE as other UEs in group. The SMF determines the DNAI and
selects corresponding PSA UPF serves the DNAI, and determines DNS server(s) to
ensure a dynamic group uses the same EAS and/or same DNAI.
3\. Optionally, the SMF selects and inserts UL-CL/BP. The SMF configures the
UL-CL/BP for DNS Query handling.
4\. The SMF includes the IP address of Local DNS Server in PDU Session
Establishment Accept message.
5\. The EAS information (e.g. EAS IP address) is resolved by Local DNS Server
and sent the UE.
### 6.18.3 Impacts on services, entities and interfaces
SMF:
\- determines the pre-conditions of whether the collections of the UE should
be configured with the same EAS.
\- determines whether the UE is satisfied with the pre-conditions, according
to UE location information and FQDN.
\- decides to have a direct DNS response to the UE or configure the same DNS
message handling rule to this UE DNS query, according to the configurations in
the pre-conditions;
\- updates the IP address of EAS in DNS message handling rule using the
Neasdf_DNSContext_Update Service based on the timer retrieved by
implementation.
EASDF:
\- directly responds to the UE DNS query with the EAS IP address that other
UEs are served.
AF:
\- sends the indication of EAS correlation.
PCF:
\- creates PCC rule based on information provided in AF request.
## 6.19 Solution 19 (KI#4): Influencing UPF and EAS (re)location for
collections of UEs
### 6.19.1 Introduction
This solution aims to address the technical requirements related to key issue
#4. In particular, it proposes for certain Edge Application use case e.g. all
users playing a certain online game and registered to a particular EAS, or all
UEs in a platoon, how these UEs collectively for an ad hoc and dynamic group,
how to identify such group, how to handle coordination of the UPF(s) and EAS
(re)location for the UEs belonging to the same group.
### 6.19.2 Functional Description
The following are the main principles of the solution:
\- Application Function creates an ad hoc group of collection of UEs specific
to specific use cases and based on its respective criteria, for example: all
Users served by the same EAS that hosts an online gaming application, and ad
hoc group of UEs of a Platoon..
\- Application Function creates an ad hoc group of collection of UEs, and
provides to 5GC, either directly or via NEF, the necessary group specific
information, together with (external) group ID.
\- NEF performs AF request authorization and provides necessary mappings, and
configures UDM with the ad hoc group information.
### 6.19.3 Procedure
#### 6.19.3.1 AF provisioning ad-hoc group information
The figure 6.19.3.1-1 below provides a detailed call flow on ad hoc group and
group specific attributes provisioning by AF.
Figure 6.19.3.1-1: AF Provisioning Ad-hoc Group Information
1\. Application Function configures an ad hoc dynamic group of a collection of
UEs. These collection of UEs are based on common use case or application. e.g.
all users registered on a particular gaming server (EAS) or all UEs in a
platoon. AF assigns an (external) Group ID to this collection of UEs. AF
provisions this group information to 5GC either directly or via NEF and
provides required details including: (external) group ID, Group Type (this is
to differentiate with static groups based on user subscriptions), collection
of UEs IDs forming the group, i.e. list of group members, and group property
or attributes such as all users to be served by the same EAS.
Alternatively, AF may use new API e.g.
Nnef_GroupParameterProvision_Create/update/delete to provision these
information.
Group Type indicates specific ad hoc groups e.g. an ad hoc group specific to
platooning or an ad hoc group of UEs playing online game and registered to a
particular gaming server/EAS. Group Type may be used by NEF to translate group
specific 5GC internal requirements and store in the UDM/UDR as group attribute
information, for example:
\- all group members to be served by same SMF. This may be based on indication
from AF such as Specific Application e.g. platooning and/or based on
preconfigured logic of the NEF;
\- same PSA-UPF and DNAI for all UEs in the group. This may be based on
indication from AF such as same EAS, or Specific Application e.g. online
gaming or based on preconfigured logic on NEF.
2\. NEF after authorizing the AF request, creates or updates these information
in UDM. It translates AF provided information into corresponding 5GC internal
information such as external Group ID into an internal group ID. The Group
Attributes are group specific information such as indication to use same EAS
for all group members, or same PSA UPF.
NEF stores (or updates) these in UDM.
As specified in clause 4.15.6.2 of TS 23.502 [9], and clause 6.5.6.2.6 of TS
29.503 [18], UDM/UDR assigns/allocates a unique Internal Group ID.
3-4. UDM uses Nudr_DM_Query/Update to UDR. UDR stores the data as part of the
Group subscription data and responds with Nudr_DM_Create/Update/Delete
Response message.
Table 6.19.3-1: Ad hoc group data
Parameters Description
* * *
S-NSSAI (Optional) S-NSSAI for the ad hoc group DNN (Optional) DNN for the ad
hoc group Group Type Indicates specific ad hoc group e.g. platooning, online
gaming, etc. EAS ID (Optional) Edge Application Server ID e.g. application
server instance where users of the online gaming application are registered
Group Attributes Group type specific properties
Table 6.19.3-2: Ad hoc group membership management parameters
Parameters Description
* * *
External Group ID An identifier of the ad hoc group List of GPSI List of ad
hoc group members, each member is identified by GPSI
5\. UDM responds with Nudm_ParameterProvision_Create/Update/Delete Response.
6\. NEF responds to AF with Nnef_ParameterProvision_Create/Update/Delete
Response.
7\. UDM notifies to the subscribed Network Function e.g. AMF and SMF, of the
Group subscription data via Nudm_SDM_Notification Notify message. The SMF
stores the received parameters and associates them with a PDU Session based on
the DNN and S-NSSAI included in the message from UDM.
The group information is used e.g. by SMF to ensure collective and common
behaviour and treatment to the member UEs of the ad hoc group. For example,
all the UEs of a particular ad hoc group are (re-)located in the same EAS
instance as in solution 6.37.
#### 6.19.3.2 Group members served by same SMF
For certain group applications e.g. platooning, network can improve and
optimize services and possibly reduce management/signalling overhead by
ensuring same SMF (or SMF instances belonging to the same SMF set) serves all
the group member UEs. This SMF then provides common and coordinated treatment
of the group member UEs.
Below figure 6.19.3.2-1 provides details to allow the serving SMF to register
itself in the UDM/UDR updating the particular group information.
Figure 6.19.3.2-1: Serving SMF registers to the UDM/UDR
1-2. Same as in TS 23.502 [9].
3\. SMF registers SMF ID and/or SMF Set ID (serving the group), to UDM/UDR
and/or to NEF.
\- SMF uses Nudm_UECM_Registration API or a new message/API to register SMF ID
and/or SMF set ID to the particular ad hoc group ID.
\- Alternatively, SMF may update its SMF ID and/or SMF set ID for the
particular ad hoc group to UDR via NEF.
4-5. UDM may further store this information in UDR by Nudr_DM_Update, thus
updating ad hoc group attributes to indicate the serving SMF for the
particular Group.
### 6.19.4 Impacts on services, entities and interfaces
AF:
\- provisions ad hoc group information to the 5GC.
NEF:
\- authorizes, translates and stores ad hoc group information to UDM/UDR.
SMF:
\- subscribes to the ad hoc group subscription data, and also updates its ID
in the group information stored in the UDM/UDR.
## 6.20 Solution 20 (KI#5): Global EASDF
### 6.20.1 Description
This solution addresses KI#5: GSMA OPG impacts and improvements for EHE
operated by separate party.
In this solution, the UE uses a predefined EASDF that is global between
operators. For example, GSMA could host this with the URL:
http://easdf.mnc\.mcc\.pub.3gppnetwork.org
Each operator that wants to support separate party\'s EHE into their network
will then add these EHEs entry points into the DNS entry owned by themselves
in the Global EASDF. There are two alternatives to do this, either they add
the EAS entry point directly into the Global EASDF. The other alternative is
to add the entry point to another EASDF into the Global EASDF. With the second
alternative then the UE shall now use that received IP address as EASDF to
discover the appropriate EAS according to existing procedures. Since the
Global EASDF is based on standard DNS infrastructure that allows an operator
to specify which order the UE shall select EAS/EASDF in the different separate
party\'s operated EHEs. If we allow both alternatives, then it is up to each
operator to decide which method they want to use as long as we specify that
the UE shall support both methods. The second alternative with discovering
another EASDF allows more static configuration in the Global EASDF.
### 6.20.2 Procedures
#### 6.20.2.1 Global EASDF
Figure 6.20.2-1: Global EASDF
0\. Pre-requisites: HPLMN has configured the Global EASDF with appropriate
entries for all separate party\'s EASDF and/or their EAS they want to enable
in their network.
1\. Existing PDU Session establishment procedure according to step 1 in clause
6.2.3.2.2 of TS 23.548 [3].
2\. For Option A, the UE performs a DNS query to the Global EASDF. Since this
is a public FQDN to the Global EASDF, the UE may use any locally configured
DNS Server that in turn will use next DNS server in the DNS hierarchy until it
goes to the Global EASDF.
NOTE 1: The unique identifier to use for querying another EASDF will be
specified during the normative phase.
NOTE 2: The structure of the DNS Query is the same as defined in solution#09
in clause 6.9.
3\. The Global EASDF responds with the IP address of the EASDF that the UE
should use in next step.
4\. The UE performs EAS Discovery, as specified in step 7 in clause 6.2.3.2.2
of TS 23.548 [3] except that it uses the IP address received in step 3 as DNS
server for the DNS query instead of the one received during PDU Session
establishment procedure.
5\. EASDF sends the DNS Response to the UE, as specified in step 19 in clause
6.2.3.2.2 of TS 23.548 [3].
6\. For Option B, The UE performs EAS Discovery, as specified in step 7 in
clause 6.2.3.2.2 of TS 23.548 [3] and uses the IP address of the Global EASDF
instead of the one received during PDU Session establishment procedure.
7\. EASDF sends the DNS Response to the UE, as specified in step 19 in clause
6.2.3.2.2 of TS 23.548 [3].
8\. The UE application starts to utilize the provided EAS.
### 6.20.3 Impacts on services, entities and interfaces
UE:
\- configured with the FQDN for the Global EASDF. The UE allows to perform a
EASDF Discovery from the EASDF address that the UE received from the Global
EASDF.
Global EASDF:
\- acts as a DNS Server and responds to the DNS Queries from the UE.
## 6.21 Solution 21 (KI#5): EAS Deployment information differentiated by PLMN
ID
### 6.21.1 Introduction
This solution proposes an EAS discovery method for the scenario described in
clause 2.1.5 of GSMA OPG.02 [5] that an OP deploys applications provided by
Application Providers on another OP. This solution focuses on the scenario
that the OPs are different PLMNs. In this case, the problem is to ensure the
EAS deployed by HPLMN in VPLMN\'s EHE should only be discovered and accessed
by the UE of the HPLMN roaming to the VPLMN and using LBO PDU Session. This
solution introduces how to handle the DNS requests to ensure an EAS deployed
by a PLMN can only be accessed by the UE of same PLMN.
This solution corresponds to KI#5.
### 6.21.2 Functional Description
This solution is based on the following principles:
\- The EAS Deployment information provided by AF contains the EAS provider\'s
ID (i.e. PLMN ID) to differentiate the EAS deployment information of different
PLMNs. Different EAS providers (PLMNs) may use different DNS servers (e.g.
C-DNS server or Local DNS server) to discover the EAS deployed by the PLMNs.
\- During the PDU Session Establishment procedure, the SMF selects the proper
PLMN\'s EAS Deployment Information based on UE\'s HPLMN ID and then generates
corresponding DNS message handling rule to handle DNS messages related to the
roaming UE.
### 6.21.3 Procedures
The EAS Deployment Information Provision procedure reuses the procedure
defined in clause 6.2.3.4.2 of TS 23.548 [3]. The enhancement is that the EAS
Deployment information provided by AF in step 1 includes PLMN ID to
differentiate EAS deployment information of different PLMNs. EAS deployment
information of different PLMNs may contain different DNS servers (e.g. C-DNS
server or Local DNS server) or different ECS options.
The EAS Deployment Information Management in the SMF reuses the procedure
defined in clause 6.2.3.4.3 of TS 23.548 [3].
The EAS discovery procedure with EASDF defined in clause 6.2.3.2.2 of TS
23.548 [3] is reused to discover the EAS(s) deployed by different providers.
The enhancement is that the during the PDU Session Establishment procedure,
the SMF selects the proper provider based on HPLMN ID. The SMF queries the UDR
via NEF with the HPLMN ID to get the EAS Deployment information and configures
the EASDF with DNS message handling rules to handle DNS messages related to
the UE. Then the following steps in clause 6.2.3.2.2 of TS 23.548 [3] are
reused for DNS queries and UL-CL/BP insertion.
### 6.21.4 Impacts on services, entities and interfaces
AF:
\- supports sending EAS Deployment information with PLMN ID to differentiate
the EAS deployment information of different providers.
SMF:
\- supports selecting proper provider based on roaming UE\'s HPLMN ID and
configures the EASDF according to the EAS Deployment information of the HPLMN.
## 6.22 Solution 22 (KI#5): EAS discovery for Edge Node Sharing
### 6.22.1 Introduction
This solution addresses Key Issue #5 and allows the discovery of an Edge
Application Server (EAS) in case of Edge Node Sharing. In this solution, it is
assumed that the EAS is hosted by a different PLMN than the PLMN that is
serving the UE.
NOTE: It is assumed that the EAS is hosted by a different PLMN than the PLMN
serving the UE, and that the two PLMNs have IP connection at the edge area.
### 6.22.2 Functional description
#### 6.22.2.0 Option 0: SMF configuration
This solution is based on the Rel-17 EAS based discovery procedures with the
assumption that the SMFs of each PLMN Sharing Edge Node need to be configured
with the DNAI values associated to the EAS\' hosted by the other Operators.
More in details:
\- the SMF needs to know the EAS deployment information of the EAS running on
other PLMN\'s edge infrastructure e.g. IP address range(s)/FQDN(s).
For example, if the EAS is running in MNO 2\'s PLMN#2, when the EAS discovery
is triggered the EASDF in MNO 1\'s PLMN#1 will receive the DNS response from
the DNS server knowing the EAS\' address and will forward the EAS\' address to
the SMF in PLMN#1.
\- At this point, after the SMF gets the IP address of EAS running in PLMN#2,
in order to know that the EAS is instantiated in PLMN#2\'s edge
infrastructure, it is required that the SMF knows the mapping between the PLMN
ID of the PLMN hosting the EAS and the corresponding IP address received as a
result of the DNS query so that the SMF can steer the user plane path towards
the PLMN#2\'s domain. This may require an update of the SMF each time an EAS
is added or removed.
#### 6.22.2.1 Option 1: Shared EASDF
This option is based on the concept of shared EAS Discovery Function (shared
EASDF), which is a new network entity shared among multiple operators and used
to support the discovery of EAS for shared Edge Nodes.
Figure 6.22.2.1-1: Architecture with deployed Shared EASDF
The Shared EASDF is a new network entity deployed in the core network and
shared among the PLMNs of the MNOs that support Edge Node Sharing. The shared
EASDF is hosted by one PLMN. The PLMN hosting the shared EASDF is the anchor
PLMN. The communication between other PLMNs and the shared EASDF takes place
via the serving EASDF (sEASDF) and the serving SMF (sSMF), that is via the
EASDF and the SMF of the PLMN serving the UE. The sSMF handles the DNS context
on the shared EASDF in a similar way as for the sEASDF, i.e. via the
Neasdf_DNSContext_Create service.
The shared EASDF stores EAS deployment information such as EAS address hosted
by other PLMNs. An operator needs to update its EAS information in the shared
EASDF any time a change is applied (e.g. an EAS is added/modified/removed, or
an MNO joins or leaves sharing of Edge Node).
#### 6.22.2.2 Option 2: Per-PLMN EASDFs
This solution option is based on the communication between the EASDFs of the
different PLMNs of the MNOs that support sharing of Edge Nodes. The EASDF of a
PLMN manages information for EAS\' that are hosted by the Edge Data Network of
that PLMN, and the EASDF of a PLMN can interact with other PLMNs\' EASDFs to
support Edge Node Sharing.
**Architecture**
Figure 6.22.2.2-1: Architecture with per-PLMN EASDF
In the figure above:
\- serving EASDF (sEASDF) and the serving SMF (sSMF) are, respectively, the
EASDF and the SMF of the PLMN that is currently serving the UE;
\- partner EASDF (pEASDF) is the EASDF of the partner PLMN which hosts the
Edge Application Server whose service is desired.
**EAS Deployment Information extension**
By using the Nnef_EASDeployment APIs, the AF provides to the CN the EAS
Deployment Information (see table 6.2.3.4-1 of TS 23.548 [3]). Such
information needs to be associated to the additional PLMN ID(s) and FQDN
filter/DNS server address filter(s) to help the SMF identify, during EAS
discovery, where the EAS is located. Table 6.22.2.2-1 shows the filtering
information used to select the proper EAS and table 6.22.2.2-2 shows some
examples of FQDN/DNS server address filter(s).
Table 6.22.2.2-1: NEW: Filtering table for EAS Deployment Information
+-------------------+---------------------------------------------------+ | Parameters | Description | +===================+===================================================+ | PLMN ID(s) -- NEW | Used to identify in which PLMN the EAS is located | | | | | | [optional] | +-------------------+---------------------------------------------------+ | Filter(s) -- NEW | Used to identify where the EAS is located | | | | | | [optional] | +-------------------+---------------------------------------------------+
Table 6.22.2.2-2: NEW: Examples of Filters for EAS Deployment Information
DNS query content or DNS resolution DNS server address or FQDN filter Result
* * *
MNO1.xrgaming.edge MNO1.* Matched, select EASDF of MNO1
Battle.gamingX.edge.com *.gamingX.edge.* Matched, serving MNO knows in which
MNO \'gamingX\' is running, so select the MNO\'s EASDF 11.123.45.22 11.123.*
Matched, selected the EASDF of MNO1, which is corresponding to 11.123.*
**EAS Discovery**
The EAS discovery is based on the existing EAS discovery procedures described
in TS 23.548 [3], with the following changes:
\- provisioning of EAS deployment information to 5GS:
\- For each of its EASs, the application service provider (via the AF)
provides each PLMN Sharing Edge Nodes with the EAS deployment information with
PLMN ID, DNAI, and (list of) FQDNs necessary to discover the EAS. Such
information is stored in the UDR following the EAS Deployment Information
Provision from AF via NEF procedure (clause 6.2.3.4.2 of TS 23.548 [3]).
\- The SMF retrieves the EAS deployment information from the UDR (clause
6.2.3.4.3 of TS 23.548 [3]) and provides the following pieces of information
to the EASDF (clause 6.2.3.4.4 of TS 23.548 [3]):
a) FQDN filter: the list of filters regarding FQDN in the DNS query from the
UE;
b) DNS server address filter: the list of filters regarding DNS server address
in the DNS query from the UE;
c) PLMN ID associated with the FQDN filter or DNS server address;
d) Action: DNS query forwarding to the target pEASDF, reporting to the SMF.
\- EAS discovery:
\- At EAS discovery (clause 6.2.3.2.2 of TS 23.548 [3]), the sEASDF determines
the target pEASDF associated with the PLMN ID, if the received DNS query (from
the UE) meets the following conditions:
\- the FQDN in the DNS query matches with the configured FQDN filter
associated with the DNAI/PLMN ID;
\- the DNS server address in the query matches with the configured DNS address
filter with the DNAI/PLMN ID.
\- Based on the indication by the sSMF, the sEASDF forwards the query to
target pEASDF.
\- Target pEASDF replies with the specific DNAI/PLMN ID result.
\- The result is reported to the sSMF.
### 6.22.3 Procedures
#### 6.22.3.0 Option 0: SMF configuration
This option re-uses the EAS discovery procedure defined in clause 6.2.3.2.2 of
TS 23.548 [3].
#### 6.22.3.1 Option 1: Shared EASDF
Figure 6.22.3.1-1 describes a modified EAS discovery procedure based on the
Rel-17 procedure described in TS 23.548 [3].
Figure 6.22.3.1-1: Modified EAS discovery (clause 6.2.3.2.2 of TS 23.548 [3])
for Option 1
The procedure is based on the EAS discovery procedure defined in clause
6.2.3.2.2 of TS 23.548 [3], with the following changes:
\- new step 9a: based on the DNS message report sent by the sEASDF in steps
8/9, the SMF selects the shared EASDF.
\- new step 9b/c: the sSMF creates the DNS context in the shared EASDF.
NOTE 1: In case of IPv4, it is assumed that the SMF knows the UE\'s public IP
address. This can be done based on interaction with the NAT server and/or on
implementation specific ways.
\- steps 10/11: the sSMF instructs the sEASDF to forward the DNS query to the
shared EASDF. The sSMF provides to the serving EASDF the FQDN filter (e.g.
FQDN ranges) to be reported. The FQDN filter indicates that the shared EASDF
needs to be contacted to resolve the DNS query.
\- new step 11a: the sEASDF forwards the DNS query to the shared EASDF.
NOTE 2: While the sEASDF matches the DNS query with the DNS context for the UE
(as per Rel-17), the Shared EASDF does not need to do that because it uses the
DNS ECS option to select the most appropriate EAS. In that sense the Shared
EASDF behaves as a regular DNS server. The need to have a DNS UE context in
the Shared EASDF for UE accessing from partner PLMNs can be discussed in the
normative phase.
\- new step 13a: the shared EASDF resolves the DNS query and sends the DNS
reply to the sEASDF.
NOTE 2: Alternatively to steps 11a/13a, the DNS query can be forwarded by the
sEASDF to the shared EASDF via the SMF.
#### 6.22.3.2 Option 2: Per-PLMN EASDFs
Figure 6.22.3.2-1 describes the modified EAS discovery procedure based on the
Rel-17 procedure described in TS 23.548 [3].
Figure 6.22.3.2-1: Modified EAS discovery (clause 6.2.3.2.2 of TS 23.548 [3])
for Option 2
The procedure is based on the EAS discovery procedure defined in clause
6.2.3.2.2 of TS 23.548 [3], with the following changes:
\- in step 3: the sSMF may provide to the serving EASDF the Filters for EAS
Deployment Information (e.g. FQDN ranges) to be reported.
\- new step 9a: based on the DNS message report sent by the sEASDF in steps
8/9 and on mapping criteria (see e.g. clause 6.40) or local configuration
(i.e. a list of preconfigured, per partner PLMN DNS servers), the SMF selects
the pEASDF or the preconfigured DNS server, respectively.
\- steps 10/11: the sSMF instructs the sEASDF to forward the DNS query to the
selected partner EASDF or to at least one preconfigured DNS server in the
partner PLMNs.
\- new step 11a: the sEASDF forwards the DNS query to the pEASDF or to at
least one preconfigured DNS server in the partner PLMNs.
NOTE: While the sEASDF matches the DNS query with the DNS context for the UE
(as per Rel-17), the partner EASDF does not need to do that because it uses
the DNS ECS option to select the most appropriate EAS. In that sense, the
pEASDF behaves as a regular DNS server. The need to have a DNS UE context in
the pEASDF for UE accessing from partner PLMNs can be discussed in the
normative phase.
\- new step 13a: the pEASDF resolves the DNS query and sends the DNS reply to
the sEASDF. In case of multiple replies to the sEASDF, the sEASDF selects
(based on internal logic) which pEASDF (and, consequently, which partner PLMN)
is to be used for the EAS selection.
### 6.22.4 Impact on existing entities and interfaces
#### 6.22.4.0 Option 0: SMF configuration
SMF:
\- needs to know EAS deployment information (IP address range(s)/FQDN(s)) of
each EAS running in the PLMNs of the operators supporting Edge Node Sharing;
\- needs to be configured with mapping between EAS deployment information and
PLMN ID. If EAS\' are added or removed, the configuration information needs to
be updated.
#### 6.22.4.1 Option 2: Shared EASDF
EASDF:
\- requires capability to communicate with shared-EASDF forward DNS query to
and receive DNS response.
Shared-EASDF:
\- needs to be configured with IP range/FQDN of list of all EAS\' running in
PLMNs of operators participating in the Edge Node Sharing.
SMF:
\- needs to be configured with shared-EASDF address.
#### 6.22.4.2 Option 3: Per-PLMN EASDFs
EASDF:
\- requires capability to communicate with EASDFs of another PLMN to forward
DNS query to and receive DNS response.
SMF:
\- needs to be configured per-PLMN EASDF addresses.
AF:
\- provides CN with EAS Deployment Information with PLMN ID(s) and/or Filters.
## 6.23 Solution 23 (KI#5): Improvements for EHE operated by separate party
### 6.23.1 Introduction
This solution aims to address the technical requirements related to key issue
#5. In particular, it provides solutions to, among others, how the 5GS
facilitates edge relocation between an EAS deployed by a source EHE provider
to another EHE deployed by a target EHE provider, even in scenarios when EHEs
are operated by different service providers. This solution has following
architecture assumptions:
\- the architecture for Edge computing specified in Rel-17 is used as basis;
\- the Edge Hosting Environment (EHE) can be under the control of the serving
network operator or a 3rd party;
\- the target and source AFs communicate with the SMF/NEF of a single PLMN;
\- interconnectivity between EHEs of different operators is available, thus
those deployments that does not support this would need further enhancements.
### 6.23.2 Functional Description
The following are the main principles of the solution:
\- In case of multiple and/or different EHE providers, it is possible that
there is no cooperation and agreements among different Edge domains, thus
implying that source EHE is unaware of other/target EHE specific deployment
details. In such cases, specific to Edge relocation scenarios, source AF is
unaware of suitable target AF and/or target EAS. Thus, source AF is not always
able to assist suitable AF and EAS relocation as per clause 4.3 of TS 23.548
[3].
\- EHE providers likely have some kind of agreements with the 5GS, thus
enabling 5GS to know respective EHE domain deployment details and
corresponding AF, service area, TAI, application supported, etc.
### 6.23.3 Solution Details
\- The selection of the target EHE, and corresponding AF/EAS is triggered due
to multiple reasons, for example UE mobility, EAS overload, etc.
\- SMF is able to know AF in the target EHE. This may be possible with either
NRF or NEF maintaining AF list indicating for each AF one or more of these
parameters: EHE domain it supports, service area, application supported, etc.
This list could be based on e.g. pre-configuration and SLA with the EHE
domain. Accordingly, SMF selects suitable target AF based on e.g. UE current
location.
The figure 6.23.3-1 below provides call flow where AF and EAS relocations are
performed during early and late notifications.
Figure 6.23.3-1: Procedure to support EAS and/or AF relocation between EHE
from different provider
0\. SMF decides to relocate AF and/or EAS based on different criteria such as
UE new location, Anchor UPF relocation and so on.
1\. As part of early notification, SMF provides target AF ID i.e. ID of the AF
responsible for the new/target EC Domain corresponding to UE new location. SMF
also provides source AF transaction ID. These are provided in the
Nsmf_eventExposure_Notify and/or Nnef_TrafficInfluence_Notify.
2\. Source AF on receipt of message in step 1 above, initiates AF context
exchange and provides to target AF these information: source EAS ID, Service
ID, etc.
3\. Target AF responds by sending Relocation Reply with target EAS ID and
Service ID.
4\. EAS is relocated and if required application layer context are also
exchanged.
NOTE: This may require some application layer exchange between source and
target EAS/AFs. How these information are exchanged are outside the scope of
SA2.
5\. Source AF Acknowledges to SMF by sending
Nnef_EventExposure_AppRelocationInfo and Nsmf_EventExposure_AppRelocation_Info
messages.
6\. After confirmation from AF and considering information provided by AF, SMF
may re-configure user plane path, etc. as required.
7\. SMF sends Late notification to target AF in Nsmf_eventExposure_Notify
and/or Nnef_TrafficInfluence_Notify.
8\. Target AF sends acknowledgement to received late notification from SMF.
New traffic descriptors are provided to replace the old ones which were
provided earlier by the source AF.
9\. Target AF sends Relocation Complete to the source AF so that the later
deletes (relocated) EAS contexts.
## 6.24 Solution 24 (KI#1): Reuse Option D after UL-CL Insertion
### 6.24.1 Description
This solution addresses the following aspect in KI#1:
\- how to support Rel-17 edge computing related procedures, such as EAS
(re-)discovery, as specified in clause 6 of TS 23.548 [3].
Option D is specified in clause 6.2.3.2.3 of TS 23.548 [3] to support EAS
Discovery procedure with Local DNS Server/Resolver.
This solution addresses the scenario 2.2 of clause 5.1.2, that is, UE
accessing V-EHE via a Home Routed (HR) PDU Session (i.e. with PSA in HPLMN)
where HPLMN does not have the knowledge of EAS deployment information in
VPLMN.
This solution assumes that the V-SMF in the VPLMN is authorized by HPLMN to
insert the UL-CL and Local PSA during or after PDU Session Establishment based
on the VPLMN operator\'s configuration, which can be based on the conclusion
on other solutions for this key issue. With this assumption, Option D can work
for both LBO and HR roaming cases.
### 6.24.2 Procedure
Figure 6.24.2-1: EAS discovery with Local DNS server/resolver
1\. UL-CL and Local PSA are inserted by V-SMF. This procedure can happen
during PDU Session establishment or can be triggered by DNS messages as
defined in clause 6.2.3.2.2 of TS 23.548 [3]. During this procedure, the V-SMF
instructs the UL-CL the traffic routing rule to route the DNS Query for an
FQDN (range) to a local DNS Server/Local DNS Resolver.
NOTE 1: Option D assumes that UL-CL steering is based on L4 information (i.e.
DNS port number) and that UL-CL has visibility of the DNS traffic (i.e. FQDN
in the DNS Query message). The UPF may be instructed by the SMF to apply
different forwarding of non-ciphered UL DNS traffic based on the target domain
of the DNS Query. Option D requests modification of destination IP address of
DNS messages. Whether this is allowed or not is subject to local regulations.
Option D does not apply to DoH or DoT messages.
2\. The DNS Query message is sent by UE. The UL-CL locally routes the DNS
Query message to Local PSA.
3\. The Local PSA sends the DNS traffic to the Local DNS Server that resolves
the FQDN target of the DNS Query by itself or that communicates with a C-DNS
server to recursively resolve the EAS IP address.
NOTE 2: The Local PSA can send the DNS traffic to the Local DNS Server via
tunnelling or via IP address replacement. If IP address replacement is used,
the SMF sends the IP address of the Local DNS Server to the Local PSA and
instructs the Local PSA to modify the packet\'s destination IP address
(corresponding to EASDF) to that of the Local DNS Server.
4\. The Local PSA receives DNS Response message from Local DNS server, it
forwards it to the UL-CL/BP and the UL-CL/BP forwards the DNS Response message
to UE.
NOTE 3: If IP address replacement has been enforced at step 3, the Local PSA
replaces the source IP address to EASDF IP according to SMF instruction.
### 6.24.3 Impacts on services, entities, and interfaces
V-SMF:
\- supports UL-CL/Local PSA insertion, traffic routing rule configuration on
UL-CL to route the DNS Query for an FQDN (range) to a local DNS
Server/Resolver.
## 6.25 Solution 25 (KI#1): EAS discovery in VPLMN via V-EASDF for a HR PDU
Session
### 6.25.1 High level description
The solution addresses a scenario where the UE accesses EHE in VPLMN via a HR
PDU Session for the two sub-scenarios 2.1 and 2.2. in clause 5.1.2. In
addition, the solution includes an option that allows the HPLMN to monitor,
assist and validate VPLMN decisions for accessing EHE when that has been
triggered by HPLMN (scenario 2.1).
The authorization for the traffic offload for a HR PDU Session with given
S-NSSAI and DNN is received by the AMF from the UDM, based on a \"HR-LBO
allowed\" indication in the UE subscription data.
In scenario 2.1, HPLMN has the knowledge of EAS Deployment information (EDI)
in VPLMN for specific areas. In this solution, EDI Information structure in TS
23.548 [3] table 6.2.3.4-1 does not require VPLMN DNAIs, which simplifies the
information exchanged between all parties (VPLMN DNAIs in EDI to HPLMN require
that Home MNO understands the VPLMN DNAIs, that HPLMN shares them then with
the Service providers (SPs) it has agreements with, and that SPs provide EDI
related to VPLMN DNAIs and modify it if VPLMN DNAIs change). In this solution,
EDI information is structured and grouped based on common steering needs, e.g.
same SP EHE. As part of SLA between the HPLMN and VPLMN, HPLMN provides the
list of EC FQDNs and/or traffic descriptors (e.g. destination IP ranges) for
the traffic that would require access to EHE in VPLMN to trigger EAS Discovery
and local traffic routing in VPLMN. This information is used to set the UL-CL
filters and also to provision V-EASDF in the case of dynamic PSA insertion by
DNS-based EAS discovery. Alternatively, this information can be conveyed to
V-SMF by H-SMF during PDU Session establishment or update. AF can use clause
6.2.3.4 in TS 23.548 [3] EAS Deployment Information Management mechanisms to
create/update/delete HPLMN knowledge of EAS Deployment information of specific
services relevant for HPLMN roamers in VPLMN. A common steering identifier can
be used instead of DNAI.
For scenario 2.1, when HPLMN wishes to monitor, assist and validate VPLMN
decisions when HPLMN has triggered accessing EHE in VPLMN, the common steering
identifier refers to Geo Location Area in VPLMN. This alternative requires
that HPLMN knows how VPLMN ECSs map to the VPLMN Geo Location Areas.
For scenario 2.2, VPLMN has the knowledge of EAS Deployment information in
VPLMN for specific areas. Clause 6.2.3.4 in TS 23.548 [3] EAS Deployment
Information Management mechanisms can be used by AF to provide and keep
updated EDI in VPLMN via V-NEF, and by V-SMF to retrieve that data and use in
EAS Discovery procedures. Information can also be locally configured.
At HR PDU Session establishment, the HPLMN (H-SMF) receives V-EASDF address
from V-SMF. For V-EASDF to be the DNS resolver for the EC FQDNs, there are two
options:
\- A. H-SMF configures V-EASDF in the UE as DNS server for the PDU Session.
V-SMF may insert a UL-CL/BP and local PSA to reach the V-EASDF, to eliminate
DNS traffic tromboning. V-SMF gets the HPLMN DNS Resolver.
\- B. V-SMF receives the EC FQDNs (either by OAM or from H-SMF at PDU Session
establishment), and it configures a local UL-CL for replacement of the
destination IP address of DNS queries with EC FQDN to V-EASDF IP.
NOTE 1: The above solution is known as option D described in clause 6.2.3.2.3
in TS 23.548 [3]. Option D assumes that UL-CL steering is based on L4
information (i.e. DNS port number) and that UL-CL has visibility of the DNS
traffic (i.e. FQDN in the DNS Query message). The UPF can be instructed by the
SMF to apply different forwarding of unencrypted UL DNS traffic based on the
target domain of the DNS Query. Option D requests modification of destination
IP address of DNS messages. Whether this is allowed or not is subject to local
regulations. Option D does not apply to DoH or DoT messages.
V-SMF selects and inserts UL-CL/L-PSA for the DNS traffic at PDU Session
establishment and for the EC application traffic either statically at PDU
Session establishment, or dynamically, based on interaction with V-EASDF.
For scenario 2.2 in clause 5.1.2, dynamic EAS discovery and insertion of UL-CL
and local PSA happens in the V-PLMN based on V-EASDF as defined in TS 23.548
[3]. HPLMN does not need to know the EC deployment in VPLMN, VPLMN has the
knowledge of EAS Deployment information in VPLMN, and the selection is made by
V-SMF considering this information.
For scenario 2.1 in clause 5.1.2, the VPLMN does not know the EC deployment in
VPLMN (it is known by HPLMN), and V-SMF selects the L-PSA based on UE location
only. V-SMF selects the UL-CL and L-PSA based on V-EASDF notification as
defined in TS 23.548 [3], but without considering the EAS deployment
information. V-SMF uses information provided by HPLMN to set the UL-CL filters
and to provision V-EASDF.
For scenario 2.1, if Home MNO monitors, assists and validates the decisions
related to applications for which it has triggered user access to EHE in
VPLMN, H-SMF selects an H-EASDF that monitors the DNS resolution for those
applications and that validates the selected L-PSA. The address of the H-EASDF
for the PDU Session is sent to V-SMF as a next HPLMN DNS Resolver after
V-EASDF, which triggers validation in the following way:
\- V-EASDF appends to the UE DNS queries for EC FQDNs (agreed in the SLA, or
provided at session establishment) an ECS option based on current UE location
and sends it to H-EASDF.
\- H-EASDF notifies H-SMF of the query, also sending the ECS option received,
based on which H-SMF identifies the UE Geo Location Area and may select a
local DNS server for the query and provide it to H-EASDF.
\- Based on the information received from the H-SMF, the H-EASDF forwards the
query according to instruction, setting the next DNS server to the local DNS
server if one received
\- The DNS response is then received by H-EASDF, which notifies H-SMF. If an
EAS has been selected, H-SMF may instruct H-EASDF to include ECS back in the
response (the one provided by VPLMN in the DNS Query or one corresponding to
the EAS IP selection) and to forward the DNS Response to V-EASDF.
\- If the ECS is inserted in the response, this means that it has been used in
EAS selection. V-SMF then selects and inserts UL-CL and local PSA based on
notification received from V-EASDF considering the ECS received if any.
The solution is based on the Session breakout connectivity model in VPLMN.
In scenario 2.1, as part of SLA between the HPLMN and VPLMN, HPLMN may also
provide QoS policies for specific Applications to VPLMN. V-SMF may be
configured with limitations for roamers (and DNN/S-NSSAI) it enforces on HPLMN
provided policies. Alternatively, QoS rules can be conveyed to V-SMF by H-SMF
during PDU Session establishment or update as specific information or as an
indication to V-SMF to store the information sent to the UE in the NAS message
and the QoS profile sent to gNB.
In scenario 2.2, V-PCF may provide PCCs to V-SMF during PDU Session
Establishment.
To support charging in both PLMNs, the V-SMF provides Usage Reporting Rules to
the UL-CL/BP and local PSA to collect Usage Reports for charging in VPLMN that
it conveys to H-SMF.
### 6.25.2 Procedures
#### 6.25.2.1 PDU Session establishment and EAS discovery
The solution is shown in figure 6.25.2.1-1 below.
Figure 6.25.2.1-1: EAS discovery in VPLMN via HR PDU Session
0\. At UE registration procedure, the AMF receives a \"HR-LBO allowed\"
indication from the UDM for a given S-NSSAI and DNN. This is used by the AMF
to select a V-SMF with the required capability during the PDU Session
establishment procedure.
1\. UE sends PDU Session establishment request to V-SMF selected by the AMF.
AMF appends HR-LBO authorization indication to V-SMF.
2\. V-SMF takes into account the HR-LBO indication and may create an
association with V-PCF for local traffic offload policies. For scenario 2.2,
it may contact V-NEF to retrieve EAS Deployment Information. V-SMF selects UPF
and V-EASDF in VPLMN (that could be based on the policies fetched from V-PCR)
and sends Nsmf_PDUSession_Create Request to H-SMF, in which it indicates
support for EC, and also provides the V-EASDF address to H-SMF and recommended
indication for EDC usage for the PDU Session.
3\. H-SMF retrieves subscription information and policies for this UE and PDU
Session, and selects and configures UPF in HPLMN as in steps 7-12 in clause
4.3.2.2.2 of TS 23.502 [9], but the subscription information and policies
include the information related to the EC traffic that could be directed to
EHE in VPLMN. For scenario 2.1, H-SMF may contact H-NEF to retrieve EAS
Deployment Information.
4\. [Conditional] For scenario 2.1 in clause 5.1.2 if HPLMN monitoring,
assisting and validation, the H-SMF selects an H-EASDF and configures the DNS
handling rules in H-EASDF, via Neasdf_DNSContext_Create.
5\. The H-SMF sends Nsmf_PDUSession_Create Response to the V-SMF. H-SMF
provides V-SMF with the H-DNS server as resolver for non-EC FQDNs (in case of
Option A from clause 6.25.1). For scenario 2.1, the H-SMF response may include
QoS rules for this PDU Session. According to UE support, the H-SMF response
may also include in e PCO the vECS (Edge Configuration Server) information and
indication for EDC usage for the PDU Session for the UE. The DNS server
information in the PCO includes one of:
a. V-EASDF IP address (in case of Option A from clause 6.25.1); or
b. a H-DNS server (in case of Option B from clause 6.25.1).
For scenario 2.1, H-SMF may provide V-SMF with information of applications for
which to trigger routing to EHE in VPLMN (IP ranges and DNS domain name
ranges).
[Conditional] For scenario 2.1 if HPLMN monitoring, assisting and validation,
H-SMF also provides the address of the selected H-EASDF.
6\. The V-SMF performs UL-CL/BP and local PSA selection and insertion. The
V-SMF also provisions V-EASDF and UL-CL/BP to steer DNS traffic (only certain
FQDNs if Option B) towards V-EASDF IP address and local PSA.
7\. V-SMF configures the DNS handling rules in V-EASDF, via
Neasdf_DNSContext_Create.
8\. V-SMF sends PDU Session Establishment accept message including the PCO
received from H-SMF to the UE.
9\. UE sends a DNS query which includes FQDN for an EHE deployed in the VPLMN.
The query reaches V-EASDF via the local UL-CL and PSA (in case of both Options
A and B from clause 6.25.1).
10\. [Conditional] For scenario 2.2 and 2.1 in clause 5.1.2 without HPLMN
monitoring, assisting and validation, the EAS discovery and UL-CL/BP and local
PSA selection is performed as described in steps 8--19 from clause 6.2.3.2.2
in TS 23.548 [3], though information available in each scenario varies. For
scenario 2.1, V-SMF does not have EDI, and decision is mainly based on UE
location.
Steps 11-16. [Conditional] For scenario 2.1 in clause 5.1.2 with HPLMN
monitoring, assisting and validation:
11\. The DNS query triggers notification from V-EASDF to V-SMF, which provides
message handling rules to V-EASDF as described in steps 8-11 from clause
6.2.3.2.2 of TS 23.548 [3]. The rules include an ECS to append to the DNS
query corresponding to the candidate local PSA and H-EASDF as next DNS server
to send the query to. V-SMF does not have EDI, and decision is mainly based on
UE location.
12\. The DNS query is forwarded from V-EASDF to H-EASDF using the ECS received
from V-SMF in step 11.
13\. The procedure in steps 8-15 from clause 6.2.3.2.2 of TS 23.548 [3] is
repeated, where the DNS query triggers notification from H-EASDF to H-SMF, and
H-EASDF sends the DNS query to H-SMF together with the ECS received. This
triggers a validation process in H-SMF for UE Geo Location Area corresponding
to the received ECS. The SMF may instruct H-EASDF to send the query to a Local
DNS in the DNS handling rule. H-EASDF then handles the DNS resolution and
notifies the response to the H-SMF that may also validate the response. Note
that H-SMF does not deploy any UL-CL/BP and local PSA. H-SMF may instruct
H-EASDF to include ECS back in the response (the one provided by VPLMN in the
DNS Query or one corresponding to the EAS IP selection) and to forward the DNS
Response to V-EASDF.
14\. The DNS response is sent back the V-EASDF.
15\. V-EASDF notifies V-SMF that takes into account ECS and may modify the UP
path to steer application traffic to another L-PSA as in steps 14-18 from
clause 6.2.3.2.2 of TS 23.548 [3].
16\. If indicated so, the DNS response is sent back to the UE.
#### 6.25.2.2 EAS rediscovery due to UE or application mobility
The support for EAS rediscovery indication procedure enables the UE to refresh
stale EAS information stored locally so that the UE can trigger EAS discovery
procedure to discover new EAS information as described in clause 6.2.3.3 of TS
23.548 [3]. The corresponding EAS rediscovery procedure is shown in figure
6.25.2.2-1:
Figure 6.25.2.2-1: EAS rediscovery procedure due to UE mobility
0\. The procedure in clause 6.25.2.1 is executed with the following
differences required for EAS rediscovery:
In step 1, the UE may indicate its support for refreshing stale EAS
information stored locally corresponding to the impact field per the EAS
rediscovery indication from network.
If the UE indicates such support, then in step 5, H-SMF conveys this
indication to V-SMF and V-SMF stores this indication.
1\. Due to the UE mobility or AF influence on traffic routing to VPLMN (which
happens through V-NEF and V-PCF for scenario 2.2), the V-SMF triggers L-PSA
insertion, change or removal for the PDU Session.
2\. V- SMF sends PDU Session Nsmf_PDUSession_Update Request to H-SMF,
including:
\- an EAS rediscovery needed indication;
\- information about the impacted EAS(s);
\- [conditionally] if V-EASDF relocation is also needed, the new V-EASDF IP
address.
3\. H- SMF sends PDU Session Modification Command (EAS rediscovery indication,
[impact field]) to UE as described in step 2 of clause 6.2.3.3 of TS 23.548
[3]. The EAS rediscovery indication indicates to refresh the cached EAS
information. The impact field is used to identify which EAS(s) information
needs to be refreshed.
4\. H- SMF sends PDU Session Nsmf_PDUSession_Update Response to V-SMF.
5\. UE may trigger EAS discovery procedure to get new EAS information.
NOTE: For scenario 2.1, AF request to influence traffic routing towards the
HPLMN (H-SMF) is not possible if the EDI does not include DNAIs. The
Application mobility will in general not imply UL-CL/BP and L-PSA relocation
for scenario 2.1, as the L-PSA is selected based on UE location.
### 6.25.3 Impacts on services, entities and interfaces
UDM:
\- UE subscription information enhanced for authorizing the \"HR-LBO\".
AMF
\- handles \"HR-LBO\" in UE Subscription and takes it into account for V-SMF
selection.
V-SMF:
\- indicating support for EC and providing V-EASDF IP address and recommended
EDC usage indication to H-SMF;
\- supporting V-EASDF selection and interaction with V-EASDF using Neasdf
interface as in TS 23.548 [3];
\- supporting interaction with NEF in VLPMN to retrieve EDI as in TS 23.548
[3] (only scenario 2.2);
\- supporting UL-CL/BP and L-PSA selection and provisioning for session
breakout in HR PDU Session based for example on local configuration, and user
session information from policy association with VPCF, from HPLMN H-SMF,
and/or from V-EASDF;
\- sending EAS rediscovery needed indication and impacted EAS(s) information;
\- supporting V-EASDF interaction including instructions for tunnelling DNS
messages towards a next H-EASDF (only scenario 2.1 with HPLMN monitoring,
assisting and validation).
H-SMF:
\- provisions UE using (e)PCO via V-SMF with V-EASDF for the EC related DNS
queries (using option A from clause 6.25.2.1), EDC usage indication
(considering V-SMF recommendation) and vECS information for the VPLMN;
\- sends to V-SMF information related to local traffic routing such as the IP
address ranges and DNS domain name ranges for EC applications for which to
trigger steering to EHE in VPLMN. Information is based on HPLMN knowledge of
EDI (only scenario 2.1). It also sends the H-DNS;
\- sends H-EASDF IP address to V-SMF (including any tunnelling information)
and with H-EASDF it inspects/replaces/restores ECS information in received DNS
messages from VPLMN to monitor, assist and validate selected L-PSA vs the
selected EAS location (only for scenario 2.1 with HPLMN monitoring and
validation).
V-PCF:
\- provides local policies to V-SMF for HR-PDU Sessions.
EASDF:
\- sends DNS query/response over a tunnel (between V-EASDF and H-EASDF). EASDF
instructions include tunnelling information (only for scenario 2.1 with HPLMN
monitoring and validation).
## 6.26 Solution 26 (KI#1): SM Policy for HR Session Breakout in VPLMN
### 6.26.1 Description
This solution addresses the following aspects in KI#1 for the scenario where
Home Routed PDU Session is used with a PSA in the HPLMN:
\- how to authorize the PDU Session to support local traffic routing to access
an EHE in the VPLMN;
\- how to ensure proper policy control and QoS enforcement;
\- potential impact on Policy and QoS control.
This solution proposes how to obtain and apply Session Management policy when
a roaming UE establishes a Home Routed PDU Session supporting session breakout
in VPLMN to access EHE in VPLMN, assuming that HPLMN and VPLMN have an
agreement on supporting HR session breakout.
In this scenario, Session Management policy is created and applied for the HR
Session supporting session breakout as follows:
1) During the establishment of Home Routed PDU Session, if the roaming UE is
allowed to access the local part of DN, V-SMF selects a V-PCF that is capable
of providing SM policy for HR session breakout and requests, to the selected
V-PCF, SM policy for HR session breakout via SM policy association procedure.
2) The V-PCF provides SM Policy to the V-SMF based on the VPLMN operator
policy (option 1) or interaction with H-PCF (option 2).
3) The V-SMF executes the session breakout procedure and configures V-UPF
acting as UL-CL/BP, V-PSA (connected to local part of DN), and V-UPF
(connected with H-UPF for home routed session), respectively based on the SM
Policy. For example, usage monitoring control and QoS information can be
applied differently for the session toward the H-UPF and the local session to
the local part of DN (i.e. HR breakout session). Thus, different usage
monitoring control related information and QoS information such as Session-
AMBR are provisioned to the V-UPF connected with the H-UPF and the V-PSA
providing access to local part of DN, respectively.
### 6.26.2 Procedures
#### 6.26.2.1 Option 1: Indirect interaction between V-PCF and H-PCF
Figure 6.26.2.1-1: Option 1: SM Policy Association Procedure for HR Session
Breakout in VPLMN
1\. During the PDU Session establishment procedure, the AMF indicates to the
SMF that the HR session breakout is allowed.
2\. If the V-SMF is indicated by the AMF that the HR session breakout is
allowed, the V-SMF sends Session Management Policy Association Establishment
request to the V-PCF. The V-SMF provides the V-PCF with the indication to
request HR session breakout related policy.
3\. The V-PCF makes the authorization and the policy decision for HR session
breakout, and sends SM Policy Establishment response to the V-SMF. The V-PCF
provides policy information that may include QoS constraints (e.g. including
HR breakout session AMBR constraint) or usage monitoring control related
information (e.g. AMBR and volume threshold for the session toward the local
part of the DN) for the HR breakout session.
4\. The V-SMF sends PDU Session Create Request to H-SMF. The V-SMF provides
the H-SMF with the VPLMN-provided policy information for the HR breakout
session.
5\. The H-SMF retrieves Session Management subscription data related to the HR
breakout session (e.g. Subscribed HR breakout session AMBR from UDM) for the
VPLMN. The Session Management subscription data related to the HR breakout
session may be associated with PLMN ID (i.e. VPLMN ID).
6\. The H-SMF performs SM Policy Association Establishment with the H-PCF. The
H-SMF provides the H-PCF with the received VPLMN-provided policy information
for the HR breakout session and Subscribed HR breakout session AMBR retrieved
from UDM. The H-PCF executes the authorization and the policy decision for HR
roaming session with taking VPLMN-provided policy information and Subscribed
HR breakout session AMBR retrieved from UDM into account. The H-PCF provides
the authorized SM policy information to the H-SMF as the response to the SM
Policy Association Establishment request.
7\. The H-SMF sends PDU Session Create Response to V-SMF. The H-SMF provides
HPLMN-authorized policy information.
8\. The V-SMF performs SM Policy Association Modification with V-PCF based on
the policy information from the H-SMF. The V-SMF performs the insertion of
V-UPF acting as UL-CL with configuring the authorized SM policy (e.g. HR
breakout session AMBR) into it.
#### 6.26.2.2 Option 2 --- Direct interaction between V-PCF and H-PCF
Figure 6.26.2.2-1: Option 2: SM Policy Association Procedure for HR Session
Breakout in VPLMN
0\. During the Registration procedure, the AMF is indicated by the UDM that
the HR session breakout is allowed. This indication can be per DNN/S-NSSAI.
The AMF performs discovery and selection of the H-PCF that is capable of
providing SM Policy for HR session breakout if the AMF receives the HR session
breakout allowed indication from the UDM.
1\. During the PDU Session establishment procedure, the AMF sends Session
Management Context Create Request including the selected H-PCF information and
the indication to the SMF that the HR session breakout is allowed.
2\. If the V-SMF is indicated by the AMF that the HR session breakout is
allowed, the V-SMF sends Session Management Policy Association Establishment
request to the V-PCF. The V-SMF provides the V-PCF with the indication to
request HR session breakout related policy and the H-PCF information.
3\. The V-PCF determines to interact with the H-PCF identified by the AMF-
provided H-PCF information and sends SM Policy Establishment request. The
V-PCF provides the H-PCF with the VPLMN-supported policy information that may
include QoS constraints or usage monitoring control related information (e.g.
AMBR and volume threshold for the session toward the local part of the DN) for
the HR breakout session in VPLMN.
4\. The H-PCF executes the authorization and the policy decision for HR
roaming session with taking the received policy information into account. The
H-PCF provides the authorized SM policy information to the V-PCF as the
response to the SM Policy Association Establishment request.
5\. The V-PCF forwards the received SM policy information to the V-SMF.
6\. The V-SMF sends PDU Session Create Request to H-SMF after UPF selection
and configuration in VPLMN based on the received SM policy information. The
V-SMF provides the H-SMF with the applied SM policy information in VPLMN and
information of the H-PCF that establishes SM Policy Association with the
V-PCF.
7\. The H-SMF retrieves Session Management subscription data related to the HR
breakout session (e.g. Subscribed HR breakout session AMBR from UDM) for the
VPLMN. The Session Management subscription data related to the HR breakout
session may be associated with PLMN ID (i.e. VPLMN ID).
8\. The H-SMF performs SM Policy Association Establishment with the H-PCF of
which information is provided by the V-SMF. The H-PCF executes the
authorization and the policy decision for HR roaming session with taking the
VPLMN-provided policy information into account. The H-PCF provides the
authorized SM policy information to the H-SMF as the response to the SM Policy
Association Establishment request.
9\. The H-SMF sends PDU Session Create Response to V-SMF. The V-SMF performs
the insertion of V-UPF acting as UL-CL with configuring the authorized SM
policy (e.g. HR breakout session AMBR) into it.
### 6.26.3 Impacts on existing entities and interfaces
V-SMF:
\- supports SM Policy Association with the V-PCF for the HR PDU Session;
\- supports to provide VPLMN-provided policy information to the H-SMF;
\- supports to insert the V-UPF acting as UL-CL for the HR PDU Session and
provide enforcement rule information (e.g. HR breakout session AMBR).
V-PCF:
\- supports SM Policy Association with the V-SMF, authorization and policy
decision for the HR Session breakout in VPLMN;
\- supports SM Policy Association with the H-PCF (for option 2).
H-SMF/H-PCF:
\- supports SM Policy Association with taking VPLMN-provided SM Policy
information into account;
\- (H-SMF) supports to retrieve the subscription information related to HR
session breakout.
AMF:
\- supports to indicate V-SMF that HR session breakout is allowed;
\- supports discovery and selection of SM PCF in HPLMN (for option 2).
UDM:
\- supports to store the subscription information for whether HR session
breakout is allowed and indicate AMF that HR session breakout is allowed based
on the stored information;
\- supports to store the subscription information for QoS constraints on HR
breakout session such as Subscribed HR breakout session AMBR.
## 6.27 Solution 27 (KI#1): EAS discovery with dynamic setup of a LBO PDU
Session
### 6.27.1 High level description
The solution addresses a scenario where the UE accesses EHE in VPLMN via a LBO
PDU Session.
UE initially connects to the HPLMN. The transition from a HR PDU Session to a
LBO PDU Session takes place based on a trigger to the H-SMF, which may be e.g.
a DNS query from the UE towards an EC FQDN or an AF influence of traffic
routing for the UE. The latter may be issued by an AF of the VPLMN too. H-SMF
determines that a LBO PDU Session to the VPLMN is needed, based on:
\- Information provided by VPLMN at PDU Session Establishment, like indication
of support for Dynamic set up of LBO for the PDU Session and information
related to supported edge computing applications, i.e. Application IDs, or
FQDN ranges;
\- the FQDN in the UE DNS query and EDI available in HPLMN for the given FQDN,
where the DNAI is relevant for a certain PLMN in the EDI, i.e. there is an
associated information in the EDI stating which PLMN is relevant for the DNAI;
\- the DNAI in the N6 routing information in the AF influence of traffic
routing, where the DNAI has associated PLMN information;
\- policy information available in the H-SMF (that could be provided by H-PCF)
regarding the requested FQDN or DNAI.
Then, H-SMF sends a LBO session authorization indication to the AMF via V-SMF
-- optionally including a DNAI e.g. if previously received from the AF in the
N6 routing information -- and then it requests the PDU Session release with
indication that PDU Session re-establishment to the same DN is required.
NOTE 1: The LBO session authorization indication overrides the subscription
data.
NOTE 2: The HPLMN ensures that there are no URSP rules in the UE conflicting
with the LBO authorization for this PDU Session, e.g. no other traffic that
requires HR PDU Session should be mapped to the same DNN and S-NSSAI that
could be authorized for LBO. If the information related to supported Edge
Computing applications sent by the VPLMN is in collision with the current URSP
rules in HPLMN for some application, then the HPLMN can just omit this
information and not authorize the PDU Session for LBO for the given
application.
NOTE 3: Terminating the HR PDU Session before establishing the LBO PDU Session
as in SSC#2 impacts the ongoing traffic on that PDU Session, e.g. TCP
connections break and QUIC connections are interrupted until the connectivity
is re-established on the new LBO PDU Session.
The AMF decides to set up a LBO PDU Session for the next UE PDU Session
establishment request from the UE for the same DNN and S-NSSAI, based on the
authorization indication received from the H-SMF. Then it selects V-SMF based
on internal configuration or target DNAI received and it also conveys a target
DNAI to V-SMF corresponding to the DNAI received from H-SMF. The V-SMF selects
a PSA based on the DNAI information received from AMF (if available) or based
on policy information and may also configure a V-EASDF if dynamic EAS
discovery is to be used.
NOTE 4: An LBO PDU Session can be established for this DNN, and it is assumed
that configuration in VPLMN for this DNN has been set accordingly.
The solution requires a H-EASDF is selected for this HR PDU Session in HPLMN
for the case of LBO PDU Session dynamically triggered by DNS EAS discovery and
EAS discovery can be applied for all connectivity models in V-PLMN, in the
following way:
\- in case of Distributed anchor and Multiple PDU Sessions connectivity
models, the V-SMF selects a local anchor to the UE\'s current location based
on policies for this DNN. EAS (re-)discovery happens as described in clause
6.2.2 of TS 23.548 [3];
\- in case of Session Breakout, the V-SMF selects an UL-CL/BP and local anchor
based on:
\- the DNAI received from the AF in the AF influence of traffic routing if a
DNAI for an N6 routing is specified; or
\- the FQDN of a subsequent UE DNS query, as described in clause 6.2.3.2.2 in
TS 23.548 [3].
V-SMF may initiate termination of the LBO PDU Session if traffic ceases
towards the EHE.
### 6.27.2 Procedures
The solution is shown in figure 6.27.2-1 below.
Figure 6.27.2-1: EAS discovery in VPLMN with dynamic setup of a LBO PDU
Session
1\. HR PDU Session Establishment to H-SMF and UPF1, according to the procedure
described in clause 4.3.2.2.2 of TS 23.502 [9] with the difference that AMF or
V-SMF, based on configuration, sends indication to support Dynamic set up of
LBO for this PDU Session. Optionally, based on configuration, V-SMF also sends
information related to supported edge computing applications, i.e. Application
IDs, or FQDN ranges. In case of dynamic setup of a LBO PDU Session by DNS,
allocation of an H-EASDF and sending rules to the EASDF also happens according
to steps 1-6 in the clause 6.2.3.2.2 for EAS Discovery Procedure with EASDF
for Session Breakout connectivity model in TS 23.548 [3].
2a. [Conditional] The UE sends a DNS Query message for an FQDN to the EASDF
via Central PSA. Steps 7-11 in the procedure in clause 6.2.3.2.2 in TS 23.548
[3] for EAS Discovery Procedure with EASDF for Session breakout Connectivity
are applied. That is, the H-EASDF checks the DNS Query against the DNS
Handling Rules in the DNS Context and reports to H-SMF.
2b. [Conditional] The AF sends a request on traffic routing for the UE as
specified in clauses 4.3.6.2 or 4.3.6.4 of TS 23.502 [9], impacting the
existing PDU Session. Therefore, H-PCF updates the H-SMF with corresponding
new policy information about the PDU Session by invoking
Npcf_SMPolicyControl_UpdateNotify service operation as described in steps 5
and 6 in clause 4.16.5 of TS 23.502 [9].
3\. Based on either 2a or 2b, H-SMF determines that an LBO PDU Session to the
VPLMN is needed, as described in clause 6.27.1 above. If 2a, H-SMF removes the
Session Context in H-EASDF and the DNS Query is discarded.
4\. H-SMF invokes Nsmf_PDUSession_StatusNotify service operation to the V-SMF,
sending an indication that LBO is authorized for the next PDU Session
establishment for this UE, DNN and S-NSSAI, and optionally also sending a
target DNAI to the AMF for the local PSA to be selected for the next PDU
Session request from the UE for the same DNN and S-NSSAI. H-SMF sends an \"AMF
acknowledgment requested\" indication within this message and a validity
indication that shows for how long the AMF should keep the information
received and apply it for the next PDU Session.
5\. V-SMF invokes Nsmf_PDUSession_SMContextStatusNotify service operation to
the AMF including the received indication that LBO is authorized and target
DNAI. V-SMF acknowledges the notification from step 4 after receiving the AMF
acknowledgment to this notification.
6\. H-SMF triggers a PDU Session change from HR (UPF1) to LBO (UPF2), using
one of the procedures below:
\- SSC#2: H-SMF triggers a HR PDU Session release, as described in clause
4.3.4.3 of TS 23.502 [9]. Indication that PDU Session re-establishment to the
same DN is required is included.
At the next UE request for PDU Session establishment for the same DNN and
S-NSSAI, based on the LBO authorization indication and target DNAI received in
step 5, AMF decides on a LBO PDU Session establishment towards a proper V-SMF
and UPF 2, as specified in clause 4.3.2.2 of TS 23.502 [9]. EAS discovery then
happens as described in clause 6.27.1 above.
\- SSC#3: H-SMF triggers a HR PDU Session modification, as described in clause
4.3.3.3 of TS 23.502 [9]. where PDU Session ID indicates the existing PDU
Session to be relocated and Cause indicates that a PDU Session re-
establishment to the same DN is required. A PDU Session Address Lifetime value
may also be provided.
The UE may decide to initiate the PDU Session Establishment request to the
same DNN and S-NSSAI described in clause 4.3.2.2 of TS 23.502 [9], with the
differences described in clause 4.3.5.2 of TS 23.502 [9]. Based on the LBO
authorization indication and target DNAI received in step 5, AMF decides on a
LBO PDU Session establishment towards a proper V-SMF and UPF 2, as specified
in clause 4.3.2.2 of TS 23.502 [9].
The old PDU Session may be released as described in clause 4.3.4.3 either by
the UE before the timer provided in step 3 expires (e.g. once the UE has
consolidated all traffic on new PDU Session or if the session is no more
needed) or by the H-SMF upon expiry of this timer.
### 6.27.3 Impacts on services, entities and interfaces
H-SMF:
\- determines that a LBO PDU Session to the VPLMN is needed for a given UE and
PDU Session;
\- sends an indication to AMF that LBO is authorized for the next PDU Session
establishment and a validity indication.
AMF:
\- logic to switch to LBO PDU Session for a PDU Session establishment request
based on the LBO authorization and validity indications previously received
from the H-SMF via V-SMF.
AMF or V-SMF:
\- indication to support dynamic set up of LBO for this PDU Session.
V-SMF:
\- sends information related to supported edge computing applications, i.e.
Application IDs, or FQDN ranges.
## 6.28 Solution 28 (KI#1): Support edge computing in Roaming
### 6.28.1 Description
#### 6.28.1.1 General
When the UE powers on in visited PLMN and does not have initial registration,
the following procedures are performed:
\- When the UE registers in the visited PLMN, the updated URSP rules is
provided by H-PCF via V-PCF. In the updated URSP rules, the EAS IP address
which located in the visited PLMN is included, and the URSP rules can trigger
to establish an LBO session or apply the application traffic which connects to
EAS in visited PLMN by LBO PDU Session.
\- If the URSP rules in visited PLMN are not updated timely, or the URSP rules
related to EAS in visited PLMN do not exist, the UE should establish the PDU
Session either LBO PDU Session or HR PDU Session. The UE should be configured
with the DNS server in visited PLMN scenarios and triggers the DNS query of
FQDN.
In the LBO PDU Session, the V-SMF delivers the DNS server IP address to UE via
NAS messages. For the HR session, the H-SMF is responsible for configuring the
DNS server IP address to UE via NAS messages.
In the LBO PDU Session, the UE can connect to EAS in visited PLMN via visited
local PSA. But for the HR session, after DNS server responds with the DNS
response, the home PLMN should trigger a UL-CL insertion for the local
breakout session to offload the UE traffic to visited EAS.
#### 6.28.1.2 ECS configuration information Configuration Information
configuration in UE
To support EDGEAPP in SA6, the UE in visited PLMN should receive the ECS
configuration information Configuration Information.
When UE in LBO session, the V-SMF retrieves the UE subscription data in UDM
and delivers the ECS configuration information to UE in ePCO.
When UE in HR session, the H-SMF checks the UE subscription in UDM and
retrieves the ECS configuration information. After that, the H-SMF delivers
the ECS configuration information to V-SMF, and the V-SMF delivers the ECS
configuration information to UE in ePCO.
All of the ECS configuration information above should be retrieved per VPLMN
ID.
Also, in order to support to establish the LBO PDU Session to ECS, the 5GC can
also support to distribute the updated URSP rules to UE. When UE has the
traffic towards ECS in visited PLMN, the URSP rules with ECS configuration
information can trigger an LBO PDU Session establishment or apply the traffic
to LBO PDU Session.
### 6.28.2 Procedures
#### 6.28.2.1 UE registers in VPLMN and URSP rules updated timely
Figure 6.28.2.1-1: UE registers in VPLMN and URSP rules updated timely
1\. UE powers on in roaming PLMN initially.
2\. The UE registers into the visiting PLMN, and the URSP rules are delivered
from 5GC to UE timely. Some of the URSP rules which related to the EAS located
in VPLMN and ECS are provided by 5GC.
3\. The application on UE has the traffic to be sent to EAS 1, and the UE uses
the URSP rules to trigger a new LBO PDU Session establishment.
4\. UE triggers to establish an LBO PDU Session with the parameters that
provided by the RSD in URSP rules which the URSP rules is related to EAS l
located in VPLMN.
5\. During the LBO PDU Session establishment procedure, the V-SMF is
responsible for selecting local DNS server (e.g. V-EASDF) for UE in VPLMN.
Also, the V-SMF should retrieve the UE subscription data from UDM to obtain
the ECS configuration information. Each ECS configuration information is
associated with the visiting PLMN ID. The related UPF should be configured
with the routing rules to route the UE DNS query to local DNS server. Also,
the V-SMF should authorize in UDM that whether the UE can consume the EASDF to
discovery the EAS in VPLMN.
6\. The V-SMF delivers the local DNS server IP address and ECS configuration
information to UE in ePCO via DL NAS messages.
7\. The IP connection between UE and EAS 1 is established.
8\. For EAS 2 deployed in VPLMN, if there is no such URSP rules related to EAS
2 in UE, the UE can only receive the FQDN related to EAS 2 to trigger DNS
query towards the local DNS server received from V-SMF via ePCO in step 7.
9\. The DNS query is routed to local DNS server via local PSA in VPLMN. If the
V-EASDF is selected for the UE in VPLMN, the V-EASDF should use the Rel-17
mechanism to apply the DNS message handling rules to DNS query.
10\. The UE receives the DNS response from local DNS server.
11\. The IP connection between UE and EAS 2 is established.
#### 6.28.2.2 UE registers in VPLMN and URSP rules are not updated timely
If the UE registers to 5GS and the URSP rules which related to the EAS
deployed in VPLMN not timely, and the UE has the DNN, S-NSSAI in VPLMN, the UE
can only establish an LBO PDU Session with the DNN, S-NSSAI in VPLMN.
During the LBO PDU Session establishment, the V-SMF delivers the local DNS
server IP address and ECS configuration information to UE in ePCO via DL NAS
messages. UE triggers the DNS query to local DNS server with the FQDN, and the
local DNS server responds with the EAS IP address.
The overall procedures are similar to the procedure in clause 6.28.2.1 from
step 4 to 11 without step 7.
#### 6.28.2.3 HR session to support Edge computing
If the UE registers to 5GS and the URSP rules which related to the EAS are
deployed in VPLMN not timely, and the UE does not have the DNN, S-NSSAI in
VPLMN, the UE can only establish an HR PDU Session with the DNN, S-NSSAI in
HPLMN. During the HR session, the edge computing features can be guaranteed.
In this procedure, it is supposed that the HPLMN can obtain the EDI from
VPLMN.
Figure 6.28.2.3-1: HR session to support Edge computing
The overall procedure in figure 6.28.2.3-1 are similar as the procedure in
figure 4.3.2.2.2-1 of TS 23.502 [9], but with the following changes and
differences:
12\. The H-SMF retrieves the subscription data in UDM. The subscription data
includes two parts. The first one is, whether the UE is authorized for the
edge computing service in VPLMN. Some of the traffic should be offloaded in
VPLMN, not re-routed to the HPLMN. The second one is, the H-SMF retrieves the
ECS configuration information from UDM, per VPLMN.
14\. H-SMF selects the H-EASDF for the UE.
15-18. Due to the H-SMF should configure the baseline DNS pattern in the
H-EASDF or the DNS handling rules, the EDI is required. But the EDI related to
VPLMN is stored in V-UDR and the H-SMF should retrieve the EDI in VPLMN.
The H-SMF triggers the V-NEF discovery to H-NRF using the
Nnrf_NFDiscovery_Request, and the H-NRF invokes the Nnrf_NFDiscovery_Request
service to vNRF. The association between H-NRF and V-NRF are referred to the
procedure in figure 4.3.2.2.3.3-1 of TS 23.502 [9]. The V-NRF responds with
the IP address of V-NEF to H-NRF, to H-SMF.
19-23. After the V-NEF is discovered, the H-SMF subscribes or gets the EDI
from V-UDR via V-NEF. These procedures are similar to the procedure in TS
23.548 [3].
24-25. After the retrieving the EDI from VPLMN, the H-SMF configures the
baseline DNS pattern towards H-EASDF.
29\. The H-SMF configures the routing rules in H-UPF to route the UE DNS query
towards H-EASDF.
31\. The H-SMF responds to V-SMF with Nsmf_PDUSession_Create response. In the
response, the ECS configuration information and H-EASDF IP address are
included.
#### 6.28.2.4 When UE moving into VPLMN and the original EC-session are
impacted
For the situation when the UE moves into the VPLMN and the original EC session
will be influenced. The UE should re-discover another EAS from the DNS
procedure.
In order to not stop the traffic and business, the UE should discover a new
EAS and performs the EAS relocation procedure.
The details of the procedure are listed below:
Figure 6.28.2.4-1: EAS relocation from EAS in HPLMN to VPLMN
1\. The UE is the status of roaming in VPLMN, and the original PDU Session to
EAS in HPLMN are influenced, for example, the EAS in HPLMN becomes suboptimum
for UE to connect.
2\. The HR session is established to continue the old PDU Session to EAS in
HPLMN.
3a. The 5GC triggers an indication to UE to refresh the DNS cache that the old
cache still reflects the mapping table between FQDN and EAS IP address located
in HPLMN.
3b. If the HR session changes the IP address of PDU Session, for example, due
to the relocation of PSA in HPLMN and the IP address of PDU Session is
changed, the UE refreshes the DNS cache stored in HPLMN.
4\. The DNS cache is cleared or refreshed.
5\. The UE triggers a new DNS query with the FQDN towards the local DNS server
or H-EASDF.
6\. The old EAS deployed in HPLMN relocates to the new EAS located in VPLMN.
### 6.28.3 Impacts on services, entities and interfaces
H-SMF:
\- retrieves the EDI from V-UDR via V-NEF;
\- retrieves the indication of whether the EC feature is supported in VPLMN
and ECS address from UDM.
V-UDR:
\- supports to provide the EDI in VPLMN to HPLMN.
V-SMF:
\- supports to retrieve the ECS address from UDM;
\- delivers the DNS server IP address to UE via NAS messages.
UDM:
\- stores the ECS configuration information by PLMN basis.
## 6.29 Solution 29 (KI#3): Use of Internal Group ID and constraints in EDI
### 6.29.1 High level description
To identify a finer granularity of UEs, Internal Group ID is to be used. There
is no practical limit for how many Internal group IDs that can be assigned in
a 5GS. The structure of an Internal Group ID is as follows:
Figure 6.29.1-1: Internal Group ID structure
A UE can be associated with a number of Internal Group IDs as per TS 23.501
[2]. Stage 3 has not specified any limit for how many internal groups a UE can
be associated with.
To support different constraints related to EC, the solution uses EDI, which
is enhanced with a constraints field that tells under which constraints the
EDI record applies. The EDI can be provisioned by an operator though OAM to
UDR (or via NEF) or the EDI can be provided by an AF.
Example of the updated EDI from table 6.2.3.4-1 in TS 23.548 [3]:
Table 6.29.1-1: EDI parameters
+----------------------------------+----------------------------------+ | Parameters | Description | +==================================+==================================+ | DNN | DNN for the EAS Deployment | | | Information. | | | | | | [optional] | +----------------------------------+----------------------------------+ | S-NSSAI | S-NSSAI for the EAS Deployment | | | Information. | | | | | | [optional] | +----------------------------------+----------------------------------+ | External Group | Group ID for the EAS Deployment | | Identifier/Internal Group | information. | | Identifier | | | | [optional] | | | | | | NOTE: The AF may provide | | | External Group Identifier, and | | | NEF can map the External Group | | | Identifier into Internal Group | | | Identifier according to | | | information received from UDM. | +----------------------------------+----------------------------------+ | Application ID | Identifies the application for | | | which the EAS Deployment | | | Information corresponds to. | | | | | | [optional] | +----------------------------------+----------------------------------+ | **Constraints** | **When and where this EDI | | | appliesÂ´** | | | | | | **Example:** | | | | | | **Time: 08:00-17:00** | | | | | | **Place: TAI-list** | +----------------------------------+----------------------------------+ | FQDN(s) | Supported FQDN(s) for | | | application(s) deployed in the | | | Local part of the DN. | +----------------------------------+----------------------------------+ | DNS Server Information | list of DNS server identifier | | | (consisting of IP address and | | | port) for each DNAI. | | | | | | [optional] | +----------------------------------+----------------------------------+ | EAS IP address range Information | IP address(s) of the EASs in the | | | local DN for each DNAI. | | | | | | [optional] | +----------------------------------+----------------------------------+
NOTE: External/Internal Group IDs in this solution are all provisioned via OAM
procedures to UDM.
### 6.29.2 Impacts on services, entities and interfaces
SMF:
\- needs to take the constraints into account when constructing DNS handling
rules to EASDF, and action taken when EASDF notifies SMF due to a DNS handling
rule.
UDR:
\- new data in EDI.
NEF:
\- Nnef_EASDeployment service: new data in EDI.
AF:
\- new data in EDI.
## 6.30 Solution 30 (KI#3): Policies referring to \"Allowed services\" and/or
\"Subscriber categories\"
### 6.30.1 Description
The solution aims at supporting AF request for specific traffic routing (as
defined for Nnef_TrafficInfluence_Create / Update in clause 5.6.7 of TS 23.501
[2]) targeting a category of users or users having subscribed to specific
services (basically for users having subscribed to specific tariff plans).
NOTE 1: Very local traffic offload can be expensive (the more locally CPU is
deployed, e.g. to support EAS, the more expensive this CPU is) and it may be
useful to apply very local offload only for users with specific tariff plans
(e.g. users having subscribed to a \"game boost\" offer). The goal is also to
avoid the burden to define dedicated DNN and/or slices for these cases.
AF guidance is needed as it is the AF that knows the relative cost of
deploying very local EAS capabilities.
The solution adds a new kind of targets (beyond a UE, a group of UE, Any UE)
for AF requests for traffic routing Nnef_TrafficInfluence_Create/Update where
this new kind of targets may correspond to one of \"Allowed services\" and/or
\"Subscriber categories\" as defined in TS 23.503 [13] table 6.2-2: PDU
Session policy control subscription information.
The AF requests is provided to the PCF as defined in clause 4.3.6.2 of TS
23.502 [9]. When the SMF invokes an SM Policy Association Establishment as
defined in clause 4.16.4 of TS 23.502 [9], the PCF looks up the UDR to check
whether the corresponding user subscription maps to one of \"Allowed
services\" and/or \"Subscriber categories\" of the AF policies received by the
PCF (from the UDR as defined in clause 4.3.6.2 of TS 23.502 [9]).
Allowed services and Subscriber categories as defined in table 6.2-2 of TS
23.503 [13] cannot be sent on roaming interfaces as they refer to subscription
plans of a given operator; this is not an issue as
Nnef_TrafficInfluence_Create/Update and NWDAF services are not defined on
roaming interfaces.
An external AF (an AF from a third party with no specific agreement with the
5GC operator) cannot use \"Allowed services\" and/or \"Subscriber categories\"
targets whose set of values are not defined by 3GPP and left for deployment
definition (values defined by the 5GC operator). The NEF may have local
policies allowing it to map the information included in an AF request from an
external AF to identify the more granular sets of UE(s) into operator defined
\"Allowed services\" and/or \"Subscriber categories\" values. The information
included in an AF request to identify the more granular sets of UE(s) can
include AF identifier and/or MTC Provider Information (identifying the
MTC/non-MTC Service Provider and/or MTC/non-MTC Application).
NOTE 2: NOTE 5 in clause 4.15.6.10 of TS 23.502 [9] states \"The MTC Provider
Information can be used by any type of Service Providers (MTC or non-MTC) or
Corporate or External Parties for, e.g. to distinguish their different
customers\". So, the MTC Provider Information can also be used to carry
information for non-MTC service.
NOTE 3: Different values of the allowed services parameter (in PCF
subscription data stored in UDR) can based on local operator configuration to
distinguish between subscription allowing to benefit from edge computing or
even from deep edge computing (using more expensive compute resources at the
RAN site) from subscription not allowing not to benefit from edge computing
for some services. For example, the operator may associate some \"game boost\"
tariff plan with values of the allowed services parameter in PCF subscription
data (stored in UDR) allowing the users to have a better gaming experience as
the gaming application they would use would be very local.
### 6.30.2 Procedures
Clause 4.3.6.2 of TS 23.502 [9] \"Processing AF requests to influence traffic
routing for Sessions not identified by an UE address\" is modified as
described below:
Figure 6.30.2-1: Processing AF requests to influence traffic routing for
Sessions not identified by an UE address
\- In step 1, the target of the AF request may refer a set of UEs as described
in clause 6.30.1.
\- In step 3 and 4, the data stored in UDR and the information sent to the PCF
may refer to one of \"Allowed services\" and/or \"Subscriber categories\" as
defined in TS 23.503 [13] table 6.2-2.
Clause 4.3.6.2 of TS 23.502 [9] \"SM Policy Association Establishment\" is
modified as follows:
Figure 6.30.2-2: SM Policy Association Establishment
\- In step 2, the PCF looks up the UDR PDU Session policy control subscription
information as defined in table 6.2-2 of TS 23.503 [13] to check whether the
corresponding user subscription maps to one of \"Allowed services\" and/or
\"Subscriber categories\" of the AF policies received by the PCF as defined in
clause 4.3.6.2 of TS 23.502 [9]. If there is a match, the PCF uses this
information of the AF policies for its policy rules determination.
### 6.30.3 Impacts on Existing Nodes and Functionality
AF and NEF:
\- support the new target (\"Allowed services\" and/or \"Subscriber
categories\") in Nnef_TrafficInfluence_Create / Update in clause 5.6.7 of TS
23.501 [2].
UDR:
\- storage of the new target type of \"Allowed services\" and/or \"Subscriber
categories\" in data set \"Application data\" and Data Subset \"AF traffic
influence request information\".
PCF:
\- looks up the UDR PDU Session policy control subscription information
defined in table 6.2-2 of TS 23.503 [13] to check whether the user
subscription corresponding to a SM Policy Association maps to one of \"Allowed
services\" and/or \"Subscriber categories\" received from the \"AF traffic
influence request information\" policies in UDR.
## 6.31 Solution 31 (KI#3): Providing traffic offload policy for a set of UEs
with service information
### 6.31.1 Description
To provide the traffic routing policy for a set of UEs at a finer granularity,
the set of UEs at a finer granularity can be identified using a pre-defined
group of UEs or a dynamic group of UEs. The set of UEs can be decided by the
network administrator or by the application. For example, the set of UEs can
be a pre-defined group which is configured by the operator. The set of UEs can
be decided by the application side. For example, only certain users under
certain conditions can access the application with edge computing service due
to limited or expensive EC resource, considering the service agreement among
the EC provider(s), application provider, network provider and the users. The
set of UEs can be decided dynamically when the related conditions are met,
e.g. the application client with specific service level can use edge computing
service under certain conditions.
For providing the traffic routing policy for a set of UEs within a pre-defined
group, or a dynamic group reusing 5G VN group management mechanism as defined
in clause 6.14, it can be implemented using Application Function influence on
traffic routing procedure targeting a group of UEs.
For providing the traffic routing policy for a set of UEs with associated with
the same service information, e.g. the same application client category, it
can be implemented reusing the existing Application Function influence on
traffic routing mechanism with additionally including the following:
\- The traffic routing policy information is provisioned associated a set of
UEs with the same service information.
\- The UE accessing the application with the matched Service information can
apply the traffic routing policy information provisioned associated a set of
UEs with the service information.
NOTE: The service information, for example, can be Target Category information
that is an abstract value associated with 1) Allowed services for accessing
applications with additional conditions e.g. allowed applications to be
accessed, allowed application to be accessed using edge computing; or 2)
Subscriber categories of the UE defined by the operator or of application
users defined by the application provider, or 3) other service information
acting as condition to group the set of UEs, e.g. the application decided
service information such as application level client category for the
application clients.
### 6.31.2 Procedures
The following figure shows the solution providing the traffic routing policy
for a set of UE with associated with the same service information.
Figure 6.31.2-1 Traffic routing policy provisioning for a set of UE with
associated with service information
0\. The UE initiates the PDU Session establishment procedure.
1\. AF request with traffic routing information is sent to the PCF targeting
UE(s) with service information. For the Target UE Identifier(s), the service
information, acting as the criteria to identify the UE(s) that the request is
targeting, so the traffic routing information can only be applied to the PDUs
which are allowed to access the application with service information. The
related information is sent via NEF and stored in the UDR, and delivered to
the PCF following the existing Application Function influence on traffic
routing procedure. Data Key = AF Transaction Internal ID, S-NSSAI and DNN and
the service information for the application. For management of the targeting
UE(s) with specific service information for the application(s), the specific
internal group ID may be allocated by the UDM corresponding to the targeting
UEs with specific service information as which is done for the 5G VN group
management.
2\. The SMF retrieves the SM policy using SM Policy Association Establishment
procedure during the PDU Session establishment procedure. The traffic routing
information for the specific application in step 1 is not sent to the SMF for
the PDU Session because no service information matched.
3\. Application Client with service information requests the IP address of app
server and logs in, the user-plane communication takes place between the
Application Client in UE and Application Server via the C-UPF. In this step,
the application layer can decide that the service information the application
client associated with based on the configuration or application subscription
information.
4\. Optionally, the AF gets the service information for the accessing
application client reusing the procedure of Service specific parameter
provisioning defined in clause 4.15.6.7 of TS 23.502 [9] one of the following
procedures with service information. If the internal group ID is associated
with UE for the accessing application client, the internal group ID is stored
as information of the subscription data of the UE.
NOTE: The service information in this solution is notified to the SM-PCF to
influence the PCC Rules instead of AM-PCF delivered to the UE as defined in
clause 4.15.6.7 of TS 23.502 [9].
5-6. The PCF makes the decision to modify the SM policy for the application
within the PDU Session based on the traffic routing information targeting the
set of UEs received in step 1, and the related information for the PDU Session
including \"Allowed services\" and/or \"Subscriber categories\" as defined in
\"PDU Session policy control subscription information\" in TS 23.503 [13]
table 6.2-2 and/or the service information for the PDU Session received in
step 4, and the routing policy related to the traffic routing information is
sent to the SMF.
7\. The UE enters the service area of the edge DN.
8-10. The SMF decides to establish a new PDU Session Anchor e.g. due to UE
mobility as described in step 7, and based on the latest traffic routing
policy received in step 6.
11\. User-plane communication takes place between the Application Client in UE
and Edge Application Server via the local UPF.
12-13. The AF decides to delete the service specific parameter, e.g. when the
AC with service information logs out of the application or the IP flows of the
application are terminated. The delete procedure is similar to the create
procedure described in step 4, the only difference is that it is to delete the
related information.
14-15. The PCF makes the decision to modify the SM policy for the application
within the PDU Session, and the related traffic routing policy is deleted in
the SMF.
16-18. If another Application Client without service information requests the
IP address of app server and logs in in the PDU Session of the UE, the User-
plane communication takes place between the Application Client in UE and
Application Server via the C-UPF. As there is no related traffic routing
information matched for this application client, no traffic routing policy is
applied to the application for this UE in this case.
### 6.31.3 Impacts on services, entities and interfaces
The following impacts are involved to support providing the traffic routing
policy for a set of UE associated with the same service information:
AF/NEF/UDR:
\- service information is supported while providing traffic routing policy
information in the procedure of AF influence traffic routing, wherein the
service information can be the Target Category information associated with
\"Allowed services\" and/or \"Subscriber categories\" and/or the application
decided service information such as application level client category;
\- service information of the UE accessing the application is optionally
provided using the procedure of Service specific parameter provisioning.
PCF:
\- the traffic routing policy for a set of UE associated with service
information is received;
\- service information of the UE accessing the application is notified;
\- associates the UE accessing the application with the set of UEs using
Service information, and sends the PCC rule to the SMF for the PDU Session of
the UE with the traffic routing policy information provisioned associated a
set of UEs with the service information.
## 6.32 Solution 32 (KI#3): Offload policy for finer granular set of UEs
### 6.32.1 Description
This solution corresponds to KI#3, which addresses offload policy for finer
granular set of UEs related to:
\- how to identify set of UEs at a finer granularity that are associated with
a dedicated offload policy, and how to express the set of UE in the offload
policy;
\- impacts to 5GS needed to support providing traffic offload policy for such
a set of UEs.
Based on the existing traffic influence procedure, this solution introduces
\"subscribed services\", which is used for expressing a set of UEs at a finer
granularity, and the Spatial Validity Condition and Temporal Validity
Condition in AF request is reused for expressing location and time period for
definition of set of UEs.
The \"subscribed services\" includes logical combination of criteria, for
instance:
\- Allowed Service#1 AND Allowed Service#2;
\- Group#1 AND Group#2;
\- Allowed Service#1 AND Group#1;
\- Group#1 AND (NOT Group#2);
\- Subscriber category#1 AND Group#1;
\- PLMN ID (the offload policy is to UEs subscribed to PLMN identified by PLMN
ID);
\- etc.
The criterion (e.g. Allowed Service, Subscriber category, Group ID etc) is
maintained in UE subscription, and when the \"subscribed services\" is
included in traffic influence, then the traffic influence applies to UE(s)
whose subscription information matching with the \"subscribed services\"
logically, for example, the \"subscribed services\" is \"Allowed Service#1 AND
Group ID#1\" then traffic influence is for UEs whose subscription including
both Allowed Service#1 and Group ID#1; the \"subscribed services\" is
\"Allowed Service#1 AND (NOT Group ID#1)\", then traffic influence is for UEs
whose subscription including Allowed Service#1 but not Group ID#1.
NOTE 1: If one criterion belongs to MNO\'s internal information, then it could
only be used by an AF belonging to the MNO.
### 6.32.2 Procedures
The following is the procedure for providing traffic offload policy to UEs
matching with \"subscribed service\".
The procedure of \"Processing AF requests to influence traffic routing for
Sessions not identified by an UE address\" as defined in clause 4.3.6.2 of TS
23.502 [9] is reused with the following updates:
\- in step 2: AF includes \"subscribed services\" in the AF request. The
\"subscribed services\" can be indicated, for example, by including one or
more of the following information or by other means:
\- Allowed Service;
\- Subscriber category;
\- Group ID;
\- PLMN ID.
\- in step 5: Based on received AF request, PCF creates PCC rule for UEs whose
subscription information matching with the \"subscribed services\", for
example, the \"subscribed services\" is \"Allowed Service#1 AND Group ID#1\",
then PCC rule is created for UEs whose subscription including both Allowed
Service#1 and Group ID#1; the \"subscribed services\" is \"Allowed Service#1
AND (NOT Group ID#1)\", then PCC rule is created for UEs whose subscription
including Allowed Service#1 but not Group ID#1.
### 6.32.3 Impacts on services, entities and interfaces
AF, NEF, PCF and UDR is to be updated for supporting \"subscribed services\".
Nnef_TrafficInfluence Service is extended with new parameter \"subscribed
services\".
## 6.33 Solution 33 (KI#3): AF requests offload policy for sets of UEs
### 6.33.1 Description
The following solution corresponds to the key issue #3 on Policies for finer
granular sets of UEs as specified in clause 5.3.
It is using the AF influence traffic mechanism to route the traffic for a
collection of UEs. The AF provides the Category information in AF request to
indicate which information elements (e.g. Spatial Validity Condition,
Application Identifier, FQDN range, Temporal Validity Condition, Target UE
Identifier) are used to determine the collection of UEs for traffic offload.
The information elements defined in clause 5.6.7 in TS 23.501 [2] can be
reused, the categories include:
\- Category 1: Spatial Validity Condition (Area of Interest, geographical area
etc.), e.g. the traffic routing mechanism is applied to the UEs located in the
same Area of Interest.
\- Category 2: Application Identifier/FQDN range, e.g. the traffic routing
mechanism is applied to the UEs that are using the same application.
\- Category 3: Temporal Validity Condition, e.g. the traffic routing mechanism
is applied to the UEs that use the same application during the specific time
interval.
\- Category 4: Target UE Identifier(s), e.g. the traffic routing mechanism is
applied to the UEs that are associated with a specific External Group
Identifier.
Other categories: combinations of category 1-4, it may include:
\- Category 5: Spatial Validity Condition AND Application Identifier/FQDN
range, e.g. the traffic routing mechanism is applied to the UEs located in the
same Area of Interest and using the same application.
\- Category 6: Combination of different groups, e.g. UEs that are associated
with both External Group Identifier A and External Group Identifier B.
\- etc.
Based on the Category information in AF request, the PCF generates PCC rule(s)
and sends it to the SMF. The SMF determines that the UE belongs to the
collection of UEs for traffic offload, and reconfigures the UP per PCC
rule(s).
### 6.33.2 Procedures
Figure 6.33.2-1: Processing AF requests to influence traffic routing for
Sessions associates with a collection of UEs (reuse the figure 4.3.6.2-1 of TS
23.502 [9])
The solution reuses the procedure of AF requests to influence traffic routing
as described in clause 4.3.6.2 of TS 23.502 [9], with the following
enhancements:
\- In step 1, the AF requests the offload policy with Category information
that indicates the collection of UEs for traffic offload, and the content of
offload policy is as described in clause 6.33.1.
\- In step 2, the offload policy is included in the AF request message.
\- In step 5, the PCF determines which UE belongs to the collection of UEs for
traffic offload and generates PCC rule(s) for PDU Session of UEs in the UE
collection based on the Category information in AF request.
\- In step 6, based on the received PCC rule(s) from PCF, the SMF reconfigures
the User plane of the PDU Session correspondingly.
### 6.33.3 Impacts on services, entities and interfaces
AF:
\- provides the Category information in AF request.
PCF:
\- creates PCC rule based on the Category information.
## 6.34 Solution 34 (KI#4): Selecting the same EAS/DNAI for collection of UEs
### 6.34.1 Description
This solution is based on solution 16, described in clause 6.16.
This solution uses EDI to make sure a collection defined by an AF uses the
same DNAI and/or EAS. By this EDI is updated with EAS address field per DNAI
and an indicator if the DNAI is selected for a group. The data in EDI is also
updated with a Dynamic External Group Id that can be per DNAI or per
application ID. The AF can use the Dynamic External Group ID and external
application id to influence routing for a collection of UEs. The dynamic
external group id is an identifier that is generated by the AF, i.e. it is not
to be confused with the external group id configured in UDM. The AF associates
a list of UEs with the dynamic external group id when requesting in AF
influence on routing that the list of UEs should be using the same EAS and/or
DNAI.
Example of EDI record before any group has been requested through traffic
influence:
DNN-1/S-NSSAI-1:
ApplicationID-1
FQDN
DynExtGrID-1
DynExtGrID-2
DNAI-1
DynExtGrID-4
DynExtGrID-5
DNAI-2
DynExtGrID-5
etc.
Example of EDI record before after _some_ groups have been requested through
traffic influence:
DNN-1/S-NSSAI-1:
ApplicationID-1
FQDN
DynExtGrID-1
DNAI-55
EASaddr-1
DynExtGrID-2
DNAI-1
DynExtGrID-4
DNAI selection indicator
EASaddr-3
DynExtGrID-5
DNAI-2
DynExtGrID-5
EASaddr-2
### 6.34.2 Procedure
The following is the procedure for selecting the same EAS for collection of
UEs accessing the same application. The procedures defined in figure 4.3.6.2-1
in TS 23.502 [9] and figure 6.2.3.2.2-1 in TS 23.548 [3] are reused.
Figure 6.34.2-1: Discovery procedure for selecting the same EAS/DNAI for
collection of UEs
1\. AF provides EDI and SMF may get the EDI according to TS 23.548 [3]. AF
includes a Dynamic External Group ID per DNAI or per External Application ID,
if on External application ID, then it is relevant for all DNAIs. There may be
a list of Dynamic External Group IDs on both levels. See example in clause
6.16.2.1.
2\. The AF request in step 1 of figure 4.3.6.2-1 in TS 23.502 [9] is used to
request selecting the same EAS and/or same DNAI for a collection of UEs
accessing the application as identified by external application ID in the AF
Request. The AF provides a DNAI correlation indication and/or EAS correlation
indication. The correlation indications are used as a means to request a
common DNAI and/or a common EAS for the UEs. Spatial Validity Condition could
be provided for limiting the location of the UEs, and also \"any UE\" or an UE
list or group ID will be provided for defining UE collection accessing the
same EAS or the same DNAI.
NEF maps external application ID to application ID.
AF will also indicate if re-discovery is needed to NEF, this can only be used
if a list if UEs is provided. This is to ensure that a common EAS will be used
by the concerned UEs.
In step 5 of figure 4.3.6.2-1 of TS 23.502 [9], PCF determines the UEs
influenced by the AF Request, and based on AF request, PCF creates PCC rule
with application ID and the Dynamic External Group ID and DNAI correlation
indication and/or EAS correlation indication.
If not already subscribed to receive updates events of the EDI for the
concerned DNN and S-NSSAI, SMF does that as per TS 23.548 [3] to retrieve the
EDI.
3 If re-discovery is requested, SMF does a PDU Session modification to trigger
EAS re-discovery as per clause 6.2.3.3 in TS 23.548 [3].
4\. The same as steps 1-9 in figure 6.2.3.2.2-1 in TS 23.548 [3].
5\. If the notified FQDN from EASDF to SMF is related to the Application ID
that is associated with a Dynamic External Group ID, and that DNAI and/or EAS
correlation information was received in step 2, the SMF determines that the UE
should be part of a dynamic group with same DNAI and/or same EAS (depending on
what the AF originally requested). Using the data received in step 2, SMF
determines if any of the DNAI has been selected for the group by checking the
EDI. If so, the SMF uses this DNAI in step 7. and if EAS correlation
indication was received from PCF, and if there is an EAS address associated
with the Dynamic External Group ID SMF uses this in step 7.
6\. The following cases can occur:
\- If no DNAI could be used in step 5, SMF selects a DNAI and if a common DNAI
should be selected indicated via the DNAI correlation indicator in step 2, SMF
updates the EDI with the selected DNAI, either with an indicator or the actual
DNAI depending on which level the dynamic external group id was provided on
(SMFs subscribing to update events to the EDI change will be notified).
\- If EAS correlation indication was set in step 2 and SMF did not have any
EAS address available in step 5, SMF provides the EAS address that was
received from EASDF. If multiple EAS addresses were received, SMF selects one.
SMF updates EDI with the EAS address. SMF uses this in step 7.
7\. Based on steps 10-19 in figure 6.2.3.2.2-1 in TS 23.548 [3]. i.e. updates
of the DNS handling rules with the EAS address, and breaking out the session
at selected DNAI.
### 6.34.3 Impacts on services, entities and interfaces
AF:
\- to be updated with Dynamic External Group ID, EAS correlation indicator,
and DNAI correlation indicator.
NEF:
\- Nnef_TrafficInfluence service (or new) as per AF new information;
\- new data in EDI.
SMF:
\- using PCC rule to associate UEs to a dynamic group of UEs, based on the
original AF provided information given by PCF. Using and updating data in EDI.
UDR:
\- new data in EDI.
EASDF:
\- may need to be updated for create and send DNS response to UE.
PCF:
\- services related to AF influence on routing to be updated with Dynamic
External Group ID, EAS correlation ID, DNAI correlation ID.
## 6.35 Solution 35 (KI#4): Providing dedicated (re)location information as
traffic routing information
### 6.35.1 Description
To provide the dedicated (re)location information for a collection of UEs, the
collection of UEs can be a pre-defined group of UEs or a dynamic group of UEs,
the dedicated (re)location information can be the target DNAI or the target
EAS which is shared by the collection of UEs. The collection of UEs can be
decided by the network administrator or by the application. The collection of
UEs can be a pre-configured group which is be configured by the operator,
which is already supported and out of scope of KI#4. The collection of UEs can
also be decided by the application.
The target DNAI or target EAS can be decided by the AF based on the edge
relocation triggered by AF or can be received by the AF via the User Plane
Management events notification to the AF from the CN, or can be received by
the AF via application layer. AF Providing the dedicated (re)location
information for the identified collection of UEs, the existing Application
Function influence on traffic routing mechanism is reused with additionally
including the following:
\- The target DNAI/EAS is provisioned for a collection of UEs, not only
targeting an individual UE.
\- The collection of UEs can be identified by dynamic group ID managed with 5G
VN group management mechanism as defined in clause 6.14, or the UEs shares the
same service information.
### 6.35.2 Procedures
The following figure shows the solution providing the dedicated (re)location
information for a collection of UE within the same dynamic group or associated
with the same service information.
Figure 6.35.2-1: Server Discovery with dedicated (re)location information
1\. The UE1 establishes the PDU Session with C-UPF.
2\. UE1 enters the EDN Service Area and initiates one application e.g. starts
one game and target EAS is discovered for the game.
3\. The dedicated relocation information is included in step 3, which targets
the collection of UEs. The traffic correlation can be explicitly indicated by
the traffic correlation indication, or implicitly indicated by the dedicated
relocation information for the collection of UEs. AF request with traffic
routing information is used to provide the dedicated relocation information,
and is sent to the Core network for the specific application with the
application ID, targeting a collection of UE(s). The collection of UEs can be
identified by the group ID (the group can be dynamically managed with the
existing mechanism), or by the target UEs with service information (e.g. the
application instance identifier identifying the application instance a
collection of UEs are accessing, which means all the UEs accessing the
identified application instance). If it targets a group of UEs with the
service specific information, it means the UE with the service specific
information in the group can apply the receive traffic routing information
received. The dedicated relocation information should be stored as associated
data for the collection of UEs.
3a. Step 3a is used for sending the information of a specific UE to associate
the UE with the collection of UEs, if the group ID is used to identify the
collection of UEs and the UEs belong to the group are preconfigured in 5GC,
step 3a is skipped. Otherwise, if the collection of UEs is identified with the
service information provided in step 3, the procedure of Service specific
parameter provisioning defined in clause 4.15.6.7 of TS 23.502 [9] can be used
to send the service specific information of the UE, for example indicating the
UE is accessing the application with service specific information (e.g.
joining the game).
If the collection of UEs is identified by the group ID within 5GC, the group
ID can be sent to the SMF while retrieving the SM subscription data, and the
SMF retrieves the PCC rule with the group ID from the PCF for each UE, and the
UE accesses the application will be matched whether it belongs to the group,
if so, the traffic of the UE for the application should be correlated with the
group of UEs accessing the application in the PCF.
NOTE: The service information in this solution is notified to the SM-PCF to
influence the PCC Rules instead of AM-PCF delivered to the UE as defined in
clause 4.15.6.7 of TS 23.502 [9].
4\. Based on the information received in step 3 and/or step 3a, the related
policy with traffic correlation and the dedicated relocation information is
sent to the SMF. The traffic correlation information is optional, if it is
included, all the PDU Sessions with the same traffic correlation information
can be correlated together to relocate the related traffic to the target
DNAI/EAS. The SMF manages the PDU Session considering the target DNAI/EAS,
which includes the routing decisions for traffic of PDU Session and the DNS
handling rule decision.
5-7. The SMF controls the traffic routing based on the received traffic
routing with dedicated relocation information accordingly. BP and L-UPF are
inserted based on the edge relocation information e.g. the target DNAI/EAS
received in step 4 if available. User-plane communication takes place between
the Application Client in UE1 and Edge Application Server the local UPF after
the application relocation to the EAS, the new UE IP address is used if multi-
homing is used.
8\. UE2 Session Establishment with C-UPF to access the DN, and EASDF is
configured with DNS handling rules.
9\. UE2 sends DNS query for the application.
10a-10b. Condition triggered, the related policy with traffic correlation and
the target DNAI/EAS is generated. The condition triggered includes one of the
following:
\- Specific service information matched, in this case, the specific service
information of UE2 accessing the application is sent to the PCF in step 10a
which is similar to step 3a.
\- UE2 belongs to the same group as UE1, the target DNAI/EAS information is
associated with the group as described in step 3-4.
11-12. The related policy with traffic correlation and the target DNAI/EAS is
sent to the SMF. The traffic correlation information is optional, if it is
included, all the PDU Sessions with the same traffic correlation information
will be correlated together to relocate the related traffic to the target
DNAI/EAS. The SMF manages the PDU Session considering the target DNAI/EAS,
which includes the routing decisions for traffic of PDU Session and the DNS
handling rule decision.
13\. UL-CL/BP insertion based on the target DNAI/EAS received in step 11.
14\. Receiving the DNS query message for UE2 for the application as described
in step 9, if the DNS Query message matches a DNS message detection template
of DNS message handling rule for reporting, the EASDF sends the DNS message
report to SMF.
15\. The SMF decides the DNS handling rule based on the target DNAI/EAS
received in step 11:
\- If the dedicated relocation information is target DNAI, the SMF selects the
EDNS Client Subnet option or the local DNS server based on the target DNAI,
and sends the DNS handling rule accordingly.
\- If the dedicated relocation information is target EAS, the SMF indicates
the EASDF to response the DNS query with the target EAS, by adding one more
action of responding with indicated EAS in the DNS handling rule.
16\. Optionally, the EASDF handles the DNS Query message.
17\. The EASDF sends the DNS response to the UE with the EAS within the target
DNAI or with the target EAS directly.
18\. User-plane communication takes place between the Application Client in
UE2 and Edge Application Server via the local UPF after the application
relocation to the EAS.
19-22. When the condition changes, it should be supported that the Association
of the collections of UEs can be updated or disassociated for EAS
(re)location, for example the collection of UEs can be updated, the dedicated
relocation information can be updated, the association of the collection of
UEs can be disassociated.
Step 19-22 gives the example that the association of the collection of UEs can
be disassociated when the game is over. The game is over. The delete procedure
is similar to the create procedure described in step 4, the only difference is
that it is to delete the related information and the PCF makes the decision to
modify the SM policy for the application within the PDU Session accordingly.
If the association of the collections of UEs are updated, the AF update is
executed and the PCF updates the related SM policy accordingly.
### 6.35.3 Impacts on services, entities and interfaces
The following impacts are involved to support providing the traffic routing
policy for a set of UE with associated with the same service information:
AF/NEF/UDR:
\- dedicated (re)location information is provided as traffic routing
information;
\- service information is optionally supported to associate a specific UE with
a collection of UEs;
\- traffic correlation information to differentiate different collections of
UEs may be supported.
PCF:
\- the dedicated (re)location information for a set of UEs is received;
\- service information is optionally supported to associate a specific UE with
a set of UEs;
\- associates the UE accessing the application with the set of UEs, and sends
the PCC rule to the SMF for the PDU Session of the UE with the traffic routing
policy information with the dedicated (re)location information;
\- traffic correlation information to differentiate different set of UEs may
be supported.
SMF:
\- manages the PDU Session considering the received dedicated (re)location
information, which includes the routing decisions for traffic of PDU Session
and the DNS handling rule decision;
\- all the PDU Sessions with the same traffic correlation information will be
correlated together to use the same traffic correlation information.
EASDF:
\- sends the DNS response to the UE with the EAS indicated by the SMF.
## 6.36 Solution 36 (KI#4): Providing dedicated (re)location information as
EAS Deployment information
### 6.36.1 Description
To provide the dedicated (re)location information for a collection of UEs for
server discovery, the collection of UEs can be a pre-defined group of UEs or a
dynamic group of UEs, the dedicated (re)location information can be the target
DNAI or the target EAS which is shared by the collection of UEs. The
collection of UEs can be decided by the network administrator or by the
application. The collection of UEs can be a pre-configured group which is be
configured by the operator, which is already supported and out of scope of
KI#4. The collection of UEs can also be decided by the application.
The target DNAI or target EAS can be decided by the AF based on the edge
relocation triggered by AF or can be received by the AF via the User Plane
Management events notification to the AF from the CN, or can be received by
the AF via application layer. AF Providing the dedicated (re)location
information for the identified collection of UEs, the EAS Deployment
Information Management mechanism is reused with additionally including the
following:
\- The target DNAI/EAS is provisioned for a collection of UEs.
\- The collection of UEs can be identified by pre-configured group ID, dynamic
group ID managed with 5G VN group management mechanism as defined in clause
6.14, or the UEs shares the same service information.
### 6.36.2 Procedures
The following figure shows the solution providing the dedicated (re)location
information for a collection of UE within the same dynamic group or associated
with the same service information.
Figure 6.36.1: Server Discovery with dedicated (re)location information as EAS
Deployment Information
1\. The UE1 establishes the PDU Session with C-UPF.
2\. UE1 enters the EDN Service Area and initiates one application e.g. starts
one game and target EAS is discovered for the game.
3\. The dedicated relocation information is sent to the SMF to improve the
PSA/application relocation. All the UEs within the game are required to access
the application according to the dedicated relocation information, which is
the same DNAI/EAS. The SMF manages the PDU Sessions considering the target
DNAI, which includes the routing decisions for traffic of PDU Session and the
DNS handling rule decision.
AF request to Provide EAS Deployment information with dedicated relocation
information is sent to the Core network for the specific application(s) with
the application ID(s), targeting a collection of UE(s) using the EAS
Deployment Information Management procedure defined in clause 6.2.3.4 of TS
23.548 [3]. The collection of UEs can be identified by the group ID (the group
can be dynamically managed similar with the 5GVN group management mechanism),
or by the target UEs with service information (e.g. the application instance
identifier identifying the application instance a collection of UEs are
accessing, which means all the UEs accessing the identified application
instance). If it targets a group of UEs with the service specific information,
it means the UE with the service specific information in the group can apply
the dedicated relocation information received.
4\. If the group ID is used to identify the collection of UEs and the UEs
belong to the group are preconfigured in 5GC, step 3a for sending the
information of a specific UE to associate the UE with the collection of UEs is
skipped. If the collection of UEs is identified with the service information
provided in step 3, the procedure of Service specific parameter provisioning
defined in clause 4.15.6.7 of TS 23.502 [9] can be used to send the service
specific information of the UE, for example indicating the UE is accessing the
application with service specific information (e.g. joining the game).
NOTE: The service information in this solution is notified to the SM-PCF to
influence the PCC Rules instead of AM-PCF delivered to the UE as defined in
clause 4.15.6.7 of TS 23.502 [9].
If the collection of UEs is identified by the group ID within 5GC, the group
ID can be sent to the SMF while retrieving the SM subscription data, and the
SMF retrieves the PCC rule with the group ID from the PCF for each UE, and the
UE accesses the application will be matched whether it belongs to the group,
if so, the traffic of the UE for the application should be correlated with the
group of UEs accessing the application.
5-7. The SMF controls the traffic routing based on the received information of
dedicated relocation information (the target DNAI) accordingly. BP and L-UPF
are inserted based on the dedicated relocation information e.g. the target
DNAI. User-plane communication takes place between the Application Client in
UE1 and Edge Application Server the local UPF after the application relocation
to the EAS, the new UE IP address is used if multi-homing is used.
8\. UE2 Session Establishment with C-UPF to access the DN, and EASDF is
configured with DNS handling rules.
9\. UE2 sends DNS query for the application.
10a-10. Condition triggered, the related information of the target DNAI/EAS
are received by the SMF. The condition triggered includes one of the
following:
\- specific service information matched; in this case, the specific service
information of UE2 accessing the application is sent to the SMF in step 10a
which is similar as step 4;
\- UE2 belongs to the same group with UE1, the target DNAI/EAS information is
associated with the group as described in step 3-4.
11\. BP insertion based on the target DNAI for the PDU Session received in
step 10a-10 if needed.
12\. Receiving the DNS query message for UE2 for the application as described
in step 9, if the DNS Query message matches a DNS message detection template
of DNS message handling rule for reporting, the EASDF sends the DNS message
report to SMF.
13\. The SMF decides the DNS handling rule based on the target DNAI/EAS as
described in step 10a-10, including:
\- if the dedicated relocation information is target DNAI, the SMF selects the
EDNS Client Subnet option or the local DNS server based on the target DNAI,
and sends the DNS handling rule accordingly to the EASDF;
\- if the dedicated relocation information is target EAS, the SMF indicates
the EASDF to response the DNS query with the target EAS, by adding one more
action of responding with indicated EAS in the DNS handling rule.
14\. The EASDF handles the DNS Query message. Optionally, the EASDF forwards
the DNS query message.
15\. The EASDF sends the DNS response to the UE with the EAS within the target
DNAI or with the target EAS directly.
### 6.36.3 Impacts on services, entities and interfaces
The following impacts are involved to support providing the traffic routing
policy for a set of UE with associated with the same service information:
AF/NEF/UDR:
\- dedicated (re)location information is provided as EAS Deployment
information;
\- service information is optionally supported to associate a specific UE with
a collection of UEs.
SMF:
\- the EAS Deployment information with dedicated (re)location information for
a set of UEs is received;
\- service information is optionally supported to associate a specific UE with
a set of UEs;
\- associates the UE accessing the application with the set of UEs using
service information if received;
\- makes the DNS handling rule decision for the PDU Session associated with
the set of UEs considering the received dedicated (re)location information.
EASDF:
\- sends the DNS response to the UE with the EAS indicated by the SMF.
## 6.37 Solution 37 (KI#4): (Re)location of same EAS and coordination across
UEs
### 6.37.1 Introduction
This solution aims to address the technical requirements related to key issue
#4. In particular, it provides solutions to, among others, how the 5GS
facilitates EAS (re)location of EAS for the collection of UEs. The procedure
defined in figure 6.2.3.2.2-1 in TS 23.548 [3] is reused. Also, procedure for
ad hoc group provisioning and group information management/storing in the
UDM/UDR are assumed, for example solution 19 in clause 6.19.
There could be one SMF serving the collection of UEs that connects the same
EAS/DNAI for accessing the same application, or there could be multiple SMFs
for different UEs in the collection. For the latter case, UDM is used for
coordination between SMFs to make sure selecting the same EAS/DNAI for UEs in
the ad hoc group, i.e. SMF updates the selected EAS IP/DNAI to UDM or SMFs
gets the EAS IP/DNAI information from UDM.
### 6.37.2 Functional Description
The following are the main principles of the solution:
\- Procedure for ad hoc group provisioning and group information
management/storing in the UDM/UDR are re-used for example based on solution 19
in clause 6.19.
\- EAS ID is determined based on the procedure in clause 6.2.3.2.2-1 in TS
23.548 [3].
\- SMF updates the ad hoc group information in the UDM/UDR with the EAS ID.
\- SMFs subscribes to the UDM to get notification on any changes to the ad hoc
group data.
\- For the subsequent ad hoc group member UEs DNS request, SMF(s) instructs
the EASDF to provide the already determined EAS IP address in the DNS response
for DNS queries.
### 6.37.3 Solution Details
#### 6.37.3.1 EAS (re)location to the ad hoc group member UEs
The figure 6.37.3.1-1 below provides a detailed call flow on the (re)location
of the same EAS to the all the UEs of the ad hoc group.
Although the figure below does not explicitly indicate the same DNAI, but the
same is applicable in case of common/same DNAI requirement. For example,
initial/first SMF selects a DNAI and updates to the group information in the
UDM/UDR. UDM/UDR then notifies to other SMFs (if subscribed). This DNAI may
change e.g. using existing procedures due to UE mobility and/or AF influence
and so on. If so, respective SMF updates to the group information in the
UDM/UDR newly selected DNAI using Nudm_ParameterProvision. This ensures that
the same DNAI is applied to all the group members, and also allows DNAI
change.
Figure 6.37.3.1-1: EAS (re)location to the ad hoc group member UEs
1\. Ad hoc group provisioning and group information management/storing in the
UDM/UDR, for example:
\- as in solution 19 in clause 6.19 or based on details in clause 6.37.3.3.
Nnef_ParameterProvision_Create request is used to provision group attributes
like group ID, member UEs, FQDN, etc. SMF subscribed to the Group subscription
data via Nudm_SDM_Notification Notify message.
2\. The same as steps 1\~15 in figure 6.2.3.2.2-1 in TS 23.548 [3].
3\. This step may possibly/also occur before step 2, where SMF learns via
Nudm_SDM_Notification Notify that UE belongs to the ad hoc group provisioned
by the AF for certain application that requires same application server/EAS.
4\. SMF uses Nudm_ParameterProvision to update ad hoc group subscription data
in the UDM/UDR to include EAS ID.
5\. Based on steps 16\~19 in figure 6.2.3.2.2-1 in TS 23.548 [3]:
In step 17, SMF sends DNS message handling rule with IP address for the EAS
instructing EASDF to return the IP address for the EAS to UE in step 19.
6\. All the SMFs subscribed to the notification of the Group subscription data
are notified of the changes using Nudm_SDM_Notification Notify, and thus learn
EAS ID applicable to the ad hoc group member UEs.
7\. For the Group of UEs, if another UE of Group of UEs sends DNS request,
based on steps 1\~9 in figure 6.2.3.2.2-1 in TS 23.548 [3]:
Steps 10 to 15 are skipped and in step 16 the UL-CL UPF is selected by SMFx
for EAS ID notified by UDM and at step 17, SMFx sends DNS message handling
rule with IP address for the EAS instructing its EASDFx to return the IP
address for the EAS to UE in step 19.
#### 6.37.3.2 Updating EAS ID in the Group Info
In cases such as where multiple UEs of the same group send DNS queries almost
simultaneously, and subsequently resolved to different EAS ID, it is possible
that respective SMF may try to update the EAS ID of the ad hoc group. For this
kind of race condition, the procedures below are proposed:
\- SMF creates/modifies the correlation of an EAS ID with a Group ID and FQDN
in the UDM/UDR as explained in clause 6.37.3.1. The binding information may
include an FQDN for which the binding exists and/or SMF ID and/or SMF set ID;
\- SMF subscribes to the UDM/UDR for notification of change of
creation/deletion/modification of the correlation of EAS ID with Group ID;
\- Based on the binding information that includes an FQDNs for which the
binding exists and/or SMF ID and/or SMF set ID, UDM/UDR evaluates new
creation/deletion/modification of the correlation of EAS ID with Group ID in
order to avoid overwriting the initially stored EAS ID and accordingly UDM/UDR
rejects creation/deletion/modification of the correlation of EAS ID with Group
ID by sending the stored EAS ID to the subsequent SMF, i.e. SMF2;
\- SMF2 accepts the response to the creation/update of the correlation of EAS
ID with Group ID from UDM/UDR with an EAS ID (i.e. if already stored in the
group data) different from the EAS ID provided by the SMF2 to the database;
\- SMF evaluates the EAS ID received in the response from the UDM/UDR and re-
selects and re-configures DNAI / UL-CL UPF and PSA UPF (before instructing the
EASDF to reply with DNS response towards the UE).
#### 6.37.3.3 Collection of UEs based on 5GC criteria
This clause relates to 5GC initiated ad hoc group creation/update/deletion,
i.e. SMF may form a dynamic ad hoc group of a collection of UEs that could be
subject to collective and common treatment. This collection of UEs may be
based on specific criteria, for example all the UEs in this group use the same
EAS and/or same DNAI and/or same PSA UPF and/or UEs in a specific geographical
area.
In case of ad hoc group consisting of UEs using the same EAS, SMF may interact
with EASDF to form this group. Thus, SMF determines the collection of UEs
based on the DNS response messages provided by EASDF to SMF.
As per existing specification, SMF instructs EASDF to report DNS responses
matching one or more specific FQDNs and/or EAS IP addresses. EASDF notifies
SMF per UE\'s PDU Session when such DNS response is received. Once SMF
receives the notification from EASDF for each PDU Session, then SMF can group
them based on the grouping criteria. Alternatively, the SMF may instruct the
EASDF to report DNS responses matching one or more specific FQDNs and/or EAS
IP addresses for any PDU Session of ANY UE possibly matching certain criteria
(e.g. a specific S-NSSAI and DNN). Once SMF receives notification from the
EASDF, SMF assigns an ad hoc group ID for the same and may store group
information in the UDM/UDR, together with Group ID and list of UEs, etc. SMF
may also report this group ID/info to AF based on AF notification criteria,
thus allowing AF to make an offloading decision subsequently.
### 6.37.4 Impacts on services, entities and interfaces
SMF:
\- subscribes to the ad hoc group subscription data;
\- updates UDM/UDR with EAS ID/DNAI information in the ad hoc group
subscription data;
\- interactions between SMF and EASDF related to clause 6.37.3.3.
## 6.38 Solution 38 (KI#5): EAS Discovery for EHE shared with other PLMN
### 6.38.1 Description
In Key Issue#5, the following aspects shall be studied:
\- investigate potential impacts related to the GSMA Operator Platform Group
work on EAS discovery.
Edge Node Sharing scenario is one use case defined in clause 3.3.5 of GSMA
OPG.02 [5], in which case EAS A (hosted by Operator A) is to be accessed by
Operator B\'s network. This solution aims to solve the EAS discovery for the
Edge Node Sharing scenario. From Operator B\'s point of view, the EAS deployed
in Operator A\'s network is equivalent to the case that 3rd party provider
hosting the EHE. Application provider (AF) creates EDI (EAS Deployment
Information) corresponding to Operator A\'s network, and Operator A forward
EDI to Operator B instead of the application provider.
There are two candidate options to provision EDI to serving Operator:
1) based on interaction between NEFs from different PLMNs;
2) based on EWBI interface defined by GSMA OPG.02 [5].
Option1 - NEF-based EDI provision to serving Operator:
Operator A needs to translate the EDI provided by AF to an EDI corresponding
to Operator B\'s network, and also N6 traffic routing requirements could be
included in EDI for instructing how to route traffic from Operator B\'s
network to the Operator A\'s EHE. It is assumed that AF only has agreement
with Operator A. NEF is in charge of translation between EDIs, it translates
DNAI corresponding to Operator A\'s network to DNAI corresponding to Operator
B\'s network.
NOTE 1: The translation of DNAI could be based on configured relationship
between DNAIs from different operators, or NEF could retrieve Operator B\'s
DNAI dynamically, e.g. based on solutions from KI#7 described in clause 5.7.
The N6 traffic routing requirements could be determined based on SLA between
Operators (similar to the way how AF configures N6 traffic routing
requirements currently).
Option2 - EWBI-based EDI provision to serving Operator:
EWBI defined by GSMA OPG.02 [5] is used for exchange EDI information between
PLMNs, and it assumes EWBI support the capability for exchanging application
instance access information between PLMNs. The OPG platform could interact
with NEF of serving PLMN via SBI-NR interface for provision of EDI.
NOTE 2: Per SLA agreement between operator one dedicated IP connection can be
established between Operators, which will be in charge of satisfy the end-to-
end QoS requirement when the traffic routing from Operator B\'s UPF to
Operator A\'s DN, and UPF could mark the packets with appropriate pre-
configured DSCP value for traffic routing Qos fulfilment between PLMNs.
### 6.38.2 Procedures
#### 6.38.2.1 Option1 - NEF-based EDI provision to serving Operator
The EAS discovery procedure for Edge Node Sharing scenario is defined below.
Figure 6.38.2.1-1: EAS discovery procedure
1\. AF invokes the Nnef_EASDeployment_Create operation with EDI1 corresponding
to Operator A.
2\. NEF of Operator A translates the received EDI1 from AF to a new EDI2
corresponding to Operator B:
\- NEF translates DNAI in the received EDI1 to the DNAI of Operator B, and
includes the DNAI of Operator B in the new EDI2.
\- (optional) NEF adds N6 traffic routing information in the new EDI2.
NOTE 1: The translation of DNAI could be based on configured relationship
between DNAIs from different operators, or NEF could retrieve Operator B\'s
DNAI dynamically, e.g. based on solution from KI#7, described in clause 5.7.
The N6 traffic routing requirements could be determined based on SLA between
operators.
3\. The NEF of Operator A sends Nnef_EASDeployment_Create Response to the AF.
4\~7. The same as steps in EAS Deployment Information management in the AF
procedure as defined in figure 6.2.3.4.2-1 in TS 23.548 [3]. In step 3, EDI2
corresponding to Operator B is included in the Nnef_EASDeployment_Create
operation. In step 4, NEF#B could do authorization on the request from NEF#A.
8\. The same as EAS Deployment Information management in the SMF procedure as
defined in figure 6.2.3.4.3-1 in TS 23.548 [3].
9\. Step 3\~19 of EAS Discovery procedure in figure 6.2.3.2.2-1 in TS 23.548
[3] is reused, with the following difference:
In step 16, after determining the DNAI, SMF could determine the N6 traffic
routing information for the DNAI based on the N6 routing Information in EDI.
#### 6.38.2.2 Option2 - EWBI/AF-based EDI provision to serving Operator
Figure 6.38.2.2-1: EAS discovery procedure based on EWBI
NOTE 1: The serving PLMN gets EDI of PLMN, which shares the EHE, via EWBI
interface, and GSMA OP platform could act the role of AF. It assumes EWBI
supports the capability for exchanging application instance access information
between PLMNs.
1\. AF invokes the Nnef_EASDeployment_Create operation with EDI1 corresponding
to PLMN hosting EHE. The EDI1 contains DNAI(s) corresponding to PLMN hosting
EHE.
2\. NEF translates the received EDI1 from AF to a new EDI2 corresponding to
UE\'s serving PLMN:
\- NEF translates DNAI in the received EDI1 to the DNAI of serving PLMN, and
includes the DNAI of serving PLMN in the new EDI2;
\- (optional) NEF adds N6 traffic routing information in the new EDI2.
NOTE 2: The translation of DNAI could be based on configured relationship
between DNAIs from different PLMNs, or NEF could retrieve serving PLMN\'s DNAI
dynamically, e.g. based on solution from KI#7, described in clause 5.7. The N6
traffic routing requirements could be determined based on SLA between
operators.
3\. The NEF of Operator A sends Nnef_EASDeployment_Create Response to the AF.
4-5. NEF stores the received EDI into UDR.
6\. The same as EAS Deployment Information management in the SMF procedure as
defined in figure 6.2.3.4.3-1 in TS 23.548 [3].
7\. Steps 3-19 of EAS Discovery procedure in figure 6.2.3.2.2-1 in TS 23.548
[3] is reused, with the following difference:
\- In step 16, after determining the DNAI, SMF could determine the N6 traffic
routing information for the DNAI based on the N6 routing Information in EDI.
### 6.38.3 Impacts on services, entities and interfaces
EAS Deployment Information (EDI) is extended with N6 traffic routing
Information for DNAI.
NEF:
\- supports EDI translation.
AF:
\- supports the new EDI.
SMF:
\- supports N6 traffic routing Information in EDI.NEF.
## 6.39 Solution 39 (KI#1, KI#5): Support EAS relocation of inter-PLMN
### 6.39.1 Description
The following solution corresponds to the key issue #1 on Accessing EHE in a
VPLMN when roaming as specified in clause 5.1 \"how to support the edge
relocation in roaming scenarios\" and key issue #5 on GSMA OPG impacts and
improvements for EHE operated by separate party as specified in clause 5.5
\"how the 5GS facilitates edge relocation between an EAS deployed by a source
EHE provider to another EHE deployed by a target EHE provider, even in
scenarios when EHEs are operated by different service providers\".
This solution makes the following assumptions:
\- the EAS relocation is triggered by AF (e.g. due to the load balance between
EAS instances in the EHE);
\- an OP to deploy EAS on another OP, and these OPs are different PLMNs;
\- the EAS is relocated from VPLMN/HPLMN to HPLMN/VPLMN.
The solution is to address EAS relocation of different PLMNs, and it is
illustrated as the scenario of figure 6.39.2.1-1. The EHE1 is operated by OP1
in PLMN1. In the EHE1, there is a EAS1 deployed by OP1 and a EAS4 deployed by
OP2. The EHE2 is operated by OP2 in PLMN2. In the EHE2, there is a EAS2
deployed by OP1 and a EAS3 deployed by OP2.
Figure 6.39.1-1: Scenario of EAS relocation from VPLMN to HPLMN
Figure 6.39.1-2: Scenario of EAS relocation from HPLMN to VPLMN
Figure 6.39.1-3: Scenario of EAS relocation between operators via N6
### 6.39.2 Procedures
#### 6.39.2.1 EAS relocation from VPLMN to HPLMN (KI#1)
Figure 6.39.2.1-1: EAS relocation from VPLMN to HPLMN
0\. When UE is roaming to VPLMN, it establishes a LBO PDU Session to access
the source EAS (EAS2), which is deployed by OP1 in VPLMN (EHE of OP2), e.g.
OP1 and OP2 have a federation agreement.
1\. When the EAS relocation is triggered, AF determines the source EAS should
be relocated to the target EAS (e.g. EAS 1) deployed by OP1 in HPLMN (e.g.
based on a federation agreement). The AF invokes Nnef_TrafficInfluence_Create
or Nnef_TrafficInfluence_Update service operation to send the request message
to NEF, or invokes Npcf_PolicyAuthorization_Create or
Npcf_PolicyAuthorization_Update to send the request message to the PCF
directly. The request message includes the PLMN ID, which indicates the EAS
should be relocated to the target PLMN (identified by PLMN ID).
If 5GC supports EAS IP replacement mechanism, the EAS IP replacement
information (i.e. source EAS IP address and port number, target EAS IP address
and port number) is sent to the V-SMF as specified in clause 6.3.3 of TS
23.548 [3]. Alternatively, the AF sends the EAS information (e.g. EAS IP
address) to network and to UE via application layer.
2\. The PCF creates and sends the PCC rule to the V-SMF by invoking
Npcf_SMPolicyControl_UpdateNotify service operation. The PCC rule includes the
PLMN ID.
3\. V-SMF discovers the H-SMF.
If the V-SMF has knowledge of EAS deployment information in HPLMN, the V-SMF
determines the target DNAI based on the EAS deployment information and IP
address of target EAS. V-SMF sends the target DNAI to the V-AMF by invoking
Nsmf_PDUSession_SMContextStatusNotify service operation. Then, V-AMF selects
H-SMF based on the target DNAI. Then, H-SMF sends Nsmf_PDUSession_Context
Request to V-SMF.
Alternatively, the V-SMF sends discovery request to vNRF by invoking
Nnrf_NFDiscovery_Request (serving PLMN ID, home PLMN ID), and discovers the
H-SMF as specified in clause 4.17.5 in TS 23.502 [9].
4\. The V-SMF inserts or changes the UL-CL/BP V-UPF. The V-SMF sends an inter-
PLMN relocation indicator to H-SMF by Nsmf_PDUSession_Update Request. The
inter-PLMN relocation is to indicate the EAS is relocated from VPLMN to HPLMN.
5\. The H-SMF selects the H-PSA UPF based on the EAS IP replacement
information/EAS information. H-SMF configures the H-PSA UPF for traffic
routing towards target EAS. If the EAS IP replacement information is received,
the H-SMF configures H-PSA UPF with EAS IP replacement information.
6\. The H-SMF sends the acknowledgement message to the V-SMF, which includes
the tunnel information towards H-PSA UPF.
7\. When V-SMF receives the acknowledgement, V-SMF configures the UL-CL/BP
V-UPF for traffic routing towards H-PSA UPF if the destination address is the
IP address of source EAS or target EAS.
#### 6.39.2.2 EAS relocation from HPLMN to VPLMN (KI#1)
Figure 6.39.2.2-1: EAS relocation from HPLMN to VPLMN
0\. The UE establishes PDU Session to access the source EAS (EAS1).
1\. When the EAS relocation is triggered, AF determines the source EAS should
be relocated to the target EAS (e.g. EAS 2) deployed by OP1 in VPLMN (e.g.
based on a federation agreement). The AF invokes Nnef_TrafficInfluence_Create
or Nnef_TrafficInfluence_Update service operation to send the request message
to NEF, or invokes Npcf_PolicyAuthorization_Create or
Npcf_PolicyAuthorization_Update to send the request message to the PCF
directly. The request message includes the PLMN ID, which indicates the EAS
should be relocated to the target PLMN (identified by PLMN ID).
If 5GC supports EAS IP replacement mechanism, the EAS IP replacement
information (i.e. source EAS IP address and port number, target EAS IP address
and port number) is sent to the V-SMF as specified in clause 6.3.3 of TS
23.548 [3]. Alternatively, the AF sends the EAS information (e.g. EAS IP
address) to network and to UE via application layer.
2\. If the PCF authorizes the traffic routing in the VPLMN is allowed, the PCF
creates and sends the PCC rule to the V-SMF by invoking
Npcf_SMPolicyControl_UpdateNotify service operation. The PCC rule includes the
PLMN ID.
3\. H-SMF discovers the V-SMF.
If the H-SMF has knowledge of EAS deployment information in VPLMN, the H-SMF
determines the target DNAI based on the EAS deployment information and IP
address of target EAS. H-SMF sends the target DNAI to the H-AMF by invoking
Nsmf_PDUSession_SMContextStatusNotify service operation. Then, H-AMF selects
V-SMF based on the target DNAI. Then, V-SMF sends Nsmf_PDUSession_Context
Request to H-SMF.
Alternatively, the H-SMF sends discovery request to hNRF by invoking
Nnrf_NFDiscovery_Request (home PLMN ID, serving PLMN ID), and discovers the
V-SMF as specified in clause 4.17.5 in TS 23.502 [9].
4\. The H-SMF inserts or changes the UL-CL/BP H-UPF. The H-SMF sends an inter-
PLMN relocation indicator to V-SMF by Nsmf_PDUSession_Update Request. The
inter-PLMN relocation indicator is to indicate the EAS is relocated from HPLMN
to VPLMN. Optionally, the H-SMF may check with H-UDM whether UE is authorized
to access VPLMN.
5\. The V-SMF selects the V-PSA UPF based on the EAS IP replacement
information/EAS information. V-SMF configures the V-PSA UPF for traffic
routing towards target EAS. If the EAS IP replacement information is received,
the V-SMF configures V-PSA UPF with EAS IP replacement information.
6\. The V-SMF sends the acknowledgement message to the H-SMF, which includes
the tunnel information towards V-PSA UPF.
7\. When H-SMF receives the acknowledgement, H-SMF configures the UL-CL/BP
H-UPF for traffic routing towards V-PSA UPF if the destination address is the
IP address of source EAS or target EAS.
#### 6.39.2.3 EAS relocation between operators via N6 (KI #5)
Figure 6.39.2.3-1: EAS relocation between operators via N6
0\. The UE establishes PDU Session to access the source EAS (EAS1) in PLMN1.
1\. When the EAS relocation is triggered, AF determines the source EAS should
be relocated to the target EAS (e.g. EAS 2 as shown in figure 6.39.1-3)
deployed by OP2 in target PLMN2 (e.g. based on a federation agreement). The AF
invokes Nnef_TrafficInfluence_Create or Nnef_TrafficInfluence_Update service
operation to send the request message to NEF, or invokes
Npcf_PolicyAuthorization_Create or Npcf_PolicyAuthorization_Update to send the
request message to the PCF directly. The request message includes the PLMN ID,
which can be used as an inter-PLMN relocation indicator and indicates the EAS
should be relocated to the target PLMN (identified by PLMN ID).
If 5GC supports EAS IP replacement mechanism, the EAS IP replacement
information (i.e. source EAS IP address and port number, target EAS IP address
and port number) is sent to the V-SMF as specified in clause 6.3.3 of TS
23.548 [3]. Alternatively, the AF sends the EAS information (e.g. EAS IP
address) to network and to UE via application layer.
2\. If the PCF authorizes the traffic routing in the PLMN1 (serving PLMN) is
allowed, the PCF creates and sends the PCC rule to the SMF by invoking
Npcf_SMPolicyControl_UpdateNotify service operation. The PCC rule includes the
PLMN ID.
3\. Based on the received PLMN ID, the SMF can differentiate the EAS
deployment information of different PLMNs (the PLMN ID is included in the EAS
deployment information) and determine the target DNAI corresponding to PLMN1,
and then SMF inserts or changes the PSA UPF that supports target DNAI to
access target EAS via controlled IP network. The SMF configures the PSA UPF
for traffic routing towards target EAS. If the EAS IP replacement information
is received, the SMF configures UPF with EAS IP replacement information.
4\. UE accesses the EAS deployed in PLMN2 using PSA UPF via N6.
### 6.39.3 Impacts on services, entities and interfaces
#### 6.39.3.1 EAS relocation between VPLMN and HPLMN (clause 6.39.2.1 and
6.39.2.2)
AF:
\- determines the target EAS and sends corresponding PLMN ID.
V-SMF:
\- determines target DNAI based on EAS information and EAS deployment
information;
\- sends an inter-PLMN relocation indicator to H-SMF;
\- configures the UL-CL/BP V-UPF for traffic routing towards H-PSA UPF if the
destination address is the IP address of source EAS or target EAS.
H-SMF:
\- determines target DNAI based on EAS information and EAS deployment
information;
\- sends an inter-PLMN relocation indicator to V-SMF;
\- configures the UL-CL/BP H-UPF for traffic routing towards V-PSA UPF if the
destination address is the IP address of source EAS or target EAS.
PCF:
\- authorizes the traffic routing in the target PLMN is allowed;
\- creates the PCC rule, which includes the PLMN ID.
H-AMF:
\- selects V-SMF based on the target DNAI received from H-SMF.
EAS Deployment information:
\- adding PLMN ID.
#### 6.39.3.2 EAS relocation between operators via N6 (clause 6.39.2.3)
AF:
\- determines the target EAS and sends corresponding PLMN ID.
PCF:
\- authorizes the traffic routing in the target PLMN is allowed;
\- creates the PCC rule, which includes the PLMN ID.
EAS Deployment information:
\- adding PLMN ID.
## 6.40 Solution 40 (KI#5): EAS discovery for shared EHE
### 6.40.1 Introduction
This solution addresses Key Issue #5 and allows the discovery of an Edge
Application Server (EAS) within a set of Operators sharing the EHE. It is
assumed that the EAS is hosted by a different PLMN than the PLMN that is
serving the UE, and the two PLMNs have IP connection at edge area.
### 6.40.2 Functional description
In this solution description, it is assumed that the EAS is deployed in
MNO2\'s PLMN2 and that the UE is connected to MNO1\'s PLMN1 (see figure
6.40.2-1). The solution is based on the following two steps:
**Step 1: Configuration phase**
The MNO2 AF provides the DNS query filtering information for PLMN2 EHE as well
as the EASDF Deployment information for PLMN2 described in table 6.40.2-1 to
EASDF1 in PLMN1 before the PDU Session establishment.
**Step 2: After PDU Session establishment**
When a DNS query from UE is intended for a specific application at edge, but
EASDF1 in PLMN1 finds that the application cannot be found in current PLMN1\'s
edge platform but can be found in PLMN2\'s DNS query filtering information,
the EASDF1 will send (UE IP address, DNS handling rule) created by SMF1 to the
selected EASDF2 through SEPP through control plane. Then, EASDF1 forwards the
DNS Query message to EASDF2 through user plane. EASDF2 then sends the DNS
query to DNS server in PLMN2 for EAS discovery.
DNS query filtering information includes the PLMN2\'s supported EAS FQDN(s).
The EASDF2 is selected by EASDF1 based on UE location, EASDF2 serving area,
EDI information for PLMN2 EHE, and the N6 Transmission requirement.
EASDF1 sends DNS query to EASDF2 through user plane. The DNS query is
transmitted in the path of EASDF1â†’UPF1â†’UPF2â†’EASDF2. The UPF1 and UPF2 are
locally configured to support the DNS message transmission between two PLMNs.
The indication of supporting shared EAS discovery will be included in UE SM
subscription data. SMF1 gets this information from UDM1 during the PDU Session
establishment. SMF1 may select the proper UPF(s) to support the DNS message
transmission via two PLMNs. The UPF(s) in PLMN1which support access to PLMN2
domain, may support to add DSCP value in IP layer to guarantee the
transmission between two PLMNs.
MNO2 AF may create an External Group ID to show that these UE(s) support the
interaction between different PLMNs.
Figure 6.40.2-1: Architecture with Operator Platform
**EASDF Deployment Information**
EASDF1 finds EASDF2 based on EASDF Deployment Information (EDI) information
including UE location, serving area of EASDF2 in PLMN2, N6 transmission
requirement of PLMN2.
Table 6.40.2-1: EASDF Deployment Information
+----------------------------------+----------------------------------+ | Parameters | Description | +==================================+==================================+ | PLMN ID(s) | Used to identify in which PLMN | | | the EAS is located | +----------------------------------+----------------------------------+ | EASDF FQDN(s) | FQDN(s) of EASDF in other PLMN | +----------------------------------+----------------------------------+ | Serving area(s) | Serving area where the EASDF can | | | provide service | +----------------------------------+----------------------------------+ | External Group | Group ID for the EAS Deployment | | Identifier/Internal Group | information. | | Identifier | | | | [optional] | | | | | | (NOTE 1) | +----------------------------------+----------------------------------+ | N6 Transmission requirement | Transmission requirements when | | (e.g. DSCP) | packet transmit between two | | | PLMNs. This parameter will be | | | added by UPF of PLMN1 in the | | | IP-layer when packet is sent out | | | from PLMN1 to PLMN2. | | | | | | [optional] | +----------------------------------+----------------------------------+ | NOTE 1: The AF may provide | | | External Group Identifier, and | | | NEF can map the External Group | | | Identifier into Internal Group | | | Identifier according to | | | information received from UDM. | | | The PLMN2 provides external | | | group identifier to PLMN1 thus | | | PLMN1 can identify that the UE | | | is allowed to access the EAS in | | | PLMN2. | | +----------------------------------+----------------------------------+
### 6.40.3 Procedures
Figure 6.40.3-1: EAS discovery in shared EAS scenario
1\. Steps 1-6 are the same as EAS discovery procedure in clause 6.2.3.2.2 of
TS 23.548 [3].
2\. UE sends DNS query to EASDF1.
3\. If EASDF1 finds the DNS Query message cannot be resolved by PLMN1\'s DNS
server, but matches a PLMN2\'s FQDN(s) information, EASDF1 sends the DNS Query
Message to SMF with providing indication that EASDF2 in PLMN2 should be
selected.
NOTE: When EASDF receives multiple DNS Query messages from one UE, if EASDF
detects that these DNS Query messages are the same, EASDF will only send the
Neasdf_DNSContext_Notify Request once to SMF for these DNS Query messages.
4\. The SMF responds with Neasdf_DNSContext_Notify Response.
5\. EASDF1 invokes Neasdf_DNSContext_Create Request (UE IP address, PLMN1 ID,
notification endpoint, (DNS message handling rules)) to the selected EASDF2 in
PLMN2.
The EASDF2 creates a DNS context for the PDU Session and stores the UE IP
address, PLMN1 ID, notification endpoint, (DNS message handling rules) into
the context.
The DNS handling rule is created by SMF and redirected to EASDF1 and EASDF1
sends this to EASDF2. In this handling rule, option A is used to forward the
DNS message with the EDNS Client Subnet option that is updated to UE location
information. Option B is not supported since the EASDF1 does not have DNS
address in PLMN2.
6\. The EASDF2 invokes the service operation Neasdf_DNSContext_Create
Response.
7\. EASDF1 sends DNS query to EASDF2 through user plane. The DNS query may
pass though UPF1 which is able to access UPF2 in PLMN2. The DSCP value can be
added by UPF1 in DNS query IP layer to satisfy transmission requirement with
low latency between two PLMNs.
8-9. The same as steps 12-13 in clause 6.2.3.2.2 in TS 23.548 [3].
10\. EASDF2 returns DNS response (EAS IP address or FQDN) to EASDF1.
11-12. The same as steps 14-15 in clause 6.2.3.2.2 in TS 23.548 [3].
13\. The SMF may perform UL-CL/BP and Local PSA selection and insert UL-CL/BP
and Local PSA.
14-16. The same as steps 17-19 in clause 6.2.3.2.2 in TS 23.548 [3].
During PDU Session Release procedure, the SMF triggers the removal of the DNS
context by invoking Neasdf_DNSContext_Delete service from EASDF1 to EASDF2.
### 6.40.4 Impacts on existing entities and interfaces
EASDF:
\- enhanced to support to communicate with EASDFs in other PLMN to transform
DNS handling rule and related information;
\- needs to be configured with EASDF Deployment information to discover other
PLMN\'s EASDF.
UDM:
\- UE authorization for EAS discovery via other PLMN\'s EASDF.
UPF:
\- enhanced to support the addition of N6 Transmission requirement (e.g. DSCP)
into IP-layer to ensure low latency.
AF:
\- can configure other PLMN\'s DNS query filtering information and EASDF
deployment information in serving PLMN.
## 6.41 Solution 41 (KI#6): Controlling non-3GPP access of EC traffic via URSP
and ATSSS
### 6.41.1 High level description
If a network is to apply EC-related functionality such as providing
connectivity to the edge for all or part of the traffic for a given PDU
Session, and the EC-related functionality requires specific consideration of
traffic steering to the non-3GPP access, then the network re-configures the
URSP rules in the UE for the RDS corresponding to the EC traffic. Examples of
useful URSP rules:
\- setting the Access Type Preference to \"3GPP\" for the given EC traffic
descriptors, DNN and S-NSSAI. This will result in setting up the PDU Session
carrying the EC traffic on the 3GPP access.
\- setting the Access Type Preference to \"Multi-access\" for the given
traffic descriptors, DNN and S-NSSAI.
The latter is used when a refined control of traffic steering over the 3GPP
and non-3GPP accesses is needed, based on appropriate ATSSS rules for the PDU
Session provided by the network (SMF). Examples of useful ATSSS rules to
control steering EC traffic to non-3GPP access (see clause 5.32.8 of TS 23.501
[2]):
\- Steering Mode=Active-Standby, Active=3GPP & no Standby (octet f+4=0000001):
it results in steering the related traffic within the PDU Session (described
by the traffic descriptors) always to the 3GPP access;
\- Steering Mode=Load Balancing allows for using a the non-3GPP access based
on latency and loss thresholds.
NOTE 1: SMF may change the access network over which the traffic of a GBR QoS
flow is transmitted, and in this way it can both select the access for this
QoS flow and provide bandwidth guarantees.
The solution may be applied for all connectivity models.
NOTE 2: How the URSP settings interact with built-in UE policies or user
preferences to influence the UE\'s decision to use connectivity outside of 5GC
is out of scope.
### 6.41.2 Procedures
For Multiple Sessions and Distributed Anchor connectivity models, the existing
procedures are applicable, where the following options may be used:
\- the URSP rules and ATSSS rules are configured in the UE before or during
the setup of the PDU Session, if the corresponding non-3GPP access related
policies are already available;
\- if the URSP rules are dynamically updated (based on Application guidance
for URSP determination clause 4.15.6.10 in TS 23.502 [9]) while some EC
traffic is ongoing on a PDU Session, the updated rules might not be enforced
by the UE immediately for this traffic, but they will be applied for any
application traffic that will start later. Updating the URSP rules requires
SMF notification towards the UE PCF.
For the Session Breakout scenario, only the 3GPP access should be allowed for
the EC traffic, because the UL-CL is reachable only through that access, since
there are no ATSSS procedures that would ensure that an UL-CL can be on path
when the UE connects through a non-3GPP access. Based on the received EC
related policy and deployment information the SMF may, however, select an UL-
CL based on existing procedures if the UE connects through a 3GPP access. One
simple solution to keep the EC traffic to 3GPP access is to set the Access
Type Preference to \"3GPP\" in the corresponding URSP rule for this PDU
Session. To avoid other, non-EC traffic be constrained to the 3GPP access,
WIFI offload can be setup for that traffic using the \"Non-Seamless Offload
indication\" as route selection in the corresponding URSP rule. An example
URSP rule set is given in table 6.41.2-1. Note that the traffic descriptors in
the URSP rules may need to be updated, e.g. based on AF Application guidance
for URSP determination, resulting that the updated URSP rules might not be
immediately enforced for some ongoing traffic.
Table 6.41.2-1: Example URSP rules to restrict EC traffic to 3GPP access in
the Session Breakout model
+----------------------+----------------------+----------------------+ | URSP rules | Comments | | +======================+======================+======================+ | Rule Precedence =1 | Route Selection | This URSP rule | | | Descriptor | associates the | | Traffic Descriptor: | Precedence = 1 | traffic of | | Application | | application \"App1\" | | descriptor=App1 | DNN Selection: | and the traffic to | | | internet | \"De | | IP descriptor = | | stination_prefix1\" | | Destination_prefix1 | Access Type | 3GPP access and the | | | preference: 3GPP | \"internet\" DNN. | | | access | | | | | It enforces the | | | | following routing | | | | policy: | | | | | | | | The traffic of App1 | | | | as well as the | | | | traffic to | | | | \"De | | | | stination_prefix1\" | | | | should be | | | | transferred on a PDU | | | | Session supporting | | | | DNN=internet over | | | | 3GPP access. If this | | | | PDU Session is not | | | | established, the UE | | | | shall attempt to | | | | establish a PDU | | | | Session with the | | | | \"internet\" DNN | | | | over 3GPP access. | +----------------------+----------------------+----------------------+ | Rule Precedence | Route Selection | This URSP rule | | =default | Descriptor | enables all the | | | Precedence = 1 | traffic that is not | | Traffic Descriptor: | | covered by the | | * | Non-seamless Offload | previous rule of | | | indication: | higher preference be | | | Permitted | directly offloaded | | | | to WLAN, if the UE | | | | is connected to a | | | | WLAN | +----------------------+----------------------+----------------------+
A specific case in the Session Breakout model is when the EC traffic shares
the PDU Session with other traffic that requires traffic steering based on
ATSSS. In that case the Access Type Preference in the URSP rule for this
traffic is set to \"Multi-access\", based on which the UE sets up a MA PDU
Session for this DNN and S-NSSAI on all available accesses. The MA PDU Session
is set up to a C-PSA, where the ATSSS functionality is applied for the non-EC
traffic. The SMF configures ATSSS rules for the EC traffic (identified by
Application ID or IP ranges in route descriptors) that steer the traffic
always to the 3GPP access (using Steering Mode=Active-Standby, see clause
6.41.1). Other traffic may be allowed to be offloaded to WIFI by URSP rules as
described above.
For Dynamic PSA distribution using EASDF, URSP rules could be set similarly as
for the Session Breakout Scenario, see table 6.41.2-1, assuming that the PCF
knows the traffic descriptors of the EC applications. Further flexibility for
the EC applications may be achieved by using the ATSSS rules. An example
solution based on ATSSS rules is depicted in the generic figure below:
Figure 6.41.2-1: ATSSS solution for controlling non-3GPP usage for Dynamic PSA
distribution
1\. UE sets up a PDU Session. The session is initially set up to a C-PSA and
the URSP rules in the UE need not contain any constraints related to non-3GPP
usage. The UE may indicate in the session establishment message its ATSSS
capability and that \"MA-PDU Network upgrade allowed\" for this PDU Session,
which can help selecting an ATSSS capable SMF for this PDU Session. SMF
creates/updates the EASDF context for this PDU Session.
2\. A DNS query for the EAS discovery from the UE APP triggers dynamic PSA
change in the SMF.
3\. SMF initiates a PDU Session modification or PDU Session release depending
on the SSC Mode selected.
4\. The UE initiates a PDU Session establishment, where the UE indicates in
the session establishment message its ATSSS capability and that \"MA-PDU
Network upgrade allowed\" for this PDU Session. The SMF (that may be a new SMF
that receives indication to provide connectivity to the edge from the AMF in
the form of a DNAI) selects an edge UPF (L-PSA), and it provisions the DNS
settings in the UE, as described in clause 6.2.2.4 of TS 23.548 [3]. The SMF
also upgrades the session to a MA PDU Session, based on related policy rules
that may be received from the PCF. If UE is registered to non-3GPP access,
then the UE initiates a MA PDU Session establishment also on this leg.
Otherwise, it initiates another MA PDU Session establishment when it connects
to the non-3GPP.
5\. SMF configures ATSSS rules for this MA PDU Session that will define how
the different accesses may be used by the EC application.
6\. UE starts applying the ATSSS rules for this PDU Session. The EC
application traffic will be routed to the EAS through the L-PSA from either
allowed access.
### 6.41.3 Impacts on services, entities and interfaces
UE:
\- URSP support, and (conditionally, if ATSSS rules apply) ATSSS support.
NOTE 1: It is expected that the UE supports the URSP rules for non-seamless
offload as specified in clause 6.1.2.2.1 of TS 23.503 [13].
SMF:
\- (conditionally, if dynamic update to URSP rules apply) notification towards
the UE PCF about the EC traffic handling that may be mediated by SM PCF.
NOTE 2: It is expected that the SMF supports the procedure for EAS discovery
in the Session Breakout model as described in TS 23.548 [3] also for the MA
PDU Sessions with 3GPP access.
## 6.42 Solution 42 (KI#6): Network-guided EC traffic switching
### 6.42.1 General
#### 6.42.1.1 Introduction
The KI#6 deals with the scenario where Edge computing enablers cannot be
served to the UE when the UE has taken a decision to switch application
traffic to a route that is not integrated with MNO. In a typical scenario, UE
considers multiple inputs before choosing the best of the available routes for
application traffic. The range of inputs include user and application
preferences, power consumption status of the UE, delay status in both routes,
server loading status, etc.
When the 5G connectivity offers additional benefits for edge computing
traffic, this information will be critical to the UE before making the
decision to switch away traffic that is benefitting from MNO\'s edge
deployments.
This solution assumes that the EAS is also reachable via Internet, and that
the UE application is aware of this and that the UE would not switch the
traffic away from 3GPP access if it is not the case.
#### 6.42.1.2 Description
The current edge enablers in 5G network are often not visible to the UE. For
example, a UE does not know if the application traffic is being carried over a
PDU Session that has access to edge data centre. Similarly, whether a PDU
Session has a UL-CL and L-PSA inserted for local routing of certain
application traffic is not known to the UE. This information is foreseen as an
important parameter that UE should consider before deciding on which access to
use for certain application traffic, when all other things are equal.
#### 6.42.1.3 WLAN offload guided by the network
In the URSP rules today, there is only a possibility to indicate if a given
traffic can be offloaded to WLAN. The presence of the route selection
component \"Non-Seamless Offload indication\" in a Route Selection Descriptor
and the priority of the Route selection descriptor for a URSP rule informs UE
when the corresponding traffic can be offloaded to a non-integrated non-3gpp
access.
However, this method is a static guidance on whether traffic can be routed
over non-integrated path corresponding to the priority of the RSD.
For edge computing traffic, whether the network is currently offering any of
the edge optimized routing in the network is an aspect that varies
dynamically. To enable the UE to make an informed decision, additional
evaluations may be required according to the current nature of traffic
routing.
The URSP information can provide a static guidance to the UE, so that it
evaluates the use of edge enablers at the time when traffic switching is
decided. A new route selection component in the Route Selection Descriptor is
introduced for this purpose.
Table 6.42.1.3-1: Addition to table 6.6.2.1-3 of TS 23.503 [13]: Route
Selection Descriptor
Information name Description Category PCF permitted to modify in URSP Scope
* * *
WLAN Offload Guidance The presence of this component indicates that decision
on offloading edge computing traffic matching the Traffic Descriptor for this
URSP rule is conditional to the evaluation of conditions informed by the
network Optional Yes UE context
The conditions for switching the traffic are dynamic indications that the
network provides to the UE.
Dynamic conditions are indicated to the UE using the following information.
First one is an indication that network is using any of the edge enablers for
the SDF corresponding to the edge application. This could be for example, the
use of L-PSA providing access to an EAS in a local Edge Hosting Environment or
a UL-CL with traffic offload in a session break-out model.
The second component of dynamic condition is a configuration to measure
latency experienced by the Edge application. For an application, one of the
most important benefits of connecting to an Application Server in edge hosting
environment is latency. When the UE has alternate paths to reach an
application server, it would be an important parameter to measure the round-
trip time for these alternate paths. During the PDU Session
establishment/modification, the network configures the UE with necessary
measurement configuration to do an RTT measurement (similar to the performance
measurement for ATSSS) to the EAS in Edge Hosting environment. The UE triggers
measurement on the cellular path and evaluates RTT on alternate paths before
deciding which one should be selected to meet applications\' requirement.
### 6.42.2 Procedures
The following call flow illustrates the procedure for traffic offload
guidance.
Figure 6.42.2 1: Network guided EC traffic switching
1\. The UE evaluates URSP rules on receiving an application PDU.
2\. The UE triggers a PDU Session Establishment/Modification request to carry
the application traffic.
3\. The SMF fetches appropriate SM Policies for adding this SDF to a QoS Flow.
This may also need insertion of UL-CL/BP for the UE. SMF requests UPF to
perform RTT measurements to Application Server. The Application Server
information for RTT measurement is provided by the AF as part of
TrafficInfluence rules.
4\. SMF sends PDU Session Establishment Accept or Modification Command to the
UE. If UE is configured with edge enablers (e.g. L-PSA or UL-CL/BP) for any
traffic carried in this PDU Session, SMF includes an \"EC indication\" marked
per SDF. In this message, SMF also includes performance measurement rules
applicable for this SDF, measured RTT value between UPF and Edge Application
Server, Traffic offload rule. The traffic offload rule can be either an
absolute threshold or factor by which non-3GPP RTT shall be better than 3GPP
RTT before UE offloads traffic.
5\. UE detects availability of an alternate non-3GPP path that is suitable for
this application traffic.
6\. UE performs RTT measurement in the UE-UPF path over 3GPP link.
7\. UE computes the aggregate RTT on the 3GPP path as the sum of measured RTT
on UE-UPF link and the UPF-AS RTT indicated by the SMF.
NOTE: The RTT between UPF and an application server in Edge Hosting
Environment is considered as a static component of the overall RTT.
8\. UE performs RTT computation between UE and the Application Server over the
non-3GPP link.
9\. UE applies the network provided traffic offload rule provided by the
network to the decision matrix for traffic offload.
### 6.42.3 Impacts to existing nodes
SMF:
\- provides an EC indication per SDF if any edge enablers are configured for
the traffic;
\- provides RTT measurement rules to the UE, instructs UPF for RTT measurement
to the AS.
PCF:
\- provides \"WLAN Offload guidance\" as part of RSD in URSP rules for a
traffic descriptor that may be subject to dynamic evaluation of edge
performance prior to traffic offload;
\- provides SM Policy rules with information for UPF-AS RTT measurement to the
SMF.
UPF:
\- performs UPF-AS RTT measurements;
\- enables UE-UPF performance measurements.
UE:
\- understands the URSP rules with traffic offload guidance;
\- performs performance measurement and applies the results according to the
configured traffic offload rules.
## 6.43 Solution 43 (KI#6): Network-based solution for keeping EC traffic on
3GPP Access
### 6.43.1 Description
When UE has several available access types in the UE location, the UE may
switch from 3GPP access to non-3GPP access; for example, at home, the non-3GPP
usually has better performance or non-3GPP has higher priority than 3GPP
access.
But for the EC traffic on UE, if the traffic is switched from 3GPP access to
non-3GPP access, the EC features might not be maintained, for example, the
N3IWF is located in the central, and the traffic should be routed to central
PSA and routed back to EAS in the local area.
One of the solutions is, when UE triggers PDU Session establishment using the
PDU Session ID of EC traffic towards 5GC in non-3GPP access, the 5GC can judge
this PDU Session is an EC PDU Session, and rejects the PDU Session
establishment request. So, the UE can keep the EC PDU Session to not switched
to non-3GPP access, and still use this EC PDU Session to communicate with EAS
via 3GPP access.
NOTE: This solution applies to the situation of 5GC controlled non-3GPP access
procedure, also called integrated non-3GPP.
### 6.43.2 Procedures
#### 6.43.2.1 Network sides rejects EC-PDU Sessions handover from 3GPP Access
to non-3GPP Access
Figure 6.43.2.1-1: Network-based solution for keeping EC traffic on 3GPP
Access
1\. If the UE is not registered via non-3GPP access, the UE shall initiate
Registration procedure as defined in clause 4.12.2 (untrusted non-3GPP access)
of TS 23.502 [9] or as defined in clause 4.12a.2.2 of TS 23.502 [9].
2\. The UE performs PDU Session Establishment procedure in non-3GPP Access
with the PDU Session ID of the PDU Session to be moved as specified from step
1 to step 2a in clause 4.12.5 of TS 23.502 [9] or in clause 4.12a.5 of TS
23.502 [9]. At this stage, the PDU Session ID includes both the EC PDU Session
to EAS and non-EC PDU Session to non-EAS.
The UE can have an indication of the preference of whether the some of the PDU
Sessions should be switched to non-3GPP access or not, to 5GC, essentially the
PDU Session ID of EC PDU Session towards EAS. There exists the situation that
user\'s preference is to access non-3GPP, and not to keep the EC PDU Session
at 5GS.
3\. The SMF receives the PDU Session establishment request from UE, that
includes multiple PDU Session IDs. The SMF can identify the PDU Session is EC
or non-EC, according to PDU Session ID. Also, SMF can identify the PDU Session
is EC or non-EC PDU, according to the PDU Session parameters that PDU Session
ID refers to, that helps SMF to identify whether it is EC PDU Session or not:
\- S-NSSAI: The SMF identifies the whether the S-NSSAI the PDU Session access
is local or not.
\- DNN: The SMF identifies the whether the DNN the PDU Session selects is
local or not.
\- PSA IP address: The SMF checks the PSA IP address that serves the UE, and
decides whether the PSA IP address is located in the IP range of local area or
local data network.
4\. According to the PDU Session ID, the PDU Session parameters that PDU
Session ID and user\'s preference, the SMF may reject the PDU Session
establishment request, if:
\- PDU Session ID represents an EC PDU Session;
\- there is no user preference of whether the EC PDU Session switch from 3GPP
access to non-3GPP access towards the EC PDU Session.
The SMF sends the rejection of the PDU Session ID that EC PDU Session refers
to, to UE via NAS message. The reason of rejection in NAS message is: the PDU
Session over non-3GPP Access is not allowed.
After UE receives the rejection, the UE can keep the EC PDU Session on 3GPP
access which the rejection of PDU Session ID refers to in the NAS message.
#### 6.43.2.2 UE decides PDU Session handover according to NWDAF analytics
In study of Rel-18 FS_AIMLsys, the UE obtaining the NWDAF analytics is
discussed and the UE can acquire the analytics from NWDAF via DCAF or NAS
messages.
In Rel-17, the NWDAF can provide the analytics of service experience in both
3GPP Access and non-3GPP Access according to the table 6.4.3-1 of TS 23.288
[19].
Table 6.43.2.2-1: Service Experience statistics (Referred to table 6.4.3-1 of
TS 23.288 [19])
Information Description
* * *
Application service experiences (0..max) List of observed service experience
information for each Application. > S-NSSAI Identifies the Network Slice used
to access the Application. > Application ID Identification of the Application.
> Service Experience Type Type of Service Experience analytics, e.g. on voice,
video, other. > UE location Indicating the UE location information (e.g. TAI
list, gNB ID, etc) when the UE service is delivered. > UPF Info Indicating UPF
serving the UE. > DNN DNN for the PDU Session which contains the QoS flow. >
Application Server Instance Address Identifies the Application Server Instance
(IP address of the Application Server) or FQDN of Application Server. **>
Service Experience** **Service Experience over the Analytics target period
(average, variance).** > SUPI list (0..SUPImax) List of SUPI(s) with the same
application service experience. > Ratio Estimated percentage of UEs with
similar service experience (in the group, or among all UEs). > Spatial
validity Area where the Application service experience analytics applies. >
Validity period Validity period for the Application service experience
analytics as defined in clause 6.1.3 of TS 23.288 [19]. **> RAT Type**
**Indicating the list of RAT type(s) for which the application service
experience analytics applies.** **> Frequency** **Indicating the list of
carrier frequency value(s) of UE\'s serving cell(s) where the application
service experience analytics applies.**
Also, the NWDAF can provide WLAN performance in certain area or under certain
SSID as indicated in table 6.11.3-1 of TS 23.288 [19].
The performance of different Access mode includes: QoS flow Bit Rate, QoS flow
Packet Delay, Packet retransmission, UL/DL data rate, etc.
When UE obtains the analytics above from NWDAF in certain UE location and time
range, the UE can decide whether to handover the EC-PDU Session from 5GC to
non-3GPP access according to the performance. For example, if in the certain
UE location and time, the EC-PDU Session in 3GPP Access has better performance
than the non-3GPP Access, for example, the lower packet loss and higher UL/DL
data rate, the UE can decide to not handover the EC-PDU Session to non-3GPP
Access, and vice versa.
Figure 6.43.2.2-1: NWDAF based solutions for keeping EC traffic not handover
to non-3GPP Access
1\. If the UE is not registered via non-3GPP access, the UE shall initiate
Registration procedure as defined in clause 4.12.2 (untrusted non-3GPP access)
of TS 23.502 [9] or as defined in clause 4.12a.2.2 of TS 23.502 [9].
2\. UE obtains the analytics from NWDAF. The Analytic ID includes Service
Experience, WLAN Performance. After UE obtains the analytics from NWDAF, the
UE can receive both of the performance under 3GPP Access and non-3GPP Access
in certain UE location and time range, for example, the QoS flow Bit Rate, QoS
flow Packet Delay, Packet retransmission, UL/DL data rate, etc.
3\. UE compares the performance between 3GPP Access and non-3GPP Access of a
certain EC PDU Session.
4\. If the UE decides that an EC PDU Session established in 3GPP Access has
better performance than non-3GPP Access, the UE decides to not handover this
PDU Session from 3GPP Access (for example, 5GS) to non-3GPP Access. If the PDU
Session established in 3GPP Access has worse performance than non-3GPP Access,
the PDU Session ID which the PDU Session referred to should be selected out,
and to be used in step 5, to handover to non-3GPP Access to acquire better
performance.
5\. The UE performs PDU Session Establishment procedure in non-3GPP Access
with the PDU Session ID selected by UE in step 4 of the PDU Session to be
moved as specified from step 1 to step 2a in clause 4.12.5 of TS 23.502 [9] or
in clause 4.12a.5 of TS 23.502 [9].
At this stage, the PDU Session which has worse performance in non-3GPP Access
should not be included in the PDU Session Establishment procedure.
### 6.43.4 Impacts on services, entities and interfaces
UE:
\- provides the user\'s preference in NAS messages which access type are
preferred or whether the PDU Session is expected to switched to non-3GPP or
not.
SMF:
\- according to the user\'s preference and the PDU Session ID, the SMF
identifies the EC PDU Session and rejects the PDU Session establishment
request from UE.
## 6.44 Solution 44 (KI#6): EAS traffic switching avoidance
### 6.44.1 Description
This solution addresses Key Issue #6: Avoiding UE to Switch away from EC PDU
Session.
This solution considers a scenario where a UE discovers an EAS with assistance
of 5GC and uses a PDU Session for the data traffic exchange between
application in the UE and the discovered EAS. When non-integrated connectivity
becomes available for the UE, the UE connectivity setting (e.g. WiFi is on)
may induce that the data traffic for the EAS is switched from the PDU Session
to other session associated to the connectivity which is outside of 5GS. Then,
local access via UL-CL/BP and local PSA to the EAS cannot be supported for the
UE. To prevent this, 5GC may indicate to the UE that the traffic for EAS
discovered via 5GC assistance (e.g. with EASDF) shall not be switched away
from the PDU Session to other session associated to the access (e.g. non-
integrated Wi-Fi) that is not integrated with 5GS even if the non-integrated
connectivity becomes available for the UE. Such indication is based on the UE
subscription information and delivered by the SMF during the establishment
procedure for the PDU Session to which the EAS traffic is mapped.
Additionally, the UE needs to support a capability to prevent switching away
the EAS traffic according to the indication from the SMF.
In this regard, this solution proposes a procedure to address the following
aspects: (i) how to determine what EAS traffic is targeted for avoidance of
switching away from the 5GS for edge computing service and (ii) how to
indicate to UE such determination and the related information for the targeted
application traffic in order to prevent from switching away from the PDU
Session used for edge computing when connectivity outside 5GS (e.g. non-
integrated Wi-Fi) becomes available.
### 6.44.2 Procedures
Figure 6.44.2-1: EAS traffic switching information provisioning during PDU
Session Establishment
1-2. During the PDU Session Establishment procedure, UE may indicate to the
SMF its capability to support the EDC functionality and to control application
traffic switching via PCO.
3\. The SMF invokes Nudm_SDM_Get to retrieve the UE subscription information
from the UDM.
4\. The UDM provides the SMF with the UE subscription information that may
include an indication on UE authorization for EAS discovery via EASDF and EAS
traffic switching information. The EAS traffic switching information indicates
that the traffic for EAS discovered via 5GC assistance (e.g. with EASDF) shall
be delivered over 5GS access without being switched away from the PDU Session
to other session associated to the access that is not integrated with 5GS
(e.g. non-integrated Wi-Fi) even if the non-integrated connectivity becomes
available for the UE.
5\. The SMF selects an EASDF and perform DNS context creation at the selected
EASDF.
6-7. The SMF may decide to indicate to the UE either that the use of the EDC
functionality is allowed for this PDU Session or that the use of the EDC
functionality is required for this PDU Session. If the UE subscription
information retrieved in step 4 includes EAS traffic switching information,
the SMF indicates to UE that EAS traffic switching control is required via AMF
(by invoking Namf_Communication_N1N2MessageTransfer service) as follows:
\- If the SMF decides to indicate that EDC functionality is allowed, the SMF
indicates that EAS traffic switching control is required for the traffic of
the application(s) that is mapped onto the PDU Session and explicitly requests
the use of the EDC functionality.
\- If the SMF decides the use of EDC functionality is required for the PDU
Session, the SMF indicates to UE that EAS traffic switching control is
required for all the traffic of the application mapped onto the PDU Session.
\- If the UE does not indicate its capability to support EDC functionality
(i.e. does not support EDC functionality), the SMF indicates to UE that EAS
traffic switching control is required for all the traffic of applications that
are mapped onto the PDU Session and whose DNS resolution is performed via
EASDF.
8\. After the successful PDU Session Establishment, the UE informs upper layer
with the EAS traffic switching information indicated by the SMF in step 6-7.
The UE performs EAS traffic switching avoidance for the application traffic
associated to the PDU Session and indicated by the SMF as follows:
\- When the connectivity that is not integrated with 5GS becomes available,
the UE keeps the 5GS connectivity for the established PDU Session and does not
perform the switching the traffic away from the PDU Session for the following
application(s):
\- application(s) that explicitly requests the use of the EDC functionality if
the SMF indicates that EDC functionality is allowed and that EAS traffic
switching control is required for the traffic of the application(s) that is
mapped onto the PDU Session;
\- all the applications that are mapped onto the PDU Session and of which
traffic is transmitted over the PDU Session if the SMF indicates the use of
EDC functionality is required for the PDU Session;
\- application(s) that are mapped onto the PDU Session and of which DNS
resolution is performed via EASDF if the UE does not support EDC functionality
and if the SMF indicates that EAS traffic switching control is required.
### 6.44.3 Impacts on existing entities and interfaces
UE:
\- indicates to the SMF its capability to control application traffic
switching via PCO;
\- performs EAS traffic switching avoidance for the application traffic based
on the information provided by SMF.
UDM:
\- provides SMF with an indication on UE authorization for EAS traffic
switching information.
SMF:
\- determines to indicate UE that EAS traffic switching control.
## 6.45 Solution 45 (KI#1, KI#6): Application selected PDU Session
### 6.45.1 Description
This solution addresses KI#6: Avoiding UE to switch away from EC PDU Session.
This solution also addresses some parts of KI#1: Accessing EHE in a VPLMN when
roaming.
This solution is based on the existing functionalities in smartphones which
allows a UE application to ignore the UE OS preference on preferred
connectivity (3GPP vs non-integrated Wi-Fi). The UE Application will instead
decide which connectivity (PDU Session) to be used regardless if for example
Wi-Fi will become available or not. In current smartphones, the UE application
can either use UE OS Preference for data connectivity and then the UE OS will
automatically select the \"best\" connectivity when they become available.
Alternatively, the UE Application selects a specific network interface, which
corresponds to a specific PDU Session. In this case, the UE Application will
always use that network interface regardless of other applications or if the
UE OS connectivity preference is changing. When the UE Application has
selected a specific network interface (PDU Session) then the smartphone
supports the exposure of the operator provided DNS Server for that network
interface. In this solution, the UE Application should discover EAS from the
EASDF according to existing procedure and in addition, use the same PDU
Session for all edge related connectivity, not only for the DNS Query as
specified in clause 5.2 of TS 23.548 [3]\$.
NOTE: This solution is applicable when the UE Application is aware that the UE
Application uses an EC service.
### 6.45.2 Procedures
#### 6.45.2.1 Procedures for Application selected PDU Session
Figure 6.45.2-1: Procedure for Application selected PDU Session
1\. Existing PDU Session establishment procedure according to step 1 in clause
6.2.3.2.2 of TS 23.548 [3] where the SMF indicates to the UE that this PDU
Session is to be used for the EDC functionality.
2\. The UE Application selects the appropriate network interface for all edge
related communication to be used as long as it is available.
3\. The UE Application uses the selected network interface for the EAS
Discovery and Re-discovery as specified in clause 6.2.4 of TS 23.548 [3].
4\. The UE application uses the selected network interface for all
communication to the EAS.
### 6.45.3 Impacts on services, entities and interfaces
UE:
\- The UE Application is expected to select a specific network interface for
all edge related communications.
## 6.46 Solution 46 (KI#6): Avoid UE switching on-going EC traffic away from
3GPP access
### 6.46.1 Description
As described in clause 5.6.2, the existing edge computing enablers cannot be
used if the UE switches to an access that is not integrated with 5GS or does
not provide the expected characteristics. The on-going EC traffic in a PDU
Session may suffer an interruption or a bad user experience due to long UP
path. This solution avoids UE switching the on-going EC traffic away from 3GPP
access.
NOTE: This solution applies to options A and B as described in TS 23.548 [3].
### 6.46.2 Procedure
Figure 6.46.2-1 shows the call flow of avoiding UE switching on-going EC
traffic away from 3GPP access.
Figure 6.46.2-1: Avoid UE switching EC traffic away
1\. UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS 23.502
[9].
2\. UE sends DNS query including FQDN to EASDF.
3\. EASDF reports the FQDN to the SMF.
4\. The SMF determines the FQDN corresponds to EC service based on EAS
deployment information as described in clause 6.2.3.4 of TS 23.548 [3]. The
SMF initiates PDU Session Modification procedure.
5\. The SMF sends PDU Session Medication Command including an indicator that
it requests the UE to avoid switching traffic corresponding to the FQDN away
from the 3GPP access.
Based on the received indicator, the UE shall avoid switching away the on-
going traffic corresponding to the FQDN away from the 3GPP access even though
non-3GPP access is available and has a higher priority than 3GPP access.
### 6.46.3 Impacts on services, entities and interfaces
SMF:
\- sends an indicator to UE by initiating PDU Session Modification procedure.
UE:
\- avoids switching on-going EC traffic corresponding to the FQDN in DNS query
away from the 3GPP access.
## 6.47 Solution 47 (KI#6): Avoiding Switch Away Based on an SMF Indication
### 6.47.1 Description
#### 6.47.1.1 General
This solution addresses Key Issue #6 for the cases where the Distributed
Anchor Point, Session Breakout, and Multiple PDU Session connectivity models
are used.
The premise of the solution is that the SMF is aware of whether the PDU
Session uses a PSA UPF in local site and the SMF can send an \"edge-anchored\"
indication to the UE that indicates that the PDU Session uses a PSA UPF that
is in a local site and also a \"5GC-preference\" indication that indicates
that the network prefers to keep the traffic in the 5GC, or a \"3GPP-access-
preference\" indication that indicates that the network prefers to keep the
traffic on the 3GPP access. The indications may be coupled with descriptors of
the impacted traffic. The UE can use the \"edge-anchored\" indication to
notify any subscribed consumer (e.g. an application) mapped into the PDU
Session about the local PSA. Also, when non-integrated connectivity becomes
available for the UE, the UE can use the \"5GC-preference\" indication from
the SMF to help determine whether to use the non-integrated connectivity for
the traffic that is currently associated with a PSA UPF in a local site.
NOTE: The user preferences that are associated with the UE should be taken
into account and how this is done is not specified. For example, the user
preferences may indicate that all traffic should use non-integrated
connectivity when it is available. In such a scenario, this indications from
the SMF would be ignored.
#### 6.47.1.2 Procedure
In the case when the network provides connectivity to the edge for all or part
of the traffic for a given PDU Session, the SMF may include an \"edge-
anchored\" and \"5GC-preference\" or \"3GPP-access-preference\" indications in
the ePCO of the PDU Session Establishment Accept message or PDU Session
Modification Command. The \"edge-anchored\" indication indicates to the UE
that the that the PDU Session has a local PSA UPF. The \"5GC-preference\"
indication indicates that the 5GC prefers that the traffic stays within the
5GC (e.g. because the services are only available via the 5GC). The \"3GPP-
access-preference\" indication indicates that the network prefers to keep the
traffic on the 3GPP access.
The trigger for the SMF providing connectivity to the edge and sending the
\"edge-anchored\" and/or \"5GC-preference\" indication or \"3GPP-access-
preference\" indication in the ePCO may be:
\- A PDU Session Establishment request arriving from the UE through the AMF in
a Nsmf_PDUSession_CreateSMContext request message, where the SMF decides to
provide connectivity to the edge for all or part of this PDU Session. The
indications in the ePCO are sent by the SMF in the PDU Session Establishment
Accept message.
\- An EAS discovery message from the UE that is triggering in the SMF (via
from EASDF) a selection of a local PSA. The indications in the ePCO are sent
by the SMF in a PDU Session Modification Command message.
\- An AF traffic influence request via the NEF and PCF that is targeting
connectivity to the edge for some traffic within an existing PDU Session
(conveyed via a Npcf_SMPolicyControl_UpdateNotify message from the PCF). The
indications in the ePCO message are sent by the SMF in a PDU Session
Modification Command.
Once the PDU Session is established, if the SMF (re)selects a PSA UPF for the
PDU Session and there is no longer any local PSA UPF for the PDU Session, then
the SMF may send a PDU Session Modification Command to indicate in the ePCO
that the PDU Session should no longer be considered \"edge-anchored\".
Once the PDU Session is established, if none of the PSA UPF(s) are deployed in
a local site and the SMF (re)selects a PSA UPF for the PDU Session and the new
PSA UPF is deployed in a local site, then the SMF may send a PDU Session
Modification Command to the UE and indicate in the ePCO that the PDU Session
should now be considered \"edge-anchored\". The SMF may also send the \"5GC-
preference\" indication if there is a preference to keep the traffic within
the 5GC. Alternatively, the SMF may also send \"3GPP-access-preference\"
indication if there is a preference to keep the traffic on the 3GPP access.
The UE may use the \"edge-anchored\" indication to notify any subscribed
consumer (e.g. an application) mapped into the PDU Session about the local
PSA. The consumer (application) could use this information to perform actions
to maintain proper connectivity to edge computing resources, such as keeping
the 3GPP access active, monitoring non-3GPP access performance and taking
traffic routing decisions.
When the SMF has information about the impacted traffic or applications, e.g.
it has configured a branching point UPF or an uplink classifier UPF for the
PDU Session such that only some traffic is routed towards a PSA UPF in a local
site, then the \"edge-anchored\" and \"5GC-preference\" or \"3GPP-access-
preference\" indications may be sent to the UE in the ePCO with the Flow
Descriptor(s) (e.g. Packet Filters derived from the PDR(s) that were sent to
the branching point UPF or uplink classifier UPF to be used to detect which
traffic should be forwarded to the local site. The UE may use the Flow
Descriptor(s) to determine which traffic from the PDU Session is associated
with a PSA that is in a local site and may use this to notify the specific
applications.
In some cases, AF may become aware of the alternate connectivity options for a
UE and determines that a connectivity through 5GS is optimal. AF may request
5GS to provide the traffic guidance to the UE through a policy control update
procedure. The SMF may decide to send the \"edge-anchored\" and \"5GC-
preference\" or \"3GPP-access-preference\" indication once the traffic
corresponding to the SDF is detected based on this policy setting requested by
the AF. If the AF determines that an alternate connectivity is better, it may
request 5GS to stop providing traffic switching guidance to the UE.
When connectivity outside of 5GC becomes available for the UE, the UE may use
the \"5GC-preference\" or \"3GPP-access-preference\" indication and any
associated Flow Descriptor(s) to decide if the traffic that is currently
associated with a PDU Session should be transferred to connectivity outside of
5GC.
NOTE 1: How the \"edge anchored\" and \"5GC-preference\" or \"3GPP-access-
preference\" indications interact with user preferences to influence the UE\'s
decision to use connectivity outside of 5GC is out of scope.
NOTE 2: The SMF does not send an \"edge-anchored\" indication every time there
is branching point UPF or an uplink classifier UPF for the PDU Session; the
SMF only sends the \"edge-anchored\" indication when the branching point UPF
or uplink classifier UPF is being used to access edge computing services. The
SMF knows based on configuration (e.g. per DNAI) whether a branching point UPF
or an uplink classifier UPF is being used to access edge computing services.
### 6.47.2 Impacts on services, entities and interfaces
SMF:
\- sends the \"edge-anchored\" and \"5GC-preference\" or \"3GPP-access-
preference\" indications and associated Flow Descriptor(s) in the ePCO of the
PDU Session Establishment Accept and PDU Session Modification Command
messages.
UE:
\- receives the \"edge-anchored\" and \"5GC-preference\" or \"3GPP-access-
preference\" indications and associated Flow Descriptor(s) in the ePCO of the
PDU Session Establishment Accept and PDU Session Modification Command messages
and provides functionality to notify relevant applications to consider
avoiding connectivity to non-integrated access.
PCF:
\- evaluates and provides to SMF the policy configured by the AF to generate
traffic switching guidance indications.
NEF:
\- provides interface to an AF to update the policy for edge traffic
switching.
## 6.48 Solution 48 (KI#6): Avoiding Switch Away Based on an Indication in the
URSP
### 6.48.1 Description
#### 6.48.1.1 General
This solution addresses Key Issue #6 for the cases where URSP Rules are used,
and it is known that certain DNN/S-NSSAI combinations will use PSA UPFs that
are in a local site.
The premise of the solution is that an indication may be added to the URSP
Rules to indicate that any PDU Session that is associated with an RSD may be
using a PSA UPF that is in a local site. When non-integrated connectivity
becomes available for the UE, the UE may use the indication to help determine
whether to use the non-integrated connectivity for the traffic that is
currently associated with the PDU Session.
NOTE: The user preferences that are associated with the UE should be taken
into account and how this is done is not specified. For example, the user
preferences may indicate that all traffic should use non-integrated
connectivity when it is available. In such a scenario, this indication in the
RSD would be ignored.
#### 6.48.1.2 Procedure
The Route Selection Descriptor of a URSP Rule may include an \"edge-anchored\"
indication. The UE may consider any PDU Session that is established with the
RSD to be \"edge-anchored\". Whether the PCF includes the \"edge-anchored\"
indication in an RSD, may be based on configuration (e.g. OAM). For example,
the PCF may be configured to know that certain DNN / S-NSSAI combinations
should be considered to be \"edge-anchored\".
NOTE 1: This solution assumes that the inclusion of the \"edge-anchored\"
indication in the RSD indicates that the DNN / S-NSSAI combination should
always be considered to be \"edge-anchored\".
When connectivity outside of 5GS becomes available for the UE, the UE may use
\"edge-anchored\" indication to decide if the traffic that is currently
associated with a PDU Session should be transferred to connectivity outside of
5GS.
NOTE 2: How the \"edge-anchored\" indication influences the UE\'s decision to
use connectivity outside of 5GS is out of scope.
### 6.48.2 Impacts on services, entities and interfaces
PCF:
\- may include the \"edge-anchored\" indication in RSD(s) of URSP Rules.
UE:
\- receives the \"edge-anchored\" indication in RSD(s) of URSP Rules.
## 6.49 Solution 49 (KI#6): URSP based solution to avoid UE to switch away
from Edge PDU Session
### 6.49.1 Introduction
This solution enables UE to avoid switching the EC traffic away from the EC
PDU Session and 5GS altogether, for example due to connectivity to non-
integrated Wi-Fi). In particular it addresses below identified problems:
\- how to determine what traffic is using the 5G System to access edge
computing resources, and specifically in what granularity the traffic can be
identified (e.g. Flow and/or PDU Session);
\- what actions might be taken when some application traffic is currently
using the 5G System to access edge computing resources and connectivity
outside of 5GS becomes available.
### 6.49.2 Functional Description
The following are the main principles of the solution:
\- Providing URSP rules to the UE with extended Route Selection Descriptor to
indicate EC traffic to the local part of the DN i.e. RSD is extended with an
EC tag indicating Edge computing offload to local DN.
\- The PCF for a UE triggers an update of the URSP rules to the UE when it is
notified of an EC traffic to a local Data Network. This could be due to:
\- AF, as part of Application Guidance for URSP determination as described in
clause 4.15.6.10 of TS 23.502 [9], request URSP with EC tag e.g. if AF is
aware of requirement due to ongoing EC traffic;
\- PCF for the PDU Session subscribes to the SMF and is notified about EC
traffic to the local part of the DN e.g. DNAI change or Local PSA UPF
selection. Also, the PCF for a UE (i.e. the PCF that is responsible for
provisioning the URSP rules to a UE) subscribes to the PCF for a PDU Session
for such events. When a PCF for a UE is notified of EC traffic to a local Data
Network, it may determine and trigger an update of the URSP rules to the UE.
\- If the PCF for the UE and the PCF for the PDU Session are different PCFs,
the PCF for the UE is informed when a SM Policy Association is established or
released by subscription to the BSF. PCF for the UE may subscribe to the BSF
to be notified when a PCF for the PDU Session is registered in the BSF as
defined for AM policy use cases in TS 23.502 [9] clause 4.16.14. The (DNN,
S-NSSAI) combinations may be configured in the PCF for the UE or retrieved
from the UDR as part of the Application Data Set. If the PCF for the UE
subscribed to the BSF, the BSF notifies that a PCF for the PDU Session is
registered in the BSF.
\- With received indication in the URSP, and considering its user preferences,
the UE may accordingly decide to continue using the ongoing PDU Session for EC
traffic.
### 6.49.3 Procedure
Figure 6.49.3-1 below shows the detailed procedure to allow PCF of the UE to
be informed of EC traffic thus PCF triggering an update to URSP rule with
extended Route Selection Descriptor indicating EC traffic to the local part of
the DN is being performed.
Figure 6.49.3-1: PCF for a UE subscribes to Events that indicate edge
computing session and triggers UE Policy modification
The Events indicating EC traffic that can be subscribed in the above figure
6.49.3-1 may be implemented as an extension of the User Plane Management
Events specified in TS 23.502 [9], extended to include events that indicate
that the SMF has established a local or Edge PDU Session (e.g. via selection
of the PSA UPF and/or UL-CL UPF for EC traffic) or any of the Edge Computing
connectivity models described in clause 4.3 of TS 23.548 [3], i.e. Distributed
Anchor Point, Session Breakout, Multiple PDU Sessions.
### 6.49.4 Impacts on services, entities and interfaces
PCF:
\- subscribes to receive indication on EC traffic to local part of the DN, and
accordingly updates URSP rule.
SMF:
\- new event type in the User Plane Management event exposure.
UE:
\- receives URSP with RSP indicating ECtraffic. With received indication in
the URSP, and considering its user preferences, the UE may accordingly decide
to continue using the ongoing PDU Session for EC traffic.
## 6.50 Solution 50 (KI#7): Obtain and maintain mapping table between IP
address/IP range with DNAI
### 6.50.1 Key Issue mapping
This solution addresses Key Issue #7 with following aspects:
\- what information the AF should provide to 5GC (e.g. IP address or range
thereof (i.e. IPv4 subnetwork and IPv6 prefixes), FQDN) and how it should
provide it to help determine proper DNAI if the AF does not have knowledge of
the DNAI information;
\- whether and how the 5GC can provide a DNAI to AF to help the subsequent AF
influence/request.
### 6.50.2 Description
When AF does not have DNAI information, based on the AF request, the 5GS
should help determine proper DNAI(s) and notify the information to AF. DNAI
information implies the proper UPF which should be selected for the UE\'s PDU
Session, and the proper UPF should be located in the same or nearby area to
the target EAS. Therefore, it is possible that the AF will provide AF/EAS IP
address or AF/EAS IP address range to help 5GS determine the DNAI.
When NEF gets the AF request for determine DNAI information with the AF/EAS IP
address or AF/EAS IP address range, optionally with the target geographic
area, DNN, S-NSSAI. The NEF can map the geographic area into TA list. The NEF
may find the target SMF(s) through NRF, with using the TA list, DNN, S-NSSAI.
Then, the NEF requests the SMF with the AF/EAS IP address range, optionally TA
list, DNN, S-NSSAI, in order to find the suitable DNAI(s).
The NEF may store the mapping relationship between the DNAI(s) and the AF/EAS
IP address/IP address range, in order to help the subsequent AF request for
DNAI determination.
SMF is locally configured with the mapping information between the DNAI(s) and
the AF/EAS IP address/IP address range, no matter whether the AF/EAS IP
address/IP address range is public or private IP address.
AF may subscribe the mapping information modification with NEF/SMF. When the
configuration information (relationship between DNAI and EAS IP address/IP
address range) is changed, the SMF can notify the new mapping information to
NEF, and NEF forwards this notification to AF.
### 6.50.3 Procedures
Figure 6.50.3-1: 5GS determines the DNAI based on AF request
1\. AF invokes Nnef_EventExposure service to subscribe for DNAI determination.
The request includes EAS IP address or IP address range, may include
geographic area. AF may also subscribe the DNAI information modification in
NEF.
2\. NEF finds the corresponding SMF based on the S-NSSAI, DNN, TA. Then, NEF
invokes the Nsmf_EventExposure service to get the suitable DNAI(s) based on
the EAS IP address or IP address range, TA list, S-NSSAI or DNN. NEF can also
subscribe the DNAI information modification in SMF.
3-4. SMF notifies the DNAI(s) information/the changed DNAI information
(optionally with the EAS IP address or IP address range) to AF/NEF.
### 6.50.4 Impacts on existing entities and interfaces
NEF:
\- information exposure enhancement to support the DNAI exposure;
\- capability enhancement to store the relationship between DNAI and IP
address mapping.
SMF:
\- finds the corresponding DNAI based on the EAS IP address/IP address range;
\- notifies the new DNAI information, optionally with the EAS IP address or IP
address range, once the mapping relationship between DNAI and the EAS IP
address/IP address range changed.
## 6.51 Solution 51 (KI#7): EDI holding the IP address to DNAI mapping
### 6.51.1 High level description
OAM provisions EDI either to UDR or to NEF where NEF may store it in UDR. For
this purpose, EDI shall at least contain DNN and S-NSSAI and IP address
range(s) per DNAI, but other EDI information may also be present.
Furthermore, SMF can also interrogate NEF for EDI to get use this EDI
information for option A when assigning a ECS options IP address.
### 6.51.2 High level procedures
#### 6.51.2.1 Provisioning
The provisioned EDI for this purpose contains at least DNN and S-NSSAI, and IP
address range(s) (IPv4 subnetwork(s) and/or IPv6 prefix(es)).
Figure 6.51.2.1-1: Provisioning of DNAI from NEF
1a EDI creating/updating/deleting through OAM procedure to UDR.
1b EDI creating/updating/deleting through OAM procedures to NEF.
2b. The NEF invokes the Nudr_DM_Create/Update/Delete to the UDR if it is
authorized.
3b. The UDR stores/updates/removes the corresponding information (and responds
a Nudr_DM_Create/Update/Delete Response to the NEF).
#### 6.51.2.2 Providing IP address to DNAI mapping
Figure 6.51.2.2-1: Getting DNAI information
1 AF queries NEF for translation of IP address to DNAI using Nnef_IPtoDNAI_Get
Request (IP address(es)).
2 NEF checks whether the AF is authorized to perform the request. The NEF
derives DNN and S-NSSAI from the AF-Service-Identifier if not received
explicitly.
3 NEF queries UDR for records related to the received IP address(es) using
Nudr_DM_Get Request (DNN, S-NSSAI, IP address(es)).
4 UDR responds with related records holding IP address per DNAI information
Nudr_DM_Get Response (EDI records).
5 NEF formats result to an IP address(es) to DNAI mapping table.
6 NEF sends the result to AF Nnef_IPtoDNAI_Get Request (IP address(es) per
DNAI).
NOTE: NEF can cache any received result from UDR to reduce signalling load
towards UDR.
### 6.51.3 Impacts on services, entities and interfaces
NEF:
\- new service.
EDI:
\- FQDN not required.
## 6.52 Solution 52 (KI#7): AF obtaining target DNAI provided by NEF
### 6.52.1 Description
This solution corresponds to KI#7: Obtain and maintain mapping table between
IP address/IP range with DNAI.
The AF may provide one or more the following information set to 5GC, in order
to request for target DNAI(s):
\- EHE information, including one or more of the following:
\- EAS IP address/IP range: the IP address or IP range of the requested EAS;
\- FQDN(s): the FQDN (list) of the requested EAS;
\- (Local) DNS server information: the (L-)DNS server address for each DNAI.
\- DNN(s): the DNN(s) related to the requested EAS;
\- S-NSSAI(s) (optional): the S-NSSAI(s) related to the requested EAS.
After receiving the information above, the 5GC determines and sends the DNAI
to the AF by the following way:
\- NEF may determine target DNAI based on NF local configuration;
\- NEF may obtain target DNAI from UDR.
### 6.52.2 Procedure
Figure 6.52.2-1: Procedure of AF obtaining target DNAI
1\. The AF has the requirement to obtain target DNAI, and creates an AF
request, which may include the following information to 5GC, in order to
request for target DNAI:
\- EHE information, including one or more of the following:
\- EAS IP address/IP range: the IP address or IP range of the requested EAS;
\- FQDN(s): the FQDN (list) of the requested EAS;
\- (Local) DNS server information: the (L-)DNS server address for each DNAI.
\- DNN(s): the DNN(s) related to the requested EAS;
\- S-NSSAI(s) (optional): the S-NSSAI(s) related to the requested EAS.
2\. The AF invokes Nnef_EASDeployment_Query Request service to send its
request to the NEF. The NEF authorizes the AF request.
The NEF may determine the target DNAI by local configuration, or obtain the
DNAI from UDR, as described in steps 3-4.
3\. The NEF invokes Nudr_DM_Query Request service to request for target DNAI,
including information received in the AF request.
4\. The UDR sends Nudr_DM_Query Response to the NEF, including the target
DNAI.
5\. The NEF sends Nnef_EASDeployment_Query Response to the AF, including the
target DNAI.
### 6.52.3 Impacts on services, entities and interfaces
AF:
\- provides EHE information (described in clause 6.52.2), DNN(s), S-NSSAI(s)
via invoking Nnef_EASDeployment_Query service.
NEF:
\- provides target DNAI in Nnef_EASDeployment_Query Response;
\- requests DNAI information (described in clause 6.52.2) via invoking
Nudr_DM_Query service.
UDR:
\- provides target DNAI in Nudr_DM_Query Response.
## 6.53 Solution 53 (KI#1): EDC-based EAS discovery for HR PDU Session with
Session Breakout
### 6.53.1 High level description
This solution is based on Solution 25 (see clause 6.25) and enables the UE to
select which DNS resolver (between H-EASDF/H-DNS resolver and V-EASDF) to be
used for a certain application. The solution works as follows:
1\. During the PDU Session Establishment/Modification, the H-SMF provides via
ePCO the UE with both the H-EASDF/H-DNS resolver\'s IP address (as per Rel-17)
and the V-EASDF\'s IP address. In addition, the H-SMF may include a preference
indication indicating which one of the two DNS resolvers the HPLMN would like
the UE to use. If no preference indication is included, it means that the
HPLMN does not have a preference.
NOTE 1: For backward compatibility, if the H-SMF includes only one IP address
in the ePCO (i.e. the one of the H-EASDF/-HDNS resolver), then the UE behaves
as per Rel-17 (see EDC functionality in TS 23.548 [3] clauses 5.2.1 and
6.2.4). In that case the H-SMF will not include in the preference indication
in the ePCO.
NOTE 2: As described in Solution 25 in clause 6.25, this assumes that the
V-SMF provides the H-SMF with the IP address of the V-EASDF. The H-SMF can
provide the V-SMF with the IP address of the H-EASDF/H-DNS resolver so that,
if needed, it can be configured to forward potential unresolvable DNS queries.
2\. The EDC functionality in the UE, once received the two addresses, takes
the optional preference indication from the HPLMN into account and, based on
local logic (e.g. whether a certain application can use Edge Computing
services in the VPLMN, user preferences, etc.), selects to use either the
H-EASDF/H-DNS resolver (as per Rel-17) or the V-EASDF to resolve a specific
DNS query.
3\. Depending on the selected DNS resolver, the DNS query is sent to the HPLMN
or to the VPLMN.
### 6.53.2 Procedures
Figure 6.53.2-1 represents a simplified signalling flow for discovering the
EAS in case of HR PDU Session with Session Breakout in the VPLMN.
Figure 6.53.2-1: EAS discovery in in case of HR PDU Session with Session
Breakout in the VPLMN
0\. The UE registers to the network and the AMF in the V-PLMN receives an
\"HR-SBO allowed\" indication.
1-2. At PDU Session establishment request, the V-PLMN CN decides to establish
a Session Breakout for the HR PDU Session. This is possible because the H-PLMN
previously sent the \"HR-SBO allowed\" indication. The V-SMF sends to the
H-SMF the address of the V-EASDF.
NOTE 1: If the V-SMF does not include the V-EASDF\'s IP address in step 2, it
means that the V-PLMN does not want to establish a Session Breakout for the HR
PDU session and the following steps do not apply.
3-4. The H-SMF retrieves the subscription/policy information from the UDM and
create the DNS context in the H-EASDF.
5\. The H-SMF sends Nsmf_PDUSession_Create Response to the V-SMF. H-SMF
provides H-EASDF reachability/IP address to VPLMN. The DNS server information
in the ePCO includes both the:
a. H-EASDF/H-DNS resolver\'s IP address; and
b. V-EASDF\'s IP address.
The H-SMF may include in the ePCO an indication of which DNS resolver the
HPLMN prefers the UE to use for resolving the DNS query. If no preference
indication is included in the ePCO, it means that the HPLMN has no preference.
The preference indication may be:
\- preference to use the H-EASDF/H-DNS resolver,
\- preference to use the V-EASDF.
NOTE 2: For backward compatibility, if the H-SMF includes only one IP address
in the ePCO (i.e. the one of the H-EASDF/-HDNS resolver), then the UE behaves
as per Rel-17 (see EDC functionality in TS 23.548 [3] clauses 5.2.1 and
6.2.4). In that case the H-SMF will not include in the preference indication
in the ePCO.
6-8. The V-SMF inserts the UL-CL/BP and local PSA, creates the DNS context in
the V-EASDF and forwards the PDU Session Establishment Accept message to the
UE including the addresses of both V- and H-EASDF and the preference
indication from the H-PLMN.
**Option A**
9A. The EDC functionality in the UE takes the optional preference indication
from the H-SMF into account and, based on local logic, it selects to use the
V-EASDF as resolver for the DNS queries.
10A. The UE sends the DNS query to the V-EASDF.
11.A The DNS query triggers steps 8-18 of TS 23.548 [3] clause 6.2.3.2.2
executed in the in V-PLMN. If UL-CL/local PSA have been inserted in step 6,
then it is not executed now.
12.A The V-EASDF resolves the DNS query and sends the DNS response to the UE.
**Option B**
9B. The EDC functionality in the UE takes the optional preference indication
from the H-SMF into account and, based on local logic, it selects to use the
H-EASDF/H-DNS resolver (i.e. the address indicated as per Rel-17) as resolver
for the DNS queries.
10B. The UE sends the DNS query to the H-EASDF/H-DNS resolver.
11B. The DNS query triggers steps 8-18 of TS 23.548 [3] clause 6.2.3.2.2
executed in the in H-PLMN.
12B. The H-EASDF/H-DNS resolver resolves the DNS query and sends the DNS
response to the UE.
### 6.53.3 Impacts on services, entities and interfaces
H-SMF:
\- sends authorization for \"HR-LBO\" to V-EASDF;
\- sends H-EASDF/H-DNS resolver\'s IP address to V-SMF to configure the
V-EASDF, if needed;
\- provides to the UE address of H-EASDF/H-DNS Resolver and of V-EASDF (via
ePCO);
\- optionally provides to the UE preference on which address to use for DNS
resolution (via ePCO).
V-SMF:
\- indicates support for EC and providing V-EASDF IP address to H-SMF;
\- supports interaction with V-EASDF using Neasdf interface.
UE:
\- indicates capability to CN;
\- receives in ePCO two IP addresses and preference indication;
\- considers precedence indication when selecting IP address for DNS
resolution.
## 6.54 Solution 54 (KI#4): PCF controlling common DNAI
### 6.54.1 Description
This solution addresses KI#4. The solution addresses how 5GC can select a
common DNAI for a set of UEs.
It is assumed that the AF/EASs solves the issue with a common EAS for the set
of UEs.
The set of UEs is identified by the AF by the external group ID. It is assumed
that the AF creates the UE set (group) by e.g. as per solution 14, in clause
6.14.
### 6.54.2 Procedure
The AF will request a common DNAI from 5GC in AF influence on routing by
indicating correlation of traffic for a group of UEs. The group is identified
by the External Group ID, which is translated by 5GC (UDM via NEF) to an
Internal Group ID.
The request for influencing traffic ends up in PCF, via UDR, see TS 23.502 [9]
clause 4.3.6.2. Once PCF has received the request for the group of UEs, it
will need to send PCC rules to the concerned PDU sessions. PCF starts with
sending the PCC rule via Npcf_SMPolicyControl_UpdateNotify including
indication of traffic correlation and the related Internal Group ID to the SMF
having most of the PDU Sessions that should be correlated. SMF determines the
common DNAI for the Internal Group and responds with the selected DNAI to the
PCF. PCF then sends Npcf_SMPolicyControl_UpdateNotify with indication of
traffic correlation, the related Internal Group and selected DNAI to the rest
of the PDU Sessions for the UEs identified by the Internal Group ID.
### 6.54.3 Impacts on Existing Nodes and Functionality
SMF:
\- selects common DNAI, gives it to PCF, uses selected DNAI when ordered from
PCF.
PCF:
\- selects the SMF with most PDU Sessions for the concerned group of UEs,
receives and sends selected DNAI.
## 6.55 Solution 55 (KI#5): Access the shared EAS via N9 tunnel
### 6.55.1 Description
As indicated in LS S2-2203633 [20], the 5GAA has requirements to allow a PLMN
to use EHE resources shared by another MNO appropriately, i.e. allow a UE in
PLMN B to access efficiently the EAS in PLMN A located in close proximity and
route the UE traffic to the identified EAS.
As some of the MNOs do not have local edge resources, in order to consume the
edge service from other PLMN, the issues below should be resolved:
\- how can the UE in PLMN B discover the EAS deployed in PLMN A by a 3GPP-
defined mechanism;
\- after having determined the EAS IP address deployed in PLMN A, how to
determine the target DNAI. The EAS deployed in PLMN A may refer to the target
DNAI defined in PLMN A, and the SMF in PLMN B cannot directly determine the
target DNAI;
\- how to select the UPF in PLMN A. In order to access the EAS deployed in
PLMN A, the PLMN B where the UE is located should trigger the UPF selection in
PLMN A and configure the N4 rules and N9 tunnel information to UPF in PLMN A.
This procedure refers to the interoperability across PLMNs.
### 6.55.2 Procedure
#### 6.55.2.1 Determine target DNAI in PLMN A according to EAS IP address
As the EAS shared by PLMN A can be accessed via N9 tunnel by UE in PLMN B, the
target DNAI related to EAS IP address should be determined. The DNAI is used
or defined per PLMN, and as the EAS is deployed in another PLMN, the SMF in
PLMN B cannot directly determine the target DNAI in PLMN A.
Some information should be provided by PLMN A to assist SMF in PLMN B to
determine the target DNAI in PLMN A. The AF in PLMN A can provide such
information to AF in PLMN B, which is the application layer procedure. The AF
in PLMN B reuses the EDI procedure.
There exists a relationship between the EAS IP address(range)/FQDN and target
DNAI in PLMN A. The information used to determine target DNAI in PLMN A are
listed in table 6.55.2.1-1.
Table 6.55.2.1-1 Mapping table between target DNAI and IP range provided by AF
Parameters Description
* * *
IP range/address Indicates the IP range/address to be converted to the target
DNAI DNAI The target DNAI is equivalent to the IP address/range PLMN ID
Indicates the target DNAI supported in this PLMN
The procedure where AF provides the mapping table to 5GC is in Figure
6.55.2.1-1.
Figure 6.55.2.1-1: Mapping table between target DNAI in other PLMN and IP
range in the AF procedure
1\. The AF invokes the service operation to provide the mapping table between
target DNAI in other PLMN and EAS IP range/address.
2\. NEF checks whether the AF is authorized to perform the request, and
authorised to provision the mapping table to UDR based on the operator
policies.
3\. The NEF invokes the Nudr_DM_Create/Update/Delete to the UDR if it is
authorized.
4\. The UDR stores/updates/removes the corresponding information and responds
a Nudr_DM_Create/Update/Delete Response to the NEF.
5\. The NEF sends Nnef_EASDeployment_Create/Update/Delete Response to the AF.
#### 6.55.2.2 SMF recovers or obtain the mapping table to determine the target
DNAI
After receiving the EAS IP address from EASDF, the SMF cannot determine the
target DNAI, because this DNAI is referred to the other PLMN ID. So, the SMF
should check the mapping table in UDR and convert the received EAS IP address
to target DNAI in other PLMN, and trigger the UPF selection in other PLMN.
Figure 6.55.2.2-1: SMF recovers or obtain the mapping table
1\. The SMF receives the EAS IP address from EASDF, but the SMF cannot decide
the target DNAI according to EAS IP address, because this IP address
corresponds to the target DNAI which is supported by another PLMN.
2-3. The SMF subscribes to the mapping table Change Notification from the NEF
or obtains the mapping table from NEF.
4-5. The NEF invokes the Nudr_DM_Query/Subscribe to the UDR for the mapping
table.
6\. The NEF sends notification or Response to the SMF for the mapping table
between EAS IP address/range and target DNAI.
#### 6.55.2.3 EAS discovery procedure and access the shared EAS via N9 tunnel
The EAS deployed in PLMN A can be shared to UE in PLMN B to provide the edge
services. PLMN A has already provided the mapping table between IP
address/range and target DNAI in PLMN A as indicated in clause 6.55.2.1.
Figure 6.55.2.3-1: EAS discovery procedure and access the shared EAS via N9
tunnel
0\. For some of the FQDNs that can only be resolved in the PLMN B. So, the
PLMN B can provide the EDI related to such FQDNs to PLMN A.
1-11. These procedures are the same as the procedures listed steps 1 to 13 in
figure 6.2.3.2.2-1 of TS 23.548 [3] with the exception below:
5-6. After receiving the EDI from PLMN B, the SMF retrieves the EDI from UDR
via NEF, and configures the DNS message handling rules to EASDF, to handle
some of the FQDNs related to PLMN B.
8-11. If EASDF receives the DNS query which contains an FQDN deployed in PLMN
B or PLMN B can resolve, the EASDF reports the FQDN to SMF, the SMF recovers
the EDI from UDR provided by PLMN B, and SMF configures the DNS message
handling rules.
12\. According to the DNS handling rules, the EASDF delivers the DNS query to
DNS server. This DNS message handling rules are generated by the PLMN B EDI.
13\. The DNS server delivers the DNS response to EASDF in PLMN A.
14-15. The EASDF sends DNS message reporting to the SMF by invoking
Neasdf_DNSContext_Notify request, including EAS information if the EAS IP
address or the FQDN in the DNS Response message matches the DNS message
detection template provided by the SMF. SMF cannot decide the target DNAI
according to the EAS IP address or the FQDN in the DNS response.
16\. The SMF recovers or obtains the mapping table from UDR via NEF, which can
be used to determine the target DNAI. The SMF uses the mapping table to decide
that the EAS IP address corresponds to the target DNAI in PLMN A.
17\. The SMF may perform UL-CL/BP and Local PSA selection according to the
target DNAI.
23-25. These procedures are the same as the procedures listed in steps 17-19
in figure 6.2.3.2.2-1 of TS 23.548 [3].
### 6.55.3 Impacts on services, entities and interfaces
SMF:
\- receives the mapping table from UDR via NEF, and transfers the EAS IP
address to target DNAI;
\- generates the DNS handling rules according to the EDI from PLMN B, and
configures the EASDF with DNS message handling rules.
UDR:
\- stores the mapping table between EAS IP address/range and target DNAI.
AF:
\- provides the mapping table between EAS IP address/range and target DNAI to
5GC;
\- provides the EDI from other PLMN.
# 7 Evaluation
## 7.1 Evaluation for KI#1: Accessing EHE in a VPLMN when roaming
### 7.1.1 Evaluation for scenario 1 (via LBO PDU Session)
Solutions #6, #7, #8, #9, #10, #27, #28, and #39 all cover the scenario where
the EHE is accessed via an LBO PDU Session.
For how to establish the LBO PDU Session towards the correct S-NSSAI/DNN pair,
updating the URSP rules in the UE is regarded as the general solution to
establish the LBO PDU Session with proper DNN, S-NSSAI for the traffic that
needs EC treatment. The generation of URSP rules that apply in the VPLMN and
their provisioning to the roaming UE is part of scope of FS_eUEPO KI#1. TR
23.700-85 [10] includes several solutions in this area, and the solutions in
FS_EDGE_Ph2 for this topic do basically overlap with solutions in FS_eUEPO
report.
The proposal is to leave to FS_eUEPO Study Item the definition of the solution
that guarantees that it is possible to provision the UE with URSPs that allow
that for a given EC application, UE selects the correct S-NSSAI/DNN that can
trigger vPLMN to establish and use a LBO PDU Session to access the VPLMN EHE.
That includes scenarios where vAF sends guidance for determination of proper
URSP in VPLMN.
Solutions #6, #7, and #10 share some common points and all relate to URSP
enhancements. Solution #7 extends Location Criteria, while solution #10
defines PLMN Criteria as new validity criteria. Considering PLMN is not kind
of location, e.g. multiple PLMNs can cover same location, PLMN ID is
recommended as a new criterion besides Location Criteria in RSD.
In solution #6, an AF of the VPLMN contacts the NEF of the HPLMN to use the
API defined in clause 4.15.6.10 of TS 23.502 [9], \"Application guidance for
URSP rules determination mechanisms\". This allows the VPLMN to influence the
URSP Rules to guide UE for traffic to be offloaded in the VPLMN to use a
specific DNN and slice deployed in LBO mode while the rest of the traffic can
use HR PDU Session(s). The H-PCF may, based on local policies, determine
whether to always send the URSP rules immediately to the UE or to send these
rules only when the UE is served by the corresponding serving PLMN, e.g.
waiting to be triggered from a V-PCF of that PLMN in step 3 of TS 23.502 [9],
clause 4.6.1. If the URSP rules are sent immediately (i.e. before the UE is
being served by the VPLMN), then the new rules may trigger the UE to re-
evaluate URSP rules and select DNN/S-NSSAI combinations that are not optimal.
If the URSP rules are sent by the H-PCF when triggered by the V-PCF, then
there will be some delay between when the UE is roaming and actually receiving
policies that can be used to access the EHE.
Instead of introducing a new \"Revaluation Suggested\" indication, updating to
condition for UE to re-evaluate URSP rules in clause 6.6.2.3 of TS 23.503 [13]
can achieve the purpose.
Solution #7 proposes 2 changes to URSP Rules:
\- Solution #7 proposes that PLMN ID(s) can be part of Location Criteria in
the Validation Criteria. This will allow the UE to be sent URSP rules that
will work in the VPLMN before the UE is served by the VPLMN and prevent the UE
from establishing a PDU Session with the RSD unless the UE is actually served
by the VPLMN.
\- Solution #7 also proposes that the RSD(s) can also optionally include a
\"Revaluation Suggested\" indication. This indication may be included to
indicate to the UE that URSP Re-evaluation should take place if the Validation
Criteria is no longer met. This is needed because Rel-17 behaviour, as
described in TS 23.503 [13] is that \"_The Time Window and Location Criteria
are not required to be checked again during the lifetime of the PDU Session._
\"
Solution #6 and Solution #7 can be paired in the sense that Solution #6 can be
used to allow an AF in the VPLMN to provide the H-PCF with information that
can be used to build URSP rules that include PLMN ID(s) in the Location
Criteria and use the \"Revaluation Suggested\" indication to ensure that URSP
rules are re-evaluated when appropriate. Thus, the network can send the URSP
rules when they are immediately available and the UE will not attempt to
establish PDU Sessions with the VPLMN DNN/S-NSSAI combinations until the UE is
served by the VPLMN.
Solution #10 is similar to Solution #7 because it also proposes that PLMN
ID(s) can be part of the Validation Criteria. Since the UE only uses the Route
Selection Validation Criteria to determine whether a PDU Session should be
established and the Time Window and Location Criteria are not required to be
checked again during the lifetime of the PDU Session, this solution would
benefit from additionally including the \"Revaluation Suggested\" indication
that is included in Solution #7. The \"Revaluation Suggested\" indication can
be used to ensure that URSP rules are re-evaluated when the serving PLMN
changes.
Solution #8 deals specifically with V-ECS discovery when roaming. Solution #8
proposes that the SoR Transparent Container can include either:
\- an FQDN or an IP Address of a V-ECS to the UE. When the UE accesses the
provided FQDN or IP Address, URSP rules may steer the UE to use a DNN/S-NSSAI
combination that can be used to reach the ECS (e.g. an LBO Session); or
\- a DNN/S-NSSAI combination. In this case, the DNN/S-NSSAI combination may be
used to send a PDU Session Establishment Request in the VPLMN that will result
in an LBO PDU Session. The SMF in the VPLMN may then send ECS Address
Configuration Information to the UE as described in TS 23.548 [3]. The EEC may
then use the ECS FQDN or IP Address from the ECS Address Configuration
Information.
Solution #9 relies on the UE using a predefined FQDN to the EASDF that is
shared between operators. The Global EASDF acts as a DNS server to provide the
UE with either the IP address of the EASDF that the UE should use in the VPLMN
or the S-NSSAI/DNN combination that the UE will use to set up a PDU Session.
It is not clear how the Global EASDF obtains the information to determine that
a new LBO PDU Session is needed, and extending DNS Response message for such
an indication is not specified in our specification. It is unclear why URSPs
do not suffice and why an alternative mechanism is needed, neither which
mechanism in UE will determine which applications shall use this DNN/S-NSSAI.
In Solution #27, the H-SMF detects that a HR PDU Session would be better
served by an LBO PDU Session. This detection is based on DNS query from the UE
towards an EC FQDN or an AF influence of traffic routing for the UE. When the
H-SMF detects that the UE should switch to an LBO PDU Session, the H-SMF will
terminate the HR PDU Session and inform the AMF that the DNN/S-NSSAI
combination should trigger an LBO PDU Session when the UE attempts to re-
establish the PDU Session. According to current Rel-17 specification, whether
to establish a LBO PDU Session is determined by UE subscription based on
DNN+S-NSSAI. Other applications using same DNN+S-NSSAI as per URSP will be
forced to use the same LBO PDU Session even if they may need a HR Session to
access services. Terminating the HR PDU Session impacts the ongoing traffic on
that PDU Session, e.g. TCP connections break and QUIC connections are
interrupted until the connectivity is re-established on the new LBO PDU
Session. Solution #27 requires that the HPLMN ensures that there are no URSP
rules in the UE conflicting with the LBO authorization for this PDU Session,
e.g. no other traffic that requires HR PDU Session should be mapped to the
same DNN and S-NSSAI that could be authorized for LBO. Solution #27 also
allows the V-SMF to send information related to supported edge computing
applications, i.e. Application IDs or FQDN ranges.
In Solution #28, in order to support to establish the LBO PDU Session to ECS,
the 5GC can support to distribute the updated URSP rules to UE. When UE has
the traffic towards ECS in visited PLMN, the URSP rules with ECS configuration
information can trigger an LBO PDU Session establishment or apply the traffic
to LBO PDU Session. During LBO PDU Session establishment procedure, SMF
selects EASDF, and sends EASDF address to UE via NAS message, and/or delivers
ECS configuration information to UE in ePCO. Then UE may perform EAS discovery
with the EASDF. The LBO procedure of solution #28 re-uses Rel-17 non-roaming
EAS discovery procedure.
Solution #39 deals with the case where the EAS is relocated between the VPLMN
and HPLMN. When moving from the VPLMN to the HPLMN, the V-SMF determines
target DNAI based on EAS information and EAS deployment information, sends an
inter-PLMN relocation indicator to H-SMF, and configures the UL-CL/BP V-UPF
for traffic routing towards H-PSA UPF if the destination address is the IP
address of source EAS or target EAS. The same approach is taken when moving
from the HPLMN to the VPLMN.
### 7.1.2 Evaluation for scenario 2 (via HR PDU Session)
In this clause, we evaluate the solutions addressing KI#1 scenario 2: #1, #2,
#3, #4, #5, #24, #25, #26, #28 HR part and #53.
1\. Regarding the technical aspect on how to authorize the PDU Session to
support local traffic routing to access an EHE in the VPLMN, there are three
categories of solutions as follows:
1) With #2, #25 and #53, the authorization information is stored in UDM.
During the UE registration procedure, the UDM sends the allowed indication to
the AMF in VPLMN.
2) With #1 and #3, the authorization information is stored in UDM or is
configured in H-SMF locally according to roaming agreement. During the PDU
Session Establishment procedure, the H-SMF sends the indication to allow local
traffic routing to the V-SMF.
3) With #4 and #5, H-PCF provides the policy to V-SMF via H-SMF.
UDM-based approaches can be used where no dynamic PCC is deployed. The allowed
indication sent to the AMF can be used to assist the AMF to select the V-SMF.
2\. Regarding the technical aspect on whether and how to support charging for
the local traffic of a PDU Session that supports local traffic routing to
access an EHE in the VPLMN, there are six solutions (#1, #2, #3, #4, #5 and
#25) addressing VPLMN charging.
\- With #1, V-UPF reports the usage and charging records to the V-SMF. V-SMF
sends the charging information to V-CHF and also sends the usage records to
the H-SMF.
\- With #2 and #3, V-PSA collects and reports it.
\- With #4 and #5, V-SMF configures the traffic routing rule and Usage Report
Rule to assist traffic offload to V-EAS and usage information report from UL-
CL V-UPF or BP V-UPF to H-SMF via V-SMF for offline and online charging.
\- Solution #25 proposes that the V-SMF provides Usage Reporting Rules to the
UL-CL/BP and local PSA to collect Usage Reports for charging in VPLMN that it
conveys to H-SMF.
Both VPLMN and HPLMN need to store charging records, it is reasonable that
V-SMF sends the records to H-SMF.
3\. Regarding the technical aspect on how to support Rel-17 edge computing
related procedures, such as EAS (re-) discovery, as specified in clause 6 of
TS 23.548 [3], there are seven solutions (#1, #2, #3, #4, #5, #24, and #25).
1) Scenario 2.1: #1, #4, #5, and #25
\- #1. H-AF requests influence traffic routing and H-SMF sends local routing
indication to the V-SMF.
\- #4. H-EASDF is used. The V-SMF performs selection and insertion of UL-CL/BP
and local PSA based on DNAIs received from H-SMF. The DNAIs are determined by
H-SMF based on EAS IP report from H-EASDF, which implies interaction between
H-SMF and V-SMF in every DNS resolution to trigger V-SMF actions related to
local UL-CL/PSA selection and configuration and unnecessary involvement of
HPLMN for scenario 2.2.
\- #5. The V-SMF determines the HR PDU Session for V-EHE should be activated
based on the EAS information and roaming offload policy received from H-PCF
via H-SMF, and configures the traffic routing rule to assist traffic offload
to V-EAS.
\- #25. H-SMF and Home DNS/H-EASDF may monitor, assist and validate the L-PSA
selected by the V-SMF, based on H-EASDF trigger.
#4 supports the dynamic EAS (re-)discovery by H-SMF based on interaction with
EASDF.
In #1, #5 and #25, HPLMN sends an offload policy/configuration to the V-SMF,
and V-SMF performs the UL-CL and local PSA selection at EAS (re-)discovery.
2) Scenario 2.2: #1, #2, #3, #4, #5, #24, #25, #28 HR part
\- #1. V-SMF retrieves the EAS deployment information of the VPLMN from the
V-NEF and performs EAS discovery according to the EAS discovery procedure.
\- #2. Based on V-EASDF trigger, the V-SMF decides the Session Breakout using
EAS Deployment Information provisioned from the AF and V-SBO information
provided by the H-SMF.
\- #3. V-SMF uses a pre-configured list of FQDNs subject to EC services to
derive a traffic routing rule and configures it to the V-UPF so that the V-UPF
can route DNS queries (corresponding to FQDNs) to V-EASDF reusing IP
replacement mechanism of Option D. After the V-UPF routes DNS queries
(corresponding to FQDNs) to V-EASDF, the EAS discovery procedure with V-EASDF
which implements the functions of EASDF refers to TS 23.548 [3]. For the DNS
query requiring DNS resolution in the HPLMN, the DNS resolution path is same
as the normal path in the HR PDU Session. Based on EAS information received
from the V-EASDF and UE location, V-SMF may perform V-ULCL and V-PSA selection
and insertion.
\- #4. V-SMF performs V-UL-CL/V-BP and V-local PSA selection and insertion
based on UE location. The H-SMF obtains ECS option/local DNS server from V-SMF
during PDU Session Establishment and send it to H-EASDF. The H-EASDF handles
all DNS queries of the UE based on this ECS option/local DNS server.
\- #5. Based on the received EAS information (e.g. EAS IP address) and the
roaming offload policy, the V-SMF decides to insert or relocate UL-CL/BP V-UPF
and PSA V-UPF for traffic offload to the V-EAS. According to the roaming
offload policy and the EAS Deployment Information, the V-SMF configures DNS
message handling rules to V-EASDF.
\- #24. During the PDU Session establishment procedure, the V-SMF instructs
the UL-CL the traffic routing rule to route the DNS Query for an FQDN (range)
to a local DNS Server/Local DNS Resolver (Re-use Option D).
\- #25. Dynamic EAS discovery and insertion of UL-CL and local PSA happens in
the V-PLMN based on available EC application information and related policies
and trigger from V-EASDF.
\- #28 HR part. The HPLMN obtains EDI from VPLMN via interaction between H-NEF
and V-NEF.
V-SMF decides UL-CL and local UPF insertion based on V-EASDF notification (#1,
#2, #3, #5, #25) while in #4, H-SMF determines the DNAI of VPLMN.
V-SMF configures V-EASDF based on roaming offload policy from H-SMF and EAS
deployment Information (#1, #2, #3, #5, #25).
Solutions address how to forward DNS query:
\- use V-EASDF handling rule by the V-SMF (#2, #5, #25 opt A);
\- use Option C (#1);
\- V-UPF to forward the DNS queries to local DNS server/V-EASDF or home DNS
server/H-EASDF (i.e. Option D) (#3, #24, #25 Opt B);
\- always use H-EASDF (#4, #28 HR part).
In solution 53, the solution describes that the network sides provide multiple
DNS server IP address to UE with the precedence. One is the DNS server in
VPLMN and the other is in HPLMN. Together with the DNS server from network,
the precedence of each DNS server is also provided to UE. When UE triggers the
DNS query, according to the precedence, the UE selects one of the DNS servers
to trigger the DNS query.
However, this design has some problematic and unclear issue:
\- First, if the MNO has the precedence of DNS server, why does the MNO not
directly indicate the DNS server to UE and instead let the UE select?
\- Second, to indicate which DNS server to select is only by the preference.
However, the UE still does not know the logic why the DNS server A has higher
priority than DNS server B. Also, which DNS server to select is the role of
MNO, not of the UE. So, it is not needed for UE to make the choice via a
complex design.
\- Finally, which DNS server is better to use depends on whether this FQDN in
the DNS query can be resolved as an EAS IP address. This is fully internal 5GC
strategy, which the UE does not understand. So, as the precedence does not
have a relationship with the FQDN, and the precedence alone cannot reflect
which DNS server is better to resolve the FQDN, this design does not bring
much enhancement.
4\. Regarding the technical aspect on how to ensure proper policy control and
QoS enforcement, there are four solutions (#1, #4, #5 and #26)
With #1, #4 and #5, regarding HPLMN policy, V-SMF receives the roaming offload
policy/rules from H-PCF via H-SMF, while regarding VPLMN policy, with #26,
V-SMF receives its VPLMN policy from V-PCF.
Solution #25 proposes that in scenario 2.1, HPLMN may provide QoS policies for
specific applications in the SLA, and then this will be configured in V-SMF
with limitation to roamers. Alternatively, QoS rules can be conveyed to V-SMF
by H-SMF during PDU Session establishment or update as specific information or
as an indication to V-SMF to store the information sent to the UE in the NAS
message and the QoS profile sent to gNB. In scenario 2.2, V-PCF provides local
policies for V-SMF.
It is reasonable to support both HPLMN and VPLMN policy respectively and both
can co-exist.
5\. Regarding the technical aspect on potential impact on Policy and QoS
control:
The technical aspects 2 and 4 address this aspect.
6\. Regarding the technical aspect on how to configure the VPLMN ECS address
to UE in roaming scenarios, one solution (#1) addresses this issue.
With #1, H-SMF sends VPLMN ECS address stored in UDM to UE via V-SMF.
7\. Regarding the technical aspect on how to support the edge relocation in
roaming scenarios, #39 (clauses 6.39.2.1 and 6.39.2.2) addresses this issue.
It supports the AF triggered EAS relocation between different PLMNs. The AF
sends PLMN ID corresponding to target EAS to the network, which assists to
select SMF and UPF, and indicates SMF to configure traffic rule on UPF to
access target PLMN. It is reasonable to support this scenario.
### 7.1.3 Evaluation for ECS address delivery aspects
For the ECS address delivery in roaming situation (including both HR and LBO),
according to and following the conclusion in Rel-17, some of the issues should
be discussed:
1\. When home routed, how the AF in visited network provides the ECS address
to 5GC in HPLMN, and how the AF in visited network provides the ECS address to
5GC in visited PLMN when local breakout.
2\. For both HR and LBO, how to recover the UE subscription data from UDM and
get the ECS address.
3\. How to send ECS address to UE in both HR and LBO.
4\. How to identify the ECS address to be used for UEs in different VPLMN.
For each of the bullets, there are two categories, including home-routed
situation and LBO situation.
For bullet #1, the ECS address can be provided by 3rd party AF via parameter
provisioning procedure, which is the Rel-17 conclusion. In Rel-18, the
conclusion can still be followed:
1a. For LBO situation, the AF in the visited PLMN provides the ECS address by
parameter provisioning procedure to UDM. This principle follows the design in
Rel-17.
1b. For HR situation, as the home PLMN should configure the ECS address to UE
in roaming, the HPLMN should obtain the ECS address provided by VPLMN in
advance. There are two categories: HPLMN has the knowledge of ECS address in
VPLMN and HPLMN does not have the knowledge of ECS address in VPLMN:
\- Category A: In this category, HPLMN has the knowledge of ECS address in
VPLMN including Sol#1 and Sol#28. Sol#1 and Sol#28: The V-AF sends application
related information to H-AF, which includes the ECS address. This procedure is
in scope of SA6.
\- Category B: In this category, HPLMN does not have the knowledge of ECS
address in VPLMN including Sol#1. Sol#1: The V-AF configures the V-SMF
according to the AF influence on traffic routing procedure. In this case,
during the HR PDU Session establishment, the V-SMF needs to select a PCF in
the VPLMN to establish the SM Policy Association. V-PCF may send the VPLMN ECS
address obtained from V-AF to V-SMF. The V-SMF sends the ECS address to H-SMF
during PDU Session establishment procedure.
For bullet #2, as the ECS address is one of the UE subscription data stored in
UDM, how to recover this information can follow the Rel-17 principle:
2a. For LBO situation, Sol#28: When UE in LBO session, the V-SMF retrieves the
UE subscription data from UDM.
2b. There are two categories: HPLMN has the knowledge of ECS address in VPLMN
and HPLMN does not have the knowledge of ECS address in VPLMN:
\- Category A: In this category, HPLMN has the knowledge of ECS address in
VPLMN including Sol#1 and Sol#28. Sol#1 and Sol#28: The H-SMF retrieves the UE
subscription data including ECS address from UDM.
\- Category B: In this category, HPLMN does not have the knowledge of ECS
address in VPLMN including Sol#1. Sol#1: The V-SMF sends the ECS address to
H-SMF during PDU Session establishment procedure. The H-SMF does not recover
the UE subscription data from UDM.
For bullet #3, after receiving or obtaining the ECS address, the ECS address
should be delivered to UE. For both the LBO and HR situations, there are two
categories for UE receiving the ECS address:
3a. In Sol#28, it follows the Rel-17 principle that the V-SMF or H-SMF sends
the ECS address in ePCO to UE via DL NAS message.
3b. In Sol#8, the SoR transparent container can be used to provide an FQDN or
an IP Address of a V-ECS. This is a new feature to be introduced in Rel-18.
As the SoR has the specific function, the information in SoR transparent
container is used for PLMN selection when UE in roaming. Certainly, the SoR is
not designed or enhanced to support any general application layer connection.
Also, the SoR is used for HPLMN to deliver the information that is unknown to
VPLMN or that the HPLMN does not want the VPLMN to know. Certainly, the ECS
address does not belongs to the unknown information or the information that
the HPLMN does not want VPLMN to know. At last, there is no defect of
delivering ECS address in ePCO to UE to solve the situation in UE roaming.
Based on the evaluation above, there is no need to enhance the SoR. The Rel-17
principle of delivering ECS address in ePCO via DL NAS message to UE should be
reused.
For bullet #4, as the UE can roam to different PLMNs, the ECS address should
also be coordinated with the different PLMNs. For both the LBO and HR
situations:
\- In Sol#28: All of the ECS configuration information above should be
retrieved per VPLMN ID. The AF should also provide the ECS address that is
paired to the PLMN ID to UDM, and the SMF can decide to retrieve the different
ECS address when UE roaming in different PLMN.
## 7.2 Evaluation for KI#2: Fast and efficient network exposure improvements
Key Issue #2 is for fast and efficient network exposure improvements.
Solutions #11, #12 and #13 are proposed to solve this KI.
**Exposure information**
In solutions #11 and #12, network congestion indication/level is exposed to AF
by extending GTP-U header and UPF/L-NEF exposure services, same as the
exposure path used in clause 6.4 of TS 23.548 [3]. Furthermore, solution #11
proposes to expose QNC for GBR QoS Flow via this path.
Report updating threshold as proposed in Solution#11is provided to RAN, and
optionally it may be provided to the PSA UPF, but the need and benefits are
not clear for the second case, as pointed out in Note 1 in clause 6.11.1.
In solution #12, a specific QoS flow is used to expose the above information.
In solution #13, cell ID is exposed to AF via user plane. The current
specification defined exposure of cell ID to AF as part of UE location as
specified in clause 4.15.3.1 of TS 23.502 [9] is not the most optimal and
efficient.
**Subscribe service**
In solutions #11 and #13, AF uses Nnef_AFSessionWithQoS to subscribe the above
information exposed by 5GC, same as local exposure mechanism defined in TS
23.548 [3]. While in solution#12, AF uses Nnef_EventExposure_Subscribe to
subscribe information exposed by 5GC.
## 7.3 Evaluation for KI#3: Policies for finer granular sets of UEs
The following solutions address Key Issue 3:
\- #29: Use of Internal Group ID and constraints in EDI;
\- #30: Policies referring to \"Allowed services\" and/or \"Subscriber
categories\";
\- #31: Providing traffic offload policy for a set of UEs with service
information;
\- #32: Offload policy for finer granular set of UEs;
\- #33: AF requests offload policy for sets of UEs.
Rules to control which PDU Sessions of which users are subject to Edge
computing are carried via Nnef_TrafficInfluence service and target the PCF.
\- Solution 30 uses \"allowed services\" and \"subscribed services\" as a
means for addressing a finer granularity of UEs;
\- Solution 31 adds a \"service information\" as a means for selecting a finer
granularity of UEs;
\- Solution 32 introduces \"subscribed services\" which is a logical
combination of criteria, e.g. group1 AND group2;
\- Solution 33 introduces category information to indicate which information
elements (e.g. spatial validity condition, application id...) determine the
collection of UEs. Logical combinations are also possible.
Solution 31 and part of solution 30 and/or use of External/Internal group IDs
should sufficiently support the Key Issue, which means that an AF can identify
a finer granularity set of UEs by means of:
\- External Group ID or a list of Exernal Group IDs;
\- external representation if needed of \"Subscriber categories\" (e.g. gold /
silver / bronze users);
\- service information like application client category, or application-
decided service level. This can be matched against allowed services by PCF.
## 7.4 Evaluation for KI#4: Influencing UPF and EAS (re)location for
collections of UEs
For KI#4, the key points to address the issues include:
1\. How to define and identify a collection of UEs forming a dynamic ad-hoc
group that should use the same EAS and/or same local part of DN and/or same
DNAI. The dynamic ad-hoc group, agreed between the 5GC and the AF (e.g. as
part of a SLA) can be managed only by AF or be synchronized by both AF and 5GC
using agreed targeting information.
2\. How to inform the SMF the information of the same EAS and/or same local
part of DN and/or same DNAI to be used. The information of the same EAS and/or
same local part of DN and/or same DNAI to be used can be determined by the AF
and sent to the 5GC for maintaining and using (corresponding to AF selection
of common EAS/DNAI), or can be determined by the 5GC and maintained within 5GC
(corresponding to 5GC selection of common EAS/DNAI). For the AF-determined
DNAI/EAS, it can be sent to the UE via application layer which is out of scope
of 3GPP SA2, it can also be sent to the 5GC for the routing decisions for
traffic of PDU Session and the DNS handling rule decision.
In TS 23.548 [3], the mechanism to support \"Edge Relocation Triggered by AF\"
is defined. The AF may invoke the AF request targeting an individual UE
address procedure as described in TS 23.502 [9] clause 4.3.6.4 (the AF
influence on traffic routing procedure), due to EAS relocation.
In TS 23.548 [3] and TS 23.502 [9], the solution for \"EAS (re-)discovery over
Session Breakout Connectivity Model\" is described. The SMF interacts with
EASDF and provides the ECS option or the Local DNS server address, related to
candidate DNAI(s) for that FQDN for the UE location, as part of the rules to
handle DNS queries from the UE to the EASDF, the EASDF sends DNS message to
the local DNS server or sends DNS message to the centralized DNS server with
ECS option. The rules to handle DNS queries from the UE can be updated based
on the notified DNS Query with certain FQDN, UE mobility or PSA relocation.
For the selection of the candidate DNAI for a FQDN for the UE, the SMF may
consider the UE location, network topology, EAS Deployment Information and
related policy information for the PDU Session provided as defined in TS
23.503 [13] clause 6.4 or be preconfigured into the SMF. The EAS Deployment
Information used to construct the rule can be set per group.
Solutions of KI#4 address one or more of the following aspects: UE collection
definition, 5GC selection of common EAS/DNAI, AF selection of common EAS/DNAI.
Table 7.4-1: Solutions addressing KI#4
Solution UE collection definition 5GC selects common EAS/DNAI AF selects
common EAS/DNAI
* * *
#14: Group management X  
#15: Selection of common DNAI X X #16: Selecting the same EAS/DNAI for
collection of UEs X X X #17: Application layer EAS selection for collections
of UEs X #18: Discovery of the same EAS for collections of UEs X X  
#19: Influencing UPF and EAS (re)location for collections of UEs X X #34:
Selecting the same EAS/DNAI for collection of UEs X X  
#35: Providing dedicated (re)location information as traffic routing
information X X #36: Providing dedicated (re)location information as EAS
Deployment information X X #37: (Re)location of same EAS and coordination
across UEs X X
Thus, based on the issues for KI#4 and to reuse the existing mechanism as much
as possible and solve the issue for KI#4, the solutions are analysed with
focus on the above three aspects.
**Aspect 1: UE collection definition**
Solution #14 performs UE collection definition by group management. It
utilizes Nnef_ParameterProvision (or new defined) service for AF to send GPSI
list and external group ID. UDM aligns the group data and UE subscription
data. UDR generates internal group ID, and stores SUPI list, internal group ID
and external group ID.
If Nnef_ParameterProvision service is used, it shall be enhanced to support
dynamic UE group management, which only supports 5G VN group or MBS group
management in current specification.
Solution #19 performs UE collection definition by group management. AF uses
Nnef_ParameterProvision (or new defined) service to send group management
information, including group member management parameters and group data:
\- Group member management parameters: GPSI list, external group ID;
\- Group data: DNN/S-NSSAI, Group Type (i.e. ad-hoc group for
gaming/platooning/etc.), EAS ID, Group Attributes (e.g. same EAS/same PSA is
needed/etc.).
NEF translates external group ID into internal group ID, and stores this
information in UDM.
Solution #16, #18 and #34 use UE list, group ID or any UE, and Spatial
Validity Condition to define the UE collection of specific application, which
is identified by FQDN or Application ID.
Solution #35 and #36, the collection of UEs can be identified using explicit
group management extending the 5GVN group management which is similar as that
described for Solution #14 and #19. The collection of UEs can also be
identified with target UEs with service information. The PCF or SMF associates
the UE with the collection based on the group ID or the service information
via traffic routing information or EDI, and the specific service information
for each PDU session received via the procedure of Service specific parameter
provisioning.
**Aspect 2: 5GC selection of common EAS/DNAI**
Solution #16 proposes that the SMF determines that UE belongs to the dynamic
UE group when steps 1-9 of clause 6.2.3.2.2 of TS 23.548 [3] are performed,
and the SMF obtains common EAS/DNAI of the UE collection, locally or
retrieving from UDR. If the common EAS/DNAI has not been determined for UE
collection, the SMF determines the common EAS/DNAI via the Rel-17 EAS
discovery procedure, and synchronizes to UDR with the common EAS/DNAI.
Solution #34 EDI is used for maintaining the common EAS/DNAI. SMF synchronizes
common EAS/DNAI by updating EDI to NEF/UDR.
Solution #37 UDM/UDR is used for maintaining the common DNAI/EAS as part of
group information. The difference is, when common EAS/DNAI is synchronized,
the UDM/UDR shall send notification to the SMF(s) that subscribed the group
data (see solution #19, clause 6.19), including the common EAS/DNAI.
Solution #15 introduces a new network function SCMF to manage the common DNAI.
SMF may obtain the common DNAI either when PDU Session is established (pre-
invoke of SCMF) or when reported DNS Query by EASDF (dynamic invoke of SCMF).
The SMF sends EASDF information to build ECS option or L-DNS server address
according to the common DNAI. Then rest of procedure in clause 6.2.3.2.2 of TS
23.548 [3] are performed. Solution #15 only deals with common DNAI case.
Solution #18 assumes that the UE group is served by a single SMF. When
reported DNS Query, the SMF responds to the EASDF with either the common EAS,
or the same information to build ECS option or L-DNS server address as other
member(s) of the dynamic UE group.
**Aspect 3: AF selection of common EAS/DNAI**
Solution #15 proposes both 5GC and AF selection ways, and only AF selection
procedure is evaluated in this aspect.
SMF selects UPF according to common DNAI obtained from SCMF, and notifies the
common DNAI to AF as target DNAI via UP path change event. Then AF sends
\"group FQDN\" corresponding to the common DNAI to UE via application layer.
UE solves common EAS via DNS. If common DNAI is updated, SMF gets notified by
SCMF, and the above is repeated.
Solution #17 proposes that AF determines members of the dynamic UE group. For
each group member UE, AF sends request to the SMF for candidate DNAI(s) via
PCF. SMF notifies AF the candidate DNAI(s). AF selects common DNAI and common
EAS according to the candidate DNAI(s) from all the SMF(s). Then AF sends the
common DNAI to each SMF via AF influence traffic procedure, and sends the
address of the common EAS to each UE via application layer.
Solution #35 and #36 propose a solution to support the case that AF determines
common EAS/DNAI for certain application for dynamic UE group. The common
EAS/DNAI is sent to the SMF via PCC rule or EAS Deployment Information, and
the SMF uses the common DNAI/EAS for the routing decisions for traffic of PDU
Session and the DNS handling rule decision. In Solution #35, the common
EAS/DNAI for the collection of UEs is received via traffic routing
information. The PCF associates the UE accessing the application with the
collection of UEs using the same DNAI/EAS, and the PCF sends the PCC rule with
the common EAS/DNAI to the SMF. In Solution #36, the common EAS/DNAI for the
collection of UEs is received via EAS Deployment Information, and the SMF
associates the UE accessing the application with the collection of UEs using
the same DNAI/EAS.
## 7.5 Evaluation for KI#5: GSMA OPG impacts and improvements for EHE operated
by separate party
The solutions addressing Key Issue #5 can be split into two categories:
1\. solutions that enable the discovery of an EAS deployed in another PLMN
than the one serving the UE, and
2\. solutions that facilitate the edge relocation between PLMNs.
**Solutions to enable the discovery of an EAS deployed in another PLMN than
the one serving the UE.**
This category of solutions encompasses Solution #20, Solution #21, Solution
#22, Solution #38 and Solution #40. All solutions assume that the involved
PLMNs are part of an GSMA OP federation and/or that there is a controlled
inter-PLMN IP connectivity between the PLMN serving the UE and the PLMN
hosting the EAS.
Solution #20 is based on the usage of the newly defined Global EASDF which can
directly resolve the DNS query sent by the UE to discover the shared EAS
(which can be deployed in any PLMN) or can first resolve the DNS query sent by
the UE to discover the EASDF able to provide the IP address of the shared EAS.
Both options require the UE to be configured with the Global EASDF\'s URL and
to resolve it to obtain the Global EASDF\'s IP address. Because of that these
two options are inconsistent with the Rel-17 EAS discovery procedure described
in TS 23.548 [3] clause 6.2.3.2.2 (which, on the contrary, assumes that the
EASDF\'s IP address is provided by the SMF via ePCO during PDU Session
establishment/modification). In addition, the second option is incompatible
with the Rel-17 EAS discovery because it requires the UE to obtain the
EASDF\'s IP address by sending a DNS query to the Global EASDF, while the
Rel-17 EASDF in the PLMN has no role to play.
Solution #22 describes three alternative options: Option 0 (based on the SMF
configuration to know the EAS deployment information of the EAS running on
other PLMN\'s edge infrastructure, e.g. IP address range(s)/FQDN(s)), Option 1
(based on the usage of the Shared EASDF which stores the EDI of each EAS
running in each PLMN sharing Edge Nodes) and Option 2 (which relies on inter-
PLMN inter-EASDF communication to resolve the DNS Query for an EAS hosted by
another PLMN). Option 2 requires storing in the NEF/UDR/SMF/EASDF an
additional filtering information (PLMN ID and DNS server address/FQDN filter)
for the EAS\' deployed in another PLMN -- such information is essential to
locate the EAS during the EAS discovery procedure. Solution #22 has no impact
on the UE, but, depending on the option, it affects the CN entities to
different degrees.
Solution #38 relies on the AF to provide extended EAS Deployment Information
(EDI) which includes N6 traffic routing information to the PLMN hosting the
EHE. After having been translated by the NEF of the original PLMN and sent to
the PLMN serving the UE, the extended EDI is stored in the UDR of the PLMN
serving the UE. The SMF of the serving PLMN can then use such EDI to find the
EAS hosted in the other PLMN. Similar to Solution #22, this solution has no UE
impacts.
Solution #40 has a similar concept to Option 2 of Solution #22, in that it
forwards the DNS query from the EASDF of the PLMN serving the UE to the EASDF
of the PLMN hosting the EHE, if the former cannot find it. Differently from
Solution #22 though, the inter-EASDF communication takes place via SMF and
NEF. In addition, Solution #40 proposes the use of additional information
(S-NSSAI, DNN, UE location and External Group ID) to allow the SMF in the PLMN
hosting the EHE to find the proper EASDF.
Solution #21 ensures that an EAS deployed by a certain operator in a VPLMN\'s
EHE can only be discovered and accessed by the UE of that operator while
roaming in local breakout to the VPLMN. To do this, the solution the AF to
provide, together with the EAS Deployment Information, the PLMN ID of the EAS
owner so that the SMF can match it with the UE\'s HPLMN ID when the EAS
discovery is triggered. This solution, however, does not seem to address the
ENS (Edge Node Sharing) deployment which allows OP B to deploy Edge Computing
applications in the Operator A\'s EHE, without restricting the access to it to
only OP B\'s UEs.
**Solutions to enable the EAS relocation for shared EHE**
Solution #23 proposes to support the scenario of EAS relocation between EHE
deployed by a source EHE provider to another EHE deployed by a target EHE
provider, even in scenarios when EHEs are operated by different service
providers. It needs the NRF or NEF maintains parameters for each AF, e.g. EHE
domain it supports, service area, etc. Then SMF selects suitable target AF.
The impact is introduced on 5GC and no impact on UE.
Solution #39 proposes to support the scenario EAS relocation between EHEs
deployed in different PLMNs. The AF sends corresponding PLMN ID to network to
indicate the EAS should be relocated to the target PLMN, and based on
retrieval of PLMN ID, SMF selects UPF to access target EAS via controlled IP
network. The impact is introduced on 5GC and no impact on UE.
## 7.6 Evaluation for KI#6: Avoiding UE to switch away from EC PDU Session
There are nine solutions provided for this key issue, Solutions #41 to #49.
Clause 5.6.2 lists some problematic scenarios that should be covered:
\- non-integrated access, where re-connecting to the 5GS is not possible, e.g.
because lack of UE support or an N3IWF could not be discovered or connected to
and these Edge Computing enablers can only be reached via the 5GS;
\- re-connecting to the 5GS is possible but results in long UP paths because
of e.g. a centralized N3IWF;
\- session breakout scenarios where an UL-CL and L-PSA is used to obtain EC
connectivity and switching to an access that is not integrated with 5GS would
therefore break the EC connectivity.
In the first case, connecting to non-integrated WIFI access should be avoided
if the 5GS applies Edge Computing enablers. This could be achieved, as
different solutions propose, e.g. by an indication from the 5GC to the UE to
avoid switching away to non-integrated WIFI access.
Whether the application still gets access to application server via non-
integrated access can depend also on factors outside of 5GC control, such as
the IP latency form the WIFI POP to the EHE, the EHE connectivity
configuration or transport protocol used between the UE applications and local
application server (e.g. QUIC can provide service continuity during access
change, but TCP cannot). It may depend on application functionality (e.g. RTT
measurements over the different accesses) whether the application could
leverage on using non-integrated WIFI. The application may, however, benefit
from an indication whether the 5GC currently applies EC treatment: this may
trigger the application logic to control its traffic over different accesses,
e.g. based on latency monitoring as proposed in Solution #42.
In the second and third cases above, even (re-)connecting to 5GC via non-3GPP
access should be avoided. In these cases, the 5GC has the information to
decide whether this is needed or not so the 5GS may again send an indication
to the UE to avoid switching to non-3GPP access.
There are different alternatives proposed to send an indication from 5GS to
avoid switching away to non-integrated WIFI access:
1\. via existing URSP rules: Solution #41 proposes to apply the existing URSP
rules to control non-seamless WIFI offload. As stated in clause 6.1.2.2.1 of
TS 23.503 [13]: _\"If the UE has an URSP rule (except the URSP rule with the
\"match all\" Traffic descriptor) that matches the application as defined in
clause 6.6.2.3, the UE shall perform the association of the application to the
corresponding PDU Session or to Non-Seamless Offload or ProSe Layer-3 UE-to-
Network Relay Offload according to this rule\"_. That is, if 5GC defines
policy rules for non-seamless offload for some traffic in the RSD, then the UE
should apply these rules for that traffic in the corresponding PDU Session.
For session breakout, if an update of traffic descriptors in URSP rules is
required, the resulting rule will possibly not be acted upon by the UE
immediately. The ATSSS rules can be configured for more refined control of
traffic steering if the conflicting non-3GPP access is integrated. The
solution can achieve this outcome without any impacts to the specifications.
However, in this solution, the UE is not made aware whether any of the edge
enablers are configured for the 3GPP access.
2\. via a new attribute in URSP rules: Solution #48 proposes an \"edge-
anchored\" indication in URSP RSD(s). The principle of Solution #48 is that an
indication may be added to the URSP Rules to indicate that any PDU Session
that is associated with the RSD is possibly using a PSA UPF that is in a local
site. Solution #48 only applies to the scenario where it is known that a PDU
Session that is associated with certain Traffic Descriptors or DNN/S-NSSAI
combinations will always access edge computing resources that cannot be
accessed if the UE switches to an access that is not integrated with the 5GS.
The solution makes no reference whether the URSP can be updated based on the
AF guidance at run time. Solution #49 proposes to dynamically indicate
\"ongoing traffic offload\" in the RSD. This is based on AF provisioning as
part of Application Guidance for URSP determination as described in clause
4.15.6.10 of TS 23.502 [9], and/or based on PCF decision due to an offloading
of EC traffic to a local Data Network. With received indication in the URSP,
and considering its user preferences, the UE may accordingly decide to
continue using the ongoing PDU Session for EC traffic.
3\. as a new indication via PCO: the principle of Solution #47 is that the SMF
is aware of whether the PDU Session uses a PSA UPF in local site and the SMF
can send an \"edge-anchored\" indication to the UE that indicates that the PDU
Session uses a PSA UPF that is in a local site and also a \"5GC-preference\"
indication that indicates that the network prefers to keep the traffic in the
5GC. The indications can be per Flow Descriptor(s).
4\. as a new indication coupled to EDC attributes: Solution #44 proposes that
the ability for network to control UE\'s traffic offloading decision is
dependent on UE capability and UE\'s subscription. The UE may indicate to the
SMF its capability to support the EDC functionality and to control application
traffic switching via ePCO. If the UE subscription information includes EAS
traffic switching information, the SMF indicates to UE that EAS traffic
switching control is required. The solution proposes this capability to be
linked to the EDC functionality, but EDC which is handling DNS queries from
the UE will possibly not have visibility of the actual application traffic and
cannot enforce traffic routing rules.
NOTE 1: Solution #44 is similar to Solution #47. Solution#46 also proposes
indication to the UE that the PDU Session is using edge computing
functionality of the network, but it is not explicitly stated how this
indication is conveyed. The UE decision of traffic switching cannot be
enforced as stated in the solution since it may happen in upper layers.
There are two potential alternatives to send the indication to UE whether the
5GC currently applies EC treatment for some traffic:
1\. as a new indication via PCO. Solution#47 proposes an \"Edge-anchored\"
indication;
2\. via a new attribute in URSP rules. See point 2 above.
Providing an indication to the UE to avoid switching to non-3GPP access has
been proposed in two solutions:
\- Solution#41 proposes to apply the existing URSP rules for this, i.e.
setting the Access Type Preference to \"3GPP\" for the given EC traffic.
Besides, for MA PDU sessions, it proposes to use the ATSSS rules to avoid
going to non-3GPP access.
\- Solution #47 proposes that this type of indication could be also sent via
PCO. This could be needed in the cases when a dynamic update needed for an
existing PDU session where URSP rules would be difficult to update.
Other solutions include:
\- Solution#42 proposes a new \"WLAN Offload Guidance\" indication in the
Route Selection Descriptor to indicate to the UE that offloading edge
computing traffic matching the Traffic Descriptor for this URSP rule to
integrated non-3GPP access is conditional to the evaluation of conditions
informed by the network. The UE may then perform RTT measurements on the
non-3GPP path and use the measurements to help decide if integrated non-3GPP
access should be used. It is not clear what the benefit of this approach is
compared to when the application measures RTT directly to EAS over the
different accesses. This solution requires that Application Server also
supports the best path selection in the UE by configuring performance
measurement parameters to compute RTT over 3GPP and non-3GPP paths.
\- Solution#43 provides two approaches:
1\. SMF rejects the PDU Session establishment from non-3GPP access if it is
handling EC traffic. This reuses the handover procedure defined in clause
4.9.2 of TS 23.502 [9]. If the UE uses the PDU Session ID of 3GPP access to
trigger the PDU Session establishment in non-3GPP, the SMF rejects this
establishment and the EC-session is still kept in 3GPP access. This requires
UE support, i.e. keeping the old PDU Session on the 3GPP access while
attempting to establish a PDU Session on the non-3GPP access, which likely
requires multi PDU Session capable UEs. The SMF can know whether this session
is EC or not according to the former notification from EASDF about the FQDN
and EAS IP address. The SMF which decides the rejection and the SMF involved
in session creation during the DNS related procedure are the same. This
requires a new logic in the SMF.
2\. The UE decides to perform a PDU Session handover according to NWDAF
analytics. This does not require the UE registration to non-3GPP, only if
there is another device available that the analytics can rely on. The
analytics can either the historic/real-time analytics or the prediction but
the real-time analytics is what could provide sufficient reliability. The
analytics can indicate to the UE or 5GC which kind of access is better for the
EAS. This will avoid that the EC-traffic is directly kept unconditionally on
5GS, as the 5GS might have low coverage or poor signal. Performance
comparation between the non-3GPP access and 5GS is necessary.
\- Solution#45 proposes an application-based solution to select/bind to a
proper network interface for communication. This solution does not require SA2
standardization. Note that it assumes that the application is aware that it
uses an EC service, which also calls for an indication to the UE (conveyed by
the UE to the Application) that the 5GC currently applies EC treatment. It
should also be noted that for operator deployed services, application clients
can be designed to use this mechanism.
## 7.7 Evaluation for KI#7: Obtain and maintain mapping table between IP
address/IP range with DNAI
There are 3 solutions (solutions #50, #51 and #52) addressing KI#7: \"Obtain
and maintain mapping table between IP address/IP ranges with DNAI\".
The main differences among these solutions are two aspects:
1\. which NF determines DNAI,
2\. what parameter(s) AF provides to NEF.
For aspect 1:
\- Solution #50 proposes that SMF is configured with mapping information
between EAS IP address(es)/IP range(s) and DNAI(s), and determine DNAI. NEF
can cache the mapping information.
\- Solution #51 proposes that UDR/NEF stores EDI. NEF determine target DNAI
based on EAS IP address in AF queries.
\- Solution #52 proposes that NEF determines target DNAI based on NF local
configuration. NEF may obtain target DNAI from UDR.
For aspect 2:
\- Solution #50: (mandatory) EAS IP address/IP range, (optional) DNN, S-NSSAI,
geographical area.
\- Solution #51: (mandatory) EAS IP address/IP range, (optional) DNN, S-NSSAI.
\- Solution #52: (mandatory) EHE information (i.e. at least one of EAS IP
address/IP range, FQDN(s), (local) DNS server address), (optional) DNN,
S-NSSAI.
**Evaluation of the solutions**
For aspect 1, on which NF determines DNAI:
\- Since mapping relationship between IP address/FQDN and DNAI is kind of
network deployment information and independent from session management, SMF is
not the proper NF for the determination of DNAI. AF can request such a map
without any PDU Session established beforehand. Therefore, NEF is more
suitable for such a mapping service.
For aspect 2, on what parameter(s) AF provide to NEF:
\- According to the description of the key issue, IP address/IP range or FQDN
may be provided by AF to obtain DNAI. DNN, S-NSSAI, and geographical area can
be used optionally to obtain corresponding DNAI.
# 8 Conclusions
## 8.1 Conclusion for KI#1: Accessing EHE in a VPLMN when roaming
### 8.1.1 Conclusion for scenario 1 (via LBO PDU Session)
To support the establishment of an LBO PDU Session towards the correct
DNN/S-NSSAI to access an EHE in the VPLMN, URSP based solution is preferred.
Key Issue 1 of TR 23.700-85 [10] is studying URSP rule provisioning and
updating procedures in roaming scenarios. Therefore, the conclusions of Key
Issue 1 of TR 23.700-85 [10] will take in account the conclusions of this
clause.
In order to support scenarios where the EHE is accessed via an LBO PDU
Session, it is concluded that URSP related procedures should be enhanced as
follows:
\- PLMN ID(s) should be sent with URSP rules. How the PLMN ID(s) are included
is defined in the conclusion of Key Issue #1 of TR 23.700-85 [10].
\- Whether the UE can be sent URSP rules that is applicable in the VPLMN
before the UE is served by the VPLMN will be defined in the conclusion of Key
Issue #1 of TR 23.700-85 [10].
NOTE 1: Normative work for the bullets above will take place within the scope
of a WID that is based on the conclusions of FS_eUEPO Key Issue #1. It will be
decided in FS_eUEPO Key Issue #1 whether a new trigger for URSP re-evaluation
is needed.
NOTE 2: The agreement that the normative work for this KI#1/LBO will take
place within the WID for FS_eUEPO depends on whether the conclusion for KI#1
FS_eUEPO fulfils the conclusion listed in this clause. If this is not the
case, the normative work to fulfil this conclusion will have to take place
within the WID for EDGE_Ph2.
### 8.1.2 Conclusion for scenario 2 (via HR PDU Session)
Regarding KI#1 scenario 2, it is concluded with the following principles:
1\. Authorization:
AMF can get SMF Selection Subscription data with indication for HR-local
traffic routing allowed during registration procedure, in order to help AMF
select the proper SMF. V-SMF sends the HR PDU session establishment request to
H-SMF, H-SMF authorizes the local traffic routing request for this PDU Session
based on subscription data and provides HR-local traffic offloading
authorization information (e.g. allowed FQDN ranges) to V-SMF. The V-SMF
configures V-EASDF taking into account this authorization information.
After authorizing the local traffic routing in VPLMN, the H-SMF sends VPLMN-
specific roaming offload policy including traffic description information,
e.g. FQDN range, EAS IP range and the session-related policy to the V-SMF if
configured in HPLMN based on the service level agreement between VPLMN and
HPLMN.
2\. Charging.
NOTE 1: It will be described how V-SMF supports charging for the local traffic
of a PDU Session that supports local traffic routing to access an EHE in the
VPLMN and whether it reports to V-CHF as well as to H-SMF in coordination with
SA5 during normative phase.
3\. EAS discovery:
V-SMF decides UL-CL/BP and local UPF insertion based on V-EASDF notification
and UE location. The V-SMF interacts with the H-SMF for UL CL/BP and local UPF
insertion as described in clause 4.23.9.1 of TS 23.502 [9] by replacing I-SMF
with V-SMF and SMF with H-SMF.
For Options A and B as specified in clause 6.2.3.2.2 of TS 23.548 [3], with
the following differences:
V-SMF configures V-EASDF based on roaming offload policy from H-SMF and EAS
Deployment Information from AF deployed in VPLMN via V-NEF and/or local
configuration in V-SMF and the DNS server address of HPLMN received from
HPLMN.
The V-SMF sends the V-EASDF address to the H-SMF for the H-SMF to create PCO
for the UE during PDU Session Establishment/Modification procedure.
Options C and D specified in clause 6.2.3.2.3 of TS 23.548 [3] can be used to
route some unencrypted DNS messages after the UL-CL is inserted for the PDU
Session for HR roaming scenarios, with the following differences:
\- For Option C, the V-SMF sends the local DNS server address to the H-SMF for
the H-SMF to create PCO for the UE during PDU Session
Establishment/Modification procedure.
\- For Option D, the H-SMF sends H-DNS server address included in PCO to UE
via V-SMF during PDU Session Establishment/Modification procedure. The DNS
query related to the edge computing (corresponding to FQDNs) can be routed to
V-EASDF/Local DNS server in the VPLMN reusing IP replacement mechanism. In
case of routing to V-EASDF, V-UPF replaces the destination IP address of DNS
query (corresponding to FQDNs) to V-EASDF and routes this DNS query to
V-EASDF, the EAS discovery procedure with V-EASDF which implements the
functions of EASDF refers to TS 23.548 [3]. For the DNS query requiring DNS
resolution in the HPLMN, the DNS resolution path is same as the normal path in
the HR PDU Session. The procedure and restriction of Option D defined in
clause 6.2.3.2.3 of TS 23.548 [3] still apply in the HR roaming case.
4\. EAS (Re-)discovery:
For UE mobility triggered EAS Re-discovery for both inter-PLMN and intra-PLMN:
The V-SMF uses the existing procedure defined in clause 4.23.9 of TS 23.502
[9] by replacing I-SMF with V-SMF and SMF with H-SMF to send target DNAI (if
available), with the difference that V-SMF may optionally send also the impact
field and optionally target V-EASDF to the H-SMF.
The H-SMF triggers the PDU Session Modification procedure as described in TS
23.502 [9] and TS 23.548 [3] to send EAS rediscovery indication, optionally
impact field and optionally V-EASDF to UE.
For AF triggered EAS Re-discovery for an AF interacting with HPLMN:
The AF deployed in VPLMN acting as 3rd party AF interacts with H-SMF via H-NEF
and provides the target DNAI to the H-SMF.
The H-SMF sends target DNAI information including the target DNAI to the V-SMF
that relays this information to the AMF, and the AMF uses the target DNAI to
select a target V-SMF as described in clause 4.23.5.4 of TS 23.502 [9] by
replacing I-SMF with V-SMF, SMF with H-SMF.
The target V-SMF selects target V-EASDF based on the target DNAI as described
in clause 6.3.23 of TS 23.501 [2] and initiates PDU Session Modification
procedure to trigger EAS re-discovery.
NOTE 2: The baseline procedure for AF triggered EAS Re-discovery for an AF
interacting with VPLMN will be determined in normative phase.
5\. For edge relocation in roaming scenarios, the AF sends PLMN ID
corresponding to target EAS to the network, and an inter-PLMN relocation
indicator is transferred between V-SMF and H-SMF to indicate that the EAS
relocation is between HPLMN and VPLMN.
### 8.1.3 Conclusion for ECS Address Configuration Information delivery
1\. ECS Address Configuration Information (EACI) provision by the AF to 5GC:
\- For the LBO case, the AF in the visited PLMN provides the EACI by using the
parameter provisioning procedure to UDM. This principle follows the design in
Rel-17.
\- For the HR case when access to EHE in VPLMN is allowed, there are two
categories:
1\. the HPLMN has the knowledge of EACI in the VPLMN.
In this case, it is assumed that an AF deployed in the HPLMN provides the EACI
to the HPLMN (i.e. UDM) as per Rel-17.
NOTE: SA WG2 is not going to define how an AF deployed in the HPLMN can know
the EACI that applies in a given VPLMN.
**In the UDM and UDR, the subscription data of EACI is stored per PLMN ID.**
2\. HPLMN does not have the knowledge of EACI in VPLMN.
In this case, the AF deployed in the VPLMN provides the EACI in the VPLMN to
the V-SMF via the V-NEF. During the HR PDU Session establishment, the V-SMF
sends the VPLMN EACI obtained from V-AF to the H-SMF.
2\. Provision of the EACI to the UE:
\- The V-SMF (for the LBO case) or the H-SMF via the V-SMF (for the HR case)
provides the UE with the EACI as indicated in step 11 in figure 4.3.2.2.1-1 of
TS 23.502 [9].
\- For the HR case, the V-SMF does not modify, but just delivers the EACI
provided by the H-SMF.
## 8.2 Conclusion for KI#2: Fast and efficient network exposure improvements
To support fast and efficient network exposure the conclusion for Key Issue #3
of TR 23.700-60 [21] (5GS information exposure for XR/media Enhancements) is
endorsed.
NOTE 1: Normative work will take place within the scope of a WID that is based
on the conclusions of FS_XRM Key Issue #3.
## 8.3 Conclusion for KI#3: Policies for finer granular sets of UEs
Normative specifications related to KI#3 will be based on following
principles:
1) the 5GC and the AF may (as part of a SLA) agree on a Target Category
information that is an abstract value (whose values are not specified by 3GPP)
and that may represent a combination of a list of External group Identifiers
or any UE, and (\"Subscriber categories\" and/or service information).
Whether 5GC actually exposes the internal representation of \"subscriber
categories\" or some external representation is to be used, will be decided in
normative phase.
The combination may e.g. refer to users members of Group Id = X and Y and also
having a certain \"Subscriber category\" for example \"Gold\", or any UE
having subscriber category set to e.g. \"Silver\".
2) The NEF may, based on local policies, determine a combination of a list of
group Identifiers or any UE, and (\"Subscriber categories\" and/or service
information), that is to be associated with the Target Category in an incoming
Nnef_TrafficInfluence service request.
Only the NEF needs to be aware of Target Category and SLA with the
application.
NOTE: The NEF is the 5GC NF where policies per AF are configured.
3) AF may provide a list of group IDs in AF request for providing policy for
UEs belong to all the groups in the list.
4) The data stored by NEF in UDR (as part of step 3a of figure 4.3.6.2-1 of TS
23.502 [9]) and the information sent by UDR to the PCF (as part of step 4 of
figure 4.3.6.2-1of TS 23.502 [9]) may refer to a combination of Group Ids or
any UE, and (service information and/or \"Subscriber categories\").
5) The PCF is impacted by the work on this key issue as the policies it gets
from UDR may refer to a combination of a list of Group Ids or any UE and
(service information and/or \"Subscriber categories\").
6) The SMF, EASDF and UPF are not impacted by normative work on this KI.
## 8.4 Conclusion for KI#4: Influencing UPF and EAS (re)location for
collections of UEs
KI#4 shall be concluded by the three aspects: UE collection definition, 5GC
selection of common EAS/DNAI, AF selection of common EAS/DNAI.
**UE collection definition**
The selection of a common DNAI/EAS map apply to a collection of PDU Sessions
that are accessing the same application and are using the same DNN, and are
established by UEs in the UE collection.
The UEs in the UE collection are identified by a UE list, group ID or any UE
may be used. Optionally, Spatial Validity Condition, may be used to limit the
UEs in the UE collection to a specific area.
The dynamic group management may be used to manage the UEs in the UE
collection, and Nnef_ParameterProvision service for 5G VN group management is
extended to support the dynamic group management other than that specific for
5G VN group.
NOTE 1: The details to differentiate 5GVN group and general dynamic group,
e.g. using Group Type indication, can be decided in the normative phase.
Indication for traffic correlation, and optionally with Correlation ID, for
using common DNAI/EAS as part of the Traffic influence information is provided
to indicating the UE collection using common DNAI/EAS.
The SMF determines that the UE belongs to a collection of UEs accessing the
application based on the following:
\- the indication for traffic correlation in the PCC Rule with eas_correlation
indication/dnai_correlation indication, Correlation ID, and:
1) the FQDN in the DNS Query reported to the SMF matched with FQDN(s) as
indicated in the EAS Deployment Information and the Service data flow template
of the PCC Rule with the indication for traffic correlation; or
2) the traffic to be routed matched with the Service data flow template of the
PCC Rule with the indication for traffic correlation.
NOTE 2: Whether correlation ID as a generic value, or Internal Group ID will
be used to correlate a collection of UEs will be decided in normative phase.
**5GC selection and enforcement of common EAS/DNAI**
For solutions using 5GC NFs to manage the common EAS/DNAI, it is concluded
that:
\- 5GC selection of the common DNAI for UE collection shall be supported;
\- 5GC selection of a common EAS for a collection of UEs shall be supported;
\- UDM/UDR is used for storing the common EAS/DNAI.
For the common EAS/DNAI selection, it is concluded that:
\- SMF selects the common EAS/DNAI considering both multiple SMFs and single
SMF cases.
NOTE 3: The detailed procedure to be used to consider multiple SMFs for common
DNAI/EAS selection in 5GC is decided in normative phase.
For the common EAS/DNAI maintenance within 5GC, it is concluded that:
\- UDM/UDR is used for storing the common EAS/DNAI;
\- 5GC enforcement of common EAS/DNAI is applicable to single as well as
multiple SMFs cases.
For the using of common DNAI/EAS, it is concluded that:
\- for using common DNAI for Traffic routing handling:
\- in case of Distributed Anchor connectivity model, the SMF may change the
PSA of the PDU Session to a PSA that provides connectivity to the common DNAI;
\- in case of Session Breakout connectivity model, the SMF triggers UL-CL/BP
and L-PSA insertion as specified in clause 6.2.3.2.2 in TS 23.548 [3].
\- for using common DNAI/EAS for EAS (re)discovery:
\- for EAS (Re-)discovery over Session Breakout Connectivity Model using
EASDF, the common DNAI can be used as input for DNS handling rule
construction:
\- for Option A, the SMF configures the EASDF to insert an EDNS Client Subnet
option to the DNS Query. The EDNS Client Subnet option refers to a location
that is topologically close to the common DNAI;
\- for Option B, the SMF configures the EASDF to forward the DNS Query to a
common Local DNS server or a Local DNS related to the common DNAI;
\- for Option C, the SMF provides the address of Local DNS server corresponds
to common DNAI to UE;
\- if a common EAS IP address is applicable to the collection of UEs and if
the IP address of the common EAS is determined e.g. using EAS discovery
procedure, the SMF configures the EASDF with DNS handling rules for the
collection of UEs to directly respond with the IP address of the common EAS in
response to the DNS Query;
\- for common EAS, the SMF may initiate EAS re-discovery to the UE.
NOTE 4: The control of the validity of the common EAS stored in 5GC can be
discussed and decided in normative phase.
**AF selection of common EAS/DNAI**
As an option, AF could determine the common EAS/DNAI for the UE collection and
provide the common EAS/DNAI to 5GS. For this aspect, it is proposed that:
\- AF selection of the common EAS/DNAI for UE collection shall be supported by
5GC;
\- AF can determine the common EAS/DNAI, e.g. based on candidate DNAI(s)
obtained from SMF(s);
NOTE 5: The information used by the AF to determine common DNAI/EAS to be
standardised is to be decided in normative phase.
\- AF may provide common DNAI/EAS for the UE collection as part of AF traffic
influence data, or AF provides common EAS ID applicable to the group as part
of group provisioning procedure.
## 8.5 Conclusion for KI#5: GSMA OPG impacts and improvements for EHE operated
by separate party
To enable the discovery of an EAS deployed by the serving Operator\'s OP on
cloud resources provided by another PLMN or partner (i.e. the Edge Node
Sharing Scenario as described in GSMA OPG.02 [5], the following is recommended
as baseline for normative work.
**EAS Deployment Provision**
The serving PLMN is provided with the information needed to support UEs to
discover and connect to the shared EHE deployed in the hosting network. In
particular, the serving SMF may either store:
\- the FQDN(s), DNS Server Information, and/or DNAI(s) of the EAS Deployment
Information (EDI, see TS 23.548 [3] clause 6.2.3.4-1). Depending on GSMA OPG
feedback, a Partner ID (e.g. PLMN ID) to identify to which partner that EDI
corresponds to may also be included. Such EDI information can be preconfigured
in the serving SMF or provided by the AF.
The serving SMF configures EASDF according to EDI based on Rel-17 methods (see
TS 23.548 [3]).
The DNS server can be selected by SMF by considering the UE location as
described in Rel-17 TS 23.548 [3].
**EAS Discovery Procedure**
The EAS discovery procedure defined in TS 23.548 [3] will be reused.
**Traffic transmission between two PLMNs**
When the traffic transmitted between two PLMNs, the UPF in serving PLMN should
support mechanisms to facilitate low latency transmission. N6 routing
information (as defined in TS 23.501 [2] clause 5.6.7) could be included in
EDI for routing specific edge.
NOTE: How to support charging in EHE sharing scenario will be specified by
considering GSMA OPG\'s feedback. Some cooperation with SA5 may be needed.
**Edge Relocation**
For edge relocation in GSMA OPG scenario, the EAS reselection methods should
be the same as the initial selection.
Edge relocation within the same hosting PLMN\'s EHE is supported, with the
principles below:
1) SMF initiates AF/EAS relocation and selection of the target EHE e.g. due to
UE mobility;
2) SMF determines AF in the target EHE domain corresponding to the UE target
location based on service area or EHE domain supported by AF;
3) notification of User plane management event procedure is enhanced to
support AF/EAS change (Sol #23, see clause 6.23).
EAS relocation between different PLMNs\' EHE depends on GSMA feedback.
Depending on the feedback, for different PLMNs case:
1) the AF initiates EAS relocation (e.g. due to AF internal triggers) and
sends PLMN ID corresponding to target EAS to the network for indicating the
EAS should be relocated to the target PLMN (identified by PLMN ID);
2) the PCF creates the PCC rule including PLMN ID (if PCF authorizes that the
traffic routing in the target PLMN is allowed);
3) the SMF determines the target DNAI for accessing target PLMN.
## 8.6 Conclusion for KI#6: Avoiding UE to switch away from EC PDU Session
It has been concluded not to pursue KI#6 for the normative phase.
## 8.7 Conclusion for KI#7: Obtain and maintain mapping table between IP
address/IP range with DNAI
The following are recommended as baseline for normative work:
\- NEF/UDR is configured by OAM with the mapping information between EAS IP/IP
range and DNAI.
\- AF requests to NEF to obtain DNAI by providing EAS IP/IP range and/or FQDN
and optionally DNN, S-NSSAI, and geographical area. NEF checks the
authorization of AF and obtains DNAI locally or from UDR. NEF responses DNAI
to AF.
\- Once the mapping information between DNAI(s) and EAS IP /IP range is
changed or removed, AF can get the notification from NEF.
#
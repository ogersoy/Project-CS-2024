# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, certain modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
NOTE 1: The constructions \"shall\" and \"shall not\" are confined to the
context of normative provisions, and do not appear in Technical Reports.
NOTE 2: The constructions \"must\" and \"must not\" are not used as
substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as
possible, and they are not used in a normative context except in a direct
citation from an external, referenced, non-3GPP document, or so as to maintain
continuity of style when extending or modifying the provisions of such a
referenced document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
NOTE 3: The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
NOTE 4: The constructions \"can\" and \"cannot\" shall not to be used as
substitutes for \"may\" and \"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
NOTE 5: The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The purpose of this Technical Report is to enhance the ATSSS feature by
investigating solutions that can support the following capabilities:
1) Support new steering functionalities that can steer/switch/split non-TCP
traffic flows (e.g. UDP traffic flows and IP traffic flows). Two types of such
steering functionalities are studied: (i) a steering functionality based on
the QUIC protocol and its multipath extensions, and (ii) a steering
functionality based on the DCCP protocol and its multipath extensions.
2) Support redundant traffic steering for both GBR and non-GBR traffic flows.
With redundant traffic steering, a traffic flow (GBR or non-GBR) can be
replicated on multiple access paths and, therefore, can improve transmission
reliability and reduce packet latency.
3) Support traffic switching between one non-3GPP access path, from a UE to a
N3IWF in a PLMN, and another non-3GPP access path, from the UE to a TNGF in
the same PLMN.
4) Support the establishment of a MA PDU Session with one 3GPP access path via
5GC and one non-3GPP access path via ePDG/EPC. This is to complement the
existing ATSSS capability that supports the establishment of a MA PDU Session
with one non-3GPP access path via 5GC and one 3GPP access path via EPC.
For each of the above capabilities, the conclusions of the study identify
whether a solution is required for the normative phase and, if required, which
solution to consider in the normative phase.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G system, Stage 2\".
[4] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System\".
[5] 3GPP TR 23.700‑93: \"Study on access traffic steering, switch and
splitting support in the 5G System (5GS) architecture; Phase 2\".
[6] IETF RFC 9000: \"QUIC: A UDP-Based Multiplexed and Secure Transport\".
[7] IETF RFC 9001: \"Using TLS to Secure QUIC\".
[8] IETF RFC 9002: \"QUIC Loss Detection and Congestion Control\".
[9] IETF RFC 9221: \"An Unreliable Datagram Extension to QUIC\".
[10] draft-ietf-quic-multipath: \"Multipath Extension for QUIC\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[11] IETF RFC 4340: \"Datagram Congestion Control Protocol (DCCP)\".
[12] draft-ietf-tsvwg-multipath-dccp: \"DCCP Extensions for Multipath
Operation with Multiple Addresses\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[13] 3GPP TS 24.193: \"Access Traffic Steering, Switching and Splitting
(ATSSS); Stage 3\".
[14] 3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via
non-3GPP access networks; Stage 3\".
[15] IETF RFC 4336: \" Problem Statement for the Datagram Congestion Control
Protocol (DCCP)\".
[16] Void.
[17] IEEE AINAW, \"Out-of-Order Transmission for In-Order Arrival Scheduling
for Multipath TCP\", DOI:10.1109/WAINA.2014.122.
[18] Void.
[19] IETF RFC 4341: \"Profile for Datagram Congestion Control Protocol (DCCP)
Congestion Control ID 2: TCP-like Congestion Control\".
[20] IETF RFC 4342: \"Profile for Datagram Congestion Control Protocol (DCCP)
Congestion Control ID 3: TCP-Friendly Rate Control (TFRC)\".
[21] IETF RFC 5622: \"Profile for Datagram Congestion Control Protocol (DCCP)
Congestion ID 4: TCP-Friendly Rate Control for Small Packets (TFRC-SP)\".
[22] Void.
[23] 3GPP TS 29.512: \"5G System; Session Management Policy Control Service;
Stage 3\".
[24] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
nodes\".
[25] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[26] 3GPP TR 23.793: \"Study on access traffic steering, switch and splitting
support in the 5G System (5GS) architecture\".
[27] IETF RFC 9298: \"Proxying UDP in HTTP\".
[28] IETF RFC 9114: \"Hypertext Transfer Protocol Version 3 (HTTP/3)\".
[29] IETF RFC 9297: \"HTTP Datagrams and the Capsule Protocol\".
[30] IETF RFC 9220: \"Bootstrapping WebSockets with HTTP/3\".
[31] draft-ietf-masque-connect-ip: \"IP Proxying Support for HTTP\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[32] IETF RFC 5225: \"RObust Header Compression Version 2 (ROHCv2): Profiles
for RTP, UDP, IP, ESP and UDP-Lite\".
[33] IETF RFC 6846: \"RObust Header Compression (ROHC): A Profile for TCP/IP
(ROHC-TCP)\".
[34] 3GPP TS 38.323: \"Packet Data Convergence Protocol (PDCP)
specification\".
[35] IETF RFC 4555: \"IKEv2 Mobility and Multihoming Protocol (MOBIKE)\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1], in
TS 23.501 [2] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1] or in TS 23.501 [2].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1], in TS 23.501 [2] and the following apply. An abbreviation defined in the
present document takes precedence over the definition of the same
abbreviation, if any, in TR 21.905 [1] or in TS 23.501 [2].
# 4 Architectural Assumptions and Requirements
The study in this technical report is based on the following architectural
requirements and assumptions:
\- The study takes the Rel-17 ATSSS architecture (see TS 23.501 [2]) as a
baseline.
\- It is assumed that an MA PDU Session is required for supporting all ATSSS
capabilities. Only ATSSS enhancements using an MA PDU Session are considered.
\- The study may impact the core network (5GC and/or EPC) but it shall not
impact the access network (e.g. NG-RAN, W-5GAN, etc.).
\- All ATSSS steering functionalities (existing and new) shall reside in the
UE and in an UPF. Steering functionalities outside either of the UE or the UPF
are not considered.
\- Any new steering functionality shall be based on the multipath extensions
of the QUIC or DCCP protocols as defined in IETF.
\- New ATSSS capabilities shall either be able to co-exist with the existing
ATSSS capabilities or any dependencies between new and existing capabilities
shall be explicitly defined.
\- The study considers, not only ATSSS-capable UEs, but also ATSSS-capable
5G-RGs. The conclusions of the study identify which aspects / solutions are
applicable only to ATSSS-capable UEs and which are applicable only to ATSSS-
capable 5G-RGs.
\- The solutions proposed to KI#5 will also be analysed whether addresses the
scenario of UE simultaneously moving of both IPsec peers in the same RAT-type
(i.e. UE local IP address and the anchor N3IWF/TNGF change), since according
to RFC 4555 [35] MOBIKE is not best suited.
NOTE: Co-ordination with BBF and CableLabs will take place as needed during
the study.
# 5 Key Issues
NOTE: The numbering of the key issues below corresponds to the numbering of
the Work Tasks in the approved ATSSS_ph3 study item (see SP-211612).
## 5.1 Key Issue #2: New steering functionalities for non-TCP traffic
### 5.1.1 Description
This key issue aims at studying new steering functionalities (in addition to
the existing ATSSS-LL and MPTCP steering functionalities defined in TS 23.501
[2]), which can be used to support steering, switching and splitting of non-
TCP traffic flows (e.g. UDP traffic flows and IP traffic flows). Presently,
traffic splitting of non-TCP traffic flows is not fully supported with the
ATSSS-LL because this steering functionality may introduce out of order
delivery, which can severely impact the transport performance.
Editor\'s note: Whether support of steering, switching and splitting of
Ethernet traffic flows is required is FFS.
More specifically, this key issue aims to:
1) Continue the Rel-17 study of the QUIC-based steering functionality and its
multipath extensions by considering some of the aspects that were left open
(see clause 8.2 of TR 23.700‑93 [5]). The resolution of these aspects may lead
to new solutions, in addition to those specified in TR 23.700‑93 [5], and any
of them should support per-packet splitting. For example, it will be
considered whether the QUIC-based steering functionality will apply other IETF
protocols, such as the MASQUE protocol, and whether a single multipath QUIC
connection can support one or multiple steering modes.
The study of the QUIC-based steering functionality is based on the QUIC
protocol [6], its multipath extensions (e.g. draft-ietf-quic-multipath [10])
and, possibly, on other relevant documents specified by IETF, such as RFC 9001
[7], RFC 9002 [8], draft-ietf-quic-datagram [9].
Any security aspects associated with the QUIC protocol mandating the usage of
TLS 1.3 for key exchange, authentication, and negotiation of security and
performance parameters (see RFC 9001 [7]), will be studied in conjunction with
SA WG3.
2) Study a new steering functionality based on the DCCP protocol RFC 4340 [11]
and its multipath extensions draft-ietf-tsvwg-multipath-dccp [12] that provide
support for per-packet splitting.
The conclusions of the study will identify which one of the above two steering
functionalities may be specified in the normative phase.
This key issue shall also consider the following additional aspects:
\- How the new steering functionalities can co-exist with MPTCP and ATSSS-LL;
\- What is the impact on the user plane performance (e.g. additional overhead)
for each one of the new steering functionalities;
\- Whether it is needed and how to negotiate the support of the new steering
functionalities between the UE and the network;
\- Whether it is needed and how to enhance PCC rules, ATSSS rules and N4 rules
to support the new steering functionalities;
\- UE impacts in order to support each one of the new steering
functionalities;
\- How to treat out-of-order delivery caused by per packet-splitting.
## 5.2 Key Issue #3: Support of redundant traffic steering
### 5.2.1 Description
This key issue is to enable the transmitter (UE for UL traffic and UPF for DL
traffic) to support redundant traffic steering with duplication criteria, in
order to improve reliability and latency.
The key issue also studies potential duplication criteria, i.e. how to
activate or deactivate packet transmission redundancy on both accesses with
additional mechanisms. The duplication criteria are known to UE and UPF, e.g.
allowing to decide which DL and/or UL packets need to be duplicated on all
access paths of a MA PDU session and which ones not.
This key issue aims to study the following issues:
\- How to support redundant traffic steering mode for different steering
functionalities.
NOTE: The redundant traffic steering mode does not apply to the ATSSS-LL
steering functionality.
\- Whether new measurements are needed to support redundant traffic steering
mode.
\- Whether and which criteria for traffic duplication should be introduced in
order to allow the UE and UPF to decide, e.g. which packets must be duplicated
on all access paths of a MA PDU session and which packets must be send over
only one access path.
\- If duplication criteria are introduced, how ATSSS and MA rules should be
modified to allow to indicate the duplication criteria to UE and UPF.
\- How the UE and UPF operate based on the modified ATSSS and MA rules for
both GBR and non-GBR traffic. This includes the definition of UE and UPF
behaviours for the case in which traffic is not duplicated on both access
paths as it does not fulfil the configured duplication criteria.
\- Whether and how to introduce mechanisms to activate and deactivate packet
duplication in a dynamic manner, e.g. triggered by network entities or
application functions.
\- How the receiver (UPF for UL traffic and UE for DL traffic) will treat
duplicated packets.
## 5.3 Key Issue #5: Switching traffic of an MA PDU Session between two
non-3GPP access paths
### 5.3.1 Description
This key issue aims to study how the data traffic of an MA PDU Session can be
switched between one non-3GPP access path, from the UE to a N3IWFin a PLMN,
and another non-3GPP access path, from the UE to a TNGF in the same PLMN.
The following topics are considered:
\- How the UE can register to 5GC in order to enable switching the traffic
from one non-3GPP access path to another non-3GPP access path.
\- How to switch the traffic of an MA PDU Session between one non-3GPP access
path from the UE to a N3IWF and another non-3GPP access path from the UE to a
TNGF in the same PLMN. This includes how the UE and the network take decision
to perform the switch of the traffic.
\- Study how existing steering modes and steering functionalities, as well as
new steering modes and steering functionalities (defined in this TR) can be
reused, or, if needed, be modified to allow switching the traffic from one
non-3GPP access path to another non-3GPP access path.
The study of the above topics will be based on the following assumptions:
\- Both non-3GPP access paths traverse the same PLMN.
\- One non-3GPP access path is using an N3IWF, while the other non-3GPP access
path is using a TNGF.
\- After switching the traffic, only one UE registration via non-3GPP access
may exist.
\- If the UE is able to access the same PLMN directly using 3GPP radio
technology, then the UE may have an MA PDU Session with three access paths
(two non-3GPP and one 3GPP) for the duration of switching the traffic from a
source non-3GPP access path to a target non-3GPP access path.
\- Impact to the UE and network should be minimized.
NOTE 1: In conclusion if time permits, it can be considered whether the
selected solution enables also the traffic switching between one non-3GPP
access path (e.g. from the UE to a N3IWF), and another non-3GPP access path
(e.g. from the UE to a TNGF) per single access PDU session.
## 5.4 Key Issue #6: Supporting MA PDU Session with one 3GPP access path via
5GC and one non-3GPP access path via ePDG/EPC
### 5.4.1 Description
This key issue considers how to support the establishment of a MA PDU Session
with one 3GPP access path via 5GC and one non-3GPP access path via ePDG/EPC. A
solution for this key issue complements the existing ATSSS solution that
supports the establishment of a MA PDU Session with one non-3GPP access path
via 5GC and one 3GPP access path via EPC (see clause 4.22.2.3 of TS 23.501
[2]).
The key issue addresses the following aspects:
\- How to establish a MA PDU session with a non-3GPP access path over ePDG/EPC
and a 3GPP access path over 5GC.
\- How to establish an PDN Connection in EPC using the S2b procedures with
untrusted non-3GPP access and designate this PDN Connection as user-plane
resource associated with a MA PDU Session.
\- How to transfer a non-3GPP access path over ePDG/EPC (while keeping the
3GPP access path over 5GC) to a trusted non-3GPP access path over 5GC.
NOTE: Handover between non-3GPP of EPC and non-3GPP access of 5GC will not be
defined.
\- The impact on UE, ePDG, EPC and 5GC.
\- Which steering functionalities and which steering modes can be applied to
an MA PDU Session with a non-3GPP access path over ePDG/EPC and a 3GPP access
path over 5GC.
It is assumed that:
\- The UE can attach to EPC via an ePDG using the S2b procedures (see clause
7.2 of TS 23.402 [25]) and can simultaneously register with 5GC over 3GPP
access.
\- The study is restricted to EPC attach using the S2b procedures via
untrusted non-3GPP access. EPC attach using S2c procedures via untrusted
non-3GPP access are not considered.
\- Solutions are preferred that re-use (as much as possible) the existing
concepts and procedures for enabling an MA PDU Session with one non-3GPP
access path via 5GC and one 3GPP access path via EPC, as defined in clause
4.22.2.3 of TS 23.501 [2].
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
Solution # Solution Title Key Issue(s)
* * *
#2.1 MP-DCCP based Steering Functionality #2 (DCCP) #2.2 MPQUIC steering
functionality using UDP proxying over HTTP #2 (QUIC) #2.3 MPQUIC steering
functionality using IP proxying over HTTP #2 (QUIC) #2.4 Limiting MA-PDU Per-
Packet Overhead #2 #3.1 New steering mode - Redundancy steering mode with
packet loss rate #3 #3.2 Redundant traffic steering triggered by AF #3 #3.3
New traffic duplication operation #3 #3.4 Redundant steering mode with
duplication information #3 #3.5 Redundant Traffic Steering Mode
Activation/Deactivation #3 #3.6 Redundant steering mode #3 #3.7 Suspending the
Redundancy Steering Mode #3 #5.1 Support traffic switching between two
non-3GPP paths #5 #5.2 Delaying UDM Registration until non-3GPP access
switching completes #5 #5.3 Path switching between non-3GPP accesses #5 #5.4
Non-3GPP access path switching in MA PDU Session #5 #5.5 Non-3GPP path switch
during Registration in new non-3GPP access #5 #5.6 Consolidated solution for
traffic switching between two non-3GPP access paths #5 #6.1 Support non-3GPP
access leg of MA-PDU Session with PDN connection in EPC #6
## 6.1 Solution #3.1: New steering mode - Redundancy steering mode with packet
loss rate
### 6.1.1 Introduction
This solution addresses KI#3 on support of redundant traffic steering.
### 6.1.2 High-level Description
The redundancy steering mode was discussed during both Rel-16 and Rel-17 ATSSS
study phase, as described in clause 6.3.1.1, 6.4.1 of TR 23.793 [26] for the
loss rate sensitive traffic, such as IMS singling, video, and some TCP-based
traffic, and the solution 4 in clause 6.4 of TR 23.700‑93 [5]. It allows the
traffic transmitted via 3GPP and non-3GPP accesses in a redundant way to
achieve the lowest latency and to lower the loss rate.
It is proposed to further enhance the redundancy steering mode as described in
TR 23.793 [26], with which the traffic will always be transmitted over both
accesses once applied, to make it possible that the traffic transmission goes
via both accesses, if necessary, or via only one access to save the transport
resource. In details, when the traffic is allowed on both accesses and the
packet loss rate (PLR) is provided with the redundancy steering mode:
\- The UE and the UPF can select any one of the accesses (based on
implementation) to transport the traffic, if both accesses can satisfy the PLR
requirement.
\- If only one access can satisfy the PLR value, this access is applied to
transport the traffic.
\- Otherwise, redundant transmission over both accesses is triggered, if the
PLR is satisfied again over one access during the redundant transmission, the
redundant transmission should be deactivated. This access is applied to
transport the traffic.
For example, if the loss rate on one access does not exceed the PLR threshold,
then only this one access is applied, otherwise, redundant transmission is
triggered.
When the traffic is allowed on both accesses and the redundancy steering mode
is provided without a PLR threshold value, both accesses are always applied
for the redundant transmission.
See below Figure 6.1.2-1 for details, where UL packet flow is taken as an
example. The DL packet flow shares the same mechanism.
This redundancy steering mode can be applied by the MPTCP functionality with
new requirements to be derived from this study/solution.
NOTE 1: The redundant transmission algorithm required by the redundancy
steering mode with packet loss rate relies on the implementation of the MPTCP
by the OS today.
NOTE 2: The redundancy steering mode with packet loss rate does not apply to
the ATSSS-LL steering functionality.
Editor\'s note: How the receiver will treat duplicated packets in case of MP-
QUIC or MP-DCCP is FFS.
Editor\'s note: The redundant traffic steering mode for the GBR traffic is
FFS.
Editor\'s note: Whether threshold values other than packet loss rate, such as
RTT, are applicable, or whether and how multiple threshold values can be used
together, is FFS.
NOTE: For the MA PDU session, when the UE performs traffic switching between
the 3GPP and non-3GPP accesses in 5GS and the MPTCP functionality is applied
for the traffic, the UE and the UPF may trigger the redundant transmission via
the 3GPP and non-3GPP access. This redundant transmission can be applied to
all the MPTCP traffic with any steering mode.
Editor\'s note: How the UE and the UPF decide to trigger the redundant
transmission via the 3GPP and non-3GPP access during the traffic switching is
FFS.
Figure 6.1.2-1: Redundancy steering mode
## 6.2 Solution #6.1: Support non-3GPP access leg of MA-PDU Session with PDN
connection in EPC
### 6.2.1 Introduction
This solution enables a UE and the network to create an MA PDU Session with
the non-3GPP access leg of a normal PDU connection in EPC, while keeping the
3GPP access leg in 5GC.
### 6.2.2 High-level Description
In this solution, it is assumed that the UE is able to attach to the EPC via
GTP-based S2b interface and simultaneously to register with the 5GC over 3GPP
access. The architecture is shown in Figure 6.2.2-1.
Figure 6.2.2-1: Multi-access between EPC and 5GC
The solution as defined in clause 4.22.2.3.2 of TS 23.502 [3] is reused, with
the major difference:
\- Extend the ATSSS container and apply APCO IE to transport the ATSSS related
parameters.
The key points of the solution are as follows:
When the UE firstly requests a new PDN connection to EPC via non-3GPP access
and wants to use this PDN connection as user-plane resource associated with a
MA PDU Session:
\- The UE requests establishment of a new PDN connection when the UE is
registered via non-3GPP access in EPS using the IPsec tunnel establishment
procedure. The UE provides the ATSSS container to ePDG via IKE_AUTH request
message. The ATSSS container is extended to include the ATSSS request PCO
parameter as defined in clause 6.1.6.2 of TS 24.193 [13]. The ePDG forwards
the ATSSS request PCO parameter in APCO IE to the PGW-C/SMF.
\- PGW-C+SMF replies the Create Session Response message to ePDG including
APCO. The APCO includes the ATSSS response with the length of two octets PCO
parameter as defined in clause 6.1.6.3 of TS 24.193 [13] and additionally
provides ATSSS rule. The ePDG obtains the ATSSS response parameter and ATSSS
rule from APCO and forwards this information via ATSSS container to the UE via
IKE_AUTH response message.
When the UE firstly requests a new MA PDU Session in 5GC/3GPP access and wants
to add the user-plane resources on non-3GPP access over EPC, it applies the
procedures as defined in clause 4.22.2.3.2 of TS 23.502 [3] and clause 7.2.2.1
of TS 24.302 [14] for the transferring an existing PDU session from 5GS:
\- The UE sends ATSSS container with the ATSSS request PCO parameter in the
IKE_AUTH request message to the ePDG including the IP address of the MA PDU
Session in CFG_REQUEST Configuration Payload, an \"MA PDU Request\" indication
and the PDU Session ID of the existing MA PDU Session on non-3GPP access over
5GC. The ePDG forwards the ATSSS request PCO parameter in the APCO to the
PGW-C/SMF via Create Session Request message.
\- PGW-C+SMF replies the Create Session Response message to ePDG including
APCO with ATSSS response with the length of two octets PCO parameter. The ePDG
obtains the ATSSS response parameter from APCO and forwards this information
via ATSSS container to the UE via IKE_AUTH response message.
For the 3GPP access, the mobility procedure from 5GS to EPS is to be performed
as follows:
\- If the MA PDU Session is transferred to EPS in case of interworking support
with N26, or if the UE sends a PDN Connectivity Request with \"handover\"
indication to transfer the MA PDU Session to EPS in case of interworking
without N26, the SMF+PGW-C can keep the MA PDU Session.
\- In case of UE operating in dual registration, the UE may decide to keep the
MA PDU Session in 5GS, in addition to the above behaviour.
### 6.2.3 Impacts on services, entities, interfaces and IETF protocols
ePDG:
\- Shall be able to support the ATSSS container and apply APCO IE to transport
the ATSSS related parameters.
PGW-C+SMF:
\- Shall be able to apply APCO IE to transport the ATSSS related parameters.
UE:
\- Shall be able to provide MA PDU \"MA PDU Request\" indication and the PDU
Session ID of the existing MA PDU Session in the IKE_AUTH request message.
\- Shall be able to receive ATSSS rule over EPC via IKE signalling.
## 6.3 Solution #2.1: MP-DCCP based Steering Functionality
### 6.3.1 Introduction
This solution addresses Key Issue #2 \"New steering functionalities for non-
TCP traffic\" proposing MP-DCCP-LL to enable Access Traffic Steering,
Switching and Splitting for any type of traffic, e.g. UDP, etc.
The ATSSS feature is to enable a UE the advantage that application traffic can
use both access resources to raise the bandwidth or/and access reliability by
simultaneously connecting over both 3GPP and non-3GPP accesses. Since
release-16, the splitting mode is only available to TCP streams using the
ATSSS-HL functionality based on MPTCP. For UDP and even plain IP traffic, it
can only be supported by the ATSSS-LL functionality, thus an UDP or even an IP
packet flow cannot be efficiently split over both accesses due to missing re-
ordering support and to the lack of access path bandwidth capabilities, so
actually the increase of bandwidth requirement is not achieved for those types
of traffic. This solution is proposed to introduce a new steering method based
on MP-DCCP to resolve this issue.
The Datagram Congestion Control Protocol (DCCP) was specified in IETF in RFC
4340 [11] for the transport layer to complement TCP and UDP for traffic that
does not require reliable transport and re-transmission (in contrast to TCP
traffic), but needs session and congestion control (in contrast to UDP
traffic). For an introduction to DCCP please refer to RFC 4336 [15]. DCCP RFC
4340 [11] and its multipath pendant MP-DCCP, draft-ietf-tsvwg-multipath-dccp
[12] provide protocol inherent measurement of path characteristics like
latency, packet loss and available bandwidth. In that regard MP-DCCP is
similar to MPTCP and therefore can support the same steering modes. Different
to MPTCP though, is the handling of missing packets. Re-transmission and
resulting head-of-line blocking are not under the responsibility of (MP-)DCCP,
which is therefore similar to the ATSSS-LL characteristics provided for any
type of traffic. This makes it suitable to be applied to Ethernet, IP and
higher layer traffic when it becomes integrated with an encapsulation
framework, which tunnels these types of traffic over a MP-DCCP connection.
Moreover MP-DCCP provides measures to facilitate the process of re-ordering at
the termination points of ATSSS. For this purpose, timing and sequencing
information are transmitted along with the encapsulated data to facilitate re-
ordering or partial reordering of the data received from the 3GPP and non-3GPP
access. Both access types provide different path characteristics that let the
original data stream scramble during transport after it has been split. Re-
ordering helps in the receiving ATSSS entity (UPF or UE) to reconstruct a
certain degree order.
For example, MP-DCCP supports similar functionality as provided by ATSSS-LL
and ATSSS-HL (MPTCP) for all ATSSS steering modes, for any type of traffic,
and provides re-ordering capabilities. MP-DCCP does not introduce encryption
but relies on the security layer of 3GPP.
This solution can be applied to any type of traffic, at least to the UDP based
application traffic, with IP-based MA PDU Sessions for various IP versions
(IPv4, IPv6, IPv4v6).
### 6.3.2 Description
This solution is largely based on Solution #6 \"MPQUIC-LL Steering
Functionality\" defined in TR 23.700-93 [5] with the main difference of using
MP-DCCP instead of MP-QUIC.
The MP-DCCP-LL solution is applicable to applications relying on any type of
traffic (plain IP, Ethernet, TCP/IP, UDP/IP), but at least provides ATSSS
functionalities to non-TCP based traffic (e.g. UDP/IP, QUIC/UDP/IP). MP-DCCP-
LL is able to co-exist with ATSSS-LL and MPTCP, even if it can take over their
functionality.
To support ATSSS using the MP-DCCP-LL steering functionality, the architecture
reference model for ATSSS, as specified in TS 23.501 [2] clause 4.2.10, is
enhanced as shown in Figure 6.3.2-1. The MP-DCCP-LL steering functionality is
implemented in the UE and in the PSA UPF. The PMF functionality is not needed
for an MA PDU Session that applies MP-DCCP-LL.
Figure 6.3.2-1: Reference Architecture for ATSSS using MP-DCCP
The MP-DCCP protocol is specified in draft-ietf-tsvwg-multipath-dccp [12]:
\"DCCP Extensions for Multipath Operation with Multiple Addresses\". It is
designed to support the multipath scenario, and provides the means for access
traffic steering, switching, and splitting. Depending on the traffic
direction, the UE or PSA UPF acts as ATSSS sender or ATSSS receiver,
respectively. The UE uses the MP-DCCP-LL functionality to establish multiple
sub-flows as DCCP tunnels which are set up and operated towards the PSA UPF
for bi-directional usage. Within each sub-flow inherent sequencing is given
and DCCP congestion control provides real-time path characteristic
information, which is required for splitting based steering modes (e.g.
priority-based, smallest delay, load-balancing) and packet reordering
measures.
The MP-DCCP-LL provides an unreliable tunnelling service between the UE and
the UPF that is based on:
1\. The DCCP protocol specified in RFC4340 [11] along with accompanying
documents that describe congestion control (CCID2, RFC 4341 [19], CCID3, RFC
4342 [20], CCID4, RFC 5622 [21], CCID5); and
2\. The DCCP extension specified in draft-ietf-tsvwg-multipath-dccp [12] for
supporting multipath DCCP.
The Figure 6.3.2-2 shows the model of an MA PDU Session that operates using
the MP-DCCP-LL steering functionality.
Figure 6.3.2-2: Model of MA PDU Session using MP-DCCP-LL
The MP-DCCP-LL is composed of the following components which can also be found
in Figure 6.3.2-3:
\- **MP-DCCP Tunnel Client (MDTC)** : The MDTC operates in the UE as a MP-DCCP
client application and provides the following functionality:
\- It establishes N MP-DCCP connections with the MP-DCCP tunnel server (MDTS)
in the UPF. The number N of MP-DCCP connections, as well as the destination IP
address & port for each MP-DCCP connection, is determined from information
contained in the PDU Session Establishment Accept message (see the \"MP-DCCP
Connection Setup Information\" below). Each MP-DCCP connection is established
immediately after the setup of the MA PDU Session.
NOTE 1: As explained below, each MP-DCCP connection carries the traffic of one
QoS flow only. By using a separate MP-DCCP connection for each QoS flow, we
ensure that PDUs belonging to different QoS flows, which may require a
different QoS treatment, are not multiplexed in the same MP-DCCP connection,
hence, each MP-DCCP connection does not need to support QoS-aware scheduling.
\- It receives UL PDUs from the upper layer and, for each UL PDU:
\- First, it selects a QoS flow based on the QoS rules in the UE.
\- Then, it selects a steering mode to be applied for the UL PDU based on the
ATSSS rules in the UE.
\- If negotiated, it compresses the inner headers (e.g. IP, UDP, TCP,
Ethernet) of the UL PDU.
\- Finally, it selects a MP-DCCP connection to transmit the PDU based on the
selected QoS flow and the selected steering mode. For each established MP-DCCP
connection, the MDTC maintains an associated steering mode and QoS flow
indicator.
NOTE 2: It is assumed that the scheduler of a MP-DCCP connection can apply
only one steering mode. Therefore, if different steering modes are needed for
the traffic of a QoS flow, then different MP-DCCP connections are setup for
this QoS flow, one per steering mode.
\- **MP-DCCP Tunnel Server (MDTS)** : The MDTS operates in the UPF as a MP-
DCCP server application and provides the following functionality:
\- It accepts the MP-DCCP connections requested by MDTC in the UE.
\- It receives DL PDUs from the upper layer and, for each DL PDU, it selects
(a) a QoS flow, (b) a MP-DCCP connection to transmit the PDU, and (c) a
steering mode. The MP-DCCP connection is selected based on the N4 (e.g. MAR)
rules.
\- If negotiated, it compresses the inner headers (e.g. IP, UDP, TCP,
Ethernet) of the DL PDU.
\- **MP-DCCP protocol** : The DCCP protocol as defined by IETF with the
applicable multipath extensions, draft-ietf-tsvwg-multipath-dccp [12]. It
receives PDUs from the MDTC in the UE (or the MDTS in the UPF) indicating the
MP-DCCP connection to be sent on and, for each PDU, it selects an access type
(i.e. a MP-DCCP sub-flow) to transmit the PDU. The access type selection is
based on the steering mode associated with the MP-DCCP connection and the
measurements provided by the MP-DCCP protocol (e.g. RTT, loss rate,
congestion).
The MP-DCCP-LL functionality tunnels PDUs (e.g. IP packets or Ethernet frames)
over a multipath DCCP transport. The protocol stack in the UE and UPF is shown
in Figure 6.3.2-3. The different IP addresses shown in this figure are
explained in the next clause.
Figure 6.3.2-3: Protocol stack for MP-DCCP-LL
In summary, the MP-DCCP-LL steering functionality:
a. Supports a multipath, unreliable, and transparent bi-directional tunnelling
service between the UE and UPF.
b. Does not support retransmission of lost DCCP datagrams but supports loss
detection, according to RFC 4340 [11].
c. Provides mechanisms for reordering of out-of-order arrived DCCP datagrams
as described in clause 6.3.7.
d. Supports congestion control per DCCP sub-flow, based on standardized CC
algorithms RFC 4341 [19], RFC 4342 [20], RFC 5622 [21]). As a result, the UE
and the UPF may stop sending datagram frames on a DCCP sub-flow when
congestion is detected by the MP-DCCP protocol on this sub-flow.
e. Supports round-trip, packet loss measurements per DCCP sub-flow, as part of
the CCID framework as specified in RFC 4340 [11] and provides available
bandwidth estimation.
f. Supports steering modes compatible with the ATSSS rules, the QoS rules and
the N4 rules as defined in Rel-17. One steering mode is supported per MP-DCCP
connection.
g. Optionally, support compression of the inner headers (e.g. IP, UDP, TCP,
Ethernet) of the UL and DL PDUs.
### 6.3.3 MA PDU Session Establishment procedure
Figure 6.3.3-1: MA PDU Session establishment using MP-DCCP
The above Figure 6.3.3-1 shows how an MA PDU Session is established when (a)
the UE indicates support for MP-DCCP-LL and (b) the network accepts to apply
MP-DCCP-LL for one or more traffic flows. All steps are the same as the steps
used to establish an MA PDU Session in Rel-17 specifications. The additions to
support MP-DCCP-LL are further discussed below.
1a. In the PDU Session Establishment Request the UE indicates (in the 5GSM
capability) that it supports the MP-DCCP-LL steering functionality, inner
header compression (IHC), supported compression profile, and, possibly, other
steering functionalities such as MPTCP and ATSSS-LL.
1b. The AMF selects an SMF supporting ATSSS.
5a. In the SM Policy Control Create Request, the SMF includes the ATSSS
Capabilities of the MA PDU Session (see TS 23.502 [3] and TS 29.512 [23]),
which contain the MP-DCCP-LL capability and, possibly, other capabilities
already defined, such as \"MPTCP functionality with any steering mode and
ATSSS-LL functionality with any steering mode\", etc.
5b. The PCF decides to allow the requested MA PDU Session and creates PCC
rules containing MA PDU Session Control information (see TS 29.512 [23]),
which specifies a steering functionality (e.g. MP-DCCP-LL, ATSSS-LL), a
steering mode (e.g. Active/Standby), etc.
6a. Based on the received PCC rules, the SMF creates N4 rules for the UPF
including MAR rules for MP-DCCP-LL and decides to use IHC and which
compression profile.
6b. In the N4 Session Establishment Request, the SMF includes the N4 rules and
indicates to UPF that MP-DCCP-LL Control Information should be provided (see
next step). The MP-DCCP-LL Control Information indicates to UPF how many MP-
DCCP connections are needed, which is determined from the received PCC rules
which map to QoS Flows and steering modes. For example, if the SMF has two QoS
Flows carrying traffic with steering functionality = MP-DCCP-LL and steering
mode= smallest delay then the SMF indicates to UPF that two MP-DCCP
connections are needed. It also includes IHC configuration information.
6c. Based on the requested MP-DCCP-LL Control Information, the UPF provides
the following MP-DCCP-LL parameters:
1) Two \"UE link-specific MP-DCCP-LL\" IP addresses used only by the MP-DCCP-
LL functionality in the UE, one associated with the 3GPP access and another
associated with the non-3GPP access. It is possible that the UPF provides \"UE
link-specific MP-DCCP-LL\" IP addresses that are not routable via N6 (e.g.
IPv6 link-local addresses). For example, the \"UE link-specific MP-DCCP-LL\"
IP addresses may be the following:
UE link-specific MP-DCCP-LL IP address over 3GPP access = 10.10.1.1
UE link-specific MP-DCCP-LL IP address over non-3GPP access = 10.10.2.1
NOTE 1: The \"UE link-specific MP-DCCP-LL\" IP addresses are similar to the
\"UE link-specific multipath\" IP addresses used for MPTCP, specified in TS
23.502 [3] and TS 29.244 [24].
NOTE 2: In case MP-DCCP-LL and MPTCP are enabled for the same MA PDU Session,
the \"UE link-specific MP-DCCP-LL\" IP addresses and the \"UE link-specific
multipath\" IP addresses can be the same.
2) \"MP-DCCP Address Information\" which contains the \"UPF link-specific MP-
DCCP-LL\" IP address for the UPF, and one UPF port number per MP-DCCP
connection.
3)
7\. Based on the received PCC rules and the MP-DCCP-LL parameters received
from UPF, the SMF creates the following information, which will be sent to the
UE:
\- ATSSS rules;
\- QoS rules; and
\- \"MP-DCCP Connection Setup Information\" which contains
a) information for the UE to setup the MP-DCCP connections with the UPF. For
example, it indicates that a MP-DCCP Connection over 3GPP access should be
established toward the UPF IP address 10.10.3.1and UPF port 53671 for QFI-x
and steering mode=smallest delay.
b) IHC configuration information
8a. In the PDU Session Establishment Accept, the ATSSS Container (defined in
TS 24.193 [13]) contains:
1) The ATSSS rules, which are applied by MDTC in the UE to route the traffic
of the MA PDU Session across the DCCP connections; and
2) The \"network steering functionalities information\" (see TS 24.193 [13]),
which contains:
a. The two \"UE link-specific MP-DCCP-LL\" IP addresses provided by UPF in
step 6c; and
b. The \"MP-DCCP Connection Setup information\" created by SMF in step 7.
11\. Based on the received \"MP-DCCP Connection Setup information\" the MDTC
in the UE establishes one or more MP-DCCP connections with the MDTS in the
UPF. The UE establishes the MP-DCCP connections immediately after receiving
the PDU Session Establishment Accept message. The application protocol
negotiated during each MP-DCCP connection will be decided by stage-3 (for
example, it could be \"mp-dccp-ll\").
When MP-DCCP-LL functionality is enabled for the MA PDU Session:
\- any QoS rules or PDRs that apply to the MA PDU Session IP address/prefix
and port also apply to the \"link-specific multipath\" addresses/prefixes and
ports used by the UE to establish MP-DCCP subflows over 3GPP and non-3GPP
accesses; and
\- any QoS rules or PDRs that apply to the IP address/prefix and port of the
final destination server in DN also apply to the IP address and port of the
MDTS for corresponding MP-DCCP subflows that are terminated at the UPF.
NOTE 2: How these associations are made is left up to the UE and UPF
implementations.
The MP-DCCP connections established between the MDTC in UE and the MDTS in UPF
include also MP-DCCP connections associated with downlink-only QoS flows. This
is achieved by sending \"MP-DCCP connection setup information\" to UE that
includes information for establishing a MP-DCCP connection associated with a
downlink-only QoS flow. The UE does not send uplink PDUs to a MP-DCCP
connection associated with a downlink-only QoS flow, because the UE has no
associated QoS rule for this MP-DCCP connection. However, the UE sends DCCP
packets (e.g. Data-ACK, etc.) over this MP-DCCP connection based on the normal
MP-DCCP protocol operation.
6.3.4 MA PDU Session Modification procedure
The MA PDU Session Modification procedure (either network-requested or UE-
requested) may be used to add or remove QoS flows from an established MA PDU
Session, as specified since Rel-16.
After the MA PDU Session Modification procedure is completed, then:
\- If a QoS flow is deleted and this QoS flow was used to transfer MP-DCCP-LL
traffic, then the MP-DCCP connection associated with this QoS flow (one DCCP
connection per access) is released. The UE receives updated \"MP-DCCP
Connection Setup Information\" in order to determine which MP-DCCP connection
to release.
\- If a QoS flow is created and this QoS flow will be used to transfer MP-
DCCP-LL traffic, then the MP-DCCP connection associated with this QoS flow
(one DCCP connection per access) is established between the UE and UPF. The UE
receives updated \"MP-DCCP Connection Setup Information\" in order to
determine the UPF IP addresses and ports for the new MP-DCCP connections.
### 6.3.5 Example of MP-DCCP-LL Operation
To better explain the MP-DCCP-LL operation, we consider an example in this
clause. In this example, it is assumed that the PCF creates two PCC rules
which contain steering functionality = MP-DCCP-LL (see Figure 6.3.5-1 below)
and the UPF provides the following MP-DCCP-LL parameters:
1) \"UE Link-specific MP-DCCP-LL\" IP addresses:
UE Link-specific MP-DCCP-LL IP address over 3GPP access = 10.10.1.1
UE Link-specific MP-DCCP-LL IP address over non-3GPP access = 10.10.2.1
2) MP-DCCP-LL Address Information:
UPF Link-specific MP-DCCP-LL IP address for both 3GPP access and for non-3GPP
access = 10.10.3.1
UPF Port for MP-DCCP Connection #1 = 53671
UPF Port for MP-DCCP Connection #2 = 53672
Based on the above MP-DCCP-LL Address Information, the SMF creates the
following \" MP-DCCP Connection Setup information\", which is sent to UE.
\- MP-DCCP Connection #1:
\- UPF Link-specific MP-DCCP-LL IP address for 3GPP access: 10.10.3.1
\- UPF Port: 53671
\- Associated QFI: QFI-x
\- Associated Steering Mode: Active/Standby
\- MP-DCCP Connection #2:
\- UPF Link-specific MP-DCCP-LL IP address for both 3GPP accessand non-3GPP
access: 10.10.3.1
\- UPF port: 53672
\- Associated QFI: QFI-y
\- Associated Steering Mode: Smallest Delay
The UE applies the received \"UE link-specific MP-DCCP-LL\" IP addresses and
the \"MP-DCCP Connection Setup information\" and establishes two MP-DCCP
connections with the UPF over both 3GPP access and non-3GPP access, as shown
below.
Figure 6.3.5-1: Example of MP-DCCP-LL Operation
After the two MP-DCCP connections are established between the UE and the UPF,
the MP-DCCP-LL routes the PDUs received from the upper layers to one of the
flows of a MP-DCCP connection, as illustrated in Figure 6.3.5-2 and Figure
6.3.5-3 below for up-link and down-link traffic, respectively.
First, the QoS rules are applied on a received PDU (e.g. IP packet or Ethernet
frame) to determine a QFI for this PDU. Subsequently, the MDTC finds a
matching ATSSS rule for the PDU based on which it identifies the steering mode
that should be applied for this PDU. Finally, the MDTC selects a MP-DCCP
connection for the PDU based on the selected QFI and the steering mode. For
each MP-DCCP Connection, the MDTC maintains an associated steering mode and
QFI according on the received \"MP-DCCP Connection Setup information\".
Finally, the PDU is encapsulated in a DCCP datagram and is added to a DCCP/IP
packet destined to [UPF Link-specific MP-DCCP-LL IP address = 10.10.3.1, UPF
Port = 53671].
NOTE 1: The QFI selected for a PDU is transferred down to the selected access
(3GPP or non-3GPP) so that the selected access can transfer the PDU via the
corresponding QoS flow. For a packet created by the MP-DCCP protocol itself
(e.g. a Data ACK), the QFI delivered to the access is the QFI associated with
the MP-DCCP connection over which this packet is transmitted.
NOTE 2: The header compression, if performed by the MP-DCCP Tunnel Client and
the MP-DCCP Tunnel Server (see clause 6.3.2) is not shown in the following two
figures for simplicity.
Figure 6.3.5-2: Example of user-plane operation with MP-DCCP-LL (UL direction)
Figure 6.3.5-3: Example of user-plane operation with MPDCCP-LL (DL direction)
### 6.3.6 Support of Steering Modes
MP-DCCP solution supports all specified steering modes in TS 23.501 [2]. In
addition, MP-DCCP can support additional steering modes as listed in clause
6.3.1.
MP-DCCP protocol may provide additional modes by new scheduling algorithms and
by flexibly combining any of the existing steering modes.
### 6.3.7 Support of Re-Ordering
Traffic splitting over access paths with different characteristics causes
scrambling of the original data stream. A reassembly of such data stream
requires a re-ordering.
MP-DCCP protocol itself does not specify re-ordering mechanisms but provides
path sequencing (DCCP packet sequencing [11]), connection sequencing (MP_SEQ
option [12]) and has inherent latency (MP_RTT option [12]) or timing (DCCP
timestamp option [11]) information exchange, i.e. all properties that are
necessary for the packet receiving side, i.e. UE or UPF, to be able to
implement re-ordering properly. Different re-ordering strategies may be used
which can be achieved by using implementation specific means.
### 6.3.8 User-plane overhead
This clause shows additional header sizes used by the MP-DCCP-LL solution to
encapsulate and transport PDUs over the user-plane.
Note: Outer IP header is not considered as not different between solutions.
**Data Packet** \ MP_RTT for Reordering\ \---DCCP------- + -----MP-DCCP--- +
Payload
Generic Header + MP-SEQ + MP-RTT + IP + UDP\ 12 or 16 + 9 + 12 + 20 + 8 =
**61/65 Bytes** \ \ DCCP Timestamp for reordering
\---DCCP------------------- + MP-DCCP + Payload\ Generic Header + timestamp +
MP-SEQ + IP + UDP\ 12 or 16 + 6 + 9 + 20 + 8 = **55/59 Bytes**
Depending on which combination of short or long DCCP header and the type of
delay information exchange (DCCP timestamp option or MP_RTT option) is used
for reordering the additional headers add 55 Byte to 65 Byte to the actual
payload. It is recommended to use short DCCP header (12 Bytes) and timestamp
option (6 Bytes) for implementations which results in additional 55 Byte only.
Compression of IP/UDP or IP/TCP or Ethernet headers can significantly reduce
overhead.
### 6.3.9 Co-existence with MPTCP and ATSSS-LL
The MP-DCCP and the MPTCP steering functionalities complement each other as
the former supports multipath transport for UDP/IP/Ethernet traffic, while the
latter supports multipath transport for TCP/IP traffic.
Since the UE indicates if it supports the MP-DCCP steering functionality (in
the PDU Establishment Request message), the network may configure the UE/UPF
to apply MP-DCCP for UDP data flows, only if it is supported by the UE.
Otherwise, the network may configure the UE/UPF to apply ATSSS-LL for UDP data
flows.
### 6.3.10 Impacts on services, entities, interfaces and IETF protocols
The ATSSS rules and the N4 rules are enhanced to support values for the MP-
DCCP-LL steering functionality and for potentially new steering modes. The UE
and the UPF receive information (\"MP-DCCP Connection Setup information\" for
UE respectively \"MP-DCCP-LL Control Information\" for UPF) which indicates
how many MP-DCCP connections should be established between the UE and the UPF,
and the QoS flow and steering mode associated with each MP-DCCP connection.
IETF protocols:
\- The MP-DCCP-LL solution is based on the following draft specifications
defined by IETF. The MP-DCCP-LL does not require any changes to these
specifications.
RFC 4340 [11], draft-ietf-tsvwg-multipath-dccp [12].
AMF:
\- No impact. It is assumed that if 5GC supports ATSSS / Rel-18, then all
ATSSS-capable SMFs in 5GC are capable of supporting MP-DCCP-LL.
SMF:
\- From the PCC rules, it shall determine the number of MP-DCCP connections
needed.
\- Shall indicate to UPF the number of MP-DCCP connections needed.
\- Shall create and send to UE the \"MP-DCCP Connection Setup Information\"
based on the \"MP-DCCP-LL Address Information\" received from UPF.
\- From the received PCC rules, it shall create corresponding ATSSS rules and
QoS rules for the UE.
\- From the received PCC rules, it shall create corresponding N4 rules (PDRs,
MAR, QER, etc.) for the UPF.
\- Decides whether to use IHC and forwards IHC configuration information to UE
and UPF
PCF:
\- Shall be able to create PCC rules using the MP-DCCP-LL steering
functionality.
UPF:
\- Shall be able to allocate the \"UE Link-specific MP-DCCP-LL\" IP addresses.
\- Shall be able to allocate MP-DCCP-LL Address Information, i.e. one IP
address used for MP-DCCP-LL and one DCCP port number for each MP-DCCP
connection.
\- Shall apply the N4 rules (e.g. PDRs and associated MARs) to select a MP-
DCCP connection and an access (sub-flow) on this connection, for each DL PDU.
Each MAR using the MP-DCCP-LL steering functionality shall identify a MP-DCCP
Connection.
\- Shall select a MP-DCCP connection for an DL PDU based on the steering mode
and QoS flow selected with this PDU.
\- Shall be able to support the DCCP protocol with multipath extensions.
\- Shall apply the QoS Enforcement Rules (QERs) to map the traffic of each MP-
DCCP connection to a QoS flow.
\- Applies inner header compression based on the received when IHC
configuration received in N4 rules
UE:
\- Shall be able to indicate support of MP-DCCP-LL and whether IHC is
supported and which compression profile it supports when requesting a MA PDU
Session.
\- Shall establish _N_ MP-DCCP connections to UPF via each access, based on
the received \" MP-DCCP Connection Setup Information\".
\- Shall apply the ATSSS rules to select a steering mode for each UL PDU.
\- Shall select a MP-DCCP connection for an UL PDU based on the steering mode
and QoS flow selected with this PDU.
\- Shall be able to support the DCCP protocol with multipath extensions.
\- Shall apply the QoS rules to map the traffic of a SDF to a QoS flow.
\- Shall apply IHC based on the received compression profile in the MP-DCCP
Connection Setup Information
## 6.4 Solution #3.2: Redundant traffic steering triggered by AF
### 6.4.1 Introduction
This solution aims at addressing key Issue #3 about support of redundant
traffic steering. In particular, this solution mainly focuses on whether and
how to introduce mechanisms to active and deactivate packet duplication in a
dynamic manner, e.g. triggered by network entities or application functions.
For how the UE and UPF apply the redundancy steering mode, Solution #3.1
specified in clause 6.1 can be applied.
### 6.4.2 High-level Description
This solution aims at addressing key Issue #3 about support of redundant
traffic steering. In particular, this solution mainly focuses on whether and
how to introduce mechanisms to activate and deactivate packet duplication in a
dynamic manner, e.g. triggered by network entities or application functions.
For how the UE and UPF apply the redundancy steering mode, Solution #3.1
specified in clause 6.1 can be applied.
Application function (AF) can provide packet loss rate threshold value for
specific traffic flows to the PCF via the NEF, triggering PCF to update the
PCC rules related to the traffic flows, e.g. using redundant steering mode to
transmit the traffic flows with applying the packet loss rate threshold value.
When the SMF receives the updated PCC rules provided by the PCF, the SMF
updates the N4 rules to UPF and ATSSS rules to UE via AMF respectively. The UE
and the UPF transmit the traffic flows with redundancy steering mode as
defined in Solution #3.1 based on the updated ATSSS rules and N4 rules.
### 6.4.3 Procedures
#### 6.4.3.0 General
Application function (AF) can provide packet loss rate threshold value for
specific traffic flows to PCF via the NEF as defined in the clauses 4.3.6.2,
4.15.6.6 or 4.15.6.6a of TS 23.502 [3]. When the parameter (i.e. the packet
loss rate threshold value) is updated to PCF, the PCF may decide to trigger
redundant traffic steering by updating PCC rules including the updated
parameters to the SMF, enabling the SMF modifies the N4 rules and ATSSS rules
to UPF and UE respectively. Clause 6.4.3.1 illustrates that the PLR threshold
value is provided to PCF via the procedure of AF requesting to influence
traffic routing for Sessions not identified by an UE address, while the clause
6.4.3.2 illustrates that the PLR threshold value is provided to PCF via the AF
session with required QoS update procedure.
Editor\'s note: It is FFS which one of the options is be selected.
#### 6.4.3.1 Procedure of AF providing PLR threshold value via
Nnef_TrafficInfluence_Create/Update operation service
Figure 6.4.3.1-1: Procedure of AF providing PLR threshold value via
Nnef_TrafficInfluence_Create/Update operation service
1\. Step 1 to step 5 in Figure 4.3.6.2-1 of TS 23.502 [3] are performed with
following modification:
\- The request message in step 1, step 2 and step 4 includes the maximum loss
rate tolerated by the application corresponding to the traffic flow identified
by the traffic filtering info.
\- In step 5, the PCF determines to updates the SMF with corresponding new
policy information about the MA PDU Session based on the maximum loss rate
received in step 4. The MA PDU Session control information included in the PCC
rules indicate that redundant steering mode with PLR threshold value is
applied to traffic flows identified by the traffic filtering information.
2\. SMF derives the updated N4 rules and ATSSS rules based on the updated PCC
rules. SMF sends the N4 rules to UPF via N4 Session modification procedure.
Both N4 rules and ATSSS rules indicate that when transmitting the specific
traffic flows identified by the traffic descriptor, the redundant steering
mode shall be applied. The redundant steering mode can be triggered
dynamically as specific in clause 6.1 in Solution #3.1.
3\. SMF sends Namf_Communication_N1N2MessageTransfer message to AMF, which
include N1 SM container that consists of the ATSSS rules.
4\. AMF sends the ATSSS rules to the UE via NAS message.
When both UE and UPF obtain the ATSSS rules and N4 rules respectively, they
transmit the specific traffic flows by using redundant steering mode as
defined in Solution #3.1.
#### 6.4.3.2 Procedure of AF providing PLR threshold value via
Nnef_AFsessionWithQoS_Create/Update operation service
Figure 6.4.3.2-1: Procedure of AF providing PLR threshold value via
Nnef_AFsessionWithQoS_Create/Update operation service
1\. Step 1 to step 5 in figure 4.15.6.6-1 or 4.15.6.6a-1 of TS 23.502 [3] are
performed with following modifications:
\- The request message in step 1 and 3 includes the QoS parameter of PLR
corresponding to the traffic flow identified by the Flow descriptions.
\- the TSCTSF is not involved in this procedure, so the steps 3a, 3b, 4b, 6a,
7a and 7b are not applicable.
2\. The PCF determines to update the SMF with corresponding new policy
information about the MA PDU Session based on the PLR threshold value received
in step 1. The MA PDU Session control information included in the PCC rules
indicate that redundant steering mode with PLR threshold value is applied to
traffic flows identified by the traffic filtering information.
3\. SMF derives the updated N4 rules and ATSSS rules based on the updated PCC
rules. SMF sends the N4 rules to UPF via N4 Session modification procedure.
Both N4 rules and ATSSS rules indicate that when transmitting the specific
traffic flows identified by the traffic descriptor, the redundant steering
mode shall be applied. The redundant steering mode can be triggered
dynamically as specific in clause 6.1 in Solution #3.1.
4\. SMF sends Namf_Communication_N1N2MessageTransfer message to AMF, which
include N1 SM container that consists of the ATSSS rules.
5\. AMF sends the ATSSS rules to the UE via NAS message.
When both UE and UPF obtain the ATSSS rules and N4 rules respectively, they
transmit the specific traffic flows by using redundant steering mode as
defined in Solution #3.1.
### 6.4.4 Impacts on Existing Nodes and Functionality
PCF impact:
\- Ability to determine to apply redundant steering mode with PLR threshold
value based on the parameters provided by AF.
## 6.5 Solution #3.3: New traffic duplication steering mode
### 6.5.1 Introduction
This new solution addresses KI#3 on Support of redundant traffic steering.
### 6.5.2 High-level Description
With this solution redundant traffic steering is enabled as a new steering
mode. The new steering mode enforces, based on certain criteria, that a Packet
Data Unit (PDU) is duplicated and sent to the other access. Traffic
duplication can be activated and de-activated by setting or re-setting the
traffic duplication criteria.
The UE indicates its capability for support of traffic duplication during the
MA PDU session establishment procedure.
Traffic duplication reduces end-to-end latency and packet loss rate, but at
the cost of utilizing resources over both accesses. Thus, selective
duplication is a necessity to avoid wasting unnecessarily network, and
especially radio resources. The state of each access is dynamically changing
over time, and hence a static selection of an access as primary access is
suboptimal.
The new steering mode operates on a per PDU basis in the following way: First,
for each PDU the access to be used as primary access is determined either
statically, or dynamically based on access conditions, e.g. smallest delay.
Second, once the primary access for the PDU is selected and if the duplication
criteria are met, the PDU is duplicated and sent over the other (the current
secondary) access.
As part of the ATSSS Rule and MA Rule at SDF level, the UE and the UPF
respectively receive the necessary information to use the new steering mode.
In certain cases, duplication of traffic may be desired only for a specific
access, e.g. limited to the non-3GPP access to avoid excessive charging. For
this purpose, an Access Constraint Indicator can be provided indicating the
access to which duplication is not allowed, i.e. it can be set to 3GPP or
non-3GPP. If not set, duplication can be applied for any access.
1\. Regarding the selection of the primary access, the following configuration
parameter can be set:
a. Static: One access is indicated and set as the primary access. The other
access is the secondary access used for duplication.
b. Dynamic: Based on measured performance criteria (e.g. PLR, RTT), the best-
performing access is selected as primary access, and the other access is used
as secondary access.
2\. If none of the duplication criteria described below is provided and the
Access Constraint Indicator is not set, all the traffic sent to the primary
access is duplicated to the secondary access. If duplication criteria are
provided, (part of the) traffic is duplicated to the other access whenever the
duplication criteria are met, and the secondary access is available.
The new steering mode is applicable to GBR and non-GBR traffic as it generally
improves the user experience. For GBR traffic networks resources need to be
reserved on both accesses.
Editor\'s note: How the receiver will treat duplicated packets in case of MP-
QUIC or MP-DCCP is FFS.
If present, traffic duplication criteria are evaluated by the UE for the UL
and by the UPF for the DL to decide which packets need to be duplicated. One
or more of the following traffic duplication criteria can be applied to the
traffic on the primary access:
1\. Link quality: Traffic duplication is started or stopped based on link
quality measurements, e.g. considering Packet Loss Rate (PLR) or Round Trip
Time (RTT) thresholds. The measurement result focuses only on the performance
of a single link, i.e. the 3GPP or non-3GPP link in UL or DL. When the
measured link performance violates the provisioned threshold, the next packets
will be duplicated to the other path, otherwise the traffic will be sent on
the currently selected primary access. This allows to limit duplication of
traffic to the case where the link quality decreases, thus the probability to
lose packets increases. These duplication threshold values can be specified in
a similar way to existing Threshold values.
The link quality criterion allows to specify the duplication conditions for
the selected primary access.
Duplication threshold values: One or more threshold values may be provided for
a steering mode. A threshold value may be either a value for RTT or a value
for PLR. The threshold values are applicable to currently selected primary
access and are applied by the UE and UPF to decide whether a PDU shall be
duplicated and send on the other access.
Applicability: This criterion keeps track of the status of the primary access
path and enables the UE and the UPF to independently apply duplication when
considered useful based on the measurements available. Thus, it can tackle
temporary degradation of an access path in UL and/or DL.
2\. Percentage of duplicated traffic (Max or fixed percentage is possible):
The max percentage variant, if indicated, allows to define a duplication
budget as the max percentage (e.g. up to 20%) of traffic that can be
duplicated over a certain time. It is up to implementation which traffic is
duplicated. The fixed percentage variant, if indicated, mandates the exact
percentage of traffic that should be duplicated to the secondary access. For
example, fixed 20% duplication rate would mean that UE and UPF duplicate 20%
of the packets, e.g. every 5th packet. A max of 20% duplication rate would
mean that UE and UPF duplicate every 5th or less packet over a certain time
period.
Applicability: Unless fixed percentage is indicated, this criterion enables
the UE and the UPF to select how much and which of the traffic to duplicate
based for example on locally available information such as the battery state
of the UE or other possible criteria, such as:
i. Important PDUs: Traffic duplication is applied based on header information
indicating whether a PDU is important or not, i.e. only important PDUs are
duplicated, and up to the maximum duplication budget. For example, duplicating
only PDUs carrying I-frames, and not P-frames (which is indicated in a RTP
header extension), in video streams, or duplicating only video and not audio
in a video surveillance application.
NOTE 1: The concrete information in the PDU header that is used for traffic
duplication is not specified.
ii. Survival time: Survival Time, as defined in TS 23.501 [2], refers to the
time period an application can survive without any data burst (with a certain
burst size). As per TSC feature, Survival Time is part of TSCAI (see TS 23.501
[2]). The AF may provide the time an application can survive without any
burst. It refers to the time that an application consuming a communication
service may continue without an anticipated message and can be expressed as
the maximum number of messages or in terms of time units.
NOTE 2: The exact usage of the Survival Time in the TSCAI information is not
specified, but the Survival Time has to be included as part of the ATSSS and
MA rules to be used by the UE and the UPF respectively.
Essentially the two criteria are easily combinable since:
1\. the first (Link quality) controls the dynamic activation of duplication of
traffic
2\. the second (Percentage), upon activation determines which PDUs should be
duplicated based on the indicated budget.
Access selection is based on relative performance of the two accesses, and by
selecting always the best one it reduces the need for duplication. On the
other hand, Link quality criterion for duplication captures the temporal
evolution of access state and relies on absolute performance values. The
combination of dynamic primary access selection and partial duplication
significantly reduces the duplication overhead since the duplication is
applied only when needed and to the extent it is needed.
The duplication steering mode, together with duplication criteria, needs to be
authorized by the PCF in the PCC Rules, and the SMF provides an indication for
duplication and the duplication criteria in the ATSSS Rule to the UE, and in
the Multi-Access Rule (MAR) to the UPF. After receiving the rules, UE and UPF
determine when and how to duplicate traffic based on the provided duplication
criteria and the measured performance of each access.
The AF can also request to start and stop traffic duplication by including the
corresponding duplication steering mode indication and traffic duplication
criteria to be applied for the application traffic. The NEF provides an API
allowing the AF to request start and stop of traffic duplication and providing
traffic duplication criteria.
The duplication steering mode requires that the Multi-Access Rule (MAR) and
the ATSSS Rule, both generated by the SMF will need to be updated as follows:
Table 6.5.2-1: Updated structure of ATSSS Rule and MA Rule
+-------------+-------------+----------+-------------+-------------+ | Information | Description | Category | SMF | Scope | | name | | | permitted | | | | | | to modify | | | | | | in a PDU | | | | | | context | | +=============+=============+==========+=============+=============+ | Static | Identifies | Optional | Yes | PDU context | | primary | the static | | | | | access (1) | primary | | | | | | access | | | | | | (e.g. 3GPP | | | | | | access) | | | | +-------------+-------------+----------+-------------+-------------+ | Static | Identifies | Optional | Yes | PDU context | | secondary | the static | | | | | access (1) | secondary | | | | | | access | | | | | | (e.g. | | | | | | non-3GPP | | | | | | access) | | | | +-------------+-------------+----------+-------------+-------------+ | Dynamic | Identifies | Optional | Yes | PDU context | | primary | the | | | | | access (2) | performance | | | | | | criteria | | | | | | (PLR, RTT) | | | | | | to | | | | | | determine | | | | | | the primary | | | | | | access | | | | +-------------+-------------+----------+-------------+-------------+ | Access | Identifies | Optional | Yes | PDU context | | Constraint | the | | | | | Indicator | accesses to | | | | | | which | | | | | | duplication | | | | | | is not | | | | | | allowed. | | | | | | | | | | | | If not set, | | | | | | duplication | | | | | | is allowed | | | | | | on all | | | | | | accesses. | | | | +-------------+-------------+----------+-------------+-------------+ | Duplication | Identifies | Optional | Yes | PDU context | | criterion | the | | | | | | duplication | | | | | | criterion | | | | | | that should | | | | | | be applied | | | | | | and | | | | | | associated | | | | | | parameters | | | | | | (see below) | | | | +-------------+-------------+----------+-------------+-------------+ | Duplication | A Maximum | Optional | Yes | PDU context | | threshold | RTT and/or | | | | | values | a Maximum | | | | | | Packet Loss | | | | | | Rate. | | | | +-------------+-------------+----------+-------------+-------------+ | Survival | A Maximum | Optional | Yes | PDU context | | time | duration | | | | | | that, as | | | | | | defined in | | | | | | TS 22.261, | | | | | | is | | | | | | synonymous | | | | | | with the | | | | | | time period | | | | | | an | | | | | | application | | | | | | can survive | | | | | | without any | | | | | | data burst. | | | | +-------------+-------------+----------+-------------+-------------+ | Percentage | A Maximum | Optional | Yes | PDU context | | of | or fixed | | | | | duplicated | percentage | | | | | traffic | of traffic | | | | | | that can be | | | | | | duplicated | | | | | | plus an | | | | | | indication | | | | | | whether max | | | | | | or fixed | | | | | | percentage | | | | | | is assumed. | | | | +-------------+-------------+----------+-------------+-------------+
(1) Static primary and Static secondary access are configured together.
(2) Dynamic primary access excludes configuration of Static primary and Static
secondary access.
### 6.5.3 Procedures
#### 6.5.3.1 AF providing traffic duplication parameters
Application Function (AF) can provide traffic duplication parameters for
specific traffic flows to PCF via the NEF as defined in clauses 4.3.6.2,
4.15.6.6 and 4.15.6.6a of TS 23.502 [3]. When the AF influenced parameters
(i.e. Duplication criterion, Duplication threshold values, Survival time or
Percentage of duplicated traffic) are updated to PCF, the PCF may decide to
trigger redundant traffic steering by updating PCC rules including the updated
parameters at the SMF, enabling the SMF to modify the N4 rules and ATSSS rules
at UPF and UE respectively. Clause 6.5.3.2 illustrates how the traffic
duplication parameters are provided to PCF via the procedure of AF requesting
to influence traffic routing for sessions not identified by a UE address,
while clause 6.5.3.3 illustrates how the traffic duplication parameters are
provided to PCF via the AF session with required QoS update procedure.
#### 6.5.3.2 Procedure of AF providing traffic duplication parameters via
Nnef_TrafficInfluence_Create/Update service
Figure 6.5.3.2-1: Procedure of AF providing traffic duplication parameters via
Nnef_TrafficInfluence_Create/Update operation service
1\. Step 1 to step 5 in Figure 4.3.6.2-1 of TS 23.502 [3] are performed with
following modifications:
\- The request message in step 1, step 2 and step 4 includes the maximum loss
rate tolerated by the application corresponding to the traffic flow identified
by the traffic filtering info.
\- In step 5, the PCF determines to update the SMF with corresponding new
policy information about the MA PDU Session based on the exceeded threshold
value received in step 4. The MA PDU Session control information included in
the PCC rules indicate that redundant steering mode with duplication
parameters is applied to traffic flows identified by the traffic filtering
information.
2\. SMF derives the updated N4 rules and ATSSS rules based on the updated PCC
rules. SMF sends the N4 rules to UPF via N4 Session modification procedure.
Both N4 rules and ATSSS rules indicate that when transmitting the specific
traffic flows identified by the traffic descriptor, the redundant steering
mode shall be applied. The redundant steering mode can be triggered
dynamically as specific in clause 6.5.2.
3\. SMF sends Namf_Communication_N1N2MessageTransfer message to AMF, which
include N1 SM container with the ATSSS rules.
4\. AMF sends the ATSSS rules to the UE via NAS message.
### 6.5.4 Impacts on Existing Nodes and Functionality
The ATSSS rules and the N4 rules are enhanced with a new steering mode
definition and with new parameters.
SMF:
\- Based on the PCC rules, create ATSSS rules and N4 rules with the new
steering mode data including optional traffic duplication criteria.
PCF:
\- Provide PCC rules considering new steering mode including optional traffic
duplication criteria to the SMF.
UPF:
\- Based on the traffic duplication steering mode and optionally available
traffic duplication criteria decide when to duplicate traffic via the
available access paths of a MA PDU session for the downlink traffic.
UE:
\- Based on the traffic duplication steering mode and optionally available
traffic duplication criteria decide when to duplicate traffic via the
available access paths of a MA PDU session for the uplink traffic.
AF:
\- AF can request start and stop of traffic duplication for an application
session and optionally provide traffic duplication parameter which allow UPF
and UE to decide when duplication of traffic is required.
NEF:
\- NEF provides an API allowing the AF to request start and stop of traffic
duplication and providing traffic duplication parameter.
## 6.6 Solution #3.4: Redundant steering mode with duplication information and
trigger mechanisms
### 6.6.1 Introduction
KI#3 indicates the need to study a new steering mode in order to enable the
transmission of redundant traffic between UE and UPF. The solution proposed in
this clause enables the CN to indicate to the UE and to the UPF what
percentage of the traffic needs to be duplicated and over which access link.
In addition, the solution defines mechanisms that allow the CN to trigger the
establishment of a MA PDU Session with Redundant Steering Mode (RSM) to enable
its usage in case some QoS requirements (e.g. PER/reliability) cannot be met
with a regular (single access) PDU Session.
NOTE: The working of RSM relies on the support of redundant packet
transmission from the underlying protocol e.g. MPTCP, MPQUIC, or MPCCP.
### 6.6.2 High-level Description
#### 6.6.2.1 Provision of RSM related parameters to UE and UPF
The provision of the redundant steering mode (RSM) parameters is based on the
following principles:
\- The PCF, based on the QoS requirements from the AF, will generate PCC rules
to be sent to the SMF indicating that the redundant steering mode (RSM) is to
be used for a certain traffic and/or application.
\- Based on the PCC rules, the SMF decides that the redundant steering mode
(RSM) needs to be used for a certain traffic and/or application. The SMF also
decides how much such traffic needs to be duplicated and over which access
path it is to be duplicated.
\- The SMF indicates to the UE and to the UPF via ATSSS rules and N4 rules,
respectively, the details of the RSM:
\- indication of which traffic and/or application is subject to RSM.
\- how much of that traffic needs to be duplicated (duplication factor): this
may vary between 0 to 100%. If 0% is indicated, it means that no duplication
takes place and that all the traffic is sent only over the primary access
link. If, e.g. 20, 50 or 100% is indicated, it means that that only 20, 50 or
90% of the traffic sent over the primary access link is duplicated over the
secondary access link. 100% means that all traffic is duplicated over the
secondary access link. The indication can be different for UL and DL. For
example, there could be a duplication factor of 50% in UL and of only 30% in
DL.
\- indication of which of the access paths is the secondary access. If
secondary access = \'non-3GPP access\', then 100% of the traffic is sent over
the 3GPP access path and the X% duplicated PDUs (indicated by the duplication
factor) will be sent over the non-3GPP access path. The indication can be
different for UL and DL.
NOTE 1: If the duplication factor is not indicated, it is implicitly assumed
that all the traffic is duplicated.
NOTE 2: How the receiver (i.e. the UPF in UL, the UE in DL) handles duplicated
PDUs is up to implementation. For example, for each PDU sent by the sender
(i.e. the UE in UL, the UPF in DL) over the primary access whose duplicate PDU
is sent over the secondary access, the receiver retains the PDU that arrives
at destination first and discards the one arriving later.
#### 6.6.2.2 Triggering the usage of a MA PDU Session with RSM
In addition, in scenarios in which the QoS requested for one or more QoS flows
of a single access PDU Session cannot be met (e.g. a too high PER), the SMF
may decide, based on information provided by the RAN and/or implementation
dependent mechanisms, to use, instead use the regular single access PDU
Session, a MA PDU Session with RSM to match the QoS requirements from the AF.
In order to do this, two options are possible:
\- Option 1: UE proactively indicating the possible use of a MA PDU Session.
If the UE can proactively indicate its willingness to upgrade to a MA PDU
Session, then the UE Requested PDU Session Establishment with Network
Modification to MA PDU Session procedure can be reused. The UE sends its ATSSS
rules with the MA PDU Network-Upgrade Allowed indication and the SMF can
trigger the switch to the MA PDU Session with RSM according to the indicated
ATSSS rules.
\- Option 2: SMF asking UE to upgrade to a MA PDU Session.
In that case, UE initially triggers the establishment of a regular single
access PDU Session Establishment procedure without indicating ATSSS rules nor
MA PDU Session Request. In the PDU Session Establishment Accept the SMF may
indicate to the UE that if it establishes a MA PDU Session the provided QoS
level will increase. The UE, after receiving such indication, may decide to
upgrade to a MA PDU session by modifying the single access PDU Session and
sending its ATSSS capabilities together with the MA PDU Request indication.
### 6.6.3 Procedures
**Provision of rules to SMF, UE and UPF**
The solution is based on the reuse of the existing procedures for ATSSS to
provision the necessary rules to SMF, UE and UPF:
\- the PCF provides the extended PCC rules (see clause 6.6.2.2) to the SMF at,
e.g. UE triggered Service Request (see clause 4.2.3.2 of TS 23.502 [3]);
\- the SMF provides the extended ATSSS and N4 rules to the UE and the UPF,
respectively, by means of, the MA PDU Session Establishment procedure (see
clause 4.22.2 of TS 23.502 [3]).
**Triggering of usage of RSM by the SMF**
In order to trigger the establishment of the MA PDU Session:
**\- Option 1: Re-usage of UE Requested PDU Session Establishment with Network
Modification to MA PDU Session with a \"MA PDU Network-Upgrade Allowed\"**
This option re-uses the UE Requested PDU Session Establishment with Network
Modification to MA PDU Session (see clause 4.22.3 of TS 23.502 [3]) with a
\"MA PDU Network-Upgrade Allowed\" indication. The SMF may decide to establish
the MA PDU Session based on the fact that the QoS characteristics levels of a
certain QoS flow of the PDU Session that is being establish do not meet the
QoS requirements from the AF. The SMF will then sends the appropriate ATSSS
rules and N4 rules to the UE and to the UPF, respectively, to initiate the
usage of the RSM.
**\- Option 2: Modification of AF session setup and PDU Session Establishment
procedures**
This option is based on the extension of the following procedures.
**AF session setup**
The AF uses the procedure for setting up an AF session with the required QoS
by sending an Nnef_AFsessionWithQoS_Create message (see clause 4.15.6.6 of TS
23.502 [3]) to indicate the QoS requirements for a given UE. The PDU Session
is identified by indicating the proper DNN/S-NSSAI combination. The following
changes apply to the existing procedure:
\- Step 1: instead of using UE\'s IP address, the AF indicates that the UE\'s
GPSI to the NEF when it provides the related QoS requirements.
NOTE 2: It is assumed that the AF knows (e.g. based on application level
subscription) when to provide the QoS requirements for the UE even the PDU
Session is not yet established.
\- Step 3:
The NEF temporarily stores the QoS requirements associated to the UE\'s GPSI
and it triggers the storage of a \'retrieve QoS requirements\' flag associated
to the GPSI and of the NEF\'s endpoint address in the UDM. This flag is later
used at PDU session establishment by the SMF to contact the NEF to retrieve
the QoS requirements.
**PDU Session Establishment**
The UE Requested PDU Session Establishment (see clause 4.3.2.2.1 of TS 23.502
[3]) is extended with the following changes:
\- Step 4: If the Session Management Subscription data is not available, then,
as per current Rel-17 behavior, the SMF retrieves the Session Management
Subscription data from the UDM. The SMF identifies the \'retrieve QoS
requirements\' flag in the UDM and the NEF\'s endpoint address and retrieves
the QoS requirements from the NEF.
\- Step 11: the SMF is aware that the QoS requirements for a certain QoS flow
of the PDU Session that is being established cannot be met. Because of that
the QoS flow is established with lower QoS characteristics levels.
\- After step 17: the SMF sends a PDU Session Modification Command message to
the UE including an indication that, if the UE switches to MA PDU Session,
then the QoS levels will be improved.
After the UE receives the indication from the SMF and the single access PDU
Session is established, the UE may decide to modify the PDU Session into a MA
PDU Session by sending its ATSSS capabilities and a MA PDU Request indication.
The SMF will then provide the appropriate ATSSS rules and N4 rules to the UE
and the UPF, respectively, to initiate the usage of the RSM and improve the
QoS provided to the UE (see clause 4.22.2.1 of TS 23.502 [3]).
### 6.6.4 Impacts on Existing Nodes and Functionality
PCF:
\- Extension of PCC rules to include RSM as a possible steering mode.
NEF:
\- Optional: Receives from AF per-GPSI QoS Requirements and temporarily stores
them.
\- Optional: Stores in UDM flag to indicate to SMF to contact NEF at PDU
session establishment and retrieve QoS requirements.
SMF:
\- Extension of PCC rules/ATSSS rules/N4 rules to include RSM as a possible
steering mode.
\- Extension of ATSSS rules/N4 rules to include indication of how much traffic
needs to be duplicated and over which access path.
\- Decides to trigger the establishment of a MA PDU Session with RSM based on
QoS conditions.
\- Optional: check UDM for flag to retrieve QoS Requirements from NEF at PDU
Session establishment.
UE:
\- Extension of ATSSS rules to include indication of RSM, of how much traffic
needs to be duplicated and over which access path.
\- Receives indication from SMF to switch to MA PDU Session to improve QoS
level of QoS Flow.
UPF:
\- Extension of N4 rules to include indication of RSM, of how much traffic
needs to be duplicated and over which access path.
UDM:
\- Optional: Stores flag to retrieve QoS Requirements from NEF at PDU Session
establishment.
AF:
\- Optional: Needs to provide per-GPSI QoS Requirements to 5GC before PDU
Session Establishment (Nnef_AFsessionWithQoS_Create service operation).
## 6.7 Solution #5.1: Support traffic switching between two non-3GPP paths
### 6.7.1 Introduction
This solution addresses KI#5 on support traffic switching between one non-3GPP
access path from the UE to a N3IWF in a PLMN and another non-3GPP access path
from the UE to a TNGF in the same PLMN.
### 6.7.2 High-level Description
In this solution, it is assumed that the two registrations via two non-3GPP
access in the same PLMN are performed in order to enable switching the traffic
from a source non-3GPP access path to a target non-3GPP access path and after
switching the traffic, only one UE registration via non-3GPP access may exist.
When UE decides to switch traffic of MA PDU Session from source non-3GPP
access (e.g. trusted non-3GPP access) path to a target non-3GPP access (e.g.
untrusted non-3GPP access) path in the same PLMN, UE shall perform
registration procedure via the target non-3GPP access (untrusted non-3GPP
access) path.
The MOBIKE protocol may not be able to support handover procedure between
trusted non-3GPP access and untrusted non-3GPP access and vice versa due to
the simultaneous changes of the IP address of the two end point of IKEv2, i.e.
the UE change of local IP address from source N3GPP access to target N3GPP
access and the simultaneous change of GW endpoint from N3IWF to a TNGF.
N3IWF/TNGF shall select the same AMF based on AN parameters provided by UE.
AMF shall update UDM with the RAT type of target non-3GPP access after the
registration procedure over the target non-3GPP access path is completed.
When adding user-plane resources over the target non-3GPP access path, SMF may
update ATSSS rules and N4 rules to the UE and the UPF respectively to indicate
that the traffic have to be send on the target N3GPP access.
### 6.7.3 Procedures
This clause specifies how a UE can handover one leg of MA PDU Session from a
source non-3GPP access to a target non-3GPP access path. Figure 6.7.3-1
illustrates the procedure of switching traffic of a MA PDU Session from
trusted non-3GPP access path to untrusted non-3GPP access path. It can also be
applied to the procedure of switching traffic of a MA PDU Session from
untrusted non-3GPP access path to trusted non-3GPP access path by replacing
the TNAP/TNGF with untrusted non-3GPP access network/N3IWF, and vice versa.
Figure 6.7.3-1: Switching traffic of a MA PDU Session from trusted non-3GPP
access path to untrusted non-3GPP access path
0\. UE registers to 5GC via trusted non-3GPP access and has established a MA
PDU session over trusted non-3GPP access.
1\. The UE shall initiate Registration procedure via untrusted non-3GPP access
using step 1 to step 4 in clause 4.12.2.2-1 of TS 23.502 [3].
2\. UE sends the IKE_AUTH request which including an EAP-Response/5G-NAS
packet that contains the Access Network parameters (AN parameters) and the
Registration Request message. The AN parameters shall contain the same
information used in the registration procedure over trusted non-3GPP access
including the GUAMI, the Selected PLMN ID, the Requested NSSAI (if included)
and the Establishment cause. The Registration Request message shall include
the non-3GPP Path Switching indication, which indicate that the UE intends to
switch traffic between non-3GPP accesses.
3\. The N3IWF shall select the same AMF that TNGF selected via trusted
non-3GPP access based on the received AN parameters. The N3IWF shall then
forward the Registration Request received from the UE to the selected AMF
within an N2 message, which also contains N2 parameters that include the
Selected PLMN ID and the Establishment cause.
4\. The AMF shall send a NAS Security Mode Command to UE in order to activate
NAS security. The UE then replies the NAS Security Mode Complete message
within an EAP/5G-NAS packet as specified in step 9 in clause 4.12.2.2-1 of TS
23.502 [3].
NOTE 1: It is assumed that there is no need to perform authentication over
untrusted non-3GPP access since security context is available in the selected
AMF.
5\. The AMF shall send an NGAP Initial Context Setup Request message that
includes the N3IWF key.
6\. UE perform registration procedure via untrusted non-3GPP access as
specified in step 11 to step 13 in clause 4.12.2.2-1 of TS 23.502 [3].
7\. When the registration is completed over trusted non-3GPP access, AMF shall
update the RAT type of untrusted non-3GPP access with the UDM using
Uudm_UECM_Update service. AMF shall also initiate a deregistration timer over
the untrusted non-3GPP access. The usage of this deregistration timer is to
deregister UE over untrusted non-3GPP access without releasing UE context of
source (i.e. trusted) non-3GPP access when the deregistration timer is expired
and the UE has not completed non-3GPP path switching.
8\. UE adds user-plane resources over untrusted non-3GPP access with the same
PDU Session ID of the established MA PDU Session as specified in clause 4.22.7
of TS 23.502 [3] with following clarifications and additions:
\- AMF shall insert \"non-3GPP Path Switching indication\" in the
Nsmf_PDUSession_Update SM Context Request to indicate SMF that UE is requested
to perform path switching between non-3GPP accesses.
\- When adding user-plane resources over untrusted non-3GPP access, SMF shall
include additional indication (e.g. RAT type) in
Namf_Communication_N1N2MessageTransfer to indicate AMF that N2 SM information
included in this message should be sent over untrusted non-3GPP access.
\- The N4 rules are updated to UPF to indicate that the traffic have to be
send on the target N3GPP access.
\- The MA PDU Session Establishment Accept message received by the UE may
contain updated ATSSS rules which can be applied when there are two non-3GPP
access paths available. The updated ATSSS rules shall indicate that the
traffic shall be send on the target non-3GPP access path.
9\. If the User Plane of the MA PDU Session is activated in untrusted non-3GPP
access, the SMF releases of resources over trusted non-3GPP access as
specified in clause 4.22.10 of TS 23.502 [3] with following clarifications and
additions:
\- When releasing user-plane resources over trusted non-3GPP access, SMF shall
include additional indication (e.g. RAT Type) in
Namf_Communication_N1N2MessageTransfer to indicate AMF that N2 SM information
included in this message should be sent over trusted non-3GPP access.
After the resources over trusted non-3GPP access are completely released, the
user plane resources of single access PDU session over this access will also
be deactivated.
10\. If the deregistration timer over untrusted non-3GPP access is expired and
AMF is not informed of the completion of non-3GPP access path switching of the
UE (i.e. user plane resources over trusted non-3GPP access is released), AMF
shall perform deregistration procedure via untrusted non-3GPP access as
specified in clause 4.2.2.3.3 of TS 23.502 [3]
### 6.7.4 Impacts on Existing Nodes and Functionality
UE:
\- Performs Registration with non-3GPP Path Switching indication.
\- Temporarily maintains simultaneous parallel user plane tunnel over trusted
non-3GPP access and untrusted non-3GPP access.
\- When the UE receives the N2 resources Registration Accept message for the
target non-3GPP access, the UE shall add user plane resources over target
non-3GPP access.
AMF:
\- Initials deregistration timer over target non-3GPP access when registration
with non-3GPP Path Switching indication is completed.
\- Update the RAT type of target non-3GPP access with the UDM by using
Nudm_UECM_Update service after registration is completed.
\- Perform Deregistration when deregistration timer is expired and the AMF is
not informed of the completion of non-3GPP access path switching of the UE.
\- Insert non-3GPP Path Switching indication in the Nsmf_PDUSession_Update SM
Context Request when UE adds user-plane resources over another non-3GPP
access.
SMF:
\- Indicates to AMF which access path should the N2 SM information be sent.
\- Update N4 rules and ATSSS rules when UE requests to switch traffic between
non-3GPP accesses.
UPF:
\- Temporarily maintains simultaneous parallel user plane tunnel over trusted
non-3GPP access and untrusted non-3GPP access.
UDM:
\- Update the RAT type of target non-3GPP access by using Nudm_UECM_Update
service.
## 6.8 Solution #5.2: Delaying UDM Registration until non-3GPP access
switching completes
### 6.8.1 Introduction
This solution addresses Key Issue #5 \"Switching traffic of an MA PDU Session
between two non-3GPP access paths\" by allowing two simultaneous registrations
over two non-3GPP accesses. In this solution, in order to minimize overall
system impact, the AMF delays UDM Registration until access switching is
completed.
### 6.8.2 High-level Description
When a UE establishes MA PDU Session, the SMF may indicate to the UE whether
non-3GPP access switching is supported. Based on this indication, the UE may
determine to change non-3GPP access leg. Whether and when to switch non-3GPP
access is determined by the UE. If the UE determines to switch access, the UE
performs registration over the new non-3GPP access with new registration type
to indicate the registration is for switching non-3GPP access.
The AMF follows normal registration procedure as described in TS 23.502 [3]
but does not perform UDM registration. After the Registration procedure is
completed, the UE sends PDU Session Establishment message to add new non-3GPP
access leg to the existing MA PDU Session. After the access leg over the new
non-3GPP access is established, the UE and UPF starts sending traffic over the
new non-3GPP access leg and stops sending traffic over the old non-3GPP access
leg. The AMF triggers AN release procedure over the old non-3GPP access and
performs UDM Registration.
### 6.8.3 Procedures
This procedure assumes that the UE is registered over untrusted non-3GPP
access first and then switches trusted non-3GPP access.
Figure 6.8.2-1: Overall non-3GPP access switching procedure
1\. The UE is registered over 3GPP access and untrusted non-3GPP access and
established MA PDU Session. During the MA PDU Session Establishment, the UE
indicates whether it supports non-3GPP access switching in the PDU Session
Establishment Request message. The AMF also indicates whether it supports
non-3GPP access switching to the SMF. Considering the received capabilities of
the UE, AMF and SMF capability, the SMF indicates whether non-3GPP access
switching is supported to the UE in the PDU Session Establishment Accept
message.
2\. The UE registers over trusted non-3GPP access with new Registration type =
non-3GPP access switching. The UE includes in the List Of PDU Sessions To Be
Activated the MA PDU Sessions that user plane resources are established over
untrusted non-3GPP access.
NOTE: It is assumed that the selected TNGF supports the S-NSSAI of the
established MA PDU Session. This could be ensured by the UE or done by the
network. In case the AMF needs to redirect the UE to the other TNGF, the AMF
does not trigger non-3GPP access switching and wait until redirection
procedure is finished (e.g. may be done between step 3 and step 4 or UE may
need to trigger registration with new TNGF and then performs non-3GPP access
switching depending solutions). The details of redirection is in the scope of
5WWC_Ph2 study.
3\. The AMF may perform authentication procedure based on existing procedure.
4\. The AMF sends Initial UE Context Setup Request message to the TNGF.
5\. After the Initial UE Context Setup procedure is completed, the AMF
notifies to the SMF that the UE requested non-3GPP access switching.
6-7. The SMF establishes user plane resources over the trusted non-3GPP
access. At this point, there can be three user plane tunnels (i.e. 3GPP
access, untrusted non-3GPP access, trusted non-3GPP access) in the UE and UPF.
When the SMF establishes user plane resources over the trusted non-3GPP
access, the SMF shall set the target access type to \"trusted non-3GPP
access\" so that the AMF delivers the N2 information to the trusted non-3GPP
access.
8\. The AMF performs UDM Registration by triggering Nudm_UECM_Registration
service operation. The UDM triggers Nudm_UECM_DeregistrationNotify service
according to the existing procedure. After this point, all signalling and
Reachability procedures are performed over the trusted non-3GPP access.
9\. The AMF performs AN release procedure over the untrusted non-3GPP access.
As a result of this procedure, user plane resources over untrusted non-3GPP
access of MA PDU is completely released. When the UE and UPF recognize that
user plane resources over untrusted non-3GPP access are released, the UE and
UPF starts to send traffic over trusted non-3GPP access.
10\. The AMF sends Registration Accept message to the UE. When the UE receives
Registration Accept message, the UE considers that the UE is deregistered from
untrusted non-3GPP access and registered over trusted non-3GPP access.
6.8.4 Impacts on Existing Nodes and Functionality
UE:
\- Performs Registration with new registration type.
\- Indicates to the SMF that the UE supports non-3GPP access switching during
the MA PDU Session Establishment.
\- Temporarily maintains simultaneous parallel user plane tunnel over
untrusted 3GPP access and trusted non-3GPP access.
\- When the UE receives the Registration Accept message for the target
non-3GPP access, the UE considers that it is deregistered from the source
non-3GPP access.
AMF:
\- During the Registration procedure, delay UDM registration until non-3GPP
access switching is completed.
\- Indicates to the SMF that the AMF supports non-3GPP access switching during
the MA PDU Session Establishment.
\- Notifies to the SMF that the UE requested non-3GPP access switching during
the Registration procedure.
\- Performs AN release over old access during the Registration procedure
SMF:
\- Indicates to the UE whether the MA PDU Session supports non-3GPP access
switching during the MA PDU Session Establishment.
UPF:
\- Temporarily maintains simultaneous parallel user plane tunnel over
untrusted 3GPP access and trusted non-3GPP access.
## 6.9 Solution #5.3: Path switching between non-3GPP accesses
### 6.9.1 Introduction
The solution in clause 6.9 addresses the objective of KI#5, i.e. it specifies
how the data traffic of an MA PDU Session to be switched between two non-3GPP
access paths, both of them using the same PLMN.
### 6.9.2 High-level Description
This solution uses the following principles to switch the data traffic of an
MA PDU Session between two Non-3GPP access paths:
a. UE uses existing procedures to register to 5GC via a Non-3GPP access
network (e.g. an untrusted Non-3GPP access network). Optionally, the UE may
also register to 5GC via a 3GPP access network (e.g. via NG-RAN).
b. MA PDU Session is established using the existing procedures specified in
clause 4.22.2 of TS 23.502 [3] and data traffic is transferred over the paths
of the MA PDU Session.
c. UE discovers a new Non-3GPP access network (e.g. a trusted Non-3GPP access
networks) and registers to 5GC via this access network by indicating
\"Non-3GPP path switch\". This allows the AMF to maintain temporarily two
registrations via two non-3GPP accesses until the path switch is completed.
d. UE initiates the path switch by sending, via the new Non-3GPP access
network, an MA PDU Session Establishment Request (using the same PDU session
ID), which triggers the SMF to establish user-plane resources for the MA PDU
Session over the new Non-3GPP access network.
e. When the user-plane resources for the MA PDU Session over the new Non-3GPP
access network are established, the SMF triggers the AMF to deregister the UE
from the old Non-3GPP access network (e.g. the untrusted Non-3GPP access
network).
f. The UE can trigger the path switching procedure based on internal
implementation Alternatively, the UE can decide to switch data traffic based
on URSP policies (if available) received from the PCF indicating the priority
of a non-3GPP access (priority of the trusted and untrusted non-3GPP accesses)
which are part of a MA PDU session.
### 6.9.3 Procedures
Figure 6.9.3-1 below depicts the key steps of the solution, which enables the
data traffic of an MA PDU Session to be switched from a non-3GPP access path
using a N3IWF to a non-3GPP access path using a TNGF. The same steps can be
used to switch the data traffic of an MA PDU Session between any non-3GPP
access paths (using either N3IWF or TNGF).
Figure 6.9.3-1: Procedure for enabling data traffic switching between two
non-3GPP access paths
1\. [Optionally] the UE performs an initial 5G registration over 3GPP access
in a PLMN. The selected AMF registers with UDM for 3GPP access and provides
its GUAMI and RAT type = NR.
2\. The UE selects an N3IWF and performs an initial 5G registration over
untrusted non-3GPP access in the same PLMN using step 1 to step 13 in clause
4.22.9 of TS 23.502 [3] and with the following differences and clarifications:
i) The UE indicates its support for \"Non-3GPP path switch\":
\- \"Non-3GPP path switch\" indication indicates that this UE is capable of
switching traffic of an MA PDU Session between two non-3GPP access paths.
ii) The same AMF is selected, as the one in the previous step.
iii) The AMF indicates to the UE its support for \"Non-3GPP path switch\".
iv) The AMF registers with UDM for non-3GPP access and provides its GUAMI and
RAT type = Virtual or WLAN.
NOTE: The above procedure may be performed at any time the UE initiates a
registration request (i.e. to any AN).
3\. The UE requests an MA PDU Session, as specified in clause 4.22.2 of TS
23.502 [3]. User-plane resource are established over 3GPP access and over
untrusted non-3GPP access. Data traffic over the MA PDU Session is exchanged
between the UE and UPF using the two accesses.
4\. The UE detects a trusted non-3GPP access network that supports 5G
connectivity to the same PLMN. The UE decides to switch the data traffic
transferred over the untrusted non-3GPP access of the MA PDU Session to the
detected trusted non-3GPP access network as described in clause 6.9.2f. For
this purpose, the UE initiates a 5G registration over trusted non-3GPP access
using step 1 to step 15 in clause 4.12a.2.2 of TS 23.502 [3] with the
following differences and clarifications:
i) Indicates \"Non-3GPP path switch\".
\- This indication indicates that the registration over trusted non-3GPP
access is required for switching the data traffic of an MA PDU Session from
one non-3GPP access path to another non-3GPP access path.
ii) After the UE is registered via trusted non-3GPP access with the indication
\"Non-3GPP patch switch\", the AMF does not release the existing registration
via untrusted non-3GPP access.
iii) A timer value indicating how long the network will maintain two
registrations via non-3GPP access is configured in the AMF. The AMF shall
start a timer and maintain the two registrations via non-3GPP access until the
path switch is completed or until this timer is equal to the configured timer
value:
\- As shown below (see step 9), when the timer expires, the AMF initiates
deregistration via the TNGF.
5\. The UE initiates the non-3GPP path switch by requesting user-plane
resources via trusted non-3GPP access. To request these user-plane resources:
i) The UE sends a PDU Session Establishment Request via the TNGF, which
contains request type = MA PDU Request and the identity of the existing MA PDU
Session.
ii) The AMF sends an Update SM Context Request to SMF, which contains a
\"Non-3GPP path switch indication\":
\- This indication informs the SMF that the PDU Session Establishment Request
is sent to enable path switching from the existing non-3GPP access of the MA
PDU Session to a new non-3GPP access.
iii) The AMF inserts the \"Non-3GPP path switch indication\" in the Update SM
Context Request because the UE is registered with type \"Non-3GPP path
switch\" (see step 4).
iv) The SMF initiates the user-plane resources establishment over trusted
non-3GPP access.
6\. After user-plane resources over trusted non-3GPP access are established,
the UE switches all uplink MA PDU Session traffic from untrusted non-3GPP
access to trusted non-3GPP access. Similarly, the UPF switches all downlink MA
PDU Session traffic from untrusted non-3GPP access to trusted non-3GPP access
(for this the SMF modifies the existing N4 connection).
7\. The SMF sends an SM Context Status Notify message to AMF to indicate that
the non-3GPP path switch has been completed.
8\. After receiving the SM Context Status Notify message, the AMF updates the
UDM with RAT type = Trusted_WLAN for non-3GPP access. The AMF initiates
deregistration procedure for untrusted Non-3GPP access (see clause 4.12.3 of
TS 23.502 [3]). Also, the AMF stops the timer that was started in step 4.
After this step, the UE has only one 5G registration via non-3GPP access.
9\. [Conditional] If AMF timer started in step 4 expires, the AMF deregisters
the UE via trusted non-3GPP access. After this step, the UE has only one 5G
registration via non-3GPP access.
### 6.9.4 Impacts on Existing Nodes and Functionality
UE:
\- Indicates to the AMF that the UE supports non-3GPP access switching during
the Registration Request message.
\- Trigger the switching from one N3GPP path to another N3GPP path is based on
UE implementation.
\- Use a new indication when performing the switching during the registration
procedure via the other Non-3GPP path.
AMF:
\- Indicate to SMF that Non-3GPP path switching is required for the MA PDU
session.
\- A configured timer value indicating how long the network will maintain two
registrations via non-3GPP accesses.
\- Configured timer value used to trigger a de-registration if a non-3GPP
access path switch has not completed within the allotted provisioned time.
SMF/UPF:
\- Perform the traffic switching from untrusted N3GPP access to trusted N3GPP
access or vice versa.
UDM:
\- UDM is only expected to be updated with the new RAT type information (e.g.
from Virtual/WLAN to Trusted_WLAN) after the path switching has been performed
successfully.
## 6.10 Solution #5.4: Non-3GPP access path switching in MA PDU Session
### 6.10.1 Introduction
This solution addresses KI#5 on switching traffic of an MA PDU Session between
two non-3GPP access paths.
### 6.10.2 High-level Description
In this solution, it is assumed that the UE is able to register to 5GC over
two non-3GPP access paths for the duration of switching the non-3gpp access
path of an established MA PDU Session, and the duration is decided by the
network. Each non-3GPP access path is identified by the RAT Type of the
non-3GPP access network (e.g. one non-3GPP access path is using an N3IWF, and
the other non-3GPP access path is using an TNGF).
It is assumed that the Non-3GPP access path switching feature is supported
only for the MA PDU Session, therefore any UE which does not have ATSSS
Capability cannot request to the network of two Non-3GPP access registrations
for purpose of Non-3GPP access path switching of an MA PDU Session.
The key points of the solution are as follows:
\- The UE triggers the non-3GPP access path switching of the established MA
PDU Session. The AMF detects this by presence of ATSSS path switching
indication, and List of PDU Sessions To Be Activated included in the
Registration request.
\- The AMF determines the RAT Type of the target non-3GPP access path which
the Registration request is sent, and the RAT Type of the source non-3GPP
access path which the UE is already registered over non-3GPP access. The AMF
provides both source RAT Type and target RAT Type to the SMF, and requests to
SMF the Access Path Switching Lifetime Value. The Access Path Switching
Lifetime Value is used to decide the duration of switching. The AMF decides
the value of Access Path Switching Timer based on its local configuration and
the value received from the SMF, and provides to the UE.
\- The UE requests MA PDU Session Establishment via target non-3GPP access
network before the Access Path Switching Timer is expired. The AMF determines
whether this request is for the second non-3GPP access path, and requests to
the SMF to allocate N3 CN Tunnel Info for Target Access Network. The SMF
distinguishes two non-3GPP access paths by Target RAT Type and Source RAT Type
provided by the AMF.
\- The target non-3GPP access network also allocates the N3 AN Tunnel Info. If
the AMF receives the successful result in N2 Session Response and the SMF
receives the AN Tunnel Info of target non-3GPP access network, the access
traffic switching is possible, and the traffic is transmitted via the target
non-3GPP access network.
\- The SMF initiates the MA PDU Session release over the source non-3GPP
access. Any corresponding SM Context and UE Context is removed from the
network. UP resources via source non-3GPP access are released.
\- The AMF initiates the Deregistration of the UE over the source non-3GPP
access.
### 6.10.3 MA PDU Session Access Path Switching procedure
Figure 6.10.3-1: Non-3GPP access path switching procedure for an MA PDU
Session
The above Figure 6.10.3-1 shows how the non-3GPP access path of an MA PDU
Session is switched to another Non-3GPP access path.
0\. The UE is registered over untrusted non-3GPP access and established MA PDU
Session. The UE may be registered over 3GPP access. During registration
procedure over non-3GPP access, the UE includes its capability of non-3GPP
path switching in the Registration Request message and the AMF informs to UE
whether the network supports non-3GPP access path switching for MA PDU
Session.
1\. The UE determines that the existing non-3GPP access path of the MA PDU
Session needs to be changed to trusted non-3GPP access.
2\. In the Registration Request message, the UE includes ATSSS path switching
indication and List Of PDU Sessions To Be Activated. ATSSS path switching
indication indicates that this request is for the registration for the second
non-3GPP access path via target non-3GPP access network (the trusted non-3GPP
access in this case). List Of PDU Sessions To Be Activated includes the PDU
Session ID of the MA PDU Session.
The same AMF is selected using GUAMI provided by the UE. If the AMF supports
non-3GPP access path switching for MA PDU Session, the AMF determines whether
this request is for registration over the second non-3GPP access path of the
established MA PDU Session. AMF determines RAT Type of trusted non-3GPP access
(as defined in clause 5.3.2.3 of TS 23.501 [2]), and checks if it is different
with that of the existing non-3GPP access path of the MA PDU Session.
3 The AMF invokes the Nsmf_PDUSession_UpdateSMContext Request which includes
the ATSSS path switching indication, PDU Session ID of the MA PDU Session,
Target RAT Type (e.g. trusted W-LAN), and Source RAT Type (e.g. untrusted
non-3GPP).
4\. The SMF sends the Nsmf_PDUSession_UpdateSMContext Response which includes
Access Path Switching Lifetime Value. The Access Path Switching Lifetime Value
indicates how long the SMF will accept the MA PDU Session Establishment
request over the second non-3GPP access path. The SMF starts a timer
corresponding to the Access Path Switching Lifetime Value, and if the SMF does
not receive any successful Nsmf_PDUSession_UpdateSMContext Request including
AN Tunnel Info over the target non-3GPP access before expiry of this timer,
the SMF maintains the source non-3GPP access path.
5\. The AMF sends Registration Accept which includes Access Path Switching
Timer. The AMF starts De-registration timer corresponding to the Access Path
Switching Timer. The AMF can decide Access Path Switching Timer as longer
value than Access Path Switching Lifetime Value received from the SMF in step
5, to avoid triggering the de-registration before the MA PDU Session
Establishment over the second non-3GPP access path is finished.
6\. The UE requests MA PDU Session Establishment over the trusted non-3GPP
access before the expiry of the Access Path Switching Timer received in step
6.
7\. The AMF invokes the Nsmf_PDUSessin_CreateSMContext Request which includes
ATSSS path switching indication, PDU Session ID of the MA PDU Session, Target
RAT Type, and Source RAT Type. The SMF detects that this MA PDU Session
request is related to the request of step 4. AMF updates its registration to
UDM with Target RAT Type (e.g. untrusted non-3GPP) by invoking
Nudm_UECM_Registration service operation.
8\. The CN Tunnel Info for trusted non-3GPP access is allocated.
9\. The SMF sends Namf_Communication_N1N2MessageTransfer which includes CN
Tunnel Info for trusted non-3GPP access in N2 SM information.
10\. The AMF sends N2 Session Request to the TNGF.
11\. The TNGF issues AN specific resource setup with the UE, and the the AN
Tunnel Info for the trusted non-3GPP access is allocated. The UE switches all
uplink traffic from untrusted non-3GPP access to trusted non-3GPP access.
12\. The Target Access Network sends N2 Session Response which includes the AN
Tunnel Info corresponds to the TNGF address of the N3 tunnel for the MA PDU
Session.
13\. The AMF sends the N2 SM information received from TNGF and the RAT Type
of trusted non-3GPP access to the SMF
14\. The SMF initiates an N4 Session modification procedure with the UPF. The
SMF provides the AN Tunnel Info to the UPF. The UPF provides an N4 Session
Modification Response to the SMF. After this step, there can be three user
plane tunnels (i.e. 3GPP access, untrusted non-3GPP access, and trusted
non-3GPP access) in the UE and the UPF. The UPF switches all downlink traffic
from untrusted non-3GPP access to trusted non-3GPP access.
15\. The SMF initiates the MA PDU Session release over untrusted non-3GPP
access. Any corresponding SM Context and UE Context is removed from the
network. UP resources over untrusted non-3GPP access is deactivated.
16\. The AMF initiates the Deregistration of the UE over untrusted non-3GPP
access.
### 6.10.4 Impacts on Existing Nodes and Functionality
UE:
\- Triggers the non-3GPP access path switching of MA PDU Session.
\- Indicates UE\'s capability of non-3GPP access path switching in
Registration request during non-3GPP access registration procedure.
\- Indicates in Registration request that this request is for the registration
for the second non-3GPP access path by using ATSSS path switching indication
and the List Of PDU Session To Be Activated.
AMF:
\- Informs to UE whether the network supports non-3GPP access path switching
for MA PDU Session during registration procedure over non-3GPP access.
\- Determines whether the Registration request from the UE is for registration
over the second non-3GPP access path of the established MA PDU Session by
using ATSSS path switching indication and the List Of PDU Session To Be
Activated.
\- Provides to SMF the RAT Type of the target non-3GPP access and the RAT Type
of the source non-3GPP access.
\- Decides the Access Path Switching Timer and provides to the UE to inform
the duration of non-3GPP access path switching.
\- Updates the UDM registration for the target non-3GPP access after user-
plane resources of the target non-3GPP access are established.
UDM:
\- Updates RAT Type for AMF registration with the RAT type of target non-3GPP
access after user-plane resources of the target non-3GPP access are
established.
SMF:
\- Decides the Access Path Switching Lifetime Value and provides to the AMF to
assist the AMF to finally decide the value of Access Path Switching Timer for
the UE.
UPF:
\- Allocates the N3 CN Tunnel Info for the second non-3GPP access path.
## 6.11 Solution #2.2: MPQUIC steering functionality using UDP proxying over
HTTP
### 6.11.1 Introduction
The solution in clause 6.11 specifies a new ATSSS steering functionality,
called Multipath QUIC (MPQUIC) steering functionality, and addresses the
objective of KI#2 for a QUIC-based steering functionality. It borrows several
aspects from solutions studied in TR 23.700-93 [5], mainly from Solution #6
\"MPQUIC-LL Steering Functionality\" and from Solution #14 \"Proxy based
solution using MP-QUIC\".
The solution is primarily based on RFC 9298 \"proxying UDP in HTTP\" [27],
which specifies how UDP traffic can be transferred between a client (UE) and a
proxy (UPF) using the HTTP/3 protocol [28]. The HTTP/3 protocol operates on
top of the QUIC protocol [6], which supports simultaneous communication over
multiple paths, as defined in draft-ietf-quic-multipath [10].
The solution supports the following transport modes for transmitting a UDP
flow between UE and UPF (see further details in clause 6.11.3, step 5):
\- Datagram mode 2: This transport mode is the mode already supported in RFC
9298 [27]. It encapsulates UDP packets within QUIC Datagram frames and
provides unreliable transport with no sequence numbering and no packet
reordering / deduplication. It can be applied for UDP flows where the
application is robust against out-of-order delivery and jitter (e.g. because
it can perform itself appropriate packet reordering / deduplication).
\- Datagram mode 1: This transport mode is an extension of the mode supported
in RFC 9298 [27]. It encapsulates UDP packets within QUIC Datagram frames and
provides unreliable transport but with sequence numbering and with packet
reordering / deduplication. It can be applied for any UDP flows, e.g. for
applications that perform re-transmissions. The datagram mode 1 requires the
definition of a new Context ID (see RFC 9298), which can be done in stage-3.
Also, additional details (e.g. the algorithms for packet re-ordering) may also
be considered in stage-3.
\- Stream mode: This transport mode is readily supported by the QUIC protocol.
It encapsulates UDP packets within QUIC Stream frames and provides reliable
transport with sequence numbering and with packet reordering / deduplication.
It can be applied for UDP flows where it is known that the application does
not perform retransmissions.
The PCF selects which of the above transport modes shall be applied for a UDP
flow (SDF). The selected transport mode is provided to UE and UPF within the
ATSSS rules and N4/MAR rules respectively.
NOTE 1: When the Datagram mode 2 is used with steering modes that use both
accesses simultaneously, e.g. the Load-Balancing steering mode, traffic
scheduling with per-packet splitting can result to excessive out-of-order
delivery.
NOTE 2: The Stream mode provides strict reliability and in-order delivery with
re-transmissions and therefore can lead to melt down phenomena [see
http://sites.inka.de/\~W1011/devel/tcp-tcp.html] when reliable traffic (e.g.
QUIC) is carried, or counteracts application decisions when UDP is selected to
avoid reliability and/or in-order delivery. Therefore, it can be avoided for
applications which perform their own reliability mechanisms.
The Datagram mode 1 and the Stream mode can be used for supporting per-packet
splitting, i.e. when the packets of a UDP flow are split across multiple
accesses and may be received out-of-order. The Datagram mode 2 is a transport
mode which can be applied for applications that can tolerate packet reordering
or duplicated packets. The Datagram mode 2 is required (although it does not
support re-ordering) because the MPQUIC steering functionality (as any other
ATSSS steering functionality) must support all steering modes and not only
steering modes that require packet reordering / deduplication. The Datagram
mode 2 features benefits compared to ATSSS-LL as it supports congestion
control, RTT/PLR measurements without the need to implement the PMF protocol,
and it is implemented in high-layers so it can interact with applications.
However, it also adds additional overhead and encryption.
### 6.11.2 High-level Description
The key principles of the solution are summarized below.
\- After the MA PDU Session establishment, the UE creates one or more
multipath QUIC connections with the UPF. Each multipath QUIC connection is
associated with a QoS flow, i.e. it carries the traffic mapped to a QoS flow.
\- The UE operates as a connect-udp client and the UPF operates as a connect-
udp proxy, both defined in RFC 9298 [27]. Therefore, the UE supports an HTTP/3
client and the UPF supports an HTTP/3 proxy, both of them operating over QUIC.
\- When the UE wants to transmit the first uplink packet of a new UDP flow,
the UE:
\- Selects which QUIC connection will be used for the uplink traffic of the
UDP flow based on the QoS flow associated with the UDP flow;
\- Creates a new bidirectional QUIC stream on the selected QUIC connection;
\- Configures the QUIC stream to apply a steering mode (i.e. the steering mode
that should be used for the uplink traffic of the UDP flow based on the ATSSS
rules);
\- Sends to UPF, via the QUIC stream, an extended HTTP CONNECT request [27]
containing \'path\' information that identifies a destination address and port
for the UDP flow (i.e. identifies the remote host where the UDP flow should be
forwarded to); and
\- Forwards to UPF the uplink packets of the UDP flow using multipath QUIC
transport.
\- When the UPF wants to transmit a downlink packet of a UDP flow, the UPF:
\- Selects which QUIC connection will be used for the downlink traffic of the
UDP flow based on the QoS flow associated with the UDP flow (this QUIC
connection is the same as the one selected by UE for the UDP flow, assuming
the QoS flow in UL and DL directions is the same);
\- Selects a bidirectional QUIC stream on the selected QUIC connection (this
QUIC stream is the same as the one created by the UE for the UDP flow);
\- Configures the QUIC stream to apply a steering mode (i.e. the steering mode
that should be used for the downlink traffic of the UDP flow based on the N4
rules); and
\- Forwards to UE the downlink packets of the UDP flow using multipath QUIC
transport.
The following figure illustrates how the traffic of a UDP flow is transferred
between the UE and UPF using multipath QUIC transport. In this figure, it is
assumed that the uplink traffic and the downlink traffic of the UDP flow are
mapped to the same QoS flow (QFI-1). Therefore, both the uplink traffic and
the downlink traffic of the UDP flow use the same multipath QUIC connection.
Figure 6.11.2-1: Using multipath QUIC transport for a UDP flow
The bidirectional QUIC stream is established by the UE to enable transmission
of uplink data packets (blue) and downlink data packets (red) of the UDP flow.
The UE configures this stream to send uplink traffic with a steering mode
determined based on the ATSSS rules in the UE (uplink steering mode). The UPF
configures this stream to send downlink traffic with a steering mode
determined based on the N4 rules in the UPF (downlink steering mode). The data
packets of the UDP flow shown in Figure 6.11.2-1 are transmitted in datagram
mode (mode 1 or mode 2), i.e. they are encapsulated in HTTP datagrams and in
QUIC DATAGRAM frames, each one carrying header information (see the Quarter
Stream ID defined in RFC 9297 [29]) that associates it with the established
bidirectional stream. As discussed below, the data packets of the UDP flow may
be transmitted in stream mode (instead of datagram mode), i.e. transmitted
directly over the bidirectional stream. In this case, the data packets of the
UDP flow are encapsulated in DATAGRAM capsules (see [29]) and in QUIC STREAM
frames.
Figure 6.11.2-2 and Figure 6.11.2-3 illustrate the components of the MPQUIC
steering functionality used to support data transmission in the uplink and
downlink direction respectively. The MPQUIC steering functionality is composed
of three components:
1) QoS flow selection & Steering mode selection: This component in the UE
initiates the establishment of one or more QUIC connections, after the
establishment of the MA PDU Session and, for each uplink UDP flow, it selects
a QoS flow (based on the QoS rules), and a steering mode and a transport mode
(based on the ATSSS rules). This component in the UPF selects, for each
downlink UDP flow, a QoS flow (based on the N4 rules), a steering mode and a
transport mode (based on the N4 rules).
In the UE, this component is only used in the uplink direction, while, in the
UPF, this component is only used in the downlink direction.
2) HTTP/3 layer: Supports the HTTP/3 protocol defined in RFC 9114 [28] and the
extensions defined in:
\- RFC 9298 [27] for supporting UDP proxying over HTTP;
\- RFC 9297 [29] for supporting HTTP datagrams; and
\- RFC 9220 [30] for supporting Extended CONNECT.
The HTTP/3 layer selects a QUIC connection to be used for each UDP flow and
allocates a new QUIC stream on this connection that is associated with the UDP
flow. It also configures this QUIC stream to apply a specific steering mode.
In the UE, the HTTP/3 layer implements an HTTP/3 client, while, in the UPF, it
implements an HTTP/3 proxy.
3) QUIC layer: Supports the QUIC protocol as defined in the applicable IETF
specifications (RFC 9000 [6], RFC 9001 [7], RFC 9002 [8]) and the extensions
defined in:
\- RFC 9221 [9] for supporting unreliable datagram transport with QUIC; and
\- draft-ietf-quic-multipath [10] for supporting QUIC connections using
multiple paths simultaneously.
Figure 6.11.2-2: Components of MPQUIC steering functionality used for UL data
transmission
Figure 6.11.2-3: Components of MPQUIC steering functionality used for DL data
transmission
The protocol stack of the solution is depicted in Figure 6.11.2-4 below.
Figure 6.11.2-4: UP protocol stack of the solution
### 6.11.3 Procedures
Figure 6.11.3-1 below depicts the key steps of the procedure that enables data
traffic to be exchanged between the UE and UPF using the MPQUIC steering
functionality. For simplicity, the components of the MPQUIC steering
functionality at the UPF are not depicted.
Figure 6.11.3-1: Procedure for enabling data traffic using the MPQUIC steering
functionality
1\. The UE establishes a MA PDU Session with the 5G core (5GC) network. During
the MA PDU Session establishment:
\- In the PDU Establishment Request message, the UE indicates that it supports
the MPQUIC steering functionality. This indication can be used by the network
(a) to select a UPF that supports the MPQUIC steering functionality and (b) to
decide whether the ATSSS/N4 rules for the MA PDU Session may use the MPQUIC
steering functionality.
\- The UE receives MPQUIC proxy information, i.e. one IP address of UPF, one
UDP port number and the proxy type (e.g. \"connect-udp\"). This information is
used by the UE for establishing QUIC connections with the UPF, which is also
referred to as \"MPQUIC proxy\".
\- The UE receives one IP address/prefix for the MA PDU Session and two
additional IP addresses/prefixes, called \"link-specific multipath QUIC\"
addresses; one associated with 3GPP access and another associated with
non-3GPP access. These two addresses can be used by the UE to create two paths
in a multipath QUIC connection.
\- The UE receives QoS rules and ATSSS rules to be applied for the MA PDU
Session, for QoS enforcement and traffic steering enforcement respectively.
Similar rules (N4 rules) are received by UPF.
2\. After the MA PDU Session is established and the UE identifies that one or
more ATSSS rules require traffic steering using the MPQUIC steering
functionality, the UE determines the number of multipath QUIC connections to
be established with the UPF (MPQUIC proxy). For example, the UE determines to
establish as many multipath QUIC connections, as the number of QoS flows of
the MA PDU Session, i.e. one multipath QUIC connection per QoS flow. This way,
every QUIC packet can carry only traffic (e.g. one or more UDP payloads) that
belongs to the same QoS flow, which facilitates QoS handling in the access
layer.
The QoS rules provided to UE include downlink QoS information and the UE
applies the downlink QoS information to establish QUIC connections for the QoS
flows used for downlink traffic only.
3\. The UE establishes the number of multipath QUIC connection with the UPF
(MPQUIC proxy) determined in the previous step. This results into several
multipath QUIC connections between the UE and UPF, each one composed of
multiple paths, e.g. one path over 3GPP access and another path over non-3GPP
access.
NOTE 1: Data transmitted over a multipath QUIC connection must be encrypted
according to RFC 9001 [7]. However, encryption might not be necessary when the
multipath QUIC connection is established between UE and UPF, because the
underlying 5G security mechanisms can be applied.
Editor\'s note: Whether and how encryption in the QUIC layer can be omitted is
FFS and need to be studied by SA WG3. It could be studied, for example,
whether RFC 9150 \"TLS 1.3 Authentication and Integrity-Only Cipher Suites\"
can be applied to omit the data encryption. The impact due to encryption
regarding overhead and performance is FFS in SA WG3.
During a QUIC connection establishment, the UE and UPF negotiate QUIC
transport parameters and indicate (a) support of QUIC Datagram frames and (b)
support of multipath. They indicate support of QUIC Datagram frames by
providing the \"max_datagram_frame_size\" transport parameter with a non-zero
value (see RFC 9221 [9]) and they indicate support of multipath by providing
the \"enable_multipath\" transport parameter (see draft-ietf-quic-multipath
[10]).
After a QUIC connection establishment, the HTTP/3 client and the HTTP/3 proxy
negotiate HTTP settings and indicate support of HTTP Datagrams (see RFC 9297
[29]) and support of Extended CONNECT (see RFC 9220 [30]).
The QoS flow associated with a QUIC connection is also negotiated between the
UE and UPF. This is done by using a new QUIC transport parameter (defined by
3GPP) when the QUIC connection is established.
NOTE 2: The new QUIC transport parameter needs to be registered in IANA (by
stage 3).
4\. An app in the UE generates a new data packet (also referred to as \"UDP
payload\") that should be sent via the MA PDU Session. This data packet
initiates a new UDP flow, i.e. a sequence of data packets using the same
5-tuple. In the example shown in Figure 6.11.3-1, the data packet should be
sent to IP address 144.23.1.47 and to UDP port 556.
5\. For the new UDP flow (and for each new UDP flow):
\- The UE selects a QoS flow (QFI) over which the UDP flow should be
transmitted. This is selected by using the received QoS rules.
\- The UE selects a steering mode that should be applied for the UDP flow.
This is selected by using the received ATSSS rules.
\- The UE selects a transport mode that should be applied for the UDP flow.
This is selected by using the received ATSSS rules, i.e. each ATSSS rule which
indicates that the MPQUIC steering functionality should be applied for the
matching traffic, indicates also the transport mode that should be applied for
this traffic.
As specified in clause 6.11.1, three transport modes are supported (Datagram
mode 1, Datagram mode 2 and Stream mode) and the transport mode that should be
applied for a UDP flow is selected by PCF and is provided to UE and UPF within
the ATSSS rules and the N4/MAR rules respectively.
\- The Datagram mode 2 is already specified in RFC 9298 [27] and does not
require further specification in 3GPP. In this mode, the HTTP/3 proxy/client
encapsulates each UDP data within an HTTP Datagram that contains a Context
Id=0. Then, the HTTP Datagram is sent to the QUIC layer for multipath
transmission. No sequence numbers are included in the HTTP Datagrams (see
[27]).
\- The Datagram mode 1 is similar to the Datagram mode 2 but it also provides
a sequence number for each UDP data. In this mode, the HTTP/3 proxy/client
encapsulates each UDP data within an HTTP Datagram that contains a Context Id
and a sequence number. Then, the HTTP Datagram is sent to the QUIC layer for
multipath transmission. The value of this Context Id will be defined in
stage-3 and indicates that a sequence number is also included. The sequence
numbers are used by the receiving endpoint to re-order the UDP data and remove
duplicated UDP data. Details of how packet reordering is supported (including
the mechanisms for reordering) can be specified in stage-3.
The Datagram mode 1 and Datagram mode 2 use two different (and pre-defined in
3GPP) Context IDs, e.g. Context ID=0 and Context ID=1, respectively. With
Context ID=0, the HTTP Datagram Payload contains the UDP data, whereas, with
Context ID=1, the HTTP Datagram Payload contains a sequence number followed by
the UDP data. The format of QUIC DATAGRAMs used in both datagram modes is
shown below. As specified in clause 6.11.6, the Datagram mode 1 supports
reordering in the HTTP/3 layer (as described above).
The following table shows how UDP data is encapsulated in a QUIC datagram
using the Datagram mode 1 and the Datagram mode 2. It is assumed that the
value of Context Id used in Datagram mode 1 is set to 1.
Datagram mode 1
* * *
Datagram mode 2
6\. The UE selects a multipath QUIC connection to be used for the new UDP flow
(e.g. based on the selected QFI) and the UE allocates a new bidirectional QUIC
stream (e.g. stream 40) in this multipath QUIC connection. This new stream is
associated with the new UDP flow. The UE configures the new stream to transmit
uplink data traffic using the selected steering mode for this UDP flow.
7-9. The UE sends the data packet using the allocated new stream on the
selected QUIC connection.
When the datagram transport mode is selected (either mode 1 or mode 2), the UE
encapsulates the data packet within an HTTP DATAGRAM frame [27], which is
transferred inside a QUIC DATAGRAM frame [9]. The header of the HTTP DATAGRAM
indicates that this datagram is associated with stream 40 (i.e. the Quarter
Stream ID is set to 10).
When the stream transport mode is selected, the UE encapsulates the data
packet within an HTTP DATAGRAM frame [29] that is further encapsulated in a
DATAGRAM capsule (see clause 3.5 in [29]), which is transferred inside a QUIC
STREAM frame [6].
In the example procedure shown in Figure 6.11.3-1, the datagram transport mode
(either mode 1 or mode 2) is selected. The UE sends an HTTP CONNECT request
via the allocated stream 40, which indicates to UPF (MPQUIC proxy) that the UE
wishes to create an HTTP tunnel to send UDP traffic to remote host 144.23.1.47
and port 556. The :protocol pseudo-header is set to \"connect-udp\" (as
defined in [27]) to indicate that the protocol to be spoken on the tunnel is
the capsule protocol defined in RFC 9297 [29]. Finally, the UE sends a QUIC
DATAGRAM frame to UPF that encapsulates the data packet, which is forwarded to
the remote host (144.23.1.47:556). Note that the QUIC DATAGRAM frame may
contain a sequence number (as defined in step 5).
If the stream transport mode were selected, the HTTP DATA frame in step 8
would contain a DATAGRAM capsule, which would include the data packet in the
HTTP Datagram Payload field (see [29]).
10\. The UPF (MPQUIC proxy) responds with an HTTP 200 status, indicating that
the request to proxy data packets to a remote host 144.23.1.47 and destination
port 556 is accepted.
11\. When a data packet is received by UPF (MPQUIC proxy) from the remote host
(data packet #2), this data packet is transferred to the UE using the
established context information for the UDP flow, i.e. using the selected
multipath QUIC connection, the selected stream on this connection, the
selected steering mode, and the selected transport mode. Such context
information is stored in the UPF and in the UE and is applied for all the data
packets of the UDP flow.
12\. Similarly, when another data packet is generated by the UE app (data
packet #3), this data packet is transferred to UPF (MPQUIC proxy) using again
all the stored context information for the UDP flow.
NOTE 2: The context information for a UDP flow in the UE and in the UPF is
created when the first data packet (i.e. Data packet #1) of this UDP flow is
transferred. All subsequent data packets of the same UDP flow are transferred
between the UE and the UPF using this context information.
When the UE identifies that the context information for a UDP flow is no
longer needed (e.g. the app closes the associated UDP socket), the UE deletes
this context information and releases the associated QUIC stream, which cause
the UPF to delete the context information stored in UPF.
The following figure 6.11.3-2 illustrates an example of how the uplink traffic
of various UDP flows is transferred from the UE to UPF using QUIC multipath
transport, and how the UPF relays this traffic to a final destination (remote
host). Note that, for each UDP flow, there is an associated QUIC connection
and an associated bidirectional QUIC stream, which is configured to apply a
specific steering mode for the uplink traffic. For example, the red UDP flow
is associated with the multipath QUIC connection #1 and with the red Stream Y,
which is configured to apply the Smallest-delay steering mode in the uplink
direction.
All UDP flows shown in this figure, except the blue UDP flow, are transferred
with the datagram transport mode (mode 1 or mode 2), so their data packets are
transferred inside QUIC DATAGRAM frames. The blue UDP flow is transferred with
the stream transport mode, so its data packets are transferred inside QUIC
STREAM frames.
The downlink traffic of UDP flows is transferred between the UE and UPF in a
similar way.
Figure 6.11.3-2: Example of user-plane operation using the MPQUIC steering
functionality (UL direction)
### 6.11.4 User-plane overhead
As shown in the figure 6.11.3-2 above and in the table below, the user-plane
overhead of the MPQUIC steering functionality is given by the applied (a)
proxying mechanism (instead of IP-in-IP tunneling), (b) the HTTP/3
encapsulation and (c) the QUIC protocol which can multiplex payload packets
into a single QUIC packet as explained later in this clause. This proxying
mechanism \"allows an HTTP client to create a tunnel for UDP communications
through an HTTP server that acts as a proxy\" (see RFC 9298 [27]).
The table below provides an estimate of the size of the additional headers for
the various transport modes. Note that the exact estimation of the size of the
additional headers depends on the QUIC implementation (e.g. how the
implementation selects the size of the stream identity) and it is difficult to
be calculated. Therefore, the table below provides approximate numbers based
on some assumptions.
Table 6.11.4-1
+-----------------+---------------------------------------------------+ | Transport mode | Size of additional headers [bytes] | +=================+===================================================+ | Datagram mode 1 | Size of additional headers = IP header (20) + UDP | | | header (8) + QUIC short header (5) + QUIC | | | Datagram header (6) = 39 bytes | | | | | | The QUIC short header size depends on the length | | | of the Destination Connection ID (0-160 bits) and | | | the length of the Packet Number (8-32 bits). It | | | is assumed that 16 bits are enough for each | | | field. | | | | | | The QUIC Datagram header contains: | | | | | | Type: 1 byte | | | | | | Length: Variable-length integer specifying the | | | length of the Datagram Data field in bytes. It is | | | assumed 2 bytes are enough. | | | | | | Quarter Stream Id: Variable-length integer. It is | | | assumed that 2 bytes are enough to support 65536 | | | active streams on an MPQUIC connection. | | | | | | Context Id: 1 byte | | | | | | Sequence number: 2 bytes (assumed to be enough) | +-----------------+---------------------------------------------------+ | Datagram mode 2 | The same as Datagram mode 1 but without the | | | sequence number (i.e. minus 2 bytes). | +-----------------+---------------------------------------------------+ | Stream mode | Size of additional headers = IP header (20) + UDP | | | header (8) + QUIC short header (5) + QUIC Stream | | | header (3) + Datagram Capsule (5) = 41 bytes | | | | | | The QUIC Stream header contains: | | | | | | Type: 1 byte | | | | | | Stream Id: Assume 2 bytes are enough to contain | | | all stream ids in each MPQUIC connection | | | | | | Offset: Optional, variable length | | | | | | Length: Optional, variable length | | | | | | The Datagram Capsule contains: | | | | | | Type: 1 byte | | | | | | Length: Variable-length integer. It is assumed | | | that 2 bytes are enough. | | | | | | Quarter Stream Id: Variable-length integer. It is | | | assumed that 2 bytes are enough to support 65536 | | | active streams on an MPQUIC connection. | +-----------------+---------------------------------------------------+
The figure 6.11.4-1 below shows that, when two app payloads are provided to
the MPQUIC steering functionality they can be multiplexed in the same QUIC
packet (this is a feature supported by QUIC), thus, reducing the user-plane
overhead. In addition, a single UDP datagram can multiplex multiple QUIC
packets, which can further reduce the overhead.
NOTE: As a consequence of RFC9000 [6] the precondition for possible
multiplexing of payload packets is that those payload packets fit completely
inside a single QUIC packet, which is limited by the maximum MTU size.
An overhead of the MPQUIC steering functionality, which is not evident from
the figure below, is the HTTP CONNECT request plus the 200 OK response, sent
at the beginning of every UDP flow (see steps 7 and 10 in Figure 6.11.3-1).
Figure 6.11.4-1: Example of multiplexing QUIC datagram frames in one QUIC
packet to reduce the user-plane overhead when using the MPQUIC steering
functionality (UL direction)
### 6.11.5 Co-existence with MPTCP and ATSSS-LL
The MPQUIC steering functionality can co-exist with the MPTCP and the ATSSS-LL
steering functionalities and can complement the capabilities supported by
these functionalities. As shown in the following figure, the MPQUIC steering
functionality and the MPTCP steering functionality coexist and complement each
other by applying the same principles for different types of flows (UDP/IP
traffic flows and TCP/IP traffic flows respectively):
\- They both support a proxy functionality in the UPF. During the MA PDU
Session establishment, the UE receives proxy information for MPQUIC (IP
address, UDP port and type) and, in a similar way, it receives proxy
information for MPTCP (IP address, TCP port and type).
\- They are both high-layer functionalities that can interact with apps via
multipath-aware APIs.
\- The MPTCP establishes a new MP-TCP connection for every TCP data flow,
while the MPQUIC establishes a new QUIC stream for every UDP data flow.
\- The MPTCP applies a steering mode for every MP-TCP connection, while the
MPQUIC applies a steering mode for every QUIC stream.
Since the UE indicates if it supports the MPQUIC steering functionality (in
the PDU Establishment Request message), the network may configure the UE/UPF
to apply MPQUIC for UDP data flows, only if it is supported by the UE.
Otherwise, the network may configure the UE/UPF to apply ATSSS-LL for UDP data
flows.
In case of an MA PDU Session with Ethernet type, only the ATSSS-LL is applied.
Figure 6.11.5-1: Co-existence of steering functionalities
### 6.11.6 Handling of out-of-order delivery
In some scenarios, e.g. when a UDP flow is simultaneously split across two
accesses using the MPQUIC steering functionality, a percentage of received
packets can be out-of-order. These packets need to be reassembled in the
correct order (i.e. to be re-ordered) before they are consumed. This out-of-
order delivery arises when:
\- The MPQUIC steering functionality applies a steering mode that
simultaneously uses both accesses, such as the Load-Balancing steering mode,
for an UDP flow and (a) the transmitted packets are scheduled across the two
accesses on a per-packet decision (aka \"per-packet splitting\") and (b) there
is a difference of RTTs across the two accesses.
In other scenarios, e.g. when the MPQUIC steering functionality applies e.g.
an Active/Standby steering mode, the out-of-order delivery caused by multipath
transmission can be limited because, most of the time, the traffic of the UDP
flow is transmitted on one access only.
To enable scenarios where per-packet spitting is required and out-of-order
delivery cannot be avoided otherwise, the MPQUIC steering functionality is
able to:
\- Apply packet re-ordering by using the existing mechanisms provided by QUIC
for stream transport, when the PCF indicates that the stream mode should be
applied (head-of-line blocking can happen when delay due to re-transmissions
is too high).
\- Apply packet re-ordering by using the mechanisms provided by Datagram mode
1, when the PCF indicates that the Datagram mode 1 should be applied. As
mentioned before, the Datagram mode 1 adds sequence numbers to the HTTP
Datagrams that carry the UDP data packets (see details in clause 6.11.3, step
5) and requires the definition of a new Context Id. This Context Id, as well
as the following aspects of Datagram mode 1 will be considered in stage-3.
\- How to ensure re-ordering on the receiver side is implemented and
activated, when needed.
\- How the same reordering in both downlink and uplink can be provided.
\- Which sequencing and reordering schemes can be supported and whether such
schemes will be specified or will left to UE/UPF implementation.
### 6.11.7 Handling of duplicated packets
In some scenarios, the multipath transmission of a UDP flow using the MPQUIC
steering functionality can lead to reception of double copies of the same
packet. The duplicated copies of packets need to be discarded (i.e. to be
deduplicated) before they are consumed. This duplicated delivery issue can
arise when:
\- The MPQUIC steering functionality applies the redundant steering mode (RSM)
for an UDP flow.
The MPQUIC steering functionality can identify and remove the duplicated
packets by using a transport mode that supports packet reordering /
deduplication, such as the Datagram mode 1 or the Stream mode.
### 6.11.8 Impacts on Existing Nodes and Functionality
The 5GC network functions shall be able to support the following functionality
in addition to the ATSSS functionality defined in Rel-17.
AMF
\- No additional functionality is needed. It is assumed that when 5GC supports
ATSSS / Rel-18, then all ATSSS-capable SMFs in 5GC are able to support MPQUIC.
SMF
\- Shall be able to determine whether the UE supports the MPQUIC steering
functionality and to indicate this to PCF.
\- Shall be able to create ATSSS/N4 rules that apply the MPQUIC steering
functionality, based on the PCC rules received from PCF.
\- Shall be able to select a UPF that supports the MPQUIC steering
functionality.
PCF
\- If it is informed from SMF that the UE supports the MPQUIC steering
functionality, then it shall be able to determine which UDP flows should be
steered with the MPQUIC steering functionality. For each UDP flow, it shall be
able to indicate a steering mode and a transport mode.
UPF
\- Shall be able to support the MPQUIC steering functionality for steering the
UDP flows indicated in the received N4 rules. For each UDP flow, it should
apply the transport mode indicated in the received N4 rules.
UE
\- Shall be able to indicate in the PDU Session Establishment Request that is
supports the MPQUIC steering functionality.
\- Shall be able to support the MPQUIC steering functionality for steering the
UDP flows indicated by the received ATSSS rules. For each UDP flow, it should
apply the transport mode indicated in the received ATSSS rules.
The MPQUIC steering functionality is largely based on existing IETF
specifications (see clause 6.11.2) but does not require any changes on these
specifications.
\- A new QUIC transport parameter must be defined by 3GPP and registered with
IANA. This transport parameter associates a QUIC connection with a QoS flow.
## 6.12 Solution #2.3: MPQUIC steering functionality using IP proxying over
HTTP
### 6.12.1 Introduction
The solution in clause 6.12 specifies a new ATSSS steering functionality,
called Multipath QUIC-IP (MPQUIC-IP) steering functionality, and addresses the
objective of KI#2 for a QUIC-based steering functionality. It borrows several
aspects from solutions studied in TR 23.700-93 [5], mainly from Solution #6
\"MPQUIC-LL Steering Functionality\" and from Solution #14 \"Proxy based
solution using MP-QUIC\".
The solution is primarily based on the draft-ietf-masque-connect-ip [31],
which specifies how IP traffic can be transferred between a client (UE) and a
proxy (UPF) using the HTTP/3 protocol [28]. The HTTP/3 protocol operates on
top of the QUIC protocol [6], which supports simultaneous communication over
multiple paths, as defined in draft-ietf-quic-multipath [10].
The solution considers the following modes for transmitting an IP flow (see
further details in clause 6.12.3, step 5):
\- Datagram mode 1: This mode encapsulates the IP packets into QUIC DATAGRAM
frames. It provides unreliable transport and adds sequence numbers to the
transmitted IP packets, so that the received IP packets can be re-ordered, and
the duplicated IP packets can be removed.
\- Datagram mode 2: This mode encapsulates the IP packets into QUIC DATAGRAM
frames. It provides unreliable transport but does not add sequence numbers to
the transmitted IP packets. Therefore, it may result in data delivery with
out-of-order packets and/or with duplicated packets.
\- Stream mode: This mode encapsulates the IP packets into QUIC STREAM frames.
It provides reliable transport (based on the existing mechanisms supported by
the QUIC protocol) and supports data delivery without out-of-order packets and
without duplicated packets.
NOTE: Stream mode provides strict reliability and in-order delivery with re-
transmissions and therefore leads to melt down phenomena [see
http://sites.inka.de/\~W1011/devel/tcp-tcp.html] when reliable (e.g. QUIC) is
carried, or counteracts application decisions when UDP is selected to avoid
reliability and/or in-order delivery.
The Datagram mode 1 and the Stream mode are particularly useful for supporting
per-packet splitting, i.e. when the packets of an IP flow are split across
multiple accesses and may be received out-of-order. The Datagram mode 2 is a
simple transport mode which can be applied for applications that can tolerate
packet reordering or duplicated packets. The Datagram mode 2 features benefits
compared to ATSSS-LL, e.g. (a) it supports congestion control, (b) it supports
RTT/PLR measurements without the need to implement the PMF protocol, etc.
As clarified in clause 6.12.6, the MPQUIC-IP solution defines the mechanisms
needed for packet re-ordering (Datagram mode 1 and Stream mode) and the
conclusions should indicate which of those mechanisms should be defined in the
normative specs.
### 6.12.2 High-level Description
The key principles of the solution are summarized below.
\- After the MA PDU Session establishment, the UE creates one or more
multipath QUIC connections with the UPF. Each multipath QUIC connection is
associated with a QoS flow, i.e. it carries the traffic mapped to a QoS flow.
\- The UE operates as a connect-ip client and the UPF operates as a connect-ip
proxy, both defined in draft-ietf-masque-connect-ip [31]. Therefore, the UE
supports an HTTP/3 client and the UPF supports an HTTP/3 proxy, both of them
operating over QUIC.
\- On each of the established QUIC connections, the UE sends an extended HTTP
CONNECT request to UPF (as defined in [31]) indicating that IP proxying over
HTTP is needed.
\- When the UE wants to transmit an uplink packet of an IP flow, the UE:
\- Selects which QUIC connection will be used for the uplink traffic of the IP
flow based on the QoS flow associated with the IP flow;
\- Creates a new bidirectional QUIC stream on the selected QUIC connection;
\- Configures the QUIC stream to apply a steering mode (i.e. the steering mode
that should be used for the uplink traffic of the IP flow based on the ATSSS
rules); and
\- Forwards to UPF the uplink packets of the IP flow using multipath QUIC
transport.
\- When the UPF wants to transmit a downlink packet of an IP flow, the UPF:
\- Selects which QUIC connection will be used for the downlink traffic of the
IP flow (this QUIC connection is the same as the one selected by UE for the IP
flow, assuming the QoS flow in UL and DL directions is the same);
\- Selects a bidirectional QUIC stream on the selected QUIC connection (this
QUIC stream is the same as the one created by the UE for the IP flow);
\- Configures the QUIC stream to apply a steering mode (i.e. the steering mode
that should be used for the downlink traffic of the IP flow based on the N4
rules); and
\- Forwards to UE the downlink packets of the IP flow using multipath QUIC
transport.
The following figure illustrates how the traffic of an IP flow is transferred
between the UE and UPF using multipath QUIC transport [9]. In this figure, it
is assumed that the uplink traffic and the downlink traffic of the IP flow are
mapped to the same QoS flow (QFI-1). Therefore, both the uplink traffic and
the downlink traffic of the IP flow use the same multipath QUIC connection.
Figure 6.12.2-1: Using multipath QUIC transport for a IP flow
The bidirectional QUIC stream is established by the UE to enable transmission
of uplink IP packets (blue) and downlink IP packets (red) of the IP flow. The
UE configures this stream to send uplink traffic with a steering mode
determined based on the ATSSS rules in the UE (uplink steering mode). The UPF
configures this stream to send downlink traffic with a steering mode
determined based on the N4 rules in the UPF (downlink steering mode). The data
packets of the IP flow shown in Fig. 6.12.2-1 are transmitted in datagram mode
(mode 1 or mode 2), i.e. they are encapsulated in HTTP datagrams and QUIC
DATAGRAM frames, each one carrying header information (see the Quarter Stream
ID defined in draft-ietf-masque-h3-datagram [29]) that associates it with the
established bidirectional stream. As discussed below, the IP packets of the IP
flow may be transmitted in stream mode (instead of datagram mode), i.e.
transmitted directly over the bidirectional stream. In this case, the IP
packets of the IP flow are encapsulated in DATAGRAM capsules (see [29]) and
QUIC STREAM frames.
Figure 6.12.2-2 and Figure 6.12.2-3 illustrate the components of the MPQUIC-IP
steering functionality used to support data transmission in the uplink and
downlink direction respectively. The MPQUIC-IP steering functionality is
composed of three components:
1) QoS flow selection & Steering mode selection: This component in the UE
initiates the establishment of one or more QUIC connections, after the
establishment of the MA PDU Session and, for each uplink IP flow, it selects a
QoS flow (based on the QoS rules), a steering mode (based on the ATSSS rules)
and a transport mode (see further details below). This component in the UPF
selects, for each downlink IP flow, a QoS flow (based on the N4 rules), a
steering mode (based on the N4 rules) and a transport mode (see further
details below)
In the UE, this component is only used in the uplink direction, while, in the
UPF, this component is only used in the downlink direction.
2) HTTP/3 layer: Supports the HTTP/3 protocol defined in draft-ietf-quic-http
[28] and the extensions defined in:
\- draft-ietf-masque-connect-ip [31] for supporting IP proxying over HTTP; and
\- draft-ietf-masque-h3-datagram [29] for supporting HTTP datagrams.
The HTTP/3 layer selects a QUIC connection to be used for each IP flow and
allocates a new QUIC stream on this connection that is associated with the IP
flow. It also configures this QUIC stream to apply a specific steering mode
(further details are provided below).
In the UE, the HTTP/3 layer implements an HTTP/3 client, while, in the UPF, it
implements an HTTP/3 proxy.
3) QUIC layer: Supports the QUIC protocol as defined in the applicable IETF
specifications (RFC 9000 [6],
RFC 9001 [7], RFC 9002 [8]) and the extensions defined in:
\- RFC 9221 [9] for supporting unreliable datagram transport with QUIC; and
\- draft-ietf-quic-multipath [10] for supporting QUIC connections using
multiple paths simultaneously.
Figure 6.12.2-2: Components of MPQUIC-IP steering functionality used for UL
data transmission
Figure 6.12.2-3: Components of MPQUIC-IP steering functionality used for DL
data transmission
The protocol stack of the solution is depicted in Figure 6.12.2-4 below.
Figure 6.12.2-4: UP protocol stack of the solution
### 6.12.3 Procedures
Figure 6.12.3-1 below depicts the key steps of the procedure that enables data
traffic to be exchanged between the UE and UPF using the MPQUIC-IP steering
functionality.
Figure 6.12.3-1: Procedure for enabling data traffic using the MPQUIC-IP
steering functionality
1\. The UE establishes a MA PDU Session with the 5G core (5GC) network. During
the MA PDU Session establishment:
\- In the PDU Establishment Request message, the UE indicates that it supports
the MPQUIC-IP steering functionality. This indication can be used by the
network (a) to select a UPF that also supports the MPQUIC-IP steering
functionality and (b) to decide whether the ATSSS/N4 rules for the MA PDU
Session may use the MPQUIC-IP steering functionality.
\- The UE receives MPQUIC-IP proxy information, i.e. one IP address of UPF,
one UDP port number and the proxy type (e.g. \"connect-ip\"). This information
is used by the UE for establishing QUIC connections with the UPF, which is
also referred to as \"MPQUIC-IP proxy\".
\- The UE receives one IP address/prefix for the MA PDU Session and two
additional IP addresses/prefixes, called \"link-specific multipath QUIC\"
addresses; one associated with 3GPP access and another associated with the
non-3GPP access. These two addresses can be used by the UE to create two paths
in a multipath QUIC connection.
\- The UE receives QoS rules and ATSSS rules to be applied for the MA PDU
Session, for QoS enforcement and traffic steering enforcement respectively.
Similar rules (N4 rules) are received by UPF.
2\. After the MA PDU Session is established and the UE identifies that one or
more ATSSS rules require traffic steering using the MPQUIC-IP steering
functionality, the UE determines the number of multipath QUIC connections to
be established with the UPF (MPQUIC-IP proxy). For example, the UE may
determine to establish as many multipath QUIC connections, as the number of
QoS flows of the MA PDU Session, i.e. one multipath QUIC connection per QoS
flow. The QoS rules provided to UE include downlink QoS information and the UE
applies the downlink QoS information to establish QUIC connections for the QoS
flows used for downlink traffic only.
3\. The UE establishes the number of multipath QUIC connection with the UPF
(MPQUIC-IP proxy) determined in the previous step. This results into several
multipath QUIC connections between the UE and UPF, each one composed of
multiple paths, e.g. one path over 3GPP access and another path over non-3GPP
access.
NOTE 1: Data transmitted over a multipath QUIC connection must be encrypted
according to RFC 9001 [7]. However, encryption might not be necessary when the
multipath QUIC connection is established between UE and UPF, because the
underlying 5G security mechanisms can be applied.
Editor\'s note: Whether and how encryption in the QUIC layer can be omitted is
FFS and need to be verified by SA3. The impact due to encryption regarding
overhead and performance is FFS.
During a QUIC connection establishment, the UE and UPF negotiate QUIC
transport parameters and indicate (a) support of QUIC Datagram frames and (b)
support of multipath. They indicate support of QUIC Datagram frames by
providing the \"max_datagram_frame_size\" transport parameter with a non-zero
value (see RFC 9221 [9]) and they indicate support of multipath by providing
the \"enable_multipath\" transport parameter (see draft-ietf-quic-multipath
[10]).
After a QUIC connection establishment, the HTTP/3 client and the HTTP/3 proxy
negotiate HTTP settings and indicate support of HTTP Datagrams (see draft-
ietf-masque-h3-datagram [29]) and support of Extended CONNECT (see draft-ietf-
httpbis-h3-websockets [30]).
The QoS flow associated with a QUIC connection is also negotiated between the
UE and UPF. This is done by using a new QUIC transport parameter (defined by
3GPP) when the QUIC connection is established.
NOTE 2: QUIC transport parameter needs to be registered in IANA (by stage 3).
4\. On each of the established QUIC connections, the UE sends an extended HTTP
CONNECT request to UPF (as defined in [31]) indicating that IP proxying over
HTTP is needed. If this is accepted by UPF, it responds with a 200 status.
5\. The UE generates a new IP packet (IP packet #1) that should be sent via
the MA PDU Session. This IP packet initiates a new IP flow, i.e. a sequence of
IP packets using the same 5-tuple. For this new IP flow (and for each new IP
flow):
\- The UE selects a QoS flow (QFI) over which the IP flow should be
transmitted. This is selected by using the received QoS rules.
\- The UE selects a steering mode that should be applied for the IP flow. This
is selected by using the received ATSSS rules.
\- The UE selects a transport mode, e.g. a datagram transport mode or the
stream transport mode. This is selected by using the received ATSSS rules,
i.e. each ATSSS rule which indicates that the MPQUIC-IP steering functionality
should be applied for the matching traffic, indicates also the transport mode
that should be applied for this traffic.
The datagram transport mode supports the following two sub-modes of operation:
\- Datagram mode 1 (with sequence numbers): The HTTP/3 proxy/client or the
\"QoS flow selection and Steering mode selection\" layer prefixes each UDP
data with a sequence number before passing it to the QUIC layer for multipath
transmission. The sequence numbers are applied by the receiving endpoint to
re-order the UDP data and remove duplicated UDP data. Details of how packet
reordering is support with the MPQUIC-IP steering functionality are provided
in clause 6.12.6.
\- Datagram mode 2 (without sequence numbers): The HTTP/3 proxy/client does
not prefix each IP packet with a sequence number before passing it to the QUIC
layer for multipath transmission. This may result (depending on the applied
steering mode) in data delivery with out-of-order packets and/or with
duplicated packets. For some applications, however, such type of data delivery
may be acceptable.
The datagram mode 2 is needed (although it does not support re-ordering)
because it features benefits compared to ATSSS-LL, e.g. (a) it supports
congestion control, (b) it supports RTT/PLR measurements without the need to
implement the PMF protocol, etc.
In both datagram modes, every IP packet is encapsulated within an HTTP
DATAGRAM, which if further encapsulated within an QUIC DATAGRAM frame [9]. The
payload of the HTTP DATAGRAM is composed of a Context ID and a Payload (as
defined in draft-ietf-masque-connect-ip [31]): HTTP DATAGRAM payload =
{Context ID (i), Payload (..)}.
The Datagram mode 1 and Datagram mode 2 use two different (and pre-defined in
3GPP) Context IDs, e.g. Context ID=0 and Context ID=1, respectively. With
Context ID=0, the Payload contains the IP packet, whereas, with Context ID=1,
the Payload contains a sequence number followed by the IP packet. The format
of QUIC DATAGRAMs used in both datagram modes is shown below. As specified in
clause 6.12.6, the Datagram mode 1 may support reordering either in the HTTP/3
layer (as described above) or in the layer above HTTP/3. In the latter case,
the definition of a new Context ID is not needed as sequencing and reordering
is performed outside the HTTP/3 layer.
Datagram mode 1
* * *
Datagram mode 2
6\. The UE selects a multipath QUIC connection to be used for the new IP flow
(e.g. based on the selected QFI) and the UE allocates a new QUIC stream (e.g.
stream 40) in this multipath QUIC connection. This new stream is associated
with the new IP flow. The UE configures the new stream to transmit data
traffic using the selected steering mode for this IP flow.
9\. The UE sends the IP packet using the allocated new stream on the selected
QUIC connection.
When the datagram transport mode is selected (mode 1 or mode 2), the UE
encapsulates the IP packet within an HTTP DATAGRAM frame [29], which is
transferred inside a QUIC DATAGRAM frame [9]. The header of the HTTP DATAGRAM
indicates that this datagram is associated with stream 40 (i.e. the Quarter
Stream ID is set to 10).
When the stream transport mode is selected, the UE encapsulates the IP packet
within an HTTP DATAGRAM frame [29] that is further encapsulated in a DATAGRAM
capsule (see [29]), which is transferred inside a QUIC STREAM frame [6].
In the example procedure shown in Figure 6.12.3-1, the datagram transport mode
(mode 1 or mode 2) is selected. The UE sends a QUIC DATAGRAM frame to UPF that
encapsulates the IP packet, which is forwarded by UPF to the remote host.
11\. When an IP packet is received by UPF (MPQUIC-IP proxy) from the remote
host (IP packet #2), this IP packet is transferred to the UE using the
established context information for the IP flow, i.e. using the selected
multipath QUIC connection, the selected stream on this connection, the
selected steering mode, and the selected transport mode. Such context
information is stored in the UPF and in the UE and is applied for all the IP
packets of the IP flow.
12\. Similarly, when another IP packet is generated by the UE app (IP packet
#3), this IP packet is transferred to UPF (MPQUIC-IP proxy) using again all
the stored context information for the IP flow.
NOTE 2: The context information for an IP flow in the UE and in the UPF is
created when the initial IP packet (i.e. IP packet #1) of this IP flow is
transferred. All subsequent IP packets of the same IP flow are transferred
between the UE and the UPF using this context information.
When the UE identifies that the context information for an IP flow is no
longer needed, the UE deletes this context information and releases the
associated QUIC stream, which cause the UPF to delete the context information
stored in UPF.
The following figure 6.12.3-2 illustrates an example of how the uplink traffic
of various IP flows is transferred from the UE to UPF using QUIC multipath
transport, and how the UPF relays this traffic to a final destination (remote
host). Note that, for each IP flow there is an associated QUIC connection and
an associated bidirectional QUIC stream, which is configured to apply a
specific steering mode for the uplink traffic. For example, the red IP flow is
associated with the multipath QUIC connection #1 and with the red Stream Y,
which is configured to apply the Smallest delay steering mode in the uplink
direction.
All IP flows shown in this figure, except the blue IP flow, are transferred
with the datagram transport mode (mode 1 or mode 2), i.e. their data packets
are transferred inside QUIC DATAGRAM frames. The blue IP flow is transferred
with the stream transport mode, so its data packets are transferred inside
QUIC STREAM frames.
The downlink traffic of IP flows is transferred between the UE and UPF in a
similar way.
Figure 6.12.3-2: Example of user-plane operation using the MPQUIC-IP steering
functionality (UL direction)
### 6.12.4 User-plane overhead
Editor\'s note: This clause is FFS.
### 6.12.5 Co-existence with MPTCP and ATSSS-LL
Editor\'s note: This clause is FFS.
### 6.12.6 Handling of out-of-order delivery
In some scenarios, the multipath transmission of an IP flow using the MPQUIC-
IP steering functionality can lead to a large percentage of received packets
being out-of-order. These packets need to be reassembled in the correct order
(i.e. to be re-ordered) before they are consumed. This out-of-order delivery
issue can be significant when:
\- The MPQUIC-IP steering functionality applies the Load-Balancing steering
mode for an IP flow and (a) the transmitted packets are scheduled across the
two accesses in a per-packet round-robin fashion (aka \"per-packet
splitting\") and (b) the difference of RTTs across the two accesses is large.
In other scenarios, e.g. when the MPQUIC-IP steering functionality applies a
steering mode other than Load-Balancing, the out-of-order delivery caused by
multipath transmission is very limited because, most of the time, the traffic
of the IP flow is transmitted on one access only.
Even in the scenarios where Load-Balancing is applied, the excessive out-of-
order delivery can be mitigated by avoiding per-packet round-robin scheduling.
Note that the ATSSS specifications mandate only the traffic to be split using
certain percentages (e.g. 50% over 3GPP, 50% over non-3GPP) but do not specify
a time window for achieving these percentages. For example, a UE may choose to
perform splitting every 20 packets, e.g. send 10 packets over 3GPP and the
next 10 packets over non-3GPP. This type of traffic scheduling can be very
well applied by the UE/UPF for Load-Balancing, and it is compliant with the
ATSSS specifications. UE/UPF implementations may also choose to adjust their
traffic scheduling based on the difference of RTTs across the two accesses in
order to minimize the percentage of out-of-order packets.
Nevertheless, to enable scenarios where per-packet spitting is required and
out-of-order delivery cannot be avoided otherwise, the MPQUIC-IP steering
functionality is able to:
\- Offload the re-ordering procedure to the application, when the network
indicates (via the \"transport mode\" parameter in the ATSSS/N4 rules) that
Datagram mode 2 should be applied. In this case, the MPQUIC-IP does not
perform packet re-ordering since the PCF indicates that packet re-ordering can
be handled by the application.
\- Apply packet re-ordering by using the existing mechanisms provided by QUIC
for stream transport, when the PCF indicates that the stream mode should be
applied. This may be indicated by PCF for applications that do not perform
retransmissions themselves (e.g. do not embed QUIC streaming functionality in
the application) hence the meltdown effect can be avoided.
\- Apply packet re-ordering by using new mechanisms not provided by QUIC, when
the PCF indicates that the Datagram mode 1 should be applied. This may be
indicated by PCF for applications that perform retransmissions themselves
(e.g. embed QUIC streaming functionality in the application).
The new mechanisms that can be used for packet sequencing and re-ordering in
Datagram mode 1 can be supported either in the HTTP/3 layer (as described in
clause 6.12.3) or can be supported in the layer above HTTP/3. Whether the
mechanisms for Datagram mode 1 are needed in Rel-18 or whether the Stream mode
is sufficient is considered in the conclusions of KI#2 (in clause 8).
Editor\'s note: It is FFS how to ensure re-ordering on the receiver side is
implemented and activated, when needed.
Editor\'s note: It is FFS how same re-ordering in both Down- and Uplink can be
provided which is pre-requisite for a consistent and good user experience.
Editor\'s note: http3 does not specify sequencing. It is FFS which IETF
sequencing scheme can/will be used.
Editor\'s note: It is FFS how the MPQUIC-IP steering functionality does re-
ordering for the Datagram mode 1 (with sequence numbers). It is FFS whether
and which parts of re-ordering mechanisms can be specified by IETF, should be
specified by 3GPP and can be left for implementation.
Editor\'s note: It is FFS whether Stream mode and/or Datagram mode 2 are
needed. Both do not support required rel18 functionality for non-TCP traffic
splitting of unreliable traffic, including the transport mode negotiation.
### 6.12.7 Handling of duplicated packets
In some scenarios, the multipath transmission of a IP flow using the MPQUIC-IP
steering functionality can lead to reception of double copies of the same
packet. The duplicated copies of packets need to be discarded (i.e. to be
deduplicated) before they are consumed. This duplicated delivery issue can
arise when:
\- The MPQUIC-IP steering functionality applies the redundant steering mode
for an IP flow.
The MPQUIC-IP steering functionality addresses this issue as follows:
\- An ATSSS/N4 rule which indicates that redundant steering mode should be
applied, may include an additional parameter called \"deduplication info\".
When the \"deduplication info\" parameter is false or is not included, the
MPQUIC-IP steering functionality at the receiver shall not perform packet
deduplication. In this case, it is assumed that packet deduplication is
performed by the application itself. Otherwise, the MPQUIC-IP steering
functionality shall number the transmitted packets and shall perform packet
deduplication using an implementation specific mechanism.
### 6.12.8 Impacts on Existing Nodes and Functionality
The 5GC network functions shall be able to support the following functionality
in addition to the ATSSS functionality defined in Rel-17.
AMF
\- No additional functionality is needed. It is assumed that when 5GC supports
ATSSS / Rel-18, then all ATSSS-capable SMFs in 5GC are able to support MPQUIC.
SMF
\- Shall be able to determine whether the UE supports the MPQUIC-IP steering
functionality and to indicate this to PCF.
\- Shall be able to create ATSSS/N4 rules that apply the MPQUIC-IP steering
functionality, based on the PCC rules received from PCF.
\- Shall be able to select a UPF that supports the MPQUIC-IP steering
functionality.
PCF
\- If it is informed from SMF that the UE supports the MPQUIC-IP steering
functionality, then it shall be able to determine which IP flows should be
steered with the MPQUIC-IP steering functionality. For each IP flow, it shall
be able to indicate a steering mode and a transport mode (e.g. stream mode or
datagram mode 1/2).
UPF
\- Shall be able to support the MPQUIC-IP steering functionality defined in
clause 6.12 for steering the IP flows indicated in the received N4 rules. For
each IP flow, it should apply the transport mode (e.g. stream mode or datagram
mode 1/2) indicated in the received N4 rules.
UE
\- Shall be able to indicate in the PDU Session Establishment Request that is
supports the MPQUIC-IP steering functionality.
\- Shall be able to support the MPQUIC-IP steering functionality defined in
clause 6.12 for steering the IP flows indicated by the received ATSSS rules.
For each IP flow, it should apply the transport mode (e.g. stream mode or
datagram mode 1/2) indicated in the received ATSSS rules.
The impact of the MPQUIC-IP steering functionality to IETF is the following:
\- The MPQUIC-IP steering functionality is based on:
a) IETF RFCs specifying the QUIC protocol [6] -- [9] and on draft-ietf-quic-
multipath [10] defining QUIC extensions for multipath support; and
b) IETF documents defining support for HTTP/3 including draft-ietf-quic-http
[28], draft-ietf-masque-connect-ip [31] for supporting UDP proxying over HTTP,
draft-ietf-masque-h3-datagram [29] for supporting HTTP datagrams and draft-
ietf-httpbis-h3-websockets [30] for supporting Extended CONNECT.
The MPQUIC-IP steering functionality does not require changes to any of the
above documents.
\- A new QUIC transport parameter must be defined by 3GPP and registered with
IANA. This transport parameter associates a QUIC connection with a QoS flow.
## 6.13 Solution #2.4: Limiting MA-PDU Per-Packet Overhead
### 6.13.1 Introduction
This solution addresses aspects of Key Issue #2, especially, the impact on the
user plane performance and UE impacts.
When encapsulating IP and/or Ethernet traffic within a DCCP or QUIC tunnel,
the headers of the encapsulated traffic need to be compressed to reduce the
overhead per packet, using typically Ethernet Header Compression (EHC) [34,
Annex A] and Robust Header Compression (ROHC) [32, 33] protocols. We can call
this feature \"inner header compression\" (IHC). This solution describes how
IHC can be established between the UE and UPF. IHC is optional and configured
by the network based on network policy and UE/network capability.
### 6.13.2 High Level Description
Inner header compression can be performed by tunnel clients/servers, such as
the MP-DCCP tunnel client/server defined in solution #2.1, or by the MP-DCCP
or MP-QUIC layers. Using the tunnel clients/servers may be preferable since it
enables using the same mechanism independently from the underlying transport
protocol. Such a solution could therefore be used for any low-layer steering
functionality, such as the MPDCCP-LL steering functionality defined in
solution #2.1 and for the MPQUIC-IP steering functionality defined in solution
#2.3. However, it is not required for high-layer steering functionalities,
such as the MPQUIC steering functionality defined in solution #2.2, because no
inner headers are used.
Inner header compression should be configured on both ends, i.e. UE and UPF,
prior to establishing a flow. NAS signalling can be used for this purpose, as
described below.
### 6.13.3 Procedures
The following procedure describes how inner header compression can be
configured when a new MA PDU session is created.
Figure 6.13.3-1: Configuration of Inner Header Compression in a MA-PDU Session
In step 1, a UE application decides to initiate communication with an
Application Server (AS). UE determines to use a MA PDU session. UE determines
to use IHC.
In step 2, UE sends a PDU Session Establishment Request. The request includes
the UE\'s supported IHC capabilities (e.g. the supported RoHC profiles).
In step 3, SMF determines, based on the PCC rules, which traffic of the MA PDU
Session should be steered with MP-DCCP/MP-QUIC based steering functionality.
SMF determines the IHC configuration based on the IHC capabilities of the UE
and the network.
The same IHC configuration applies to all SDFs which are steered with a MP-
DCCP/MP-QUIC based steering functionality.
In step 4, SMF sends to UPF a N4 session establishment/modification request,
including an IHC configuration.
In step 5, UPF configures packet detection, enforcement and reporting rules,
and configures the tunnel server to use the received IHC configuration for the
appropriate MA PDU session flows.
In step 6, UPF sends a N4 session establishment response to SMF.
In step 7, SMF sends to UE, through AMF, a PDU Session Establishment Accept
message including IHC configuration.
In step 8, UE configures the tunnel client to use IHC for the appropriate MA
PDU session flows, based on the IHC configuration in the PDU session
establishment accept message.
From this point on, the application traffic is switched/steered/split over a
MA PDU session between UE and UPF. Inner headers are compressed between UE and
UPF. The application traffic is forwarded by the UPF to/from the Application
Server (AS).
### 6.13.4 Impacts on Existing Nodes and Functionality
IHC requires UE and UPF to implement header compression, e.g. using ROHC
and/or EHC. This function may be in the tunnel client (on UE) and server (on
UPF). UE indicates its IHC capabilities in the PDU session establishment
request and obtains IHC configuration in PDU session establishment accept.
The SMF determines IHC configuration based on the IHC capabilities of the UE
and the network. The SMF transmits the IHC configuration to UPF (over N4
signalling) and to UE (over NAS signalling).
## 6.14 Solution #3.5: Redundant Traffic Steering Mode Activation/Deactivation
### 6.14.1 Introduction
This solution addresses aspects of Key Issue #3 (Solutions for Redundant
Traffic Steering Mode), especially related to the mechanism to support the
activation and deactivation of traffic duplication, and the criteria needed
for making this decision. In the following, we use existing solutions (MP-
QUIC-LL as described in TR 23.700-93 [5], Solution #6, and MP-DCCP-LL as
described in the present document, clause 6.3) as the framework to describe
the solution. However, the solution is not tightly tied to these solutions,
and can work for other solutions.
### 6.14.2 High Level Description
In both the MP-DCCP and MP-QUIC based solutions, the protocol stack at the UE
and UPF is as shown in Figure 6.14.2.1.
Figure 6.14.2-1: Protocol Stack for MP-QUIC and MP_DCCP
The MP-QUIC/DCCP Tunnel Client (MxTC) at the UE, and the MP-QUIC/DCCP Tunnel
Server (MxTS) at the UPF, rely on the underlying MP-QUIC or MP-DCCP protocol.
These protocols support a number of traffic steering modes, including
redundant traffic steering.
In both cases, the MxTC establishes an MP-QUIC/DCCP connection with the MxTS
in the UPF. An MP-QUIC/DCCP connection carries the traffic of only one QoS
flow. In addition, it is assumed that an MP-QUIC/DCCP connection will be
configured with a single steering mode. The MxTC receives UL PDUs from the
upper layer and, for each UL PDU, the MxTC selects a steering mode to be
applied for the UL PDU based on the ATSSS rules in the UE. The MxTC
subsequently selects a MP-QUIC/DCCP connection to transmit the PDU based on
the selected QoS flow and the selected steering mode.
This mechanism works well for QoS flows which are known, a priori, to require
redundant transmission. For such use cases, the choice of redundant
transmission can be made at PDU session establishment, and traffic duplication
should always be activated. In other use cases, traffic duplication should
only be used when needed, as duplicating traffic over both accesses results
in:
\- Power consumption at the UE: The UE is required to operate over both
accesses.
\- Core network load: The redundant transmissions will result in a certain
load to the 5GC.
\- Processing at UE and UPF: The UE and UPF both need to handle re-ordering
and possible reception of duplicate PDUs.
\- Radio resource usage: Radio resources are used over both accesses.
For these use cases, traffic duplication should only be used when needed, and
should be dynamically activated / deactivated on a per-packet basis.
NOTE: The mechanism to duplicate the packet is FFS. It may be implemented at
the MxTC or it may be implemented in the layers below the MxTC (for example in
the MP-QUIC/DCCP layer).
The Activation/Deactivation decision should be made at the MxTC for the UE and
at the MxTS for the UPF, and should be based on selection criteria and
measurements:
\- Packet Loss Rate (PLR): This measurement indicates the rate of PDU packet
loss for each access network. The measurement is applicable to both uplink and
downlink transmissions.
\- Delay: This measurement indicates the PDU transmission delay for each
access network. This is a one-way delay between UE and UPF for uplink
transmissions, and between UPF and UE for downlink transmissions.
\- Variability of Delay: This measurement indicates the variability of PDU
arrivals (jitter) over an access network. PDU arrivals at the UPF for uplink
transmission and PDU arrivals at the UE for downlink transmissions. The
variability of delay measurement is a reflection of transfer quality stability
within certain time interval. It may be calculated using the mechanisms
described in Solution #3 in TR 23.700‑93 [5]. Variability of Delay
measurements prevent wasteful transmissions over an access path. Some
services, such as gaming and IMS voice, are sensitive to variability of delay.
For these services, activating traffic duplication over a path that will not
meet the variability of delay requirements, will not be useful.
\- Load: This measurement indicates the load over an access network.
The selection criteria should rely on these measurements and should allow the
UE to activate traffic duplication only when \"**needed and effective** \".
For example, if the PLR is of critical importance of a data flow, the
duplication should be activated when the measured PLR on the active access
leg(s) is bigger than the threshold. For another example, the UE should not
activate traffic duplication over a non-3GPP access, if the delay over the
non-3GPP access will not meet the one-way delay requirement for the PDU. In
such a case, the duplicate transmissions over the non-3GPP access would be
useless. The selection criteria are included in the ATSSS rules provided to
the UE and the N4 Rules provided to the UPF. The measurement configuration is
included in the Measurement Assistance Information.
When traffic duplication is deactivated, the UE and UPF should rely on a
default steering mode (such as \"Active-Standby\" or \"Smallest Delay\") to
select which access path to use. The default steering mode configuration could
be chosen in a similar way how normal steering mode is configured (e.g.
depending on UE/NW capabilities) and provided in the ATSSS rules to the UE and
in the N4 rules to the UPF. The duplication criteria is configured in a way
that the measurements in default steering mode can be used. For example, if
Active-Standby is configured as the default steering mode, the PLR measurement
on the active access, instead of both accesses, should be used in the
criteria.
Editor\'s note: How to handle out-of-order reception due to latency difference
between access paths is FFS.
### 6.14.3 Procedures
The following procedure (Figure 6.14.3.1) describes how traffic duplication
can be dynamically activated and/or deactivated.
Figure 6.14.3-1: Redundant Steering Mode: Activation/Deactivation of Traffic
Duplication
In step 1, UE application decides to initiate communication with AS. UE
determines to use a MA-PDU session.
In step 2, UE sends a PDU Session Establishment or Modification Request. The
request includes capability support for redundant steering mode.
In step 3, SMF determines to use MA-PDU session, e.g. based on configuration
or PCC rules. SMF determines ATSSS rules for the UE and N4 rules for UPF.
In step 4, SMF sends to UPF a N4 session establishment/modification request,
including N4 rules and Measurement Assistance Information. The N4 rules
include an indication whether the UPF should start with traffic duplication
activated or deactivated, default steering mode configuration to use if
duplication is deactivated, as well as the selection criteria to activate or
deactivate traffic duplication.
In step 5, SMF sends to UE, through AMF, a PDU Session
Establishment/Modification Accept message including ATSSS rules for redundant
steering mode and Measurement Assistance Information. The ATSSS rules include
an indication whether the UE should start with traffic duplication activated
or deactivated, default steering mode configuration to use if duplication is
deactivated, as well as the selection criteria to activate or deactivate
traffic duplication.
In step 6, UE configures the MxTC.
In step 7, before measurements for selection criteria are available, MxTC
determines whether traffic duplication should be activated or deactivated
based on the indication from the PDU Session Establishment/Modification Accept
message.
From this point on, the application traffic is sent over the MA-PDU session
between UE and UPF. The MxTC monitors the selection criterion and based on
ATSSS rules, decides whether traffic duplication should be activated or
deactivated for the uplink application traffic. Similarly, the MxTS monitors
the selection criterion and based on N4 rules, decides whether traffic
duplication should be activated or deactivated for the downlink application
traffic.
### 6.14.4 Impacts on Existing Nodes and Functionality
PCF:
\- Provide PCC rules to SMF, considering the selection criteria to activate or
deactivate traffic duplication
SMF:
\- Based on the PCC rules, create ATSSS rules and N4 rules including the
selection criteria to activate or deactivate traffic duplication, and default
steering mode configuration to use if duplication is deactivated.
UPF:
\- Shall be able to determine whether traffic duplication is activated or
deactivated.
UE:
\- Shall be able to indicate support of redundant steering mode when
requesting a MA PDU Session.
\- Shall be able to determine whether traffic duplication is activated or
deactivated.
## 6.15 Solution #3.6: Redundant steering mode
### 6.15.1 Introduction
This solution addresses KI#3 on support of redundant traffic steering.
### 6.15.2 High-level Description
Redundant steering mode (RSM) allows traffic to be transmitted via 3GPP and
non-3GPP accesses in a redundant way to achieve the lowest latency and to
lower the loss rate.
In this solution all packets are duplicated over both 3GPP and non-3GPP access
when RSM applies for the traffic. This ensures that the application traffic
always benefits from the increased robustness that comes with duplication of
packets.
RSM can be supported when MPTCP steering functionality is used. RSM does not
apply to the ATSSS-LL steering functionality.
Editor\'s note: RSM for MP-QUIC/MP-DCCP is FFS.
In case RSM is applied for a GBR flow, the SMF provides the related GBR QoS
profile to both 3GPP and non-3GPP accesses. This ensures that the
corresponding GBR resources are reserved in both accesses.
Editor\'s note: It is FFS if and how AF can influence the use of RSM.
### 6.15.3 Procedures
The existing procedures apply. Only a new Steering Mode is defined.
### 6.15.4 Impacts on Existing Nodes and Functionality
The PCC rules, ATSSS rules and the N4 rules are enhanced to support a new
steering mode for Redundant Steering Mode.
SMF:
\- Based on the PCC rules, create ATSSS rules and N4 rules with the new
Steering Mode.
PCF:
\- Provide PCC rules with the new Steering Mode.
UPF:
\- Ife RSM is used for a traffic flow, duplicate traffic via the available
access paths of a MA PDU session for the downlink traffic. Handle received
duplicated uplink traffic.
UE:
\- If RSM is used for a traffic flow, duplicate traffic via the available
access paths of a MA PDU session for the uplink traffic. Handle received
duplicated downlink traffic.
Editor\'s note: It is FFS if and how AF can influence the use of RSM.
## 6.16 Solution #5.5: Non-3GPP path switch during Registration in new
non-3GPP access
### 6.16.1 Introduction
### 6.16.2 High-level Description
This solution addresses Key Issue #5 \"Switching traffic of an MA PDU Session
between two non-3GPP access paths\" by allowing a UE to Register in a new
non-3GPP AN node while optionally keeping the UP connection in old non-3GPP AN
node for a while, allowing the UE and UPF to switch the traffic to the new
non-3GPP access before releasing the old access. The solution is based on UE
triggering a Registration Request via the new non-3GPP AN node and requesting
UP establishment using the \"PDU Sessions to be activated\" parameter.
The solution allows both single access PDU Sessions and MA PDU Sessions to be
\"switched\" using the Registration procedure. A reason for this is that the
solution is basically describing how a mobility Registration Update is
performed via non-3GPP access. If the UE initiates a mobility Registration
Update via 3GPP access and indicates that it wants to activate UP connections
using \"PDU Sessions to be activated\" parameter, it applies in the same way
for single-access and MA PDU Sessions. It is proposed here that the same is
assumed for mobility Registration via non-3GPP access.
### 6.16.3 Procedures
This procedure assumes that the UE is registered over untrusted non-3GPP
access first and then switches to trusted non-3GPP access. A similar procedure
is applicable if UE is registered over trusted non-3GPP access first and then
switches to untrusted non-3GPP access. The UE may also be registered in 3GPP
access. The solution re-uses some aspects of Solution#5.2, e.g. a new
registration type.
Figure 6.16.2-1: Mobility Registration procedure to support non-3GPP access
switching
1\. The UE is registered over an untrusted non-3GPP access and may also be
registered in 3GPP access. A MA PDU Session is established that has UP
connections via untrusted non-3GPP access and possibly also via 3GPP access.
The UE may also have single access (SA) PDU Sessions over 3GPP and/or
untrusted non-3GPP access.
During registration in non-3GPP, the AMF indicates to UE whether it supports
non-3GPP access switching.
2\. The UE registers over trusted non-3GPP access with Registration type =
mobility registration. The UE also indicates whether it is maintaining the old
non-3GPP access connectivity by including a \"dual non-3GPP access switching\"
indication. The UE includes in the List Of PDU Sessions To Be Activated the MA
PDU Sessions that have user plane resources established over untrusted
non-3GPP access. The UE may also include SA PDU Sessions active in untrusted
non-3GPP access in the List Of PDU Sessions To Be Activated. The UE also
indicates all SA and MA PDU Sessions that were active over the old non-3GPP
access in the PDU Session status parameter.
3\. The AMF may perform authentication based on existing procedures. The AMF
may send an Initial Context Setup Request to TNGF and include AS security
information. Alternatively, the AMF sends the Initial Context Setup Request to
TNGF in step 6, after contacting the SMF(s).
4\. The AMF releases the old N2 connection if the UE did not provide a \"dual
non-3GPP access switching\" indication in step 2 or if the AMF only supports a
single N2 connection via non-3GPP access.
5\. The AMF notifies to the SMF(s) that the UE requested UP connection
activation. For MA PDU Sessions, the AMF also includes the \"dual non-3GPP
access switching\" indication, if received from the UE. The AMF repeats this
step for all SA and MA PDU Sessions indicated in step 2.
The SMF contacts UPF to allocate CN tunnel information, if needed. If the
\"dual non-3GPP switch\" indication is received, the SMF does not trigger a
release of UP connection (if any) to old non-3GPP access.
The SMF replies to AMF including the CN tunnel information.
6\. The AMF sends an N2 message to TNGF and includes the CN tunnel information
received from the SMF(s). The N2 message is an Initial Context Setup Request
(if not sent in step 3) or a PDU Session Resource Setup request. The AMF knows
that the N2 information is targeting TNGF since the UP connection setup is
part of the registration in trusted non-3GPP access.
The TNGF completes the IPSec SA establishment as described in clause 4.12a.2.2
of TS 23.502 [3] and triggers establishment of UP resources towards the UE,
e.g. to create a first Child SA for the PDU Session.
After this step, the UE may start to send UL traffic via the new non-3GPP
access.
7\. The TNGF replies with Initial Context Setup Response, including AN tunnel
information.
8\. The AMF forwards the information to the SMF(s) and the SMF(s) provides the
tunnel information to the UPF(s). For MA PDU Sessions, the UPF starts to use
the trusted non-3GPP access as the non-3GPP access for the MA PDU Session,
i.e. untrusted non-3GPP access is not used for downlink traffic anymore. For
SA PDU Sessions, the downlink tunnel is switched to the trusted non-3GPP
access. The UPF still accepts uplink packets from the untrusted non-3GPP
access.
9\. The AMF triggers a AN release of the untrusted non-3GPP access if not done
in step 4. As a result of this procedure, user plane resources over untrusted
non-3GPP access of MA PDU is completely released. Also user plane resources of
SA PDU Session(s) are deactivated. The N3IWF does not need to signal to the UE
since the UE may not be reachable over the old non-3GPP access. Latest when
the UE recognize that user plane resources over untrusted non-3GPP access are
released, the UE starts to send traffic over trusted non-3GPP access.
10\. The AMF sends a NAS Registration Accept message to the UE, via the TNGF.
11\. The AMF may update the registration for non-3GPP access in UDM, by
providing the new RAT type.
12\. The UE may send a NAS Registration Complete message, as described in TS
23.502 [3].
### 6.16.4 Impacts on Existing Nodes and Functionality
UE:
\- Performs Registration with new indication for non-3GPP access switching.
\- Indicates to the SMF that the UE supports non-3GPP access switching during
the MA PDU Session Establishment.
\- May be able to temporarily maintain simultaneous parallel user plane tunnel
over untrusted 3GPP access and trusted non-3GPP access.
\- When the UE receives the Registration Accept message for the target
non-3GPP access, the UE considers that it is deregistered from the source
non-3GPP access.
AMF:
\- During the Registration procedure, indicate capability for non-3GPP access
switching to UE.
\- Update UDM with new RAT type when non-3GPP access switching is completed.
\- Notifies to the SMF in Nsmf_PDUSession_UpdateSMContext that the UE
requested non-3GPP access switching.
\- May be able to temporarily maintain two N2 connections for non-3GPP access
during the Registration procedure.
SMF:
\- Not trigger release of old UP/N3 if receiving an Update from AMF to
activate a new UP connection.
UPF:
\- None.
UDM:
\- Support for updating RAT type using Nudm_UECM Update.
## 6.17 Solution #5.6: Consolidated solution for traffic switching between two
non-3GPP access paths
### 6.17.1 Introduction
The solution in clause 6.17 addresses the objective of KI#5, i.e. it specifies
how the data traffic of an MA PDU Session can be switched between two non-3GPP
access paths, both of them using the same PLMN. The solution borrows several
aspects from solutions #5.2, #5.3 and #5.4.
### 6.17.2 High-level Description
The key principles of the solutions are listed below and are further detailed
in the next clause.
a. The UE applies the existing procedures to register to 5GC via a non-3GPP
access network. Optionally, the UE may also register to 5GC via a 3GPP access
network (e.g. via NG-RAN).
b. An MA PDU Session is established based on the existing procedures specified
in clause 4.22.2 of TS 23.502 [3]. In addition, during the MA PDU Session
establishment, the UE and the network indicate whether they support \"Non-3GPP
path switch\", i.e. whether they can switch the traffic of an MA PDU Session
from one Non-3GPP access path to another Non-3GPP access path.
c. If both the UE and the network support \"Non-3GPP path switch\", then the
following steps apply:
i) When the UE wants to switch the traffic of the MA PDU Session from the
existing non-3GPP access path to the new non-3GPP access path, the UE
initiates registration over the new non-3GPP access path and indicates that
the registration is for \"Non-3GPP path switch\". Also, the UE includes in the
\"List Of PDU Sessions To Be Activated\" the identity of the existing MA PDU
Session.
ii) A registration procedure (based on clause 4.2.2.2 of TS 23.502 [3]) takes
place over the new non-3GPP access path and the SMF triggers establishment of
user-plane resources for the MA PDU Session over the new non-3GPP access path.
At this point, the MA PDU Session has user-plane resources over the old
non-3GPP access path and over the new non-3GPP access path.
iii) The AMF updates its registration with the UDM for non-3GPP access and
initiates deregistration over the old non-3GPP access path. The deregistration
releases the user-plane resources over the old non-3GPP access and the UE and
UPF start using the new non-3GPP access for the MA PDU Session.
In order to support \"Non-3GPP path switch\" in a PLMN, it is assumed that all
AMFs supporting ATSSS in the PLMN are enhanced to support \"Non-3GPP path
switch\". This ensures that, if the UE establishes an MA PDU Session when
connected to one AMF and receives an indication that \"Non-3GPP path switch\"
is supported, the UE can assume the \"Non-3GPP path switch\" is still
supported after moving into the serving area of another AMF in the same PLMN.
### 6.17.3 Procedures
Figure 6.17.3-1 below depicts the key steps of the solution, which enables the
data traffic of an MA PDU Session to be switched from a non-3GPP access path
using a N3IWF to a non-3GPP access path using a TNGF. The same steps can be
used to switch the data traffic of an MA PDU Session between any non-3GPP
access paths (using either N3IWF or TNGF).
Figure 6.17.3-1: Procedure for enabling traffic switching between two non-3GPP
access paths
1\. Optionally, the UE performs an initial 5G registration over 3GPP access in
a PLMN. The selected AMF registers with UDM for 3GPP access and provides its
GUAMI and RAT type = NR.
2\. The UE selects an N3IWF and performs an initial 5G registration over
untrusted non-3GPP access in the same PLMN. The same AMF is selected, as the
one in the previous step. The AMF registers with UDM for non-3GPP access and
provides its GUAMI and RAT type = Untrusted WLAN.
3\. The UE requests an MA PDU Session, as specified in clause 4.22.2 of TS
23.502 [3]. Since the UE supports Non-3GPP path switch, the UE includes in the
UL NAS Transport message a Non-3GPP path switch supported indication. Based on
this indication, the AMF selects an SMF that supports Non-3GPP path switch and
sends a Create SM Context Request to SMF including a Non-3GPP path switch
indication which indicates that the AMF and the UE support Non-3GPP path
switch. The SMF registers with the UDM and additional steps are executed to
complete the MA PDU Session establishment including the establishment of user-
plane resource over 3GPP access and over untrusted non-3GPP access.
The PDU Session Establishment Accept message sent to UE indicates that
Non-3GPP path switch is supported for the MA PDU Session.
4\. The UE detects a trusted non-3GPP access network that supports 5G
connectivity to the same PLMN. The UE decides to switch the data traffic
transferred over the untrusted non-3GPP access of the MA PDU Session to the
detected trusted non-3GPP access network.
5\. For this purpose, the UE initiates a 5G registration over trusted non-3GPP
access and sends a Registration Request to the same AMF. The Registration
Request contains a Non-3GPP path switch indication (e.g. either a new
registration type = \"Non-3GPP path switch\" or a registration type =
\"Initial\" plus a new IE), which indicates that the registration over trusted
non-3GPP access is required for switching the data traffic of an MA PDU
Session to another non-3GPP access path. The Non-3GPP path switch indication
indicates to AMF that the existing registration via untrusted non-3GPP access
should not be released until the path switch is completed.
In the \"List of PDU Sessions To Be Activated\" the UE includes the identity
of the established MA PDU Session in order to trigger the establishment of
user-plane resources over the trusted non-3GPP access.
6\. Optionally, an authentication procedure may be executed.
7\. The normal SMC Request / Response messages are exchanged to setup NAS
security between the UE and the AMF over the trusted non-3GPP access.
8\. The AMF sends an Initial Context Setup Request to TNGF including the TNGF
key, which triggers the establishment of the NWt connection between the UE and
the TNGF.
9\. Since the UE provided a \"List of PDU Sessions To Be Activated\" including
the identity of the established MA PDU Session, the AMF sends an Update SM
Context Request to SMF to initiate the establishment of user-plane resources
over the trusted non-3GPP access for this MA PDU Session. The Update SM
Context Request contains a Non-3GPP path switch indication which indicates
that the requested update is for switching the data traffic of an MA PDU
Session to the trusted non-3GPP access and that the SMF shall not release the
existing user-plane resources over the untrusted non-3GPP access. These
resources are released later, in step 13.
10\. The user-plane resources over the trusted non-3GPP access are
established. At this point, the MA PDU Session has user-plane resources over
the untrusted non-3GPP access path, over the trusted non-3GPP access path, and
(optionally) over the 3GPP access path. The SMF initiates an N4 Session
Modification procedure with the selected UPF. The UPF may switch the downlink
traffic of the MA PDU Session from the untrusted non-3GPP access path to the
trusted non-3GPP access path upon receiving updated N4 rules with new AN
tunnel info from the SMF. The updated N4 rules indicate the target non-3GPP
access to switch traffic. The UE may switch the uplink traffic of the MA PDU
Session from the untrusted non-3GPP access path to the trusted non-3GPP access
path upon all IPsec Child SAs for the MA PDU Session over trusted non-3GPP
access path are established.
11\. The AMF updates its UDM registration for non-3GPP access by sending a
UECM Registration Request to UDM including RAT type = Trusted WLAN.
12\. Based on the current procedures, the UDM accepts the new registration for
non-3GPP access and notifies the AMF that the previous registration for
non-3GPP access (performed in step 2) is now deregistered.
13\. After updating the UDM, the AMF triggers an AN release procedure towards
the N3IWF to release the N2 connection and the user-plane resources over the
untrusted non-3GPP access.
14\. Finally, the registration procedure is completed by sending a
Registration Accept message to the UE. When the UE receives the Registration
Accept message, it considers that it is deregistered from the untrusted
non-3GPP access, and it is registered over the trusted non-3GPP access.
### 6.17.4 Impacts on Existing Nodes and Functionality
UE:
\- During the MA PDU Session Establishment, the UE indicates that it supports
non-3GPP path switch.
\- Performs registration by providing a Non-3GPP path switch indication. This
indication can be provided either as a new registration type or as a new IE.
\- Temporarily maintains simultaneous user-plane resources over the untrusted
3GPP access and over the trusted non-3GPP access.
\- When the UE receives the Registration Accept message for the new non-3GPP
access, the UE considers that it is deregistered from the old non-3GPP access.
AMF:
\- During the Registration procedure, the AMF updates the UDM registration for
non-3GPP access after the user-plane resources over the new non-3GPP access
are established.
\- Indicates to the SMF that the AMF and the UE support non-3GPP path switch
during the MA PDU Session Establishment.
\- Indicates to SMF that the UE requested non-3GPP path switch during the
Registration procedure.
\- Performs AN release over old access during the Registration procedure
SMF:
\- Indicates to UE whether the MA PDU Session supports non-3GPP path switch
during the MA PDU Session Establishment.
UPF:
\- Temporarily maintains simultaneous user-plane tunnels over untrusted
non-3GPP access and over trusted non-3GPP access.
## 6.18 Solution #3.7: Suspending the Redundancy Steering Mode
### 6.18.1 Introduction
Full traffic duplication can be expected to be used as one of the basic
configurations of Redundancy Steering Mode (RSM), since it is the easiest one
to implement and is applicable to all types of flows. However, full
duplication has the highest cost in terms of network resource utilization, and
inevitably increases network congestion. When the user plane is becoming
congested, blindly using traffic duplication can further increase network
congestion. Thus, though an individual UE would expect improved performance,
the collective impact of RSM on the overall network performance can be
negative. The network should support to enable suspend/reduce the duplication
for some time and to some extent.
### 6.18.2 High-level Description
The UPF is at the best position to identify the impact of duplication on the
system. Thus, when the UPF detects congestion, or when it considers that
duplication is not efficient (e.g. since the same packets are being lost on
both accesses due to UPF overload, the same performance would be achievable
even without duplication), it may override the RSM configuration and can
suspend for certain UEs or certain types of SDFs (e.g. for all Non-GBR SDFs)
by indicating the access that is suspended for traffic transport. Especially
for cases of full duplication, such an adjustment can rapidly address the
congestion issue. This adjustment is referred to as Duplication Adjustment
operation.
Editor\'s note: How the UPF decides when to apply Duplication adjustment
besides using implementation specific means is FFS.
When Duplication Adjustment operation is authorized by the PCF in the PCC
Rule, the SMF provides an indication for Duplication Adjustment in the ATSSS
Rule to the UE, and in the MAR to the UPF.
Once the need for duplication adjustment is identified, UPF can easily adapt
to such a situation by changing itself the duplication in the downlink.
Regarding the uplink though, the UE needs to be informed about this necessary
adjustment. This information can be provided by the UPF via user plane by
extending PMF Protocol with a new message. The new message can be implemented
similarly to the UE assistance provided by the UE to the network in UE-
assistance operation, with the difference that the network provides the
guidance to the UE and that the UE is obliged to follow the provided guidance.
Editor\'s note: Whether the UPF can only fully suspend duplication or could
also indicate the desired percentage of partial duplication as the necessary
adjustment is FFS.
Once the UPF decides to terminate the Duplication Adjustment operation, e.g.
when the congestion issue is resolved, the UPF sends a PMF protocol
termination message to the UE.
Remark: Duplication Adjustment can be achieved by updating the ATSSS/N4 rules,
but such a solution cannot adapt fast enough to dynamically changing user-
plane conditions
### 6.18.3 Procedures
Notice that all proposed solutions of KI#3 support full traffic duplication,
and hence suspending it temporarily is independent of the exact solution
finally adopted for normative work.
No impact to existing ATSSS procedures has been identified, other than the
Access Network Performance Measurements being extended with 2 new messages for
suspending and reactivating duplication.
### 6.18.4 Impacts on Existing Nodes and Functionality
The ATSSS rules and the N4 rules are enhanced with a new steering mode
definition and with new parameters, including the support of traffic
duplication suspension.
SMF
\- Based on the PCC rules, create ATSSS rules and N4 rules with the new RSM
data including an indication that the UE/UPF is allowed to suspend
duplication.
PCF
\- Provide PCC rules considering new RSM including an indication that the
UE/UPF is allowed to suspend duplication.
UPF:
\- If an indication that the UPF is allowed to suspend traffic duplication has
been received, UPF can adjust traffic duplication and indicate these changes
to a UE to apply the same for the uplink.
UE:
\- If an indication that the UPF is allowed to suspend traffic duplication has
been received in ATSSS rules, and upon receipt from the UPF duplication
updates, the UE applies UPF duplication guidance for the uplink, e.g.
suspending duplication on a certain access path.
# 7 Evaluation
Editor\'s note: This clause provides the evaluation of different solutions. It
may contain an evaluation for each Key Issue.
## 7.1 Evaluation for KI #2: New steering functionalities for non-TCP traffic
The main classes of solutions related to KI#2 are DCCP-based (#2.1) and QUIC-
based (#2.2 and #2.3). Additionally, solution #2.4 complements some of those
main solutions with methods to reduce header overhead.
Both classes of solutions support a \"Low-Layer\" mode, where the payload of
the MA-PDU session is an IP packet or an Ethernet frame. The QUIC-based class
of solutions also supports \"UDP proxying\", where the payload of the MA-PDU
session is a UDP payload (#2.2). Solution #2.4 details an aspect of \"Low-
Layer\" solutions, which enables bringing their user plane performance up to
par with the \"UDP proxying\" solution.
### 7.1.1 User Plane Performance Aspect
While the main solutions differ from per-packet overhead standpoint, solution
#2.4 describes how inner header compression can be used in the tunnel between
UE and UPF to limit overhead in some cases (#2.1 and #2.3). The estimated per-
packet overhead of all 3 solutions (#2.1, #2.2, and #2.3) becomes equivalent
to each other if header compression is used with #2.1 and #2.3.
Solution #2.2 does not require header compression to achieve its low per-
packet overhead. RoHC (or EHC) can be implemented with Solutions #2.1 and #2.3
to perform inner header compression in MA-PDU session endpoints (UE and UPF).
### 7.1.2 Summary of proposed steering functionalities
For KI#2, three solutions have been proposed:
1) Solution #2.1 (MP-DCCP-LL);
2) Solution #2.2 (MPQUIC); and
3) Solution #2.3 (MPQUIC-IP).
Solution #2.1 is based on the DCCP protocol and its multipath extension
(draft-ietf-tsvwg-multipath-dccp). This solution supports the transport of UDP
flows, IP flows and even Ethernet flows, over DCCP.
Solutions #2.2 and #2.3 are both based on the QUIC protocol, its multipath
extensions (draft-ietf-quic-multipath) and additional extensions defined in
IETF for supporting \"UDP proxying over HTTP\" and \"IP proxying over HTTP\"
respectively (see RFC 9298 and draft-ietf-masque-connect-ip). These solutions
support the transport of UDP flows and IP flows respectively, encapsulated in
HTTP/3.
Solution #2.2 supports UDP traffic only, while solution #2.3 supports IP and
UDP traffic. Solution #2.1 support IP, UDP and Ethernet traffic.
#### 7.1.2.1 Co-existence with MPTCP and ATSSS-LL
All three solutions #2.1, #2.2 and #2.3 are in principle capable to co-exist
with MPTCP and ATSSS-LL and can be chosen using the solutions defined N4 and
ATSSS rules.
Solutions #2.1 does not necessarily need any additional steering functionality
as it can handle all kinds of traffic.
### 7.1.3 Evaluation of steering functionalities for UDP traffic flows
#### 7.1.3.1 General
For supporting UDP traffic flows, two alternative solutions can be used:
Solution #2.1 (MP-DCCP-LL) and Solution #2.2 (MPQUIC). The following sub-
clauses discuss different aspects of these solutions.
The solution #2.3 may also be used for UDP traffic flows but this solution is
more suitable when IP traffic flows (other than UDP) should be supported,
thus, it should be considered separately.
#### 7.1.3.2 Allocation of UPF resources
As specified in clause 6.3.5, the MP-DCCP-LL solution requires the UPF to
allocate: one IP address and two ports (one per access type) per MP-DCCP
connection, as shown in the figure below. The UPF allocates the IP addresses
and ports for each MP-DCCP connection based on information received from SMF
(MP-DCCP-LL Control Information), which indicates how many MP-DCCP connections
are required. The SMF derives this information based on the PCC rules received
from PCF. If additional MP-DCCP connections are required during the lifetime
of the MA PDU Session, the SMF should ask UPF to allocate more resources for
these additional connections and then send a PDU Session Modification message
to UE including the allocated UPF resources.
Figure 7.1.3.2-1 (a)
On the contrary, the MPQUIC solution requires the allocation of one IP address
and one UDP port at the UPF, which are used for _all_ MPQUIC connections of a
UE. This is possible because the QUIC protocol can multiplex many connections
on the same UDP port (using the \"connection ID\" parameter). The UE receives
the IP address and UDP port at the UPF as part of the \"proxy information\" in
the PDU Session Establishment Accept (exactly the same as in MP-TCP). When the
UE needs to establish a new MPQUIC connection to UPF, the UE applies the
received \"proxy information\" and does not require additional resources to be
allocated at the UPF.
Figure 7.1.3.2-1 (b)
#### 7.1.3.3 Connections between UE and UPF
The MPQUIC solution requires one MPQUIC connection per QoS flow (see clause
6.11.2). Each UDP flow transferred via an MPQUIC connection is associated with
a unique QUIC stream on the connection and each QUIC stream is configured to
apply a steering mode. Thus, different steering modes can be applied per
MPQUIC connection.
The MP-DCCP-LL requires one connection per QoS flow and per Steering Mode (see
clause 6.3.2), so it needs much more connections than MPQUIC. The MP-DCCP-LL
connection management (adding / removing connections) is cumbersome: Every
time a new UDP flow should be transmitted using a steering mode for which no
MP-DCCP connection supports, a new MP-DCCP connection should be established
and the SMF should send a PDU Session Modification message with the parameters
(UPF address/ports) for this MP-DCCP connection.
The MP-DCCP-LL solution specifies that the UE receives \"MP-DCCP Connection
Setup Information\", which indicates the QoS flow and the steering mode
associated with each MP-DCCP connection. However, it does not specify how the
UPF knows the QoS flow and the steering mode associated with each MP-DCCP
connection. Without such information, the UPF cannot determine the MP-DCCP
connection that should be used for each DL packet. In the MPQUIC solution, the
QoS flow associated with an MPQUIC connection is indicated (as a new transport
parameter) during the connection setup.
When the UE creates a \"derived\" QoS rule (see TS 23.501 [2]), the MP-DCCP-LL
solution does not specify how an MP-DCCP connection can be created to carry
the traffic that matches this QoS rule. In case of the MPQUIC solution, when a
\"derived\" QoS rules is created, the UE establishes a new MPQUIC connection
and indicates to UPF the QFI associated with this connection (using a new QUIC
transport parameter).
#### 7.1.3.4 Application visibility
In some cases, it is beneficial that an application can provide information to
the underlying steering functionality, e.g. via an enhanced sockets API, such
as, when an application implements itself the QUIC protocol and use it for
reliable transport (using QUIC Streams). In this case, it could inform the
underlying steering functionality that it should apply unreliable transport
(e.g. using QUIC Datagrams) to avoid meltdown effects.
The MPQUIC steering functionality is a high-layer functionality implemented
higher in the protocol stack and can support interactions with the apps, e.g.
via an enhanced sockets API (which is outside the scope of this study).
#### 7.1.3.5 User-plane overhead
Both the MP-DCCP-LL and the MPQUIC send Ack packets to acknowledge successful
reception.
As shown in figure below, when two (or more) app payloads are provided to the
MPQUIC steering functionality, these payloads can be multiplexed in the same
QUIC packet, thus, reducing the user-plane overhead (this is a feature
supported by QUIC). In addition, a single UDP datagram can multiplex multiple
QUIC packets, which can further reduce the overhead.
NOTE: As a consequence of RFC 9000 [6] the precondition for possible
multiplexing of payload packets is that those payload packets fit completely
inside a single QUIC packet, which is limited by the maximum MTU size.
In case of MP-DCCP-LL, each app payload will be encapsulated into two IP
(inner) packets and will be transmitted with two DCCP-Data packets. However,
inner header compression (IHC) can be applied by MP-DCCP-LL to reduce the
overhead.
Figure 7.1.3.5-1
The table below provides an estimate of the size of the additional headers for
the solutions #2.1 and #2.2. Note that the exact estimation of the size of the
additional headers depends on the implementation (e.g. how a QUIC
implementation selects the size of the stream identity) and it is difficult to
be calculated. Therefore, the table below provides approximate numbers based
on some assumptions. One assumption is that the link-specific multipath IP
addresses in the UE and UPF are IPv4.
Table 7.1.3.5-1
+----------------------------------+----------------------------------+ | **Solution** | **Size of additional headers | | | [Bytes]** | +==================================+==================================+ | Solution #2.2 / | Size of additional headers = | | | IPv4 header (20) + UDP header | | Datagram mode 1 | (8) + QUIC short header (5) + | | | QUIC Datagram header (6) = 39 | | | bytes | | | | | | The QUIC short header size | | | depends on the length of the | | | Destination Connection ID (0-160 | | | bits) and the length of the | | | Packet Number (8-32 bits). It is | | | assumed that 16 bits are enough | | | for each field. | | | | | | The QUIC Datagram header | | | contains: | | | | | | Type: 1 byte | | | | | | Length: Variable-length integer | | | specifying the length of the | | | Datagram Data field in bytes. It | | | is assumed 2 bytes are enough. | | | | | | Quarter Stream Id: | | | Variable-length integer. It is | | | assumed that 2 bytes are enough | | | to support 65536 active streams | | | on an MPQUIC connection. | | | | | | Context Id: 1 byte | | | | | | Sequence number: 2 bytes | | | (assumed to be enough) | +----------------------------------+----------------------------------+ | Solution #2.2 / | As Datagram mode 1 but without | | | the sequence number (i.e. minus | | Datagram mode 2 | 2 bytes). | +----------------------------------+----------------------------------+ | Solution #2.2 / | Size of additional headers = | | | IPv4 header (20) + UDP header | | Stream mode | (8) + QUIC short header (5) + | | | QUIC Stream header (3) + | | | Datagram Capsule (5) = 41 bytes | | | | | | The QUIC Stream header contains: | | | | | | Type: 1 byte | | | | | | Stream Id: Assume 2 bytes are | | | enough to contain all stream ids | | | in each MPQUIC connection | | | | | | Offset: Optional, variable | | | length | | | | | | Length: Optional, variable | | | length | | | | | | The Datagram Capsule contains: | | | | | | Type: 1 byte | | | | | | Length: Variable-length integer. | | | It is assumed that 2 bytes are | | | enough. | | | | | | Quarter Stream Id: | | | Variable-length integer. It is | | | assumed that 2 bytes are enough | | | to support 65536 active streams | | | on an MPQUIC connection. | +----------------------------------+----------------------------------+ | Solution #2.1 / | Depending on short/long DCCP | | | header and the type of delay | | Inner IP = IPv4 (i.e. PDU | information exchange for | | session type = IPv4) | reordering: | | | | | | 55 bytes + 20 bytes for the | | | outer IPv4 header for short | | | header and DCCP timestamp | | | option. | | | | | | 65 bytes + 20 bytes for the | | | outer IPv4 header for long | | | header and MP_RTT option. | +----------------------------------+----------------------------------+ | Solution #2.1 / | Depending on short/long DCCP | | | header and the type of delay | | Inner IP = IPv6 (i.e. PDU | information exchange for | | session type = IPv6) | reordering: | | | | | | 75 bytes + 20 bytes for the | | | outer IPv4 header, for short | | | header and DCCP timestamp | | | option. | | | | | | 85 bytes + 20 bytes for the | | | outer IPv4 header, for long | | | header and MP_RTT option. | +----------------------------------+----------------------------------+
#### 7.1.3.6 Data encryption aspects
As specified in RFC 9001 (Using TLS to Secure QUIC), each QUIC connection is
established using TLS v1.3 handshake and all QUIC packets are encrypted, and
integrity protected using the negotiated TLS keys and algorithms. However, in
case of ATSSS_ph3, where QUIC is applied between the UE and UPF and where
access-level security mechanisms are used to protect the user-plane traffic,
the additional security mechanism in the QUIC layer is unnecessary. The MPQUIC
solution contains the following EN, so this issue is expected to be addressed
by SA WG3.
Editor\'s note: Whether and how encryption in the QUIC layer can be omitted is
FFS and need to be verified by SA WG3. The impact due to encryption regarding
overhead and performance is FFS.
It is noted that RFC 9150 \"TLS 1.3 Authentication and Integrity-Only Cipher
Suites\" defines cipher suites which \"provide server authentication and data
authenticity, but not data confidentiality.\"
The double-layer encryption is not an issue for MP-DCCP-LL, which relies on
existing access-level security mechanisms to protect the user-plane traffic.
However, the security aspects of MP-DCCP-LL will also have to be studied in SA
WG3 (as needed for every solution).
Figure 7.1.3.6-1
#### 7.1.3.7 Packet reordering and deduplication
Both MP-DCCP-LL and MPQUIC solutions provide the means to support packet
reordering and deduplication.
The MP-DCCP-LL solution mentions that \"MP-DCCP protocol itself does not
specify re-ordering mechanisms but provides path sequencing (DCCP packet
sequencing [11]), connection sequencing (MP_SEQ option [12]), and has inherent
latency (MP_RTT option [12]) or timing (DCCP timestamp option[11]) information
exchange, i.e. all properties that are necessary for the packet receiving
side, i.e. UE or UPF, to be able to implement re-ordering properly.\" Although
the MP-DCCP draft [12] states that \"The details of the transmission
scheduling mechanism and optional reordering mechanism are up to the sender
and receiver, respectively, and are outside the scope of the MP-DCCP
protocol,\" it is understood that such mechanisms can be considered and
possibly defined in stage 3.
The MPQUIC solution can readily support reordering and deduplication by
leveraging the existing QUIC stream mechanisms, which are applied in the
Stream transport mode. So, when the UDP traffic can be transferred in Stream
transport mode, no additional mechanisms need to be specified for supporting
packet reordering and deduplication.
In addition, the MPQUIC solution support Datagram mode 1 (see clause 6.11.3),
which supports unreliable transport and inserts sequence numbers in every UDP
data packet. In Datagram mode 1, every UDP packet is encapsulated into a QUIC
Datagram frame, which also carries a Context ID and a sequence number. The
definition of this Context ID, as well as other aspects of Datagram mode 1
(e.g. reordering mechanisms), will be considered in stage 3.
#### 7.1.3.8 IETF Support
The QUIC multipath draft is planned to be published as a Standards Track RFC,
while the DCCP multipath draft is planned to be published as an Experimental
RFC.
As specified in RFC 2026:
\"Specifications that are not on the standards track are labelled with one of
three \"off-track\" maturity levels: \"Experimental\", \"Informational\", or
\"Historic\". The documents bearing these labels are not Internet Standards in
any sense.\"
NOTE: The TCP converter used by the MPTCP proxy is based on the Experimental
RFC 8803.
## 7.2 Evaluation for KI #3: Support of redundant traffic steering
### 7.2.1 Considerations on RSM with Duplication Criteria
In order to support redundant traffic steering, there are solution #3.1, 3.2,
3.3, 3.4, 3.5 and 3.6 proposed to define the Redundant Steering Mode (RSM). If
this new steering mode is applied by UE and UPF, the traffic is transmitted
via 3GPP and non-3GPP accesses in a redundant way.
Considering redundant transmission is costly, which consumes at maximum double
resources compared with normal transmission without duplication, duplication
criteria may be defined to indicate when RSM should be initiated. In other
words, predefined conditions or criteria, as proposed by quite a few
solutions, such as solution 3.1, 3.2, 3.3 and 3.4, can be defined as trigger
points for initiating redundant transmission. The duplication criteria may not
always be needed as, in some cases, applications may always require redundant
transmission without criteria for activation / deactivation.
One of the major benefits of redundant transmission is to reduce packet loss
rate, therefore Packet loss rate should be taken as one of the criteria.
Except packet loss rate, other criteria proposed by solution 3.3 and / or
solution 3.4 to trigger redundant transmission, include Round Trip Time (RTT),
jitter, percentage of duplicated traffic and load on an access network.
Another benefit of redundant transmission is to reduce the RTT. If the RTT via
both accesses cannot satisfy the traffic requirement, the redundant
transmission can reduce the RTT because the receiver always selects the packet
that arrives faster. Note that if the RTT over 3GPP access is smaller than the
RTT over non-3GPP access, this does not mean that all packets arrive faster
via 3GPP access. Some percentage of packets will arrive faster via non-3GPP
and since the receiver always selects the packet that arrives first, this
means that the RTT due to redundant transmission will be smaller than the RTT
over 3GPP access and than the RTT over non-3GPP access. However, if both
accesses exceed the threshold, but the RTT differs a lot between the two
accesses, duplication will not help much. A few packets may arrive earlier via
the slow access (depending on the jitter) but the max delay may not decrease
in any significant way. Redundant steering based on RTT threshold may thus not
be better than using Lowest-Delay steering mode but consumes more resources.
Editor\'s note: Evaluation of the duplication factor is FFS.
### 7.2.2 Considerations on RSM without Duplication Criteria
Some of the solutions (#3.3 and #3.4) propose that the core network can decide
how much of the traffic is duplicated on either of the accesses and provides
this information in ATSSS rules to the UE and in the MAR rules to the UPF
without indicating any duplication criteria. The amount of traffic that is
duplicated on the secondary access is defined by a duplication factor between
0% and 100%. This can be used to limit the number of duplicated packets to the
ones seen as important for UE and UPF.
Editor\'s note: Evaluation of the duplication factor is FFS.
### 7.2.3 Considerations on RSM suspension
Whereas Duplication Criteria control the activation of duplication based on
the state of each of the available accesses, the overall network situation is
not considered by any of the traffic duplication solutions. Thus, it can
happen that the network is congested and activating traffic duplication even
worsens this situation. This issue would be amplified if only full duplication
is applied. Solution #3.7 proposes to temporarily suspend the use of
duplication, whenever it is beneficial for the overall network performance,
e.g. due to UPF congestion. Although this can be performed by updating ATSSS
and N4 rules, such a pure control-plane solution would be slow and not
flexible enough, as it requires the coordination of several network entities.
Instead, the UPF can react immediately, and user-plane suspension can be
implemented by extensions of the PMF protocol as per solution #3.7.
## 7.3 Evaluation for KI #5: Switching traffic of an MA PDU Session between
two non-3GPP access paths
There are two categories of solutions for KI#5, called Option 1 and Option 2:
\- Option 1: Switching the data traffic after the Registration procedure
(Solution #5.1, #5.3 and #5.4):
\- These solutions propose to perform the Registration procedure over the new
non-3GPP access first and after the procedure is finishes, the UE adds a new
leg to the existing MA PDU Session by re-using existing access addition
procedure. After the access addition is completed, the network performs access
release / deregistration over the old non-3GPP access.
The main impact of these solutions is maintaining two simultaneous
registrations over two non-3GPP accesses. There may exist undisclosed impacts
to the system as the overall solution describes only access switching aspects
and other procedures are not investigated in detail.
In solution #5.1, #5.3 there is impact to the UE, AMF, SMF, UPF and UDM. In
solution #5.4, there is no clear description that there is impact to the UDM.
However, it seems that the UDM needs to maintain two simultaneous registration
states so there is impact to the UDM.
\- Option 2: Switching the data traffic during the Registration procedure
(Solution #5.2, #5.5 and #5.6):
\- These solutions propose to perform access switching during the Registration
procedure over the new non-3GPP access, i.e. there is no need to trigger
additional procedure for access switching after the Registration procedure.
In these solutions, there is no need to maintain simultaneous registration
over two non-3GPP accesses. This enables to perform access switching by
registering over the new non-3GPP access without need to trigger another
session related procedure to add additional access to the existing MA PDU
Session.
In solution #5.2 and #5.6, there is impact to the UE, AMF, SMF, UPF while in
solution #5.5 there is additional impact to the UDM.
Several aspects of Option 1 and Option 2 are considered below.
**Path switching (PS) capability indication** :
For option 1:
\- UE capability indication - since the traffic switching is initiated by UE,
the UE shall be able to support traffic switching. Limiting UE\'s path
switching capability by include indication in its subscription is not
necessary since there is no capability indication in subscription for path
switching within 3GPP accesses.
\- Network capability indication - an indication is sent to the UE before
switching traffic in order to prevent the UE from initiating the path
switching when the AMF/SMF does not support it.
**Path switching (PS) indication** :
For option 1:
\- AMF needs to be informed that this registration via target non-3GPP access
is intended for switching the traffic between two non-3GPP access paths. It is
used by the AMF to maintain temporary dual-registration via two non-3GPP
accesses during the PS procedure. This indication is necessary to allow the
AMF to distinguish the scenario where the registration shall be immediately
replaced, or temporary registration is maintained for 2 N3GPP accesses.
\- SMF needs to be informed that this PDU session establishment request via
non-3GPP access is intended for switching the traffic between two non-3GPP
access paths. in order to allow the SMF to establish new UP resources on the
target access while existing UP resources in source non-3GPP access are
preserved.
\- Considering that these two indicators are both necessary and they are only
applicable for non-3GPP traffic switching, it is preferable to define only 1
indicator (information element) which is used by both AMF and SMF.
For option 2:
\- In this option the UE register for the purpose of traffic switching. When
the AMF receives the path switching indication from UE, it shall update the SM
context of UE in order to trigger the user-plane resources establishment. The
registration results would also indicate whether the path switching between
two non-3GPP accesses is success or not. Therefore, from the point of view of
the whole procedure, the definition of a new registration type is preferred
for option 2.
**List of PDU session indication** :
For option 1:
\- Since UE performs PDU session establishment after the end of registration
procedure, the UE can indicate the list of PDU session that wants to move in
PDU session establishment and therefore it is not necessary to include list of
PDU session in Registration Request procedures.
For option 2:
\- List of PDU session is already supported in the Registration message. It
can used for SMF to distinguish which PDU session the UE is requesting to
move, thus it is necessary.
**Deregistration timer** :
For option 1:
\- The AMF needs to determine the maximum time for maintaining the UE
registered via two non-3GPP access in order to allow the UE to perform the
establishment of PDU session on target non-3GPP access, but to avoid also to
keep for a long time the two registrations, for example when the UE does not
establish PDU session on target access for some unexpected reason. The usage
of a timer is not necessary for SMF.
For option 2:
\- It is not required since PS is completed during registration.
**Maintenance of N2 sessions**
For option 1:
\- The UE registers in new non-3GPP access while the UE is still registered in
the old non-3GPP access. The AMF maintains two non-3GPP access registrations
(and possibly a 3GPP access registration) while a PDU Session Establishment
procedure is performed. The AMF thus needs to maintain two non-3GPP N2
sessions across several procedures.
For option 2:
\- The path switch takes place during a single procedure (Registration). In
order to allow the old user plane to be available while the new user plane is
being established, the AMF can establish a N2 session in new non-3GPP access
before releasing the N2 session in old non-3GPP access. The AMF thus needs to
maintain two non-3GPP N2 sessions within the Registration procedure.
Alternatively, the AMF can release the old N2 session before establishing the
new N2 session, and in that case, AMF always has only a single N2 session for
non-3GPP access.
**ATSSS rules update** :
\- When UE completes user-plane resources establishment on target non-3GPP
access, two non-3GPP accesses paths can be available before that the user-
plane resource of source non-3GPP access would be released. If UE has UL
traffic to be transmitted, the UE may select either the target or the source
non-3GPP access.
For option 1:
\- If source non-3GPP access is selected, the service over non-3GPP access
would be interrupted when user-plane resource of source non-3GPP access is
released afterward. Enhancements on ATSSS rule with indication of the RAT type
(Trusted or Untrusted N3GPP) to be used would solve the issue and improve the
service continuity. Thus, updated ATSSS rule with the indication of RAT-type
to be used is required.
For option 2:
\- The UE switches the UL to the new non-3GPP access when the new non-3GPP
access user plane connectivity is available. There is no need to modify the
ATSSS rules due to the path switch.
**N4 rules update** :
\- Since the AN tunnel info changes after switching which is allocated by the
target N3GPP access node (e.g. N3IWF or TNGF), the N4 rules including the
target AN tunnel info need to be updated to UPF.
**PS for SA PDU session** :
For option 1 & 2:
\- All existing solutions can support PS for single access PDU session between
Trusted and Untrusted network, i.e. with change of RAT type.
**PS for same RAT type** :
For option 1 & 2:
\- The Trusted and Untrusted N3GPP access mandates the support of MOBIKE (RFC
4555 [35]) which enables the mobility of one peer end points (but not of both
end point at the same time). For example, in TS 23502 [3] for Trusted N3GPP is
defined the following:
_\- \"In step 13c, the TNGF provides to UE (a) an \"inner\" IP address, (b) a
NAS_IP_ADDRESS and a TCP port number and (c) a DSCP value. After this step, an
IPsec SA is established between the UE and TNGF. This is referred to as the
\"signalling IPsec SA\" and operates in Tunnel mode. Operation in Tunnel mode
enables the use of MOBIKE [40] for re-establishing the IPsec SAs when the IP
address of the UE changes during mobility events. All IP packets exchanged
between the UE and TNGF via the \"signalling IPsec SA\" shall be marked with
the above DSCP value. The UE and the TNAP may map the DSCP value to a QoS
level (e.g. to an EDCA Access Class [48]) supported by the underlying non-3GPP
Access Network. The mapping of a DSCP value to a QoS level of the non-3GPP
Access Network is outside the scope of 3GPP_
\- Therefore, mobility of UE between different access network without changing
of anchor Access node, as shown in figure 1, is currently supported.
\- The mobility of UE between the same access network type (RAT-type) with
changing of anchor Access node, as shown in figure 2, is not supported by
MOBIKE (see RFC 4555 [35]) hence it would be good if the solution selected for
support PS for SA PDU session between Trusted and Untrusted N3GPP access
supports to the scenario of PS for SA PDU session without changing of RAT
type.
Figure 7.3-1: Mobility of UE between 2 N3GPP access networks without changing
of access node
Figure 7.3-2: Mobility of UE between 2 N3GPP access networks with changing of
AN node (e.g. N3IWF)
The following table lists evaluation aspects of existing proposed solutions.
Table 7.3-1: Evaluation aspects of solutions
Sol Handover Procedure Capability Indication Handover Indicator List of PDU
Session ATSSS Rules Update SA PDU Session Support Deregistration Timer
* * *
#5.1 Separate, option 1 Not mentioned IE Indicator for both AMF and SMF
Included in PDU session establishment procedure Required to indicate target
N3GPP access Yes Applied for AMF #5.2 Combined, option 2 Include both UE and
network capability indication New Registration Type for AMF and IE indicator
for SMF Included in Registration Request procedure Not mentioned Yes Not
needed #5.3 Separate, option 1 Include only AMF capability indication New
Registration Type for AMF and IE indicator for SMF Included in PDU session
establishment procedure Not mentioned Yes Applied for AMF #5.4 Separate,
option 1 Include only UE capability indication IE Indicator for both AMF and
SMF Included in both Registration Request procedure and PDU session
establishment procedure Not mentioned Yes Applied for AMF and SMF #5.5
Combined, option 2 Include both UE and network capability indication New
Registration Type for AMF and IE indicator for SMF Included in Registration
Request procedure Not mentioned Yes Not needed #5.6 Combined, option 2 Include
both UE and network capability indication IE Indicator for both AMF and SMF
Included in Registration Request procedure Not Mention Yes Not needed
Additional evaluation aspects for the KI#5 solutions are considered below. In
particular, the following key aspects are considered:
\- New registration type = \"non-3GPP path switch\" or registration type =
\"initial\" + new IE or registration type = \"mobility\" + new IE.
\- Capability exchange between UE and network:
\- 5G Session Management (5GSM) capability exchange.
\- 5G Mobility Management (5GMM) capability exchange.
\- PDU Session Establishment in the new non-3GPP access without requiring UE
initiated PDU Session Establishment/Modification signalling.
\- AMF update of RAT Type in UDM after user plane resources establishment in
the new non-3GPP access.
\- Timer related to de-registration of new non-3GPP access.
\- Impacts on existing Nodes and Functionality.
Tables 7.3-2 & 7.3-3 compare several key aspects where they differ or are
align.
Table 7.3-2: Comparison of Solutions to Evaluation Items
+---------+---------+---------+---------+---------+---------+---------+ | S | New | Cap | PDU | UDM | AMF | Timer | | olution | Regis | ability | Session | subsc | update | for | | # & | tration | e | Establ | ription | of RAT | d | | Title | Type or | xchange | ishment | needed | Type in | e-regis | | | New IE | between | in the | for | UDM | tration | | | for | UE & | new | ATSSS | after | of new | | | Path | network | N3GPP | path | User | N3GPP | | | Switch | | access | sw | Plane | Access | | | Ind | (5GSM | without | itching | Re | | | | ication | or 5GMM | re | | sources | | | | | layer) | quiring | | establ | | | | | | UE | | ishment | | | | | | in | | in the | | | | | | itiated | | new | | | | | | PDU | | N3GPP | | | | | | Session | | Access | | | | | | Estab | | | | | | | | lishmen | | | | | | | | t/Modif | | | | | | | | ication | | | | | | | | sig | | | | | | | | nalling | | | | +=========+=========+=========+=========+=========+=========+=========+ | #5.1: | New | No | No | No | No | Yes | | Support | Regis | | | | | (AMF) | | traffic | tration | | | | | | | sw | Type | | | | | | | itching | | | | | | | | between | | | | | | | | two | | | | | | | | n | | | | | | | | on-3GPP | | | | | | | | paths | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #5.2: | New | Yes | Yes | No | Yes | No | | D | Regis | | | | | | | elaying | tration | (5GSM) | | | | | | UDM | Type | | | | | | | Regis | | | | | | | | tration | | | | | | | | until | | | | | | | | n | | | | | | | | on-3GPP | | | | | | | | access | | | | | | | | sw | | | | | | | | itching | | | | | | | | co | | | | | | | | mpletes | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #5.3: | Either | Yes | No | No | Yes | Yes | | Path | | | | | | (AMF) | | sw | | (5GMM) | | | | | | itching | | | | | | | | between | | | | | | | | n | | | | | | | | on-3GPP | | | | | | | | a | | | | | | | | ccesses | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #5.4: | New IE | Yes | No | No | Yes | Yes | | N | | | | | | (AMF & | | on-3GPP | | (5GMM) | | | | SMF) | | access | | | | | | | | path | | | | | | | | sw | | | | | | | | itching | | | | | | | | in MA | | | | | | | | PDU | | | | | | | | Session | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #5.5: | Either | Yes | Yes | No | Yes | No | | N | (Ed | | | | | | | on-3GPP | itor\'s | (5GSM) | | | | | | path | Note) | | | | | | | switch | | (Ed | | | | | | during | | itor\'s | | | | | | Regis | | Note) | | | | | | tration | | | | | | | | in new | | | | | | | | n | | | | | | | | on-3GPP | | | | | | | | access | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #5.6: | Either | Yes | Yes | No | Yes | No | | Conso | | | | | | | | lidated | | (5GSM) | | | | | | s | | | | | | | | olution | | | | | | | | for | | | | | | | | traffic | | | | | | | | sw | | | | | | | | itching | | | | | | | | between | | | | | | | | two | | | | | | | | n | | | | | | | | on-3GPP | | | | | | | | access | | | | | | | | paths | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
Table 7.3-3: Comparison of Solutions to Impacts on existing Nodes and
Functionality
Solution # & Title Impacts on Existing Nodes & Functionality
* * *
                                                                                         UE                                          AMF   SMF   UPF   UDM
#5.1: Support traffic switching between two non-3GPP paths Yes Yes Yes Yes Yes
#5.2: Delaying UDM Registration until non-3GPP access switching completes Yes
Yes Yes Yes No #5.3: Path switching between non-3GPP accesses Yes Yes Yes Yes
Yes #5.4: Non-3GPP access path switching in MA PDU Session Yes Yes Yes Yes Yes
#5.5: Non-3GPP path switch during Registration in new non-3GPP access Yes Yes
Yes Yes Yes #5.6: Consolidated solution for traffic switching between two
non-3GPP access paths Yes Yes Yes Yes No
## 7.4 Evaluation for KI #6: Support non-3GPP access leg of MA-PDU Session
with PDN connection in EPC
Solution #6.1 addresses KI#6 to support the non-3GPP access leg of MA-PDU
Session with PDN connection in EPC. This solution also supports the mobility
procedure from 5GS to EPS. It applies the similar mechanism as the solution
for MA-PDU session with one leg via non-3GPP access to 5GC and one leg via
3GPP access to EPC, as defined in Rel-17, with a bit impact on the ePDG and
PGW-C+SMF to support APCO IE to transport the ATSSS related parameters.
# 8 Conclusions
Editor\'s note: This clause enlists the conclusions of the study, including
agreements for work to be done in the normative phase.
## 8.1 Conclusions for KI #2: New steering functionalities for non-TCP traffic
It is concluded that:
a) For supporting multipath transport of UDP flows between the UE and UPF, a
high-layer steering functionality will be specified during the normative
phase, which will be based on solution #2.2: \"MPQUIC steering functionality
using UDP proxying over HTTP\".
\- The specified high-layer steering functionality shall be able to support
all ATSSS steering modes (i.e. the redundant steering mode and all other
steering modes defined in Rel-17).
NOTE 1: When the PCF selects a steering mode for a UDP flow and this steering
mode is supported by ATSSS-LL (e.g. Active-Standby), the PCF can select to use
the MPQUIC steering functionality if additional features, which are not
supported by the ATSSS-LL steering functionality and PMF, are required for the
traffic steering/switching/splitting of the UDP flow.
NOTE 2: SA WG3 can study security optimizations that can improve the user-
plane performance, such as whether the encryption in the QUIC layer can be
omitted.
## 8.2 Conclusions for KI #3: Support of redundant traffic steering
A Redundant Steering Mode (RSM) shall be defined in the normative phase, which
supports the following features:
1) The PCF decides the SDF(s) for which RSM should be applied based on its own
criteria and/or based on information received from AFs.
2) Duplication criteria may be provided by PCF for an SDF using a non-GBR QoS
flow. Duplication criteria shall not be provided for SDFs using GBR QoS flows.
3) When duplication criteria are not provided for an SDF, then RSM operates in
static mode. In this mode:
\- The network may provide a Primary Access to instruct the UE/UPF that the
UE/UPF shall send all data packets of the SDF on the Primary Access and may
duplicate data packets of the SDF on the other, secondary access. How many and
what data packets are duplicated on the secondary access is chosen by the UE
and UPF based on their implementation. The primary access is selected by the
PCF.
\- If the network does not provide Primary Access to UE/UPF, the UE/UPF shall
send all data packets of the SDF on both accesses.
An example of ATSSS rule using RSM is static mode is shown below:
\- Traffic descriptor
\- Application identity: com.example.app0
\- Protocol: TCP
\- Access Selection descriptor
\- Steering functionality: MPTCP
\- Steering mode: Redundant
This means that:
\- Redundant traffic steering is applied by the MPTCP steering functionality
to the TCP traffic of application \"com.example.app0\".
\- 100% of the traffic is duplicated over both accesses.
4) When duplication criteria are provided for an SDF, then RSM operates in
dynamic mode. In this mode:
\- When the duplication criteria are fulfilled on both accesses, the UE/UPF
shall duplicate the traffic of the SDF on both accesses.
\- When the duplication criteria are fulfilled on one access only, the UE/UPF
shall send the traffic of the SDF over the other access only.
\- When the duplication criteria are not fulfilled on both accesses, the
UE/UPF shall send the traffic of the SDF over the \"primary\" access. The
\"primary\" access may be selected by PCF and indicated to UE and UPF in ATSSS
and N4 rules or may be selected by UE/UPF based on their own implementation
(e.g. using the best performing access). If the measurements are not available
to evaluate the duplication criteria for an access, it is assumed that the
duplication criteria are not fulfilled on this access. If the duplication
criteria are fulfilled again over one access the UE/UPF should deactivated the
RSM. The UE/UPF sends the traffic of the SDF over the access only.
NOTE 1: For example, the duplication criterion \"Max PLR = 0.1%\" is fulfilled
on one access when the measured PLR on this access exceeds the 0.1% threshold.
5) The duplication criteria contain either threshold values for Packet Loss
Rate (PLR) or threshold values for Round Trip Time (RTT).
\- When only a PLR threshold is provided for an SDF and the measured PLR
exceeds this threshold on both accesses, the UE/UPF shall duplicate the
traffic of the SDF on both accesses.
\- When only a RTT threshold is provided for an SDF and the measured RTT
exceeds this threshold on both accesses, the UE and UPF decide independently
to initiate packet duplication or not based on their own implementation.
NOTE 2: For example, the UE/UPF can decide to initiate packet duplication only
when the values of jitter on each access and the difference of values of RTT
indicate that the packet duplication is expected to reduce the overall RTT for
the SDF.
6) The existing structure of ATSSS/N4 rules shall be re-used with enhancements
for supporting RSM. An example of an ATSSS rule using dynamic RSM is shown
below.
\- Traffic descriptor
\- Application identity: com.example.app1
\- Protocol: TCP
\- Access Selection descriptor
\- Steering functionality: MPTCP
\- Steering mode: Redundant
\- Steering Mode Information: Primary access=3GPP
\- Threshold Values: Max PLR = 0.1%
This ATSSS rule indicates that:
\- Redundant traffic steering shall apply to the TCP traffic of application
\"com.example.app1\".
\- If the measured PLR exceeds 0.1% on both accesses (duplication criteria
fulfilled on both accesses), then all matched traffic shall be duplicated on
both accesses.
\- If the measured PLR does not exceed 0.1% on both accesses, then all matched
traffic shall be sent over 3GPP access only (as the primary access).
\- If the measured PLR does not exceed 0.1% on one access only (either 3GPP or
non-3GPP), then all matched traffic shall be sent over this access.
7) The redundant traffic steering shall be applicable to both GBR and non-GBR
traffic. For GBR traffic, the SMF shall provide the GBR QoS profile to both
accesses.
8) The Nnef_AFsessionWithQoS API can be used by an AF to indicate the desired
packet delay and/or packet loss rate for a data flow. This information can be
considered by PCF when deciding the steering mode for this data flow and may
influence when traffic duplication is activated or deactivated.
9) The RSM does not apply to the ATSSS-LL steering functionality.
10) UPF can suspend traffic duplication for a UE, e.g. in case of locally
detected UPF congestion, via an extension of the PMF protocol. How UPF
determines to suspend traffic duplication or reactivate duplication is
implementation specific. It is up to UPF to decide for which UEs and/or types
of SDFs (e.g. all non-GBR SDFs) traffic duplication is suspended. UPF can at
any time decide to terminate duplication suspension for one or several UEs via
the PMF protocol.
Editor\'s note: Additional bullets may be added before the completion of this
study. It should also be defined how the steering functionality handles the
duplicated packets.
## 8.3 Conclusions for KI #5: Switching traffic of an MA PDU Session between
two non-3GPP access paths
The solution to be specified in the normative phase shall support the
following principles:
1) The path switching between non-3GPP accesses is performed during the
Registration procedure. The UE sends a Registration Request message with the
Registration type value set to \"Mobility Registration Update\" and optionally
a new parameter indicating \"Non-3GPP path switching\" via the target non-3GPP
access network and also requests user-plane establishment using the \"PDU
Sessions to be activated\" parameter. There are two options for non-3GPP path
switching as follows:
\- Non-3GPP path switching without releasing AN resources over old non-3GPP
access during switching procedure. In this option, user plane resources of old
non-3GPP access is kept until user plane resources are established over the
new non-3GPP access. The details are described in bullet 6.A.
\- Non-3GPP path switching with releasing AN resources over old non-3GPP
access during switching procedure. In this option, user plane resources of the
old non-3GPP access is released first and then user plane resources are
established over the new non-3GPP access. The details are described in bullet
6.B.
\- The UE does not perform non-3GPP path switching if the PLMN of the selected
target non-3GPP AN is different from the PLMN of the source non-3GPP AN.
2) The AMF updates the registration for non-3GPP access in UDM after the data
traffic is switched to the new access via Nudm_UECM_Registration.
3) Path switching between any two non-3GPP accesses except wireline shall be
supported, (i.e. trusted to trusted, trusted to untrusted, untrusted to
trusted, or untrusted to untrusted).
4) Capability exchange between UE and network shall be performed.
\- If the AMF supports non-3GPP path switching, the AMF indicates whether the
AMF supports non-3GPP switching to the UE during the Registration procedure.
\- During the MA PDU Session establishment, the UE indicates whether the UE
supports non-3GPP path switching to the AMF.
\- If the AMF supports non-3GPP path switching, the AMF selects the SMF that
supports non-3GPP path switching and indicates whether the UE supports
non-3GPP path switching to the SMF when the AMF sends PDU Session
Establishment Request message.
\- If the AMF and SMF support non-3GPP path switching, the SMF indicates
whether the network supports non-3GPP path switching in the PDU Session
Establishment Accept message.
5) When the UE performs non-3GPP path switching, the UE includes the identity
of the established MA PDU Session in the \"List of PDU Sessions To Be
Activated\".
NOTE 1: Whether the UE can also indicate SA PDU Session in the \"List of PDU
Sessions To Be Activated\" will be determined during the normative phase. This
enables SA PDU Sessions to be moved between non-3GPP accesses.
6) When non-3GPP path switching is performed:
\- The UE can perform non-3GPP path switching when it receives capability
indication during the Registration procedure.
\- A. For non-3GPP path switching without releasing AN resources over old
non-3GPP access during switching procedure
\- The UE performs mobility registration procedure including \"Non-3GPP path
switching\" indication in case the UE supports to maintain the old non-3GPP
access while performing Registration over the new non-3GPP access.
\- If the UE cannot maintain connection over old non-3GPP access while
performing Registration over the new non-3GPP access, the UE does not provide
the Non-3GPP path switching\" indication. This case is described in bullet
6.B.
\- If the AMF receives Registration Request message with \"Non-3GPP path
switching\" indication, and the AMF supports to maintain the old non-3GPP N2
connection while establishing the new non-3GPP N2 connection, the AMF does not
trigger AN release procedure over old non-3GPP access and includes \"Non-3GPP
path switching\" indication in Nsmf_PDUSession_UpdateSMContext request. If the
SMF receives this indication, the SMF does not release the existing user-plane
resources of old non-3GPP access.
\- The UE and UPF start to send traffic over the new non-3GPP access when user
plane resources are established over new non-3GPP access. No need to enhance
ATSSS rule and N4 rule to support non-3GPP path switching.
\- The AMF updates UDM and triggers AN release procedure over the old non-3GPP
access.
\- The AMF provides Registration Accept to the UE.
\- B. For non-3GPP path switching with releasing AN resources over old
non-3GPP access during switching procedure
\- The UE performs mobility registration procedure without including
\"Non-3GPP path switching\" indication.
\- If the AMF receives Registration Request message without \"Non-3GPP path
switching\" indication, the AMF triggers AN release procedure over old
non-3GPP access before notifying SMF about the user plane activation in new
non-3GPP access.
\- The UE and UPF start to send traffic over the new non-3GPP access when user
plane resources are established over new non-3GPP access. No need to enhance
ATSSS rule and N4 rule to support non-3GPP path switching.
\- The AMF updates UDM and provides Registration Accept to the UE.
\- If the AMF receives Registration Request message with \"Non-3GPP path
switching\" indication, and the AMF does not support to maintain the old
non-3GPP N2 connection while establishing the new non-3GPP N2 connection, the
AMF triggers the AN release procedure, before triggering activation of the new
N2 connection. During the AN release procedure, the AMF may notify SMF before
sending the N2 release request to old non-3GPP AN.
NOTE 2: The non-3GPP access switching is intended to be the switch between two
different RAT-types, i.e. from Trusted N3GPP access to untrusted N3GPP access
and vice versa, or the scenario of UE simultaneously moving of both IPsec
peers in the same RAT-type (i.e. UE local IP address and the anchor N3IWF/TNGF
change) or the scenario of changing to different N3IWF/TNGF without changing
UE local IP address, since the scenario of UE moving without changing the
N3GPP access node anchor is supported based on RFC 4555 MOBIKE support by
IKEv2 from Rel-15.
## 8.4 Conclusions for KI #6: Supporting MA PDU Session with one 3GPP access
path via 5GC and one non-3GPP access path via ePDG/EPC
Solution #6.1 is concluded as baseline for normative work.
#
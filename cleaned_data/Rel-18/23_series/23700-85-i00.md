# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, certain modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
NOTE 1: The constructions \"shall\" and \"shall not\" are confined to the
context of normative provisions, and do not appear in Technical Reports.
NOTE 2: The constructions \"must\" and \"must not\" are not used as
substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as
possible, and they are not used in a normative context except in a direct
citation from an external, referenced, non-3GPP document, or so as to maintain
continuity of style when extending or modifying the provisions of such a
referenced document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
NOTE 3: The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
NOTE 4: The constructions \"can\" and \"cannot\" shall not to be used as
substitutes for \"may\" and \"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
NOTE 5: The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
This study focuses on key issue description, solution and conclusion on the
enhancement of 5G UE Policy aspect by covering following objectives:
\- URSP rule provisioning and updating procedures for home-routed and LBO
roaming scenario, while keeping the existing framework of policy control based
on HPLMN.
\- Investigate whether and how the network can be made aware when the UE
enforces URSP rule and investigate whether and what actions the 5G network can
perform.
\- Investigate if enhancements are needed for provisioning UE with consistent
URSP across 5GC and EPC, and study the mechanism if needed.
\- Investigate how to support standardized and operator-specific traffic
categories in the traffic descriptor of URSP.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
[4] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS); Stage 2\".
[5] 3GPP TS 23.548: \"5G System Enhancements for Edge Computing; Stage 2\".
[6] 3GPP TS 23.434: \"Service Enabler Architecture Layer for Verticals (SEAL);
Functional architecture and information flows\".
[7] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[8] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[9] 3GPP TS 29.525: \"5G System; UE Policy Control Service; Stage 3\".
[10] 3GPP TS 24.526: \"User Equipment (UE) policies for 5G System (5GS); Stage
3\".
[11] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".
[12] 3GPP TS 23.304: \"Proximity based Service (ProSe) in the 5G System (5GS);
Stage 2\".
[13] 3GPP TS 32.421: \"Telecommunication Management; Subscriber and equipment
trace; Trace concepts and requirements\".
[14] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
nodes\".
[15] 3GPP TS 29.519: \"5G System; Usage of the Unified Data Repository Service
for Policy Data, Application Data and Structured Data for Exposure; Stage 3\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
# 4 Architectural Assumptions and Principles
Editor\'s note: This clause will document any architectural assumptions and
principles.
Rel-15, Rel-16 and Rel-17 specified UE Policy mechanism in TS 23.501 [2], TS
23.502 [3] and TS 23.503 [4] will be used as baseline for this study.
No new interface in EPC will be defined to solve the issue of consistent URSP
provisioning.
For the objective to investigate if enhancements are needed for provisioning
UE with consistent URSP across 5GC and EPC, and study the mechanism if needed,
the following applies:
\- Solutions using the ePCO to transfer URSP Rules via EPC assumes that the UE
is registered in an MME supporting 5GS interworking, and as such transferring
of ePCO in the PDN Connection signalling is supported by the MME and SGW. It
is also assumed that the SMF+PGW-C selected for a PDN Connection established
to a specific APN supports UE policy delivery service (i.e. SMF+PGW-C supports
sending and receiving of a UE Policy Container to/from the UE).
# 5 Key Issues
## 5.1 Key Issue #1: URSP in VPLMN
### 5.1.1 Description
This Key Issue will study URSP rule provisioning and updating procedures in
roaming scenario, while keeping backward compatibility with the existing
framework of policy control based on HPLMN. In particular:
\- Whether the HPLMN needs any information from the VPLMN to generate URSP
Rules in roaming. If so, which information and how to provide it.
\- How to provide URSP Rules in roaming to the UE. In particular, how the
HPLMN and VPLMN are involved in such procedure.
\- Whether and how to support URSP enhancements to support routing of the
application traffic with different URSP rules in different PLMNs.
## 5.2 Key Issue #2: 5GC awareness of URSP enforcement
### 5.2.1 Description
This key issue address WT#4: whether and how the network can be made aware
when the UE enforces URSP rule for a traffic and investigate whether and what
actions the 5G network can perform.
The following aspects will be studied:
\- Whether and how the 5GC can be made aware whether or when the UE enforces a
URSP rule to route an application traffic to a PDU Session based on the URSP
rule provisioned by 5GC.
\- Whether there are any actions the 5GS can take after 5GC is aware whether
the UE enforces a URSP rule for specific application traffic or not. If any,
what action 5GC should take?
NOTE: User privacy needs to be considered when defining solution (e.g. 5GC
will know if a user started/stopped \"any\" application).
## 5.3 Key Issue #3: Provision consistent URSP to UE across 5GS and EPS
### 5.3.1 Description
The UE may use the route selection component (e.g. DNN) in a URSP rule in EPS,
but when the URSP rule is updated at network side, there is no way to
provision the URSP rule to UE in EPS based on current design. The different
scenarios of provisioning the UE with URSP in EPS will be defined, according
to the existing Rel-17 TS 23.501 [2], TS 23.502 [3] and TS 23.503 [4] TSs and
considered in order to configure the UE with consistent URSP across EPS and
5GS. This key issue is to study how to support provisioning of URSP to a UE
that is consistent across 5GC and EPC, including:
\- Identify the use cases and scenarios where the UE may need URSP that is
consistent across 5GC and EPC.
\- Study whether there are any issues and gaps in the existing URSP mapping
mechanism described in clause 5.17.1.2 of TS 23.501 [2], if so, identify them
and propose solutions.
\- Whether, when and how to provision the URSP to UE when served by the EPC
and ANDSF is not deployed in the network. For the Rel-15 UEs not supporting
the URSP mapping in EPS, whether the URSP updating/provisioning to such UEs in
EPS should be supported.
NOTE: No new interface will be defined in EPC to solve this key issue.
## 5.4 Key Issue #4: Support standardized and operator-specific traffic
categories in URSP
### 5.4.1 Description
Based on GSMA requirement (LS in S2-2105356), SA WG2 will investigate how to
support traffic categories in the traffic descriptor of URSP. Following
aspects will be considered:
\- Definition of Traffic Category use cases and how to support both
standardized traffic categories and MNO-specific traffic categories. If
standardized values for traffic categories are defined, what are the various
traffic categories that need to be standardized.
\- Whether the existing URSP design can be used to support the traffic
category. If not, how to support traffic category in the traffic descriptor of
a URSP rule.
NOTE 1: Traffic categories should support mechanisms that enable the UE to
uniquely identify and categorize the traffic generated by any active
application in a consistent manner across UE implementations.
NOTE 2: 3GPP will coordinate with GSMA for the definition of traffic category,
its use cases and the traffic categories GSMA may want to standardize.
It is assumed to have following standardised traffic categories considering
the requirement from GSMA:
\- IMS traffic category; voice, video and SMS over IMS, as well as RCS, are
included in this traffic category.
\- Internet traffic category.
\- IoT and machine to machine type of traffic.
\- On demand downlink streaming.
\- On demand uplink streaming.
\- Vehicular communications, including vehicle-to-infrastructure, vehicle-to-
network, vehicle-to-vehicle, vehicle-to-pedestrian, vehicle-to-device and
vehicle-to-grid.
\- Real time interactive traffic.
\- Unified communications traffic; instant messaging, VoIP and video
collaboration are included in this category.
\- Background traffic; comprising processes for e.g. firmware/software updates
over the air.
\- Location-based traffic.
\- Critical Communications.
## 5.X Key Issue #X: \
### 5.X.1 Description
Editor\'s note: This clause provides a description of the key issue.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
              Key Issues
* * *
Solutions 1 2 3 4 1 X  
2 X  
3 X  
4 X  
5 X  
6 X  
7 X  
8 X  
9 X  
10 X  
11 X  
12 X  
13 X  
14 X  
15 X  
16 X  
17 X  
18 X  
19 X  
20 X  
21 X 22 X 23 X 24 X 25 X 26 X 27 X  
28 X  
29 X  
30 X  
31 X  
32 X  
33 X  
34 X  
35 X
## 6.1 Solution #1: Usage of application guidance for URSP rules determination
mechanisms
### 6.1.1 Description
Currently when a UE is served by a network other than its home operator (i.e.
VPLMN) the serving network cannot influence the determination of URSP. It
would be useful for the serving network to be able to influence the
determination of URSP for example in LBO case where the VPLMN may support
dedicated DNN(s) for Edge applications.
A solution is to leverage, clause 6.6 of TS 23.548 [5] \"Support of AF
Guidance to PCF Determination of Proper URSP Rules\" and clause 4.15.6.10 of
TS 23.502 [3] \"Application guidance for URSP rules determination mechanisms\"
as defined for Rel-17.
An AF from the VPLMN provides the VPLMN specific URSP information (e.g. DNN
and S-NSSAI to be used for an application traffic etc.) (according to clause
6.6 of TS 23.548 [5] and clause 4.15.6.10 of TS 23.502 [3]); this indication
can be leveraged by the PCF of the HPLMN to (if authorized by HPLMN) provide
dedicated URSP rules applicable to relevant users of the HPLMN when they are
roaming in that VPLMN. These URSP may have a validity condition (e.g. Time
Window and/or Location Criteria) corresponding to the VPLMN. The location
validity condition may be provided by the AF from VPLMN that contains the list
of TA(s) or Cell Id(s) of the VPLMN.
NOTE 1: The PLMN ID in the Policy Section identified by the Policy Section
Identifier (PSI) is used to determine which PLMN owns the policy section. A
PCF can provide UE policies for policy sections that are associated with the
PLMN that the PCF belongs to i.e. a PCF from HPLMN cannot provide UE policies
for a Policy Section list that belongs to a VPLMN.
The H-PCF may, based on local policies, determine whether to always send the
URSP rules immediately to the UE or to send these rules only when the UE is
served by the corresponding serving PLMN, e.g. waiting to be triggered from a
V-PCF of that PLMN in step 3 of clause 4.6.11 of TS 23.502 [3].
The PCF of the HPLMN when it sends such URSP update to a UE, needs, as for
Rel-17, to ensure that the DNN, S-NSSAI provided in the URSP rules sent to the
UE is allowed in UDM subscription even when the UE is roaming in that VPLMN.
NOTE 2: This solution could also apply in FS_EDGE_Ph2.
NOTE 3: This solution is applicable only when HPLMN supports dynamic PCC and
application guidance for URSP rules determination mechanisms.
### 6.1.2 Procedures
The solution reuses existing procedures.
### 6.1.3 Impacts on Existing Nodes and Functionality
\- The VPLMN and the HPLMN as part of the roaming agreement need to ensure
that the VPLMN AF can reach the NEF of the HPLMN to use the API defined in
clause 4.15.6.10 of TS 23.502 [3] \"Application guidance for URSP rules
determination mechanisms\"
\- UDM to include the DNN, S-NSSAI of the VPLMN in the list of Subscribed
S-NSSAIs and to allow the DNN, S-NSSAI to work in LBO mode in the user
subscription.
## 6.2 Solution #2: VPLMN influencing URSP rules in an HPLMN
### 6.2.1 Description
Editor\'s note: This clause will describe the solution principles and
architecture assumptions for corresponding key issue(s) which should be
explicitly stated. (Sub) clause(s) may be added to capture details.
To support the objectives of KI#1 it is proposed to re-use the procedure
defined in Release-17 on application guidance for URSP rule creation with the
additional enhancement on allowing an Application Function in a VPLMN to
influence URSP rules creation at an HPLMN. The AF in the visited PLMN provides
the service information re-using the service specific information provisioning
procedure described in TS 23.502 [3] with the following addition:
\- The AF includes an indication to apply this rule only when UEs register to
a specific PLMN.
The trigger for the AF request could be due to:
\- AF service provider of a VPLMN wishes to use specific DNN/S-NSSAI handling
for roaming UEs
\- A trigger by the Network Slices Capability Enablement Server defined in TS
23.434 [6]. The NSCE server may be located in an AF. The NSCE server may
receive from an NSCE client (located in a UE) a network/slice notification
remapping for an application based on configuration provided by the NSCE
server to the NSCE client in the UE.
The NEF stores the AF request information in the UDR in the \"Application
Data\" field within the Service Specific Information Data Subset together with
the assigned Transaction Reference ID (provided by the AF).
When the PCF receives the updated subscription information from the UDR the
PCF derives updated URSP rules for a UE (or any UE) including in the URSP rule
information indicating to the UEs to apply this URSP rules only when routing
traffic via a specific PLMN. This is supported by enhancing the Route
Selection Descriptor of the URSP rule including a PLMN identity. There are
several options on how the RSD component can be enhanced:
\- **Option 1:** New validation criteria in RSD.
\- **Option 2:** Use existing validation criteria i.e. the location criteria,
where the location could be set to e.g. 3GPP location\"={PLMN,location}.
\- **Option 3:** Include a new RSD parameter (i.e. not validation criteria) to
identify the PLMN.
If the UE determines an applicable URSP rule for detected application traffic
then the UE considers the Route Selection Descriptor valid if the PLMN
identity of the validity condition matches the PLMN identity of the registered
PLMN. The new RSD component that include PLMN identity are set by the PCF as
higher priority so that the UE evaluates the first.
Alternatively, the PCF filters the Service Specific Information Data Subset
provided by UDR, e.g. using the PLMN as Data Subkey, then includes only URSP
Rules applicable for the Serving PLMN. The PCF removes the URSP Rules
applicable for the Serving PLMN when the UE Policy association with the V-PCF
in the Serving PLMN is terminated or when the UE moves to a different Serving
PLMN and a change of PLMN PCRT is reported via V-PCF. The H-PCF provides a
list of PSIs identified by the HPLMN ID, the location validity conditions in
the URSP Rule contains a list of TAI(s) or Cell ID(s), if included.
An example of provisioning URSP rules that contains RSDs for a VPLMN is as
follows. In order to let UE give preference to evaluate the VPLMN specific
URSP rules, the UE receives the provisioning as follows:
\- VPLMN specific URSP rules only contains the RSDs for VPLMN;
\- HPLMN specific URSP rules can be used for both VPLMN and HPLMN;
\- VPLMN specific rules has higher priority than HPLMN specific URSP rules, so
that UE can firstly evaluate VPLMN specific URSP rules/RSDs in roaming case.
### 6.2.2 Procedures
#### 6.2.2.1 VPLMN AF guidance for URSP rule creation at an HPLMN
A call flow of the procedure is shown below.
Figure 6.2.2.1-1: Procedure to influence URSP rules for a different PLMN
Steps are as follows:
1\. AF in VPLMN is triggered to request to the home PLMN of a UE a specific
handling of routing traffic to the VPLMN.
2\. The AF invokes a service operation with the NEF including in the request
updated service information as described in clause 4.15.6.10 of TS 23.502 [3].
The updated information includes a validity conditions to apply a URSP rule in
a specific PLMN (or a list of PLMN). The request is applicable for any UE or
the AF may include external identifiers of the UE.
2a-2c The NEF may authorize the request with the UDM according to TS 23.502
[3].
3a When the authorization is successful the NEF updates the data in the UDR
including within Application Data the updated service information. The NEF
invokes an Nudr_DM_Create (or Update) service request requested the UDR to
store the service information in the \"Application Data\" Data Set within the
Service Specific Information Data Subset identifier. The NEF may also include
a Data Key the target UEs or Group of UEs.
3b. The UDR acknowledges the NEF request.
3c. The NEF acknowledges the AF request.
4a. If the PCF has subscribed to Service Specific Information the UDR notifies
the PCF of the updated service information.
4b. When a UE registers to the H-PLMN (or VPLMN) the UE includes a list of
PSIs. The AMF (in HPLMN) or V-PCF (in VPLMN) initiates a UE Policy Association
Create request with the PCF including in the request the list of PSIs
associated to the HPLMN.
4c. The PCF may retrieve Application Data subscription information from the
UDR.
5\. The PCF creates updated URSP rules including URSP rules with validity
conditions on per PLMN basis according to the information stored in the UDR.
6\. The PCF provides updated URSP rules to the UE by initiating a UE
Configuration Update for transparent policy delivery (via the V-PCF if the UE
is roaming) to deliver updated URSP rule to a UE.
6b. The UE acknowledges successful installation of rules.
7\. If the AF has subscribed to notification of successful policy delivery the
PCF notifies the UDR.
8a-8b The UDR informs the NEF of successful policy delivery.
9a-9b. The NEF informs the AF of successful policy delivery.
#### 6.2.2.2 UE behaviour on applying a URSP rule with a PLMN validity
condition in route selection descriptor
The UE upon reception of URSP rules including a PLMN validity conditions
within Route Selection Descriptors enforces the URSP rules as follows:
\- When the UE finds that application traffic matches traffic descriptor of a
URSP rules the UE checks the list of Route Selection Descriptors of the
matched URSP rule.
\- If an RSD in the list of RSDs contains PLMN validity conditions the UE
checks if the PLMN identity within the validity conditions matches the PLMN
identity of the registered PLMN or an equivalent PLMN of the registered PLMN.
\- If there is match the UE considers the RSD valid and routes the application
traffic according to the contents of the route selection descriptor.
\- If there is no match the UE considers the RSD as invalid and continues to
process a second RSD in the list of RSD of the matched URSP rules if
available.
### 6.2.3 Impacts on services, entities and interfaces
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
URSP rule is enhanced with a PLMN identity validity condition within Route
Selection Descriptors. The UE checks if the PLMN identity within the validity
conditions matches the PLMN identity of the registered PLMN or an equivalent
PLMN of the registered PLMN.
## 6.3 Solution #3: URSP provisioning and updating in roaming
### 6.3.1 Description
This is a solution related to the Key Issue #1 URSP in VPLMN.
Flexible scenarios deployed in VPLMN, e.g. flexible LADN deployment or MEC
deployment, requires the URSP generation and updating to have the
consideration of the policy information (including LADN DNN or AF located in
VPLMN) in VPLMN dynamically. Furthermore, as it needs to keep the backward
compatibility with the existing framework of policy control based on HPLMN,
the aforementioned policy information in VPLMN needs to be provided to the
HPLMN by VPLMN for UPSP generation and updating in roaming case. In this
solution, it is proposed that the V-PCF provides the UE policy assistant
information of VPLMN to the H-PCF and take the UE Policy Association
Establishment/modification procedure as specified in clause 4.16.11 of TS
23.502 [3] as basis for URSP provisioning and updating.
### 6.3.2 UE Policy Association Establishment with VPLMN assistant information
Figure 6.3.2-1: UE Policy Association Establishment with VPLMN assistant
information
This procedure takes the UE Policy Association Establishment procedure in
roaming case as specified in clause 4.16.11 of TS 23.502 [3] as basis.
1\. The AMF establishes UE Policy Association with the V-PCF same as step 1 in
clause 4.16.11 of TS 23.502 [3].
2\. The AMF sends a Npcf_UEPolicyControl Create Request to V-PCF same as step
2 in clause 4.16.11 of TS 23.502 [3].
3\. After receiving the Npcf_UEPolicyControl Create Request from the AMF, the
V-PCF gets the VPLMN assistant UE policy information based on local policy or
get it from the V-UDR by using the Nudr_DM_Query service. The VPLMN assistant
UE policy information is used for HPLMN to generate the UE policy taking the
VPLMN requirement into account.
4\. The V-PCF forwards the information received from AMF in step 2 and the
VPLMN assistant UE policy information got in step 3 to the H-PCF. The VPLMN
assistant UE policy information may include the following information:
\- The mapping from traffic descriptor to DNN, NSSAI, SSC mode, PLMN ID, etc.
in VPLMN.
5-6. Steps 5\~6 same as steps 4\~5 are performed.
7\. Similar to step 6 in clause 4.16.11 of TS 23.502 [3], the H-PCF gets
policy subscription related information and the latest list of PSIs from the
UDR using Nudr_DM_Query service operation. The H-PCF creates the UE policy
based on the policy information from UDR and the VPLMN assistant UE policy
information if any in step 4, then provides the UE policy container in the
Npcf_UEPolicyControl UpdateNotify Request to V-PCF.
8\~11. The steps 8\~11 are same as the steps 7\~10.
### 6.3.3 UE Policy Association modification with VPLMN assistant information
Figure 6.3.3-1: UE Policy Association modification with VPLMN assistant
information
This procedure takes the UE Policy Association Modification initiated by the
PCF procedure in roaming case as specified in clause 4.16.12.2 of TS 23.502
[3] as a basis.
1\. If (V-)PCF subscribed to notification of VPLMN assistant information
change and a change is detected, the V-UDR notifies V-PCF of that the VPLMN
assistant information has been changed. Before performing this step, the V-PCF
needs to subscribe the notification of VPLMN assistant information change from
the V-UDR.
2\. If the VPLMN assistant information changed according the step 1 or based
on local policy in V-PCF, the V-PCF forwards the VPLMN assistant information
to the H-PCF via the Npcf_UEPolicyControl_Update request.
3\. H-PCF responds to V-PCF.
4\. The H-PCF may update the UE policy based on the VPLMN assistant UE policy
information from V-PCF in step 4, and send it to the V-PCF via the
Npcf_UEpolicyControl_UpdateNotify request similar to the step 3 of figure
4.16.12.2-1 of TS 23.502 [3].
5\. The V-PCF sends a response to H-PCF using Npcf_UEPolicyControl
UpdateNotify Response.
6\. The step 6 is same to the steps 5-9 of figure 4.16.12.2-1 of TS 23.502
[3].
### 6.3.4 Support routing of the same application traffic with different URSP
rules in different PLMNs
#### 6.3.4.1 URSP enhancement with including the PLMN ID in TD (Option#1)
For support routing of the same application traffic with different URSP rules
in different PLMNs, a potential way is to enhance the existing structure of
URSP as specified in clause 6.6.2 of TS 23.503 [4]. The Traffic descriptor in
URSP can be enhanced to include:
\- a new component \"PLMN ID\".
When to perform the URSP evaluation, for every newly detected application, the
UE additionally enter a PLMN ID with the application data. This means that
PLMN ID is also involved in URSP evaluation. The PLMN ID is the PLMN ID of its
serving PLMN.
#### 6.3.4.2 URSP dedicated to VPLMN (Option#2)
For support routing of the same application traffic with different URSP rules
in different PLMNs, if there is the VPLMN assistant UE policy information
received from the V-PCF as specified in step 4 of clause 6.3.2 or step 2 of
clause 6.3.3, the H-PCF provides the URSP only applied to this VPLMN to the
UE. When the UE moves to a different VPLMN, the H-PCF will generate or update
the URSP Rule to the UE for this different and to be served VPLMN.
### 6.3.5 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
V-PCF:
\- Is able to request the VPLMN assistant UE policy information from the
V-UDR.
\- Supports the subscription of VPLMN assistant UE policy information change
notification from the V-UDR.
UDR:
\- Supports the notification of VPLMN assistant UE policy information change.
\- Support to provide the VPLMN assistant UE policy information to V-PVF.
H-PCF:
\- Support to create/update the UE policy combined with the VPLMN assistant UE
policy information from the V-PCF.
\- Provides the URSP only dedicated to the VPLMN to the UE if VPLMN assistant
UE policy information is received.
UE:
\- Evaluates the URSP with the consideration of matching PLMN ID in TD with
current serving PLMN ID.
## 6.4 Solution #4: URSP decision with V-PCF involvement
### 6.4.1 Description
The Solution addresses Key Issue #1 on URSP in VPLMN. This solution assumes
the following:
\- It is assumed that there are some applications which may be deployed in
both VPLMN and HPLMN, or VPLMN only. In either scenario, the VPLMN may request
to transport the corresponding application traffic with some specific DNN(s)
and/or S-NSSAI(s).
\- During the lifetime of UE Policy Association, the V-PCF is capable of
generating URSP rules from VPLMN perspective, based on operator configuration
or input from the AF. For example, the AF (e.g. gyms, museums) in VPLMN may
request to distribute URSP rules to the UEs within a specific area, including
the roaming UEs, thus the application traffic can be routed with corresponding
DNN and/or S-NSSAI in the URSP rules.
\- To avoid breaking the current framework of URSP decision by HPLMN, the
V-PCF provides the generated URSP rules to the H-PCF for final decision, which
contains the Route Selection Descriptor and Validation Criteria which
indicates that the RSD is only applicable in the current VPLMN and its
equivalent PLMN(s).
The enhancement is to add a new criteria as Applicable PLMN to the **Route
Selection Validation Criteria** in the Route Selection Descriptor, as defined
in the Table 6.6.2.1-3 of the TS 23.503 [4].
* * *
Applicable PLMN Indicates the applicable PLMN(s) in which the RSD can be
adopted for URSP association. Optional Yes UE context
* * *
### 6.4.2 Procedure
Figure 6.4.2-1: URSP decision with V-PCF involvement
0\. UE registers to the 5GC via the VPLMN.
1\. The V-PCF determines to generate URSP rules applicable to the UE based on
local policies and/or AF/V-UDR interaction, to allow the UE access to the
application using the values indicated by specific DNN, and/or S-NSSAI.
Besides, the Route Selection Validation Criteria of the RSD contains the
PLMN(s) in which the RSD is applicable, e.g. the VPLMN, the PLMN(s) equivalent
to the VPLMN.
NOTE 1: The S-NSSAI within the NSSP provided by the V-PCF is for the HPLMN,
which is determined by the V-PCF based on local configuration or based on the
mapping of VPLMN S-NSSAIs to HPLMN S-NSSAIs received from the AMF.
NOTE 2: The equivalent PLMN(s) of the VPLMN can be configured in the V-PCF or
received from the AMF.
2\. The V-PCF provides the generated URSP rule(s) to the H-PCF for final
decision via Npcf_UEPolicyControl_Update request message.
3\. Based on the subscription data and/or local policies, the H-PCF checks
whether the received URSP rule(s) can be authorized for the UE, e.g. whether
the S-NSSAI in the NSSP is allowed by the subscription NSSAI.
NOTE 3: It is up to the H-PCF implementation to determine the precedence of
the URSP rules originated by the V-PCF.
4\. The H-PCF provides the authorized URSP rules to the V-PCF via
Npcf_UEPolicyControl Update response message.
5\. The V-PCF triggers the UE policy delivery via UE configuration Update
procedure.
After this procedure, the UE can associate the corresponding application to
appropriate PDU Session based on the received URSP rules.
### 6.4.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
UE:
\- Needs to support the validation of Applicable PLMN list in RSD Validation
Criteria.
V-PCF:
\- Needs to support the generation of URSP rules applicable to VPLMN only and
further provide the generated URSP rules to H-PCF for final decision.
H-PCF:
\- Needs to perform final decision taking the generated URSP rules from V-PCF
into account.
## 6.5 Solution #5: URSP determination based on service parameter obtained
from VPLMN
### 6.5.1 Description
This is a solution for key issue #1 \"URSP in VPLMN\".
Currently, URSP is only controlled and determined by HPLMN. Therefore, to give
influence on URSP determination, e.g. application guidance for URSP
determination specified in clause 4.15.6.10 of TS 23.502 [3], the AF needs to
provide inputs to HPLMN. The application guidance for URSP determination may
be for Edge services or for location-based services which means there may be
the case that the URSP rules determined based on the application guidance can
be applied and valid only when the UEs are in any specific VPLMN in roaming
case. Anyhow, in this case, the AF may need to provide application guidance
for URSP determination to all PLMNs whose subscribers will be probably roaming
into the VPLMN, and the AF has service level agreements with. In addition, if
the AF includes a geographical area as spatial validity condition in the
application guidance for URSP determination, the NEF may need to transform
this information into 3GPP identifiers (e.g. TAI(s)). For this, the NEF needs
to have knowledge on VPLMN\'s 3GPP identifiers (e.g. TAI(s)).
In this solution, the AF provides application guidance for URSP determination
to the PLMN (i.e. to UDR via NEF of this PLMN) where the related services are
provided or the related traffic is routed. H-PCF of the roaming UE obtains the
application guidance for URSP determination from VPLMN by requesting V-PCF to
subscribe to V-UDR to be notified about the data creation/modification for the
UE. V-PCF subscribes to V-UDR on behalf of H-PCF, by adding a new PCRT that
request notification when Service Parameters are available for a UE Policy
Association. If the AF provides inputs to V-UDR via V-NEF, V-PCF provides the
data notified by V-UDR to H-PCF.
The AF can include the PLMN ID(s) when provisioning application guidance for
URSP determination for all HPLMNs whose subscribers may roam into the VPLMN,
in order to indicate that the provisioned information is for roamers from that
PLMN ID(s). The Application data in UDR is extended to provide PLMN ID as Data
Key. Table 6.5.1-1 shows \"PLMN ID\" as an additional Data Key and NOTE 5
describing the \"PLMN ID\" on top of data keys for Application data specified
in Table 5.2.12.2.1-1: Data keys in TS 23.502 [3].
Table 6.5.1-1: Data keys
+----------------+----------------+----------------+--------------+ | Data Set | Data Subset | Data Key | Data Sub Key | +================+================+================+==============+ | Application | Service | S-NSSAI and | - | | data | specific | DNN | | | | information | | | | | (See | or | | | | cl | | | | | ause 4.15.6.7) | Internal Group | | | | | Identifier or | | | | | SUPI or "PLMN | | | | | ID" or \"any | | | | | UE\" | | | | | indication | | | | | (NOTE 4) | | | | | (NOTE 5) | | +----------------+----------------+----------------+--------------+ | NOTE 4: When | | | | | the Data Key | | | | | targets \"any | | | | | UE\", then the | | | | | request to UDR | | | | | applies on | | | | | Application | | | | | data that | | | | | applies on all | | | | | subscribers of | | | | | the PLMN. For | | | | | encoding, see | | | | | TS | | | | | 29.519 [15]. | | | | | | | | | | NOTE 5: When | | | | | the Data Key | | | | | targets \"PLMN | | | | | ID\", then the | | | | | request to UDR | | | | | applies on | | | | | Application | | | | | data that | | | | | applies on all | | | | | subscribers of | | | | | that PLMN ID. | | | | | The AF | | | | | provides a | | | | | PLMN ID if the | | | | | request | | | | | applies for | | | | | all | | | | | subscribers of | | | | | that PLMN that | | | | | can be roaming | | | | | to the VPLMN | | | | | the AF | | | | | provides the | | | | | request to. | | | | +----------------+----------------+----------------+--------------+
This solution reuses the existing Npcf_UEPolicyControl Service for the H-PCF
to subscribe to reception of new/updated Service Parameters for the UE, using
a new PCRT and for the V-PCF to notify to the H-PCF and provide the Service
Parameters for the UE to the H-PCF.
The H-PCF generates a new URSP Rule or updates an existing URSP Rule with the
same traffic descriptor as provided in the Service Parameters, if the S-NSSAI
subscription information indicates that this DNN, S-NSSAI is subscribed, and
LBO roaming is allowed.
The H-PCF sends the URSP Rule to the UE using existing procedures. In
addition, the H-PCF subscribes to \"change of PLMN\", then when the UE moves
to a different PLMN, the H-PCF removes or updates the URSP Rule sent to the UE
to remove the RSD that routed the traffic thought the VPLMN were the UE was
registered. The H-PCF also removes or updates the URSP Rule sent to remove the
RSD that routed the traffic though the VPLMN when the V-PCF requests to
terminate the UE Policy Association.
### 6.5.2 Procedures
#### 6.5.2.1 Procedure for URSP determination based on service parameter
obtained from VPLMN
Figure 6.5.2.1-1 shows the procedure for URSP determination based on service
parameter obtained from VPLMN.
Figure 6.5.2.1-1: Procedure for URSP determination based on service parameter
obtained from VPLMN
1\. The UE is registered to 5GC and the UE Policy Association is performed
between the AMF and the H-PCF via V-PCF. In addition, the H-PCF may subscribe
using a new PCRT \"Service Parameters received\" to the V-PCF. The V-PCF
provides the Service Parameters if available.
2\. Based on the reception of a new PCRT from the H-PCF, the V-PCF may
subscribes to the reception of Service Parameters from the AF for the
determination of URSP Rules for any UE of that HPLMN registered in this VPLMN,
if not subscribes to V-UDR when the UE Policy Association is created for
subscribers of that HPLMN. The V-PCF includes VPLMN DNN and S-NSSAI in the
subscription request to the UDR given that the AF provides Application
guidance for URSP determination to the VPLMN.
3\. To provide Application guidance for URSP determination as specified in
clause 4.15.6.10 of TS 23.502 [3], the AF creates a new request.
4-6. As specified in steps 2 to 4 in clause 4.15.6.7 of TS 23.502 [3], the AF
sends its request to the NEF, and the NEF stores the AF request information in
the UDR and responds to the AF. In this figure, the NEF is V-NEF and the UDR
is V-UDR.
The AF request is targeting any UE (all UEs) of a HPLMN that are registered in
this VPLMN. Therefore, the V-NEF authorizes the request based on local policy
based on service level agreements between the AF and the VPLMN (e.g. based on
AF Id) without requesting for any service specific authorization from UDM as
specified in clause 4.15.6.10 of TS 23.502 [3].
NOTE: The AF request targeting a specific UE or a group of UE(s) does not
apply to this solution because Service Specific Authorization for an
individual UE or group of UEs by NEF to UDM has to be performed for the AF
request as specified in clause 4.15.6.10 of TS 23.502 [3].
7\. The V-PCF receives a Nudr_DM_Notify notification of data change from the
V-UDR.
8\. The V-PCF sends the notification of data change from the V-UDR invoking
Npcf_UEPolicyControl_Update including the Service Parameters that have been
received from the UDR to the H-PCF. The V-PCF also provides the mapping of the
VPLMN S-NSSAI to HPLMN S-NSSAI and the mapping of the VPLMN DNN to HPLMN DNN
to the H-PCF.
9\. The H-PCF determines the URSP rules that is to be sent to the UE based on
the Service Parameters received from the V-PCF and the S-NSSAI subscription
information for this SUPI, DNN, S-NSSAI retrieved from the UE context policy
control subscription information from the UDR The H-PCF generates a new URSP
Rule or update an existing URSP Rule that was sent to the UE for the same
traffic descriptor to include a new RSD with the DNN, S-NSSAI provided by the
V-PCF then sets the RSD precedence and validity conditions taking the
information provided by the V-PCF into account.
That is, the H-PCF replaces any URSP rules related to Route Selection
Descriptor(s) including the DNN and S-NSSAI.
10\. The H-PCF provisions the URSP rules to the UE via the V-PCF by using the
UE Configuration Update procedure for transparent UE Policy delivery as
specified in clause 4.2.4.3 of TS 23.502 [3]. The H-PCF provides S-NSSAI and
DNN values of the VPLMN to the UE in the RSD component of the URSP rule.
11\. The UE needs to send traffic, e.g. destined to an Edge service.
Therefore, the UE determines a URSP rule applicable for the traffic. For URSP
Rules applicable in the VPLMN the UE considers a RSD valid if the S-NSSAI
value is in the Allowed NSSAI instead of the Mapping Of Allowed NSSAI.
12\. If there is no PDU Session that matches all components in the selected
RSD within the URSP rule, the UE establishes a PDU Session. The UE provides
both the S-NSSAI of the VPLMN, i.e., the S-NSSAI in the URSP Rule, and the
S-NSSAI of the HPLMN obtained from the mapping of the Allowed NSSAI to HPLMN
S-NSSAI as described in clause 5.15.5.3 of TS 23.501 [2]. The UE includes the
DNN of the VPLMN, i.e., the DNN in the URSP Rule if provided as UE Requested
DNN, as described in clause 6.6.2.1 of TS 23.503 [4]. If the UE Requested DNN
is supported but not subscribed, then the AMF checks if there is a mapping to
the HPLMN DNN configured, then uses it for subscription check. The AMF uses
the UE Requested DNN as Selected DNN, then performs SMF selections. The AMF
sends both the Selected DNN (i.e. UE Requested DNN) and the DNN value of the
HPLMN to SMF. The SMF uses the DNN value of the HPLMN and the S-NSSAI value of
the HPLMN for subscription check as described in clause 4.3.2.2.1 of TS 23.502
[3].
13\. The UE communicates with the Application Server, e.g. Edge Application
Server.
### 6.5.3 Impacts on services, entities and interfaces
H-PCF:
\- Subscribes to a new PCRT \"Service Parameters received\".
\- Reception of Service Parameters for a UE Policy Control Association
established with the V-PCF.
\- Determines URSP rules based on the data provided by AF and received via
V-UDR and V-PCF, taking S-NSSAI subscription information into account.
\- S-NSSAI subscription information extended to include if LBO is allowed.
V-PCF:
\- Subscribes to V-UDR to be notified about the Service Parameters
creation/modification for roaming UEs if the H-PCF provided a PCRT.
\- Provides the Service Parameters notified by V-UDR to H-PCF.
H-UDR:
\- S-NSSAI Subscription information needs to include an indication of whether
LBO roaming is allowed for a DNN, S-NSSAI.
UE:
\- For URSP Rules applicable in the VPLMN the UE considers the RSD valid if
the S-NSSAI value is in the Allowed NSSAI instead of the Mapping Of Allowed
NSSAI.
AMF:
\- At PDU Session Establishment uses the UE requested DNN as Selected DNN, for
subscription check the AMF maps the UE Requested DNN to HPLMN DNN.
## 6.6 Solution #6: Solution for URSP in VPLMN with PLMN domain indication
### 6.6.1 General
As specified in TS 23.503 [4], the URSP is only to be provided by the HPLMN.
However, there are cases where different VPLMNs have different preference on
the PDU session parameters for the same application. To support such
differentiated URSP handling in different PLMNs, following enhancements are
required:
\- Enhance the URSP provision so that the URSP rules are provided with PLMN
ID(s) associated.
\- Allowing the UE to utilize the URSP rules associated with the serving PLMN
fist, and if no match is found, utilize the URSP of the HPLMN.
### 6.6.2 Functional descriptions
The VPLMN provides the URSP applicable to the UE to HPLMN. This may be
triggered by the UE\'s registration in the VPLMN or happen before UE roam into
the VPLMN. AF in VPLMN may use the service specific parameter procedure to
influence HPLMN generating the URSP for VPLMN.
For how the UE identify VPLMN's URSP rules, there are two options as below.
Option-1: The HPLMN constructs the URSP for the UE, with different list of
PSIs associated with the different VPLMN IDs which are outside of PSI, then
sends the mapping table to UE together with UE Policy Sections containing the
URSP. Some examples are shown in below:
\;
\;
. . .
\.
The HPLMN ensures that the URSP rules associated with the VPLMN IDs only apply
to the PDU session that supports LBO. This solution maintains the Rel-17
principle that the HPLMN ID is always part of the PSI when the policy section
carries a URSP rule, thus there will continue to be no conflict between VPLMN
allocated PSI\'s (which do not carry URSP rules) and HPLMN allocated PSIs.
The UE is provisioned with the URSP rules following the existing procedure as
defined in TS 24.501 [7]. The UE stores the list of PSIs associated with PLMN
IDs.
When UE registered in the VPLMN, it locates the list of PSIs associated with
the VPLMN-ID and the list of PSIs associated with HPLMN-ID.
UE applies the URSP rules associated with the VPLMN ID first, if any. If there
is a match, the UE follows the URSP rule to establish the PDU session.
If the UE does not find a match using the URSP rules associated with the VPLMN
ID, it uses the URSP rules associated with the equivalent VPLMN ID, if any. If
there is no URSP rules associated with the equivalent VPLMN ID, the UE uses
the URSP rules associated with the HPLMN ID.
The UE does not use other URSP rules than those associated with the VPLMN ID,
equivalent VPLMN ID or HPLMN IDs.
Option-2: alternatively, if the new mapping table is not used, the (H-)PCF
provides URSP Rules that are identified by the HPLMN ID as defined in TS
23.503 [4]. The PCF removes the URSP Rules applicable for the Serving PLMN
when the UE Policy association with the V-PCF in the Serving PLMN is
terminated or when the UE moves to a different Serving PLMN and a change of
PLMN PCRT is reported via V-PCF. The H-PCF provides a list of PSIs identified
by the HPLMN ID, the location validity conditions in the URSP Rule may contain
a list of TAI(s) or Cell ID(s). The URSP policy can be used to the registered
VPLMN and its equivalent VPLMN, however cannot be used for other PLMNs. In
order to avoid using a wrong URSP rules, the UE may remove all URSP rules when
it moves to a different PLMN except the equivalent PLMN. This option-2 reduces
the number of URSP Rules that are sent to the UE and the number of URSP Rules
that needs to be evaluated by the UE.
### 6.6.3 Procedures
The existing procedures as defined in TS 24.501 [7] for UE Policy provisioning
can be reused, besides the above enhancements.
### 6.6.4 Impacts on services, entities, and interfaces
For Option-1 (provisioning mapping table along with URSP rules), the impacts
on existing entities:
\- UE needs to utilize URSP rules associated with the VPLMN or Equivalent PLMN
if no VPLMN URSP rules, before applying URSP rules associated with HPLMN.
\- A mapping between VPLMN ID and PSI sets need to be provisioned to UE along
with the Policy Sections containing URSP rules.
For Option-2 (provisioning new URSP rules when PLMN changes), the impact on
existing entities:
\- The UE may remove all URSP rules when it moves to a different PLMN except
an equivalent VPLMN.
## 6.7 Solution #7: URSP Compliance Verification
### 6.7.1 Description
This solution addresses the following technical issues of the KI#2:
\- Whether and how the 5GC can be made aware whether or when the UE enforces a
URSP rule to route an application traffic to a PDU Session based on the URSP
rule provisioned by 5GC.
\- Whether there are any actions the 5GS can take after 5GC is aware whether
the UE enforces a URSP rule for specific application traffic or not. If any,
what action 5GC should take?
In the current 5GC, there is no way to check whether the application traffic
from the UE is compliant with the URSP.
The URSP is composed of Traffic Descriptor and Route Selection Component. The
UE can associate application with the existing PDU Session or request a new
PDU Session if no PDU Session matches the URSP rules when the application is
detected. In this solution, we focus on the case when the UE requests a new
PDU Session and discuss how the 5GC can know whether the requested PDU Session
is compliant with the URSP.
In order to check whether the PDU Session Establishment request is compliant
with URSP rule, the 5GC needs to identify the request is caused by which URSP
rule. The PDU Session Establishment request can include RSC of the URSP rules,
however, there is no information which URSP rule (i.e. Traffic Descriptor)
matches.
Therefore, we introduce an identifier for the URSP Rule so that the PCF can
identify which URSP rule causes the request of the PDU Session. If the UE
includes the matched URSP Rule Identifier in the PDU Session Establishment
request, the 5GC can be aware of the association between the URSP rules and
the PDU Session so that 5GC can verify whether the UE is compliant with the
URSP rules.
1\. When constructing a URSP rule, URSP Rule Identifier (URID) is added to
identify the URSP rule.
2\. UE reports the URSP Rule Identifier associated with URSP rules causing a
new PDU Session Establishment request by including the URID in the same
request based on the PCF demand.
When the SMF is reported for the associated URID, it should be reported to the
PCF responsible for the URSP (i.e. UE-PCF). Since the multiple SM-PCFs can be
used for one UE, we assume UE-PCF and SM-PCF may not be the same and the UE-
PCF is responsible for URSP compliance verification.
Since SMF may not have a direct interface to the UE-PCF, we use the reporting
path from the SMF to the UE-PCF via SM-PCF in order for the SMF to report the
URID and its received PDU Session Parameters (PSP).
If the 5GC identifies that the UE is not compliant to the URSP rule, the 5GC
does not allow the UE to establish a new PDU Session based on its policy.
The abstract of this solution is depicted in the Figure 6.7.1-1.
Figure 6.7.1-1: Authorization of URSP verified PDU Session with the UE
reported URSP rule identifier
The UE-PCF is responsible for URSP compliance verification. The UE-PCF sends
URSP Authorization Request Indication (UARI) to the AMF when the UE Policy
Association is established or notified with the update.
If AMF receives UARI and PCF binding info, it stores the information and sends
them to the SMF during the PDU Session Establishment procedure.
NOTE: This solution uses the existing feature that the AMF stores the PCF ID
so that the SM-PCF can use it to contact the UE-PCF.
When the SMF establishes the SM Policy Association, the SMF forwards the UARI
and Received PDU Session Parameters (R-PSPs) to the SM-PCF. If the SM-PCF
receives the UARI request, it performs the URSP Authorization procedure with
UE-PCF with the R-PSPs received from the SMF through SM-PCF and URID received
from the UE.
The UE-PCF can request the UE to assist the URSP compliance by sending URSP
Compliance Request (UCR) together with URSP rules with the UE Policy
Container. The UCR indicates the UE to report the URSP Rule Identifier (URID)
associated URSP rule that causes the establishment of the PDU Session. If the
UE receives the UCR, the UE includes the URID in the PDU Session Establishment
request when initiating a PDU Session caused by the URSP rule.
When the SMF is requested for UARI and receives the PDU Session Establishment
Request, the SMF requests the authorization of the PDU Session from the UE-PCF
through SM-PCF. The UE-PCF checks the R-PSP requested by the UE and the URID
to verify whether the PDU Session Establishment request is compliant with the
URSP rule.
The UE-PCF can take other actions later instead of immediate authorization of
the PDU Session. In this scenario, the UE-PCF can receive the reporting of the
established PDU Session from the SM-PCF. The UE-PCF requests the PDU Session
Parameters Reporting (PSPR) instead of UARI. The abstract procedure of this
alternative is described in the Figure 6.7.1-2. When the PSPR is requested
from the UE-PCF, the SM-PCF notifies the PDU Session Parameters to the UE-PCF.
Figure 6.7.1-2: PDU Session Parameter Reporting with the UE reported URSP rule
identifier
Due to various reasons, the UE-PCF does use the URSP rule identifier
reporting. The UE-PCF performs the authorization of the URSP verified PDU
Session without UE reporting as depicted in the Figure 6.7.1-3. In this
scenario, the procedure is similar to the Figure 6.7.1-1 except the following
differences:
\- The UE-PCF provides the URSP rules without URSP rule identifier and does
not command URSP Compliance Request to the UE.
\- The UE does not report the URSP rule identifier when establishing the PDU
Session.
Figure 6.7.1-3: Authorization of URSP verified PDU Session without UE
reporting
Similarly, the UE-PCF does use the URSP rule identifier reporting. The UE-PCF
requests the PDU Session Parameter Reporting. The abstract procedure is
described in Figure 6.7.1-4.
Figure 6.7.1-4: Authorization of URSP verified PDU Session without UE
reporting
**Consideration on Requested PDU Session Parameters**
For the PCF for the UE to verify the appropriate RSD provided by the UE in the
PDU Session Establishment request, the SMF should be able to delivery the RSD
parameters that it receives from the UE to the SM-PCF.
Among the Route selection components in URSP rules, the PDU Session Parameters
such as DNN, S-NSSAI, PDU Session Type, Access Type that the UE sent to the
SMF can be delivered to the PCF.
However, the SSC Mode, PDU Session Pair ID, RSN are required to be sent to the
PCF so that the PCF can validate parameters.
NOTE: Non-seamless Offline indication and ProSe Layer-3 UE-to-Network Relay
Offload indication is not subject to be verified in the serving network.
Table 6.7.1.1: Comparison between URSP RCS and the parameters in
SMPolicyControl service operation
+----------------+----------------+----------------+----------------+ | Route | Description of | N | Required to be | | selection | RSC | pcf_SMPolicyC | reported (New) | | components | | ontrol_Create | | | | in Table | request | | | | 6.6.2.1-3 of | | | | | T | (cl | | | | S 23.503 [4] | ause 5.2.5.4.2 | | | | | of | | | | | TS | | | | | 23.502 [3]) | | +================+================+================+================+ | _SSC Mode |_ One single | | _YES_ | | Selection _| value of SSC | | | | | mode._ | | | +----------------+----------------+----------------+----------------+ | Network Slice | Either a | S-NSSAI | Already exist | | Selection | single value | | | | | or a list of | | | | | values of | | | | | S-NSSAI(s). | | | +----------------+----------------+----------------+----------------+ | DNN Selection | Either a | DNN | Already exist | | | single value | | | | | or a list of | | | | | values of | | | | | DNN(s). | | | +----------------+----------------+----------------+----------------+ | PDU Session | One single | PDU Session | Already exist | | Type Selection | value of PDU | Type | | | | Session Type. | | | +----------------+----------------+----------------+----------------+ | Non-Seamless | Indicates if | | Not required | | Offload | the traffic of | | | | indication | the matching | | | | | application is | | | | | to be | | | | | offloaded to | | | | | non-3GPP | | | | | access outside | | | | | of a PDU | | | | | Session. | | | +----------------+----------------+----------------+----------------+ | ProSe Layer-3 | Indicates if | | Not required | | UE-to-Network | the traffic of | | | | Relay Offload | the matching | | | | indication | application is | | | | | to be sent via | | | | | a ProSe | | | | | Layer-3 | | | | | UE-to-Network | | | | | Relay outside | | | | | of a PDU | | | | | session. | | | +----------------+----------------+----------------+----------------+ | Access Type | Indicates the | Access Type | Already exist | | preference | preferred | | | | | Access Type | | | | | (3GPP or | | | | | non-3GPP or | | | | | Multi-Access) | | | | | when the UE | | | | | establishes a | | | | | PDU Session | | | | | for the | | | | | matching | | | | | application. | | | +----------------+----------------+----------------+----------------+ | _PDU Session |_ An indication | | _YES_ | | Pair ID _| shared by | | | | | redundant PDU | | | | | Sessions as | | | | | described in | | | | | c | | | | | lause 5.33.2.1 | | | | | of | | | | | TS | | | | | 23.501 [2]._ | | | +----------------+----------------+----------------+----------------+ | _RSN_ | _The RSN as | |_ YES _| | | described in | | | | | c | | | | | lause 5.33.2.1 | | | | | of | | | | | TS | | | | | 23.501 [2]._ | | | +----------------+----------------+----------------+----------------+
### 6.7.2 Procedures
#### 6.7.2.1 Provisioning of URSP Compliance Verification in Registration
procedure
This procedure describes the provisioning of URSP Compliance Verification
procedure during the UE registration procedure. With this procedure, the UE-
PCF performs the following:
1) UE-PCF indicates the UE to report the URSP Rule Identifier associated with
URSP rules causing a new PDU Session Establishment request by including the
URID in the same request.
2) UE-PCF provides PDU Session Parameter Reporting (PSPR) or URSP
Authorization Request Indication (UARI) with PCF binding information to the
AMF so that the AMF sends them to the SMF during the PDU Session Establishment
procedure.
Figure 6.7.2.1-1: Provisioning of URSP Compliance Verification during
Registration procedure
1\. The UE, that is compliant with URSP and supports the reporting URSP
identifier, sends URSP Compliance Capability Indicator (UCCI) within the UE
Policy Container during the registration procedure.
2\. The UE-PCF determines whether to perform the URSP compliance verification
procedure (e.g. URSP compliant PDU Session Authorization or PDU Session
Parameter Reporting).
3\. The UE-PCF sends PSPR (PDU Session Parameter Reporting Request) or URSP
Authorization Required Indication (UARI) to the AMF. The AMF records the PCF
binding info (PCF ID)
4-5. The UE-PCF provides the URSP Compliance Reporting (UCR) and the URSP
rules in UE Policy Container. When the UE-PCF constructing a URSP rule, URSP
Rule Identifier (URID) is added to identify the URSP rule. The UE-PCF provides
the URSP rules within which each URSP rule is identified by the URSP
identifier.
5\. When the UE receives the UE Policy Container, the UE stores the URSP rules
with URID and UCR.
6\. The UE sends the acknowledgement of UCR with the URID that the UE is
compliant with them.
7\. The UE-PCF receives the UCR acknowledgement.
#### 6.7.2.2 URSP Compliance Verification in PDU Session Establishment
procedure
This procedure describes the URSP Compliance Verification during the PDU
Session Establishment procedure:
1) Authorization of URSP compliant PDU Session Establishment with (or without)
UE reporting URSP rule identifier. (UARI).
2) Reporting of PDU Session Parameters with (or without UE) UE reporting URSP
rule identifier (PSPR).
Figure 6.7.2.2-1: URSP Compliance Verification during PDU Session
Establishment
1\. After the UE evaluates URSP rules, the UE detects an application that
matches the URSP rule and determines to establishment a new PDU Session based
on the URSP. If the UE receives the URSP Compliance Request (UCR) in the
provisioning of URSP compliance verification during registration procedure
(see the step 5 of Figure 6.7.2.1-1), the UE sends the PDU Session
Establishment request including the URSP Rule Identifier (URID) associated
with URSP rule causing the establishment of this PDU session.
NOTE 1: No new privacy issue is caused by this solution.
2\. The AMF forwards the PDU Session Establishment to the SMF. If the PSPR or
UARI is requested from the UE-PCF, the AMF forwards the request to the SMF
together with PCF binding info.
3\. UARI mode: The SMF sends Requested PDU Session Parameters (R-PSPs). The
R-PSPs include the DNN, S-NSSAI, PDU Session Type, Access Type, which already
appear in Npcf_SMPolicyControl_Create request. In addition, the R-PSPs include
the SSC Mode, PDU Session Pair ID, RSN if the UE sent in the PDU Session
Establishment request so that the PCF can validate the parameters.
4\. If the UE-PCF has requested UARI (as in the step 3 of Figure 6.7.2.1-1),
the SM-PCF sends the URSP Compliance Authorization Request to the UE-PCF.
5\. The UE-PCF verify whether the UE is compliant with the URSP rules by
checking the requested PDU Session parameters with the URSP rules (RSDs) and
authorises the UE requested PDU Session. The UE-PCF is able to reject the PDU
Session if the UE-PCF determines that the request is not compliant with URSP
rules.
Once the UE-PCF authorises the URSP compliance, the UE-PCF sends URSP
Compliance Authorization Response including the URSP compliance result.
NOTE 2: When UE-PCF and SM-PCF is deployed in the same entity, the step 4\~5
and 11 are not exposed.
6\. If URSP compliance result is successful, the SM-PCF sends the authorized
policy information to the SMF. The SMF forwards the URSP compliance result.
7\. If the SMF is requested with UARI and the URSP Compliance Authorization
Result is not successful, the SMF reject the PDU Session Establishment.
8\. The AMF forwards the PDU Session Establishment Accept/Reject to the UE.
9\. The AMF updates the SM context.
10\. After the successful establishment of the PDU Session, if the SMF is
indicated with the PSPR, the SMF reports the A-PSPs to the SM-PCF.
NOTE 3: The UE-PCF can stores the established PDU Session Parameters and later
it can use them to verify whether the UE is compliant with selecting the PDU
Session for the corresponding application or application traffic by using
application detection feature.
11\. If the SM-PCF is requested with PSPR to the UE-PCF, the SM-PCF notifies
the UE-PCF of the PDU Session Status, PDU Session ID and URID, A-PSP. The UE-
PCF records A-PSP, PDU Session ID associated with the URSP Rule Identifier for
verification of the URSP compliance.
### 6.7.3 Impacts on services, entities and interfaces
UE:
\- The UE should understand the URSP Rule Identifier referring URSP Rules and
be able to identify the URSP rule when initiating a PDU Session.
\- The UE should be able to report the URSP Rule Identifier in the PDU Session
Establishment Request.
\- The UE should be able to report the complied URSP Rule Identifiers back to
the UE-PCF.
NOTE: Due to UE design philosophy, some of UE implementation may not support
some of Traffic Descriptors in the URSP Rule. For those URSP rules, the UE may
reply to the UE-PCF with sending the compiled URSP Rule Identifiers with UE
policy delivery result.
AMF:
\- The AMF should be able to receive the request (i.e. either URSP Compliance
Authorization or PDU Session Parameter Reporting) and its related parameters
from the UE-PCF during UE Policy Association procedure.
\- When receiving PDU Session Establishment request from the UE, the AMF
should forward the request from the UE-PCF to the SMF.
SMF:
\- For URSP Compliance Authorization, the SMF should authorize the UE
requested PDU Session based on the response from the SM-PCF after the UE-PCF
authorizes the request via SM-PCF.
\- For PDU Session Parameter Reporting, the SMF should report the requested
and accepted PDU Session Parameters to the SM-PCF so that SM-PCF can report
those to the UE-PCF.
SM-PCF:
\- For USSP Compliance Authorization, during the SM Policy Association
procedure caused by the PDU Session Establishment, the SM-PCF performs the
URSP compliance authorization with UE-PCF.
\- For PDU Session Parameter Reporting, after the PDU Session Establishment
procedure, the SM-PCF reports the UE requested and accepted PDU Session
Parameters to the UE-PCF.
UE-PCF:
\- The UE-PCF is responsible for URSP compliance verification. The UE-PCF
should be able to support 1) URSP Compliance Reporting 2) URSP Compliance
Authorization 3) PDU Session Parameter Reporting.
\- For URSP Compliance Reporting (UCR request) to the UE, the UE-PCF generates
the URSP rules with URSP Rule Identifier and request the UE to report the URSP
Rule Identifier.
\- For URSP Compliance Authorization (UARI), the UE-PCF should be able to
authorize the UE-requested PDU Session by checking whether the PDU Session
Parameters of the request is compliant to the RSD\'s of URSP rules.
\- For PDU Session Parameter Reporting (PSPR), the UE-PCF should be able to
request the SMF to report the PDU Session Parameters of the request.
## 6.8 Solution #8: URSP Rule Precedence reporting for awareness of URSP
enforcement
### 6.8.1 Description
This solution aims to address the Key Issue#2: 5GC awareness of URSP
enforcement.
It is proposed to use the parameter of URSP Rule Precedence to identify a
specific URSP rule.
The UE can indicate to the network the URSP rule it is trying to enforce by
reporting the URSP Rule Precedence. When an existing PDU session matches the
RSD of selected URSP, or when the UE tries to establish a new PDU Session
using the values specified by the selected RSD, the URSP enforcement reporting
process can be done during a session management procedures such as PDU Session
Establishment procedure or PDU Session Modification procedure.
To protect user privacy, the URSP enforcement reporting process shall be
subject to user consent. The user consent is obtained by the ASP and provided
to the MNO. The information of user consent for URSP enforcement reporting is
included per URSP rules and provisioned to the UE. The UE reports the URSP
Rule Precedence of the URSP rule it is trying to enforce only when the user
consent part of the URSP rule is \"YES\".
NOTE: The procedures to obtain user consent need to be studied by SA3.
### 6.8.2 Procedures
As described in TS 23.503 [4], for every newly detected application the UE
evaluates the URSP rules in the order of Rule Precedence and determines if the
application is matching the Traffic descriptor of any URSP rule. When a valid
Route Selection Descriptor is found, the UE determines if there is an existing
PDU Session that matches all components in the selected Route Selection
Descriptor.
If one or more matching PDU Session(s) exist(s), the UE associates the
application to one existing PDU Session and initiates PDU Session Modification
procedure for URSP enforcement reporting as described in clause 4.3.3.2 of TS
23.502 [3]. Following impacts are applicable:
\- Step 1a: The UE includes UE Policy Container (URSP Rule Precedence
corresponding to the URSP rule enforced by the UE, and the operating system
identifier) in PDU Session Modification Request message. The AMF transfers the
message transparently to the SMF via Nsmf_PDUSession_UpdateSMContext message.
\- Step 2: After receiving UE Policy Container in the PDU Session Modification
Request message, the SMF forwards the PCF the UE Policy Container reported by
the UE using Npcf_SMPolicyControl_Update service operation. The PCF returns
the URSP rule indicated by the URSP Rule Precedence to the SMF.
The SMF compares the RSD of the URSP rule received from the PCF with the PDU
session attributes (e.g. DNN, S-NSSAI, etc) of the PDU session the UE trying
to associate to. If it is not matched, the SMF rejects the PDU Session
Modification request with a proper cause value.
\- Step 2a/2b: The SMF generates N4 rules (PDR, URR) based on the Traffic
Descriptor of the URSP rule received from the PCF and provisions the rules to
the UPF using N4 Session Modification procedure. The SMF indicates the UPF to
report the event when incorrect application traffic is detected for the QoS
Flow indicated in the PDR.
When incorrect application traffic is detected, the UPF should send a report
to the SMF. The SMF should further inform to the PCF that the URSP rule is
wrongly enforced by the UE. The PCF can decide whether to update the URSP
rules to the UE based on local configuration and operator policies (e.g.
update the URSP via UCU procedure by excluding the wrongly enforced URSP
rule).
NOTE 1: It is assumed that same PCF is selected by the SMF and the AMF.
NOTE 2: The PDR sent from the SMF to the UPF indicates the QFI and a Packet
Filter Set, any traffic in the QoS Flow identified by the QFI does not match
the Packet Filter Set deemed as incorrect application traffic.
If none of the existing PDU Sessions matches the selected Route Selection
Descriptor, the UE tries to establish a new PDU Session as described in clause
4.3.2.2.1 TS 23.502 [3] using the values specified by the selected RSD.
Following impacts are applicable for URSP enforcement reporting:
\- Step 1: The UE includes UE Policy Container (URSP Rule Precedence
corresponding to the URSP enforced by the UE, and the operating system
identifier) in PDU Session Establishment Request message.
\- Step 3: The AMF transfers the PDU Session Establishment Request (UE Policy
Container (URSP Rule Precedence corresponding to the URSP rule enforced by the
UE, and the operating system identifier)) to the SMF by
Nsmf_PDUSession_CreateSMContext Request message.
\- Step 7b: After receiving UE Policy Container in the PDU Session
Establishment Request message, the SMF forwards to the PCF the UE Policy
Container reported by the UE using Npcf_SMPolicyControl_Create service
operation. The PCF returns the URSP rule indicated by the URSP Rule Precedence
to the SMF.
The SMF compares the RSD of the URSP rule received from the PCF with the PDU
session attributes (e.g. DNN, S-NSSAI, etc) of the PDU session the UE trying
to establish. If it is not matched, the SMF rejects the PDU Session
Establishment request with a proper cause value.
\- Step 10a/10b: The SMF generates N4 rules (PDR, URR) based on the Traffic
Descriptor of the URSP rule received from the PCF and provisions the rules to
the UPF using N4 Session Establishment procedure. The SMF indicates the UPF to
report the event when incorrect application traffic is detected for the QoS
Flow indicated in the PDR.
When incorrect application traffic is detected, the UPF should send a report
to the SMF. The SMF should further inform to the PCF that the URSP rule is
wrongly enforced by the UE. The PCF can decide whether to update the URSP
rules to the UE based on local configuration and operator policies (e.g.
update the URSP via UCU procedure by excluding the wrongly enforced URSP
rule).
### 6.8.3 Impacts on services, entities and interfaces
UE:
\- Initiates PDU Session Modification procedure when matching PDU Session is
found for a URSP rule, and includes UE Policy Container (URSP Rule Precedence
corresponding to the URSP enforced by the UE, and the operating system
identifier) in PDU Session Modification Request message.
\- During the new PDU Session Establishment procedure when none of the
existing PDU Sessions matches the selected Route Selection Descriptor,
includes UE Policy Container (URSP Rule Precedence corresponding to the URSP
enforced by the UE, and the operating system identifier) in PDU Session
Establishment Request message.
SMF:
\- Forwards the UE Policy Container reported by the UE to the PCF.
\- Compares the RSD of the URSP rule received from the PCF with the attributes
of the PDU session the UE trying to establish or associate to.
\- Generates N4 rules (PDR, URR) based on the Traffic Descriptor of the URSP
rule received from the PCF.
\- Indicates the UPF to report the event when incorrect application traffic is
detected for the QoS Flow indicated in the PDR.
\- Forwards the incorrect application traffic detection report received from
UPF to the PCF.
PCF:
\- Based on the UE Policy Container received from the SMF, provides
corresponding URSP rule to the SMF.
\- Decides whether to update the URSP to the UE by the UCU procedure when
incorrect application traffic detection report is received from the SMF.
UPF:
\- Detects application traffic and reports to the SMF when incorrect
application traffic is detected.
## 6.9 Solution #9: Per-PDU session awareness of URSP enforcement
### 6.9.1 Description
Editor\'s note: This clause will describe the solution principles and
architecture assumptions for corresponding key issue(s) which should be
explicitly stated. Clause(s) may be added to capture details.
The main use case of this solution is to support a network operator to
determine if a UE routes application traffic to an established PDU session of
a specific DNN/S-NSSAI according to a URSP rule. For example, when the UE
establishes a PDU session to an S-NSSAI/DNN that is used for enterprise
services, based on a specific URSP rule, the network operator verifies that
the UE does not route application traffic that is not intended for enterprise
services.
The solution relies on the PCF to identify if a UE routes traffic correctly
when the UE establishes a PDU session for an S-NSSAI/DNN/RAT type that matches
a Route Selection Descriptor of a URSP rule that was provisioned to the UE.
The PCF determines to identify if the UE routes traffic correctly to the UE
requested PDU session based on local configuration or based on information
provided by the UDR. In such scenario, the PCF determines the applicable URSP
rule that triggered the UE to request establishment of a PDU session to a
specific S-NSSAI/DNN by obtaining the list of PSIs containing the provisioned
URSP rules to the UE from the UDR. The PCF then identifies the traffic allowed
to the requested S-NSSAI/DNN by identifying URSP rule(s) that have within a
Route Selection Descriptor, components that matches the requested S-NSSAI/DNN
and then evaluating the Traffic Descriptor of such URSP rule(s). For example,
if the Traffic Descriptor includes a Destination Address IP 3 tuple then the
PCF considers allowed traffic any traffic sent to or received via the
Destination Address.
When the PCF is triggered to identify if the UE routes traffic to an
S-NSSAI/DNN according to a provisioned URSP rule the PCF provides rules to the
SMF to report traffic that is not intended to be routed via the PDU session.
Further details are provided below.
### 6.9.2 Procedures
Editor\'s note: This clause describes high-level procedures and information
flows for the solution.
The procedure is shown below:
Figure 6.9.2-1: PCF requests to identify from UPF if UE enforces URSP rules
correctly
The procedure is as follows:
0\. An application in the UE sends traffic or request a network connection.
1\. The UE detects new application traffic and determines that application
traffic needs to be routed via a PDU session of a specific DNN, S-NSSAI, RAT
type. The determination may be based due to a configured URSP rule, local
configuration or application request.
2\. The UE requests establishment of a PDU session using specific S-NSSAI,
DNN, SSC mode. Optionally, provided that there is user consent, if the
determination in step 1 was made due to a URSP rule the UE may include a URSP
indication in the PDU session establishment request provided that there is
user consent. The indication may include an identifier of the URSP rule that
triggered the UE to request establishment of a PDU session or may include the
Policy Section Identifier of the policy section that contained the URSP rule
that triggered the PDU session establishment.
3\. The SMF selects a PCF and requests policies by establishing an SM Policy
Association. The SMF sends an Npcf_SM_PolicyControl_Create including the SUPI,
PDU session ID, DNN, S-NSSAI requested and RAT type of the access that the UE
requested establishment of a PDU session.
4\. The PCF determines to check for the UE requested PDU session if the UE
routes traffic according to a provisioned URSP rule.
The PCF may be pre-configured or configured from the UDR with the allowed
traffic when a UE establishes a PDU session to a specific S-NSSAI/DNN.
Alternatively steps 5 takes place.
5\. The PCF determines the potential URSP rule and the corresponding Traffic
Descriptor of the URSP rule that triggered the UE to request establishment of
a PDU session to a specific S-NSSAI/DNN.
5a. The PCF obtains the URSP rule by interfacing with the UDR to obtain the
policy sections of URSP rules provisioned to the UE. The PCF may include the
PSI identifier or URSP rule id if included by the UE in step 2.
5b. The UDR provides the policy sections of the URSP rule.
6\. The PCF makes policy decisions according to UE subscription.
7\. The PCF provides PDU session related information rules and PCC rules in an
Npcf_SMPolicyCreate_Response. The PCF also includes rules to the SMF to report
non-matching traffic (i.e. traffic different to the allowed traffic) via the
S-NSSAI, DNN. The PCF includes the Allowed Traffic that can be routed via the
PDU session.
NOTE: The PCF may provide rule at a later stage by invoking an
Npcf_SMPolicyModication request.
8\. SMF based on the PCC rules installs N4 rules at the UPF. SMF includes
rules to the UPF to report non-matching traffic via the S-NSSAI, DNN and
includes also the allowed traffic.
9\. When the UPF detects non-matching traffic the UPF reports the traffic to
the SMF. The UPF includes the service data flow information of the non-
matching traffic detected.
10\. The SMF reports the detected information to the PCF.
11\. The PCF determines if the traffic reported should be sent via a different
S-NSSAI or whether traffic should be blocked. The PCF may install rules to the
SMF to block such traffic or determine new URSP rules to route traffic via a
different S-NSSAI.
12\. The PCF provides updated URSP rules to the UE using the UE Configuration
Update for transparent policy delivery.
### 6.9.3 Impacts on services, entities and interfaces
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
\- UPF report SDFs that do not match to allowed traffic.
## 6.10 Solution #10: Network based URSP rules enforcement feedback
### 6.10.1 Description
#### 6.10.1.1 Network based URSP rules enforcement verification without UE
assistance
The UE uses URSP rules to apply the application traffic to PDU sessions in UE.
But, for some of the situation, the 5GC wants to aware of the enforcement of
URSP rules in UE.
One of the solutions is, according to the URSP rules, the UPF sets the PDR in
specific UE\'s PDU session. If the specific application packets are detected
by PDR, it means the application traffic is applied to this PDU session, and
the parameters of this PDU session can be used to reverse to determine the
RSD. Which RSDs contains the PDU session parameters, is the real URSP rules
that used in UE for this application traffic.
If PCF wants to monitor some of the enforcement of the RSD in specific Traffic
Descriptor, the PCF provides the Traffic Descriptor which describes the
traffic feature to SMF to construct the PDR.
In PDR, the packet filter set is the main parameters for UPF to detect. And in
the Traffic Descriptor in URSP rules, the IP descriptor can be directly used
for the construction of PDR, that the IP descriptor describes the destination
IP address. But for other kinds of Traffic Descriptor, for example, the
Application Descriptor, DNN, Domain Descriptor or Connection Capabilities,
that these parameters can\'t be directly used for construction of PDR.
Although some of the Traffic Descriptor in URSP rules doesn\'t provide the
5-IP-tuple, but finally, the application traffic should be routed to a
specific application server which is represented as IP address and port
number. So, it means the Traffic Descriptor in UE only has the function of
applying application traffic to specific PDU session, but there still has a
mapping table between Traffic Descriptor and destination IP address.
So, after applying the application traffic to a PDU session, the SMF should
set the destination IP address of this application traffic in UPF. The SMF
should maintain a mapping table between non-IP related Traffic Descriptor and
3-IP-tuple.
For example:
\- If the application traffic is applied to a PDU session by Traffic
Descriptor = ABC.com (FQDN), the SMF should have a mapping table between
ABC.com and the destination IP address of this application traffic, for
example, ABC.com (FQDN) is equal to 100.1.1.1;
\- If the application traffic is applied to a PDU session by Traffic
Descriptor = APP1 (Application Descriptor), the SMF should have a mapping
table between APP1 and the destination IP address of this application traffic,
for example, APP1 is equal to 192.168.1.1
#### 6.10.1.2 Network based URSP rules enforcement verification with UE
assistance
Without UE\'s assistance, the network sides should have the packet detection
in every of the UE\'s PDU session. In order to reduce the burden of network,
some of the information should be reported by UE. For example, when UE
enforces the URSP rules to apply the application traffic to a PDU session, the
UE can report the PDU session ID that the application traffic applied to, and
report the URSP rules the UE uses. With the help of UE, there are three level
of URSP rules verification:
\- The stage 1 verification: When UE uses the URSP rules (one of the Traffic
descriptor and RSD) to apply the application traffic to a PDU session (both
existing PDU session or trigger to establish a new PDU session), the UE
notifies the AM-PCF via NAS messages which URSP rules is used and which PDU
session the application traffic applied to (indicated by PDU session ID). The
AM-PCF can check the URSP rules that UE notifies. The URSP rule reported by
the UE is inconsistent with the rule delivered by the network, the AM-PCF
determines that the UE doesn\'t use the URSP rules correctly.
\- The stage 2 verification: Although the UE notifies the URSP rules it used
and the PDU session that the application traffic applied to, the AM-PCF should
trigger the SMF to check whether the parameters of the PDU session (for
example, the SSC mode, PDU session type and etc) are the same as in RSD. If in
the PDU session ID which PDU session refers to and the application traffic
applied to, the PDU session parameters are not the same as the parameter
indicated in RSD, the AM-PCF can decide that the UE doesn\'t use the URSP
rules correctly. Because the real PDU session parameters are not the same as
the parameters in RSD that UE notifies.
\- The stage 3 verification: Based on the previous two level of verification,
the AM-PCF can decide that UE reports the same URSP rules as network
distributed and the PDU session parameters are the same as in RSD that UE
reports. But, whether the application traffic exists in the PDU session is
unknown. So, the last stage of verification is, the 5GC should use the traffic
detection mechanism in the PDU session, to detect whether the application
traffic exists. The SMF develops the PDR according to the traffic descriptor
and applies the PDR to PDU sessions. If no packet is detected, the SMF
notifies the AM-PCF the results and the AM-PCF decides the UE doesn\'t use the
URSP rules correctly.
### 6.10.2 Procedure
#### 6.10.2.1 Network based URSP rules enforcement verification without UE
assistance
The details of the procedure of network based URSP rules enforcement feedback
is in Figure 6.10.2-1.
Figure 6.10.2-1: Network based URSP rules enforcement feedback
1\. The PCF determines to monitor the URSP rules enforcement in UE.
2\. The PCF finds the SMF serving the UE for this SUPI using
Nudm_UECM_Get_Request including SUPI, type of requested information set to SMF
Registration Info and the S-NSSAI and DNN, as defined in clause 5.3.2.5.7 of
TS 29.503 [11].
3\. The UDM provides the SMF id and the corresponding PDU Session id, S-NSSAI,
DNN using
4\. The PCF subscribes the service in SMF for packet detection. The PCF
provides the monitored Traffic Descriptor to SMF via
Nsmf_EventExposure_Subscribe. The PCF will be notified with the PDU session
parameters that the application traffic applied to.
NOTE: The PCF is AM-PCF, and the subscription procedure can be routed to SMF
via SM-PCF. The details are described in the Figure 6.10.2-2.
5\. The SMF receives the parameters of Traffic Descriptor from PCF and
generate the PDR. And the SMF should derive the IP descriptor which the
Traffic Descriptor corresponds to.
And in the Traffic Descriptor, the IP descriptor can be directly used for the
construction of PDR, that the IP descriptor describes the destination IP
address. If for other kinds of Traffic Descriptor, for example, the
Application Descriptor, DNN, Domain Descriptor or Connection Capabilities, the
SMF derives the 3-IP-tuple which the Application Descriptor, DNN, Domain
Descriptor or Connection Capabilities corresponds to by the maintained mapping
table between non-IP related Traffic Descriptor and 3-IP-tuple.
6\. The SMF applies the PDR to the UPF that serves the UE via N4 session
procedure.
7\. In UE, an application traffic is mapped to a PDU session by the monitored
URSP rules.
8\. The UPF detects the application traffic by PDR in a PDU session.
9\. The UPF reports the PDU session information, which the application traffic
applied to, to SMF, including the PDU session information, including PDU
session id, SSC mode, DNN, access type, S-NSSAI and etc, by N4 reporting
procedure. The PDU session information is used to verify the which RSDs are
enforced in the Traffic Descriptor in URSP rules.
10\. The SMF reports the PDU session information, which the application
traffic applied to, to PCF, including the PDU session id, SSC mode, DNN,
access type, S-NSSAI and etc by Nsmf_EventExposure_Notify.
11\. The PCF verify which RSDs are enforced in the Traffic Descriptor in URSP
rules according to PDU session information. And PCF determines the enforcement
of UE\'s URSP rules at this step. If no RSDs are matched to the PDU session
information, it means the UE doesn\'t use the URSP rules correctly.
The PCF should re-evaluate the URSP rules to this UE and update the URSP rules
in UE, if the URSP rules are not enforced correctly. For example, adjust the
precedence of Traffic Descriptor or RSD, update the RSDs in Traffic
Descriptor, add or remove the Traffic Descriptor and RSDs, etc.
12\. The PCF updates the re-evaluated URSP rules to UE, according to the step
from step 5 to step 9 described in clause 4.16.12.2 of TS 23.502 [3].
#### 6.10.2.2 Network based URSP rules enforcement verification with UE
assistance
Figure 6.10.2-2: Network based URSP rules enforcement feedback with UE
assistance
1\. UE performs the URSP rules to apply application traffic to a PDU session,
including newly establish a PDU session or apply the application traffic to
existing PDU session.
2\. The UE delivers the URSP rules enforcement results to AM-PCF via AMF by UL
NAS messages, including the used URSP rules (represented by Traffic Descriptor
precedence or RSD precedence, or, represented by details of Traffic Descriptor
or RSD), PDU session ID that the application traffic applied to.
3\. The AMF delivers the URSP rules enforcement results to AM-PCF by
Npcf_UEPolicyControl_Update request, including the used URSP rules
(represented by Traffic Descriptor precedence or RSD precedence, or,
represented by details of Traffic Descriptor or RSD), PDU session ID that the
application traffic applied to.
4\. The AM-PCF responses to AMF.
5\. The AM-PCF performs the stage 1 verification. The AM-PCF can check the
URSP rules that UE notifies with the URSP rules AM-PCF delivers to UE. If the
URSP rule reported by the UE is inconsistent with the rule delivered by the
network, the AM-PCF determines that the UE doesn\'t use the URSP rules
correctly.
If the AM-PCF determines the UE doesn\'t use the URSP rules correctly, the
step from step 6 to step 19 are skipped.
NOTE 1: For example, the UE reports the URSP rules is: TD = \"FQDN =
ABC.com\", RSD 1 = \"SSC mode 2, DNN = DNN1\", but the AM-PCF checks that the
real URSP rules delivered to UE is: TD = \"FQDN = ABC.com\", RSD 1 = \"SSC
mode 3, DNN = DNN1\". So the AM-PCF determines that the UE doesn\'t use the
URSP rules correctly
6-7. The AM-PCF recovers the SMF ID, SM-PCF ID from UDM, with Key = SUPI,
Subkey = S-NSSAI or DNN.
8\. The AM-PCF triggers the procedure Npcf_PolicyAuthorization Subscribe to
subscribe the packet detection results in certain PDU session. In the
subscription, the AM-PCF provides SMF ID, used URSP rules (represented by
Traffic Descriptor precedence or RSD precedence, or, represented by details of
Traffic Descriptor or RSD), PDU session ID to SM-PCF.
9\. The SM-PCF subscribes the service in SMF for packet detection. The PCF
provides the monitored Traffic Descriptor to SMF via
Nsmf_EventExposure_Subscribe. The PCF will be notified with the PDU session
parameters that the application traffic applied to.
10\. The SMF recovers the PDU session parameters according to PDU session ID,
for example, SSC mode, DNN, S-NSSAI, PDU session type and etc. The SMF can
have two options to perform stage 2 verification:
\- Option 1: The SMF can compare the PDU session parameters with the
parameters in RSD. If either one of the parameters is not the same, the SMF
notifies the SM-PCF by Nsmf_EventExposure Notify in step 11, and SM-PCF
notifies AM-PCF by Npcf_PolicyAuthorization_Notify with the failure results.
And the AM-PCF determines that the UE doesn\'t use the URSP rules correctly.
From step 13 to step 19 are skipped.
\- Option 2: The SMF only delivers the recovered PDU session parameters to AM-
PCF, via SM-PCF in step 11 and step 12. The AM-PCF compares the PDU session
parameters with the parameters in RSD. If either one of the parameters is not
the same, the AM-PCF determines that the UE doesn\'t use the URSP rules
correctly. From step 13 to step 19 are skipped.
11\. (optional) After the SMF compares the PDU session parameters with the
parameters in RSD, if either one of the parameters is not the same, the SMF
notifies the SM-PCF by Nsmf_EventExposure Notify with the stage 2 verification
failure.
12\. (optional) The SM-PCF notifies AM-PCF by Npcf_PolicyAuthorization_Notify
with the stage 2 verification failure results.
13\. The SMF receives the parameters of Traffic Descriptor from SM-PCF and
generate the PDR. And the SMF should derive the IP descriptor which the
Traffic Descriptor corresponds to.
And in the Traffic Descriptor, the IP descriptor can be directly used for the
construction of PDR, that the IP descriptor describes the destination IP
address. If for other kinds of Traffic Descriptor, for example, the
Application Descriptor, DNN, Domain Descriptor or Connection Capabilities, the
SMF derives the 3-IP-tuple which the Application Descriptor, DNN, Domain
Descriptor or Connection Capabilities corresponds to by the maintained mapping
table between non-IP related Traffic Descriptor and 3-IP-tuple.
14\. The SMF determines the UPF or PSA that serves the PDU session which
indicated by PDU session ID.
NOTE 2: The SMF triggers the packet detection procedure only after the UE
report that a URSP rule have been applied or enforced.
15\. The SMF applies the PDR to the UPF that serves the UE via N4 session
procedure.
16\. The UPF detects the application traffic by PDR in a PDU session in the
certain time range. The results can be either successfully detected or not
detected.
17\. The UPF reports the packet detection results to SMF, either successfully
detected or not detected in the certain time range.
18\. The SMF reports the packet detection results to SM-PCF by
Nsmf_EventExposure_Notify. This packet detection results are used for stage 3
verification.
19\. The SM-PCF notifies AM-PCF by Npcf_PolicyAuthorization_Notify with packet
detection results.
20\. The AM-PCF performs stage 2 verification and stage 3 verification:
Stage 2 verification: The AM-PCF compares the PDU session parameters with the
parameters in RSD. If either one of the parameters is not the same, the AM-PCF
determines that the UE doesn\'t use the URSP rules correctly.
Stage 3: The AM-PCF receives the packet detection results from SMF via SM-PCF.
If no packets are detected from the PDU session which indicated by the PDU
session ID that UE reports, it means that the real application traffic
doesn\'t exist in the PDU session, and the UE doesn\'t use the URSP rules
correctly. If the packets are detected from the PDU session, the UE uses the
URSP rules correctly.
21\. The PCF updates the re-evaluated URSP rules to UE, according to the step
from step 5 to step 9 described in clause 4.16.12.2 of TS 23.502 [3].
### 6.10.3 Impacts on services, entities and interfaces
Editor\'s note: This clause lists impacts to services and interfaces.
PCF (AM-PCF or SM-PCF):
\- Decides the monitored URSP rules, and provides the parameters in Traffic
Descriptor to SMF to generate PDR.
\- Subscribe the packet detection results from SMF to verify the URSP rules
enforcement in UE.
\- Re-evaluates the URSP rules to the UE and update the URSP rules in UE, if
the URSP rules are not enforced correctly according to the notification from
SMF.
SMF:
\- Transition of the Application Descriptor, DNN, Domain Descriptor or
Connection Capabilities in Traffic Descriptor to IP descriptor to construct
3-IP-tuple in PDR.
\- Receives the monitored Traffic Descriptor which is included in the
monitored URSP rules from PCF.
\- Provide the traffic detection results to PCF.
UE:
\- Reports the enforced URSP rules and PDU session ID that the application
traffic applied to, to AM-PCF by UL NAS messages.
## 6.11 Solution #11: 5GC awareness of URSP recognition by UE
### 6.11.1 Description
This solution is proposed to address KI#2 to assist 5GC awareness of URSP
enforcement. It is beneficial for both the UE and the 5GC to ensure that the
URSP rules provisioned to the UE are enforceable. With enforceable URSP rules,
the mechanisms that allow 5GC to determine when the UE enforces the URSP rules
can be followed efficiently.
Currently the UCU procedure is used to provision UE policy (including URSP
policy) to UE. However, the result in the UCU Response message only indicates
whether the UE supports the type of UE policy per Policy Section.
Meanwhile, if UE supports URSP but does not recognize a URSP rule (e.g. due to
not recognize the TD parameter in a URSP rule), the UE will ignore(skip) the
URSP rule without any notification to the network side. This implicit ignoring
will result in the inefficiency for the UE to perform URSP rules evaluation
and enforcement and for the 5GC to configure enforceable URSP rules at the UE
for routing specific application traffic to a specific route, e.g. expected
slice as described in an RSD of a URSP rule.
Therefore, it is proposed to enhance the UCU procedure so that the UE can
indicate in the UL NAS Transport message if and which TD type(s) of the URSP
rule are not recognized by UE.
### 6.11.2 Procedures
Figure 6.11.2-1: Result of the delivery of UE policies indicate if and which
URSP rule is supported by UE
The procedure above is extended from the UCU procedure in clause 4.2.4.3 of TS
23.502 [3]:
\- In step 3, the PCF indicates to the UE via AMF to obtain information from
the UE for URSP policy in the UE policy container.
\- When receiving the indication, the UE will evaluate each URSP rule in the
UE policy container received in step 3, and identify which component(s) of the
URSP rule (i.e. TD types) are not recognized by UE.
\- The UE indicates corresponding status information of the UE for URSP policy
in step 6a.
Based on the feedback from UE, the PCF may update the parameters (e.g. if some
parameters in TD are wrongly configured) and provision the updated URSP to UE
again. Whether and how to determine the URSP Rules to be sent to UE based on
the feedback received is implementation specific.
### 6.11.3 Impacts on services, entities and interfaces
UE:
\- Receive the indication and check the URSP rules when it is provisioned in
\"Delivery of UE policies\" message for reporting unrecognized URSP rules; and
\- Provide feedback about which TD type(s) that cannot be recognized in the
URSP rule in NAS Transport message.
PCF:
\- Store TD types that are not recognized by the UE, use them for URSP Rule
generation.
\- Be configured with local policies to enable checking if the UE recognizes
TD types.
## 6.12 Solution #12: URSP rule enforcement validation via gating control
### 6.12.1 Description
This solution addresses Key Issue #2 on validation of URSP rule enforcement.
For newly detected application, the UE is required to evaluate the URSP rules
and associate the application to a specific PDU Session, by initiating PDU
Session Establishment procedure or PDU Session Modification procedure,
depending on whether existing PDU session can be reused or not.
While, the core network is not aware of which URSP rule is matched in the UE,
not to mention what the detected application is. As the URSP rule is only
known to the core network at PSI granularity.
To resolve the validation of URSP rule enforcement, URSP rule ID is introduced
to uniquely identify the URSP rule sent to a UE. When the PCF provides URSP
rules to the UE, a rule ID is allocated for each URSP rule and sent to the UE
together with the URSP rules, apart from the PSI. When the UE initiates a PDU
Session Establishment/Modification request, the UE indicates the URSP rule ID
it uses for the request to the network, the network is able to know which URSP
rule is enforced by the UE for the request. Further the PCF for the PDU
Session when receiving the URSP rule ID transferred by the SMF can retrieve
the content of the URSP rule identified by the rule ID from the PCF for the UE
or the UDR, and then check if the requested S-NSSAI and DNN requested by the
UE matches with the components of the Route Selection Descriptors of the URSP
rule, and generate the policy for the session management e.g. allow the
application traffic identified by the corresponding Traffic descriptor of the
URSP rule, to be transferred via the PDU Session.
The enhancement is to add a Rule Identifier to URSP rule as defined in the
Table 6.6.2.1-2 of the TS 23.503 [4].
+----------------+----------------+-------------+-----+------------+ | Rule | Uniquely | Conditional | Yes | UE Context | | Identifier | identifies the | | | | | | URSP rule, | | | | | | within the UE. | | | | | | | | | | | | It is used | | | | | | between PCF | | | | | | and UE for | | | | | | referencing | | | | | | URSP rules. | | | | +----------------+----------------+-------------+-----+------------+
When detecting there is an unmatched application in the PDU Session, the PCF
for the PDU Session may notify the PCF for the UE and the PCF for the UE may
decide to update the URSP in the UE.
NOTE: The UE may use wrong URSP since the URSP in UE is not updated in time.
Editor\'s note: It is FFS whether the URSP rule identifier is mandatory.
Editor\'s note: User consent is needed for URSP rule ID reporting and the
detailed descriptions and procedures of user consent is FFS.
### 6.12.2 Procedure
When the UE triggers the PDU Session Establishment procedure or PDU Session
Modification Procedure, the rule identifier of the matched URSP rule will be
provided to the SMF, and then further provided by the SMF to the PCF for
validation of the enforcement of the corresponding URSP rule and generate
corresponding policy for the session management.
Figure 6.12.2-1: PDU Session Establishment/Modification Procedure for URSP
enforcement validation
1\. During the PDU Session Establishment/Modification procedure, the URSP rule
ID related to the application which triggers the procedure is contained within
the SM NAS request message by the UE.
2\. The SMF sends Npcf_SMPolicyControl_Create/Update request message to the
PCF, which includes the URSP rule ID received from the UE.
3\. Upon receiving the URSP rule ID, the PCF for the PDU Session can retrieve
the content of the corresponding URSP rule by either interacting with PCF for
the UE via Npcf_EventExposure_Subscribe service operation or with the UDR via
Nudr_DM_Query service operation (e.g. Policy Set Entry).
4\. Based on the received URSP rule, the PCF for the PDU Session first checks
whether the PDU Session is associated correctly, e.g. whether the DNN/S-NSSAI
or the SSC mode matches with the components of the RSD(s) of the URSP rule. If
the PDU Session is associated correctly, the PCF can make policy decision by
generating PCC rule(s) corresponding to the application traffic identified by
the Traffic descriptor. If the PDU Session is associated incorrectly, the PCF
may reject the request message from the SMF.
5\. The PCF provides the generated PCC rule(s) based on the URSP received in
step 3 to the SMF. In addition, the PCF may set \"unmatched application\" PCR
trigger to the SMF, and the SMF shall report to the PCF for the PDU Session
when it determines the application transferred in the PDU Session does not
match the URSP rule.
6\. The SMF enforces the received PCC rule(s) by providing corresponding N4
rule(s) to the UPF, thus the application traffic of the Traffic descriptor can
be transferred via this PDU Session.
7\. The SMF responds to the UE with PDU Session Establishment/Modification
Accept message, which may contain QoS rule(s) corresponding to the received
PCC rule(s).
After this procedure, upon receiving the service packets, if the UPF
determines that the service packets are not aligned with the instruction in N4
rules received from SMF, the UPF will drop the packet and report the unmatched
application event (i.e. there is an unmatched packet) to the SMF, then the SMF
notifies the PCF for the PDU Session. The PCF for the UE updates the URSP in
the UE when receiving the event notification of unmatched application from the
PCF for the PDU Session.
### 6.12.3 Impacts on existing Functions
The solution has impacts on the following entities:
UE:
\- Supports the reporting of URSP rule ID in PDU Session
establishment/modification request.
SMF:
\- Supports procedures for transferring of URSP rule ID to the PCF.
\- Reports to the PCF about whether there is an unmatched application event.
UPF:
\- Reports to the SMF about whether there is an unmatched application event.
PCF:
\- Supports procedures for querying the content of the URSP rule from the PCF
for the UE.
\- Generates the policy for the session management based on the URSP rule.
\- Rejects the transmission of application traffic not matching the Traffic
descriptor of the URSP.
\- Subscribes to PCF for the PDU Session and SMF for notification about
whether there is an unmatched application event.
\- triggers URSP update based on the unmatched application event.
## 6.13 Solution #13: URSP enforcement via PDU Session
authorization/authentication when UE associating with application
### 6.13.1 Description
This solution addresses Key Issue #2 5GC awareness of URSP enforcement.
Currently for every newly detected application, the UE evaluates the URSP
rules to select a Route Selection Descriptor. UE determines to reuse an
existing PDU Session or establish a new PDU Session to associate the
application, depending on whether an existing PDU Session matches all
components in the selected Route Selection Descriptor or not.
However, 5GC is not aware of which URSP rule the UE matches, and what
application the UE detects. To resolve the key issue, a PDU Session
authorization/authentication when UE detecting and associating with
application is introduced to verify whether the UE should route the specific
application traffic to the PDU session or not.
After UE evaluates the URSP rules to select a Route Selection Descriptor for
newly detected application, if UE determines to initiates a PDU Session
Establishment, the UE indicates the Rule Precedence of URSP rule it uses for
the request to the network, and the application identity.
NOTE 1: The DN-AAA server may belong to the 5GC or to the DN.
If the UE provides authentication/authorization information corresponding to
an application identity during the Establishment of the PDU Session, and the
SMF determines that Secondary authentication/authorization of the PDU Session
Establishment is required based on the SMF policy associated with the DN, the
SMF triggers a PDU Session Establishment authentication/authorization
procedure with the DN-AAA Server without involving the UPF if the DN-AAA
Server is located in the 5GC and reachable directly. If the SMF determines
that authentication/authorization of the PDU Session Establishment is required
but the UE has not provided an application identity as part of the PDU Session
Establishment request, the SMF requests the UE to indicate an application
identity using EAP procedures. If the authentication/authorization of the PDU
Session Establishment fails, the SMF rejects the PDU Session Establishment.
Before the UE reports application identity in PDU Session Establishment
request or NAS Authentication Message, the UE shall first obtain user consent.
NOTE 2: The scenario where to get user intention and consent for UE to report
the application identity, which involves UI interaction or message exchanges
between UE and user, is not in scope.
Editor\'s note: The procedures to obtain user consent need to be studied by SA
WG3.
If UE determines to reuse the existing PDU Session for the newly detected
application, UE shall initiate a PDU Session Establishment Request and
includes the Rule Precedence of URSP rule and application identity. The SMF
may trigger the PDU Session establishment authentication/authorization
procedure with the DN-AAA Server. DN-AAA Server based on the SMF policy
associated with the DN confirms the successful authentication/authorization of
the PDU Session for the specific application. The SMF shall reuse the existing
PDU Session and accept the PDU Session Establishment, without establish a new
PDU session.
NOTE 3: Application identity is the subscription identity of Network Slice
Customer (NSC), and able to map to the DN-AAA server.
Further, the PCF for SM policy control, when receiving the Rule Precedence of
URSP rule transferred by the SMF, can retrieve the content of the URSP rule
identified by the Rule Precedence from the PCF for AM policy control, and then
check if the requested S-NSSAI and DNN requested by the UE matches with the
components of the Route Selection Descriptors of the URSP rule, and generate
the policy for the session management e.g. allow the application traffic
identified by the corresponding Traffic descriptor of the URSP rule.
### 6.13.2 Procedures
Figure 6.13.2-1: PDU Session Establishment Procedure for URSP enforcement
1\. During the PDU Session Establishment procedure, UE includes Rule
Precedence of URSP rule and application identity in SM NAS request message.
2\. SMF triggers the PDU Session establishment authentication/authorization
directly with DN-AAA Server based on the SMF policy associated with the DN.
3\. DN-AAA Server sends an Authentication/Authorization message towards UE
including application identity.
4\. Transfer of DN Request Container information received from UE towards the
DN-AAA.
5\. The DN-AAA Server confirms the successful authentication/authorization of
the PDU Session associating with the application.
6\. Within the Npcf_SMPolicyControl_Create/Update request message, SMF provide
the Rule Precedence to the PCF.
7\. Upon receiving the Rule Precedence of URSP rule, the PCF can retrieve the
content of the corresponding URSP rule directly or from the UDR. Based on the
received URSP rule, the PCF checks whether the UE associated the correct PDU
Session according to the Route Selection Descriptor of the URSP rule. If the
PDU Session is associated correctly, the PCF can make policy decision by
generating PCC rule(s). If the PDU Session is associated incorrectly, the PCF
may reject the request message from SMF.
8\. The PCF provides the generated PCC rule(s) to the SMF.
9\. The SMF enforces the received PCC rule(s) by providing corresponding N4
rule(s) to the UPF, thus the traffic can be transferred via this PDU Session.
10\. The SMF responds to the UE with PDU Session Establishment Accept message,
which may contain QoS rule(s) corresponding to the received PCC rule(s).
### 6.13.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
UE:
\- Needs to support the reporting of Rule Precedence and application identity
in PDU Session Establishment request.
\- Needs to support secondary Authentication/Authorization based on the
application identity.
\- Needs to support to initiate a PDU session Establishment request if UE
determines to reuse the existing PDU Session for the newly detected
application after UE evaluates the URSP rules to select a Route Selection
Descriptor.
SMF:
\- Needs to support procedures for transferring of Rule Precedence to the PCF.
\- Needs to support procedures for transferring of application identity to the
DN-AAA Server in Authentication/Authorization Request in PDU session
establishment procedure.
PCF:
\- Needs to support procedures for querying the content of the URSP rule based
on received Rule Precedence of URSP rule.
\- Needs to generate the policy for the session management based on the URSP
rule, and reject the transmission of application traffic if not matching with
the Traffic descriptor of the URSP.
## 6.14 Solution #14: 5GC awareness of URSP rule evaluation and verification
of network slice usage
### 6.14.1 Description
This solution addresses Key Issue #2: \"5GC awareness of URSP enforcement\".
This solution is intended to be used when a specific network slice has been
deployed for the exclusive usage of an application service provider. Business
agreements between the MNO and the application service provider guarantee that
the network slice only carries traffic from the applications of the
application service provider.
URSP rules are enhanced with an optional indication that a URSP rule is
subject to application registration along with the address of an Application
Function. When receiving a URSP rule with this indication, the UE verifies
that the user consents to application registration (e.g. based on pre-
configuration by the user or interaction with the user); if not, then the UE
rejects this URSP rule and discards it.
When the evaluation of a URSP rule subject to application registration
triggers the establishment of a new PDU Session, the UE first performs
application registration with the indicated AF (unless this has been done
previously for the application requesting data transmission), and then
initiates PDU Session Establishment, including in the PDU Session
Establishment Request the Traffic Descriptor of the matched URSP rule, and the
application identity obtained during application registration. The SMF may
verify that the indicated application identity is trusted and that the S-NSSAI
is allowed for this application identity according to operator policy. If this
verification fails, the SMF rejects the PDU Session Establishment Request with
a proper cause value and the UE evaluates remaining URSP rules for routing the
user data from this application.
When the evaluation of a URSP rule subject to application registration leads
to routing the user data from a new application in an already established PDU
Session, the same as above applies except that PDU Session Modification is
used instead of PDU Session Establishment.
Application registration takes place between the UE and the AF, and the UE
provides to the AF and identifier recognized by the AF, that is linked with
the business agreement between the MNO and the application service provider,
and known to the application running in the UE, but that does not need to
reveal the exact application used as multiple applications involved with the
application service provider may use the same identifier with the AF. Then,
the AF provides the UE with the application identity that the UE will present
to the SMF at PDU Establishment Request.
NOTE: A mechanism for verification of the application identity needs to be
defined by SA WG3.
Editor\'s note: The SMF verification of the application identity based on
local policies needs to be detailed.
### 6.14.2 Procedures
#### 6.14.2.1 Overall procedure
Figure 6.14.2.1-1: 5GC awareness of URSP rule evaluation and verification of
network slice usage
1\. UE Policies are delivered to the UE using the current, existing mechanism
of UE Configuration Update procedure for transparent UE Policy delivery, see
clause 4.2.4.3 of TS 23.502 [3]. One or more URSP Rule contains an indication
that it is subject to application registration along with the address of an
AF. The UE may, based on local privacy settings and/or interaction with the
user, reject URSP rules containing an indication that it is subject to
application registration; in this case the UE indicates to the AMF the URSP
rule(s) that it rejects due to not allowing application registration for this
URSP rule.
2\. The evaluation of a URSP rule subject to application registration triggers
the establishment of a new PDU Session (case a) or leads to routing the user
data from a new application in an already established PDU Session (case b).
3\. If the UE had previously performed application registration for the
application requesting data transmission and for this URSP rule, the procedure
continues with step 4. Otherwise, the UE performs application registration
(see clause 6.14.2.2) with the AF which address was indicated in the URSP
rule.
4\. The UE sends a PDU Session establishment request (case a) or a PDU Session
Modification request (case b), including the Traffic Descriptor of the matched
URSP rule, and the application identity obtained during application
registration.
5\. The SMF verifies that the indicated application identity is valid and that
the S-NSSAI is allowed for this application identity according to operator
policy.
6\. Depending on the outcome of step 5, the PDU Session establishment or
modification is accepted or rejected with a cause value indicating that the
S-NSSAI is not allowed for this application identity; in the latter case, the
UE evaluates remaining URSP rules for routing the user data from this
application.
#### 6.14.2.2 Application registration
This call flow depicts an expanded view of step 3 in clause 6.14.2.1.
Editor\'s note: Whether this procedure uses CP or UP is FFS.
Figure 6.14.2.2-1: Application registration
1\. The UE sends an application registration request to the AF, including an
identifier recognized by the AF (which need not be the AppID used in the UE\'s
OS). User identity is not included.
2\. The AF authenticates and authorizes the request. This may involve one or
more additional messages between the UE and the AF.
3\. The AF sends a registration response to the UE, including an application
identifier that can be used at step 4 of clause 6.14.2.1.
### 6.14.3 Impacts on services, entities and interfaces
UE:
\- Support URSP rules subject to application registration and related
procedures.
PCF:
\- Support URSP rules subject to with application registration.
\- Nsmf_PDUSession_UpdateSMContext and Nsmf_PDUSession_CreateSMContext:
support application identity verification.
AF:
\- New service if CP is used for application registration.
## 6.15 Solution #15: UE URSP enforcement validation by the network
### 6.15.1 Description
This solution addresses the bellow requirements from Key Issue #2: 5GC
awareness of URSP enforcement.
\- Whether and how the 5GC can be made aware whether or when the UE enforces a
URSP rule to route an application traffic to a PDU Session based on the URSP
rule provisioned by 5GC.
\- Whether there are any actions the 5GS can take after 5GC is aware whether
the UE enforces a URSP rule for specific application traffic or not. If any,
what action 5GC should take?
The solution allows for UE enforcement to follow correctly the URSP rules for
traffic matching. It introduces Application identity parameter provisioned to
the PCF by the UE during PDU Session Establishment procedure. The PCF performs
URSP validity check in order to validate whether the UE correctly enforces the
traffic matching rules in the URSP for the Application requiring the service.
If the PCF finds out that the URSP rules are not correctly followed by the UE,
the PDU Session is rejected with a new cause to indicate that the URSP rules
in general or a specific URSP rules are not followed. Also, the PCF may
optionally trigger UE Policy Update procedure to refresh the URSP rules in the
UE with the latest version of the URSP rules.
### 6.15.2 Procedures
Figure 6.15.2-1: UE\'s URSP enforcement validation by the network
1\. An Application in the UE requires service. The UE initiates PDU Session
Establishment Request message in which the UE includes the UE_ID, the
PDU_Session_ID, the S-NSSAI and the DNN. The UE selects the S-NSSAI and the
DNN based on the URSP rules applicable for the Application requiring service.
The UE also includes the App_ID of the Application in the PDU Session
Establishment Request message.
NOTE: The UE obtains the App_ID when the Application is registered with the AF
(Service provider) and it is not in the scope of this study. The link between
the App_ID and the Application on the UE itself is only known to the Service
provider.
2\. SMF selection by the AMF.
3\. The AMF invokes either Nsmf_PDUSession_CreateSMContext_Request message to
the SMF if there is no association with it or
Nsmf_PDUSession_UpdateSMContext_Request message if the AMF is already
associated with a SMF. Along with the UE_ID, the S-NSSAI, the DNN and the User
location parameters, the AMF also forwards to the SMF the App_ID received by
the UE.
4\. Continue with PDU Session Establishment procedure according to steps 4 to
7a of clause 4.3.2.2.1 of TS 23.502 [3].
5\. The SMF initiates the SM Policy Association Establishment procedure and
the SMF sends the Npcf_SMPpolicy_Control_Create message to the PCF in which
the SMF includes the UE_ID, the S-NSSAI, the DNN, the User location and the
App_ID parameters.
6\. The PCF performs URSP validity check for the UE. The PCF retrieves the
stored latest version of the URSP rules for the UE and the PCF verifies
whether the UE is following correctly the S-NSSAI selection rules, the DNN
selector rules, the Time window criteria and the Location criteria.
7\. If the result from the URSP validity check by the PCF is that one or more
of the traffic matching rules in the latest version of the URSP are not
correctly followed by the UE, the PCF returns Failure parameter in the
Npcf_SMPpolicy_Control_Create response to the SMF. The PCF may also include
the cause for the failure, e.g. URSP rules not followed or a more specific
reject cause identifying the specific URSP rule that is not followed by the
UE.
8\. The SMF forwards the reject cause to the AMF in the
Nsmf_PDUSession_CreateSMContext_Response message.
9\. The AMF rejects the PDU Session Establishment Request from the UE and the
AMF includes a rejection cause URSP rules not followed or a more specific
reject cause pointing to which URSP rules are not followed (e.g. S-NSSAI
selection rules not followed or DNN selection rules not followed or Time
windows criteria not followed or Location criteria not followed).
10\. If at step 6 the URSP validity check by the PCF fails, the PCF may assume
the UE may not have the latest URSP rules so, the PCF may trigger UE Policy
update procedure according to clause 4.2.4.3 of TS 23.502 [3] to refresh the
UE with the latest URSP rules.
11\. UE Policy update according to clause 4.2.4.3 of TS 23.502 [3].
### 6.15.3 Impacts on services, entities and interfaces
UE, AMF, SMF:
\- New App_ID parameter and a new PDU Session Establishment reject cause.
PCF:
\- New App_ID parameter and URSP validity check functionality.
## 6.16 Solution #16: URSPs into PCO for EPC
### 6.16.1 Description
The solution address KI#3. In this solution, two different aspects are
covered:
\- Provide the use case examples and scenarios where the UE may need URSP when
in EPS.
\- How to provision the URSP to UE when served by the EPS.
#### 6.16.1.1 Use cases and scenarios
When a UE attaches initially in EPC or when the UE handovers from 5GC to EPC,
PCF may need to update the URSPs in the UE:
\- During Initial attach procedure in EPS due to for example:
\- New AF guidance on URSP request applicable to the UE was sent by an AF
while the UE is deregistered and prior to the EPC attach procedure, so the
corresponding URSP rules were not delivered yet to the UE.
\- Operator policies configured with time, location or any other condition are
met when the UE attaches to EPC, implying new or updated URSP rules apply
under those conditions.
\- Operator policies for determining URSPs were updated by the operator while
the UE is deregistered and prior to the EPC attach procedure, so the
corresponding URSP rules were not delivered yet to the UE.
\- At any time a URSP is changed while the UE is registered in EPC (coming
from EPC initial attachment or after handover from 5GC) due to for example:
\- New AF guidance on URSP request applicable to the UE is sent by an AF.
\- Due to time, location change or other network condition the PCF determines
that an operator policy configured for the operator for URSP determination
applies in the new network conditions, implying new or updated URSP rules
apply to the UE.
#### 6.16.1.2 Background: URSP provisioning to a UE in 5GS
In 5GC URSP updates are delivered from the PCF to the UEs following the
procedure defined in clause 6.1.2.2.2 of TS 23.503 [4] for the distribution of
the policies to UE. The distribution of UE policies is based on a protocol
defined between the UE and the PCF described in TS 24.501 [7] and called UPDP
protocol (UE Policy Delivery Protocol) and summarized in the figure below. The
UPDP messages are then encapsulated into N1 Policy Containers and transferred
transparently by the AMF from/to the UEs.
Figure 6.16.1.2-1: URSP provisioning to a UE in 5GS
The operation UE STATE INDICATION is used by the UE to provide to the PCF the
list of stored PSIs which identify the Policy Sections stored in the UE.
The Network-requested UE Policy management procedure is used by the PCF to
delivery an update of UE Policies to the UE. First the PCF sends the operation
MANAGE UE POLICY COMMAND including the update of UE policies to the UE. Then
the UE answer to the PCF with MANAGE UE POLICY COMPLETE or MANAGE UE POLICY
COMMAND REJECT.
#### 6.16.1.3 How to provision URSP to a UE in EPC
This solution proposes a mechanism that allows the network to update the URSPs
for a UE in EPC, by encapsulating UPDP messages into a new ePCO parameter
(from now on UE Policy Container ePCO) and transfer them to the UE via PDN
connection.
In this clause, the PCF refers to a deployment where the PCF serving the UE
and the PCF serving each of the PDU Sessions for this UE are the same PCF.
The solution assumes the same protocol (UPDP protocol) for URSP delivery
between the PCF and the UE than in 5GC, although the final decision on this is
up to stage 3.
The mechanism reuses the existing capability of the EPC network for sending
ePCO from the UE to the SMF+PGW-C (and vice versa) and in addition it proposes
a way to transport the UE Policy Container from the SMF+PGW-C to the PCF (and
vice versa) based on reusing existing PDU session procedures.
For the delivery of URSPs to UEs in EPC, this solution assumes the standard
solution for interworking architecture between EPC and 5GC as described in TS
23.501 [2].
When the PCF needs to send a UE Policy update towards the UE in EPC, it
invokes a SM Policy Association Modification including the corresponding UPDP
message into a new IE (UE Policy Container) in the N7 interface. When the
SMF+PGW-C receives this new IE the SMF+PGW-C encapsulates it into UE Policy
Container ePCO and transfers them to the UE by using existing procedure of PDN
GW initiated bearer modification without bearer QoS update as defined in
clause 5.4.3 of TS 23.401 [8].
When the UE in EPC needs to send a UPDP message towards the PCF in relation to
UE Policy handling the UE first encapsulates the UPDP message into a UE Policy
Container ePCO and then transfers it towards the SMF+PGW-C by reusing existing
mechanisms. When the SMF+PGW-C receives such UE Policy Container ePCO from the
UE, just forwards transparently the UE Policy Container towards the PCF by
reusing SMF initiated SM Policy Association procedure (establishment or
modification).
The solution also proposes that the UE has to be able to handle the reception
of such UPDP messages received over EPC NAS signalling in a similar way than
when received over 5GC NAS signalling in 5GC.
In addition, for those events happening in PCF which may trigger the sending
of a URSP update for a UE (as described in clause 6.16.1.1), the PCF will
check if the UE is currently in EPC, and if so will use one of these PDU
sessions to trigger the delivery of the URSP updates, by invoking PCF
initiated SM Policy Association modification procedure including the proper UE
Policy Container.
Clause 6.16.1.4 describes the solution for deployments where the PCF for the
UE (PCF-UE from now on) and the PCF for the PDU Session (PCF-SM from now on)
are different PCFs and there are multiple PCFs for the PDU session.
#### 6.16.1.4 Deployments where the PCF for the PDU session and the PCF for
the UE are different PCFs
The solution utilizes the establishment of a UE Policy Association between the
PCF-SM and the PCF-UE for the purpose of the delivery and handling of URSP
updates for a UE in EPC. Therefore, the PCF-SM is responsible to transfer UE
Policy Containers received from the UE over N7 towards PCF-UE and also to
receive those UE Policy Containers from the PCF-UE and to transfer them
towards the UE via SMF+PGW-C over N7 procedures.
The PCF-SM is a new consumer of the Npcf_UEPolicyControl service for the
purpose of providing URSP updates to the UE in EPC. The communication between
the PCF-SM and the SMF+PGW-C for the sending and reception of UE Policy
Containers from/to the UE is according to the existing proposal for
deployments where the PCF serving the UE and the PCF serving each of the PDU
Sessions of this UE are the same PCF as described in clause 6.16.1.3.
For the initial attach of a UE in EPC it is proposed the PCF-SM triggers the
establishment of a UE Policy Association towards PCF-UE upon a PDU session
establishment is requested by SMF+PGW-C including a UE Policy Container.
For the case where the UE moves from 5GS to EPC it is proposed the PCF-SM
triggers the establishment of a UE Policy Association towards the PCF-UE upon
the SMF+PGW-C notifies the PCF-SM about the UE is moved to EPC.
For the case where the UE moves from EPC to 5GS the proposal is that the PCF-
SM terminates any ongoing UE Policy Association established towards the PCF-UE
when it is notified from the SMF+PGW-C.
Once the UE Policy Association is established between the PCF-SM and the PCF-
UE, the PCF-UE may decide at any time to send an update of URSPs to the UE in
EPC, e.g. triggered by an AF guidance on URSP request. In addition, the PCF-UE
is also able to provide an URSP update at UE Policy Association from PCF-SM
when the UE initially attaches in EPC or when the UE moves from 5GS to EPC.
For the case where the UE moves from 5GS to EPC the following is proposed in
relation with the establishment of a UE Policy Association from the PCF-SM:
\- It is proposed to add an extension of the UE Policy Container which the UE
sends at 5GS initial registration, so the UE may include an indication about
whether the UE supports URSP delivery when in EPC. Then the PCF-UE stores that
indication in UDR for the UE during 5GS initial registration as part of UE
context policy control subscription information. When the UE moves to EPC, the
PCF-SM determines whether the UE supports URSP delivery in EPC by checking UE
context policy control subscription information in UDR and uses such
indication to decide whether to establish a UE Policy Association towards the
PCF-UE.
\- If there are multiple ongoing PDU sessions for the UE handled in the same
PCF-SM (e.g. in a deployment where the same PCF-SM handles all the PDU
sessions for an S-NSSAI), the PCF-SM controls that only one UE Policy
Association is established and maintained for the same UE. That is, the PCF-SM
will establish the UE Policy Association only for the first PDU session which
reports the change to EPC. In addition, the PCF-SM will terminate the UE
Policy Association at the time the last PDU session for this UE is terminated.
The PCF-UE is able to send a URSP update to a UE which has moved from 5GS to
EPC if there is at least one ongoing PDU session for the UE in the PCF-SM, no
matter if some PDU sessions have been terminated after the UE moves to EPC.
\- For the case where there are multiple PCF-SMs handling PDU sessions for the
UE it is proposed to extend the operation Npcf_UEPolicyControl_Create with an
indication (e.g. \"Handover5GtoEPC\") about whether the scenario triggering
the establishment of the UE Policy Association is due to a handover from 5GS
to EPC.
With such indication the PCF-UE is able to correlate all these UE Policy
Associations from different PCF-SMs and avoid the re-sending of URSP updates
for each of the UE Policy associations. At the time the PCF-UE determines an
update of URSP is needed for a UE, the PCF-UE will first select one of the UE
Policy Associations for this UE including the new indication and use it for
the URSP update delivery.
With this proposal the PCF-UE is able to send a URSP update to a UE which has
moved from 5GS to EPC if there is at least one ongoing PDU session for the UE
in at least one PCF-SM, no matter if some PDU sessions have been terminated in
some PCF-SMs after the UE moves to EPC.
\- Upon the reception of UE Policy Association establishment from PCF-SM
including an empty UE Policy Container (the PCF-SM doesn\'t receive the UE
Policy Container from the UE at 5GS to EPC) and the new indication (i.e.
\"Handover5GtoEPC\"), the PCF-UE gets the information about the PSIs stored in
the UE (and other info that the UE includes in the UE Policy Container in
Initial Registration in 5GS) from the former UE Policy Association for this UE
which was established when the UE was in 5GS.
For scenarios with N26, according to clause 4.11.1.2.1 of TS 23.502 [3], the
AMF deletes the UE Policy Association when the UE moves to EPC and it is not
clear whether this deletion happens after or before the SMF+PGW-UE notifies
the PCF-SM about the change to EPC. So, it is unknown whether the PCF-UE
deletes the ongoing UE Policy Association (from 5GS) before the new one from
PCF-SM (from EPC) is established.
In order to avoid that the information included in the former UE Policy
association from 5GS is deleted in PCF-UE before the new one from PCF-SM is
established, it is proposed to extend the operation for deletion of the UE
Policy Association (Npcf_UEPolicyControl_Delete) with a new indication (e.g.
\"Handover5GtoEPC\") about whether the scenario triggering the deletion of the
UE Policy Association is due to a handover from 5GS to EPC. When the AMF
initiates the deletion because a handover from 5GS to EPC, the AMF includes
such indication so the PCF-UE may delay the removal of the associated
information for the ongoing UE Policy Association during a while, to wait for
the establishment of the new UE Policy Associations from the PCF-SM.
In addition, when the PCF-UE delays the removal of the UE Policy Association,
the PCF-UE delays other additional actions related with the removal of the
association as the unbinding from the BSF or un-subscription to receive
notifications from UDR, therefore unnecessary signalling due to the unbinding
and immediate binding from BSF and un-subscription and immediate subscription
to UDR again is avoided.
\- When the PCF-SM needs to establish a UE Policy Association triggered by a
5GS to EPC handover, the PCF-SM first discovers the address of the PCF-UE by
querying the BSF. This together with the one in previous bullet (i.e.
\"Handover5GtoEPC\"), makes possible that the PCF-SM selects the same PCF-UE
handling the UE Policy Association in 5GS, therefore the PCF-UE that receives
the new UE Policy Association from the PCF-SM is able to get the list of PSIs
stored in the UE from the former UE Policy Association in 5GS.
In the case of different PCF-SMs are handling PDU sessions for the same UE,
the PCF-UE selected by all of them will be the same PCF-UE. For the case of
EPC initial attach the PCF-SM selects the PCF-UE based on the information
retrieved from NRF query.
### 6.16.2 Procedures
#### 6.16.2.1 Initial Attach procedure in EPC
For the initial attachment of a UE in EPC, the procedure follows the one
defined in clause 5.3.2.1 of TS 23.401 [8] with the following additions
summarized in the figure below for the support of URSP deliveries to the UE:
Figure 6.16.2-1: Initial Attach procedure in EPC
1\. The UE generates UE STATE INDICATION UPDP message (including the list of
PSIs stored in the UE) in the same way that it is done for the registration in
5GC. Then the UE includes this UE STATE INDICATION UPDP message into UE Policy
Container ePCO in PDN Connectivity Request encapsulated in Attach Request.
NOTE 1: For those cases where the UE attaches to EPC but doesn\'t request the
establishment of a default bearer the procedure just follows the steps defined
in clause 5.3.2.1 of TS 23.401 [8] and there is no PCF interaction. However,
for those cases, the UE will include UE STATE INDICATION within a UE Policy
Container ePCO during the first request for PDN connectivity. Then the PCF
will be able to update the URSPs to the UE only after the establishment of the
first PDU session establishment for the UE.
2-4. These steps follow the existing procedure as defined in TS 23.401 [8], so
the UE Policy Container ePCO is sent towards the SMF+PGW-C.
5\. The SMF+PGW-C forwards transparently the UE Policy Container ePCO to the
PCF as a new IE in the PDU Session Establishment (Npcf_SMPolicyControl_Create
Request).
NOTE 2: Upon the reception of this UE Policy Container ePCO, the SMF+PGW-C
shall establish the corresponding SM Policy Association even in case the
network configuration for the APN of the PDN connection does not require PCF
involvement.
6\. The PCF answers to the SMF with Npcf_SMPolicyControl_Create Response.
7\. The procedure for initial attach continues as defined in clause 5.3.2.1 of
TS 23.401 [8].
8\. the PCF gets the content of the UE STATE INDICATION included in new IE and
processes it in a similar way than it does when it is received in 5GC during
the UE Policy Association establishment, i.e. uses the list of UPSIs included
in the UE STATE INDICATION to determine if an update of UE policies is
required for this UE. If no update is determined the procedure finishes here.
If an update is needed, then the PCF generates the corresponding UPDP message
MANAGE UE POLICY COMMAND in a similar way than it is done in 5GC and then
includes the message into a UPDP Container ePCO.
NOTE 3: The interactions toward UDR in relation with the retrieving and
storage of UPSIs into UDR are not shown in the diagram.
\- The flow follows the steps 2-14 defined in clause 6.16.2.2 for URSP update
initiated by PCF.
#### 6.16.2.2 URSP update initiated by PCF
For the procedure for URSP update initiated by the PCF when the UE is in EPC,
the procedure follows the steps described in the figure below:
Figure 6.16.2.2-1: PCF initiated URSP update procedure
1\. An event as described in clause 6.16.1.1 happens in PCF. The PCF triggers
the re-evaluation of applicable URSPs for the UE and determines an update of
URSP is needed for the UE. The PCF selects one of the PDN connection/PDU
sessions associated to EPC for the delivery of the URSP update. Then the PCF
generates the corresponding UPDP message MANAGE UE POLICY COMMAND in a similar
way than it is done in 5GC and then includes the message into a new IE for
sending it to the SMF over N7.
2\. The UPDP message is then provided to the SMF+PGW-C by invoking
Npcf_SMPolicyControl_UpdateNotify request.
3\. The PCF starts timer T3501 to monitor the reception of an answer for UPDP
MANAGE UE POLICY COMMAND.
4\. The SMF+PGW-C, upon reception of the new IE with UPDP message, answers the
PCF with Npcf_SMPolicyControl_UpdateNotify response and initiates a bearer
modification procedure without bearer QoS update (as defined in clause 5.4.3
of TS 23.401 [8]) to provide the UE Policy Container ePCO towards the UE.
5-7. These steps follow the existing procedure for bearer modification
procedure without bearer QoS
8\. When the UE gets the UE Policy Container ePCO including a MANAGE UE POLICY
COMMAND UPDP message, the UE processes that message in a similar way than when
it is received in 5GC, i.e. stores the URSP updates, optionally re-evaluates
the mapping of applications into PDN connections according to the mapping of
URSP values into EPC, and generates UPDP message MANAGE UE POLICY COMMAND
COMPLETE with the result to the PCF.
9\. The UE then generates a UE Policy Container UPDP including the MANAGE UE
POLICY COMMAND COMPLETE, and include it in the EPS Bearer Context Response
sent to the MME.
10-11. These steps follow the existing procedure defined for Update Bearer
Response
12\. Upon reception of UE Policy Container ePCO in Update Bearer Response, the
SMF+PGW-C then invokes Npcf_SMPolicyControl_Update Request including the
content of the UE Policy Container ePCO.
13\. The PCF processes the MANAGE UE POLICY COMMAND COMPLETE in a similar way
than in 5GC as defined in TS 29.525 [9] and stops timer T3501.
14\. The PCF sends Npcf_SMPolicyControl_Update Response.
#### 6.16.2.3 Procedures for deployments where the PCF for the PDU session and
the PCF for the UE are different PCFs
##### 6.16.2.3.1 Initial Attach Procedure in EPC
This clause extends the procedure in clause 6.16.2.1 when the PCF for a PDU
session is different than the PCF for a UE.
Figure 6.16.2.3.1-1
1-7. They are the same than the ones described for deployments with a
collocated PCF in clause 6.16.2.1, with the difference that in step 5 the
SMF+PGW-C selects a PCF for a PDU session (PCF-SM)
2\. The PCF-SM checks that the SMF+PGW-C provided a UE Policy Container in
step 1 and then request the establishment of a UE Policy Association towards
PCF-UE providing the UE Policy Container received from the SMF+PGW-C.
3\. The PCF-UE follows standard procedure to handle the UE Policy
establishment as defined in clause 4.16.11 of TS 23.502 [3] for the roaming
case. It determines whether an update of URSP is needed and in such a case
generates a UE Policy Container including the URSP update (UPDP message MANAGE
UE POLICY COMMAND).
4\. The PCF-UE answers the UE Policy Association establishment request.
5\. If a UE Policy Container is provided to the PCF-SM in step 4, the flow
continues with steps 2-14 from procedure defined in clause 6.16.2.2 for
deployments with a collocated PCF and the PCF-SM forwards the UE Policy
Container to the UE via SMF+PGW-C.
##### 6.16.2.3.2 URSP update initiated by PCF
This clause extends the procedure in 6.16.2.2 for URSP updates initiated by
the PCF when the PCF for a PDU session is different than the PCF for a UE.
Figure 6.16.2.3.2-1
0: An event as described in clause 6.16.1.1 happens in the PCF-UE. The PCF-UE
triggers the re-evaluation of applicable URSPs for the UE and determines an
update of URSP is needed for the UE.
1\. If several ongoing UE Policy Associations with new indication \"5GS to EPC
handover\" exists in the PCF-UE this selects one of them for the delivery of
the URSP update.
2\. The PCF-UE generates the corresponding UE Policy Container (UPDP message
MANAGE UE POLICY COMMAND) in a similar way than it is done in 5GC (according
to clause 4.16.12.2 of TS 23.502 [3]) and then invokes
Npcf_UEPolicyControl_UpdateNotify including the UE Policy Container.
3\. PCF-SM answers Npcf_UEPolicyControl_UpdateNotify.
4\. It follows the steps 2-14 from clause 6.16.2.2 for a deployment with a
collocated PCF.
5\. The PCF-SM sends Npcf_UEPolicyControl_Update to provide the received UE
Policy Container (including MANAGE UE POLICY COMMAND COMPLETE UPDP message
from the UE) to the PCF-UE.
6\. The PCF-UE processes the MANAGE UE POLICY COMMAND COMPLETE in a similar
way than in 5GC as defined in TS 29.525 [9] and answers
Npcf_UEPolicyControl_Update.
##### 6.16.2.3.3 Handover from 5GS to EPC
This clause shows the impact in the procedure for 5GS to EPC handover when the
PCF for a PDU session is different than the PCF for a UE.
Figure 6.16.2.3.3-1
1\. It follows standard procedure for 5GS to EPC handover as described in
clause 4.11.1.2.1 of TS 23.502 [3] (similar for handover with idle mobility).
2\. For the scenarios with N26 the AMF invokes the deletion of UE Policy
Association including a new indication \"5GS handover to EPC\".
3-4. Based on the new indication (\"5GS handover to EPC\") the PCF-UE, after
the PCF-UE answers the AMF, the PCF-UE decides to maintain the UE Policy
association for a configurable period (e.g. 20s), until the new UE Policy
Association from the PCF-SM is received. In addition, during this period, no
other actions associated to the removal of the UE Policy Association (e.g.
unbinding from BSF or un-subscription from UDR notifications for this UE) are
executed.
NOTE 1: If step 2 happens after step 8 the PCF-UE may remove directly the
former UE Policy Association.
5\. SMF+PGW-C notifies PCF-SM about the handover to EPC invoking
Npcf_SMPolicyControl_Update Request.
This step happens for every ongoing PDU session handled by the PCF-SM.
6\. PCF-SM answers SMF+PGW-C as in standard procedure.
7\. The PCF-SM determines whether the UE supports URSP delivery in EPC by
checking UE context policy control subscription information in UDR and based
on that decides to establish a UE Policy Association towards the PCF-UE.
NOTE 2: For those deployments where the solution is restricted to a specific
combination of S-NSSAI/DNN the PCF-SM also checks if the PDU session being
notified by SMF+PGW-C is established towards the specific S-NSSAI/DNN. In
other case the PCF-SM controls that only one UE Policy Association
Establishment is established and maintained for the same UE. In case the same
PCF-SM maintains several PDU sessions for the same UE the PCF-SM will
establish the UE Policy Association only for the first PDU session
establishment which reports the change of RAT-Type.
8\. The PCF-SM discovers the address of the PCF-UE handling the UE by querying
BSF.
9\. The PCF-SM establishes a UE Policy Association towards the PCF-UE
including an empty UE Policy Container, i.e. no information about PSI list in
the UE is provided to the PCF-UE and an indication about the trigger for the
UE Policy association establishment (\"5GS to EPC handover\").
NOTE 3: If the removal of associated information for the former UE Policy
Association was delayed, the PCF-UE can now delete it. Since additional UE
Policy Associations are still ongoing for this UE (the one from PCF-SM) the
PCF-UE doesn\'t execute other additional actions associated to the removal of
the UE Policy Association (e.g. unbinding from BSF or un-subscription from UDR
notifications for this UE).
10\. Based on the indication received in step 9, the PCF-UE recovers the
information about the PSI list in the UE and the subscribed PCRTs in 5GS from
former UE Policy Association for the UE.
NOTE 4: If the removal of associated information for the former UE Policy
Association was delayed, the PCF-UE can now delete it. Since additional UE
Policy Associations are still ongoing for this UE (the one from PCF-SM) the
PCF-UE does not execute other additional actions associated to the removal of
the UE Policy Association (e.g. unbinding from BSF or un-subscription from UDR
notifications for this UE).
11\. The PCF-UE follows standard procedure to handle the UE Policy
establishment as defined in clause 4.16.11 of TS 23.502 [3] for the roaming
case. It determines whether an update of URSP is needed and in such a case
generates a UE Policy Container including the URSP update (UPDP message MANAGE
UE POLICY COMMAND).
12\. The PCF-UE sends Npcf_UEPolicyControl create answer including a UE Policy
Container with the URSP updates if needed and the list of PCRTs, obtained from
the former UE Policy Association for the UE in 5GS.
NOTE 5: Note that only the list of supported PCRTs over N7 will be supported
for the UE Policy Association (e.g. Connectivity State changes event trigger
is not supported over N7).
13\. Follows steps 2-14 of the procedure described in clause 6.16.2.2.1 for
URSPs update initiated by PCF.
### 6.16.3 Impacts
Impact on interface:
N7:
\- Introduce additional IE for the transfer of UE Policy Container between
SMF+PGW-C and PCF.
NAS, S11, S5/S8(?):
\- Introduce new parameter UE Policy Container in ePCO.
Impact on PCF:
\- Handling of UE Policy Container within SM Policy Association procedures.
\- For those cases where PCF initiates the sending of URSP update for a UE in
EPC, the triggering of SM Policy Association modification including the new IE
with MANAGE UE POLICY COMMAND UPDP message.
\- PCF-SM establishes UE Policy Association towards PCF-UE upon EPC initial
attach and 5GS to EPC handover.
\- PCF-UE handles new indication in UE Policy association deletion so it may
delay the removal of UE Policy Association in PCF-UE during a short configured
period, waiting for the new one established from PCF-SM.
\- PCF-UE handles new indication in UE Policy Association establishment from
PCF-SM at handover to EPC, so it may get the list of PSIs stored in the UE
from former UE Policy Association from 5GS.
Impact on SMF+PGW-C:
\- Upon reception of UE Policy Container ePCO in Create Session Request, the
SMF+PGW-C forwards the UE Policy Container to the PCF at SM Policy Association
establishment. Use the reception of UPDP Container as an additional reason to
establish the SM Policy Association, even in case the network configuration
for the APN of the PDN connection does not require PCF involvement.
\- Upon reception of UE Policy Container from PCF during SM Policy Association
initiated by PCF, SMF+PGW-C performs a Bearer Modification Procedure without
bearer QoS update including the UE Policy Container ePCO.
\- Upon reception of Update Bearer Response from MME including UE Policy
Container ePCO, the SMF+PGW-C forwards the received UE Policy Container to
PCF.
Impact on UE:
\- During initial attach in EPC, the UE includes UE STATE INDICATION UPDP
message into UE Policy Container ePCO in PDN Connectivity Request encapsulated
in Attach Request.
\- The UE receives MANAGE UE POLICY COMMAND in UE Policy Container ePCO during
EPS Bearer Context Request and process it as in 5GC. The UE generates MANAGE
UE POLICY COMPLETE UPDP message and send it to the MME encapsulated into a UE
Policy Container ePCO in EPS Bearer Context Response.
\- The UE includes additional parameter in UE Policy Container at 5GS initial
registration about whether it supports URSP provisioning via EPC.
Impact on AMF:
\- For deployments with N26 the AMF includes a new indication when the UE
Policy Association is deleted due to a 5GS to EPC handover.
\- Impact on UDR:
\- The information in UE context policy control subscription information is
extended with a new attribute which indicates whether the UE supports URSP
delivery in EPC.
## 6.17 Solution #17: Indication of applicability of URSP to UE in EPS
### 6.17.1 Description
Support of URSPs in EPS was introduced in 3GPP Rel-16. A Rel-16 UE can use
URSPs while in EPS (S1 mode) by translating the various parameters in the
Traffic Descriptors and Route Selection Descriptors to corresponding EPS
parameters as defined in clause 4.4.2 of TS 24.526 [10]. URSPs are still
provisioned via 5GC. Whereas for the Traffic Descriptors (TD) a 1-to-1 mapping
can be derived, certain 5GS parameters of a Route Selection Descriptor (RSD)
do not have an exact equivalent in EPS e.g. SSC mode selection, Network Slice
selection, DNN selection, Time Window, Location criteria etc. For this
purpose, a static mapping of 5GS parameters to EPS was specified in the Table
4.4.2.2 of TS 24.526 [10], with certain parameters marked as not applicable in
EPS. A UE in EPS currently ignores an RSD if it contains any such parameter
that are marked as not applicable in Table 4.4.2.2 of TS 24.526 [10].
Although this static mapping enables the use of certain URSPs in EPS, i.e. the
ones that do not contain any of the non-applicable parameters, this static
mapping of what is applicable in EPS is very limiting. Essentially, a network
operator, to ensure that the UEs in EPS behave as desired, has to design and
provision EPS-specific RSDs that avoid any non-applicable parameter. This
results to unnecessary signalling, storage and processing overheads at both UE
and network sides, and network management overheads.
Additionally, with this static mapping none of those parameters can be used by
a UE while in EPS. However, for certain features like edge computing, \"Time
Window\" and \"Location Criteria\" are spatial and temporal criteria which
could be used to determine the validity of URSP rules.
In this solution, it is proposed to introduce a new optional parameter \"EPS
applicability\" in the Route Selection Descriptor component of a URSP rule.
The new parameter, if present in the RSD, will provide an indication to the
UE, whether the RSD parameter is applicable in EPS.
In order to ensure backwards compatibility and avoid any unnecessary
signalling, at registration the UE shall indicate whether it supports this new
feature. If the UE includes the \"EPS RSD support indication\" during
registration, the PCF may then include the additional parameter \"EPS
applicability\" in the RSD component to indicate how the UE should use each
RSD parameter in EPS. This design ensures that the optional applicability
indication can be used only if needed, and supported by both the UE and the
network.
### 6.17.2 Procedures
#### 6.17.2.1 URSP provisioning with EPS applicability indication
Figure 6.16.2.1-1 explains the procedure for URSP provisioning with EPS
applicability indication.
Figure 6.17.2.1-1: URSP provisioning with EPS applicability indication
1\. At registration the UE indicates support of the feature by including the
\"EPS RSD support indication\".
2\. If the UE has indicated support for \"EPS RSD support indication\" then
the PCF generates the URSP rules including the applicability of certain
parameters to EPS. For each Route Selection Descriptor component, the PCF
shall include the new optional parameter \"EPS applicability\".
3\. UE indicates the success or failure of update.
The Route Selection Descriptor component is extended as shown in Table
6.17.2.1-1 below to support the \"EPS applicability\" indication.
Editor\'s note: It is FFS whether the EPS applicability indication is included
to all components or only to the ones for which the handling over the static
mapping of \"4.4.2 Use of URSP in EPS\" of TS 24.526 [10] as per Rel-16 is to
be overridden.
Table 6.17.2.1-1: Route Selection Descriptor component
+---------------------+-------------------------+--------------------+ | Parameter name | Description | Mandatory/Optional | +=====================+=========================+====================+ | RSD component type | This indicates the | M | | | route selection | | | | descriptor component | | | | type e.g. SSC mode or | | | | DNN type etc. as | | | | specified in | | | | Table 5.2.1 of TS | | | | 24.526 [10]. This | | | | parameter is | | | | transmitted first. | | +---------------------+-------------------------+--------------------+ | RSD component value | This indicates the | M | | | value corresponding to | | | | the route selection | | | | descriptor component | | | | type. | | +---------------------+-------------------------+--------------------+ | EPS applicability | Indicates how to handle | O | | | this RSD when in EPS. | | | | This parameter may be | | | | included only if UE has | | | | indicated support. One | | | | of the following values | | | | can be included: | | | | | | | | 1) Not applicable | | | | (backward compatible | | | | handling) | | | | | | | | 2) To be ignored in | | | | EPS | | | | | | | | 3) Applies to EPS | | | | | | | | 4) reserved | | +---------------------+-------------------------+--------------------+
#### 6.17.2.2 Evaluation of URSP rules with EPS applicability indication
When the UE is in S1 mode, during URSP evaluation the UE shall:
\- ignore the complete RSD if any RSD component has EPS applicability
parameter set to \"Not applicable\".
\- only ignore the specific RSD component (i.e. not the whole RSD) when the
EPS applicability parameter is set to \"To be ignored in EPS\".
\- consider the RSD component in EPS also if the EPS applicability parameter
in the RSD component is set to \"Applicable to EPS\".
### 6.17.3 Impacts on services, entities and interfaces
The solution has the following impacts:
PCF:
\- PCF shall support the additional parameter (EPS applicability indication)
in RSD component of URSP rule as explained in clause 6.16.2.1.
\- PCF shall include the \"EPS applicability indication\" in RSD component
only if UE has provided \"EPS RSD support indication\" during registration.
UE:
\- UE shall include \"EPS RSD support indication\" during registration.
\- UE shall support evaluation of the URSP rules as described in clause
6.16.2.2.
## 6.18 Solution #18: Provisioning consistent URSP to UE across 5GS and EPS
for Collocated PCF Deployment
### 6.18.1 Description
This solution addresses KI#3 and assumes a collocated PCF deployment where the
PCF serving the UE and PCF serving each of the PDU Sessions of the UE are the
same. The solution aims to solve the issue when ANDSF is not deployed in EPS.
With regard to the scenarios and gaps (first two bullets in the KI#3), if a UE
has used the Route Selection component (e.g. DNN) in a URSP rule in EPS and
the Route Selection component (e.g. DNN) has been changed when the UE stays in
EPS, the updated URSP rule needs to be provisioned to UE in EPS, otherwise the
UE in EPS may use outdated DNN to establish PDN connection in EPS. In 5GS the
UE may be provisioned with URSP rules for both 5GS and EPS by the PCF of the
HPLMN. Only the rules provisioned by the PCF are used by the UE, if both URSP
rules provisioned by the PCF and pre-configured URSP rules are present. The
URSP rules are provisioned in UE using NAS messages. The AMF transparently
transfers the UE Policy container (UE policy information) received from the
PCF to the UE (using DL NAS TRANSPORT message). The UE Policy container
includes the list of Policy Sections as described in TS 23.503 [4]. Similar
mechanism can be used to provision URSP rules in EPS.
Since the URSP usage is not supported by a Rel-15 UE supporting interworking
between EPS and 5GS, it\'s not necessary to provision/update the URSP to such
UE, which will cause additional signalling overload. Thus, the EPS needs to be
aware whether a 4G interworking UE supports the URSP usage or not.
To realize provisioning of consistent URSP rules in UE, this solution follows
the below two principles:
1) The same set of URSP is provisioned to UE regardless of UE attaching to EPS
or registering to 5GS.
2) The UE in EPS uses the components in RSD of a URSP rule according to Rel-16
specification defined in clause 5.17.1.2 of TS 23.501 [2].
The EPS and 5GS interworking architecture defined in TS 23.501 [2] is reused,
the solution addresses the collocated PCF deployment scenario where the SM-PCF
and UE-PCF are collocated, N7 interface is reused to provision URSP from PCF
to PGW-C and no new interface is introduced. The solution proposes a mechanism
for the network to provision and update the URSP for a UE in EPS by
encapsulating UE Policy Container in ePCO via one of the PDN connections. The
UE Policy Container is transparently forwarded via SMF+PGW-C. The
communication between SMF+PGW-C and PCF reuses the SM Policy Association
procedures.
### 6.18.2 Procedures
#### 6.18.2.1 UE triggered UE Policy provisioning procedure in EPS
1\. The UE sends the UE Policy Container including URSP Support indication in
EPS which is indicating whether a UE supports URSP usage or not in EPS
(defined in TS 23.501 [2] clause 5.17.1.2) and the PSIs (Policy Set
Identifier) in ePCO (extended PCO) to SMF+PGW-C during Initial Attach
procedure (in the Attach Request) as described in clause 5.3.2.1 of TS 23.401
[8] and the UE requested PDN connectivity procedure (PDN Connectivity Request)
as described in clause 5.10.2 of TS 23.401 [8].
2\. The SMF+PGW-C transparently forwards the UE Policy Container in ePCO to
the PCF as a new IE in the PDU Session Establishment
(Npcf_SMPolicyControl_Create Request).
NOTE: If the PCF involvement for a PDN connection is not required, the
SMF+PGW-C should still establish SM Policy Association with PCF and forward
the UE Policy Container to PCF based on local configuration.
3\. The PCF gets policy subscription related information and the updated list
of PSIs from the UDR. The PCF creates the UE policy container including UE
policy information as defined in clause 6.6 of TS 23.503 [4]. Then it sends
the latest UE policy information in the UE Policy Container to SMF+PGW-C.
4\. The SMF+PGW-C sends the UE Policy Container in ePCO to UE in Activate
Default EPS Bearer Context message which may be encapsulated in Attach Accept
message.
5\. The UE sends a response to SMF+PGW-C by acknowledging the reception of the
UE Policy reusing existing messages (e.g. Attach Complete, Modify Bearer
Request) as defined in clause 5.3.2 of TS 23.401 [8].
6\. The SMF+PGW-C forwards the acknowledgement of UE reception of the UE
Policy to PCF using Npcf_SMPolicyControl_Update request.
#### 6.18.2.2 PCF triggered UE Policy provisioning procedure in EPS
1\. When the PCF is notified by UDR that the URSP is updated, it triggers the
UE Policy update procedure towards the SMF+PGW-C using
Npcf_SMPolicyControl_UpdateNotify request. The PCF selects one of the PDN
connections for the UE in EPS for the delivery of the updated URSP rules.
2\. The SMF+PGW-C transparently forwards the updated URSP rules to UE in UE
Policy Container via ePCO, which can be achieved by reusing existing messages
(e.g. Update Bearer Request, Downlink NAS Transport) as defined in clause
5.4.3 of TS 23.401 [8].
3\. When the UE receives the updated URSP rules, it updates the URSP rules and
sends a response to SMF+PGW-C by acknowledging the reception of the UE Policy
reusing existing messages (e.g. Uplink NAS Transport, Update Bearer Response,)
as defined in clause 5.4.3 of TS 23.401 [8].
4\. The SMF+PGW-C forwards the acknowledgement of UE reception of the UE
Policy to PCF using Npcf_SMPolicyControl_Update request.
### 6.18.3 Impacts on services, entities and interfaces
UE:
\- Send the UE Policy Container including UE capability to support URSP
Support indication in EPS and PSIs to PGW-C via ePCO.
\- Receive the URSP rules in the UE Policy Container from PGW-C via ePCO.
\- Sends an acknowledgement of UE Policy reception.
SMF+PGW-C:
\- Transparently forward the UE Policy Container in ePCO to PCF.
\- Transparently forward the UE Policy Container in ePCO to UE.
PCF:
\- Receive the UE Policy Container from SMF+PGW-C.
\- Initiates transfer of URSP rules in UE Policy Container to UE via
SMF+PGW-C.
## 6.19 Solution #19: Provision of URSP to UE when the UE attaches in the EPS
### 6.19.1 Introduction
This solution addresses key issue#3 \'Provision consistent URSP to UE across
5GS and EPS\'.
When the UE is attaching to the EPS system, the PGW-C+SMF node requests the
PCF to provide the URSP information. The PCF provides the URSP information
after interacting with the UDR.
### 6.19.2 Procedures
Figure 6.19.2-1: Transfer of URSP procedure when the UE is registering to the
EPS system
The detailed steps of the procedure are defined below:
1\. The UE initiates attach procedure to a PLMN by sending an attach request
message to the MME. The UE includes the UE policy list, UE policy classmark
and UE OS ID Information Element (IE) either in a PDN connectivity request
message or in the attach request message. The UE policy list, the UE policy
classmark and the UE OS ID Information Element (IE) may be set in the PCO
parameter in the attach request message.
NOTE 1: UE policy list, the UE policy classmark and the UE OS ID are defined
in TS 24.501 [7].
2\. Upon reception of the attach request message, the MME sends a create
session request message containing PCO, UE status and the UE policy list, the
UE policy classmark and the UE OS ID Information Element (IE) to the S-GW. The
UE status may be added to the create session request message by the MME. The
UE status may include following information:
\- CN type: It indicates a CN type, core network type, that the UE is being or
has attached. E.g. EPC or 5GC.
\- Access Type: It indicates an access that the UE is accessing. E.g. 3GPP
access or Non-3GPP access.
\- RAT type: It indicates a Radio Access Technology that the UE is accessing.
E.g. EUTRAN, EUTRAN-NB-IoT, LTE-M, or NR.
\- Serving Network (PLMN ID, or PLMN ID and NID).
In this solution, the MME may determine the UE status based on local
information regarding the UE in the MME or received information regarding the
UE from other network node(s).
3\. Upon reception of the create session request message the S-GWsends the
create session request message containing the PCO, the UE status and the UE
policy list, the UE policy classmark and the UE OS ID Information Element (IE)
to the PGW-C+SMF.
4\. Upon reception of the create session request message the PGW-C+SMF sends
Npcf_get_UEpolicy Request message containing Policy type, S1 mode supported,
N1 mode supported, the UE policy list, the UE policy classmark, the UE OS ID
IE and the UE status. The Policy type indicates a type of UE policy that the
PGW-C+SMF wants to fetch for the UE. If the UE policy list, the UE policy
classmark and the UE OS ID Information Element (IE) are encapsulated in the
PCO, the PGW-C+SMF extracts the UE policy list, the UE policy classmark and
the UE OS ID Information Element (IE) from the PCO.
If policy list is not contained in the create session request message, the
PGW-C+SMF includes Policy type information element. In this solution, the
PGW-C+SMF may determine the Policy type information element based on the UE
policy list. In this solution, the PGW-C+SMF may determine the Policy type
information element based on a local configuration in the PGW-C+SMF or stored
information regarding policy list of the UE.
The PGW-C+SMF may obtain the \"S1 mode supported\" and the \"N1 mode
supported\" based on information regarding the UE stored in the PGW-C+SMF or
received information regarding the UE from other network node(s).
NOTE 2: The PGW-C+SMF can discover and select the UE PCF according to clause
6.3.7.1 of TS 23.501 [2]. The UE PCF can be colocated with SMF PCF or can be a
separate PCF than the SMF PCF.
5\. Upon reception of the message from the PGW-C+SMF, the PCF sends
Nudr_get_UEpolicy Request message containing the Policy type, the S1 mode
supported, the N1 mode supported, the UE policy list, the UE policy classmark,
the UE OS ID and the UE status to the UDR.
6\. Upon reception of the message from the PCF, the UDR transfers the UE
policy to the PCF in the Nudr_get_UEpolicy Response message.
7\. Upon reception of the UE policy in the response message from the UDR, the
PCF sends Npcf_get_UE policy response message to the PGW-C+SMF.
8\. Upon reception of the UE policy in the response message from the PCF, the
PGW-C+SMF sends a Create session response message containing the UE policy to
the S-GW. The UE policy may be stored in the PCO. The UE policy may be stored
in the PCO of the Create session response message.
9\. Upon reception of the Create session response message, the S-GW sends a
Create session response message containing PCO and the UE policy to the MME.
Upon reception of the Create session response message the MME takes either
step 10a or step 10b.
10a. The MME sends an attach accept message containing the PCO and Activate
Default EPS Bearer Context Request message which contains the UE policy. If
the UE policy is encapsulated in the PCO, the UE extracts the UE policy from
the PCO.
10b. The MME sends an attach accept message containing the PCO and the UE
policy and an Activate Default EPS Bearer Context Request message.
11\. The UE upon reception of the UE policy applies the UE policy when the UE
is registered in the EPS or when the UE registers to the 5GS as defined in TS
24.526 [10].
## 6.20 Solution #20: URSP delivery for the UE in EPS
### 6.20.1 Description
According to clause 5.2.1 of TS 23.503 [4], the SM-PCF does not support N15
reference point while the UE-PCF does not support N7 reference point. In this
solution, for URSP delivery from UE-PCF in 5GC to the UE in EPS, the UE Policy
Association establishment between SM-PCF and UE-PCF is proposed. The URSP can
be transparently delivered to the UE via SM-PCF, SMF+PGW-C, SGW, and MME. The
architecture is shown in Figure 6.20.1-1.
Figure 6.20.1-1: Non-roaming architecture for URSP delivery to the UE in EPS
As depicted in Figure 6.20.1-1, an interface (Nx) needs to be specified
between SM-PCF and UE-PCF for establish an UE Policy Association. N15
interface can be reused as Nx.
When the UE sends Attach Request in EPS (e.g. Initial Attach procedure, 5GS to
EPS Mobility procedure without N26), the UE sends UE Policy Container
including list of PSIs and URSP delivery over EPS Indication in PCO to UE-PCF.
The detail procedure is introduced in clause 6.20.2.1.
When the UE policy has been updated in PCF while UE is in EPS, the UE-PCF
sends UE Policy Container to SMF+PGW-C. The SMF+PGW-C sends PCO including UE
Policy Container to the UE. The detail procedure is introduced in clause
6.20.2.2.
When the UE sends Registration Request in 5GS, UE Policy Container including
list of PSIs and URSP delivery over EPS Indication to UE-PCF. The detail
procedure is introduced in clause 6.20.2.3.
In 5GS to EPS Handover/Idle mode mobility using N26, the UE Policy Association
established in 5GS can be maintained in EPS. The detail procedures are
introduced in clauses 6.20.2.4, 6.20.2.5, 6.20.2.6.
### 6.20.2 Procedures
#### 6.20.2.1 UE Policy delivery procedure initiated by the UE in EPS
Figure 6.20.2-1: UE Policy delivery procedure initiated by the UE in EPS
1\. UE sends UE Policy Container including the list of PSIs and URSP delivery
over EPS Indication SMF+PGW-C. The PCO can be included in Attach Request and
Create Session Request as described in Figure 5.3.2.1-1 of TS 23.401 [8].
2\. The SMF+PGW-C invokes Npcf_SMPolicyControl_Update Request to the SM-PCF to
forwards the UE Policy Container to the SM-PCF. The SMF+PGW-C provides SUPI,
UE Policy Container and UE-PCF ID to the SM-PCF. The SM-PCF can notice that
the UE-PCF Association Establishment with UE-PCF is allowed in this network by
the presence of UE Policy Container in PCO and UE-PCF ID.
NOTE: The SMF+PGW-C discovers and selects the UE-PCF as described in clause
6.3.7.1 of TS 23.501 [2].
3\. The SM-PCF establishes the UE-PCF Association with the UE-PCF which is
identified UE-PCF ID received from the SMF+PGW-C, and forwards the UE Policy
Container to the UE-PCF.
4\. The UE-PCF sends to SM-PCF the UE-PCF Association Establishment Response
with result of UE-PCF Association establishment result.
5\. The UE-PCF gets policy subscription related information and the latest
list of PSIs from the UDR using Nudr_DM_Query service operation. The UE-PCF
creates the UE policy container including UE policy information as defined in
clause 6.6 of TS 23.503 [4] (step 6 of Figure 4.16.11-1 of TS 23.502 [3] can
be reused).
6\. When the UE-PCF decides to provide the UE policy to the UE, the UE-PCF
sends to SM-PCF the UE Policy Container.
7\. The SM-PCF forwards the UE Policy Container to the SMF+PGW-C by
Npcf_SMPolicyControl_Update Response.
8\. The Initial Attach procedure is continued as described in Figure 5.3.2.1-1
of TS 23.401 [8]. The SMF+PGW-C sends the PCO which is including the UE Policy
Container to the UE. The PCO can be included in Attach Accept. The UE sends
the acknowledgement on successful reception of the UE Policy to the SMF+PGW-C,
this acknowledgement can be included in the Attach Complete and Modify Bearer
Request.
9\. The SMF+PGW-C forwards the UE\'s acknowledgement by invoking
Npcf_SMPolicyControl_Update Request to the SM-PCF.
10\. The SM-PCF forwards the UE\'s acknowledgement to the UE-PCF.
#### 6.20.2.2 UE Policy delivery procedure initiated by the PCF
Figure 6.20.2-2: UE Policy delivery procedure initiated by the PCF
1\. The UE-PCF is notified from the UDR that the URSP is updated.
2\. The UE-PCF sends to SM-PCF the UE Policy Container which includes the
updated URSP.
3\. The SM-PCF forwards the UE Policy Container to the SMF+PGW-C by
Npcf_SMPolicyControl_UpdateNotify Request.
4\. The SMF+PGW-C sends the PCO which is including the UE Policy Container to
the UE. The step 2 to 5 described in Figure 5.4.3-1 of TS 23.401 [8] is used.
The PCO can be included in Update Bearer Request, Downlink NAS Transport, and
Direct Transfer. The UE sends the acknowledgement on successful reception of
the UE Policy to the SMF+PGW-C, this acknowledgement can be included in Direct
Transfer, Uplink NAS Transport, and Update Bearer Response.
5\. The SMF+PGW-C forwards the UE\'s acknowledgement by invoking
Npcf_SMPolicyControl_Update Request to the SM-PCF.
6\. The SM-PCF forwards the UE\'s acknowledgement to the UE-PCF.
#### 6.20.2.3 URSP delivery over EPS Indication in 5GS
During Registration procedure in 5GS, the UE sends UE Policy Container
including the list of PSIs and URSP delivery over EPS Indication to AMF in
Registration request as described in clause 4.2.2 of TS 23.502 [3].
AMF transparently forwards UE Policy Container to UE-PCF during UE Policy
Association Establishment as described in clause 4.16.11. UE-PCF stores URSP
delivery over EPS Indication. The UE-PCF determines whether the UE Policy
Association established in 5GS can be maintained in EPS based on this
indication as described in clauses 6.20.2.4 and 6.20.2.5.
#### 6.20.2.4 5GS to EPS Handover using N26 interface
Figure 6.20.2-3: (Figure 4.11.1.2.1-1 of TS 23.502 [3]) 5GS to EPS handover
for single-registration mode with N26 interface
Step 18 includes the deregistration of the old AMF for 3GPP access from the
HSS+UDM as specified in clause 4.11.1.5.3 in TS 23.502 [3]. The registered AMF
for 3GPP access initiates UE Policy Association Termination procedure as
defined in clause 4.16.13.1 in TS 23.502 [3]. The UE-PCF determines whether to
terminate the UE Policy Association based on URSP delivery over EPS Indication
received from UE (as described in clause 6.20.2.1 and 6.20.2.3). The UE-PCF
rejects the Npcf_UEPolicyControl_Delete request from the AMF and informs to
the AMF that the UE Policy Association can be maintained in EPS. In this case,
the AMF initiates the procedure to move the UE Policy Association established
between the AMF and UE-PCF to between SM-PCF and UE-PCF as described in clause
6.20.2.6.
#### 6.20.2.5 5GS to EPS Idle mode mobility using N26 interface
Figure 6.20.2-4: (Figure 4.11.1.3.2-1 in TS 23.502 [3]) 5GS to EPS Idle mode
mobility using N26 interface
In step 15, The UE-PCF determines whether to terminate the UE Policy
Association based on URSP delivery over EPS Indication received from UE (as
described in clause 6.20.2.1 and 6.20.2.3). The UE-PCF rejects the
Npcf_UEPolicyControl_Delete request from the AMF and informs to the AMF that
the UE Policy Association can be maintained in EPS. In this case, the AMF
initiates the procedure to move the UE Policy Association established between
the AMF and UE-PCF to between SM-PCF and UE-PCF as described in clause
6.20.2.6.
#### 6.20.2.6 Relocate an established UE Policy Association to SM-PCF
Figure 6.20.2-5: Relocation of an established UE Policy Association to SM-PCF
1\. As described in clauses 6.20.2.4 and 6.20.2.5, the AMF requests to UE-PCF
to terminate the UE Policy Association, when the UE moves from 5GS to EPS.
2\. The UE-PCF determines whether to terminate the UE Policy Association based
on URSP delivery over EPS Indication received from UE (as described in clauses
6.20.2.1 and 6.20.2.3). The UE-PCF rejects the Npcf_UEPolicyControl_Delete
request from the AMF and informs to the AMF that the UE Policy Association can
be maintained in EPS.
3\. When the AMF is informed that the UE Policy Association can be reused in
EPS, the AMF determines which Policy Control Request Triggers can be supported
in SMF (e.g. Location change, PLMN change) among the PCRTs of the UE Policy
Association.
4\. The AMF sends UE-PCF ID, UE Policy Association ID, Policy Control Request
Triggers for UE Policy Association (determined in step 3), and Information on
the UE policy related Policy Control Request Trigger condition that can be met
in Nsmf_PDUSession_UpdateSMContext Request to SMF+PGW-C.
5\. The SMF+PGW-C transfers UE Policy Association information received from
the AMF in step 4 to SM-PCF by Npcf_SMPolicyControl_Update Request.
6\. The SM-PCF notices the UE Policy Association established in 5GS is moved
from the AMF to the SM-PCF when SM-PCF receives UE-PCF ID and UE Policy
Association ID from SMF+PGW-C. The SM-PCF sends UE Policy Association ID and
Information on the UE policy related Policy Control Request Trigger condition
that can be met in Npcf_UEPolicyControl_Update Request to UE-PCF. The UE-PCF
updates the stored information provided by the AMF with the information
provided by the SM-PCF.
7\. The UE-PCF updates the policy decision based on the information provided
by SM-PCF. Step 4 in clause 4.16.2.1.2 of TS 23.502 [3] can be reused. The UE-
PCF updates Policy Control Request Trigger parameters for UE Policy
Association to be supported in SMF+PGW-C (e.g. remove PCRTs that cannot be
supported in SMF+PGW-C).
8\. The UE-PCF sends UE Policy Container, Policy Control Request Triggers of
UE Policy Association in Npcf_UEPolicyControl_Update Response to SM-PCF. SM-
PCF stores the updated Policy Control Request Triggers of UE Policy
Association. The UE Policy Container is delivered to the UE (as described in
clause 6.20.2) after TAU procedure.
9\. The SMF+PGW-C updates the PCRTs of UE Policy Association received from the
AMF (in step 4) with the PCRTs of UE Policy Association received from the SM-
PCF (in step 8). After this step, when a PCRT of UE Policy Association
condition is met, the SMF+PGW-C sends Information on the UE policy related
Policy Control Request Trigger condition that can be met to the SM-PCF and the
SM-PCF reports it to the UE-PCF.
10\. The SMF+PGW-C sends Nsmf_PDUSession_UpdateSMContext Response to AMF. The
AMF notices the UE Policy Association is successfully moved to SM-PCF.
### 6.20.3 Impacts on services, entities and interfaces
SMF+PGW-C:
\- Shall be able to include the UE Policy Container received from the PCF into
the PCO, and forward to the UE via SGW and MME transparently.
\- Shall be able to forward the UE Policy Container from the UE to the UE-PCF.
\- Shall be able to provide the UE-PCF ID to SM-PCF.
\- Shall be able to forward the acknowledgement of UE reception of the UE
Policy to the PCF.
\- Shall be able to provide Information on the UE policy related Policy
Control Request Trigger condition that can be met to SM-PCF when the condition
is met.
SM-PCF:
\- Shall be able to handle UE Policy Association with UE-PCF.
\- Shall be able to provide to SMF+PGW-C, the UE Policy Container which
includes the UE Policy for the UE in EPS.
\- Shall be able to relocate the UE Policy Association established in 5GS from
AMF to SM-PCF.
UE-PCF:
\- Shall be able to handle UE Policy Association with SM-PCF.
\- Shall be able to handle UE Policy Association for the UE in EPS based on
the URSP delivery over EPS Indication provided by the UE.
AMF:
\- Shall be able to relocate the UE Policy Association established in 5GS from
AMF to SM-PCF.
MME:
\- No impact.
UE:
\- Shall be able to store the URSP received over EPS entities.
\- Shall be able to send the acknowledgement of UE reception of the UE Policy
to the PCF over EPS entities.
\- Shall be able to send the list of PSIs stored in the UE to the PCF by
encapsulating in UE Policy Container, and by including the UE Policy Container
into PCO over EPS entities.
## 6.21 Solution #21: Traffic Category with existing mechanism
### 6.21.1 Description
It is proposed to reuse the current Traffic Descriptor (TD) type to represent
Traffic Category.
**Option 1:**
Introduce new special DNN in the TD to represent Traffic Category. DNN is
composed of Network Identifier and optionally Operator Identifier. Network
Identifier has a maximum length of 63 octets. It is enough to have
standardized traffic categories. If it is an operator specific traffic
category, Operator Identifier is involved.
The applications that shares the same traffic category should be mapped to the
same DNN in the TD.
It is proposed to have DNNs considering the requirement from GSMA as described
in clause 5.4.
Some more DNN containing multiple bullets of GSMA requirement as described in
clause 5.4 can also be introduced.
NOTE 1: The DNN in corresponding Route Selection (RSD) could be different if
the real DNN of the application is not the same as the one in TD as described
in clause 6.6.2.1, TS 23.503 [4].
NOTE 2: It is assumed that the operator will allocate proper DNN to an
application with considering its traffic category. How to allocate DNN to an
application is based on current mechanism. It is assumed the operator will
have agreement with the Application Service Providers to generate the URSP.
NOTE 3: To cover the case that an application may share different traffic
categories, DNN could be combination of different categories.
**Option 2:**
Introduce new standardized Application descriptor. A new OS Id value which
means \"Traffic Category\" Type should be defined. the maximum length of OS
App Id is 256 octets. It is enough to have standardized traffic categories and
operator specific Traffic Categories.
It is proposed to have following application descriptors considering the
requirement from GSMA as described in clause 5.4.
NOTE 4: More than one application descriptors can be provided in TD as
described in clause 6.6.2.1, TS 23.503 [4]. Thus no need to introduce new
application descriptors as combination of different categories.
NOTE 5: It is assumed the operator will have agreement with the Application
Service Providers to generate the URSP.
### 6.21.2 Procedures
No new procedure will be introduced. The PCF will transfer the URSP to the UE
via UE Configuration Update procedure as defined in clause 4.2.4.3 of TS
23.502 [3].
### 6.21.3 Impacts on services, entities and interfaces
UE/PCF:
\- Need to support the new standardized value of DNN/Application Descriptor in
the Traffic descriptor.
## 6.22 Solution #22: UE provisioned/configured with a mapping of application
traffic to traffic categories
### 6.22.1 Description
A general description of the solution is as follows:
\- A UE is provisioned/configured with a mapping of Application Traffic to a
Traffic Category (or one or more traffic categories). The UE may be configured
with such mapping from an Application Function or from the PCF or based on
pre-configuration. If provisioned by the PCF this mapping information is sent
outside of a URSP rule, i.e. a new rule within UE policy information (ATC
rule):
\- When the UE receives such mapping, when the UE detects new Application
Traffic the UE associates the application to the corresponding traffic
category:
\- The existing traffic descriptors defined in URSP rules can be used to map
Application Traffic to one or more Traffic Categories. For example:
\- An application with Application Descriptor (com.android.app1) is mapped to
Traffic Category: \"Gaming\".
\- An application sending traffic to a specific destination IP 3 tuple mapped
to Traffic Category: \"Streaming\".
\- Domain Descriptors (e.g. FQDN requested) mapped to one or more traffic
categories:
\- In such case the UE associates the destination IP addresses received in a
DNS response to a traffic category.
\- Non-IP descriptors mapped to one or more traffic categories.
\- An application requesting DNN \"IMS\" is mapped to Traffic Category
\"Voice\".
\- An Application requesting connection capability for MMS is mapped to
Traffic Category \"Media\".
\- The URSP rule is enhanced with a Traffic Category Traffic Descriptor:
\- When the UE receives URSP rules with Traffic Categories traffic descriptor
then the UE uses the configuration received from the AF/PCF to associate
detected application traffic to a traffic category and consider the URSP rule
matched when the Traffic Category of the URSP rule matches the traffic
category of the application.
The solution can support both MNO specific and standardised traffic
categories. The encoding of the Traffic Category can be defined in stage 3\.
For example, standardised traffic category can be encoded as a bit map as
follows:
\- Bitmap: 00000001 **\-- >** Gaming (Standardised).
\- Bitmap: 00000002 **\-- >** Voice (Standardised).
\- Bitmap: 00000003 **\-- >** Reserved for operators (MNO specific).
The solution has the advantage that the rules to associate an application (or
application traffic) are provided by the MNO and does not rely on the
application in the UE or the OS layer in the UE to indicate a traffic category
for an application traffic.
The procedures are shown in the next clause.
### 6.22.2 Procedures
#### 6.22.2.1 Association of application traffic to a Traffic Category
The UE associates application traffic to a traffic category based on
\"Application to Traffic Category\" (ATC) rules received from the AF or the
PCF. The rules provide information on how Application Traffic is mapped to a
traffic category.
The PCF can provide ATC rules to the UE using the UE configuration update for
transparent policy deliver. The ATC rules are sent outside of URSP rule as a
new type of rule within UE policies provisioned by the PCF. The UE can include
ATC rules within a specific Policy Section identified by a Policy Section
Identifier. The PCF may determine the ATC rules the UE requires based on the
operating system supported by the UE. The procedure is shown in the figure
below.
Figure 6.22.2.1-1: PCF provisioning Application to Traffic Categories Rules
0\. UE registers to the PLMN as per TS 23.502 [3]. The UE may include OSId of
its operating system and a list of Policy Sections (identified by a PSI)
installed at the UE. During registration the AMF selects a PCF for AM and SM
policies.
1\. The PCF determines that ATC rules are needed to be provided to the UE. The
PCF determines based on:
\- A Policy Section identified by a PSI is not installed at the UE or the
Policy Section Identifier provided by the UE that includes ATC rules requires
updating.
\- A trigger from the UDM/UDR.
2\. The PCF sends ATC rules to the AMF via an Namf_Communication_N1N2Message
transfer service operation based on the UE Configuration Update for
transparent policy delivery.
3\. The AMF transparently sends the ATC rules to the UE. If the UE is in IDLE
the AMF triggers a network triggered service request.
4\. The ATC rules are sent to the UE via a NAS Downlink transport message
5\. The UE installs the rules and provides the result to the AMF via a NAS
Uplink transport message.
6\. The AMF forwards the ack to the PCF.
7\. The UE associates applications to a traffic category based on the ATC
rules.
An Application Function may also provide ATC rules to the UE as shown in the
figure below.
Figure 6.22.2.1-2: AF provisioning ATC rules to a UE
1\. The UE registers with the PLMN network as per TS 23.502 [3].
2\. The PCF subscribes from the UDR to be notified of change/update of ATC
rules.
3\. The AF decides to update ATC rules for a UE.
4\. The AF sends an Nnef_ServiceParameterCreate request including parameters
for ATC rules determination.
5\. The NEF authorizes the request and stores the ATC rules in the UDR. The
NEF stores the AF request information in the UDR as the \"Application Data\"
(Data Subset setting to \"Service specific information\") together with the
assigned Transaction Reference ID.
6\. The UDR determines that the PCF needs to be notified.
7\. The UDR notifies the PCF in a Nudr_DM_Notify service operation.
8\. The PCF sends update ATC rules using the UE Configuration Update procedure
for transparent policy delivery (as per steps 2-6 of Figure 2.3).
9\. The UE associates application to an application category based on the ATC
rules.
Alternatively (instead of steps 2-7), the UPF may also be configured to
perform traffic classification and report back to the PCF (via the SMF) the
traffic category mapping. In this case, during the SM Policy Association
Establishment procedure, the PCF may provide Usage Reporting Rules that
include one or more traffic classification triggers to the UPF. The attributes
in the \"Usage Report\" as defined in Table 5.8.2.11.7-1 of TS 23.501 [2] are
extended to support traffic classification and the \"traffic category\" is
reported by the UPF in a new attribute in the report.
#### 6.22.2.2 Enhancing URSP rule with a Traffic Category Traffic Descriptor
The URSP rule is enhanced to include a Traffic Category Traffic Descriptor.
How the Traffic Category Traffic Descriptor is encoded is up to stage 3
design.
When the UE is provisioned with a URSP rule containing a Traffic Category
traffic descriptor then for every detected application traffic the UE
considers this URSP rule applicable when the Traffic Category of the
application detected matches the Traffic Category of the Traffic Descriptor in
the URSP rule.
If the UE has received URSP rules with Traffic Category traffic descriptors
but the UE did not receive ATC rules or cannot identify the traffic category
of the application traffic detected (i.e. the ATC rules do not provide any
association for the application traffic detected) the UE considers the rule
not applicable and moves to the next URSP rule in the order of precedence.
An example implementation is shown in the figure below.
Figure 6.22.2.2-1: Example implementation for Traffic Classification and
matching a URSP rule based on Traffic Category
1\. An application in a UE requests a network connection from the operating
system in the UE.
2\. The mobile operating system requests a network connection including the
AppID of the application.
3\. The UE determines that URSP rules include Traffic Categories Traffic
Descriptor and determines a Traffic Category.
4\. The UE finds the traffic category based on the ATC rules.
5-6. The UE finds a matching URSP rules based on the Traffic Category ID.
7-8. A PDU session is established based on the RSD of the matched URSP rule.
9\. The Mobile OS notifies the application that a connection is established.
### 6.22.3 Impacts on services, entities and interfaces
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
\- URSP rule is enhanced with a new Traffic Descriptor for supporting Traffic
Category.
\- New Policy Section is defined to include ATC rules.
PCF:
\- Determine and provision updated UE Policy (ATC rules) based on detected
traffic category.
SMF:
\- Install URR (Usage Reporting Rules) that include traffic classification
trigger on the UPF.
\- Indicate the traffic category information based on Usage Reports to PCF.
UPF:
\- Determine the Traffic category based on URR and provide Usage Reports
including the traffic category mapping to the SMF.
## 6.23 Solution #23: Support standardized and operator-specific traffic
categories in URSP
### 6.23.1 Description
As per the LS received from GSMA, the traffic generated by a UE could be
grouped into various traffic categories, enabling each traffic category to be
handled differently, e.g. mapped to a different slice. Some example traffic
categories are as below:
Enterprise: Traffic from one or more applications related to an Enterprise
service.
Gaming: Traffic from one or more applications related to Gaming service, e.g.
with low latency requirement.
Video Streaming: Traffic from one or more applications related to Video
Streaming, e.g. HD video streaming, 4K video streaming.
A new component \"traffic category\" is introduced in the traffic descriptor
part of the URSP rule. The \"traffic category\" shall support standardized
values specified by 3GPP and values that are reserved for operator specific
traffic categories. For example, the Traffic category can be encoded as below
(this is a stage 3 decision):
Bits
8 7 6 5 4 3 2 1
0 0 0 0 0 0 0 1 Enterprise
0 0 0 0 0 0 1 0 Gaming
0 0 0 0 0 0 1 1 Video Streaming
0 0 0 0 0 1 0 0
to
0 1 1 1 1 1 1 1 Spare for standardized traffic categories
1 0 0 0 0 0 0 0
to
1 1 1 1 1 1 1 1 Reserved for Operator specific traffic categories
Editor\'s note: It is FFS whether a new TD component \"traffic category\" is
introduced or to re-use/extend an existing TD component e.g. Connection
capabilities to support the new standardized and operator defined traffic
categories.
An application can indicate a traffic category in its request which the UE
then matches with the traffic category component in the Traffic Descriptor of
the URSP rule. Only one traffic category can be included in a single request.
However, a single application may indicate different traffic category in
different requests, for example, an application may indicate one traffic
category in the traffic descriptor for IM or chat session while it may
indicate a different traffic category in the traffic descriptor for live video
or streaming etc. A given traffic category can be simultaneously used by
multiple applications.
An application may request any traffic category from the traffic category
values standardized by 3GPP or from the operator specific traffic category
values.
Editor\'s note: It is FFS whether and how the UE or the Network verifies that
an application is requesting for the correct traffic category.
### 6.23.2 Procedures
When an application starts, or at a later time, it may request for a specific
traffic category. The traffic categories are defined by the 3GPP and are
independent of the Operating System used in the UE. The traffic category
requested by an application may be either a traffic category standardized by
the 3GPP or a value that is specified by the MNO. The application requests a
traffic category in a way similar to existing traffic descriptors, which is
then pushed to the URSP layer transparently through the OS layer. Traffic
categories shall be transparent to the OS layer to allow MNOs to define
operator-specific traffic categories and still enable the application to
request for such traffic categories.
NOTE 1: The implementation details of how the application indicates the
requested traffic category are outside the scope of 3GPP.
A UE of a previous release that does not support \"Traffic Category\" shall
ignore the URSP rules with \"Traffic Category\" according to clause 4.2.3 of
TS 24.526 [10] \"Unknown or unexpected URSP rules\".
NOTE 2: Based on UE implementation, if the UE does not support \"Traffic
category\" TD request for \"Traffic category\" by an application can be
disabled.
### 6.23.3 Impacts on services, entities and interfaces
The solution has the following impacts:
PCF:
\- PCF shall support the new parameter \"traffic category\" in traffic
descriptor part of the URSP rule.
UE:
\- UE shall support receiving \"traffic category\" from the application and
match it with the \"traffic category\" component in the Traffic Descriptor
provided as part of the URSP rule.
## 6.24 Solution #24: Introduction of Traffic Category into URSP rules
### 6.24.1 Description
In order to have no impact or further work to application layer, a new mapping
rules can be introduced to UE of traffic category.
The application on UE still use the original parameters in Traffic Descriptor
to describe the features of application traffic, for example, the FQDN, DNN or
IP-5-tuple. But the Traffic Category in TD, can be the set the combination of
multiple traffic characteristic identification filter to identify the traffic
from different application. And before the UE maps the application traffic to
specific PDU session that RSDs corresponds to, the UE can map the application
traffic to a specific traffic category in TD.
For example, according to the FQDNs, the UE can identify this traffic to a
specific traffic category for video or music. Another example, according to
the destination IP address and DNN of application traffic, the UE can identify
the traffic category as enterprise because the IP address located in the IP
range that the enterprise served and the DNN is a local DN.
According to this design, one of the examples of introducing traffic category
are listed below:
Table 6.24.1-1: Example of URSP rules contains traffic category
+----------------------------------+----------------------------------+ | Traffic Descriptor | Route Selection Descriptor | +==================================+==================================+ | Rule Precedence =1 | Route Selection Descriptor | | | Precedence=1 | | Traffic Descriptor: Application | | | descriptor=App1 | Network Slice Selection: | | | S-NSSAI-a | | | | | | SSC Mode Selection: SSC Mode 3 | | | | | | DNN Selection: internet | | | | | | Access Type preference: 3GPP | | | access | +----------------------------------+----------------------------------+ | Rule Precedence =2 | Route Selection Descriptor | | | Precedence =2 | | Traffic Descriptor: Traffic | | | Category = Video = {Application | Network Slice Selection: | | Descriptor = App2} or {IP | S-NSSAI-a | | Descriptor = 10.1.1.1} | | | | Access Type preference: Non-3GPP | | | access | +----------------------------------+----------------------------------+ | Rule Precedence =3 | Route Selection Descriptor | | | Precedence=1 | | Traffic Descriptor: Traffic | | | Category = Game = {Domain | Network Slice Selection: | | Descriptor = ABC.com} + {DNN = | S-NSSAI-b | | DNN1} + {Connection Capabilities | | | = \"ims\"} | SSC Mode Selection: SSC Mode 2 | +----------------------------------+----------------------------------+ | Rule Precedence =4 | Route Selection Descriptor | | | Precedence =2 | | DNN = local.DN.1 | | | | Access Type preference: Non-3GPP | | | access | +----------------------------------+----------------------------------+
NOTE 1: It is up to operator\'s configuration that how to design the
combination of traffic characteristic identification filter in a certain
Traffic Category. The original Traffic Descriptor can be co-existed with newly
introduced Traffic category in TD.
NOTE 2: As the example above, the operators can set the different precedence
of TD, including the Traffic Category. For example, if the traffic from an
application can both satisfy the original TD and Traffic Category, which has
the higher precedence will be performed first.
NOTE 3: The Traffic Category can be the combination of multiple traffic
characteristic identification filter. It is also possible that the application
traffic can meet one of the Traffic characteristics in the Traffic Category.
NOTE 4: For a certain application traffic, it is possible to be classified as
different traffic category. The final result of traffic category depends on
the design of TD, for example, the precedence of TD, and the UE
implementation.
And after mapping to specific traffic category, how to apply the application
traffic to RSDs are reuse the mechanism in current URSP rules.
Also, one application traffic can be mapped to multiple Traffic category. For
example, one application traffic which has the feature of Application
descriptor, can be mapped to Traffic Category = Enterprise or Traffic Category
= Game at the same time.
### 6.24.2 Procedure
After UE receives the URSP rules from PCF, the UE should do the following
steps:
1\. Mapping the application traffic to Traffic Descriptor, as the existing
URSP rules mechanism.
2\. According to the Traffic Descriptor that the application mapping to, the
UE has the two selection according to the URSP rules delivered by PCF:
\- (Existing mechanism in URSP rules) The application traffic is matched to a
certain Traffic Descriptor;
\- The application traffic is matched to a certain Traffic Descriptor, and
there exists the Traffic Category in this Traffic Descriptor. But for the
Traffic Category, it can be the combination of multiple traffic characteristic
identification filter. It is up to operator\'s configuration that how to
design the combination of traffic characteristic identification filter in a
certain Traffic Category.
3\. After determination of the Traffic Descriptor, the UE applies the
application traffic to specific PDU sessions according to the RSDs. This is
the same procedure as defined in URSP rules.
### 6.24.3 Impacts on services, entities and interfaces
Editor\'s note: This clause lists impacts to services and interfaces.
PCF:
\- Introduce Traffic Category into URSP rules. The Traffic Category in TD, can
be the set the combination of multiple traffic characteristic identification
filter to identify the traffic from different application into the same
traffic category. It is also ok that the application traffic can meet one of
the Traffic characteristics in the Traffic Category.
UE:
\- Mapping the application traffic which belongs to the specific Traffic
Category in Traffic Descriptor according to the traffic characteristic
identification filter in Traffic Category.
## 6.25 Solution #25: Support standardized and operator-specific traffic
categories in URSP
### 6.25.1 Description
In the current specification, application descriptors (short for \'APP ID\')
is defined as one TD in URSP rules. Application descriptors is used to
identify the Application(s) that is(are) running on the UE\'s OS as specified
in clause 6.6.2 of TS 23.503 [4] \"UE Route Selection Policy information\".
To resolve the KI#4, application descriptors as one TD in URSP rules is to
leverage for supporting standardized and operator-specific traffic categories
in URSP. The special value of application descriptors can be defined or used
for standardized and operator-specific traffic categories, and other value of
application descriptor can be used for non-special application(s).
For example:
\- Assuming that there are standardized and operator-specific traffic
categories like \"video\", \"games\", \"streaming\" and \"enterprise\";
\- So the following application descriptors value can be defined or used for
standardized and operator-specific traffic categories:
Table 6.25.1-1
Special value of application descriptors (short for \'APP ID\') standardized
and operator-specific traffic categories
* * *
APP ID= aaaa video APP ID= bbbb games APP ID= cccc streaming APP ID= dddd
enterprise ...... ......
So the solution to reuse the application descriptors as one TD in URSP rules
to define special value for standardized and operator-specific traffic
categories in URSP has meet the Key issue#4.
### 6.25.2 Procedures
The solution reuses existing procedures.
### 6.25.3 Impacts on Existing Nodes and Functionality
None.
## 6.26 Solution #26: Traffic categories based on 5G QoS characteristics
### 6.26.1 Description
The 5G QoS characteristics describe the edge-to-edge packet treatment received
by a QoS flow between the UE and UPF as described in clause 5.7.3 of TS 23.501
[2] in terms of various performance characteristics. These performance
characteristics include Resource type (GBR, non-GBR), Priority level, Packet
delay budget, Packet error rate, Averaging window, Maximum data burst volume,
etc. Standardized 5QI values are specified for services that are frequently
used and the one-to-one mapping between standardized 5QI values and the 5G QoS
performance characteristics is specified in table 5.7.4-1 of TS 23.501 [2].
A new component \"traffic category\" is introduced in the traffic descriptor
part of the URSP rules to support standardized values specified by 3GPP and
values that are reserved for operator specific traffic categories. The
encoding of these traffic categories can be specified in stage 3 in TS 24.526
[10].
#### 6.26.1.1 Traffic categories based on service type
Traffic categories can be defined based on type of service handled by an
application. As an example, enterprise class applications could include
traffic categories for email, browsing, chat, conferencing, voice, etc.
Similarly gaming applications could include real-time gaming, interactive
gaming and other games which could include XR type of traffic as well.
Similarly, video streaming class of applications could also include live or
buffered streaming, HD streaming, 4K streaming traffic, etc. For each of these
service types, the traffic categories can then be mapped to specific 5G QoS
performance characteristics as specified in table 5.7.4-1 of TS 23.501 [2]. In
addition to different well-known services, traffic categories can also be
operator specific or even have specific QoS attributes or parameters that may
not map to a well-known service.
The traffic category values depend on the intended granularity of the
categorization. They can be either defined based on different high level
application classes or service types such as Enterprise, Gaming, Streaming,
Operator specific, etc. or they can be defined with finer granularities, e.g.
voice, conferencing, real-time gaming, interactive gaming, live streaming,
buffered streaming, etc. These finer granular values may belong to one or more
high level application classes or service types and can better assist in
mapping specific application traffic or flows to appropriate slices.
The values of 5G QoS performance characteristics are reproduced below from
table 5.7.4-1 of TS 23.501 [2] for easy reference.
Table 6.26.1.1-1: Traffic categories based on Service type of different
applications
+-------+-------+-------+-------+-------+-------+-------+-------+ | Tr | 5QI | Res | De | P | P | De | De | | affic | | ource | fault | acket | acket | fault | fault | | Cat | Value | Type | Pri | Delay | Error | Ma | | | egory | | | ority | B | | ximum | Aver | | | | | Level | udget | Rate | Data | aging | | | | | | | | Burst | W | | | | | | | | V | indow | | | | | | | | olume | | +=======+=======+=======+=======+=======+=======+=======+=======+ | Enter | | | | | | | | | prise | | | | | | | | | Class | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Voice | 1 | GBR | 20 | 1 | 1 | N/A | 2000 | | tr | | | | 00 ms | 0^-2^ | | ms | | affic | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | E | 6 | No | 60 | 3 | 1 | N/A | N/A | | mail, | | n-GBR | | 00 ms | 0^-6^ | | | | bro | | | | | | | | | wser, | | | | | | | | | chat | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Co | 2 | GBR | 40 | 1 | 1 | N/A | 2000 | | nfere | | | | 50 ms | 0^-3^ | | ms | | ncing | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | G | | | | | | | | | aming | | | | | | | | | Class | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Real | 3 | GBR | 30 | 50 ms | 1 | N/A | 2000 | | time | | | | | 0^-3^ | | ms | | G | | | | | | | | | aming | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | I | 7 | GBR | 70 | 1 | 1 | N/A | N/A | | ntera | | | | 00 ms | 0^-3^ | | | | ctive | | | | | | | | | G | | | | | | | | | aming | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Augm | 80 | GBR | 68 | 10 ms | 1 | N/A | N/A | | ented | | | | | 0^-6^ | | | | Re | | | | | | | | | ality | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Video | | | | | | | | | Stre | | | | | | | | | aming | | | | | | | | | Class | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Live | 71 | GBR | 56 | 150 | 1 | N/A | 2000 | | stre | | | | ms | 0^-6^ | | ms | | aming | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Buf | 8 | No | 80 | 3 | 1 | N/A | N/A | | fered | | n-GBR | | 00 ms | 0^-6^ | | | | Stre | | | | | | | | | aming | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | HD | 90 | Dela | 25 | 20 ms | 1 | 63000 | 2000 | | Stre | | y-cri | | | 0^-4^ | bytes | ms | | aming | | tical | | | | | | | | | GBR | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+
NOTE: The above traffic categories are just illustrative examples, other
traffic categories may be added as needed.
#### 6.26.1.2 Traffic categories based on Traffic characteristics
Traffic categories can also be defined directly based on traffic
characteristics and the specific QoS attributes could have a relative priority
level. As an example, for a certain class of traffic, there could be relative
priority among the QoS attributes latency and bandwidth (e.g. low latency and
high bandwidth with latency as higher priority). Priority can be given to
single or multiple QoS attributes (e.g. prioritize latency and packet error
rate over bandwidth for voice traffic, prioritize latency and bandwidth over
packet error rate for gaming or video streaming traffic, etc.).
The traffic categories could be defined as follows based on different traffic
characteristics.
Table 6.26.1.2-1: Traffic categories based on Traffic characteristics of
different applications
Traffic Category Service Type Usage examples
* * *
Latency Loss Bandwidth  
Low Normal Low Real-time online interaction Games Normal Normal Normal Default
bearer Best Effort. Default service class; pretty much a mix of everything.
High Low High Video Streaming Youtube, Netflix, Hulu High Normal High AR/VR  
High Normal Normal Background Bulk data upload High High Normal Background
(alt) \"Background\", user-initiated, high delay tolerant, high loss tolerant,
elastic flow, variable size. e.g. user-initiated iCloud synching or Time
Capsule backup; or traffics of background applications, for which there is
some progress feedback. Any Any Any Off Peak Data/Cost Push traffic
NOTE: The above traffic categories are just illustrative examples, other
traffic categories may be added as needed.
### 6.26.2 Procedures
Different applications know the kind of traffic they can generate, and they
can classify the traffic based on the above defined traffic categories. An
application may request for a specific traffic category from the execution
environment (OS). Such a request triggers the UE to determine whether this new
application traffic can be associated to an established PDU session, or the UE
needs to establish a new PDU session based on URSP rules including the
matching traffic category in the traffic descriptor. The requested traffic
category by the application may be either a standardized value specified by
3GPP or an operator specific value. Traffic categories are transparent to the
execution environment (OS) to allow operators to define operator specific
traffic categories.
NOTE: The implementation details of how the application indicates the
requested traffic category to the execution environment (OS) are outside the
scope of 3GPP.
### 6.26.3 Impacts on services, entities and interfaces
UE:
\- Able to process application requested traffic category and match it with
the traffic category component of the traffic descriptor provided as part of
the URSP rule.
PCF:
\- Introduce traffic category into URSP rules and design the mapping rules of
traffic categories.
## 6.27 Solution #27: URSP provisioning and updating in roaming
### 6.27.1 Description
This is a solution related to the Key Issue #1 URSP in VPLMN, that aims to
address the following aspects:
\- How to provide URSP Rules in roaming to the UE. How the HPLMN and VPLMN are
involved in such procedure.
\- Whether and how to support URSP enhancements to support routing of the
application traffic with different URSP rules in different PLMNs.
In addition, backward compatibility with the existing framework of policy
control based on HPLMN will be maintained as stated in the KI description.
This solution proposes that when the UE is roaming, the HPLMN may provide URSP
Rules to the UE as in the existing baseline, in addition the VPLMN can provide
URSP Rules. For the handling at the UE, a similar behaviour as for ANDSP Rules
is proposed: When the UE is roaming, and the UE has valid URSP rules from both
HPLMN and VPLMN the UE gives priority to the valid URSP rules from the VPLMN.
The VPLMN provides URSP Rules to UE that contain RSD components that comply
with the S-NSSAI subscription information defined in Table 6.2-1 in TS 23.503,
then extended with the indication of LBO allowed as follows:
Table 6.27.1-1: UE context policy control subscription information
Information name Description Category
* * *
Subscriber categories List of category identifiers associated with the
subscriber Optional Tracing Requirements Tracing requirements as defined in TS
32.421 [13] Optional PEI The Permanent Equipment Identifier of the UE.
Optional OSId Identifies the operating system supported by UE. Optional
Indication of UE support for ANDSP Indicates the UE support for ANDSP.
Optional S-NSSAI subscription information Contains the list of subscribed
S-NSSAIs, its associated subscribed DNNs. For each DNN, it includes the
Allowed PDU Session types, the Allowed SSC modes, the ATSSS information and
the LBO roaming information (NOTE). Optional NOTE: ATSSS information is
defined in Table 5.2.3.3.1-1 of TS 23.502 [3] and Indicates whether MA PDU
Session establishment is allowed. LBO roaming is defined in Table 5.2.3.3.1-1
of TS 23.502 [3] and Indicates whether LBO roaming is allowed per DNN or per
(S-NSSAI and DNN)
The S-NSSAI subscription information is stored at the UDR at the HPLMN,
provided to the H-PCF. The H-PCF sends the S-NSSAI subscription information to
the VPLMN based on local policies that states whether VPLMN can provide URSP
Rules to the UE and whether the LBO roaming is allowed. The H-PCF only
provides S-NSSAI subscription information for this DNNs or (S-NSSAI and DNN)
combinations that has LBO roaming allowed set. The V-PCF maps the DNN,S-NSSAI
value in the VPLMN to the DNN,S-NSSAI values in the HPLMN either retrieving
this from NSSF or from AMF.
The V-PCF generates URSP Rules for traffic that will be offloaded at the
VPLMN, either due to AF providing Application guidance for URSP rules
determination defined in clause 6.6 of TS 23.548 [5] or due to local policies
at the V-PCF. The V-PCF may decide to offload application traffic to a certain
DNN, S-NSSAI in the VPLMN based on e.g. load in the network that can be
derived from analytics at certain time of day. The V-PCF provides the list of
PSIs including the VPLMN ID to identify them at the UE.
The H-PCF can instruct the UE not to accept URSP Rules from the VPLMN, The
H-PLMN provides this indication to the UE when the UE Policy Authorization is
established.
#### 6.27.1.1 Characteristics of the solution
These are some of the characteristics of this solution that aims to motivate
the advantages to allow the VPLMN to provide URSP Rules to roamers.
1- Enables the VPLMN to have better control on how to route traffic in their
network while complying with the HPLMN S-NSSAI subscription information and
the Application guidance, if provided.
2- Reduces the amount of configuration information that is needed at the
HPLMN, e.g. a NEF or at the H-PCF to map the validity conditions on location
to the TAIs or Cell IDs at the VPLMN.
3- Reduces the amount of signalling to report subscribed PCRTs to the HPLMN,
in the most efficient way the HPLMN requires no PCRTs.
4- It is backward compatible with the existing policy framework given that the
HPLMN provides URSP Rules for its subscribers as in the design base, then
enhanced to the possibility for the VPLMN to provide URSP Rules for those
subscribers that have LBO roaming allowed in their HPLMN subscription.
Some scenarios:
\- Certain corporate application reachable via a DNN, S-NSSAI only in some
locations, some of these locations are at the VPLMN. A HPLMN may decide to
allow LBO roaming for this DNN, S-NSSAI for the corporate users, then the
VPLMN provide URSP Rules to route application traffic to a DNN, S-NSSAI when
the UE is at that location. In this scenario the AF can provide guidance for
URSP and the location where the corporate network is accessible will be mapped
by NEF at the VPLMN to the list of TAIs and Cell Ids in the access network.
\- A HPLMN may decide not to allow the VPLMN to provide URSP Rules, then the
S-NSSAI subscription information is not sent to the V-PCF. If no S-NSSAI
subscription data is received or if received but the LBO roaming allowed
indication is set to \"not allowed\", then the V-PCF generates no URSP Rules.
### 6.27.2 Procedure for UE Policy Association Establishment with VPLMN
provided URSP Rules
Figure 6.27.2-1: UE Policy Association Establishment when roaming (VPLMN
provides URSP Rules)
This procedure takes the UE Policy Association Establishment procedure in
roaming case as specified in clause 4.16.11 of TS 23.502 [3] as basis:
1,2, 3. Same as steps 1, 2 and 3 in clause 4.16.11 of TS 23.502 [3].
4\. Same as step 4 in in clause 4.16.11 of TS 23.502 [3], in addition the
H-PCF may include the S-NSSAI subscription information defined in Table
6.27.1-1.
5\. Same as step 5 in in clause 4.16.11 of TS 23.502 [3], in addition the
V-PCF stores the S-NSSAI subscription information as part of the UE Context
and may provide additional PCRTs to the AMF.
6a,7,8. The (H-)PCF may create a UE Policy Container to be sent to the UE as
defined in steps 7 and 8 in clause 4.16.11 of TS 23.502 [3].
6b. The (V-)PCF may create a UE Policy Container to be delivered to the UE.
NOTE: If step 6b happens it takes place at any time after step 5.
9\. The (V-)PCF triggers UE Configuration Update Procedure to send the UE
policy container as defined in step 8 in clause 4.5.11 of TS 23.502 [3].
10\. The V-PCF checks if the notification response is treated it locally or is
to be sent to the H-PCF, if so step 9 in clause 4.5.11 of TS 23.502 [3]
occurs.
11\. Same as step 10 in H-PCF clause 4.5.11 of TS 23.502 [3].
### 6.27.3 PDU Session establishment for LBO
The procedure for PDU Session establishment for LBO specified in clause in TS
23.502 [3] remains unchanged with the following clarifications:
The UE checks the validity of the RSD in the URSP Rule for VPLMN provided URSP
Rules as follows:
\- If any S-NSSAI(s) is present, the S-NSSAI(s) is in the Allowed NSSAI.
The UE checks the validity of the RSD in the URSP Rule for HPLMN provided URSP
Rules as follows:
\- If any S-NSSAI(s) is present, the mapping of the Allowed NSSAI to HPLMN
S-NSSAI(s) for the roaming case.
In both cases the UE provides both the S-NSSAIs of the Home PLMN and Visited
PLMN at PDU Session establishment as described in clause 5.15.5.3 of TS 23.501
[2]. The UE provides the PDU Session parameters as provided in the selected
RSD of the URSP Rule, i.e. for VPLMN provided URSP Rules the PDU Session
parameters are related to the VPLMN.
For those URSP Rules provided by the VPLMN, the V-PCF subscribes to DNN
replacement PCRT to the AMF. Then, the AMF sends the DNN to the PCF to replace
the DNN of the serving PLMN to the DNN of the HPLMN. The AMF sends both the
serving PLMN DNN if provided and the DNN of the HPLMN to the SMF then SMF
checks the SMF subscription data retrieved from UDM.
NOTE: It is assumed that a serving S-NSSAI maps to only one HPLMN S-NSSAI. It
is assumed that a serving DNN maps to only one PLMN S-NSSAI.
### 6.27.4 AF guidance for URSP determination
Figure 6.27.4-1: AF guidance for URSP determination
This procedure takes the Service Parameter provisioning as specified in clause
4.16.12.2 of TS 23.502 [3] as a basis. The difference is that the AF checks
the PLMNs that has an agreement with, then provide AF guidance to all these
PLMNs, in this case the VPLMN where the UE is roaming. The AF sends the
Service Parameter containing AF guidance on URSP Rule determination for any UE
at the VPLMN. Then the HPLMN has set LBO roaming allowed flag for those users
that are allowed to offload their application traffic to certain DNN, S-NSSAI
used to access the AF.
### 6.27.5 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
V-PCF:
\- to store S-NSSAI subscription information from the HPLMN.
\- to subscribe to notification from the V-UDR on Service Parameters.
\- to generate URSP Rules with RSD components that contain VPLMN DNN,
S-NSSAIs.
\- to subscribe to DNN replacement for those UE Policy associations for UEs
that has VPLMN provided URSP Rules.
H.PCF:
\- to provide S-NSSAI subscription information for a SUPI, per DNN and S-NSSAI
that has LBO roaming allowed set.
UDR:
\- UE Policy subscription data includes the S-NSSAI subscription information
includes the LBO roaming information, i.e. Indicates whether LBO roaming is
allowed per DNN, or per (S-NSSAI, subscribed DNN).
UE:
\- Check PLMN ID in the list of PSIs, for those including the VPLMN ID the UE
checks the validity of the RSD as for non-roaming case, i.e. the S-NSSAI is in
the list of Allowed S-NSSAIs.
## 6.28 Solution #28: Provisioning VPLMN URSP
### 6.28.1 Description
This solution is proposed to address technical issues for supporting URSP
delivery in VPLMN have been identified in Key Issue #1 particularly on \"How
to provide URSP Rules in roaming to the UE. In particular, how the HPLMN and
VPLMN are involved in such procedure\".
This solution identifies three scenarios from the perspective of which
operator generate the URSP. For each scenario, how H-PCF and V-PCF behave is
described as follows:
Scenario A. HPLMN URSP Generation:
\- The H-PCF in HPLMN generates the URSP rules for the UE on VPLMN request.
The V-PCF in VPLMN requests the H-PCF to generate URSP rules for VPLMN with
appropriate parameters.
\- When V-PCF requests H-PCF to generate URSP rules for VPLMN, the V-PCF use
LBO information (DNN/S-NSSAI and SSC mode) received from UDM of the HPLMN via
AMF to provide the parameters for H-PCF to generate the URSP rules.
Scenario B. VPLMN URSP Generation with HPLMN permission:
\- In this scenario, the V-PCF generates the VPLMN URSP rules with HPLMN
permission.
\- When V-PCF generates the VPLMN URSP rules, the V-PCF uses the LBO
information via AMF from UDM in HPLMN so that the V-PCF can derive the Route
Selection Descriptors for URSP rules. V-PCF also use VPLMN precedence range
provided by H-PCF to avoid the conflict URSP from PLMN and HPLMN.
With this solution, the H-PCF can assign the precedence range that HPLMN
provides to VPLMN during the establishing the UE policy association between
V-PCF and H-PCF in order to avoid the conflict to avoid the conflict between
the HPLMN generated URSP rules and VPLMN URSP rules. The V-PCF can map the
pre-assigned precedence values to the HPLMN assigned precedence values.
### 6.28.2 Procedures
#### 6.28.2.1 Provisioning VPLMN URSP rules for roaming scenario
With this procedure, the solution provides three different scenarios for
provisioning the VPLMN URSP rules to the UE.
1) HPLMN generation of URSP for VPLMN request.
This solution supports the HPLMN generation of VPLMN URSP rules based on the
V-PCF request as depicted in the Figure 6.28.2-1. During the UE registration,
the UDM in HPLMN provides the LBO information along with HPLMN URSP Generation
indication. The LBO information includes HPLMN\'s subscription information
such as DNN/S-NSSAI and SSC mode to be used for generation of the Route
Selection Components within the URSP rules. The AMF sends LBO information to
the V-PCF so that V-PCF can request for HPLMN generation of the VPLMN URSP
rules with the requested parameters.
Figure 6.28.2.1-1: HPLMN generation of URSP for VPLMN request
H-PCF may authorize whether the parameters requested by the V-PCF by checking
UDR. The H-PCF generates the VPLMN URSP in H-PCF with the authorized Route
Selection Components. H-PCF takes the relative precedence values sent by V-PCF
when generating the VPLMN URSP rules.
2) VPLMN generation of VPLMN URSP based on HPLMN permission.
This solution supports the VPLMN generation of VPLMN URSP rules based on the
HPLMN\'s permission as depicted in the Figure 6.28.2.1-2. During the UE
registration, the UDM in HPLMN provides the VPLMN URSP generation allowed
indication to the AMF in VPLMN. The UDM also sends the LBO information such as
DNN/S-NSSAI and SSC mode to be used for the generation of the Route Selection
Components within the URSP rules. The AMF sends LBO information to the V-PCF
so that V-PCF can generate VPLMN URSP rules.
Figure 6.28.2.1-2: VPLMN generation of VPLMN URSP based on HPLMN permission
To avoid the conflict between URSP rules from HPLMN and VPLMN, H-PCF provides
the VPLMN precedence range to the V-PCF. The H-PCF assigns the range of the
precedence of URSP rules for VPLMN URSP rules and provides the range to the
V-PCF. The V-PCF maps the pre-defined VPLMN URSP\'s precedence values to the
VPLMN range provided by the H-PCF.
With an example is as in the Table 6.28.2.1-1, the H-PCF in HPLMN can assigns
the VPLMN precedence range to 5\~6 for the V-PCF to use. HPLMN can use the
high priority values precedence for the application in the HPLMN\'s URSP rules
so that HPLMN can control those applications in high order. For example,
HPLMN\'s rule#1 for the App#1 is higher priority than VPLMN\'s rule #6 for the
same application. On the other hands, HPLMN can give more control for HPLMN
rule #3, #4, #5 to VPLMN. VPLMN can take those precedence provided by HPLMN to
use them for App#1 and abc.com. Rule #6 for App#1 is lower precedence of
Rule#1 of HPLMN, however, Rule#7 for the abc.com of VPLMN can have higher
priority than rule #4 of HPLMN. With this solution, HPLMN can take a control
of URSP rules that they care and also give a flexibility for VPLMN to use
those within the range.
Table 6.28.2.1-1: Example usage of URSP rule precedence
PLMN PSI URSP Rule Rule Precedence Traffic Descriptor Route Selection
Descriptor
* * *
HPLMN ID 1 Rule #1 1 App#1 DNN#1, S-NSSAI#1 Rule #2 2 App#2 DNN#1, S-NSSAI#2
Rule #3 7 IP 1.1.1.* DNN#1, S-NSSAI#3 2 Rule #4 8 Abc.com DNN#1, S-NSSAI#4
Rule #5 9 Match-all DNN#1, S-NSSAI#4 VPLMN ID 3 Rule #6 5 App#1, App#3, App#3
DNN#1, S-NSSAI#5 4 Rule #7 6 Abc.com DNN#1, S-NSSAI#5
How the H-PCF provides VPLMN precedence range to the V-PLMN is described in
the step 6 and 7 of Figure 6.28.2.1-4: Procedure of provisioning VPLMN URSP
rules for roaming scenario.
The procedure of provisioning VPLMN URSP rules for roaming scenario is
described in Figure 6.28.2.1-3. The procedure consolidates the all scenarios
described in the description.
Figure 6.28.2.1-3: Procedure of provisioning VPLMN URSP rules for roaming
scenario
From step 1 to 4 describes the procedure for the UE to register the serving
PLMN (i.e. VPLMN) in roaming scenario.
1\. During the registration procedure, the UE sends registration request to
the AMF in VPLMN. The UE sends in the UE Policy Container the Policy Section
Identifiers that are stored in the UE.
2\. The AMF identifies the HPLMN of the UE with SUCI and requests the
subscription information from UDM in HPLMN.
3\. The UDM in HPLMN sends the URSP generation information such as HPLMN URSP
Generation indication or VPLMN URSP Generation allowed indication to the AMF.
The AMF also receives the LBO information that includes DNN/S-NSSAI and SSC
mode from the UDM.
Table 6.28.2.1-2
+----------------------+----------------------+----------------------+ | Subscription data | Field | Description | | type | | | +======================+======================+======================+ | LBO Roaming | LBO Roaming Allowed | This information | | Subscription data | Parameters | includes SSC Mode, | | | | PDU Session Type, | | | | Access Mode Type, | | | | | | | | This information is | | | | used for V-PCF to | | | | check the Home | | | | subscription data if | | | | Visited URSP | | | | Generation Allowed | | | | indication is | | | | present. | +----------------------+----------------------+----------------------+ | | Visited URSP | Indicates whether | | | Generation Allowed | the V-PCF generates | | | | the URSP rules for | | | | VPLMN. The absence | | | | of this indication | | | | means that VPLMN is | | | | not allowed to | | | | generate URSP rules. | +----------------------+----------------------+----------------------+ | | HPLMN URSP | Indicates HPLMN can | | | Generation Required | generate the URSP | | | Indication | rules for VPLMN. If | | | | this indication is | | | | included, the V-PCF | | | | is allowed to | | | | request H-PCF to | | | | generate the URSP | | | | rules for VPLMN. | +----------------------+----------------------+----------------------+
4\. The AMF sends the Registration Accept to the UE.
5\. The AMF sends the UEPolicyControl_Create request to the V-PCF with the UE
Policy Container received from the UE. The AMF sends HPLMN URSP Generation or
VPLMN URSP Generation allowed indication along with the LBO information (e.g.
DNN/S-NSSAI and SSC mode) the V-PCF either to request to HPLMN URSP generation
or to generate VPLMN URSP rules by V-PCF itself.
6\. The V-PCF either requests HPLMN to generate URSP for VPLMN or generates
VPLMN URSP by itself based on the HPLMN URSP Generation or VPLMN URSP
Generation allowed indication received from the AMF respectively.
If HPLMN URSP Generation is indicated, the V-PCF sends the parameters to
request H-PCF to generate URSP rules for VPLMN. The parameters includes the
information for H-PCF to generate URSP rules for VPLMN such as traffic
descriptor and Route Selection Descriptors. If there are multiple rules, the
information also includes relative precedence values.
If VPLMN URSP Generation allowed is indicated, the V-PCF sends the request for
H-PCF to allow the V-PCF to generate URSP rules for VPLMN. It requests
implicitly the precedence value ranges for the V-PCF to generate the URSP
rules.
After identifying the parameters, the V-PCF sends the
Npcf_UEPolicyControl_Create request to the H-PCF.
NOTE: In a scenario where no UE-PCF is deployed in HPLMN as depicted in Figure
6.28.2.1-3, the steps 6, 7, 8, 9, 11, 12, 18, 19 are not performed.
If V-PCF requests H-PCF to generate URSP for VPLMN with its parameters, the
H-PCF authorizes the requested parameters to be used as Route Selection
Components of the URSP rules by checking the subscription information by
accessing the UDR.
If V-PCF requests H-PCF to allow the V-PCF to generate the VPLMN URSP, the
H-PCF authorizes the request by checking the subscription information by
accessing the UDR.
7\. The H-PCF sends the authorization result to the V-PCF by sending
Npcf_UEPolicyControl_Create response.
If H-PCF receives the VPLMN URSP generation request, the H-PCF also assigns
the VPLMN precedence range and sends it to the V-PCF so that the V-PCF uses
the VPLMN precedence range when generating URSP rules in order to avoid the
conflict between the HPLMN generated URSP rules and VPLMN URSP rules.
8\. The V-PCF responds to the AMF with sending Npcf_UEPolicyControl_Create
response.
9\. If V-PCF requested HPLMN URSP generation for the VPLMN, the H-PCF
generates both the URSP rules of HPLMN and URSP rules for VPLMN using the
parameters provided by the V-PCF. If V-PCF requests to allow V-PCF to generate
VPLMN URSP rules, the H-PCF generates only URSP rules of HPLMN.
The H-PCF invokes the UEPolicyControl_UpdateNotify to send the generated URSP
rule to the V-PCF.
10\. The V-PCF acknowledges the UEPolicyControl_UpdateNotify.
11\. The V-PCF generates the VPLMN URSP rules by itself and sends both HPLMN
URSP rules and VPLMN URSL rules to the AMF. When generating VPLMN URSP rules,
V-PCF uses the LBO information (such as DNN/S-NSSAI and SSC mode) received
from the AMF to derive Route Selection Descriptors. If the V-PCF receives the
VPLMN precedence range from the H-PCF at the step 7, the V-PCF assigns the
precedence values of VPLMN URSP rules within the received range.
12-14. The AMF sends the UE policy container to the UE using the UE
configuration update procedure.
15\. The AMF reports the UE policy delivery result to the V-PCF.
16\. The V-PCF sends the Npcf_UEPolicyControl_UpdateNotify to the H-PCF to
inform the UE policy delivery result.
17\. The H-PCF acknowledges the Npcf_UEPolicyControl_UpdateNotify.
#### 6.28.2.2 Application Guidance of URSP determination in VPLMN
With this procedure, the solution provides three different scenarios for AF in
VPLMN to provide application guidance for URSP determination. Similar to
clause 6.28.2.1, three different scenarios for VPLMN URSP generation are
described.
1) HPLMN generation of URSP for VPLMN request (Figure 6.28.2.2-1)
When the AF requests the application guidance for URSP determination, NEF
stores the service parameters in V-UDR. The V-UDR notify the V-PCF. Since the
V-PCF has received LBO information from the AMF during the UE registration
procedure as in step 5 of Figure 6.28.2.1-3, the V-PCF is aware of available
home subscription values for the UE. The V-PCF sends the parameters to request
the H-PCF to generate the URSP rules for VPLMN. The rest of steps are similar
to the procedures of Figure 6.28.2.1-4.
Figure 6.28.2.2-1: HPLMN Generation of URSP for VPLMN request
2) VPLMN generation of URSP rules (Figure 6.28.2.2-2)
When the AF requests the application guidance for URSP determination, NEF
stores the service parameters in V-UDR. The V-UDR notify the V-PCF. Since the
V-PCF has received LBO information from the AMF during the UE registration
procedure as in step 5 of Figure 6.28.2.1-4, the V-PCF is aware of available
home subscription values for the UE.
Figure 6.28.2.2-2: VPLMN Generation of URSP
The procedure of application guidance for URSP determination in VPLMN for
roaming scenario is described in Figure 6.28.2.2-4. The procedure consolidates
the all three scenarios described above.
Figure 6.28.2.2-4: Procedure of application guidance for URSP determination in
VPLMN
0\. UE performs the registration procedure with the AMF in VPLMN. The AMF
retrieves HPLMN URSP Generation indication or VPLMN URSP Generation allowed
indication and the LBO information in UDM and provides them to the V-PCF
during creation of UE Policy Association.
1\. The AF in VPLMN creates an AF request for application guidance for URSP
determination in VPLMN
2\. The AF sends the AF request to the NEF.
3\. The NEF stores the service parameters to the UDR in VPLMN.
4\. NEF acknowledges the AF request. The parameters of AF request is checked
in the step 6.
5\. The V-UDR notifies V-PCF of DM information.
6\. Based on the HPLMN URSP Generation indication or VPLMN URSP Generation
allowed indication received from the AMF when creating the UE Policy
association, the V-PCF either requests HPLMN to generate URSP for VPLMN or
generates VPLMN URSP by sending Npcf_UEPolicyControl_Create to the H-PCF.
If the VPLMN URSP Generation is allowed, the V-PCF checks the parameters of AF
request to URSP rules with LBO roaming subscription data received from the
UDM.
If HPLMN URSP Generation is indicated, the V-PCF sends the parameters to
request H-PCF to generate URSP rules for VPLMN. The parameters includes the
information for H-PCF to generate URSP rules for VPLMN such as traffic
descriptor and Route Selection Descriptors. If there are multiple rules, the
information also includes relative precedence values.
NOTE: For the scenarios as depicted in Figure 6.28.2.2-2, the steps 6, 7, 8,
9, 11, 12, 18, 19 are not performed.
7\. H-PCF sends the response to the V-PCF.
8-12. The steps are the same as the step 11 to step 19 of the Figure
6.28.2.1-4.
13\. The V-PCF notifies the outcome of UE policy delivery result to the NEF.
14\. The NEF notifies the outcome of UE policy delivery result to the AF.
### 6.28.3 Impacts on services, entities and interfaces
AMF:
\- The AMF is required to support HPLMN URSP Generation and VPLMN URSP
Generation indication and forward LBO information (e.g. DNN/S-NSSAI and SSC
mode) to the V-PCF.
V-PCF:
\- The V-PCF is required to provide the parameters for H-PCF to generate URSP,
generate VPLMN URSP triggered by UE registration and support the AF request
for application guidance of URSP determination in VPLMN.
H-PCF:
\- The H-PCF is required to support the generation of URSP for VPLMN request.
The H-PCF is required to assign the VPLMN precedence range if the V-PCF
requests VPLMN generation of URSP rules.
UDM:
\- The UDM is required to provide the HPLMN URSP generation indication or
VPLMN URSP generation allowed indication.
## 6.29 Solution #29: Using Location Criteria to Control Routing of
Application Traffic
### 6.29.1 Description
This solution addresses the following aspect of Key Issue #1:
\- Whether and how to support URSP enhancements to support routing of the
application traffic with different URSP rules in different PLMNs.
Other Key Issue #1 solutions in this TR explain what might trigger the PCF to
send URSP rules to the UE. This solution does not address this aspect of Key
Issue #1. Rather, this solution proposes how to use Location Criteria to
support routing of the application traffic with different URSP rules in
different PLMNs. In this solution the RSDs can be VPLMN dependent and can be
sent to the UE by the HPLMN before the UE registers to the VPLMN. An
indication in the RSD is used by the UE to help detect when URSP re-evaluation
should be considered. In other words, this solution does not require that new
URSP Rules be sent to the UE each time the UE registers in a different PLMN.
The principles of this solution are:
\- In Rel-17, a URSP rule can already be configured with Location Criteria
that indicates to the UE that the route (i.e. PDU Session) should only be
established, or used, when the UE served by certain cell(s), RAN node(s), or
TAIs. This feature can be used to cause the UE to select a DNN/S-NSSAI
combination that is appropriate for the PLMN where the UE is registered (e.g.
an LBO Session). Location criteria is defined in TS 24.526 [10] and may be a
list of cell(s), RAN node(s), or TAI(s). This solution proposes that Location
Criteria can also include PLMN ID(s).
NOTE 1: Whether PLMN ID(s) can be encoded as part of Location Criteria or
encoded as a new validation criteria information element is left to stage 3.
\- When a route includes Location Criteria, a \"Revaluation Suggested\"
indication can be added to the RSD. A \"Revaluation Suggested\" indication in
the RSD indicates to the UE that the UE should re-evaluate URSP rules for
traffic that uses the PDU Session if the Location Criteria becomes invalid and
release the PDU Session if no traffic is using the PDU Session after re-
evaluation. In other words, the PDU Session may be released when the UE leaves
the PLMN, cell(s), RAN node(s), or TAI(s) where the location criteria is valid
and all traffic is moved to a different PDU Session (e.g. an LBO PDU Session).
Triggering re-evaluation will cause the UE to select a new route. The new
route may include location criteria for the UE\'s new location and a PDU
Session will be established with a DNN/S-NSSAI combination that is better
suited for the UE\'s new location (e.g. for the PLMN where the UE is now
registered).
NOTE 2: It is a UE implementation decision when to re-evaluate URSP Rules. The
indication is used to by the UE to help determine if it should re-evaluate.
### 6.29.2 Procedures
The UE receives URSP rules. Some URSP rules may have Traffic Descriptors that
are associated with traffic that should preferably use a certain DNN/S-NSSAI
combination when the UE is in a certain PLMN. The RSDs of these URSP rules may
include Location Criteria. By including Location Criteria, the URSP rule can
be configured such that the UE will select a DNN/S-NSSAI combination for PDU
Session Establishment based on the UE\'s cell, RAN Node, TAI or PLMN ID. Thus,
the UE will use a DNN/S-NSSAI combination based on the PLMN that the UE is
registered with. For example, the route will only be considered valid if the
PLMN ID in the Location Criteria matches the PLMN ID of the PLMN where the UE
is currently registered or if the PLMN ID in the Location Criteria is an
equivalent PLMN of the PLMN where the UE is currently registered.
Existing Rel-17 behaviour is that when the UE leaves the cell, RAN Node, or
tracking area, the UE will continue to use the PDU Session until URSP Rules
are re-evaluated. However, the UE is not required to re-evaluate URSP rules
for the traffic.
This solution proposes that the RSD(s) also include a \"Revaluation
Suggested\" indication. When a change of cell, RAN node, TAI, or PLMN occurs,
the existing PDU Session will be released if no longer needed and the UE will
re-evaluate URSP rules. URSP re-evaluation will cause the UE to choose a new
RSD for the traffic. The location criteria in the new RSD will cause the UE to
select a DNN/S-NSSAI that is associated with the PLMN where the UE is
currently registered.
### 6.29.3 Impacts on services, entities and interfaces
PCF:
\- can include the \"Revaluation Suggested\" indication with location criteria
in RSDs;
\- can include a PLMN ID(s) in location criteria.
UE:
\- can receive the \"Revaluation Suggested\" indication with location criteria
in RSDs;
\- can use the \"Revaluation Suggested\" indication to decide when to trigger
URSP Re-evaluation;
\- can receive a PLMN ID(s) in location criteria.
## 6.30 Solution #30: Leveraging NWDAF to determine UEs that enforce URSP
rules incorrectly.
### 6.30.1 Description
This solution is related with KI#6 of the eNA study and also KI#2 of FS_eUEPO
on how the 5GC can be aware that the UE enforces a URSP rules correctly.
The solution proposes to leverage the NWDAF to identify cases where a UE
routes traffic to a PDU session (of a specific S-NSSAI/DNN) that is not
according to the routing policies configured to the UE based on a provisioned
URSP rule.
The consumer ( i.e.) PCF is aware of the correct application traffic that
needs to be routed over a specific S-NSSAI/DNN by inspecting the URSP rule
that needs to be determined if it is enforced correctly by UEs. The Traffic
Descriptor of the URSP rule will identify the application traffic and the
Route Selection Descriptor component will denote the correct S-NSSAI/DNN to
route the application traffic.
The PCF determines to request analytics to identify if UEs enforce URSP rules
correctly to a PDU session of a specific S-NSSAI/DNN based on local
configuration.
The request to the NWDAF to provide analytics to detect UEs that do not
enforce URSP correctly include the following:
\- An analytic ID denoting a request for URSP enforcement analytics.
\- Analytic Filters:
\- The S-NSSAI/DNN of the PDU session established by a UE.
\- The Allowed application traffic towards the PDU session according to the
URSP rule. Allowed application traffic may include the Traffic Descriptor of
the URSP rule (e.g. Application ID, FQDN) or may include allowed service data
flows (i.e. the PCF may determine the allowed service data flows based on the
Traffic Descriptor).
\- Area of interest.
\- Any UE or list of UEs.
The NWDAF subscribes to the UPF using a new Nupf event based subscription to
report \"non-matching traffic\" for a PDU session established to a specific
S-NSSAI/DNN. The Nupf_EventExposure_Subscribe requests includes the following:
\- A new event ID: e.g. \"Non-matching traffic\";
\- Traffic Filters indicating the allowed traffic. This can be a 5-tuple or an
application id;
\- S-NSSAI or DNN of the PDU session to be inspected;
\- Target of Event Reporting (e.g. a single UE, a group of UE or any UE);
\- Notification Target Address (+ Notification Correlation ID); and
\- Event Reporting Information defined in Table 4.15.1-1 of TS 23.502 [3].
The NWDAF determines the UPF that support the requested S-NSSAI/DNN either by
interfacing with the NRF or the UDM (if the request includes a list of UE(s).
When the UPF detect non-matching traffic the UPF reports to the NWDAF, traffic
filters indicating the traffic detected and a UE identifier (UE ID or UE IP
address) of the UE that routed non-matching traffic to a PDU session
established to a specific S-NSSAI/DNN.
NOTE 1: The UPF can use the usage reporting capabilities as described in
clause 5.4.6 of TS 29.244 [14] to determine and report non-matching traffic.
NOTE 2: It is assumed that the UPF has received S-NSSAI/DNN information from
the SMF when the SMF establishes an N4 session for a requested PDU session.
NOTE 3: To control the signalling load of the UPF the UPF can be configured to
report usage periodically to the NWDAF by re-using the event reporting
information defined in Table 4.15.1-1 of TS 23.502 [3].
Based on the information collected the NWDAF reports to the PCF a list of UEs
that route traffic incorrectly and application traffic that is routed
incorrectly over the S-NSSAI/DNN. The PCF uses the information to determine if
such UEs require updated URSP rules (e.g. route specific application traffic
over a default DNN) (if the consumer is the UE PCF) or block traffic by
providing updated PCC rules for the established PDU session (if the consumer
is the SM PCF).
### 6.30.2 Input Data
The following input data are required by the NWDAF to identify UEs that
enforce URSP rules incorrectly.
Table 6.30.2-1: Input data for URSP enforcement analytics
+----------------------+--------+-----------------------------+ | Information | Source | Description | +======================+========+=============================+ | S-NSSAI | UPF | The S-NSSAI that the UE has | | | | established a PDU session | | | /SMF | | +----------------------+--------+-----------------------------+ | DNN | UPF | The DNN that the UE has | | | | established a PDU session | | | /SMF | | +----------------------+--------+-----------------------------+ | UE ID | UPF | The identity of the UE that | | | | has established a PDU | | | /SMF | session to a specific | | | | S-NSSAI/DNN | +----------------------+--------+-----------------------------+ | non-matching traffic | UPF | The traffic detected that | | | | is not matched against the | | | | allowed traffic over a | | | | specific S-NSSAI/DNN | +----------------------+--------+-----------------------------+
### 6.30.3 Output Analytics
The NWDAF only provides to the PCF statistics on UEs that do not enforce URSP
correctly as shown in the table below. For this scenario the NWDAF does not
provide any predictions.
Table 6.30.3-1: \"URSP enforcement\" statistics
Information Description
* * *
List of URSP enforcement Analytics (1..max)  
> Non-matching traffic The traffic detected that is not matched against the
> allowed traffic >Applicable DNN The DNN that the UE has established a PDU
> session >Applicable S-NSSAI The S-NSSAI that the UE has established a PDU
> session > List of SUPIs A list of UE that route the same non-matching
> traffic over a specific S-NSSAI/DNN
### 6.30.4 Procedures
The procedure is shown in the figure below.
Figure 6.30.4-1: NWDAF providing analytics for URSP rules enforcement
The procedure is as follows:
1\. The consumer (i.e. PCF) needs to identify if a URSP rule is enforced
correctly by UEs. The PCF is locally configured to determine which URSP rule
needs to be checked if enforced correctly by UEs.
2\. The consumer request analytics for URSP enforcement by the NWDAF. The
consumer includes a specific Analytic ID (that is associated to the URSP
enforcement analytics) and includes as analytics filters the following
information:
\- An analytic ID denoting a request for URSP enforcement analytics.
\- Analytic Filters:
\- The S-NSSAI/DNN of the PDU session established by a UE.
\- The Allowed application traffic towards the PDU session according to the
URSP rule. Allowed application traffic may include the Traffic Descriptor of
the URSP rule (e.g. Application ID, FQDN) or may include allowed service data
flows (i.e. the consumer may determine the allowed service data flows based on
the Traffic Descriptor).
\- Area of interest.
\- Any UE or list of UEs.
3.
**If the request includes ny UE:**
\- The NWDAF subscribes from all SMFs supporting the S-NSSAI/DNN requested, to
be notified when a UE establishes a PDU session to the S-NSSAI/DNN requested
in step 2. The SMF provides the UE ID and UE IP address to the NWDAF.
**If the request includes a list of UEs**
\- The NWDAF finds the UPF serving the UE for the requested S-NSSAI/DNN by
querying the UDM to identify SMF serving UE for the S-NSSAI/DNN and then
querying the SMF to identify the UPF serving the UE.
\- Alternatively the NWDAF may query the UDM to find the UPF serving the UE
for an S-NSSAI/DNN
4\. The NWDAF subscribes from the UPF to report non-matching traffic. The
NWDAF subscribes to the UPF using a new Nupf event based subscription to
report \"non-matching traffic\" for a PDU session established to a specific
S-NSSAI/DNN. The Nupf_EventExposure_Subscribe requests includes the following:
\- A new event ID: e.g. \"Non-matching traffic\";
\- Traffic Filters indicating the allowed traffic. This can be a 5-tuple or an
application id;
\- S-NSSAI or DNN of the PDU session to be inspected;
\- Target of Event Reporting (e.g. a single UE, a group of UE or any UE);
\- Notification Target Address (+ Notification Correlation ID); and
\- Event Reporting Information defined in Table 4.15.1-1 of TS 23.502 [3].
5\. A UE determines to request a PDU session based on application traffic
matching a URSP rule.
6\. The UE requests establishment of a PDU session to the SMF according to TS
23.502 [3].
7\. When the UPF receives traffic (either in downlink or uplink) for a UE the
UPF reports non-matching traffic and includes the service data flows of the
traffic detected.
8\. The NWDAF compiles a list of UEs where application traffic is sent to the
wrong S-NSSAI/DNN.
9\. The NWDAF provides a list of UE IDs and a list of non-matching traffic
that is wrongly sent to this S-NSSAI/DNN.
10\. The PCF may construct a new URSP rule to route traffic detected via a
different S-NSSAI/DNN, e.g. via a default DNN.
### 6.30.5 Impacts on services, entities and interfaces
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
\- NWDAF supporting new analytic id to identify UEs that do not enforce URSP
rule correctly.
\- UPF reporting to NWDAF application traffic that is not matched against
allowed traffic to a specific S-NSSAI/DNN.
## 6.31 Solution #31: New URSP Notification Component
### 6.31.1 Description
This solution describes an extension to the Route Selection Descriptors listed
in clause 6.6.2 of TS 23.503 [4] with a new category: URSP Notification
component. The solution allows the 5GC to be made aware of whether a URSP rule
is enforced and considers as well user privacy by allowing the UE/user to
reject URSP rules with a notification component and notify the 5GC of the
rejection.
Examples are provided in clause 6.31.2.4 of how this solution can enable
action from the 5GS to be taken after the 5GC is aware whether the UE enforces
a URSP rule for specific application traffic or not. However, the focus of the
solution is on making the 5GC aware of URSP rule enforcement.
A URSP Notification component instructs the URSP rule to, under certain
trigger conditions, generate a notification towards the core network. If the
component is not included in the URSP rule, it is not required by the network
to generate notifications towards the core network (i.e. URSP functionality as
it is now).
Similarly to how SBI notifications contain a subscription identifier, URSP
Notification component contain an identifier, which is included in
notifications and are used by the core network to map the notification to a
URSP rule and trigger.
In order not to overload existing identifiers (e.g. PSI, precedence), the
identifier introduced in this solution is coupled to the notification
component. This also allows that more than one notification trigger can be
linked to a given URSP rule.
The table below, based on Table 6.6.2.1-3 of TS 23.503 [4] includes the
current Route Selection Descriptor and the new URSP Rule Notification
Descriptor. Existing URSP descriptors are shown greyed-out, new URSP
Notification Component highlighted.
Information name Description Category
* * *
Route Selection Descriptor Precedence Determines the order in which the Route
Selection Descriptors are to be applied. Mandatory Route selection components
At least one of the route selection components Mandatory Route Selection
Validation Criteria Optional Route Validation Criteria components Optional
[NEW] URSP Notification Component Optional Route Selection Notification
Component(s) Optional
The URSP Notification Component indicates the UE that, under certain
conditions, the UE is to notify the PCF. URSP Notifications are sent towards
the PCF responsible for the UE indirectly via the AMF via a UL NAS TRANSPORT
message carrying a UE Policy Container (URSP Notification) to the AMF. The UL
NAS TRANSPORT mechanism used to reach the PCF uses the same mechanics as the
Procedure for UE triggered ProSe Policy provisioning described in clause 6.2.4
of TS 23.304 [12].
NOTE 1: URSP Notification component(s) are not used with match-all rules.
The AMF at the receiving end maps the PCF responsible for the UE and forwards
the Notification towards the PCF. The PCF at the receiving end will be able to
map the generating UE, URSP rule and trigger based on the URSP Notification
Component ID without the information having to be explicitly signalled.
So that the 5GC can be made aware whether or when the UE enforces a URSP rule
to route an application traffic to a PDU Session based on the URSP rule
provisioned by 5GC, the following trigger conditions are considered as part of
a URSP Notification Component:
a) First use of the URSP rule.
b) Data sent over given period of time (i.e. periodic reporting).
c) If a certain amount of data has been sent over a specific period of time
(i.e. Bandwidth threshold).
Examples of possible applications of the above-mentioned triggers would be (a)
first activation of a service, (b) the network ascertaining if the URSP rule
is still in use (i.e. a sort of \"service Up/Down\" indicator) or (c) for some
services (e.g. video) a bandwidth threshold could be setup so that signalling
(e.g. HTTP requests to the web itself, not the video) do not trigger a
\"used\" indication, but rather only if a bandwidth-intensive usage is seen.
Note that the 5GC specifies how to detect the data sent and received over a
given period, using usage monitoring reporting and can provide bandwidth
parameters to limit the amount of data sent over a period, using the QoS
framework defined in 23.501, and the MBR parameter.
For the use of the URSP Rule, this is a solution while other solutions exist
to this KI#2 that enables detection of the URSP Rule in use (first or
subsequent use) either at the SMF or PCF.
User privacy is considered by allowing the UE to reject URSP policies
including notifications based on UE security policies. However, if a UE
accepts a URSP rule, it is expected to apply it fully, including URSP
Notification Component(s).
Procedures are shown for the following cases:
\- URSP rule delivery, URSP Notification sent to 5GC.
\- Detail of UE policy delivery and user content.
\- Applicability to (pre-)configured URSP rules and changes in privacy
settings.
NOTE 2: How the preconfigured URSP Rules are used and for what purpose is
detailed in clause 6.31.2.3.
### 6.31.2 Procedures
A call flow of the procedure is shown below.
#### 6.31.2.1 URSP Notification procedure flow
Figure 6.31.2.1-1: URSP Notification procedure flow
1\. As part of the UE policy association establishment, as per TS 23.502 [3],
clause 4.16.11, the PCF is assumed to register to the BSF as the PCF serving
this UE. The PCF is subscribed to be notified of the reception of the UE
Policy container then the AMF forwards the response of the UE to the PCF using
Namf_Communication_N1MessageNotify.
NOTE 1: According to clause 6.3.7.1 of TS 23.501 [2], the same PCF instance is
assumed for AM policy association and UE policy association.
2\. UE Policies are delivered to the UE using the current, existing mechanism
of UE Configuration Update procedure for transparent UE Policy delivery, see
clause 4.2.4.3 of TS 23.502 [3]. URSP Rule(s) contain one or more Route
Selection Notification Components. The UE can, based on local security/privacy
settings, reject URSP rules containing URSP notification component(s). Each
Route Selection Notification Components contains:
\- Identifier: Similarly to how a SBI subscription has a subscription
identifier, a Notification component contains an identifier to be included in
subsequent notifications. The identifier is used by the PCF to map the
notification to a UE, URSP rule and trigger.
\- Trigger condition: Following trigger conditions are considered:
\- First use of the URSP rule.
\- Data sent over given period of time (i.e. periodic reporting).
\- If a certain amount of data has been sent over a specific period of time
(i.e. Bandwidth threshold).
NOTE 2: Details of the UE policy delivery including privacy-related aspects
and user consent are detailed in the next call flow in clause 6.31.2.1.
3\. Trigger condition for a notification (Notification Component A) is set
4\. The UE sends the URSP notification via a UL NAS TRANSPORT message. The
included UE Policy Container is of type URSP Notification and contains:
\- Identifier of Notification Component A.
\- Notification information (depending on trigger condition).
5\. The AMF sends Namf_Communication_N1MessageNotify request to the PCF
including the UE Policy Container received from UE as described in step 2 of
clause 6.2.4 of TS 23.304 [12].
6\. The PCF uses the URSP Notification Component ID to map the incoming
notification information to a UE, URSP rule (if the URSP rule is known) and
trigger condition.
#### 6.31.2.2 Detail of UE policy delivery and user consent
This call flow depicts an expanded view of step 2. The flow is based on clause
4.2.4.3 of TS 23.502 [3].
Figure 6.31.2.2-1: UE Configuration Update procedure for transparent UE Policy
delivery including URSP Notification component and privacy aspects
0-2. Same as in clause 4.2.4.3 of TS 23.502 [3].
3\. Delivery of the UE policy content described in clause 6.31.2.1, step 2.
The UE policy content is delivered as for step 3 in clause 4.2.4.3 of TS
23.502 [3].
4\. For URSP rules containing a URSP Notification component, the UE can be
configured to allow said reporting. Examples of security/privacy
configuration:
\- User is to be prompted whether a given URSP rule including a notification
component should be allowed when the URSP rule is received.
\- Certain applications are allowed to use URSP notification components (e.g.
UE configuration, configured by user).
If the Notification component is not allowed, the URSP rule is rejected and
not stored in the UE.
NOTE 1: If the URSP rule is rejected, as a result, certain traffic will not be
able to use enhanced functionality. Thus, the user has the option to allow
enhanced routing for certain application with the knowledge that traffic
reports may be send or disallow such reporting and use other routing (e.g.
default slice/PDU session).
5\. Same as step 4 in clause 4.2.4.3 of TS 23.502 [3], with the addition that
in case the URSP rule was rejected due to one or more URSP Notification
component(s) not being allowed. The UE includes this information in the
result.
NOTE 2: For the case when an already-accepted URSP rule is rejected after
being accepted (e.g. privacy/security settings were changed), see clause
6.31.2.3.
6\. Same as step 5 in clause 4.2.4.3 of TS 23.502 [3].
If a URSP rule is rejected by the UE, the PCF can use the returned URSP
rejection reason to produce an alternative set of URSP rule(s). The logic how
the PCF can produce an alternative set of URSP rule(s) or whether no
alternative URSP rule is produced is not in scope of this solution.
#### 6.31.2.3 URSP Rule rejection for pre-configured URSP rules or already-
accepted URSP rules (e.g. change in privacy/security settings)
Pre-configured URSP rules are covered by the current specification. As stated
in TS 23.503 [4], clause 6.1.2.2, \"_ANDSP and URSP may be pre-configured in
the UE or may be provisioned to UE from PCF_ \".
If the solution does not consider user privacy for the case of pre-configured
URSP rules (e.g. a UE pre-configured for use of a certain slice), it would be
possible by design to circumvent the functionality in clause 6.31.2.2 simply
by means of pre-configuring URSP rules. Pre-configuration of URSP rules would
either result in the UE not having a chance of rejecting the URSP rule (the
rejection mechanism described in clause 6.31.2.2 is based on \"Result of the
delivery of UE policies\") or the UE not applying the given URSP rule while
the network is not aware that the URSP rule has been rejected.
While it is possible that a pre-configured URSP rule is not known to the PCF,
it is assumed that it, as well as any associated URSP notification identifier,
is known to the operator. As such, this solution does not propose that the UE-
PCF performs any action based on this (not known) URSP rule besides forwarding
it to a 3rd party (e.g. see clause 6.31.2.4.2).
Additionally, a similar case occurs if, after the UE accepted a URSP rule (see
clause 6.31.2.2), UE configuration is changed (e.g. if security/privacy
settings are changed so that a given URSP rule should now be rejected by the
UE).
For pre-configured URSP rules or already-accepted URSP rules, there is no
possibility for the UE to respond with a \"Result of the delivery of UE
policies\". In this case, the UE\'s URSP security/privacy policy is configured
with a URSP rule to be used for rejected URSP rules (e.g. the default URSP
rule). The UE notifies the PCF via UL NAS TRANSPORT:
\- Identifier of Notification Component.
\- Notification information indicating that the pre-configured URSP rule does
not conform to the security/privacy policy and as such it is rejected.
Figure 6.31.2.1-1: URSP rule rejection for existing URSP rules
0\. The initial assumption is a URSP rule (URSP rule A) provisioned in the UE
containing a URSP notification component (URSP Notification X), e.g. a pre-
configured URSP rule or a URSP rule that has been signalled by the PCF and
accepted (see 6.31.2.2). Privacy/security settings from the UE do not allow
URSP Notification X1. Traffic matches URSP rule A. URSP rule A is not applied
due to the privacy/security settings, e.g. first use of a pre-configured URSP
rule, change of security/privacy settings since the URSP rule was received
from UE-PCF and accepted by the UE.
2\. The UE sends the a URSP Notification via a UL NAS TRANSPORT message. The
included UE Policy Container is of type URSP Notification and contains:
\- URSP rule A rejection.
\- Reason for rejection: URSP Notification Component A not allowed.
3\. The AMF sends Namf_Communication_N1MessageNotify request to the PCF
including the UE Policy Container received from UE as described in TS 23.304
[12], clause 6.2.4, step 2.
4\. The PCF uses the URSP Notification Component ID to map the incoming
notification information to a UE, URSP rule (if the URSP rule is known) and
trigger condition.
NOTE: The UE can report that a URSP Rule provided in the UE Configuration
Update for UE Policies was not installed, this procedure could also be
enhanced to allow the UE to report that a URSP Rule was removed to the
network.
#### 6.31.2.4 Example of PCF actions on receiving URSP Notifications
This clause lists some examples of actions the PCF could take on reception of
URSP notifications. While the solution focuses on asserting the URSP usage by
the UE, the examples shown in this clause show possible uses of this
information and that the solution is compatible with the current 5GC
architecture and design principles.
The examples focus on how SM-PCF, AF and/or NEF can be notified of URSP
Notifications received by the UE-PCF. The mapping of a URSP notification to a
URSP rule by the UE-PCF is only considered for URSP rules known to the UE-PCF.
This solution focuses on how the 5GC can be made aware of URSP rule
enforcement, but following actions are possible based on reception of URSP
Notifications:
\- Sending an alternative URSP rule to the UE (or removing an existing one)
without notification capability and/or modifying the applied SM policy.
\- Rejecting the UE (e.g. the service requires a specific SLA and part of the
SLA can only be fulfilled if the URSP rule is applied)
\- Notifying the application owner, when the URSP Rule was generated based on
Service Parameters provided by the AF.
Related to possible triggers, an example use case for sending an alternative
URSP rule to the UE (or removing an existing one) would be a combination with
transmission of a certain amount of data, whereas only a certain amount of
data would be using a specific slice (e.g. with resource reservation), whereas
after that the URSP rule could be remove by the UE-PCF.
##### 6.31.2.4.1 Example action: Storage of received notification on the UDR
linked to the triggered UE
In this example, the PCF receiving the URSP Notification performs storage of
the received notification on the UDR linked to the triggered UE (e.g. via
Nudr_DR/policy-data/ues/{ueId}/) and, if available, to the generating URSP
rule. Pre-configured URSP rules may not be known to the PCF but known to the
operator.
NOTE: There is already a procedure for the PCF to report to the AF via UDR,
per current procedures, the UDR is a repository not handling reporting of
events but rather PCF or AMF can do it directly. This example could
alternatively (and with less need for changes) be realized in such a way.
Based on the received information, the UDR can generate notifications towards
SM-PCF(s) subscribed to notifications related to a given URSP policy rule.
With the information that a given application linked to a the URSP is active,
the SM-PCF can steer the session policy to e.g., increase the QoS associated
to a PDU session.
Specific (example) use cases related to this example would be a PDU session
used by an application (e.g. slice offering GBR services) where a second
application is now first used (and so signalled by the UE). The existing PDU
session\'s GBR could now be updated so that it can also accommodate the
additional application. Similarly, if it is detected that the second
application is not used anymore (e.g. via periodic reporting), the GBR could
be adjusted down.
For the realization of this example, it is considered that the UDR contains a
mapping between the URSP rules (accessed via /policy-data/ues/{ueId}/am-data)
and SM policy data (accessed via /policy-data/ues/{ueId}/sm-data). In this
way, a SM-PCF can subscribe to events related to its SM policies without
requiring any explicit knowledge of what URSP rules are related to its SM
policies.
For URSP Notifications where the associated URSP rule is not known by the UE-
PCF (e.g. possible in the case of a UE with pre-configured URSP rules), a
subscription based on the URSP Notification identifier can be realized.
Figure 6.31.2.4.1-1: Example flow for Storage of received notification on the
UDR linked to the triggered UE and notification to SM-PCF based on SM policy
Figure 6.31.2.4.1-2: Example flow for Storage of received notification on the
UDR linked to the triggered UE for URSP rule not known to UE-PCF and
notification to AF/NEF based on URSP notification ID
Impacts related to this example:
PCF:
\- UE-PCF: Add received URSP notification to UDR.
\- SM-PCF: Subscribe to UDR for URSP notifications related to a SM policy.
AF/NEF:
\- Subscribe to UDR for URSP notifications related to a given application ID
and/or notification ID.
UDR:
\- Storage of URSP notification data in UDR
\- Add link in UDR between the existing /policy-data/ues/{ueId}/am-data and
/policy-data/ues/{ueId}/sm-data so that a SM-PCF can subscribe to events
related to SM policies without having to refer to UE policy-related data
\- Map received URSP notification data to a SM policy
\- Probably add subscription procedure for insertion of URSP Notifications to
UE policy data for a given SM policy, URSP notification ID and/or application
ID. Current subs-to-notify information contained in PolicyDataSubscription is
geared towards changes in elements, not insertion of related elements
##### 6.31.2.4.2 Example action: Notification via Event exposure to other NFs
In this example, the PCF receiving the URSP Notification generates a
notification via Event exposure to other NFs (e.g. NWDAF for analytics,
anomaly detection, SM-PCF to steer policies applied to PDU sessions) or AF.
NOTE: It is assumed the subscriber (e.g. SM-PCF, AF, NEF) can locate the UE-
PCF, e.g. via the BSF and that UE-PCF and subscriber have connectivity.
Figure 6.31.2.4.2-1: Example flow for Notification via Event exposure to SM-
PCF based on URSP rule ID
Figure 6.31.2.4.2-1: Example flow for Notification via Event exposure to
AF/NEF based on URSP Notification ID
Impacts related to this example:
PCF:
\- UE-PCF: Addition of EventExposure to Npcf_UEPolicyControl to send received
URSP notification to subscribed NFs based on URSP rule identifier
\- SM-PCF: Subscribe to UE-PCF for URSP notifications related to a SM policy
rule
\- SM-PCF: Identify UE-PCF for a given UE
AF/NEF:
\- Subscribe to UDR for URSP notifications related to a given application ID
and/or notification ID
\- Identify UE-PCF for a given UE
UDR:
\- Add link in UDR between the existing /policy-data/ues/{ueId}/am-data and
/policy-data/ues/{ueId}/sm-data so that a SM-PCF can subscribe to events
related to SM policies without having to know UE policy-related data
##### 6.31.2.4.3 Example action: Notification of Application owner via NEF
Based on the examples shown in clauses 6.31.2.4.1 and 6.31.2.4.2, the
awareness of whether a UE enforces a URSP rule for specific application
traffic can be used to convey information to the application owner. While an
application owner can be aware whether its application is running, it may be
interested to know via notifications from the 5GC whether a URSP rule
associated with the application is active (e.g. as a relevant KPI part of an
SLA).
Figure 6.31.2.4.2-1: Example flow for Notification of Application owner via
NEF
Impacts related to this example additionally to those in clauses 6.31.2.4.1 or
6.31.2.4.2:
NEF:
\- Subscription from application owner to URSP usage by a given application or
URSP notification ID (e.g. for pre-configured URSP rules), subscription to UDR
or UE-PCF to URSP notifications related to a given application
PCF or UDR:
\- Allow subscription to URSP notifications related to a given Application ID
### 6.31.3 Impacts on Existing Nodes and Functionality
UE:
\- Support for additional URSP Notification Component in received UE policy
container via UE Configuration Update.
\- Support for acceptance/rejection of URSP rules containing URSP Notification
component(s) based on URSP security/privacy.
\- Support for triggering of URSP notifications sent via UL NAS TRANSPORT and
a new UE Policy Container of type URSP Notification.
AMF:
\- Forward URSP rule notifications to PCF received via UL NAS TRANSPORT.
PCF:
\- Support for URSP rule notifications forwarded from AMF via
Namf_Communication_N1MessageNotify.
NOTE: Impacts regarding the different examples of PCF actions on receiving
URSP notifications are not necessary to realize the solution and are
informatively included in each corresponding example clause.
## 6.32 Solution #32: Application Detection using Domain Descriptor
### 6.32.1 Description
This solution addresses the following technical issues of the KI#2:
\- Whether and how the 5GC can be made aware whether or when the UE enforces a
URSP rule to route an application traffic to a PDU Session based on the URSP
rule provisioned by 5GC.
This solution provides a part of solution to address the above key issue only
for the case where the Domain Descriptor is used in the URSP rule. This
solution can be used with other application detection solution.
Among various traffic descriptors are listed in URSP rules, the domain
descriptor is one of useful descriptors to identify the application traffic.
Today, UPF-based mechanism to detect the FQDN-based application traffic can be
used, however, it has the following limitations:
\- It may not work if DNS over TLS or DNS over HTTPS is used.
\- It may not guarantee the same IP address is resolved since the EAS IP
address may be different based on EDNS Client Subnet option is used. Since the
specifications do not specify how the UPF detect the domain name, based on the
UPF implementations, the different IP address for the same FQDN can be
resolved.
Therefore, the current mechanism is not enough to check whether the
application traffic from the UE is compliant with the URSP if the domain
traffic descriptor is used.
This solution provides a mechanism for the UE-PCF to detect application
traffic detection using domain descriptor to check whether the UE is compliant
with the traffic descriptor for the case when the EASDF is used for edge
computing. This solution assumes that the EASDF for edge computing is deployed
and SMF can be notified when the EASDF detects the DNS messages.
The UE-PCF is notified the PDU Session establishment of the target UE to be
checked for the URSP compliance. The UE-PCF subscribes SM-PCF for the
reporting of application traffic detection for FQDN based the flow descriptor.
The SM-PCF updates the PCC rules with FQDN-based flow descriptor for the SMF
to report if DNS message exchanges are detected or DNS resolved traffic
identified by the FQDN is detected.
Figure 6.32.1-1 shows an abstract operation of 5GC for DNS message detection
and reporting. The UE-PCF subscribes the application detection indicating DNS
message detection and reporting with FQDN to the SM-PCF. The SM-PCF updates
the PCC rules indicating the DNS message reporting with FQDN-based SDF
template.
In addition to the existing IP-based or Ethernet-based service data flow
filters and in a PCC rule or an application identifier, it is proposed to
define additional service data flow filter which identifies a FQDN or FQDN
range with regular expression. In this solution, it is also called as a FQDN-
based SDF template.
The SMF updates DNS message handling rule with EASDF. When the UE, EASDF and
the DNS server exchanges the DNS message, the EASDF detects and reports the
DNS message to the SMF. The SMF notifies the detected application information
to the SM-PCF. SM-PCF forwards the information to the UE-PCF.
Figure 6.32.1-1. FQDN based Application Detection (DNS message detection and
reporting)
The Figure 6.32.1-1 shows an abstract operation of 5GC for DNS resolved
traffic detection and reporting. The UE-PCF subscribes the application
detection indicating DNS resolved traffic detection and reporting with FQDN to
the SM-PCF. The SM-PCF updates the PCC rules indicating the DNS resolved
traffic detection and reporting with FQDN-based SDF template. The SMF updates
DNS message handling rule with EASDF. When the UE, EASDF and the DNS server
exchanges the DNS message, the EASDF detects and reports the DNS message to
the SMF. The SMF updates N4 rule (e.g. PDU and URR) to the UPF. When the UPF
detects the application traffic, it notifies the SMF of the detected traffic.
The SMF notifies the detected application information to the SM-PCF. SM-PCF
forwards the information to the UE-PCF.
Figure 6.32.1-2. FQDN based Application Detection (DNS resolved traffic
detection and reporting)
### 6.32.2 Procedures
#### 6.32.2.1 Procedure of application detection for domain (e.g. FQDN)
traffic descriptor
This procedure describes the FQDN-based application detection
Figure 6.32.2-1: FQDN-based Application Detection
1\. UE-PCF subscribes the reporting of application detection to the SM-PCF.
The message includes the FQDN-based SDF template to identify the application
traffic matching the domain descriptor of the target UE. The subscription
request may also request either DNS reporting indication or DNS resolved
traffic detection if FQDN-based service data flow template is used.
2\. SM-PCF updates the PCC rules with FQDN-based SDF template for the SMF to
report the detected application. The FQDN-based SDF template can represent one
or more FQDN such as abc.asp1.com, abcd.asp1.com or FQDN range in regular
expression such as *.asp1.com. The PCC rules indicates either 1) DNS message
reporting or 2) DNS resolved traffic detection.
3\. The SMF generates DNS message handling rules using FQDN-based SDF
template.
4\. The SMF sends the DNS message handling rule for the EASDF to report the
DNS message when the EASDF detects the DNS messages.
5-7. The UE exchanges the DNS Query and DNS Response with the DNS server via
EASDF.
8\. When detecting the DNS Response, the EASDF notifies the FQDN and resolved
address for the FQDN to the SMF.
9\. If the PCC rules indicates DNS resolved traffic detection, the SMF
generates the corresponding N4 rules, e.g. PDR and URR in order for the UPF to
report the traffic identified by IP address.
10-11. The SMF updates the N4 rules to the UPF.
12\. If the PCC rule indicates DNS message reporting and the SMF is notified
DNS message detection from the EASDF, the SMF notifies the detected FQDN and
its IP address to the SM-PCF.
13\. The SM-PCF notifies the notification address of the UE-PCF of the DNS
message detection received from the SMF.
14\. The EASDF forwards the DNS Response message to the UE.
15\. After resolving the IP address of the application, the UE and the
application server exchanges the application traffic (e.g. TCP SYN or HTTP
transactions).
16\. The UPF detects the traffic matching PDR and reports it to the SMF.
17\. If the PCC rule indicates DNS resolved traffic detection and the SMF is
notified the packet detection associated with the FQDN-based template from the
UPF, the SMF notifies the DNS resolved traffic detection to the SM-PCF.
18\. The SM-PCF notifies the notification address of the UE-PCF of the DNS
resolved traffic detection received from the SMF.
### 6.32.3 Impacts on services, entities and interfaces
UE-PCF (The PCF for the UE):
\- The UE-PCF is able to utilize the SM-PCF service for FQDN-based application
detection.
SM-PCF (The PCF for the Session):
\- The SM-PCF is required to support the notification and PCC rules for FQDN-
based application detection.
\- The SM-PCF is required to understand the proposed FQDN-based service data
flow filter with DNS reporting indication and DNS resolved traffic detection
options.
SMF:
\- The SMF is required to support the PCC rules indicating FQDN-based
application detection identified FQDN-based SDF template.
\- The SMF is required to understand the proposed FQDN-based service data flow
filter with DNS reporting indication and DNS resolved traffic detection
options.
\- The SMF is required to generate and update the DNS message handling rule
using FQDN-based service data flow template.
\- The SMF is required to report the DNS message reporting to the SM-PCF if
the DNS reporting option is indicated in the PCC rules.
\- The SMF is required to update N4 rules with the UPF based on the reporting
from the EASDF and report the DNS resolved traffic detection to the SM-PCF if
DNS resolved traffic detection option is indicated in the PCC rules.
## 6.33 Solution #33: **Consistent URSP Provisioning across 5GS and EPS**
### 6.33.1 Description
This solution addresses KI#3.
With regard to the scenarios and gaps (first two bullets in the KI#3), if a UE
has used the Route Selection component (e.g. DNN) in a URSP rule in EPS and
the Route Selection component (e.g. DNN) has been changed when the UE stays in
EPS, the updated URSP rule needs to be provisioned to UE in EPS, otherwise the
UE in EPS may use outdated DNN to establish PDN connection in EPS. In 5GS the
UE may be provisioned with URSP rules for both 5GS and EPS by the PCF of the
HPLMN. Only the rules provisioned by the PCF are used by the UE, if both URSP
rules provisioned by the PCF and pre-configured URSP rules are present. The
URSP rules are provisioned in UE using NAS messages. The AMF transparently
transfers the UE Policy container (UE policy information) received from the
PCF to the UE (using DL NAS TRANSPORT message). The UE Policy container
includes the list of Policy Sections as described in TS 23.503 [4]. Similar
mechanism can be used to provision URSP rules in EPS.
For the pre-Rel-18 UE, when it\'s attached to EPC, even if the UE-PCF
provisions/updates the URSP rule to it, it will silently discard the URSP rule
in the ePCO since the new ePCO cannot be recognized by the pre-Rel-18 UE. In
order to avoid unnecessary signalling overload for URSP provisioning/updating
for pre-Rel-18 UE,UE-PCF needs to be aware whether a UE supports the URSP
Provisioning in EPS or not.
To realize provisioning of consistent URSP rules in UE, this solution follows
the below two principles:
1) The same set of URSP is provisioned to UE regardless of UE attaching to EPS
or registering to 5GS.
2) The UE in EPS uses the components in RSD of a URSP rule according to Rel-16
specification defined in clause 5.17.1.2 of TS 23.501 [2].
The EPS and 5GS interworking architecture defined in TS 23.501 [2] is reused,
the solution addresses both the collocated and separate SM-PCF and UE-PCF
deployment scenario, N7 interface is reused to provision URSP from SM-PCF to
SMF+PGW-C and no new interface is introduced. The solution proposes a
mechanism for the network to provision and update the URSP for a UE in EPS by
encapsulating UE Policy Container in ePCO via one of the PDN connections. The
UE Policy Container is transparently forwarded via SMF+PGW-C. The
communication between SMF+PGW-C and SM-PCF reuses the SM Policy Association
procedures.
#### 6.33.1.1 Use Cases and Scenarios
When a UE attaches initially in EPC or when the UE handovers from 5GC to EPC,
UE-PCF may need to update the URSPs in the UE:
\- During Initial attach procedure in EPS due to for example:
\- New AF guidance on URSP request applicable to the UE was sent by an AF
while the UE is deregistered and prior to the EPC attach procedure, so the
corresponding URSP rules were not delivered yet to the UE.
\- Operator policies configured with time, location or any other condition are
met when the UE attaches to EPC, implying new or updated URSP rules apply
under those conditions.
\- Operator policies for determining URSPs were updated by the operator while
the UE is deregistered and prior to the EPC attach procedure, so the
corresponding URSP rules were not delivered yet to the UE.
\- At any time a URSP is changed while the UE is registered in EPC (coming
from EPC initial attachment or after handover from 5GC) due to for example:
\- New AF guidance on URSP request applicable to the UE is sent by an AF.
\- Due to time, location change or other network condition the PCF determines
that an operator policy configured for the operator for URSP determination
applies in the new network conditions, implying new or updated URSP rules
apply to the UE.
#### 6.33.1.2 Provision URSP to a UE in EPC
The solution in this paper proposes a mechanism that allows the network to
update the URSPs for a UE in EPC, by encapsulating UPDP messages into a new
ePCO parameter (from now on UE Policy Container ePCO) and transfer them to the
UE via PDN connection.
The solution assumes the same protocol (UPDP protocol) for URSP Provisioning
between the PCF and the UE than in 5GC, although the final decision on this is
up to stage 3.
The mechanism reuses the existing capability of the EPC network for sending
ePCO from the UE to the SMF+PGW-C (and vice versa) and in addition it proposes
a way to transport the UE Policy Container from the SMF+PGW-C to the PCF (and
vice versa) based on reusing existing PDU session procedures.
For the delivery of URSPs to UEs in EPC, this solution assumes the standard
solution for interworking architecture between EPC and 5GC as described in TS
23.501 [2].
When the PCF needs to send a UE Policy update towards the UE in EPC, it
invokes a SM Policy Association Modification including the corresponding UPDP
message into a new IE (UE Policy Container) in the N7 interface. When the
SMF+PGW-C receives this new IE the SMF+PGW-C encapsulates it into UE Policy
Container ePCO and transfers them to the UE by using existing procedure of PDN
GW initiated bearer modification without bearer QoS update as defined in
clause 5.4.3 of TS 23.401 [8].
When the UE in EPC needs to send a UPDP message towards the UE-PCF in relation
to UE Policy handling the UE first encapsulates the UPDP message into a UE
Policy Container ePCO and then transfers it towards the SMF+PGW-C by reusing
existing mechanisms. When the SMF+PGW-C receives such UE Policy Container ePCO
from the UE, just forwards transparently the UE Policy Container towards the
PCF by reusing SMF initiated SM Policy Association procedure (establishment or
modification).
The solution also proposes that the UE has to be able to handle the reception
of such UPDP messages received over EPC NAS signalling in a similar way than
when received over 5GC NAS signalling in 5GC.
In addition, for those events happening in PCF which may trigger the sending
of a URSP update for a UE (as described in clause 6.33.1.1), the PCF will
check if the UE is currently in EPC, and if so will use one of these PDU
sessions to trigger the delivery of the URSP updates, by invoking PCF
initiated SM Policy Association modification procedure including the proper UE
Policy Container.
#### 6.33.1.3 Handle the UE Policy Association during mobility from 5GS to EPS
with N26
During initial Registration procedure, the UE needs to indicate its URSP
Provisioning Support Indication in EPS in the 5GMM Capability to AMF.
If the AMF knows that the UE supports URSP Provisioning in EPS and target EPC
supports URSP provisioning to UE, the AMF doesn\'t terminate the UE Policy
Association with UE-PCF and sends the UE Policy Association information for
EPS (i.e. URSP Provisioning Support Indication in EPS, UE-PCF ID in 5GS,
PCRTs) to MME during mobility (i.e. Handover, Idle mode mobility) from 5GS to
EPS with N26.
The PCRTs (Policy Control Request Trigger) for UE Policy include Location
change (tracking area), Change of UE presence in Presence Reporting Area,
Connectivity stage changes. The MME enforces the received PCRTs for UE Policy.
When the MME receives the URSP Provisioning Support Indication in EPS, it
creates a UE Policy Container for the UE including only the indication of MME
Created UE Policy Container for 5GS to EPS Mobility and selects one of the PDN
Connections serving the UE to establish the UE Policy association between SM-
PCF and UE-PCF. The UE Policy Container and UE-PCF ID are included in the
Modify bearer Request message sent to SGW and SMF+PGW-C.
When the SMF receives the UE Policy Container, it initiates SM Policy
Association Modification procedure by sending Npcf_SMPolicyControl_Update
request to SM-PCF including UE-PCF ID and UE Policy Container.
Based on the received UE-PCF ID, the SM-PCF knows it\'s a request for updating
the UE Policy Association with UE-PCF identified by UE-PCF ID. The SM-PCF
sends a Npcf_UEPolicyControl_Update request including the UE Policy Container
to UE-PCF to modify the UE Policy Association for the UE.
Based on the indication of MME Created UE Policy Container, the UE-PCF knows
it\'s an MME initiated UE Policy Association update procedure after mobility
from 5GS to EPS and updates the UE Policy Association with SM-PCF. For any
subsequent URSP update, the UE-PCF contacts with SM-PCF.
The UE-PCF may notify the AMF of the removal of the UE Policy Association via
Npcf_UEPolicyControl_UpdateNotify service operation.
### 6.33.2 Procedures
#### 6.33.2.1 UE Policy provisioning procedure with explicit URSP Support
Indication in EPS
For all pre-Rel-18 UEs, it would be impossible to provision/update the URSP to
them since the new ePCO cannot be recognized by pre-Rel-18 UEs attached to
EPC. Provisioning/updating URSP to pre-Rel-18 UEs in EPC will cause
unnecessary signalling overload. Thus, the UE-PCF needs to be aware whether a
UE supports the URSP Provisioning in EPS or not.
For the cases that PDN Connectivity Request is sent by UE (i.e. Initial Attach
procedure, UE requested PDN connectivity procedure, 5GS to EPS Mobility
procedure without N26), the UE reports the UE Policy Container including URSP
Provisioning Support indication in EPS in ePCO.
Figure 6.33.2.1-1: UE Policy provisioning procedure with explicit URSP
Provisioning Support Indication in EPS
1\. The UE sends the UE Policy Container including URSP Provisioning Support
indication in EPS which is indicating whether a UE supports URSP Provisioning
or not in EPS (defined in clause 5.17.1.2 of TS 23.501 [2]) and the PSIs
(Policy Set Identifier) in ePCO (extended PCO) to SMF+PGW-C during Initial
Attach procedure (in the Attach Request) as described in clause 5.3.2.1 of TS
23.401 [8] or the UE requested PDN connectivity procedure (PDN Connectivity
Request) as described in clause 5.10.2 of TS 23.401 [8].
2\. The SMF+PGW-C transparently forwards the UE Policy Container in ePCO to
the SM-PCF as a new IE in the PDU Session Establishment
(Npcf_SMPolicyControl_Create Request).
NOTE 1: If the PCF involvement for a PDN connection is not required, the
SMF+PGW-C should still establish SM Policy Association with SM-PCF and forward
the UE Policy Container to SM-PCF based on local configuration.
3\. The SM-PCF establishes the UE Policy Association with UE-PCF when a UE
Policy Container is received from the UE and forwards the UE Policy Container
to UE-PCF in Npcf_UEPolicyControl_Create Request. When a UE Policy Container
is received at initial registration, the UE-PCF stores the URSP Provisioning
Support indication in EPS in the UDR using Nudr_DM_Create including DataSet
\"Policy Data\" and Data Subset \"UE context policy control data\".
NOTE 2: UE-PCF is discovered and selected according to clause 6.3.7.1 of TS
23.501 [2].
4\. The UE-PCF gets policy subscription related information and the updated
list of PSIs from the UDR. The UE-PCF creates the UE policy container
including UE policy information as defined in clause 6.6 of TS 23.503 [4].
Then it sends the latest UE policy information in the UE Policy Container to
SM-PCF in Npcf_UEPolicyControl_Create Response.
5\. The SM-PCF forwards the UE Policy Container to the SMF+PGW-C in
Npcf_SMPolicyControl_Create Response.
6\. The SMF+PGW-C sends the UE Policy Container in ePCO to UE in Activate
Default EPS Bearer Context message which may be encapsulated in Attach Accept
message.
7\. The UE sends a response to SMF+PGW-C by acknowledging the reception of the
UE Policy reusing existing messages (e.g. Attach Complete, Modify Bearer
Request) as defined in clause 5.3.2 of TS 23.401 [8].
8\. The SMF+PGW-C forwards the acknowledgement of UE reception of the UE
Policy to SM-PCF using Npcf_SMPolicyControl_Update request.
9\. The SM-PCF forwards the acknowledgement of UE reception of the UE Policy
to UE-PCF using Npcf_UEPolicyControl_Update request.
For the cases that PDN Connectivity Request is not sent by UE in EPS (i.e. 5GS
to EPS handover using N26 interface, 5GS to EPS Idle mode mobility using N26
interface), UE reported URSP Provisioning Support indication in EPS during 5GS
Registration procedure can be used by UE-PCF to determine whether to provision
URSP to UE in EPS. This requires the UE to include the URSP Provisioning
Support indication in EPS in the UE Policy Container in the initial
Registration Request message.
Figure 6.33.2.1-2: Initial Registration in 5GS
1\. In the Registration Request message, the UE reports the URSP Support
indication in EPS in the UE Policy Container to AMF.
In order to allow the AMF to be aware of UE's Capability of URSP Provisioning
Support in EPS, the UE needs to include the URSP Provisioning Support
indication in EPS in the 5GMM Capability in the Registration Request message.
This indication will be used by AMF to determine whether to terminate the UE
Policy Association for the UE and whether to send the UE Policy Association
information to MME during 5GS to EPS mobility with N26. The AMF stores the
URSP Provisioning Support indication in EPS as part of the MM Context.
2\. AMF establishes UE Policy Association with UE-PCF and forwards the UE
Policy Container to UE-PCF. The UE-PCF stores the URSP Provisioning Support
indication in EPS in the UDR using Nudr_DM_Create including DataSet \"Policy
Data\" and Data Subset \"UE context policy control data\".
3\. The UE Configuration Update procedure for transparent UE Policy delivery
as defined in clause 4.2.4.3 of TS 23.502 [3].
#### 6.33.2.2 PCF triggered UE Policy provisioning procedure
For the procedure for URSP update initiated by the PCF when the UE is in EPC,
the procedure follows the steps described in the figure below:
Figure 6.33.2.2-1: PCF triggered URSP provisioning procedure
1: An event as described in clause 6.33.1.1 happens in UE-PCF. The UE-PCF
triggers the re-evaluation of applicable URSPs for the UE and determines an
update of URSP is needed for the UE.
2: The UE-PCF generates the URSP and send it to SM-PCF in the UE Policy
Container via Npcf_UEPolicyControl_UpdateNotify Request.
NOTE 1: It is assumed the UE Policy Association has been established and is
maintained between the SM-PCF and UE-PCF after initial attach or 5GS to EPS
mobility.
3: The UE Policy Container is then provided to the SMF+PGW-C by invoking
Npcf_SMPolicyControl_UpdateNotify request.
NOTE 2: It is assumed the SM Policy Association has been established and is
maintained between SMF and SM-PCF after initial attach or 5GS to EPS mobility.
4, 5, 6: The SMF+PGW-C initiates a bearer modification procedure without
bearer QoS update (as defined in clause 5.4.3 of TS 23.401 [8]) to provide the
UE Policy Container in ePCO towards the UE.
7: When the UE gets the UE Policy Container in ePCO, the UE processes that
message in a similar way as it is received in 5GC, i.e. stores the URSP
updates, optionally re-evaluates the mapping of applications into PDN
connections according to the mapping of URSP values into EPC, and
achknowledges the delivery result in UE Policy Container to the MME.
8, 9: These steps follow the existing procedure defined for Update Bearer
Response.
10: Upon reception of UE Policy Container in ePCO in Update Bearer Response,
the SMF+PGW-C then invokes Npcf_SMPolicyControl_Update Request including the
content of the UE Policy Container in ePCO.
11: The SM-PCF forwards the UE Policy Container to UE-PCF via
Npcf_UEPolicyControl_Update request.
#### 6.33.2.3 5GS to EPS Handover using N26 interface
Figure 6.33.2.3-1: 5GS to EPS handover for single-registration mode with N26
interface defined in clause 4.11.1.2.1 of TS 23.502 [3]
In the Relocation Request message of step 3, the AMF includes the UE Policy
Association information (i.e. URSP Provisioning Support Indication in EPS, UE-
PCF ID selected in 5GS, PCRTs). MME stores this information.
NOTE: The PCRTs (Policy Control Request Trigger) include Location change
(tracking area), Change of UE presence in Presence Reporting Area,
Connectivity state changes.
In step 13 and 14a, MME selects one of the PDN Connections serving the UE to
establish the UE Policy association between SM-PCF and UE-PCF. The MME creates
and includes a UE Policy Container for UE including only the indication of MME
Created UE Policy Container for 5GS to EPS Mobility in the Modify bearer
Request. UE-PCF ID is also included in Modify bearer Request message.
#### 6.33.2.4 5GS to EPS Idle mode mobility using N26 interface
Figure 6.33.2.4-1: 5GS to EPS Idle mode mobility using N26 interface defined
in clause 4.11.1.3.2 of 23.502 [3]
In the Context Ack message of step 8, the AMF includes the UE Policy
Association information (i.e. URSP Provisioning Support Indication in EPS, UE-
PCF ID selected in 5GS, PCRTs for UE Policy). MME stores the UE Policy
Association information.
In step 9 and 10, MME selects one of the PDN Connections serving the UE to
establish the UE Policy association between SM-PCF and UE-PCF. The MME creates
and includes a UE Policy Container for UE including only the indication of MME
Created UE Policy Container for 5GS to EPS Mobility in the Modify bearer
Request. UE-PCF ID is also included in Modify bearer Request message.
#### 6.33.2.5 SM Policy and UE Policy Association Update after 5GS to EPS
mobility using N26 interface
Figure 6.33.2.5-1: SM Policy and UE Policy Association update after 5GS to EPS
mobility
1\. When the SMF receives the UE Policy Container or URSP Provisioning Support
Indication in EPS, it initiates SM Policy Association Modification procedure
by sending Npcf_SMPolicyControl_Update request to SM-PCF including UE-PCF ID,
the UE Policy Container.
2\. Based on the UE-PCF ID, the SM-PCF knows it\'s a request for establishing
UE Policy Association with UE-PCF. The SM-PCF sends a
Npcf_UEPolicyControl_Update request to UE-PCF including the UE Policy
Container to modify the UE Policy Association for the UE.
3\. From the Indication of MME Created UE Policy Container, the UE-PCF knows
it\'s an MME initiated UE Policy Association update procedure after mobility
from 5GS to EPS and updates the UE Policy Association with SM-PCF. For any
subsequent URSP update, the UE-PCF contacts with SM-PCF. The UE-PCF responds
to SM-PCF with Npcf_UEPolicyControl_Update Response.
4\. The SM-PCF responds to SMF with Npcf_SMPolicyControl_Update Response.
#### 6.33.2.6 UE Policy Association handling after EPS to 5GS mobility
When the UE moves from EPS to 5GS, UE Policy Association Establishment
procedure will be initiated. When UE-PCF detects that a UE Policy Association
for the UE exists in EPS, the UE-PCF will initiate the UE Policy Association
Termination procedure to terminate the UE Policy Association in EPS.
### 6.33.3 Impacts on services, entities and interfaces
N7: Introduce additional IE for the transfer of UE Policy Container between
SMF+PGW-C and SM-PCF.
NAS, S11, S5/S8: Introduce new parameter UE Policy Container in ePCO.
Impact on SM-PCF:
\- Handling of UE Policy Container within SM Policy Association and UE Policy
Association procedures.
\- For those cases where PCF initiates the sending of URSP update for a UE in
EPC, the triggering of SM Policy Association modification including the new IE
with MANAGE UE POLICY COMMAND UPDP message.
Impact on UE-PCF:
\- Handing the URSP Provisioning Support indication in EPS and stores it into
UDR.
\- Based on the URSP Provisioning Support indication in EPS, determines
whether to provision UE with URSP when the UE is in EPS.
\- For those cases where PCF initiates the sending of URSP update for a UE in
EPC, the triggering of UE Policy Association modification with SM-PCF.
Impact on SMF+PGW-C:
\- Upon reception of UE Policy Container ePCO in Create Session Request, the
SMF+PGW-C forwards the UE Policy Container to the PCF at SM Policy Association
establishment. Use the reception of UPDP Container as an additional reason to
establish the SM Policy Association, even in case the network configuration
for the APN of the PDN connection does not require PCF involvement.
\- Upon reception of UE Policy Container from SM-PCF during SM Policy
Association initiated by UE-PCF, SMF+PGW-C performs a Bearer Modification
Procedure without bearer QoS update including the UE Policy Container ePCO.
\- Upon reception of Update Bearer Response from MME including UE Policy
Container ePCO, the SMF+PGW-C forwards the received UE Policy Container to
PCF.
Impact on UE:
\- During initial attach in EPS, the UE includes UE STATE INDICATION UPDP
message into UE Policy Container ePCO in PDN Connectivity Request encapsulated
in Attach Request.
\- The UE receives MANAGE UE POLICY COMMAND in UE Policy Container ePCO during
EPS Bearer Context Request and process it as in 5GC. The UE generates MANAGE
UE POLICY COMPLETE UPDP message and send it to the MME encapsulated into a UE
Policy Container ePCOin EPS Bearer Context Response.
\- The UE also needs to include the URSP Provisioning Support indication in
EPS in the UE Policy Container.
\- During initial Registration in 5GS, the UE includes the URSP Provisioning
Support indication in EPS in both 5GMM Capability and the UE Policy Container.
Impact on AMF:
\- Receives and stores the URSP Provisioning Support indication in EPS as part
of the MM Context;
\- Sends the UE Policy Association information to MME.
Impact on MME:
\- Receives and stores the UE Policy Association information (i.e. URSP
Provisioning Support Indication in EPS, UE-PCF ID selected in 5GS, PCRTs for
UE Policy) from AMF;
\- Creates a UE Policy Container for UE including only the indication of MME
Created UE Policy Container for 5GS to EPS Mobility.
\- Includes the UE Policy Container and UE-PCF ID in Modify bearer Request
message sent to SMF.
## 6.34 Solution #34: Provisioning UE policy in EPS via N3IWF
### 6.34.1 Description
This solution addresses the Key Issue#3 \'Provision consistent URSP to UE
across 5GS and EPS\'.
When the UE is in EPS, the UE may use the route selection component (e.g. DNN)
in a URSP rule to derive EPS parameters for PDN connection. Note that:
a) If UE keeps connectivity with 5GS, then the UE Policy can be updated via
5GS; and
b) If UE does not need to use URSP in EPS, there is no need for UE to update
the policy.
Thus, the UE updates UE policy in EPS only when it is going to use URSP to
derive EPS parameters.
A solution (i.e. access 5GS via N3IWF) is proposed in this paper, which
follows the two principles:
a) minimize the impact on network and UE, reuse the existing mechanism only if
the non-3GPP access is supported; and
b) no restriction for whether UE has registered in 5GS or not.
Given that if UE has not registered to 5GS, then the UE does not have any
serving NF (e.g. AMF, UDM). In this case, if the 5GS wants to updates UE
policy for UE in EPS, 5GS needs to temporarily establish 5G connections for UE
to update UE policies. On the other hand, if there is no 5GS access, in order
to support deliver the URSP rules to the UE in EPS, it has a huge impact to
the current design of 5GS.
Besides, even if the UE has registered in 5GS, whether AMF or UE-PCF would
keep the UE context is not ensured. The AMF can implicitly detach the UE upon
reachability time-out.
The registration via untrusted non-3GPP access as described in clause 4.12.2.2
of TS 23.502 [3] and procedure for UE Policy Association Establishment or
Modification procedure as described in clauses 4.16.11 or 4.16.12 of TS 23.502
[3] is reused for provisioning UE policy to UE via N3IWF. No extra new
signalling or interface is required in this solution.
This solution relies on the scenario that the operator deploys the N3IWF and
the UE can register to N3IWF via non-3GPP access.
Editor\'s note: It is FFS on how to update the URSP from AM-PCF to UE in case
the UE has URSP and doesn\'t register to 5GS via N3WIF.
### 6.34.2 Procedures
Figure 6.34.2-1: UE Policy delivery procedure initiated by the UE in EPS
The detailed steps of the procedure are defined below:
1: The UE needs to use URSP in EPS to derive EPS parameters. This may happen
when UE is performing an initial attach procedure as described in clause
5.3.2.1 of TS 23.401 [8], interworking procedures from 5GS to EPS as described
in clause 4.11 of TS 23.502 [3], or when UE is going to use URSP to derive EPS
parameters (e.g. when UE performs the requested PDN connectivity) or when UE
is expected to receive the updated URSP rules.
The UE shall indicate its N1 mode capability, and provides a native 4G-GUTI or
a 4G-GUTI mapped from 5G GUTI (indicated as native GUTI), if available,
otherwise the IMSI in Attach Request message in its initial attach procedure.
The HSS selects one of the SMF+PGW-C FQDN for one APN based on operator\'s
policy. The MME may indicate HSS to select a SMF+PGW-C FQDN based on the UE
identity (e.g. a 4G-GUTI mapped from 5G GUTI).
2: SMF+PGW-C may send N3IWF selection info to the UE in ePCO during step 1 in
using existing messages (e.g. Activate Default EPS Bearer Context message,
DOWNLINK NAS TRANSPORT message). The N3IWF selection info contains the
following info:
1) N3IWF identifier configuration (either FQDN or IP address); and
2) Access node selection information consists of a prioritized list of PLMNs
for N3IWF selection and an indication that the selection of an N3IWF in a PLMN
should be based on Tracking Area Identity FQDN or on Operator Identifier FQDN.
3: When the default PDN connection is established, the UE performs
Registration via untrusted non-3GPP access as described in clause 4.12.2.2 of
TS 23.502 [3]. If PCF determines to update UE policy, it will trigger a UE
Policy Association Establishment procedure as described in clause 4.16.11 of
TS 23.502 [3] during step 3.
4: Any time PCF needs to update the UE policy, it triggers a UE Policy
Association Modification as described in clause 4.16.12 of TS 23.502 [3] via
N3IWF.
### 6.34.3 Impacts on services, entities and interfaces
UE:
\- receive the N3IWF selection info via ePCO.
\- UE needs to simultaneously register to 5GS via non-3GPP access through
N3IWF and attach to EPS.
SMF+PGW-C:
\- send the N3IWF selection info via ePCO.
MME:
\- indicate UDM to select a collocated SMF+PGW-C node.
## 6.35 Solution #35: Support standardized and operator-specific traffic
categories using existing URSP traffic descriptors
### 6.35.1 Description
3GPP CT1 has agreed operator specific values for the Connection Capabilities
traffic descriptor, with a specific meaning and association to slices only
within the MNO domain.
At the same time, the LS received from GSMA, S2-220365, indicates that the
traffic categories agreed are accommodating connectivity requirements that are
shared by different applications traffic, being those categories the
following:
\- IMS traffic.
\- Internet.
\- IoT and machine to machine type of traffic.
\- On demand downlink streaming.
\- On demand uplink streaming.
\- Vehicular communications.
\- Real time interactive traffic.
\- Unified communications traffic.
\- Background traffic.
\- Location-based traffic.
\- Critical Communications.
This solution makes use of Connection Capabilities traffic descriptor to
support the list of GSMA agreed categories, so that both standard and operator
specific categories are dealt with in the same descriptor.
Although encoding of the Connection Capabilities is a stage 3 decision, the
following is an example how to code it:
Bits
8 7 6 5 4 3 2 1
0 0 0 0 0 0 0 1 IMS
0 0 0 0 0 0 1 0 MMS
0 0 0 0 0 0 1 1 SUPL
0 0 0 0 0 1 0 0 Internet
0 0 0 0 0 1 0 1 IoT and M2M traffic
0 0 0 0 0 1 1 0 On demand downlink streaming
0 0 0 0 0 1 1 1 On demand uplink streaming
0 0 0 0 1 0 0 0 Vehicular communications
0 0 0 0 1 0 0 1 Real time interactive traffic
0 0 0 0 1 0 1 0 Unified communications traffic
0 0 0 0 1 0 1 1 Background traffic
0 0 0 0 1 1 0 0 Location-based traffic
0 0 0 0 1 1 0 1 Critical communications
0 0 0 0 1 1 1 0
To Available for further standard capabilities
0 0 0 1 1 1 1 1
0 0 1 0 0 0 0 0
To Operator specific connection capabilities
0 0 1 1 1 1 1 1
1 0 0 0 0 0 0 0
To Spare values
1 1 1 1 1 1 1 1
An application can indicate it belonging to a specific category in its
request, or for some application implementations the OS may know the
application category without explicit signalling from the application. The
URSP layer then matches this with the Connection Capability Traffic Descriptor
of the URSP rule.
A single application may indicate different categories in different requests,
for example, an application may indicate real time interactive traffic for a
gaming session while it may indicate an operator specific capability for a
different session.
Any URSP rule can contain a Connection Capabilities TD (to be matched with the
traffic category) together with any other descriptor; e.g. it may include an
AppID in addition to the category, or a DNN and a category, or any other
descriptor together with the category. The UE shall then need to match all the
Traffic Descriptors of the URSP rule.
A given traffic category can be simultaneously used by multiple applications.
### 6.35.2 Procedures
When an application attempts to initiate a session, it may indicate it belongs
to a specific traffic category. The traffic category requested by an
application may be either a traffic category as agreed by GSMA or a value that
is specified by the MNO.
The URSP layer then uses the application indication of a traffic category,
either as the only indication, or accompanied by other information like AppID,
DNN, etc, depending on the URSP rules.
NOTE 1: A traffic category for an application can be accompanied by other
indication in scenarios where the operator has agreements with the Application
Service Providers to generate the URSP.
NOTE 2: The use of traffic categories does not preclude that other traffic
descriptors are used alone to be matched with a given URSP rule.
The URSP layer shall then scan the URSP rules configured by the MNO to find
the matching rule containing the Connection Capabilities traffic descriptor
matching the traffic category indicated by the application/OS layer. If the
URSP rules contain a Connection Capability Traffic Descriptor together with
another descriptor, the URSP layer shall then need to find the matching rule
containing a traffic descriptor listing the same components.
Operator-specific traffic categories can be supported by defining MNO specific
values within the Connection Capabilities Traffic Descriptor. It is assumed
that the application and/or OS layer in the UE supports providing MNO specific
traffic categories to the URSP layer. The type of MNO traffic category is
transparent to the OS layer
### 6.35.3 Impacts on services, entities and interfaces
The solution has the following impacts:
PCF:
\- PCF shall support the new values for the Connection Capabilities traffic
descriptor in the URSP rules.
UE:
\- UE shall support indications of traffic category from the application and
match it with the Connection Capabilities component in the Traffic Descriptor
provided as part of the URSP rule.
## 6.X Solution #X: \
### 6.X.1 Description
Editor\'s note: This clause will describe the solution principles and
architecture assumptions for corresponding key issue(s) which should be
explicitly stated. (Sub) clause(s) may be added to capture details.
### 6.X.2 Procedures
Editor\'s note: This clause describes high-level procedures and information
flows for the solution.
### 6.X.3 Impacts on services, entities and interfaces
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
# 7 Overall Evaluation
Editor\'s note: This clause will provide evaluation of different solutions.
## 7.1 Evaluation of solutions to KI#1
The KI description listed the following issues to be resolved:
\- Whether and how to support URSP enhancements to support routing of the
application traffic with different URSP rules in different PLMNs.
\- Whether the HPLMN needs any information from the VPLMN to generate URSP
Rules in roaming. If so, which information and how to provide it.
\- How to provide URSP Rules in roaming to the UE. How the HPLMN and VPLMN are
involved in such procedure.
### 7.1.1 How to identify PLMN specific URSP Rules
This is related to the following description in KI#1: \"Whether and how to
support URSP enhancements to support routing of the application traffic with
different URSP rules in different PLMNs.\"
There are different solutions:
a) The RSD is extended to include the PLMN ID(s) as validation criteria, a
URSP Rule can contain RSD for different PLMN ID(s). (Solution#2, #4 and #29).
b) The Traffic Descriptor in the URSP Rule is extended to include the PLMN
ID.(Solution#3).
c) The PCF provides a list of PSIs associated to the HPLMN and a list of PSIs
associated to each of the VPLMN with roaming agreements. (Solution#6).
d) No extensions to the RSD or URSP rule. The PCF provides the URSP Rules and
RSD components that are applicable in the VPLMN where the UE is registered and
removes them when the UE deregisters. (Solution#1, #2, #3 and 5).
Table 7.1-1: Evaluation of solutions on how to identify VPLMN specific URSP
Rules evaluates solutions listing the benefits and drawback, any open issue
that makes the solution complete and the system impact.
Table 7.1-1: Evaluation of solutions on how to identify VPLMN specific URSP
Rules
+----------+----------+----------+----------+----------+----------+ | What is | How it | Benefit, | System | Open | R | | the | is | drawback | impact | issues | eference | | problem | solved | | | | | | to | | | | | | | solve? | | | | | | +==========+==========+==========+==========+==========+==========+ | KI#1 - | The URSP | Benefit: | Impacts | How the | Sol#6 | | Whether | rules | | the | PLMN IDs | option 1 | | and how | are | Minimum | H-PCF | are | | | to | provided | pr | and | s | | | support | with its | ocessing | V-PCF | ignalled | | | URSP | as | in the | and the | with the | | | enha | sociated | UE to | UE. | Policy | | | ncements | PLMN | find the | | Sections | | | to | ID(s). | URSP | | is not | | | support | | Rules | | resolved | | | routing | The UE | as | | yet. | | | of the | c | sociated | | | | | app | onsiders | to a | | | | | lication | URSP | PLMN. | | | | | traffic | rules | | | | | | with | as | D | | | | | d | sociated | rawback: | | | | | ifferent | to the | | | | | | URSP | PLMN | | | | | | rules in | where | | | | | | d | the UE | | | | | | ifferent | is | | | | | | PLMNs. | re | | | | | | | gistered | | | | | +----------+----------+----------+----------+----------+----------+ | | The PCF | Benefit: | Based on | None | Sol#1 | | | provides | | the | | ,#3_Op | | | the list | PCF | existing | | tion2,5, | | | PSIs | internal | Release | | 6 option | | | that | logic | 17 | | 2 | | | apply in | only. | pr | | | | | the PLMN | | ocedures | | | | | where | UE does | to | | | | | the UE | not need | p | | | | | is | to store | rovision | | | | | reg | the | UE | | | | | istered. | complete | p | | | | | | list of | olicies. | | | | | | URSP | | | | | | | Rules | UE may | | | | | | for any | need to | | | | | | VPLMN, | remove | | | | | | reducing | all URSP | | | | | | storage. | rules | | | | | | | when it | | | | | | D | r | | | | | | rawback: | egisters | | | | | | si | to a new | | | | | | gnalling | PLMN | | | | | | i | except | | | | | | ncreases | an | | | | | | when the | eq | | | | | | UE moves | uivalent | | | | | | between | PLMN. | | | | | | PLMNs, | | | | | | | the PCF | | | | | | | needs to | | | | | | | remove | | | | | | | the list | | | | | | | of PLMN | | | | | | | specific | | | | | | | URSP | | | | | | | rules | | | | | | | and | | | | | | | sends | | | | | | | URSP | | | | | | | rules | | | | | | | for | | | | | | | another | | | | | | | PLMN | | | | | | | even | | | | | | | some or | | | | | | | most of | | | | | | | the | | | | | | | rules | | | | | | | are the | | | | | | | same. | | | | | | | | | | | | | | UE may | | | | | | | not have | | | | | | | the | | | | | | | a | | | | | | | vailable | | | | | | | URSP to | | | | | | | use if | | | | | | | the | | | | | | | H-PCF | | | | | | | does not | | | | | | | p | | | | | | | rovision | | | | | | | the URSP | | | | | | | to UE | | | | | | | timely | | | | +----------+----------+----------+----------+----------+----------+ | | The RSD | Benefit: | Impacts | None | Sol#2, | | | is | it | both the | | #4 and | | | extended | follows | PCF and | | #29 | | | to | the | the UE. | | | | | include | existing | | | | | | the PLMN | m | Adds the | | | | | ID(s) as | echanism | validity | | | | | va | to | co | | | | | lidation | provide | nditions | | | | | c | va | per RSD | | | | | riteria. | lidation | except | | | | | | criteria | HPLMN | | | | | The UE | per RSD | specific | | | | | c | extends | RSD in a | | | | | onsiders | the | URSP | | | | | the RSD | validity | Rule. | | | | | if the | co | | | | | | PLMN | nditions | | | | | | identity | with new | | | | | | of the | con | | | | | | validity | ditions. | | | | | | c | | | | | | | ondition | D | | | | | | matches | rawback: | | | | | | the PLMN | | | | | | | identity | | | | | | | of the | | | | | | | re | | | | | | | gistered | | | | | | | PLMN | | | | | +----------+----------+----------+----------+----------+----------+ | | The | Benefit: | Extends | None | Sol#3 | | | Traffic | Reduces | the | | _Option | | | De | pr | Traffic | | 1 | | | scriptor | ocessing | De | | | | | in the | at the | scriptor | | | | | URSP | UE to | in the | | | | | Rule is | d | URSP | | | | | extended | etermine | Rule. | | | | | to | the list | | | | | | include | of VPLMN | Extends | | | | | the PLMN | specific | the UE | | | | | ID | URSP | p | | | | | | Rules | rocedure | | | | | | compared | to | | | | | | with the | a | | | | | | ex | ssociate | | | | | | tensions | app | | | | | | of the | lication | | | | | | location | traffic | | | | | | criteria | to a PDU | | | | | | per RSC. | Session | | | | | | | using | | | | | | D | the | | | | | | rawback: | traffic | | | | | | Impacts | des | | | | | | the UE | criptor. | | | | | | p | | | | | | | rocedure | Impacts | | | | | | for | both the | | | | | | ass | PCF and | | | | | | ociating | the UE. | | | | | | appl | | | | | | | ications | | | | | | | to PDU | | | | | | | Sessions | | | | | | | based on | | | | | | | URSP, | | | | | | | the UE | | | | | | | cannot | | | | | | | a | | | | | | | ssociate | | | | | | | app | | | | | | | lication | | | | | | | traffic | | | | | | | to a | | | | | | | URSP | | | | | | | Rule | | | | | | | using | | | | | | | the PLMN | | | | | | | ID. | | | | +----------+----------+----------+----------+----------+----------+
### 7.1.2 Which PLMN determines the VPLMN specific URSP Rules
\- Whether the HPLMN needs any information from the VPLMN to generate URSP
Rules in roaming. If so, which information and how to provide it.
\- How to provide URSP Rules in roaming to the UE. In particular, how the
HPLMN and VPLMN are involved in such procedure.
This is related to the following description in KI#1: \"_How to provide URSP
Rules in roaming to the UE. In particular, how the HPLMN and VPLMN are
involved in such procedure_ \" and \"_Whether the HPLMN needs any information
from the VPLMN to generate URSP Rules in roaming. If so, which information and
how to provide it_ \".
Table 7.1-2: Evaluation of solutions on how to identify VPLMN specific URSP
Rules evaluates solutions listing the benefits and drawback, any open issue
that makes the solution complete and the system impact.
Table 7.1.2-1: Evaluation of solutions on which PLMN determines the VPLMN
specific URSP Rules
+----------+----------+----------+----------+----------+----------+ | What is | How it | Benefit, | System | Open | R | | the | is | drawback | impact | issues | eference | | problem | solved | | | | | | to | | | | | | | solve? | | | | | | +==========+==========+==========+==========+==========+==========+ | KI#1 - | An AF in | Benefit: | - UDM | | Sol.#1 | | Whether | the | | to | | ,#2,#6 | | the | VPLMN | D | include | | | | HPLMN | provides | rawback: | the DNN, | | | | needs | to the | | S-NSSAI | | | | any | HPLMN | | of the | | | | inf | how to | | VPLMN in | | | | ormation | route | | the list | | | | from the | the | | of | | | | VPLMN to | traffic | | Su | | | | generate | via e.g. | | bscribed | | | | URSP | DNN in | | S-NSSAIs | | | | Rules in | the | | and to | | | | roaming. | VPLMN | | allow | | | | If so, | | | the DNN, | | | | which | | | S-NSSAI | | | | inf | | | to work | | | | ormation | | | in LBO | | | | and how | | | mode in | | | | to | | | the user | | | | provide | | | subsc | | | | it. | | | ription. | | | | | | | | | | | | | | - | | | | | | | Ad | | | | | | | ditional | | | | | | | confi | | | | | | | guration | | | | | | | in the | | | | | | | HPLMN | | | | | | | that | | | | | | | needs to | | | | | | | define | | | | | | | DNN and | | | | | | | S-NSSAI | | | | | | | of | | | | | | | VPLMNs | | | | | | | in UDM | | | | | | | su | | | | | | | bscribed | | | | | | | values. | | | | | | | | | | | | | | - An | | | | | | | SLA | | | | | | | needs to | | | | | | | be | | | | | | | defined | | | | | | | for the | | | | | | | AF | | | | | | | outside | | | | | | | the MNO | | | | | | | to find | | | | | | | the | | | | | | | HPLMN of | | | | | | | a SUPI | | | | | | | roaming | | | | | | | in the | | | | | | | VPLMN. | | | +----------+----------+----------+----------+----------+----------+ | | The | Benefit: | Impacts | It is | Sol.#3 | | | V-PCF | VPLMN | the UE, | uns | | | | provides | can aid | V-PCF, | pecified | | | | the UE | inf | H-PCF | whether | | | | policy | ormation | and UDR. | the | | | | a | to the | | HPLMN | | | | ssistant | HPLMN | | sends | | | | inf | while | | VPLMN | | | | ormation | the | | specific | | | | (NOTE 1) | HPLMN | | URSP | | | | of VPLMN | still | | Rules to | | | | to the | decides | | the UE. | | | | H-PCF. | if the | | | | | | The | URSP | | It is | | | | H-PCF | Rule is | | not | | | | provides | to be | | defined | | | | URSP | pro | | how the | | | | Rules to | visioned | | UE | | | | the UE. | to the | | policy | | | | | UE. | | a | | | | | | | ssistant | | | | | D | | inf | | | | | rawback: | | ormation | | | | | | | is | | | | | | | stored | | | | | | | in UDR. | | +----------+----------+----------+----------+----------+----------+ | | The | Benefit: | Impacts | | Sol.#4 | | | V-PCF | VPLMN | V-PCF | | | | | g | can | and | | | | | enerates | decide | H-PCF. | | | | | URSP | which | | | | | | Rules | traffic | | | | | | that are | to route | | | | | | sent to | in its | | | | | | the | PLMN | | | | | | H-PCF | while | | | | | | for | the | | | | | | va | HPLMN | | | | | | lidation | can | | | | | | and | check | | | | | | distr | both the | | | | | | ibution. | roaming | | | | | | The URSP | ag | | | | | | rule | reements | | | | | | contains | and the | | | | | | S-NSSAI | su | | | | | | of the | bscribed | | | | | | HPLMN. | values | | | | | | | in the | | | | | | | RSD. | | | | | | | | | | | | | | D | | | | | | | rawback: | | | | | | | URSP | | | | | | | Rules | | | | | | | are for | | | | | | | the UE | | | | | | | to route | | | | | | | app | | | | | | | lication | | | | | | | traffic | | | | | | | then it | | | | | | | has no | | | | | | | sense to | | | | | | | send the | | | | | | | complete | | | | | | | URSP | | | | | | | rule to | | | | | | | the | | | | | | | HPLMN. | | | | +----------+----------+----------+----------+----------+----------+ | | The | Benefit: | Impacts | None. | Sol.#5 | | | V-PCF | VPLMN | UE, | | | | | provides | can | H-PCF, | | | | | service | decide | V-PCF. | | | | | inf | which | | | | | | ormation | traffic | | | | | | to the | to route | | | | | | H-PCF. | in its | | | | | | | PLMN | | | | | | The | while | | | | | | H-PCF | the | | | | | | provides | HPLMN | | | | | | URSP | can | | | | | | Rules | check | | | | | | with | both the | | | | | | VPLMN | roaming | | | | | | values | ag | | | | | | for the | reements | | | | | | DNN and | and the | | | | | | S-NSSAI | su | | | | | | | bscribed | | | | | | | values | | | | | | | in the | | | | | | | RSD. | | | | | | | | | | | | | | D | | | | | | | rawback: | | | | | | | - | | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | UE | | | | | | | as | | | | | | | sistance | | | | | | | inf | | | | | | | ormation | | | | | | | contains | | | | | | | the | | | | | | | mapping | | | | | | | from | | | | | | | traffic | | | | | | | de | | | | | | | scriptor | | | | | | | to DNN, | | | | | | | NSSAI, | | | | | | | SSC | | | | | | | mode, | | | | | | | PLMN ID, | | | | | | | etc. in | | | | | | | VPLMN. | | | | | | +----------+----------+----------+----------+----------+----------+
Table 7.1.2-2
+----------+----------+----------+----------+----------+----------+ | What is | How it | Benefit, | System | Open | R | | the | is | drawback | impact | issues | eference | | problem | solved | | | | | | to | | | | | | | solve? | | | | | | +==========+==========+==========+==========+==========+==========+ | KI#1 - | Only | Benefit: | > \- UDM | It is | Sol.#1 | | How to | HPLMN | | > to | not | ,#2,#6 | | provide | provides | D | > | defined | | | URSP | URSP | rawback: | include | how a AF | | | Rules in | Rules to | | > the | outside | | | roaming | the UE. | | > DNN, | the MNO | | | to the | (NOTE 1) | | > | can find | | | UE. In | | | S-NSSAI | the | | | par | Assumes | | > of the | HPLMN of | | | ticular, | that the | | > VPLMN | a SUPI | | | how the | HPLMN | | > in the | roaming | | | HPLMN | trusts | | > list | in the | | | and | the | | > of | VPLMN. | | | VPLMN | VPLMN to | | > Su | | | | are | provide | | bscribed | | | | involved | URSP | | > | | | | in such | Rules | | S-NSSAIs | | | | pr | un | | > and to | | | | ocedure. | changed. | | > allow | | | | | | | > the | | | | | | | > DNN, | | | | | | | > | | | | | | | S-NSSAI | | | | | | | > to | | | | | | | > work | | | | | | | > in LBO | | | | | | | > mode | | | | | | | > in the | | | | | | | > user | | | | | | | > subsc | | | | | | | ription. | | | +----------+----------+----------+----------+----------+----------+ | | Both | Benefit: | Impacts | | Sol.#3 | | | HPLMN | | the UE, | | | | | and | D | V-PCF, | | | | | VPLMN | rawback: | H-PCF | | | | | provides | | and UDR. | | | | | URSP | | | | | | | Rules to | | | | | | | the UE. | | | | | | | (NOTE 1) | | | | | | | | | | | | | | (NOTE 2) | | | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | Assumes | | | | | | | that the | | | | | | | HPLMN | | | | | | | trusts | | | | | | | the | | | | | | | VPLMN to | | | | | | | provide | | | | | | | u | | | | | | | nchanged | | | | | | | URSP | | | | | | | Rules to | | | | | | | the UE. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Assumes | | | | | | | that the | | | | | | | HPLMN | | | | | | | trusts | | | | | | | the | | | | | | | VPLMN to | | | | | | | provide | | | | | | | URSP | | | | | | | Rules to | | | | | | | the UE | | | | | | | to route | | | | | | | traffic | | | | | | | in the | | | | | | | VPLMN. | | | | | | +----------+----------+----------+----------+----------+----------+
## 7.2 Evaluation on Solutions for KI#2
Table 7.2-1: Summary of solutions for KI#2
+---------------+-----------------------------------------------------+ | Solution #7 | PDU Session establish/mod includes the URSP Rule | | | ID. | | | | | | PCF-SM sends URSP ID and PDU Session Parameters to | | | UE-PCF. UE-PCF checks that the PDU Session | | | Parameters comply with the URSP Rule. | +===============+=====================================================+ | Solution #9 | PDU Session establ./mod. includes the URSP Rule | | | Precedence. | | | | | | SMF gets the URSP Rule and RSD from the PCF. SMF | | | checks the PDU Session parameters are according to | | | the RSD(s) in the URSP Rule, otherwise it rejects | | | the PDU Session Establishment. | | | | | | UPF reports "incorrect application traffic" to SMF | | | and then to PCF. The PCF decides if the UE should | | | be updated to route the application traffic to the | | | "correct" PDU Session. | +---------------+-----------------------------------------------------+ | Solution #10 | (with UE assistance) | | | | | | UE notifies PCF-UE the URSP Rules in use and its | | | PDU Session ID(s). | | | | | | The PCF-UE uses the PDU Session to find the SMF for | | | the PDU Session, then asks SMF or the PCF-SM | | | (depending on the option) to check that the PDU | | | Session parameters are the same as in the RSD. The | | | SMF derives the N4 rules to detect the traffic in | | | the TD of the URSP Rule. If no packet is detected, | | | the SMF notifies the PCF-UE via PCF-SM, the PCF-AM | | | sends URSP Rules to the UE to route traffic. | | | | | | SMF maps Application Descriptor, DNN, Domain | | | Descriptor or Connection Capabilities in Traffic | | | Descriptor to IP descriptor to construct 3-IP-tuple | | | in PDR. | | | | | | (without UE assistance) | | | | | | The PCF decides to monitor some URSP Rules provided | | | to a UE, then finds the PDU Sessions established | | | for this UE (DNN, S-NSSAI) contacting UDM, then | | | provides the Traffic Descriptors to be monitored to | | | the SMF. | +---------------+-----------------------------------------------------+ | Solution #11 | UE reports the URSP Rules that contain unsupported | | | values to the PCF, then the PCF can adjust URSP | | | Rules including only supported values. | +---------------+-----------------------------------------------------+ | Solution #12 | The URSP Rule is extended with URSP ID, the UE | | | includes the URSP Rule ID in the PDU Session | | | Establishment, the PCF generates PCC Rules based on | | | the content of the URSP Rule ID. | | | | | | The UPF reports unmatched traffic to the PCF, the | | | PCF generates URSP Rules for this unmatched | | | traffic. | +---------------+-----------------------------------------------------+ | Solution #13 | The UE provides the application identity, that | | | triggers a secondary authentication/authorization | | | to the DN-AAA. Then, once the DN-AAA authorizes the | | | UE to use this application, the SMF establishes the | | | SM Policy Association, provides the URSP Rule | | | precedence to the PCF, then PCC Rules according to | | | the traffic descriptor and the RSD are provided to | | | the SMF. | +---------------+-----------------------------------------------------+ | Solution #14 | URSP Rules are extended with an indication of | | | application registration and the identity of the AF | | | is needed. The UE registers to the AF, if the | | | indication is set, the AF authorizes the UE to use | | | this PDU Session. Then if the AF authorizes the use | | | of this PDU Session for this application traffic, | | | then the AF provides an application identity to the | | | UE that sends it in the PDU Session establishment | | | for the SMF to verify. | | | | | | There are still Editors Notes on the procedure for | | | application registration. | +---------------+-----------------------------------------------------+ | Solution #15 | The UE gets the the App_ID from the ASP, the UE | | | provides the App_ID at PDU Session Est/mod. The | | | SMF forwards the App_ID to the PCF that checks if | | | the UE route the App_ID over the correct PDU | | | Session, and if not informs the UE that e.g. | | | S-NSSAI selection rule or Time window was not | | | followed. The PDU Session Est/mod. Is rejected. | +---------------+-----------------------------------------------------+ | Solution #30 | The NWDAF requests the UPF to report "unmatched | | | traffic", then the NWDAF identifies the "unmatched | | | traffic" per S-NSSAI and DNN, compares with the | | | list of allowed services per DNN,S-NSSAI provided | | | by the PCF, then determines which UEs routed the | | | traffic incorrectly, i.e. no according to the URSP | | | Rules sent to the UE and informs the PCF. The PCF | | | updates URSP Rules or provides PCC Rules to e.g., | | | block this traffic. | +---------------+-----------------------------------------------------+ | Solution #31 | URSP Rule is extended with the URSP Notification | | | Component that indicates the conditions that | | | trigger reporting to the PCF, such as a) First use | | | of the URSP rule, b) Data sent over given period of | | | time (i.e. periodic reporting) or c) If a certain | | | amount of data has been sent over a specific period | | | of time (i.e. Bandwidth threshold). The reporting | | | to PCF-UE is performed over NAS signalling. | | | | | | The URSP Notification Component applies to both | | | URSP Rules preconfigured in the UE and those | | | provided by the PCF. Possible actions are to reject | | | the UE, if the service requires a SLA such a slice | | | offering GBR services or to trigger SM Policies to | | | accommodate the traffic into the PDU Session at | | | reporting of start of service and ends of service | | | by the UE. | +---------------+-----------------------------------------------------+ | Solution #32 | When the TD in the URSP includes a domain | | | description, then the PCC Rules also includes a | | | FQDN in the SDF template to identify the | | | application traffic matching the domain descriptor | | | of the target UE. The SMF generates DNS message | | | handling rules using FQDN-based SDF template. The | | | SMF sends the DNS message handling rule for the | | | EASDF , when detecting the DNS Response, the EASDF | | | notifies the FQDN and resolved address for the FQDN | | | to the SMF. The SMF generates the corresponding N4 | | | rules, e.g. PDR and URR in order for the UPF to | | | report the traffic identified by IP address. | +---------------+-----------------------------------------------------+
Some of the solutions, Sol#12, #13, #31 states that the network ensures that
the application traffic sent by the UE in a PDU Session established according
to the URSP Rule is treated according to the SLA, e.g. ensuring that the
application traffic is routed over a slice for GBR services. For that the PCF
provisions PCC Rule to the SMF to provide Session Management policies for the
Traffic Descriptors sent in the URSP Rule. This process is applicable to
preconfigured URSP Rules and those URSP Rules signalled by the UE as proposed
in Sol#31.
**Observation 1: There is a need to describe how to ensure that the
application traffic sent by the UE is routed over a PDU Session according to
SLAs, this will be done using PCC Rules.**
Most of the solution proposes that the UE provides the URSP ID or the URSP
Precedence or includes the Application ID in the PDU Session Est. or
Modification or in NAS signalling from UE to PCF. This may help the PCF to
determine the RSD component that the UE used, potentially validate it and then
provide PCC Rules with Session Management policies for the Traffic
Descriptors. However, the PCF can also do this determination based on internal
logic, such as checking the PDU Session Parameters provided at SM Policy
Association Est./Mod. to identify the URSP Rule that the UE enforced.
**Observation 2: The PCF can determine the URSP Rule used by the UE analysing
the PDU Session parameters to find the candidate RSD(s) and the Traffic
Descriptors. If the UE sends the URSP Rule ID, this will also be used in the
process to identify the URSP Rule.**
There is a mismatch between the SDF template and the Traffic Descriptor, and
then some solutions, such as Sol#10 or Sol#32, proposes to configure the SMF
with the mapping of a DNN, Connection Capabilities, Domain descriptor to IP
descriptors. This can be a solution for some specific DNNs that the operator
knows the Application server IP addresses, however if the DNN allows for
multiple applications, the list of IP addresses to configure can be quite
dynamic and difficult to configure in the SMF. For the Connection
Capabilities, given that this identifies the traffic category, it is also
difficult to know all the IP address of possible servers that belong to
traffic category.
**Observation 3: The PCC Rules include the Application ID or the IP/non-IP
descriptor in a SDF template.**
There are solutions that aim to identify the traffic that was routed not
following the URSP Rule to the UE, in order to prevent that Sol#11 proposes
that the UE reports to the PCF unsupported values, then the PCF provides URSP
Rules with only supported values, this will reduce unnecessary signalling and
prevent storing in the UE URSP Rules that are not used or even reject it. A
solution using NWDAF to try to identify this traffic and possible ask the UE
to send it over a different PDU Session is also proposed in Sol#30.
**Observation 4: NWDAF can be used to identify the unknown traffic, this is
also addressed in eNA_Ph2.**
**Observation 5: The UE reports unsupported values to the PCF at the time the
URSP Rules are provisioned.**
## 7.3 Evaluation on Solutions for KI#3
The Key Issue #3 includes three aspects:
\- #1: Identify the use cases and scenarios where the UE may need URSP that is
consistent across 5GC and EPC.
\- #2: Study whether there are any issues and gaps in the existing URSP
mapping mechanism described in clause 5.17.1.2 of TS 23.501 [2], if so,
identify them and propose solutions.
\- #3: Whether, when and how to provision the URSP to UE when served by the
EPC and ANDSF is not deployed in the network. For the Rel-15 UEs not
supporting the URSP mapping in EPS, whether the URSP updating/provisioning to
such UEs in EPS should be supported.
For bullet #2, there is only one solution (Solution#17) on the table. For this
solution, there is very restricted applicability for the dynamic mapping. EPS
only supports SSC mode 1; APN is always equivalent to DNN; The mapping to PDN
connection need to follow what 5GS has; and S-NSSAI is not applicable in EPS.
For Multi-Access preference, Time window, Location criteria, they are already
setting as \"not applicable in EPS\". The only two parameters that may have
different mapping settings are Access Type preference and Non-seamless Offload
indication. However, there was no identified scenario that requiring setting a
value dynamically and differently from the 5G URSP RSD.
The advantages in adopting Sol#17 are that there are certain aspects in the
URSP that are currently only applicable to 5GS due to the static mapping make
the URSPs (RSDs) invalid in EPS. For example: a rule that has an S-NSSAI in
its RSD will simply be considered invalid in EPS by the UE as S-NSSAI is not
applicable in EPS. With Sol#17 S-NSSAI parameter of the RDS can be simply set
as \"to be ignored in EPS\" and hence the rule will be applied identically to
EPS. This will ensure URSP rule consistency.
The additional advantage of adopting Sol #17 is that we can enable support of
certain parameters that currently are not supported in EPS. For example, in
FS_eIMS5G2 it is discussed that S-NSSAI may be used in EPS to indicate the IMS
slice to be used.
For bullet #1 and #3, there are 6 solutions (Solution#16, #18, #19, #20, #33,
#34) in total, but solution #18, #19 and #20 have been covered in the
consolidated solution #33 (for PCRT handling, #20 is covered by #16), so only
three solutions (Sol#16, #33, #34) should be evaluated.
Solution #34 proposes to provision the URSP to UE in EPS by registering the UE
to 5GC via E-UTRAN with N3IWF, which relies on the deployment of N3IWF in 5GC
and UE triggering the registration. There are some aspects unclear for this
solution:
\- If the URSP update happens before the UE triggers the URSP provisioning
request, how does UE-PCF update the URSP rule to UE?
\- Accessing to 5GC via N3IWF was defined to use non-3GPP access, while this
proposal uses the 3GPP access (E-UTRAN), which was never studied in early
releases and may have significant architecture change.
\- The design requires the UE to do dual registration to both EPS and 5GS,
it\'s very questionable in real deployment.
However, Sol #34 has many advantages over Sol#16, #33 and the rest of the
solutions that are proposing similar mechanisms. Sol #34 has minimum impact on
the network as network operators need to only deploy N3IWF (if not already
deployed). There is also minimal impact on the UE to support registering to
5GC via N3IWF using a PDN connection in the EPC as underlay.
Based on above analysis, it\'s proposed not to proceed with Solution#34.
For Solution#16 and #33, the major parts of the two solutions are same (i.e.
using ePCO for URSP Delivery in EPS, relying on UE-PCF to terminate the UE
Policy Association during 5GS to EPS mobility, UE indicating the URSP Delivery
Support indication in UE Policy Container in Registration Request in 5GS) but
with following difference:
\- Sol#33 requires UE to indicate URSP Support Indication in EPS in the ePCO
carried in PDN Connectivity Request message. During mobility from 5GS to EPS
with N26,
\- Sol#33 doesn\'t require AMF to initiate to terminate the UE Policy
Association with UE-PCF, the UE Policy Association can be terminated by UE-PCF
after the UE Policy Association is updated by SM-PCF in EPS for the UE, while
this solution would require the AMF to be able to differentiate the UE
supporting URSP delivery in EPS or not, which means the UE needs to report its
capability of URSP Delivery Support Indication in EPS in the MM Capability in
Registration Request. Sol#16 doesn\'t require AMF to initiate to terminate the
UE Policy Association with UE-PCF either, but it further proposes the AMF to
indicate to UE-PCF to delay the UE Policy Association termination for a
configured period, the UE-PCF will remove the UE Policy Association either
after the configured period or after receiving the UE Policy Association
establishment request from SM-PCF for this UE.
\- In Sol#16, AMF doesn\'t provide any new information to MME and let SM-PCF
determine whether the UE supports URSP delivery in EPC by checking UE context
policy control subscription information in UDR. In solution#33, by providing
the UE Policy Association information (i.e. URSP Provisioning Support
Indication in EPS, UE-PCF ID in 5GS, PCRTs) to MME by AMF, the MME can
determine to create a UE Policy Container only including the indication of MME
Created UE Policy Container for 5GS to EPS Mobility, based on this indication,
the UE-PCF knows it\'s an MME initiated UE Policy Association update procedure
and updates the UE Policy Association with SM-PCF and terminates the UE Policy
Association with AMF for this UE. Based on the UE-PCF ID, the SM-PCF knows to
select the same UE-PCF serving the UE in 5GS. In order to avoid impact to MME,
Sol #16 proposed mechanism can be used as a way forward.
For Solution#16 and #33, however there are many drawbacks and technically
unclear. For example:
-
\- It is also not clear what happens if the UE is Dual registered e.g. with a
N3IWF and thus already having an UE PCF.
Based on above analysis on Sol #16 and Sol #33, both solutions work from
technical viewpoint to address bullet #1 and #3 for KI #3.
**Conclusion Proposal #1:** The ePCO based URSP delivery to UE in EPS is
selected as baseline mechanism for normative work.
**Conclusion Proposal #2:** In order to avoid unnecessary signalling overload
for the purpose of delivery URSP to pre-Rel-18 UEs in EPS, the UE needs to
indicate the URSP Delivery Support Indication in EPS in the UE Policy
**Container to UE-PCF in EPS and 5GS.**
**Conclusion Proposal #3:** During 5GS to EPS mobility with N26, the AMF
doesn\'t initiate the UE Policy Association termination procedure, instead the
AMF will request the UE-PCF to delay the termination of UE Policy Association
for a configured period. The UE-PCF can initiate the UE Policy Association
Termination procedure either after it receives the UE Policy Association
Establishment from SM-PCF or after the configured period.
**Conclusion Proposal #4:** AMF doesn\'t provide any new information to MME
during 5GS to EPS mobility with N26, the SM-PCF determines whether the UE
supports URSP delivery in EPS by checking UE context policy control
subscription information in UDR. The SM-PCF discovers the address of UE-PCF
serving the UE by querying BSF. The UE-PCF recovers the information about the
PSI list in the UE and the subscribed PCRTs in 5GS from former UE Policy
Association for the UE after receiving the UE Policy Association Establishment
request including a UE Policy Container only including an indication about the
trigger for the UE Policy Association Establishment (\"5GS to EPS handover\").
**Conclusion Proposal #5:** When the UE is attached to EPS, the SM-PCF can
retrieve the PCRTs for UE Policy from UE-PCF and subscribe to the applicable
PCRTs in EPC to SMF+PGW-C.
## 7.4 Evaluation on Solutions for KI#4
Solutions for Key issue #4 address different approaches to support traffic
categories in the traffic descriptor of URSP.
The investigations were to consider several main aspects:
1\. Definition of traffic categories
2\. How to support standard and operator specific traffic categories,
3\. Whether the current URSP design can be used to support the standard and
operator specific traffic categories. If not, how to support traffic category
in the traffic descriptor of a URSP rule.
The first aspect has been addressed basically by the GSMA, by defining
categories considering application traffic characteristics and based on
latency, unidirectional or bidirectional bandwidth requirements, availability
requirements and particular priorities over specific QoS components (e.g.
loss, jitter..).The following table summarises the evaluation of each solution
considering how those address the support of traffic category in the current
URSP design, or support traffic category in the traffic descriptor of a URSP
rule. It also adds advantages and disadvantages seen relevant for the
conclusion phase.
Table 7.4-1
+----------+----------+----------+----------+----------+----------+ | Solution | Reuse | URSP TD | Number | Ad | Disad | | | current | to | of | vantages | vantages | | | URSP | support | ca | | | | | design | Traffic | tegories | | | | | | Category | | | | +==========+==========+==========+==========+==========+==========+ | #21 | Yes | Option 1 | Variable | - | - DNN | | | | - DNN | | Reuses | has a | | | | | | URSP | very | | | | Option 2 | | design | d | | | | -- AppId | | although | ifferent | | | | and | | re-inte | meaning | | | | fixed | | rpreting | from | | | | value to | | some | network | | | | OS Id | | c | pers | | | | | | omponent | pective. | | | | | | types. | | | | | | | | - DNNs | | | | | | | need to | | | | | | | be coded | | | | | | | on a per | | | | | | | app | | | | | | | lication | | | | | | | basis. | | | | | | | | | | | | | | - It | | | | | | | requires | | | | | | | network | | | | | | | and | | | | | | | su | | | | | | | bscriber | | | | | | | confi | | | | | | | guration | | | | | | | to | | | | | | | change | | | | | | | the | | | | | | | DNN | | | | | | | =traffic | | | | | | | category | | | | | | | to a | | | | | | | real | | | | | | | DNN. | | | | | | | | | | | | | | - AppID | | | | | | | has also | | | | | | | d | | | | | | | ifferent | | | | | | | meaning | | | | | | | from the | | | | | | | network | | | | | | | per | | | | | | | spective | | | | | | | as well | | | | | | | as the | | | | | | | OS Id | | | | | | | and | | | | | | | requires | | | | | | | App | | | | | | | lication | | | | | | | and OS | | | | | | | ada | | | | | | | ptation. | | | | | | | | | | | | | | - It | | | | | | | disables | | | | | | | the use | | | | | | | of real | | | | | | | App IDs. | +----------+----------+----------+----------+----------+----------+ | #22 | No | New TD | No | | - It | | | | | as | | requires | | | | | sumption | | ad | | | | | | | ditional | | | | | | | rules to | | | | | | | be sent | | | | | | | to the | | | | | | | terminal | | | | | | | as UE | | | | | | | policy. | | | | | | | | | | | | | | - Need | | | | | | | to | | | | | | | redesign | | | | | | | the URSP | | | | | | | format | | | | | | | to | | | | | | | define | | | | | | | new | | | | | | | c | | | | | | | omponent | | | | | | | type in | | | | | | | the TD. | | | | | | | | | | | | | | - The | | | | | | | appl | | | | | | | ications | | | | | | | to be | | | | | | | cat | | | | | | | egorized | | | | | | | and the | | | | | | | type of | | | | | | | traffic | | | | | | | by those | | | | | | | appl | | | | | | | ications | | | | | | | need to | | | | | | | be known | | | | | | | in | | | | | | | advance | | | | | | | by the | | | | | | | operator | | | | | | | making | | | | | | | d | | | | | | | ifficult | | | | | | | to | | | | | | | properly | | | | | | | ca | | | | | | | tegorize | | | | | | | all | | | | | | | appl | | | | | | | ications | | | | | | | used by | | | | | | | a UE. | +----------+----------+----------+----------+----------+----------+ | #23 | No | New TD | Max. | - Can | - Need | | | | | 256\ | be used | to | | | | | (A | with | redesign | | | | | ccording | other | the URSP | | | | | to an | TDs for | format | | | | | example | more | to | | | | | in TR) | gra | define | | | | | | nularity | new | | | | | | (e.g. | c | | | | | | for | omponent | | | | | | ente | type in | | | | | | rprise). | the TD. | | | | | | | | | | | | | - Not | - | | | | | | many | Current | | | | | | values | impleme | | | | | | to be | ntations | | | | | | assumed | of URSP | | | | | | as the | rules | | | | | | example, | need to | | | | | | however, | be | | | | | | no | updated. | | | | | | concern | | | | | | | on | | | | | | | backwa | | | | | | | rd-compa | | | | | | | tibility | | | | | | | if | | | | | | | encoding | | | | | | | changes | | | | | | | from the | | | | | | | ass | | | | | | | umption. | | +----------+----------+----------+----------+----------+----------+ | #24 | No | New | No | | - It is | | | | c | As | | unclear | | | | omponent | sumption | | how a TD | | | | in URSP | | | to TC | | | | or new | | | mapping | | | | co | | | is | | | | mponents | | | supposed | | | | type in | | | to work | | | | the TD | | | in the | | | | | | | UE. | | | | | | | | | | | | | | - Need | | | | | | | to | | | | | | | redesign | | | | | | | the URSP | | | | | | | rule | | | | | | | format | | | | | | | to | | | | | | | define | | | | | | | new | | | | | | | c | | | | | | | omponent | | | | | | | in | | | | | | | addition | | | | | | | to the | | | | | | | TD and | | | | | | | list of | | | | | | | RSD or | | | | | | | to | | | | | | | define a | | | | | | | new | | | | | | | c | | | | | | | omponent | | | | | | | type in | | | | | | | the TDs. | | | | | | | | | | | | | | - It | | | | | | | adds | | | | | | | unn | | | | | | | ecessary | | | | | | | co | | | | | | | mplexity | | | | | | | in the | | | | | | | PCF to | | | | | | | design | | | | | | | mappings | | | | | | | between | | | | | | | TDs and | | | | | | | TCs and | | | | | | | between | | | | | | | TCs and | | | | | | | RSDs. If | | | | | | | PCF can | | | | | | | know the | | | | | | | TDs, the | | | | | | | traffic | | | | | | | ca | | | | | | | tegories | | | | | | | are | | | | | | | irr | | | | | | | elevant. | | | | | | | | | | | | | | - | | | | | | | Current | | | | | | | impleme | | | | | | | ntations | | | | | | | of URSP | | | | | | | rules | | | | | | | need to | | | | | | | be | | | | | | | updated | +----------+----------+----------+----------+----------+----------+ | #25 | Yes | App ID | Variable | - | - App | | | | | | Reuses | ID has | | | | | | URSP | d | | | | | | design | ifferent | | | | | | although | meaning | | | | | | re-inte | from the | | | | | | rpreting | network, | | | | | | the | app | | | | | | AppID | lication | | | | | | c | and OS | | | | | | omponent | per | | | | | | type. | spective | | | | | | | | | | | | | | - It | | | | | | | disables | | | | | | | the use | | | | | | | of real | | | | | | | App IDs | | | | | | | | | | | | | | - It | | | | | | | requires | | | | | | | mapping | | | | | | | of | | | | | | | (real) | | | | | | | AppID to | | | | | | | TC at | | | | | | | app | | | | | | | lication | | | | | | | client | | | | | | | level, | | | | | | | OS or | | | | | | | URSP | | | | | | | level in | | | | | | | the UE. | | | | | | | It is | | | | | | | unclear | | | | | | | which | | | | | | | layer | | | | | | | would | | | | | | | make the | | | | | | | mapping. | | | | | | | | | | | | | | - It | | | | | | | requires | | | | | | | the | | | | | | | operator | | | | | | | to know | | | | | | | which | | | | | | | appl | | | | | | | ications | | | | | | | should | | | | | | | map to | | | | | | | which | | | | | | | c | | | | | | | ategory. | +----------+----------+----------+----------+----------+----------+ | #26 | No | New TD | No | - Can | - Need | | | | | As | be used | to | | | | | sumption | with | redesign | | | | | | other | the URSP | | | | | | TDs for | format | | | | | | more | to | | | | | | gra | define | | | | | | nularity | new | | | | | | (e.g. | c | | | | | | for | omponent | | | | | | ente | type in | | | | | | rprise). | the TD. | | | | | | | | | | | | | | - | | | | | | | Current | | | | | | | impleme | | | | | | | ntations | | | | | | | of URSP | | | | | | | rules | | | | | | | need to | | | | | | | be | | | | | | | updated. | +----------+----------+----------+----------+----------+----------+ | #35 | Yes | Co | Max. 256 | - | - | | | | nnection | | Reuses | Current | | | | Capa | | URSP | length | | | | bilities | | design | of | | | | | | and | Co | | | | | | concept | nnection | | | | | | | Capa | | | | | | - No | bilities | | | | | | impact | is 1 | | | | | | on the | octet. | | | | | | network | | | | | | | e | | | | | | | quipment | | | | | | | si | | | | | | | gnaling. | | | | | | | | | | | | | | - In | | | | | | | line | | | | | | | with | | | | | | | Rel-17 | | | | | | | updates | | | | | | | of URSP | | | | | | | for | | | | | | | operator | | | | | | | specific | | | | | | | capab | | | | | | | ilities. | | | | | | | | | | | | | | - Can | | | | | | | be used | | | | | | | with | | | | | | | other | | | | | | | TDs for | | | | | | | more | | | | | | | gra | | | | | | | nularity | | | | | | | (e.g. | | | | | | | for | | | | | | | ente | | | | | | | rprise). | | +----------+----------+----------+----------+----------+----------+
# 8 Conclusions
Editor\'s note: This clause will list conclusions that have been agreed during
the course of the study item activities.
## 8.1 Conclusions on KI#1
### 8.1.1 General
The following definitions will be included as part of the normative work on
URSP Rules in roaming:
**VPLMN specific URSP Rules:** A VPLMN specific URSP Rule is applicable when
the UE is registered in the VPLMN or its equivalent VPLMN only. VPLMN specific
URSP rules are provided from the HPLMN and contains, based on agreements with
VPLMN, HPLMN values for Network Slice Selection Policies and DNN Selection
Policies. When provided, the Time and Location criteria in each of the RSD
contain VPLMN values.. It is provided to the UE to route traffic on a PDU
Session to a SMF and UPF in the VPLMN.
VPLMN configuration is used to ensure that the local VPLMN values are used
when a PDU Session is established for a roaming UE.
When the UE sends a PDU Session Establishment the HPLMN values that are
included in the S-NSSAI and DNN may need to be translated to VPLMN values to
be able to select a SMF at the VPLMN. This means that the AMF may select a
local DNN that is used to select a SMF in the VPLMN. How the AMF selects a
local DNN is to be decided during normative phase. The AMF also sends the
local DNN, if decided, as \"Selected DNN\" to the SMF, while the DNN requested
by the UE is sent as \"Requested DNN\".
The VPLMN provides the service parameters to HPLMN for HPLMN to generate the
VPLMN specific URSP rules. The H-PCF creates VPLMN specific URSP rules
corresponding to different VPLMN. The H-PCF may provide the VPLMN specific
URSP rules to the UE. This can be triggered by the UE\'s registration in the
VPLMN or it can happen before UE roams into the VPLMN. The URSP Rules received
by UE in VPLMN are only applicable when the UE is registered in that VPLMN or
its equivalent VPLMNs. If the UE does not find a match using the URSP rules
associated with the VPLMN ID or equivalent VPLMN ID, it uses the URSP rules
associated with the HPLMN.
NOTE: The PCF may provide VPLMN specific URSP rules based on existing PCRT
report from PCF such as PLMN Change or other triggers.
### 8.1.2 Conclusions on the how to identify PLMN specific URSP Rules
To enable the PCF to provide and the UE to identify the PLMN specific URSP
Rules, the following conclusion principles apply:
\- VPLMN ID is provided to UE along with the URSP.
\- The PCF provides to UE a list of PSIs associated to the HPLMN ID and a list
of PSIs associated to each VPLMN ID with roaming agreements (following the
principles of Solution #6).
### 8.1.3 Conclusions on which PLMN determines the VPLMN specific URSP Rules
The scenario where the network provides the UE with URSP rules applicable in
the VPLMN It is proposed to adopt the following interim conclusion principles:
\- The H-PCF provides VPLMN specific URSP Rules to the UE.
\- The H-PCF generates VPLMN specific URSP rules by taking Service Parameters
from V-PCF or the V-AF into account.
\- The Service Parameters provided by the V-AF are either provided to:
\- V-NEF and stored in V-UDR so that the V-PCF can obtain the Service
Parameters from V-UDR.
\- H-NEF and stored in the H-UDR. H-PCF retrieves the service parameters
directly from the H-UDR.
\- The Service Parameters are AF guidance for URSP Rule determination for
subscribers of a certain PLMN.
### 8.1.4 Conclusions on Re-evaluation Triggers
Upon PLMN change, the UE (re-)evaluates URSP rules.
## 8.2 Conclusion on KI#2
New Analytics ID will be discussed to be supported by the NWDAF to monitor the
traffic in one or multiple PDU Session for statistics of URSP enforcement, The
analytics request includes the expected traffic according to provisioned URSP
rules via the S-NSSAI/DNN. Consumer of new analytic ID can be a PCF. A PCF
that provisions URSP rule for a UE may use the NWDAF output to determine
updated URSP rules for UE(s).
NOTE: Further details on the new analytic ID will be determined during the
normative phase.
The process to generate URSP Rules to the UE and corresponding PCC rules for
the traffic matching the Traffic Description in the URSP Rule does not require
the UE to send the URSP ID or the App ID. The PCF for the UE can derive the
candidate RSD components using the PDU Session parameters sent by the UE, if
no URSP Rule ID or App ID is sent as defined in Sol#9.
During UE registration procedure, the UE should indicate the capability of
reporting URSP rule enforcement based on UE configuration to network and the
5GC indicates to the UE to report URSP rule enforcement to network, and if the
UE URSP rule includes Connection Capabilities contained in the TD (see clause
6.6.2.1 of TS 23.503 [4]), when newly-appeared application traffic is matched
to the TD during URSP evaluation, the UE reports the Connection Capabilities
contained in the TD, which will be included in the PDU Session Establishment
or Modification (i.e. when the URSP rule is matched), then to the PCF for the
PDU Session and to PCF for the UE. The UE does not report information to the
5GC when a \"match-all\" URSP rule is enforced. No service degradation for
legacy UEs shall result from this functionality in Rel-18.
NOTE 2: Traffic categories will be further discussed during the normative
phase.
NOTE 3: By including Connection capabilities, the network indicates to the UE
for which URSP rule enforcement in UE should be reported. It will waste UE
resource to report all of the URSP rule enforcement to network side including
the uninterested URSP rule enforcement.
NOTE 4: UE reporting the enforced URSP rule information in PDU Session
Establishment/Modification can significantly increase the amount of signalling
in the network. Limiting the signalling impact of usage of using PDU Session
Modification while keeping functionality is a matter of operational trade-off,
e.g. UE reporting can be limited to specific application traffic on specific
UEs. The mentioned aspects in this NOTE requiring normative work will be
limited to minor modifications of existing solutions.
NOTE 5: PDU Session Modification Accept/Reject, PDU Session Establishment
Accept/Reject messages will not be impacted.
NOTE 6: If SA WG3 feedbacks that it sees an issue with privacy and that it
cannot be solved, work on UE assistance won\'t proceed. Feedback has been
asked from SA WG3 and will be included regarding the following aspects:
\- Whether SA WG3 sees an issue with privacy regarding the UE sending
information to the 5GC via NAS to identify an enforced URSP rule
\- Whether SA WG3 see an issue with user consent regarding the UE sending
information to the 5GC via NAS to identify an enforced URSP rule that SA2
would need to consider and if yes, whether SA WG2 is correct to assume that
details regarding user consent would fall under the scope of SA WG3 (e.g.
FS_UC3S_Ph2)
The PCF for the UE knows the list of URSP Rules sent to the UE and its RSDs,
this allows the PCF for the UE to check the PDU Session parameters and request
the PCF for the PDU Session to generate PCC Rules to apply policies for a PDU
Session established with preconfigured URSP Rules. This is defined in Sol#32.
The PCF for the PDU Session provisions PCC rules to the SMF that includes in
the SDF template based on the Application identifier, or the IP/non-IP Flow
descriptions as defined in the TD of the URSP Rule. For example, the mapping
of other TD such as DNN, Connection Capabilities and Domain Descriptors can be
done for certain cases such as specific DNNs using local configuration in the
SMF, and the Connection Capability that contains a traffic category can be
mapped in some cases into the Application Identifier (e.g. Connection
Capability=IMS assumes IMS application identifier).
Already existing mechanisms, which do not require additional normative work,
can be used and are not precluded, e.g. so that the PCF can provide SDF
Templates in PCC rules which correspond to traffic that is not expected to
occur in a PDU session, so that if the UPF detects such traffic, the PCF for a
PDU Session gets notified from the SMF and can then notify the PCF for a UE
about the detected traffic and the relevant parameters of the PDU Session.
Based on this information, the PCF for a UE can adjust the URSP rules.
NOTE 7: Exposure of UPF events towards NWDAF is part of UPEAS.
## 8.3 Conclusion on KI#3:
\- The ePCO based URSP delivery to UE in EPS is selected as baseline mechanism
for normative work.
\- In order to avoid unnecessary signalling overload for the purpose of
delivery URSP to pre-Rel-18 UEs in EPS, the UE needs to indicate the URSP
Provisioning Support Indication in EPS in the UE Policy Container to UE-PCF in
5GS.
\- During 5GS to EPS mobility with N26, the AMF doesn\'t initiate the UE
Policy Association termination procedure, instead the AMF will request the UE-
PCF to delay the termination of UE Policy Association for a configured period.
The UE-PCF can initiate the UE Policy Association Termination procedure either
after it receives the UE Policy Association Establishment from SM-PCF or after
the configured period. The mobility procedure from 5GS to EPC described in
clause 6.16.2.3.3 is selected as the baseline procedure for 5GS to EPS
mobility with N26.
\- AMF doesn\'t provide any new information to MME during 5GS to EPS mobility
with N26, the SM-PCF determines whether the UE supports URSP delivery in EPS
by checking UE context policy control subscription information in UDR. The SM-
PCF discovers the address of UE-PCF serving the UE by querying BSF. The UE-PCF
recovers the information about the PSI list in the UE and the subscribed PCRTs
in 5GS from former UE Policy Association for the UE after receiving the UE
Policy Association Establishment request including a UE Policy Container only
including an indication about the trigger for the UE Policy Association
Establishment (\"5GS to EPS handover\").
\- When the UE is attached to EPS, the SM-PCF can retrieve the PCRTs for UE
Policy from UE-PCF and subscribe to the applicable PCRTs in EPC to SMF+PGW-C.
\- When the UE returns from EPS to 5GS, the old UE policy association in EPS
should be terminated after the new UE policy association established in 5GS.
\- When the UE does Initial Attach to EPC, in the default PDN connection is
requested to established, the UE includes the UE Policy Container ePCO in PDN
Connectivity Request encapsulated in Attach Request; otherwise, the UE will
include the UE Policy Container ePCO in the PDN Connectivity Request during
the first request for PDN connectivity as described (i.e. as described in
Sol#16). The PDN Connection used by UE and SMF/PGW-C to convey UE Policy
Container ePCO shall be kept when the UE is in the CONNECTED mode.
\- The PCF triggers the re-evaluation of applicable URSPs for the UE and
determines an update of URSP is needed for the UE when an event as described
in clause 6.16.11 happens in PCF. The PCF selects one of the PDN
connection/PDU sessions associated to EPC for the delivery of the URSP update.
Then the PCF generates the corresponding UPDP message MANAGE UE POLICY COMMAND
in a similar way than it is done in 5GC and then includes the message into a
new IE for sending it to the SMF over N7, then further to UE as described in
clause 6.16.2.2.
NOTE: How to discover the same PCF for UE Policy serving the UE in both EPS
and 5GS will be determined in normative phase.
## 8.4 Conclusion on KI#4
The following principles are proposed to be used for conclusion:
a) Application in the UE may select a standardized traffic category and
informs the lower layer (e.g., OS layer). MNOs should not be assumed to assign
the traffic category used by all the specific applications in a UE:
i. Some implementations may rely on OS to assign the traffic category.
b) For standardized and operator-specific traffic categories, how this is
selected by the application is out of scope of this specification.
c) Traffic categories are independent of the Operating System. This allows
operators to define operator-specific traffic categories and permit
applications setting and classifying the traffic according to categories.
d) Implementation details on applications indicating a particular traffic
category to the OS and/or URSP layer are outside the scope of this work.
e) The existing traffic descriptors shall not modify their definition or use
due to the use of traffic categories.
f) Traffic categories shall be able to be used together with any other traffic
descriptor in the same URSP rule, and traffic must match to all TDs (an AND
function and not OR function) to trigger the URSP rule processing as described
in current TS 23.503 [4].
g) The existing TD component types should be able to be reused either alone or
in combination with other TD component types as a way to implicitly
determining the category of an application.
h) The URSP design should be able to associate traffic categories to slices in
such a way that it is possible to address large enough operator-specific
categories required by operator scenarios, e.g. the length of the component
type to accommodate the traffic category to be 2 or more octets.
\- Solution #35 is recommended for normative work to use Connection Capability
in order to support standardized and operator-specific traffic categories in
URSP. Stage 3 should consider extending the length of the Connection
Capabilities component type of the URSP TD so as to secure enough number of
traffic categories.
NOTE: Besides the standardized traffic category defined by GSMA, additional
traffic categories may be defined by 3GPP. This may be defined/discussed
during stage 3.
SA WG2 recommends stage-3 normative work to proceed based on the above
principles.
#
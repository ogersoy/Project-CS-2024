# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The scope of this Technical Report is to study and evaluate the possible
architecture enhancements to the 5G Proximity-based Services (5G ProSe) system
defined in TS 23.304 [3], based on the relevant Stage 1 requirements defined
in TS 22.261 [4], TS 22.278 [5] and TS 22.115 [6] and determine which of the
solutions can proceed to normative specifications.
This study will consider architecture enhancements in the following areas:
\- Support of single NR PC5 hop UE-to-UE Relay for unicast.
\- Enhancement of 5G ProSe UE-to-Network Relay functionality.
\- Support of path switching between direct NR Uu communication path and
direct NR PC5 communication path (i.e. non-relay case).
# 2 References {#references-1}
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TR 23.752: \"Study on system enhancement for Proximity based Services
(ProSe) in the 5G System (5GS)\".
[3] 3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System
(5GS)\".
[4] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets; Stage 1\".
[5] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System
(EPS); Stage 1\".
[6] 3GPP TS 22.115: \"Service aspects; Charging and billing; Stage 1\".
[7] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[8] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
[9] 3GPP TS 22.101: \"Service aspects; Service principles\".
[10] 3GPP TS 32.277: \"Proximity-based Services (ProSe) charging\".
[11] 3GPP TS 23.713: \"Study on extended architecture support for proximity-
based services\".
[12] IETF RCF 4862: \"IPv6 Stateless Address Autoconfiguration\".
[13] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System\".
[14] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
Specification\".
[15] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".
[16] 3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
2\".
[17] 3GPP TS 23.280: \"Common functional architecture to support mission
critical services; Stage 2\".
[18] 3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\".
[19] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[20] 3GPP TR 38.836: \"Study on NR sidelink relay\".
[21] 3GPP TS 24.554: \"Proximity-services (ProSe) in 5G System (5GS) protocol
aspects; Stage 3\".
[22] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[23] 3GPP TS 23.167: \"3rd Generation Partnership Project; Technical
Specification Group Services and Systems Aspects; IP Multimedia Subsystem
(IMS) emergency sessions\".
[24] 3GPP TS 33.503: \"Security Aspects of Proximity based Services (ProSe) in
the 5G System (5GS)\".
[25] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[26] 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control;
Protocol specification\".
[27] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to
support Vehicle-to-Everything (V2X) services\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
TS 23.304 [3] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1] and TS 23.304 [3].
**5G ProSe End UE:** A 5G ProSe-enabled UE that connects with another 5G
ProSe-enabled UE(s) via a 5G ProSe UE-to-UE Relay.
**5G ProSe UE-to-UE Relay:** A 5G ProSe-enabled UE that provides functionality
to support connectivity between 5G ProSe End UEs.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
# 4 Architecture Requirements and Assumptions
## 4.1 Architecture Requirements
Solutions shall build on the 5G ProSe architecture principles as defined in TS
23.304 [3] and 5G System architectural principles as defined in TS 23.501 [7],
including flexibility and modularity for newly introduced functionalities.
In order to satisfy the normative stage-1 general requirements in TS 22.278
[5], TS 22.261 [4] and TS 22.115 [6], the system shall:
\- support single NR PC5 hop UE-to-UE Relay for unicast.
\- enhance UE-to-Network Relay functionality to support:
\- service continuity when switching between two indirect network
communication paths for UE-to-Network Relay;
\- service continuity when switching between direct network communication path
and indirect network communication path for 5G ProSe Layer-2 UE-to-Network
Relay, including inter-gNB indirect-to-direct and inter-gNB direct-to-indirect
path switching;
\- multi-path transmission using only one direct network communication path
and only one indirect network communication path e.g. for improved reliability
or data rates;
\- Emergency Services for Remote UE over UE-to-Network Relay.
\- support path switching between direct NR Uu communication path and direct
NR PC5 communication path;
NOTE 1: The UE-to-Network Relay and UE-to-UE Relay in this study include both
Layer-3 and Layer-2 Relays unless explicitly stated.
NOTE 2: It is not targeted to support session continuity (e.g. IP address
preservation) during path switching between direct NR Uu communication path
and direct NR PC5 communication path.
NOTE 3: For multi-path transmission over Layer-2 UE-to-Network Relay, a UE is
connected to the same gNB using one direct path and one indirect path via
Layer-2 UE-to-Network relay.
NOTE 4: Multi-path transmission over Layer-3 UE-to-Network Relay cannot have
RAN impacts.
NOTE 5: Path switching between Layer-2 UE-to-Network Relay and Layer-3 UE-to-
Network Relay cannot have RAN impacts.
## 4.2 Architecture Assumptions
\- Architecture reference models defined in TS 23.304 [3] are used as basis
architecture for supporting 5G ProSe Ph2.
\- Architecture reference model defined in TS 23.501 [7] are used as basis
architecture for supporting 5G ProSe Ph2.
\- NG-RAN is considered; non-3GPP AN is not considered in this release.
\- NR based PC5 and NR Uu are considered.
\- For emergency service, the UE prioritises direct connection via any
network, if available. If no such network is available, the UE attempts
emergency service via 5G ProSe UE-to-Network Relay.
# 5 Key Issues
## 5.1 Key Issue #1: Support of UE-to-UE Relay
### 5.1.1 General description
This key issue intends to support single hop UE-to-UE Relay for unicast as
illustrated in figure 5.1.1-1, including support for in coverage and out of
coverage operation of Source UE, Target UE as well as the UE-to-UE Relay.
Figure 5.1.1-1: Example scenario of support of UE-to-UE Relay
At least the following aspects need to be studied in potential solutions:
\- How to discover UE-to-UE Relay(s) and (re)-select a UE-to-UE Relay UE in
proximity.
\- Whether and how the network can control UE-to-UE Relay operation, at least
including how to:
\- Authorize the UE-to-UE Relay, e.g. authorize a UE as UE-to-UE Relay.
\- Authorize Source/Target UEs to use a UE-to-UE Relay.
\- Provisioning policy and parameters for UE-to-UE Relay service.
\- How to establish the connection between the source UE and the target UE via
UE-to-UE Relay.
\- How to provide end-to-end QoS framework to satisfy the QoS requirements
(such as data rate, reliability, latency).
\- How to enhance the system architecture to provide security/privacy
protection for a relayed connection.
\- How to provide a mechanism for a path changing in the case of e.g. UE-to-UE
Relay changes, including reducing communication disruptions and fulfilling QoS
requirements.
\- Whether and how to determine whether Layer-2 UE-to-UE Relay or Layer-3 UE-
to-UE Relay or both are supported by the Source, Target and Relay UEs and how
to make sure the Source, Target and Relay UE all use the same type of relay.
NOTE 1: The solution should take into account the forward compatibility for
supporting more than one hop in a later release.
NOTE 2: For the involvement of NG-RAN, coordination with RAN WGs is needed.
NOTE 3: For security/privacy protection aspects, coordination with SA WG3 is
needed.
NOTE 4: This KI covers both Layer-2 and Layer-3 UE-to-UE relay cases.
## 5.2 Key Issue #2: Support of path switching between two indirect network
communication paths for UE-to-Network Relaying with service continuity
consideration
### 5.2.1 General description
This key issue intends to support the path switching between two indirect
network communication paths for UE-to-Network Relaying with service continuity
consideration.
This key issue should study whether all of the following path switching
scenarios need to be considered and how:
\- Layer-3 UE-to-Network Relay with N3IWF switching from/to Layer-3 UE-to-
Network Relay with N3IWF.
\- Layer-3 UE-to-Network Relay without N3IWF switching from/to Layer-3 UE-to-
Network Relay without N3IWF.
\- Layer-3 UE-to-Network Relay without N3IWF switching from/to Layer-3 UE-to-
Network Relay with N3IWF.
\- Layer-2 UE-to-Network Relay switching from/to Layer-2 UE-to-Network Relay.
\- Layer-2 UE-to-Network Relay switching from/to Layer-3 UE-to-Network Relay
without N3IWF.
\- Layer-2 UE-to-Network Relay switching from/to Layer-3 UE-to-Network Relay
with N3IWF.
It is understood that service continuity in different path switching cases can
be achieved via application layer or session continuity. In this key issue, at
least the following aspects need to be considered:
\- What the triggers and criteria for path switching.
\- How to select a UE-to-Network Relay for path switching.
\- Identify the path switch procedure with service continuity consideration.
\- Identify what the service continuity to be achieved for the solution in
path switching.
NOTE: Coordination with RAN WGs is needed for RAN dependency.
## 5.3 Key Issue #3: Support direct communication path switching between PC5
and Uu (i.e. non-relay case)
### 5.3.1 General description
As illustrated in figure 5.3.1-1, the \"direct communication path switching
between PC5 and Uu reference points\" refers to the procedure on how a UE
switches between direct Uu communication path and direct PC5 communication
path when it is communicating with another UE. The direct communication path
over PC5 reference point means that the communication with another UE is
performed by using 5G ProSe Direct Communication only. The direct
communication path over Uu reference point means that the communication with
another UE is performed via the network.
Figure 5.3.1-1: Example scenario of direct communication path switching
between PC5 and Uu (i.e. switching between Figure a and Figure b)
When switching the path between the direct communication path over PC5
reference point and the direct communication path over Uu reference point, the
ProSe service disruption to the UE should be minimized.
This key issue addresses the following:
\- Whether and how to support path switching from direct NR Uu communication
path to direct NR PC5 communication path or vice versa for both commercial and
public safety services.
\- How to support any IP, Ethernet or Unstructured PDU type for direct
communication path switching.
\- What functional entities and triggers are responsible for direct
communication path switching and their impact on the corresponding interfaces.
What information/policy are used for path switching decision.
\- What are the procedures and potential impacts of direct communication path
switching on QoS handling for direct PC5 communication path vs. direct Uu
communication path?
NOTE: No RAN dependency is expected for key issue.
## 5.4 Key Issue #4: Support of path switching between direct network
communication path and indirect network communication path for Layer-2 UE-to-
Network Relay with session continuity consideration
### 5.4.1 General description
This key issue addresses how to enhance the 5GS to support the path switching
between direct network communication path and indirect network communication
path for Layer-2 UE-to-Network Relay, including inter-gNB indirect-to-direct
and inter-gNB direct-to-indirect path switching.
When studying the above aspect, the following needs to be considered:
\- What the triggers and criteria for path switching.
\- How to select a direct network communication path or an indirect
communication path for path switching.
\- How to perform the path switching with session continuity consideration.
NOTE: This key issue has strong dependency with RAN, and input from RAN WGs is
needed to conclude.
## 5.5 Key Issue #5: Support of multi-path transmission for UE-to-Network
Relay
### 5.5.1 General description
Multi-path transmission using only one direct network communication path and
only one indirect network communication path with UE-to-Network Relay can be
used to improve reliability or data rates for the Remote UE. As illustrated in
figure 5.5.1-1, a UE can use path #1 and path #2 for multi-path transmission,
where path #1 is direct network communication path, and path #2 is indirect
network communication path with UE-to-Network Relay.
Figure 5.5.1-1: Example scenario of multi-path transmission using UE-to-
Network Relay
At least the following aspects needs to be studied:
\- Whether and how the network authorizes and the triggers for connection
establishment for multi-path transmission, including:
\- Whether and how to authorise a Remote UE to use the multi-path transmission
for specific ProSe service(s).
\- What information is required for and how does a Remote UE or UE-to Network
Relay or the network trigger the multi-path connection establishment.
\- How to provide/update the rules for multiple-path transmission.
\- Whether and how to enhance the existing procedures to
establish/modify/release a connection for multi-path transmission.
NOTE 1: Coordination with RAN WGs is needed for RAN dependency.
NOTE 2: For security aspects, coordination with SA WG3 is needed.
NOTE 3: This KI covers both Layer-2 and Layer-3 UE-to-Network Relay cases.
NOTE 4: The solution can study whether to use a single PDU Session to transfer
data over direct and indirect network communication paths simultaneously, or
use two PDU Sessions to transfer data with one over direct network
communication path and the other over indirect network communication path with
UE-to-Network Relay.
## 5.6 Key Issue #6: Support of PC5 Service Authorization and Policy/Parameter
Provisioning
### 5.6.1 General description
Following scenarios need to be considered for this key issue:
\- UE-to-UE Relay in KI#1;
\- Multi-path transmission for UE-to-Network Relay in KI#5;
\- Direct communication path switching between PC5 and Uu (i.e. non-relay
case) in KI#3.
\- Path switching between two indirect network communication paths for UE-to-
Network Relaying in KI#2.
In order to enable PC5 service authorization and policy/parameter provisioning
following aspects need to be studied:
\- What are necessary enhancements for the procedures related to PC5 service
authorization and policy/parameter provisioning to a UE, compared with what is
currently specified in clause 5.1 of TS 23.304 [3] and clause 4.2.2.2 of TS
23.502 [8] (Registration Procedure), 4.2.4.3 (UE Configuration Update
procedure for transparent UE Policy Delivery), 4.16.11 (UE Policy Association
Establishment procedure), 4.16.12 (UE Policy Association Modification
procedure).
\- what are new information for PC5 service authorization and provisioning
beyond what is currently specified in clause 5.1 of TS 23.304 [3].
NOTE: Authorization and Provisioning as documented in clause 5.1 of TS 23.304
[3] will be used as the baseline for this key issue.
## 5.7 Key Issue #7: Support of Emergency for UE-to-Network Relaying
### 5.7.1 General description
This key issue addresses how to Support of Emergency Services over UE-to-
Network Relaying.
According to TS 22.101 [9], emergency service is defined as citizen to
authority services, and it is left to the national authorities to decide
whether the network accepts emergency calls e.g. for valid UE only, or for UEs
without the SIM/USIM/ISIM.
In the 5G ProSe UE-to-Network relaying, if there is an emergency request from
the remote UE, it implies that the Relay UE needs to be responsible for remote
UE\'s emergency service. It is required that the Relay UE has a valid
SIM/USIM/ISIM.
Assuming that a UE relaying emergency service for another UE is compliant with
local regulation, this key issue is expected to address whether and how to
address the following aspects for 5G ProSe UE-to-Network Relaying:
\- Whether and how the UE-to Network Relay identifies the emergency services
from the Remote UE and vice versa?
\- Under which conditions can it be ensured that the emergency call is routed
to PSAP of the same country as the Remote UE?
\- What are UE and network behaviors and principles of operation for a Remote
UE and 5G ProSe UE-to-Network Relay to be enhanced for the emergency services
, below are some (but not limited) aspects:
\- Overriding Mobility Restrictions when applicable as defined in TS 23.501
[7].
\- Supporting emergency services for 5G ProSe Remote UE in Limited service
state as defined in clause 5.16.4 of TS 23.501 [7].
\- Supporting Congestion Control as defined in clause 5.19 of TS 23.501 [7].
\- How to handle the emergency service conflict between 5G ProSe Layer-3
Remote UE and UE-to-Network Relay.
NOTE: Whether it is feasible to support all regulatory service requirements
for Emergency Services over 5G ProSe UE-to-Network Relay is to be determined
during the study.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
              Key Issues
* * *
Solutions 1 2 3 4 5 6 7 1 X  
2 X  
3 X  
4 X  
5 X  
6 X  
7 X  
8 X X  
9 X  
10 X  
11 X  
12 X  
13 X  
14 X  
15 X  
16 X X  
17 X  
18 X  
19 X  
20 X  
21 X  
22 X  
23 X  
24 X  
25 X X  
26 X  
27 X  
28 X  
29 X  
30 X  
31 X  
32 X  
33 X  
34 X  
35 X  
36 X  
37 X  
38 X  
39 X  
40 X  
41 X  
42 X 43 X 44 X 45 X 46 X 47 X 48 X
## 6.1 Solution #1: UE-to-UE Relay Selection Without Relay Discovery
### 6.1.1 Description
This solution addressed Key Issue #1 \"Support of UE-to-UE Relay\".
NOTE: The solution was Solution #8 of TR 23.752 [2].
When a source UE wants to communicate with a target UE, it will first try to
find the target UE by either sending a Direct Communication Request or a
Solicitation message with the target UE info. If the source UE cannot reach
the target UE directly, it will try to discover a UE-to-UE relay to reach the
target UE which may also trigger the relay to discover the target UE. To be
more efficient, this solution tries to integrate target UE discovery and UE-
to-UE relay discovery and selection together, including two alternatives:
\- Alternative 1: UE-to-UE relay discovery and selection can be integrated
into the unicast link establishment procedure as described in clause 6.4.3.1
of TS 23.304 [3].
\- Alternative 2: UE-to-UE relay discovery and selection is integrated into
Model B direct discovery procedure.
A new field is proposed to be added in the Direct Communication Request or the
Solicitation message to indicate whether relays can be used in the
communication. The field can be called relay_indication. When a UE wants to
broadcast a Direct Communication Request or a Solicitation message, it
indicates in the message whether a UE-to-UE relay could be used. For Release
18, it is assumed that the value of the indication is restricted to single
hop.
When a UE-to-UE relay receives a Direct Communication Request or a
Solicitation message with the relay_indication set, then it shall decide
whether to forward the message (i.e. modify the message and broadcast it in
its proximity), according to e.g. Relay Service Code if there is any,
Application ID, authorization policy (e.g. relay for specific ProSe Service),
the current traffic load of the relay, the radio conditions between the source
UE and the relay UE, etc.
It may exist a situation where multiple UE-to-UE relays can be used to reach
the target UE or the target UE may also directly receive the Direct
Communication Request or Solicitation message from the source UE. The target
UE may choose which one to reply according to e.g. signal strength, local
policy (e.g. traffic load of the UE-to-UE relays), Relay Service Code if there
is any or operator policies (e.g. always prefer direct communication or only
use some specific UE-to-UE relays).
The source UE may receive the responses from multiple UE-to-UE relays and may
also from the target UE directly, the source UE chooses the communication path
according to e.g. signal strength or operator policies (e.g. always prefer
direct communication or only use some specific UE-to-UE relays).
### 6.1.2 Procedures
#### 6.1.2.1 UE-to-UE relay discovery and selection is integrated into the
unicast link establishment procedure (Alternative 1)
Figure 6.1.2.1-1 5G ProSe UE-to-UE relay selection (Alternative 1)
Figure 6.1.2.1-1 illustrates the procedure of the proposed method.
0\. UEs are authorized to use the service provided by the UE-to-UE relays. UE-
to-UE relays are authorized to provide service of relaying traffic among UEs.
The authorization and the parameter provisioning can use solutions for KI#5.
The authorization can be done when UEs/relays are registered to the network.
Security related parameters may be provisioned so that a UE and a relay can
verify the authorization with each other if needed.
1\. UE-1 wants to establish unicast communication with UE-2 and the
communication can be either through direct link with UE-2 or via a UE-to-UE
relay. Then UE-1 broadcasts Direct Communication Request with relay_indication
enabled. The message will be received by relay-1, relay-2. The message may
also be received by UE-2 if it is in the proximity of UE-1. UE-1 includes
source UE info, target UE info, Application ID, as well as Relay Service Code
if there is any. If UE-1 does not want relay to be involved in the
communication, then it will made relay_indication disabled.
NOTE 1: The data type of relay_indication can be determined in Stage 3.
Details of Direct Communication Request/Accept messages will be determined in
stage 3.
2\. Relay-1 and relay-2 decide to participate in the procedure. They broadcast
a new Direct Communication Request message in their proximity without
relay_indication enabled. If a relay receives this message, it will just drop
it. When a relay broadcasts the Direct Communication Request message, it
includes source UE info, target UE info and Relay UE info (e.g. Relay UE ID)
in the message and use Relay\'s L2 address as the source Layer-2 ID. The Relay
maintains association between the source UE information (e.g. source UE L2 ID)
and the new Direct Communication Request.
3\. UE-2 receives the Direct Communication Requests from relay-1 and relay-2.
UE-2 may also receive Direct Communication Request message directly from the
UE-1 if the UE-2 is in the communication range of UE-1.
4\. UE-2 chooses relay-1 and replies with Direct Communication Accept message.
If UE-2 directly receives the Direct Communication Request from UE-1, it may
choose to setup a direct communication link by sending the Direct
Communication Accept message directly to UE-1. After receiving Direct
Communication Accept, a UE-to-UE relay retrieves the source UE information
stored in step 2 and sends the Direct Communication Accept message to the
source UE with its Relay UE info added in the message.
After step 4, UE-1 and UE-2 have respectively setup the PC5 links with the
chosen UE-to-UE relay.
NOTE 2: The security establishment between the UE1 and Relay-1, and between
Relay-1 and UE-2 are performed before the Relay-1 and UE-2 send Direct
Communication Accept message. Details of the authentication/ security
establishment procedure are determined by SA WG3. The security establishment
procedure can be skipped if there already exists a PC5 link between the source
(or target) UE and the relay which can be used for relaying the traffic.
5\. UE-1 receives the Direct Communication Accept message from relay-1. UE-1
chooses path according to e.g. policies (e.g. always choose direct path if it
is possible), signal strength, etc. If UE-1 receives Direct Communication
Accept / Response message request accept directly from UE-2, it may choose to
setup a direct PC5 L2 link with UE-2 as described in clause 6.4.3.1 of TS
23.304 [3], then step 6 is skipped.
6a. For the L3 UE-to-UE Relay case, UE-1 and UE-2 finish setting up the
communication link via the chosen UE-to-UE relay. The link setup information
may vary depending on the type of relay, e.g. L2 or L3 relaying. Then UE-1 and
UE-2 can communicate via the relay. Regarding IP address allocation for the
source/remote UE, the addresses can be either assigned by the relay or by the
UE itself (e.g. link-local IP address) as defined in clause 6.4.3.1 of TS
23.304 [3].
6b. For the Layer 2 UE-to-UE Relay case, the source and target UE can setup an
end-to-end PC5 link via the relay. UE-1 sends a unicast E2E Direct
Communication Request message to UE-2 via the Relay-1, and UE-2 responds with
a unicast E2E Direct Communication Accept message to UE-1 via the Relay-1.
Relay-1 transfers the messages based on the identity information of UE-1/UE-2
in the Adaptation Layer.
NOTE 3: How Relay-1 can transfer the messages based on the identity
information of UE-1/UE-2 in the Adaptation Layer requires cooperation with
RAN2 during the normative phase.
NOTE 4: In order to make a relay or path selection, the source UE can setup a
timer after sending out the Direct Communication Request for collecting the
corresponding response messages before making a decision. Similarly, the
target UE can also setup a timer after receiving the first copy of the Direct
Communication Request / message for collecting multiple copies of the message
from different paths before making a decision.
NOTE 5: In the first time when a UE receives a message from a UE-to-UE relay,
the UE needs to verify if the relay is authorized be a UE-to-UE relay.
Similarly, the UE-to-UE relay may also need to verify if the UE is authorized
to use the relay service. The verification details and the how to secure the
communication between two UEs through a UE-to-UE relay is to be defined by SA
WG3.
#### 6.1.2.2 UE-to-UE relay discovery and selection is integrated into Model B
direct discovery procedure (Alternative 2)
Depicted in Figure 6.1.2.2-1 is the procedure for UE-UE Relay discovery Model
B, and the discovery/selection procedure is separated from hop by hop and end-
to-end link establishment.
Figure 6.1.2.2-1 5G ProSe UE-to-UE relay selection (Alternative 2)
1\. UE-1 broadcasts discovery solicitation message carrying UE-1 info, target
UE info (UE-2), Application ID, Relay Service Code if any, the UE-1 can also
indicate relay_indication enabled.
2\. On reception of discovery solicitation, the candidate Relay UE-R
broadcasts discovery solicitation carrying UE-1 info, UE-R info, Target UE
info. The Relay UE-R uses Relay\'s L2 address as the source Layer-2 ID.
3\. The target UE-2 responds the discovery message. If the UE-2 receives
discovery solicitation message in step 1, then UE-2 responds discovery
response in step 3b with UE-1 info, UE-2 info. If not and UE-2 receives
discovery solicitation in step 2, then UE-2 responds discovery response
message in step 3a with UE-1 info, UE-R info, UE-2 info.
4\. On reception of discovery response in step 3a, UE-R sends discovery
response with UE-1 info, UE-R info, UE-2 info. If more than one candidate
Relay UEs responding discovery response message, UE-1 can select one Relay UE
based on e.g. implementation or link qualification.
5\. The source and target UE may need to setup PC5 links with the relay before
communicating with each other. Step 5a can be skipped if there already exists
a PC5 link between the UE-1 and UE-R which can be used for relaying. Step 5b
can be skipped if there already exists a PC5 link between the UE-2 and UE-R
which can be used for relaying.
6a. Same as step 6a described in clause 6.1.2.1.
6b. For the Layer-2 UE-to-UE Relay, the E2E unicast Direct Communication
Request message is sent from UE1 to the selected Relay via the per-hop link
(established in steps 5a) and the Adaptation layer info identifying the peer
UE (UE3) as the destination. The UE-to-UE Relay transfers the E2E messages
based on the identity information of peer UE in the Adaptation Layer. The
initiator (UE1) knows the Adaptation layer info identifying the peer UE (UE3)
after a discovery procedure. UE3 responds with E2E unicast Direct
Communication Accept message in the same way.
NOTE 1: For the Layer 2 UE-to-UE Relay case, whether step5b is performed
before step 6b or triggered during step 6b will be decided at normative phase.
NOTE 2: How Relay-1 can transfer the messages based on the identity
information of UE-1/UE-2 in the Adaptation Layer requires cooperation with
RAN2 during the normative phase.
### 6.1.3 Impacts on services, entities and interfaces
UE impacts to support new Relay related functions.
## 6.2 Solution #2: ProSe 5G Layer-3 UE-to-UE Relay based on IP routing
### 6.2.1 Description
This solution addressed Key Issue #1 \"Support of UE-to-UE Relay\".
NOTE 1: The solution was Solution #10 of TR 23.752 [2].
In this solution, the ProSe 5G UE-to-UE Relay operations is supported with the
following principles:
\- Authorization and configuration:
\- Only the UE authorized by the service authorization configuration can act
as a ProSe 5G UE-to-UE Relay. These UEs will be configured according to the
service authorization and provisioning mechanism defined in TS 23.304 [3] to
operate in the UE-to-UE Relay mode.
\- ProSe 5G UE-to-UE Relay discovery:
\- The ProSe 5G UE-to-UE Relay sends out a Relay Discovery message
periodically, announcing its availability for serving other UEs in the area.
\- The ProSe 5G UE-to-UE Relay also supports the query and response mode for
discovery. The ProSe 5G UE-to-UE Relay listens on a configured Layer-2 ID for
the query, and would respond with its address and corresponding information to
enable to other UE to establish a unicast connection with it. This process is
similar to the unicast L2 link establishment procedure as defined in clause
6.4.3.1 of TS 23.304 [3].
NOTE 2: The Layer-2 ID used for the discovery can be specific for UE-to-UE
Relay discovery, or shared with other discoveries, e.g. UE-to-Network Relay
discovery.
\- ProSe 5G UE-to-UE Relay operation:
\- Any UE that wants to make use of the ProSe 5G UE-to-UE Relay needs to
establish a unicast L2 link with the UE-to-UE Relay, with IP configuration.
The ProSe 5G UE-to-UE Relay allocates IP address/prefix to the other UEs.
\- As part of the unicast L2 link establishment procedure, the ProSe 5G UE-to-
UE Relay stores an association of the User Info of the peer UE of the unicast
link (or ProSe Service provided by the peer UE) and the IP address/prefix
allocated to the UE into its DNS entries. The ProSe 5G UE-to-UE Relay acts as
a DNS server to other UEs.
\- When a (source) UE needs to communicate with another (target) UE or needs
to discover a ProSe service via the ProSe 5G UE-to-UE Relay, it sends a DNS
query for the target UE (based on Target User Info) or for the ProSe Service
to the ProSe 5G UE-to-UE Relay over the unicast link, which will return the IP
address/prefix of the target UE or the IP address(es)/prefix(es) of UEs which
provide the ProSe Service.
If there are multiple UEs supporting the same ProSe Service, the (source) UE
can select a UE(s) based on UE implementation.
\- The source UE sends the IP data or non-IP data encapsulated in IP to the
target UE or to the selected UE(s) which provide(s) the ProSe Service via the
unicast L2 link to UE-to-UE Relay that returned the IP address/prefix of the
target UE or UE(s) which provide(s) the ProSe Service. The ProSe 5G UE-to-UE
Relay acts as an IP router, and forwards the packets to the corresponding
unicast L2 link towards the target UE or UE(s) which provide(s) the ProSe
Service. Each of the unicast L2 link is treated as an IP interface.
\- If there are multiple ProSe 5G UE-to-UE Relays in the proximity, UE can
choose either one or more ProSe 5G UE-to-UE Relays to establish the unicast L2
link based on UE implementation. For example, the UE sends a DNS query on each
of the unicast L2 link to the ProSe 5G UE-to-UE Relays. Then, the source UE
may choose to use the first ProSe 5G UE-to-UE Relay that returns a positive
DNS query for the target UE.
NOTE 3: The selection of the UE-to-UE Relay may be based on local configured
rules on the UE, or based on other discovery solutions, e.g. \"Stateful UE-to-
UE Relay\" described in clause 6.3.
\- QoS handling:
\- When the source UE establishes the unicast L2 link with the ProSe 5G UE-to-
UE Relay, it can establish corresponding PC5 QoS Flows according to procedure
defined in clause 6.4.3.1 of TS 23.304 [3]. It can also modify the PC5 QoS
Flows at any time using procedure defined in clause 6.4.3.4 of TS 23.304 [3].
\- Correspondingly, the ProSe 5G UE-to-UE Relay can also establish and modify
the PC5 QoS Flows using the above-mentioned procedures over the unicast L2
Link with the target UE based on PC5 Packet Filter received from the source UE
during the PC5 QoS flow establishment/modification procedure or destination IP
address of IP packet received from the source UE for the forwarding of source
UE\'s traffic. The ProSe 5G UE-to-UE Relay determines the PC5 QoS parameters
of PC5 QoS Flows with target UE based on corresponding PC5 QoS Flows with
target UE.
\- Security handling:
\- source UE and target UE can establish bearer level security with the UE-to-
UE Relay for the unicast L2 Link, using procedures defined in TS 23.304 [3].
\- If end-to-end security protection is required between source UE and target
UE, IPSec can be used.
NOTE 4: The security protection of the traffic of source UE and target UE will
be specified by SA WG3.
\- Charging Support:
\- ProSe 5G UE-to-UE Relay can follow the charging solution defined in TS
32.277 [10] to report the source and target UEs and corresponding traffic to
the charging function.
### 6.2.2 Procedures
Figure 6.2.2-1: 5G ProSe UE-to-UE Relay operation
Figure 6.2.2-1 provides an example operation for the 5G ProSe UE-to-UE Relay
operation based on standard IP operation.
### 6.2.3 Impacts on services, entities and interfaces
There is no impact to NG-RAN, as the solution is using the existing features
supported in Rel-16 NR V2X design.
UEs operate with existing IP operation, and the ProSe 5G UE-to-UE Relay
supports the IP router function (for IP address allocation and traffic
forwarding) and the functionality of a DNS server.
## 6.3 Solution #3: Stateful UE-to-UE Layer-2 or Layer-3 Relay for Public
Safety
### 6.3.1 Introduction
The solution applies to Key Issue #1 \"Support of UE-to-UE Relay\".
NOTE: The solution was Solution #11 of TR 23.752 [2].
The procedure for discovery of UE-to-UE Relay in this solution is based on
clause 6.1.2.4 of TR 23.713 [11].
The communication via the stateful UE-to-UE Relay can be performed at either
Layer-3 (refer to clause 6.3.3.2.2) or at Layer-2 (refer to clause 6.3.3.2.3).
### 6.3.2 Functional Description
In reference to Figure 6.3.2-1, the UE-to-UE Relay (UE-R) is a logical
functionality that assists a UE (e.g. UE-1) to discover its group members
(e.g. UE-2) which may not be reachable directly over NR PC5, but each of which
is reachable via the UE-to-UE Relay. Once the UE discovers other group member
UEs that are reachable via the UE-to-UE Relay, it can engage in communication
with them, the UE-to-UE Relay acting as a Layer-3 relay.
Figure 6.3.2-1: Stateful UE-to-UE Relay
The UE-to-UE Relay performs the following functionality:
\- Group Member Discovery using Model A or Model B discovery as defined in TS
23.304 [3].
\- UE-to-UE Relay Discovery using the procedures defined in clause 6.3.3.1.
\- Acting as Layer-3 relay for communication between UEs using the procedures
defined in clause 6.3.3.2.
### 6.3.3 Procedures
#### 6.3.3.1 UE-to-UE Relay discovery
##### 6.3.3.1.1 Model A
Depicted in figure 6.3.3.1.1-1 is the procedure for UE-to-UE Relay discovery
Model A.
Figure 6.3.3.1.1-1: UE-to-UE Relay discovery with Model A
1\. UE-1 (\"this UE\") performs the Group Member Discovery procedure (either
Model A or Model B) as defined in TS 23.304 [3]. In the process UE-1 discovers
UE-R as its only neighbour.
2\. UE-R (\"the potential relay\") also performs the Group Member Discovery
procedure (either Model A or Model B). In the process UE-R discovers two UEs
in vicinity: UE-1 and UE-2.
NOTE 1: The execution of the Group Member Discovery procedure in steps 1 and 2
is a pre-requisite for the execution of the UE-to-UE Relay discovery procedure
proper that only starts at step 3. Each of the UEs periodically performs the
Group Member Discovery procedure in order to keep an up-to-date list of the
neighbouring UEs that are directly reachable via NR PC5.
3\. UE-R decides that it can act as a UE-to-UE Relay and announces this by
periodically transmitting an Announcement message including the following
parameters:
\- Type = Announcement.
\- Discovery Type = UE-to-UE Relay Discovery.
\- Announcer Info (i.e. an upper layer identifier for the UE-R user).
\- ProSe UE ID of UE-R (i.e. Layer-2 identifier of UE-R).
\- A list of \"Target User Info\" parameters (including users of UE-1 and
UE-2) that have been gathered during Group Member Discovery in step 2.
\"Target User Info\" is an upper layer parameter identifying the target user.
To support Layer-2 communication via the stateful UE-to-UE Relay, the \"Target
User Info\" also includes the Layer-2 identifier of the target user\'s UE.
4\. Based on the information received in the previous step, UE-1 decides to
establish a one-to-one communication link with UE-R and engage in
communication with UE-2 via UE-R, as described in clause 6.3.3.2.
##### 6.3.3.1.2 Model B
Depicted in figure 6.3.3.1.2-1 is the procedure for UE-UE Relay discovery
Model B.
Figure 6.3.3.1.2-1: UE-to-UE Relay discovery with Model B
1-2. These steps are identical to steps 1-2 in Figure 6.3.3.1.1-1.
NOTE: The execution of the Group Member Discovery procedure in steps 1 and 2
is a pre-requisite for the execution of the UE-to-UE Relay discovery procedure
proper that only starts at step 3. Each of the UEs periodically performs the
Group Member Discovery procedure in order to keep an up-to-date list of the
neighbouring UEs that are directly reachable via NR PC5.
3\. Having discovered its neighbours, UE-1 realises that the group member of
interest (\"target user\") is not within direct range over NR PC5. UE-1 then
(in the role of Discoverer) solicits potential UE-to-UE Relays by transmitting
the Solicitation message including the following parameters:
\- Type = Solicitation.
\- Discovery Type = UE-to-UE Relay Discovery.
\- Discoverer Info (i.e. an upper layer identifier for the UE-1 user).
\- ProSe UE ID of UE-1 (i.e. layer-2 identifier of UE-1).
\- A list of \"Target User Info\" parameters corresponding to the target
user(s) of interest (in this case it is the user of UE-2). \"Target User
Info\" is an upper layer parameter identifying the \"target user\" of
interest.
4\. Upon reception of the Solicitation message, UE-R (in the role of
Discoveree) realises that it can act as a UE-to-UE Relay and replies with a
Response message including the following parameters:
\- Type = Response.
\- Discovery Type = UE-to-UE Relay Discovery.
\- Discoveree Info (i.e. an upper layer identifier for the UE-R user).
\- ProSe UE ID of UE-R (i.e. layer-2 identifier of UE-R).
\- A list of \"Target User Info\" parameters corresponding to the target
user(s) of interest (in this case it is the user of UE-2). The latter have
been gathered during Group Member Discovery in step 2. To support Layer-2
communication via the stateful UE-to-UE Relay, the \"Target User Info\" also
includes the Layer-2 identifier of the target user\'s UE.
5\. Based on the information received in the previous step, UE-1 decides to
establish a one-to-one communication link with UE-R and engage in
communication with UE-2 via UE-R, as described in clause 6.11.3.2.
#### 6.3.3.2 Communication via the stateful UE-to-UE Relay
##### 6.3.3.2.1 General
The communication via the stateful UE-to-UE Relay can be performed at either
Layer-2 or Layer-3.
##### 6.3.3.2.2 Communication via stateful Layer-3 UE-to-UE Relay
When the communication via the stateful UE-to-UE Relay is performed at
layer-3, the simplified Layer-2 format for ProSe 5G communication is decpited
in Figure 6.3.3.2.2-1.
Figure 6.3.3.2.2-1: Layer-2 frame format for ProSe 5G communication via
Layer-3 UE-to-UE Relay
When UE1 sends a packet to UE2 via the Relay, in reference to Figure
6.3.3.2.2-1 the fields in the Layer-2 header are ste as follows:
\- Source Layer-2 ID: Identifies the sender of the data (UE-1).
\- Destination Layer-2 ID: Identifies the Relay (UE-R).
The final destination (i.e. UE-2) is identified via the Destination IP address
in the IP packet header.
NOTE: The Layer-2 frame in Figure 6.3.3.2.2-1 is a high-level illustration of
the required addressing functionality in Layer-2 header. The exact Layer-2
frame format is in the scope of RAN WGs.
The procedures for communication via the stateful UE-to-UE Layer-3 Relay are
performed at layer-3 as described in clause 6.2, the stateful UE-to-UE Relay
acting as an IP router.
##### 6.3.3.2.3 Communication via stateful Layer-2 UE-to-UE Relay
When the communication via the stateful UE-to-UE Relay is performed at
layer-2, the Layer-2 frame header is used as illustrated in Figure
6.3.3.2.3-1. In addition to the Source Layer-2 ID and Destination Layer-2 ID
fields, the header has in addition a \"Relay Layer-2 ID\" field and a
\"Direction\" field:
\- \"Relay Layer-2 ID\": identifies the UE-to-UE Relay.
\- \"Direction\" indicates whether the Layer-2 frame is being transmitted \"To
the Relay\" or \"From the Relay\".
Figure 6.3.3.2.3-1: Extended Layer-2 frame format for ProSe 5G communication
via Layer-2 UE-to-UE Relay
When UE-1 wishes to send data to UE-2 via UE-R, the addressing identifiers in
the Layer-2 frame are set as follows:
\- Source Layer-2 ID: identifies UE-1.
\- Destination Layer-2 ID: identifies UE-2.
\- Relay Layer-2 ID: identifies the Relay (UE-R).
\- Direction = \"To Relay\".
When UE-R forwards the Layer-2 frame to UE-2, the addressing identifiers in
the Layer-2 frame are set as follows:
\- Source Layer-2 ID: identifies UE-1.
\- Destination Layer-2 ID: identifies UE-2.
\- Relay Layer-2 ID: identifies UE-R.
\- Direction = \"From Relay\".
NOTE1: The Layer-2 frame in Figure 6.3.3.2.3-1 is a high-level illustration of
the required addressing functionality in Layer-2 header. The exact Layer-2
frame format is in the scope of RAN WGs.
NOTE2: The \"Direction\" field is used by the final receiver (UE-2) to
eliminate duplicate frames if UE-2 enters in direct transmission range of
UE-1.
### 6.3.4 Impacts on services, entities and interfaces
UE:
\- New functionality related to UE-to-UE Relay discovery, as well as
communication via UE-to-UE Relay.
## 6.4 Solution #4: QoS control for UE-to-UE Relay
### 6.4.1 Description
This is a solution for Key Issue #1, UE-to-UE Relay. This solution is
applicable for both Layer 2 UE-to-UE Relay and Layer 3 UE-to-UE Relay.
NOTE: The solution was Solution #31 of TR 23.752 [2].
When a source UE wants to establish unicast communication with a target UE,
the source UE will decide the E2E QoS parameters between source UE and target
UE based on the application layer requirements. The E2E QoS parameters,
especially the PDB, needs to be split between the two PC5 interface. The PER
of the two PC5 interfaces also needs to be set properly to achieve the PER
target in the E2E QoS parameters.
Relay will split the E2E QoS parameters into two parts: one part is the QoS
parameters between source UE and Relay (we call it \"Source side PC5 QoS
parameters\"), the other part is the QoS parameters between Relay and the
target UE (we call it \"Target side PC5 QoS parameters\").
When standardized PQI is used, the Source side PC5 QoS parameters and the
Target side PC5 QoS parameters include PQI and other optional QoS parameters,
e.g. GFBR. When non-standardized PQI is used, the whole set of PC5 QoS
characteristics is also included.
Relay ensures the PDB and PER associated with the PQI in the Source side PC5
QoS parameters and the PDB and PER associated with the PQI in the Target side
PC5 QoS parameters supports the E2E PDB requirements between Remote UE and
target UE. Relay also ensures other QoS parameters/QoS characteristics in the
Source side PC5 QoS parameters and Target side PC5 QoS parameters are
compatible, e.g. have the same value. The Relay decision may be based on the
local policy or the low layer measurement.
Optionally, it\'s possible that the source UE is pre-configured with
authorized service(s) and the related Source side PC5 QoS parameters, the UE-
to-UE Relay is pre-configured with authorized service(s) and the related
Target side PC5 QoS parameters. These can be provided by PCF during
provisioning procedure. The authorized service can be identified by Relay
Service Code etc. With the preconfigured QoS parameters, the source UE
provides the Source side PC5 QoS parameters to the UE-to-UE Relay by the
procedure defined in clause 6.4.3.1 or clause 6.4.3.4 of TS 23.304 [3], then
the UE-to-UE Relay identifies the authorized service and establishes the
corresponding PC5 QoS Flows with the Target UE using the preconfigured Target
side PC5 QoS parameters.
E2E QoS parameters splitting is common for both Layer 2 UE-to-UE Relay and
Layer 3 UE-to-UE Relay. The difference lies in the QoS flow. In the Layer 3
UE-to-UE Relay case, two QoS flows are setup, one QoS flow between Source UE
and UE-to-UE Relay UE, and another QoS flow between Source UE and UE-to-UE
Relay UE. In the Layer 2 UE-to-UE Relay case, the end-to-end QoS flow is setup
between the Source UE and the Target UE.
### 6.4.2 Procedures for Layer 3 UE-to-UE Relay
Figure 6.4.2-1: QoS control for Layer 3 UE-to-UE Relay
1\. Source UE wants to establish unicast communication with target UE, it
decides the E2E QoS parameters between source UE and target UE based on the
application layer requirements. The Source UE sets up a PC5 QoS Flow with
PFI=PFI_s. Then Source UE provides the PFI_s, E2E QoS parameters, source and
target user info to UE-to-UE Relay. The process is similar to the unicast L2
link establishment or modification procedure as defined in clause 6.4.3 of TS
23.304 [3].
2\. Relay splits the E2E QoS parameters into two parts: one part is for the
PC5 interface between source UE and Relay, the other part is for the PC5
interface between Relay and the target UE. Relay will setup a PC5 QoS Flow
with PFI=PFI_t using the target side PC5 QoS parameters between Relay and the
target UE.
3\. Relay provides the PFI_t, target side PC5 QoS parameters, source and
target user info to target UE. The process is similar to the unicast L2 link
establishment or modification procedure as defined in clause 6.4.3 of TS
23.304 [3].
4\. Relay receives the Layer-2 link establishment/modification accept from
target UE.
5\. Relay provides the Layer-2 link establishment/modification accept to the
source UE with the PFI_s and the source side PC5 QoS parameters.
The data transfer on Layer 3 UE-to-UE Relay is according to traffic filter on
both hops.
### 6.4.3 Procedures for Layer 2 UE-to-UE Relay
Figure 6.4.3-1: QoS control for Layer 2 UE-to-UE Relay
0\. When the Source UE wants to communication with the target UE, it uses the
extended unicast link defined in Solution#9 of TR 23.752 [2], and the Source
UE decides the E2E QoS parameters between Source UE and Target UE based on the
application layer requirements. The Source UE sets up a PC5 QoS Flow with PFI,
similar to the 5G ProSe mechanism defined in clause 6.4.3.1 of TS 23.304 [3],
the Source UE negotiates the information about PC5 QoS Flow, which includes
the PFI, the corresponding E2E PC5 QoS parameters and the associated
application info, with the Target UE in step 0a and step 0b. In this step, E2E
PC5-S messages are used for E2E QoS negotiation, and the UE-to-UE Relay just
transfers the E2E PC5-S messages using the RAN specified L2 relay method.
NOTE: The PC5-S messages used in step 0 are the E2E PC5-S messages transferred
between the Source UE and the Target UE and the PC5-S messages used in step 1
to step 5 are the per-hop PC5-S messages transferred between the Source UE or
the Target UE and the UE-to-UE Relay.
1\. After the E2E QoS parameter negotiation in step 0a and step 0b, the Source
UE provides the PFI, E2E QoS parameters, source and target user info to UE-to-
UE Relay. The process is similar to the unicast L2 link establishment or
modification procedure as defined in clause 6.4.3 of TS 23.304 [3].
2\. Relay splits the E2E QoS parameters into two parts: one part is for the
PC5 interface between source UE and Relay (source side PC5 QoS parameters),
the other part is for the PC5 interface between Relay and the target UE
(target side PC5 QoS parameters).
3\. Relay provides the PFI received from source UE, target side PC5 QoS
parameters, source and target user info to target UE. The process is similar
to the unicast L2 link establishment or modification procedure as defined in
clause 6.4.3 of TS 23.304 [3].
4\. Relay receives the Layer-2 link establishment/modification accept from
target UE.
5\. Relay provides the Layer-2 link establishment/modification accept to the
source UE with the PFI and the source side PC5 QoS parameters.
After the PC5 QoS parameters splitting for two PC5 links, the AS layer
configurations for PC5 QoS parameters in each of the PC5 links can be achieved
according to legacy mechanisms in Rel-17 5G ProSe (TS 23.304 [3]). For the QoS
enforcement, the UE-to-UE Relay UE performs the necessary adaptation in the AS
layers of the two PC5 interfaces, and it transfers the received data based on
the adaptation in the AS layer.
Editor\'s note: How to ensure the PC5 QoS over the two PC5 links by the
Adaptation Layer, and the functionalities of the Adaptation Layer will be
confirmed by RAN WG2.
If the Source UE or Target UE wants to add, remove or modify a QoS flow on the
extended unicast link, the link modification procedure defined in clause
6.4.3.4 of TS 23.304 [3] can be used, where the Link Modification Request
message is the E2E PC5-S message.
### 6.4.4 Impacts on services, entities and interfaces
\- UE-to-UE Relay supports the E2E QoS parameters splitting between the two
PC5 interfaces.
## 6.5 Solution #5: Support Layer-3 UE-to-UE Relay Based on IPv6 link-local
addresses
### 6.5.1 Description
This solution addressed Key Issue #1 \"Support of UE-to-UE Relay\".
NOTE: The solution was Solution #32 of TR 23.752 [2].
The basic idea of the solution is when a UE establishes a connection with a
UE-to-UE relay, it uses its link-local IPv6 address as its IPv6 address and
informs to the relay UE. The relay UE maintains a mapping between link-local
IPv6 addresses to UE IDs (e.g. Application Layer IDs), as well as mapping from
an Application User ID to a PC5 unicast link.
The solution is based on the following assumptions:
1\. A source UE establishes a unicast link to a relay UE for communicating
with target UEs which connects to that relay UE.
2\. For a specific source UE, the traffic to target UEs through the same relay
UE can share the same unicast link to that relay UE.
3\. When the relay UE receives a packet from a source or target UE, it
forwards the packet to an PC5 unicast link according to the destination IP
address in the packet.
### 6.5.2 Procedures
In this clause, UE-1 and UE-2 are the source and target UEs, respectively.
Relay-1 is a Layer-3 UE-to-UE relay.
#### 6.5.2.1 Relay path establishment procedure
Step 1. UE-1 and UE-2 do the relay selection. In this step, any solution for
UE-to-UE relay selection can be applied here, e.g. solution#1.
Step 2. UE-1 and UE-2 establish individual unicast link to Relay-1, if they do
not have unicast link with the relay for the UE-to-UE relaying communication
use case.
UE forms its own link-local IPv6 address based on IETF RFC 4862 [12] and
informs the IP address to the relay UE. Relay UE maintains a mapping between
the UE ID (e.g. Application Layer ID) and the link-local address.
NOTE: If the link-local IP address of UE-1 or UE-2 is conflicting with the
link-local IP address of another remote UE that has already connected to the
relay UE, the relay shall inform UE-1 or UE-2 to change its link-local IP
address, e.g. using the address duplicate detection procedure defined in IETF
RCF 4862 [12].
Step 3. If UE-1 does not know the IP address of UE-2, it sends a request to
the relay UE, asking the IP address of UE-2. The request includes the UE-2 ID,
e.g. the Application Layer ID. Relay-1 gives the link-local IP address of UE-2
to UE-1. UE-2 does the same procedure if it does not know the IP address of
UE-1.
Step 4. UE-1 and UE-2 can communicate with each other via Relay-1.
When the remote UEs change Layer-3 UE-to-UE relay, they can keep their link-
local IP addresses. The old UE-to-UE relay shall remove the mapping between
the link-local IP address and the remote UE.
Editor\'s note: Whether and how to support periodic change of the link-local
IP address due to privacy requirement is FFS and co-ordinated with SA WG3
group.
Figure 6.5.2.1-1 UE-1 communicates with UE-2 via Layer-3 UE-to-UE relay
#### 6.5.2.2 Path switch from one UE-to-UE relay to another UE-to-UE relay
The following procedure depicts the scenario that UE-1 and UE-2 changes the
UE-to-UE relay from Relay-1 to Relay-2.
Figure 6.5.2.2-1 UE-1 and UE-2 change the communication path from the path via
Relay-1 to the path via Relay-2
1\. One of the remote UE detects the current UE-to-UE communication path is
not good enough or some other event triggers relay re-selection, so the relay
re-selection is executed.
NOTE 1: The reselection trigger for UE-2 can be based on, for example,
application layer trigger or based on current relay conditions.
2\. Any UE-to-UE (re)selection solution for Layer-3 UE-to-UE relay can be
applied here, and Relay-2 is selected as the new relay by UE-1 and UE-2.
3\. UE-1 and UE-2 establish unicast link individually to Relay-2. The UE-1 and
UE-2 keep their link-local addresses and inform the IP addresses to the
Relay-2. Relay-2 maintains a mapping between the UE IDs (e.g. Application
Layer IDs) and the link-local addresses.
This step can be skipped if the remote UE already has a unicast link with the
same link-local IPv6 address to Relay-2.
4\. UE-1 and UE-2 send an end marker through the old path to each other,
indicating that they start sending traffic via the new path.
NOTE 2: The UEs can wait for a predetermined period until the end marker is
received from each other before switching to new path. Such details are to be
developed during stage 3 work.
5\. UE-1 and UE-2 can communicate with each other via Relay-2.
### 6.5.3 Impacts on services, entities and interfaces
The solution impacts the relay UE to support IP packets forwarding between
remote UEs.
## 6.6 Solution #6: Support Layer-3 UE-to-UE Relay to Handle Non-IP Traffic
### 6.6.1 Description
#### 6.6.1.1 General
This solution addressed Key Issue #1 \"Support of UE-to-UE Relay\".
NOTE: The solution was Solution #49 of TR 23.752 [2].
The user plane protocol stack assumed in this contribution is illustrated by
Figure 6.6.1.1-1. Since there is no IP headers in the Non-IP packets, the UE-
to-UE relay cannot use destination IP addresses to forward the packets, In
this solution, the UE-to-UE relay uses the Layer-2 IDs in the incoming Layer-2
frames to find the correct outgoing PC5 links. Basically, the solution is
based on the following principles:
1\. For a specific source UE, it establishes a PC5 link for Non-IP traffic
with the UE-to-UE relay for each target UE it wants to communicate via that
relay. This principle means that the Non-IP traffic to different target UEs
from the same source UE cannot share the same PC5 link between the source UE
and the UE-to-UE relay.
2\. For each pair of source and target UEs, the UE-to-UE relay assigns itself
a Layer-2 ID, denoted as L2-ID_R, which is used in the Non-IP PC5 link to the
source UE and the Non-IP PC5 link to the target UE. The UE-to-UE relay
maintains a mapping between L2-ID_R and a pair of source and target UEs. The
source and target UEs store the mapping information when establishing relay
path between the source and target UEs via the UE-to-UE relay. When the source
and target UEs send Non-IP traffic to each other via the UE-to-UE relay, they
use L2-ID_R as the destination Layer-2 ID. When the UE-to-UE relay receives a
packet, according to the L2-ID_R and the source L2-ID it can forward the
packet to the correct PC5 link based on the mapping, it also changes the
destination L2-ID from L2-ID_R to the correct Layer2 ID of the target UE. The
source and target UEs identify the original UE when receiving packets from the
UE-to-UE relay according to the mapping information.
Figure 6.6.1.1-1: User plane protocol stack of PC5 when using Layer-3 UE-to-UE
relay to forward Non-IP traffic
#### 6.6.1.2 QoS handling
Regarding QoS handling, solution #4 is adopted to achieve end-to-end QoS
control via UE-to-UE relay. Basically, for a specific PC5 QoS flow, say PFI_s,
in the Non-IP PC5 link with the source UE, the UE-to-UE relay maps it to a
specific PC5 QoS flow, say PFI_t, in the Non-IP PC5 link with the target UE.
Incoming traffic from one of the flows is forwarded by the UE-to-UE relay to
the other flow.
#### 6.6.1.3 Security
For end-to-end security, IPsec cannot be used, since it is not IP traffic. It
is up to the application to implement end-to-end security for non-IP traffic.
Editor\'s note: How to handle end-to-end security for Non-IP traffic is FFS
and shall be co-ordinated with SA WG3 group.
### 6.6.2 Procedures
#### 6.6.2.1 Relay path establishment procedure
Figure 6.6.2.1-1 illustrates the procedure of path establishment procedure for
Non-IP traffic communication via a Layer-3 UE-to-UE relay.
0\. Source UE and target UE do the relay selection. In this step, any solution
for UE-to-UE relay selection can be applied here.
1\. Source UE wants to start Non-IP communication with the target UE. It
starts to establish a PC5 unicast link with the relay by sending a Direct
Communication Request to the relay as defined in clause 6.4.3.1 of TS 23.304
[3]. In the request, the source UE indicates that the PC5 link is used for
Non-IP communication to the target UE.
Editor\'s note: It is FFS if traffic type, e.g. IP or Non-IP, can be derived
from the ProSe Application ID.
2\. The UE-to-UE relay assigns itself a Layer-2 ID, denoted as L2-ID_R, which
is used in the Non-IP PC5 link to the source UE and the Non-IP PC5 link to the
target UE. The UE-to-UE relay creates the mapping between the L2-ID_R and the
pair of UEs.
3\. UE-to-UE relay sends a Direct Communication Request to the target UE,
indicating that the link is used for Non-IP communication with the source UE.
It also provides the mapping information in the request.
4\. Target UE and the UE-to-UE relay setup security for the PC5 link.
NOTE: Whether L2-ID_R is provided in step 3 or step 4 is coordinated with SA
WG3.
5\. Target UE stores the mapping information, and sends Direct Communication
Accept.
6\. UE-to-UE relay and the source UE setup security for the PC5 link.
7\. UE-to-UE relay sends Direct Communication Accept with L2-ID_R and provides
the mapping information. The resource UE stores the mapping information.
8\. Non-IP communication between the source and the target UE via the relay.
When the source and target UEs send Non-IP traffic to each other via the UE-
to-UE relay, they use L2-ID_R as the destination L2-ID. When the UE-to-UE
relay receives a packet, according to the L2-ID_R and the original UE L2-ID it
can forward the packet to the correct PC5 link based on the mapping between
the L2-ID_R and the pair of UEs, it also changes the destination L2-ID from
L2-ID_R to the correct L2-ID of the destination UE. The source and target UEs
identify the original UE when receiving packets from the UE-to-UE relay
according to the local stored mapping information.
Figure 6.6.2.1-1 Path establishment procedure for Non-IP traffic communication
via a Layer-3 UE-to-UE relay
#### 6.6.2.2 Layer-2 ID update procedure
Figure 6.6.2.2-1 illustrates the procedure of Link Identifier Update.
Figure 6.6.2.2-1 Link identifier update procedure for Non-IP PC5 link with a
Layer-3 UE-to-UE relay
1\. The source UE decides to change its identifier(s), it sends Link
Identifier Update Request with its new Layer2-ID to the UE-to-UE relay as
defined in clause 6.4.3.2 of TS 23.304 [3]. The source UE keeps sending data
traffic to the UE-to-UE relay with the old identifiers until it sends the Link
Identifier Update Ack to the relay.
2\. Upon receiving the Link Identifier Update Request message, the UE-to-UE
relay assigns a new L2-ID_R for the link with the source UE and the link with
the target UE.
3\. UE-to-UE relay sends Link Identifier Update Request to the target UE with
the new L2-ID_R and provides new source UE identifier. The UE-to-UE relay
keeps sending data traffic to the target UE with the old identifiers until it
sends the Link Identifier Update Ack to the target UE.
4\. Target UE sends Link Identifier Update Response with its new Layer2-ID.
The target UE continues to receive traffic with the old Layer-2 ID from UE-to-
UE relay until the target UE receives traffic with the new Layer-2 ID from the
relay. After sending the Link Identifier Update response, the target UE keeps
sending data traffic to the relay with the old identifier until it receives
the Link Identifier Update Ack message from the relay.
5\. UE-to-UE relay sends Link Identifier Update Response to the source UE with
the new L2-ID_R and provides new target UE identifier. The UE-to-UE relay
continues to receive traffic with the old L2-ID_R from the source and target
UE until it receives the traffic with new L2-ID_R from both the source and
target UEs. After sending the Link Identifier Update response, the UE-to-UE
relay keeps sending data traffic to the source UE with the old identifier
until it receives the Link Identifier Update Ack message from the source UE.
6\. The source UE sends the Link Identifier Update Ack to the UE-to-UE relay.
The source UE continues to receive traffic with the old Layer-2 ID from the
relay until the source UE receives traffic with the new Layer-2 ID from the
relay.
After step 5 and step 6, the UE-to-UE relay maintains a mapping between the
new L2-ID_R and the new identifiers of the source and target UEs. The UE-to-UE
relay keeps the mapping between the old L2-ID_R and the old identifiers of the
source and target UEs until the relay receives the traffic with the new
identifiers from both the source and target UEs.
7\. The UE-to-UE relay sends Link Identifier Update Ack to the target UE.
8\. The source and target UEs start using their new identifiers and the UE-to-
UE relay starts to use the new L2-ID_R. Based on the new mapping information,
the UE-to-UE relay transfers the packets accordingly, and the source and
target UEs identify the original UE when receiving packets from the UE-to-UE
relay.
### 6.6.3 Impacts on Existing Nodes and Functionality
The UE-to-UE relay needs to support the mapping between the L2-ID_R and the
pair of source and target UEs. Regarding QoS handling, the impact to the UE-
to-UE relay is the same as solution# 4.
The source and target UEs identify the original UE when receiving packets from
the UE-to-UE relay based on the mapping information.
## 6.7 Solution #7: Negotiated UE-to-UE Relay Reselection
### 6.7.1 Description
This solution provides a solution for UE-to-UE Relay reselection in Key Issue
#1. Since the solution is independent of how the relay forwards traffic
between Source UE and Target UE this solution is applicable to both Layer 2
UE-to-UE Relays and Layer 3 UE-to-UE Relays.
NOTE: The solution was Solution #50 of TR 23.752 [2] and has been updated.
Solution#1 provides a solution for UE-to-UE Relay Selection, and this solution
is suitable for initial Relay selection and it could be extended for UE-to-UE
Relay reselection. However, it will cause the UE-to-UE Relay in proximity
broadcast the relay discovery message. Under some cases, these broadcast
messages can be avoided, by Source UE and Target UE negotiating the relay
reselection using the existing relay connection.
After the connection between Source UE and Target UE is setup, the Source UE
and Target UE may receive relay discovery messages from the other UE-to-UE
Relays. The Source UE or Target UE may find that the signal quality with other
UE-to-UE Relays is better than that with the currently used UE-to-UE Relay.
Alternatively if the Source UE or Target UE finds that the signal quality with
the selected UE-to-UE Relay is not good enough, it will initiate the discover
message to find the candidate UE-to-UE Relays which can provide a better
connection. After new candidate UE-to-UE Relays have been identified, the
Source UE or Target UE will initiate the relay reselection procedure and then
these two UEs can negotiate UE-to-UE Relay reselection using the existing
relay connection.
### 6.7.2 Procedures
Figure 6.7.2-1: UE-to-UE Relay Reselection Procedure
1\. Connection between Source UE and Target UE via Relay 1 is setup by using
the other, and Relay 1 is selected as UE-to-UE Relay, such as by using the
Solution #1.
2\. The Source UE decides to perform UE-to-UE Relay reselection. This may be
triggered by receiving the relay discovery message from another UE-to-UE
Relay, and the signal quality with this UE-to-UE Relay is better than that
with Relay 1. Alternatively the Source UE will initiate the discover message
to find candidate UE-to-UE Relays which can provide a better connection, when
it finds that the signal quality with Relay 1 is not good enough.
3\. After the Source UE identifies the candidate UE-to-UE Relays, the Source
UE sends the UE-to-UE Relay reselection request to the Target UE using the
connection via Relay 1, and the request message includes the candidate UE-to-
UE Relay ID(s) ordered by the Source UE\'s preference based on e.g. the signal
quality of UE-to-UE Relays. The request message may include the Layer-2 ID(s)
of the candidate UE-to-UE Relay ID(s).
NOTE 1: Details of UE-to-UE Relay reselection request message and how the
message is forwarded by UE-to-UE Relay depends on the Layer 2 UE-to-UE Relays
and Layer 3 UE-to-UE Relays solution.
4\. The Target UE decides to change from Relay 1 to a new UE-to-UE Relay. The
new UE-to-UE Relay is chosen from the candidate UE-to-UE Relay ID(s) included
in the reselection request. This decision can be based on a new UE-to-UE Relay
providing the best signal quality, additionally based on the order of
candidate UE-to-UE Relay ID (s) received from the Source UE. If the Target UE
has not received a relay discovery message from a candidate UE-to-UE Relay or
does not connect to the candidate UE-to-UE Relay, the Target UE may perform
the UE-to-UE Relay discovery procedure with a candidate UE-to-UE Relay ID in
discovery message, and may set the Layer-2 ID of the candidate UE-to-UE Relay,
if received at step 3, as the Destination Layer-2 ID to carry the discovery
message.
NOTE 2: Whether and how the signal quality information is used for candidate
UE-to-UE Relay selection needs to be coordinated with RAN WG.
5\. The Target UE sends a response to the Source UE via Relay 1 that includes
the new UE-to-UE Relay ID. If no new UE-to-UE Relay is chosen, the Target UE
may not respond to Source UE or send a response indicating Relay reselection
failure.
6\. [Optional] If the Target UE choses a new UE-to-UE Relay in step 5, the
Source UE initiates the connection setup procedure via the new UE-to-UE Relay,
and also releases the connection via Relay 1.
#### 6.7.2.1 Layer-2 based UE-to-UE Relay Re-selection
Figure 6.7.2.1-1 illustrates the procedure for UE-to-UE Relay re-selection for
Layer-2 based.
Figure 6.7.2.1-1: Layer-2 based UE-to-UE Relay Re-selection
1\. A PC5 unicast link is established between Source UE and Target UE via
Relay 1 (using any L2 UE-to-UE Relay solution).
2\. Traffic is exchanged between the Source UE and the Target UE over the PC5
unicast link, via Relay 1.
3\. Source UE detects a condition or receives a trigger to change the UE-to-UE
Relay. The Source UE may perform a discovery procedure to obtain a list of
candidate UE-to-UE Relay IDs (i.e. RIDs).
4\. Source UE sends a Link Modification Request message to Target UE (via
Relay 1) including a Relay re-selection indication, a list of candidate RIDs
and a source UE link ID, which is used on the Source UE, at steps 9 and/or 10,
to associate the existing PC5 unicast link via Relay 1 to the replacing PC5
unicast link with the selected Relay (e.g. Relay 2).
5\. Target UE selects a Relay from the received list of candidate RIDs (e.g.
Relay 2).
6\. Target UE sends a Link Modification Accept message to Source UE (via Relay
1) including the Relay re-selection indication, its Selected RID and a target
UE link ID, which is used on the Target UE, at step, 8 to associate the
existing PC5 unicast link via Relay 1 to the replacing PC5 unicast link with
the selected Relay (i.e. Relay 2).
There are two options for the E2E PC5 connection establishment with the newly
selected UE-to-UE Relay. Option A is from Step 7 to Step 11, where the per-hop
links are established during the E2E PC5 link establishment procedure. Option
B is from Step 12 to Step 13, where the per-hop links are established before
the E2E PC5 link establishment procedure.
7\. Source UE sends a broadcast Direct Communication Request (DCR) message
including the Target UE user info, and the Selected RID and the target UE link
ID received from Target UE during the Relay re-selection at step 6.
8\. Relay 2 receives the DCR message and verifies if the \"Selected RID\"
value matches its own RID and forwards the DCR message only if the \"Selected
RID\" value matches its own RID. The UE-to-UE Relay adds its RID to the
forwarded DCR message (as specified in Layer-2 based sol #9 of TR 23.752 [2]).
Target UE receives the DCR message and validates that the target UE link ID
matches its link ID as previously sent to Source UE (at step 6). Target UE
also verifies that the DCR message is received from its selected RID (i.e.
RID2). Target UE uses the target UE link ID to find the previous PC5 unicast
link to be replaced by the new PC5 unicast link. The association between the
Application Layer identifier and the PC5 unicast link via Relay 1 is updated
with the new PC5 unicast link via Relay 2 once the traffic is ready to be
switched to the new PC5 unicast link (via Relay 2) (i.e. at step 12).
9\. Target UE may trigger the security establishment procedure, via Relay 2,
and include the source UE link ID, as received on the Link Modification
Request at step 4. The security establishment procedure may be skipped if the
existing security context used with the previous PC5 unicast link is re-used
with the replacing PC5 unicast link, allowing a quicker link setup and path
switching. Source UE uses the source UE link ID to find the previous PC5
unicast link with Relay 1 to be replaced by the new PC5 unicast link being
established (i.e. via Relay 2). The association between the Application Layer
identifier and the PC5 unicast link via Relay 1 is updated with the new PC5
unicast link via Relay 2 once the traffic is ready to be switched to the new
PC5 unicast link (via Relay 2) (i.e. at step 12).
10\. Target UE sends a Direct Communication Accept message which may include
the source UE link ID from Source UE as received at step (4).
11\. A new PC5 unicast link is established between the Source UE and Target UE
via the Relay 2.
12\. This step is same as step 3 of Figure 6 30.2.1.2-1 in Sol#30.
13\. This step is same as steps 4-6 of Figure 6.30.2.2-1 in clause 6.3.2.2 of
Sol#30 with the target UE link ID received from Target UE during the Relay
reselection at step 6 specified on the DCR message. Target UE uses the target
UE link ID to find the previous PC5 unicast link to be replaced by the new PC5
unicast link. Target UE may trigger the security establishment procedure, via
Relay 2, and include the source UE link ID, as received on the Link
Modification Request at step 4\. Source UE uses the source UE link ID to find
the previous PC5 unicast link with Relay 1 to be replaced by the new PC5
unicast link being established (i.e. via Relay 2)
14\. Source UE and Target UE switch the data traffic to the new PC5 unicast
link via Relay 2. Source UE or Target UE may terminate the PC5 unicast link
via Relay 1.
#### 6.7.2.2 Layer-3 based UE-to-UE Relay Re-selection
Figure 6.7.2.2-1 illustrates the procedure for UE-to-UE Relay re-selection for
Layer-3 based solution (as defined in Sol#2).
Figure 6.7.2.2-1: Layer-3 based UE-to-UE Relay Re-selection
1\. Source UE has a PC5 unicast link established with Relay 1.
1a. Target UE has a PC5 unicast link established with Relay 1 and exchange IP
packets via Relay 1.
2\. Source UE has a PC5 unicast link established with Relay 2.
2a. Target UE has a PC5 unicast link established with Relay 2.
3\. Source UE and Target UE exchange IP packets via Relay 1.
4\. Source UE detects or receives a trigger to change the Relay.
5\. Source UE sends a PC5 Link Modification Request message for Target UE (via
the PC5 unicast link with Relay 1) which includes a Relay reselection
indication, a list of candidate Relay IDs (RIDs), Source UE and Target UE IP
addresses used to communicate via Relay 1. The IP addresses are specified
since the PC5 Link Modification message does not include these IP addresses
which are needed at the Relay to fetch the corresponding PC5 unicast link from
its mapping table toward the Target UE (as specified in sol#2).
The list of candidate RIDs is selected based on the PC5 unicast links already
established between Source UE and such Relays (RIDs). The IP address of
multiple Target UE s may be specified in the case where Source UE is
communicating with multiple Target UEs via Relay 1.
6\. Relay 1 determines that the message is destined to the Target UE based on
the \"Relay reselection indication\" and Target UE\'s IP address. Relay 1
sends a PC5 Link Modification Request message to Target UE\'s IP address (as
specified in the message); if multiple Target UEs are impacted, the Relay 1
sends a PC5 Link Modification Request to each of these Target UEs.
7\. Based on the relay reselection indication, Target UE knows that the
communication with Source UE needs to be handled via another Relay. Target UE
selects a RID from the list of candidate RIDs. Target UE may select a RID with
which a PC5 unicast link is already established or Target UE may establish a
new link with the selected RID.
8\. Target UE sends a Link Modification Accept message to Relay 1, which
includes a Relay reselection indication, Source UE and Target UE IP addresses
used via Relay 1, and Target UE\'s IP address used via Relay 2 and the
selected RID (e.g. RID2).
9\. Relay 1, based on the relay reselection indication, sends a PC5 Link
Modification Accept message to Source UE using the specified Source UE\'s IP
address.
10\. Source UE extracts the selected Relay ID (RID2) from the Link
Modification Accept message and sends a Link Modification Ack message which
includes its IP address associated to Relay 2.
11\. Relay 2 receives this message and forwards it to the Target UE since the
Relay reselection indication is specified. This Ack message is needed to
synchronise the switch of traffic between the Source UE and Target UE, via the
selected UE (Relay 2), at the same time.
12\. From this point on, Source UE and Target UE switch the IP traffic to the
new PC5 unicast link via Relay 2 (since Source UE and Target UE have exchanged
their respective IP address in above steps they can skip performing DNS query
steps with Relay 2).
### 6.7.3 Impacts on services, entities and interfaces
Source UE:
\- Identifies the candidate UE-to-UE Relays, and initiates Relay reselection
via the existing connection.
Target UE:
\- Decides the new UE-to-UE Relay.
UE-to-UE Relay:
\- Sends/receives discovery messages to/from the Source UE or the Target UE.
## 6.8 Solution #8: Authorization for 5G ProSe UE-to-UE Relay Service
### 6.8.1 Description
This solution addresses KI#1 and #6, and applies to both Layer-2 and Layer-3
UE-to-UE Relay.
NOTE 1: The solution was Solution #36 of TR 23.752 [2]. This solution
continues to use terms from TR 23.752 [2], including Remote UE, Source UE and
Target UE which are 5G ProSe U2U UEs.
For KI#1 (Support of UE-to-UE Relay), following aspects are covered:
\- Authorize the UE-to-UE Relay, e.g. authorize a UE as UE-to-UE Relay.
\- Authorize Source/Target UEs to use a UE-to-UE Relay.
\- Provisioning policy and parameters for UE-to-UE Relay service.
For KI#6 (Support of PC5 Service Authorization and Policy/Parameter
Provisioning), two following major aspects are covered:
\- What are necessary enhancements for the procedures related to PC5 service
authorization and policy/parameter provisioning to a UE, compared with what is
currently specified in clause 5.1 of TS 23.304 [3] and clauses 4.2.2.2
(Registration Procedure), 4.2.4.3 (UE Configuration Update procedure for
transparent UE Policy Delivery), 4.16.11 (UE Policy Association Establishment
procedure), 4.16.12 (UE Policy Association Modification procedure) of TS
23.502 [8].
\- what are new information for PC5 service authorization and provisioning
beyond what is currently specified in clause 5.1 of TS 23.304 [3].
The PCF based service authorization and provisioning as defined in TS 23.304
[3] are used as baseline for this solution.
NOTE 2: When the UE-to-UE Relay is out of coverage, it can act as a UE-to-UE
Relay based on the preconfigured policy and parameters.
NOTE 3: When the 5G ProSe UE is out of coverage, it can act as a 5G ProSe U2U
UE, i.e. Remote UE for UE-to-UE Relay service, based on the preconfigured
policy and parameters.
The procedures for Service Authorization to NG-RAN as defined in clause 6.6 of
TS 23.304 [3] are used as baseline for this solution.
### 6.8.2 Procedures
#### 6.8.2.1 Procedure Enhancement for Information Provisioning to a 5G ProSe
Remote UE/UE-to-UE Relay
For PCF based Service Authorization and Provisioning to 5G ProSe Remote UE/UE-
to-UE Relay, the Registration procedures as defined in clause 4.2.2.2 of TS
23.502 [8], UE Policy Association Establishment procedure as defined in clause
4.16.11 of TS 23.502 [8] and UE Policy Association Modification procedure as
defined in clause 4.16.12 of TS 23.502 [8] apply with the following additions:
\- If the UE indicates 5G ProSe capability as a 5G ProSe Layer-2/Layer-3
Remote UE/UE-to-UE Relay in the Registration Request message and if the UE is
authorized to be a 5G ProSe Layer-2/Layer-3 Remote UE/UE-to-UE Relay based on
subscription data, the AMF selects the PCF which supports 5G ProSe information
provisioning and establishes a UE policy association with the PCF for 5G ProSe
Layer-2/Layer-3 Remote UE/UE-to-UE Relay information provisioning delivery.
\- If the UE supports 5G ProSe capability as a Layer-2/Layer-3 Remote UE/UE-
to-UE Relay and it does not have valid 5G ProSe Remote UE/UE-to-UE Relay
information, the UE includes the UE Policy Container with indicating the 5G
ProSe UE-to-UE Relay Information Provisioning request during registration
procedure.
\- If the UE indicates the 5G ProSe Remote UE/UE-to-UE Relay Information
Provisioning request in the UE Policy Container, the PCF determines whether to
provision the 5G ProSe Remote UE/UE-to-UE Relay Information to the UE, as
specified in clause 6.1.2.2.2 of TS 23.503 [13], and the PCF provides the 5G
ProSe Remote UE/UE-to-UE Relay Information to the UE by using the procedure as
defined in clause 4.2.4.3 \"UE Configuration Update procedure for transparent
UE Policy Delivery\" in TS 23.502 [8].
The PCF may update the 5G ProSe Policy and parameters to the UE in following
conditions:
\- UE Mobility, e.g. UE moves from one PLMN to another PLMN. This is achieved
by using the procedure of UE Policy Association Modification initiated by the
AMF, as defined in clause 4.16.12.1 of TS 23.502 [8].
\- When there is a subscription change in the list of PLMNs where the UE is
authorized to perform the 5G operation. This is achieved by using UE Policy
Association Modification initiated by the PCF procedure as defined in clause
4.16.12.2 of TS 23.502 [8].
\- When there is a change of service specific parameter as described in clause
4.15.6.7 of TS 23.502 [8].
If the serving PLMN is removed from the list of PLMNs in the service
authorization parameters, the service authorization is revoked in the UE.
When the UE is roaming, the change of subscription resulting in updates of the
service authorization parameters are transferred to the UE by H-PCF via V-PCF.
The UE may perform UE triggered Policy Provisioning procedure to the PCF as
specified in clause 6.2.4 of TS 23.304 [3] when the UE determines the 5G ProSe
Policy and parameters are invalid (e.g. Policy/Parameter is outdated, missing
or invalid).
#### 6.8.2.2 The Policy/parameter to a 5G ProSe UE-to-UE Relay
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe UE-to-UE Relay:
1) Authorisation policy for acting as a 5G ProSe UE-to-UE Relay:
\- when the UE is \"served by NG-RAN\":
\- PLMNs in which the UE is authorized to relay traffic for 5G Remote UE
accessing UE-to-UE Relays over PC5 reference point.
\- when the UE is \"not served by NG-RAN\":
\- Indicates whether the UE is authorized to be a UE-to-UE Relay over PC5
reference point.
2) Radio parameters when the UE is \"not served by NG-RAN\":
\- Includes the radio parameters NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform UE-to-UE Relay
discovery and communication procedures only if the UE can locate itself in the
corresponding Geographical Area. Otherwise, the UE is not authorised to
transmit.
3) 5G ProSe Relay Discovery policy/parameters for 5G ProSe UE-to-UE Relay:
\- Includes the parameters that enable the UE to perform 5G ProSe Relay
Discovery as a UE-to-UE Relay when provisioned from the PCF in the ME or
configured in the UICC:
\- 5G ProSe UE-to-UE Relay Discovery parameters per ProSe Service;
\- User Info ID, Relay Service Code(s), UE-to-UE Relay Layer indicator(s),
Traffic type (IP or non-IP); the UE-to-UE Relay Layer Indicator indicates
whether a particular RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-UE
Relay service. Discovery parameters are described in clause 6.H.2.4
\- Default Destination Layer-2 ID(s) for sending Relay Discovery Solicitation
messages and receiving Relay Discovery Announcement and Relay Discovery
Additional Information messages;
\- Security related content for 5G ProSe Relay Discovery for each 5G ProSe
Relay Service Code.
\- Validity time indicating the expiration time of the Policy/Parameter for 5G
ProSe UE-to-UE Relay discovery and communication.
#### 6.8.2.3 The Policy/parameter to a 5G ProSe Remote UE
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe Remote UE accessing a UE-to-UE Relay:
1) Authorisation policy for acting as a 5G ProSe Remote UE:
\- when the UE is \"served by NG-RAN:
\- PLMNs in which the UE is authorized to access UE-to-UE Relays over PC5
reference point.
\- when the UE is \"not served by NG-RAN:
\- Indicates whether the UE is authorized to access a UE-to-UE Relay over PC5
reference point.
2) Radio parameters when the UE is \"not served by NG-RAN\":
\- Includes the radio parameters NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform UE-to-UE Relay
discovery and communication procedures only if the UE can locate itself in the
corresponding Geographical Area. Otherwise, the UE is not authorised to
transmit.
3) 5G ProSe Relay Discovery policy/parameters for 5G ProSe Remote UE:
\- Includes the parameters that enable the UE to perform 5G ProSe Relay
Discovery as a 5G ProSe Remote UE when provisioned from the PCF in the ME or
configured in the UICC:
\- 5G ProSe UE-to-UE Relay Discovery parameters per ProSe Service;
\- User Info ID, Relay Service Code(s), UE-to-UE Relay Layer indicator(s),
Traffic type (IP or non-IP); the UE-to-UE Relay Layer Indicator indicates
whether a particular RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-UE
Relay service. Discovery parameters are described in clause 6.H.2.4
\- Default Destination Layer-2 ID(s) for sending Relay Discovery Solicitation
messages and receiving Relay Discovery Announcement and Relay Discovery
Additional Information messages;
\- Security related content for 5G ProSe Relay Discovery for each 5G ProSe
Relay Service Code.
\- Validity time indicating the expiration time of the Policy/Parameter for 5G
ProSe UE-to-UE Relay discovery and communication.
#### 6.8.2.4 5G ProSe UE-to-UE Relay Discovery parameters
5G ProSe UE-to-UE Relay Discovery parameters include:
\- User Info ID: For Model A, this corresponds to the Announcer Info parameter
when the UE is acting as an announcing UE. For Model B, this corresponds to
the Discoverer Info in Solicitation messages and the Discoveree Info in
Response messages, when the UE is acting as a discoverer or discoveree UE
respectively.
\- Relay Service Code(s): A Relay Service Code identifies a connectivity
service the ProSe UE-to-UE Relay provides to applications. The Relay Service
Codes are configured in the ProSe UE-to-UE Relays that provide connectivity
services to applications. The Relay Service Codes are configured in the Remote
UEs interested in related connectivity services.
#### 6.8.2.5 Procedures for Service Authorization related to UE-to-UE Relay
operation to NG-RAN
If the AMF receives the 5G ProSe capability as a 5G ProSe Layer-2/Layer-3
Remote UE/UE-to-UE Relay in the Registration Request message from UE, the AMF
further reports the 5G ProSe capability as a 5G ProSe Layer-2/Layer-3 Remote
UE/UE-to-UE Relay to the selected PCF. The PCF determines the 5G ProSe
Layer-2/Layer-3 Remote UE/UE-to-UE Relay information based on the received 5G
ProSe capability as a 5G ProSe Layer-2/Layer-3 Remote UE/UE-to-UE Relay.
Regarding UE-to-UE Relay operation, \"5G ProSe authorised\" information sent
by the AMF to NG-RAN may include one or more of the following:
1) whether the UE is authorized to act as a 5G ProSe Layer-2 UE-to-UE Relay;
2) whether the UE is authorized to act as a 5G ProSe Layer-3 UE-to-UE Relay;
3) whether the UE is authorized to act as a 5G ProSe Layer-2 U2U UE;
4) whether the UE is authorized to act as a 5G ProSe Layer-3 U2U UE.
Editor\'s note: Coordination with RAN WGs is needed to decide whether the \"5G
ProSe authorised\" information needs to be enhanced to include the above
information and if so which bullet(s) need to be included.
### 6.8.3 Impacts on services, entities and interfaces
5G ProSe UE-to-UE Relay:
\- Indicates 5G ProSe capability as a UE-to-UE Relay in the Registration
Request message;
\- Includes the UE Policy Container with indicating the 5G ProSe UE-to-UE
Relay Information Provisioning request during registration procedure;
\- Receive and enforce the Policy and parameter as 5G ProSe UE-to-UE Relay.
\- Act as a 5G ProSe UE-to-UE Relay for direct discovery and communication.
5G ProSe Remote UE:
\- Indicates 5G ProSe capability as a Remote UE accessing UE-to-UE Relay in
the Registration Request message;
\- Includes the UE Policy Container with indicating the 5G ProSe Remote UE
accessing a UE-to-UE Relay Information Provisioning request during
registration procedure;
\- Receive and enforce the Policy and parameter as 5G ProSe Remote UE
accessing a UE-to-UE Relay.
\- Act as a 5G ProSe Remote UE for direct discovery and communication.
AMF:
\- Determine whether UE is authorized to be a 5G ProSe Remote UE/UE-to-UE
Relay;
\- Select a PCF capable of authorization Policy and parameter for 5G ProSe
Remote UE/UE-to-UE Relay;
\- Forward UE\'s PC5 Capability for 5G ProSe Remote UE/UE-to-UE Relay to PCF.
\- Provision the NG-RAN with indication about the UE authorization status
related to UE-to-UE Relay operation.
Editor\'s note: Coordination with RAN WGs is needed.
PCF:
\- Send the Authorization Policy and parameter to 5G ProSe Remote UE/UE-to-UE
Relay.
## 6.9 Solution #9: Model A discovery for 5G ProSe Layer-3 UE-to-UE Relay
scenario
### 6.9.1 Description
In this solution, the 5G ProSe UE-to-UE Relay operations follow with the
following principles:
\- The 5G ProSe UE-to-UE Relay sends out a Relay Announcement message
periodically, announcing its availability for serving other UEs in the area.
\- A 5G ProSe-enabled UE decides if it can be connected via a 5G ProSe UE-to-
UE relay by sending a message to the relay, so that the relay can add the UE
into its neighbour list.
\- For supporting more than one hop, if required in the future, a hop count
per UE in the announcement message could be added if/when multi-hop is added.
\- RSC used in the UE-to-UE Relay communication setup procedure is selected
during UE-to-UE Relay discovery procedures. The RSC can be associated with one
or multiple ProSe identifier(s). The UE-to-UE Relay, the source UE and the
target UE are aware of whether an RSC is offering Layer-2 or Layer-3 UE-to-UE
Relay service, and whether an RSC is for IP or non-IP based the configured
policy.
### 6.9.2 Procedures
Figure 6.9.2-1: 5G ProSe UE-to-UE Relay operation
Figure 6.9.2-1 provides an example operation for the 5G ProSe UE-to-UE Relay
1\. Authorization /parameter provisioning for UE-to-UE Relay Service has been
performed.
2a. A ProSe 5G UE-to-UE Relay sends out a Relay Announcement message
periodically to its proximity, announcing its availability as a UE-to-UE
relay. In the Announcement message, it includes its User Info ID, a Relay
Service Code (RSC), a list of UEs that are reachable by the relay, we can call
it target UE list.
2b. When a UE receives a Relay Announcement message, it can decide if it can
use the relay according to e.g. Relay Service Code, the User Info ID (e.g.
only use some specific UE-to-UE relays). If the relay can serve the UE and the
UE wants to be discovered by other UEs via this relay, the UE will send an
Announcement message with its own User Info ID and the relay User Info ID.
When the relay receives an Announcement message from a UE and the message
contains the User Info ID of the relay, the relay will add the User Info ID of
that UE into its target UE list.
When a 5G ProSe UE-to-UE relay receives an Announcement message with target UE
list, it may, according to its configuration or policy, add the target the UE
list in it own target UE list for each target UE.
3\. When the source UE wants to communicate with the target UE via a UE-to-UE
relay, the source UE will choose a relay whose target UE list includes the
corresponding target UE ID. If there are multiple relays can reach the target
UE, then the source UE may select the relay according to relay selection
criteria.
4a, 4b. The source UE may establish a PC5 link with the selected 5G ProSe UE-
to-UE Relay and the 5G ProSe UE-to-UE Relay may establish a PC5 link with the
target UE. The details will be addressed in other solutions of KI#1.
The ProSe 5G UE-to-UE Relay stores an association of the User Info of the peer
UE of the unicast link and the IP address/prefix of the UE into its DNS
entries. The 5G ProSe UE-to-UE Relay acts as a DNS server to other UEs.
5\. For IP traffic, the source UE sends a DNS query for the target UE (based
on Target User Info to the 5G ProSe UE-to-UE Relay over the unicast link),
which will return the IP address/prefix of the target UE.
### 6.9.3 Impacts on services, entities and interfaces
\- For IP traffic, the UE-to-UE Relay acts as an IP router and DNS server.
\- For non-IP traffic, the UE-to-UE Relay performs traffic relaying based on a
mapping between the links with source UE and the links with target UE.
## 6.10 Solution #10: Consolidated Solution for UE-to-UE Relay discovery and
selection based on Model A and Model B discovery
### 6.10.1 Description
This solution applies to Key Issue #1 \"Support of UE-to-UE Relay\". The Model
A discovery and Model B discovery procedures proposed in this solution are
common procedures applicable for both Layer-2 UE-to-UE Relay and Layer-3 UE-
to-UE Relay.
This solution is a consolidated solution for UE-to-UE Relay discovery and
selection based on sol#1 alt2(Model B discovery) and sol#3(Model A discovery).
RSC is used in the UE-to-UE Relay discovery to indicate the connectivity
service the UE-to-UE Relay provides to the source UE. The RSC can be
associated with one or multiple ProSe identifier(s). The UE-to-UE Relay, the
source UE and the target UE are aware of whether an RSC is offering Layer-2 or
Layer-3 UE-to-UE Relay service based configured policy.
NOTE: Source UE, target UE, UE-to-UE Relay decide the RSC used for UE-to-UE
Relay discovery based on the Policy/Parameter Provisioning solutions of KI#6
(Support of PC5 Service Authorization and Policy/Parameter Provisioning).
This solution doesn\'t assume the discovery procedure is followed by
communication procedure, thus the UE-to-UE Relay doesn\'t store info for the
communication setup in future.
For Model A discovery, the UE-to-UE Relay periodically transmits an
Announcement message contains RSC, a list of User Info ID and Layer-2 ID of
the potential target UEs. The source UE monitors announcement messages to
select the UE-to-UE Relay and get the Layer-2 ID of the target UE.
For Model B discovery, the source UE sends a Discovery Solicitation message
contains RSC and optional User Info ID of the target UE, then the UE-to-UE
Relay that matches the RSC broadcasts discovery solicitation message. The
target UE that matches the RSC and optional the User Info ID of the target UE
responds to the UE-to-UE Relay with a Discovery Response message, the UE-to-UE
Relay sends a Discovery Response message which contains the User Info ID and
Layer-2 ID of the target UE and RSC to the source UE. The source UE selects
the UE-to-UE Relay and gets the Layer-2 ID of the target UE.
Editor\'s note: The privacy and authentication/authorization issues are FFS
and need to coordinate with SA WG3.
### 6.10.2 Procedures
#### 6.10.2.1 Model A discovery
Depicted in figure 6.10.2.1-1 is the procedure for UE-to-UE Relay discovery
Model A.
Figure 6.10.2.1-1: UE-to-UE Relay discovery with Model A
1\. The UE-to-UE Relay decides that it can act as a UE-to-UE Relay based on
configured policy, and the UE-to-UE Relay determines a list of User Info ID
and Layer-2 ID of the target UEs it can announce based on the previous
discovery or based on existing or prior communication between the UE-to-UE
Relay and the target UEs. For example, the UE-to-UE Relay may perform the
Group Member Discovery procedure (either Model A or Model B) or Direct
Discovery procedure (either Model A or Model B) with the RSC it supports to
discover target UEs it can announce.
NOTE: In order to keep an up-to-date target UE list, UEs want to be discovered
by other UEs via the UE-to-UE Relay periodically performs the Discovery
procedure, or response to the UE-to-UE Relay Announcement as described in
sol#9. The UE-to-UE Relay, by implementation, removes specific target UE info
from the target UE list after its expiration.
2\. The UE-to-UE Relay periodically transmits an Announcement message. The
Announcement message contains the Type of Discovery Message, User Info ID of
the UE-to-UE Relay, RSC, a list of User Info ID and Layer-2 ID of the target
UEs. The Source Layer-2 ID of the Announcement message is self-assigned by the
UE-to-UE Relay, the Destination Layer-2 ID is selected based on the configured
policy.
3\. The source UE monitors announcement messages with the RSC and the User
Info ID of the target UE. The source UE selects the UE-to-UE Relay and gets
the Layer-2 ID of the target UE based on the information received in step 1.
#### 6.10.2.2 Model B discovery
Depicted in figure 6.10.2.2-1 is the procedure for UE-to-UE Relay discovery
Model B.
Figure 6.10.2.2-1: UE-to-UE Relay discovery with Model B
1\. The source UE sends a Discovery Solicitation message contains the Type of
Discovery Message, User Info ID of the source UE, RSC and optional User Info
ID of the target UE and a relay indication. The Source Layer-2 ID is self-
assigned by the source UE, the Destination Layer-2 ID is selected based on the
configured policy. The relay indication indicates how many hops that the
source UE wants the discovery message to be forwarded away.
NOTE: In Release 18, the value of relay indication is set to one and may not
be needed.
2\. On reception of discovery solicitation message, the UE-to-UE Relay that
matches the RSC broadcasts discovery solicitation message contains the Type of
Discovery Message, User Info ID of the source UE, User Info ID of the UE-to-UE
Relay, RSC, and optional User Info ID of the target UE. The Source Layer-2 ID
is self-assigned by the UE-to-UE Relay, the Destination Layer-2 ID is selected
based on the configured policy. If the relay indication is 0, then the relay
UE will not broadcast the discovery message, otherwise, it will decrease the
relay indication by 1 and update it in the discovery message.
3\. The target UE that matches the RSC which is associated to its desired
connectivity service and optional the User Info ID of the target UE responds
to the UE-to-UE Relay with a Discovery Response message. The Discovery
Response message contains the Type of Discovery Message, User Info ID of the
target UE, User Info ID of the UE-to-UE Relay, User Info ID of the source UE,
and RSC. The Source Layer-2 ID is self-assigned by the target UE, the
Destination Layer-2 ID is the Source Layer-2 ID of the received Discovery
Solicitation message from UE-to-UE Relay. If the target UE receives multiple
discovery solicitation messages from different UE-to-UE Relays, i.e. UE-to-UE
Relay-1 and UE-to-UE Relay-2 in the figure, it responds to each UE-to-UE Relay
separately.
4\. The UE-to-UE Relay sends a Discovery Response message contains the Type of
Discovery Message, User Info ID and Layer-2 ID of the target UE, User Info ID
of the UE-to-UE Relay, User Info ID of the source UE, and RSC. The Source
Layer-2 ID is self-assigned by the UE-to-UE Relay, the Destination Layer-2 ID
is the Source Layer-2 ID of the received Discovery Solicitation message from
source UE. The Layer-2 ID of the target UE in the Discovery Response message
is the Source Layer-2 ID of the received message from target UE in step 3.
5\. The source UE performs the UE-to-UE Relay selection.
### 6.10.3 Impacts on services, entities and interfaces
UE:
\- New functionality related to UE-to-UE Relay discovery and selection.
## 6.11 Solution #11: Consolidated Solution for Layer-3 UE-to-UE Relay
communication setup after Model A and Model B discovery
### 6.11.1 Description
This solution applies to Key Issue #1 \"Support for UE-to-UE Relay\" to
support communication setup for Layer-3 UE-to-UE Relay. It can be taken as a
merged and consolidated solution of sol#5, Sol#6 and Sol#4. The assumption is
that source UE has selected a suitable UE-to-UE Relay and received the Layer-2
ID of the target UE after Model A or Model B discovery.
RSC used in the UE-to-UE Relay communication setup procedure is selected
during UE-to-UE Relay discovery procedures. The RSC can be associated with one
or multiple ProSe identifier(s). The UE-to-UE Relay, the source UE and the
target UE are aware of whether an RSC is offering Layer-2 or Layer-3 UE-to-UE
Relay service, and whether an RSC is for IP or non-IP based the configured
policy.
This solution is applicable for both IP and non-IP traffic. For non-IP
traffic, the UE-to-UE Relay stores the 1:1 mapping between the link with
source UE and the link with target UE, thus Direct Communication Request is
always provided by source UE to the UE-to-UE Relay and provided by the UE-to-
UE Relay to target UE. For IP traffic, the UE-to-UE Relay acts as an IP
router, the link between source UE and UE-to-UE Relay can be shared by
multiple target UEs, the link between UE-to-UE Relay and target UE can be
shared by multiple source UEs. If there\'s no PC5 link between source UE and
the UE-to-UE Relay existing for the required RSC, or for non-IP traffic
transmitting, Source UE sends the Direct Communication Request to the UE-to-UE
Relay which contains User Info ID of UE-to-UE Relay, User Info ID and Layer-2
ID of target UE, RSC. If there\'s an existing PC5 link between source UE and
the UE-to-UE Relay for the required RSC which is related to IP type traffic,
source UE sends a Link Modification Request to the UE-to-UE Relay contains
User Info ID and Layer-2 ID of target UE. If there\'s no PC5 link between the
UE-to-UE Relay and the target UE existing for the required RSC, or for non-IP
traffic transmitting, the UE-to-UE Relay sends Direct Communication Request to
the target UE using the received Layer-2 ID of target UE as the Destination
Layer-2 ID. If there\'s an existing PC5 link between the UE-to-UE Relay and
the target UE for the required RSC which is related to IP type traffic, the
UE-to-UE Relay sends a Link Modification Request to the target UE. After
receiving the response from target UE, for IP traffic, UE-to-UE Relay provides
the IP address of target UE to source UE.
### 6.11.2 Procedures
Depicted in figure 6.11.2-1 is the procedure for Layer-3 UE-to-UE Relay
communication setup.
Figure 6.11.2-1: Layer-3 UE-to-UE Relay communication setup after Model A and
Model B discovery
0\. Source UE has selected a suitable UE-to-UE Relay and received the Layer-2
ID of the target UE after Model A or Model B discovery. Source UE decides to
connect with target UE via the selected UE-to-UE Relay.
1a. If there\'s no PC5 link between source UE and the UE-to-UE Relay existing
for the required RSC, or for non-IP traffic transmitting, Source UE sends a
Direct Communication Request to the UE-to-UE Relay. The Direct Communication
Request contains User Info ID of source UE, User Info ID of UE-to-UE Relay,
User Info ID and Layer-2 ID of target UE, RSC. The Source Layer-2 ID of the
Direct Communication Request is self-assigned by the source UE, the
Destination Layer-2 ID of the Direct Communication Request is the source
Layer-2 ID of the selected UE-to-UE Relay during UE-to-UE Relay discovery.
1b. If there\'s an existing PC5 link between source UE and the UE-to-UE Relay
for the required RSC which is related to IP type traffic, source UE sends a
Link Modification Request to the UE-to-UE Relay. The Link Modification Request
contains User Info ID and Layer-2 ID of target UE, end-to-end QoS to the
target UE.
2\. After step 1a, if the UE-to-UE Relay matches the User Info ID of UE-to-UE
Relay and RSC, it responds by establishing the security with source UE. When
the security protection is enabled, source UE sends the information as
described in clause 6.4.3.1 of TS 23.304 [3] including end-to-end QoS to the
target UE, source UE may provide its Link-Local IPv6 Address in this step.
3\. The UE-to-UE Relay, based on its implementation, splits the end-to-end QoS
into two parts: one part is for the PC5 interface between source UE and UE-to-
UE Relay, the other part is for the PC5 interface between UE-to-UE Relay and
the target UE.
4a. If there\'s no PC5 link between the UE-to-UE Relay and the target UE exist
for the required RSC, or for non-IP traffic transmitting, the UE-to-UE Relay
sends a Direct Communication Request to the target UE. The Direct
Communication Request contains User Info ID of source UE, User Info ID of UE-
to-UE Relay, User Info ID of target UE, RSC, source UE\'s IP address if it\'s
available in the UE-to-UE Relay. The Source Layer-2 ID of the Direct
Communication Request is self-assigned by the UE-to-UE Relay, the Destination
Layer-2 ID of the Direct Communication Request is the Layer-2 ID of target UE
received in step 1.
NOTE: For non-IP traffic, the UE-to-UE Relay use different Source Layer-2 IDs
in the Direct Communication Requests towards the same target UE for different
source UEs.
4b. If there\'s an existing PC5 link between the UE-to-UE Relay and the target
UE for the required RSC which is related to IP type traffic, the UE-to-UE
Relay sends a Link Modification Request to the target UE. The Link
Modification Request contains User Info ID of source UE, source UE\'s IP
address if it\'s available in the UE-to-UE Relay, QoS part between UE-to-UE
Relay and the target UE.
5\. After step4a, if the target UE matches the User Info ID of target UE and
RSC, it responds by establishing the security with UE-to-UE Relay. When the
security protection is enabled, UE-to-UE Relay sends the information to target
UE, the information is as described in clause 6.4.3.1 of TS 23.304 [3]
including QoS part between UE-to-UE Relay and the target UE.
6a. After step5, the target UE sends the Direct Communication Accept as
described in clause 6.4.3.1 of TS 23.304 [3] to the UE-to-UE Relay, the target
UE may provide its Link-Local IPv6 Address in this step.
6b. After step4b, the target UE sends the Link Modification Accept as
described in clause 6.4.3.4 of TS 23.304 [3] to the UE-to-UE Relay.
7\. After step 6a, if the target UE doesn\'t provide its Link-Local IPv6
Address, for IP traffic, IPv6 prefix or IPv4 address is allocated by the UE-
to-UE Relay for the target UE.
8a. if step1a is performed, the UE-to-UE Relay sends the Direct Communication
Accept as described in clause 6.4.3.1 of TS 23.304 [3] to the source UE. For
IP traffic, the Direct Communication Accept in addition contains the IP
address of target UE. For non-IP traffic, the UE-to-UE Relay stores the 1:1
mapping between the link with source UE and the link with target UE.
8b. if step1b is performed, the UE-to-UE Relay sends the Link Modification
Accept as described in clause 6.4.3.4 of TS 23.304 [3] to the source UE. the
Link Modification Accept in addition contains the IP address of target UE.
9\. After step 8a, if the source UE hasn\'t provided its Link-Local IPv6
Address, for IP traffic, IPv6 prefix or IPv4 address is allocated by the UE-
to-UE Relay for the source UE.
The UE-to-UE Relay performs relaying function at the corresponding layer as
follows:
\- For IP traffic, the UE-to-UE Relay acts as an IP router.
\- For non-IP traffic, the UE-to-UE Relay performs traffic relaying based on a
mapping between the link with source UE and the link with target UE.
### 6.11.3 Impacts on services, entities and interfaces
UE:
\- New functionality related to UE-to-UE Relay communication setup.
## 6.12 Solution #12: Layer-3 UE-to-UE Relay discovery and communication
### 6.12.1 Description
The solution applies to Key Issue #1 \"Support of UE-to-UE Relay\".
In this solution, the Layer-3 UE-to-UE Relay operation is supported with the
following principles:
\- Authorization and configuration:
\- Only the UE authorized by the service authorization configuration can act
as a UE-to-UE Relay. These UEs will be configured according to the service
authorization and provisioning solutions for Key Issue #6.
\- UE-to-UE Relay discovery:
\- Model A and Model B direct discovery as defined in clause 6.3.2 of TS
23.304 [3] are supported for UE-to-UE Relay discovery.
\- Relay Service Code (RSC) is used to indicate the connectivity service that
UE-to-UE Relay can support.
\- In order to serve as a UE-to-UE Relay, it is required to discover other UEs
in proximity in advance or on demand.
\- The Source and Destination Layer-2 IDs used for discovery message are
determined based on the principles as defined in clause 5.8 of TS 23.304 [3].
\- UE-to-UE Relay communication:
\- Source UE initiates the Layer-2 link establishment procedure as defined in
clause 6.4.3.1 of TS 23.304 [3] with UE-to-UE Relay, and the QoS Info and IP
address are negotiated during this procedure.
\- The UE-to-UE Relay initiates the Layer-2 link establishment procedure as
defined in clause 6.4.3.1 of TS 23.304 [3] with Target UE, and the QoS Info
and IP address are negotiated during this procedure.
\- IP, Ethernet and Unstructured traffic type are supported.
\- Both UE-to-UE Relay allocated IP address and Link-Local IPv6 address are
supported.
\- QoS handling:
\- When the Source UE establishes the unicast Layer-2 link with the UE-to-UE
Relay, it can establish corresponding PC5 QoS Flows according to procedure
defined in clause 6.4.3.1 of TS 23.304 [3]. The UE-to-UE Relay determines the
PC5 QoS parameters used on the PC5 QoS Flow between Source UE and UE-to-UE
Relay, as well as the PC5 QoS parameters used on the PC5 QoS Flow between UE-
to-UE Relay and Target UE.
\- The PC5 QoS Flows are also set up between UE-to-UE Relay and Target UE
using the PC5 QoS parameters determined by UE-to-UE Relay.
The Control Plane and User Plane protocol stacks of Layer-3 UE-to-UE Relay are
as followings.
Figure 6.12.1-1: Control plane for Layer-3 UE-to-UE Relay
Figure 6.12.1-2: User plane for Layer-3 UE-to-UE Relay
### 6.12.2 Procedures
#### 6.12.2.1 Procedures for UE-to-UE Relay discovery
##### 6.12.2.1.1 Procedure for UE-to-UE Relay discovery with Model A
Depicted in figure 6.12.2.1.1-1 is the procedure for UE-to-UE Relay discovery
with Model A.
Figure 6.12.2.1.1-1: UE-to-UE Relay discovery with Model A
1\. The UE-to-UE Relay has discovered other UEs in proximity via the previous
direct discovery or direct communication procedures. The UE-to-UE Relay
obtains the User Info ID, Relay Service Code (RSC) and Layer-2 ID of other UEs
in proximity. The UE-to-UE Relay may buffer these parameters for subsequent
UE-to-UE Relay communication as described in clause 6.12.2.2. These parameters
will be removed by UE-to-UE Relay if the buffer timer expired.
2\. The UE-to-UE Relay sends an Announcement message. The Announcement message
may include the Type of Discovery Message, User Info ID of the UE-to-UE Relay,
RSC, and a list of User Info ID of the Target UEs (UEs discovered in step 1).
The Source Layer-2 ID of the Announcement message is self-assigned by the UE-
to-UE Relay, and the Destination Layer-2 ID is selected based on the ProSe
policy.
##### 6.12.2.1.2 Procedure for UE-to-UE Relay discovery with Model B
Depicted in figure 6.12.2.1.2-1 is the procedure for UE-to-UE Relay discovery
with Model B.
Figure 6.12.2.1.2-1: UE-to-UE Relay discovery with Model B
1\. The UE-to-UE Relay may have discovered other UEs in proximity via the
previous direct discovery or direct communication procedures. The UE-to-UE
Relay obtains the User Info ID, Relay Service Code (RSC) and Layer-2 ID of
other UEs in proximity.
2\. The Source UE sends a Solicitation message. The Solicitation message may
include the Type of Discovery Message, User Info ID of Source UE, RSC, and
User Info ID of Target UE.
The Source Layer-2 ID of the Announcement message is self-assigned by the
Source UE, and the Destination Layer-2 ID is selected based on the ProSe
policy.
3\. The UE-to-UE Relay may perform direct discovery procedure to discover the
Target UE if it has not been discovered in step 1. The UE-to-UE Relay obtains
the User Info ID, Relay Service Code (RSC) and Layer-2 ID of Target UEs in
proximity. The UE-to-UE Relay may buffer these parameters for subsequent UE-
to-UE Relay communication as described in clause 6.12.2.2. These parameters
will be removed by UE-to-UE Relay if the buffer timer expired.
4\. The UE-to-UE Relay that match the values of the User Info ID of Target UE
and RSC contained in the Solicitation message respond to the Source UE with a
Response message. The Response message contains the Type of Discovery Message,
User Info ID of UE-to-UE Relay, RSC, and User Info ID of Target UE.
The Source Layer-2 ID of the Response message is self-assigned by the UE-to-UE
Relay, and the Destination Layer-2 ID is set to the Source Layer-2 ID of the
received Solicitation message.
#### 6.12.2.2 Procedures for UE-to-UE Relay communication
Depicted in figure 6.12.2.2-1 is the procedure for Layer-3 UE-to-UE Relay
communication.
Figure 6.12.2.2-1: Layer-3 UE-to-UE Relay communication
1\. Service authorization and provisioning are performed for Source UE, Target
UE and UE-to-UE Relay as described for solutions for Key Issue #6.
2\. The Source UE performs discovery of a UE-to-UE Relay as described in
clause 6.12.2.1.
3\. The Source UE sends a Direct Communication Request message to initiate the
unicast Layer-2 link establishment procedure with the UE-to-UE Relay. The
Direct Communication Request message includes User Info ID of Source UE, User
Info ID of UE-to-UE Relay, User Info ID of Target UE and Relay Service Code
(RSC).
The Source Layer-2 ID of the DCR message is self-assigned by the Source UE,
and the Destination Layer-2 ID is set to the Source Layer-2 ID of the
discovery message of UE-to-UE Relay.
4\. If the User Info ID of Target UE, User Info ID of UE-to-UE Relay and RSC
are included in the Direct Communication Request, the UE-to-UE Relay responds
by establishing the security with Source UE. When the security protection is
enabled, the Source UE sends IP Address Configuration or Link-Local IPv6
address (if IP communication is used), QoS Info (PFI and PC5 QoS parameters).
The Source Layer-2 ID used for the security establishment procedure is self-
assigned by the UE-to-UE Relay, and the Destination Layer-2 ID is set to the
Source Layer-2 ID of the received Direct Communication Request message.
Upon receiving the security establishment procedure messages, the Source UE
obtains the UE-to-UE Relay\'s Layer-2 ID for future communication, for
signalling and data traffic for this unicast link.
5\. The UE-to-UE Relay sends a Direct Communication Accept message to the
Source UE that has successfully established security with UE-to-UE Relay. The
Direct Communication Accept message includes User Info ID of Source UE, User
Info ID of UE-to-UE Relay, User Info ID of Target UE, QoS Info (PFI and split
PC5 QoS parameters), RSC, IP Address Configuration or Link-Local IPv6 address
(if IP communication is used).
6\. Triggered by step 3, the UE-to-UE Relay sends a Direct Communication
Request message to initiate the unicast Layer-2 link establishment procedure
with the Target UE. The Direct Communication Request message includes User
Info ID of Source UE, User Info ID of UE-to-UE Relay, User Info ID of Target
UE and Relay Service Code (RSC).
The Source Layer-2 ID of the DCR message is self-assigned by the UE-to-UE
Relay, and the Destination Layer-2 ID is set to the Source Layer-2 ID of the
discovery message of Target UE.
7\. If the User Info ID of Target UE and RSC are included in the Direct
Communication Request, the Target UE responds by establishing the security
with UE-to-UE Relay. When the security protection is enabled, the UE-to-UE
Relay sends IP Address Configuration or Link-Local IPv6 address (if IP
communication is used), QoS Info (PFI and split PC5 QoS parameters).
The Source Layer-2 ID used for the security establishment procedure is self-
assigned by the Target UE, and the Destination Layer-2 ID is set to the Source
Layer-2 ID of the received Direct Communication Request message.
Upon receiving the security establishment procedure messages, the UE-to-UE
Relay obtains the Target UE\'s Layer-2 ID for future communication, for
signalling and data traffic for this unicast link.
8\. The Target UE sends a Direct Communication Accept message to the UE-to-UE
Relay that has successfully established security with Target UE. The Direct
Communication Accept message includes User Info ID of Source UE, User Info ID
of UE-to-UE Relay, User Info ID of Target UE, QoS Info (PFI and split PC5 QoS
parameters), RSC, IP Address Configuration or Link-Local IPv6 address (if IP
communication is used).
The UE-to-UE Relay may further update the PC5 link with the Source UE based on
the outcome of PC5 link establishment with the Target UE.
9\. For IP communication, the UE-to-UE Relay stores an association of User
Info ID and the IP address of Target UE into its DNS entries, and the UE-to-UE
Relay acts as a DNS server to other UEs. The Source UE sends a DNS query to
the UE-to-UE Relay to request IP address of Target UE after step 8, and the
UE-to-UE Relay returns the IP address of the Target UE to the Source UE.
NOTE: The Source UE may send DNS query multiple times to obtain the IP address
of Target UE.
10\. The Source UE communicates with the Target UE via the UE-to-UE Relay. For
IP communication, the UE-to-UE Relay acts as an IP router. For Unstructured
communication, the UE-to-UE Relay performs traffic relaying based on the
mapping between the two PC5 Layer-2 links and PC5 QoS Flows. For Ethernet
communication, the UE-to-UE Relay acts as an Ethernet switch.
In the case of one Source UE communicates with multiple Target UEs, the PC5
link between Source UE and UE-to-UE Relay can be shared for multiple Target
UEs while the PC5 link is established individually between UE-to-UE Relay and
Target UEs. For the shared PC5 link, the Layer-2 link modification procedure
can be used.
In the case of multiple Source UEs communicate with one Target UE, the PC5
link is established individually between Source UEs and UE-to-UE Relay while
the PC5 link between UE-to-UE Relay and Target UE can be shared. For the
shared PC5 link, the Layer-2 link modification procedure can be used.
### 6.12.3 Impacts on services, entities and interfaces
UE:
\- New functionality related to UE-to-UE Relay discovery, as well as
communication via UE-to-UE Relay.
## 6.13 Solution #13: Layer-2 UE-to-UE Relay
### 6.13.1 Description
#### 6.13.1.1 General
Using the solution described in this clause, a UE-to-UE Relay is authorized to
relay messages between two UEs over the PC5 interface via authorization and
provisioning.
A UE-to-UE Relay enables a source UE and a target UE to establish an end-to-
end (E2E) PC5 unicast communication.
The UE-to-UE Relay listens for Direct Communication Request messages from
surrounding UEs and, if the specified application matches one of the
applications from its provisioned relay policy/parameters, the UE-to-UE Relay
advertises it as a relayed application by adding a relay indication (e.g.
Relay ID) to the message.
The target UE receives a broadcast Direct Communication Request message with a
relay indication.
A secure \"extended\" (end-to-end) PC5 link is set up between the source UE
and the target UE via the UE-to-UE Relay. Source/Target UEs send and receive
messages through the UE-to-UE Relay, however, the security association and the
extended PC5 unicast link are established end-to-end between the source UE and
the target UE. The UE-to-UE Relay forwards the messages transparently, without
the ability to read, modify their content or replay them, with the exception
of the Direct Communication Request message. As DCR is always sent unprotected
the UE-to-UE Relay modifies the message to include the relay indication (e.g.
Relay ID). The source/target UEs detect that the link establishment is going
through a UE-to-UE Relay upon detecting a relay indication included in the
received messages.
A source/target UE uses a unique link (i.e. PC5 unicast link) with a UE-to-UE
Relay to send messages to its peer UEs via this specific UE-to-UE Relay. The
UE-to-UE Relay receives E2E PC5 messages over this PC5 unicast link and
forwards them between the source UE and target UEs using an adaptation layer,
which contains information identifying the specific source and/or target UE.
The UE-to-UE Relay replaces the identifiers specified in the messages\'
headers with relay-specific identifiers to \"isolate\" the PC5 unicast links,
i.e. different identifiers are used over each PC5 unicast link.
NOTE 1: Additional security-related parameters and procedures may be needed
for the protection of relayed messages using the adaptation layer. Their
definitions need to be coordinated with SA WG3.
To enable a single step for direct and indirect link establishment procedure,
a source UE (i.e. UE1) sends a DCR message without an adaptation header. A
target UE (i.e. UE2) may receive the DCR message directly from the source UE
and establish a direct unicast link with the source UE. As well, a UE-to-UE
Relay may receive the DCR message and add an adaptation header before
forwarding it. Another target UE (i.e. UE3) may receive the DCR message via
the UE-to-UE Relay and establish an indirect unicast link with the source UE.
NOTE 2: The details about the identity information of source UE and/or target
UE specified in the adaption header will be defined in cooperation with RAN
WG2 during normative phase.
Link management (i.e. keep-alive, link modification, link identifier update
and link release) is supported over extended PC5 links. Since the security
association of extended PC5 links is between the E2E peer UEs, all messages
sent over the extended PC5 link, including link management (i.e. PC5-S)
messages, may only be processed by those two UEs. No modifications to the
keep-alive, link modification and link release procedures are needed when sent
over the E2E PC5 link. Modifications for the support of the Link Identifier
Update procedure related to extended PC5 links are expected and are specified
in another contribution.
The PC5 unicast link, used by source/target UEs to send E2E messages via a
specific UE-to-UE Relay, is also used as a management link, i.e. to manage the
extended links (e.g. for QoS adaptation or privacy procedure). The management
link is secured between the source/target UEs and the UE-to-UE Relay and
doesn\'t make use of an adaptation layer.
#### 6.13.1.2 Control and User Plane Protocol Stacks
The control and user plane protocols stacks are based on the architectural
reference model described in Annex A.
### 6.13.2 Procedures
Connection establishment via a L2 UE-to-UE Relay is done after the discovery
procedure (i.e. using Discovery messages as defined in clause 6.3 of TS 23.304
[3]) i.e. Models A/B or using the integrated discovery procedure (i.e. using
the link establishment procedure as defined in clause 6.4.3.1 of TS 23.304
[3]).
If the discovery procedure is run prior to the link establishment, the source
UE determines the UE-to-UE Relay Layer-2 ID to be used to reach the target UE
while the target UE Layer-2 ID may be discovered and kept at the UE-to-UE
Relay or at the source UE or may not be kept. In the latter case, a broadcast
Layer-2 is used when sending the DCR message towards the target UE. In this
case, the Target User Info field is used to identify the target UE.
If the integrated discovery mechanism is used, the source UE sends the DCR
message to a broadcast Layer-2 ID and the UE-to-UE relay forwards the message
using the same value.
Figure 6.13.2-1 shows the unicast link establishment over PC5 reference point
via a Layer-2 UE-to-UE Relay.
Figure 6.13.2-1: Connection establishment procedure via Layer-2 UE-to-UE Relay
0\. UE-to-UE Relay registers with the network and specifies its relay
capabilities. UE-to-UE Relay is provisioned with relay policy parameters from
the network.
1\. The target UEs (i.e. UE2, UE3 and UE4) determine the destination Layer-2
ID (i.e. broadcast Layer-2 ID) for signalling reception for PC5 unicast link
establishment as specified in clause 6.4.3.1 of TS 23.304 [3].
2\. On the source UE (i.e. UE1), the application layer provides application
information to the ProSe layer for PC5 unicast communication. The application
information includes the ProSe Service Info, source UE\'s Application Layer
ID, and may include target UE\'s Application Layer ID, as specified in clause
6.4.3.1 of TS 23.304 [3].
ProSe layer triggers the link establishment procedure by sending a Direct
Communication Request (DCR) message which includes:
\- Source User Info: the initiating UE\'s Application Layer ID (i.e. UE1\'s
Application Layer ID).
\- If the ProSe application layer provided the target UE\'s Application Layer
ID in step 2, the following information is included:
\- Target User Info: the target UE\'s Application Layer ID (i.e. UE2\'s
Application Layer ID).
\- ProSe Service Info: the information about the ProSe identifier(s)
requesting Layer-2 link establishment.
\- Security Information: the information for the establishment of security.
The message is sent using the source Layer-2 ID self-assigned by the source UE
and the broadcast Layer-2 ID or the discovered UE-to-UE Relay Layer-2 ID as
destination, and includes other parameters related to the application offered,
as specified in clause 6.4.3.1 of TS 23.304 [3]. The message may include the
target UE Layer-2 ID, if learned during a prior discovery procedure.
The DCR message is sent without an adaptation layer header. This DCR message
is used for either direct or indirect link establishment. A target UE
receiving the DCR directly from UE1 may continue the link establishment
procedure as usual, i.e. without involving the UE-to-UE Relay.
3\. The UE-to-UE Relay receives the Direct Communication Request message and
verifies if it\'s configured to relay this application, i.e. it compares the
announce ProSe Service Info with its provisioned relay policy/parameters.
The UE-to-UE Relay forwards the Direct Communication Request message by using
its own Layer-2 ID as Source L2 ID and specifies as destination either the
target UE Layer-2 ID as specified in the received DCR message or as learned
during the prior discovery procedure, or uses the broadcast Layer-2 ID. The
UE-to-UE Relay adds an adaptation header containing info identifying UE1. The
UE-to-UE Relay additionally includes its unique Relay ID and relay-specific
security info. The UE-to-UE Relay keeps the association of UE1 security info
as specified in the DCR message and its relay-specific security info as
specified with the forwarded DCR message.
NOTE 1: The UE-to-UE Relay handles DCR message in the ProSe layer. Any
subsequent E2E messages (i.e. PC5-S and data) are forwarded based on UE
identifier info specified in the adaptation header.
4\. Target UE (i.e. UE3) receives the DCR message via the UE-to-UE Relay. UE3
is interested in the announced application thus it triggers a PC5 unicast link
establishment with the UE-to-UE Relay, if such a link isn\'t already
established between UE3 and this UE-to-UE Relay.
UE3 may receive multiple DCR messages via different UE-to-UE Relays and even
directly from UE1. UE3 may select the UE-to-UE Relay based on locally
configured rules. UE3 establishes a PC5 unicast link only with the selected
UE-to-UE Relay.
5\. UE3 continues E2E link establishment procedure by initiating the security
procedures (i.e. PC5 Authentication and/or PC5 Direct Security Mode
procedures) via the selected UE-to-UE Relay (i.e. over the direct PC5 link to
the UE-to-UE Relay). UE3 adds an adaptation header including the info
identifying UE1, as received with the DCR message, and UE3 security info and
may include a UE3 identifier. UE3 associates the security info received on the
DCR message and its UE3 security info to create the security context for the
extended link. UE3 includes the Relay ID in the first protected message sent
to UE1.
The UE-to-UE Relay forwards the messages from UE3 to UE1 including relay-
specific info identifying UE3 in the adaptation header. The UE-to-UE Relay
also specifies a relay-specific security info associated to UE3 and UE1
security info as received with the DCR message, and finally may include info
identifying UE1 and associated with the DCR message (e.g. UE1 Layer-2 ID used
by UE1 when sending the DCR message). UE-to-UE Relay puts its Layer-2 ID as
the source and UE1 Layer-2 ID as the destination. The UE-to-UE Relay keeps the
association of UE3 security info as specified in message received from UE3 and
its relay-specific security info associated to UE3. UE1 keeps track of the
security info specified with the received message (i.e. security info
associated to UE3) and uses it to create the security context for the extended
link.
6\. At the reception of this first message from UE3 via the UE-to-UE Relay,
UE1 extracts the Relay ID and verifies if a PC5 unicast link is already
established between UE1 and this UE-to-UE Relay. If none already exists, UE1
triggers a PC5 unicast link establishment procedure before continuing security
procedures of step 5.
NOTE 2: Whether the PC5 unicast link establishment between UE and the Relay is
triggered by UE or Relay is to be determined during normative phase, after
RAN2 has provided more details about adaptation layer and Relay behavior.
7\. UE1 continues the E2E security procedure with the target UE (continuation
of step 5). UE1 keeps track of the security info specified with the received
message (i.e. security info associated to UE3) and uses it to create the
security context for the extended link.
8\. Once E2E link security establishment procedures are completed, UE3
completes the E2E link establishment procedure via the UE-to-UE Relay by
sending a DCA message to UE1.
9\. UE1 receives the DCA message. An \"extended\" unicast link is established
between UE1 and UE3, via the UE-to-UE Relay. The extended link may be secured
end-to-end, i.e. a security association is created between UE1 and UE3.
10\. UE1 and UE3 exchange E2E data via the UE-to-UE Relay, using an adaptation
header. The UE-to-UE Relay replaces the fields specified in the adaptation
header with relay-specific identifiers, as specified above before forwarding
the E2E messages.
Editor\'s note: The need and details of the E2E authentication and E2E
security procedure will be investigated by SA WG3.
Editor\'s note: The details of the adaptation between two PC5 interfaces are
confirmed by RAN WG2.
### 6.13.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
UE/ Layer-2 UE-to-UE:
\- Needs to support procedures for ProSe 5G Layer-2 UE-to-UE Relay and
communications via a ProSe 5G Layer-2 UE-to-UE Relay.
\- Needs to support procedures for extended communication management, via
communication with a ProSe 5G Layer-2 UE-to-UE Relay.
\- Needs to support an adaptation layer for communication via a Layer-2 UE-to-
UE Relay.
## 6.14 Solution #14: Criteria for two indirect network path switches
### 6.14.1 Description
This solution is related to the Key Issue #2: Support of path switching
between two indirect network communication paths for UE-to-Network Relaying
with service continuity consideration, and it mainly focus on the following
sub-KIs:
\- What the triggers and criteria for path switching.
\- How to select a UE-to-Network Relay for path switching.
As described in clause 6.5.3 of TS 23.304 [3], after being connected to the 5G
ProSe UE-to-Network Relay, the 5G ProSe Remote UE keeps performing the
measurement of the signal strength of PC5 unicast link with the 5G ProSe UE-
to-Network Relay for relay reselection. When the measured signal strength is
lower than a threshold, the 5G Prose Remote UE will perform the 5G ProSe UE-
to-Network relay reselection for indirect network path switching. Currently
the descriptions in clause 6.5.4 of TS 23.304 [3] for 5G ProSe Remote UE
traffic handling are more suitable to initial UE-to-Network relay selection,
it is not clear enough for a target indirect network path re-selection when to
perform the indirect network path switching. For example, when a L3 remote
UE(without N3IWF case) needs to perform path switching, then what the target
indirect path should be selected, does it still selects the L3 relay without
N3IWF, L3 relay with N3IWF, or L2 relay? Does it keeps evaluating the next RSD
or re-evaluate the URSP?, etc. These issues are still not clear for studying.
In this solution, taking the backward compatibility into consideration, the
Remote UE still use the URSP evaluation to determine the UE-to-Network relay
reselection as specified in clauses 6.14.2, 6.14.3 and 6.14.4.
Editor\'s note: The criteria on path switching from RAN perspective are FFS.
NOTE: This solution studies the criteria on how to select a UE-to-Network
Relay for path switching.
### 6.14.2 Criteria for path switching for 5G ProSe Layer-3 relay without
N3IWF
5G ProSe Layer-3 Remote UE that is connected to the 5G ProSe Layer-3 UE-to-
Network Relay without N3IWF for traffic transmission means the selected RSD
has the component of \"5G ProSe Layer-3 UE-to-Network Relay Offload
indication\". When it determines the indirect network path switching for
another path selection, it follows the following steps:
\- The 5G ProSe Layer-3 Remote UE shall still first perform the 5G ProSe
Layer-3 UE-to-Network Relay UE discovery and selection with the \"5G ProSe
Layer-3 UE-to-Network Relay Offload indication\", if there is a 5G ProSe
Layer-3 UE-to-Network Relay UE can be discovered and selected, the target
indirect network path to be switched is 5G ProSe Layer-3 UE-to-Network Relay
path. If not, the 5G ProSe Layer-3 Remote UE may re-evaluate the URSP and the
RSD within it according to the precedence. During this process, if the same
relay type is appeared again, the Remote UE evaluates the next RSD.
\- After that, if the next selected RSD has the preferred non-3GPP access type
and the ProSe policy has the 5G ProSe Layer-3 UE-to-Network Relay with N3IWF
configurations, the target indirect path to be switched is 5G ProSe Layer-3
UE-to-Network Relay with N3IWF path. Then the 5G ProSe Layer-3 Remote UE
performs the 5G ProSe Layer-3 UE-to-Network Relay with N3IWF discovery and
selection. If the next selected RSD has the preferred 3GPP access type and the
ProSe policy has the 5G ProSe Layer-2 UE-to-Network Relay configurations, the
target indirect network path to be switched is 5G ProSe Layer-2 UE-to-Network
Relay path. Then the 5G ProSe Remote UE performs the 5G ProSe Layer-2 UE-to-
Network Relay discovery and selection. If there are multiple 5G ProSe UE-to-
Network Relay UEs can be selected, it depends on Remote UE\'s implementation
to perform the 5G ProSe UE-to-Network Relay UE selection.
### 6.14.3 Criteria for path switching for 5G ProSe Layer-3 relay with N3IWF
5G ProSe Layer-3 Remote UE that is connected to the 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF for traffic transmission means the selected RSD has
the component of preferred non-3GPP access type and the ProSe policy has the
5G ProSe Layer-3 UE-to-Network Relay with N3IWF configurations. When it
determines the indirect network path switching for another path selection, it
follows the following steps:
\- The 5G ProSe Layer-3 Remote UE shall still first perform the 5G ProSe
Layer-3 UE-to-Network Relay with N3IWF discovery and selection, if there is a
5G ProSe Layer-3 UE-to-Network Relay with N3IWF can be discovered and
selected, the target indirect network path to be switched is 5G ProSe Layer-3
UE-to-Network Relay with N3IWF path. If not, the 5G ProSe Layer-3 Remote UE
may re-evaluate the URSP and the RSD within it according to the precedence.
During this process, if the same relay type is appeared again, the Remote UE
evaluates the next RSD.
\- After that, if the next selected RSD has component of \"5G ProSe Layer-3
UE-to-Network Relay Offload indication\", then the target indirect network
path to be switched is 5G ProSe Layer-3 UE-to-Network Relay without N 3IWF
path. Then the 5G ProSe Layer-3 Remote UE performs the 5G ProSe Layer-3 UE-to-
Network Relay without N3IWF discovery and selection. If the next selected RSD
has the preferred 3GPP access type and the ProSe policy has the 5G ProSe
Layer-2 UE-to-Network Relay configurations, the target indirect network path
to be switched is 5G ProSe Layer-2 UE-to-Network Relay path. Then the 5G ProSe
Remote UE performs the 5G ProSe Layer-2 UE-to-Network Relay discovery and
selection. If there are multiple 5G ProSe UE-to-Network Relay UEs can be
selected, it depends on Remote UE\'s implementation to perform the 5G ProSe
UE-to-Network Relay UE selection.
### 6.14.4 Criteria for path switching for 5G ProSe Layer-2 relay
5G ProSe Layer-2 Remote UE that is connected to the 5G ProSe Layer-2 UE-to-
Network Relay for traffic transmission means the selected RSD has the
component of preferred 3GPP access type and the ProSe policy has the 5G ProSe
Layer-2 UE-to-Network Relay configurations. When it determines the path
switching, it follows the following steps:
\- The 5G ProSe Layer-2 Remote UE shall first perform the 5G ProSe Layer-2 UE-
to-Network Relay discovery and selection, if there is a 5G ProSe Layer-2 UE-
to-Network Relay can be discovered and selected, the target indirect network
path to be switched is 5G ProSe Layer-2 UE-to-Network Relay path. If not, the
5G ProSe Layer-2 Remote UE may re-evaluate the URSP and the RSD within it
according to the precedence. During this process, if the same relay type is
appeared again, the Remote UE evaluates the next RSD.
\- After that, if the next selected RSD has component of \"5G ProSe Layer-3
UE-to-Network Relay Offload indication\", then the target indirect network
path to be switched is 5G ProSe Layer-3 UE-to-Network Relay without N 3IWF
path. Then the 5G ProSe Layer-2 Remote UE performs the 5G ProSe Layer-3 UE-to-
Network Relay without N3IWF discovery and selection. If the next selected RSD
has the preferred non-3GPP access type and the ProSe policy has the 5G ProSe
Layer-3 UE-to-Network Relay with N3IWF configurations, the target indirect
network path to be switched is 5G ProSe Layer-3 UE-to-Network Relay with N3IWF
path. Then the 5G ProSe Remote UE performs the 5G ProSe Layer-3 UE-to-Network
Relay with N3IWF discovery and selection. If there are multiple 5G ProSe UE-
to-Network Relay UEs can be selected, it depends on Remote UE implementation
to perform the 5G ProSe UE-to-Network Relay UE selection.
### 6.14.5 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
UE(s):
\- support of indirect network path selection based on the URSP and ProSe
policy.
## 6.15 Solution #15: Service continuity support for path switch between two
indirect network communication paths
### 6.15.1 General Description
This solution addresses KI#2 (as defined in clause 5.2) to support service
continuity for a Remote UE connected to the network via a 5G ProSe UE-to-
Network Relay (i.e. indirect network communication path) switch to another
indirect network communication path, as shown in Figure 6.15.1-1.
Figure 6.15.1-1: Remote UE indirect-to-indirect path switch
As described in TS 23.304 [3], Remote UE connect to the network via Layer-3
UE-to-Network Relay or Layer-3 UE-to-Network Relay with N3IWF access or
Layer-2 UE-to-Network relay and can switch between any of these indirect
network communication paths.
Editor\'s note: Whether all the combinations of path switching (i.e. L2-L2,
L2-L3, L3-L2, L3 with 2 variants) are needed is to be determined during
conclusion phase.
### 6.15.2 Procedures
#### 6.15.2.1 Relay (re)selection
Target UE-to-Network Relay selection for path switch between indirect network
communication paths is performed by the UE or network as below:
\- Layer-3 Remote UE and Layer-2 Remote UE in CM-IDLE or CM-CONNECTED with
RRC_INACTIVE state select a target UE-to-Network Relay based on Remote UE
controlled relay (re)selection procedures.
\- Layer-2 Remote UE in CM-CONNECTED with RRC_CONNECTED state is controlled by
the network as part of the network controlled handover procedures as described
in clause 6.15.2.2.
Layer-3 Remote UE with/without N3IWF and Layer-2 Remote UE in CM-IDLE or CM-
CONNECTED with RRC_INACTIVE state keep performing the PC5 unicast link
measurements with its serving Relay to support Relay (re)selection, as
specified in clause 6.5.3 of TS 23.304 [3]. When the NG-RAN configured
measurement thresholds and the criteria for indirect-to-indirect path relay
(re)selection are satisfied, the Remote UE performs the path switch to the
target indirect network communication path. The target UE-to-Network Relay can
be either connected to the same NG-RAN or different NG-RAN than the source UE-
to-Network Relay.
Editor\'s note: The measurement trigger criteria for path switch between two
indirect network communication paths will be defined by RAN WG.
If multiple UE-to-Network Relay UEs satisfy the Relay (re)selection criteria,
the Layer-3 Remote UE select the target UE-to-Network Relay for path switch
based on the 5G ProSe Policy or URSP rules and the Remote UE traffic handling
described in clause 6.5.4 of TS 23.304 [3].
#### 6.15.2.2 Service Continuity
The service continuity procedures that can be supported when Remote UE path
switch between indirect network communication paths differ based on whether
both NAS and AS connections are setup for Remote UE on the source indirect
communication path to the 5GS and whether both connections can be setup on the
target indirect communication path to the 5GS.
\- Layer-3 Remote UE switch from Layer-3 UE-to-Network Relay to another
Layer-3 UE-to-Network Relay: Layer-3 Remote UE does not have any PDU session
with 5GC when connected via Layer-3 UE-to-Network Relay without N3IWF access.
Hence, application layer procedures is used for service continuity support.
For example:
\- Commercial IMS Services: IMS service continuity procedures specified in TS
23.237 [16].
\- Missional Critical Services: service continuity procedures specified in
Annex B of TS 23.280 [17], with the source path being an indirect
communication path.
\- Other services: application layer procedures specified outside of 3GPP
scope can be utilized if available.
\- Layer-3 Remote UE switch from Layer-3 UE-to-Network Relay with N3IWF
support to an indirect network communication path with either a Layer-3 UE-to-
Network Relay with N3IWF access or a Layer-2 UE-to-Network Relay: Layer-3
Remote UE connected to N3IWF can handover the existing PDU session to the
target path. Hence, the handover procedures specified in clause 4.9.2 of TS
23.502 [8] for UE mobility between a 3GPP access and Untrusted non-3GPP
access, are considered as baseline for session continuity support.
\- Layer-2 Remote UE in CM-IDLE or CM-CONNECTED with RRC_INACTIVE state
performs path switch to an indirect network communication via Layer-2 UE-to-
Network Relay: Existing mobility procedure can be used, and session continuity
is supported with the existing procedures defined TS 23.502 [8].
\- Layer-2 Remote UE in CM-CONNECTED state path switch to an indirect
communication path via Layer-3 UE-to-Network Relay with N3IWF: Layer 2 Remote
UE\'s PDU session(s) can handover to the indirect path via Layer-3 UE-to-
Network Relay with N3IWF support. Thus, service continuity using the handover
procedures specified in clause 4.9.2 of TS 23.502 [8] for UE mobility between
a 3GPP access and Untrusted non-3GPP access, are considered as baseline for
session continuity support.
\- Layer-2 Remote UE in CM-CONNECTED state path switch to an indirect
communication path via Layer-2 UE-to-Network Relay: Network controlled
handover procedures defined for 3GPP access in clause 4.9.1 of TS 23.502 [8]
are reused to support AS/NAS service continuity:
\- When Xn interface is supported between the source NG-RAN and target NG-RAN,
Xn based inter NG-RAN handover specified in clause 4.9.1.2 of TS 23.502 [8]
are reused.
\- When the Xn interface is not supported the source NG-RAN and target NG-RAN,
Inter NG-RAN node N2 based handover specified in clause 4.9.1.3 of TS 23.502
[8] are reused.
Editor\'s note: Intra-NG-RAN and Inter-NG-RAN AS handover procedures for path
switch between Layer-2 UE-to-Network Relay indirect communication paths is
defined by RAN WGs.
### 6.15.3 Impacts on Existing Nodes and Functionality
The solution has impacts in the following entities:
5GC entities (AMF, SMF, PCF, UPF):
\- none.
NG-RAN:
\- support indirect-to-indirect path relay (re)selection measurement criteria
configuration
Remote UE:
\- Remote UE needs to support handover procedures for untrusted non-3GPP
access via N3IWF over L3 UE-to-NW Relay with N3IWF indirect communication
path.
## 6.16 Solution #16: Provisioning policy based direct communication path
switching between PC5 and Uu reference points
### 6.16.1 Description
This solution resolves Key Issue #3 \"Support direct communication path
switching between PC5 and Uu (i.e. non-relay case)\" and Key Issue #6
\"Support of PC5 Service Authorization and Policy/Parameter Provisioning\".
The \"direct communication path switching between direct PC5 and direct Uu
reference points\" refers to the procedure on how a UE switches the direct
communication paths between PC5 reference point and Uu reference point when it
is communicating with another UE. The direct communication path over direct
PC5 reference point means that the communication with another UE is performed
by using 5G ProSe Direct Communication only. The direct communication path
over Uu reference point means that the communication with another UE is
performed via the network (i.e. non-relay case) and the communication via 5G
ProSe UE-to-Network Relay (Layer-2 or Layer-3) is not considered.
NOTE 1: Session continuity (e.g. IP address preservation) is not supported
during path switching in this solution.
Path switching policy is provided to the UE to indicate which path(s) is
allowed for all or specific ProSe services (i.e. direct PC5 allowed, direct Uu
allowed or no allowed indicated). The path switching policy is defined as the
mapping of ProSe services (i.e. ProSe identifiers) to path allowed (i.e.
direct PC5 allowed, direct Uu allowed, or no allowed) and the path switching
policy can be a one mapping for all ProSe services (i.e. same path allowed for
all ProSe services).
The path switching policy can be (pre-) configured in the UE or provided by
the PCF. The ProSe Application Server may provide a path allowed indication
for ProSe Services to UDR and this may be used by PCF for path switching
policy generation and update.
The UE may use the pre-configured/provisioned path switching policy to
switching all or specific ProSe services to the appropriate communication
path. The \"Procedures for Service Authorization and Provisioning to UE\" as
defined in TS 23.304 [3] is reused for provisioning path switching policy to
the UE.
The UE evaluates the path switching policy and switches the communication path
as below:
\- If direct PC5 allowed is indicated, the UE may switch to the direct PC5
reference point for communication path for the ProSe service.
\- If direct Uu allowed is indicated, the UE may switch to the direct Uu
reference point for communication path for the ProSe service.
\- If no allowed is indicated or no path switching policy is provisioned, the
UE may switch to either a direct Uu or direct PC5 communication path based on
its pre-configuration or implementation for the ProSe service.
NOTE 2: The path switching policy is used to determine whether a communication
path can be switched when a UE is communicating with another UE, so it is
different to the path selection policy as defined in TS 23.304 [3].
Based on the path switching policy, a UE may establish a PDU session or a PC5
connection in the target path and switch the traffic from the source path to
the target path. The service continuity during path switching can be achieved
by the application layer mechanism.
### 6.16.2 Procedures
This clause describes the direct path switching procedures, including direct
Uu to direct PC5 path switching and direct PC5 to direct Uu path switching.
Figure 6.16.2-1 depicts the procedure on direct Uu to direct PC5 path
switching.
Figure 6.16.2-1: Procedure on direct Uu to direct PC5 path switching
1\. UE-1 and UE-2 register to the network and establish PDU sessions
respectively. The UE-1 and UE-2 communicate with each other via the
established PDU sessions.
2\. The UE-1 and UE-2 may decide to switch ProSe services from direct Uu path
to direct PC5 path, due to, e.g. UE-1 and UE-2 are proximity to each other or
to offload some traffic from the network.
UE-1 and UE-2 determine whether the ProSe services can be switched based on
path switching policy as described in clause 6.16.1.
3\. UE-1 and UE-2 establish PC5 connection by reusing the Layer-2 link
establishment procedure as described in clause 6.4.3.1 of TS 23.304 [3].
4\. The ProSe services are switched from direct Uu path to direct PC5 path.
5\. The PDU session over direct Uu path may be released if no traffic
transmitted over the PDU session.
Figure 6.16.2-2 depicts the procedure on direct PC5 to direct Uu path
switching.
Figure 6.16.2-2: Procedure on direct PC5 to direct Uu path switching
1\. UE-1 and UE-2 establish PC5 connection and communicate with each other via
the direct PC5 path.
2\. The UE-1 and UE-2 may decide to switch ProSe services from direct PC5 path
to direct Uu path, due to, e.g. UE-1 and UE-2 are moving far with each other.
UE-1 and UE-2 determine whether the ProSe services can be switched based on
path switching policy as described in clause 6.16.1.
3\. UE-1 and UE-2 establish PDU sessions by reusing the PDU session
establishment procedure as described in clause 4.3.2 of TS 23.502 [8].
4\. The ProSe services are switched from direct PC5 path to direct Uu path.
5\. The PC5 connection may be released if no traffic transmitted over the PC5
connection.
### 6.16.3 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
UE:
\- UE needs to support the provisioned path switching policy as described in
clause 6.16.1 to perform path switching between direct PC5 and direct Uu
communication path.
PCF:
\- PCF generates/updates path switching policy and provisions it to the UE.
ProSe Application Server:
\- The ProSe Application Server may provide a path allowed for ProSe Services
to UDR.
UDR:
\- The UDR stores the path allowed and provides it to the PCF.
## 6.17 Solution #17: Path switching between PC5 path and Uu path
### 6.17.1 Description
This solution resolves Key Issue #3 for direct communication path switching
between a PC5 path and a Uu path.
This solution uses the make-before-break mechanism to reduce interruption when
path switch between PC5 and Uu paths for two scenarios:
\- Scenario A: path switching from PC5 path to Uu path between UE1 and UE2.
\- Scenario B: path switching from Uu path to PC5 path between UE1 and UE2.
For Scenario A: The two UEs perform the Uu path preparation procedure for the
switched service, and then may release the PC5 connection. During the Uu path
preparation procedure phase, the two UEs may negotiate, using the ProSe layer,
the Uu QoS based on PC5 QoS via the PC5 connection in order to ensure
consistent service experience, and optionally share the IP address used for
the Uu path to each other to achieve the switch of service transmission.
For Scenario B: The two UEs perform the PC5 path preparation procedure for the
switched service, and then may release the Uu connection. During the PC5 path
preparation procedure phase, the two UEs discovery each other and establish a
PC5 connection.
### 6.17.2 Procedures
#### 6.17.2.1 Switching from PC5 to Uu path
Figure 6.17.2.1-1 presents a high-level procedure for path switch from PC5
path to Uu path (Scenario A).
Figure 6.17.2.1-1: high-level procedure for path switch from PC5 to Uu
1\. Triggered by an AF request, the PCF may provide the path switch
Policy/parameters for Proximity Services to the UE (including UE1 and UE2) by
using the procedure as defined in clause 4.2.4.3 in TS 23.502 [8]. The path
switch Policy/parameters may include whether the specific service (e.g.
Service A, Service B, Service C) is allowed to switch from PC5 to Uu.
2\. UE1 and UE2 have an established PC5 connection and are transferring
service data with each other for some service(s), e.g. Service A, Service B
and Service C. Before the PC5 connection establishment, UE1 and UE2 may get
the path selection policy, which indicates that the PC5 path is preferred for
the services.
3\. When e.g. the PC5 signal level is lower than the configured threshold or
PC5 QoS for Service A cannot be satisfied, UE1 sends the path switch request
to UE2. The request message includes the service identifier(s) to switch.
Before UE1 sends the request, UE1 checks the path switch Policy/parameters to
make sure that the service (s) are is allowed to switch from PC5 to Uu.
UE1 informs UE2 in the request message which service(s) to switch based on
path switch policy and optionally whether UE1 can establish the PDU Session/Uu
path for the service.
4\. UE2 sends the path switch response to UE1 that indicates which if the
services in the request can be switched to a Uu path. The response message
includes the service identifier(s). Before UE2 sends the response, UE2 checks
the path switch Policy/parameters to make sure that a service is allowed to
switch from PC5 to Uu.
The response message from UE2 includes the service(s) from the request message
that can be switched as acknowledgement. For example, for UE1, both Service A
and Service B are allowed to switch from PC5 to Uu, but Service C is not
allowed to switch from PC5 to Uu, and for UE2, both Service A and Service C
are allowed to switch from PC5 to Uu, but Service B is not allowed to switch
from PC5 to Uu. In this case the request will contain Service A and Service B
and the response will only contain Service A, resulting in Service A being
switched to Uu and the remaining services continuing to use PC5.
NOTE: PC5 connection is still valid to transfer the PC5 signalling in step 3
and step 4.
5\. UE1 and UE2 perform the Uu path preparation procedure. In particular, UE1
and UE2 each trigger PDU Session establishment/modification procedure, if
needed, to make the Uu path ready for Service A transmission. During this
procedure UE1 and UE2 can get the IP address of the PDU session that will be
used for the Service A, and UE1 and UE2 can respectively request the Uu QoS 1
(used for Uu path of UE1) and Uu QoS 2 (used for Uu path of UE2) for Service
A.
Before UE1 and UE2 request the Uu QoS for Service A, UE1 decides the Uu QoS 1
and Uu QoS 2 requirements for Service A based on PC5 QoS requirement for
Service A and sends Uu QoS 2 requirements to UE2 via the PC5 connection. Uu
QoS 1 and Uu QoS 2 requirements can be decided based on the configured mapping
of PC5 QoS parameter to Uu QoS parameter or based on UE1 implementation.
Optionally, UE1 and UE2 can also share the IP/port addresses used for Uu path
with each other via the PC5 connection, to achieve the switch of the Service A
transmission.
6\. UE1 and UE2 transmit the data of the Service A via the Uu path.
7\. After the step 6, UE1 and UE2 still transmit the data of the unswitched
service(s) via the PC5 path. UE1 and UE2 may release the PC5 connection if no
service uses it, using the existing Layer-2 link release over PC5 reference
point, see clause 6.4.3.3 of TS 23.304 [3].
#### 6.17.2.2 Switching from Uu to PC5 path
Figure 6.17.2.2.1 presents a high-level procedure for path switch from Uu path
to PC5 path (Scenario B).
Figure 6.17.2.2-1: high-level procedure for path switch from Uu to PC5
1\. Triggered by an AF request, the PCF may provide the path switch
Policy/parameters for Proximity Services to the UE (including UE1 and UE2) by
using the procedure as defined in clause 4.2.4.3 in TS 23.502 [8]. The path
switch Policy/parameters may include whether the specific service (e.g.
Service A, Service B, Service C) is allowed to switch from Uu to PC5.
2\. UE1 and UE2 have PDU Sessions and the Uu path is used for some service
data transmission, e.g. Service A, Service B, Service C transmission. Before
the Uu path transmission, UE1 and UE2 may get the path selection policy, which
indicates that the Uu path is preferred for the services.
3\. UE-1 and UE-2 can be discover each other and establish the PC5 connection
for service, when the Uu signal level is lower than the configured threshold
or Uu QoS for a service cannot be satisfied.
UE1 informs UE2 in the request message which service(s) to switch based on
path switch policy. The response message from UE2 includes the service(s) from
the request message that can be switched as acknowledgement.
For example, for UE1, both Service A and Service B are allowed to switch from
Uu to PC5, but Service C is not allowed to switch from Uu to PC5, and for UE2,
both Service A and Service C are allowed to switch from Uu5 to PC5, but
Service B is not allowed to switch from Uu to PC5. In this case the request
will contain Service A and Service B and the response will only contain
Service A, resulting in Service A being switched to PC5 and the remaining
services continuing to use Uu.
4\. UE1 and UE2 transmit the data of the Service A via the PC5 path.
5\. After the step 4, UE1 and UE2 still transmit the data of the unswitched
service(s) via the Uu path and the PDU session(s) over Uu path may be released
or deactivated if no service uses them.
### 6.17.3 Impacts on services, entities and interfaces
UE:
\- Support path switch procedure following the policy, including Uu path
preparation procedure.
PCF:
\- Composition of path switch policy.
## 6.18 Solution #18: UE Negotiation-based path switching from PC5 to Uu
### 6.18.1 Description
This is a solution related to the Key Issue #3 Support direct communication
path switching between PC5 and Uu reference points.
This solution provides a UE Negotiation-Based mechanism for the direct
communication path switching between PC5 to Uu reference points. Before
performing the path switch, 2 UEs having PC5 connection negotiate the triggers
of path switching and what service or QoS flows need to be switched. Once the
negotiated triggers are satisfied, the 2 UEs perform the path switching
between PC5 to Uu directly. To reduce the service interruption, the principle
of \"make before break\" may be adopted, the 2 UEs may perform corresponding
Uu session setup/activation in advance after the UE Negotiation-Based
mechanism over PC5 for the path switching from PC5 to Uu interface. For the
path switching from the Uu to PC5 interface, it requires that the 2 UEs
establish the PC5 link firstly, then negotiate the ProSe services to be
switched over the established PC5 link. After that, the 2 UEs perform the path
switching based on the negotiated result.
During the negotiation procedure, the 2 UEs may negotiate:
\- Which ProSe service to be switched;
\- Which QoS flow(s) to be switched;
\- Triggers of path switching from PC5 to Uu about:
\- Threshold of PC5 signal level;
\- Threshold of QoS requirement/parameters.
NOTE 1: In this solution, the negotiation can be triggered by UE
implementation from the its own service requirement perspective.
NOTE 2: Granularity of this solution for path switching can be service level
and QoS flow level.
Due to UE mobility or its own conditions (e.g. under congestion control,
mobility restriction), the UE can not perform the path switch, then the UE may
notify the peer UE of deactivating the negotiated triggers or UE ProSe policy
of path switching to avoid the peer UE performing path switch solely.
### 6.18.2 Procedures for path switching from PC5 to Uu with negotiation
Figure 6.18.2-1: high-level procedure for path switch from PC5 to Uu with
negotiation
1\. Service authorization and provisioning are performed for the UE#1 and UE#2
as described in clause 6.2 of TS 23.304 [3].
2\. UE#1 and UE#2 may have an established PC5 connection which are
transferring service data with each other over PC5 QoS flows.
3\. Considering to avoid service interruption, UE#1 and UE#2 may consider the
path switch from PC5 to Uu. In order to have a uniform understanding for the
path switch, the 2 UEs negotiate the path switching services, QoS flows and
the triggers of the service or QoS flows to be switched. UE#1 sends a Path
switching negotiation request which may include the ProSe ID, PC5 QoS flows
IDs, Threshold of PC5 signal level, or Threshold of QoS
requirement/parameters. This step can be combined with PC5 unicast connection
establishment/modification procedure.
4\. After receiving the above request from UE#1, UE#2 determines that
services, QoS flows triggers and related triggers based on the Path switching
negotiation request from the UE#1. The UE#2 responds to the UE#1 with a Path
switching negotiation response including the accepted ProSe ID, PC5 QoS flows
IDs, Threshold of PC5 signal level, or Threshold of QoS
requirement/parameters.
5\. Based on the negotiation, the UE#1 and UE#2 may perform the Uu path
preparation procedure. UE1 and UE2 triggers PDU Session
establishment/modification procedure to make the Uu path ready for the
corresponding ProSe services or PC5 QoS flows transmission.
6\~7. When the negotiated triggers/conditions are satisfied, the UE#1 and UE#2
transmit the data of the ProSe services of accepted ProSe IDs or the PC5 QoS
flows of the accepted PC5 QoS flow IDs to the Uu path.
8\. After the step 7, UE1 and UE2 may release the PC5 connection, using the
existing Layer-2 link release over PC5 reference point, see clause 6.4.3.3 of
TS 23.304 [3].
UE#1 and UE#2 may update the negotiated triggers after the negation procedure.
### 6.18.3 Procedures of deactivating path switching
Figure 6.18.3-1: Negotiated triggers de-activate
1\. After the path switch negotiation procedure as described in clause 6.18.2,
the UE#1 and UE#2 store the accepted path switching triggers.
2\. Due to mobility or other situations, the UE#1 can not perform the path
switching from the PC5 to Uu, then the UE#1 may notify the UE#2 of
deactivating the negotiated triggers. The UE#1 sends a Negotiated triggers de-
activate notification to UE#2.
3\. When the UE#2 received the notification from the UE#1, it deactivates the
negotiated triggers determined in step1 and sends a response to UE#1.
### 6.18.4 Procedures for path switching from Uu to PC5 with negotiation
Figure 6.18.4-1: High-level procedure for path switch from Uu to PC5 with
negotiation
1\. Service authorization and provisioning are performed for the UE#1 and UE#2
as described in clause 6.2 of TS 23.304 [3].
2\. UE#1 and UE#2 interacts the service data over the Uu path (PDU session)
through the server with corresponding QoS flows.
3\. The UE#1 and UE#2 may have the offload requirement from the Uu to PC5,
then the 2 UEs may perform the direct discovery to discover each other as
described in clause 6.3.2.1 of TS 23.304 [3].
4\. When the 2 UEs discover each other, the UE#1 and UE#2 may establish a
default direct unicast PC5 link as described in clause 6.4.3.1 of TS 23.304
[3].
5\. The 2 UEs may further negotiate path switching (traffic handover) based on
current situation (e.g. one of the 2 UEs is under mobility restriction or
congestion control), UE#1 may send a Path switch negotiation request to the
UE#2. In this request, it may include the ProSe IDs or traffic descriptor to
reflect what service that the UE#1 would like to switch from the Uu to PC5.
6\. UE#2 receives the Path switch negotiation request from the UE#1 and
responds to UE#1 with the accept ProSe service.
7\. Based on the negotiated result, the UE#1 and UE#2 may perform the direct
link modification procedure over PC5 or re-establish a PC5 direct link for the
service to be switched.
8\. The 2 UEs may perform the Uu path modification, e.g. PDU session
modification/release, or determine to not send the traffic data for
service/application to be switched over the Uu.
9\. The 2 UEs change the path of the traffic data for the service/application
to be switched from the Uu to PC5.
### 6.18.5 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
UE(s):
\- Support the negotiation Procedures for path switching between Uu and PC5and
triggers de-activate procedure.
\- have unified understanding of which traffic will be switched based on the
negotiated triggers.
## 6.19 Solution #19: Path switching between PC5 and Uu reference points based
on path permission policy
### 6.19.1 Description
This solution resolves Key Issue #3 about direct communication path switching
between PC5 and Uu reference points.
One of the aspects on this key issue is described as:
\- What information/policy are used for path switching decision.
In clauses 5.1.3 and 5.11 of TS 23.304 [3], the communication path selection
between PC5 and Uu reference points is described and the path selection policy
is used to make decision on the communication path by the UE. The policy for
path selection is based on the ProSe services as the following:
\- If PC5 preferred is indicated, the UE should prefer to use the PC5 for
communication path for the ProSe service.
\- If Uu preferred is indicated, the UE should prefer to use the Uu for
communication path for the ProSe service.
\- If no preference is indicated or no path selection policy is provisioned,
the UE selects either a Uu or PC5 communication path based on its pre-
configuration or implementation for the ProSe service.
NOTE: When either PC5 preferred or Uu preferred is indicated, the UE can still
select the other non-preferred path, e.g. because the peer UE is not in
proximity.
In this solution, it is proposed to unify the path policy for both direct
communication path selection and path switching and the policy will be path
permission policy. The UE will evaluate the path permission policy before path
selection or path switching operation.
### 6.19.2 Procedures
#### 6.19.2.1 Path permission policy description
The path permission policy includes the mapping of ProSe Services to the
following path permission, and only one option is applied for a specific ProSe
Service:
\- PC5 permitted;
\- Uu permitted;
\- both PC5 and Uu permitted.
The policy will be used for both direct communication path selection and path
switching. For path selection, the description in clause 5.11 of TS 23.304 [3]
is applied with the difference that PC5 or Uu \"preferred\" changes to PC5 or
Uu \"permitted\", \"no preference indicated\" is not available; and only when
both PC5 and Uu permitted is indicated, the UE can select either a PC5 or a Uu
communication path.
For path switching, when the UE communicates with another UE for a specific
ProSe Service on either PC5 path or Uu path and finds the ongoing
communication path cannot satisfy the ProSe Service, the UE will evaluate the
path permission policy and operates as below:
\- When only PC5 or only Uu permitted is indicated, the UE cannot switch to
another communication path (from PC5 to Uu, or vice versa) for the ProSe
Service.
\- When both PC5 and Uu permitted is indicated, the UE can switch to another
communication path (from PC5 to Uu, or vice versa) for the ProSe Service.
#### 6.19.2.2 Path permission policy provision procedure
The path permission policy can be (pre-) configured in the UE or provided by
the PCF. The ProSe Application Server may provide a path permission for ProSe
Services to UDR and this may be used by PCF for path permission policy
generation and update.
The procedures for service authorization and provisioning to UE as defined in
clause 6.2 of TS 23.304 [3] is reused for provisioning path permission policy
to the UE.
#### 6.19.2.3 Path switching based on path permission policy procedure
Depicted in Figure 6.19.2.3-1 is the high-level procedure for path switching
based on path permission policy.
Figure 6.19.2.3-1: High-level path switching procedure based on path
permission policy
1\. UE-1communicates with UE-2 for a ProSe Service on either PC5 path or Uu
path.
2\. The communication path (either PC5 or Uu) quality for the ongoing ProSe
Service cannot satisfy the requirements of the ProSe Service.
Whether the Uu communication path quality satisfies the requirements of the
ProSe Service will be based on the traffic loss rate and delay for the service
which is measured at application layer.
Whether the PC5 communication path quality satisfies the requirements of the
ProSe Service will be based on the traffic loss rate and delay for the service
which is measured at application layer, or by performing the measurement of
the signal strength of PC5 unicast link between two UEs.
3\. UE-1 checks the path permission policy and finds the policy for the served
ProSe Service is both PC5 and Uu path permitted. Then UE-1 decides to switch
the ongoing communication path to another (from PC5 to Uu or vice versa).
4\. If the old communication path is still valid, UE-1 may negotiate with UE-2
to confirm the switching of communication path.
NOTE: The signalling in Step. 4 is transported on the old communication path.
5\. UE-1 and UE-2 switch the communication path to another (from PC5 to Uu or
vice versa) and transmit the ProSe Service data on the new path.
For communication path switching from PC5 to Uu, a PDU session is established
as defined in clause 4.3.2 of TS 23.502 [8] or modified as defined in clause
4.3.3 of TS 23.502 [8] to transfer the ProSe Service data.
For communication path switching from Uu to PC5, a PC5 unicast link is
established as defined in clause 6.4.3.1 of TS 23.304 [3] or modified as
defined in clause 6.4.3.4 of TS 23.304 [3] to transfer the ProSe Service data.
6\. UE-1 and UE-2 release the old communication path.
For communication path switching from PC5 to Uu, the used PDU session is
released as defined in clause 4.3.4 of TS 23.502 [8] or modified as defined in
clause 4.3.3 of TS 23.502 [8].
For communication path switching from Uu to PC5, the used PC5 unicast link is
released as defined in clause 6.4.3.3 of TS 23.304 [3] or modified as defined
in clause 6.4.3.4 of TS 23.304 [3].
### 6.19.3 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
UE:
\- Support receiving and storing the path permission policy;
\- Perform path switching between PC5 and Uu communication path based on the
path permission policy.
PCF:
\- Provision the path permission policy to the UE.
ProSe Application Server:
\- Provide a path permission for ProSe Services to UDR.
UDR:
\- Store the path permission and provide it to the PCF.
## 6.20 Solution #20: Switching back from Uu path to PC5 path
### 6.20.1 Description
This is a solution for key issue #3 \"Support direct communication path
switching between PC5 and Uu (i.e. non-relay case)\".
Two UEs can switch their communication path from PC5 to Uu because the PC5
signal strength of the unicast link between two UEs gets below configured
signal strength threshold. In this case, there may be the case that two UEs
will be able to communicate over PC5 reference point with the satisfactory
signal strength after a while, e.g. as temporary obstacle between two UEs does
not exist anymore. In order to switch back from Uu to PC5, two UEs need to
establish a unicast link again after discovering each other over PC5 reference
point. These tasks may take some time. In addition, when the UE(s) triggers
ProSe Direct Discovery or Layer-2 link establishment may be uncertain if they
want to communicate over PC5 reference point again.
Therefore, this solution proposes to reuse the unicast link when switching
back from Uu to PC5 by maintaining the established unicast link after path
switching to Uu. The maintained unicast link is also used to check whether
switching back to PC5 path can be performed.
The outline of the proposed solution for switching back from Uu path to PC5
path is as below:
\- After path switching from PC5 to Uu is made due to the PC5 signal strength
of the unicast link lower than configured signal strength threshold, the
unicast link between two UEs is not released but kept.
\- One UE of the unicast link keeps checking the PC5 signal strength of the
unicast link through the Layer-2 link maintenance procedure. Based on the
checking results, the UE can determine whether to perform switching back to
PC5 path as below:
\- If the PC5 signal strength of the unicast link is considered good (i.e. not
lower than configured signal strength threshold) during a configured time, the
UE determines to perform switching back to PC5 path by reusing the unicast
link.
\- Otherwise, the UE determines not to perform switching back to PC5 path,
thus, the unicast link is released.
\- If the Layer-2 link maintenance procedure fails, e.g. because the UE
initiating the procedure does not receive the Keep-alive Ack message from peer
UE, the peer UE does not receive the Keep-alive message from the initiating
UE, the unicast link is locally released.
NOTE: This solution does not preclude the switching back from Uu path to PC5
path without reusing the unicast link by releasing the unicast link after
switching to Uu path.
### 6.20.2 Procedures
#### 6.20.2.1 Procedure for switch back from Uu path to PC5 path
Figure 6.20.2.1-1 shows the procedure for switching back from Uu path to PC5
path.
Figure 6.20.2.1-1: Procedure for switching back from Uu path to PC5 path
1\. To communicate over PC5 reference point, UE-1 and UE-2 establish a Layer-2
link as specified in clause 6.4.3.1 of TS 23.304 [3]. UE-1 and UE-2 can
exchange the data over the established unicast link.
2\. When the PC5 signal strength of the unicast link is below configured
signal strength threshold, path switching from PC5 to Uu is performed. UE-1
and UE-2 can exchange the data via the 5GC.
After path switching to Uu, UE-1 and UE-2 do not release the unicast link, so
the unicast link is kept. During the Layer-2 link establishment procedure or
the procedure for path switching from PC5 to Uu, UE-1 and UE-2 may negotiate
whether to maintain the unicast link after path switching to Uu based on e.g.
Path Selection policy (e.g. PC5 preferred), Path Switching policy (e.g. direct
PC5 allowed).
NOTE 1: For details of path switching from PC5 to Uu, other solutions to
propose it can be used. However, for this solution, the unicast link is
maintained after path switching to Uu.
3\. UE-1 initiates the Layer-2 link maintenance procedure by sending a Keep-
alive message to UE-2 in order to determine the status of the PC5 unicast link
as specified in clause 6.4.3.5 of TS 23.304 [3].
UE-1 starts a switch-back-attempt timer.
The switch-back-attempt timer may be provisioned in UE-1 as 5G ProSe
Policy/Parameter.
4\. UE-2 responds with a Keep-alive Ack message.
If the Layer-2 link maintenance procedure fails, e.g. because UE-1 does not
receive the Keep-alive Ack message from UE-2, UE-2 does not receive the Keep-
alive message from UE-1, the unicast link is locally released.
If UE-1 receives the Keep-alive Ack message from UE-2, UE-1 measures the PC5
signal level of the unicast link.
5\. UE-1 may repeat the Layer-2 link maintenance procedure until the switch-
back-attempt timer expires.
6\. UE-1 determines whether to perform switching back to PC5 path based on the
PC5 signal levels of the unicast link measured through the Layer-2 link
maintenance procedures.
When UE-1 determines to perform path switching to PC5, steps 7 to 10 are
performed.
7\. UE-1 sends a Path Switch Request message to UE-2 to trigger path switching
from Uu to PC5.
8\. UE-2 responds with a Path Switch Response message.
After path switching from Uu to PC5 is completed, UE-1 and UE-2 can exchange
the data over the unicast link.
NOTE 2: For path switching back to PC5, the Layer-2 link modification
procedure as specified in clause 6.4.3.4 of TS 23.304 [3] can be performed
following or instead of exchanging Path Switch Request/Response messages.
9\. If the PDU Session used to communicate with UE-2 is not needed anymore
after path switching to PC5, the PDU Session for UE-1 may be released.
10\. If the PDU Session used to communicate with UE-1 is not needed anymore
after path switching to PC5, the PDU Session for UE-2 may be released.
When UE-1 determines not to perform path switching to PC5, step 11 is
performed.
11\. The unicast link between UE-1 and UE-2 is released as specified in clause
6.4.3.3 of TS 23.304 [3].
NOTE 3: The unicast link between UE-1 and UE-2 can be released per request of
the application layer.
### 6.20.3 Impacts on services, entities and interfaces
UE:
\- supports switching back to PC5 path from Uu path by maintaining the unicast
link after switching to Uu path and reusing the unicast link when switching
back to PC5 path.
## 6.21 Solution #21: Support direct communication path switching between PC5
and Uu
### 6.21.1 Description
This solution addresses KI#3.
In clause 6.21.2, two procedures are depicted:
\- Scenario A: This scenario addresses the case for direct communication path
switching from Uu communication path to PC5 communication path between UE1 and
UE2.
\- Scenario B: This scenario addresses the case for direct communication path
switching from PC5 communication path to Uu communication path between UE1 and
UE2.
### 6.21.2 Procedures
Figure 6.21.2-1: Scenario A: Path switch from Uu to PC5 communication path
1\. PCF subscribes to the UDR to receive notifications on ProSe Application
parameter changes when there is a change of service specific parameter as
described in clause 6.2.5 of TS 23.304 [3]. This may include either existing
path selection policy, a modified path selection policy or a new path
switching policy.
2.a-2c. ProSe Application Server invokes a \"ServiceParameter_Update\" service
operation through NEF. NEF stores the information within the UDR. PCF receives
the notification of data change from the UDR (which it has already subscribed
to in step 1.a). NEF responds on \"ServiceParameter_Update\" to the ProSe
Application Server.
3-4. PCF decides to update the UE ProSe policy and initiates policy update for
both UE 1 and UE2.
Steps 1-4 are optional and can be skipped if the parameters already
provisioned for ProSe policy are still valid.
5\. UE1 discovers UE2 in proximity as part of application-level signalling
with ProSe Application server or via ProSe Direct Discovery. When UE1
discovers UE2 via ProSe Direct Discovery, identifiers for 5G ProSe Direct
Discovery (e.g. ProSe Application ID, Layer-2 ID) shall have been shared
between UE1 and UE2 over Uu path before ProSe Direct Discovery. UE1 decides on
the path switch and sends direct communication request to initiate the unicast
layer-2 link establishment incl. PC5 QoS parameters. UE2 accepts the request
and confirms QoS Info and optionally PC5 QoS rule(s).
6\. Following existing procedure in clause 4.3.7, TS 23.502 [8], the SMF may
deactivate the UP connection of the relevant PDU sessions after a specified
inactivity period leading to releasing UPF resources and AN-level resources
via AMF. Alternatively, both UEs may initiate PDU session modification request
for the pair of Uu links (over 5GC communication path) including a new
parameter to indicate \"PDU session to be deactivated\". If so, during
deactivation procedure, the UPF of N3 terminating point is still maintained as
described in the step 4 of clause 4.3.7 of TS 23.502 [8].
ProSe session continues over the direct link established between UE1 and UE2.
NOTE: How to confirm the identity of discovery object over PC5 path will be
determined in cooperation with SA WG3 during normative phase.
Figure 6.21.2-2: Scenario B: Path switch from PC5 to Uu communication path
1\. PCF subscribes to the UDR to receive notifications on ProSe Application
parameter changes when there is a change of service specific parameter as
described in clause 6.2.5 of TS 23.304 [3]. This may include either existing
path selection policy, a modified path selection policy or a new path
switching policy.
2.a-2c. ProSe Application Server invokes a \"ServiceParameter_Update\" service
operation through NEF. NEF stores the information within the UDR. PCF receives
the notification of data change from the UDR (which it has already subscribed
to in step 1.a). NEF responds on \"ServiceParameter_Update\" to the ProSe
Application Server.
3-4. PCF decides to update the UE ProSe policy and initiates policy update for
both UE 1 and UE2.
Steps 1-4 are optional and can be skipped if the parameters already
provisioned for ProSe policy are still valid.
5\. UE1 (or UE2) identify that they are not in proximity range of each other
as part of application-level signalling with ProSe Application server or via
ProSe Direct Discovery. Alternatively, UE1 (or UE2) identify that they cannot
fulfil PC5 QoS requirements. In the latter case, UE1 (or UE2) requests (over
PC5) for path switch to Uu path. This request also includes suggested QoS
rules and QoS Flow level QoS parameters for Uu path mapped based on former the
PC5 QoS parameters for the corresponding PC5 QoS Flow. UE2 (or UE1) accepts
the path switch request.
6\. Both UEs initiate PDU session establishment or modification request to
switch to Uu communication path based on suggested QoS rules and QoS Flow
level QoS parameters for Uu path in step 5.
7\. Each UE (re)activates corresponding PDU session over Uu path following.
8\. The AMF sends N2 PDU session (re-activation) request message to the R(AN).
9\. (R)AN setups related AN-level resources.
PC5 connection is released and ProSe service continues over the Uu path
between UE1 and UE2.
### 6.21.3 Impacts on services, entities and interfaces
UE:
\- Support PC5 signalling for path switch including suggested QoS rules and
QoS Flow level QoS parameters for Uu path.
\- Optionally support PDU session deactivation indication.
PCF:
\- Support changes to ProSe policy (for a modified path selection policy or
path switching policy only).
SMF:
\- Optionally support PDU session deactivation while maintaining the UPF of N3
terminating point.
## 6.22 Solution #22: Direct Communication Path switching between PC5 and Uu
### 6.22.1 Description
This solution resolves Key Issue #3 for direct communication path switching
between PC5 and Uu.
### 6.22.2 Procedures
#### 6.22.2.1 Direct Communication Path switching from PC5 to Uu
Figure 6.22.2.1-1: Path switching from PC5 to Uu
0\. UE1 and UE2 are provisioned with path switching policies (e.g.
enabled/disabled, preferred interface, radio quality thresholds) by using the
procedure as defined in clause 6.2 of TS 23.304 [3]. For each ProSe service
which is allowed for path switching between PC5 and Uu, the UEs are provided
with PC5 QoS parameters which will be allowed for path switching to Uu
connection.
1\. UE1 and UE2 establish a PC5 connection. During this procedure, the Path
switching parameters (e.g. path switching enabled/disabled) are exchanged.
2\. UE1 informs UE2 about its PDU session status (e.g. available for PDU
session establishment) by using the PC5 Keepalive procedure.
3\. UE2 informs UE1 about its PDU session status (e.g. available for PDU
session establishment) by using the PC5 Keepalive procedure.
4\. If UE1 determines to switch path from PC5 to Uu e.g. based on PC5 signal
level and UE2\'s PDU session status (i.e. PDU session establishment is
available), UE1 sends a PC5 Path Switching Request message to UE2, including
the path switching direction (i.e. PC5-to-Uu).
5\. UE2 may establish a PDU session or modify an existing PDU session for
switched traffic. In the PDU session establishment request or modification
request, UE2 includes a Path Switch indication from PC5 to Uu informing the
5GCN to assign QoS flows for the PC5 QoS flows of ProSe service to be path
switched. Based on the Path Switch indication and, requested DNN, the 5GCN may
assign QoS flows for the applications allowing path switch.
NOTE: It is assumed that 5GCN has PCC rules for the applications supported
over Uu connection and PC5 connection and allowing path switch between Uu and
PC5 connection for each UE.
6\. UE2 sends a PC5 Path Switching Response message to UE1, which includes the
IP address associated to UE2\'s PDU session.
7\. UE1 may establish a PDU session or modify an existing PDU session for
switched traffic. In the PDU session establishment request or modification
request, UE2 includes a Path Switch indication from PC5 to Uu informing the
5GCN to assign QoS flows for the PC5 QoS flows of ProSe service to be path
switched. Based on Path Switch indication and, requested DNN, the 5GCN may
assign QoS flows for the applications allowing path switch.
8\. UE1 sends a PC5 Path Switching Ack message to UE2, which includes the IP
address associated to UE1\'s PDU session. UE1 may send a PC5 Path Switching
Abort message to abort the path switching procedure e.g. if the PDU session
establishment/modification failed.
9\. After the step 8, UE1 and UE2 may release the PC5 connection and use Uu
path for communication.
NOTE: For Ethernet traffic, the IP address associated to UE\'s PDU session in
Step. 6 and 8 is replaced with MAC address associated to UE\'s PDU session;
for Unstructured traffic, the IP address associated to UE\'s PDU session in
Step. 6 and 8 is replaced with UE address and data unit type associated to
UE\'s PDU session.
#### 6.22.2.2 Direct Communication Path switching from Uu to PC5
Figure 6.22.2.2-1: Path switching from Uu to PC5
0\. UE1 and UE2 are provisioned with path switching policies (e.g.
enabled/disabled, preferred interface, radio quality thresholds) by using the
procedure as defined in clause 6.2 of TS 23.304 [3]. UE1 and UE2 use Uu path
for communication.
1\. UE1 and UE2 establish a PC5 connection. In order to discover each other
during PC5 discovery phase, discovery parameters e.g. Application ID, target
User Info ID, may be provided by the application or derived in UE1 and UE2
using the information e.g. application ID, User ID of UE1, User ID of UE2,
which are used during step 0. During this procedure, the Path switching
parameters (e.g. path switching enabled/disabled) are exchanged. During PC5
connection setup, for ProSe service allowed path switching, UE1 and UE2
negotiate QoS within the provisioned PC5 QoS parameters to be allowed for path
switching.
For the case that the data unit type for PDU session in step 0 is IP type, UE1
and UE2 decide to reuse the IP addresses of PDU sessions for PC5
communication, e.g. if the IP address is public address. During Layer-2 link
establishment procedure defined in clause 6.4.3.1 of TS 23.304 [3], UE sends
an indication to reuse the addresses of the PDU sessions, e.g. UE may send
PROSE DIRECT LINK SECURITY MODE COMMAND message with an indication, followed
by a PROSE DIRECT LINK SECURITY MODE COMPLETE message without IP address
configuration.
For the case that the data unit type for PDU session in step 0 is Ethernet,
UE1 and UE2 reuse the UE MAC addresses of the PDU sessions for PC5
communication with an indication e.g. in PROSE DIRECT LINK SECURITY MODE
COMMAND message.
For the case that the data unit type for PDU session in step 0 is
Unstructured, UE1 and UE2 reuse the addresses and data unit type of the PDU
sessions for PC5 communication with an indication e.g. in PROSE DIRECT LINK
SECURITY MODE COMMAND message.
2\. UE1 sends a PC5 Path Switching Request message, including the path
switching direction (i.e. Uu-to-PC5) and the address information associated to
UE1\'s PDU session.
3\. UE2 sends a PC5 Path Switching Response message, including the address
information associated to UE2\'s PDU session.
4\. UE1 and UE2 use PC5 path for communication. The addresses used over Uu may
be re-used over the PC5 session, if indicated during the PC5 link
establishment.
5\. UE1 and UE2 may release/modify their PDU session.
### 6.22.3 Impacts on services, entities and interfaces
UE:
\- Support path switch procedure.
\- Reuse the address of PDU session for PC5 path.
PCF:
\- Support path switch policy provisioning and handling policy control based
on path switch indication.
SMF:
\- Handling PDU session based on path switch indication.
## 6.23 Solution #23: Session Continuity for path switching for L2 U2N Relay
### 6.23.1 Description
This solution addresses key issue 4 \"Support of path switching between direct
network communication path and indirect network communication path for Layer-2
UE-to-Network Relay with session continuity consideration\". This solution has
considered Xn based and N2 based HO procedure applied for inter-gNB indirect-
to-direct and inter-gNB direct-to-indirect path switching.
In this solution, the source gNB determines whether to switch to a direct cell
or a L2 U2N relay UE. If the source gNB determines to switch to a L2 U2N relay
UE, the source gNB or the target gNB selects the target L2 U2N relay UE for
remote UE taken the authorized PLMN list for L2 U2N remote UE into account.
Editor\'s note: For the inter-gNB cases which gNB (source or target) gNB
selects a target Relay UE or direct Uu route depends upon RAN2 conclusion.
### 6.23.2 Procedures
#### 6.23.2.1 Xn based inter-gNB indirect-to-direct path switching
Figure 6.23.2.1-1 shows the procedure for Xn based inter-gNB indirect-to-
direct path switching.
Figure 6.23.2.1-1: Procedure for Xn based inter-gNB indirect-to-direct path
switching
1\. The remote UE performs the measurement and reporting procedure, this step
is the same as step 1 in clause 16.12.6.1 of TS 38.300 [15].
2\. The source gNB decides to switch the Remote UE onto direct Uu path in a
different gNB.
3\. The procedures are performed as specified in clause 4.9.1.2.2 of TS 23.502
[8].
Steps 4 and 5 are performed as step6 and step 7 in clause 16.12.6.1 of TS
38.300 [15].
Editor\'s note: The procedures have RAN dependency. The procedures are
required to be evaluated by RAN WGs.
#### 6.23.2.2 Xn based inter-gNB direct-to-indirect path switching
Figure 6.23.2.2-1 shows the procedure for Xn based inter-gNB indirect-to-
direct path switching.
Figure 6.23.2.2-1: Procedure for Xn based inter-gNB direct-to-indirect path
switching
1\. The remote UE performs the measurement and reporting procedure, this step
is the same as step 1 in clause 16.12.6.2 of TS 38.300 [15].
2\. The source gNB decides to switch the U2N Remote UE to a target U2N Relay
UE. If the source gNB selects a target U2N relay UE, then the source gNB
selects a target U2N relay UE taken into the authorized PLMN list which is
retrieved from AMF to select the target U2N relay UE.
3\. If the source gNB selects a target U2N relay UE, then the source gNB sends
the Handover Request defined in TS 38.423 [18] in addition at least selected
L2 U2N Relay UE\'s source L2 ID, selected U2N Relay UE\'s serving cell ID. If
the target gNB selects a target U2N relay UE, the source gNB sends the
Handover Request defined in TS 38.423 [18] in addition at least candidate L2
U2N Relay UE\'s source L2 ID, candidate U2N Relay UE\'s serving cell ID taken
into the authorized PLMN list which is retrieved from AMF, then the target gNB
selects a target U2N relay UE. The target gNB responds the Handover Request
Ack defined in TS 38.413 [19].
Steps 4 to 7 are performed as steps 2 to 5 in clause 16.12.6.2 of TS 38.300
[15].
If the selected U2N Relay UE is in RRC_IDLE or RRC_INACTIVE, step 7 will
trigger the U2N Relay UE to enter RRC_CONNECTED state, then in this case step
7 will be performed before step 5.
8\. The procedures are performed as steps 1b to 9 in clause 4.9.1.2.2 of TS
23.502 [8].
Editor\'s note: The procedures have RAN dependency. The procedures are
required to be evaluated by RAN WGs.
#### 6.23.2.3 N2 based inter-gNB indirect-to-direct path switching
Figure 6.23.2.3-1 shows the procedure for N2 based inter-gNB indirect-to-
direct path switching.
Figure 6.23.2.3-1: Procedure for N2 based inter-gNB indirect-to-direct path
switching
1\. The remote UE performs the measurement and reporting procedure, this step
is the same as step1 in clause 16.12.6.1 of TS 38.300 [15].
2\. The source gNB decides to switch the Remote UE onto direct Uu path in a
different gNB using N2 based handover.
3\. The procedures are performed as steps 1 to 12 specified in clause
4.9.1.3.2 of TS 23.502 [8].
4\. The procedures are performed as steps 1 to 15b specified in clause
4.9.1.3.3 of TS 23.502 [8].
Steps 5 and 6 are performed as step 6 and step 7 in clause 16.12.6.1 of TS
38.300 [15].
Editor\'s note: The procedures have RAN dependency. The procedures are
required to be evaluated by RAN WGs.
#### 6.23.2.4 N2 based inter-gNB direct-to-indirect path switching
Figure 6.23.2.4-1 shows the procedure for N2 based inter-gNB indirect-to-
direct path switching.
Figure 6.23.2.4-1: Procedure for N2 based inter-gNB direct-to-indirect path
switching
1\. The remote UE performs the measurement and reporting procedure, this step
is the same as step1 in clause 16.12.6.2 of TS 38.300 [15].
2\. The source gNB decides to switch the U2N Remote UE to a target U2N Relay
UE. If the source gNB selects a target U2N relay UE, then the source gNB
selects a target U2N relay UE taken into the authorized PLMN list which is
retrieved from AMF to select the target U2N relay UE.
3\. If the source gNB selects a target U2N relay UE, the source gNB sends the
Handover Required defined in TS 38.413 [19] in addition at least selected L2
U2N Relay UE\'s source L2 ID, selected U2N Relay UE\'s serving cell ID. If the
target gNB selects a target U2N relay UE, the source gNB sends the the
Handover Required defined inTS 38.413 [19] in addition at least candidate L2
U2N Relay UE\'s source L2 ID, candidate U2N Relay UE\'s serving cell ID taken
into the authorized PLMN list which is retrieved from AMF.
4\. T-AMF selection: same as step 2 in clause 4.9.1.3.2 of TS 23.502 [8].
5\. S-AMF to T-AMF: Namf_Communication_CreateUEContext Request is sent as
specified in step 3 in clause 4.9.1.3.2 of TS 23.502 [8] in addition at least
selected L2 U2N Relay UE\'s source L2 ID, selected U2N Relay UE\'s serving
cell ID if the source gNB selects a target U2N relay UE;
Namf_Communication_CreateUEContext Request is sent as specified in step 3 in
clause 4.9.1.3.2 of TS 23.502 [8] in addition at least candidate L2 U2N Relay
UE\'s source L2 ID, candidate U2N Relay UE\'s serving cell ID if the target
gNB selects a target U2N relay UE.
6\. The procedures are performed as step 4 to 8 as specified in clause
4.9.1.3.2 of TS 23.502 [8].
7\. T-AMF to T-RAN: Handover Request is sent as specified in step 9 in clause
4.9.1.3.2 of TS 23.502 [8] in addition at least selected L2 U2N Relay UE\'s
source L2 ID, selected U2N Relay UE\'s serving cell ID if the source gNB
selects a target U2N relay UE; Handover Request is sent as specified in step 9
in clause 4.9.1.3.2 of TS 23.502 [8] in addition at least L2 U2N Relay UE\'s
source L2 ID, U2N Relay UE\'s serving cell ID if the target gNB selects a
target U2N relay UE. The target UE selects a U2N relay UE.
8\. This step is performed as step2 in clause 16.12.6.1 of TS 38.300 [15]
9\. The procedures are performed as steps 10 to 12 as specified in clause
4.9.1.3.2 of TS 23.502 [8].
10\. The procedures are performed as steps 1 to 3 as specified in clause
4.9.1.3.3 of TS 23.502 [8].
Step 11 and step 12 are performed as step 4 and step 5 in clause 16.12.6.2 of
TS 38.300 [15].
If the selected U2N Relay UE is in RRC_IDLE or RRC_INACTIVE, step 7 will
trigger the U2N Relay UE to enter RRC_CONNECTED state, then in this case step
12 will be performed before step 8.
13\. The procedures are performed as steps 5 to 15b in clause 4.9.1.3.3 of TS
23.502 [8].
Editor\'s note: The procedures have RAN dependency. The procedures are
required to be evaluated by RAN WGs.
### 6.23.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
gNB:
\- source gNB selects a target relay UE and sends the target relay UE info to
AMF or target gNB; or
\- target gNB selects a target relay UE and source gNB sends the candidate
relay UE info to AMF or target gNB.
AMF:
\- Receives the selected or candidate U2N relay UE info from gNB and AMF.
\- Sends the selected U2N relay UE info to target gNB or the candidate U2N
relay UE info to target gNB.
\- Sends the authorized PLMN list to gNB.
## 6.24 Solution #24: Service continuity support for path switch between
direct network communication path and indirect network communication path for
Layer-2 UE-to-Network Relay
### 6.24.1 General Description
This solution addresses KI#4 (as defined in clause 5.4) to support service
continuity for Layer-2 Remote UE path switch between direct network
communication path and indirect network communication path via Layer-2 UE-to-
Network Relay.
Figure 6.24.1-1: Layer 2 Remote UE path switch between direct and indirect
network communication path via Layer-2 UE-to-Network Relay
As described in clause 6.5.2 of TS 23.304 [3], 5G ProSe Layer-2 Remote UE
connected to the network via a Layer-2 UE-to-Network Relay UE has a NAS
connection and AS layer (RRC) connection to 5GS, similar to a UE connected
directly to the network. Thus, Layer-2 Remote UE can be in CM-IDLE or CM-
CONNECTED with RRC_CONNECTED or RRC_INACTIVE state. In TS 23.502 [8], network
controlled handover procedures are defined for handling the mobility of a UE
in CM-CONNECTED with RRC_CONNECTED state. These network controlled handover
procedures are reused for UE path switch between a direct communication path
and indirect communication path via Layer-2 UE-to-Network Relay connected to
same NG-RAN or different NG-RAN.
Layer-2 Remote UE in CM-IDLE or CM-CONNECTED with RRC_INACTIVE state can only
support UE controlled handover procedures based on Relay (re)selection
procedures.
### 6.24.2 Procedures
#### 6.24.2.1 Relay (re)selection
UE in CM-IDLE or CM-CONNECTED with RRC_INACTIVE state, connected to the direct
path or the indirect network communication path via Layer-2 UE-to-Network
Relay performs the Uu link measurements or the PC5 unicast link measurements
to perform Relay (re)selection, as specified in clause 6.5.3 of TS 23.304 [3].
When the NG-RAN configured measurement thresholds and the criteria for
reselection from direct path to indirect path or from indirect path to direct
path are satisfied, UE performs path switch and establishes connection over
the target path. The target NG-RAN after the path switch may be the same NG-
RAN or different NG-RAN than the source path.
If multiple UE-to-Network Relay UEs satisfy the Relay (re)selection criteria,
the Layer-2 Remote UE select the target UE-to-Network Relay for path switch
based on the 5G ProSe Policy and the Remote UE traffic handling described in
clause 6.5.4 of TS 23.304 [3].
#### 6.24.2.2 Session Continuity
Layer-2 Remote UE in CM-IDLE or CM-CONNECTED with RRC_INACTIVE state:
\- When a UE in CM-IDLE or CM-CONNECTED with RRC_INACTIVE state performs path
switch between direct network communication path and indirect network
communication via Layer-2 UE-to-Network Relay, the Remote UE selects the
target Relay, and perform the mobility procedures as defined in TS 23.502 [8].
Editor\'s note: It is FFS whether there is RAN impacts when the Remote UE in
RRC_INACTIVE state resumes RRC connection via a Layer-2 UE-to-Network Relay.
Layer-2 Remote UE in CM-CONNECTED state:
\- Network controlled handover procedures defined for 3GPP access in clause
4.9.1 of TS 23.502 [8] are reused to support AS/NAS session continuity for
Layer-2 Remote UE in CM-CONNECTED state path switch between direct network
communication path and indirect network communication path via Layer-2 UE-to-
Network Relay.
\- When Xn interface is supported between the source NG-RAN and target NG-RAN,
Xn based inter NG-RAN handover specified in clause 4.9.1.2 of TS 23.502 [8]
are reused.
\- When the Xn interface is not supported the source NG-RAN and target NG-RAN,
Inter NG-RAN node N2 based handover specified in clause 4.9.1.3 of TS 23.502
[8] are reused.
NOTE: Intra-NG-RAN and Inter-NG-RAN AS layer handover procedures for path
switch between direct network communication path and indirect network
communication path via Layer-2 UE-to-Network Relay are defined by RAN WGs.
### 6.24.3 Impacts on Existing Nodes and Functionality
The solution has impacts in the following entities:
5GC entities (AMF, SMF, PCF, UPF):
\- None.
NG-RAN:
\- support the Handover procedures in 3GPP access as defined in TS 23.502 [8]
with the Remote UE connected via a Layer-2 UE-to-Network Relay.
Remote UE:
\- None.
## 6.25 Solution #25: Authorization for Multi-path Transmission via UE-to-
Network Relay and direct Uu using URSP
### 6.25.1 Description
This solution addresses KI#5 and 6, applies to both Layer-2 and Layer-3 UE-to-
UE Relay.
For KI#5, following aspects are covered:
\- Whether and how to authorise a Remote UE to use the multi-path transmission
for specific ProSe service(s).
\- How to provide/update the rules for multiple-path transmission.
For KI#6 (Support of PC5 Service Authorization and Policy/Parameter
Provisioning), two following major aspects are covered:
\- What are necessary enhancements for the procedures related to PC5 service
authorization and policy/parameter provisioning to a UE, compared with what is
currently specified in clause 5.1 of TS 23.304 [3] and clauses 4.2.2.2
(Registration Procedure), 4.2.4.3 (UE Configuration Update procedure for
transparent UE Policy Delivery), 4.16.11 (UE Policy Association Establishment
procedure), 4.16.12 (UE Policy Association Modification procedure) of TS
23.502 [8].
\- what is new information for PC5 service authorization and provisioning
beyond what is currently specified in clause 5.1 of TS 23.304 [3].
The PCF based service authorization and provisioning as defined in TS 23.304
[3] are used as baseline for this solution.
### 6.25.2 Procedures
#### 6.25.2.1 Procedure Enhancement for Multi-path Policy Provisioning to a 5G
ProSe Remote UE
For PCF based Service Authorization and Provisioning to 5G ProSe Remote UE/UE-
to-UE Relay, the Registration procedures as defined in clause 4.2.2.2 of TS
23.502 [8], UE Policy Association Establishment procedure as defined in clause
4.16.11 of TS 23.502 [8] and UE Policy Association Modification procedure as
defined in clause 4.16.12 of TS 23.502 [8] apply with the following additions:
\- If the UE supports Multi-path transmission and 5G ProSe capability as a
Remote UE accessing UE-to-Network Relay and it does not have valid Multi-path
policy, the UE includes the UE Policy Container with indicating the Multi-path
policy provisioning request during registration procedure.
\- If the UE indicates the Multi-path policy provisioning request in the UE
Policy Container, the PCF determines whether to provision the Multi-path
policy to the UE accessing Layer-2 or Layer-3 UE-to-Network Relay based on the
received capability of 5G ProSe Layer-2 or Layer-3 Remote UE from AMF, as
specified in clause 6.1.2.2.2 of TS 23.503 [13], and the PCF provides the
Multi-path policy to the UE by using the procedure as defined in clause
4.2.4.3 of TS 23.502 [8].
#### 6.25.2.2 The Multi-path Policy to a 5G ProSe Remote UE using URSP
Table 6.25.2.2-1: (Table 6.6.2.1-3 in TS 23.503 [13]) Route Selection
Descriptor
+-------------+-------------+------------+-------------+------------+ | Information | Description | Category | PCF | Scope | | name | | | permitted | | | | | | to modify | | | | | | in URSP | | +=============+=============+============+=============+============+ | Route | Determines | Mandatory\ | Yes | UE context | | Selection | the order | (NOTE 1) | | | | Descriptor | in which | | | | | Precedence | the Route | | | | | | Selection | | | | | | Descriptors | | | | | | are to be | | | | | | applied. | | | | +-------------+-------------+------------+-------------+------------+ | Route | This part | Mandatory\ | | | | selection | defines the | (NOTE 2) | | | | components | route | | | | | | selection | | | | | | components | | | | +-------------+-------------+------------+-------------+------------+ | SSC Mode | One single | Optional | Yes | UE context | | Selection | value of | | | | | | SSC mode. | | | | | | | | | | | | (NOTE 5) | | | | +-------------+-------------+------------+-------------+------------+ | Network | Either a | Optional | Yes | UE context | | Slice | single | | | | | Selection | value or a | (NOTE 3) | | | | | list of | | | | | | values of | | | | | | S-NSSAI(s). | | | | +-------------+-------------+------------+-------------+------------+ | DNN | Either a | Optional | Yes | UE context | | Selection | single | | | | | | value or a | | | | | | list of | | | | | | values of | | | | | | DNN(s). | | | | +-------------+-------------+------------+-------------+------------+ | PDU Session | One single | Optional | Yes | UE context | | Type | value of | | | | | Selection | PDU Session | (NOTE 8) | | | | | Type | | | | +-------------+-------------+------------+-------------+------------+ | N | Indicates | Optional | Yes | UE context | | on-Seamless | if the | | | | | Offload | traffic of | (NOTE 4) | | | | indication | the | | | | | | matching | | | | | | application | | | | | | is to be | | | | | | offloaded | | | | | | to non-3GPP | | | | | | access | | | | | | outside of | | | | | | a PDU | | | | | | Session. | | | | +-------------+-------------+------------+-------------+------------+ | ProSe | Indicates | Optional | Yes | UE context | | Layer-3 | if the | | | | | UE | traffic of | (NOTE 4) | | | | -to-Network | the | | | | | Relay | matching | | | | | Offload | application | | | | | indication | is to be | | | | | | sent via a | | | | | | ProSe | | | | | | Layer-3 | | | | | | UE | | | | | | -to-Network | | | | | | Relay | | | | | | outside of | | | | | | a PDU | | | | | | session. | | | | +-------------+-------------+------------+-------------+------------+ | Access Type | Indicates | Optional | Yes | UE context | | preference | the | | | | | | preferred | | | | | | Access Type | | | | | | (3GPP or | | | | | | non-3GPP or | | | | | | Mu | | | | | | lti-Access) | | | | | | when the UE | | | | | | establishes | | | | | | a PDU | | | | | | Session for | | | | | | the | | | | | | matching | | | | | | a | | | | | | pplication. | | | | +-------------+-------------+------------+-------------+------------+ | Multi-Path | Indicates | Optional | Yes | UE context | | preference | the | | | | | | Multi-Path | | | | | | PDU | | | | | | Sessions | | | | | | via direct | | | | | | Uu and | | | | | | Layer-2/3 | | | | | | UE | | | | | | -to-Network | | | | | | Relay is | | | | | | preferred | | | | +-------------+-------------+------------+-------------+------------+ | PDU Session | An | Optional | Yes | UE context | | Pair ID | indication | | | | | | shared by | | | | | | redundant | | | | | | PDU | | | | | | Sessions as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 5.33.2.1 | | | | | | of | | | | | | TS 23 | | | | | | .501 [2]. | | | | +-------------+-------------+------------+-------------+------------+ | RSN | The RSN as | Optional | Yes | UE context | | | described | | | | | | in | | | | | | clau | | | | | | se 5.33.2.1 | | | | | | of | | | | | | TS 23 | | | | | | .501 [2]. | | | | +-------------+-------------+------------+-------------+------------+ | Route | This part | Optional | | | | Selection | defines the | | | | | Validation | Route | | | | | Criteria | Validation | | | | | | Criteria | | | | | (NOTE 6) | components | | | | +-------------+-------------+------------+-------------+------------+ | Time Window | The time | Optional | Yes | UE context | | | window when | | | | | | the | | | | | | matching | | | | | | traffic is | | | | | | allowed. | | | | | | The RSD is | | | | | | not | | | | | | considered | | | | | | to be valid | | | | | | if the | | | | | | current | | | | | | time is not | | | | | | in the time | | | | | | window. | | | | +-------------+-------------+------------+-------------+------------+ | Location | The UE | Optional | Yes | UE context | | Criteria | location | | | | | | where the | | | | | | matching | | | | | | traffic is | | | | | | allowed. | | | | | | The RSD | | | | | | rule is not | | | | | | considered | | | | | | to be valid | | | | | | if the UE | | | | | | location | | | | | | does not | | | | | | match the | | | | | | location | | | | | | criteria. | | | | +-------------+-------------+------------+-------------+------------+ | NOTE 1: | | | | | | Every Route | | | | | | Selection | | | | | | Descriptor | | | | | | in the list | | | | | | shall have | | | | | | a different | | | | | | precedence | | | | | | value. | | | | | | | | | | | | NOTE 2: At | | | | | | least one | | | | | | of the | | | | | | route | | | | | | selection | | | | | | components | | | | | | shall be | | | | | | present. | | | | | | | | | | | | NOTE 3: | | | | | | When the | | | | | | S | | | | | | ubscription | | | | | | Information | | | | | | contains | | | | | | only one | | | | | | S-NSSAI in | | | | | | UDR, the | | | | | | PCF needs | | | | | | not | | | | | | provision | | | | | | the UE with | | | | | | S-NSSAI in | | | | | | the Network | | | | | | Slice | | | | | | Selection | | | | | | i | | | | | | nformation. | | | | | | The \"match | | | | | | all\" URSP | | | | | | rule has | | | | | | one S-NSSAI | | | | | | at most. | | | | | | | | | | | | NOTE 4: If | | | | | | this | | | | | | indication | | | | | | is present | | | | | | in a Route | | | | | | Selection | | | | | | Descriptor, | | | | | | no other | | | | | | components | | | | | | shall be | | | | | | included in | | | | | | the Route | | | | | | Selection | | | | | | Descriptor. | | | | | | | | | | | | NOTE 5: The | | | | | | SSC Mode 3 | | | | | | shall only | | | | | | be used | | | | | | when the | | | | | | PDU Session | | | | | | Type is IP. | | | | | | | | | | | | NOTE 6: The | | | | | | Route | | | | | | Selection | | | | | | Descriptor | | | | | | is not | | | | | | considered | | | | | | valid | | | | | | unless all | | | | | | the | | | | | | provided | | | | | | Validation | | | | | | Criteria | | | | | | are met. | | | | | | | | | | | | NOTE 7: In | | | | | | this | | | | | | Release of | | | | | | spe | | | | | | cification, | | | | | | inclusion | | | | | | of the | | | | | | Validation | | | | | | Criteria in | | | | | | Roaming | | | | | | scenarios | | | | | | is not | | | | | | considered. | | | | | | | | | | | | NOTE 8: | | | | | | When the | | | | | | PDU Session | | | | | | Type is | | | | | | \ | | | | | | "Ethernet\" | | | | | | or | | | | | | \"Unst | | | | | | ructured\", | | | | | | this | | | | | | component | | | | | | shall be | | | | | | present. | | | | | +-------------+-------------+------------+-------------+------------+
\- ProSe Layer-3 UE-to-Network Relay Offload indication: Indicates that the
traffic of the matching application is to be sent via a ProSe Layer-3 UE-to-
Network Relay outside of a PDU Session when the rule is applied. If this
indication is absent then the traffic matching of the URSP rule shall not be
sent via a ProSe Layer-3 UE-to-Network Relay outside of a PDU Session. If this
component is present without Multi-Path preference indication in a Route
Selection Descriptor, no other components shall be included in the Route
Selection Descriptor. If this component is present with Multi-Path preference
indication in a Route Selection Descriptor, other components can be included
in the Route Selection Descriptor.
\- Multi-Path preference: If the UE needs to establish PDU Sessions, it
indicates such operation via direct Uu and Layer-2/3 UE-to-Network Relay is
preferred.
When the UE has a Layer-2/3 UE-to-Network Relay path available and establishes
a PDU Session, it evaluates the matched URSP rule for application traffic and
decides whether to use Multi-Path PDU Session for the application traffic
based on the Multi-Path preference in the Route Selection Descriptor of a URSP
rule.
#### 6.25.2.3 Using Multi-Path preference at UE
When the UE evaluates URSP rule for application traffic:
\- If the RSD of a matched URSP rule shows ProSe Layer-3 UE-to-Network Relay
Offload indication along with a Multi-Path preference indication, the UE can
use other components included in the RSD to determine a PDU Session (new or
existing PDU Session) over direct Uu or further look into the ProSe Policy for
accessing 5GC via a Layer-3 UE-to-Network Relay if a Layer-3 UE-to-Network
Relay path is available.
\- If the RSD of a matched URSP rule shows Multi-Path preference without a
ProSe Layer-3 UE-to-Network Relay Offload indication, the UE can determine to
use direct Uu, ProSe Layer-3 UE-to-Network Relay with N3IWF or ProSe Layer-3
UE-to-Network Relay based on the availability of the according access path,
the UE uses other components included in the RSD to determine a PDU Session
(new or existing PDU Session).
### 6.25.3 Impacts on services, entities and interfaces
UE:
\- Includes the UE Policy Container with indicating the Multi-path Policy
Provisioning request during registration procedure;
\- Receive and enforce the Multi-path Policy.
PCF:
\- Determine and Send the Multi-path Policy to 5G ProSe Remote UE.
## 6.26 Solution #26: Multi-path transmission via Layer-2 UE-to-Network Relay
### 6.26.1 Description
This solution resolves Key Issue #5 Support of multi-path transmission via
Layer-2 UE-to-Network Relay. As illustrated in figure 6.26.1-1, a (Remote) UE
can use path #1 and path #2 for multi-path transmission between the UE and NG-
RAN, where path #1 is direct network communication path (the UE directly
accesses NG-RAN), and path #2 is indirect network communication path via a
Layer-2 UE-to-Network Relay (the UE accesses NG-RAN using a Layer-2 UE-to-
Network Relay). For the Layer-2 UE-to-Network Relay case, NG-RAN controls the
multi-path connection establishment and the specific transmission such as
splitting or duplication.
Figure 6.26.1-1: Multi-path transmission using Layer-2 UE-to-Network Relay
Editor\'s note: This solution proposes a high-level procedure for multi-path
transmission via Layer-2 UE-to-Network Relay and coordination with RAN WG2 is
needed for solution alignment and update based on RAN WG2 progress and
normative work.
### 6.26.2 Procedures
Figure 6.26.2-1: High-level procedure for Multi-path transmission via Layer-2
U2N Relay
0\. UE1 may get the authorization/policy from the PCF or be preconfigured with
an indication that UE1 is authorized for multi-path transmission via a Layer-2
UE-to-Network Relay.
1\. The UE1 sets up a RRC connection. UE1\'s serving NG-RAN may get
authorization information from the AMF that UE1 is allowed to use multi-path
transmission via Layer-2 UE-to-Network Relay. The AMF gets the authorization
information from UDM as part of the subscription data for 5G ProSe services.
Editor\'s note: Whether the UE establishes RRC connection via direct path or
via indirect path is to be coordinated with RAN WGs.
3\. During PDU session establishment/modification procedure, NG-RAN can decide
that multi-path transmission for a QoS flow can be performed during or after a
QoS Flow establishment, considering the authorization/policy in step 0.
4\. NG-RAN sets up the second transmission path between the UE and the NG-RAN
node and then NG-RAN node transfers user data over the QoS Flow with theUE1
using both of the transmission paths.
Editor\'s note: How to handle the second transmission path between UE1 and the
NG-RAN node is to be determined by RAN WGs.
### 6.26.3 Impacts on services, entities and interfaces
Remote UE:
\- Multi-path connection establishment and the transfer of data via both
paths.
NG-RAN:
\- Multi-path connection establishment and the transfer of data via both
paths, taking into account authorisation from AMF.
AMF:
\- Provide authorisation to NG-RAN.
Editor\'s note: Further impact depends on the input from the RAN WGs.
## 6.27 Solution #27: Remote UE traffic handling for Multi-Path with Layer-3
relay without N3IWF
### 6.27.1 Description
This solution is related to the Key Issue #5: Support of multi-path
transmission for UE-to-Network Relay, and it mainly focuses on supplementing
one direct network communication path with one indirect network communication
path established via Layer 3 UE-to-Network Relay without N3IWF.
In this solution, the 5G ProSe Remote UE triggers the establishment of multi-
path communication based on one or more of the following criteria:
\- Application provides multi-path requirements;
\- UE ProSe policy, UE ProSe policy contains multi-path usage indication which
can be pre-configured or configured by the network;
\- UE implementation, e.g. based on the application layer high QoS
requirement.
\- Enhance URSP, RSD includes a new item \"Multi-Path ProSe Layer-3 UE-to-
Network Relay Offload indication\".
When the 5G ProSe Remote UE determines to use the multi-path transmission
based on the above triggers, the 5G ProSe Remote UE still follows the traffic
handling for 5G ProSe UE-to-Network Relay support as described in clause 6.5.4
of TS 23.304 [3].
When to decide to use multi-path transmission with including the 5G ProSe
Layer-3 relay without N3IWF path, the 5G ProSe Remote UE should have same
understanding on the PDU session parameters usage on the direct network path
and indirect network path, details can be seen in clause 6.27.2.1.
For the application with capability to integrate the traffic from multiple
paths, the Remote UE can directly use direct and indirect path for multi-path
transmission, the integration is up to application layer.
For the application without capability to integrate the traffic from multiple
paths, the procedure in clause 6.27.2.2 is applied, in the procedure, the 5G
ProSe Layer-3 UE-to-Network Relay UE provides the necessary information to the
5GC for the direct path and indirect path PDU sessions to be correlated. If
the two PDU sessions terminate at different UPFs, the 5GC creates a forwarding
tunnel between the UPFs.
The UPF serving the originally established path performs the role of anchor
UPF and routes the traffic to and from the application server while the UPF
terminating the additional path receives the downlink data for the Remote UE
from anchor UPF and sends the uplink data from the Remote UE to the anchor
UPF. With reference to Figure 6.27.1-1, UPF-1 acts as anchor when the direct
path was established first, UPF-2 acts as anchor when the indirect path via
the Layer-3 UE-to-Network Relay path was established first.
NOTE: Multi-path solution with Layer-3 relay without N3IWF defined in clause
6.27.2.2 across different PLMNs is not supported in this release.
Figure 6.27.1-1: Multi-path transmission using a direct path and a path via
Layer-3 UE-to-Network Relay without N3IWF. The UPF of the first path
established acts as anchor path
### 6.27.2 Procedure for Remote UE traffic handling for Multi-Path with
Layer-3 relay without N3IWF
#### 6.27.2.1 Establishment of multipath transmission using Layer-3 UE-to-
Network Relay
Figure 6.27.2.1-1: Multi-path transmission with using 5G ProSe UE-to-Network
Relay without N3IWF
As described in clause 6.5.4 of TS 23.304 [3], the application traffic on the
5G ProSe Remote UE is managed by URSP rules, the 5G ProSe Remote UE
establishes indirect or direct path as the first path based on whether the
selected RSD contains the component of \"5G ProSe Layer-3 UE-to-Network Relay
Offload indication\". The 5G ProSe Remote UE triggers the establishment the
second path when multipath transmission is desired, for example, the first
path cannot satisfy the QoS requirement of the application traffic. When
establishing the second path, the Remote UE determines the parameters of the
second path using the following procedure:
\- If the selected RSD contains the \"5G ProSe Layer-3 UE-to-Network Relay
Offload indication\", then the indirect network path is 5G ProSe Layer-3 UE-
to-Network Relay, then to determine the direct network path:
\- The 5G ProSe Remote UE determines the PDU session parameters (PDU Session
type, DNN, SSC Mode, S-NSSAI, Access Type Preference) based on the UE ProSe
policy as described in clause 5.1.4.1 of TS 23.304 [3].
\- The 5G ProSe Remote UE takes the above determined PDU session parameters as
the PDU session parameters of the direct network path, and to evaluate the
existing PDU sessions, or establish a new PDU session.
\- If the selected RSD does not contain the \"5G ProSe Layer-3 UE-to-Network
Relay Offload indication\" and it determines to use direct network path as the
first path, then to determine the indirect network path:
\- If there is the configurations for 5G ProSe Layer-3 UE-to-Network Relay
without N3IWF and the 5G ProSe Layer-3 UE-to-Network Relay without N3IWF is
selected as the indirect path, the 5G ProSe Layer-3 Remote UE takes UE ProSe
policy as described in clause in clause 5.1.4.1 of TS 23.304 [3] to determine
the RSC and corresponding PDU session parameters for the indirect network path
setup.
Another option is that the indirect path and direct path are always
established for transmitting the application traffic based on URSP rules. The
5G ProSe Remote UE establishes the indirect path and direct path based on the
selected RSD containing the new component of \"Multi-Path 5G ProSe Layer-3 UE-
to-Network Relay Offload indication\". Either the indirect path or direct path
can be used as the first path based on UE implementation. The 5G ProSe Remote
UE can trigger the establishment of the indirect path and direct path
consecutively in either order. The PDU session parameters together with
\"Multi-Path 5G ProSe Layer-3 UE-to-Network Relay Offload indication\" in the
selected RSD are used as the PDU session parameters for the direct path, and
the RSC used for the indirect path can be decided by ProSe policy as per
Rel-17.
#### 6.27.2.2 Procedure
Figure 6.27.2.2-1 illustrates the procedure for establishing multipath
transmission via a Layer 3 UE-to-Network relay by correlating direct path and
indirect path. Steps 1a-2a illustrate the scenario1where an indirect path via
a Layer-3 UE-to-Network Relay is added to an existing direct path; steps 1b-2b
illustrate the scenario where a direct path is added to an established
indirect path via a Layer-3 UE-to-Network Relay. The remaining steps are
common to both scenarios.
When establishing the second path, the Remote UE determines the PDU session
parameters of the second path as specified in clause 6.27.2.1.
In this procedure, we always assume that AMF-1, SMF-1 and UPF-1 serve the PDU
session of the Remote UE using the direct path, and AMF-2, SMF-2 and UPF-2
serve the PDU session of the Layer 3 UE-to-Network Relay in the indirect path.
Which UPF performs the role of anchor UPF depends on which PDU session was
first established, i.e. for scenario 1 the UPF-1 performs the role of anchor
UPF and for scenario 2 the UPF-2 performs the role of anchor UPF.
Figure 6.27.2.2-1: Establishment of multipath transmission using Layer-3 UE-
to-Network Relay
0\. The Remote UE is authorized by network to use Layer-3 multipath
transmission with Layer-3 UE-to-Network Relay. The Layer-3 UE-to-Network Relay
is authorized by network to provide indirect path for Remote UE performing
Layer-3 multipath transmission with a Layer-3 UE-to-Network Relay.
1a. The Remote UE establishes PDU session-1 and QoS flow-1 as defined in TS
23.502 [8] for direct path. This PDU session is served by UPF-1. The remote UE
exchanges data with an Application Server via UPF-1.
1b. The Remote UE establishes indirect path as defined in TS 23.304 [3],
during this procedure, The Layer-3 UE-to-Network Relay may establish or modify
PDU session-2 and QoS flow-2 to relay the traffic of the Remote UE. T PDU
session-2 is served by UPF-2. The remote UE exchanges data with an Application
Server via UPF-2.
2a. Same as 1b.
2b. Same as 1a.
3\. The Remote UE request Layer-3 UE-to-Network to modify one-to-one
communication as defined in TS 23.304 [3] with following additions:
The Remote UE provides \"L3 relay multipath\" that indicates to the Layer-3
UE-to-Network Relay that the Remote UE intends to use the indirect path via
the Layer-3 UE-to-Network Relay in a multipath configuration.
The Remote UE sends its 5G-GUTI, the PDU session ID and QFI that it uses for
multipath transmission. This information will be used for correlating the
direct and indirect communication paths in the core network.
The anchor path that indicates which path should be configured as anchor path.
For scenario 1, the anchor path is the direct path and for scenario 2, the
anchor path is the indirect path.
The Remote UE also indicates Layer-3 UE-to-Network Relay PC5 QoS flow Identity
on which traffic data is subject to multipath transmission.
The Remote UE may also indicate PC5 QoS rule if only some traffic on a PC5 QoS
flow is subject to multipath transmission.
4\. The Layer-3 UE-to-Network Relay initiates the PDU Session Modification
procedure transmitting a NAS message (N1 SM container (PDU Session
Modification Request)) to AMF-2 as defined in TS 23.502 [8] with the
additional parameters in NAS: \"L3 relay multipath\", Layer-3 UE-to-Network
Relay PDU session ID (PDU session ID-2) and QFI (QFI-2) or QoS rule (QoS
rule-2) used for the Remote UE traffic, Remote UE 5G-GUTI ,Remote User ID, PDU
session ID-1 and QFI(QFI-1) or QoS rule (QoS rule-1) for the data for Layer-3
multipath transmission and anchor path.
5\. AMF-2 uses the Remote UE 5G-GUTI to determine AMF-1 which serves the
Remote UE and gets the address of the SMF that serves the PDU session ID-1
(SMF-1).
Step6\~step11 are used to establish tunnel between UPF1 and UPF2 to forwarding
data for multipath transmission.
6\. AMF-2 requests SMF-2 to modify the PDU session using
Nsmf_PDUSession_UpdateSMContext Request as defined in TS 23.502 [8]. In this
step, AMF-2 forwards the additional parameters received in step 4 to SMF-2
with the addition of the address of SMF-1.
7a. The SMF-2 sends an N4 Session Modification Request to the UPF-2.
If the SMF-2 supports the Layer-3 UE-to-Network Relay multipath transmission,
SMF-2 instructs UPF-2 to establish a forwarding tunnel (CN downlink Tunnel for
scenario 1 or CN uplink Tunnel for scenario 2).
Based on the Remote User ID, the SMF-2 retrieves the Remote UE info and
generate PDR for UPF-2 to identify traffic data of the Remote UE for multipath
transmission.
If anchor path is the direct path (scenario 1), SMF-2 instruct UPF-2 to send
the uplink data received from UPF-1 via forwarding tunnel to the Application
Server.
If anchor path is the indirect path (scenario 2), SMF-2 instruct UPF-2 to send
a copy of the downlink data for Layer-3 multipath transmission to UPF-1.
7b. UPF-2 acknowledges the request to establish a tunnel by sending an N4
Session Modification Response.\ UPF-2 provides CN downlink Tunnel for scenario
1 or CN uplink Tunnel for scenario 2 to SMF-2.
8\. SMF-2 sends Nsmf_PDUSession_UpdateSMContext Request as defined in TS
23.502 [8] to SMF-1 with the following parameters: \"L3 relay multipath\",
Remote UE SUPI, Remote UE PDU session ID (PDU session ID-1) and QFI (QFI-1) or
QoS rule (QoS rule-1) and anchor path.
9a. SMF-1 sends an N4 Session Modification Request to the UPF-1.
If SMF-1 supports Layer-3 multipath transmission for the Remote UE, SMF-1
provides UPF-1 the information about the CN downlink/uplink Tunnel info
established in step 7.
The SMF-1 also instructs UPF-1 to establish a forwarding channel (CN uplink
Tunnel for scenario 1 or CN downlink Tunnel for scenario 2).
If anchor path is the direct path (scenario 1), SMF-1 also instruct UPF-1 to
send a copy of the downlink data for Layer-3 multipath transmission to UPF-2.
If anchor path is the indirect path (scenario 2), SMF-2 instruct UPF-2 to send
the uplink data received from UPF-2 via forwarding tunnel to the Application
Server.
9b. UPF-1 acknowledges by sending an N4 Session Modification Response.\ UPF-1
provides CN uplink Tunnel Info (scenario 1) or CN downlink Tunnel Info
(scenario 2) as forwarding tunnel to SMF-1.
10\. SMF-1 to SMF-2: Nsmf_PDUSession_UpdateSMContext Response (CN
Uplink/Downlink Tunnel Info).
11a. SMF-2 sends an N4 Session Modification Request to the UPF-2(CN uplink
Tunnel Info (scenario 1) or CN downlink Tunnel Info (scenario 2)).
11b. The UPF-1 acknowledges by sending an N4 Session Modification Response.
12-13. The traffic data applied to Layer-3 multipath transmission are
transmitted both on direct path (12a for scenario 1 and 13a for scenario 2)
and indirect path (12b for scenario 1 and 13b for scenario 2) based on the
Layer-3 multipath transmission strategy (switching/redundancy).
For the data to be transmitted on the first path, the Remote UE generates IP
packets based on IP address and port number of the first path.
For the data to be transmitted on the second path, the following manipulation
of the IP header is enhanced for the uplink and downlink as following:
Uplink
\- The Remote UE sets two IP headers, the inner IP header is generated with
the IP address and port of the first path, and the outer IP header is
generated with the IP address and port of the second path.
\- The UPF that serves the first path removes the outer IP header received
from the UPF that serves the second path and performs IP layer elimination and
sorting for the data from two path.
Downlink
\- The Remote UE removes the outer IP header and performs IP layer elimination
and sorting for the data from two path.
\- The UPF that serves the second path adds an additional IP header for the
data received from the UPF that serves the first path based on the IP address
and port number assigned for the Layer-3 UE-to-Network Relay that serves the
Remote UE (scenario 1) or the IP address and port number assigned to the
Remote UE (scenario 2).
### 6.27.3 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
Remote UE(s):
\- Support multi-path transmission.
\- Can determine the PDU session parameters based on another path without URSP
evaluation for multi-path transmission with including the 5G ProSe Layer-3
relay without N3IWF path.
\- Support packet replication and elimination for two paths.
\- Provides Remote UE 5G-GUTI and direct path\'s PDU session info to Layer-3
UE-to-Network Relay.
\- Support IP in IP address encapsulation.
Layer-3 UE-to-Network Relay:
\- Provide both direct and indirect path\'s PDU session info to Core network
for correlation of two PDU sessions.
PCF:
\- Support authorisation for both the Remote UE and Layer-3 UE-to-Network
Relay with Layer-3 multipath transmission.
SMF:
\- Support enhanced PDR for Layer-3 multipath transmission.
UPF:
\- Support IP data handling and forwarding based on PDR for Layer-3 multipath
transmission.
## 6.28 Solution #28: Multi-path transmission support for one direct path and
one indirect network communication path
### 6.28.1 General Description
This is a solution to support KI#5 (as defined in clause 5.5) multi-path
transmission for a UE using one direct network communication path and one
indirect network communication path, as shown in Figure 6.28.1-1. Indirect
network communication path can be via a Layer-3 UE-to-Network Relay with or
without N3IWF access or Layer-2 UE-to-Network Relay.
Figure 6.28.1-1: Multi-path transmission using a direct Uu path and indirect
network communication path
Supporting multi-path connectivity using 3GPP features like ATSSS or Multi-
Radio Dual Connectivity (MR-DC) is dependent on whether the Remote UE has an
AS connection or NAS connection with the Network.
Layer-3 Remote UE does not have a 5G connection when connected via Layer-3 UE-
to-Network Relay without N3IWF as defined in clause 6.5.1.1 of TS 23.304 [3].
Thus, Application layer mechanisms are used to support multi-path transmission
for Layer-3 Remote UE. Application layer can decide when to setup the multi-
path connectivity and how to aggregate/split the traffic on both paths.
On the other hand, when the Layer-3 Remote UE access the network via a Layer-3
UE-to-Network Relay with N3IWF support, as defined in clause 6.5.1.2 of TS
23.304 [3], it has NAS connection with the 5GC and PDU session will be used
for the application traffic. The ATSSS feature supports a multi-access PDU
Connectivity Service, which can exchange PDUs between the UE and a data
network by simultaneously using one 3GPP access network and one untrusted
non-3GPP access network and two independent N3/N9 tunnels between the PSA and
RAN/AN. As the Layer-3 Remote UE connection via Layer-3 UE-to-Network Relay
with N3IWF is considered as \"untrusted non-3GPP access to 5GC via N3IWF\",
ATSSS feature can be used to support multi-path transmission for Layer-3
Remote UE connected to network using one 3GPP access network (i.e. direct
path) and one non-3GPP access network (i.e. indirect path via Layer-3 UE-to-
Network Relay with N3IWF), as shown in Figure 6.28.1-2.
Figure 6.28.1-2: Multi-path transmission using ATSSS for a direct path and
indirect path via Layer-3 UE-to-Network Relay with N3IWF
Layer-2 Remote UE has a NAS connection and AS connection, similar to a UE
connected directly to the network via Uu connectivity. Multi-Radio Dual
Connectivity (MR-DC) is supported in NG-RAN to allow multi-path transmission
for a UE connected to the network via two access nodes. Similar approach can
be introduced to support multi-path transmission for a CM-CONNECTED Layer-2
Remote UE that has an AS connection via direct network communication path and
indirect network communication path. The operation details of the MR-DCis
within RAN WGs scope.
Editor\'s note: SA WG2 to coordinate with RAN2 WG on support of multi-path
transmission for Layer-2 Remote UE to determine the impacts for 5GC.
### 6.28.2 Procedures
#### 6.28.2.1 Procedures for MA PDU sessions support for Layer-3 Remote UE
Figure 6.28.2.1-1 provides the procedures for MA PDU session setup by the UE
over direct network communication path and indirect network communication path
via a Layer-3 UE-to-Network Relay with N3IWF.
Figure 6.28.2.1-1: MA-PDU Session establishment over direct network
communication path and indirect network communication path via a Layer-3 UE-
to-Network Relay with N3IWF
1\. 5G ProSe Layer-3 UE-to-Network Relay and Layer-3 Remote UE perform
Registration procedures and obtains the ProSe Policy that corresponds to the
operation supporting the access to N3IWF.
The 5G ProSe Layer-3 Remote UE is configured with the corresponding URSP
rules. The URSP policy indicates if a particular service needs to be accessed
within a PDU Session and thus should use a 5G ProSe Layer-3 UE-to-Network
Relay with N3IWF support as described in clause 6.5.4 of TS 23.304 [3].
2\. Layer-3 Remote UE establishes a MA PDU session for services requiring
multi-path transmission over the direct network communication path, using the
procedures for 3GPP access in clause 4.22 of TS 23.502 [8].
3\. Layer-3 Remote UE, if not connected and registered to the network via a
Layer-3 UE-to-Network Relay with N3IWF, performs relay (re)selection and
performs registration with 5GC using the procedures in clause 6.5.1.2 of TS
23.304 [3]. Remote UE may identify this indirect path as ProSe access type
when establishing MA PDU session.
4\. Layer-3 Remote UE performs MA PDU Session Establishment procedure or adds
the user plane resources over the indirect network communication path using
the procedures in clause 4.22 of TS 23.502 [8].
NOTE 1: There is no sequential dependency on step 2 and 3.
NOTE 2: Layer-3 Remote UE may establish MA PDU session over the indirect path
before the direct path. The sequence of step 2 and 4 could be arbitrary.
### 6.28.3 Impacts on Existing Nodes and Functionality
5GC entities (AMF, SMF, PCF, UPF):
\- support the ATSSS feature as defined in TS 23.502 [8].
NG-RAN:
\- support multi-path connectivity for Layer-2 Remote UE via one direct
network communication path and one indirect network communication path as
specified by RAN.
Remote UE:
\- For Layer-3 relaying: support the ATSSS feature as defined in TS 23.502
[8].
\- For Layer-2 relaying: support multi-path connectivity over one direct
network communication path and one indirect network communication path via
Layer-2 UE-to-Network Relay as specified by RAN.
## 6.29 Solution #29: multi-path transmission for Layer-3 UE-to-Network Relay
without N3IWF
### 6.29.1 Description
#### 6.29.1.1 Overview
In this solution, it proposes to reuse existing procedure as much as possible.
The network can provision the authorization and policy parameters for multi-
path transmission service to UE as existing mechanism specified in TS 23.304
[3]. This solution applies to Layer-3 UE-to-Network Relay without N3IWF.
#### 6.29.1.2 Policy for Multi-path Transmission via Layer-3 UE-to-Network
Relay without N3IWF
In the clause 6.5.4 of TS 23.304 [3] (5G ProSe Remote UE traffic handling for
5G ProSe UE-to-Network Relay support), the application traffic on the 5G ProSe
Remote UE is managed by URSP rules, and the URSP rule is enhanced with the RSD
including \"5G ProSe Layer 3 UE-to-Network Relay Offload indication\".
Using the similar mechanism, the multi-path transmission of application
traffic on 5G ProSe Layer-3 Remote UE is also managed by URSP rules, where the
URSP rule is enhanced with the RSD including a new item \"Multi-Path ProSe
Layer-3 UE-to-Network Relay Offload indication\".
### 6.29.2 Procedures
Table 6.29.2-1: (Table 6.6.2.1-3 in TS 23.503 [13]) Route Selection Descriptor
with Multipath
+-------------+-------------+------------+-------------+------------+ | Information | Description | Category | PCF | Scope | | name | | | permitted | | | | | | to modify | | | | | | in URSP | | +=============+=============+============+=============+============+ | Route | Determines | Mandatory\ | Yes | UE context | | Selection | the order | (NOTE 1) | | | | Descriptor | in which | | | | | Precedence | the Route | | | | | | Selection | | | | | | Descriptors | | | | | | are to be | | | | | | applied. | | | | +-------------+-------------+------------+-------------+------------+ | Route | This part | Mandatory\ | | | | selection | defines the | (NOTE 2) | | | | components | route | | | | | | selection | | | | | | components | | | | +-------------+-------------+------------+-------------+------------+ | SSC Mode | One single | Optional | Yes | UE context | | Selection | value of | | | | | | SSC mode. | | | | | | | | | | | | (NOTE 5) | | | | +-------------+-------------+------------+-------------+------------+ | Network | Either a | Optional | Yes | UE context | | Slice | single | | | | | Selection | value or a | (NOTE 3) | | | | | list of | | | | | | values of | | | | | | S-NSSAI(s). | | | | +-------------+-------------+------------+-------------+------------+ | DNN | Either a | Optional | Yes | UE context | | Selection | single | | | | | | value or a | | | | | | list of | | | | | | values of | | | | | | DNN(s). | | | | +-------------+-------------+------------+-------------+------------+ | PDU Session | One single | Optional | Yes | UE context | | Type | value of | | | | | Selection | PDU Session | (NOTE 8) | | | | | Type | | | | +-------------+-------------+------------+-------------+------------+ | N | Indicates | Optional | Yes | UE context | | on-Seamless | if the | | | | | Offload | traffic of | (NOTE 4) | | | | indication | the | | | | | | matching | | | | | | application | | | | | | is to be | | | | | | offloaded | | | | | | to non-3GPP | | | | | | access | | | | | | outside of | | | | | | a PDU | | | | | | Session. | | | | +-------------+-------------+------------+-------------+------------+ | ProSe | Indicates | Optional | Yes | UE context | | Layer-3 | if the | | | | | UE | traffic of | (NOTE 4) | | | | -to-Network | the | | | | | Relay | matching | | | | | Offload | application | | | | | indication | is to be | | | | | | sent via a | | | | | | ProSe | | | | | | Layer-3 | | | | | | UE | | | | | | -to-Network | | | | | | Relay | | | | | | outside of | | | | | | a PDU | | | | | | session. | | | | +-------------+-------------+------------+-------------+------------+ | Multi-Path | Indicates | Optional | Yes | UE context | | ProSe | if the | | | | | Layer-3 | traffic of | | | | | UE | the | | | | | -to-Network | matching | | | | | Relay | application | | | | | Offload | is to be | | | | | indication | sent using | | | | | | Multi-Path | | | | | | via direct | | | | | | Uu path and | | | | | | a Layer-3 | | | | | | UE | | | | | | -to-Network | | | | | | Relay path. | | | | +-------------+-------------+------------+-------------+------------+ | Access Type | Indicates | Optional | Yes | UE context | | preference | the | | | | | | preferred | | | | | | Access Type | | | | | | (3GPP or | | | | | | non-3GPP or | | | | | | Mu | | | | | | lti-Access) | | | | | | when the UE | | | | | | establishes | | | | | | a PDU | | | | | | Session for | | | | | | the | | | | | | matching | | | | | | a | | | | | | pplication. | | | | +-------------+-------------+------------+-------------+------------+ | PDU Session | An | Optional | Yes | UE context | | Pair ID | indication | | | | | | shared by | | | | | | redundant | | | | | | PDU | | | | | | Sessions as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 5.33.2.1 | | | | | | of | | | | | | TS 23 | | | | | | .501 [2]. | | | | +-------------+-------------+------------+-------------+------------+ | RSN | The RSN as | Optional | Yes | UE context | | | described | | | | | | in | | | | | | clau | | | | | | se 5.33.2.1 | | | | | | of | | | | | | TS 23 | | | | | | .501 [2]. | | | | +-------------+-------------+------------+-------------+------------+ | Route | This part | Optional | | | | Selection | defines the | | | | | Validation | Route | | | | | Criteria | Validation | | | | | | Criteria | | | | | (NOTE 6) | components | | | | +-------------+-------------+------------+-------------+------------+ | Time Window | The time | Optional | Yes | UE context | | | window when | | | | | | the | | | | | | matching | | | | | | traffic is | | | | | | allowed. | | | | | | The RSD is | | | | | | not | | | | | | considered | | | | | | to be valid | | | | | | if the | | | | | | current | | | | | | time is not | | | | | | in the time | | | | | | window. | | | | +-------------+-------------+------------+-------------+------------+ | Location | The UE | Optional | Yes | UE context | | Criteria | location | | | | | | where the | | | | | | matching | | | | | | traffic is | | | | | | allowed. | | | | | | The RSD | | | | | | rule is not | | | | | | considered | | | | | | to be valid | | | | | | if the UE | | | | | | location | | | | | | does not | | | | | | match the | | | | | | location | | | | | | criteria. | | | | +-------------+-------------+------------+-------------+------------+ | NOTE 1: | | | | | | Every Route | | | | | | Selection | | | | | | Descriptor | | | | | | in the list | | | | | | shall have | | | | | | a different | | | | | | precedence | | | | | | value. | | | | | | | | | | | | NOTE 2: At | | | | | | least one | | | | | | of the | | | | | | route | | | | | | selection | | | | | | components | | | | | | shall be | | | | | | present. | | | | | | | | | | | | NOTE 3: | | | | | | When the | | | | | | S | | | | | | ubscription | | | | | | Information | | | | | | contains | | | | | | only one | | | | | | S-NSSAI in | | | | | | UDR, the | | | | | | PCF needs | | | | | | not | | | | | | provision | | | | | | the UE with | | | | | | S-NSSAI in | | | | | | the Network | | | | | | Slice | | | | | | Selection | | | | | | i | | | | | | nformation. | | | | | | The \"match | | | | | | all\" URSP | | | | | | rule has | | | | | | one S-NSSAI | | | | | | at most. | | | | | | | | | | | | NOTE 4: If | | | | | | this | | | | | | indication | | | | | | is present | | | | | | in a Route | | | | | | Selection | | | | | | Descriptor, | | | | | | no other | | | | | | components | | | | | | shall be | | | | | | included in | | | | | | the Route | | | | | | Selection | | | | | | Descriptor. | | | | | | | | | | | | NOTE 5: The | | | | | | SSC Mode 3 | | | | | | shall only | | | | | | be used | | | | | | when the | | | | | | PDU Session | | | | | | Type is IP. | | | | | | | | | | | | NOTE 6: The | | | | | | Route | | | | | | Selection | | | | | | Descriptor | | | | | | is not | | | | | | considered | | | | | | valid | | | | | | unless all | | | | | | the | | | | | | provided | | | | | | Validation | | | | | | Criteria | | | | | | are met. | | | | | | | | | | | | NOTE 7: In | | | | | | this | | | | | | Release of | | | | | | spe | | | | | | cification, | | | | | | inclusion | | | | | | of the | | | | | | Validation | | | | | | Criteria in | | | | | | Roaming | | | | | | scenarios | | | | | | is not | | | | | | considered. | | | | | | | | | | | | NOTE 8: | | | | | | When the | | | | | | PDU Session | | | | | | Type is | | | | | | \ | | | | | | "Ethernet\" | | | | | | or | | | | | | \"Unst | | | | | | ructured\", | | | | | | this | | | | | | component | | | | | | shall be | | | | | | present. | | | | | +-------------+-------------+------------+-------------+------------+
The ProSe Layer-3 UE-to-Network Relay Offload indication and Multi-Path ProSe
Layer-3 UE-to-Network Relay Offload indication are separated indications.
ProSe Layer-3 UE-to-Network Relay Offload indication is used for only one path
via a ProSe Layer-3 UE-to-Network Relay, and if present no other components
shall be included. The Multi-Path ProSe Layer-3 UE-to-Network Relay Offload
indication acts in a similar way to the existing indication, except it is an
additional indication that can be present with other components and indicates
that the traffic can be sent via direct Uu and outside of a PDU Session via a
Layer-3 UE-to-Network Relay.
\- ProSe Layer-3 UE-to-Network Relay Offload indication (existing Rel-17
component): Indicates that the traffic of the matching application is to be
sent via a ProSe Layer-3 UE-to-Network Relay outside of a PDU Session when the
rule is applied. If this indication is absent then the traffic matching of the
URSP rule shall not be sent via a ProSe Layer-3 UE-to-Network Relay outside of
a PDU Session. If this component is present in a Route Selection Descriptor,
no other components shall be included in the Route Selection Descriptor.
\- Multi-Path ProSe Layer-3 UE-to-Network Relay Offload indication (new
indication for Rel-18): Indicates that the traffic of the matching application
is to be sent using Multi-Paths of direct via a Uu path (as determined by the
other components in the RSD) and sent outside of a PDU Session using a Layer-3
UE-to-Network Relay. If this indication is absent then the traffic matching of
the URSP rule shall not be sent using the multiple of directly via Uu and
outside of a PDU Session using a Layer-3 UE-to-Network Relay. If this
component is present in a Route Selection Descriptor, other components can be
included in the Route Selection Descriptor.
When the UE evaluates URSP rule for application traffic:
\- If the selected RSD contains \"Multi-Path ProSe Layer-3 UE-to-Network Relay
Offload indication\":
\- The 5G ProSe Remote UE can route the traffic over an existing PC5
connection with 5G ProSe Layer-3 UE-to-Network Relay and existing PDU Session
matched to other components (e.g. Network Slice Selection) in the selected
RSD, when such connections are available.
\- If the PC5 connection with 5G ProSe Layer-3 UE-to-Network Relay is not
available, this may trigger the 5G ProSe Remote UE to start 5G ProSe UE-to-
Network Relay discovery and connection establishment, controlled by the ProSe
Policy configured on the 5G ProSe Remote UE.
\- If the PDU Session matched to other components is not available, this will
trigger to establish a new PDU Session using the values specified by the
selected RSD.
The Route Selection Descriptor of a URSP rule shall be only considered valid
if Multi-Path ProSe Layer-3 UE-to-Network Relay Offload indication is present
and the UE supports the ProSe capability of 5G ProSe Layer-3 Remote UE.
#### 6.29.2.2 Procedure for Multi-path connection establishment via Layer-3
UE-to-Network Relay without N3IWF
There following cases are described, depending upon what connections are
existing:
\- Case A, UE has established Uu connection to deliver traffic to the target
DN. When UE is authorized to use the multi-path transmission service for a
specific traffic based on URSP, the UE triggers discovery of a UE-to-Network
Relay and tries to establish a connection to the same target for data traffic
as existing mechanism specified in TS 23.304 [3].
\- Case B, UE has established 3GPP connection to the target DN via UE-to-
Network Relay. When UE is authorized to use the multi-path transmission
service for a specific traffic based on URSP, the UE triggers the
establishment of a 3GPP connection via Uu as specified in TS 23.502 [8], e.g.
establishing a PDU Session to deliver the traffic to the same DN.
\- Case C, UE has not established Uu connection to deliver traffic to the
target DN and has not established 3GPP connection to the target DN via UE-to-
Network Relay. When the UE is authorized to use the multi-path transmission
service for a specific traffic based on URSP, the UE perform the actions in
case A and case B, i.e. triggers discovery and connection via a UE-to-Network
Relay, and establish a Uu connection and/or a PDU Session over Uu to deliver
the traffic to the same target DN.
For all the cases, how to integrate the traffic from both the Uu connection
and the connection via UE-to-Network Relay is up to the application layer.
### 6.29.3 Impacts on services, entities and interfaces
No impact on 3GPP for Multi-path connection establishment via Layer-3 UE-to-
Network Relay without N3IWF.
URSP enhancement for Multi-path Transmission via Layer-3 UE-to-Network Relay
without N3IWF.
## 6.30 Solution #30: Layer-2 UE-to-UE Relaying
### 6.30.1 Description
The solution applies to Key Issue #1 \"Support of UE-to-UE Relay\", and is
used for Layer-2 UE-to-UE Relay.
The solution proposes the procedure of Layer-2 UE-to-UE Relay discovery and
connection establishment.
### 6.30.2 Procedures
#### 6.30.2.1 Procedures for UE-to-UE Relay discovery
##### 6.30.2.1.1 Procedure for UE-to-UE Relay discovery with Model A
Depicted in figure 6.30.2.1.1-1 is the procedure for UE-to-UE Relay discovery
with Model A.
Figure 6.30.2.1.1-1: UE-to-UE Relay discovery with Model A
1\. The UE-to-UE Relay has discovered other UEs in proximity via the direct
discovery or direct communication procedures.
2\. The UE-to-UE Relay sends an Announcement message. The Announcement message
may include the Type of Discovery Message, User Info ID of the UE-to-UE Relay,
RSC, and User Info ID of the proximity UEs.
The Source Layer-2 ID of the Announcement message is self-assigned by the UE-
to-UE Relay, and the Destination Layer-2 ID is selected based on the ProSe
policy.
##### 6.30.2.1.2 Procedure for UE-to-UE Relay discovery with Model B
Depicted in figure 6.30.2.1.2-1 is the procedure for UE-to-UE Relay discovery
with Model B.
Figure 6.30.2.1.2-1: UE-to-UE Relay discovery with Model B
1\. The Source UE broadcasts a Solicitation message. The Solicitation message
may include the Type of Discovery Message, User Info ID of Source UE, User
Info ID of Target UE, and RSC.
The Source Layer-2 ID of the Announcement message is self-assigned by the
Source UE, and the Destination Layer-2 ID is selected based on the ProSe
policy.
2\. On reception of the Solicitation message, a candidate UE-to-UE Relay (e.g.
UE-to-UE Relay 1 and UE-to-UE Relay 2) broadcasts a Solicitation message
carrying the User Info ID of Source UE, User Info ID of Target UE, User Info
ID of the UE-to-UE Relay, and the RSC.
The Source Layer-2 ID of the Announcement message is self-assigned by the
candidate UE-to-UE Relay, and the Destination Layer-2 ID is selected based on
the ProSe policy.
3\. The Target UE chooses UE-to-UE Relay 1 from the candidate UE-to-UE Relays
based on, e.g. signal strength. The Target UE responds to UE-to-UE Relay 1.
4\. UE-to-UE Relay 1 responds to the Source UE.
#### 6.30.2.2 Procedures for Layer-2 UE-to-UE Relay connection establishment
Depicted in figure 6.30.2.2-1 is the procedure for Layer-2 UE-to-UE Relay
connection establishment.
Figure 6.30.2.1.2-1: Layer-2 UE-to-UE Relay connection establishment
1\. Service authorisation and policy provisioning is performed for the Source
UE, Target UE and UE-to-UE Relay as described in the solutions for KI#6.
2\. UE-to-UE Relay discovery is performed as described in clause 6.30.2.1.
3\. The Source UE and Target UE may need to setup or modify the PC5 link with
UE-to-UE Relay.
If there is no PC5 link between the Source UE and the UE-to-UE Relay that can
be used for relaying, e.g. based on RSC, then a new PC5 link needs to be setup
in step 3a by the Source UE, otherwise the existing link can be modified by
the Source UE to support communication between the Source and Target UEs. User
Info ID of Target UE is included in the Direct Communication Request message
or Link Modification Request message. The Target User Info for the Target UE
is obtained from the discovery procedure performed in step 2.
If there is no PC5 link between the UE-to-UE Relay and the Target UE that can
be used for relaying, e.g. based on RSC, then a new PC5 link needs to be setup
in step 3b by the UE-to-UE Relay, otherwise the existing link can be modified
by the UE-to-UE Relay to support communication between the Source and Target
UEs.
If a new PC5 link needs to be setup in either step 3a or step 3b the
destination Layer-2 ID may be broadcast or unicast Layer-2 ID and the Source
Layer-2 ID is self-assigned by the Source UE or the UE-to-UE Relay. When a
unicast destination Layer-2 ID is used, it is obtained during the discovery
procedure performed in step 2.
NOTE 1: RAN coordination on support of per-hop PC5 link sharing between the
Source UE and UE-to-UE Relay, and UE-to-UE Relay and Target UE is needed.
4\. The Source UE sends a Direct Communication Request message to initiate the
unicast Layer-2 link establishment procedure with the Target UE. The Direct
Communication Request message includes User Info ID of Source UE, User Info ID
of Target UE, QoS Info (PFI and PC5 QoS parameters) and RSC.
The Direct Communication Request message is sent over the PC5 link with the
UE-to-UE Relay. The Source Layer-2 ID and the Destination Layer-2 ID of the
PC5 link setup or modified in step 3a are used.
The UE-to-UE Relay forwards the Direct Communication Request message towards
the Target UE, and the Direct Communication Request message is sent over the
PC5 link with the Target UE. The Source Layer-2 ID and the Destination Layer-2
ID of the PC5 link setup or modified in step 3b are used.
5\. The Target UE triggers the security procedure with Source UE.
6\. The Target UE sends a Direct Communication Accept message to the Source
UE. The Direct Communication Accept message includes User Info ID of Source
UE, User Info ID of Target UE, QoS Info (PFI and PC5 QoS parameters) and RSC.
NOTE 2: RAN WGs will define how the E2E QoS will be handled and split over the
PC5 links.
7\. The end-to-end QoS flow is established between Source UE and Target UE.
The data is transferred between the Source UE and the Target UE via the UE-to-
UE Relay.
Editor\'s note: How the PC5-S messages in steps 4-6 and the data in step 7 are
forwarded by the UE-to-UE Relay is to be determined by RAN2, such as based on
an Adaptation layer.
### 6.30.3 Impacts on services, entities and interfaces
UE:
\- New functionality related to UE-to-UE Relay discovery and communication.
## 6.31 Solution #31: ProSe 5G Layer-3 UE-to-UE Relay Authorization for IP
address sharing
### 6.31.1 Introduction
Solutions for ProSe 5G Layer-3 UE-to-UE Relay based on IP routing (i.e. #2,
#3, #5, #11 and #12) are defined.
As part of the PC5 unicast link establishment procedure, the ProSe 5G UE-to-UE
Relay allocates an IP address/prefix to the UE or is informed of the UE\'s IP
address/prefix. The Relay stores the association of the UE\'s Application
layer ID (also called User Info) and UE\'s IP address/prefix (e.g. into its
DNS entries).
When a (source) UE needs to communicate with another (target) UE via the ProSe
5G UE-to-UE Relay, it sends a request (e.g. DNS query) to the ProSe 5G UE-to-
UE Relay, over the unicast link, to obtain to the target UE\'s IP
address/prefix (based on Target User Info). The Relay returns the IP
address/prefix of the target UE.
The source UE sends IP data to the target UE via the PC5 unicast link to UE-
to-UE Relay. The UE-to-UE Relay acts as an IP router and forwards the packets
to the corresponding PC5 unicast link towards the target UE.
### 6.31.2 Authorization for IP address sharing support
#### 6.31.2.1 Function Description
A source UE obtaining or registering an IP address from/to a UE-to-UE Relay
may not want its IP address/prefix to be shared with every requesting target
UEs. The source UE may want to divulge its IP address/prefix only with
specific target UEs. This is similar to the restricted discovery mechanism
where only an authorized Discoverer UE may discover a Discoveree UE.
To enable the support of IP address/prefix sharing authorization, a source UE
indicates to the UE-to-UE Relay during the PC5 link establishment procedure if
its IP address/prefix may be shared with target UEs without seeking source UE
authorization or if prior authorization from the source UE is required. In
addition, a source UE may provide a token to the UE-to-UE Relay, allowing the
UE-to-UE Relay to itself authorize the source UE\'s IP address sharing using
this token.
#### 6.31.2.2 Procedures
This procedure enables a source UE to indicate to the UE-to-UE Relay if its IP
address/prefix may be shared with target UEs without seeking its authorization
or if its authorization is required. It also enables the source UE to provide
information to the UE-to-UE Relay to itself validate if the target UE is
authorized to receive the source UE\'s IP address/prefix.
Figure 6.31.2.2-1: S-UE provides its authorization to the UE-to-UE Relay for
IP address sharing
1\. S-UE specifies an indication (authorization needed) and may specify a
token during the PC5 Link Establishment procedure with the UE-to-UE Relay. UE-
to-UE Relay keeps track of this indication and token (if received) with
S-UE\'s User Info, IP address and PC5 related information. S-UE may be pre-
provisioned with the authorization token.
Editor\'s note: The definition and usage of the token needs to be coordinated
with SA3.
2\. UE-to-UE Relay receives a Query message (e.g. DNS Query) from T-UE
specifying S-UE\'s User Info and possibly a token. UE-to-UE Relay fetches
S-UE\'s info and if the authorization needed indication is set, UE-to-UE Relay
validates the token received from T-UE with S-UE\'s saved token, if a token is
received on Query and if a token from S-UE is saved on the UE-to-UE Relay.
The distribution of such token to the T-UE may be facilitated out of band or
in band, e.g. by UE-to-UE Relay after/during the successful Query (as
specified at step 5).
3\. If no token is received from T-UE and/or no token has been provided by
S-UE during the link establishment procedure, UE-to-UE Relay sends a PC5
message (e.g. Link Authorization Request) with T-UE\'s User Info, T-UE\'s IP
address, and the token (if received on the Query) to S-UE, requesting
authorization to share S-UE\'s IP address with T-UE.
4\. S-UE receives the Link Authorization Request message and replies with a
Link Authorization Accept or Reject message, specifying T-UE\'s User Info.
S-UE may provide a token at this point for further Query messages to be
authorized directly at the UE-to-UE Relay using this token. S-UE\'s decision
may be based on policies, Application\'s layer authorization, etc.
5\. UE-to-UE Relay sends a response (e.g. DNS response) to T-UE with S-UE\'s
IP address (if token matches at the UE-to-UE Relay or if a Link Authorization
Accept message is received from S-UE) or doesn\'t reply to the Query message
(if no match with token or if a Link Authorization Reject message is received
from S-UE). UE-to-UE Relay keeps track of the token, if provided by S-UE, and
may send it to the T-UE with the response. T-UE may use this token the next
time it needs to send a Query message to discover S-UE\'s IP address.
Editor\'s note: The authorization for IP address sharing procedure needs to be
coordinated with SA WG3.
### 6.31.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
UE:
\- Needs to support Discoveree UE behaviour authorizing a UE-to-UE Relay to
share its IP address/prefix.
\- Needs to support Discoverer UE behaviour providing an authorization token
associated to a peer User Info.
UE-to-UE Relay:
\- Needs to support requesting the authorization for IP address/prefix sharing
with the Discoveree UE.
## 6.32 Solution #32: Link Identifier Update procedure when using UE-to-UE
Relay
### 6.32.1 Description
A Link Identifier Update (LIU) procedure is defined in clause 6.4.3.2 of TS
23.304 [3]. This procedure is re-using the procedure defined in clause 6.3.3.2
of TS 23.287 [27].
This Link Identifier Update procedure is re-used when the communication is
done via a UE-to-UE Relay. The procedure is adapted with some changes,
depending on if the UE-to-UE Relay is Layer-2 based or Layer-3 based.
For the support of Layer-2 UE-to-UE Relay, RAN2 has defined that a single per-
hop link is established between a UE and a UE-to-UE Relay and that an
adaptation layer is used over the per-hop link to enable the forwarding of
packets between end-to-end peer UEs. The adaptation layer header contains
information identifying the end-to-end source UE and/or destination UE.
The solution for Layer-2 Link Identifier Update procedure, coordination with
RAN2 WG is needed for solution alignment and update based on RAN2 conclusion.
### 6.32.2 Layer-2 UE-to-UE Relay
#### 6.32.2.1 Description
For Layer-2 based UE-to-UE Relay, the link establishment procedure is
specified in TR 23.700-33 Solution #13. A unique PC5 unicast link (also called
per-hop or management link) is established between a UE and the UE-to-UE
Relay. An end-to-end (E2E) PC5 unicast link is established with an E2E peer UE
via the 2 per-hop links, i.e. between source UE and the Relay and between the
Relay and target UE. The E2E PC5 packets are using an adaptation header
containing information identifying the source UE and/or destination UE,
enabling the forwarding of packets E2E between peer UEs. PC5 packets also
carry E2E security information, as for regular non-relayed PC5 communication,
in the headers (e.g. PDCP header).
SA WG3 studied identity privacy for PC5 unicast link during V2X R16. The
requirements stated that the 5GS should provide means for mitigating
trackability and link ability attacks on a UE during PC5 unicast
communications. As concluded by SA3 during this study, \"all identifiers sent
in cleartext in the message headers must be changed at the same time, i.e.
during the same procedure run and from both UEs, to avoid trackability and
linkability issues\".
Thus, considering the new adaptation layer and that all identifiers sent as
cleartext must be updated at the same time, the Link Identifier Update
procedure, designed in the context of direct communication only, is updated to
support the periodic change of the source/destination UEs identity information
carried into the adaptation header, at the same time as the per-hop
identifiers (i.e. L2 IDs) and the end-to-end security information. In other
words, all identifiers carried together, in cleartext, and that may be
associated must be changed at the same time.
Furthermore, the usage of multiple end-to-end unicast links via a single per-
hop link means that source/destination UEs identity information carried in the
adaptation header, of all end-to-end unicast links, may be associated (i.e.
linked) to the same per-hop identifiers since they are sent in the clear when
end-to-end peer UEs exchange messages via the UE-to-UE Relay. This implies
that the source UE and all its peer UEs over the same per-hop link/Relay would
need to change their identifiers (i.e. per-hop identifiers, end-to-end
identifiers in adaptation layer and security information identifiers related
to per-hop and to end-to-end communication) at the same time. This obviously
could lead to a signalling storm of PC5-S message exchanges.
To overcome this problem, this solution isolates the identifiers on a per-hop
basis, i.e. makes all identifiers sent in cleartext (i.e. in the headers),
specific to the per-hop link. This is handled at the UE-to-UE Relay by
replacing the received source UE identifiers with corresponding relay-specific
identifiers before forwarding a message to a peer UE via another per-hop link.
The reverse action is done when the peer UE sends a message to the source UE,
i.e. the UE-to-UE Relay replaces the relay-specific identifiers with source UE
identifiers before forwarding the message to the source UE.
A UE does not know its peer UE\'s identifiers thus, when identifiers need to
be changed on the UE, only the identifiers used between this UE and the UE-to-
UE Relay need to be updated and only this UE and the UE-to-UE Relay are
involved in the Link Identifier Update procedure.
In addition to the per-hop identifiers and E2E identifiers carried in
adaptation header, the Application layer ID and the IP address/prefix may as
well be changed periodically. The Application layer ID and the IP
address/prefix, however, cannot be replaced by the UE-to-UE Relay with relay-
specific identifiers to be isolated on the per-hop link since they are not
exchanged in the message header (thus not visible at the UE-to-UE Relay). To
overcome this problem, the Link Modification procedure is executed between the
source UE and the E2E peer UE during (i.e. before completion of) the LIU
procedure, in the case where the LIU procedure is triggered due to the change
of Application layer ID and/or IP address/prefix.
#### 6.32.2.2 Procedures
Figure 6.32.2.2-1 shows an enhanced LIU procedure when a Layer-2 UE-to-UE
Relay is used. The LIU procedure, as defined in TS 23.304 [3], is modified to
allow the update of all identifiers sent in cleartext on the per-hop and
adaptation layer headers. UE1 uses the per-hop link, as a management link, to
exchange PC5 messages with the UE-to-UE Relay. In this case, the PC5 messages
are consumed by the UE-to-UE Relay and are not forwarded to the E2E peer UE.
In this case, we refer to the PC5 link as the management link. The management
link is used to exchange new E2E identifiers between a UE and the UE-to-UE
Relay as part of the enhanced LIU procedure.
Figure 6.32.2.2-1: Link Identifier Update procedure with Layer-2 UE-to-UE
Relay
0\. UE1 and UE2 establish and end-to-end PC5 unicast link via the UE-to-UE
Relay. Security is established E2E between UE1 and UE2. Both UEs have a PC5
unicast link (also called per-hop link or management link) established with
the UE-to-UE Relay. The PC5 unicast link established with the UE-to-UE Relay
is used for the transport of E2E messages, and also for the management of
these E2E links when the UE-to-UE Relay needs to be involved, as defined in
this TR Solution #13: Layer-2 UE-to-UE Relay.
1\. UE1 receives a trigger to change its identifiers e.g. privacy timer
expiry, Application layer ID change or IP address/prefix change. UE1 sends an
LIU Request message to the UE-to-UE Relay via the management link. The LIU
Request message includes a new L2 ID and new security information for the
management link, as well as new E2E security info and a new E2E identifier for
the E2E link with UE2 and used in the adaptation layer.
2\. The UE-to-UE Relay receives the message, updates its mapping table with
the new identifiers from UE1 while keeping the current values. The UE-to-UE
Relay generates a new L2 ID and security information for the management link,
and a new relay-specific E2E identifier and new relay-specific E2E security
information associated to UE2. The UE-to-UE Relay sends a LIU Response message
to UE1 which includes its new L2 ID and security information for the
management link, the new relay-specific E2E identifier, and new relay-specific
E2E security information.
NOTE: For UE-to-UE Relay solutions for which the UE-to-UE Relay doesn\'t
perform Adaptation layer replacement between E2E ID and Relay specific ID,
which information will be included in steps 1-2 and steps 3-4 will be
determined during normative phase.
3\. [optional] If UE1 has triggered the LIU procedure because a new
Application layer ID and/or a new IP address/prefix has been received from the
upper layer, UE1 sends a Link Modification Request to UE2 including its new
Application layer ID and new IP address/prefix. The Link Modification Request
message is modified to support a new operation code, e.g. \"change-of-ID\",
and the new Application layer ID and new IP address/prefix.
4\. [optional] UE2 sends a Link Modification Accept to acknowledge the new IDs
from UE1. The new IDs received on the Request message are sent back with the
Accept message. After step 4, UE2 may triggers LIU procedure with UE-to-UE
Relay to update its E2E identifier and L2 ID used between UE2 and UE-to-UE
Relay, as described at steps 1 and 2.
5\. UE1 completes the LIU procedure by sending a LIU Ack message to the Relay.
### 6.32.3 Layer-3 UE-to-UE Relay
#### 6.32.3.1 Description
The Layer-3 UE-to-UE Relay solutions, as specified in this TR, are based on IP
routing (except for non-IP traffic solution). As part of the PC5 unicast link
establishment procedure, the ProSe 5G UE-to-UE Relay allocates an IP
address/prefix to the UE or the UE registers its IP address/prefix with the
UE-to-UE Relay. The UE-to-UE Relay stores an association of the UE\'s
Application layer ID (also called User info) and IP address/prefix. The source
UE sends IP data to the target UE via the PC5 unicast link to UE-to-UE Relay.
The UE-to-UE Relay acts as an IP router and forwards the packets to the
corresponding PC5 unicast link towards the target UE.
The existing Link Identifier Update procedure as defined in TS 23.304 [3] may
be used between the UE and the Layer-3 UE-to-UE Relay. In the case where the
IP address/prefix needs to be changed, the existing Link Identifier Update
procedure is re-used with some modifications. The source UE triggers the Link
Identifier Update procedure over the PC5 link established with the UE-to-UE
Relay and if the UE-to-UE Relay is the one allocating the IP address/prefix
for the source UE, the source UE requests a new IP address/prefix to the UE-
to-UE Relay during the Link Identifier Update procedure. If the UE allocates
its own IP address/prefix, then it is provided to the UE-to-UE Relay. Since
the peer UE is communicating with the source UE using the source UE\'s IP
address, the peer UE needs to be informed of the source UE\'s new IP address.
The source UE thus also provides to the UE-to-UE Relay its peer UE\'s
Application layer ID and IP address, allowing the UE-to-UE Relay to send the
source UE\'s new IP address to its peer UE. The peer UE is informed during the
LIU procedure thus the new IP address/prefix may be used as soon as the LIU
procedure completes.
#### 6.32.3.2 Procedures
Figure 6.32.3.2-1 shows the Link Identifier Update procedure when a Layer-3
UE-to-UE Relay is used. The LIU procedure, as defined in TS 23.304 [3], is
modified to request the UE-to-UE Relay to allocate a new IP address/prefix to
the source UE and to send this new IP address/prefix to the peer UE.
Figure 6.32.3.2-1: Link Identifier Update procedure and IP address change with
Layer-3 UE-to-UE Relay
0\. A PC5 link is established between UE1 and a UE-to-UE Relay. Another PC5
link is established between the UE-to-UE Relay and UE2. IP data may be
exchanged between UE1 and UE2 via the UE-to-UE Relay over the PC5 links.
During the link establishment, UE1 informs the UE-to-UE Relay that the link
requires privacy.
1\. UE1 receives a trigger e.g. privacy timer expiry or new Application layer
ID or new IP address/prefix to be changed. UE1 triggers the Link Identifier
Update procedure, i.e. it auto-generates a new Layer-2 ID and new security
information, and it sends a Link Identifier Update Request message to the UE-
to-UE Relay including: its new Layer-2 ID, new security information, new
Application layer ID (if provided by the upper layer) and a \"new IP address
needed\" indication (if IP communication is used).
a. If UE1\'s IP address/prefix needs to be changed, UE1 also provides its peer
UE information (UE2\'s IP address, UE2\'s Application layer ID), allowing the
UE-to-UE Relay to inform the peer UE (i.e. UE2) about UE1\'s new allocated IP
address/prefix.
b. If UE1 self-assigns its IP address/prefix and has updated it then UE1
specifies its new IP address and does not specify \"new IP address needed\"
indication. In this case, the UE-to-UE Relay keeps track of this new IP
address associated to UE1.
2\. UE-to-UE Relay self-assigns a new L2 ID, new security information and
possibly new IP address/prefix for PC5 link with UE1.
a. UE-to-UE Relay assigns a new IP address/prefix to UE1 and saves it locally
if a \"new IP address needed\" indication is received.
b. If a \"new IP address needed\" indication is received, UE-to-UE Relay
fetches UE2\'s entry from its local table based on the received Application
layer ID or IP address/prefix. UE-to-UE Relay then sends a PC5 Relay Update
Request message to UE2, including: UE1\'s old IP address/prefix, UE1\'s old
and new Application layer ID, UE1\'s new IP address/prefix.
3\. UE2 receives the PC5 Relay Update Request message and saves UE1\'s new IP
address/prefix. UE2 sends a PC5 Relay Update Response message to the UE-to-UE
Relay including all parameters received on the PC5 Relay Update Request
message.
a. UE2 should be able to receive IP data with UE1\'s old IP address (transit
packets sent prior to UE1\'s receiving its new IP address) until an IP packet
using UE1\'s new IP address is received. At this point, UE2 starts using
UE1\'s new IP address and may forget UE1\'s old IP address.
4\. UE-to-UE Relay sends a Link Identifier Update Response message to UE1
including UE1\'s new IP address/prefix, UE-to-UE Relay\'s new Layer-2 ID, new
security information and possibly new IP address/prefix and/or new Application
layer ID.
5\. UE1 saves its new IP address/prefix and UE-to-UE Relay\'s new parameters
and sends a Link Identifier Update ACK message to the UE-to-UE Relay,
including its new IP address received on the Response message. UE1 and UE-to-
UE Relay may then start using the new Layer-2 IDs for PC5 communication. UE1
starts using its new IP address for IP data exchange with UE2.
### 6.32.4 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
UE:
\- Needs to support procedures for communications via a ProSe 5G Layer-2 and
Layer-3 UE-to-UE Relay.
\- Needs to support procedures for management of extended communication, via
communication with a ProSe 5G Layer-2 UE-to-UE Relay.
\- Needs to support updating E2E peer UE with new Application Layer ID and/or
new IP address/prefix during LIU procedure when connected via 5G ProSe Layer-2
UE-to-UE Relay.
\- Needs to support requesting a new IP address/prefix from a 5G ProSe Layer-3
UE-to-UE Relay when IP address allocation is handled by the 5G ProSe Layer-3
UE-to-UE Relay.
UE-to-UE Relay:
\- Needs to support procedures for ProSe 5G Layer-2 and Layer-3 UE-to-UE
Relay.
\- Needs to support procedures for extended communication management link when
acting as a ProSe 5G Layer-2 UE-to-UE Relay.
\- Needs to support updating a peer UE with new allocated IP address/prefix of
source UE and new Application Layer ID when acting as a 5G ProSe Layer-3 UE-
to-UE Relay.
## 6.33 Solution #33: Layer-2 UE-to-UE Relay discovery and communication
### 6.33.1 Description
The solution applies to Key Issue #1 \"Support of UE-to-UE Relay\".
In this solution, the Layer-2 UE-to-UE Relay operation is supported with the
following principles:
\- Authorization and configuration:
\- Only the UE authorized by the service authorization configuration can act
as a UE-to-UE Relay. These UEs will be configured according to the service
authorization and provisioning solutions for Key Issue #6.
\- UE-to-UE Relay discovery:
\- Model A and Model B direct discovery as defined in clause 6.3.2 of TS
23.304 [3] are supported for UE-to-UE Relay discovery.
\- Relay Service Code (RSC) is used to indicate the connectivity service that
UE-to-UE Relay can support.
\- In order to serve as a UE-to-UE Relay, it is required to discover other UEs
in proximity in advance or on demand.
\- The Source and Destination Layer-2 IDs used for discovery message are
determined based on the principles as defined in clause 5.8 of TS 23.304 [3].
\- The Layer-2 ID of Target UE is obtained by the Source UE during discovery
procedure.
\- UE-to-UE Relay communication:
\- Source UE initiates the Layer-2 link establishment procedure as defined in
clause 6.4.3.1 of TS 23.304 [3] with Target UE via the UE-to-UE Relay, and the
QoS Info and IP address are negotiated during this procedure.
\- IP, Ethernet and Unstructured traffic type are supported.
\- Both UE-to-UE Relay allocated IP address and Link-Local IPv6 address are
supported.
\- QoS handling:
\- The PC5 QoS Flows are set up end-to-end between Source UE and Target UE.
The Control Plane and User Plane protocol stacks are defined in TR 38.836 [20]
as followings.
Figure 6.33.1-1: User plane protocol stack for Layer-2 UE-to-UE Relay
Figure 6.33.1-2: Control plane protocol stack for Layer-2 UE-to-UE Relay
### 6.33.2 Procedures
#### 6.33.2.1 Procedures for UE-to-UE Relay discovery
##### 6.33.2.1.1 Procedure for UE-to-UE Relay discovery with Model A
Depicted in figure 6.33.2.1.1-1 is the procedure for UE-to-UE Relay discovery
with Model A.
Figure 6.33.2.1.1-1: UE-to-UE Relay discovery with Model A
1\. The UE-to-UE Relay has discovered other UEs in proximity via the previous
direct discovery or direct communication procedures. The UE-to-UE Relay
obtains the User Info ID, Relay Service Code (RSC) and Layer-2 ID of other UEs
in proximity.
2\. The UE-to-UE Relay sends an Announcement message. The Announcement message
may include the Type of Discovery Message, User Info ID of the UE-to-UE Relay,
RSC, and a list of User Info ID and Layer-2 ID of the Target UEs (UEs
discovered in step 1).
The Source Layer-2 ID of the Announcement message is self-assigned by the UE-
to-UE Relay, and the Destination Layer-2 ID is selected based on the ProSe
policy.
##### 6.33.2.1.2 Procedure for UE-to-UE Relay discovery with Model B
Depicted in figure 6.33.2.1.2-1 is the procedure for UE-to-UE Relay discovery
with Model B.
Figure 6.33.2.1.2-1: UE-to-UE Relay discovery with Model B
1\. The UE-to-UE Relay may have discovered other UEs in proximity via the
previous direct discovery or direct communication procedures. The UE-to-UE
Relay obtains the User Info ID, Relay Service Code (RSC) and Layer-2 ID of
other UEs in proximity.
2\. The Source UE sends a Solicitation message. The Solicitation message may
include the Type of Discovery Message, User Info ID of Source UE, RSC, and
User Info ID of Target UE.
The Source Layer-2 ID of the Announcement message is self-assigned by the
Source UE, and the Destination Layer-2 ID is selected based on the ProSe
policy.
3\. The UE-to-UE Relay may perform direct discovery procedure to discover the
Target UE if it has not been discovered in step 1.
4\. The UE-to-UE Relay that match the values of the User Info ID of Target UE
and RSC contained in the Solicitation message respond to the Source UE with a
Response message. The Response message contains the Type of Discovery Message,
User Info ID of UE-to-UE Relay, RSC, and User Info ID and Layer-2 ID of Target
UE.
The Source Layer-2 ID of the Response message is self-assigned by the UE-to-UE
Relay, and the Destination Layer-2 ID is set to the Source Layer-2 ID of the
received Solicitation message.
#### 6.33.2.2 Procedures for UE-to-UE Relay communication
Depicted in figure 6.33.2.2-1 is the procedure for Layer-2 UE-to-UE Relay
communication.
Figure 6.33.2.2-1: Procedure for Layer-2 UE-to-UE Relay communication
1\. Service authorization and provisioning are performed for Source UE, Target
UE and UE-to-UE Relay as described for solutions for Key Issue #6.
2\. The Source UE performs discovery of a UE-to-UE Relay as described in
clause 6.33.2.1.
3\. The Source UE initiates the PC5 connection establishment with UE-to-UE
Relay, which triggers UE-to-UE Relay to establish PC5 connection with Target
UE. Solution #12 described in the clause 6.12 can be used to establish the PC5
links.
4\. The Source UE sends a Direct Communication Request message to initiate the
unicast Layer-2 link establishment procedure with the Target UE. The Direct
Communication Request message includes User Info ID of Source UE, User Info ID
of Target UE and Relay Service Code (RSC) and is sent over the PC5 link
established with the UE-to-UE Relay.
The Source Layer-2 ID of the DCR message is self-assigned by the Source UE.
The UE-to-UE Relay forwards the PC5-S message towards the Target UE.
Editor\'s note: It is FFS how the UE-to-UE Relay handles forwarding, and the
adaptation layer is to be defined by RAN.
Editor\'s note: It is FFS how the Destination Layer-2 ID is set.
5\. If the User Info ID of Target UE, User Info ID of Source UE and RSC are
included in the Direct Communication Request, the Target UE responds by
establishing the security with Source UE. When the security protection is
enabled, the Source UE sends IP Address Configuration or Link-Local IPv6
address (if IP communication is used), QoS Info (PFI and PC5 QoS parameters).
The Target UE sends PC5 messages over the PC5 link established with the UE-to-
UE Relay. The Source Layer-2 ID used for the security establishment procedure
is self-assigned by the Target UE, and the Destination Layer-2 ID is set to
the Source Layer-2 ID of the received Direct Communication Request message.
Upon receiving the security establishment procedure messages, the Source UE
obtains the Target UE\'s Layer-2 ID for future communication, for signalling
and data traffic for this unicast link.
6\. The Target UE sends a Direct Communication Accept message to the Source UE
that has successfully established security with Target UE. The Direct
Communication Accept message includes User Info ID of Source UE, User Info ID
of Target UE, QoS Info (PFI and PC5 QoS parameters), RSC, IP Address
Configuration or Link-Local IPv6 address (if IP communication is used). The
end-to-end QoS flow is established between Source UE and Target UE.
Editor\'s note: Whether and how the PC5-S messages in step 4, 5 and 6 are
forwarded by the UE-to-UE Relay based on Adaptation layer is to be determined
by RAN WG2.
Editor\'s note: Which UE and how to perform QoS enforcement for the two PC5
reference points (between Source UE and UE-to-UE Relay, as well as between UE-
to-UE Relay and Target UE) is to be determined by RAN WG2.
7\. The data is transferred between the Source UE and the Target UE via the
UE-to-UE Relay.
### 6.33.3 Impacts on services, entities and interfaces
UE:
\- New functionality related to UE-to-UE Relay discovery, as well as
communication via UE-to-UE Relay.
## 6.34 Solution #34: ProSe UE-to-UE relay support
### 6.34.1 General Description
This solution address KI#1. This solution focuses on a unified route selection
procedure for both Layer-2 and Layer-3 UE-to-UE relay operation, so that the
UE can determine which 5G ProSe UE-to-UE Relay can provide connection to a
target UE.
In this solution, the ProSe 5G UE-to-UE Relay operation is supported with the
following principles. Some of the aspects that are specific to Layer-2
operation are indicated explicitly:
\- Authorization and configuration:
\- Only the UEs authorized by the service authorization configuration can act
as a 5G ProSe UE-to-UE Relay or a 5G ProSe U2U UE. These UEs will be
configured according to the service authorization and provisioning mechanism
defined in solutions for KI#6 to operate in the UE-to-UE Relay mode.
\- 5G ProSe UE-to-UE Relay discovery:
\- Reuse the Model A and Model B UE-to-Network relay discovery procedures
defined in clause 6.3.2.3 of TS 23.304 [3] for discovering the 5G ProSe UE-to-
UE Relay by the 5G ProSe U2U UEs. A RSC may be associated with multiple ProSe
services. Relay discovery is supported independent of the 5G ProSe U2U UEs
communicating with each other via the 5G ProSe UE-to-UE Relay.
NOTE 1: The Layer-2 ID used for the discovery can be specific for UE-to-UE
Relay discovery.
\- 5G ProSe UE-to-UE Route discovery:
\- When 5G ProSe UEs cannot discover each other directly using the ProSe
direct discovery procedures described in TS 23.304 [3], ProSe direct discovery
messages are relayed via the 5G ProSe UE-to-UE Relay to discover each other.
During this end-to-end discovery relaying procedure, the 5G ProSe U2U UEs also
discover the route, i.e. 5G ProSe UE-to-UE Relay UEs, that can reach another
5G ProSe U2U UE.
\- 5G ProSe UE-to-UE Relay discovery messages (both Model A and Model B) are
reused to include the end-toend direct discovery message information to assist
with 5G ProSe U2U UE route discovery. The End-to-End (E2E) direct discovery
message information contains the User Info ID/ProSe discovery codes
corresponding to the ProSe service supported by the 5G ProSe U2U UE, and it
may be different from the User Info ID used in Relay discovery message.
\- 5G ProSe UE-to-UE Route selection:
\- When multiple routes, i.e. multiple 5G ProSe UE-to-UE Relay UEs are
discovered during the Route discovery, the source 5G ProSe U2U UE selects a
best route before U2U relay connection setup based on Radio link quality
criteria and Upper layer criteria like E2E discovery message (i.e. ProSe
service matching) information.
NOTE 2: Radio link quality criteria for 5G ProSe UE-to-UE Route selection are
in the scope of RAN WG2.
\- 5G ProSe UE-to-UE Relay operation:
\- Per-hop unicast links are established between the 5G ProSe U2U UEs and the
selected 5G ProSe UE-to-UE Relay before U2U relay communication is supported.
A unicast link that is already setup between the 5G ProSe U2U UE and 5G ProSe
UE-to-UE Relay can be shared for relaying traffic to different 5G ProSe U2U
UEs.
\- When a source 5G ProSe U2U UE needs to communicate with target 5G ProSe U2U
UE via the Layer-3 5G ProSe UE-to-UE Relay, it sends a DNS query to obtain the
IP address and IP/non-IP relaying is supported via the per-hop unicast links
as described in sol#2.
\- In the case of Layer-2 5G ProSe UE-to-UE relay operation, an end-to-end
unicast link is setup between the source 5G ProSe U2U UE and the target 5G
ProSe U2U UE before relaying IP/non-IP data. When a per-hop unicast link is
shared between different end-to-end unicast links, there is additional routing
functionality that will be defined by RAN WG2 for Layer-2 relaying.
\- QoS handling:
\- For Layer-3 5G ProSe UE-to-UE relay connection, 5G ProSe UE-to-UE Relay
configures the per-hop PC5 QoS flows to meet the E2E QoS, as described in
sol#2.
\- For Layer-2 5G ProSe UE-to-UE relay connection, the source 5G ProSe U2U UE
and the target 5G ProSe U2U UE establish and modify the PC5 QoS Flows using
the procedures in TS 23.304 [3]. The E2E QoS flows are not known to the
Layer-2 ProSe UE-to-UE relay. Hence, to support the E2E QoS, how the QoS
parameters for the per-hop PC5 link RLC channels are configured by the Layer-2
ProSe 5G UE-to-UE Relay will be defined by RAN WG2.
\- Security handling:
\- Source 5G ProSe U2U UE and target 5G ProSe U2U UE can establish bearer
level security with the ProSe 5G UE-to-UE Relay for the unicast L2 Link, using
procedures defined in TS 23.304 [3].
\- If end-to-end security protection is required between source 5G ProSe U2U
UE and target 5G ProSe U2U UE connected via Layer-3 ProSe 5G UE-to-UE Relay
then IPSec can be used.
\- End-to-end security protection between source 5G ProSe U2U UE and target 5G
ProSe U2U UE connected via Layer-2 5G ProSe UE-to-UE Relay is be supported via
bearer level security for the E2E unicast link.
NOTE 3: The security protection of the traffic of source 5G ProSe U2U UE and
target 5G ProSe U2U UE will be specified by SA WG3.
### 6.34.2 Procedures
#### 6.34.2.1 Route discovery
##### 6.34.2.1.1 Model A route discovery
Route discovery procedures described are common for both Layer-3 and Layer-2
5G ProSe UE-to-UE relay operation.
Figure 6.34.2.1.1-1 shows the procedure for Model A route discovery to
discover the route, i.e. 5G ProSe UE-to-UE Relay -UEs, that can reach other 5G
ProSe U2U UEs supporting ProSe service.
Figure 6.34.2.1.1-1: Model A route discovery
1\. An Announcing UE, which is the target 5G ProSe U2U UE for communication,
sends Announcement message to a requesting the relaying of the ProSe direct
discovery information to other 5G ProSe U2U UEs.
The Announcing UE includes the Type of Discovery Message, Announcer Info, RSC
and E2E discovery information in the Announcement message. RSC is included to
indicate which 5G ProSe UE-to-UE Relay(s) can relay the discovery message. The
announcement message is sent using the Source Layer-2 ID self-assigned by the
Announcing UE and Destination Layer-2 ID corresponding to the RSC configured
as per the policy.
E2E discovery information can contain the E2E ProSe direct discovery message
with contents including the User Info ID, Discovery Codes, Application layer
Group ID.
2\. Upon receiving an announcement message including RSC from a 5G ProSe U2U
UE, a 5G ProSe UE-to-UE Relay forwards the E2E discovery information to other
5G ProSe U2U UEs.
The 5G ProSe UE-to-UE Relay sends an Announcement message containing the Type
of Discovery Message, Announcer Info (i.e. Relay User Info ID), RSC, Relay
indication (to indicate ProSe direct discovery forwarding), original Announcer
Info (i.e. target 5G ProSe U2U UE User Info ID) and E2E discovery information.
The announcement message is sent using the Source Layer-2 ID self-assigned by
the 5G ProSe UE-to-UE Relay and Destination Layer-2 ID corresponding to the
RSC configured as per the policy.
NOTE: The security protection of the E2E discovery and Relay discovery will be
defined by SA WG3.
3\. The Monitoring UE, which is looking for other 5G ProSe U2U UEs, i.e.
source 5G ProSe U2U UE for communication, receives the Announcement message
from a 5G ProSe UE-to-UE Relay(s). The presence of the Relay indication in the
Announcement message indicates that the announcement message contains the E2E
discovery information that is relayed by the 5G ProSe UE-to-UE Relay.
The Monitoring UE checks the E2E discovery information for the desired ProSe
service support by the 5G ProSe U2U UE and selects one of the 5G ProSe UE-to-
UE Relay(s), when the announcement message is received from multiple 5G ProSe
UE-to-UE Relay(s). Monitoring UE uses the original Announcer Info (i.e. target
5G ProSe U2U UE User Info ID) while communicating with the 5G ProSe UE-to-UE
Relay to setup per-hop links. The E2E discovery information is only used
between the 5G ProSe U2U UEs.
##### 6.34.2.1.2 Model B route discovery
Figure 6.34.2.1.2-1 shows the procedure for Model B route discovery to
discover the route, i.e. 5G ProSe UE-to-UE Relay -UEs that can reach other 5G
ProSe U2U UEs supporting ProSe service.
The Route discovery procedures described are common for both Layer-3 and
Layer-2 ProSe 5G UE-to-UE relay operation.
Figure 6.34.2.1.2-1: Model B route discovery
1\. The Discoverer UE, which is the source 5G ProSe U2U UE for communication,
sends solicitation message to a ProSe 5G UE-to-UE Relay requesting it to relay
the ProSe direct discovery information to other 5G ProSe U2U UEs. The
Discoverer UE includes the Type of Discovery Message, Discoverer Info, RSC and
E2E discovery information in the solicitation message. RSC is included to
indicate which ProSe 5G UE-to-UE Relay(s) can relay the discovery message. The
solicitation message is sent using the Source Layer-2 ID self-assigned by the
Announcing UE and Destination Layer-2 ID corresponding to the RSC configured
as per the policy.
E2E discovery information can contain the E2E ProSe direct discovery message
with contents including the User Info ID, Discovery Codes, Application layer
Group ID.
2\. On receiving the solicitation message including RSC from a 5G ProSe U2U
UE, a ProSe 5G UE-to-UE Relay forwards the E2E discovery information to other
5G ProSe U2U UEs. The ProSe 5G UE-to-UE Relay sends solicitation message
containing the Type of Discovery Message, Discoverer Info (i.e. Relay User
Info ID), RSC, Relay indication (to indicate ProSe direct discovery
forwarding), original Discoverer Info (i.e. source 5G ProSe U2U UE User Info
ID) and E2E discovery information. The solicitation message is sent using the
Source Layer-2 ID self-assigned by the ProSe 5G UE-to-UE Relay and Destination
Layer-2 ID corresponding to the RSC configured as per the policy.
NOTE: The security protection of the E2E discovery and Relay discovery will be
defined by SA WG3.
3\. A Discoveree UE(s), that matches the E2E discovery information (i.e.
target 5G ProSe U2U UE for communication) responds to the solicitation message
via a response message. The responding Discoveree UE includes the Type of
Discovery Message, Discoveree Info, RSC, original Discoverer Info (i.e. source
5G ProSe U2U UE User Info ID) and E2E discovery response information in the
response message. The original Discoverer Info (i.e. source 5G ProSe U2U UE
User Info ID) indicates to the ProSe 5G UE-to-UE Relay(s) the source 5G ProSe
U2U UE to which the response message is to be forwarded to. The response
message is sent using the Source Layer-2 ID self-assigned by the Discoveree UE
and Destination Layer-2 ID is set to the Source Layer-2 ID of the received
solicitation message received from the ProSe 5G UE-to-UE Relay.
4\. On receiving the response message including RSC from a 5G ProSe U2U UE, a
ProSe 5G UE-to-UE Relay forwards the E2E discovery information to other 5G
ProSe U2U UEs. The ProSe 5G UE-to-UE Relay sends response message containing
the Type of Discovery Message, Discoveree Info (i.e. Relay User Info ID), RSC,
Relay indication (to indicate ProSe direct discovery forwarding), original
Discoveree Info (i.e. target 5G ProSe U2U UE User Info ID) and E2E discovery
information. The response message is sent using the Source Layer-2 ID self-
assigned by the ProSe 5G UE-to-UE Relay and Destination Layer-2 ID
corresponding to the source 5G ProSe U2U UE User Info ID received in step 1.
5\. The Discoverer UE, which is looking for other 5G ProSe U2U UEs, i.e. a
target 5G ProSe U2U UE for communication, receives the response message from
ProSe 5G UE-to-UE Relay(s). The Discoverer UE selects one of the ProSe 5G UE-
to-UE Relay(s), when response messages are received from multiple ProSe 5G UE-
to-UE Relay. The Discoverer UE uses the original Discoveree Info (i.e. target
5G ProSe U2U UE User Info ID) while communicating with the selected ProSe 5G
UE-to-UE Relay to setup per-hop links. The E2E discovery information is only
used by the 5G ProSe U2U UEs and not by the 5G ProSe UE-to-UE Relay.
#### 6.34.2.2 5G ProSe UE-to-UE Relay Connection setup
Figure 6.34.2.2-1 shows the 5G ProSe UE-to-UE relay connection setup procedure
for both Layer-3 and Layer-2 UE-to-UE relay communication.
Figure 6.34.2.2-1: 5G Prose UE-to-UE relay connection setup
1\. 5G ProSe U2U UE interested in communicating with another 5G ProSe U2U UE
may optionally perform UE-to-UE Relay discovery procedures to determine if
there is at least one ProSe 5G UE-to-UE Relay supporting an RSC of interest in
proximity before performing the remaining steps.
2\. Source 5G ProSe U2U UE and target 5G ProSe U2U UE may participate in the
Route discovery procedures as described in clause 6.34.2.1 to determine the 5G
ProSe UE-to-UE Relay that can support connection between the UEs.
3\. Per-hop unicast link is setup between the 5G ProSe U2U UEs and a 5G ProSe
UE-to-UE Relay. Target User Info ID for the Target 5G ProSe U2U UE obtained
from route discovery procedure as in clause 6.34.2.1 is used in this step.
3a. Source 5G ProSe U2U UE performs either unicast link setup when there is no
link with the 5G ProSe UE-to-UE Relay, or unicast link setup modification
procedure when an existing link with the 5G ProSe UE-to-UE Relay can be
modified to support relay communication, as defined in clause 6.4.3 of TS
23.304 [3].
The Source 5G ProSe U2U UE indicates the target 5G ProSe U2U UE User Info ID
corresponding to the RSC discovered during the Model A or Model B route
discovery procedure.
The Source Layer-2 ID used for the unicast link setup/modification messages is
self-assigned by the Source 5G ProSe U2U UE and the destination Layer-2 ID is
the Layer-2 ID corresponding to the 5G ProSe UE-to-UE Relay, e.g. obtained
during route discovery procedure, or a broadcast Layer-2 ID.
3b. 5G ProSe UE-to-UE Relay performs either unicast link setup when there is
no link with the target 5G ProSe U2U UE, or unicast link setup modification
procedure when an existing link with the target 5G ProSe U2U UE can be
modified to support relay communication, as defined in clause 6.4.3 of TS
23.304 [3].
The source Layer-2 ID used for the unicast link setup/modification messages is
self-assigned by the 5G ProSe UE-to-UE Relay and the destination Layer-2 ID is
the Layer-2 ID corresponding to the target 5G ProSe U2U UE User Info ID
received in step 3a.
NOTE 1: If the 5G ProSe UE-to-UE Relay does not have available target 5G ProSe
U2U UE User Info ID, the 5G ProSe UE-to-UE Relay may either return a failure
to source UE, or trigger a route discovery procedure based on implementation.
If Layer-3 relay operation will be used then:
the 5G ProSe UE-to-UE Relay may allocate an IP address/prefix to the
source/target 5G ProSe U2U UEs on each per-hop link, and
the Source 5G ProSe U2U UE indicates the E2E QoS required for UE-to-UE relay
traffic in the ProSe Direct Link Security Mode Complete or ProSe Direct Link
Modification Request message sent to the ProSe 5G UE-to-UE Relay.
4\. 5G ProSe UE-to-UE Relay decides the per-hop QoS parameters to satisfy the
E2E QoS indicated by source 5G ProSe U2U UE. The UE-to-UE Relay can decide
this based on local configuration, e.g. split the QoS requirements equally
among the two hops.
4a. 5G ProSe UE-to-UE Relay send the per-hop QoS parameters and QoS flow
information to the source 5G ProSe U2U UE either during unicast link or via
unicast link modification procedure. This step may be carried out together
with step 3a.
4b. 5G ProSe UE-to-UE Relay send the per-hop QoS parameters and QoS flow
information to the target 5G ProSe U2U UE either during unicast link or via
unicast link modification procedure. This step may be carried out together
with step 3b.
5\. Layer-3 source 5G ProSe U2U UE sends a DNS query for the target UE (based
on target 5G ProSe U2U UE User Info ID) to the ProSe 5G UE-to-UE Relay over
the unicast link, which will return the IP address/prefix of the target 5G
ProSe U2U UE.
6\. Layer-3 source 5G ProSe U2U UE sends the IP/non-IP to the 5G ProSe UE-to-
UE Relay for forwarding it to the target 5G ProSe U2U UE as discussed in
sol#2.
7\. Layer-2 source 5G ProSe U2U UE performs an end-to-end unicast link setup
with the target 5G ProSe U2U UE by sending the E2E Direct Communication
Request PC5-S messages via the Layer-2 ProSe 5G UE-to-UE Relay. The Direct
Communication Request message includes User Info ID of Source UE, User Info ID
of Target UE, QoS Info (PFI and PC5 QoS parameters) and RSC.
When the target UE receives the Direct Communication Request, it triggers the
security procedure with source UE via the Layer-2 ProSe 5G UE-to-UE Relay.
The target UE sends a Direct Communication Accept message to the source UE via
the Layer-2 ProSe 5G UE-to-UE Relay. The Direct Communication Accept message
includes User Info ID of Source UE, User Info ID of Target UE, QoS Info (PFI
and PC5 QoS parameters) and RSC.
RAN WG2 will define how the E2E PC5-S messages are relayed between the 5G
ProSe U2U UE by the Layer-2 5G ProSe UE-to-UE Relay. Source 5G ProSe U2U UE
and target 5G ProSe U2U UE negotiate the E2E QoS using the PC5-S messages.
8\. Layer-2 5G ProSe UE-to-UE Relay uses the E2E QoS information to decide the
split of QoS parameters and the configuration of RLC CHs for both per-hop
links to satisfy the E2E QoS.
NOTE 2: RAN WGs will define how the E2E QoS and split of QoS parameters are
handled.
9\. Layer-2 data relaying via the UE-to-UE Relay.
NOTE 3: RAN WGs will define how the E2E user data is relayed via the Layer-2
5G ProSe UE-to-UE Relay.
### 6.34.3 Impacts on Existing Nodes and Functionality
The solution has impacts in the following entities:
\- ProSe 5G UE-to-UE Relay, 5G ProSe U2U UE -- support Relay discovery, Route
discovery and selection, ProSe 5G UE-to-UE Relay connection setup procedures.
## 6.35 Solution #35: Solution for path switching between two indirect network
communication paths
### 6.35.1 Description
As described in TS 23.304 [3], Remote UE connects to the network via Layer-3
UE-to-Network Relay or Layer-3 UE-to-Network Relay with N3IWF access or
Layer-2 UE-to-Network relay and can switch between any of these indirect
network communication paths.
Since the Prose application server knows its capability, e.g. capability to
support service continuity at application level, and its service requirement,
and other factors, e.g. business consideration, the ProSe application server
can decide the path re-selection rules for Remote UE based on above factors.
For example, if the service requirement needs service continuity, but the
application does not support service continuity, the ProSe application server
may prioritize Layer-2 UE-to-Network relay or Layer-3 UE-to-Network Relay with
N3IWF to ensure session continuity. If the service requirement does not need
continuity, the ProSe application server can decide the path re-selection
rules based on the business consideration, e.g. Layer-3 UE-to-Network Relay
without N3IWF may be preferred for its simplicity and low-cost.
This solution proposes the Prose application server to decide the path re-
selection rules for path switching among different indirect network
communication paths. The path re-selection rules include the prioritizations
of target relay mode. The target relay mode has three modes: Layer-3 UE-to-
Network Relay, Layer-3 UE-to-Network Relay with N3IWF access and Layer-2 UE-
to-Network relay. The configuration parameters for a 5G ProSe remote UE may
consist one or more relay service code(s) for the UE-to-network relay
discovery which is an indication of whether the relay service code is offering
5G ProSe layer-2 or layer-3 UE-to-network relay service. There exists the
situation the target relay UE with the relay mode which has the highest
priority in the path re-selection rules may not be available, e.g. no response
received, when the remote UE starts the reselection of relay UE. To quickly
find the target relay UE and minimize the service interruption between the
path switching, the Remote UE should send multiple 5G ProSe UE-to-Network
Relay Discovery Solicitation messages simultaneously each of which contains
different relay service code supported in the path re-selection rules, and set
a timer to wait and receive the response messages from the available target
relay UEs. Similarly, in model A the remote UE may set a timer to receive
multiple discovery messages of the available relay UEs. Then remote UE can
decide to select the target relay UE which has the highest priority of relay
mode among the received available target relay UEs.
### 6.35.2 Procedures
Figure 6.35.2-1
0\. Remote UE has connected to the network via one of the following modes:
Layer-3 UE-to-Network Relay, Layer-3 UE-to-Network Relay with N3IWF and
Layer-2 UE-to-Network relay. And the Remote UE may support one or more of the
above relay modes.
1\. Remote UE is triggered to perform relay re-selection based on e.g. the
signal strength of PC5 unicast link with the 5G ProSe UE-to-Network Relay is
lower than a threshold.
2\. Remote UE requests ProSe application server for relay re-selection, the
request includes but is not limited to the following content: current access
mode in step 0.
3\. Prose application server decides the path re-selection rules for remote UE
which include the prioritizations of target relay mode. The mechanism of the
decision is up to implementation of the Prose application server. It may
consider the current relay mode used by Remote UE and other factors exampled
in description in clause 6.35.1.
4\. The application server sends the path re-selection rules to remote UE.
5\. Remote UE performs ProSe Direct Discovery based on path Re-selection
rules.
5a. For 5G ProSe UE-to-Network Relay Discovery with Model A,
5a1. The target available relay UE(s) in proximity may send UE-to-Network
Relay Discovery Announcement messages as described in clause 6.3.2.3.2 of TS
23.304 [3]. A 5G ProSe UE-to-Network Relay UE supporting multiple RSCs can
advertise the RSCs using multiple discovery messages, with one RSC per
discovery message.
5a2. Remote UE receives the Announcement messages from the available target
UEs within the set timer, then the remote UE selects the target relay UE which
has the highest priority of relay mode among these available target UEs within
the set timer.
5b. For 5G ProSe UE-to-Network Relay Discovery with Model B,
5b1. The Remote UE should send multiple 5G ProSe UE-to-Network Relay Discovery
Solicitation messages simultaneously, each of which contains different
supported relay service code in the path re-selection rules. And the relay
service code indicates whether the relay service code is offering 5G ProSe
layer-2 or layer-3 UE-to-network relay service as described in clause 5.2.5 of
TS 24.554 [21].
5b2. The target relay UEs that match the values of the RSC contained in the
solicitation message respond to the Remote UE with a UE-to-Network Relay
Discovery Response message as described in clause 6.3.2.3.2 of TS 23.304 [3].
5b3. Remote UE receives the Response messages from the available target UEs
within the set timer, then the remote UE selects the target relay UE which has
the highest priority of relay mode among the available target relay UEs.
NOTE: If the remote UE does not have path Re-selection rules from ProSe
application server, and there are URSP rules and 5G Prose policy for path
selection as proposed in other solutions, the UE can also perform procedure 5
based on these available rules and policy.
6\. Relayed data transfer via the new UE-to-Network Relay following the
procedure after 5G ProSe UE-to-Network Relay Discovery in 5G ProSe UE-to-
Network Relay Communication procedure as described in clause 6.5 of TS 23.304
[3].
### 6.35.3 Impacts on Existing Nodes and Functionality
Prose application server:
\- Prose application server decides for remote UE.
Remote UE:
\- request path re-selection rules from the Prose application server
\- Remote UE performs ProSe Direct Discovery accordingly based on path Re-
selection rules.
## 6.36 Solution #36: Path switching between two indirect Layer-3 UE-to-
Network Relay paths using N3IWF
### 6.36.1 Description
The solution is based on re-use of an already established Remote UE
connectivity via Layer-3 UE-to-Network Relay using N3IWF.
When the Remote UE detects the reason to switch from one Layer-3 UE-to-Network
Relay to another, it initiates discovery and PC5 connection establishment
procedures as in the initial Layer-3 UE-to-Network relaying set up. When the
new Relay UE has allocated IPv4 address or IPv6 prefix, the Remote UE
### 6.36.2 Protocol stacks
The protocol stack structure specified for N3IWF access in Figure 6.1.2.3.1-2
of TS 23.304 [3] can be re-used without any modifications as shown below. The
path switching from one Relay UE to another Relay UE means the re-
configuration of the outer IP address of the Remote UE towards the same N3IWF.
Figure 6.36.2-1: Protocol stacks for switching between two Layer-3 UE-to-
Network Relays using N3IWF
### 6.36.3 Path switching procedure
Figure 6.36.3-1 shows the call flow for path switching between two indirect
Layer-3 UE-to-Network Relays and using the same N3IWF before and after the
switch so that no N3IWF discovery is needed.
This procedure allows the Remote UE to switch from the old Layer-3 UE-to-
Network Relay to the new Layer-3 UE-to-Network Relay. The NG-RAN, the AMF, the
SMF, and the UPF are the ones serving the new Layer-3 UE-to-Network Relay.
They can be the same or different from those serving the old Layer-3 UE-to-
Network Relay. The N3IWF remain the same during the switch as N3IWF discovery
is omitted during the path switch procedure.
Figure 6.36.3-1: Path switching between two indirect Layer-3 UE-to-Network
Relays using N3IWF
Steps 0 and 1 are pre-requisite to path switching. The Layer-3 UE-to-Network
Relay has been authorised to do relaying. In step 1, the Remote UE is
provisioned and authorised to relay its traffic via Layer-3 UE-to-Network
Relay and the Remote UE is registered to PLMN.
2\. When the path switching criteria is met, the Remote UE discovers new
Layer-3 UE-to-Network Relay.
Editor\'s note: It is expected that the path switching criteria is specified
in another solution and in co-operation with RAN WGs.
3\. Remote UE establishes a PC5 link with the new Layer-3 UE-to-Network Relay.
If the Layer-3 UE-to-Network Relay does not already have suitable PDU session
for relaying, it establishes new PDU session or modifies an existing PDU
session to provide the QoS required by the Remote UE.
4\. Layer-3 UE-to-Network Relay allocates IPv4 address or IPv6 prefix to the
Remote UE.
There are no new requirements on the Remote UE or the Layer-3 UE-to-Network
Relay in steps 2 - 4. In these steps, both UEs support their Remote UE and
Relay UE roles in relay discovery as specified in clause 6.5.1.2.1 of TS
23.304 [3].
5\. Remote UE re-uses the tunnel that has already been established and uses
MOBIKE to re-configure its outer IP address towards the same N3IWF as before.
The N3IWF re-uses the mechanism specified for Local mobility anchor within
untrusted non-3GPP access networks using MOBIKE as specified in clause 6.2.9
of TS 23.501 [7].
6\. Relayed data transfer via the new Layer-3 UE-to-Network Relay.
7\. Remote UE releases the old PC5 connection.
### 6.36.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
Remote UE:
\- Capability to select another Relay UE when being connected via Relay UE
over PC5 link.
\- Capability to re-use the already specified update of IP address using
MOBIKE.
## 6.37 Solution #37: Path switching of remote UE(s) having an indirect
connection via a L2 UE-NW Relay
### 6.37.1 Description
This solution addresses Key Issue 4.
A solution is proposed to address the scenario where a Layer 2 based UE-NW
Relay that has one or more Remote UE(s) having an active indirect connection
via this relay and the network determines that the UE-NW relay needs to
handover. When the handover takes place one or more of the Remote UE(s) may
not be allowed to access the target RAN node selected for this UE-NW relay due
to mobility restrictions. In order to ensure service continuity the source RAN
node can effectively trigger path switch to a direct connection for such
Remote UE(s).
This solution requires the following functionality to be supported:
\- NG-RAN node is aware of the Remote UE(s) that have an indirect 3GPP
connection via a Layer-2 based UE-NW Relay.
\- NG-RAN node is aware of the Mobility Restriction List of the L2 UE-NW Relay
and Remote UE(s) having an active indirect connection via the UE-NW Relay.
\- Remote UE(s) provide Measurement Reports to the NG-RAN node via the Layer-2
based UE-NW Relay.
\- NG-RAN node handles the handover signalling of the L2 UE-NW Relay and
Remote UE(s) (that have an indirect 3GPP connection via the L2 UE-NW relay)
separately.
### 6.37.2 Procedures
The procedure is described in the Figure below.
Figure 6.37.2-1: Path switch procedure
0a. A Remote UE has already selected a UE-NW Relay and has an active indirect
connection to the 3GPP network via the L2 UE-NW Relay. Both Remote UE and UE-
NW Relay are in Connected state.
0b. The Source RAN node is aware of which Remote UE(s) have an active indirect
connection via a UE-NW Relay.
0c. The Source RAN node is also aware of the Mobility Restriction List of both
the UE-NW Relay and the Remote UE.
1a. The L2 UE-NW Relay provides RRC Measurement Reports to the Source RAN
node.
1b. The Remote UE provides RRC Measurements Reports to the Source RAN node via
the L2 UE-NW Relay.
2\. Based on the measurement reports of the L2 UE-NW Relay the Source RAN node
decides to handover the L2 UE-NW Relay and selects a Target RAN node. The
Target RAN node selected should support both L2 UE-NW Relay and Remote UEs.
Editor\'s note: Step 2 has RAN dependency and should be evaluated by RAN WGs.
3\. The Source RAN node may decide to switch the Remote UE connection to a
direct 3GPP connection and selects a Target RAN node for the Remote UE taking
into account the Measurement Reports provided by the Remote UE in step 1b.
4\. Source RAN node starts the Handover Preparation phase for the Remote UE as
described in clause 4.9.1.3.2 of TS 23.502 [8]. The Source RAN node includes
in the handover signalling information related to the Remote UE (e.g. QoS
Flows/DRB information and the PDU sessions related to the Remote UE).
5\. The AMF of the Remote UE starts the Execution Phase of the handover
sending a Handover Command indication to the Remote UE.
6\. The Remote UE determines a handover to a direct connection.
7\. The Remote UE synchronises to the target cell.
8\. The AMF of the Remote UE sends a PDU session update to the SMF informing
that the handover is complete (as in clause 4.9.1.3.3 of TS 23.502 [8]).
9\. The Remote UE may release the direct PC5 connection to the UE-NW relay.
10\. Source RAN node starts the Handover Preparation phase for the L2 UE-NW
Relay as described in clause 4.9.1.3.2 of TS 23.502 [8]. The Source RAN node
includes in the handover signalling information related to the L2 UE-NW Relay
(e.g. QoS Flows/DRB information and the PDU sessions related to the UE/NW
Relay).
11\. The AMF of the L2 UE-NW Relay starts the Execution Phase of the handover
sending a Handover Command indication to the L2 UE-NW Relay.
12\. The L2 UE-NW Relay synchronises to the target cell.
13\. The AMF of the L2 UE-NW Relay sends a PDU session update to the SMF
informing that the handover is complete (as in clause 4.9.1.3.3 of TS 23.502
[8]).
### 6.37.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
\- NG-RAN triggers handover of remote UE(s) during handover of relay UE.
## 6.38 Solution #38: Switching from direct network communication to indirect
network communication
### 6.38.1 Description
In this solution is to address KI#4 on how to switch from direct network
communication to indirect network communication based on L2.
In this solution, there are following assumptions:
\- It is assumed that UE has direct network communication and expects to
switch to indirect network communication (i.e. via L2 Relay UE).
\- Remote UE sends HO request to Source gNB, to assist source gNB to perform
HO
\- The source gNB and target gNB can be same or different one
### 6.38.2 Procedures
Figure 6.38.2-1: Switch from direct network connection to indirect network
connection
It is assumed that UE has UL/DL data transferred via the direct network
connection.
1\. UE decides to try to switch from direct network connection to indirect
network connection, based on the local policy/configuration, e.g. the direct
network connection may fail to meet the QoS of the UL/DL data transmission.
2\. Remote UE tries to perform L2 U2N Relay discovery procedure to select a
suitable L2 U2N Relay UE as specified in clause 6.3.2.3 of TS 23.304 [3]. when
one UE triggers to perform L2 U2N Relay discovery procedure, it becomes as
Remote UE.
3\. PC5 connection is established between Remote UE and L2 U2N Relay UE as
specified in clause 6.4.3 of TS 23.304 [3].
When L2 U2N Relay UE is in CM-IDLE state, it triggers Service Request to
become CM-CONNECTED state.
4\. Remote UE sends the HO request with necessary information to assist source
gNB to make decision to handover to target gNB, the information including
target gNB ID/cell ID, L2 U2N Relay UE ID, UE ID, etc.
5\. Source gNB makes the decision to switch the Remote UE\'s data from source
gNB to target gNB, based on the information received in step 4.
6\. Xn based HO procedure is performed as in clause 4.9.1.2.2 of TS 23.502 [8]
when there is Xn connection between source/target gNB; or if there is no Xn
connection, N2 based HO procedure is performed as in clauses 4.9.1.3.2 and
4.9.1.3.3 of TS 23.502 [8]
Editor\'s notes: this solution has RAN dependency and evaluated by RAN WG is
required;
Editor\'s notes: this solution doesn\'t address the switch from indirect
connection to direct connection. It is FFS.
### 6.38.3 Impacts on services, entities and interfaces
UE impact:
\- sending HO request to assist gNB to make the decision.
gNB impact:
\- to make decision for HO from direct network communication to indirect
network communication based on UE\'s request.
## 6.39 Solution #39: Multi-path transmission for Layer-2 UE-to-Network Relay
Using Redundant PDU Sessions
### 6.39.1 Description
This solution resolves Key Issue #5 about multi-path transmission of UE-to-
Network Relay for improved reliability only aspect of the KI, for Layer-2 UE-
to-Network Relay.
5GS is already enhanced to support redundant transmission of high reliability
communication for URLLC scenario as described in clause 5.33.2 of TS 23.501
[7]. A UE supporting redundant transmission will set up two redundant PDU
Sessions over the 5G network, and the 5GS sets up the user plane paths of the
two redundant PDU Sessions.
For the multi-path transmission for Layer-2 UE-to-Network Relay, the UE acts
as a normal UE accessing to its serving NG-RAN directly and also as a Remote
UE accessing to NG-RAN through UE-to-Network Relay as shown in Figure
6.39.1-1. And two redundant PDU Sessions are established by the interaction
between UE and NG-RAN/5GC to transfer the data for the ProSe Services with
high reliable requirements. In the figure, a single NG-RAN realizes redundant
user plane resources for the two PDU Sessions and it acts as both Master Node
and Secondary Node.
Editor\'s note: For the involvement of NG-RAN and which path is used to
transfer CP messages, coordination with RAN WGs is needed. Whether one Remote
UE can have two active RRC and PDCP connections (direct Uu and indirect Uu via
a Layer-2 U2N Relay) with one NG-RAN needs to be checked with RAN WGs.
Figure 6.39.1-1: Multi-path transmission for Layer-2 UE-to-Network Relay
How to establish two redundant PDU Sessions and associate the duplicated
traffic from the same application using RSN and/or PDU Session Pair ID is
specified in clause 5.33.2 of TS 23.501 [7].
Editor\'s note: In URLLC, the same AMF, and same UE are involved. Here Relay
UE is involved and how the Relay UE is involved is to be determined by NG-RAN.
When NG-RAN receives the indication (i.e. the RSN and PDU Session Pair ID) of
redundant PDU Session request, it will configure dual connectivity for these
two redundant PDU sessions as described in clause 16.1.6 of TS 38.300 [15]
with the following change:
\- Regarding the disjoint paths for the redundant PDU Sessions, the direct
path is used for one PDU Session and the indirect path is used for another PDU
Session.
### 6.39.2 Procedures
Depicted in Figure 6.39.2-1 is the high-level procedure of multi-path
transmission for Layer-2 UE-to-Network Relay.
Figure 6.39.2-1: High-level procedure of multi-path transmission for Layer-2
UE-to-Network Relay
0\. Remote UE performs registration and connection establishment as specified
in steps 0\~6 of clause 6.5.2.2 of TS 23.304 [3].
1\. UE establishes redundant PDU Session 1 with RSN and/or PDU Session Pair ID
with user plane path directly to NG-RAN as specified in clause 5.33.2 of TS
23.501 [7].
2\. UE establishes redundant PDU Session 2 with RSN and/or PDU Session Pair ID
with user plane path through Layer-2 UE-to-Network Relay as specified in
clause 5.33.2 of TS 23.501 [7].
The handling of redundant PDU Sessions for NG-RAN is specified in clause
16.1.6 of TS 38.300 [15].
3\. Redundant data of ProSe Service is transmitted directly.
4\. Redundant data of ProSe Service is transmitted through Layer-2 UE-to-
Network Relay.
### 6.39.3 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
UE:
\- Support redundant PDU Sessions with one of them on Layer-2 UE-to-Network
Relay path.
NG-RAN:
\- Support redundant PDU Sessions with one of them on Layer-2 UE-to-Network
Relay path.
SMF:
\- Support redundant PDU Sessions.
UPF:
\- Support traffic transmission for redundant PDU Sessions.
## 6.40 Solution #40: 5GC influenced multi-path transmission via Layer-2 UE-
to-Network Relay
### 6.40.1 Description
This solution proposes a 5GC influenced multi-path transmission via Layer-2
UE-to-Network Relay mechanism for KI#5.
In this solution, 5GC will provide some guidance to NG-RAN for multi-path
transmission. The guidance may instruct NG-RAN that which QoS flow should be
duplicated or split, it means the principles of multi-path transmission are
not only relied on NG-RAN determination.
To realize the 5GC influenced multi-path transmission, the NG-RAN needs to
indicate the 5GC that the Remote UE has established dual path connection. As
for how to determine to use multi-path, the Remote UE can be based on the
configured ProSe policy for multi-path, or rely on the application indication,
or depend on its implementation.
### 6.40.2 5GC influenced multi-path transmission procedure including L2 relay
Figure 6.40.2-1: 5GC influenced multi-path transmission procedure including L2
relay
1\. The Remote UE performs the registration procedure and policy provisioning
procedure which may include multi-path policy over direct network path as
described in TS 23.502 [8] or indirect network path as described in TS 23.304
[3].
2\. When to initiate the ProSe service, if there is multi-path requirement
based on triggers in clause 6.27.1, the Remote initiate the AS connection with
NG-RAN over another path depended on step 1.
Editor\'s note: How the multi-AS connections are established depends on RAN
WG2.
3\. After step 2, the NG-RAN informs the AMF that the Remote UE has dual path
connection.
4\. Remote UE initiates the PDU session establishment procedure over one path,
and sends the NAS message including PDU session establishment request to AMF.
5\. AMF sends the PDU session establishment request from Remote UE to SMF
along with a dual path connection indication.
6\. SMF responses to AMF.
7\. SMF determines the multi-path transmission guidance based on local policy
or interaction with PCF.
8\. SMF sends the Namf_Communication_N1N2MessageTransfer to AMF including the
determined multi-path transmission guidance to NG-RAN.
9\. AMF provides the multi-path transmission guidance to NG-RAN via the N2 PDU
session request.
10\. NG-RAN creates the multi-path transmission rules taking the multi-path
transmission guidance from SMF into account. NG-RAN instructs the Remote UE
multi-path transmission.
11\. NG-RAN responses to AMF including the performing result of multi-path
transmission (e.g. the accepted multi-path transmission guidance) via the N2
PDU session response.
12\. AMF forwards the performing result of multi-path transmission to SMF from
NG-RAN.
13\. SMF performs the N4 session modification.
14\. SMF responds to AMF.
Editor\'s note: The RAN dependent issues in this solution need to coordinate
with RAN groups.
Editor\'s note: Whether one Remote UE can have two active RRC and PDCP
connections (direct Uu and indirect Uu via a Layer-2 U2N Relay) with one NG-
RAN needs to be checked with RAN WGs.
### 6.40.3 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
UE(s):
\- is able to perform multi-path transmission.
NG-RAN(s):
\- is able to perform multi-path transmission.
\- indicates 5GC the Remote UE has dual path connection.
\- perform the multi-path transmission taking the multi-path transmission
guidance into account.
AMF:
\- indicates SMF the Remote UE has dual path connection.
SMF:
\- supports to create the multi-path transmission guidance for NG-RAN.
## 6.41 Solution #41: Improve communication reliability with two-path
transmission
### 6.41.1 Description
This solution addresses the Key Issue 5 on Multi-path transmission using U2N
Relay to improve the communication reliability. It applies for scenario when
the indirect network communication path is through L-3 U2N relay.
This solution assumes the following mechanism to support communication
reliability:
\- In the case of L-3 U2N relay without N3IWF, it is assumed that the Remote
UE uses its own PDU session as the direct communication path and the PDU
session of the relay UE as the indirect network communication path to realize
communication reliability. These two redundant PDU sessions use two different
UPFs.
\- In the case of L-3 U2N relay with N3IWF, it is assumed that the Remote UE
uses its own PDU session as the direct communication path and the Non-3GPP PDU
session established through N3IWF as the indirect communication path to
realize communication reliability, The Non-3GPP PDU session established
through N3IWF is over the PDU session of L-3 U2N relay. These two redundant
PDU sessions use two different UPFs.
\- In the case of L-3 U2N relay with N3IWF, it is assumed that the Remote UE
can use ATSSS mechanism to setup two redundant User Plane paths in a MA PDU
session to realize communication reliability. One path is over 3GPP access as
the direct communication path, and the other one is over Non-3GPP access as
the indirect communication path which is through N3IWF and the path of PDU
session of the L-3 U2N relay. The traffic distributed across the two redundant
User Plane paths may apply corresponding Steering Mode, e.g. Active-Standby or
Duplication.
\- In the above 3 cases, the two redundant User Plane paths may go through two
different NG-RANs or same NG-RAN, depending on the scenarios. In the case of
two different NG-RANs, communication reliability at RAN side is naturally
supported. In the case of a same NG-RAN, the NG-RAN needs to internally
realize the communication reliability, e.g. by allocate different, redundant
user plane resources for the each User Plane path.
\- It is assumed NG-RAN is provided with the ID of the communication path in
the PDU session of L-3 U2N relay. This ID is generated by L-3 U2N relay. The
NG-RAN is also provided with ID of redundant communication path in the PDU
session established by Remote UE over 3GPP access. This ID is determined by
Remote UE, and the Remote UE get this ID information from L-3 U2N relay. If
within a NG-RAN there are two PDU session with the same ID for the
communication path and redundant communication path, this NG-RAN should
realize communication reliability for these two PDU session.
\- The Remote UE and L-3 U2N relay should support the above redundancy
mechanism. The Remote UE and L-3 U2N relay need to be authorized for the
additional service of redundancy communication when performing authorization
and provision for L-3 U2N Relay. In the discovery procedure, the Remote UE
selects a L-3 U2N relay which supports redundancy communication.
### 6.41.2 Procedures
#### 6.41.2.1 Procedures for communication reliability
Figure 6.41.2.1-1 describes the general procedures of the solution.
Figure 6.41.2.1-1: General procedures for the solution
1\. Redundancy service Authorization and Provisioning procedures following R17
are performed for L-3 U2N Relay and Remote UE. The Prose policy for remote UE
can include authorization for redundancy communication between multi-path
transmission. The Prose policy for L-3 U2N UE can include authorization for
redundancy handing on PDU session for L3 relay.
2\. The 5G ProSe L-3 U2N Relay may establish a PDU Session for relay that
supports redundancy. The L-3 U2N Relay may generate the ID of the
communication path and send to its SMF. The SMF sends the ID of the
communication path to NG-RAN in the PDU session establish procedures, e.g. in
N2 SM information.
NOTE: Uniqueness of the ID is required to be guaranteed to avoid the case that
multiple L-3 U2N Relay generate the same ID. The L-3U2N Relay UE may generate
the ID of the communication path by some algorithm, e.g. based on random
number, to ensure it is unique across all Relay UEs in a RAN node.
3\. The Remote UE performs discovery of a ProSe L-3 U2N Relay with redundancy
capability and service. This may be triggered by UE implementation, when some
application needs reliable communication.
4\. The Remote UE establishes a connection to L-3 U2N Relay. If there is no
PDU Session associated with the Relay Service Code or a new PDU Session for
relaying is needed, the 5G ProSe L-3 U2N Relay initiates a new PDU Session
establishment procedure for relaying as described in step 2 before completing
the PC5 connection establishment. In the procedures for establishment of
unicast PC5 link, the L-3 U2N Relay sends the ID of the communication path to
Remote UE, e.g. in Direct Communication Accept message, then the Remote UE
treats it as ID of the redundancy communication path to the communication path
established at 3GPP access side in step 6.
5\. Subsequent steps for different L-3 U2N communication mode, after Remote UE
connected to L-3 U2N Relay:
5a. In the case of L-3 U2N relay without N3IWF, for IP PDU Session Type and IP
traffic over PC5 reference point, IPv6 prefix or IPv4 address (including NAT
case) is allocated for the Remote UE. The UE use the IP address for
communication.
5b. In the case of L-3 U2N relay with N3IWF, the Remote UE registers in 5GC
through N3IWF via the communication path of L-3 U2N Relay. The Remote UE
establishes PDU session or MA PDU session at Non-3GPP side. If the UE is
configured with ATSSS and the network supports MA PDU session, then the UE
decides to establish MA PDU session at Non-3GPP side. It is assumed the MA PDU
session is prior to two single PDU sessions when redundant communication is
required.
6\. If it is following step 5a in which the Remote UE uses the PDU session of
L-3 U2N relay for communication, or in step 5b the Remote UE establishes PDU
session at Non-3GPP side, the Remote UE establishes a new PDU session at 3GPP
access side. These two redundant PDU sessions use two different UPFs which
could be achieved by operator configuration.
If in step 5b the Remote UE established MA PDU session at Non-3GPP side, the
Remote UE establishes another access leg of the MA PDU session at 3GPP access
side.
In the above PDU session establish procedures, the Remote UE may send the ID
of redundant communication path to its SMF. The SMF sends this ID to NG-RAN in
the PDU session establish procedures, e.g. in N2 SM information. With ID of
redundant communication path, NG-RAN knows the PDU session is from L3 remote
UE and needs the redundancy handling with another UE\'s PDU session.
After step 6, two redundant communication paths are established, then they can
be used for redundant traffic delivery end-to-end following the methods
defined in URLLC. If it is a MA PDU session, then the traffic distributed
across the two redundant paths may apply corresponding Steering Mode for
ATSSS, e.g. Active-Standby or Duplication. How to support redundant handling
for ATSSS at UE side and 5GC side will be standardized in Rel-18 ATSSS_Ph3.
7\. This step includes the assumed redundant handling at RAN side. If the PDU
session of L-3 U2N Relay and PDU session of Remote UE at 3GPP access are in a
same NG-RAN node, this NG-RAN should realize communication reliability for
these two PDU session, e.g. allocating different, redundant user plane
resources for each PDU session. The NG-RAN can identify the two PDU sessions
by comparing the ID of the communication path in a PDU session of Relay with
the ID of the redundant communication path in a PDU session of Remote UE. If
the two PDU sessions are separately at different NG-RAN nodes, then each of
the NG-RAN can check out that the two PDU sessions are not paired in the NG-
RAN. When multiple Remote UEs share a same Relay in a NG-RAN, the NG-RAN
should realize communication reliability for PDU session of Relay and PDU
sessions of multiple Remote UEs, e.g. the allocated user plane resources for
PDU session of Relay is different from the allocated user plane resources for
PDU sessions of multiple Remote UEs. It is assumed that the NG-RAN could
identify the two PDU sessions by finding out a PDU session of Remote UE whose
ID of redundant communication path has the same value with the ID of
communication path of the PDU sessions of Relay, when there is new PDU session
of Relay in the NG-RAN, e.g. due to Relay mobility. The NG-RAN could identify
the two PDU sessions by finding out a PDU session of Relay whose ID of
communication path has the same value with the ID of redundant communication
path of the PDU sessions of Remote UE when there is new PDU session of Remote
UE in the NG-RAN. If the NG-RAN support Master Node and Secondary Node, the
NG-RAN could realize redundant user plane resources for the two PDU Sessions
with two NG-RAN nodes, by dividing each of the two PDU sessions on different
Node.
Editor\'s note: Confirmation of feasibility on RAN impacts by RAN WGs is
required before concluding this solution.
Editor\'s note: It is up to RAN decision on whether and how to identify the
paired PDU session for redundancy belonging to different two UEs in a NG-RAN.
### 6.41.3 Impacts on services, entities and interfaces
The following impacts are foreseen by this solution:
Remote UE:
\- Authorization of ProSe service of L3 Relay supporting communication
redundancy
\- Selection of a L-3 U2N relay support communication redundancy mechanism in
ProSe discovery procedure
\- Provision of ID of redundant communication path
L-3 U2N relay:
\- Authorization of ProSe service of L3 Relay supporting communication
redundancy
\- Provision of ID of communication path
5G DDNMF:
\- Authorization and discovery for ProSe service of L3 Relay supporting
communication redundancy
SMF:
\- Provision to NG-RAN with ID of communication path, ID of redundant
communication path
NG-RAN:
\- Redundancy handing between the two PDU sessions identified by same ID of
communication path
## 6.42 Solution #42: Emergency Services for UE to Network Relaying
### 6.42.1 Description
This solution address Key Issue #7 for \"Support of Emergency Services for UE
to Network Relaying\".
When a 5G ProSe enabled UE acts as Relay, based on the SA WG1 response
(S2-2205433), it is assumed that the Relay UE registered to a PLMN, i.e. the
relay UE has a SIM/USIM/ISIM.
Under the assumptions that a UE responsible for another UE\'s emergency
service is compliant with local regulation and the Relay UE and the Remote UE
belong to the same PLMN, this solution contains the following aspects:
\- Provisioning emergency service support using the Rel-17 policy and
parameter providing with the following additions:
\- ProSe Relay Discovery policy/parameters for 5G ProSe UE-to-Network
Relay/Remote UE includes a dedicated emergency Relay Service Code associated
with emergency service (as Emergency RSC). The Emergency RSC needs to be
defined as a unique value in 3GPP standards.
\- A 5G ProSe Layer-3 UE-to-Network Relay advertises its support of emergency
service only when the UE receives Emergency Support Indicator in Registration
Accept, and has been provisioned with the policy for the dedicated emergency
RSC.
\- A 5G ProSe Layer-2 UE-to-Network Relay advertises its support of emergency
service when NG-RAN support of emergency services is indicated as the Layer
Remote UE may select a different PLMN from the Layer-2 Relay and has been
provisioned with the policy for the dedicated emergency RSC.
Editor\'s note: When the L2 Relay UE advertise emergency RSC, whether the L2
Relay needs to check if its serving PLMN\'s supports relaying of emergency
service is FFS.
\- A 5G ProSe Remote UE becomes aware whether a 5G ProSe UE-to-Network Relay
can support emergency services during discovery from the dedicated emergency
RSC.
\- A 5G ProSe Remote UE indicates emergency access request to the 5G ProSe UE-
to-Network Relay using the dedicated emergency RSC during PC5 link
establishment, and 5G ProSe UE-to-Network Relay informs its network of the
emergency service access.
\- If the 5G ProSe Remote UE completes the emergency call, it may wait for a
configurable period of time before initiating release of PC5 link for
emergency service. This is to prepare for any possible call back.
\- A dedicated PC5 link needs to be established for the dedicated RSC for
emergency service.
\- When the PC5 link for emergency service is released if the 5G ProSe UE-to-
Network Relay is not involved in emergency service from any Remote UE, the
Relay UE inform its AMF it is no longer relaying for emergency service.
For emergency service from a Remote UE, it is assumed that the local
regulation and associated operator policy of the Relay UE\'s serving PLMN will
apply to the Remote UE as well, e.g.:
\- if the Relay UE\'s serving PLMN does not allow emergency service from a UE
without a SIM/USIM/ISIM, then the emergency request from such UE is also
rejected by the Layer-3 Relay. If the Remote UE includes SUCI or PRUK ID in
PC5 link establishment (see clause 6.3.3 of TS 33.503 [24]), then the Layer-3
Relay UE knows that the Remote UE may have a SIM.
\- if authentication is optional in Relay UE\'s serving PLMN, then the
authentication security procedures as specified in clause 5.1.4.3 of TS 23.304
[3], for the Remote UE during PC5 link establishment for emergency service can
be skipped.
Editor\'s note: Whether any PC5 security procedures are requires is FFS.
NOTE: If local regulation and associated operator policy allows emergency
calls without the SIM/USIM/ISIM, the IMSI check can be skipped.
### 6.42.2 Procedures
This clause captures the changes to the following (existing) procedures in TS
23.304 [3]:
\- clause 5.1.4.1: Policy/Parameter provisioning for 5G ProSe UE-to-Network
Relay.
\- The dedicated Relay Service Code is used to support and identify emergency
services over a UE-to-Network Relay. ProSe Relay Discovery policy/parameters
for 5G ProSe UE-to-Network Relay includes the dedicated emergency Relay
Service Code and any associated parameters.
\- clause 5.4.3: Mobility Restrictions for 5G ProSe UE-to-Network Relaying.
\- Reflect the support of emergency service as follows:
\- If a 5G ProSe enabled UE with UE-to-Network Relay capability has a normal
registration but in Non-Allowed Area, it can perform relay operation for
emergency service from a remote UE. This applies to both Layer-2 and Layer-3
5G ProSe UE-to-Network relaying.
\- For Layer-3 Remote UE, service Area Restrictions are not applicable.
\- For Layer-2 remote UE which has normal registration but in Non-Allowed
Area, the remote UE can initiate emergency service.
\- For Layer-2 remote UE in forbidden area, the L2 remote UE can initiate
emergency service if its serving PLMN supports emergency service.
\- clause 6.3.2.3: 5G ProSe UE-to-Network Relay Discovery.
\- A dedicated emergency RSC is included in the UE-to-Network Relay Discovery
messages including Model A and Model B discovery, if the Relay Discovery is
for emergency service. The 5G ProSe UE-to-Network Relay and the 5G ProSe
Remote UE can recognise the discovery and the subsequent procedure (e.g. PC5
connection setup or management) which are for emergency service based on the
dedicated emergency RSC.
\- A 5G ProSe Layer-3 UE-to-Network relay includes a dedicated emergency RSC
when it receives the Emergency Services Support indication from AMF in the
Registration Accept message. Emergency Services Support indication indicates
that the 5G ProSe Layer-3 UE-to-Network Relay can setup emergency PDU Session
to obtain emergency services. For Layer-2 UE-to-Network Relay case, a UE-to-
Network relay includes the dedicated emergency RSC when the serving NG-RAN
indicates the support of emergency services, such as ims-EmergencySupport in
SIB1 message as defined in TS 38.331 [14].
\- For 5G ProSe UE-to-Network Discovery with Model B, 5G ProSe Remote UE
requests for emergency service for relaying.
\- clause 6.4.3.6: Layer-2 link management over PC5 reference point for 5G
ProSe UE-to-Network Relay.
\- When the Remote UE sets up the PC5 link for emergency service towards the
Relay UE, the Relay UE may check the network support of emergency service for
Remote UE.
\- During PC5 Layer-2 link establishment, the Relay UE will check the AMF
provided network support of remote UE emergency service to determine whether
to reject the link establishment or to continue the link establishment. When
the Relay UE determine to continue the link establishment, whether the
security procedure should be performed or can be skipped for 5G ProSe
Communication via 5G ProSe UE-to-Network Relay (see clause 5.1.4.3 of TS
23.304 [3] for the security procedure) is based on Relay UE\'s serving AMF
indication in registration procedure (as described below for updates to clause
6.6.2).
Editor\'s note: Whether any PC5 security procedures are requires is FFS.
\- clause 6.5.1.1: 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network
Relay without N3IWF.
\- The connection establishment defined in clause 6.5.1.1 and clause 6.5.1.2
of TS 23.304 [3] is reused. When the Remote UE sends the Direct Communication
Request message including the dedicated emergency RSC, the UE-to-Network Relay
sets up the emergency PDU session for relaying or modifies the emergency PDU
session for support of Remote UE\'s emergency service.
\- If the 5G ProSe UE-to-Network Relay UE\'s state is in RRC_IDLE, then the
Relay UE set RRC establishment cause to \"emergency\" when establishing a Uu
connection to RAN.
\- The 5G ProSe Layer-3 UE-to-Network Relay needs to establish an emergency
PDU Session for emergency service from the 5G ProSe Layer-3 UE-to-Network
Remote UE.
\- When a 5G ProSe Layer-3 UE-to-Network Remote UE initiates emergency
service, if the 5G ProSe Layer-3 UE-to-Network Relay has its own emergency
service ongoing, the 5G ProSe Layer-3 UE-to-Network Relay should prioritize
its own emergency service and reject the Remote UE\'s request. The 5G ProSe
Layer-3 UE-to-Network Remote UE can attempt to select other 5G ProSe Layer-3
UE-to-Network Relay.
Editor\'s note: It if FFS whether the emergency PDU Session of Layer-3 Relay
UE can be used to transmit the Layer-3 Remote UE\'s emergency service and the
Layer-3 Relay UE\'s emergency service simultaneously or whether a Remote UEs
emergency session should be terminated in favour of an emergency session from
the Relay UE.
\- clause 6.5.1.2: 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network
Relay with N3IWF support.
\- A 5G ProSe Layer-3 Remote UE shall attempt to use 5G ProSe Communication
via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF procedures before
attempting to establish an emergency PDU Session via 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF support.
\- If 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay without
N3IWF can\'t be used then 5G ProSe Layer-3 UE-to-Network Relay with N3IWF
support can be used however there is no enhancement to the 5G ProSe Layer-3
Relay UE to support this, i.e. if the 5G ProSe UE-to-Network Relay UE\'s state
is RRC_IDLE, then the Relay UE does not set RRC establishment cause to
\"emergency\" when establishing a Uu connection to RAN and PC5 security
procedures will be performed.
\- clause 6.5.2: 5G ProSe Communication via 5G ProSe Layer-2 UE-to-Network
Relay.
\- If the 5G ProSe UE-to-Network Relay UE\'s state is in RRC_IDLE, then the
Relay UE set RRC establishment cause to \"emergency\".
\- If the 5G ProSe UE-to-Network Relay UE\'s state is in RRC_CONNECTED, the 5G
ProSe UE-to-Network Relay needs to inform its CN over NAS that the UE is
involved in emergency service for a 5G ProSe UE-to-Network Remote UE, so that
the 5G ProSe UE-to-Network Relay UE can be exempted from e.g. overload
control.
\- Connection establishment defined in clause 6.5.2.2 of TS 23.304 [3] is
reused. If the Layer-2 Remote UE does not receive the Emergency Services
Support indication from AMF in the relayed Registration Accept message, the
Layer-2 Remote UE may release the PC5 connection associated with Emergency RSC
with the Layer-2 UE-to-Network Relay.
\- clause 6.6.2: Registration procedure.
\- To apply the local regulation and operator policy of the Relay UE\'s
serving PLMN to the Remote UE as well, the following addition is needed:
During Registration from a 5G ProSe enabled UE, if the UE is authorized to act
as a Relay, the AMF provides the network support of emergency service for
Remote UE based on behaviours defined in clause 4.3.12.1 of 23.401 [25].
Editor\'s note: Whether this is required for Layer-2 Relay is FFS.
NOTE: The above network support indications are used by the Relay UE to accept
or reject the PC5 link establishment from the Remote UE for emergency service,
and to determine whether security procedure can be skipped during PC5 link
establishment from the Remote UE for emergency service.
### 6.42.3 Impacts on services, entities and interfaces
UE:
\- 5G ProSe-enabled UE that is capable of UE-to-Network Relay receives
information from AMF the network support of remote UE\'s emergency service
\- A 5G ProSe Layer-2 UE-to-Network Relay also receives information from NG-
RAN about support whether any PLMN access via the RAN node the relay is using
supports emergency access
\- During PC5 Layer-2 link establishment, the Relay UE will check the AMF
provided network support of remote UE emergency service to determine whether
to reject the link establishment or to continue the link establishment. When
the Relay UE determine to continue the link establishment, whether the
security procedure should be performed or can be skipped for 5G ProSe
Communication via 5G ProSe Layer-3 UE-to-Network Relay.
\- If 5G ProSe-enabled UE that is capable of UE-to-Network Relay has a normal
registration but in Non-Allowed Area, it can act as Relay for emergency
service from the remote UE.
AMF:
\- Provide the network support of remote UE\'s emergency service to a 5G
ProSe-enabled UE that is capable of UE-to-Network Relay
## 6.43 Solution #43: Emergency Services over UE-to-Network Relay
### 6.43.1 Description
This solution addresses the Key Issue \"Support of Emergency services for UE
to Network Relaying\" and describes enhancements to indirect communication
over U2N Relay for supporting emergency services.
### 6.43.2 Procedures
This solution proposes support for emergency services over Layer-2 UE-to-
Network Relay and Layer-3 UE-to-Network Relay with N3IWF. The following call
flow describes the general steps required for establishing an emergency call
over U2N Relay.
Figure 6.43.2-1: Overview of emergency call establishment over U2N Relay
Identification of support of emergency services by U2N Relay: Dedicated RSC
The Remote UE should be able to identify whether a UE-to-Network Relay UE
supports relaying emergency services during Relay Discovery phase. A Relay
Service Code is used to differentiate the services offered by Relay UEs. The
Relay Service Code for emergency services needs to be defined as a unique
value in 3GPP standards.
Relay Authorization for Emergency Services
Emergency services over ProSe U2N Relay has a different importance than normal
services. The emergency services are a critical connection for the user of the
remote UE and Public Safety Access Point that is reached through UE\'s
emergency call. A 5G ProSe UE capable to perform U2N Relaying may not be
willing to relay emergency services (for example, due to low battery level and
imminent switch-off or a known movement from that location). Hence it is
important that UE indicates its capability to function as a U2N Relay capable
for emergency services during registration procedure with the network.
The network indicates authorization to function as a U2N Relay for emergency
services by either explicit indication or by including the Relay Service Codes
for emergency services.
Relay Selection Enhancements
For Layer-3 Relay Selection, the existing relay selection procedure (with
enhancements to identify emergency services RSC) is sufficient for supporting
emergency services.
For Layer-2 Relay selection, the Relay UE shall provide emergency service for
remote UEs of any PLMN. The Layer-2 Remote UE shall skip the PLMN check if the
relay selection is performed for emergency service RSC. This also implies that
a Layer-2 Relay UE that is authorized by the network for relaying emergency
services broadcasts the emergency related RSCs only if the NG-RAN cell
indicates support of emergency services (IMSEmergencySupport).
PC5 Connection Establishment enhancement
This enhancement is needed for Layer-2 UE-to-Network Relay. The Remote UE
indicates during Layer-2 link establishment phase whether the link
establishment is triggered due to an originating emergency service. This maybe
either through the use of dedicated emergency services RSC or through the use
of Direct Communication Request enhanced with a new cause value indicating
\"emergency services over U2N Relay\".
Enhancements to Location Request procedure
Network may use either of the following to get the UE location during an
emergency call.
i) UE Provided Location Information (UPLI).
ii) Network provided Location Information (NPLI).
In the case of emergency services over Layer-2 U2N Relay, if the network is
using NPLI, it may ask the Remote UE to report Enhanced Cell ID. The remote UE
reports the NCGI obtained from the Relay UE during the Discovery procedure to
report Enhanced Cell ID. In addition, the Remote UE also reports a confidence
factor which is indicative of its distance from the Relay UE. The higher the
distance between the Remote UE and Relay UE, lower the confidence factor.
Editor\'s note: Whether the distance between the Remote UE and Relay UE needs
to be computed is FFS, and if needed, how it is done is to be
determined/collaborated with RAN WGs.
### 6.43.3 Impacts on services, entities and interfaces
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
## 6.44 Solution #44: Emergency services for 5G ProSe Layer-3 UE-to-Network
Relay without N3IWF
### 6.44.1 Introduction
This solution specifies how the 5G ProSe layer-3 remote UE obtains emergency
services via a 5G ProSe layer-3 UE-to-network relay without involving N3IWF.
### 6.44.2 Functional description
The functional enhancements are required in the following aspects:
\- the authorisation policy for acting as a 5G ProSe Layer-3 UE-to-Network
Relay includes a list of PLMNs where the UE acting as 5G ProSe Layer-3 UE-to-
Network Relay is allowed to provision emergency services to the remote UE;
\- the ProSe Relay Discovery policy/parameters for 5G ProSe UE-to-Network
Relay includes a dedicated Relay Service Code associated with emergency
services;
\- an indicator for \"emergency service request\" can be provided by the
remote UE during the PC5 unicast link establishment procedure; and
\- the UE acting as 5G ProSe layer-3 UE-to-network relay:
\- requests the remote UE to provide identity information and/or location
information if receiving the \"emergency service request\" from the remote UE;
\- reports the identity information and location information of the remote UE
to the network during the PDU session establishment procedure for emergency
services;
\- optionally provides the remote UE with the addressing information of the
P-CSCF for emergency services and local emergency numbers if receiving from
the network; and
NOTE: The remote UE can be pre-configured with P-CSCF addressing information
and emergency numbers as well.
### 6.44.3 Procedures
The procedure of 5G ProSe Direct Discovery procedures over PC5 reference point
is the same with the procedure specified in clause 6.3.2.3 of TS 23.304 [3],
with the following additions:
\- for 5G ProSe UE-to-Network Relay Discovery with Model A, the UE acting as a
5G ProSe UE-to-Network Layer-3 Relay sends a UE-to-Network Relay Discovery
Announcement message which includes a dedicated Relay Service Code associated
with emergency services; and
\- for 5G ProSe UE-to-Network Relay Discovery with Model B, if the 5G ProSe
Remote UE wants to discover a 5G ProSe layer-3 UE-to-Network relay supporting
provisioning of emergency services, the remote UE sends a 5G ProSe UE-to-
Network Relay Discovery Solicitation message a solicitation message with the
RSC which is associated to the emergency service. The 5G ProSe layer-3 UE-to-
Network Relays that match the value of RSC associated with emergency services
contained in the solicitation message respond to the 5G ProSe Remote UE with a
UE-to-Network Relay Discovery Response message.
NOTE: A specific value of relay service code can be defined for emergency
services.
The procedure of unicast mode 5G ProSe Direct Communication is the same with
the procedure specified in clause 6.4.3.6 of TS 23.304 [3], with the following
modifications:
\- the remote UE sends the Direct Communication Request message including the
RSC associated with emergency services and optionally its location information
(e.g. specific Geographical Area, the last cell it camped on, etc.) if
available;
\- if the PDU session for emergency service is established, the UE acting as
5G ProSe layer-3 UE-to-Network Relay sends the ProSe link establishment accept
message including the address information (IP address/prefix, or FQDN) of the
P-CSCF for emergency services, and optionally local emergency numbers to the
remote UE.
The procedure of 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network
Relay without N3IWF is the same with the procedure specified in clause 6.5.1.1
of TS 23.304 [3], with the following modifications:
\- the UE acting as 5G ProSe layer-3 UE-to-Network Relay may retrieve the
physical address information (e.g. PEI, MAC address, etc.) of the remote UE
via PC5 signalling messages; and
\- the UE acting as 5G ProSe layer-3 UE-to-Network Relay reports the remote
UE\'s physical address information (e.g. MAC address, IMEI, etc.) and/or the
location information if received from the remote UE to the network during the
procedure of 5G ProSe UE-to-Network Relay connection with setup of network
Prose security context during PC5 link establishment in step 4.
Editor\'s note: The procedure of 5G ProSe UE-to-Network Relay connection with
setup of network Prose security context during PC5 link establishment for
emergency services is FFS and depends on SA WG3 conclusion.
Editor\'s note: How to determine location information of the remote UE is to
be collaborated with RAN WGs.
### 6.44.4 Impacts on services, entities and interfaces
Remote UE impacts:
\- ability to identify the dedicated RSC associated with emergency services;
\- provide physical address information and/or location information according
to the request from 5G ProSe layer-3 UE-to-Network Relay; and
\- ability to identify and handle the received address information (IP
address/prefix, or FQDN) of the P-CSCF for emergency services, and local
emergency numbers.
5G ProSe layer-3 UE-to-Network Relay impacts:
\- support to include the dedicated RSC associated with emergency services in
the UE-to-Network Relay Discovery Announcement message; and
\- ability to retrieve the physical address information and the location
information of the remote UE;
\- report UE.
Network impacts:
\- AMF/AUSF/UDM supports to authorize the UE to provision emergency service as
5G ProSe layer-3 UE-to-Network Relay; and
\- AMF/AUSF/UDM supports identify and handle the physical address information
and the location information of the remote UE.
## 6.45 Solution #45: Solution for support of emergency service for U2N relay
### 6.45.1 Description
This solution is related to the Key Issue #7 on Support of Emergency for 5G
ProSe UE-to-Network Relay.
In this solution, for the UE-to-Network Relay and remote UE that how to
identify the emergency service, it is assumed that a list of dedicated Relay
service code is to be used to reflect the emergency for UE to Network Relaying
which can be called Emergency RSC. The Emergency RSC has same format as the
RSC configured in clause 5.1.4 of TS 23.304 [3], it can be pre-configured in
the USIM or ME, or provided by the network as the UE ProSe policy.
### 6.45.2 Principles for support of emergency service for U2N relay
When the Emergency RSC is configured by the network as the ProSe policy, it
means the network of the 5G ProSe UE-to-Network Relay or the 5G ProSe Remote
UE supports the emergency service.
When the Emergency RSC is included in the UE-to-Network Relay Discovery
message including the Model A and Model B discovery, it means the 5G ProSe UE-
to-Network Relay provides emergency service for relaying or the 5G ProSe
Remote UE requests for emergency service for relaying. The 5G ProSe UE-to-
Network Relay and the 5G ProSe Remote UE can recognise the discovery and the
subsequent procedure (e.g. relay connection setup or management) which are for
emergency service based on the Emergency RSC.
When the Emergency RSC is included in the UE-to-Network Relay Discovery
Announcement message (model A discovery) or in the UE-to-Network Relay
Discovery Response message (model B discovery), it means the 5G ProSe UE-to-
Network Relay would like to provide the emergency service to remote UE and its
network supports emergency service from the 5G ProSe Remote UE perspective.
When to perform the 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network
Relay as specified in clause 6.5.1 of TS 23.304 [3] for emergency service, the
5G ProSe Layer-3 UE-to-Network Relay sets the PDU session Request Type to
\"Emergency Request\" for relaying.
When to perform the Connection Establishment for 5G ProSe Layer-2 UE-to-
Network Relay as specified in clause 6.5.2 of TS 23.304 [3] for emergency
service, the 5G ProSe Layer-2 UE-to-Network Relay sets the service request
type to \"Emergency service\" to enter the CM-CONNECTED state. If the 5G ProSe
Layer-2 UE-to-Network Relay is already in CM-CONNECTED, the NG-RAN informs
Relay AMF that the 5G ProSe Relay UE is performing emergency service for 5G
ProSe Remote UE to exempt from e.g. overload control for the 5G ProSe Relay
UE..
When the 5G ProSe UE-to-Network Relay determines to relay emergency service
for 5G ProSe Remote UE, it is allowed to act as the role of relay and perform
the Relay operation (e.g. relay discovery and connection setup) when it is
under congestion control as specified in clause 5.12 of TS 23.304 [3] and
mobility restriction as specified in clause 5.4.3 of TS 23.304 [3].
The 5G ProSe Layer-2 Remote UE follows the principles of a normal UE for
emergency service handling.
It shall ensure that the traffic and the signalling of the 5G ProSe Layer-2
Remote UE are related to the emergency service when the Connection
Establishment for 5G ProSe Layer-2 UE-to-Network Relay in clause 6.5.2 of TS
23.304 [3] is used to emergency service, especially when the 5G ProSe Layer-2
UE-to-Network Relay is under congestion control as specified in clause 5.12 of
TS 23.304 [3], mobility restriction as specified in clause 5.4.3. Clause
6.45.3 in this solution provides a way to ensure that the traffic and the
signalling of the 5G ProSe Layer-2 Remote UE are related to the emergency
service, which proposes that the RAN notify the Remote AMF of that the Remote
UE is only allowed to perform the emergency service.
Needing to be clarified is that it is still possible that the 5G ProSe remote
UE initiates the emergency services communication after the legacy connection
establishment for 5G ProSe Layer-2 UE-to-Network Relay as described in TS
23.304 [3] clause 6.5.2.2. To exempt from e.g. overload control, the NG-RAN
informs Relay AMF that the 5G ProSe Relay UE is performing emergency service
for 5G ProSe Remote UE.
For emergency service conflict between 5G ProSe Layer-3 Remote UE and UE-to-
Network Relay, the 5G ProSe Layer-3 UE-to-Network Relay is allowed to
establish 2 emergency PDU sessions.
Editor\'s note: The feasibility of more than one emergency PDU sessions at the
same time is FFS.
### 6.45.3 Procedure to ensure emergency service via Layer-2 U2N relay
Figure 6.45.2.2-1: Connection Establishment for 5G ProSe Layer-2 UE-to-Network
Relay with ensuring emergency service
0\~5. Steps 0\~5 are basically similar to the steps 0\~5 of clause 6.5.2.2 of
TS 23.304 [3] for Connection Establishment of 5G ProSe Layer-2 UE-to-Network
Relay. Following may be some differences:
For steps 2\~3, the Relay discovery, selection and PC5 connection
establishment are for emergency services which may associated with an
Emergency RSC.
For step 4, the 5G ProSe Layer-2 Remote UE establishes an RRC Connection with
the same NG-RAN serving the selected 5G ProSe Layer-2 UE-to-Network Relay
specified in TS 38.300 [15]. The RRC Connection cause is set to emergency.
For step 4, the 5G ProSe layer-2 Relay uses the service request with emergency
type to enter to the CM-CONNECTED.
6\. NG-RAN informs Remote AMF that the 5G ProSe Remote UE is using the Relay
communication and is only allowed to use emergency service.
In addition, if the 5G ProSe layer-2 Relay is already in CM-CONNECTED state
(i.e. the step 5 will be skipped), after receiving the Remote UE RRC
connection setup request with emergency cause, NG-RAN informs Relay AMF that
the 5G ProSe Relay UE is performing emergency service for 5G ProSe Remote UE
to exempt from e.g. overload control for the 5G ProSe Relay UE.
Editor\'s note: The above notification from NG-RAN to AMF needs coordination
with RAN groups.
7\~9. Steps 7\~9 are basically similar to the steps 6\~8 of clause 6.5.2.2 of
TS 23.304 [3] for Connection Establishment of 5G ProSe Layer-2 UE-to-Network
Relay. Following may be some differences:
\- Remote AMF needs to determine the request type of the NAS connection setup
and PDU session establishment, if it is not for emergency, the Remote AMF
shall reject the Remote UE\'s request.
In particular, needing to be clarified is that the legacy connection for 5G
ProSe Layer-2 UE-to-Network Relay as established in clause 6.5.2.2 of TS
23.304 [3] does not mean the 5G ProSe Remote UE cannot performing the
emergency service. During or after the legacy connection establishment for 5G
ProSe Layer-2 UE-to-Network Relay, the 5G ProSe Remote UE follows the same
handlings for emergency services performing (e.g. set emergency type/cause) as
described in TS 23.501 [7] and TS 23.502 [8]. Only the difference is that the
NG-RAN informs Relay AMF that the 5G ProSe Relay UE is performing emergency
service for 5G ProSe Remote UE to exempt from e.g. overload control.
### 6.45.4 Procedure for Layer-3 U2N relay to avoid emergency service conflict
If there is an emergency PDU session for relaying, when emergency service is
required for 5G ProSe Layer-3 relay UE itself, the 5G ProSe Layer-3 relay UE
initiates another emergency PDU session establishment procedure. Based on the
authorized subscription data Layer-3 relay UE, if there is not more than 2
emergency PDU sessions, the AMF will not reject the NAS Message containing PDU
Session Establishment Request.
### 6.45.5 Impacts on Existing Nodes and Functionality
The solution has impacts on the following entities:
UE(s):
\- Enhancement on the emergency service handling, e.g. the 5G ProSe Relay is
allowed to act the role of relay under mobility restriction and congestion
control.
\- L3 relay UE is allowed to establish 2 emergency PDU sessions.
RAN:
\- notify Remote AMF of that the Remote UE is performing relay communication
with only emergency service allowed for L2 relay case.
\- notify Relay AMF of that the Relay UE is performing emergency service for
5G ProSe Remote UE to exempt from e.g. overload control.
AMF:
\- Remote AMF determine whether the Remote UE\'s request is for emergency
service, reject the request if it is not for L2 relay case.
\- Relay AMF determines whether there is more than 2 emergency PDU sessions,
if not, the AMF will not reject the NAS Message containing PDU Session
Establishment Request.
## 6.46 Solution #46: Emergency service via 5G ProSe Layer-3 UE-to-Network
Relay with and without N3IWF
### 6.46.1 Description
This solution specifies how to support emergency services via a 5G ProSe
layer-3 UE-to-network relay with or without N3IWF. This solution is based on
5G ProSe communication via 5G ProSe Layer-3 UE-to-Network relay as specified
in clause 6.5.1 of TS 23.304 [3].
This solution has also considered the 5G ProSe remote UE which has not been
authenticated or authorize by the network. This means that the 5G ProSe remote
UE might not have been provisioned with the UE-to-Network Relay discovery
parameters. If those 5G ProSe remote UEs that have not been provisioned with
the UE-to-Network Relay discovery parameters are considered, a specific Relay
service code for the emergency service or an explicit emergency service
indication can be included in the UE-to-Network Relay discovery procedure. If
only 5G ProSe remote UEs that have been provisioned with the UE-to-Network
Relay discovery parameters are considered, a Relay service code for the
emergency service can be provisioned to both 5G ProSe remote UE and 5G ProSe
UE-to-Network Relay UE as specified in clause 5.1.4 of TS 23.304 [3].
NOTE: A specific relay service code for the emergency service can be selected
from the reserved value as specified in TS 24.554 [21].
Editor\'s note: It is FFS whether to support the 5G ProSe remote UEs that have
not been provisioned with the UE-to-Network Relay discovery parameters.
The 5G ProSe communication via 5G ProSe Layer-3 UE-to-Network as specified in
clause 6.5.1 of TS 23.304 [3] is reused with the following modifications:
\- an emergency PDU session is established;
\- the relay UE will not trigger any PDU session modification procedure;
The emergency number can be preconfigured in the UE (ME and UICC) as specified
in TS 22.101 [9]. If the remote UE was registered to the network with its own
5GC and the network has provided the emergency number, the emergency number
may also be valid in the same country of the PLMN from which the emergency
number is received.
The P-CSCF can be preconfigured in the UE or is discovered by DHCP as
specified in TS 23.228 [22]. The P-CSCF is discovered by DHCP as following:
\- The remote performs the DHCP to relay and the relay UE will respond to
remote UE with the address of P-CSCF.
For emergency service via 5G ProSe Layer-3 UE-to-Network relay with N3IWF, the
N3IWF selection is based on clause 6.3.6.4.2 of TS 23.501 [7] and clause
6.5.1.2.2 of TS 23.304 [3].
### 6.46.2 Procedures
#### 6.46.2.1 Procedures via 5G ProSe Layer-3 U2N relay without N3IWF
Figure 6.46.2.1-1 shows the call flow for the emergency service via 5G ProSe
Layer-3 UE-to-Network Relay without N3IWF.
Figure 6.46.2.1-1: Emergency service via 5G ProSe Layer-3 UE-to-Network Relay
without N3IWF
1\. Service authorization and provisioning are performed for the 5G ProSe
Layer-3 UE-to-Network Relay (step 1a) and 5G ProSe Layer-3 Remote UE (step 1b)
as described in clause 6.2 of TS 23.304 [3]. During this procedure, the relay
service code offering the emergency service is provisioned to the remote UE
and relay UE. If those 5G ProSe remote UEs that have not been provisioned with
the UE-to-Network Relay discovery parameters are considered, then step 1b is
skipped.
2\. This step is same as step 2 in clause 6.5.1.1 of TS 23.304 [3]. The PDU
session established may be an emergency PDU session.
3\. The 5G ProSe Layer-3 Remote UE performs discovery of a 5G ProSe Layer-3
UE-to-Network Relay. As part of the discovery procedure, the 5G ProSe Layer-3
Remote UE learns about the emergency service the 5G ProSe Layer-3 UE-to-
Network Relay provides from the relay service code. If those 5G ProSe remote
UEs that have not been provisioned with the UE-to-Network Relay discovery
parameters are considered, then during the procedure, a specific relay service
code for the emergency service or an explicit emergency service indication is
required.
4\. This step is performed based on step 4 in clause 6.5.1.1 of TS 23.304 [3]
with the following modification:
\- Only the IP type PDU Session is supported. the PDU session is an emergency
PDU session.
5\. This step is same as step 5 in clause 6.5.1.1 of TS 23.304 [3]
6\. The remote UE performs the P-CSCF discovery either from the preconfigured
address or using DHCP as specified in TS 23.228 [22].
7\. This step is same as step 7 in clause 6.5.1.1 of TS 23.304 [3].
8\. The remote UE performs the SIP registration as specified in TS 23.167
[23]. In the SIP registration, the access type is set to NG-RAN via 5G ProSe
Layer-3 UE-to-Network Relay.
#### 6.46.2.2 Procedures via 5G ProSe Layer-3 U2N relay with N3IWF
The procedure is same as clause 6.5.1.2 of of TS 23.304 [3] with the following
clarifications:
\- N3IWF selection is performed based on clause 6.3.6.4.2 of TS 23.501 [7] and
clause 6.5.1.2.2 of TS 23.304 [3].
\- If the Remote UE is equipped with a UICC and the Remote UE is located in
the home country, then the Remote UE selects an N3IWF in the HPLMN and
constructs N3IWF FQDN consisting of Operator Identifier of HPLMN;
\- Otherwise the Remote UE constructs N3IWF FQDN based on either the Tracking
Area Identity FQDN or on Operator Identifier FQDN of the 5G ProSe Layer-3 UE-
to-Network Relay node selection information as specified in clause 6.5.1.2.2
of TS 23.304 [3].
When an N3IWF has been selected, the UE initiates an Emergency Registration.
If the Emergency Registration fails, then the Remote UE may select another UE-
to-Network Relay.
### 6.46.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
Remote UE:
\- RSC offering emergency service is provisioned, a specific RSC for emergency
service or an explicit emergency service indication is required for the
discovery procedure;
\- Setting the access type to NG-RAN via 5G ProSe Layer-3 UE-to-Network Relay
to P-CSCF;
UE-to-Network Relay:
\- RSC offering emergency service is provisioned, a specific RSC for emergency
service or an explicit emergency service indication is required for the
discovery procedure;
P-CSCF:
\- new access type.
## 6.47 Solution #47: Emergency call via 5G ProSe UE-to-Network Relay
### 6.47.1 Description
The principle of relaying the Remote UE\'s traffic via 5G ProSe Layer-3 UE-to-
Network Relay is re-used also for emergency calls but there are additional
service requirements that must be met.
The preconditions for emergency call are that the network has indicated
support of emergency call during registration procedure and both the Remote UE
and the 5G ProSe Layer-3 UE-to-Network Relay support emergency call. The 5G
ProSe Layer-3 UE-to-Network Relay forwards its own support of emergency call
to the Remote UE in discovery procedure.
When establishing PC5 link, the Remote UE indicates to the 5G ProSe Layer-3
UE-to-Network Relay that it needs to set up new PDU session over Uu indicating
\"Emergency Request\".
Editor\'s note: This indication could be a new flag in Prose Direct Link
Establishment Request.
Emergency service capability and emergency service request must be indicated
in both directions over the PC5. It is proposed to assign a RSC to identify
emergency service over 5G ProSe Layer-3 UE-to-Network Relay.
If the Remote UE needs emergency service and it detects that no direct
emergency service is not available, it requests emergency service over Layer-3
UE-to-Network Relay. In order to discover 5G ProSe Layer-3 UE-to-Network Relay
that supports emergency RSC, it uses emergency RSC during the 5G ProSe Layer-3
UE-to-Network Relay discovery procedure. Both Model A and Model B discovery
are supported. Based on this, and \"Emergency Request\" indication in the PC5
link establishment, the 5G ProSe Layer-3 UE-to-Network Relay includes
\"Emergency Request\" indication in PDU session establishment as appropriate.
Upon receiving the \"Emergency Request\" indication, the 5G ProSe Layer-3 UE-
to-Network Relay requests for emergency PDU session. This will cause the
emergency call to be routed via the PLMN serving the 5G ProSe Layer-3 UE-to-
Network Relay.
For emergency services, the Remote UE shall prioritise direct connection. The
Remote UE shall request emergency service via UE-to-Network Relay if direct
connection is not possible.
All positioning methods that are applicable on the Remote UE are supported. If
the Remote UE location is not provided, then the network serving the 5G ProSe
UE-to-Network Relay may use the existing legacy positioning procedures to
determine the 5G ProSe UE-to-Network Relay location and use that as the best
estimate of the Remote UE location.
Potential emergency call back is supported via delayed release of the
connection after the emergency call.
### 6.47.2 Procedures
Figure 6.47.2-1 shows the call flow for the 5G ProSe emergency call relayed
via 5G ProSe Layer-3 UE-to-Network Relay.
Figure 6.47.2-1: Emergency call via 5G ProSe Layer-3 UE-to-Network Relay
Procedure for emergency call via 5G ProSe Layer-3 UE-to-Network Relay.
1a. Authorization and provisioning of the Layer-3 5G ProSe Layer-3 UE-to-
Network Relay is done as specified in clause 6.5.1.1 of TS 23.304 [3].
1b. Authorization and provisioning of the Layer-3 Remote UE is done as
specified in clause 6.5.1.1 of TS 23.304 [3].
In steps 1a and 1b, RSC associated with emergency call is provisioned as part
of authorisation and provisioning procedure for those Remote UEs or 5G ProSe
Layer-3 UE-to-Network Relays that are authorised for emergency calls.
2\. Layer-3 5G ProSe Layer-3 UE-to-Network Relay indicates using RSC assigned
for emergency service that emergency calls are available. Remote UE indicates
its emergency request using the same RSC.
For discovery Model A, the announcing UE indicates its support of emergency
service by advertising the associated RSC. Remote UE attempting to discover
suitable 5G ProSe Layer-3 UE-to-Network Relay for emergency service limits its
selection to those candidate 5G ProSe Layer-3 UE-to-Network Relays that
indicate emergency call RSC.
For discovery Model B, the Remote UE includes emergency RSC in its discovery
request to indicate to the 5G ProSe Layer-3 UE-to-Network Relay that the
emergency priority and exceptions apply.
3\. Remote UE includes emergency RSC as the indication for emergency call
request in PC5 connection establishment procedure. 5G ProSe Layer-3 UE-to-
Network Relay determines emergency call based on whether \"Emergency Request\"
is indicated in PC5 connection establishment procedure or not
4\. If Remote UE has indicated \"Emergency Request\" over PC5 in step 3, then
UE-to-Network Relay establishes new emergency PDU session towards the network
with \"Emergency Request\" indication.
NOTE: The PLMN serving the 5G ProSe Layer-3 UE-to-Network Relay routes the
emergency call to local PSAP using the 5G ProSe Layer-3 UE-to-Network Relay
location.
5\. For IP PDU Session Type and IP traffic over PC5 reference point, IPv6
prefix or IPv4 address (including NAT case) is allocated for the 5G ProSe
Layer-3 Remote UE as defined in clause 5.5.1.3 of TS 23.304 [3].
6\. Layer -2 link modification and setting of QoS rules as specified in clause
6.5.1.1 of TS 23.304 [3].
7\. 5G ProSe Layer-3 UE-to-Network Relay sends Remote UE Report as specified
in clause 6.5.1.1 of TS 23.304 [3].
8\. Emergency call via 5G ProSe Layer-3 UE-to-Network Relay. In order to
enable possible emergency call back, the connection is kept for the duration
of a guard timer after the call.
### 6.47.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
Remote UE:
\- Detect emergency support from 5G ProSe Layer-3 UE-to-Network Relay and
indicate \"Emergency Request\" during discovery procedure.
\- Indicating \"Emergency Request\" during PC5 connection establishment
procedure.
5G ProSe Layer-3 UE-to-Network Relay:
\- Indicate emergency call support for the Remote UE during discovery.
\- Set up PDU session with \"Emergency Request\" indication based on Remote
UE\'s request.
\- Delayed connection release after emergency call.
PCF:
\- Provisioning emergency RSC for those UEs that are authorised to use it in
either Remote UE or 5G ProSe Layer-3 UE-to-Network Relay role
## 6.48 Solution #48: Emergency support via 5G ProSe Layer-3 UE-to-Network
Relay
### 6.48.1 Description
This solution addresses KI#7. In particular, it addresses how the 5G ProSe UE-
to Network Relay identifies the emergency services from the Remote UE and vice
versa.
In order to support emergency services from Remote UE, existing procedures for
5G ProSe UE-to-Network Relay Discovery (see clause 6.3.2.3 of TS 23.304 [3])
and 5G ProSe UE-to-Network Relay Communication (see clause 6.5 of TS 23.304
[3]) are applicable with extra enhancements as described in clause 6.48.2.
### 6.48.2 Procedures
Figure 6.48.2-1: Emergency support via 5G ProSe Layer-3 UE-to-Network Relay
Existing procedures as defined in clause 6.5.1 of TS 23.304 [3] is followed
with the below additions:
\- As part of Authorization and Provisioning in Step 1, for 5G ProSe Layer-3
UE-to-Network Relay (1a) and Remote UE (1b), special relay service code(s)
i.e. RSC(s) is (are) provided that is (are) known and reserved to be
associated with emergency service(s). 5G ProSe Layer-3 UE-to-Network Relay or
Remote UE determines the priority associated with the specialised RSC(s) using
the provisioning information that it has stored.
NOTE 1: Whether different types of emergency services are to be defined
associated with different RSCs (or not) is out of the scope of this solution.
In either case, a unique RCS can be associated with a specific emergency
service in both Remote UE and 5G ProSe Layer-3 UE-to-Network Relay.
\- As part of Discovery Procedure in Step 3 (see also clause 6.3.2.3 of TS
23.304 [3]), when Remote UE performs discovery of a 5G ProSe UE-to-Network
Relay for an emergency service, the special RSC associated with that emergency
service is included as part of either announcing message (Model A) or
solicitation message (Model B) to indicate emergency service request or
support.
\- As a part of the connection establishment for unicast mode communication in
step 4, the remote UE indicates the RSC(s) associated with emergency service
to 5G ProSe UE-to-Network Relay for the emergency call.
\- As part of PDU Session establishment or modification in Steps 2, 4, or 6,
5G ProSe UE-to-Network Relay optionally includes a \"Service Indication\"
associated with emergency request from the Remote UE. This can be in addition
to the \"Emergency Request\" as already defined in TS 23.502 [8] enabling the
network to differentiate whether the emergency service is required by the 5G
ProSe Layer-3 UE-to-Network Relay or the Remote UE..
NOTE 2: Regarding \"Service Indication\" associated with emergency request, it
is expected that at least one remote UE emergency service to be concurrently
supported by the 5G ProSe Layer-3 UE-to-Network Relay in addition to the
\"Emergency Request\" from 5G ProSe Layer-3 UE-to-Network Relay for itself.
### 6.48.3 Impacts on services, entities and interfaces
5G ProSe Layer-3 UE-to-Network Relay UE or Remote UE:
\- To be able to interpret RSCs associated with emergency services.
PCF:
\- To be able to provision RSCs associated with emergency services.
AMF/ SMF:
\- Support service indication associated with emergency request from the
Remote UE.
# 7 Overall Evaluation
## 7.1 Key Issue #1: Support of UE-to-UE Relay
For Key Issue #1: \"Support of UE-to-UE Relay\", based on Table 6.0-1, the
solutions can be summarized and evaluated as the following:
\- Sol#1 Alternative 1 proposes to an efficient way of UE-to-UE relay
discovery and selection which is integrated into the unicast link
establishment procedure. The solution proposes to use \"relay_indication\" to
extend the reachability of the Direct Communication Request, thus the source
UE can discovery the target UE(s) via the relays. The proposed method can be
applied in PC5 unicast link establishment procedure. The solution enables
target UE to select relays and source UE to select relay path or direct path,
furthermore it does not require the UEs and relays to maintain their neighbour
lists. Sol#1 Alternative 2 is merged into Sol#10, and is evaluated in Sol#10.
\- Sol#2 proposes a Layer-3 UE-to-UE relay solution based on IP routing. In
the solution, a UE-to-UE relay is responsible for allocating IP addresses to
the UEs connected to it. The solution proposes Model A based relay discovery
that the relay announces itself to its proximity, the UEs need to setup PC5
links to all relays in proximity order to discovery other UEs or be discovered
via DNS queries. The solution proposes hop-by-hop based QoS handling to
achieve E2E QoS requirement, as well as IP encapsulation to handle Non-IP
traffic. The UEs should keep the PC5 link with the Relay UE in order to
discovery other UEs or be discovered. IPSec is used for end-to-end security
protection between source UE and target UE, and this shall be co-ordinated
with SA WG3.
\- Sol#3 is merged into Sol#10, and is evaluated in Sol#10.
\- Sol#4 QoS control for Layer-3 UE-to-UE Relay is merged into Sol#11, and is
evaluated in Sol#11. For Layer-2 UE-to-UE Relay, the E2E QoS parameters are
provided by source UE to the Layer-2 UE-to-UE relay via PC5-S, the Layer-2 UE-
to-UE relay splits the E2E QoS parameters into two parts.
\- Sol#5 is merged into Sol#11, and is evaluated in Sol#11.
\- Sol#6 is merged into Sol#11, and is evaluated in Sol#11.
\- Sol#7 focus on UE-to-UE relay reselection. It proposes that the Source UE
or Target UE can initiate the relay reselection procedure and then the two UEs
can negotiate UE-to-UE Relay reselection using the existing relay connection.
The other solutions for initial relay selection such as Sol#10 and Sol#34
could also be used for UE-to-UE Relay reselection, by requiring re-running of
the Discovery procedure. The radio criteria for Relay reselection is
determined by RAN WG2.
\- Sol#8 proposes PCF based service authorization and policy/parameter
provisioning to UE for UE-to-UE Relay operation and Service Authorization
information related to UE-to-UE Relay operation sent by AMF to NG-RAN.
\- Sol#9 proposes a Layer-3 UE-to-UE Relay sends out a Relay Announcement
message periodically to announce its availability as a UE-to-UE Relay. If the
Relay UE can serve the UE and the UE wants to be discovered by other UEs via
this Relay UE, the UE will send an Announcement message to the Relay UE so
that this UE can be added to the Relay UE\'s target UE list.
\- Sol#10 is a consolidated solution common for both Layer-2 and Layer-3 UE-
to-UE Relay discovery and selection based on Sol#1 alt2 (Model B discovery)
and Sol#3 (Model A discovery). RSC is used in the UE-to-UE Relay discovery to
indicate the connectivity service. After the Model A or Model B discovery,
source UE selects the UE-to-UE Relay and gets the User Info ID and Layer-2 ID
of the target UE. This solution doesn\'t assume the discovery procedure is
followed by communication procedure, thus the UE-to-UE Relay doesn\'t store
info for the communication setup in future.
\- Sol#11 is a consolidated solution to support Layer-3 UE-to-UE Relay
connection setup based on Sol#1, Sol#4, Sol#5, Sol#6. It assumes source UE has
already selected a suitable UE-to-UE Relay and received User Info ID and
Layer-2 ID of the target UE before this procedure. This solution is applicable
for both IP and non-IP traffic. In this procedure, UE-to-UE Relay receives the
target UE\'s L2 ID from source UE and sets up or reuses the link between UE-
to-UE Relay and target UE. The IP addresses of source UE and target UE are
exchanged by PC5 signalling. Source UE provides the E2E QoS parameters to the
Layer-3 UE-to-UE relay, the Layer-3 UE-to-UE relay splits the E2E QoS
parameters into two parts.
\- Sol#12 proposes a solution for Layer-3 UE-to-UE Relay discovery and
communication. For Relay discovery, this solution proposes the Relay UE has
discovered other UEs in proximity and obtained the User Info ID and Layer-2 ID
of Target UE which can be used for subsequent communication procedure. For
Relay communication, the Relay UE sends the DCR message to the Target UE using
the Target UE Layer-2 ID obtained during discovery procedure, and the Relay UE
acts as a DNS server to return IP address of Target UE to the Source UE.
Different from Sol#10 and Sol#11, the UE-to-UE Relay needs to buffer some
parameters during the discovery procedure for subsequent UE-to-UE Relay
communication and discard them if no communication is setup.
\- Sol#13 proposes a Layer-2 UE-to-UE Relay communication solution which
enables a source UE and a target UE to establish an end-to-end (E2E) PC5
unicast communication via the Relay UE. It proposes end-to-end security
association established between a source UE and a target UE. It works with
Model A/B discovery or integrated discovery procedure (UE-to-UE relay
discovery and selection which is integrated into the unicast link
establishment procedure). It supports source UE\'s DCR in both user oriented
L2 link setup request (w/ target User info) and service oriented L2 link setup
request (w/o target User Info). After successful E2E link establishment, it
assumed that adaptation layer will be used for routing messages between source
UE and target UE via Relay UE. E2E security association and adaptation layer
details shall be coordinated with SA3 and RAN WG2, respectively.
The key difference between Solutions #13 and #30 is that solution #13 triggers
the per-hop connection setup based on the E2E DIRECT COMMUNICATION REQUEST
message (steps 2 and 3 of Figure 6.13.2-1), while solution #30 triggers the
per-hop connection setup based on the per-hop DIRECT COMMUNICATION REQUEST
(steps 3a and 3b of Figure 6.30.2.1.2-1) and after the per-hop link is setup
the E2E DIRECT COMMUNICATION REQUEST is sent. In other words, sol#13 proposes
the per-hop links are established during the end-to-end PC5 link establishment
procedure, sol#30 proposes the per-hop links are established before the end-
to-end PC5 link establishment procedure.
\- Sol#30 proposes a procedure for Layer-2 UE-to-UE Relay discovery and
connection establishment. For Model A discovery, source UE selects the UE-to-
UE Relay, for Model B discovery, target UE selects the UE-to-UE Relay. An E2E
PC5 link is establishment by following the per-hop PC5 link establishment or
modification procedure. Per-hop PC5 link sharing is supported and RAN
coordination on this is needed. How to transfer E2E PC5-S messages and E2E
data by the UE-to-UE Relay and E2E QoS handling and splitting the QoS is for
RAN WG2 to determine.
In solution #30, Announcement message or Solicitation response message include
information about the available target UEs.
\- Sol#31 proposes to add authorization of UE using security credential to
share IP address only to authorized UE. Source UE may allow sharing IP address
only to the authorized UE by sharing token. The detail procedure needs to be
coordinated with SA3.
\- Sol#32 proposes a solution for Link Identifier Update procedure when using
UE-to-UE Relay. The Link Identifier Update procedure as defined in clause
6.4.3.2 of TS 23.304 [3] is re-used when the communication is done via a UE-
to-UE Relay, and the procedure is adapted with some changes depending on if
the UE-to-UE Relay is Layer-2 based or Layer-3 based. For Layer-2 based LIU,
it proposes a way that the LIU procedure between the UE and the Relay does not
involving the end-to-end peer UEs for ID privacy. Layer-2 based LIU needs a
coordination with RAN WG2.
\- Sol#33 proposes a solution for Layer-3 UE-to-UE Relay discovery and
communication. For Relay discovery, this solution proposes the Relay UE has
discovered other UEs in proximity and obtained the User Info ID and Layer-2 ID
of Target UE and the Source UE can obtain Layer-2 ID of Target UE during
discovery procedure. For Relay communication, it is proposed an E2E PC5
unicast link is established between Source UE and Target UE via the Layer-2
Relay, and how the PC5-S messages are forwarded is to be defined by RAN WG2.
\- Sol#34 proposes a separation of U2U Relay discovery and U2U Route
discovery. 5G ProSe UE-to-UE Relay discovery messages (both Model A and Model
B) are reused to include the end-to end direct discovery message information
to assist with 5G ProSe U2U UE route discovery. For U2U Relay discovery, it
proposes to reuse U2N Relay discovery and for U2U Route discovery Model A and
Model B discovery are proposed. For Model A discovery, it proposes that relay
UE forwards announcement message from announcing UE with RSC specifying R-UE.
For Model B discovery, similar solution to sol#10 is proposed. It proposes
that PC5 link between Source UE and Relay UE and Target UE and Relay UE are
set up after on U2U Route discovery procedure independent of an E2E connection
setup. It only supports user oriented L2 link setup request from source UE
i.e. DCR with target User info.
## 7.2 Key Issue #2: Support of path switching between two indirect network
communication paths for UE-to-Network Relaying with service continuity
consideration
The clause evaluates the solutions for KI#2 as following.
For triggers and criteria on path switching:
\- Solution #14 and #15 both point out the triggers for relay re-selection as
specified in clause 6.5.3 of TS 23.304 [3] which are based on the measurements
over PC5 link with its serving Relay. Furthermore, Sol#14 gives out detailed
criteria on target relay selection from upper layer perspective based on 5G
ProSe Remote UE traffic handling in clause 6.5.4 of TS 23.304 [3] and the
provisioned ProSe policy as specified in clause 5.1.4.1 of TS 23.304 [3], e.g.
re-evaluate the URSP or the next RSD of the selected URSP for the target relay
selection.
NOTE: The criteria on path switching from RAN perspective needs coordination
with RAN groups.
\- Solution#35 can be considered as application layer method which relies on
the application server provided prioritizations of target relay mode to select
the target relay. The discovery procedure to find and select the target relay
UE after remote UE receives the re-selection rules from application server in
solution#35 is also applicable for the scenarios described in other solutions
where the UE get the re-selection rules by other means, e.g. URSP.
For procedure supporting path switch:
\- Solution #15 covers all the switching cases and provides basic switching
principles on the switching procedure with service continuity consideration.
Following table is a brief summary about the features for the Sol#15.
Table 7.2-1: Features of the Sol#15
+----------------------+----------------------+----------------------+ | Path Switching case | Service continuity | Basic Principles | | | level | | +======================+======================+======================+ | Between L3 relay | Application layer | Commercial IMS | | without N3IWF and L3 | | Services; | | relay with or | | | | without N3IWF or L2 | | Missional Critical | | relay | | Services | +----------------------+----------------------+----------------------+ | Between L3 relay | Session level | Handover procedures | | with N3IWF and L2 | | specified in | | relay or L3 relay | | clause 4.9.2 of | | with N3IWF | | TS 23.502 [8] for | | | | UE mobility between | | | | a 3GPP access and | | | | Untrusted non-3GPP | | | | access | +----------------------+----------------------+----------------------+ | Between L2 relay and | Session level | CM-IDLE or | | L2 relay | | CM-CONNECTED with | | | | RRC_INACTIVE state: | | | | | | | | - Existing mobility | | | | procedure | | | | | | | | CM-CONNECTED state: | | | | | | | | - Xn or N2 handover | | | | procedure | +----------------------+----------------------+----------------------+
\- Solution #36 focuses on the call flow details of path switching between two
indirect Layer-3 UE-to-Network Relay paths using N3IWF. The N3IWF re-uses the
mechanism specified for Local mobility anchor within untrusted non-3GPP access
networks using MOBIKE as specified in clause 6.2.9 of TS 23.501 [7]. It
requires the Remote UE to use the MOBIKE to re-configure its outer IP address
towards the same N3IWF as before, which can be considered as an optional and
optimized solution.
## 7.3 Key Issue #3: Support direct communication path switching between PC5
and Uu (i.e. non-relay case)
For Key Issue #3: \"Support direct communication path switching between PC5
and Uu (i.e. non-relay case)\", based on Table 6.0-1, the solutions can be
summarized and evaluated as the following:
\- Sol#16 proposes provisioning policy based direct communication path
switching between PC5 and Uu. Path switching policy is provided from PCF to
the UE or (pre-)configured in the UE. The path switching policy indicates
which path(s) is allowed for all or specific ProSe services (i.e. direct PC5
allowed, direct Uu allowed or not allowed indicated). Based on the path
switching policy, a UE may establish a PDU session or a PC5 connection in the
target path and switch the traffic from the source path to the target path.
\- Sol#17 proposes to use the make-before-break mechanism to reduce
interruption when path switch between PC5 and Uu paths. The path switch Policy
indicates whether the specific service is allowed to switch from Uu to PC5 or
from PC5 to Uu. The two UEs negotiate to determine which ProSe services are
switched based on the path switching policy. For path switching from PC5 path
to Uu path, the two UEs may negotiate their Uu QoS based on the PC5 QoS in
order to ensure consistent service experience, and may share the IP addresses
used for the Uu path with each other to achieve the switch of service
transmission.
\- Sol#18 uses the principle of \"make before break\". Before performing a
path switch, the two UEs which are connected via PC5 negotiate the triggers
for path switching and what service or QoS flows need to be switched. Once the
negotiated triggers are satisfied, the two UEs perform the path switching
between PC5 to Uu directly.
\- Sol#19 proposes to use a path permission policy, which can be
(pre-)configured in the UE or provided by the PCF. The path permission policy
includes the mapping of ProSe Services to the following path permission:PC5
permitted, or Uu permitted, or both PC5 and Uu permitted.
\- Sol#20 proposes to support the switching back to PC5 path from Uu path by
maintaining the unicast PC5 link after switching to the Uu path and reusing
the unicast PC5 link when switching back to the PC5 path. After switching from
the PC5 path to Uu path it is UE implementation to keep or release the PC5
link.
\- Sol#21 proposes that the existing path selection policy, a modified path
selection policy or a new path switching policy is used to control path switch
between Uu and PC5. During the path switch from PC5 to Uu, PC5 signalling
includes the suggested QoS rules and QoS Flow level QoS parameters for Uu
path.
\- Sol#22 proposes that for path switching from PC5 to Uu, the IP addresses
associated with the UE\'s PDU sessions are exchanged along with the PDU
Session status. PDU session status piggybacked at Keep Alive procedure is used
so that each UE may decide the proper time to initiate path switch to Uu with
peer UE.
## 7.4 Key Issue #4: Support of path switching between direct network
communication path and indirect network communication path for Layer-2 UE-to-
Network Relay with session continuity consideration
For Key Issue #4 \"Support of path switching between direct network
communication path and indirect network communication path for Layer-2 UE-to-
Network Relay with session continuity consideration\", the Solution#23, #24,
#37 and #38 can be summarized and evaluated as the following:
\- Sol#23 proposes Xn based and N2 based HO procedure are applied for inter-
gNB indirect-to-direct and inter-gNB direct-to-indirect path switching. In
this solution, the source gNB determines whether to switch to a direct cell or
a Layer-2 Relay. If the source gNB determines to switch to a Layer-2 Relay,
the source gNB selects the target Layer-2 Relay for Layer-2 Remote UE taking
the authorized PLMN list for Layer-2 Remote UE into account. Which gNB (source
or target) gNB selects a target Layer-2 Relay or direct Uu route depends upon
RAN2 conclusion.
\- Sol#24 proposes that for Layer-2 Remote UE in CM-CONNECTED state, the Xn
based inter NG-RAN handover as specified in clause 4.9.1.2 of TS 23.502 [8] or
the Inter NG-RAN node N2 based handover specified in clause 4.9.1.3 of TS
23.502 [8] are reused to support session continuity. For Layer-2 Remote UE in
CM-IDLE or CM-CONNECTED with RRC_INACTIVE state, it is proposed UE performs
the mobility procedures as defined in TS 23.502 [8] based on Relay
(re)selection procedures.
\- Sol#37 proposes to address the scenario where a Layer-2 Relay that has one
or more Layer-2 Remote UE(s) having an active indirect connection via this
relay and the network determines that the Layer-2 Relay needs to handover, and
mobility restriction is considered in this procedure.
\- Sol#38 focuses on the path switching procedure from direct network
communication to indirect network communication, and it is proposed Layer-2
Remote UE sends HO request to Source gNB, to assist source gNB to perform HO.
This solution doesn\'t address the path switching from indirect connection to
direct connection.
## 7.5 Key Issue #5: Support of multi-path transmission for UE-to-Network
Relay
The Key Issue #5 covers two aspects:
\- Aspect #1: Whether and how Policy authorization is used for path selection
between direct Uu and indirect path via Layer 2/3 U2N Relay UE: Transmitting
some service data flow via U2N Relay path if available with policy guidance.
\- Aspect#2: Whether and how to enhance the existing procedures to support
Multi-path Transmission: Transmitting service data flow simultaneously via
direct Uu path and U2N Relay path.
For Aspect #1, there is are two solutions:
\- Sol #25 mainly addresses policy aspects and is applicable for both Layer 2
and layer 3 U2N Relay. It proposes to enhance the URSP to allow the UE to be
able to re-evaluate the URSP rule to determine to use direct Uu path, indirect
Uu path via U2N Relay or both paths based on the availability of U2N Relay
path.
\- Sol #29 focuses on the policy and authorization for Multi-path Transmission
via Layer-3 UE-to-Network Relay without N3IWF. It proposes to use the similar
mechanism as Rel-17 ProSe to enhance URSP with the RSD including a new item
\"Multi-Path ProSe Layer-3 UE-to-Network Relay Offload indication\" alongside
the existing \"ProSe Layer-3 UE-to-Network Relay Offload\" and keeping them
separate.
For Aspect #1, on policy authorization aspect, Sol #25 can be used for all
solutions addressing Layer 3 U2N Relay without N3IWF and Layer 2 U2N Relay.
Sol #29 can also be used for Layer 3 U2N Relay without N3IWF case.
For Aspect #2, there are following solutions:
\- Sol #26 addresses Layer 2 U2N Relay aspect and mainly focuses on the high
level description of multiple path transmission, which has significant RAN
dependency.
\- Sol #27 addresses Layer 3 U2N Relay without N3IWF aspect and reuses
existing ProSe Policy and URSP design. Remote UE determination of the
Multipath establishment is based on the ProSe policy. After legacy URSP
evaluation, if the first path is Layer-3 relay without N3IWF, when to
establish the Uu path, the Remote UE initiates the PDU Session establishment
via direct Uu path based on the PDU session parameters associated to the RSC
in ProSe Policy. If the first path is direct Uu path and there is
corresponding ProSe policy configured for Layer-3 relay without N3IWF, the
Remote UE uses the configured ProSe policy for Layer 3 U2N Relay UE discovery,
selection and relay connection establishment. It requires the Remote UE to
establish PDU Session via direct Uu path by evaluating ProSe Policy. The
solution also describes how the PDU sessions over the direct and indirect
paths are correlated in the core network so that UPF forwarding tunnels can be
established to transfer data to and from the AF/UE using either of the
available paths. This solution is transparent to the AF and does not require
ATSSS.
\- Sol #28 addresses both Layer 2 U2N Relay case and Layer 3 U2N Relay
with/without N3IWF cases. For Layer 3 U2N Relay with N3WIF case, it relies on
MA PDU session support (defined by ATSSS feature) in 5GS. For Layer 3 U2N
Relay without N3IWF case, it relies on Application layer\'s decision on when
to set up the multi-path connectivity and how to aggregate/split the traffic
on both paths. For layer 2 U2N Relay, it provides some high level description
on how to support multi-path transmission, which relies on work in RAN WGs.
\- Sol #39 and Sol #40 address how to support multi-path transmission for
Layer 2 U2N Relay case, they propose to use URLLC like mechanism under a
single NG-RAN node for redundant transmission. Sol #40 relies on MR-DC
transmission under one single NG-RAN node, while Sol #39 relies on dual PDU
Sessions transmission under one single NG-RAN node.
\- Solution #41 meets the requirement of end-to-end redundant communication by
supporting redundancy handling at a single NG-RAN node when receiving the path
identifications from 5GC, in the case of Layer 3 U2N Relay with/without N3IWF.
Its method has RAN impact then confirmation and decision from RAN group is
needed. AS a comparison Sol #39 and 40 support redundancy handling at a single
NG-RAN node using URLLC like mechanism in the case of Layer 2 U2N Relay. For
case of Layer 3 U2N Relay with N3IWF case, Sol #41 propose to use ATSSS
feature which is similar with what Sol #28 proposed, with the difference that
Sol #41 focus on redundancy communication using the feature defined in R18
ATSSS_Ph3.
For multi-path transmission via Layer 2 U2N Relay:
\- for MR-DC based mechanism (e.g. Sol#26, Sol #40), it mainly relies on work
in RAN WGs to support multi-path transmission via Layer 2 U2N Relay UE, with
the difference being that Sol#26 has no normative work is required for SA2,
whereas Sol#40 does;
\- for dual PDU Session based mechanism (i.e. Sol #39), from SA2 aspect, the
enhancement may be on policy authorization for multi-path transmission (i.e.
proposed in Sol#25), it would also require work in RAN WGs.
For multi-path transmission via Layer 3 U2N Relay without N3IWF, it can be
achieved via application layer as proposed in Sol #28 and Sol #41.
## 7.6 Key Issue #6: Support of PC5 Service Authorization and Policy/Parameter
Provisioning
For Key Issue #6: \"Support of PC5 Service Authorization and Policy/Parameter
Provisioning\", the solutions can be summarized and evaluated as the
following:
\- Sol#8 addresses the service authorization and policy/parameter provisioning
for UE-to-UE Relay, and it is evaluated under clause 7.1.
\- Sol#16 addresses the service authorization and policy/parameter
provisioning for direct path switching between PC5 and Uu, and it is evaluated
under clause 7.3.
\- Sol#25 addresses the service authorization and policy/parameter
provisioning for multi-path for UE-to-Network Relay, and it is evaluated under
clause 7.5.
\- Sol#14 and Sol#15 address the service authorization and policy/parameter
provisioning for path switching between two indirect network communication
paths, and they are evaluated under clause 7.2.
## 7.7 Key Issue #7: Support of Emergency for UE-to-Network Relaying
There are following solutions addressing KI#7:
\- Sol#42, Sol#43, Sol#44, Sol#45, Sol#46, Sol#47, Sol#48.
According to the SA WG1 response (S2-2205433/S1-221222), a general requirement
is that 5G ProSe UE-to-Network Relay UE has normal registration and UE in
limited-service state shall not act as Relay.
For Layer-2 Remote UE, it can be in limited-service state and such Remote UE
may initiate emergency service based on the local regulation and operator
policy.
Below are the other aspects that are required to support 5G ProSe UE-to-
Network Remote UE\'s emergency service.
\- Aspect#1 Whether the solution addresses Layer-2 UE-to-Network Relay, or
Layer-3 UE-to-Network Relay, or both?
\- Aspect#2 How the Relay announces emergency support?
\- Aspect#3 How the Remote UE becomes aware of Relay\'s emergency support?
\- Aspect#4 How the Remote UE initiates emergency request?
\- Aspect#5 Whether L2/L3 Relay informs NW of emergency or, of no emergency
(i.e. emergency completed)
\- Aspect#6 Emergency call back is addressed?
\- Aspect#7 How L3 Remote UE obtain P-CSCF address?
\- Aspect#8 How Remote UE obtains Emergency number?
\- Aspect#9 How to obtain Remote UE\'s position?
\- Aspect#10 How to handle the emergency service conflict between Remote UE
and Relay UE for L3 relay?
Table 7.7-1 below is a comparison of different solutions based on the aspects
above.
Table 7.7-1: Summary of Aspect#1\~Aspect#9 addressed solutions (RM=Remote UE,
RL= Relay UE, EMG=Emergency)
Solns #1 L2, L3, or both #2 RL announce EMG support #3 RM aware RL\'s EMG
support #4 RM initiate EMG. request #5 L2/L3 Relay inform NW of EMG/noEMG #6
EMG callback #7 P-CSCF addr from RL to RM (L3) #8 EMG number from RL to RM #9
Positioning of RM
* * *
Sol #42 Both RSC if EMG supported by NW RSC RSC L2: Yes Yes  
Sol #43 Both RSC if EMG Relay service is authorized RSC RSC or new est. cause
Yes Sol #44 L3 RSC New ind Yes Yes (optional) Yes Sol#45 Both RSC RSC RSC L2:
Yes  
Sol#46 L3 RSC/new ind Yes, RM UE use DHCP, new access type in P-CSCF
Preconfigured  
Sol#47 L3 RSC Emergency indicator RSC/new ind Yes Yes Yes (all positioning
methods + fallback to Relay UE location if nothing else available) Sol#48 L3
RSC RSC RSC L3: Yes, optional service indication to distinguish EMG is for RM
or RL
Aspect#1 Whether the solution addresses Layer-2 UE-to-Network Relay, or
Layer-3 UE-to-Network Relay, or both?
Sol#42, Sol#43 and Sol#45 address both L2 and L3 UE-to-Network relaying.
Sol#44, Sol#46, Sol#47 and Sol#48 address L3 UE-to-Network relaying.
Aspect#2 How the Relay announces emergency support?
All the solutions propose that the Relay UE use dedicated RSC to announce
support of emergency service from Remote UE.
In Sol#42, the Relay UE\'s serving PLMN will have some control, i.e. a 5G
ProSe UE-to-Network relay announces emergency support if the dedicated RSC for
emergency has been provisioned in the Relay UE and the Emergency Services
Support indication from AMF has been received in the Registration Accept
message.
Sol#43 highlights that support for relaying emergency services is to be
treated differently from a normal U2N Relay. Since the Relay UE is responsible
for the Remote UE\'s emergency session, the authorization for relaying
emergency services is granted when the UE indicates its capability to support
relayed emergency sessions. Not all UEs authorized to act as a ProSe U2N Relay
are authorized for emergency services.
Aspect#3 How the Remote UE becomes aware of Relay\'s emergency support?
All the solutions propose to use RSC dedicated for emergency service.
Aspect#4 How the Remote UE initiates emergency request?
All the solutions propose to use RSC dedicated for emergency service.
Sol#43 also propose to use of Direct Communication Request enhanced with a new
cause value indicating \"emergency services over U2N Relay\".
To simplify the solution, the dedicated RSC approach is recommended.
Aspect#5 Whether L2 or L3 Relay informs NW of emergency or of no emergency?
For L3 relaying, the L3 Relay will use emergency PDU Session for the Remote
UE\'s emergency service.
For L2 relaying, currently Sol#42 proposes that L2 Relay UE informs its
network of emergency service from Remote UE. Sol#45 (updated in S2-2208582 in
this meeting) proposes that NG-RAN informs the L2 relay UE\'s network of
emergency service from Remote UE. This is to ensure the prioritized handling
of the emergency service from the L2 Remote UE, the L2 Relay UE needs to get
prioritized handling in its AMF to avoid being exempted from congestion
control.
For L3 relaying, Sol#48 proposes that the L3 Relay optionally includes a
\"Service Indication\" associated with emergency request from the Remote UE to
distinguish between emergency service for Remote UE and Relay UE.
Aspect#6 Emergency call back is addressed?
Emergency call back is addressed in Sol#42.
NOTE: Call back to Remote UE that does not have SIM/USIM/ISIM is not required.
Aspect#7 How L3 Remote UE obtains P-CSCF address?
Sol#44 proposes that L3 Relay UE provide P-CSCF address to the Remote UE.
Sol#46 proposes that the Remote UE uses DHCP to obtain the P-CSCF address.
The DHCP mechanism specified in TS 24.379 [26] L3 for Remote UE can be reused
if the L3 Remote UE does not have pre-configured P-CSCF address.
Aspect#8 How Remote UE obtain Emergency number?
Sol#44 propose that L3 Relay UE optionally provide emergency number to the
Remote UE.
Sol#46 clarifies that the emergency number may be preconfigured or provided by
the network when a UE (currently acting as Remote UE) previously registered in
the network.
Emergency number is local, therefore the preconfigured approach in Sol#46 may
not work in all cases. If the pre-configuration does not work, the Relay UE
will be required to send local emergency number to the Remote UE.
Aspect#9 How to obtain Remote UE\'s position?
Sol#43 (for L2 and L3) proposes to use either UE Provided Location Information
or Network provided Location Information to get the UE location during an
emergency call.
Sol#44 (for L3) proposes that the Remote UE provide physical address
information and/or location information according to the request from 5G ProSe
layer-3 UE-to-Network Relay, however, it is not clear how the Relay UE
provides the location information to network.
Sol#47 (for L3) contains description \"The principle of routing the emergency
call via the PLMN serving the 5G ProSe Layer-3 UE-to-Network Relay implies
that the 5G ProSe Layer-3 UE-to-Network Relay location is used for emergency
call location purposes\".
The existing positioning function for emergency (e.g. TS 23.167 [23]) is
assumed to be reused. If no other Remote UE location estimate is provided,
then the default use of the Relay UE location as the Remote UE location
estimate applies on all candidate solutions.
Aspect#10 How to handle the emergency service conflict between Remote UE and
Relay UE for L3 relay?
Editor\'s note: The following content, if agreed during the meeting, will be
included.
Sol#45 (updated in S2-2208582 in this meeting) proposes that the L3 relay UE
is allowed to establish 2 emergency PDU sessions, among them, one is for
relaying Remote UE emergency services, another is for Relay UE its own
emergency services.
Sol#42 (updated in S2-2208360 in this meeting) proposes that L3 the relay UE
terminate the remote UE\'s emergency service and establish its own emergency
PDU session for its own emergency service or it is allowed that one emergency
PDU session can be shared with L3 Remote UE and L3 Relay UE at same time.
# 8 Conclusions
## 8.1 Key Issue #1: Support of UE-to-UE Relay
For Key Issue #1 (Support of UE-to-UE Relay), the followings are taken as
conclusions:
The following conclusions are common for both Layer-3 UE-to-UE Relay and
Layer-2 UE-to-UE Relay:
\- For UE-to-UE Relay discovery, both Model A and Model B discovery are
supported.
\- Discovery integrated into PC5 unicast link establishment procedure is
supported. Sol#1 Alt1 is used as basis for normative phase.
\- The 5G ProSe UE-to-UE Relay discovery message contains two sets of
elements, i.e. direct discovery set(s) and a U2U discovery set.
\- The direct discovery set of elements can be part of the contents of 5G
ProSe Direct Discovery message as defined in Rel-17. This includes for example
the User Info ID of Source UE and Target UE.
\- The U2U discovery set contains the information to support the discovery of
the UE-to-UE relay and extensions of the direct discovery. This includes for
example Type of Discovery Message, RSC, User Info ID of the relay, etc.
\- 5G ProSe UE-to-UE relay only modifies the U2U set of the elements, and
forwards the end-to-end elements during the discovery procedures.
NOTE 1: SA WG3 will determine whether there are security requirements and the
protection scheme for the direct discovery set of elements between Source UE
and Target UE.
\- The following parameters are used for UE-to-UE Relay discovery:
\- For UE-to-UE Relay Model A discovery, the Type of Discovery Message, User
Info ID of the UE-to-UE Relay, RSC, list of User Info ID of Target UE are
contained in the Announcement message.
\- For UE-to-UE Relay Model B discovery between Source UE and UE-to-UE Relay,
the Type of Discovery Message, User Info ID of Source UE, RSC, and User Info
ID of Target UE are contained in the Solicitation message, and the Type of
Discovery Message, User Info ID of UE-to-UE Relay, RSC, and User Info ID of
Target UE are contained in the Response message.
\- For UE-to-UE Relay Model B discovery between UE-to-UE Relay and Target UE,
the Type of Discovery Message, User Info ID of Source UE, User Info ID of UE-
to-UE Relay, RSC, and User Info ID of Target UE are contained in the
Solicitation message, and the Type of Discovery Message, RSC, User Info ID of
Source UE, and User Info ID and Layer-2 ID of Target UE are contained in the
Response message.
NOTE 2: Whether UE-to-UE Relay provides Layer-2 ID of Target UE in the
discovery messages to Source UE can align with the decision of RAN WGs during
normative work.
NOTE 3: Whether and how a Source UE and a Target UE indicate support of UE-to-
UE Relay operation will be determined in normative phase.
\- For UE-to-UE Relay selection, the Source UE performs the UE-to-UE Relay
selection for both Model A and Model B discovery. For Model B discovery, a
Target UE may choose to respond or not to a UE-to-UE Relay, for example, based
on the PC5 signal strength of each message received.
\- For service authorization and policy/parameter provisioning for UE-to-UE
Relay operation, the PCF based service authorization and provisioning as
defined in TS 23.304 [3] is used as basis for normative work.
\- The policy/parameters per ProSe service includes Relay Service Code(s) and
UE-to-UE Relay Layer indicator(s); a UE-to-UE Relay Layer Indicator per RSC
that indicates whether the RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-
UE Relay service.
\- The Target UE performs the UE-to-UE Relay selection if the UE-to-UE relay
discovery is integrated into PC5 unicast link establishment procedure, i.e.
upon receiving a Direct Communication Request from the Source UE via one or
more UE-to-UE Relay UEs.
\- For UE-to-UE Relay reselection, the negotiated UE-to-UE Relay reselection
between Source UE and Target UE in Sol#7 and the UE-to-UE Relay selection
procedure in Sol#10 can be used under different conditions.
NOTE 4: UE-to-UE Relay selection/reselection requires cooperation with RAN WGs
during normative work.
\- IP, Ethernet and Unstructured traffic types are supported.
NOTE 5: Ethernet and Unstructured traffic types can be encapsulated in IP
traffic type if supported by source and target UE.
\- In the case of one Source UE communicates with multiple Target UEs, the PC5
link between Source UE and UE-to-UE Relay can be shared for multiple Target
UEs per RSC while the PC5 links may be established individually between UE-to-
UE Relay and Target UEs per RSC. For the shared PC5 link, the Layer-2 link
modification procedure can be used.
\- In the case of multiple Source UEs communicate with one Target UE, the PC5
link between UE-to-UE Relay and Target UE can be shared per RSC while the PC5
links may be established individually between Source UEs and UE-to-UE Relay
per RSC. For the shared PC5 link, the Layer-2 link modification procedure can
be used.
NOTE 6: If source UE or target UE has multiple application layer IDs (user
info), it would be treated as different UEs per application layer ID and
separate PC5 link between UE (source UE or target UE) and Relay UE shall be
setup. This will be confirmed by RAN WGs during normative phase.
\- For UE-to-UE Relay Per-hop links setup (i.e. PC5 link establishment between
Source UE and UE-to-UE Relay, as well as between UE-to-UE Relay and Target
UE), Source UE initiates the PC5 link setup with UE-to-UE Relay (first hop),
and UE-to-UE Relay initiates the PC5 link setup with the target UE (second
hop). Sol#11 is used as basis for normative work.
\- The Layer-2 link establishment procedure as defined in clause 6.4.3.1 of TS
23.304 [3] is reused for per-hop link establishment for UE-to-UE Relay with
the following clarifications:
\- UE-to-UE Relay initiates the second hop PC5 link establishment after the
Security Establishment procedure is completed at the first hop.
\- UE-to-UE Relay sends the Direct Communication Accept message to Source UE
after the second hop PC5 link establishment is completed (i.e. UE-to-UE Relay
has received Direct Communication Accept message from Target UE).
\- The IP address allocation procedure as defined in clause 6.4.3.1 of TS
23.304 [3] is reused on each hop for UE-to-UE Relay.
\- The Source UE and Target UE may obtain the IP address of each other using
DNS. The Source UE may obtain the IP address of a Target UE from the UE-to-UE
Relay in the Direct Communication Accept message (if included).
\- For the first hop PC5 link establishment:
\- The Source UE sends a Direct Communication Request message including User
Info ID of Source UE, User Info ID of UE-to-UE Relay, User Info ID and Layer-2
ID of Target UE, RSC and Security Information to UE-to-UE Relay.
\- For Layer-3 UE-to-UE Relaying after the security protection is enabled the
Source UE sends IP Address Configuration or Link-Local IPv6 address, QoS Info
(PFI and PC5 QoS parameters) to UE-to-UE Relay.
\- The UE-to-UE Relay sends a Direct Communication Accept message to the
Source UE including User Info ID of Source UE, User Info ID of UE-to-UE Relay,
User Info ID of Target UE and RSC.
\- For Layer-3 UE-to-UE Relaying the Layer-3 UE-to-UE Relay also includes the
IP address of the Target UE (optional), QoS Info (PFI and split PC5 QoS
parameters), and IP Address Configuration or Link-Local IPv6 address in the
Direct Communication Accept.
\- For the second hop PC5 link establishment:
\- The UE-to-UE Relay sends Direct Communication Request message including
User Info ID of Source UE, User Info ID of UE-to-UE Relay, User Info ID of
Target UE, RSC and Security Information to the Target UE.
\- For Layer-3 UE-to-UE Relaying after the security protection is enabled, the
Layer-3 UE-to-UE Relay sends IP Address Configuration or Link-Local IPv6
address, and QoS Info (PFI and split PC5 QoS parameters) to the Target UE.
\- The Target UE sends Direct Communication Accept message to the UE-to-UE
Relay including User Info ID of Source UE, User Info ID of UE-to-UE Relay,
User Info ID of Target UE and RSC.
\- For Layer-3 UE-to-UE Relaying the Target UE also includes QoS Info (PFI and
split PC5 QoS parameters), and IP Address Configuration or Link-Local IPv6
address in the Direct Communication Accept message.
The following conclusions are specific for Layer-3 UE-to-UE Relay:
NOTE 7: Evaluation of any solution to authorize the sharing of IP address
information of Source UE and Target UE depends on SA WG3.
\- The Link Identifier Update (LIU) procedure, Sol#32 (clause 6.32.3) is used
as basis for normative work.
\- For QoS control of Layer-3 UE-to-UE Relay, the UE-to-UE Relay receives E2E
QoS from Source UE and determines the per-hop QoS parameters to satisfy the
E2E QoS. Sol#4 (clause 6.4.2) is used as basis for normative work.
The following conclusions are specific for Layer-2 UE-to-UE Relay:
\- Per-hop links (i.e. PC5 link between Source UE and UE-to-UE Relay, as well
as between UE-to-UE Relay and Target UE) needs to be established before E2E
PC5 link establishment is performed. Sol#30 (clause 6.30.2.2) is used as basis
for normative work.
NOTE 8: How the E2E PC5-S messages are forwarded by the UE-to-UE Relay is to
be determined by RAN WGs.
NOTE 9: For Layer-2 UE-to-UE Relay, RAN WGs will define how the E2E QoS will
be handled and split over the PC5 links.
## 8.2 Key Issue #2: Support of path switching between two indirect network
communication paths for UE-to-Network Relaying with service continuity
consideration
For Key Issue #2: Support of path switching between two indirect network
communication paths for UE-to-Network Relaying with service continuity
consideration, the followings are taken as conclusions:
\- For the triggers and criteria for path switching, the following principles
are adopted in normative work:
\- The Remote UE can path switch when the NG-RAN configured measurement
thresholds and the criteria are satisfied or based on re-selection rules from
application layer if any.
\- If multiple UE-to-Network Relay UEs satisfy the Relay re-selection
criteria, the Remote UE selects the target UE-to-Network Relay for path switch
based on the 5G ProSe Policy in clause 6.5.4 of TS 23.304 [3] or URSP rules
and the Remote UE traffic handling described in clause 6.5.4 of TS 23.304 [3]
with following considerations:
\- The Remote UE first selects a Target relay UE which has same type as
original relay UE, if this fails, then the Remote UE re-evaluates the URSP or
keeps evaluating the next RSD of the selected URSP for Target Relay selection.
\- The Remote UE may use re-selection rules from the application layer (e.g.
provided by an application server), the Remote UE may discover that there are
multiple UE-to-Network Relay UEs that satisfy the re-selection rules and then
selects the target UE-to-Network Relay UE based on priority in the re-
selection rules from the application layer.
\- URSP rules take higher priority than the re-selection rules from the
application layer.
NOTE 1: The measurement trigger criteria for path switch between two indirect
network communication paths will be defined by RAN WGs.
NOTE 2: SA WG2 will not define the re-selection rules from application layer
and how they are provided to the UE.
\- To supporting path switch with service continuity, solution#15 is taken as
baseline for normative work.
NOTE 3: The mechanisms supporting path switching by application layer for
service continuity are left to application layer implementation and normative
work is not needed.
NOTE 4: Handover procedures for path switch between Layer-2 UE-to-Network
Relay indirect communication paths require coordination with RAN WGs.
\- For switching case between two indirect Layer-3 UE-to-Network Relay paths
using N3IWF, solution#36 using MOBIKE is selected as basis for normative work.
## 8.3 Key Issue #3: Support direct communication path switching between PC5
and Uu (i.e. non-relay case)
For Key Issue #3 (Support direct communication path switching between PC5 and
Uu (i.e. non-relay case)), the followings are taken as conclusion:
\- A Path switching policy is used that indicates which path(s) is permitted
for all or specific ProSe services (i.e. PC5 permitted, or Uu permitted, or
both PC5 and Uu permitted).
NOTE 1: Whether the path switching policy can be combined into the path
selection policy as defined in TS 23.304 [3] will be determined in normative
phase.
\- The path switch policy can be (pre)configured in the UE or provided by the
PCF.
\- The granularity of path switch is per ProSe service.
\- UEs negotiate over the existing PC5 connection to determine whether and
which ProSe services are to be switched taking into account e.g. their path
switching policy, availability of Uu path etc. by the Source UE requesting
switch for specific services and the Target UE confirming which services can
be switched or not.
\- For the path switching from the a PC5 path to a Uu path, one of the UEs may
notify the peer UE of being not able to perform the path switching (e.g. under
congestion control or mobility restriction) or having no willing to perform
the path switching to avoid the peer UE performing the path switching.
\- For the path switching from a Uu path to a PC5 path, in order to discover
each other during PC5 discovery or during Layer-2 link establishment
procedure, user info may be provided by the application layer before switching
to PC5 path.
\- A make-before-break mechanism is used when path switching between PC5 and
Uu, i.e. when path switching occurs the UEs prepare the target path to
communicate with each other, then performing the path switching from the PC5
path to Uu path and vice versa and communicate over that target path, and at
which point for former path may be released.
NOTE 2: If UEs maintain a PC5 unicast link after path switching from a PC5
path to a Uu path, the UEs can determine to switch back to the PC5 path from
the Uu path based on e.g. the policy related to path switching, the PC5 signal
level of the maintained unicast link.
\- For the path switching from the PC5 path to Uu path, the Uu QoS each UE
will request from their network using the existing 5GS mechanism is based on
PC5 QoS and negotiated via the existing PC5 connection between two UEs.
\- For the path switching from the PC5 path to Uu path, optionally the IP
addresses used for Uu path can be shared between the UEs as assist them to
establish communication directly with each other via the Uu path.
## 8.4 Key Issue #4: Support of path switching between direct network
communication path and indirect network communication path for Layer-2 UE-to-
Network Relay with session continuity consideration
For Key Issue #4 \"Support of path switching between direct network
communication path and indirect network communication path for Layer-2 UE-to-
Network Relay with session continuity consideration\", the followings are
taken as conclusions:
\- Xn based (as defined in clause 4.9.1.2 of TS 23.502 [8]) and N2 based (as
defined in clause 4.9.1.3 of TS 23.502 [8]) HO procedure is applied for inter-
gNB indirect-to-direct and inter-gNB direct-to-indirect path switching for
Layer-2 Remote UE in CM-CONNECTED state.
NOTE: Path switching between direct path and indirect path for Layer-2 Relay
(e.g. whether the source or target gNB selects a target Relay UE or direct Uu
route, and whether and what information to be taken into account by NG-RAN for
path switching) will be defined by RAN WGs and alignment work (if any) can be
made by SA2 based on RAN WGs conclusions in normative phase.
## 8.5 Key Issue #5: Support of multi-path transmission for UE-to-Network
Relay
For Key Issue #5 \"Support of multi-path transmission for UE-to-Network
Relay\", the followings are taken as conclusions:
\- Policy authorization for multi-path transmission via direct Uu path and
Layer 3 U2N Relay UE with and without N3IWF via URSP is needed.
\- To support multi-path transmission via direct Uu path and Layer 3 U2N Relay
UE without N3IWF, the RSD is extended with additional components to indicate
multipath transmission via Layer 3 U2N Relay UE without N3IWF and Uu.
NOTE 1: For policy authorization for multi-path transmission via direct Uu
path and Layer 3 U2N Relay UE with N3IWF, whether the current Access Type
preference in URSP needs to be updated will be decided in normative phase..
\- Multi-path transmission via direct Uu path and Layer 3 U2N Relay UE with
N3IWF can rely on MA-PDU Session (introduced in clause 5.32 of TS 23.501 [7])
as described in Sol #28 and Sol #41, no system enhancement is required; in
normative phase, how to use the MA PDU Session to support multi-path
transmission via direct Uu path and Layer 3 U2N Relay UE with N3IWF will be
described for information (e.g. as described in Sol #28 and Sol #41).
NOTE 2: The conclusions of support of redundant traffic steering in Rel-18
FS_ATSSS_Ph3 study item can be applied to MA PDU Session for multi-path
transmission over direct Uu and Layer-3 UE-to-Network Relay with N3IWF.
\- For multi-path transmission via direct Uu path and Layer 2 U2N Relay UE:
\- Multi-path transmission via direct Uu path and Layer 2 U2N Relay will be
defined by RAN WGs and alignment work can be made by SA WG2 based on the
progress and outcome in RAN WGs.
\- The NG-RAN receives the authorization information indicating whether a UE
is authorized to perform multi-path transmission via direct Uu path and Layer
2 U2N Relay from the AMF. The authorization information is determined by the
AMF based on the related UE\'s 5G ProSe Capability (i.e. the UE supports 5G
ProSe Layer-2 Remote UE defined in Rel-17) and the ProSe Service Authorisation
included in the subscription data received from UDM.
## 8.6 Key Issue #6: Support of PC5 Service Authorization and Policy/Parameter
Provisioning
For Key Issue #6 \"Support of PC5 Service Authorization and Policy/Parameter
Provisioning\", the followings are taken as conclusions:
\- The mechanism and procedure defined in clause 5.1 of TS 23.304 [3] is used
for ProSe policy/parameters provisioning for the enhancements in Rel-18.
NOTE 1: Backward compatibility with Rel-17 shall be considered when concluding
this key issue for Rel-18 ProSe.
\- For service authorization and policy/parameters for UE-to-UE Relay
operation provided to the UE and NG-RAN, Sol#8 is selected as basis for
normative work.
NOTE 2: Whether and which bullets (as described in clause 6.8.2.5) need to be
included in the \"5G ProSe authorised\" information sent from AMF to NG-RAN
can be determined in normative phase based on RAN WGs feedback.
\- For service authorization and policy/parameters for path switching between
two indirect network communication paths, it is concluded under clause 8.2.
\- For service authorization and policy/parameters for direct path switching
between PC5 and Uu, it is concluded under clause 8.3.
\- For service authorization and policy/parameters for multi-path for UE-to-
Network Relay, it is concluded under clause 8.5.
## 8.7 Key Issue #7: Support of Emergency for UE-to-Network Relaying
For Key Issue #7: Support of Emergency for UE-to-Network Relaying, the
following are concluded.
The following conclusions are common to Layer-2 and Layer-3 UE-to-Network
Relaying:
\- For emergency service, the UE shall prioritise direct connection to
network. If direct connection is not possible (including the case that the RAN
broadcast SIB indicates no emergency support), the UE shall attempt to obtain
emergency service via UE-to-Network Relay.
\- A 5G ProSe enabled UE acting as Relay shall have a normal registration
(including also normal registration for a 5G ProSe Relay enabled UE in Non-
Allowed Area). A 5G ProSe Relay enabled UE in limited-service state shall not
act as Relay. Mobility Restrictions that are overruled for UE requesting
direct emergency service are overruled also for 5G ProSe UE-to-Network Relay
that is relaying emergency service.
\- A 5G ProSe enabled UE without direct connection to the network for
emergency service may request emergency service via the 5G ProSe Relay.
\- RSC(s) dedicated for emergency service needs to be provisioned in the 5G
ProSe enabled UEs with capability of Relay UE and Remote UE using procedure as
specified in clause 5.1.4 of TS 23.304 [3]. The dedicated RSC(s) are used by
the 5G ProSe UE-to-Network Relay UE and Remote UE during discovery and PC5
link establishment.
\- A dedicated PC5 link associated with an emergency RSC is only used for
emergency service. A 5G ProSe enabled UE shall not advertise its support for
relaying emergency service unless the serving network has provided an
indication of support of relaying of emergency service.
NOTE 1: Whether a 5G ProSe Layer-2 UE-to-Network Relay needs the indication of
support of relaying emergency services from its serving PLMN before
advertising its support of relaying emergency services is to be determined in
normative phase.
\- If the 5G ProSe Relay needs to establish RRC Connection when the 5G ProSe
Remote UE has requested emergency service over PC5, the 5G ProSe Relay shall
use \"Emergency\" RRC Establishment Cause.
\- Emergency call back for 5G ProSe UE-to-Network Remote UE regulatory
requirements will be supported using existing functionality defined for
Emergency Services.
\- The existing positioning function are reused for the 5G ProSe Remote UE. If
no other information is available, the location of the 5G ProSe UE-to-Network
Relay can be used as Remote UE location estimate.
NOTE 2: Whether and how PC5 security is used for emergency services is to be
determined in the normative phase as part of SA3 alignment.
The following conclusions apply to Layer-2 UE-to-Network Relaying:
\- For a 5G ProSe Layer-2 UE-to-Network Relay to advertise its support of
emergency service, the serving NG-RAN support of emergency services is
required as the Layer-2 Remote UE may select a different PLMN from the Layer-2
Relay.
\- A 5G ProSe Layer-2 Remote UE will set its RRC establishment cause to
\"emergency\" when establishing RRC connection from RRC_IDLE.
\- When NG-RAN receives an emergency RRC establishment from a 5G ProSe Layer-2
Remote UE it may need to direct the initial UE message towards its PLMN as in
legacy.
The following conclusions apply to Layer-3 UE-to-Network Relaying:
\- A 5G ProSe Layer-3 UE-to-Network Relay participates the relay discovery
procedure for emergency service only when it receives the Emergency Service
Support indicator in Registration Accept.
\- If PC5 connection was requested using emergency RSC, then the 5G ProSe
Layer-3 Relay sets the RRC Establishment cause to \"emergency\" when
establishing an RRC connection from RRC_IDLE.
\- The emergency number(s) may be preconfigured in the 5G ProSe Remote UE
\- For Layer-3 UE to Network Relaying, the Remote UE may obtain P-CSCF address
from the Relay UE via DHCP or may be preconfigured with P-CSCF address.
NOTE 3: Remote UE obtaining P-CSCF address via DHCP is specified in clause
14A.2.1 of TS 24.379 [26].
\- A Layer-3 UE-to-Network Relay sets up or modifies an emergency PDU session
to support the Remote UE\'s emergency service.
\- When a 5G ProSe Layer-3 UE-to-Network Relay UE initiates emergency service,
the 5G ProSe Relay UE shall not advertise its support of emergency service and
reject any Remote UE's requests for relaying emergency services. The 5G ProSe
Layer-3 UE-to-Network Remote UE can attempt to select other 5G ProSe Layer-3
UE-to-Network Relay.
\- If the 5G ProSe Layer-3 Relay is relaying an emergency service for a 5G
ProSe Layer-3 Remote UE, then it shall prioritise its own emergency service
establishment and stop relaying the Remote UEs emergency service.
Editor\'s note: SA WG1 is expected to verify the service requirement for pre-
empting relayed emergency service.
\- A 5G ProSe Layer-3 Remote UE should attempt to use 5G ProSe Communication
via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF procedures before
attempting to establish an emergency PDU Session via 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF support.
\- The 5G ProSe Layer-3 UE-to-Network Remote UE set the access type to NG-RAN
via 5G ProSe Layer-3 UE-to-Network Relay to P-CSCF.
NOTE 4: This access type indication is required for all IMS services and is
not specific for emergency service. It will be introduced by CT WG1.
###### ### Annex A: Layer-2 Architecture Reference Model
# A.1 Introduction
The following clauses describe the control plane and user plane protocol
stacks for supporting Layer 2 UE-to-UE Relay UE.
# A.2 Control and User Plane Protocols for Layer 2 UE-to-UE Relay
## A.2.1 User Plane Protocol Stack
Figure A.2.1-1 illustrates user plane protocol stacks using a UE-to-UE Layer-2
Relay. The security is established end-to-end between UE1 and UE2. Therefore,
user data is never exposed at the relay node since the relay function does not
process/apply any security on the relayed packets.
Figure A.2.1-1: End-to-End User Plane protocol stacks using a Layer-2 UE-to-UE
Relay
Both IP traffic and Non-IP traffic are supported.
The SDAP and PDCP protocols above are as specified in TS 38.300 [15].
## A.2.2 Control Plane Protocol Stack
Figure A.2.2-1 illustrates control plane protocol stacks using a Layer-2 UE-
to-UE Relay. The security is established end-to-end between UE1 and UE2 as
shown by the PDCP layer terminating in UE1 and UE2. Therefore, the E2E PC5-S
message between UE1 and UE2 is never exposed at the relay node since the relay
function does not process/apply any security on the relayed E2E PC5-S
messages.
Figure A.2.2-1: End-to-End Control Plane protocol stacks using a Layer-2 UE-
to-UE Relay
NOTE 1: The definition and functionalities of the Adaptation Layer are defined
by RAN WG2.
NOTE 2: Only the End-to-End control plane protocol stack is shown in Figure
A.2.2-1. The control plane protocol stack of the unicast link between UE1/UE2
and UE-to-UE Relay (i.e. PC5 unicast link) can re-use the regular PC5-S
protocol stack defined in clause 6.1.2 of TS 23.304 [3].
NOTE 3: PC5-S messages from direct PC5 unicast link with the UE-to-UE Relay
and for E2E PC5 unicast link are supported. The E2E PC5-S message is the
message transferred between UE1 and UE2, and the direct PC5-S message is the
message transferred between UE1 and UE-to-UE Relay or between UE-to-UE Relay
and UE2. How to differentiate them depends on RAN solution. Whether the same
pair of source and destination Layer-2 IDs is used for direct and E2E PC5-S
messages is to be determine during SA WG2\'s normative phase and it\'s
feasibility is to be confirmed by RAN WG2.
#
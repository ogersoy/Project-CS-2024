# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the discovery and network selection procedures
for access to 3GPP Evolved Packet Core (EPC) via non-3GPP access networks and
includes Authentication and Access Authorization using Authentication,
Authorization and Accounting (AAA) procedures used for the interworking of the
3GPP EPC and the non-3GPP access networks.
The present document also specifies the Tunnel management procedures used for
establishing an end-to-end tunnel from the UE to the ePDG to the point of
obtaining IP connectivity and includes the selection of the IP mobility mode.
The non-3GPP access networks considered in this present document are
cdma2000^®^ HRPD and Worldwide Interoperability for Microwave Access (WiMAX),
and any access technologies covered in 3GPP TS 23.402 [6]. The present
document also specifies UE access to PLMN IP-based services via restrictive
non-3GPP access networks covered in 3GPP TS 33.402 [15]. These non-3GPP access
networks can be trusted or untrusted access networks.
The present document is applicable to the UE and the network. In this
technical specification the network is the 3GPP EPC.
NOTE: cdma2000^®^ is a registered trademark of the Telecommunications Industry
Association (TIA-USA).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] Void.
[2A] 3GPP TS 23.002: \"Network architecture\".
[3] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[4] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station (MS) in idle mode\".
[5] Void.
_[5A]_ 3GPP TS 23.203: \"Policy and Charging Control Architecture\".
[6] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[6A] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[7] Void.
[8] Void.
[9] 3GPP TS 24.234 v12.2.0: \"3GPP System to Wireless Local Area Network
(WLAN) interworking; WLAN User Equipment (WLAN UE) to network protocols\".
[10] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS)\".
[11] 3GPP TS 24.303: \"Mobility management based on Dual-Stack Mobile IPv6\".
[12] 3GPP TS 24.304: \"Mobility management based on Mobile IPv4; User
Equipment (UE) - Foreign Agent interface\".
[13] 3GPP TS 24.312: \"Access Network Discovery and Selection Function (ANDSF)
Management Object (MO)\".
[14] 3GPP TS 25.304: \"User Equipment (UE) procedures in idle mode and
procedures for cell reselection in connected mode\".
[14A] 3GPP TS 25.331: \"Radio Resource Control (RRC); Protocol
Specification\".
[15] 3GPP TS 33.402: \"3GPP System Architecture Evolution: Security aspects of
non-3GPP accesses\".
[16] 3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) procedures in idle mode\".
[16A] 3GPP TS 45.008: \"Radio Access Network; Radio subsystem link control\".
[16B] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
Radio Resource Control (RRC); Protocol specification\".
[17] 3GPP TS 29.273: \"Evolved Packet System; 3GPP EPS AAA Interfaces\".
[18] 3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and
Tunnelling protocols\".
[19] 3GPP TS 29.276: \"Optimized Handover Procedures and Protocols between
EUTRAN Access and cdma2000 HRPD Access\".
[20] 3GPP2 X.S0057-B v2.0: \"E-UTRAN - HRPD Connectivity and Interworking:
Core Network Aspects\".
[21] 3GPP2 C.S0087-A v4.0: \"E-UTRAN -- HRPD and CDMA2000 1x Connectivity and
Interworking: Air Interface Aspects\".
[22] Void.
[23] 3GPP2 C.S0024-B v3.0: \"cdma2000^®^ High Rate Packet Data Air Interface
Specification\".
[23A] 3GPP2 C.S0016-D v1.0: \"Over-the-Air Service Provisioning of Mobile
Stations in Spread Spectrum Standards\".
[24] WiMAX Forum Network Architecture Release 1.0 version 1.2 -- Stage 2:
\"Architecture Tenets, Reference Model and Reference Points\", November 2007.
[25] WiMAX Forum Network Architecture Release 1.0 version 1.2 -- Stage 3:
\"Detailed Protocols and Procedures\", November 2007.
[26] WiMAX Forum Mobile System Profile Release 1.0 Approved Specification
Revision 1.4.0, April 2007.
[27] IEEE Std 802.16e-2005 and IEEE Std 802.16-2004/Cor1-2005: \"IEEE Standard
for Local and Metropolitan Area Networks, Part 16: Air Interface for Fixed and
Mobile Broadband Wireless Access Systems Amendments 2 and Corrigendum 1\",
February 2006.
[28] IETF RFC 7296 7296 (October 2014): \"Internet Key Exchange Protocol
Version 2 (IKEv2)\".
[29] IETF RFC 3748 (June 2004): \"Extensible Authentication Protocol (EAP)\".
[30] IETF RFC 4301 (December 2005): \"Security Architecture for the Internet
Protocol\".
[31] IETF RFC 4555 (June 2006): \"IKEv2 Mobility and Multihoming Protocol
(MOBIKE)\".
[32] IETF RFC 4303 (December 2005): \"IP Encapsulating Security Payload
(ESP)\".
[33] IETF RFC 4187 (January 2006): \"Extensible Authentication Protocol Method
for 3rd Generation Authentication and Key Agreement (EAP-AKA)\"
[34] IETF RFC 3629 (November 2003): \"UTF-8, a transformation format of ISO
10646\".
[35] IETF RFC 1035 (November 1987): \"DOMAIN NAMES - IMPLEMENTATION AND
SPECIFICATION\".
[36] **Void.**
_[37] IETF RFC 6153 (February 2011): \"DHCPv4 and DHCPv6 Options for Access
Network Discovery and Selection Function (ANDSF) Discovery_ \".
_[38] IETF RFC 5448 (May 2009)_ : _\"_ Improved Extensible Authentication
Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-
AKA\')_\"._
[39] OMA-ERELD-DM-V1_2: \"Enabler Release Definition for OMA Device
Management\".
[40] Void
[41] \"Unicode 5.1.0, Unicode Standard Annex #15; Unicode Normalization
Forms\", March 2008. [http://www.unicode.org]{.underline}.
[42] 3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic
bootstrapping architecture\".
[43] 3GPP TS 29.109: \"Generic Authentication Architecture (GAA); Zh and Zn
Interfaces based on the Diameter protocol\".
[44] 3GPP TS 33.222: \"Generic Authentication Architecture (GAA); Access to
network application functions using Hypertext Transfer Protocol over Transport
Layer Security (HTTPS)\".
[45] 3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity
Module (USIM) application\".
[46] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[47] 3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA) Push function\".
[48] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[49] IETF RFC 4739: \"Multiple Authentication Exchanges in the Internet Key
Exchange (IKEv2) Protocol\".
[50] 3GPP TS 29.274: \"Tunnelling Protocol for Control plane (GTPv2-C)\".
[51] 3GPP TS 24.139: \"3GPP System-Fixed Broadband Access Network
Interworking; Stage 3\".
[52] 3GPP TS 24.109: \"Bootstrapping interface (Ub) and network application
function interface (Ua); Protocol details\".
_[53] IETF RFC_ 2817 _(May_  _2000)_ : _\"_ Upgrading to TLS Within HTTP/1.1
_\"._
_[54] Void._
_[55] Void._
_[56]_ 3GPP TS 24.244: \"Wireless LAN control plane protocol for trusted WLAN
access to EPC\".
[57] IEEE Std 802.11-2016: \"IEEE Standard for Information technology \-
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
[58] IEEE Std 802-2014: \"IEEE Standard for Local and Metropolitan Area
Networks: Overview and Architecture\", 30th June 2014.
[59] Void.
[60] IETF RFC 4284 (January 2006): \"Identity Selection Hints for the
Extensible Authentication Protocol (EAP)\".
[61] IEEE Std 802.1X™-2010: \"IEEE Standard for Information technology \-
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Port-based Network Access Control\".
_[62]_ IETF RFC 4282: \"The Network Access Identifier\".
[63] ITU-T Recommendation E.212: \"The international identification plan for
mobile terminals and mobile users\".
[64] _IETF RFC_ 7651 (September 2015): \"3GPP IP Multimedia Subsystems (IMS)
Option for the Internet Key Exchange Protocol Version 2 (IKEv2)\".
[65] 3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework
(AF)\".
[66] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[67] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[68] 3GPP TS 23.161: \"Network-Based IP Flow Mobility (NBIFOM); Stage 2\".
[69] 3GPP TS 24.161: \"Network-Based IP Flow Mobility (NBIFOM); Stage 3\".
[70] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall
description; Stage 2\".
[70A] IETF RFC 4309 (December 2005): \"Internet Key Exchange Protocol Version
2 (IKEv2)\".
[70B] IETF RFC 7296 (October 2014): \"Internet Key Exchange Protocol Version 2
(IKEv2)\".
[71] IETF RFC 6696 (July 2012): \"EAP Extensions for the EAP Re-authentication
Protocol (ERP)\".
[72] IETF RFC 3948 (January 2005): \"UDP Encapsulation of IPsec ESP Packets\".
[73] IETF RFC 2234 (November 1997): \"Augmented BNF for Syntax Specification:
ABNF\".
[74] IETF RFC 5279 (July 2008): \"A Uniform Resource Name (URN) Namespace for
the 3rd Generation Partnership Project (3GPP)\".
[75] IETF RFC 2474 (December 1998): \"Definition of the Differentiated
Services Field (DS Field) in the IPv4 and IPv6 Headers\".
[76] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage3\".
[77] 3GPP TR 24.502: \"Access to the 3GPP 5G Core Network (5GCN) via non-3GPP
access networks\".
[78] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
[79] 3GPP TS 24.193: \"Access Traffic Steering, Switching and Splitting
(ATSSS); Stage 3\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**Access Network Discovery and Selection Function:** In this specification,
Access Network Discovery and Selection Function (ANDSF) is a network element
specified in 3GPP TS 23.402 [6]. Unless otherwise specified, the term ANDSF is
used to refer to both Home and Visited ANDSF.
**ANDSF rules:** In this specification, ANDSF rules refers to the set of ANDSF
policies defined in 3GPP TS 24.312 [13] for WLAN access selection and traffic
routing between E-UTRAN or UTRAN and WLAN. ANDSF rules can contain RAN
validity conditions for RAN-assisted WLAN interworking.
**Emergency session:** In this specification, an emergency session refers to
an emergency PDN connection established in E-UTRAN and handed over to a S2a
based cdma2000^®^ HRPD access network, or an emergency PDN connection
established over trusted or untrusted WLAN access, or an emergency PDN
connection established in 3GPP access and handed over to trusted or untrusted
WLAN access.
**Equivalent home service provider:** In this specification, equivalent home
service provider is a service provider that is equivalent to HPLMN in regard
to service provider selection over WLAN.
**Equivalent visited service provider:** In this specification, equivalent
visited service provider is a service provider that is equivalent to the
V-PLMN in regard to service provider selection over WLAN.
**Home ANDSF:** In this specification, the Home ANDSF (H-ANDSF) is an ANDSF
element located in the home PLMN of a UE.
**Offload Preference Indicator (OPI):** In this specification, Offload
Preference Indicator (OPI) is a bitmap (i.e. a one-dimensional bit array) that
can be used by UEs in an E-UTRA or UTRA cell to determine when to move certain
traffic (e.g. certain IP flows) to WLAN access or to 3GPP access. The meaning
of each bit in this bitmap is operator specific and is not defined in 3GPP
specifications.
**Offloadable PDN connection** : In this specification, an offloadable PDN
connection is a PDN connection, established in (or previously handed over to)
3GPP access, such that:
\- the WLAN offload indication information element (see 3GPP TS 24.301 [10]
and 3GPP TS 24.008 [46]) last received for the PDN connection has the
\"offloading the traffic of the PDN connection via a WLAN when in S1 mode is
acceptable\" value and the UE is in S1 mode; or
\- the WLAN offload indication information element (see 3GPP TS 24.301 [10]
and 3GPP TS 24.008 [46]) last received for the PDN connection has the
\"offloading the traffic of the PDN connection via a WLAN when in UTRAN Iu
mode is acceptable\" value and the UE is in UTRAN Iu mode.
**Preferred Service Providers List (PSPL):** In this specification, the
Preferred Service Providers List refers to a prioritized list of service
provider realms other than equivalent home service providers preferred by the
UE\'s 3GPP home operator for WLAN.
**Set of Access network discovery information:** In this specification, a set
of Access network discovery information is the access network discovery
information from a single ANDSF**.**
**Set of Inter-system mobility policy:** In this specification, a set of
Inter-system mobility policy is the inter-system policy information received
from a single ANDSF**.**
**Visited ANDSF:** In this specification, the Visited ANDSF (V-ANDSF) is an
ANDSF element located in the visited PLMN of a UE.
**RAN Assistance Information:** In this specification, RAN Assistance
Information refers to the set of thresholds and parameters that can be
provided by E-UTRAN or UTRAN to the UE for assisting WLAN access selection and
traffic routing. The RAN assistance information can include 3GPP access
thresholds, WLAN access thresholds, an Offload Preference Indicator (OPI)
value and WLAN identifiers as defined in 3GPP TS 25.331 [14A] and 3GPP TS
36.331 [16B].
**RAN rules:** In this specification, RAN rules refers to the set of RAN
assistance parameter and RAN steering command handling, access network
selection and traffic steering procedures defined in 3GPP TS 36.304 [16], 3GPP
TS 25.304 [14] and 3GPP TS 36.331 [16B] for the steering of traffic between
E-UTRAN or UTRAN and WLAN associated with RAN-controlled LTE-WLAN interworking
or RAN-assisted WLAN interworking.
**Restrictive non-3GPP access network type I:** a non-3GPP access network
forwarding IP packets of TCP connections initiated by a served UE, with
destination port 443, and with destination address outside of the non-3GPP
access network, and discarding IP packets of some or all other TCP connections
initiated by the served UE, with destination address outside of the non-3GPP
access network.
**Restrictive non-3GPP access network type II:** a non-3GPP access network
discarding IP packets of TCP connections initiated by a served UE, with
destination address outside of the non-3GPP access network, where the non-3GPP
access network contains HTTP proxy supporting HTTP CONNECT method for URIs
with port 443 and with host outside of the non-3GPP access network.
**Restrictive non-3GPP access network:** restrictive non-3GPP access network
type I or restrictive non-3GPP access network type II.
**Firewall traversal tunnel (FTT):** a TCP connection with TLS connection
enabling passing of messages between UE in restrictive non-3GPP access network
and ePDG.
**Firewall traversal tunnel keep-alive time (FTT KAT)** : a maximum time
between two subsequent messages sent by UE in the firewall traversal tunnel.
**Unauthenticated IMSI:** In this specification, the term \"unauthenticated
IMSI\" or the term \"IMSI is unauthenticated\" is only pertinent to the
network. The knowledge that a UE\'s IMSI is unauthenticated or that the UE has
an unauthenticated IMSI, is not available to the UE.
**WLAN Selection Policy (WLANSP):** In this specification, the WLAN Selection
Policy is a set of operator-defined rules that determine how the UE
selects/reselects a WLAN access network.
**WLAN selection information:** In this specification, WLAN selection
information refers to the information received from ANDSF including WLAN
Selection Policy (WLANSP), rule selection information, Home Network Preference
information and Visited Network Preference information as specified in 3GPP TS
24.312 [13].
**Visited PLMNs with preferred rules** : In this specification, visited PLMNs
with preferred rules included in the rule selection information refers to a
list of identifiers of visited PLMNs provided by HPLMN, so that the UE roaming
in such visited PLMN prefers ISMP, ISRP or WLANSP rules provided by the
visited PLMN over ISMP, ISRP or WLANSP rules provided the HPLMN. In ANDSF MO,
the visited PLMNs with preferred rules correspond to the
ANDSF/RuleSelectionInformation/VPLMNswithPreferredRules interior node.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.122 [4] apply:
**Acceptable cell**
**EHPLMN**
**Home PLMN**
**Limited service state**
**RPLMN**
**Visited PLMN**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.402 [6] apply:
**IFOM capable UE**
**Inter-APN routing capable UE**
**Local Operating Environment Information**
**MAPCON capable UE**
**S2a**
**S2b**
**S2c**
**Non-seamless WLAN offload capable UE**
**Single-connection mode (SCM)**
**Transparent single-connection mode (TSCM)**
**Multi-connection mode (MCM)**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 29.273 [17] apply:
**STa**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.301 [10] apply:
**Evolved packet core network**
**Evolved packet system**
For the purposes of the present document, the following terms and definitions
given in WiMAX Forum Network Architecture Release 1.0 version 1.2 -- Stage 3
[25] apply:
**Network Access Provider**
**Network Service Provider**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 33.402 [15] apply:
**External AAA server**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.312 [13] apply:
**Active rule**
**Valid rule**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.003 [3] that relate to access to 3GPP evolved packet core
via non-3GPP access networks, apply:
**NAI**
**Alternative NAI**
**Decorated NAI**
**Emergency NAI**
**Fast-Reauthentication NAI**
**Pseudonym Identity**
**Root NAI**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.002 [2A] apply:
**3GPP AAA Proxy**
**3GPP AAA Server**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.161 [68] apply:
**NBIFOM**
**Routing Rule**
**UE-inititaed NBIFOM**
**Network-initiated NBIFOM**
**Multi-access PDN connection**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.501 [76] apply:
**N1 mode**
**PDU session ID**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AAA Authentication, Authorization and Accounting
ACL Access Control List
AKA Authentication and Key Agreement
ANDSF Access Network Discovery and Selection Function
ANDSF-SN Access Network Discovery and Selection Function Server Name
ANID Access Network Identity
ANQP Access Network Query Protocol
APN Access Point Name
DHCP Dynamic Host Configuration Protocol
DM Device Management
DNS Domain Name System
DSCP Differentiated Services Code Point
DSMIPv6 Dual-Stack MIPv6
eAN/PCF Evolved Access Network Packet Control Function
EAP Extensible Authentication Protocol
EPC Evolved Packet Core
ePDG Evolved Packet Data Gateway
EPS Evolved Packet System
ERP EAP Re-authentication Protocol
ESP Encapsulating Security Payload
FQDN Fully Qualified Domain Name
GAA Generic Authentication Architecture
GBA Generic Bootstrapping Architecture
HA Home Agent
H-ANDSF Home-ANDSF
HRPD High Rate Packet Data
HSGW HRPD Serving Gateway
IEEE Institute of Electrical and Electronics Engineers
IFOM IP Flow Mobility
IKEv2 Internet Key Exchange version 2
IARP Inter-APN Routing Policy
IPMS IP Mobility Mode Selection
ISMP Inter-system Mobility Policy
ISRP Inter-system Routing Policy
IANA Internet Assigned Numbers Authority
I-WLAN Interworking -- WLAN
MAPCON Multi Access PDN Connectivity
MCM Multi-connection mode
MO Management Object
MPS Multimedia Priority Service
NAI Network Access Identifier
NAP Network Access Provider
NBIFOM Network-Based IP Flow Mobility
NBM Network based mobility management
NSP Network Service Provider
NSSAI Network Slice Selection Assistance Information
NSWO Non-Seamless WLAN Offload
NSWOF Non-Seamless WLAN Offload Function
OMA Open Mobile Alliance
OPI Offload Preference Indicator
PCO Protocol Configuration Options
P-GW PDN Gateway
PDU Protocol Data Unit
PSPL Preferred Service Provider List
QoS Quality of Service
SCM Single-connection mode
S-GW Serving Gateway
S-NSSAI Single NSSAI
SPI Security Parameters Index
TFT Traffic Flow Template
TSCM Transparent single-connection mode
UE User Equipment
UICC Universal Integrated Circuit Card
V-ANDSF Visited-ANDSF
W-APN WLAN APN
WiMAX Worldwide Interoperability for Microwave Access
WLAN Wireless Local Area Network
WLANSP WLAN Selection Policy
WLCP WLAN Control Protocol
WMF WiMAX Forum
# 4 General
## 4.1 Trusted and untrusted accesses
The HPLMN operator of the EPC selects whether a connected non-3GPP IP access
network is a trusted or untrusted IP access network.
**For a trusted non-3GPP IP access network the communication between the UE
and the EPC is secure. For an untrusted non-3GPP IP access network the
communication between the UE and the EPC is not trusted to be secure.**
For a trusted non-3GPP IP access network, all **communication between the
access network and the EPC is transferred over pre-established secure links.
For an untrusted non-3GPP IP access network** , to secure communication
between the UE and the EPC:
\- a **single IPSec tunnel needs to be established** to the ePDG for all PDN
connections when the UE accesses EPC via S2c is used; or
\- an IPSec tunnel needs to be established with the same ePDG for each PDN
connection when the UE accesses EPC via S2b is used.
## 4.2 cdma2000^®^ HRPD Access System
The cdma2000^®^ HRPD system is a wireless mobile system developed under the
auspices of 3GPP2. The cdma2000^®^ HRPD system and its access network
subsystem is compliant with 3GPP2 X.S0057 [20] and 3GPP2 C.S0087 [21], which
define the core network and air interface aspects, respectively.
## 4.3 WiMAX Access System
The WiMAX system is a wireless mobile broadband system developed under the
auspices of the WMF and the IEEE. The WiMAX system and its access network
subsystem are compliant with WiMAX Forum Network Architecture Release 1.0
version 1.2 -- Stage 2 [24]. The protocol architecture and signalling of the
WiMAX system is specified in WiMAX Forum Network Architecture Release 1.0
version 1.2 -- Stage 3 [25] which supports the air interface defined in WiMAX
Forum Mobile System Profile Release 1.0 Approved Specification Revision 1.4.0
[26] specifying selected profiles of IEEE Std 802.16e-2005 and IEEE Std
802.16-2004/Cor1-2005 [27] that are to be supported. **The WiMAX access system
correspond to the WiMAX Access Service Network (ASN) and to relevant
interfaces, as defined in** WiMAX Forum Network Architecture Release 1.0
version 1.2 -- Stage 3 **[25].**
## 4.3A WLAN
WLAN is an access network developed under the auspices of IEEE Computer
Society. WLAN is compliant with IEEE Std 802.11 [57], which define air
interface aspects.
IEEE Std 802.11 [57] defines Access Network Query Protocol (ANQP). A UE can
receive from an AP ANQP-elements in response to an ANQP query. The ANQP query
response is received in a generic advertisement service response frame or a
protected management frame.
Where needed, the current specification further describes the structure and
contents of payload of ANQP-elements specified in IEEE Std 802.11 [57] (see
annex H and annex I).
## 4.4 Identities
### 4.4.1 User identities
The user identification shall be either the root NAI, or the decorated NAI,
when the UE accesses the EPC via non-3GPP access networks, and gets
authentication, authorization and accounting services from the EPC.
For emergency services over WLAN:
\- if IMSI is not available (i.e. a UE without USIM), the IMEI shall be used
for the identification, as user part of the emergency NAI and the UE shall use
a specific domain in the realm part of the NAI as specified in 3GPP TS 23.003
[3]; or
\- if the UE has an IMSI, it shall use the IMSI for the identification, as
user part of the emergency NAI.
NOTE 1: If the IMSI is unauthenticated on the network side and the network
supports emergency session for unauthenticated IMSI, the IMEI is used for the
identification on the network side (see clause 6.4.3.1A).
For handover of an emergency session from E-UTRAN to a S2a based cdma2000^®^
HRPD access network, if IMSI is not available (i.e. a UE without USIM) or IMSI
is unauthenticated, the IMEI shall be used for the identification, as part of
the emergency NAI as defined.
The UE\'s Mobile Identity IMEI or IMEISV is conveyed to the network (see
clause 6.4 and clause 7) and used to enable consistent services for the UE
accessing the network via non-3GPP access or to support the emergency services
over WLAN for the unauthenticated UEs.
NOTE 2: IMEI and IMEISV are untrusted identities stored on the UE.
User identification in non-3GPP accesses may require additional identities
that are out of the scope of 3GPP.
IETF RFC 4187 [33] and 3GPP TS 23.003 [3] provide definitions for UE and user
identities although they use slightly different terms. Similar terms are also
used in 3GPP TS 33.402 [15]. The following list provides term equivalencies
and describes the relation between various user identities.
\- The Root NAI is to be used as the permanent identity as specified in 3GPP
TS 33.402 [15].
\- The Fast-Reauthentication NAI is to be used as the Fast-Reauthentication
Identity or the re-authentication ID as specified in 3GPP TS 33.402 [15].
\- The Pseudonym Identity is to be used as the Pseudonym as specified in 3GPP
TS 33.402 [15].
### 4.4.2 Identification of IP Services/PDN connections
For access to EPC the Access Point Name (APN) is used for identifying IP
services/PDN connections. The detailed definition of APN as used for access to
EPC is specified in 3GPP TS 23.003 [3]. APN is conveyed in the IKEv2 signaling
during tunnel establishment when S2b interface is used for UE to access EPC.
When UE accesses EPC via S2a using trusted WLAN access network, APN is
conveyed in EAP-AKA\' signaling for single-connection mode (SCM) or in WLAN
Control Protocol (WLCP) signaling (see 3GPP TS 24.244 [56]) for multi-
connection mode (MCM)
### 4.4.3 FQDN for ePDG Selection
An ePDG Fully Qualified Domain Name (ePDG FQDN) is either provisioned by the
home operator or constructed by UE in either the Operator Identifier FQDN
format or the Tracking/Location Area Identity FQDN format as described in
clause 4.5.4.2 of 3GPP TS 23.402 [6], and used as input to the DNS mechanism
for ePDG selection.
The detailed format of this ePDG FQDN is specified in 3GPP TS 23.003 [3].
### 4.4.4 Access Network Identity
For access to EPC via S2a using a trusted non-3GPP access network, the UE uses
the Access Network Identity (ANID) in the key derivation (see 3GPP TS 33.402
[15]). The handling of the Access Network Identity is described in clause
6.4.2.4 and the generic format and specific values for the Access Network
Identity are defined in clause 8.1.1.
### 4.4.5 ANDSF Server Name
The ANDSF Server Name (ANDSF-SN) is used for ANDSF discovery. The detailed
rules are defined in clause 6.8.2.2.1 and the format of the ANDSF-SN is
specified in 3GPP TS 23.003 [3].
### 4.4.6 Home Agent address(es)
If DSMIPv6 is used, the Home Agent IPv6 address (and optionally an IPv4
address) are needed. Within this specification, Home Agent address(es)
signalling via IKEv2 between the UE and the ePDG is defined in clause 7.4.1.
### 4.4.7 Security Parameters Index
The Security Parameters Index (SPI, see IETF RFC 4301 [30]) identifies
uniquely a security association between the UE and the ePDG. For the case of
NBM using S2b a one to one mapping between SPI and PDN connection applies.
## 4.5 _Fixed Broadband_ Access System
The _fixed broadband_ _access_ system is a type of high-speed Internet access
for multi-service broadband packet networking. The _fixed broadband_ _access_
system is specified by the Broadband Forum, including addressing
interoperability, architecture and management.
For support of _fixed broadband_ access interworking _,_ the EPC network
procedures are specified in 3GPP TS 24.139 [51].
The UE procedures for support of _fixed broadband_ access are specified in
3GPP TS 24.139 [51] and can be used when the EPC network uses the fixed
broadband access interworking or the fixed broadband access convergence.
The architecture of the _fixed broadband_ access convergence is specified in
3GPP TS 23.203 [5A].
## 4.6 Restrictive non-3GPP access networks
An untrusted non-3GPP access network can be a restrictive non-3GPP access
network. When the UE is served by a restrictive non-3GPP access network, the
UE and the ePDG follow the additional procedures described in the annex F.
## 4.7 Provision and handling of local emergency numbers
It is a UE implementation option to support the procedures of this clause.
Once the UE has a secure connection to a PLMN through non-3GPP access, the UE
supports obtaining local emergency numbers by one of the following ways:
i) when the UE is connected to a PLMN through trusted non-3GPP access, the
local emergency numbers is provided through ANQP, within the ANQP payload. The
signalling protocol and methods for use of ANQP is as specified in IEEE Std
802.11 [57]. See also annex I;
ii) when the UE is connected to a PLMN through untrusted non-3GPP access,
local emergency numbers can be provided through DNS query. See annex J; or
iii) when the UE is connected to a PLMN through untrusted non-3GPP access,
local emergency numbers can be provided through IKEv2. See annex K.
Upon receiving the local emergency numbers through any of the methods
indicated above, the UE shall store the local emergency numbers:
a) if the Non-3GPP emergency number indicator within the Non-3GPP NW provided
policies IE through registration procedures over 3GPP access is set to \"use
of non-3GPP emergency numbers permitted\", and:
\- if the UE is connected to a PLMN through non-3GPP access and also
registered to same PLMN or different PLMN through 3GPP access in the same
country, then provide these local emergency numbers to upper layers for the
detection of UE initiated emergency call;
\- if the UE is connected to a PLMN through non-3GPP access but is also
registered to different PLMN through 3GPP access that is not in the same
country, then do not use the received local emergency numbers;
b) if the Non-3GPP emergency number indicator within the Non-3GPP NW provided
policies IE through registration procedures over 3GPP access is set to \"use
of non-3GPP emergency numbers not permitted\", or if no Non-3GPP NW provided
policies IE was provided through registration procedures over 3GPP access,
then:
\- do not use the received local emergency numbers for the detection of UE
initiated emergency call over 3GPP access; and
c) if the UE:
\- is connected to a PLMN through non-3GPP access;
\- is not registered to any PLMN through 3GPP access;
\- is not in limited service state camped on an acceptable cell of any PLMN
through 3GPP access; and
\- can determine that the MCC information of the local emergency numbers
received over non-3GPP access corresponds to the country in which the UE is
located;
then, as an implementation option, provide these local emergency numbers to
upper layers for the detection of UE initiated emergency call.
NOTE: The UE determination of the country in which the UE is located, is UE
implementation specific.
The local emergency numbers, received in any of the methods indicated above:
\- are only valid in the country where these local emergency numbers were
provided;
\- replace only the stored local emergency numbers received over non-3GPP
access, if any;
\- shall be deleted when UE moves to a country different from where the local
emergency numbers were received; and at switch off or removal of the USIM.
## 4.8 Quality of service support
### 4.8.1 General
QoS differentiation may be supported for both **trusted WLAN and untrusted
WLAN**.
### 4.8.2 QoS differentiation in trusted WLAN
#### 4.8.2.1 General
For trusted WLAN, QoS differentiation may be supported if Multi-Connection
mode (MCM) based access to EPC is used.
#### 4.8.2.2 QoS signalling
As part of EAP-AKA\' authentication via TWAN, the UE and the TWAN first
negotiates TWAN connection mode usage as described in clause 6.4.
During PDN connection establishment, the UE indicates to the TWAG whether WLCP
multiple bearer PDN connectivity capability is supported or not, as specified
in 3GPP TS 24.244 [56]:
\- if the UE does not indicate that WLCP multiple bearer PDN connectivity is
supported, or if the UE indicates that WLCP multiple bearer PDN connectivity
is supported but the TWAG does not support WLCP multiple bearer PDN
connectivity, then QoS differentiation is not supported. Single point-to-point
PDN connection is used to carry all S2a bearers traffic between the UE and
TWAG; or
\- if WLCP multiple bearer PDN connectivity is supported by both the UE and
TWAN, then QoS differentiation is supported and multiple bearer PDN
connectivity shall be used between the UE and TWAG:
\- During PDN connection establishment, the TWAG shall establish a default
WLCP bearer for the PDN connection. The default WLCP bearer remains
established throughout the lifetime of the PDN connection; and
\- The TWAG shall establish a separate WLCP bearer for each additional S2a
dedicated bearer of the PDN connection using WLCP signalling as specified in
3GPP TS 24.244 [56]. Each WLCP bearer is associated with TFT and bearer level
QoS (i.e. QCI, GBR and MBR) for one-to-one mapping between WLCP bearer and S2a
bearer. The TWAG shall maintain the WLCP bearer to the S2a bearer mapping
table.
#### 4.8.2.3 QoS differentiation in user plane
If WLCP multiple bearer PDN connectivity is used:
\- For uplink packets, the UE shall select a WLCP bearer based on the uplink
packet filters in the TFTs. If no match is found, the UE shall select the WLCP
bearer that does not have any uplink packet filter assigned. If all bearers
have been assigned an uplink packet filter, the UE shall discard the uplink
data packet. The UE shall then use the most recent DSCP value received in the
same WLCP bearer from the TWAG or the QCI in WLCP bearer level QoS information
to derive the DSCP value for uplink packets. The UE shall provide the user
plane connection ID to the lower layers to be used as the MAC address of the
TWAG associated with the WLCP bearer. The TWAG shall then route the uplink
packets to the corresponding S2a bearers based on the WLCP bearer and the S2a
bearer mapping table.
NOTE 1: The UE can map QCIs to DSCP values, for example, by using the mapping
between standardized QCI values and Release 99 3GPP QoS parameter values
specified in 3GPP TS 23.401 [4] table E.3, and the mapping between Release 99
3GPP QoS parameter values and DSCP values specified in IEEE Std. 802.11-2012
[57] table V-1.
NOTE 2: The UE can send the same DSCP as that received in the downlink, in
case the privacy of the user is to be protected.
NOTE 3: Whether the UE determines DSCP based on the most recent DSCP value
received in the same WLCP bearer from the TWAG or on the QoS mapping is left
to the implementation.
\- For downlink packets, the PDN GW routes the packets to S2a bearers based on
the downlink packet filters in the TFTs assigned to each of the S2a bearers.
The TWAG then selects the corresponding WLCP bearer for the downlink packets
based on the the WLCP bearer and the S2a bearer mapping table. The TWAG shall,
based on operator policy, use the QCI and the ARP in WLCP bearer level QoS
information to derive the DSCP value for downlink packets. The TWAG shall
provide the user plane connection ID to the lower layers to be used as the MAC
address of the TWAG associated with the WLCP bearer.
NOTE 4: The TWAG can map QCI to DSCP value, for example, by using the mapping
between standardized QCI values and Release 99 3GPP QoS parameter values
specified in 3GPP TS 23.401 [4] table E.3, and the mapping between Release 99
3GPP QoS parameter values and DSCP values specified in IEEE Std 802.11 [57]
table R-1.
### 4.8.3 QoS differentiation in untrusted non-3GPP access
For untrusted non-3GPP access, QoS differentiation is provided if the UE and
the ePDG supports the IKEv2 multiple bearer PDN connectivity and the IKEv2
multiple bearer PDN connectivity is used in the PDN connection as defined in
clause 7.2.7 and clause 7.4.6.
# 5 Network Discovery and Selection
## 5.0 General
The following aspects are included when selecting an EPC network and routing
traffic via the EPC network:
\- access network discovery and selection procedures as defined in clause 5.1;
\- EPC network selection as defined in clause 5.2; and
\- data traffic routing of IP flows as defined in clause 5.4.
If the UE perform reselection of the access network as defined in clause 5.3
and the UE reselects to a different access network, the UE performs the second
item and third item of the above bulleted list.
## 5.1 Access network discovery and selection procedures
### 5.1.1 General
If PLMN selection specified in 3GPP TS 23.122 [4] is applicable (e.g., at
switch-on, recovery from lack of 3GPP coverage, or user selection of
applicable 3GPP access technology), the PLMN selection to select the highest
priority PLMN according to these specifications is performed before any access
network discovery. Procedures for EPC selection over non-3GPP access are
specified in clause 5.2. In particular, for WLAN access, service provider
selection function is specified in the WLAN specific procedures in clause
5.2.3.2
In the access network discovery procedure the UE may get from the ANDSF
information on available access networks in its vicinity. The UE may obtain
this information by querying the ANDSF, and may use this information when
determining the presence of operator preferred access networks. Determination
of the presence of access networks requires using radio access specific
procedures, which are not further described here.
The UE determines the presence of several access networks and then selects
between them. If a higher priority access network is found connected to the
selected service provider or a higher priority service provider, the UE will
attempt to attach via that access network.
### 5.1.2 Access network discovery procedure
#### 5.1.2.1 Triggering the discovery of operator preferred access networks
with the ANDSF
The UE may initiate communications with the ANDSF for operator preferred
access network discovery:
\- when conditions set up within the policies available in the UE are met; or
\- when a user requests for manual selection.
NOTE 1: The minimum allowed time interval between two consecutive UE initiated
requests towards the ANDSF can be set by operator policies.
NOTE 2: The UE changing of access networks can override the minimum allowed
time interval setting.
#### 5.1.2.2 Discovering availability of access networks
The UE may apply the techniques specific to the non-3GPP access technologies
to discover available non-3GPP access networks. Such techniques will not be
further described here.
In addition, the UE may signal to the ANDSF to obtain information on operator
preferred access networks. The discovery of the ANDSF by the UE, the
connection to the ANDSF by the UE and the signalling between the UE and the
ANDSF are given in clause 6.8.
### 5.1.3 Access network selection procedure
#### 5.1.3.1 General
The access network selection may be classified as inter-technology or intra-
technology.
The UE can use information received from ANDSF for inter-technology access
network selection.
If the RAN rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, the UE uses the information described in clause
6.10.4 for inter-technology access network selection.
Other mechanisms for inter-technology access network selection are out of
scope of this specification.
#### 5.1.3.2 Specific intra-technology access network selection
In this release of the specification the use of the following specific intra-
technology access network selection procedures is specified.
##### 5.1.3.2.1 cdma2000^®^ HRPD access network selection
The access network selection process for cdma2000^®^ HRPD access networks
shall follow 3GPP2 X.S0057 [20].
##### 5.1.3.2.2 WiMAX NAP selection
The access network selection process for WiMAX which encompasses the NAP
discovery and access, shall follow the WiMAX Forum Network Architecture
Release 1.0 version 1.2 -- Stage 3 [25].
##### 5.1.3.2.3 WLAN selection
##### 5.1.3.2.3.1 General {#general-6 .H6}
The purpose of this procedure is to create a prioritized list of selected
WLAN(s).
The user preferences are used to select between the automatic WLAN selection
procedure or the manual WLAN selection procedure.
The UE shall determine the prioritized list of selected WLAN(s):
1) if user preferences are present, in accordance with the manual mode WLAN
selection procedure (see clause 5.1.3.2.3.2); and
2) if user preferences are not present, in accordance with the automatic mode
WLAN selection procedure (see clause 5.1.3.2.3.3).
The UE shall use the prioritized list of selected WLAN(s) to select the
service provider in the procedure in clause 5.2.3.2.
##### 5.1.3.2.3.2 Manual mode WLAN selection {#manual-mode-wlan-selection .H6}
The UE creates a prioritized list of selected WLAN(s). The creation of the
prioritized list is implementation specific.
##### 5.1.3.2.3.3 Automatic mode WLAN selection {#automatic-mode-wlan-
selection .H6}
If the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, then the selected WLAN(s) are WLAN(s) that fulfil
the selection criteria with the highest priority configured in the active
ANDSF WLANSP rule.
If the RAN rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, then the selected WLAN(s) are WLAN(s) matching
WLAN identifiers in an entry of the list of the WLAN identifiers received
along with the move-traffic-to-WLAN indication as described in clause 6.10.4.
The UE determines the selected WLAN(s) according to the following steps:
1) the UE shall construct prioritized list of available WLANs as follows:
a) if the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, the UE shall use the procedures specified in IEEE
Std 802.11 [57] to discover the available WLANs. The UE may perform ANQP
procedures as specified in IEEE Std 802.11 [57] to discover the attributes and
capabilities of available WLANs. The UE shall compare the attributes and
capabilities of the available WLANs with the highest priority selection
criterion that has not been used yet in the active WLANSP rule, and construct
a prioritized list of available WLANs that fulfil the selection criteria. If
there are multiple highest priority selection criteria, it is up to the UE
implementation which one to use. In particular, if:
\- the group of selection criteria include the HomeNetworkIndication and it is
set to \"1\" (see 3GPP TS 24.312 [13]); and
\- the HomeNetworkPreference:
i) does not include 3GPP_RPLMN_Preferred; or
ii) includes 3GPP_RPLMN_Preferred and it is set to \"0\" (see 3GPP TS 24.312
[13]);
then a WLAN is included, if:
\- the other selection criteria in the active WLANSP rule are met; and
\- the domain name list (see IEEE Std 802.11 [57]) includes:
i) the home domain name derived from its IMSI; or
ii) any realm in the EquivalentHomeSPs as specified in 3GPP TS 24.312 [13].
The priority of a WLAN in the list is set to the WLAN priority defined in the
preferredSSIDlist of the matching selection criteria. There may be one or more
selected WLANs in the list; and
b) if the RAN rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, the UE shall use the procedures specified in IEEE
Std 802.11 [57] to discover available WLANs. The UE shall construct a
prioritized list of available WLANs and populate it with each discovered WLAN
which matches all WLAN identifiers included in an entry of the list of the
WLAN identifiers received along with the move-traffic-to-WLAN indication as
described in clause 6.10.4. The priority of a discovered WLAN in the
prioritized list of available WLANs is decided by the UE in an implementation
specific way;
2) if the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, and if the following conditions are fulfilled:
\- the UE supports the PDN connection establishment over WLAN using the
applicable S2a procedures specified in 3GPP TS 23.402 [6];
\- the \"S2a connection preference\" indicator exists and indicates that PDN
connection establishment over WLAN using the applicable S2a procedures
specified in 3GPP TS 23.402 [6] is preferred; and
\- one or more WLANs in the list constructed in step 1) is a trusted non-3GPP
IP access network;
then the UE considers the WLANs that have the highest priority and indicate
the HPLMN or RPLMN in the PLMN list with S2a connectivity IE (see annex H) as
the selected WLAN(s).
Otherwise, the UE considers the WLAN(s) that has or have the highest priority
as the selected WLAN(s). And
NOTE 1: WLAN advertises PLMN(s) towards which the S2a connectivity is
supported using ANQP-element \"3GPP Cellular Network\" with the PLMN List with
S2a Connectivity IE in the payload, according to annex H.
NOTE 2: Advertising S2a connectivity over a WLAN using EAP signalling is not
supported in this version of the specification.
3) if the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, if there are no WLAN(s selected in step 2), the UE
may repeat the procedure from step 1) taking into consideration selection
criteria with lower priority from the active WLANSP rule.
NOTE 3: UE implementation can optimize the steps described above, e.g. by
combining the ANQP procedures.
## 5.2 EPC network selection over non-3GPP access
### 5.2.1 General
The following EPC network selection procedures over non-3GPP access are
defined:
1) WiMAX specific;
2) EPC network selection via cdma2000^®^ HRPD access is given in 3GPP TS
23.122 [4] with any exceptions detailed in clause 5.3.4;
3) WLAN specific procedures in clause 5 apply: the procedures detail selecting
one or more WLANs and (subsequently) selecting one service provider offering
services via the WLAN (see clause 5.2.3.2). When the operator of the WLAN
requires authentication and the authentication succeeds (see clause 6.4 and
6.5.1), the UE follows the procedures defined for connecting with the EPC.
When the UE is connected to EPC through WLAN access, the tunnel is set-up with
the ePDG (as described in clause 7 of this document) using a root NAI as
defined in 3GPP TS 23.003 [3] or with the HA (as described in 3GPP TS 24.303
[11]); and
4) generic EPC network selection for other access technologies not listed
above.
The UE performs the appropriate EPC selection procedure over non-3GPP access
when the non-3GPP radio becomes enabled. If the UE needs to establish
emergency session over untrusted access, the UE shall select an ePDG that
supports emergency services as described in clause 7.2.1 and 3GPP TS 23.402
[6].
NOTE: The UE can perform the appropriate EPC selection procedure over non-3GPP
access based on other implementation-specific triggers, e.g. regaining
non-3GPP access network coverage or connectivity.
The UE can utilize information received from ANDSF to which EPCs an access
network is connected as described in 3GPP TS 24.312 [13]. Additionally, any
technology specific means can be employed to acquire such information, but
these are out of scope of this specification.
### 5.2.2 Generic EPC network selection procedure over non-3GPP access
#### 5.2.2.1 Identification of the EPC
The identification of EPC shall be based on one of the following:
\- PLMN-Id (i.e. pair of MCC+MNC), as specified in 3GPP TS 23.003 [3]; or
\- Home/Visited Network Realm/Domain, as specified in 3GPP TS 23.003 [3].
#### 5.2.2.2 EPC network selection
##### 5.2.2.2.1 UE selection modes
Two modes of EPC network selection are defined, manual and automatic. The UE
shall select the EPC network according to the selected operating mode.
##### 5.2.2.2.2 Manual EPC network selection
The UE shall present the list of available EPC networks, to which connectivity
is provided through the selected non-3GPP access network, to the user. If
UE\'s HPLMN or PLMNs equivalent to it are in this list, they shall be shown in
the highest ranking order. The ordering of the rest of entries in the list is
implementation dependent. If available, the UE should display names and/or
realms/domains.
If multiple equivalent HPLMNs are available, then the display order among them
is UE implementation specific.
##### 5.2.2.2.3 Automatic EPC network selection
The UE may use locally stored data for selecting between EPC networks
available for connectivity via the currently selected non-3GPP access network.
The UE shall select a PLMN according to the PLMN selection procedures of the
selected non-3GPP access network.
Additional criteria are out of scope of this specification and remain
implementation specific.
### 5.2.3 Access technology specific EPC network selection procedures
#### 5.2.3.1 EPC network selection procedures for WiMAX
##### 5.2.3.1.1 Identification of the EPC by the WiMAX access network
With WiMAX as a non-3GPP access network, the WiMAX NSP is mapped onto the EPC
network operator. The NSP indication can be provided to the UE in accordance
to WiMAX Forum Network Architecture Release 1.0 version 1.2 [25]. The WiMAX
access network should advertise the NSP identity of the EPC in the MCC, MNC
format.
##### 5.2.3.1.2 EPC network selection
##### 5.2.3.1.2.1 UE selection modes {#ue-selection-modes-1 .H6}
There are two modes of network selection, namely, manual network selection and
automatic network selection. The UE shall follow one of the following two
procedures depending on its operating mode.
##### 5.2.3.1.2.2 Manual EPC network selection {#manual-epc-network-
selection-1 .H6}
The manual network selection for WiMAX access shall follow the WiMAX Forum
Network Architecture Release 1.0 version 1.2 -- Stage 3 [25] with the
following exceptions and additions:
\- When presenting the list of available networks for user selection, the UE
shall provide the network name of the related MCC + MNC pair. If that is not
possible, the UE shall provide the MCC + MNC pair; and
\- If the UE is unable to register to the user selected NSP, further UE action
is implementation dependent.
##### 5.2.3.1.2.3 Automatic EPC network selection {#automatic-epc-network-
selection-1 .H6}
The automatic network selection for WiMAX access shall follow the WiMAX Forum
Network Architecture Release 1.0 version 1.2 -- Stage 3 [25] without any
exceptions or additions.
#### 5.2.3.2 EPC network selection procedures for WLAN
##### 5.2.3.2.1 UE selection modes
There are two modes of service provider selection, namely, manual service
provider selection and automatic service provider selection.
The UE follows one of the following two procedures defined in clause 5.2.3.2.2
and 5.2.3.2.3 depending on its implementation.
The service provider selected in accordance with these procedures determines
the WLAN that is selected. When the selected WLAN is a trusted WLAN IP access
and the UE decides to access EPC via S2a using trusted WLAN IP access, the UE
shall derive a NAI from the identity of the selected service provider and use
the NAI as the identity for authentication and authorization with the service
provider and usage of the WLAN (see clause 6.4).
##### 5.2.3.2.1A Service provider solicitation
The UE shall determine which service providers are available from the
available list of WLANs as constructed using the WLAN selection procedure
described in clause 5.1.3.2.3 using following procedures:
i) the UE selects a WLAN from the list of selected WLAN(s) constructed using
the WLAN selection procedure described in clause 5.1.3.2.3;
ii) if the WLAN selected in step i):
a) supports ANQP specified in IEEE Std 802.11 [57] and if the UE did not
obtain a list of realms using ANQP in clause 5.1.3.2.3.3 item 1, the UE sends
an ANQP request for a list of realms (i.e. ANQP-elements \"NAI Realm\") and/or
PLMN identities (i.e. ANQP-element \"3GPP Cellular Network\"); and
NOTE 1: The UE uses procedures defined in IEEE Std 802.11 [57] to determine if
the WLAN supports ANQP and to send the ANQP query request for ANQP-elements
\"NAI Realm\" and/or \"3GPP Cellular Network\", as specified in IEEE Std
802.11 [57].
b) does not support ANQP (see IEEE Std 802.11 [57]) or the UE does not receive
a list of realms in item a), an EAP-Request/Identity is received and the EAP-
request/Identity does not include one or more of realms and/or PLMN identities
of service providers (encoded in accordance with IETF RFC 4284 [60]), the UE
supports IEEE 802.1x authentication (see IEEE Std 802.1X™-2010 [61]), the UE
shall request a list of realms and/or PLMN identities of service providers
interworking with that WLAN by sending the EAP-Response/Identity message
including as identity the alternative NAI; and
iii) the UE repeats this procedure for all WLANs from the available list of
WLANs as constructed using the WLAN selection procedure described in clause
5.1.3.2.3.
NOTE 2: The list with realms and/or PLMN identities of service providers
received in accordance with procedures in IETF RFC 4284 [60], is of limited
size and might not contain all the realms and/or PLMN identities of service
providers available via the WLAN.
The UE shall convert any received PLMN identities into PLMN realms using the
rules defined in 3GPP TS 23.003 [3].
##### 5.2.3.2.2 Manual Service Provider selection mode procedure
The UE indicates to the user the service providers which are available for
WLAN. The UE may obtain the service providers available for WLAN using
procedures as described in clause 5.2.3.2.1A. The UE will select the service
provider based on the user preference.
##### 5.2.3.2.3 Automatic mode service provider selection procedure
The purpose of this procedure is to:
\- select a service provider over WLAN; and
\- construct a NAI for use with authentication signalling with the selected
service provider in order for the UE to be authorised to use the WLAN.
If the RAN rules control the WLAN access selection and traffic routing as
described in clause 6.10.2:
\- if the RPLMN or an equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS
24.008 [46]) is available as described in clause 5.2.3.2.1A via a WLAN from
the selected WLAN(s) constructed using the WLAN selection procedure described
in clause 5.1.3.2.3, the highest priority service provider is the RPLMN or an
equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS 24.008 [46]);
\- if the RPLMN and an equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS
24.008 [46]) are not available as described in clause 5.2.3.2.1A via a WLAN
from the selected WLAN(s) constructed using the WLAN selection procedure
described in clause 5.1.3.2.3 and Home PLMN or an EHPLMN is available, the
highest priority service provider is Home PLMN or an EHPLMN; and
\- if the RPLMN, an equivalent PLMN (see 3GPP TS 24.301 [10] or 3GPP TS 24.008
[46]), Home PLMN and an EHPLMN are not available as described in clause
52.3.2.1A via a WLAN from the selected WLAN(s) constructed using the WLAN
selection procedure described in clause 5.1.3.2.3, the highest priority
service provider is a PLMN selected in an implementation-dependent way.
If the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, a service provider is the highest priority service
provider if the service provider is available via a WLAN from the selected
WLAN(s) constructed using the WLAN selection procedure described in clause
5.1.3.2.3 and if:
i) the service provider is selected in item 3; or
ii) the conditions in item 3 are not met, and:
\- the service provider is the HPLMN;
\- the service provider is an equivalent home service provider (i.e. the
service provider\'s realm matches a realm in the EquivalentHomeSPs as
specified in 3GPP TS 24.312 [13]); or
\- no WLAN of the selected WLAN(s) provides access to a higher priority
service provider.
Until the highest priority service provider is found, the UE shall verify if a
service provider available over a WLAN of the selected WLAN(s) is the highest
priority service provider:
1) Void
2) Using the service providers which are available for WLAN as described in
clause 5.2.3.2.1A, the UE uses the PLMN realms as the service provider realms
in the remaining steps of this clause.
3) If the following conditions are fulfilled:
\- the \"3GPP RPLMN preferred\" indicator is configured to prioritize 3GPP
RPLMN; and
\- the realm of the RPLMN or the realm of an equivalent visited service
provider included in the EquivalentVisitedSPs as specified in 3GPP TS 24.312
[13] is included in the list of realms created in clause 5.2.3.2.1A, step ii);
then the UE shall select the RPLMN or the equivalent visited service provider.
The RPLMN shall be selected with higher priority than the equivalent visited
service provider. If the RPLMN is selected, the UE shall convert the RPLMN
identity into selected PLMN realm using the rules defined in 3GPP TS 23.003
[3] and use it as the service provider realms in the remaining steps of this
clause.
4) if the condition in step 3) is not satisfied, the UE shall select a service
provider in the following order:
i) HPLMN matching a realm in the list of realms received in step ii) as
described in clause 5.2.3.2.1A;
ii) realm found both in the list of realms received in step ii) as described
in clause 5.2.3.2.1A and in the EquivalentHomeSPs as specified in 3GPP TS
24.312 [13]; and
iii) realm found both in the list of realms received in step ii) as described
in clause 5.2.3.2.1A and in the PSPL as specified in 3GPP TS 24.312 [13] with
the priority higher than any other service provider\'s priority indicated as
available via the WLAN.
If a UE used the procedures in IETF RFC 4284 [60] (see clause 5.2.3.2.1A) to
obtain a list of service providers, then the UE is only required to select the
HPLMN (if available) or an available equivalent home service provider.
NOTE 1: A UE using procedures in IETF RFC 4284 [60] to obtain a list of
service providers is only required to select the HPLMN (if available) or an
available equivalent home service provider. If the UE selects another service
provider, the UE could be roaming even though the HPLMN or equivalent home
service provider is available at the access point.
The UE shall select the WLAN providing access to the highest priority service
provider.
If a highest priority service provider could not be determined, the UE
proceeds in implementation-dependent way.
The UE shall construct a NAI for authentication with the highest priority
service provider as described in 3GPP TS 23.003 [3]. Specifically, the UE
constructs the:
a) root NAI corresponding to the HPLMN, if the highest priority service
provider is the HPLMN advertised using a PLMN identity;
b) decorated NAI with double decoration including the realm of the highest
priority service provider and the realm of the RPLMN, if the highest priority
service provider is an equivalent visited service provider; or
c) decorated NAI including the realm of the highest priority service provider,
otherwise.
NOTE 2: UE implementation can optimize the steps described above, e.g. by
combining the ANQP procedures described in clause 5.2.3.2.1A with the ANQP
procedures in clause 5.1.3.2.3.3.
## 5.3 Access Network reselection
### 5.3.1 General
The network reselection procedure shall be executed based on the user\'s
request or the operator\'s policy. Such operator policy for supporting network
reselection can be provided by the ANDSF or can be pre-provisioned in the UE.
### 5.3.2 UE procedures
The UE may retrieve information from ANDSF, which includes available access
network and operator\'s policy as specified in clause 6.8.2.
The information which is retrieved from the ANDSF shall not impact the PLMN
selection and reselection procedures specified in 3GPP TS 23.122 [4]. For WLAN
access, the UE configured with a WLANSP rule specified in 3GPP TS 24.312 [13],
shall use the access network selection procedure and a PLMN selection
procedure defined in this document which are different from and shall not be
used in conjunction with the procedures for I-WLAN access specified in 3GPP TS
24.234 [9].
The network reselection procedure can be in automatic mode or manual mode
dependent on UE configuration settings. For WiMAX access, the manual mode
reselection shall follow the behaviour described in clause 5.2.3.1.2.2 and the
automatic mode reselection shall follow the behaviour described in clause
5.2.3.1.2.3.
If the RAN rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, if the UE receives move-traffic-to-WLAN
indication, along with the list of the WLAN identifiers as described in clause
6.10.4, the UE shall perform the procedure in clause 6.10.4.
### 5.3.3 EPC procedures
The ANDSF shall send available access network(s) and operator\'s policy to the
UE in response to the UE\'s request or based on the network triggers as
specified in clause 6.8.2.
### 5.3.4 Periodic EPC network reselection attempts
In automatic mode, when UE is not in its HPLMN or one of its equivalent
HPLMNs, the UE shall make a periodic attempt to return to its HPLMN or one of
its equivalent HPLMNs. For this purpose the timer value given in the
EF~HPPLMN~ as defined in 3GPP TS 31.102 [45] shall be used with the following
exceptions:-
\- For UE accessing the EPC via cdma2000^®^ HRPD access networks, the UE\'s
search for a more preferred system shall abide by the parameters and
procedures defined in 3GPP2 C.S0016 [23a].
\- For UE accessing the EPC via WiMAX access networks, the time period between
periodic network searches is implementation specific.
\- For UE accessing the EPC via any other non-3GPP access networks, unless the
UE has availability to EF~HPPLMN~, the time period between periodic network
searches is implementation specific but shall not be less than 30 minutes.
# 5.4 Data traffic routing of IP flows
### 5.4.1 General
In regards to the routing of IP flows, 3GPP TS 23.402 [6] defines the
following UE capabilities: IFOM capability, inter-APN routing capability, NSWO
capability and MAPCON capability. Any of these capabilities can be enabled and
disabled via UE configuration means outside of the scope of this document. A
capability that exists and has not been disabled is considered as supported. A
capability that does not exist or the existing capability that has been
disabled is considered as not supported.
A UE can have several sets of information about access technologies or access
networks or both to assist in determining the data traffic routing of IP
flows. These sets of information are:
\- the Inter-APN Routing policies. The IARP can be statically provisioned in
the UE. Additionally, the IARP can be provided by the H-ANDSF. The UE shall
ignore the IARP received from the V-ANDSF;
\- the Inter-System Routing policies. The ISRP can be statically provisioned
in the UE or it can be provided by the H-ANDSF or the V-ANDSF or both;
\- the Local Operating Environment Information. The Local Operating
Environment Information can be optionally generated by the UE locally and the
contents of Local Operating Environment Information is implementation
dependant;
\- user preference settings;
\- the RAN assistance information (including OPI);
\- the measurements corresponding to the thresholds in the RAN assistance
information; and
\- indications received from access stratum as described in clause 6.10.4.
This clause describes the relationship amongst these information sets and how
they are used in order to route data traffic of IP flows. The Local Operating
Environment Information does not apply to MAPCON rules in this version of the
specification.
### 5.4.2 Access technology or access network selection
#### 5.4.2.1 ANDSF rules control the WLAN access selection and traffic routing
This clause applies if the ANDSF rules control the WLAN access selection and
traffic routing as described in clause 6.10.2.
When selecting the access technologies or access networks or both to route the
data traffic of IP flows:
1) if a UE supporting IFOM or non-seamless WLAN offload is provided with user
preferences and has IARP rule for NSWO, ISRP or Local Operating Environment
Information or any combination of them, the user preference settings shall
take precedence over IARP rule for NSWO (if present), ISRP (if present) and
Local Operating Environment Information (if present).
2) if a UE supporting IFOM or non-seamless WLAN offload hasIARP rule for NSWO,
ISRP and Local Operating Environment Information and no user preference
settings and if based on the content of Local Operating Environment the UE
decides that an access technology or access network or both do not meet
implementation specific criteria for routing data traffic of a specific IP
flow, the UE may exclude that access technology or access network or both when
deciding on the routing of the data traffic for those IP flows.
3) if a UE supporting IFOM or non-seamless WLAN offload having Local Operating
Environment Information but no available ISRP, IARP rule for NSWO and no user
preference settings, the UE may evaluate the available access technologies or
access networks against the Local Operating Environment Information.
When a UE supporting MAPCON selects the access technologies or access networks
or both, to route the data traffic of a specific APN, the user preference
settings shall take precedence over ISRP (if present) and IARP rule (if
present).
The user preference settings shall take precedence over IARP (if present).
#### 5.4.2.2 RAN rules control the WLAN access selection and traffic routing
Access technology or access network selection procedures in clause 6.10.4
apply if the RAN rules control the WLAN access selection and traffic routing
as described in clause 6.10.2.
# 6 UE -- EPC Network protocols
## 6.1 General
## 6.2 Trusted and Untrusted Accesses
### 6.2.1 General
For a UE, the trust relationship of a non-3GPP IP access network is determined
by the home PLMN operator. That trust relationship is indicated to the UE via
the following methods:
\- Pre-configured policies in the UE by the home PLMN operator.
\- Dynamic indication during 3GPP-based access authentication.
**For a trusted non-3GPP IP access network, t** he UE shall follow the access
methods given in clause 6.4. **For an untrusted non-3GPP IP access network,
the** UE shall follow the access methods given in clause 6.5.
If the dynamic trust relationship indication is received during 3GPP-based
access authentication, the UE shall rely on the dynamic trust relationship
indication. Otherwise the UE shall follow the pre-configured policies for a
specific non-3GPP access network. If no dynamic indicator is received, and no
pre-configured policy matches a specific non-3GPP access network where the UE
attempts to access, the UE shall follow the procedure defined in clause 6.2.4.
### 6.2.2 Pre-configured policies in the UE
The following types of policies can be pre-configured on the UE by the home
PLMN operator:
\- Pre-configured trust relationship policies for specific non-3GPP access
technologies and/or PLMNs. For example, the UE may be configured to use the
procedures for trusted access networks as described in clause 6.4 as follows:
\- an access network of access technology X1 from PLMN Y1 is trusted; and/or
\- any access network of access technology X2 is trusted; and/or
\- any access network from PLMN Y2 is trusted; and/or
\- any access network is trusted.
The format of the pre-configured policies is not specified in this release of
this specification.
### 6.2.3 Dynamic Indication
If the UE performs 3GPP-based access authentication, the 3GPP AAA server may
send a trust relationship indicator of the non-3GPP access network to the UE
during the EAP-AKA, EAP-AKA\' or EAP-3GPP-LimitedService based access
authentication (i.e. EAP-AKA, EAP-AKA\' or EAP-3GPP-LimitedService) as
specified in 3GPP TS 33.402 [15]. If non-3GPP access network is trusted, the
3GPP AAA server shall send this trust relationship indicator as specified in
3GPP TS 29.273 [17]. The indicator is sent using a AT_TRUST_IND attribute, by
extending the EAP-AKA (and EAP-AKA\' and EAP-3GPP-LimitedService) protocol as
specified in clause 8.2 of IETF RFC 4187 [33]. This attribute is provided in
EAP-Request/AKA-Challenge or EAP- Request/AKA\'-Challenge or EAP-Request/3GPP-
LimitedService-Init-Info message payload respectively. The detailed coding of
this attribute is described in clause 8.2.3.1.
### 6.2.4 No trust relationship information
If no dynamic indicator is received, and no pre-configured policies matches a
specific non-3GPP access network where the UE attempts to access, the UE shall
consider it as untrusted network and operate based on clause 6.5.
## 6.3 IP Mobility Mode Selection
### 6.3.1 General
The IP mobility mechanisms supported between 3GPP and non-3GPP accesses within
an operator and its roaming partner\'s network may be based on either:
a) Static Configuration; or
b) Dynamic Configuration.
The choice between a) and b) depends upon operators\' preferences or roaming
agreement or both.
### 6.3.2 Static configuration of inter-access mobility mechanism
For networks deploying a single IP mobility management mechanism, the
statically configured mobility mechanism can be access type or roaming
agreement specific or both. The information about the mechanism to be used in
such scenario is expected to be provisioned into the terminal and the network.
In static configuration, if there is a mismatch between the IP mobility mode
mechanism parameters pre-configured in the network and in the UE, the UE may
not be able to access the EPC. If the UE is able to access the EPC even if
there is a mismatch between the IP mobility mode mechanisms, the network may
not be able to provide session continuity for the UE. More details of the
possible cases of mismatch between the IP mobility mode mechanism are
described in the informative annex D.
If the network is configured with a static mobility mechanism and the AAA
server implements protocol extensions for a dynamic IP Mobility Mode Selection
(IPMS) exchange, the AAA server shall send to the UE an AT_RESULT_IND
attribute during the authentication procedure as it is described in clause
6.3.3.1.2.
### 6.3.3 Dynamic configuration of inter-access mobility mechanism
#### 6.3.3.0 General
Dynamic IP Mobility Mode Selection (IPMS) consists of:
\- IP mobility management protocol selection between Network Based Mobility
(NBM), DSMIPv6 or MIPv4; and
\- Decision on IP address preservation if NBM is selected
Upon initial attachment to a non-3GPP access and upon handoff to non-3GPP
accesses, the UE performs IPMS by providing an indication during network
access authentication for EPC. For trusted access, the indication is provided
before an IP address is allocated to the UE, while in untrusted access
network, the indication is provided during IKEv2 signalling for IPSec tunnel
establishment with the ePDG.
When the UE provides an explicit indication for IPMS, then the network shall
provide the indication to the UE identifying the selected mobility management
mechanism.
When the dynamic IP mobility mode selection is used if the UE does not receive
any indication of a selected mobility protocol after the UE provided an
explicit indication, it is considered as an abnormal case and the UE may not
get connectivity to the EPC.
NOTE: The scenarios for mobility mode selection are described in clause 4.1.3
of 3GPP TS 23.402 [6].
#### 6.3.3.1 IPMS indication
##### 6.3.3.1.1 IPMS indication from UE to 3GPP AAA server
During network access authentication, UE may provide an explicit indication to
the 3GPP AAA server about the supported mobility protocol by using an
attribute in the EAP-AKA and EAP-AKA\' protocols, to extend these protocols as
specified in clause 8.2 of IETF RFC 4187 [33]. This attribute is provided in
EAP-Response/AKA-Challenge and corresponding EAP-AKA\' message payload.
The UE may provide the indication for IPMS using AT_IPMS_IND attribute in EAP-
AKA or EAP-AKA\' if the UE receives the AT_RESULT_IND attribute within the
EAP-Request/AKA-Challenge message, or the EAP-Request/AKA\'-Challenge message
(when EAP-AKA\' is used). If the UE provides the AT_IPMS_IND attribute within
the EAP-Response/AKA-Challenge message payload or within the EAP-
Response/AKA\'-Challenge message payload (when EAP-AKA\' is used), the UE
shall also provide the AT_RESULT_IND attribute within the message.
If the UE supports IPMS indication, it shall indicate support for one or more
mobility protocols in AT_IPMS_IND attribute as follows:
\- the UE shall indicate support for DSMIPv6 if the UE supports DSMIPv6; and
\- the UE shall indicate support for MIPv4 if the UE supports MIPv4; and
\- during initial attach, the UE should indicate support for NBM if the UE
supports address preservation based on NBM between the access it is attaching
to and all other accesses that the UE supports.; or
\- upon handover, the UE shall indicate support for NBM if the UE supports
address preservation based on NBM while moving from source access network to
target non-3GPP access network that the UE is attaching to.
NOTE: The UE can be configured not to use IPMS indication, e.g. the UE is
DSMIP capable only.
If the UE does not support any mobility protocol then the UE shall not send
the AT_IPMS_IND attribute to the 3GPP AAA server.
The preference of protocol may be indicated based on the policies configured
on the UE. The detailed coding of this attribute is described in clause
8.2.1.1.
##### 6.3.3.1.2 IPMS indication from 3GPP AAA server to UE
A 3GPP AAA server supporting IPMS shall include the AT_RESULT_IND attribute
within the EAP-Request/AKA-Challenge and corresponding EAP-AKA\' message
payload.
If the UE provided an explicit indication as described in clause 6.3.3, the
3GPP AAA server shall inform the UE of its decision on the mobility protocol
and IP preservation mode by invoking an EAP-Request/AKA-Notification dialogue
when EAP-AKA is used or an EAP-Request/AKA\'-Notification dialogue when EAP-
AKA\' is used.
On selecting the mobility protocol based on UE indication, access network
capabilities and network policies, the 3GPP AAA server shall indicate the
selected protocol to the UE by using the AT_IPMS_RES attribute. If the 3GPP
AAA server does not receive any indication from the UE but knows the UE\'s
policies allow the usage of NBM and knows the home and access network supports
NBM, the network shall use NBM shall be used for providing connectivity to the
UE.
If the AT_IPMS_RES attribute indicates DSMIPv6 then the UE shall follow the
procedures defined in 3GPP TS 24.303 [11].
If the AT_IPMS_RES attribute indicates MIPv4 support, then the UE shall follow
the procedures defined in 3GPP TS 24.304 [12].
The detailed coding of this attribute is described in clause 8.2.1.2.
## 6.4 Authentication and authorization for accessing EPC via a trusted
non-3GPP access network
### 6.4.1 General
For access to the EPC via a trusted non-3GPP access network, a connection
shall be established between the UE and the trusted non-3GPP access network
using signalling procedures specific to the trusted non-3GPP access network,
which are out of scope of this present document.
Access authentication signalling for access to the EPC shall be executed
between the UE and 3GPP AAA server to ensure mutual authentication of the user
and the EPC, with the exception of UEs without IMSI (see clauses 4.4.1 and
6.6.3.2) or UEs initiating emergency session but whose IMSI authentication
cannot proceed. Such authentication is based on IETF protocols as specified in
3GPP TS 33.402 [15].
EAP-AKA\' is used for access authentication in the trusted access network,
according to 3GPP TS 33.402 [15], clause 6.2. According to 3GPP TS 33.402
[15], clause 6.1, EAP-AKA\' can be skipped if conditions listed in clause
9.2.2.1 or conditions described in clause 13.4 of 3GPP TS 33.402 [15] are met.
If the access network does not support EAP-AKA or EAP-AKA\' and the UE
considers the access network as trusted, the UE shall access to the EPC only
via S2c and any authentication method (EAP-based or otherwise) can be used for
access authentication as long as the criteria set in 3GPP TS 33.402 [15],
clause 9.2.2.1 are met.
When the UE decides to access EPC via S2c using non-3GPP IP access, EAP-AKA
authentication is performed between the UE and the PDN-GW as specified in 3GPP
TS 24.303 [11] and 3GPP TS 33.402 [15].
The UE may support ERP as described in IETF RFC 6696 [71] and 3GPP TS 33.402
[15]. In this release of this specification, only the ERP Implicit
Bootstrapping mode defined in IETF RFC 6696 [71] is supported.
After a UE successfully completes authentication and authorization for
accessing EPC via the trusted non-3GPP access network, the UE may receive as
part of an ANQP query to the access point, an ANQP-element in a protected
frame with management frame protection enabled. If the ANQP-element is an
Emergency Call Number ANQP-element encoded in accordance with Annex I, the UE
considers the content of the Emergency Call Number field valid.
### 6.4.1A TWAN connection modes
As part of EAP-AKA\' authentication via TWAN or EAP-3GPP-LimitedService
authentication via TWAN, the UE and the network can negotiate usage of either
the single-connection mode (SCM) or the multi-connection mode (MCM) as
described in 3GPP TS 23.402 [6].
NOTE: UE requesting neither SCM nor MCM acts in transparent single-connection
mode (TSCM). No UE extensions are needed for TSCM.
The negotiation consists of the following steps:
a) The 3GPP AAA server indicates support of TSCM, SCM, MCM or any combination
of them as described in clause 6.4.3.5.
b) The UE requests usage of SCM or MCM as described in clause 6.4.2.6.2 and
clause 6.4.2.6.3, acts in TSCM or aborts the EAP authentication as described
in clause 6.4.2.6.4.
c) The 3GPP AAA server either accepts or rejects the UE request as described
in clause 6.4.3.5.
If EAP-AKA\' authentication is skipped during emergency call via TWAN for
unauthenticated UEs and the EAP-3GPP-LimitedService authentication via TWAN is
performed, the UE and the network can negotiate usage of either the single-
connection mode (SCM) or the multi-connection mode (MCM) as follows:
a) The 3GPP AAA server indicates support of SCM, MCM or any combination of
them as described in clause 6.4.3.5.1A.
b) The UE requests usage of SCM or MCM as described in clause 6.4.2.6.2A and
clause 6.4.2.6.3A, or aborts the EAP authentication as described in clause
6.4.2.6.4.
c) The 3GPP AAA server either accepts or rejects the UE request as described
in clause 6.4.3.5.
### 6.4.2 UE procedures
#### 6.4.2.1 Identity Management
The user identities to be used by the UE in the authentication and
authorization for accessing EPC via a trusted non-3GPP access are the Root-NAI
(permanent identity), decorated NAI, Fast-Reauthentication NAI (Fast-
Reauthentication Identity) and Pseudonym Identity and these identities are
described in clause 4.4.
If the UE supports ERP, the identity to be used by the UE during the re-
authentication procedure using ERP is the \"KeyName-NAI\" as described in 3GPP
TS 23.003 [3].
#### 6.4.2.1A Identity Management - emergency session
When initiating emergency session via trusted non-3GPP access, if the UE has
no valid subscriber data available (USIM not available, or USIM is considered
invalid by the UE), the UE shall provide its IMEI in an EAP Response/Identity
message based on emergency NAI format specified in 3GPP TS 23.003 [3].
If the UE receives EAP-Request/3GPP-LimitedService-Init-Info message from the
network requesting IMEI, the UE provides IMEI as specified in clause 6.4.2.7.
#### 6.4.2.2 EAP-AKA and EAP-AKA\' based Authentication
The UE shall support EAP-AKA based authentication as specified in IETF RFC
4187 [33] and EAP-AKA\' based authentication as specified in _IETF RFC 5448_
_[38]._ 3GPP TS 33.402 [15] specifies the conditions under which one or the
other of these two methods is used.
During network access authentication, the UE may provide an explicit
indication for IPMS by adding an attribute in the EAP-AKA or EAP-AKA\' payload
as defined in clause 6.3.3.
During network access authentication, the 3GPP AAA server may provide the ANID
to the UE, see clause 6.4.2.4.
For WLAN access, after the UE has been successfully authenticated from WLAN,
if the UE receives EAP-Request/AKA\'-Notification dialogue with
AT_NOTIFICATION attribute value 1031 \"User has not subscribed to the
requested service\" as defined in IETF RFC 4187 [33], the UE shall not
initiate the EPC access procedure to the same WLAN until switching off or the
UICC containing the USIM is removed.
NOTE: Switching off and USIM change conditions are implemented taking into
consideration the user experience aspect.
#### 6.4.2.3 Full Authentication and Fast Re-authentication
The UE shall support both full authentication and fast re-authentication for
EAP AKA as specified in IETF RFC 4187 [33] and for EAP-AKA\' as specified in
_IETF RFC 5448_  _[38]_.
Full authentication is performed to generate new keys. The initial
authentication shall be a full authentication as specified in 3GPP TS 33.402
[15]. For a full authentication either the Permanent Identity or the Pseudonym
Identity is used.
According to 3GPP TS 33.402 [15] the fast re-authentication procedure uses the
Fast Re-authentication Identity and is used for renewing the session keys.
The Permanent Identity is based on the IMSI of the UE. The Fast Re-
authentication Identity is provided to the UE by the 3GPP AAA server during
the previous authentication procedure. The UE shall use the Fast Re-
authentication Identity only once. A Pseudonym Identity provided to the UE by
the 3GPP AAA Server during a previous authentication procedure can be reused
in later authentications until the UE receives a new Pseudonym identity from
the 3GPP AAA Server.
NOTE: The 3GPP AAA Server will assign a new Pseudonym Identity with a
frequency dictated by operator\'s policy. The allocation of new pseudonyms is
required to prevent that the user\'s movements are tracked by an unauthorized
party.
If during an authentication request, the UE receives an EAP-Request/AKA-
Identity message containing AT_PERMANENT_ID_REQ, the UE shall return the
Permanent Identity in the AT_IDENTITY attribute of the EAP-
Response/AKA_Identity. If the UE receives an EAP-Request/AKA\'-Identity
message containing AT_PERMANENT_ID_REQ, the UE shall return the Permanent
Identity in the AT_IDENTITY attribute of the EAP- Response /AKA\'-Identity
message.
If during an authentication request, the UE receives an EAP-Request/AKA-
Identity message which contains AT_FULLAUTH_ID_REQ, the UE shall return the
Pseudonym Identity as the AT_IDENTITY within EAP-Response/AKA_Identity message
if available. If the UE receives an EAP-Request/AKA\'-Identity message
containing AT_FULLAUTH_ID_REQ, the UE shall return the Pseudonym Identity as
the AT_IDENTITY within the EAP- Response /AKA\'-Identity message if available.
Otherwise the UE shall return the Permanent Identity.
If during an authentication request, the UE receives an EAP-Request/AKA-
Identity message or EAP-Request/AKA\'-Identity message respectively, which
contains AT_ANY_ID_REQ, the UE shall return the Fast Re-authentication
Identity if available as the AT_IDENTITY. Otherwise the UE shall return the
Pseudonym Identity.
If the UE\'s USIM file indicates that the UE is a UE configured for high
priority access in the selected PLMN as specified in 3GPP TS 31.102 [35], the
UE shall inform the TWAN by returning an AT_HPA_INFO element in the EAP-
response as defined in clause 8.2.11.
#### 6.4.2.4 Handling of the Access Network Identity
##### 6.4.2.4.1 General
The 3GPP AAA server provides the UE with the ANID in EAP signalling. The UE
can also obtain the ANID by access network specific means, which are out of
scope of the present document. For some access networks the ANID can also be
configured into the UE and the 3GPP AAA server.
NOTE: According to 3GPP TS 33.402 [15], the ANID is used by HSS and UE to
generate transformed authentication vectors and therefore the ANID needs to be
identical in the HSS and in the UE. The trusted non-3GPP access network first
sends the ANID to the 3GPP AAA server via the STa reference point and the 3GPP
AAA server sends the ANID to HSS via the SWx reference point, see 3GPP TS
29.273 [17], and to the UE as specified in this specification.
##### 6.4.2.4.2 ANID indication from 3GPP AAA server to UE
When the 3GPP AAA server sends an EAP Request\' or AKA-Challenge\' message to
the UE, the 3GPP AAA server shall include the ANID to be used when generating
transformed authentication vectors, using the AT_KDF_INPUT attribute as
described in clause 8.2.2. The value and coding of this attribute is described
in clause 8.1.1.
##### 6.4.2.4.3 UE check of ANID for HRPD CDMA 2000® access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a eHRPD network, the locally determined
ANID is \"HRPD\". If the comparison check is successful and if either the
optional access network authorization decision in the UE is positive or is not
performed, the UE shall proceed; otherwise the UE shall abort the access
procedure.
##### 6.4.2.4.4 UE check of ANID for WiMAX access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a WiMAX access network, the locally
determined ANID is \"WIMAX\". If the comparison check is successful and if
either the optional access network authorization decision in the UE is
positive or is not performed, the UE shall proceed; otherwise the UE shall
abort the access procedure.
##### 6.4.2.4.5 UE check of ANID for WLAN access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a WLAN network, the locally determined
ANID is \"WLAN\". If the comparison check is successful and if either the
optional access network authorization decision in the UE is positive or is not
performed, the UE shall proceed; otherwise the UE shall abort the access
procedure.
##### 6.4.2.4.6 UE check of ANID for ETHERNET access networks
The UE shall apply the rules for comparison of the locally determined ANID and
the one received over EAP-AKA\' as specified in _IETF RFC 5448_ [38]. The UE,
or the user, may use the ANID as a basis for an optional decision whether the
access network is authorized to serve the UE. E.g. the UE may compare the ANID
against a list of preferred or barred ANIDs.
When the UE can locally determine based on physical layer or access network
procedures that the UE is connected to a Ethernet network, the locally
determined ANID is \"ETHERNET\". If the comparison check is successful and if
either the optional access network authorization decision in the UE is
positive or is not performed, the UE shall proceed; otherwise the UE shall
abort the access procedure.
#### 6.4.2.5 Full name for network and short name for network
When receiving the EAP-Request/AKA-Challenge message when the EAP-AKA is used
or the EAP-Request/AKA\'-Challenge message when the EAP-AKA\' is used, and the
AT_FULL_NAME_FOR_NETWORK attribute, the AT_SHORT_NAME_FOR_NETWORK attribute or
both are included, then the UE may use the contents to update appropriate
information stored within the UE.
#### 6.4.2.6 TWAN connection modes
##### 6.4.2.6.1 General
The UE may support SCM. The UE may support MCM.
NOTE 1: The UE is allowed to support both MCM and SCM. The UE is allowed to
support neither MCM nor SCM.
NOTE 2: No UE extensions are needed for TSCM.
##### 6.4.2.6.2 Usage of single-connection mode (SCM)
If:
a) the UE supports the SCM;
b) the EAP-Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE
attribute as described in clause 8.2.7.1 wherein the message field as
described in clause 8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field:
A) including the CONNECTION_MODE_CAPABILITY item as described in clause
8.1.4.8 indicating support of SCM; and
B) if the UE requests an emergency attach or an emergency handover, including
the CONNECTION_MODE_CAPABILITY item as described in clause 8.1.4.8 indicating
that emergency services are supported; and
c) the UE requests usage of the SCM;
then the UE:
a) shall include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1
in the EAP-Response/AKA\'-Challenge message. In the message field according to
clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the UE shall:
1) set the message type field to SCM_REQUEST; and
2) in the item list field:
A) include a CONNECTIVITY_TYPE item according to clause 8.1.4.3 indicating the
requested connectivity type - PDN connection, or NSWO; and
B) if a PDN connection is requested:
i) include a ATTACHMENT_TYPE item according to clause 8.1.4.4 indicating
whether an initial attach, a handover attach, an emergency attach, or an
emergency handover is requested;
ii) if a PDN connection for an APN other than the default APN is requested and
either an initial attach or a handover attach is requested, include an APN
item according to clause 8.1.4.5 indicating the requested APN;
iii) if the initial attach or the emergency attach is requested, include a
PDN_TYPE item according to clause 8.1.4.6 indicating the requested PDN type;
iv) if the handover attach or the emergency handover is requested, include a
PDN_TYPE item according to clause 8.1.4.6 indicating the PDN type supported in
the PDN connection to be handed over; and
v) if the UE wishes to transmit (protocol) data (e.g. configuration
parameters, error codes or messages/events) to the network, include a
PROTOCOL_CONFIGURATION_OPTIONS item according to clause 8.1.4.9; and
b) if a PDN connection is requested, shall include the AT_RESULT_IND attribute
in the EAP-Response/AKA\'-Challenge message.
NOTE 1: If the UE does not include the AT_RESULT_IND attribute in the EAP-
Response/AKA\'-Challenge message, in case of successful authentication, then
EAP-Request/AKA\'-Notification message is not received and the UE is only
informed about success using EAP-Success.
Upon receiving the EAP-Request/AKA\'-Notification message including the
AT_TWAN_CONN_MODE attribute as described in clause 8.2.7.1 wherein the message
field as described in clause 8.1.4.1:
\- contains the message type field indicating SCM_RESPONSE; and
\- contains the item list field;
the UE:
a) if the AT_NOTIFICATION attribute indicates success, shall determine the
authorized connectivity type in the CONNECTIVITY_TYPE item as described in
clause 8.1.4.3 included in the item list field. If the authorized connectivity
type is PDN connection, the UE:
1) if the initial attach, or the handover attach is requested, shall determine
the selected APN in the APN item as described in clause 8.1.4.5 included in
the item list field;
2) shall determine the PDN type supported in the PDN connection in the
PDN_TYPE item as described in clause 8.1.4.6 included in the item list field;
3) if a PROTOCOL_CONFIGURATION_OPTIONS item as described in clause 8.1.4.9 is
included in the item list field, shall determine the protocol configuration
options in the PROTOCOL_CONFIGURATION_OPTIONS item;
4) if a IPV4_ADDRESS item as described in clause 8.1.4.11 is included in the
item list field, shall determine the IPv4 address allocated to the UE for the
PDN connection in the IPV4_ADDRESS item;
5) if a IPV6_INTERFACE_IDENTIFIER item as described in clause 8.1.4.12 is
included in the item list field, shall determine the IPv6 interface identifier
allocated to the UE for the PDN connection in the IPV6_INTERFACE_IDENTIFIER
item and shall use it when building the IPv6 link local address; and
6) shall determine the TWAG user plane MAC address in the TWAG_UP_MAC_ADDRESS
item as described in clause 8.1.4.14 included in the item list field, and
shall use the TWAG user plane MAC address for encapsulating user plane packets
according to 3GPP TS 23.402 [6]; and
b) if the AT_NOTIFICATION attribute indicates failure with value 0 \"General
failure after authentication\" or value 16384 - \"General failure\" as defined
in IETF RFC 4187 [33] and the ACCESS_CAUSE item is included:
1) shall determine the cause of failure in the ACCESS_CAUSE item as described
in clause 8.1.4.17 included the item list field:
2) if the initial attach, or the handover attach is requested, and the cause
of failure is #2 \"Non-3GPP access to EPC not allowed\" as defined in clause
8.1.4.17, shall not retry the authentication procedure to any WLANs until
switching off or the UICC containing the USIM is removed;
3) if the cause of failure is #11 \"PLMN _NOT_ALLOWED\" as defined in clause
8.1.4.17, shall not retry the authentication procedure from the same PLMN via
WLANs according to the network selection procedures as defined in clause
5.2.2;
4) if the initial attach, or the handover attach is requested, and the cause
of failure is #3 \"RAT type not allowed\" as defined in clause 8.1.4.17, the
UE shall not retry the authentication procedure to any WLANs until switching
off or the UICC containing the USIM is removed;
5) if the cause of failure is #6 \"Illegal ME\" as defined in clause 8.1.4.17,
shall not retry the authentication procedure from the same PLMN until
switching off or the UICC containing the USIM is removed; and
NOTE 2: Switching off and USIM change conditions are implemented taking into
consideration the user experience aspect.
c) if the AT_NOTIFICATION attribute indicates failure as defined in bullet b)
and the CAUSE item is included:
1) shall determine the cause of failure in the CAUSE item as described in
clause 8.1.4.10 included the item list field;
2) if the initial attach, or the handover attach is requested, the cause of
failure is #26 \"Insufficient resources\" and the Tw1 item is included in the
item list field, shall take different actions depending on the timer value
received in the Tw1 item as follows:
A) if the timer value indicates neither zero nor deactivated, shall stop timer
Tw1 associated with the corresponding APN, if it is running. The UE shall
start timer Tw1 (see 3GPP TS 24.244 [56]) with the value provided in the Tw1
value IE and not send another SCM_REQUEST message with the CONNECTIVITY_TYPE
item indicating PDN connection and with APN item indicating the same APN until
timer Tw1 expires, the timer Tw1 is stopped, or the USIM is removed;
B) if the timer value indicates that this timer is deactivated, shall not send
another SCM_REQUEST message with the CONNECTIVITY_TYPE item indicating PDN
connection and with APN item indicating the same APN until the UE is switched
off or the USIM is removed;
C) if the timer value indicates zero, may send another SCM_REQUEST message
with the CONNECTIVITY_TYPE item indicating PDN connection and with APN item
indicating the same APN; and
D) if the WLAN radio is disabled when the timer Tw1 is running and if the USIM
in the UE remains the same when the WLAN radio is enabled, shall behave as
follows when the WLAN radio is enabled:
\- let t1 be the time remaining for Tw1 timeout when the WLAN radio was
disabled and let t be the time elapsed since the WLAN radio was disabled until
the WLAN radio was enabled. If t1 is greater than t, then the timer shall be
restarted with the value t1 -- t. If t1 is equal to or less than t, then the
timer need not be restarted. If the UE is not capable of determining t, then
the UE shall restart the timer with the value t1;
3) if the cause of failure is #26 \"Insufficient resources\" and the Tw1 item
is not included in the item list field, may send a SCM_REQUEST message with
the CONNECTIVITY_TYPE item indicating PDN connection and with APN item
indicating the same APN;
4) if the initial attach, or the handover attach is requested, and the cause
of failure is #38 \"Network failure\" as defined in clause 8.1.4.10.2:
A) if the Tw1 item is included in the item list field, shall behave as
follows:
i) if the timer value received in the Tw1 item indicates neither zero nor
deactivated, shall start the Tw2 timer with the timer value provided in the
Tw1 item, and shall not try again until the backoff timer expires or the UE is
switched off or the UICC containing the USIM is removed;
ii) if the timer value received in the Tw1 item indicates that this timer is
deactivated, shall not try again until the UE is switched off or the UICC
containing the USIM is removed; and
iii) if the timer value received in the Tw1 item indicates zero, may send
another SCM_REQUEST message with the CONNECTIVITY_TYPE item indicating PDN
connection and with APN item indicating the same APN; and
B) if the Tw1 item is not included in the item list field, shall start an
implementation specific backoff timer and not try again until the backoff
timer expires or the UE is switched off or the UICC containing the USIM is
removed; and
NOTE 3: Existing Tw1 item can be reused by the network to provide back off
timer value to start Tw2 timer.
5) if the initial attach, or the handover attach is requested, and the cause
of failure is #27 \"Unknown APN\" as defined in clause 8.1.4.10.2:
a) if the Tw1 item is included in the item list field, shall behave as
follows:
i) if the timer value received in the Tw1 item indicates neither zero nor
deactivated, shall start the Tw2 timer with the timer value provided in the
Tw1 item, and shall not send another SCM_REQUEST message with the
CONNECTIVITY_TYPE item indicating PDN connection and with APN item indicating
the same APN to the same PLMN until the backoff timer expires or the UE is
switched off or the UICC containing the USIM is removed;
ii) if the timer value received in the Tw1 item indicates that this timer is
deactivated, shall not send another SCM_REQUEST message with the
CONNECTIVITY_TYPE item indicating PDN connection and with APN item indicating
the same APN to the same PLMN until the UE is switched off or the UICC
containing the USIM is removed; and
iii) if the timer value received in the Tw1 item indicates zero, may send
another SCM_REQUEST message with the CONNECTIVITY_TYPE item indicating PDN
connection and with APN item indicating the same APN; and
b) if the Tw1 item is not included in the item list field, shall not retry the
authentication procedure with the same WLAN for the same APN to the same PLMN
until the UE is switched off or the UICC containing the USIM is removed,
unless the UE has an implementation specific backoff timer. In that case, the
UE shall not retry until that implementation specific timer expires.
##### 6.4.2.6.2A Usage of single-connection mode (SCM) - emergency
If the UE needs to establish an IMS emergency session over trusted WLAN
access, the UE shall:
1) if the UE already has active PDN connection, the UE shall detach first (see
3GPP TS 23.402 [6]) and then follow item 2) below to start initial attach
procedure for emergency service; and
2) if the UE does not have an active PDN connection and requests usage of the
SCM, the UE shall start initial attach procedure for emergency service using
the procedures specified in clause 6.4.2.6.2. In addition,
a) upon receiving EAP-Request/AKA\'-Challenge message:
\- if the CONNECTION_MODE_CAPABILITY item in the item list field indicates
support of emergency services, the UE shall respond with the EAP-
Response/AKA\'-Challenge message with the ATTACHMENT_TYPE item in the item
list field set to \"emergency attach\" or \"emergency handover\"; or
\- if the CONNECTION_MODE_CAPABILITY item in the item list field does not
indicate support of emergency services, the UE shall respond with the EAP-
Response/AKA\'-Client-Error message as described in clause 6.4.2.6.4. The UE
shall re-initiate initial attach procedure for emergency service by selecting
a different WLAN supporting emergency service; or
b) upon receiving EAP-Request/3GPP-LimitedService-Init-Info message including
the AT_TWAN_CONN_MODE attribute with the message type of message field
indicating CONNECTION_CAPABILITY and message field contains
CONNECTION_MODE_CAPABILITY item in the item list field indicating support of
SCM and emergency services,
\- if the UE supports the SCM and requests the usage of the SCM, the UE shall
respond with the EAP-Response/3GPP-LimitedService-Init-Info message and shall
include the AT_TWAN_CONN_MODE attribute with the message type field set to
SCM_REQUEST and in the item list field shall:
i) include a ATTACHMENT_TYPE item indicating whether an emergency attach or
emergency handover is requested;
ii) if emergency attach is requested, include a PDN_TYPE item according to
clause 8.1.4.6 indicating the requested PDN type;
iii) if emergency handover attach is requested, include a PDN_TYPE item
according to clause 8.1.4.6 indicating the PDN type supported in the PDN
connection to be handed over; and
iv) if the UE wishes to transmit (protocol) data (e.g. configuration
parameters, error codes or messages/events) to the network, include a
PROTOCOL_CONFIGURATION_OPTIONS item according to clause 8.1.4.9; and
c) upon receiving the EAP-Request/3GPP-LimitedService-Notif message including
the AT_TWAN_CONN_MODE attribute with the message type field of the message
field indicating SCM_RESPONSE and the item list field:
\- the UE shall:
i) determine the PDN type supported in the PDN connection in the PDN_TYPE item
as described in clause 8.1.4.6 included in the item list field;
ii) determine the protocol configuration options in the
PROTOCOL_CONFIGURATION_OPTIONS item if a PROTOCOL_CONFIGURATION_OPTIONS item
as described in clause 8.1.4.9 is included in the item list field;
iii) if a IPV4_ADDRESS item as described in clause 8.1.4.11 is included in the
item list field, determine the IPv4 address allocated to the UE for the PDN
connection in the IPV4_ADDRESS item;
iv) if a IPV6_INTERFACE_IDENTIFIER item as described in clause 8.1.4.12 is
included in the item list field, determine the IPv6 interface identifier
allocated to the UE for the PDN connection in the IPV6_INTERFACE_IDENTIFIER
item and use it when building the IPv6 link local address; and
v) determine the TWAG user plane MAC address in the TWAG_UP_MAC_ADDRESS item
as described in clause 8.1.4.14 included in the item list field, and use the
TWAG user plane MAC address for encapsulating user plane packets according to
3GPP TS 23.402 [6]; and
d) if the UE had requested emergency attach or emergency handover of an
emergency session, upon receiving the EAP-Request/AKA\'-Notification message,
if the AT_NOTIFICATION attribute indicates failure, the UE shall detach and
then perform initial attach procedure for emergency service by selecting a
different WLAN supporting emergency service.
##### 6.4.2.6.3 Usage of multi-connection mode (MCM)
If:
a) the UE supports the MCM;
b) the EAP-Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE
attribute as described in clause 8.2.7.1 wherein the message field as
described in clause 8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field:
A) including the CONNECTION_MODE_CAPABILITY item as described in clause
8.1.4.8 indicating support of MCM;
B) including the SUPPORTED_WLCP_TRANSPORTS item as described in clause
8.1.4.15; and
C) if the UE requests an emergency attach or an emergency handover, including
the CONNECTION_MODE_CAPABILITY item as described in clause 8.1.4.8 indicating
that emergency services are supported;
c) at least one WLCP transport indicated as supported in the
SUPPORTED_WLCP_TRANSPORTS item is also supported by the UE; and
d) the UE requests usage of the MCM;
then the UE:
a) shall include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1
in the EAP-Response/AKA\'-Challenge message. In the message field according to
clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the UE:
1) shall set the message type field to MCM_REQUEST; and
2) in the item list field:
A) if the UE requests an emergency attach or an emergency handover, shall
include an ATTACHMENT_TYPE item according to clause 8.1.4.4 indicating whether
an emergency attach, or an emergency handover is requested; and
b) shall include the AT_RESULT_IND attribute in the EAP-
Response/AKA\'-Challenge message.
Upon receiving the EAP-Request/AKA\'-Notification message including the
AT_TWAN_CONN_MODE attribute as described in clause 8.2.7.1 where the message
field as described in clause 8.1.4.1:
\- contains the message type field indicating MCM_RESPONSE; and
\- contains the item list field;
the UE:
a) if the AT_NOTIFICATION attribute indicates success:
1) shall determine the NSWO authorization in the AUTHORIZATIONS item as
described in clause 8.1.4.7 included in the item list field;
2) shall determine the TWAG control plane address(es) in the TWAG_CP_ADDRESS
item as described in clause 8.1.4.13 included in the item list field; and
3) shall derive the WLCP key as described in Annex A.3 in 3GPP TS 33.402 [15];
and
NOTE: After receiving EAP Success message terminating the EAP procedures after
successful authentication and authorization for MCM access to EPC, the UE
establishes a DTLS connection with the TWAG and initiates WLCP procedures
according to 3GPP TS 24.244 [56].
b) if the AT_NOTIFICATION attribute indicates failure, shall determine the
cause of failure in the ACCESS_CAUSE or CAUSE item as described in clause
8.1.4.17 and 8.1.4.10 included in the item list field.
##### 6.4.2.6.3A Usage of multi-connection mode (MCM) - emergency
If the UE needs to establish an IMS emergency session over trusted WLAN
access, the UE shall:
1) if the UE already has active PDN connection:
\- if the TWAN does not supports emergency service, the UE shall detach first
and then follow item 2) below to start initial attach procedure for emergency
service and selecting a WLAN supporting Emergency service; or
\- if the connected TWAN supports emergency service, the UE shall initiate PDN
connectivity establishment procedures as specified in 3GPP TS 24.244 [56].
2) if the UE does not have an active PDN connection and requests usage of the
MCM, the UE shall start initial attach procedure for emergency service using
the procedures specified in clause 6.4.2.6.3. In addition,
a) upon receiving EAP-Request/AKA\'-Challenge message:
\- if the CONNECTION_MODE_CAPABILITY item in the item list field indicates
support of emergency services, the UE shall respond with the EAP-
Response/AKA\'-Challenge message with the ATTACHMENT_TYPE item in the item
list field set to \"emergency attach\" or \"emergency handover\"; or
\- if the CONNECTION_MODE_CAPABILITY item in the item list field does not
indicate support of emergency services, the UE shall respond with the EAP-
Response/AKA\'-Client-Error message as described in clause 6.4.2.6.4. The UE
shall re-initiate initial attach procedure for emergency service by selecting
a different WLAN supporting emergency service; or
b) upon receiving EAP-Request/3GPP-LimitedService-Init-Info message including
the AT_TWAN_CONN_MODE attribute with the message type of message field
indicating CONNECTION_CAPABILITY and message field contains
CONNECTION_MODE_CAPABILITY item in the item list field indicating support of
MCM and emergency services,
\- if the UE supports the MCM and requests the usage of the MCM and
i) message field of the AT_TWAN_CONN_MODE attribute contains
SUPPORTED_WLCP_TRANSPORTS item as described in clause 8.1.4.15; and
ii) at least one WLCP transport indicated as supported in the
SUPPORTED_WLCP_TRANSPORTS item is also supported by the UE,
the UE shall respond with the EAP-Response/3GPP-LimitedService-Init-Info
message and shall:
i) include the AT_TWAN_CONN_MODE attribute with the message type field set to
MCM_REQUEST;
c) upon receiving the EAP-Request/3GPP-LimitedService-Notif message including
the AT_TWAN_CONN_MODE attribute with the message type of message field
indicating MCM_RESPONSE and the item list field:
\- the UE shall:
i) determine the TWAG control plane address(es) in the TWAG_CP_ADDRESS item as
described in clause 8.1.4.13 included in the item list field;
ii) derive the WLCP key as described in Annex A.3 in 3GPP TS 33.402 [15].
NOTE: After receiving EAP Success message terminating the EAP procedures after
successful authentication and authorization for MCM access to EPC, the UE
establishes a DTLS connection with the TWAG and initiates WLCP procedures
according to 3GPP TS 24.244 [56].
d) if the UE had requested emergency attach or emergency handover of an
emergency session, upon receiving the EAP-Request/AKA\'-Notification message,
if the AT_NOTIFICATION attribute indicates failure, the UE shall detach and
then perform initial attach procedure for emergency service by selecting a
different WLAN supporting emergency service.
##### 6.4.2.6.3B Usage of transparent single-connection mode (TSCM) -
emergency
The emergency session is not supported for the UE using TSCM mode.
NOTE: If the UE in TSCM mode already has active PDN connection, the UE remains
connected.
##### 6.4.2.6.4 Network support not available
If the EAP-Request/AKA\'-Challenge message does not include the
AT_TWAN_CONN_MODE attribute as described in clause 8.2.7.1, then only TSCM is
available.
If the UE supports SCM, the UE does not support MCM, and the EAP-
Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE attribute as
described in clause 8.2.7.1 wherein the message field as described in clause
8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field including the CONNECTION_MODE_CAPABILITY item
as described in clause 8.1.4.8 not indicating support of SCM;
then only TSCM is available.
If the UE does not support SCM, the UE supports MCM, and the EAP-
Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE attribute as
described in clause 8.2.7.1 wherein the message field as described in clause
8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field including the CONNECTION_MODE_CAPABILITY item
as described in clause 8.1.4.8 not indicating support of MCM;
then only TSCM is available.
If the UE does not support SCM, the UE supports MCM, the EAP-
Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE attribute as
described in clause 8.2.7.1 wherein the message field as described in clause
8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field:
A) including the CONNECTION_MODE_CAPABILITY item as described in clause
8.1.4.8 indicating support of MCM; and
B) including the SUPPORTED_WLCP_TRANSPORTS item as described in clause
8.1.4.15;
and none of the WLCP transport indicated as supported in the
SUPPORTED_WLCP_TRANSPORTS item is also supported by the UE, then only TSCM is
available.
If only TSCM is available:
a) if the UE does not request an emergency attach, the UE does not request an
emergency handover and the UE is willing to use TSCM, the UE shall act as in
TSCM; and
b) if the UE requests an emergency attach or the UE requests an emergency
handover or the UE is unwilling to use TSCM, the UE shall send EAP-
Response/AKA\'-Client-Error message.
NOTE: In TSCM, successful EAP-AKA\' authentication triggers creation of a PDN
connection to the default APN. The UE can be unwilling to use the PDN
connection to the default APN e.g. because the UE needs to perform handover of
a PDN connection, because the UE needs to establish a PDN connection to an APN
other than the default APN, because the UE needs to establish multiple PDN
connections, or because the UE has no usage for the PDN connection to the
default APN and wants to avoid any possible charges related to the PDN
connection to the default APN.
If the UE requests an emergency attach or an emergency handover, and the EAP-
Request/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE attribute as
described in clause 8.2.7.1 wherein the message field as described in clause
8.1.4.1:
1) contains the message type field indicating CONNECTION_CAPABILITY; and
2) contains the item list field including the CONNECTION_MODE_CAPABILITY item
as described in clause 8.1.4.8 not indicating support of emergency services;
then the UE shall send EAP-Response/AKA\'-Client-Error message.
#### 6.4.2.7 Mobile Equipment Identity Signalling
If the UE receives:
\- an EAP-Request/AKA\'-Challenge message; or
\- an EAP-Request/3GPP-LimitedService-Init-Info message;
containing the AT_DEVICE_IDENTITY attribute and the Identity Type field of the
received AT_DEVICE_IDENTITY attribute is set to either \'IMEI\' or \'IMEISV\'
and the Identity Value field is empty, then if the UE\'s Mobile Equipment
Identity IMEI or IMEISV is available, the UE shall include IMEI or IMEISV in
the AT_DEVICE_IDENTITY attribute in:
\- the EAP-Response/AKA\'-Challenge message; or
\- the EAP-Response/3GPP-LimitedService-Init-Info message;
as follows:
\- if IMEISV are available, the UE shall include IMEISV in the
AT_DEVICE_IDENTITY attribute. The Identity Type field of the
AT_DEVICE_IDENTITY attribute shall be set to \'IMEISV\': and
\- if IMEI is available and IMEISV is not available, the UE shall include IMEI
in the AT_DEVICE_IDENTITY attribute. The Identity Type field of the
AT_DEVICE_IDENTITY attribute shall be set to \'IMEI\'.
The AT_DEVICE_IDENTITY attribute shall be sent as an encrypted attribute and
included in the value field of the AT_ENCR_DATA attribute as described in IETF
RFC 4187 [33].
The detailed coding of the AT_DEVICE_IDENTITY attribute is described in clause
8.2.8.1.
### 6.4.3 3GPP AAA server procedures
#### 6.4.3.1 Identity Management
The 3GPP AAA selects the pseudonym identity or the Fast Re-authentication
Identity and returns the identity to the UE during the Authentication
procedure as specified in 3GPP TS 33.402 [15]. The 3GPP AAA server shall
maintain a mapping between the UE\'s permanent identity and the pseudonym
identity and between the UE\'s permanent identity and the Fast Re-
authentication Identity.
#### 6.4.3.1A Identity Management - emergency session
Upon receiving a request from the UE for emergency session establishment, if
\- IMSI is provided to the network but IMSI authentication cannot proceed or
IMSI authentication has failed or the 3GPP AAA server cannot determine if
authentication is successful; and
\- the 3GPP AAA server is configured to accept unauthenticated emergency
session over WLAN,
the 3GPP AAA server requests IMEI from the UE as specified in clause 6.4.3.6
using the EAP-Request/3GPP-LimitedService-Init-Info message.
#### 6.4.3.2 EAP-AKA and EAP-AKA\' based Authentication
The 3GPP AAA server shall support EAP AKA based authentication as specified in
IETF RFC 4187 [33] and EAP-AKA\' based authentication as specified in _IETF
RFC 5448_  _[38]._ 3GPP TS 33.402 [15] specifies the conditions under which
one or the other of these two methods is used. If the UE provides an explicit
indication for the supported mobility protocols and the network supports
multiple IP mobility mechanisms, the network shall select the protocol to be
used and communicate the decision to the UE as defined in clause 6.3.3.1.2.
For WLAN access, after the UE has been successfully authenticated and the EPC
access and Non-Seamless WLAN Offload are not authorized for the UE, the 3GPP
AAA Server shall invoke an EAP-Request/AKA\'-Notification dialogue and
indicate this to the UE by using the AT_NOTIFICATION attribute value 1031 --
\"User has not subscribed to the requested service\" as defined in IETF RFC
4187 [33].
#### 6.4.3.3 Full authentication and Fast Re-authentication
The 3GPP AAA shall support full re-authentication and fast re-authentication
as specified in IETF RFC 4187 [33].
The decision to use the fast re-authentication process is taken by the home
network (i.e. the 3GPP AAA server) and is based on operator policies. If fast
re-authentication is to be used, the home network shall indicate this to the
UE by providing the Fast Re-authentication Identity to the UE during the
authentication process.
When initiating an authentication, the home network shall indicate the type of
authentication required by including either AT_PERMANENT_ID_REQ or
AT_FULLAUTH_ID_REQ for Full authentication and AT_ANY_ID_REQ for Fast re-
authentication in the EAP-Request/AKA_Identity message or the EAP-
Request/AKA\'-Identity message respectively.
The home network (i.e. the 3GPP AAA server) may upon receiving the Fast Re-
authentication Identity in AT_IDENTITY, decide to proceed with the fast re-
authentication or choose instead to initiate a full authentication. This
decision is based on operator policies.
#### 6.4.3.4 Full name for network and short name for network
The 3GPP AAA server may include the AT_FULL_NAME_FOR_NETWORK attribute, the
AT_SHORT_NAME_FOR_NETWORK attribute or both in the EAP-Request/AKA-Challenge
message when the EAP-AKA is used and in the EAP-Request/AKA\'-Challenge
message when the EAP-AKA\' is used.
The detailed coding of the AT_FULL_NAME_FOR_NETWORK attribute and the
AT_SHORT_NAME_FOR_NETWORK is described in clause 8.2.5.
#### 6.4.3.5 TWAN connection modes
##### 6.4.3.5.1 General
The 3GPP AAA server may support the single-connection mode (SCM).
The 3GPP AAA server may support the multi-connection mode (MCM).
If the network supports SCM, MCM or both, the 3GPP AAA server shall include
the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1 and the
AT_RESULT_IND attribute in the EAP-Request/AKA\'-Challenge message. In the
message field according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute,
the 3GPP AAA server shall:
a) set the message type field to CONNECTION_CAPABILITY; and
b) in the item list field:
1) include a CONNECTION_MODE_CAPABILITY item according to clause 8.1.4.8
indicating whether the network supports TSCM, SCM, MCM or any combination of
them and indicating whether the network supports the emergency services; and
2) if the network supports MCM, include a SUPPORTED_WLCP_TRANSPORTS item
according to clause 8.1.4.15 indicating WLCP transport(s) supported by the
TWAG.
##### 6.4.3.5.1A Emergency session connection mode negotiation for
unauthenticated UEs
If the 3GPP AAA server is configured to accept unauthenticated emergency
session over WLAN and IMEI was received or IMSI was received but IMSI
authentication cannot proceed, the 3GPP AAA server shall initiate connection
mode negotiation with the UE as follows:
\- if the 3GPP AAA server supports SCM, MCM or both, the 3GPP AAA server shall
include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1 in the
EAP-Request/3GPP-LimitedService-Init-Info message. In the message field
according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the 3GPP AAA
server shall:
a) set the message type field to CONNECTION_CAPABILITY; and
b) in the item list field:
1) include a CONNECTION_MODE_CAPABILITY item according to clause 8.1.4.8
indicating whether the network supports SCM, MCM or any combination of them,
and indicating emergency service is supported; and
2) if the network supports MCM, include a SUPPORTED_WLCP_TRANSPORTS item
according to clause 8.1.4.15 indicating WLCP transport(s) supported by the
TWAG.
##### 6.4.3.5.2 Usage of single-connection mode (SCM)
If
\- the 3GPP AAA server supports SCM;
\- the EAP-Response/AKA\'-Challenge message includes the AT_TWAN_CONN_MODE
attribute as described in clause 8.2.7.1 wherein the message field as
described in clause 8.1.4.1 contains the message type field indicating
SCM_REQUEST; and
\- the authentication was successful;
then the 3GPP AAA server:
\- if the ATTACHMENT_TYPE item according to clause 8.1.4.4 indicating an
emergency attach, or an emergency handover is included in the item list field
of the message field, shall identify that the attach is for emergency
services; and
\- shall trigger the TWAN to establish the connectivity of the requested
connectivity type according to 3GPP TS 23.402 [6].
If:
\- the 3GPP AAA server authorizes the requested connectivity; and
\- the EAP-Response/AKA\'-Challenge message includes the AT_RESULT_IND
attribute;
then the 3GPP AAA server shall invoke an EAP-Request/AKA\'-Notification
dialogue. The 3GPP AAA server shall construct the EAP-
Request/AKA\'-Notification message as follows:
a) indicate success in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute described in clause 8.2.7.1. In the
message field according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute,
the 3GPP AAA server shall:
1) set the message type field to SCM_RESPONSE; and
2) in the item list field:
A) include a CONNECTIVITY_TYPE item as described in clause 8.1.4.3 indicating
the authorized connectivity type. Only one connectivity type is indicated; and
B) if a PDN connection was authorized:
i) if the initial attach, or the handover attach is requested, include an APN
item according to clause 8.1.4.5 indicating the APN of the authorized PDN
connection;
ii) include a PDN_TYPE item according to clause 8.1.4.6 indicating the PDN
type(s) selected in the authorized PDN connection;
iii) if the 3GPP AAA server wishes to transmit (protocol) data (e.g.
configuration parameters, error codes or messages/events) to the UE, include a
PROTOCOL_CONFIGURATION_OPTIONS item according to clause 8.1.4.9;
iv) if an IPv4 address is allocated to the UE for the PDN connection, include
a IPV4_ADDRESS item according to clause 8.1.4.11;
v) if an IPv6 interface identifier is allocated to the UE for the PDN
connection, include a IPV6_INTERFACE_IDENTIFIER item according to clause
8.1.4.12; and
vi) include a TWAG_UP_MAC_ADDRESS item according to clause 8.1.4.14.
If the UE is a UE configured for high priority access as specified in clause
6.4.2.3, if allowed by operator policy, the 3GPP AAA server shall not deny the
authorization for the requested connectivity due to a #26 \"Insufficient
resources\" failure unless doing so would cause system instability.
If the 3GPP AAA server does not authorize the requested connectivity and if:
\- the attach is not for emergency session; or
\- the attach is for emergency session and if the 3GPP AAA server is not
configured to accept unauthenticated emergency session over WLAN,
NOTE: The case where the 3GPP AAA server does not authorize the request but is
configured to accept unauthenticated emergency session over WLAN is specified
in clause 6.4.3.5.2A.
then the 3GPP AAA server shall invoke an EAP-Request/AKA\'-Notification
dialogue. The 3GPP AAA server shall construct the EAP-
Request/AKA\'-Notification message as follows:
a) indicate failure in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute described in clause 8.2.7.1. In the
message field according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute,
the 3GPP AAA server shall:
1) set the message type field to SCM_RESPONSE;
2) in the item list field, include an ACCESS_CAUSE or CAUSE item according to
clause 8.1.4.17 and 8.1.4.10 indicating the cause of failure;
3) if the initial attach, or the handover attach is requested, the cause of
failure is #26 \"Insufficient resources\" and a value of backoff timer is to
be provided to the UE for the PDN connection, include a Tw1 item according to
clause 8.1.4.16. If the UE is a UE configured for high priority access as
specified in clause 6.4.2.3, if allowed by operator policy, the 3GPP AAA
server shall not include a Tw1 item in the message;
3A) if the initial attach, or the handover attach is requested, the cause of
failure is #38 \"Network failure\" or #27 \"unknown APN\" and a value of
backoff timer is to be provided to the UE for the PDN connection, include a
Tw1 item according to clause 8.1.4.16;
4) if the 3GPP AAA Server receives
DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION sent by the HSS as specified in
3GPP TS 29.273 [17], indicate this to the UE by using \"Non-3GPP access to EPC
not allowed\" value in the ACCESS_CAUSE item;
5) if the 3GPP AAA Server receives DIAMETER_ERROR_ROAMING_NOT_ALLOWED sent by
the HSS as specified in 3GPP TS 29.273 [17], indicate this to the UE by using
\"PLMN not allowed\" value in the ACCESS_CAUSE item;
6) if the 3GPP AAA Server receives DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION
sent by the HSS as specified in 3GPP TS 29.273 [17], indicate this to the UE
by using #27 \"Unknown APN\" value in the CAUSE item;
7) if the 3GPP AAA Server receives DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED sent by
the HSS as specified in 3GPP TS 29.273 [17], indicate this to the UE by using
#3 \"RAT type not allowed\" value in the ACCESS_CAUSE item; and
8) if the 3GPP AAA Server receives DIAMETER_UNABLE_TO_COMPLY sent by HSS as
specified in 3GPP TS 29.273 [17], indicate this to the UE by using #38
\"Network failure\" in the CAUSE item.
##### 6.4.3.5.2A Usage of single-connection mode (SCM) - emergency
If the 3GPP AAA Server supports IMS Emergency sessions over WLAN, the 3GPP AAA
server shall:
\- if IMSI was received and IMSI authentication can proceed, the 3GPP AAA
server invokes an EAP-Request/AKA\'-Notification dialogue to indicate success
or failure to the UE as described in clause 6.4.3.5.2;
\- if IMSI was received but IMSI authentication cannot proceed, then
A) if the 3GPP AAA server is configured to accept unauthenticated emergency
session over WLAN:
a) the 3GPP AAA server sends EAP Request/3GPP-LimitedService-Init-Info message
as specified in clause 6.4.3.5.1A;
b) upon receiving the EAP-Response/3GPP-LimitedService-Init-Info message
including the AT_TWAN_CONN_MODE attribute with the message type of message
field indicating SCM_REQUEST and the item list field, the 3GPP AAA server
shall include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1 in
the EAP-Request/3GPP-LimitedService-Notif message. In the message field
according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the 3GPP AAA
server shall:
i) set the message type field to SCM_RESPONSE; and
ii) in the item list field:
1) include the PDN type supported in the PDN connection in the PDN_TYPE item
as described in clause 8.1.4.6 in the item list field;
2) include the protocol configuration options in the
PROTOCOL_CONFIGURATION_OPTIONS item if a PROTOCOL_CONFIGURATION_OPTIONS item
as described in clause 8.1.4.9 is in the item list field;
3) if an IPv4 address is allocated to the UE for the PDN connection, include a
IPV4_ADDRESS item according to clause 8.1.4.11;
4) if an IPv6 interface identifier is allocated to the UE for the PDN
connection, include a IPV6_INTERFACE_IDENTIFIER item according to clause
8.1.4.12; and
5) include a TWAG_UP_MAC_ADDRESS item according to clause 8.1.4.14; and
c) upon receiving the EAP-Response/3GPP-LimitedService-Notif message, the 3GPP
AAA server shall generate the MSK using IMEI as described in clause 13.4 in
3GPP TS 33.402 [15] and send EAP Success message to the UE to allow the UE to
proceed with emergency session establishment; or
B) if the 3GPP AAA server is not configured to accept unauthenticated
emergency session over WLAN, the 3GPP AAA server shall reject the emergency
session request and return an EAP Failure message to the UE; or
\- if IMEI was received,
A) if the 3GPP AAA server is configured to accept unauthenticated emergency
session over WLAN:
a), the 3GPP AAA server sends EAP Request/3GPP-LimitedService-Init-Info
message to as specified in clause 6.4.3.5.1A;
b) upon receiving the EAP-Response/3GPP-LimitedService-Init-Info message
including the AT_TWAN_CONN_MODE attribute with the message type of message
field indicating SCM_REQUEST and the item list field, the 3GPP AAA server
shall include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1 in
the EAP-Request/3GPP-LimitedService-Notif message. In the message field
according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the 3GPP AAA
server shall:
i) set the message type field to SCM_RESPONSE; and
ii) in the item list field:
1) include the PDN type supported in the PDN connection in the PDN_TYPE item
as described in clause 8.1.4.6 in the item list field;
2) include the protocol configuration options in the
PROTOCOL_CONFIGURATION_OPTIONS item if a PROTOCOL_CONFIGURATION_OPTIONS item
as described in clause 8.1.4.9 is in the item list field;
3) if an IPv4 address is allocated to the UE for the PDN connection, include a
IPV4_ADDRESS item according to clause 8.1.4.11;
4) if an IPv6 interface identifier is allocated to the UE for the PDN
connection, include a IPV6_INTERFACE_IDENTIFIER item according to clause
8.1.4.12; and
5) include a TWAG_UP_MAC_ADDRESS item according to clause 8.1.4.14; and
c) upon receiving the EAP-Response/3GPP-LimitedService-Notif message, the 3GPP
AAA server shall generate the MSK using IMEI as described in clause 13.4 in
3GPP TS 33.402 [15] and send EAP Success message to the UE to allow the UE to
proceed with emergency session establishment; or
B) if the 3GPP AAA server is not configured to accept unauthenticated
emergency session over WLAN, the 3GPP AAA server shall reject the emergency
session request and return an EAP Failure message to the UE.
##### 6.4.3.5.3 Usage of multi-connection mode (MCM)
If:
a) the 3GPP AAA server supports MCM;
b) if the EAP-Response/AKA\'-Challenge message includes:
1) the AT_TWAN_CONN_MODE attribute as described in clause 8.2.7.1 wherein the
message field as described in clause 8.1.4.1 contains the message type field
indicating MCM_REQUEST; and
2) the AT_RESULT_IND attribute;
c) the 3GPP AAA server authorizes the request. If the ATTACHMENT_TYPE item
according to clause 8.1.4.4 indicating an emergency attach, or an emergency
handover is included in the item list field of the message field, the 3GPP AAA
server shall identify that the attach is for emergency services; and
d) the authentication was successful;
then the 3GPP AAA server shall invoke an EAP-Request/AKA\'-Notification
dialogue. The 3GPP AAA server shall construct the EAP-
Request/AKA\'-Notification message as follows:
a) indicate success in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1. In the
message field according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute,
the 3GPP AAA server shall:
1) set the message type field to MCM_RESPONSE; and
2) in the item list field:
A) include an AUTHORIZATIONS item according to clause 8.1.4.7 indicating
whether UE is authorized to use NSWO; and
B) include a TWAG_CP_ADDRESS item according to clause 8.1.4.13 indicating the
TWAG control plane address.
If the 3GPP AAA server does not authorize the request and if
\- the attach is not for emergency services; or
\- the attach is for emergency services and if the 3GPP AAA server is not
configured to accept unauthenticated emergency session over WLAN,
NOTE: The case where the 3GPP AAA server does not authorize the request but is
configured to accept unauthenticated emergency session over WLAN is specified
in clause 6.4.3.5.3A.
then the 3GPP AAA server shall invoke an EAP-Request/AKA\'-Notification
dialogue. The 3GPP AAA server shall construct the EAP-
Request/AKA\'-Notification message as follows:
a) indicate failure in the AT_NOTIFICATION attribute; and
b) include the AT_TWAN_CONN_MODE attribute described in clause 8.2.7.1. In the
message field according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute,
the 3GPP AAA server shall:
1) set the message type field to MCM_RESPONSE;
2) in the item list field, include a ACCESS_CAUSE or CAUSE item according to
clause 8.1.4.17 and 8.1.4.10 indicating the cause of failure;
3) if the 3GPP AAA Server receives
DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION sent by the HSS as specified in
3GPP TS 29.273 [17], indicate this to the UE by using \"Non-3GPP access to EPC
not allowed\" value in the ACCESS_CAUSE item;
4) if the 3GPP AAA Server receives DIAMETER_ERROR_ROAMING_NOT_ALLOWED sent by
the HSS as specified in 3GPP TS 29.273 [17], indicate this to the UE by using
\"PLMN not allowed\" value in the ACCESS_CAUSE item;
5) if the 3GPP AAA Server receives DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION
sent by the HSS as specified in 3GPP TS 29.273 [17], indicate this to the UE
by using #27 \"Unknown APN\" value in the CAUSE item;
6) if the 3GPP AAA Server receives DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED sent by
the HSS as specified in 3GPP TS 29.273 [17], indicate this to the UE by using
#3 \"RAT type not allowed\" value in the ACCESS_CAUSE item; and
7) if the 3GPP AAA Server receives DIAMETER_UNABLE_TO_COMPLY sent by HSS as
specified in 3GPP TS 29.273 [17], indicate this to the UE by using #38
\"Network failure\" in the CAUSE item.
##### 6.4.3.5.3A Usage of multi-connection mode (MCM) - emergency
If the 3GPP AAA Server supports IMS Emergency sessions over WLAN, the 3GPP AAA
server shall:
\- if IMSI was received and IMSI authentication can proceed, the 3GPP AAA
server invokes an EAP-Request/AKA\'-Notification dialogue to indicate success
to the UE as described in clause 6.4.3.5.3;
\- if IMSI was received but IMSI authentication cannot proceed, then
A) if the 3GPP AAA server is configured to accept unauthenticated emergency
session over WLAN:
a), the 3GPP AAA server sends EAP Request/3GPP-LimitedService-Init-Info
message as specified in clause 6.4.3.5.1A;
b) upon receiving the EAP-Response/3GPP-LimitedService-Init-Info message
including the AT_TWAN_CONN_MODE attribute with the message type of message
field indicating SCM_REQUEST and the item list field, the 3GPP AAA server
shall include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1 in
the EAP-Request/3GPP-LimitedService-Notif message. In the message field
according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the 3GPP AAA
server shall:
i) set the message type field to SCM_RESPONSE; and
ii) in the item list field:
1) include the TWAG control plane address(es) in the TWAG_CP_ADDRESS item as
described in clause 8.1.4.13 in the item list field; and
c) upon receiving the EAP-Response/3GPP-LimitedService-Notif message, the 3GPP
AAA server shall generate the MSK using IMEI as described in clause 13.4 in
3GPP TS 33.402 [15] and send EAP Success message to the UE to allow the UE to
proceed with emergency session establishment; or
B) if the 3GPP AAA server is not configured to accept unauthenticated
emergency session over WLAN, the 3GPP AAA server shall reject the emergency
session request and return an EAP Failure message to the UE; or
\- if IMEI was received,
A) if the 3GPP AAA server is configured to accept unauthenticated emergency
session over WLAN:
a), the 3GPP AAA server sends EAP Request/3GPP-LimitedService-Init-Info
message as specified in clause 6.4.3.5.1A;
b) upon receiving the EAP-Response/3GPP-LimitedService-Init-Info message
including the AT_TWAN_CONN_MODE attribute with the message type of message
field indicating MCM_REQUEST and the item list field, the 3GPP AAA server
shall include the AT_TWAN_CONN_MODE attribute according to clause 8.2.7.1 in
the EAP-Request/3GPP-LimitedService-Notif message. In the message field
according to clause 8.1.4.1 of the AT_TWAN_CONN_MODE attribute, the 3GPP AAA
server shall:
i) set the message type field to MCM_RESPONSE; and
ii) in the item list field:
1) include the TWAG control plane address(es) in the TWAG_CP_ADDRESS item as
described in clause 8.1.4.13 in the item list field; and
c) upon receiving the EAP-Response/3GPP-LimitedService-Notif message, the 3GPP
AAA server shall generate the MSK using IMEI as described in clause 13.4 in
3GPP TS 33.402 [15] and send EAP Success message to the UE to allow the UE to
proceed with emergency session establishment; or
B) if the 3GPP AAA server is not configured to accept unauthenticated
emergency session over WLAN, the 3GPP AAA server shall reject the emergency
session request and return an EAP Failure message to the UE.
##### 6.4.3.5.3B Usage of transparent single-connection mode (TSCM) -
emergency
The emergency session is not supported for the UE using TSCM mode.
##### 6.4.3.5.4 Network support not available
NOTE: If the network does not support a TWAN connection mode and the UE needs
to request usage of the not supported TWAN connection mode, upon sending EAP-
Request/AKA\'-Challenge message, the network receives EAP-
Response/AKA\'-Client-Error message. Handling defined in _IETF RFC 5448_
_[38]_ applies for the EAP-Response/AKA\'-Client-Error message.
#### 6.4.3.6 Mobile Equipment Identity Signalling
If the network supports Mobile Equipment Identity signalling over trusted
WLAN, the 3GPP AAA server shall include the AT_DEVICE_IDENTITY attribute in:
\- the EAP-Request/AKA\'-Challenge message; or
\- the EAP-Request/3GPP-LimitedService-Init-Info message;
with the Identity Type field set to either \'IMEI\' or \'IMEISV\' and an empty
Identity Value field to request the UE to provide the Mobile Equipment
Identity indicated in the Identity Type.
Upon receiving:
\- the EAP-Response/AKA\'-Challenge message; or
\- the EAP-Response/3GPP-LimitedService-Init-Info message;
from the UE, if the AT_DEVICE_IDENTITY attribute is included and Identity Type
field is set to either \'IMEI\' or \'IMEISV\', then the 3GPP AAA server shall
forward the received Mobile Equipment Identity to the TWAN as specified in
3GPP TS 29.273 [17].
### 6.4.4 Multiple PDN support for trusted non-3GPP access
Connectivity to multiple PDNs via trusted non-3GPP access is supported in the
EPS when the network policies, the non-3GPP access and the user subscription
allow it.
NOTE 1: In 3GPP, there is a limitation to the maximum number of simultaneous
PDN connections per UE caused by the number of EPS bearer identities (see
clause 11.2.3.1.5 of 3GPP TS 24.007 [48]). Not complying with this limitation
when accessing non-3GPP access can lead to unexpected consequences, e.g.
connectivity loss in case of handover to 3GPP access. The maximum number of
PDN connection via trusted non-3GPP access is independent from the maximum
number of active EPS bearer contexts for 3GPP access (see clause 6.5.1A of
3GPP TS 24.301 [10]).
If the UE supports dynamic mobility management selection the UE shall use the
same mobility protocol when multiple connections are established, see 3GPP TS
23.402 [6].
When the UE accesses EPC via S2a using trusted non-3GPP IP access and
establishes connections to additional PDNs, the UE shall send a trigger for
additional PDN connectivity specific to the non-3GPP access. The UE shall
include an APN in this trigger to connect to the desired PDN. The UE shall
also indicate the Attach Type to the trusted non-3GPP access during additional
PDN connectivity. The Attach Type shall distinguish between Initial Attach and
Handover Attach. For the multi-connection mode used via trusted WLAN access
network, the PDN connection establishment procedures are specified in 3GPP TS
24.244 [56].
NOTE 2: The indication about Attach Type is non-3GPP access network specific
and its coding is out of scope of this specification.
NOTE 3: The trigger for additional PDN connectivity is non-3GPP access network
specific and its coding is out of scope of this specification.
When the UE accesses EPC via S2c using non-3GPP IP access, the UE shall follow
the procedures described in 3GPP TS 24.303 [11] to connect to multiple PDNs.
If the UE accesses EPC via S2a using non-3GPP IP access and it is handing over
from a source access network to a target non-3GPP IP access and the UE has
more than one PDN connection to a given APN in the source access network, the
UE shall transfer all the PDN connections for the given APN to the target
trusted non-3GPP access network as specified in 3GPP TS 23.402 [6].
If multiple PDN connections to a single APN are not supported over the target
trusted non-3GPP access network, only one PDN connection to the given APN
shall be established in the target non-3GPP access as specified in 3GPP TS
23.402 [6]. If multiple PDN connection requests to the same APN are received
but the target trusted non-3GPP access network does not support multiple PDN
connections to the same APN, the network shall reject the additional PDN
connection requests to the same APN received from the UE when one PDN
connection to the same APN has already been established. The UE shall
determine which PDN connection is re-established in the non-3GPP access based
on the home address information (i.e. IPv4 address or IPv6 prefix or both)
provided by the network.
NOTE 4: The protocol details of the PDN connection reject procedure is
non-3GPP access network specific and its coding is outside the scope of this
specification. For the multi-connection mode used via trusted WLAN access
network, the protocol details of the PDN connection reject procedure is
specified in 3GPP TS 24.244 [56]
NOTE 5: When UE supporting IP address preservation for NBM with multiple PDN
connections to the same APN hands over to the non-3GPP access network, the UE
can, as an implementation option, prioritise the re-establishment for a
particular PDN connection before re-establishing the remaining PDN
connections. The way a UE prioritizes a particular PDN connection is non-3GPP
access network specific and its coding is out of scope of this specification.
Another implementation option can be to send multiple re-establishment
requests concurrently.
NOTE 6: Any unsuccessful re-establishment of any of the multiple PDN
connections to the same APN can be managed in an implementation specific
manner avoiding UE making repeated re-establishment attempts to the network.
If the UE did not handover all the PDN connections for a given APN to the
target trusted non-3GPP access network, the network may disconnect the
remaining PDN connections for that given APN after an implementation dependent
time.
## 6.5 Authentication and authorization for accessing EPC via an untrusted
non-3GPP access network
### 6.5.1 General
In order to attach to the evolved packet core network (EPC) via untrusted
non-3GPP IP access, the UE first needs to be configured with a local IP
address from the untrusted non-3GPP access network.
During the attach to the untrusted non-3GPP access, the operator of the
non-3GPP access network may optionally require to perform a 3GPP based access
authentication as specified in 3GPP TS 33.402 [15].
Once the UE is configured with a local IP address, the UE shall select the
Evolved Packet Data Gateway (ePDG) as described in clause 7.2.1 and shall
initiate the IPsec tunnel establishment procedure as described in clause
7.2.2. During these steps authentication and authorization for access to EPC
shall be performed.
### 6.5.2 Full authentication and authorization
#### 6.5.2.1 General
During the establishment of the IPSec tunnel between the UE and the ePDG, 3GPP
based authentication signalling for untrusted non-3GPP access to the EPC shall
be exchanged between the UE and the 3GPP AAA server in the EPC to ensure
mutual authentication of the user and the EPC.
Authorization of EPC access shall be performed by the 3GPP AAA server upon
successful user authentication.
The access authentication signalling between the UE, ePDG and the 3GPP AAA
server shall be based on EAP-AKA as specified in IETF RFC 4187 [33] and is
further detailed in 3GPP TS 33.402 [15], 3GPP TS 29.273 [17] and procedural
descriptions in clauses 6.5.2.2, 6.5.2.4 and 6.5.2.3.
#### 6.5.2.2 UE procedures
##### 6.5.2.2.1 General
When accessing the EPC via the ePDG, the UE shall exchange EAP-AKA signalling
with the 3GPP AAA server as specified in 3GPP TS 33.402 [15].
NOTE: the EAP payload exchanged between UE and 3GPP AAA server is transported
within the IKEv2 messages exchanged with ePDG as described in clause 7.2.2.
After the UE has been successfully authenticated, if the UE receives EAP-
Request/AKA-Notification dialogue with AT_NOTIFICATION attribute value 1031 --
\"User has not subscribed to the requested service\" as defined in IETF RFC
4187 [33], the UE shall not initiate the EPC access procedure to same ePDG
until switching off or the UICC containing the USIM is removed.
NOTE: Swittching off and USIM change conditions are implemented taking into
consideration the user experience aspect.
##### 6.5.2.2.2 EAP AKA
##### 6.5.2.2.2.1 Identity management {#identity-management-2 .H6}
The support of user identity privacy as defined in IETF RFC 4187 [33] and
based on temporary identity is mandatory for the UE.
As defined in 3GPP TS 33.402 [15], the UE sends the user identity (in the IDi
payload) in the first message of the IKE_AUTH phase. The user identity sent by
the UE in the IDi payload depends on the presence of the temporary identity as
defined in IETF RFC 4187 [33]:
\- If valid fast re-authentication identity is available, the UE shall use the
fast re-authentication NAI;
\- Otherwise if valid pseudonym is available, the UE shall use the pseudonym
NAI;
\- Otherwise the UE shall use the permanent IMSI-based or IMEI-based NAI.
The temporary identities shall be in the form of a NAI, as specified in 3GPP
TS 23.003 [3] clause 19. The permanent identity shall be in the form of a NAI
in which username is derived from IMSI or IMEI as defined in 3GPP TS 23.003
[3]. IETF RFC 4187 [33] defines the leading digits to identify the
authentication mechanism. The leading digit defined for EAP-AKA authentication
shall be used in the NAI for both the temporary identities and the permanent
identity.
The UE after successful EAP authentication may store the new temporary
identity(ies) received in AT_ENCR_DATA attribute together with the fast re-
authentication parameters (new master key, transient EAP keys and counter
value) in the non-volatile memory of the UE or in the USIM as specified in
3GPP TS 31.102 [45]. In this later case the pseudonym is stored in the
\"Pseudonym\" data file and the fast re-authentication identity, new master
key, transient EAP keys and counter value in the \"Re-authentication
identity\" data file.
If no new temporary identity was received in AT_ENCR_DATA attribute of a
successful EAP authentication, the stored temporary identity becomes invalid
and the UE shall not send this temporary identity at the next EAP
authentication. In case the temporary identity is stored in the USIM, the UE
shall set the username of the corresponding temporary identity field to the
\"deleted\" value (hexadecimal value FF) to indicate that this temporary
identity is invalid as specified in 3GPP TS 23.003 [3].
##### 6.5.2.2.2.2 Protected result indications {#protected-result-indications
.H6}
The UE shall support protected result indications (i.e. MAC protected) as
specified in IETF RFC 4187 [33].
#### 6.5.2.3 3GPP AAA server procedures
##### 6.5.2.3.1 General
During the authentication of the UE for accessing the EPC via the ePDG, the
3GPP AAA server shall initiate EAP-AKA based authentication with the UE as
specified in 3GPP TS 33.402 [15].
After the UE has been successfully authenticated and the EPC access is not
authorized for the UE, the 3GPP AAA Server shall invoke an EAP-Request/AKA-
Notification dialogue and indicate this to the UE by using the AT_NOTIFICATION
attribute value 1031 -- \"User has not subscribed to the requested service\"
as defined in IETF RFC 4187 [33].
##### 6.5.2.3.2 EAP-AKA
##### 6.5.2.3.2.1 Identity management {#identity-management-3 .H6}
The support of user identity privacy is mandatory for the 3GPP AAA server. The
usage of this feature depends on operator\'s policies.
If user identity privacy is used, the 3GPP AAA server shall send new encrypted
temporary identity (pseudonym and/ or fast re-authentication identity) to the
UE in every EAP authentication procedure. The 3GPP AAA selects the pseudonym
identity or the Fast Re-authentication Identity and returns the identity to
the UE during the Authentication procedure as specified in 3GPP TS 33.402
[15]. The 3GPP AAA server shall maintain a mapping between the UE\'s permanent
identity and the pseudonym identity and between the UE\'s permanent identity
and the Fast Re-authentication Identity.
##### 6.5.2.3.2.2 EAP AKA based authentication {#eap-aka-based-authentication
.H6}
The 3GPP AAA server shall support EAP AKA based authentication as specified in
IETF RFC 4187 [33].
##### 6.5.2.3.2.3 Fast re-authentication {#fast-re-authentication .H6}
The 3GPP AAA server shall support fast re-authentication as specified in the
IETF RFC 4187 [33]. Fast re-authentication should be enabled in the 3GPP AAA
server. The decision of using fast re-authentication is taken in the 3GPP AAA
server depending on operator\'s policies. The 3GPP AAA server indicates to the
UE the decision of using fast re-authentication by means of sending the fast
re-authentication identity in the EAP authentication procedure (i.e. in EAP-
Request/AKA/Challenge or EAP‑Request/AKA-re-authentication). When the 3GPP AAA
server sends a fast re-authentication identity to the UE, the 3GPP AAA server
shall also include a pseudonym when allowed by the IETF RFC 4187 [33]. In this
way, the UE retains a pseudonym if the 3GPP AAA server defers to full
authentication.
##### 6.5.2.3.2.4 Protected result indications {#protected-result-
indications-1 .H6}
The 3GPP AAA server should support protected result indications (i.e. MAC
protected) for EAP AKA as specified in IETF RFC 4187 [33]. The usage of this
feature depends on operator\'s policies.
#### 6.5.2.4 ePDG procedures
During the authentication of the UE for accessing the EPC via the ePDG, the
ePDG shall initiate EAP-AKA based authentication between the UE and the 3GPP
AAA server as specified in 3GPP TS 33.402 [15]. The ePDG shall extract the EAP
messages received from the UE over IKEv2, and send them to the 3GPP AAA Server
and shall send the EAP message received from the 3GPP AAA Server to the UE
over IKEv2 messages as defined in 3GPP TS 33.402 [15].
At the reception of the first message of the IKE_AUTH phase from the UE,
indicating to the ePDG that the UE wants to use EAP over IKEv2 (i.e. AUTH
parameter absent), the ePDG sends the Authentication and Authorization request
to the 3GPP AAA server including the EAP_resp/Identity in the EAP payload,
with the User Identity retrieved from the IDi payload and the APN information
retrieved from the IDr payload of the incoming message from the UE.
### 6.5.3 Multiple PDN support for untrusted non-3GPP access network
Connectivity to multiple PDNs via untrusted non-3GPP access is supported in
the EPS when the network policies, the non-3GPP access and the user
subscription allow it.
NOTE 1: In 3GPP, there is a limitation to the maximum number of simultaneous
PDN connections per UE caused by the number of EPS bearer identities (see
clause 11.2.3.1.5 of 3GPP TS 24.007 [48]) or by the number of PDU session IDs
(see clause 11.2.3.1b of 3GPP TS 24.007 [48]). Not complying with this
limitation when accessing non-3GPP access can lead to unexpected consequences,
e.g. connectivity loss in case of handover to 3GPP access. The maximum number
of PDN connection via untrusted non-3GPP access is independent from the
maximum number of active EPS bearer contexts for 3GPP access (see clause
6.5.1A of 3GPP TS 24.301 [10]).
If the UE supports dynamic mobility management selection the UE shall use the
same mobility protocol when multiple connections are established, see 3GPP TS
23.402 [6].
When the UE accesses EPC via S2b using untrusted non-3GPP IP access, and the
UE establishes additional PDN connections, the UE shall establish a new IPSec
tunnel with the same ePDG for each PDN connection. For each tunnel
establishment procedure, the UE shall indicate to the ePDG an APN to the
desired PDN and an attach type indication as specified in clause 7.2.2. When
establishing an additional PDN connection, the UE shall not indicate the
INITIAL_CONTACT notification.
NOTE 2: When using the S2b interface to establish an additional PDN
connection, the new IPSec tunnel establishment includes a new IKEv2
authentication and security association establishment as specified in clause
7.2.2.
When the UE accesses EPC via S2c using untrusted non-3GPP IP access, the UE
shall follow the procedures described in 3GPP TS 24.303 [11] when establishing
multiple PDN connections. For multiple PDN connections, the UE shall establish
only one IPsec tunnel to the ePDG.
If the UE had more than one PDN connection to a given APN in the source access
network and the UE is performing a handover to a target untrusted non-3GPP
access network via an ePDG that supports accessing an EPC via S2b-interface,
the UE shall transfer all the PDN connections for the given APN to the target
untrusted non-3GPP access network as specified in 3GPP TS 23.402 [6].
If multiple PDN connections to a single APN are not supported over the target
untrusted non-3GPP access network, only one PDN connection to that given APN
shall be established in the target non-3GPP access network as specified in
3GPP TS 23.402 [6] if NBM is used. The UE, if supporting IP address
preservation for NBM, shall include the home address information during the
tunnel establishment procedure as specified in clause 7.2.2. If multiple PDN
connection requests to the same APN are received but the network does not
support multiple PDN connections to the same APN, the ePDG shall reject the
additional PDN connection requests to the same APN received from the UE as
described in clause 7.4.1, in the following circumstances:
\- when one PDN connection to the same APN has already been established;
\- only after the network has successfully established one PDN connection in
the case that the additional PDN connections requests were received prior to
the successful establishment of a single PDN connection.
In the above cases, the UE shall determine which PDN connection is re-
established in the non-3GPP access based on the home address information
provided by the network.
The UE behaviour, when PDN connection re-establishment is rejected by the
network during handover to the untrusted non-3GPP access network, is described
in clause 7.2.2.
NOTE 3: When a UE supporting IP address preservation for NBM with multiple PDN
connections to the same APN hands over to the non-3GPP access network, the UE
can, as an implementation option, prioritise the re-establishment for a
particular PDN connection before re-establishing the remaining PDN
connections. The UE indicates the prioritised PDN connection by including both
the APN in the IDr payload and the home address information in the Handover
Attach indicator as specified in clause 7.2.2. Another implementation option
can be to send multiple re-establishment requests concurrently.
If the UE did not handover all the PDN connections for a given APN to the
target untrusted non-3GPP access network, the source network may disconnect
the remaining PDN connections for that given APN after an implementation
dependent time.
## 6.6 UE - 3GPP EPC (cdma2000^®^ HRPD Access)
### 6.6.1 General
3GPP2 X.S0057 [20] defines the interworking architecture for access to the EPC
via cdma2000^®^ HRPD access networks. In particular, 3GPP2 X.S0057 [20]
describes support for a UE using the cdma2000^®^ HRPD air interface to access
the EPC architecture defined in 3GPP TS 23.402 [6] by:
\- specifying the use of the interface between the 3GPP2 HRPD Serving Gateway
(HSGW) and the PDN Gateway (P-GW) in the EPC by referencing 3GPP TS 29.275
[18], when the HSGW supports UEs accessing EPC via S2a;
\- specifying the use of the interface across the S101 reference point between
the eAN/PCF in the 3GPP2 HRPD access network and the MME in the EPC by
referencing 3GPP TS 29.276 [19];
\- specifying the use of the user plane interface across the S103 reference
point between the EPC Serving Gateway (S-GW) and the HSGW by referencing 3GPP
TS 29.276 [19]; and
\- describing the internal functions and responsibilities of the HSGW.
3GPP2 C.S0087 [21] defines the signalling requirements and procedures for UEs
accessing the EPC via 3GPP2 HRPD access networks using the cdma2000^®^ HRPD
air interface. In particular, 3GPP2 C.S0087 [21]:
\- defines the signalling extensions to the cdma2000^®^ HRPD air interface
defined in 3GPP2 C.S0024 [23] necessary to support interworking with the EPC
and E-UTRAN; and
\- defines the UE and eAN/PCF procedures and signalling formats to support
bidirectional handoff between E-UTRAN and cdma2000^®^ HRPD.
### 6.6.2 Non-emergency case
#### 6.6.2.1 General
Clauses 6.6.2.2 through 6.6.2.7 describe the particular requirements for
access to the EPC via a cdma2000^®^ HRPD access network in support of non-
emergency accesses and services.
#### 6.6.2.2 UE identities
The UE and network shall use the root NAI as specified in 3GPP TS 23.003 [3]
for EPC access authentication when the UE obtains service via a cdma2000^®^
HRPD access network connected to an EPC in the UE\'s HPLMN.
Additionally, the UE and network shall use the Fast-Reauthentication NAI and
the Pseudonym Identity as described in clause 4.4.
#### 6.6.2.3 cdma2000^®^ HRPD access network identity
The access network identity is described in 3GPP TS 23.003 [3] and in clause
6.4.2.4 of this specification. For a cdma2000^®^ HRPD network, the value and
encoding of the access network identity is described in clause 8.1.1. The 3GPP
AAA server, HSS, and any visited network AAA proxy shall use the access
network identity during EAP-AKA\' authentication procedures (see 3GPP TS
33.402 [15]).
#### 6.6.2.4 PLMN system selection
The UE shall rely on information provisioned by the home operator to
facilitate the PLMN system selection process described in 3GPP TS 23.122 [4].
#### 6.6.2.5 Trusted and untrusted accesses
The UE shall determine the trust relationship for access to the EPC via a
cdma2000^®^ HRPD access network as described in clause 4.1.
#### 6.6.2.6 IP mobility mode selection
The UE and network shall perform IP mobility mode selection as described in
clauses 6.3.3.1 and 6.4.3.2
#### 6.6.2.7 Authentication and authorization for accessing EPC
The UE and 3GPP AAA server shall perform authentication and authorization
procedures for access to the EPC as defined in 3GPP TS 33.402 [15].
### 6.6.3 Emergency case
#### 6.6.3.1 General
Clauses 6.6.3.2 through 6.6.3.3 describe the particular requirements for
access to the EPC via a cdma2000^®^ HRPD access network in support of an
emergency session in course of handover from E-UTRAN to HRPD.
In this release of the specification no emergency session related handling
other than the handover of an emergency session from E-UTRAN to an cdma2000^®^
HRPD access network supporting access S-GW or PDN GW via S2a-interface is
specified.
#### 6.6.3.2 UE identities
When the UE obtains emergency services via a cdma2000^®^ HRPD access network
connected to an EPC in the UE\'s HPLMN, then the UE and the network shall use
the NAI for EPC access authentication as follows:
\- if IMSI is available and authenticated , then the UE and the network shall
use the root NAI;
\- if IMSI is not available or unauthenticated, then the emergency NAI shall
be used.
Additionally, the UE and the network shall use the Fast-Reauthentication NAI
and the Pseudonym Identity as described in clause 4.4.1.
#### 6.6.3.3 Authentication and authorization for accessing EPC
If IMSI is available, then the authentication and authorization procedures via
STa are executed if the local regulation and network operator option requires
authenticating the UE.
If the authentication and authorization procedures fail, then it depends on
local regulation and network operator option to allow or reject the emergency
services for the UE.
If IMSI is not available, the authentication and authorization procedures via
STa are not executed.
## 6.7 UE - 3GPP EPC (WiMAX Access)
### 6.7.1 General
The WiMAX system and its access network subsystem are described within WiMAX
Forum Network Architecture Release 1.0 version 1.2 -- Stage 2 [24]. The
protocol architecture and signalling of the WiMAX system is specified in WiMAX
Forum Network Architecture Release 1.0 version 1.2 -- Stage 3 [25]. This
protocol architecture and signalling supports the air interface defined in
WiMAX Forum Mobile System Profile Release 1.0 Approved Specification Revision
1.4.0 [26] which specifies selected profiles of IEEE Std 802.16e-2005 and IEEE
Std 802.16-2004/Cor1-2005 [27]**.**
### 6.7.2 Non-emergency case
#### 6.7.2.1 General
Clauses 6.7.2.2 through 6.7.2.7 describe the particular requirements for
access to the EPC via a WiMAX access network in support of non-emergency
accesses and services.
#### 6.7.2.2 UE identities
The UE and network shall use the root NAI as specified in 3GPP TS 23.003 [3]
for EPC access authentication when the UE obtains service via a WiMAX access
network connected to an EPC in the UE\'s HPLMN.
Additionally, the UE and network shall use the Fast-Reauthentication NAI and
the Pseudonym Identity as described in clause 4.4.
#### 6.7.2.3 WiMAX access network identity
The access network identity is described in 3GPP TS 23.003 [3] and in clause
6.4.2.4 of this specification. For a WiMAX network, the value and encoding of
the access network identity is described in clause 8.1.1. The 3GPP AAA server,
HSS, and any visited network AAA proxy shall use the access network identity
during EAP-AKA authentication procedures (see 3GPP TS 33.402 [15]).
#### 6.7.2.4 **S** election **of the Network Service Provider**
The UE shall use WIMAX-specific procedures described in WiMAX Forum Network
Architecture Release 1.0 version 1.2 -- Stage 3 [25] to discover and select
the highest priority Network Service Provider (NSP) which is available and
allowable.
#### 6.7.2.5 Trusted and untrusted accesses
The UE shall determine the trust relationship for access to the EPC via a
WiMAX access network as described in clause 4.1.
#### 6.7.2.6 IP mobility mode selection
The UE and network shall perform IP mobility mode selection as described in
clauses 6.3.3.1 and 6.4.3.2.
#### 6.7.2.7 Authentication and authorization for accessing EPC
NOTE: In line with 3GPP TS 33.402 [15], in this present specification, no
particular security provisions are specified for interworking between WiMAX
and EPS. Any access specific security procedures for WiMAX as a non-3GPP
access network to EPC will be in accordance with WiMAX Forum Network
Architecture Release 1.0 version 1.2 -- Stage 3 [25] and WiMAX Forum Mobile
System Profile Release 1.0 Approved Specification Revision 1.4.0 [26].
### 6.7.3 Emergency case
NOTE: Procedures for handling emergency accesses or services are not
specificed within this release of the specification
## 6.8 Communication over the S14
### 6.8.1 General
In order to assist the UE with performing access network discovery and
selection, ANDSF provides a set of information to the UE. This information
contains:
\- the access network discovery and selection information to assist the UE
with selecting the access network;
\- ISMP to control and assist the UE with performing the inter-system change;
\- ISRP information to control and assist a UE with selecting the access
network to be used for routing different IP flows over different access
networks, establishing PDN connections and identifying IP flows applicable for
non-seamless WLAN offload;
\- IARP information to control and assist a UE with selecting a prioritised
APN which is associated with an existing PDN connection for routing different
IP flows. The IARP provided by ANDSF can also include information for
identifying IP flows applicable for non-seamless WLAN offload.
\- WLAN Selection Policy to assist the UE with selecting the WLAN access
network;
\- Home Network Preference information to assists the UE in selecting a WLAN
and a service provider for 3GPP-based authentication over WLAN;
\- Visited Network Preference information to assist the UE in selecting a WLAN
and a service provider for 3GPP-based authentication over WLAN when the UE is
roaming in a V-PLMN; or
\- Rule selection information to assist the roaming UE with selecting the
active ANDSF rules to be used.
The ANDSF can provide ISRP rules to a UE independently of the UE\'s support
for IFOM, MAPCON, NSWO, RAT differentiation in ISRP or RAN-assisted WLAN
interworking. Handling of ISRP nodes unsupported by the UE is described in in
3GPP TS 24.312 [13].
The ANDSF can provide IARP rules to a UE independently of the UE\'s support
for NSWO, Inter-APN routing or RAN-assisted WLAN interworking. Handling of
IARP nodes unsupported by the UE is described in in 3GPP TS 24.312 [13].
This set of information can either be provisioned in the UE by the home
operator, or provided to the UE by the ANDSF over the S14 reference point via
pull or push mechanisms as defined in 3GPP TS 23.402 [6] by means of the
access network discovery and selection procedures as described in clause
6.8.2. While roaming, the UE can receive a set of information from H-ANDSF or
V-ANDSF or both. The V-ANDSF shall not provide any IARP or rule selection
information to a roaming UE. If the roaming UE receives any IARP or rule
selection information delivered by a V-ANDSF then the roaming UE shall ignore
it.
The UE, located in the home PLMN, needs to discover the H-ANDSF by means of
the discovery procedure as described in clause 6.8.2.2.1. The UE, located in
the visited PLMN, needs to discover the H-ANDSF or V-ANDSF or both by means of
the discovery procedure as described in clause 6.8.2.2.1.
Through push mechanisms the ANDSF can provide assistance information to the UE
e.g. if the UE has previously used pull based ANDSF procedure or if OMA-DM
bootstrapping is used as described in clause 6.8.2.2.1A. Through pull
mechanisms the UE can send a request to the ANDSF in order to get assistance
information for access network discovery and selection.
ANDSF shall comply with local, national and regional requirements regarding
the privacy and confidentiality of location information.
NOTE: The regulation and legislations of the home operator of the ANDSF server
determines whether the ANDSF server can store the user\'s location
information.
If the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, then the access stratum layer of the 3GPP access
can provide RAN assistance parameters and corresponding (E-)UTRAN measurements
which are used in accordance with the ANDSF MO defined in 3GPP TS 24.312 [13].
### 6.8.2 Interaction with the Access Network Discovery and Selection Function
#### 6.8.2.1 General
The S14 interface enables IP level communication between the UE and ANDSF. The
protocols supported by the S14 interface are realized above the IP level. Both
pull and push mechanisms may be supported for communication between the UE and
the ANDSF. A combination of pull and push mechanisms may also be supported.
The communication security over the S14 interface is specified in 3GPP TS
33.402 [15].
The UE, located in a home PLMN, can communicate securely with the H-ANDSF. The
UE, located in a visited PLMN, can communicate securely with H-ANDSF or
V-ANDSF or both.
The information is transferred between the UE and ANDSF using OMA DM as
defined in OMA-ERELD-DM-V1_2 [39] with the management object as specified in
3GPP TS 24.312 [13].
#### 6.8.2.2 UE procedures
##### 6.8.2.2.1 UE discovering the ANDSF
The IP address of the H-ANDSF can be configured in the UE by the home
operator.
When the UE is in its HPLMN or equivalent HPLMN, the UE may use DNS lookup as
specified in IETF RFC 1035 [35] or DHCP query as specified in IETF RFC 6153
[37] to discover the IP address of the H-ANDSF. If the UE implements DHCP
query, the preference between DNS lookup and DHCP query is UE implementation
dependent. .
When the UE is in a visited PLMN, the UE shall use DNS lookup to discover the
IP address of the ANDSF.
When performing a DNS lookup resolution for ANDSF, the UE shall apply the
following procedures:
\- For the H-ANDSF discovery, the UE shall build a Fully Qualified Domain Name
(FQDN) that shall be set to the ANFSF-SN FQDN as defined in 3GPP TS 23.003 [3]
for the DNS request and select the IP address of the H-ANDSF included in the
DNS response message.
\- For the V-ANDSF discovery, the V-ANDSF IP address by which the UE can
contact the V-ANDSF is obtained by the UE through a DNS lookup by name as
specified in IETF RFC 1035 [35]. The QNAME shall be set to the ANDSF-SN FQDN
and included in the DNS Request as defined in 3GPP TS 23.003 [3], and select
the IP address of the V-ANDSF included in the DNS response message.
##### 6.8.2.2.1A ANDSF communication security
According to 3GPP TS 33.402 [15], for the pull model, the UE and ANDSF shall
use PSK TLS with GBA based shared key-based mutual authentication to establish
a secure connection between UE and ANDSF as specified by clause 5.4 of 3GPP TS
33.222 [44].
According to 3GPP TS 33.402 [15], for the push model, the UE and ANDSF shall
use PSK TLS with GBA push based shared key-based mutual authentication to
establish a secure connection between the UE and the ANDSF as specified by
clause 5.1 of 3GPP TS 33.223 [47].
In accordance with 3GPP TS 29.109 [43], the BSF shall provide either the UE\'s
IMSI or IMPI to NAF, ie the ANDSF server.
OMA-DM\'s application level authentication mechanism does not need to be used
with ANDSF, since mutual security association is already established on
transport level using PSK-TLS as specified in 3GPP TS 33.402 [15]. According
to OMA-ERELD-DM-V1_2 [39], however, each Managed Object (MO) shall have an
access control list (ACL) that lists authorized OMA DM servers. In order to
comply with OMA-ERELD-DM-V1_2 [39], the ANDSF-SN FQDN shall be used as server
name in the ACL list.
If the UE does not support the ANDSF security mechanism as specified in 3GPP
TS 33.402 [15], or if the operator does not implement the GAA bootstrap
framework specified in 3GPP TS 33.220 [42], appropriate communication security
can be established with the ANDSF using OMA-DM\'s bootstrap, secure http
(https) mechanism and WAP Push according to OMA-ERELD-DM-V1_2 [39].
##### 6.8.2.2.2 Role of UE for Push model
The UE shall implement the push model of ANDSF in accordance with OMA-ERELD-
DM-V1_2 [39] using WAP Push, which is applicable for 3GPP access networks
only.
If the UE operates according to the GAA bootstrap framework specified in 3GPP
TS 33.220 [42] and if the UE supports GBA Push as specified in 3GPP TS 33.223
[47], the UE shall accept the SMS as a valid ANDSF notification SMS if:
\- the notification SMS contains valid GBA Push Information (GPI) as specified
in 3GPP TS 24.109 [52],
\- the X-WAP-Application-ID field (Push Application ID) in the WSP header
indicates ANDSF,
\- the WSP payload contains only the header part defined in 3GPP TS 24.109
[52] and the GPI parameter without any additional identifiers and
\- the NAF FQDN in GPI conforms to the ANDSF-SN specified in 3GPP TS 23.003
[3].
The short code for the X-WAP-Application-ID is specified in clause 8.1.3.
If the UE operates according to OMA DM bootstrap procedures as specified in
OMA DM Enabler Release v.1.2, see OMA-ERELD-DM v1_2 [39], the UE shall accept
the SMS as a valid ANDSF notification SMS if it contains an OMA DM General
Package #0 message according to OMA-ERELD-DM v1_2 [39].
In the push model of communication, if the UE receives a valid ANDSF
notification SMS from the ANDSF, the UE shall establish a secure data
connection using the information received in the notification SMS.
If the UE receives an invalid ANDSF notification SMS it shall be ignored by
the UE.
Upon establishing a secure connection between the UE and ANDSF, the UE may be
provided with updated ISMP, ISRP, IARP, WLANSP and information about available
access networks. The list of the information is described in clause 6.8.1 and
6.8.2.3.3 and the correspondent ANDSF MO is defined in 3GPP TS 24.312 [13].
##### 6.8.2.2.3 Role of UE for Pull model
In the pull model of communication, the UE sends a query to ANDSF to retrieve
or update inter-system mobility policy or information about available access
networks in its vicinity or inter-APN routing policy or any combination of
them. A UE supporting IFOM, MAPCON, NSWO or any combination of these may also
request ISRP. A UE may request IARP. The UE will wait for an implementation
dependent time for an answer from the ANDSF. If ANDSF does not respond within
that time, further action by the UE is implementation dependent. The UE may
provide to ANDSF the UE\'s location information including, if available, the
location parameters (for example, cell identities or the MAC address of the
WLAN AP) associated with the Radio Access Networks the UE has discovered in
its current location at the time the UE sends a query to ANDSF; the format of
the location information is described as UE_Location in ANDSF MO defined in
3GPP TS 24.312 [13].
After communicating with ANDSF, the UE may be provided with updatedISMP, ISRP,
IARP, WLANSP and information about available access networks. The list of the
information is described in clause 6.8.1 and 6.8.2.3.3 and the correspondent
ANDSF MO is defined in 3GPP TS 24.312 [13].
The UE may start Pull model communication with ANDSF based upon the
information previously received from the ANDSF (e.g. based on the value of
UpdatePolicy leaf defined in 3GPP TS 24.312 [13]). The UE capable of IFOM,
MAPCON, or non-seamless WLAN offload (or any combination of these
capabilities) can have all these capabilities disabled and have no ISRP. If
the UE enables one (or more) of these capabilities, the UE may start Pull
model communication with ANDSF. The UE capable of IFOM, MAPCON, or non-
seamless WLAN offload (or any combination of these capabilities) can have one
(or more) of these capabilities enabled and have no ISMP. If the UE disables
all these capabilities, the UE may start Pull model communication with ANDSF.
If the UE has no IARP, the UE may start Pull model communication with ANDSF.
NOTE: Mechanisms to limit the frequency of queries transmission from the UE to
the ANDSF are implementation dependant.
##### 6.8.2.2.4 UE using information provided by ANDSF
##### 6.8.2.2.4.1 General {#general-29 .H6}
ANDSF may provide various types of information to the UE, including access
network discovery information, WLAN selection information, ePDG configuration
information, inter-system mobility policy, the inter-system routing policies
and the inter-APN routing policies. The UE may retain and use this ANDSF
information until new or updated information is received.
Network detection and selection shall take into account the access network
specific requirements and the UE\'s local policy, e.g. user preference
settings, access history, etc, along with the information provided by the
ANDSF when discovering and selecting an access network. The local policy and
the information provided by the ANDSF shall be used by the UE in an
implementation dependent way to limit the undesired alternating between access
systems, e.g. ping-pong type of inter-system changes. However, the use of such
information from the ANDSF shall not be in contradiction to functions
specified in 3GPP TS 23.122 [4], 3GPP TS 25.304 [14] and 3GPP TS 36.304 [16].
If the UE is roaming in a VPLMN, the UE may receive Inter-system mobility
policies or Access network discovery information or ISRP or combinations of
these from H-ANDSF or V-ANDSF or both. The UE may also receive the IARP from
H-ANDSF. If IARP is received from V-ANDSF, the UE shall ignore it. The UE may
also receive WLAN selection information including WLAN Selection Policy
(WLANSP) from H-ANDSF or V-ANDSF or both, rule selection information, and Home
Network Preference information from H-ANDSF. The UE may receive Visited
Network Preference information from V-ANDSF. The UE may also receive ePDG
configuration information from H-ANDSF. The formats of the above information
are defined in 3GPP TS 24.312 [13].
The maximum number of sets of Inter-system mobility polices or Access network
discovery information or ISRP or IARP or combinations of these that the UE may
keep is implementation dependent. However, the UE shall retain at least one
set of Inter-system mobility policies and one set of Access network discovery
information from the same ANDSF. In addition, a UE supporting IFOM, MAPCON, or
non-seamless WLAN offload shall retain at least one ISRP rule from the same
ANDSF. Additionally, a UE shall retain at least one set of IARP received from
the H-ANDSF.
If a UE supporting IFOM, MAPCON, or non-seamless WLAN offload (or any
combination of these featureshas ISMP and ISRP available, and if the ANDSF
rules control the WLAN access selection and traffic routing as described in
clause 6.10.2, then ISRP shall be used for the routing of IP traffic. The
relation between ISRP and user preferences is described in clause 5.4.2.
For a UE with IFOM, MAPCON or non-seamless WLAN offload (or any combination of
these capabilities) enabled, if ISMP, ISRP and IARP are available, and if the
ANDSF rules control the WLAN access selection and traffic routing as described
in clause 6.10.2, then IARP and ISRP shall be used. In this case, the UE shall
first apply IARP followed by ISRP as follows:
\- If non-seamless WLAN offload is selected by IARP then the IP flow is routed
to the non-seamless WLAN offload and ISRP shall not be used for the routing of
IP traffic.
\- If a certain APN is selected by IARP then the IP flow is routed to the PDN
connections corresponding to this APN. If there is a ForFlowBased ISRP rule
matching the IP flow after the APN is selected, then the UE shall use the
ForFlowBased ISRP rule matching the IP flow to select the access for this IP
flow.
\- If neither certain APN nor non-seamless WLAN offload is selected by IARP or
one or more APNs are restricted by the IARP for routing the IP flow, then ISRP
shall be used for the routing of IP traffic. When one or more APNs are
restricted by the IARP, if a rule for NSWO is matched in the active ISRP rule
that restricts the use of the selected WLAN (or any WLAN) for routing the IP
flow, then the UE selects a not restricted APN to route the IP flow.
The relation between IARP and user preferences is described in clause 5.4.2.
For a UE not supporting any of IFOM, MAPCON or non-seamless offload
capabilities or with all those capabilities disabled, if ISMP and ISRP are
available, and if the ANDSF rules control the WLAN access selection and
traffic routing as described in clause 6.10.2, the ISMP shall be used.
For a UE not supporting any of IFOM, MAPCON capabilities or with all those
capabilities disabled, if ISMP, ISRP and IARP are available, and if the ANDSF
rules control the WLAN access selection and traffic routing as described in
clause 6.10.2, the IARP and ISMP shall be used. In this case, the UE shall
firstly apply ISMP followed by IARP as follows:
\- If the 3GPP access is selected by ISMP policy, then the UE shall use the
active IARP rule to determine if the IP flow is routed to the PDN connection
corresponding to a certain APN. The non-seamless WLAN offload policy, defined
in the IARP, shall not be used for routing of IP traffic; and
\- If the WLAN access is selected by ISMP policy, then the UE shall use the
active IARP rule to determine if the IP flow is routed to the PDN connection
corresponding to a certain APN or using the non-seamless WLAN offload.
This information shall be deleted if there is a change of USIM. This
information may be deleted when UE is switched off.
If the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, irrespective of whether any rule in ANDSF policies
is \'active\' or not, the UE shall periodically re-evaluate ANDSF policies.
The value of the periodic re-evaluation timer is implementation dependant. The
additional trigger for (re‑)evaluating rules is that the \'active\' rule
becomes invalid (conditions no longer fulfilled), or other manufacturer
specific trigger. When the UE receives ANDSF information it shall re-evaluate
the available rules along with the new information.
##### 6.8.2.2.4.2 Use of Inter-system Mobility Policy {#use-of-inter-system-
mobility-policy .H6}
This clause applies if the ANDSF rules control the WLAN access selection and
traffic routing as described in clause 6.10.2.
If more than one set of Inter-system mobility policies is available in the UE,
the UE shall only use one set of Inter-system mobility policies at any one
time.
When the UE is roaming and receives Inter-system Mobility Policies from both
H-ANDSF and V-ANDSF, the set of Inter-system Mobility Policies used by the UE
is selected as follows:
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is equal to one of the VPLMNs included in
the visited PLMNs with preferred rules, the set of Inter-system Mobility
Policies from V-ANDSF is selected by the UE.
If the preferred access technology according to the Inter-system Mobility
Policy is WLAN access technology, and if there is no WLANs matching the WLANSP
rule(s) from the V-ANDSF, the set of of Inter-system Mobility Policies from
H-ANDSF is selected by the UE. However, if at least one WLAN matching one or
more groups of selection criteria in the VPLMN\'s WLANSP rule becomes
available, the UE should re-use the WLANSP policies and Inter-system Mobility
Policies from V-ANDSF.
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is not equal to any of the VPLMNs included
in the visited PLMNs with preferred rules, the set of Inter-system Policies
from H-ANDSF is selected by the UE.
If the preferred access technology according to the Inter-system Mobility
Policy is WLAN access technology, and if there is no WLANs matching the WLANSP
rule(s) from the H-ANDSF, the set of of Inter-system Mobility Policies from
V-ANDSF is selected by the UE. However, if at least one WLAN matching one or
more groups of selection criteria in the HPLMN\'s WLANSP rule becomes
available, the UE should re-use the WLANSP policies and Inter-system Mobility
Policies from H-ANDSF.
NOTE: How frequently the UE performs the discovery and reselection procedure
depends on the UE implementation.
The Inter-system Mobility Policy with the highest priority among the set of
Inter-system Mobility Policies selected above is selected as the active Inter-
system Mobility Policy. A UE uses the ISMP to decide if the most preferred
available WLAN based on the WLANSP rule has higher priority than the 3GPP RAT.
If so, the UE shall connect to EPC via WLAN access. Otherwise, the UE shall
connect to EPC via 3GPP access. The prioritized list of WLAN in the active
ISMP rule shall not be used for WLAN selection.
When applying the Inter-system mobility policy the following requirements
apply:-
\- the requirements on periodic network reselection as described in clause
5.3.4 of the present specification;
\- the PLMN selection rules specified in 3GPP TS 23.122 [4] and in clause
5.2.3.2;
\- the selection rules specified in 3GPP2 C.P0016-D [23a]; and
\- the 3GPP RAT selection, cell selection and reselection rules specified in
3GPP TS 25.304 [14], 3GPP TS 36.304 [16] and 3GPP TS 45.008 [16a].
##### 6.8.2.2.4.3 Use of Access Network Discovery Information {#use-of-access-
network-discovery-information .H6}
The UE may use the received Access network discovery information of both the
H-ANSDF and V-ANDSF for network discovery and detection. The Access network
discovery information received from:-
a) the H-ANDSF provides guidance for the UE on access networks that have
connectivity to the HPLMN or equivalent HPLMNs or both; and
b) the V-ANDSF provides guidance for the UE on access networks that have
connectivity to the corresponding VPLMN or equivalent PLMNs or both.
##### 6.8.2.2.4.4 Use of Inter-System Routing Policies {#use-of-inter-system-
routing-policies .H6}
This clause applies if the ANDSF rules control the WLAN access selection and
traffic routing as described in clause 6.10.2.
A UE supporting IFOM, MAPCON, or non-seamless WLAN offload (or any combination
of these features) shall use the ISRP if available.
A UE supporting IFOM uses the ISRP to:
\- select an access technology or an access network or both for routing user
plane traffic matching specific IP flows on a specific or any APN identified
in the ISRP. 3GPP RATs can be prioritized with respect to WLAN access but this
prioritization does not influence 3GPP RAT selection; WLAN access networks can
be prioritized with respect to 3GPP RATs but those WLANs do not influence WLAN
selection; and
\- decide if an access technology or access network or both are restricted for
a specific IP flows on a specific or any APN identified in the ISRP.
A UE supporting MAPCON uses the ISRP to:
\- select an access technology or an access network or both for routing user
plane traffic matching a specific APN or any APN identified in the ISRP. 3GPP
RATs can be prioritized with respect to WLAN access but this prioritization
does not influence 3GPP RAT selection; WLAN access networks can be prioritized
with respect to 3GPP RATs but those WLANs do not influence WLAN selection; and
\- decide if an access technology or an access network or both are restricted
for a specific APN or any APN identified in the ISRP.
NOTE: After selecting WLAN access for routing user plane traffic by this
prioritised list of access technologies, a UE can use an implementation
dependent way to prevent the traffic from being routed back to the original
RAT again in a short period of time to avoid ping-pong behaviour.
A UE supporting non-seamless WLAN offload uses the ISRP to:
\- select a WLAN access network for routing, without traversing the EPC, user
plane traffic matching specific IP flows for a specific APN or any APN
identified in the ISRP; WLAN access networks defined in routing rule do not
influence WLAN selection; and
\- decide if the selected WLAN access network is restricted for routing,
without traversing the EPC, a specific IP flows for a specific APN or any APN
identified in the ISRP. If not, the selected WLAN can be used to perform NSWO.
When the UE supporting IFOM identifies an access technology or an access
network or both over which an IP flow can be routed based on the ISRP, the UE
shall apply the IFOM procedures specified in 3GPP TS 24.303 [11] to move an
on-going IP flow from the source access technology or access network to the
identified access technology or access network, if required.
If more than one set of ISRP is available in the UE, the UE shall only use one
ISRP at any one time.
When the UE is roaming and receives Inter-system Routing Policies from both
H-ANDSF and V-ANDSF, the set of Inter-system Routing Policies used by the UE
is selected as follows:
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is equal to one of the VPLMNs included in
the visited PLMNs with preferred rules, the set of Inter-system Routing
Policies fromV-ANDSF is selected by the UE.
If there is no WLANs matching the WLANSP rule(s) from the V-ANDSF, the set of
Inter-system Routing Policy from the H-ANDSF is re-selected. However, if at
least one WLAN matching one or more groups of selection criteria in the WLANSP
rule of the VPLMN becomes available, the UE should re-use the WLANSP policies
and Inter-system Routing Policies from V-ANDSF.
\- If there is rule selection information provisioned in the UE by the
H-ANDSF, and if the RPLMN identity is not equal to any of the VPLMNs included
in the visited PLMNs with preferred rules, the set of Inter-system Routing
Policies from H-ANDSF is selected by the UE,
If there is no WLANs matching the WLANSP rule(s) from the H-ANDSF, the set of
Inter-system Routing Policy from the V-ANDSF is be re-selected. However, if at
least one WLAN matching one or more groups of selection criteria in the WLANSP
rule of the HPLMN becomes available, the UE should re-use the WLANSP policies
and Inter-system Routing Policies from H-ANDSF.
NOTE: How frequently the UE performs the discovery and reselection procedure
depends on the UE implementation.
The Inter-system Routing Policy with the highest priority among the set of
Inter-system Routing Policies selected above is selected as the active Inter-
system Routing Policy.
The UE shall periodically re-evaluate the flow distribution rules of the
\'active\' ISRP rule. The value of the periodic re-evaluation timer is
implementation dependant.
##### 6.8.2.2.4.5 Use of Inter-APN Routing Policies {#use-of-inter-apn-
routing-policies .H6}
The UE shall use the IARP for APN if available.
The UE shall use the IARP for non-seamless WLAN offload if available, and the
ANDSF rules control the WLAN access selection and traffic routing as described
in clause 6.10.2.
A UE uses the IARP to:
\- select an APN or non-seamless WLAN offload for routing user plane traffic
matching specific IP flows; and
\- decide if an APN or non-seamless WLAN offload is restricted for routing a
specific IP flows.
An IARP for APN can be applied only when it steers IP traffic to an existing
(i.e. already established) PDN connection. Also, the scenario where multiple
PDN connections via the same access network are associated with the same APN
is not specified in the present document.
When applying IARP the same requirements defined for inter-system mobility
policy in clause 6.8.2.2.4.2 applies with the exception that the UE shall
apply IARP provided by the H-ANDSF.
If no valid IARP present, then Inter-APN routing policy configuration is UE
implementation dependent.
##### 6.8.2.2.4.6 Use of WLAN selection information {#use-of-wlan-selection-
information .H6}
The UE uses the WLAN selection information provided by ANDSF to determine the
selected WLAN and the selected service provider.
The UE first uses WLAN Selection Policy (WLANSP) and the visited PLMNs with
preferred rules to determine the active WLANSP rule. When roaming, if the UE
is configured to prefer WLAN selection rules provided by the HPLMN, WLANSP
provided by HPLMN is used. Otherwise, WLANSP provided by VPLMN is used. The UE
selects the highest priority and valid WLANSP rule as the active WLANSP rule.
During power-up, while the UE has not registered to any PLMN _,_ the UE shall
use WLANSP provided by the HPLMN as valid.
The UE determines the selected WLAN(s) as specified in clause 5.1.3.2. If
there are no selected WLANs according to active WLANSP rule of the
VPLMN/HPLMN, then the UE uses the WLANSP policies from the HPLMN/VPLMN as
active WLANSP rule. However, if at least one WLAN that matches one or more
groups of selection criteria in the WLANSP rule of the VPLMN or the /HPLMN
becomes available, the UE should re-use the WLANSP policies from the VPLMN or
the HPLMN as active WLANSP rule.
NOTE: How frequently the UE performs the discovery and reselection procedure
depends on the UE implementation.
Home Network Preference information and Visited Network Preference information
can be configured in the ANDSF MO to assist the UE in selecting a service
provider over the selected WLAN(s) and constructing an appropriate NAI when
attempting authentication with the selected service provider.
The UE uses the list of selected WLANs and the Home Network Preference
information (or the Visited Network Preference information if available and if
the UE is roaming) to select a WLAN service provider as specified in clause
5.2.3.2.
##### 6.8.2.2.4.7 Use of ePDG information {#use-of-epdg-information .H6}
If the UE accesses EPC via the ePDG, the UE shall use the ePDG configuration
information during the tunnel establishment procedure to determine the home
operator preference on ePDG connection as described in clause 7.2.1.
##### 6.8.2.2.4.8 Use of LWA co-existence Information {#use-of-lwa-co-
existence-information .H6}
The H-ANDSF can configure the LWA co-existence information about the
preference between the WLANSP, ISRP and IARP for NSWO rules, on the one hand,
and the LWA/RCLWI/LWIP procedures defined in the RAN, on the other hand,
according to TS 23.402 [6]. The LWA co-existence information is configured in
the ANDSF/HomeNetworkPreference/RanMobilitySetUsed node.
If the UE:
\- has not selected a WLAN according to the WLANSP rules or user preferences,
including when the UE has not selected any WLAN; or
\- has selected a WLAN according to the WLANSP rules and is connected to a
PLMN/WLAN combination configured in the
ANDSF/HomeNetworkPreference/RanMobilitySetUsed node,
the UE shall use the WLAN mobility set (see 3GPP TS 36.300 [70]) and ignore
the WLANSP, ISRP and IARP for NSWO rules. In order to apply the WLAN mobility
set, the UE may disconnect from the WLAN it is currently connected to and
connect to a WLAN identified by the RAN-configured WLAN mobility set.
If the UE:
\- has selected a WLAN according to the WLANSP rules and is not connected to a
PLMN/WLAN combination configured in the
ANDSF/HomeNetworkPreference/RanMobilitySetUsed node; or
\- has selected a WLAN based on user preferences,
the UE shall ignore the WLAN mobility set and apply the WLANSP, ISRP and IARP
for NSWO rules.
#### 6.8.2.3 ANDSF procedures
##### 6.8.2.3.1 General
Both the H-ANDSF and the V-ANDSF can provide information about inter-system
mobility policy or information about available access networks in the vicinity
of the UE or ISRP for the UE or combinations of these. The H-ANDSF may also
provide IARP for the UE. The V-ANDSF shall not provide any IARP to a roaming
UE. The inter-system mobility policies may be organized in a hierarchy and a
priority order among multiple policies may determine which policy has the
highest priority. The policies may indicate preference of one access network
over another or may restrict inter-system mobility to a particular access
network under certain conditions. The ANDSF may also specify validity
conditions which indicate when a policy is valid. Such conditions may be based
on time duration, location, RAN validity condition. The ANDSF may limit the
information provided to the UE. This can be based on UE\'s current location,
UE capabilities other than the capability of routing IP traffic simultaneously
over multiple radio access interfaces (e.g. IFOM capability or MAPCON
capability or non-seamless WLAN offload capability), etc. How the ANDSF
decides how much information to provide to the UE is dependent on network
implementation.
##### 6.8.2.3.2 Role of ANDSF for Push model
If there is no existing valid PSK TLS connection between the UE and ANDSF, the
ANDSF, not implementing GBA Push, may send a notification SMS to the UE,
without establishing a data connection with the UE.
If there is no existing valid PSK TLS connection between the UE and ANDSF, the
ANDSF, implementing GBA Push, shall send a message via SMS to the UE to
establish a secure connection between the UE and ANDSF. The contents of the
message shall contain a GBA Push Information as specified in 3GPP TS 33.223
[47].
After a secure connection is established according to clause 6.8.2.2.1A, or if
there is a valid PSK TLS connection between the UE and ANDSF, the ANDSF shall
use the connection to provision ANDSF information to the UE.
##### 6.8.2.3.3 Role of ANDSF for Pull model
When the UE connects to an ANDSF, the ANDSF may provide the UE with ISMP,
ISRP, IARP, WLANSP or information related to available access networks in the
vicinity of the UE, or combinations of these. In case of information about
available access networks, the ANDSF provides the following information about
each available access network in the form of a list containing:
1) Type of Access network (e.g. WLAN, WiMAX);
2) Location of Access Network (e.g. 3GPP location, WLAN location);
3) Access Network specific information (e.g WLAN information, WiMAX
information); and
4) Operator differentiated text field (if supported, e.g. if WNDS MO defined
in 3GPP TS 24.312 [13] is used).
The detailed list of information is described in 3GPP TS 24.312 [13].
## 6.9 Handling of Protocol Configuration Options information
The Protocol Configuration Options (PCO) information element is specified in
3GPP TS 24.008 [46].
The support of PCOs is optional for the UE and the non-3GPP access network.
Except for the trusted WLAN access, the content syntax of PCOs for the
non-3GPP access UE and non-3GPP access network is access network specific and
not in the scope of 3GPP, but if PCO is supported, the UE and the PDN-GW shall
handle the PCO contents in accordance with 3GPP TS 24.008 [46].
PCO information is exchanged between the UE and the PDN-GW, see 3GPP TS 23.402
[6], 3GPP TS 29.274 [50] and 3GPP TS 29.275 [18]. Except for the trusted WLAN
access, the specification of PCO signalling in the non-3GPP access network is
access network specific and not in the scope of 3GPP.
When the UE access EPC via trusted WLAN access network,
\- if SCM is used, the PCO is supported as described in clause 6.4.2.6, 3GPP
TS 29.274 [50] and 3GPP TS 29.275 [18];
\- if MCM is used, the PCO is supported as described in 3GPP TS 24.244 [56],
3GPP TS 29.274 [50] and 3GPP TS 29.275 [18];and
\- if TSCM is used, the PCO is not supported by the UE.
## 6.10 Integration with access stratum layer of 3GPP access
### 6.10.1 General
The clause describes the additional procedures for integration with access
stratum layer of 3GPP access.
If the RAN assistance information is supported by the UE and the E-UTRAN or
UTRAN, the E-UTRAN or UTRAN can provide RAN assistance information to the UE
as described in 3GPP TS 25.331 [14A] and 3GPP TS 36.331 [16B].
### 6.10.2 Selection of control of WLAN access selection and traffic routing
The WLAN access selection and traffic routing can be controlled either by
ANDSF rules or by RAN rules.
The ANDSF rules control the WLAN access selection and traffic routing if:
a) the UE has ANDSF rules but no RAN rules; or
b) the UE has both ANDSF rules and RAN rules; and:
1) the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN; and:
A) the UE is not roaming and the UE has at least one ISMP rule from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has at least one ISMP rule from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has at least one ISMP rule from HPLMN; or
2) the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN; and:
A) the UE is not roaming and the UE has an valid ISRP rule from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has a valid ISRP rule from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has a valid ISRP rule from HPLMN.
The RAN rules control the WLAN access selection and traffic routing if:
a) the UE has RAN rules but no ANDSF rules; or
b) the UE has both ANDSF rules and RAN rules; and:
1) the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN; and:
A) the UE is not roaming and the UE has no ISMP rules from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has no ISMP rules from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has no ISMP rules from HPLMN; or
2) the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN, and:
A) the UE is not roaming and the UE has no valid ISRP rule from HPLMN;
B) the UE is roaming in a VPLMN contained in the visited PLMNs with preferred
rules and the UE has no valid ISRP rule from VPLMN; or
C) the UE is roaming in a VPLMN not contained in the visited PLMNs with
preferred rules and the UE has no valid ISRP rule from HPLMN.
### 6.10.3 Additional procedures when WLAN access selection and traffic
routing is controlled by ANDSF rules
If the ANDSF rules control the WLAN access selection and traffic routing as
described in clause 6.10.2, the access stratum layer of the 3GPP access
provides the received RAN assistance parameters to this layer and the UE shall
store the RAN assistance parameters and then use the RAN assistance
information together with ANDSF rules specified in 3GPP TS 24.312 [13] and
measurements results to make traffic routing decisions to move traffic to WLAN
or to E-UTRAN or UTRAN by:
\- comparing the received RAN assistance thresholds with corresponding
measurement results; and
\- comparing the received OPI value with the provisioned OPI value provided by
the ANDSF.
The following thresholds can be used for traffic routing from E-UTRAN or UTRAN
to WLAN:
\- ThreshServingOffloadWLANLowP;
\- ThreshServingOffloadWLANLowQ;
\- ThreshChUtilWLANLow;
\- ThreshBackhRateDLWLANHigh;
\- ThreshBackhRateULWLANHigh; and
\- ThreshBeaconRSSIWLANHigh.
The following thresholds can be used for traffic routing from WLAN to E-UTRAN
or UTRAN:
\- ThreshServingOffloadWLANHighP;
\- ThreshServingOffloadWLANHighQ;
\- ThreshChUtilWLANHigh;
\- ThreshBackhRateDLWLANLow;
\- ThreshBackhRateULWLANLow; and
\- ThreshBeaconRSSIWLANLow.
Offload Preference Indication (OPI) parameter can be used for traffic routing
in both directions, from E-UTRAN or UTRAN to WLAN or from WLAN to E-UTRAN or
UTRAN.
### 6.10.4 Additional procedures when WLAN access selection and traffic
routing is controlled by RAN rules
This clause applies if the RAN rules control the WLAN access selection and
traffic routing as described in clause 6.10.2.
The access stratum layer of the 3GPP access can provide:
1) move-traffic-to-WLAN indication, along with list of WLAN identifiers. An
entry in the list of the WLAN identifiers consists of SSID, BSSID, HESSID, or
any combination of them; and
2) move-traffic-from-WLAN indication.
The user preferences take precedence over the indications provided by the
access stratum layer of the 3GPP access.
NOTE 1: Handling of the move-traffic-from-WLAN indication and the move-
traffic-to-WLAN indication for a multi-access PDN connection where the
network-initiated NBIFOM mode is the selected NBIFOM mode, is specified in
3GPP TS 24.161 [69].
Upon:
\- receiving move-traffic-to-WLAN indication, along with the list of the WLAN
identifiers, if the user preferences are not present; or
\- establishment of a new PDN connection in 3GPP access, if the PDN connection
is an offloadable PDN connection, the access stratum indicated move-traffic-
to-WLAN, the access stratum has not indicated the move-traffic-from-WLAN
indication after indicating of the move-traffic-to-WLAN indication and the
user preferences are not present;
and:
\- the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN and has at least one PDN connection which is not a multi-access PDN
connection or where the UE-initiated NBIFOM mode is the selected NBIFOM mode
as specified in 3GPP TS 24.161 [69]; or
\- the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN, and all the PDN connections of the UE in 3GPP access are
offloadable PDN connections;
the UE:
a) shall perform the procedure in clause 5.1.3.2.3 and in clause 5.2.3.2 to
select the selected WLAN and the NAI for authentication;
b) if not authenticated yet with the selected WLAN using the NAI for
authentication in clause 6.4, shall authenticate with the selected WLAN using
the NAI for authentication in clause 6.4. During authentication, if the
selected WLAN is a trusted WLAN, SCM is supported by both UE and network, MCM
is not supported by UE, network or both, and if:
\- the UE is capable to simultaneously route IP traffic to both 3GPP access
and WLAN and has at least one PDN connection which is not a multi-access PDN
connection or where the UE-initiated NBIFOM mode is the selected NBIFOM mode
as specified in 3GPP TS 24.161 [69]; or
\- the UE is not capable to simultaneously route IP traffic to both 3GPP
access and WLAN, and the UE has only one PDN connection;
shall handover one PDN connection:
\- which is an offloadable PDN connection; and
\- which is not a multi-access PDN connection or where the UE-initiated NBIFOM
mode is the selected NBIFOM mode as specified in 3GPP TS 24.161 [69];
from 3GPP access to the WLAN access using procedures in clause 6.4.2.6.2;
NOTE 2: When the UE already has one PDN connection established via WLAN in
SCM, and if move-traffic-to-WLAN indication is received, it is up to the UE
implementation to determine whether to offload a PDN connection from 3GPP
access to WLAN. In that case, it is also up to the UE implementation to
determine which one of the offloadable PDN connections will be offloaded.
c) if the selected WLAN is a trusted WLAN, and MCM is supported by both UE and
network, shall handover all the PDN connections:
\- which are offloadable PDN connections; and
\- which are not a multi-access PDN connection or where the UE-initiated
NBIFOM mode is the selected NBIFOM mode as specified in 3GPP TS 24.161 [69];
from 3GPP access to the WLAN access using procedures of 3GPP TS 24.244  _[56]_
;
d) if the selected WLAN is an untrusted WLAN, and if the UE supports access to
EPC via untrusted WLAN, shall handover all the PDN connections:
\- which are offloadable PDN connections; and
\- which are not a multi-access PDN connection or where the UE-initiated
NBIFOM mode is the selected NBIFOM mode as specified in 3GPP TS 24.161 [69];
from 3GPP access to the WLAN access using procedures in clause 7.2.1 and
clause 7.2.2; and
e) if the UE has a valid IARP rule for APN, shall use the IARP for APN using
the procedures in clause 6.8.2.2.4.5.
Upon receiving move-traffic-from-WLAN indication, and if the user preferences
are not present, the UE shall handover all the PDN connections:
\- established in (or previously handed over to) WLAN access; and
\- which are not a multi-access PDN connection or where the UE-initiated
NBIFOM mode is the selected NBIFOM mode as specified in 3GPP TS 24.161 [69];
from WLAN access to the 3GPP access using procedures in 3GPP TS 24.301 [10].
# 7 Tunnel management procedures
## 7.1 General
The purpose of tunnel management procedures is to define the procedures for
establishment or disconnection of an end-to-end tunnel between the UE and the
ePDG. The tunnel establishment procedure is always initiated by the UE,
whereas the tunnel disconnection procedure can be initiated by the UE or the
ePDG.
The tunnel is an IPsec tunnel (see IETF RFC 4301 [30]) established via an
IKEv2 protocol exchange IETF RFC 7296 [28] between the UE and the ePDG. The UE
may indicate support for IETF RFC 4555 [31]. **The security mechanisms for
tunnel setup using IPsec and IKEv2 are specified in** 3GPP **TS 33.402 [15].**
## 7.2 UE procedures
### 7.2.1 Selection of the ePDG
#### 7.2.1.1 General
If the UE does not supports ePDG selection according to 3GPP TS 24.502 [77],
the UE performs ePDG selection based on the ePDG configuration information
configured by the home operator in the UE either via H-ANDSF or via USIM or
via implementation specific means. Implementation specific means apply only if
the configurations via H-ANDSF and USIM are not present. The ePDG
configuration information may consist of home ePDG identifier or ePDG
selection information or both:
\- when available in ANDSF MO, the ePDG configuration information is
provisioned in ePDG node under Home Network Preference as specified in 3GPP TS
24.312 [13]; and
\- when available in USIM, the ePDG configuration information is provisioned
in EF~ePDGId~ and EF~ePDGSelection~ files as specified in 3GPP TS 31.102 [45].
The ePDG configuration information provided by ANDSF may also be pre-
configured by the home operator on the ME or provisioned on the UICC. The UE
shall use the information in the following order of precedence:
1) ePDG configuration information provided by the ANSDF server to the ME;
2) ePDG configuration information configured on the UICC;
3) ePDG configuration information pre-configured on the ME.
The UE shall support the implementation of standard DNS mechanisms in order to
retrieve the IP address(es) of the ePDG. The input to the DNS query is an ePDG
FQDN as specified in clause 4.4.3 and in 3GPP TS 23.003 [3].
If the UE supports ePDG selection according to 3GPP TS 24.502 [77], then the
UE selects the ePDG according to 3GPP TS 24.502 [77].
#### 7.2.1.2 Determination of the country the UE is located in
If the UE cannot determine whether it is located in the home country or in a
visited country, as required by the ePDG selection procedure specified in 3GPP
TS 23.402 [6], the UE shall stop the ePDG selection.
NOTE: It is out of scope of the present specification to define how the UE
determines whether it is located in the home country or in a visited country
or in a location that does not belong to any country. When the UE is in
coverage of a 3GPP RAT, it can, for example, use the information derived from
the available PLMN(s). In this case, the UE can match the MCC of the PLMN to
which a cell belongs, broadcast on the BCCH of the 3GPP access, against the
UE\'s IMSI to determine if they belong to the same country, as defined in 3GPP
TS 23.122 [4]. If the UE is not in coverage of a 3GPP RAT, the UE can use
other techniques, including user-provided location.
#### 7.2.1.3 Handling of ePDG selection based on the country the UE is located
in
The UE shall proceed as follows:
1) if the UE is located in its home country and
a) if the ePDG selection information is provisioned in the ePDG configuration
information and if an entry for the HPLMN is available in the ePDG selection
information, the UE shall construct an ePDG FQDN based on configured FQDN
format of HPLMN as described in 3GPP TS 23.402 [6] and encoding in 3GPP TS
23.003 [3]:
b) if the ePDG selection information is not provisioned in the ePDG
configuration information or if the ePDG selection information is provisioned
and an entry for the HPLMN is not available in the ePDG selection information,
the UE shall:
i) if Home ePDG identifier is provisioned in the ePDG configuration
information, use the configured IP address to select the ePDG, or if
configured IP address is not available, construct an ePDG FQDN using the
configured FQDN; and
ii) if the Home ePDG identifier is not provisioned in the ePDG configuration
information, construct an ePDG FQDN based on the Operator Identifier FQDN
format using the PLMN ID of the HPLMN as described in 3GPP TS 23.003 [3];
c) if the ePDG configuration information is not configured on the UE, or the
ePDG configuration information is configured but empty, the UE shall construct
the ePDG FQDN based on the Operator Identifier FQDN format using the PLMN ID
of the HPLMN stored on the USIM; and
d) If the ePDG selection is for establishing emergency bearer services and the
UE is not equipped with a UICC, the UE may construct the Operator Identifier
FQDN format based on a PLMN ID obtained via implementation specific means,
and for the cases a) through d), the UE shall use the DNS server function to
resolve the contructed ePDG FQDN to the IP address(es) of the ePDG(s). The UE
shall select an IP address of an ePDG with the same IP version as its local IP
address;
2) if the UE is not located in its home country and
a) if the ePDG selection information is provisioned in the ePDG configuration
information and if the UE is attached to a VPLMN via 3GPP access:
i) if an entry for the VPLMN is available in the ePDG selection information,
the UE shall construct an ePDG FQDN based on configured FQDN format of the
VPLMN as described in 3GPP TS 23.402 [6] and encoding in 3GPP TS 23.003 [3];
ii) if an entry for the VPLMN is not available in the ePDG selection
information, and an \'Any_PLMN\' entry is available in the ePDG selection
information, the UE shall construct an ePDG FQDN based on the configured FQDN
format of the \'Any_PLMN\' entry as described in 3GPP TS 23.402 [6] and
encoding in 3GPP TS 23.003 [3],
and for case i) and ii), the UE shall use the DNS server function to resolve
the contructed ePDG FQDN to the IP address(es) of the ePDG(s). The UE shall
select an IP address of an ePDG with the same IP version as its local IP
address; and
b) if one of the following is true:
\- the UE is not attached to a PLMN via 3GPP access and the UE uses WLAN;
\- the ePDG configuration information is not configured;
\- the ePDG selection information is not provisioned in the ePDG configuration
information; or
\- the UE is attached to a VPLMN via 3GPP access and an entry for the VPLMN is
not available in the ePDG selection information and an \'Any_PLMN\' entry is
not available in the ePDG selection information,
the UE shall perform a DNS query (see 3GPP TS 23.003 [3]) as specified in
clause 7.2.1.4 to determine if the visited country mandates the selection of
ePDG in this country:
i) if selection of ePDG in visited country is mandatory:
\- if the UE is attached to a VPLMN via 3GPP access and the PLMN ID of VPLMN
is included in one of the returned DNS records, the UE shall select an ePDG in
this VPLMN by constructing an ePDG FQDN based on the Operator Identifier FQDN
format using the PLMN ID of the VPLMN as described in 3GPP TS 23.003 [3]; and
\- if the UE is not attached to a PLMN via 3GPP access or the UE is attached
to a VPLMN via 3GPP access and the PLMN ID of VPLMN is not included in any of
the DNS records:
\- if the ePDG selection information is provisioned, the UE shall select an
ePDG from a PLMN included in the DNS response that has highest PLMN priority
(see 3GPP TS 24.312 [13]) in the ePDG selection information and construct an
ePDG FQDN based on the configured FQDN format of the PLMN entry as described
in 3GPP TS 23.402 [6] and encoding in 3GPP TS 23.003 [3]; and
\- if the ePDG selection information is not provisioned or the ePDG selection
information does not contain any of the PLMNs in the DNS response, selection
of the PLMN is UE implementation specific. The UE shall select an ePDG from a
PLMN included in the DNS response and construct an ePDG FQDN based on the
Operator Identifier FQDN format using the PLMN ID of the PLMN as described in
3GPP TS 23.003 [3],
and for the above cases, the UE shall use the DNS server function to resolve
the contructed ePDG FQDN to the IP address(es) of the ePDG(s). The UE shall
select an IP address of an ePDG with the same IP version as its local IP
address;
ii) if the DNS response contains no records, selection of ePDG in visited
country is not mandatory:
\- if the ePDG selection information is provisioned and contains one or more
PLMNs in the visited country, the UE shall select an ePDG from a PLMNs that
has highest PLMN priority (see 3GPP TS 24.312 [13]) in the ePDG selection
information;
\- if the ePDG selection information is not provisioned or if the ePDG
selection information is provisioned and contains no PLMNs in the visited
country, the UE shall select an ePDG in the HPLMN as follows:
\- if the Home ePDG identifier is provisioned in the ePDG configuration
information (see 3GPP TS 24.312 [13]), the UE shall use the configured IP
address to select the ePDG, or if configured IP address is not available, use
the configured FQDN and run DNS query to obtain the IP address(es) of the
ePDG(s); and
\- if the Home ePDG identifier is not provisioned in the ePDG configuration
information, the UE shall construct an ePDG FQDN based on the Operator
Identifier FQDN format using the PLMN ID of the HPLMN as described in 3GPP TS
23.003 [3], and
\- if the ePDG selection is for establishing emergency bearer services and the
UE is not equipped with a UICC, the UE may construct the Operator Identifier
FQDN format based on a PLMN ID obtained via implementation specific means.
and for the above cases, the UE shall use the DNS server function to resolve
the contructed ePDG FQDN to the IP address(es) of the ePDG(s). The UE shall
select an IP address of an ePDG with the same IP version as its local IP
address; and
iii) if no DNS response is received, the UE shall terminate the ePDG selection
procedure.
If selecting an ePDG in the HPLMN fails, and the selection of ePDG in the
HPLMN is performed using Home ePDG identifier configuration and there are more
pre-configured ePDGs in the HPLMN, the UE shall repeat the tunnel
establishment attempt using the next FQDN or IP address(es) of the ePDG in the
HPLMN.
Upon reception of a DNS response containing one or more IP addresses of ePDGs,
the UE shall select an IP address of ePDG with the same IP version as its
local IP address. If the UE does not receive a response to an IKE_SA_INIT
request message sent towards to any of the received IP addresses of the
selected ePDG, then the UE shall repeat the ePDG selection as described in
this clause, excluding the ePDG for which the UE did not receive a response to
the IKE_SA_INIT request message.
NOTE 1: The time the UE waits before reattempting access to another ePDG or to
an ePDG that it previously did not receive a response to an IKE_SA_INIT
request message, is implementation specific.
The UE shall select only one ePDG also in case of multiple PDN connections.
#### 7.2.1.4 Determine if the visited country mandates the selection of ePDG
in this country
In order to determine if the visited country mandates the selection of ePDG in
this country (see 3GPP TS 23.402 [6]), the UE shall perform the DNS NAPTR
query using Visited Country FQDN as specified in 3GPP TS 23.003 [3].
If the result of this query is:
\- a set of one or more records containing the service instance names of the
form \"_epdg.epc.mnc\ .mcc\.pub.3gppnetwork.org_\", the UE shall
determine thst the visited country mandates the selection of the ePDG in this
country; and
NOTE: The (\, \) pair in each record represents PLMN Id (see 3GPP TS
23.003 [3]) in the visited country which can be used for ePDG selection in
clause 7.2.1.3.
\- no records containing the service instance names of the form
\"_epdg.epc.mnc\ .mcc\.pub.3gppnetwork.org_\", the UE shall
determine that the visited country does not mandate the selection of the ePDG
in this country.
### 7.2.1A Selection of the ePDG for emergency bearer services
The UE performs ePDG selection for emergency bearer services based on the ePDG
configuration information provided by the home operator in the UE via H-ANDSF
or via USIM, or via implementation specific means.
The ePDG configuration information used for selecting the ePDG for emergency
bearer services includes:
\- when available in ANDSF MO, Emergency_ePDG_Identifier and ePDG selection
information are provisioned in ePDG node under Home Network Preference as
specified in 3GPP TS 24.312 [13]; and
\- when available in the USIM, the Emergency ePDG Identifier and ePDG
selection information are provisioned in EF~ePDGIdEm~ and EF~ePDGSelection~
files as specified in 3GPP TS 31.102 [45].
NOTE: Implementation specific means apply only if the configurations via
H-ANDSF and USIM are not present.
When performing ePDG selection for establishing emergency bearer services, the
UE shall proceed by following the general ePDG selection procedure specified
in clause 7.2.1 except:
\- Emergency_ePDG_Identifier shall be used instead of Home ePDG identifier;
\- All ePDG FQDNs and visited country FQDNs for DNS query shall be constructed
based on the ePDG FQDN format defined for emergency services as defined in
3GPP TS 23.003 [3]; and
\- If the ME is not equipped with a UICC, the UE shall consider the ePDG
configuration information as not available.
### 7.2.2 Tunnel establishment
#### 7.2.2.1 Tunnel establishment accepted by the network
Once the ePDG has been selected, the UE shall initiate the IPsec tunnel
establishment procedure using the IKEv2 protocol as defined in IETF RFC 7296
[28] and 3GPP TS 33.402 [15].
The UE shall send an IKE_SA_INIT request message to the selected ePDG in order
to setup an IKEv2 security association. Upon receipt of an IKE_SA_INIT
response, the UE shall send an IKE_AUTH request message to the ePDG,
including:
\- The type of IP address (IPv4 address or IPv6 prefix or both) that needs to
be configured in an IKEv2 CFG_REQUEST Configuration Payload. If the UE
requests for both IPv4 address and IPv6 prefix, the UE shall send two
configuration attributes in the CFG_REQUEST Configuration Payload: one for the
IPv4 address and the other for the IPv6 prefix;
\- The \"IDr\" payload, containing the APN in the Identification Data, for
non-emergency session establishment. For emergency session establishment, the
UE shall format the \"IDr\" payload according to clause 7.2.5. The UE shall
set the ID Type field of the \"IDr\" payload to ID_FQDN as defined in IETF RFC
7296 [28]. The UE indicates a request for the default APN by omitting the
\"IDr\" payload, which is in accordance with IKEv2 protocol as defined in IETF
RFC 7296 [28]; and
\- The \"IDi\" payload containing the NAI.
The IKE_AUTH request message may also contain:
\- An indication in a notify payload that MOBIKE is supported by the UE;
\- The INTERNAL_IP6_DNS or the INTERNAL_IP4_DNS attribute in the CFG_REQUEST
Configuration Payload. The UE can obtain zero or more DNS server addressed in
the CFG_REPLY payload within the IKE_AUTH response message as specified in
IETF RFC 7296 [28]; or
\- The P_CSCF_IP6_ADDRESS attribute, the P_CSCF_IP4_ADDRESS attribute or both
in the CFG_REQUEST Configuration Payload. The UE can obtain zero or more
P-CSCF server addresses in the CFG_REPLY Configuration Payload within the
IKE_AUTH response message as specified in IETF  _RFC_ 7651 [64].
If the UE\'s USIM indicates that the UE is a UE configured for high priority
access in the selected PLMN as specified in 3GPP TS 31.102 [35], the UE shall
send the HPA_INFO Notify payload, as defined in clause 8.1.2.3, within the
IKE_AUTH request message, with the HPA_INFO field bits set as defined in
clause 8.2.9.22.
The UE may support the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as
specified in clause 8.2.4.2. If the UE supports the
TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute, the UE shall include the
TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute indicating support of receiving
timeout period for liveness check in the CFG_REQUEST configuration payload
within the IKE_AUTH request message. If the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK
attribute as specified in clause 8.2.4.2 indicating the timeout period for the
liveness check is included in the CFG_REPLY configuration payload within the
IKE_AUTH response message or if the UE has a pre-configured timeout period,
the UE shall perform the tunnel liveness checks as described in clause 7.2.2A.
NOTE 1: The timeout period for liveness check is pre-configured in the UE in
implementation-specific way.
If the UE supports N1 mode and N1 mode capability is enabled, the UE shall
indicate the PDU session ID in the IKE_AUTH request message during the IKEv2
authentication and tunnel establishment for initial attach.
If the UE supports N1 mode and N1 mode capability is disabled, the UE may
indicate the PDU session ID in the IKE_AUTH request message during the IKEv2
authentication and tunnel establishment for initial attach.
If the UE supports N1 mode, regardless whether the N1 mode capability is
enabled or disabled, the UE shall indicate the PDU session ID in the IKE_AUTH
request message during the IKEv2 authentication and tunnel establishment for
handover of an existing PDN connection from EPS which the PDU session ID is
associated with, or for transferring of an existing PDU session from 5GS.
If the UE supports N1 mode, regardless whether the N1 mode capability is
enabled or disabled, the UE shall not indicate the PDU session ID in the
IKE_AUTH request message during the IKEv2 authentication and tunnel
establishment for handover of a PDN connection which no PDU session ID is
associated with.
In order to indicate the PDU session ID in the IKE_AUTH request message, the
UE shall include the N1_MODE_CAPABILITY Notify payload as defined in clause
8.2.9.15 in the IKE_AUTH request message and shall:
\- if the UE is establishing a PDN connection not related to any existing PDU
session or any existing PDN connection, allocate a PDU session ID which is not
currently being used by another PDU session over either 3GPP access or
non-3GPP access, set the PDU Session ID field of the N1_MODE_CAPABILITY Notify
payload to the allocated PDU session ID, and associate the allocated PDU
session ID with the PDN connection that is being established;
if the UE is transferring an existing PDU session from 5GS, set the PDU
Session ID field of the N1_MODE_CAPABILITY Notify payload to the PDU session
ID of the existing PDU session that is being transferred, and associate the
PDU session ID with the PDN connection that is being established. If the
existing PDU session is a non-emergency PDU session, the UE shall in addition
associate the S-NSSAI of the existing PDU session that is being transferred
and the related PLMN ID with the PDN connection that is being established; or
\- if the UE is transferring an existing PDN connection from EPS and a PDU
session ID is associated with the PDN connection that is being transferred,
set the PDU Session ID field of the N1_MODE_CAPABILITY Notify payload to the
PDU session ID associated with the existing PDN connection. If the existing
PDN connection is a non-emergency PDN connection and an S-NSSAI and a related
PLMN ID are associated with the existing PDN connection, the UE shall in
addition associate the S-NSSAI and the related PLMN ID with the PDN connection
that is being established.
During the IKEv2 authentication and security association establishment, if the
UE supports explicit indication about the supported mobility protocols, it
shall provide the indication as described in clause 6.3.
During the IKEv2 authentication and tunnel establishment for initial attach,
the UE shall provide an indication about Attach Type, which indicates Initial
Attach. To indicate attach due to initial attach, the UE shall include either
the INTERNAL_IP4_ADDRESS or the INTERNAL_IP6_ADDRESS attribute or both in the
CFG_REQUEST Configuration Payload within the IKE_AUTH request message. The
INTERNAL_IP4_ADDRESS shall contain no value and the length field shall be set
to 0. The INTERNAL_IP6_ADDRESS shall contain no value and the length field
shall be set to 0.
During the IKEv2 authentication and tunnel establishment for handover, the UE
not supporting IP address preservation for NBM shall indicate Initial Attach
as described in the previous paragraph.
NOTE 2: The UE cannot handover PDN connection with PDN type \"Ethernet\" or
\"non-IP\" from E-UTRAN to an ePDG because PDN connections with PDN type
\"Ethernet\" or PDN type \"non-IP\" are not supported over ePDG.
During the IKEv2 authentication and security association establishment for
handover, the UE supporting IP address preservation for NBM, shall provide an
indication about Attach Type, which indicates Handover Attach. During the
IKEv2 authentication and security association establishment for transfer of an
existing PDU session from 5GS, the UE shall provide an indication about Attach
Type, which indicates Handover Attach. To indicate attach due to handover, the
UE shall include the previously allocated home address information during the
IPSec tunnel establishment. Depending on the IP version, the UE shall include
either the INTERNAL_IP4_ADDRESS or the INTERNAL_IP6_ADDRESS attribute or both
in the CFG_REQUEST Configuration Payload within the IKE_AUTH request message
to indicate the home address information which is in accordance with IKEv2
protocol as defined in IETF RFC 7296 [28]. If the previously allocated home
address information consists of both an IPv4 address and an IPv6 prefix, then
the UE shall include the INTERNAL_IP4_ADDRESS attribute and the
INTERNAL_IP6_ADDRESS attribute in the CFG_REQUEST configuration payload within
the IKE_AUTH request message. If the previously allocated home address
information consists of an IPv4 address only, then the UE shall include the
INTERNAL_IP4_ADDRESS attribute and shall not include the INTERNAL_IP6_ADDRESS
attribute in the CFG_REQUEST configuration payload within the IKE_AUTH request
message. If the previously allocated home address information consists of an
IPv6 prefix only, then the UE shall include the INTERNAL_IP6_ADDRESS attribute
and shall not include the INTERNAL_IP4_ADDRESS attribute in the CFG_REQUEST
configuration payload within the IKE_AUTH request message. The UE shall
support IPSec ESP (see IETF RFC 4303 [32]) in order to provide secure tunnels
between the UE and the ePDG as specified in 3GPP TS 33.402 [15].
The UE may support multiple authentication exchanges in the IKEv2 protocol as
specified in IETF RFC 4739 [49] in order to support authentication and
authorization with an external AAA server allowing the UE to support PAP
authentication procedure, or CHAP authentication procedure, or both, as
described in 3GPP TS 33.402 [15].
If NBM is used and the UE wishes to access an external PDN and therefore needs
to perform authentication and authorization with an external AAA server, the
UE shall:
\- If the IKE_SA_INIT response contains a \"MULTIPLE_AUTH_SUPPORTED\" Notify
payload, then include a \"MULTIPLE_AUTH_SUPPORTED\" Notify payload in the
IKE_AUTH request as described in IETF RFC 4739 [49] and perform the additional
authentication steps as specified in 3GPP TS 33.402 [15]; and
\- If the IKE_SA_INIT response does not contain a \"MULTIPLE_AUTH_SUPPORTED\"
Notify payload, then perform the UE initiated disconnection as defined in
clause 7.2.4.1. The subsequent UE action is implementation dependent (e.g.
select a new ePDG).
After the successful authentication with the 3GPP AAA server, the UE receives
from the ePDG an IKE_AUTH response message containing a single CFG_REPLY
Configuration Payload including the assigned remote IP address information
(IPv4 address or IPv6 prefix) as described in clause 7.4.1. Depending on the
used IP mobility management mechanism the following cases can be
differentiated:
\- If DSMIPv6 is used for IP mobility management, the UE configures a remote
IP address based on the IP address information contained in the
INTERNAL_IP4_ADDRESS or INTERNAL_IP6_SUBNET attribute of the CFG_REPLY
Configuration Payload. The UE uses the remote IP address as Care-of-Address to
contact the HA.
\- If NBM is used for IP mobility management and the UE performs an initial
attach, the UE configures a home address based on the address information from
the CFG_REPLY Configuration Payload. Otherwise, if NBM is used and the UE
performs a handover attach, the UE continues to use its IP address configured
before the handover, if the address information provided in the CFG_REPLY
Configuration Payload does match with the UE\'s IP address configured before
the handover. If the UE\'s IP address (IPv4 address or IPv6 prefix) does not
match with the address information of the CFG_REPLY Configuration Payload, the
UE shall configure a new home address based on the IP address information
contained in the INTERNAL_IP4_ADDRESS, INTERNAL_IP6_SUBNET or
INTERNAL_IP6_ADDRESS attribute of the CFG_REPLY Configuration Payload. In the
latter case, the IP address preservation is not possible.
NOTE 3: In case of IPv6 address, the UE performs the match only on the IPv6
prefix provided within the CFG_REPLY Configuration Payload contained in the
INTERNAL_IP6_SUBNET or INTERNAL_IP6_ADDRESS.
If the UE receives a PDN_TYPE_IPv4_ONLY_ALLOWED Notify payload or a
PDN_TYPE_IPv6_ONLY_ALLOWED Notify payload, then the UE shall not subsequently
initiate another UE requested PDN connectivity procedure specific to the
non-3GPP access to the same APN to obtain a PDN type different from the one
allowed by the network until:
\- the UE is switched off;
\- the UICC containing the USIM is removed; or
\- the network initiated the deactivation of the PDN connectivity to the given
APN.
If the UE supports DSMIPv6, the UE may request the HA IP address(es), by
including a corresponding CFG_REQUEST Configuration Payload containing a
HOME_AGENT_ADDRESS attribute within the IKE_AUTH request message. The
HOME_AGENT_ADDRESS attribute content is defined in clause 8.2.4.1. The HA IP
address(es) requested in this attribute are for the APN for which the IPsec
tunnel with the ePDG is set-up. In the CFG_REQUEST within the IKE_AUTH request
message, the UE sets respectively the IPv6 address field and the optional IPv4
address field of the HOME_AGENT_ADDRESS attribute to 0::0 and to 0.0.0.0. If
the UE can not obtain the IP addresses of the HA via IKEv2 signalling, it uses
the home agent address discovery as specified in 3GPP TS 24.303 [11].
In case the UE wants to establish multiple PDN connections and if the UE uses
DSMIPv6 for mobility management, the UE shall use DNS as defined in 3GPP TS
24.303 [11] to discover the HA IP address(es) for the additional PDN
connections after IKEv2 security association was established to the ePDG.
During the IKEv2 authentication and security association establishment,
following the UE\'s initial IKE_AUTH request message to the ePDG, if the UE
subsequently receives an IKE_AUTH response message from the ePDG containing
the EAP-Request/AKA-Challenge, after verifying the received authentication
parameters and successfully authenticating the ePDG as specified in 3GPP TS
33.402 [15], the UE shall send a new IKE_AUTH request message to the ePDG
including the EAP-Response/AKA-Challenge. In addition, the UE shall provide
the requested mobile device identity if available, as specified in clause
7.2.6.
If the UE supports P-CSCF restoration extension for untrusted WLAN as
specified in 3GPP TS 23.380 [66], the UE shall **send its** capability
indication of the support of P-CSCF restoration to the ePDG by including the
P-CSCF_RESELECTION_SUPPORT Notify payload within an IKE_AUTH request
message**.** The content of the P-CSCF_RESELECTION_SUPPORT Notify payload is
described in clause 8.2.9.4.
If:
\- the UE supports N1 mode; or
\- N1 mode capability is disabled and the UE indicated the PDU session ID in
the IKE_AUTH request message;
and the UE receives the N1_MODE_INFORMATION Notify payload as defined in
clause 8.2.9.16 in the IKE_AUTH response message, the UE shall delete the
associated S-NSSAI, if any, and (re‑)associate the S-NSSAI in the S-NSSAI
Value field of the N1_MODE_INFORMATION Notify payload with the PDU session
associated with the IKEv2 security association that was established, and if
the UE receives the N1_MODE_S_NSSAI_PLMN_ID Notify payload as defined in
clause 8.2.9.17 in the IKE_AUTH response message, the UE shall delete the
associated PLMN ID, if any, and (re-)associate the PLMN ID that the S-NSSAI
relates to in the S-NSSAI PLMN ID field of the N1_MODE_S_NSSAI_PLMN_ID Notify
payload with the PDU session associated with the IKEv2 security association
that was established.
If the UE supports DNS over (D)TLS, the UE shall include the
DNS_SRV_SEC_INFO_IND Notify payload as defined in clause 8.2.9.18 in the
IKE_AUTH request message and, if the UE wishes to indicate which security
protocol type(s) are supported by the UE, the UE may indicate the supported
DNS server security protocols in the DNS_SRV_SEC_INFO_IND Notify payload.
If the UE included the DNS_SRV_SEC_INFO_IND Notify payload in the IKE_AUTH
request message and receives the DNS_SRV_SEC_INFO Notify payload as defined in
clause 8.2.9.19 in the IKE_AUTH response message, the UE shall pass to the
upper layer contents of the one or more DNS server security information fields
of the DNS_SRV_SEC_INFO Notify payload.
#### 7.2.2.2 Tunnel establishment not accepted by the network
If the UE receives the IKE_AUTH response message from an ePDG of the HPLMN
including a Notify payload with a Private Notify Message Type
NON_3GPP_ACCESS_TO_EPC_NOT_ALLOWED or USER_UNKNOWN or PLMN_NOT_ALLOWED or
AUTHORIZATION_REJECTED or RAT_TYPE_NOT_ALLOWED or ILLEGAL_ME as defined in
clause 8.1.2, then after the UE authenticates the network by using ePDG
certificate and AUTH parameters as specified in 3GPP TS 33.402 [15], the UE
shall close the related IKEv2 security association states and shall not retry
the authentication procedure to an ePDG from the same PLMN until switching off
or the UICC containing the USIM is removed.
If the above Private Notify Message Type is received from the VPLMN\'s ePDG
and the UE authenticates the network by using ePDG certificate and AUTH
parameters as specified in 3GPP TS 33.402 [15]:
\- If the received Notify Message Type is NON_3GPP_ACCESS_TO_EPC_NOT_ALLOWED
or USER_UNKNOWN or AUTHORIZATION_REJECTED or RAT_TYPE_NOT_ALLOWED or
ILLEGAL_ME, the UE may retry the authentication procedure with an ePDG
deployed by the HPLMN if allowed according to the ePDG selection procedure in
clause 7.2.1 and clause 7.2.1A; or
\- If the received Private Notify Message Type is PLMN_NOT_ALLOWED, the UE
should retry the authentication procedure with an ePDG deployed by the HPLMN
if allowed according to the ePDG selection procedure in clause 7.2.1 and
clause 7.2.1A.
If the UE receives from the ePDG the IKE_AUTH response message, including a
Notify payload with a Private Notify Message Type \"NETWORK_FAILURE\" as
defined in clause 8.1.2 then after the UE authenticates the network, the UE
shall close the related IKEv2 security association states and:
a) if the received IKE_AUTH response message from ePDG contains a Notify
payload with the BACKOFF_TIMER Notify payload as defined in clause 8.2.9.1,
the UE shall behave as follows:
i) if the timer value indicates neither zero nor deactivated, start the Tw3
timer with the value provided and not retry the authentication procedure to
the same ePDG until timer Tw3 expires or the UE is switched off or the UICC
containing the USIM is removed;
ii) if the timer value indicates that this timer is deactivated, not retry the
authentication procedure to the same ePDG until the UE is switched off or the
UICC containing the USIM is removed; and
iii) if the timer value indicates zero, may retry the authentication procedure
to an ePDG from the same PLMN; or
b) if the BACKOFF_TIMER Notify payload is not included in the received
IKE_AUTH response message from ePDG, the UE shall start an implementation
specific backoff timer. The UE shall not re-try the authentication procedure
with the same ePDG until the backoff timer expires or the UE is switched off
or the UICC containing the USIM is removed.
If the UE receives from the ePDG an IKE_AUTH response message including a
Notify Payload with a Private Notify Message Error Type
\"NO_APN_SUBSCRIPTION\" as defined in clause 8.1.2 then after the UE
authenticates the network, the UE shall close the related IKEv2 security
association states and:
a) if the received IKE_AUTH response message from ePDG contains a Notify
payload with the BACKOFF_TIMER Notify payload as defined in clause 8.2.9.1,
the UE shall behave as follows:
i) if the timer value indicates neither zero nor deactivated, start the Tw3
timer with the value provided and not retry the authentication procedure to
the same PLMN for the same APN until timer Tw3 expires or the UE is switched
off or the UICC containing the USIM is removed;
ii) if the timer value indicates that this timer is deactivated, not retry the
authentication procedure to the same PLMN for the same APN until the UE is
switched off or the UICC containing the USIM is removed; and
iii) if the timer value indicates zero, may retry the authentication procedure
to an ePDG from the same PLMN for the same APN; or
b) if the BACKOFF_TIMER Notify payload is not included in the received
IKE_AUTH response message from ePDG, the UE shall not retry the authentication
procedure with the same PLMN for the same APN the UE is switched off or the
UICC containing the USIM is removed, unless the UE has an implementation
specific backoff timer. In that case, the UE shall not retry until that
implementation specific timer expires.
NOTE 1: The UE can perform NSWO from the current untrusted WLAN access network
even though the tunnel establishment procedure to the ePDG is not accepted by
the network.
NOTE 2: Switching off and USIM change conditions are implemented taking into
consideration the user experience aspect.
If NBM is used and if the UE receives from the ePDG an IKE_AUTH response
message containing a Notify payload with a Private Notify Message Type
PDN_CONNECTION_REJECTION as specified in clause 8.1.2 that includes an IP
address information in the Notification Data field, the UE shall not attempt
to re-establish this PDN connection with the same IP address while connected
to the current ePDG and the UE shall close the related IKEv2 security
association states.
If NBM is used and if the UE receives from the ePDG an IKE_AUTH response
message containing a Notify payload with a Private Notify Message Type
PDN_CONNECTION_REJECTION as specified in clause 8.1.2 and no Notification Data
field, then after the UE authenticates the network, the UE shall not attempt
to establish additional PDN connections to this APN while connected to the
current ePDG. The UE shall close the related IKEv2 security association
states. Subsequently, the UE can attempt to establishment additional PDN
connections to the given APN if one or more existing PDN connections to the
given APN are released. While connected to the current ePDG, if this PDN
connection is the first PDN connection for the given APN, the UE shall not
attempt to establish PDN connection to the given APN.
If NBM is used and if the UE receives from the ePDG an IKE_AUTH response
message containing a Notify payload with a Private Notify Message Type
MAX_CONNECTION_REACHED as specified in clause 8.1.2, then after the UE
authenticates the network, the UE shall not attempt to establish any
additional PDN connections while connected to the current ePDG. The UE shall
close the related IKEv2 security association states. Subsequently, the UE can
attempt to establishment additional PDN connections via the ePDG if one or
more existing PDN connections via the ePDG are released.
If the UE includes the DNS_SRV_SEC_INFO_IND Notify payload as defined in
clause 8.2.9.18 in the IKE_AUTH request message, the ePDG may include the
DNS_SRV_SEC_INFO Notify payload as defined in clause 8.2.9.19 in the IKE_AUTH
response message.
### 7.2.2A Liveness check procedure
If the UE supports the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as
specified in clause 8.2.4.2 and the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK
attribute as specified in clause 8.2.4.2 was included in the CFG_REPLY
configuration payload within the IKE_AUTH response message received in clause
7.2.2 the UE shall set the timeout period for the liveness check to the value
of the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute.
If the UE does not support the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as
specified in clause 8.2.4.2 or the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute
as specified in clause 8.2.4.2 was not included in the CFG_REPLY configuration
payload within the IKE_AUTH response message received in clause 7.2.2 then:
1) if the LivenessCheckPeriod node as specified in 3GPP TS 24.312 [13] is
configured, the UE shall use the timeout period for the liveness check
indicated by the LivenessCheckPeriod node; and
2) if the LivenessCheckPeriod node as specified in 3GPP TS 24.312 [13] is not
configured, the UE shall use the pre-configured value of the timeout period
for liveness check.
NOTE: The timeout period is pre-configured in the UE in implementation-
specific way.
If the UE has not received any cryptographically protected IKEv2 or IPSec
message for the duration of the timeout period for liveness check, the UE
shall send an INFORMATIONAL request with no payloads as per IETF RFC 7296
[28]. If an INFORMATIONAL response is not received, the UE shall deem the
IKEv2 security association to have failed, and shall discard all states
associated with the IKE SA and any child SAs that were negotiated using that
IKE SA as specified in IETF RFC 7296 [28].
### 7.2.2B Handling of NBIFOM
If the IKEv2 authentication and security association establishment is
triggered by procedures in 3GPP TS 24.161 [69], the UE shall include the
NBIFOM_GENERIC_CONTAINER Notify payload (see clause 8.1.2.3)in the IKE_AUTH
request message. The UE shall set the NBIFOM container contents field of the
NBIFOM_GENERIC_CONTAINER Notify payload as specified in 3GPP TS 24.161 [69].
### 7.2.2C Rekeying procedure
The UE may support rekeying as defined in IETF RFC 7296 [28].
To trigger rekeying, the UE shall use the rekeying time parameter (see IETF
RFC 7296 [28]) if it is configured by the RekeyingTime node as specified in
3GPP TS 24.312 [13], If the rekeying time parameter is not configured, the UE
shall use an implementation-specific rekeying time (e.g. 18 hours).
### 7.2.2D NAT keep alive procedure
The UE may support NAT keep alive handling as defined in IETF RFC 7296 [28]
and IETF RFC 3948 [72].
To control the NAT-keepalive packet sending, the UE shall use the parameter M
(see IETF RFC 3948 [72]]) if it is configured by the NATKeepAliveTime node as
specified in 3GPP TS 24.312 [13], If the parameter M is not configured, the UE
shall use an implementation-specific time.
### 7.2.3 Tunnel modification
#### 7.2.3.1 UE-initiated modification
This procedure is used if MOBIKE as defined in IETF RFC 4555 [31] is supported
by the UE.
When there is a change of local IP address for the UE, the UE shall update the
IKE security association with the new address, and shall update the IPsec
security association associated with this IKE security association with the
new address. The UE shall then send an INFORMATIONAL request containing the
UPDATE_SA_ADDRESSES notification to the ePDG.
If, further to this update, the UE receives an INFORMATIONAL request with a
COOKIE2 notification present, the UE shall copy the notification to the
COOKIE2 notification of an INFORMATIONAL response and send it to the ePDG.
This procedure is also used during the UE-initiated IP flow mobility procedure
(see clause 6.3.3.3 of 3GPP TS 23.161 [68]) or the NBIFOM IP flow mapping
procedure (see clause 6.4.3 of 3GPP TS 23.161 [68]).
If the UE-initiated modification is triggered by procedures in 3GPP TS 24.161
[69], the UE shall include the NBIFOM_GENERIC_CONTAINER Notify payload (see
clause 8.1.2.3) in the INFORMATIONAL request to the ePDG. The UE shall set the
NBIFOM container contents field of the NBIFOM_GENERIC_CONTAINER Notify payload
as specified in 3GPP TS 24.161 [69].
#### 7.2.3.2 UE behaviour towards ePDG initiated modification
This procedure is used if P-CSCF restoration extension for untrusted WLAN is
supported as specified in 3GPP TS 23.380 [66].
If the UE receives the P_CSCF_IP6_ADDRESS attribute, the P_CSCF_IP4_ADDRESS
attribute or both as specified in IETF  _RFC_ 7651 [64] in the CFG_REQUEST
configuration payload within the INFORMATIONAL request from the ePDG and the
UE supports P-CSCF restoration extension for untrusted WLAN as specified in
3GPP TS 23.380 [66], the UE shall reply with an INFORMATIONAL response and
proceed as specified in clause 5.6.5.2 of 3GPP TS 23.380 [66]. The
INFORMATIONAL response shall include the received P_CSCF_IP6_ADDRESS attribute
or the P_CSCF_IP4_ADDRESS attribute or both in the CFG_REPLY Configuration
Payload. The P_CSCF_IP6_ADDRESS attribute shall contain no value and the
length field shall be set to 0. The P_CSCF_IP4_ADDRESS shall contain no value
and the length field shall be set to 0.
Upon of receipt of the NBIFOM_GENERIC_CONTAINER Notify payload (see clause
8.1.2.3) in an INFORMATIONAL request, the UE shall reply with an INFORMATIONAL
response and if required by procedures in 3GPP TS 24.161 [69], the UE shall
include the NBIFOM_GENERIC_CONTAINER Notify payload (see clause 8.1.2.3) in
the INFORMATIONAL response. The UE shall set the NBIFOM container contents
field of the NBIFOM_GENERIC_CONTAINER Notify payload as specified in 3GPP TS
24.161 [69].
### 7.2.4 Tunnel disconnection
#### 7.2.4.1 UE initiated disconnection
The UE shall use the procedures defined in the IKEv2 protocol (see IETF RFC
7296 [28]) to disconnect one or more IPsec tunnels to the ePDG. The UE shall
close the incoming security associations associated with the tunnel and
instruct the ePDG to do the same by sending the INFORMATIONAL request message
including a \"DELETE\" payload. The DELETE payload shall contain either:
i) Protocol ID set to \"1\" and no subsequent Security Parameters Indexes
(SPIs) in the payload. This indicates closing of IKE security association, and
implies the deletion of all IPsec ESP security associations that were
negotiated within the IKE security association;
ii) if the IKEv2 multiple bearer PDN connectivity is not supported or not used
in the PDN connection as determined in clause 7.2.7, Protocol ID set to \"3\"
for ESP. The Security Parameters Indexes included in the payload shall
correspond to the particular incoming ESP security associations at the UE for
the given tunnel in question; or
iii) if the IKEv2 multiple bearer PDN connectivity is used in the PDN
connection as determined in clause 7.2.7, the Protocol ID field of the DELETE
payload is set to \"3\" for ESP and the SPI field of the DELETE payload
includes UE\'s ESP SPIs of all bearer contexts of the **PDN connection**.
#### 7.2.4.2 UE behaviour towards ePDG initiated disconnection
On receipt of the INFORMATIONAL request message including \"DELETE\" payload,
indicating that the ePDG is attempting tunnel disconnection, the UE shall:
i) Close all security associations identified within the DELETE payload (these
security associations correspond to outgoing security associations from the UE
perspective). If no security associations were present in the DELETE payload,
and the protocol ID was set to \"1\", the UE shall close the IKE security
association, and all IPsec ESP security associations that were negotiated
within it towards the ePDG; and
ii) The UE shall delete the incoming security associations corresponding to
the outgoing security associations identified in the \"DELETE\" payload.
The UE shall send an INFORMATIONAL response message. If the INFORMATIONAL
request message contained a list of security associations, the INFORMATIONAL
response message shall contain a list of security associations deleted in step
(ii) above.
If the UE is unable to comply with the INFORMATIONAL request message, the UE
shall send INFORMATION response message with either:
i) A NOTIFY payload of type \"INVALID_SPI\", for the case that it could not
identify one or more of the Security Parameters Indexes in the message from
the ePDG; or
ii) A more general NOTIFY payload type. This payload type is implementation
dependent.
If the INFORMATIONAL request message including the DELETE payload contains the
REACTIVATION_REQUESTED_CAUSE Notify payload, the UE shall re-establish the
IPsec Tunnel for the corresponding PDN connection after its release. The
coding of the P-CSCF_RESELECTION_SUPPORT Notify payload is described in clause
8.2.9.6.
NOTE: For an IMS PDN connection, the re-establishment of the IPSec tunnel is
part of the \"Re-establishment of the IP-CAN used for SIP signalling
procedure\" specified in 3GPP TS 24 229 [67] clause R.2.2.1B.
#### 7.2.4.3 Local tunnel disconnection initiated from 3GPP access
A PDN connection over untrusted WLAN over S2b can be released locally in the
UE, i.e. without any peer-to-peer signalling between the ePDG and the UE,
based on the trigger received from the 3GPP access, e.g. during the P-CSCF
restoration procedure for NBIFOM PDN connections (see 3GPP TS 23.380 [66]).
Upon receiving over the 3GPP access:
\- a DEACTIVATE EPS BEARER CONTEXT REQUEST message with the EPS bearer context
of a default EPS bearer context and ESM cause #39 \"reactivation requested\"
(see 3GPP TS 24.301 [10]); or
\- a DETACH REQUEST message with the detach type \"re-attach required\" (see
3GPP TS 24.301 [10])
to release the resources for a PDN connection over the 3GPP access, the UE
shall:
a) close the related IKEv2 security association for the IPsec tunnel
associated with this PDN connection; and
b) consider that the ePDG is no longer responding (see RFC 7296 [28]) and not
send any messages to the ePDG.
### 7.2.5 Emergency session establishment
If the UE needs to establish an IMS emergency session over untrusted non-3GPP
access as specified in 3GPP TS 24.229 [67], the UE shall:
\- if the UE is not connected to an ePDG yet, select an ePDG that supports
emergency services as described in clause 7.2.1A;
\- if the UE is already connected to an ePDG that has indicated its capability
of support emergency services as specified in clause 7.4.1.1 and the ePDG is
located in the same country where the UE is currently located, reuse ePDG for
emergency session; and
\- if the UE is already connected to an ePDG but the ePDG does not support the
emergency services or ePDG is not located in the same country where the UE is
currently located, first follow procedure described in clause 7.2.4.1 to
disconnect existing IPsec tunnel. The UE shall then select an ePDG that
supports emergency services as described in clause 7.2.1A.
Once the UE selects an ePDG that supports emergency services as specified in
clause 7.2.1A, or if the UE is already connected to an ePDG and the ePDG is
reused for emergency session, the UE shall initiate an IKEv2 tunnel
establishment procedure towards this ePDG as described in clause 7.2.2. Upon
receipt of an IKE_SA_INIT response, the UE shall send an IKE_AUTH request
message to the ePDG according to clause 7.2.2.1 with the \"IDr\" payload
containing the string \"EMERGENCY\", using capital letters only, in the
Identification Data. The UE shall set the ID Type field of the \"IDr\" payload
to ID_FQDN.
NOTE: In this procedure, the only scenario in which the UE is not in the same
country as the ePDG it is connected to, is when the UE is not in the country
of its HPLMN and the ePDG is in the country of the HPLMN.
In order to establish a new emergency session over an untrusted WLAN, the UE
shall include:
\- an INTERNAL_IP4_ADDRESS attribute with the length field set to zero;
an INTERNAL_IP6_ADDRESS attribute with the length field set to zero; or
\- both of the above;
in the CFG_REQUEST Configuration Payload within the IKE_AUTH request message.
In order to perform handover of an emergency session from a 3GPP access
network to untrusted WLAN, the UE shall include:
\- the INTERNAL_IP4_ADDRESS attribute set to the IPv4 address of the
previously allocated home address information;
the INTERNAL_IP6_ADDRESS attribute set to the IPv6 address of the previously
allocated home address information; or
\- both of the above;
in the CFG_REQUEST Configuration Payload within the IKE_AUTH request message.
If the previously allocated home address information consists of both an IPv4
address and an IPv6 prefix, then the UE shall include the INTERNAL_IP4_ADDRESS
attribute and the INTERNAL_IP6_ADDRESS attribute in the CFG_REQUEST
configuration payload within the IKE_AUTH request message.
If the UE does not receive a response to an IKE_SA_INIT request message sent
towards the selected ePDG, then the UE shall repeat the ePDG search as
described in 3GPP TS 23.402 [6], excluding the ePDG for which the UE did not
receive a response to the IKE_SA_INIT request message. The UE shall stop the
establishment of emergency session if it is unable to select an ePDG for
emergency bearer services.
If after sending an IKE_AUTH request message to the ePDG to initiate emergency
session, the UE receives IKE_AUTH response message from the ePDG containing a
Notify payload with a Private Notify Message Type
\"UNAUTHENTICATED_EMERGENCY_NOT_SUPPORTED\", the UE shall follow the steps
above to select a new ePDG for emergency session establishment by excluding
the ePDGs from which the emergency session request was previously not accepted
or by implementation specific means.
If the UE receives the Notify Message Type IMEI_NOT_ACCEPTED as defined in
clause 8.1.2.2, the UE shall not retry the authentication procedure from the
same PLMN until switching off, the UICC containing the USIM is replaced, or a
UICC containing the USIM is inserted.
If the UE is already connected to an ePDG selected by the procedure in clause
7.2.1A, the UE is considered as attached for emergency bearer services. In
such a case, the UE shall not initiate any addtional IKEv2 tunnel
establishment procedure.
If the UE is connected to an ePDG selected by the procedure in clause 7.2.1,
and the ePDG has **indicated its** capability of support emergency service to
the UE as specified in clause 7.4.1.1 and is located in the same country where
the UE is currently located, the UE, when it requires emergency services,
shall initiate an IKEv2 tunnel establishment procedure towards the same ePDG
to request for emergency session as specified in clause 7.2.2 provided that an
emergency PDN connection is not already active.
### 7.2.6 Mobile identity signaling
During the IKEv2 authentication and security association establishment, if the
UE:
\- receives IKE_AUTH response message from ePDG containing a Notify payload
with the DEVICE_IDENTITY Notify Message Type and the Identity Type field of
the DEVICE_IDENTITY Notify payload is set to either \'IMEI\' or \'IMEISV\' and
the Identity Value field is empty;
\- successfully authenticates the network or requests emergency session; and
\- has Mobile Equipment Identity IMEI or IMEISV available,
the UE shall include the DEVICE_IDENTITY Notify payload in the new IKE_AUTH
request message.
At any time after successful tunnel establishment, if the UE:
\- receives INFORMATIONAL request message from ePDG containing a Notify
payload with the DEVICE_IDENTITY Notify Message Type and the Identity Type
field of the DEVICE_IDENTITY Notify payload is set to either \'IMEI\' or
\'IMEISV\' and the Identity Value field is empty; and
\- has the UE\'s Mobile Equipment Identity IMEI or IMEISV available,
the UE shall send INFORMATIONAL response containing a DEVICE_IDENTITY Notify
payload.
The UE shall set the DEVICE_IDENTITY as follows:
\- if IMEISV is available, the UE shall include IMEISV in the DEVICE_IDENTITY
Notify payload. The Identity Type field of the DEVICE_IDENTITY Notify payload
shall be set to \'IMEISV\': and
\- if IMEI is available and IMEISV is not available, the UE shall include IMEI
in the DEVICE_IDENTITY attribute. The Identity Type field of the
DEVICE_IDENTITY Notify payload shall be set to \'IMEI\'.
The detailed coding of the DEVICE_IDENTITY Notify payload is described in
clause 8.2.9.2.
### 7.2.7 IKEv2 multiple bearer PDN connectivity
#### 7.2.7.1 General
The UE may support the IKEv2 multiple bearer PDN connectivity.
If the UE supports the IKEv2 multiple bearer PDN connectivity, then the UE
shall perform handling specified in the present clause. Otherwise the UE does
not perform handling specified in the present clause and remaining clauses of
the parent clause of the present clause.
The UE shall **include an** IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify
payload as specified in clause 8.2.9.9 within an IKE_AUTH request message
establishing an IKE SA of a PDN connection**. If** the IKE_AUTH response
message contains an EPS_QOS Notify payload as specified in clause 8.2.9.10,
the UE shall consider that the IKEv2 multiple bearer PDN connectivity is used
in the PDN connection.
If the IKEv2 multiple bearer PDN connectivity is used in the PDN connection,
then the UE shall perform the handling specified in remaining clauses of the
parent clause of the present clause. Otherwise the UE does not perform the
handling specified in remaining clauses of the parent clause of the present
clause.
#### 7.2.7.2 Maintained information
The UE shall maintain one or more bearer contexts for the PDN connection. Each
bearer context consists of a UE\'s ESP SPI, an ePDG\'s ESP SPI, an EPS QoS, an
extended EPS QoS, a TFT, an APN-AMBR, an extended APN-AMBR, and an indication
whether the bearer context is the default bearer context. The TFT can be
absent only in the default bearer context. The extended EPS QoS can be absent
for any bearer context. The APN-AMBR and the extended APN-AMBR are absent for
bearer contexts which are not the default bearer context. The APN-AMBR can be
present or absent for the default bearer context. The extended APN-AMBR can be
present for the default bearer context only if the APN-AMBR is present for the
default bearer context.
#### 7.2.7.3 Control plane procedures
##### 7.2.7.3.1 General
Parent clause of the present clause describe control plane procedures for the
IKEv2 multiple bearer PDN connectivity.
##### 7.2.7.3.2 Establishment of IKEv2 SA and initial IPSec ESP tunnel
NOTE: Inclusion of **a** IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify payload
in an IKE_AUTH request message is specified in clause 7.2.7.1**.**
Upon receiving the IKE_AUTH response message establishing the IKE SA of the
PDN connection, the UE shall add a new bearer context to the PDN connection.
The new bearer context shall consist of the UE\'s ESP SPI created by the
IKE_AUTH request/response pair, the ePDG\'s ESP SPI created by the IKE_AUTH
request/response pair, the EPS QoS indicated in the EPS_QOS Notify payload,
the extended EPS QoS indicated in the EXTENDED_EPS_QOS Notify payload (if
included in the IKE_AUTH response message), the APN-AMBR indicated in the
APN_AMBR Notify payload (if included in the IKE_AUTH response message), and
the extended APN-AMBR indicated in the EXTENDED_APN_AMBR Notify payload (if
included in the IKE_AUTH response message) of the IKE_AUTH response message,
and the indication that the bearer context is the default bearer context.
##### 7.2.7.3.3 Establishment of an additional IPSec ESP tunnel
Upon receiving a CREATE_CHILD_SA request message in the IKE SA of the PDN
connection, with an EPS_QOS Notify payload as specified in clause 8.2.9.10,
with a TFT Notify payload as specified in clause 8.2.9.11, and without a
REKEY_SA Notify payload, if the UE sends a CREATE_CHILD_SA response message
without an IKEv2 notify payload indicating an error, the UE shall add a new
bearer context to the PDN connection. The new bearer context shall consist of
the UE\'s ESP SPI created by the CREATE_CHILD_SA request/response pair, the
ePDG\'s ESP SPI created by the CREATE_CHILD_SA request/response pair, the EPS
QoS indicated in the EPS_QOS Notify payload of the CREATE_CHILD_SA request
message, the extended EPS QoS indicated in the EXTENDED_EPS_QOS Notify payload
(if included in the CREATE_CHILD_SA request message), the TFT indicated in the
TFT Notify payload of the CREATE_CHILD_SA request message, and the indication
that the bearer context is not the default bearer context.
Upon receiving a CREATE_CHILD_SA request message in the IKE SA of the PDN
connection, with an EPS_QOS Notify payload as specified in clause 8.2.9.10,
with a TFT Notify payload as specified in clause 8.2.9.11, and without a
REKEY_SA Notify payload:
a) the UE checks for semantic errors in TFT operations as follows:
1) if the _TFT operation_ in the TFT Notify payload is an operation other than
\"Create a new TFT\", the UE shall send a CREATE_CHILD_SA response message
with the SEMANTIC_ERROR_IN_THE_TFT_OPERATION Notify payload;
b) the UE checks for syntactical errors in TFT operations as follows:
1) if the _TFT operation_ in the TFT Notify payload is \"Create a new TFT\"
and the packet filter list in the TFT Notify payload is empty, the UE shall
send a CREATE_CHILD_SA response message with the
SYNTACTICAL_ERROR_IN_THE_TFT_OPERATION Notify payload; and
2) if there are other types of syntactical errors in the coding of the TFT
Notify payload, such as a mismatch between the number of packet filters
subfield, and the number of packet filters in the packet filter list, the UE
shall send a CREATE_CHILD_SA response message with the
SYNTACTICAL_ERROR_IN_THE_TFT_OPERATION Notify payload;
c) the UE checks for semantic errors in packet filters as follows:
1) if a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter, the UE shall send a CREATE_CHILD_SA response message with
the SEMANTIC_ERRORS_IN_PACKET_FILTERS Notify payload. How the UE determines a
semantic error in a packet filter is outside the scope of the present
document; and
2) if the resulting TFT does not contain any packet filter which applicable
for the uplink direction, the UE shall send a CREATE_CHILD_SA response message
with the SEMANTIC_ERRORS_IN_PACKET_FILTERS Notify payload;
d) the UE checks syntactical errors in packet filters as follows:
1) if the _TFT operation_ in the TFT Notify payload is \"Create a new TFT\"
and two or more packet filters in the resultant TFT would have identical
packet filter identifiers, the UE shall send a CREATE_CHILD_SA response
message with the SYNTACTICAL_ERRORS_IN_PACKET_FILTERS Notify payload;
2) if the _TFT operation_ in the TFT Notify payload is \"Create a new TFT\"
and two or more packet filters in all TFTs associated with this PDN connection
would have identical packet filter precedence values:
i) if the old packet filters do not belong to the default bearer contex, the
UE shall send a CREATE_CHILD_SA response message with the
SYNTACTICAL_ERRORS_IN_PACKET_FILTERS Notify payload; and
NOTE: the UE is not expected to be able to release a particular bearer
context.
ii) if one or more old packet filters belong to the default bearer context,
the UE shall release the PDN connection as specified in clause 7.2.4.1; and
3) if there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier, the UE shall send a CREATE_CHILD_SA response message with the
SYNTACTICAL_ERRORS_IN_PACKET_FILTERS Notify payload.
##### 7.2.7.3.4 Release of an additional IPSec ESP tunnel
Upon receiving an INFORMATIONAL request message in the IKE SA of the PDN
connection, with a DELETE payload indicating an ePDG\'s ESP SPI of a bearer
context of the PDN connection, the UE shall send an INFORMATIONAL response
message without an IKEv2 notify payload indicating an error and the UE shall
remove the bearer context from the PDN connection.
##### 7.2.7.3.5 Modification of an IPSec ESP tunnel due to change of EPS QoS
and TFT
Upon receiving an INFORMATIONAL request message the IKE SA of the PDN
connection, with a MODIFIED_BEARER Notify payload as specified in clause
8.2.9.12 indicating an ePDG\'s ESP SPI of a bearer context of the PDN
connection, if the UE sends an INFORMATIONAL response message without an IKEv2
notify payload indicating an error:
a) if the EPS_QOS Notify payload as specified in clause 8.2.9.10 is included
in the INFORMATIONAL request message:
1) the UE shall update the bearer context with the EPS QoS indicated in the
EPS_QOS Notify payload; and
2) if the EXTENDED_EPS_QOS Notify payload as specified in clause 8.2.9.10A is
included in the INFORMATIONAL request message, the UE shall update the bearer
context with the extended EPS QoS indicated in the EXTENDED_EPS_QOS Notify
payload;
b) if the TFT Notify payload as specified in clause 8.2.9.11 is included in
the INFORMATIONAL request message, the UE shall update the bearer context with
the TFT indicated in the TFT Notify payload; and
c) if the bearer context is the default bearer context and the APN_AMBR Notify
payload as specified in clause 8.2.9.13 is included in the INFORMATIONAL
request message:
1) the UE shall update the bearer context with the APN-AMBR indicated in the
APN_AMBR Notify payload; and
2) if the EXTENDED_APN_AMBR Notify payload as specified in clause 8.2.9.14 is
included in the INFORMATIONAL request message, the UE shall update the bearer
context with the extended APN-AMBR indicated in the EXTENDED_APN_AMBR Notify
payload.
Upon receiving an INFORMATIONAL request message the IKE SA of the PDN
connection, with a MODIFIED_BEARER Notify payload as specified in clause
8.2.9.12 indicating an ePDG\'s ESP SPI of a bearer context of the PDN
connection, and with a TFT Notify payload as specified in clause 8.2.9.11:
a) the UE checks for semantic errors in TFT operations as follows:
1) if the _TFT operation_ in the TFT Notify payload is \"Create a new TFT\"
and there is already an existing TFT for the bearer context, the UE shall
further process the new activation request and, if it was processed
successfully, delete the old TFT;
2) if the _TFT operation_ in the TFT Notify payload is an operation other than
\"Create a new TFT\" and there is no TFT for the bearer context, the UE shall
not diagnose an error and perform the following actions to resolve the
inconsistency:
i) if the TFT operation is \"Delete existing TFT\" or \"Delete packet filters
from existing TFT\", and if no error according to items b, c, and d was
detected, consider the TFT as successfully deleted; and
ii) if the TFT operation is \"Add packet filters in existing TFT\" or
\"Replace packet filters in existing TFT\", the UE shall process the new
request as an activation request;
3) if the _TFT operation_ in the TFT Notify payload is \"Delete packet filters
from existing TFT\" and it would render the TFT empty:
i) if the packet filters belong to a bearer context which is not the default
bearer context, the UE shall process the new deletion request and, if no error
according to items b, c, and d was detected, the UE shall send an
INFORMATIONAL response message with the SEMANTIC_ERROR_IN_THE_TFT_OPERATION
Notify payload; and
ii) if the packet filters belong to a bearer context which is the default
bearer context, the UE shall process the new deletion request and if no error
according to items b, c, and d was detected then delete the existing TFT; and
4) if the _TFT operation_ in the TFT Notify payload is \"Delete existing TFT\"
and the bearer context is not the default bearer context, the UE shall send an
INFORMATIONAL response message with the SEMANTIC_ERROR_IN_THE_TFT_OPERATION
Notify payload;
b) the UE checks for syntactical errors in TFT operations as follows:
1) if the _TFT operation_ in the TFT Notify payload is \"Create a new TFT\",
\"Add packet filters in existing TFT\", \"Replace packet filters in existing
TFT\" or \"Delete packet filters from existing TFT\" and the packet filter
list in the TFT Notify payload is empty, the UE shall send an INFORMATIONAL
response message with the SYNTACTICAL_ERROR_IN_THE_TFT_OPERATION Notify
payload;
2) if _TFT operation_ in the TFT Notify payload is \"Delete existing TFT\" or
\"No TFT operation\" with a non-empty packet filter list in the TFT Notify
payload, the UE shall send an INFORMATIONAL response message with the
SYNTACTICAL_ERROR_IN_THE_TFT_OPERATION Notify payload;
3) if _TFT operation_ in the TFT Notify payload is \"Replace packet filters in
existing TFT\" when the packet filter to be replaced does not exist in the
original TFT, the UE shall not diagnose an error, further process the replace
request and, if no error according to items c and d was detected, include the
packet filters received to the existing TFT;
4) if _TFT operation_ in the TFT Notify payload is \"Delete packet filters
from existing TFT\" when the packet filter to be deleted does not exist in the
original TFT, the UE shall not diagnose an error, further process the deletion
request and, if no error according to items c and d was detected, consider the
respective packet filter as successfully deleted;
5) if _TFT operation_ in the TFT Notify payload is \"Delete packet filters
from existing TFT\" with a packet filter list also including packet filters in
addition to the packet filter identifiers, the UE shall send an INFORMATIONAL
response message with the SYNTACTICAL_ERROR_IN_THE_TFT_OPERATION Notify
payload; and
6) if there are other types of syntactical errors in the coding of the TFT
Notify payload, such as a mismatch between the number of packet filters
subfield, and the number of packet filters in the packet filter list, the UE
shall send an INFORMATIONAL response message with the
SYNTACTICAL_ERROR_IN_THE_TFT_OPERATION Notify payload;
c) the UE checks for semantic errors in packet filters as follows:
1) if a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter, the UE shall send an INFORMATIONAL response message with
the SEMANTIC_ERRORS_IN_PACKET_FILTERS Notify payload. How the UE determines a
semantic error in a packet filter is outside the scope of the present
document; and
2) if the resulting TFT, which is assigned to a bearer context which is not
the default bearer context, does not contain any packet filter applicable for
the uplink direction among the packet filters created on request from the
network, the UE shall send an INFORMATIONAL response message with the
SEMANTIC_ERRORS_IN_PACKET_FILTERS Notify payload; and
d) the UE checks for syntactical errors in packet filters as follows:
1) if the _TFT operation_ in the TFT Notify payload is \"Create a new TFT\",
\"Add packet filters to existing TFT\", and two or more packet filters in the
resultant TFT would have identical packet filter identifiers:
i) if two or more packet filters with identical packet filter identifiers are
contained in the new request, the UE shall send an INFORMATIONAL response
message with the SYNTACTICAL_ERRORS_IN_PACKET_FILTERS Notify payload; and
ii) if two or more packet filters with identical packet filter identifiers are
not contained in the new request, the UE shall not diagnose an error, further
process the new request and, if it was processed successfully, delete the old
packet filters which have the identical packet filter identifiers;
2) if the _TFT operation_ in the TFT Notify payload is \"Create a new TFT\",
\"Add packet filters to existing TFT\" or \"Replace packet filters in existing
TFT\", and two or more packet filters among all TFTs associated with this PDN
connection would have identical packet filter precedence values:
i) if the old packet filters do not belong to the default bearer contex, the
UE shall send an INFORMATIONAL response message with the
SYNTACTICAL_ERRORS_IN_PACKET_FILTERS Notify payload; and
NOTE: the UE is not expected to be able to release a particular bearer
context.
ii) if one or more old packet filters belong to the default bearer context,
the UE shall release the PDN connection as specified in clause 7.2.4.1; and
3) if there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier, the UE shall send an INFORMATIONAL response message with the
SYNTACTICAL_ERRORS_IN_PACKET_FILTERS Notify payload.
##### 7.2.7.3.6 ePDG initiated IPSec ESP tunnel rekeying
Upon receiving a CREATE_CHILD_SA request message in the IKE SA of the PDN
connection, with a REKEY_SA Notify payload indicating an ePDG\'s ESP SPI of a
bearer context of the PDN connection, if the UE sends a CREATE_CHILD_SA
response message without an IKEv2 notify payload indicating an error, the UE
shall set the UE\'s ESP SPI of the bearer context to the UE\'s ESP SPI created
by the CREATE_CHILD_SA request/response pair and shall set the ePDG\'s ESP SPI
of the bearer context to the ePDG\'s ESP SPI created by the CREATE_CHILD_SA
request/response pair.
##### 7.2.7.3.7 UE initiated IPSec ESP tunnel rekeying
Upon receiving a CREATE_CHILD_SA response message without an IKEv2 notify
payload indicating an error, for a CREATE_CHILD_SA request message sent in the
IKE SA of the PDN connection, with a REKEY_SA Notify payload indicating an
UE\'s ESP SPI of a bearer context of the PDN connection, the UE shall set the
UE\'s ESP SPI of the bearer context to the UE\'s ESP SPI created by the
CREATE_CHILD_SA request/response pair and shall set the ePDG\'s ESP SPI of the
bearer context to the ePDG\'s ESP SPI created by the CREATE_CHILD_SA
request/response pair.
#### 7.2.7.4 User plane procedures
##### 7.2.7.4.1 General
Parent clause of the present clause describe user plane procedures for the
IKEv2 multiple bearer PDN connectivity.
##### 7.2.7.4.2 Uplink IP packet handling
If an uplink IP packet to be sent via a PDN connection:
\- matches the packet filters applicable for the uplink direction of the TFT
of a bearer context of the PDN connection, the UE shall forward the uplink IP
packet using the ePDG\'s ESP SPI of the bearer context. The UE shall use the
most recent DSCP value received in the same IPSec SA from the ePDG or the QCI
in the EPS QoS of the bearer context to derive the DSCP value for uplink
packets and set the DSCP field as specified in IETF RFC 2474 [75] of the outer
IP header of the ESP packet.
\- does not match the packet filters applicable for the uplink direction of
the TFT of any bearer context of the PDN connection and a bearer context
without the TFT exists in the PDN connection, the UE shall forward the uplink
IP packet using the ePDG\'s ESP SPI of the bearer context without the TFT. The
UE shall set the DSCP field as specified in IETF RFC 2474 [75] of the outer IP
header of the ESP packet to the DSCP value in a QoS mapping with the QCI
indicated in the EPS QoS of the bearer context without the TFT.
\- does not match the packet filters applicable for the uplink direction of
the TFT of any bearer context of the PDN connection and a bearer context
without the TFT does not exist in the PDN connection, the UE shall discard the
uplink IP packet.
NOTE 1: The UE can map QCI to DSCP value, for example, by using the mapping
between standardized QCI values and Release 99 3GPP QoS parameter values
specified in 3GPP TS 23.401 [4] table E.3, and the mapping between Release 99
3GPP QoS parameter values and DSCP values specified in IEEE Std 802.11 [57]
table R-1.
NOTE 2: The TSi payload and the TSr payloads are not used for selection of ESP
SPI for the uplink IP packet.
NOTE 3: Whether the UE determines DSCP based on the DSCP value received in the
same IPSec SA from the ePDG or on the QoS mapping is left to the
implementation.
NOTE 4: The UE can apply a different DSCP value in the outer IP header than
the DSCP value applied in the inner IP header.
## 7.3 3GPP AAA server procedures
The UE -- 3GPP AAA server procedures are as specified in 3GPP TS 29.273 [17]
and 3GPP TS 33.402 [15].
## 7.4 ePDG procedures
### 7.4.1 Tunnel establishment
#### 7.4.1.1 Tunnel establishment accepted by the network
Upon receipt of an IKE_AUTH request message from the UE requesting the
establishment of a tunnel, the ePDG shall proceed with authentication and
authorization. The basic procedure described in 3GPP TS 33.402 [15], while
further details are given below.
Upon receipt of an IKE_AUTH request message with the HPA_INFO field in the
HPA_INFO Notify payload (see clause 8.1.2.3) indicating high priority access,
based on operator policy, the ePDG should treat the UE with priority, e.g.,
with overload control for Diameter messages as defined in Annex C and Annex D
in 3GPP TS 29.273 [17].
NOTE 1: Alternatively, the ePDG can give priority to this UE after the network
has successfully authenticated the UE as described in 3GPP TS 29.273 [17], at
which time the ePDG handles all subsequent messages with priority.
During the UE\'s authentication and authorization procedure, the 3GPP AAA
server provides to the ePDG an indication about the selected IP mobility
mechanism as specified in 3GPP TS 29.273 [17].
The ePDG shall proceed with IPsec tunnel setup completion and shall relay in
the IKEv2 Configuration Payload (CFG_REPLY) of the final IKE_AUTH response
message:
\- The remote IP address information to the UE as follows:
\- If NBM is used as IP mobility mechanism, the ePDG shall assign either an
IPv4 address or an IPv6 Home Network Prefix or both to the UE via a single
CFG_REPLY Configuration Payload. If the UE requests for both IPv4 address and
IPv6 prefix, but the ePDG only assigns an IPv4 address or an IPv6 Home Network
Prefix due to subscription restriction or network preference, the ePDG shall
include the assigned remote IP address information (IPv4 address or IPv6
prefix) via a single CFG_REPLY Configuration Payload and should add the
corresponding PDN_TYPE_IPv4_ONLY_ALLOWED Notify payload, or PDN
TYPE_IPv6_ONLY_ALLOWED Notify payload. If the ePDG assigns an IPv4 address,
the CFG_REPLY contains the INTERNAL_IP4_ADDRESS attribute. If the ePDG assigns
an IPv6 Home Network Prefix, the CFG_REPLY contains the INTERNAL_IP6_SUBNET or
INTERNAL_IP6_ADDRESS configuration attributes. The ePDG obtains the IPv4
address and/or the IPv6 Home Network Prefix from the PDN GW; or
NOTE 2: In case of IPv6 address, if CFG_REPLY Configuration Payload contains
the INTERNAL_IP6_SUBNET or INTERNAL_IP6_ADDRESS, the UE considers only IPv6
Home Network Prefix defined by the prefix length value.
\- If DSMIPv6 is used as IP mobility mechanism, depending on the information
provided by the UE in the CFG_REQUEST payload the ePDG shall assign to the UE
either a local IPv4 address or local IPv6 address (or a local IPv6 prefix) via
a single CFG_REPLY Configuration Payload. If the ePDG assigns a local IPv4
address, the CFG_REPLY contains the INTERNAL_IP4_ADDRESS attribute and should
add the corresponding PDN TYPE_IPv4_ONLY_ALLOWED Notify payload or PDN
TYPE_IPv6_ONLY_ALLOWED Notify payload. If the ePDG assigns a local IPv6
address or a local IPv6 prefix the CFG_REPLY contains correspondingly the
INTERNAL_IP6_ADDRESS or the INTERNAL_IP6_SUBNET attribute; and
\- If the UE included the INTERNAL_IP6_DNS or the INTERNAL_IP4_DNS in the
CFG_REQUEST Configuration payload, the ePDG shall include the same attribute
in the CFG_REPLY Configuration payload including zero or more DNS server
addresses as specified in IETF RFC 7296 [28];
\- If the UE included the P_CSCF_IP6_ADDRESS attribute, the P_CSCF_IP4_ADDRESS
attribute or both in the CFG_REQUEST configuration payload, the ePDG may
include one or more instances of the same attribute in the CFG_REPLY
configuration payload as specified in IETF  _RFC_ 7651 [64]; and
\- The ePDG may include the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as
specified in clause 8.2.4.2 indicating the timeout period for liveness check
in the CFG_REPLY configuration payload. Presence of the
TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute in the IKE_AUTH request can be
used as input for decision on whether to include the
TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute.
If the UE does not provide an APN to the ePDG during the tunnel establishment
of a non-emergency session, the ePDG shall include the default APN in the
\"IDr\" payload of the IKE_AUTH response message. If the UE provided an APN to
the ePDG during the tunnel establishment, the ePDG shall not change the
provided APN and shall include the APN in the IDr payload of the IKE_AUTH
response message. The ePDG shall set the ID Type field of the \"IDr\" payload
to ID_FQDN as defined in IETF RFC 7296 [28]. Handling of \"IDr\" payload in
case of an emergency session is specified in clause 7.4.4. An IPsec tunnel is
now established between the UE and the ePDG.
If the UE indicates Handover Attach by including the previously allocated home
address information and the ePDG obtains one or more PDN GW identities from
the 3GPP AAA server, the ePDG shall use these identified PDN GWs in the
subsequent PDN GW selection process. If the UE indicates Initial Attach i.e.
home address information not included:
\- if the PDN GW allocation type received from the 3GPP AAA server indicates
the static allocation type, the received PDN GW identities shall be used to
select PDN-GW; and
\- if the PDN GW allocation type received from the 3GPP AAA server indicates
the dynamic allocation type, the PDN GW is selected based on DNS query via the
UE requested APN.
The ePDG shall support IPSec ESP (see IETF RFC 4303 [32]) in order to provide
secure tunnels between the UE and the ePDG as specified in 3GPP TS 33.402
[15].
During the IKEv2 authentication and tunnel establishment, if the UE requested
the HA IP address(es) and if DSMIPv6 was chosen and if the HA IP address(es)
are available, the ePDG shall provide the HA IP address(es) (IPv6 address and
optionally IPv4 address) for the corresponding APN as specified by the \"IDr\"
payload in the IKE_AUTH request message by including in the CFG_REPLY
Configuration Payload a HOME_AGENT_ADDRESS attribute. In the CFG_REPLY, the
ePDG sets respectively the IPv6 Home Agent address field and optionally the
IPv4 Home Agent address field of the HOME_AGENT_ADDRESS attribute to the IPv6
address of the HA and to the IPv4 address of the HA. If no IPv4 HA address is
available at the ePDG or if it was not requested by the UE, the ePDG shall
omit the IPv4 Home Agent Address field. If the ePDG is not able to provide an
IPv6 HA address for the corresponding APN, then the ePDG shall not include a
HOME_AGENT_ADDRESS attribute in the CFG_REPLY.
The ePDG may support multiple authentication exchanges in the IKEv2 protocol
as specified in IETF RFC 4739 [49] in order to support additional
authentication and authorization of the UE with an external AAA server.
If the ePDG supports authentication and authorization of the UE with an
external AAA server, on receipt of an IKE_SA_INIT message the ePDG shall
include a Notify payload of type \"MULTIPLE_AUTH_SUPPORTED\" in the
IKE_SA_INIT response message to the UE.
On successful completion of authentication and authorization procedure of the
UE accessing EPC and on receipt of an IKE_AUTH request containing a Notify
payload of type \"ANOTHER_AUTH_FOLLOWS\", the ePDG shall send an IKE_AUTH
response containing the \"AUTH\" payload.
Upon receipt of a subsequent IKE_AUTH request from the UE containing the user
identity in the private network within the \"IDi\" payload, the ePDG shall:
\- if PAP authentication is required, then send an EAP-GTC request to the UE
within an IKE_AUTH response message. Upon receipt of an EAP-GTC response from
the UE, the ePDG shall use the procedures defined in 3GPP TS 29.275 [18] and
3GPP TS 29.274 [50] to authenticate the user with the external AAA server; and
\- if CHAP authentication is required, then send an EAP MD5-Challenge request
to UE. Upon receipt of EAP MD5-Challenge response within an IKE_AUTH request
message from the UE, the ePDG shall use the procedures defined in 3GPP TS
29.275 [18] and 3GPP TS 29.274 [50] to authenticate the user with the external
AAA server. If the ePDG receives Legacy-Nak response containing EAP--GTC type
from the UE (see IETF RFC 3748 [29]) the ePDG may change the authentication
and authorization procedure. If the ePDG does not change the authentication
and authorization procedure or if the ePDG receives a Legacy-Nak response not
containing EAP-GTC, the ePDG shall send an EAP-Failure to the UE.
NOTE: The signalling flows for authentication and authorization with an
external AAA server are described in 3GPP TS 33.402 [15].
If the IKE_AUTH request message contains a P-CSCF_RESELECTION_SUPPORT Notify
payload as described in clause 8.2.9.4 and if the ePDG supports the P-CSCF
restoration extension (see 3GPP TS 23.380 [66]), the ePDG shall send a
P-CSCF_RESELECTION_SUPPORT indication to the PGW.
If the ePDG supports emergency service, the ePDG shall **send its** capability
indication of support emergency service to the UE by including the
EMERGENCY_SUPPORT Notify payload within an IKE_AUTH response message**.** The
content of the EMERGENCY_SUPPORT Notify payload is described in clause
8.2.9.7.
#### 7.4.1.2 Tunnel establishment not accepted by the network
During the tunnel establishment procedures, if the ePDG receives from the AAA
Server the Authentication and Authorization Answer message with the Result
code IE (as specified in 3GPP TS 29.273 [17]):
a) DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION, the ePDG shall include, in
the IKE_AUTH response message to the UE, a Notify payload with a Private
Notify Message Type NON_3GPP_ACCESS_TO_EPC_NOT_ALLOWED as defined in clause
8.1.2;
b) DIAMETER_ERROR_USER_UNKNOWN, the ePDG shall include, in the IKE_AUTH
response message to the UE, a Notify payload with a Private Notify Message
Type USER_UNKNOWN as defined in clause 8.1.2;
c) DIAMETER_AUTHORIZATION_REJECTED, the ePDG shall include, in the IKE_AUTH
response message to the UE, a Notify payload with a Private Notify Message
Type AUTHORIZATION_REJECTED as defined in clause 8.1.2;
d) DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED, the ePDG shall include, in the
IKE_AUTH response message to the UE, a Notify payload with a Private Notify
Message Type RAT_TYPE_NOT_ALLOWED as defined in clause 8.1.2;
e) DIAMETER_UNABLE_TO_ COMPLY, the ePDG shall include, in the IKE_AUTH
response message to the UE, a Notify payload with a Private Notify Message
Type NETWORK_FAILURE as defined in clause 8.1.2 and the ePDG may also include
a BACKOFF_TIMER Notify payload of the IKE_AUTH response message;
f) DIAMETER_ERROR_ROAMING_NOT_ALLOWED, the ePDG shall include, in the IKE_AUTH
response message to the UE, a Notify payload with a Private Notify Message
Type PLMN_NOT_ALLOWED as defined in clause 8.1.2;
g) DIAMETER_ERROR_ USER_NO_APN_SUBSCRIPTION, the ePDG shall include, in the
IKE_AUTH response message to the UE, a Notify Payload with a Private Notify
Message Type NO_APN_SUBSCRIPTION as defined in clause 8.1.2 and the ePDG may
also include a BACKOFF_TIMER Notify payload of the IKE_AUTH response message;
or
h) DIAMETER_ERROR_ILLEGAL_EQUIPMENT, the ePDG shall include, in the IKE_AUTH
response message to the UE, a Notify payload with a Private Notify Message
Type ILLEGAL_ME as defined in clause 8.1.2.
NOTE: In the cases a) through h), the ePDG still provides to the UE the
information needed to authenticate the ePDG.
During the tunnel establishment procedures when the ePDG is congested, if the
UE is a UE configured for high priority access as specified in clause 6.4.2.3,
and if allowed by operator policy, the ePDG shall attempt to complete the
procedure unless doing so would cause system instability.
During the tunnel establishment procedures, when the network has determined
that the requested procedure cannot be completed successfully due to a network
failure, e.g. due to ePDG congestion, the ePDG:
a) shall include in the IKE_AUTH response message to the UE a Notify payload
with a Private Notify Message Type NETWORK_FAILURE as defined in clause 8.1.2;
and
b) may also include a BACKOFF_TIMER Notify payload of the IKE_AUTH response
message.
If NBM is used and if the ePDG needs to reject a PDN connection due to
conditions as specified in 3GPP TS 29.273 [17] or the network policies or the
ePDG capabilities to indicate that no more PDN connection request of the given
APN can be accepted for the UE, the ePDG shall include, in the IKE_AUTH
response message, a Notify payload with a Private Notify Message Type
PDN_CONNECTION_REJECTION as specified in clause 8.1.2. Additionally if the
IKE_AUTH request message from the UE indicated Handover Attach as specified in
clause 7.2.2, and the ePDG needs to reject a PDN connection for example due to
the corresponding PDN GW identity not received for the APN, the ePDG shall
include, in the IKE_AUTH response message, a Notify payload with a Private
Notify Message Type \"PDN_CONNECTION_REJECTION\" as specified in clause 8.1.2
and the Notification Data field with the IP address information from the
Handover Attach indication. If the UE indicated Initial Attach, the
Notification Data field shall be omitted.
If the ePDG needs to reject a PDN connection due to the network policies or
capabilities to indicate that no more PDN connection request with any APN can
be accepted for the UE, the ePDG shall include in the IKE_AUTH response
message containing the IDr payload a Notify payload with a Private Notify
Message Type MAX_CONNECTION_REACHED as specified in clause 8.1.2.
### 7.4.1A Liveness check
If the ePDG has not received any cryptographically protected IKEv2 or IPSec
message for the duration of the timeout period for liveness check selected
according to the local policy, the ePDG shall send an INFORMATIONAL request
with no payloads IETF RFC 7296 [28]. If an INFORMATIONAL response is not
received, the ePDG shall deem the IKEv2 security association to have failed,
shall discard all states associated with the IKE SA and any child SAs that
were negotiated using that IKE SA as specified in IETF RFC 7296 [28] and shall
inform the PGW and the 3GPP AAA Server that the connection has been released.
### 7.4.1B Handling of NBIFOM
If the UE included the NBIFOM_GENERIC_CONTAINER Notify payload (see clause
8.1.2.3) within the IKE_AUTH request message, and if required by procedures in
3GPP TS 24.161 [69], the ePDG shall include the same Notify payload within the
IKE_AUTH response message as specified in 3GPP TS 24.161 [69]. The ePDG shall
set the NBIFOM container contents field of the NBIFOM_GENERIC_CONTAINER Notify
payload as specified in 3GPP TS 24.161 [69].
### 7.4.1C Handling of N1 mode support
If the UE included the N1_MODE_CAPABILITY Notify payload (see clause 8.1.2.3)
within the IKE_AUTH request message, the ePDG may include the
N1_MODE_INFORMATION Notify payload and the N1_MODE_S_NSSAI_PLMN_ID Notify
payload within the IKE_AUTH response message. The ePDG shall set the S-NSSAI
Value field of the N1_MODE INFORMATION Notify payload to the S-NSSAI for the
PDU session associated with the IKEv2 security association if the ePDG
receives the S-NSSAI information as specified in 3GPP TS 29.274 [50] for the
PDU session indicated in the PDU session ID field of the N1_MODE_CAPABILITY
Notify payload. The ePDG shall set the S-NSSAI PLMN ID field of the
N1_MODE_S_NSSAI_PLMN_ID Notify payload to the PLMN ID that the S-NSSAI relates
to for the PDU session associated with the IKEv2 security association if the
ePDG receives the PLMN ID that the S-NSSAI relates to as specified in 3GPP TS
29.274 [50] for the PDU session indicated in the PDU session ID field of the
N1_MODE_CAPABILITY Notify payload.
### 7.4.2 Tunnel modification
#### 7.4.2.1 ePDG-initiated modification
The ePDG shall forward the list of available P-CSCF addresses received from
the P-GW by including the P_CSCF_IP6_ADDRESS attribute, the P_CSCF_IP4_ADDRESS
attribute or both as specified in IETF  _RFC_ 7651 [64] in the CFG_REQUEST
configuration payload within the INFORMATIONAL request to the UE as specified
in 3GPP TS 23.380 [66].
If the ePDG-initiated modification procedure is triggered by NBIFOM procedures
in 3GPP TS 24.161 [69], the ePDG shall include the NBIFOM_GENERIC_CONTAINER
Notify payload (see clause 8.1.2.3) in the INFORMATIONAL request. The ePDG
shall set the NBIFOM container contents field of the NBIFOM_GENERIC_CONTAINER
Notify payload as specified in 3GPP TS 24.161 [69].
If the ePDG-initiated modification is initiated by a UE-initiated
modification, i.e. by a received INFORMATIONAL request message, then the ePDG
shall include in the sent INFORMATIONAL request message a PTI Notify payload
as specified in clause 8.1.2.3 with the Related Message ID field set to the
Message ID field of the received INFORMATIONAL request message.
#### 7.4.2.2 ePDG behaviour towards UE-initiated modification
When receiving an INFORMATIONAL request containing the UPDATE_SA_ADDRESSES
notification, the ePDG shall check the validity of the IP address and update
the IP address in the IKE security association with the values from the IP
header. The ePDG shall reply with an INFORMATIONAL response.
The ePDG may initiate a return routability check for the new address provided
by the UE, by including a COOKIE2 notification in an INFORMATIONAL request and
send it to the UE. When the ePDG receives the INFORMATIONAL response from the
UE, it shall check that the COOKIE2 notification payload is the same as the
one it sent to the UE. If it is different, the ePDG shall close the IKE
security association by sending an INFORMATIONAL request message including a
\"DELETE\" payload.
If no return routability check is initiated by the ePDG, or if a return
routability check is initiated and is successfully completed, the ePDG shall
update the IPsec security associations associated with the IKE security
association with the new address.
Upon of receipt of the NBIFOM_GENERIC_CONTAINER Notify payload (see clause
8.1.2.3)in an INFORMATIONAL request, the ePDG shall reply with an
INFORMATIONAL response and if required by procedures in 3GPP TS 24.161 [69],
the ePDG shall include the NBIFOM_GENERIC_CONTAINER Notify payload in the
INFORMATIONAL response. The ePDG shall set the NBIFOM container contents field
of the NBIFOM_GENERIC_CONTAINER Notify payload as specified in 3GPP TS 24.161
[69].
Based on operator policy, under general overload conditions the ePDG should
not reject requests from UEs which the ePDG is treating with high priority
access according to 3GPP TS 29.273 [17], up to the point where further
exemption would cause network instability.
### 7.4.3 Tunnel disconnection
#### 7.4.3.1 ePDG initiated disconnection
The ePDG shall use the procedures defined in the IKEv2 protocol (see IETF RFC
7296 [28]) to disconnect one or more IPsec tunnels to the UE. The ePDG shall
close the incoming security associations associated with the tunnel and
instruct the UE to do likewise by sending the INFORMATIONAL request message
including a \"DELETE\" payload. The DELETE payload shall contain either:
i) Protocol ID set to \"1\" and no subsequent Security Parameter Indexes in
the payload. This indicates that the IKE security association, and all IPsec
ESP security associations that were negotiated within it between ePDG and UE
shall be deleted;
ii) if the IKEv2 multiple bearer PDN connectivity is not supported or not used
in the PDN connection as determined in clause 7.4.6, the Protocol ID set to
\"3\" for ESP. The SECURITY PARAMETERS INDEXES s included in the payload shall
correspond to the particular incoming ESP SECURITY ASSOCIATION at the ePDG for
the given tunnel in question; or
iii) if the IKEv2 multiple bearer PDN connectivity is used in the PDN
connection as determined in clause 7.4.6, the Protocol ID field of the DELETE
payload is set to \"3\" for ESP and the SPI field of the DELETE payload
includes ePDG\'s ESP SPIs bound to each the **S2b bearers of the PDN
connection**.
The INFORMATIONAL request message, in addition of the DELETE payload, may
include the REACTIVATION_REQUESTED_CAUSE Notify payload.
If the ePDG receives the reactivation requested cause in a Delete Bearer
Request over S2b, the ePDG shall include the REACTIVATION_REQUESTED_CAUSE
Notify payload in the INFORMATIONAL request message containing a DELETE
payload.
#### 7.4.3.2 ePDG behaviour towards UE initiated disconnection
On receipt of the INFORMATIONAL request message including \"DELETE\" payload
indicating that the UE is initiating tunnel disconnect procedure, the ePDG
shall:
i) Close all security associations identified within the DELETE payload (these
security associations correspond to outgoing security associations from the
ePDG perspective). If no security associations were present in the DELETE
payload, and the protocol ID was set to \"1\", the ePDG shall close the IKE
security association, and all IPsec ESP security associations that were
negotiated within it towards the UE; and
ii) The ePDG shall delete the incoming security associations corresponding to
the outgoing security associations identified in the \"DELETE\" payload.
The ePDG shall send an INFORMATIONAL response message. This shall contain a
list of security associations deleted in step (ii) above.
If the ePDG is unable to comply with the INFORMATIONAL request message, the
ePDG shall send INFORMATION response message with either:
i) a NOTIFY payload of type \"INVALID_SPI\", for the case that it could not
identify one or more of the SECURITY PARAMETERS INDEXES in the message from
the UE; or
ii) a more general NOTIFY payload type. This payload type is implementation
dependent.
#### 7.4.3.3 Local tunnel disconnection initiated by PGW
A PDN connection over untrusted WLAN over S2b can be released locally in the
ePDG, i.e. without any peer-to-peer signalling between the ePDG and the UE,
based on the trigger received from the PGW, e.g. during the P-CSCF restoration
procedure for NBIFOM PDN connections (see 3GPP TS 23.380 [66]).
Upon receiving a request from PGW to release the resources for a PDN
connection with cause \"local release\" (see 3GPP TS 29.274 [50]) the ePDG
shall:
a) close the related IKEv2 security association for the IPsec tunnel
associated with this PDN connection; and
b) consider that the UE is no longer responding (see RFC 7296 [28]) and not
send any messages to the UE.
### 7.4.4 Emergency session establishment
If the \"IDr\" payload containing the string \"EMERGENCY\", using capital
letters only, in the Identification Data is included in the IKE_AUTH request
message from the UE, the ePDG shall:
a) if:
1) an INTERNAL_IP4_ADDRESS attribute with the length field set to zero;
2) an INTERNAL_IP6_ADDRESS attribute with the length field set to zero; or
3) both of the above;
are included in the CFG_REQUEST Configuration Payload within the IKE_AUTH
request message, handle the session establishment as an emergency session
establishment;
b) if:
1) an INTERNAL_IP4_ADDRESS attribute with the length field set to non-zero;
2) an INTERNAL_IP6_ADDRESS attribute with the length field set to non-zero; or
3) both of the above;
are included in the CFG_REQUEST Configuration Payload within the IKE_AUTH
request message, handle the session establishment as a handover of an
emergency session;
c) in the IKE_AUTH response message, the ePDG shall not include the APN in the
\"IDr\" payload; and
d) ignore the fact that the \"EMERGENCY\" string does not comply with the
ID_FQDN ID Type, as described in IETF RFC 7296 [28].
In addition, if the IKE tunnel establishment is initiated for emergency
session:
1) if IMSI is provided to the network but the ePDG receives from the AAA
Server the Authentication and Authorization Answer message with the Result
code IE indicating DIAMETER_ERROR_USER_UNKNOWN (see 3GPP TS 29.273 [17]), and
thus the network considers the IMSI is unauthenticated:
\- if the ePDG is configured to support unauthenticated emergency session over
WLAN and Mobile Equipment Identity signalling over untrusted WLAN, the ePDG
shall request the IMEI from the UE using the Mobile Equipment Identity
signalling procedure by including the DEVICE_IDENTITY Notify payload in the
IKE_AUTH response message as specified in clause 7.4.5; or
\- if the ePDG is not configured to support unauthenticated emergency session
over WLAN or the ePDG is not configured to support Mobile Equipment Identity
signalling over untrusted WLAN, the ePDG shall reject the requested PDN
connection for emergency session. The ePDG shall include, in the IKE_AUTH
response message, a Notify payload with a Private Notify Message Type
\"UNAUTHENTICATED_EMERGENCY_NOT_SUPPORTED\" as specified in clause 8.1.2; or
2) if IMSI is not provided to the network and the UE\'s IMEI is used as the
User Identity in the IDi payload of the IKE_AUTH request message:
\- if the ePDG is configured to support emergency services from
unauthenticated UE and the local policies and regulations allow
unauthenticated emergency sessions, the ePDG sends an EAP payload with the NAI
in the IDi payload received from the UE to the 3GPP AAA Server serving the
specific domain indicated in the realm part of NAI in the IDr payload. If the
ePDG receives the Authentication and Authorization Answer message with the
Result code IE indicating DIAMETER_ERROR_USER_UNKNOWN (see 3GPP TS 29.273
[17]), the ePDG shall reject the emergency services request from the UE with
the Notify Message Type IMEI_NOT_ACCEPTED as specified in clause 8.1.2.2; or
\- if the ePDG is not configured to support emergency services from
unauthenticated UE or if the local policies and regulations do not allow
unauthenticated emergency sessions, the ePDG shall reject the emergency
services request from the UE with the Notify Message Type IMEI_NOT_ACCEPTED as
specified in clause 8.1.2.2.
### 7.4.5 Mobile identity signaling
If the network supports Mobile Equipment Identity signalling over untrusted
WLAN, the ePDG may request the UE to provide the Mobile Equipment Identity by
including the DEVICE_IDENTITY Notify payload with the Identity Type field set
to either \'IMEI\' or \'IMEISV\' and an empty Identity Value field in:
\- the IKE_AUTH response message to the initial IKE_AUTH request message
received from the UE during the IKEv2 authentication and security association
establishment; or
\- the INFORMATIONAL request message at any time after successful IPSec tunnel
establishment.
If the ePDG receives the following response message from the UE:
\- the IKE_AUTH request message with the DEVICE_IDENTITY Notify payload; or
\- the INFORMATIONAL response message with the DEVICE_IDENTITY Notify payload,
and the Identity Type field set to either \'IMEI\' or \'IMEISV\' and the
Identity Value is not empty, the ePDG shall forward the received IMEI or
IMEISV identity to the 3GPP AAA server as specified in 3GPP TS 29.273 [17] and
to the PDN GW as specified in 3GPP TS 29.275 [18] and 3GPP TS 29.274 [50].
### 7.4.6 IKEv2 multiple bearer PDN connectivity
#### 7.4.6.1 General
The ePDG may support the IKEv2 multiple bearer PDN connectivity.
If the ePDG supports the IKEv2 multiple bearer PDN connectivity, then the ePDG
shall perform handling specified in the present clause. Otherwise the ePDG
does not perform handling specified in the present clause and remaining
clauses of the parent clause of the present clause.
If the IKE_AUTH request message contains **an**
IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify payload as specified in clause
8.2.9.9 and the ePDG decides to use the IKEv2 multiple bearer PDN connectivity
in the PDN connection of the IKE SA being established by the IKE_AUTH request
message according to local policy, the ePDG shall consider that the IKEv2
multiple bearer PDN connectivity is used in the PDN connection.
If the IKEv2 multiple bearer PDN connectivity is used in the PDN connection,
then the ePDG shall perform the handling specified in remaining clauses of the
parent clause of the present clause. Otherwise the ePDG does not perform the
handling specified in remaining clauses of the parent clause of the present
clause.
#### 7.4.6.2 Maintained information
The ePDG shall maintain a binding of an ePDG\'s ESP SPI and a UE\'s ESP SPI to
each S2b bearer of the PDN connection.
#### 7.4.6.3 Control plane procedures
##### 7.4.6.3.1 General
Parent clause of the present clause describe control plane procedures for the
IKEv2 multiple bearer PDN connectivity.
##### 7.4.6.3.2 Establishment of IKEv2 SA and initial IPSec ESP tunnel
In the IKE_AUTH response message establishing an IKE SA of the PDN connection:
a) the ePDG shall include an EPS_QOS Notify payload as specified in clause
8.2.9.10 indicating the EPS QoS of the default S2b bearer of the PDN
connection;
b) the ePDG may include an EXTENDED_EPS_QOS Notify payload as specified in
clause 8.2.9.10A indicating the extended EPS QoS of the default S2b bearer of
the PDN connection;
c) the ePDG may include an APN_AMBR Notify payload as specified in clause
8.2.9.13 indicating the APN-AMBR of the PDN connection; and
d) if the APN_AMBR Notify payload is included, the ePDG may include an
EXTENDED_APN_AMBR Notify payload as specified in clause 8.2.9.14 indicating
the extended APN-AMBR of the PDN connection
**.Upon sending** the IKE_AUTH response message, the ePDG shall bind the
ePDG\'s ESP SPI created by the IKE_AUTH request/response pair and the UE\'s
ESP SPI created by the IKE_AUTH request/response pair to the default S2b
bearer of the PDN connection.
##### 7.4.6.3.3 Establishment of an additional IPSec ESP tunnel
If a dedicated S2b bearer of the PDN connection is activated, the ePDG shall
send a CREATE_CHILD_SA request message in the IKE SA of the PDN connection. In
the CREATE_CHILD_SA request message:
a) the ePDG shall include an EPS_QOS Notify payload as specified in clause
8.2.9.10 indicating the EPS QoS of the dedicated S2b bearer of the PDN
connection;
b) the ePDG may include an EXTENDED_EPS_QOS Notify payload as specified in
clause 8.2.9.10A indicating the extended EPS QoS of the dedicated S2b bearer
of the PDN connection; and
c) the ePDG shall include an TFT Notify payload as specified in clause
8.2.9.11 indicating the TFT of the dedicated S2b bearer of the PDN connection.
Upon receiving a CREATE_CHILD_SA response message without an IKEv2 notify
payload indicating an error, the ePDG shall accept the dedicated S2b bearer
activation and shall bind the ePDG\'s ESP SPI created by the CREATE_CHILD_SA
request/response pair and the UE\'s ESP SPI created by the CREATE_CHILD_SA
request/response pair to the dedicated S2b bearer of the PDN connection.
Upon receiving a CREATE_CHILD_SA response message with an IKEv2 notify payload
indicating an error, the ePDG shall reject the dedicated S2b bearer
activation.
##### 7.4.6.3.4 Release of an additional IPSec ESP tunnel
If a dedicated S2b bearer of the PDN connection is deactivated, the ePDG shall
send a INFORMATIONAL request message in the IKE SA of the PDN connection. In
the INFORMATIONAL request message, the ePDG shall include an DELETE payload
indicating the ePDG\'s ESP SPI bound to the dedicated S2b bearer.
Upon receiving of a INFORMATIONAL response message, the ePDG shall acknowledge
deactivation of the dedicated S2b bearer.
##### 7.4.6.3.5 Modification of an IPSec ESP tunnel due to change of EPS QoS
and TFT
If an S2b bearer of the PDN connection is modified, the ePDG shall send a
INFORMATIONAL request message in the IKE SA of the PDN connection. In the
INFORMATIONAL request message, the ePDG shall include an MODIFIED_BEARER
Notify payload as specified in clause 8.2.9.12 indicating the ePDG\'s ESP SPI
bound to the S2b bearer. In the INFORMATIONAL request message:
a) the ePDG may include an EPS_QOS Notify payload as specified in clause
8.2.9.10 indicating the EPS QoS of the S2b bearer of the PDN connection;
b) if the EPS_QOS Notify payload is included, the ePDG may include an
EXTENDED_EPS_QOS Notify payload as specified in clause 8.2.9.10A indicating
the extended EPS QoS of the default S2b bearer of the PDN connection;
c) the ePDG may include an TFT Notify payload as specified in clause 8.2.9.11
indicating the TFT of the S2b bearer of the PDN connection; and
d) if the S2b bearer is the default S2b bearer:
1) the ePDG may include an APN_AMBR Notify payload as specified in clause
8.2.9.13 indicating the APN-AMBR of the PDN connection; and
2) if the APN_AMBR Notify payload is included, the ePDG may include an
EXTENDED_APN_AMBR Notify payload as specified in clause 8.2.9.14 indicating
the extended APN-AMBR of the PDN connection.
Upon receiving a INFORMATIONAL response message without an IKEv2 notify
payload indicating an error, the ePDG shall accept the S2b bearer
modification.
Upon receiving a INFORMATIONAL response message with an IKEv2 notify payload
indicating an error, the ePDG shall reject the S2b bearer modification.
##### 7.4.6.3.6 ePDG initiated IPSec ESP tunnel rekeying
Upon receiving a CREATE_CHILD_SA response message without an IKEv2 notify
payload indicating an error, for a CREATE_CHILD_SA request message sent in the
IKE SA of the PDN connection, with a REKEY_SA Notify payload indicating an
ePDG\'s ESP SPI bound to an S2b bearer of the PDN connection, the ePDG shall
set the ePDG\'s ESP SPI bound to the S2b bearer to the ePDG\'s ESP SPI created
by the CREATE_CHILD_SA request/response pair and shall set the UE\'s ESP SPI
bound to the S2b bearer to the UE\'s ESP SPI created by the CREATE_CHILD_SA
request/response pair.
##### 7.4.6.3.7 UE initiated IPSec ESP tunnel rekeying
Upon receiving a CREATE_CHILD_SA request message in the IKE SA of the PDN
connection, with a REKEY_SA Notify payload indicating an UE\'s ESP SPI bound
to an S2b bearer of the PDN connection, if the ePDG sends a CREATE_CHILD_SA
response message without an IKEv2 notify payload indicating an error, the ePDG
shall set the ePDG\'s ESP SPI bound to the S2b bearer to the ePDG\'s ESP SPI
created by the CREATE_CHILD_SA request/response pair, and shall set the UE\'s
ESP SPI bound to the S2b bearer to the UE\'s ESP SPI created by the
CREATE_CHILD_SA request/response pair.
#### 7.4.6.4 User plane procedures
##### 7.4.6.4.1 General
Parent clause of the present clause describe user plane procedures for the
IKEv2 multiple bearer PDN connectivity.
##### 7.4.6.4.2 Downlink IP packet handling
**The ePDG shall forward a downlink IP packet received via an S2b bearer of
the PDN connection using** a UE\'s ESP SPI bound to the **S2b bearer.** The
ePDG shall, based on operator policy, use the QCI and ARP of S2b bearer via
which the downlink packet was received to derive the DSCP value for downlink
packets and set the DSCP field as specified in IETF RFC 2474 [75] of the outer
IP header of the ESP packet.
NOTE: The ePDG can map QCI to DSCP value, for example, by using the mapping
between standardized QCI values and Release 99 3GPP QoS parameter values
specified in 3GPP TS 23.401 [4] table E.3, and the mapping between Release 99
3GPP QoS parameter values and DSCP values specified in IEEE Std 802.11 [57]
table R-1.
##### 7.4.6.4.3 Uplink IP packet handling
**The ePDG shall forward an uplink IP packet received via an ePDG** \'s ESP
SPI bound to an S2b bearer of the PDN connection using the **S2b bearer.**
# 8 PDUs and parameters specific to the present document
## 8.0 General
The least significant bit of a field is represented by the lowest numbered bit
of the highest numbered octet of the field. When the field extends over more
than one octet, the order of bit values progressively decreases as the octet
number increases.
Figure 8.0-1 shows an example of a field where the most significant bit of the
field is marked MSB and the least significant bit of the field is marked LSB.
7 6 5 4 3 2 1 0
* * *
MSB x x x x x x x octet 1 x x x x x x x x  
x x x x x x x LSB octet N
Figure 8.0-1: Example of bit ordering of a field
NOTE: IETF RFCs adopted different numbering of bits, such that the least
significant bit of a field is represented by the highest numbered bit of the
field.
## 8.1 3GPP specific coding information defined within present document
### 8.1.1 Access Network Identity format and coding
#### 8.1.1.1 Generic format of the Access Network Identity
The Access Network Identity shall take the generic format of an octet string
without terminating null characters. The length indicator for the ANID is 2
bytes long, see _IETF RFC 5448_ [38]. Representation as a character string is
allowed, but this character string shall be converted into an octet string of
maximum length 253 according to UTF-8 encoding rules as specified in IETF RFC
3629 [34] before the Access Network Identity is input to the Key Derivation
Function, as specified in 3GPP TS 33.402 [15], used in the Access Network
Identity indication from 3GPP AAA server to UE, cf. clause 8.2.2 or during
authentication for NSWO in 5GS as specified in annex S of 3GPP TS 33.501 [78].
The ANID is structured as an ANID Prefix and none, one or more ANID additional
character strings separated by the colon character \":\". In case additional
ANID strings are not indicated the complete ANID consists of the ANID Prefix
character string only. The ANID shall be represented by Unicode characters
encoded as UTF-8 as specified in IETF RFC 3629 [34] and formatted using
Normalization Form KC (NFKC) as specified in Unicode 5.1.0, Unicode Standard
Annex #15; Unicode Normalization Forms [41].
#### 8.1.1.2 Definition of Access Network Identities for Specific Access
Networks
Table 8.1.1.2-1 specifies the list of Access Network Identities defined by
3GPP in the context of non-3GPP access to EPC.
Table 8.1.1.2-1: Access Network Identities in the context of non-3GPP access
to EPC
+----------------------+----------------------+----------------------+ | Access Network | Type of Access | | | Identity | Network | | +======================+======================+======================+ | ANID Prefix | Additional ANID | | | | strings | | +----------------------+----------------------+----------------------+ | \"HRPD\" constant | No additional ANID | cdma2000® HRPD | | character string, | string, see NOTE 2 | access network | | see NOTE 1 and | and NOTE 6 | | | NOTE 2 | | | +----------------------+----------------------+----------------------+ | \"WIMAX\" constant | No additional ANID | WiMAX access network | | character string, | string, see NOTE 3 | | | see NOTE 1 | and NOTE 6 | | +----------------------+----------------------+----------------------+ | \"WLAN\" constant | No additional ANID | WLAN access network | | character string, | string, see NOTE 4 | | | see NOTE 1 | and NOTE 6 | | +----------------------+----------------------+----------------------+ | \"ETHERNET\" | No additional ANID | Fixed access network | | constant character | string, see NOTE 5 | | | string, see NOTE 1 | and NOTE 6 | | +----------------------+----------------------+----------------------+ | All other character | Not applicable | Not defined, see | | strings | | NOTE 6 and Annex B | +----------------------+----------------------+----------------------+ | NOTE 1: The quotes | | | | are not part of the | | | | definition of the | | | | character string. | | | | | | | | NOTE 2: The value of | | | | the ANID Prefix for | | | | cdma2000® HRPD | | | | access networks is | | | | defined in 3GPP2 | | | | X.S0057 [20]. | | | | 3GPP2 is responsible | | | | for specifying | | | | possible additional | | | | ANID strings | | | | applicable to the | | | | \"HRPD\" ANID | | | | Prefix. | | | | | | | | NOTE 3: WiMAX Forum | | | | is responsible for | | | | specifying possible | | | | additional ANID | | | | strings applicable | | | | to the \"WIMAX\" | | | | ANID Prefix. | | | | | | | | NOTE 4: IEEE 802 is | | | | responsible for | | | | specifying possible | | | | additional ANID | | | | strings applicable | | | | to the \"WLAN\" ANID | | | | Prefix. | | | | | | | | NOTE 5: IEEE 802 is | | | | responsible for | | | | specifying possible | | | | additional ANID | | | | strings applicable | | | | to the \"ETHERNET\" | | | | ANID Prefix. | | | | | | | | NOTE 6: Additional | | | | ANID Prefixes and | | | | ANID strings can be | | | | added to this table | | | | following the | | | | procedure described | | | | in the informative | | | | Annex B. | | | +----------------------+----------------------+----------------------+
Table 8.1.1.2-2 specifies the list of Access Network Identities defined by
3GPP in the context of access to 5GCN.
Table 8.1.1.2-2: Access Network Identities in the context of access to 5GCN
+------------------------+------------------------+-----------------+ | Access Network | Type of Access Network | | | Identity | | | +========================+========================+=================+ | ANID Prefix | Additional ANID | | | | strings | | +------------------------+------------------------+-----------------+ | SNN-service-code, | S | N/A, see NOTE 3 | | which is \"5G\" | NN-network-identifier, | | | constant character | see NOTE 2 | | | string, see NOTE 1 and | | | | NOTE 2 | | | +------------------------+------------------------+-----------------+ | NOTE 1: The quotes are | | | | not part of the | | | | definition of the | | | | character string. | | | | | | | | NOTE 2: Serving | | | | network name (SNN) | | | | specified in | | | | 3GPP TS 24.501 [76] | | | | is used as 5G Access | | | | Network Identity. In | | | | case of NSWO in 5GS, | | | | SNN is \"5G:NSWO\" as | | | | specified in | | | | 3GPP TS 24.501 [76]. | | | | | | | | NOTE 3: Type of Access | | | | Network is not | | | | applicable for 5G | | | | Access Network | | | | Identity. | | | +------------------------+------------------------+-----------------+
### 8.1.2 IKEv2 Notify Message Type value
#### 8.1.2.1 Generic
The IKEv2 Notify Message Type is specified in IETF RFC 7296 [28].
The Notify Message Type with a value (in decimal) between 8192 and 16383 is
reserved for private error usage.
The Notify Message Type with a value (in decimal) between 40960 and 65535 is
reserved for private status usage.
Only the private IKEv2 Notify Message Types used for this specification are
specified in this clause.
#### 8.1.2.2 Private Notify Message - Error Types
The Private Notify Message, Error Types defined in table 8.1.2.2-1 are error
notifications which indicates an error while negotiating an IKEv2 SA for the
PDN connection to the APN requested by the UE. Refer to table 8.1.2.2-1 for
more details on what each error type means.
Table 8.1.2.2-1: Private Error Types
+--------------------------+--------------+--------------------------+ | Notify Message | Value\ | Descriptions | | | (in decimal) | | +==========================+==============+==========================+ | PD | 8192 | With an IP address | | N_CONNECTION_REJECTION | | information in | | | | Notification Data field: | | | | | | | | The PDN connection | | | | corresponding to the IP | | | | address information has | | | | been rejected. | | | | | | | | Without Notification | | | | Data field: | | | | | | | | The PDN connection | | | | corresponding to the | | | | requested APN has been | | | | rejected. No additional | | | | PDN connections to the | | | | given APN can be | | | | established. | | | | | | | | If the rejected PDN | | | | connection is the first | | | | PDN connection for the | | | | given APN, this APN is | | | | not allowed for the UE. | +--------------------------+--------------+--------------------------+ | MAX_CONNECTION_REACHED | 8193 | The PDN connection has | | | | been rejected. No | | | | additional PDN | | | | connections can be | | | | established for the UE | | | | due to the network | | | | policies or | | | | capabilities. | | | | | | | | The maximum number of | | | | PDN connections per UE | | | | allowed to be | | | | established | | | | simultaneously is | | | | limited by the number of | | | | EPS bearer identities | | | | (see clause 11.2.3.1.5 | | | | of | | | | 3GPP TS 24.007 [48]) | | | | or by the number of PDU | | | | session IDs (see | | | | clause 11.2.3.1b of | | | | 3GPP TS 24.007 [48]). | +--------------------------+--------------+--------------------------+ | SEMANTIC_ERROR\ | 8241 | This error type is used | | _IN_THE_TFT_OPERATION | | to indicate that the | | | | requested service was | | | | rejected due to a | | | | semantic error in the | | | | TFT operation included | | | | in the request. | +--------------------------+--------------+--------------------------+ | SYNTACTICAL_ERROR\ | 8242 | This error type is used | | _IN_THE_TFT_OPERATION | | to indicate that the | | | | requested service was | | | | rejected due to a | | | | syntactical error in the | | | | TFT operation included | | | | in the request. | +--------------------------+--------------+--------------------------+ | SEMANTIC_ERR | 8244 | This error type is used | | ORS_IN_PACKET_FILTERS | | to indicate that the | | | | requested service was | | | | rejected due to a | | | | semantic error in the | | | | packet filter(s) | | | | included in the request. | +--------------------------+--------------+--------------------------+ | SYNTACTICAL_ERR | 8245 | This error type is used | | ORS_IN_PACKET_FILTERS | | to indicate that the | | | | requested service was | | | | rejected due to a | | | | syntactical error in the | | | | packet filter(s) | | | | included in the request. | +--------------------------+--------------+--------------------------+ | NON_3GPP_ACCES | 9000 | Corresponds to: | | S_TO_EPC_NOT_ALLOWED | | | | | | - | | | | DI | | | | AMETER_ERROR_USER_NO\ | | | | _NON_3GPP_SUBSCRIPTION | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | or | | | | | | | | - Other scenarios when | | | | the UE is not allowed to | | | | use non-3GPP access to | | | | EPC. | +--------------------------+--------------+--------------------------+ | USER_UNKNOWN | 9001 | Corresponds to: | | | | | | | | - | | | | DIAMET | | | | ER_ERROR_USER_UNKNOWN | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | or | | | | | | | | - Other scenarios when | | | | the user identified by | | | | the IMSI is unknown. | +--------------------------+--------------+--------------------------+ | NO_APN_SUBSCRIPTION | 9002 | Corresponds to: | | | | | | | | - | | | | DIAMETER_ERROR_USE | | | | R_NO_APN_SUBSCRIPTION | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | or | | | | | | | | - Other scenarios when | | | | the requested APN is not | | | | included in the user\'s | | | | profile, and therefore | | | | is not authorized for | | | | that user.. | +--------------------------+--------------+--------------------------+ | AUTHORIZATION_REJECTED | 9003 | Corresponds to: | | | | | | | | - | | | | DIAMETER\ | | | | _AUTHORIZATION_REJECTED | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | or | | | | | | | | - Other scenarios when | | | | the user is barred from | | | | using the non-3GPP | | | | access or the subscribed | | | | APN. | +--------------------------+--------------+--------------------------+ | ILLEGAL_ME | 9006 | Corresponds to: | | | | | | | | - | | | | DIAMETER_E | | | | RROR_ILLEGAL_EQUIPMENT | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | or | | | | | | | | - Other scenarios when | | | | the ME used is not | | | | accepted by the network. | +--------------------------+--------------+--------------------------+ | NETWORK_FAILURE | 10500 | Corresponds to: | | | | | | | | - | | | | DIAMETER_E | | | | RROR_UNABLE_TO_COMPLY | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | or | | | | | | | | - Other scenarios when | | | | the network has | | | | determined that the | | | | requested procedure | | | | cannot be completed | | | | successfully due to | | | | network failure. | +--------------------------+--------------+--------------------------+ | RAT_TYPE_NOT_ALLOWED | 11001 | Corresponds to: | | | | | | | | - | | | | DIAMETER\ | | | | _RAT_TYPE_NOT_ALLOWED | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | or | | | | | | | | - Other scenarios when | | | | the access type is | | | | restricted to the user. | +--------------------------+--------------+--------------------------+ | IMEI_NOT_ACCEPTED | 11005 | The emergency PDN | | | | connection request has | | | | been rejected since the | | | | network does not accept | | | | an emergency service | | | | request using an IMEI. | +--------------------------+--------------+--------------------------+ | PLMN_NOT_ALLOWED | 11011 | Corresponds to: | | | | | | | | - | | | | DIAMETER_ERRO | | | | R_ROAMING_NOT_ALLOWED | | | | Result code IE as | | | | specified in | | | | 3GPP TS 29.273 [17]; | | | | | | | | - The ePDG performs | | | | PLMN filtering (based on | | | | roaming agreements) and | | | | rejects the request from | | | | the UE; or | | | | | | | | - Other scenarios when | | | | the UE requests service | | | | in a PLMN where the UE | | | | is not allowed to | | | | operate. | +--------------------------+--------------+--------------------------+ | UNAUTHENTICATED_ | 11055 | The emergency PDN | | | | connection request has | | EMERGENCY_ | | been rejected due to | | | | authentication has | | NOT_SUPPORTED | | failed or authentication | | | | cannot proceed at AAA | | | | server, and the ePDG | | | | does not support an | | | | emergency service | | | | request using an | | | | unauthenticated IMSI. | +--------------------------+--------------+--------------------------+
The private notify message error type values:
\- between 9950 and 9999;
\- between 10950 and 10999;
\- between 11950 and 11999;
\- between 12950 and 12999;
\- between 13950 and 13999;
\- between 14950 and 14999; and
\- between 15500 and 15599;
will not be allocated to a Notify payload defined in the present
specification.
The private notify message error type values between 15500 and 15599 shall be
allocated in 3GPP TS 24.502 [77].
#### 8.1.2.3 Private Notify Message - Status Types
The Private Notify Message Status Types defined in table 8.1.2.3-1 are used to
indicate status notifications or additional information in a Notify payload
which may be added to an IKEv2 message or IKE_AUTH request or IKE_AUTH
response message according to the procedures described in the present
document. Refer to table 8.1.2.3‑1 for more details on what each status type
means.
Table 8.1.2.3-1: Private Status Types
+--------------------------+--------------+--------------------------+ | Notify Message | Value\ | Descriptions | | | (in decimal) | | +==========================+==============+==========================+ | REACTI | 40961 | The IPsec tunnel | | VATION_REQUESTED_CAUSE | | associated to a PDN | | | | connection is released | | | | with a cause requesting | | | | the UE to reestablish | | | | the IPsec tunnel for the | | | | same PDN Connection | | | | after its release. | +--------------------------+--------------+--------------------------+ | BACKOFF_TIMER | 41041 | The value of the backoff | | | | timer is included in the | | | | BACKOFF_TIMER Notify | | | | payload as specified in | | | | clause 8.2.9.1. | +--------------------------+--------------+--------------------------+ | PDN_T | 41050 | This value is used by | | YPE_IPv4_ONLY_ALLOWED | | the network to indicate | | | | that only PDN type IPv4 | | | | is allowed for the | | | | requested PDN | | | | connectivity. | +--------------------------+--------------+--------------------------+ | PDN_T | 41051 | This value is used by | | YPE_IPv6_ONLY_ALLOWED | | the network to indicate | | | | that only PDN type IPv6 | | | | is allowed for the | | | | requested PDN | | | | connectivity. | +--------------------------+--------------+--------------------------+ | DEVICE_IDENTITY | 41101 | The device identity type | | | | and/or identity value | | | | are included in the | | | | DEVICE_IDENTITY Notify | | | | payload as specified in | | | | clause 8.2.9.2. | +--------------------------+--------------+--------------------------+ | EMERGENCY_SUPPORT | 41112 | This status when present | | | | indicates that the ePDG | | | | supports emergency | | | | service. The | | | | EMERGENCY_SUPPORT | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.7. | +--------------------------+--------------+--------------------------+ | EMERGENCY_CALL_NUMBERS | 41134 | Additional local | | | | emergency call numbers | | | | that the UE may use for | | | | detecting UE initiated | | | | emergency calls. The | | | | EMERGENCY_CALL_NUMBERS | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.8. | +--------------------------+--------------+--------------------------+ | NB | 41288 | The NBIFOM parameters | | IFOM_GENERIC_CONTAINER | | are included in the | | | | NB | | | | IFOM_GENERIC_CONTAINER | | | | Notify payload as | | | | specified in | | | | clause 8.2.9.3. | +--------------------------+--------------+--------------------------+ | P-CS | 41304 | This status when present | | CF_RESELECTION_SUPPORT | | indicates that the UE | | | | supports the P-CSCF | | | | restoration extension | | | | for untrusted WLAN | +--------------------------+--------------+--------------------------+ | PTI | 41501 | An INFORMATIONAL request | | | | message of an | | | | ePDG-initiated | | | | modification procedure | | | | is initiated by another | | | | INFORMATIONAL request | | | | message of an | | | | UE-initiated | | | | modification procedure. | | | | The PTI Notify payload | | | | is coded according to | | | | clause 8.2.9.5. | +--------------------------+--------------+--------------------------+ | IKEV2_MULTIPLE_B | 42011 | This status when present | | EARER_PDN_CONNECTIVITY | | indicates that the UE | | | | supports IKEv2 multiple | | | | bearer PDN connectivity. | | | | | | | | The | | | | IKEV2_MULTIPLE_B | | | | EARER_PDN_CONNECTIVITY | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.9. | +--------------------------+--------------+--------------------------+ | EPS_QOS | 42014 | This status when present | | | | indicates EPS QoS. The | | | | EPS_QOS Notify payload | | | | is coded according to | | | | clause 8.2.9.10. | +--------------------------+--------------+--------------------------+ | EXTENDED_EPS_QOS | 42015 | This status when present | | | | indicates extended EPS | | | | QoS. The | | | | EXTENDED_EPS_QOS | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.10A. | +--------------------------+--------------+--------------------------+ | TFT | 42017 | This status when present | | | | indicates TFT. The TFT | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.11. | +--------------------------+--------------+--------------------------+ | MODIFIED_BEARER | 42020 | This status when present | | | | indicates sender\'s ESP | | | | SPI. The | | | | MODIFIED_BEARER Notify | | | | payload is coded | | | | according to | | | | clause 8.2.9.12. | +--------------------------+--------------+--------------------------+ | APN_AMBR | 42094 | This status when present | | | | indicates APN-AMBR. The | | | | APN_AMBR Notify payload | | | | is coded according to | | | | clause 8.2.9.13. | +--------------------------+--------------+--------------------------+ | EXTENDED_APN_AMBR | 42095 | This status when present | | | | indicates extended | | | | APN-AMBR. The | | | | EXTENDED_APN_AMBR | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.14. | +--------------------------+--------------+--------------------------+ | N1_MODE_CAPABILITY | 51015 | This status when present | | | | indicates support of N1 | | | | mode or N1 mode | | | | capability is disabled. | | | | The N1_MODE_CAPABILITY | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.15. | +--------------------------+--------------+--------------------------+ | N1_MODE_INFORMATION | 51115 | This status when present | | | | indicates N1 mode | | | | information. The | | | | N1_MODE_INFORMATION | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.16. | +--------------------------+--------------+--------------------------+ | N1_ | 52216 | This status when present | | MODE_S_NSSAI_PLMN_ID | | indicates the PLMN ID | | | | that the S-NSSAI relates | | | | to. The | | | | N1_ | | | | MODE_S_NSSAI_PLMN_ID | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.17. | +--------------------------+--------------+--------------------------+ | DNS_SRV_SEC_INFO_IND | 52301 | This status when present | | | | indicates | | | | D | | | | NS_SRV_SEC_INFO_IND. | | | | The | | | | DNS_SRV_SEC_INFO_IND | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.18. | +--------------------------+--------------+--------------------------+ | DNS_SRV_SEC_INFO | 52302 | This status when present | | | | indicates | | | | DNS_SRV_SEC_INFO. The | | | | DNS_SRV_SEC_INFO | | | | Notify payload is coded | | | | according to | | | | clause 8.2.9.19. | +--------------------------+--------------+--------------------------+ | ATSSS_REQUEST | 52331 | This status when present | | | | indicates the ATSSS | | | | request parameters. The | | | | ATSSS_REQUEST Notify | | | | payload is coded | | | | according to | | | | clause 8.2.9.20. | +--------------------------+--------------+--------------------------+ | ATSSS_RESPONSE | 52332 | This status when present | | | | indicates the ATSSS | | | | response parameters. The | | | | ATSSS_RESPONSE Notify | | | | payload is coded | | | | according to | | | | clause 8.2.9.21. | +--------------------------+--------------+--------------------------+ | HPA_INFO | 55911 | This status, when | | | | present, indicates high | | | | priority access. The | | | | HPA_INFO Notify payload | | | | is coded according to | | | | clause 8.2.9.22. | +--------------------------+--------------+--------------------------+
The private notify message status type values:
\- between 49950 and 49999;
\- between 50950 and 50999;
\- between 51950 and 51999;
\- between 52950 and 52999;
\- between 53950 and 53999;
\- between 54950 and 54999; and
\- between 55500 and 55599;
will not be allocated to a Notify payload defined in the present
specification.
The private notify message status type values between 55500 and 55599 shall be
allocated in 3GPP TS 24.502 [77].
### 8.1.3 ANDSF Push Information
#### 8.1.3.1 General
The values of the ANDSF Push Information sent to the UE using the GAA
bootstrap framework for ANDSF Push as specified in clause 6.8.2.2.2 are
defined in this clause.
#### 8.1.3.2 ANDSF Push Information values
The ANDSF Push Information defined in table 8.1.3.2-1 indicates the X-WAP-
Application-ID field (Push Application ID) for ANDSF in the WSP header.
Table 8.1.3.2-1: ANDSF Push Information values
WSP header attribute Value Short code Descriptions
* * *
X-WAP-Application-ID x-3gpp.gba.andsf.ua 0x9071 The application identity
indicates ANDSF
### 8.1.4 PDUs for TWAN connection modes
#### 8.1.4.0 General
The PDUs defined in this clause are used when SCM, MCM or both are supported.
The sending entity shall set value of spare bit to zero. The receiving entity
shall ignore value of spare bit
#### 8.1.4.1 Message
The message is coded according to figure 8.1.4.1-1 and table 8.1.4.1-1.
+--------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------------+---------+---+---+---+---+---+---+---+ | Message type | octet 1 | | | | | | | | +--------------+---------+---+---+---+---+---+---+---+ | Item list | octet 2 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +--------------+---------+---+---+---+---+---+---+---+
Figure 8.1.4.1-1: Message
Table 8.1.4.1-1: Message
+----------------------------------------------------------------------+ | Message type field is coded according to table 8.1.4.1-2. The | | message is ignored if Message type **[field]{.underline}** | | **[containing a value]{.underline}** other than those in | | table 8.1.4.1-2 is received. | | | | Optional Item list field contains sequence of items, each of which | | is coded according to clause 8.1.4.2. The receiving entity does not | | assume that a certain order of items will be used in the Item list. | | When the receiving entity does not recognize an item in the Item | | list, that particular item is ignored, and the receiving entity | | continues to process the rest of the items in the Item list. The | | Item list field includes at maximum one item of each type described | | in clause 8.1.4.2. | +----------------------------------------------------------------------+
Table 8.1.4.1-2: Message type
* * *
Message type is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 1 CONNECTION_CAPABILITY 0 0 0 0 0 0 1 0 SCM_REQUEST 0 0 0 0 0 0
1 1 SCM_RESPONSE 0 0 0 0 0 1 0 0 MCM_REQUEST 0 0 0 0 0 1 0 1 MCM_RESPONSE
* * *
#### 8.1.4.2 Item
The Item is coded according to figure 8.1.4.2-1 and table 8.1.4.2-1:
+--------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------+---------+---+---+---+---+---+---+---+ | Type | octet 1 | | | | | | | | +--------+---------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +--------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +--------+---------+---+---+---+---+---+---+---+
Figure 8.1.4.2-1: Item
Table 8.1.4.2-1: Item
* * *
Type field is coded according to the table 8.1.4.2-2. When the Type field
contains a type other than those specified in table 8.1.4.2-2, the entire Item
is ignored. Length field indicates the number of octets in the Value field.
Value field contains the parameter value of the type of item.
* * *
Table 8.1.4.2-2: Types of item
* * *
The type field is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 0 CONNECTIVITY_TYPE 0 0 0 0 0 0 0 1 ATTACHMENT_TYPE 0 0 0 0 0 0
1 0 APN 0 0 0 0 0 0 1 1 PDN_TYPE 0 0 0 0 0 1 0 0 AUTHORIZATIONS 0 0 0 0 0 1 0
1 CONNECTION_MODE_CAPABILITY 0 0 0 0 0 1 1 0 PROTOCOL_CONFIGURATION_OPTIONS 0
0 0 0 0 1 1 1 CAUSE 0 0 0 0 1 0 0 0 IPV4_ADDRESS 0 0 0 0 1 0 0 1
IPV6_INTERFACE_IDENTIFIER 0 0 0 0 1 0 1 0 TWAG_CP_ADDRESS 0 0 0 0 1 0 1 1
TWAG_UP_MAC_ADDRESS 0 0 0 0 1 1 0 0 SUPPORTED_WLCP_TRANSPORTS 0 0 0 0 1 1 0 1
Tw1 0 0 0 0 1 1 1 0 ACCESS CAUSE
* * *
#### 8.1.4.3 CONNECTIVITY_TYPE item
When the Type field of this item, according to clause 8.1.4.2, indicates the
CONNECTIVITY_TYPE, then the Length field of this item is set to 1 and the
Value field of this item is coded according to table 8.1.4.3-1.
Table 8.1.4.3-1: CONNECTIVITY_TYPE value
The Connectivity type value is coded as follows. |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | PDN connection connectivity type  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | NSWO connectivity type  
All other values are interpreted as "PDN connection connectivity type". When the Connectivity Type item is received by the 3GPP AAA server, it indicates that the indicated connectivity type is requested. When the Connectivity Type item is received by the UE, it indicates that the indicated connectivity type is authorized. |  |  |  |  |  |  |  |  |   
#### 8.1.4.4 ATTACHMENT_TYPE item
When the Type field of this item according to clause 8.1.4.2 indicates the
ATTACHMENT_TYPE, then the Length field of this item is set to 1 and the Value
field of this item is coded according to table 8.1.4.4-1.
Table 8.1.4.4-1: ATTACHMENT_TYPE value
* * *
The ATTACHMENT TYPE value is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 1 Initial attach 0 0 0 0 0 0 1 0 Handover attach 0 0 0 0 0 1 0 0
Emergency attach 0 0 0 0 0 1 1 0 Emergency handover All other values are
interpreted as \"Initial attach\".
* * *
#### 8.1.4.5 APN item
When the Type field of this item according to clause 8.1.4.2 indicates the
APN, then the Value field of this item contains the APN as described in 3GPP
TS 23.003 [3]. When received by the 3GPP AAA server, it indicates the
requested APN. When received by the UE, it indicates the selected APN.
#### 8.1.4.6 PDN_TYPE item
When the Type field of this item according to clause 8.1.4.2 indicates the
PDN_TYPE, then the Length field of this item is set to 1 and the Value field
of this item is coded according to table 8.1.4.6-1.
Table 8.1.4.6-1: PDN_TYPE value
* * *
The PDN type value is coded as follows.  
7 6 5 4 3 2 1 0
0 0 0 0 0 0 0 1 IPv4 - when received by the 3GPP AAA server, it indicates that
IPv4 is requested. When received by the UE, it indicates that IPv4 is
supported.
0 0 0 0 0 0 1 0 IPv6 - when received by the 3GPP AAA server, it indicates that
IPv6 is requested. When received by the UE, it indicates that IPv6 is
supported.
0 0 0 0 0 0 1 1 IPv4v6 - when received by the 3GPP AAA server, it indicates
that IPv4, IPv6 or both are requested. When received by the UE, it indicates
that both IPv4 and IPv6 are supported. All other values are interpreted as
\"IPv6\".
* * *
#### 8.1.4.7 AUTHORIZATIONS item
When the Type field of this item according to clause 8.1.4.2 indicates the
AUTHORIZATIONS, then the Length field of this item is set to 1 and the Value
field of this item is coded according to figure 8.1.4.7-1 and table 8.1.4.7-1.
+-------+-------+-------+-------+-------+-------+-------+-------+---------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=======+=======+=======+=======+=======+=======+=======+=======+=========+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | NSWOA | octet 1 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | Spare | Spare | | | +-------+-------+-------+-------+-------+-------+-------+-------+---------+
Figure 8.1.4.7-1: AUTHORIZATIONS value
Table 8.1.4.7-1: AUTHORIZATIONS value
* * *
The authorization value is coded as follows:  
UE authorization to use NSWO (NSWOA) (octet 1, bit 0)  
0 UE is not authorized to use NSWO 1 UE is authorized to use NSWO
Bit 1 to bit 7 of octet 1 are spare.
* * *
#### 8.1.4.8 CONNECTION_MODE_CAPABILITY item
When the Type field of this item according to clause 8.1.4.2 indicates the
CONNECTION_MODE_CAPABILITY, then the Length field of this item is set to 1 and
the Value field of this item is coded according to figure 8.1.4.8-1 and table
8.1.4.8-1.
+-------+-------+-------+-------+----+-------+------+------+---------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=======+=======+=======+=======+====+=======+======+======+=========+ | 0 | 0 | 0 | 0 | ES | TSMCI | MCMI | SMCI | octet 1 | | | | | | | | | | | | Spare | Spare | Spare | Spare | | | | | | +-------+-------+-------+-------+----+-------+------+------+---------+
Figure 8.1.4.8-1: CONNECTION_MODE_CAPABILITY value
Table 8.1.4.8-1: CONNECTION_MODE_CAPABILITY value
* * *
The Connection Mode Capability value is coded as follows:  
Support of SCM (SCMI) (octet 1, bit 0)  
0 SCM is not supported 1 SCM is supported
Support of MCM (MCMI) (octet 1, bit 1)  
0 MCM is not supported 1 MCM is supported
Support of TSCM (TSCMI) (octet 1, bit 2)  
0 TSCM is not supported 1 TSCM is supported
Support of emergency services (ES) (octet 1, bit 3)  
0 emergency services are not supported 1 emergency services are supported
Bit 4 to bit 7 of octet 1 are spare.
* * *
#### 8.1.4.9 PROTOCOL_CONFIGURATION_OPTIONS item
When the Type field of this item according to clause 8.1.4.2 indicates the
PROTOCOL_CONFIGURATION_OPTIONS, then the Value field of this item is coded as
the value part (as specified in 3GPP TS 24.007 [48] for type 4 IE) of the
protocol configuration options information element defined in 3GPP TS 24.008
[46] clause 10.5.6.3.
NOTE: The protocol configuration options IEI field and the length of protocol
configuration options contents field of the protocol configuration options
information element are not included in the Value field of the
PROTOCOL_CONFIGURATION_OPTIONS item.
#### 8.1.4.10 CAUSE item
##### 8.1.4.10.1 General
When the Type field of this item according to clause 8.1.4.2 indicates the
CAUSE, then the Length field of this item is set to 1 and the Value field of
this item is coded according to table 8.1.4.10-1. If the CAUSE item is
received by the 3GPP AAA server, the item is ignored.
Semantics of the Cause values are defined in clause 8.1.4.10.2.
Table 8.1.4.10-1: CAUSE value
* * *
The Cause value is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 1 0 0 0 Operator determined barring 0 0 0 1 1 0 1 0 Insufficient
resources 0 0 0 1 1 0 1 1 Unknown APN 0 0 0 1 1 1 0 0 Unknown PDN type 0 0 0 1
1 1 0 1 User authentication failed 0 0 0 1 1 1 1 0 Request rejected by PDN GW
0 0 0 1 1 1 1 1 Request rejected, unspecified 0 0 1 0 0 0 0 0 Service option
not supported 0 0 1 0 0 0 0 1 Requested service option not subscribed 0 0 1 0
0 0 1 0 Service option temporarily out of order 0 0 1 0 0 1 1 0 Network
failure 0 0 1 1 0 0 1 0 PDN type IPv4 only allowed 0 0 1 1 0 0 1 1 PDN type
IPv6 only allowed 0 0 1 1 0 1 1 0 PDN connection does not exist 0 1 1 0 1 1 1
1 Protocol error, unspecified 0 1 1 1 0 0 0 1 Multiple accesses to a PDN
connection not allowed All other values received by the UE are treated as
01101111, \"Protocol error, unspecified\".
* * *
##### 8.1.4.10.2 Causes
Cause #8 - Operator determined barring
This cause is used by the network to indicate that the requested service was
rejected due to operator determined barring.
Cause #26 - Insufficient resources
This cause is used by the network to indicate that the requested service
cannot be provided due to insufficient resources.
Cause #27 - Unknown APN
This cause is used by the network to indicate that the requested service was
rejected because the access point name could not be resolved.
Cause #28 - Unknown PDN type
This cause is used by the network to indicate that the requested service was
rejected by the external packet data network because the PDN type could not be
recognised.
Cause #29 - User authentication failed
This cause is used by the network to indicate that the requested service was
rejected by the external packet data network due to a failed user
authentication.
Cause #30 - Request rejected by PDN GW
This cause is used by the network to indicate that the requested service or
operation was rejected by the PDN GW.
Cause #31 - Request rejected, unspecified
This cause is used by the network to indicate that the requested service or
operation was rejected due to unspecified reasons.
Cause #32 - Service option not supported
This cause is used by the network when the UE requests a service which is not
supported by the PLMN.
Cause #33 - Requested service option not subscribed
This cause is sent when the UE requests a service option for which it has no
subscription.
Cause #34 - Service option temporarily out of order
This cause is sent when the network cannot service the request because of
temporary outage of one or more functions required for supporting the service.
Cause #38 - Network failure
This cause is used by the network to indicate that the requested service was
rejected due to an error situation in the network.
Cause #50 - PDN type IPv4 only allowed
This value is used by the network to indicate that only PDN type IPv4 is
allowed for the requested PDN connectivity.
Cause #51 - PDN type IPv6 only allowed
This value is used by the network to indicate that only PDN type IPv6 is
allowed for the requested PDN connectivity.
Cause #54 -- PDN connection does not exist
This value is used by the network at handover from a 3GPP access network to
indicate that the network does not have any information about the requested
PDN connection.
Cause #111 - Protocol error, unspecified
This value is used to report a protocol error event only when no other value
applies.
Cause #113 - Multiple accesses to a PDN connection not allowed
This value is used by the network to indicate that an additional access to the
PDN connection as specified in 3GPP TS 24.161 [69] is not allowed.
This clause shows the numbers in the decimal numeration system.
#### 8.1.4.11 IPV4_ADDRESS item
When the Type field of this item according to clause 8.1.4.2 indicates the
IPV4_ADDRESS, then the Length field of this item is set to 4 and the Value
field of this item contains an IPv4 address allocated to the UE for the PDN
connection.
#### 8.1.4.12 IPV6_INTERFACE_IDENTIFIER item
When the Type field of this item according to clause 8.1.4.2 indicates the
IPV6_INTERFACE_IDENTIFIER, then the Length field of this item is set to 8 and
the Value field of this item contains an IPv6 interface identifier allocated
to the UE for the PDN connection to be used to build the IPv6 link local
address.
#### 8.1.4.13 TWAG_CP_ADDRESS item
When the Type field of this item according to clause 8.1.4.2 indicates the
TWAG_CP_ADDRESS, then the Value field of this item contains one or two TWAG
control plane addresses and is coded according to figure 8.1.4.13-1 and table
8.1.4.13-1.
+----------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +======================+=========+===+===+===+===+===+===+===+ | TWAG CP address type | octet 1 | | | | | | | | +----------------------+---------+---+---+---+---+---+---+---+ | TWAG CP addresses | octet 2 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +----------------------+---------+---+---+---+---+---+---+---+
Figure 8.1.4.13-1: TWAG_CP_ADDRESS item value
Table 8.1.4.13-1: TWAG_CP_ADDRESS item value
* * *
The TWAG CP address type field (octet 1) is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 1 IPv4 0 0 0 0 0 0 1 0 IPv6 0 0 0 0 0 0 1 1 IPv4IPv6 All other
values of the TWAG CP address type field are interpreted as \"IPv4\".
If the TWAG CP address type field indicates IPv4, then the TWAG CP addresses
field contains one TWAG control plane address consisting of an IPv4 address in
octet 2 to octet 5.
If the TWAG CP address type field indicates IPv6, then the TWAG CP addresses
field contains one TWAG control plane address consisting of an IPv6 address in
octet 2 to octet 17.
If the TWAG CP address type field indicates IPv4IPv6, then the TWAG CP
addresses field contains two TWAG control plane addresses. The first TWAG
control plane address consists of an IPv4 address in octet 2 to octet 5, the
second TWAG control plane address consists of an IPv6 address in octet 6 to
octet 21.
* * *
#### 8.1.4.14 TWAG_UP_MAC_ADDRESS item
When the Type field of this item according to clause 8.1.4.2 indicates the
TWAG_UP_MAC_ADDRESS, then the Length field of this item is set to 6 and the
Value field of this item contains a TWAG user plane MAC address allocated to
the PDN connection. The MAC address is defined in clause 8 of IEEE Std 802
[58].
#### 8.1.4.15 SUPPORTED_WLCP_TRANSPORTS item
When the Type field of this item according to clause 8.1.4.2 indicates the
SUPPORTED_WLCP_TRANSPORTS, then the Length field of this item is set to 1 and
the Value field of this item is coded according to figure 8.1.4.15-1 and table
8.1.4.15-1.
+-------+-------+-------+-------+-------+-------+---------------+---------------+---------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=======+=======+=======+=======+=======+=======+===============+===============+=========+ | 0 | 0 | 0 | 0 | 0 | 0 | WLCPoUDPoIPv6 | WLCPoUDPoIPv4 | octet 1 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | Spare | | | | +-------+-------+-------+-------+-------+-------+---------------+---------------+---------+
Figure 8.1.4.15-1: SUPPORTED_WLCP_TRANSPORTS value
Table 8.1.4.15-1: SUPPORTED_WLCP_TRANSPORTS value
The Supported WLCP transport value is coded as follows:
* * *
WLCP over UDP over IPv4 support (WLCPoUDPoIPv4) (octet 1, bit 0)  
0 WLCP over UDP over IPv4 is not supported. 1 WLCP over UDP over IPv4 is
supported.
WLCP over UDP over IPv6 support (WLCPoUDPoIPv6) (octet 1, bit 1)  
0 WLCP over UDP over IPv6 is not supported. 1 WLCP over UDP over IPv6 is
supported.
Bit 2 to bit 7 of octet 1 are spare.
#### 8.1.4.16 Tw1 item
When the Type field of this item according to clause 8.1.4.2 indicates the
Tw1, then the Value field of this item is coded as the value part (as
specified in 3GPP TS 24.007 [48] for type 4 IE) of the GPRS timer 3
information element defined in 3GPP TS 24.008 [46] clause 10.5.7.4a.
NOTE: The GPRS Timer 3 IEI field and the length of GPRS Timer 3 contents field
of the GPRS timer 3 information element are not included in the Value field of
the Tw1 item.
#### 8.1.4.17 ACCESS_CAUSE item
##### 8.1.4.17.1 General
When the Type field of this item according to clause 8.1.4.2 indicates the
ACCESS_CAUSE, then the Length field of this item is set to 1 and the Value
field of this item is coded according to table 8.1.4.17-1.
Table 8.1.4.17-1: ACCESS_CAUSE value
* * *
The Access cause value is coded as follows.  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 1 0 Non-3GPP access to EPC not allowed 0 0 0 0 0 0 1 1 RAT type
now allowed 0 0 0 0 0 1 1 0 Illegal ME 0 0 0 0 1 0 1 1 PLMN not allowed
* * *
##### 8.1.4.17.2 Access causes
Access cause #2- Non-3GPP access to EPC not allowed
This cause is used by the network to indicate that the requested service was
rejected due to the user subscription data does not support EPS services from
non-3GPP access.
Access cause #3- RAT type not allowed
This cause is used by the network to indicate that the requested service was
rejected due to the WLAN is not allowed.
Access cause #6- Illegal ME
This cause is sent to the UE if the ME used is not acceptable to the network,
e.g. prohibit listed.
Access cause #11- PLMN not allowed
This cause is used by the network to indicate that the requested service was
rejected due to the PLMN where the UE is roaming into is not allowed.
## 8.2 IETF RFC coding information defined within present document
### 8.2.1 IPMS attributes
#### 8.2.1.1 AT_IPMS_IND attribute
+--------------------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Attribute Type = AT_IPMS_IND | octet 1 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Length = 1 | octet 2 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+
Figure 8.2.1.1: AT_IPMS_IND attribute
Table 8.2.1.1: AT_IPMS_IND attribute
Octet 1 indicates the type of attribute as AT_IPMS_IND with a value of 137. |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
Octet 2 is the length of this attribute which shall be set to 1 as per IETF RFC 4187 [33] |  |  |  |  |  |  |  |  |   
Octet 3 and 4 is the value of this attribute. Octet 3 is reserved and shall be coded as zero. Octet 4 shall be set as follows. All other values are reserved. |  |  |  |  |  |  |  |  |   
7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |  | Protocol Supported  
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | DSMIPv6 only  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | NBM only  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 1 |  | MIPv4 only  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 0 |  | DSMIPv6 and NBM both supported  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 1 |  | MIPv4 and NBM both supported  
0 | 0 | 0 | 0 | 0 | 1 | 1 | 0 |  | DSMIPv6 and NBM Supported;DSMIPv6 preferred  
0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 |  | DSMIPv6 and NBM Supported; NBM preferred  
0 | 0 | 0 | 0 | 1 | 0 | 0 | 0 |  | MIPv4 and NBM supported; MIPv4 preferred  
0 | 0 | 0 | 0 | 1 | 0 | 0 | 1 |  | MIPv4 and NBM supported; NBM preferred  
0 | 0 | 0 | 0 | 1 | 0 | 1 | 0 |  | MIPv4 and DSMIPv6 supported; MIPv4 preferred  
0 | 0 | 0 | 0 | 1 | 0 | 1 | 1 |  | MIPv4 and DSMIPv6 supported; DSMIPv6 preferred  
0 | 0 | 0 | 0 | 1 | 1 | 0 | 0 |  | MIPv4, DSMIPv6 and NBM supported; MIPv4 preferred  
0 | 0 | 0 | 0 | 1 | 1 | 0 | 1 |  | MIPv4, DSMIPv6 and NBM supported; DSMIPv6 preferred  
0 | 0 | 0 | 0 | 1 | 1 | 1 | 0 |  | MIPv4, DSMIPv6 and NBM supported; NBM preferred  
#### 8.2.1.2 AT_IPMS_RES attribute
+--------------------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Attribute Type = AT_IPMS_RES | octet 1 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Length = 1 | octet 2 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+
Figure 8.2.1.2: AT_IPMS_RES attribute.
Table 8.2.1.2: AT_IPMS_RES attribute
* * *
Octet 1 indicates the type of attribute as AT_IPMS_RES with a value of 138.  
Octet 2 is the length of this attribute which shall be set to 1 as per IETF
RFC 4187 [33]  
Octet 3 and 4 is the value of this attribute. Octet 3 is reserved and shall be
coded as zero. Octet 4 shall be set as follows. All other values are reserved.  
7 6 5 4 3 2 1 0 Protocol Selected 0 0 0 0 0 0 0 1 DSMIPv6 0 0 0 0 0 0 1 0 NBM
0 0 0 0 0 0 1 1 MIPv4
* * *
### 8.2.2 Access Network Identity indication attribute
#### 8.2.2.1 Access Network Identity in the AT_KDF_INPUT attribute
The Access Network Identity is indicated in the Network Name Field of the
AT_KDF_INPUT attribute as specified in _IETF RFC 5448_ [38]. The Network Name
Field shall contain the Access Network Identity as specified in clause 8.1.1
of this specification.
NOTE: IETF in _IETF RFC 5448_ [38] refers to this specification for the value
of the Network Name field.
### 8.2.3 Trust relationship indication attribute
#### 8.2.3.1 AT_TRUST_IND attribute
+---------------------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +---------------------------------+---------+---+---+---+---+---+---+---+ | Attribute Type = AT_TRUST_IND | octet 1 | | | | | | | | +---------------------------------+---------+---+---+---+---+---+---+---+ | Length = 1 | octet 2 | | | | | | | | +---------------------------------+---------+---+---+---+---+---+---+---+ | Value | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | +---------------------------------+---------+---+---+---+---+---+---+---+
Figure 8.2.3.1-1: AT_TRUST_IND attribute
Table 8.2.3.1-1: AT_TRUST_IND attribute
* * *
Octet 1 indicates the type of attribute as AT_TRUST_IND with a value of 139.  
Octet 2 is the length of this attribute which shall be set to 1 as per IETF
RFC 4187 [33]  
Octet 3 and 4 is the value of the attribute. Octet 3 is reserved and shall be
coded as zero. Octet 4 shall be set as follows. All other values are reserved.  
7 6 5 4 3 2 1 0 Indicated Trust Relationship 0 0 0 0 0 0 0 1 Trusted 0 0 0 0 0
0 1 0 UnTrusted
* * *
### 8.2.4 IKEv2 Configuration Payloads attributes
#### 8.2.4.1 HOME_AGENT_ADDRESS attribute
The HOME_AGENT_ADDRESS attribute is shown in figure 8.2.4.1-1. The length of
the HOME_AGENT_ADDRESS attribute is 16 or 20 bytes. The IPv4 Home Agent
Address field is optional. The HA\'s IPv6 and IPv4 addresses are laid out
respectively in IPv6 Home Agent Address and IPv4 Home Agent Address fields in
big endian order (aka most significant byte first, or network byte order), see
IETF RFC 7296 [28].
* * *
Bits  
7 6 5 4 3 2 1 0 Octets R Attribute Type 1  
Attribute Type 2  
Length 3, 4  
IPv6 Home Agent Address 5 - 20  
IPv4 Home Agent Address 21 - 24
* * *
Figure 8.2.4.1-1: HOME_AGENT_ADDRESS attribute
The R bit in the first octet is defined in IETF RFC 7296 [28].
The Attribute Type indicating HOME_AGENT_ADDRESS is of the value 19.
#### 8.2.4.2 TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute
The TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute is coded according to figure
8.2.4.2-1 and table 8.2.4.2-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets R Attribute Type 1  
Attribute Type 2  
Length 3, 4  
Timeout Period 5 - 8
* * *
Figure 8.2.4.2-1: TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute
Table 8.2.4.2-1: TIMEOUT_PERIOD_FOR_LIVENESS_CHECK value
+----------------------------------------------------------------------+ | Bit 7 of Octet 1 is the R bit defined in IETF RFC 7296 [28]. The R | | bit is the reserved bit set to zero. | +======================================================================+ | Bits 0 through 6 of Octet 1 and Octet 2 is the Attribute Type field. | | The Attribute Type field is set to value 24 to indicate the | | TIMEOUT_PERIOD_FOR_LIVENESS_CHECK. | | | | Octet 3 and Octet 4 is the Length field. This field indicates the | | length in octets of the Timeout Period field. This field is set to 0 | | or 4. | +----------------------------------------------------------------------+ | Octets 5, 6, 7 and 8 are the Timeout Period field. If the Timeout | | Period field is included, it indicates the timeout period for | | liveness check in seconds encoded in the binary format. If the | | Timeout Period field is not included in the | | TIMEOUT_PERIOD_FOR_LIVENESS_CHECK configuration attribute by the | | UE, the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK indicates the UE\'s | | support of receiving the timeout period for liveness check. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+
### 8.2.5 Full name for network and short name for network
#### 8.2.5.1 AT_FULL_NAME_FOR_NETWORK attribute
The AT_FULL_NAME_FOR_NETWORK attribute is coded according to figure 8.2.5.1-1
and table 8.2.5.1-1.
+-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Attribute Type = AT_FULL_NAME_FOR_NETWORK | octet 1 | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Full name length | octet 3 | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Full name value | octet 4 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding | octet n+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 8.2.5.1-1: AT_FULL_NAME_FOR_NETWORK attribute
Table 8.2.5.1-1: AT_FULL_NAME_FOR_NETWORK attribute
* * *
Octet 1 indicates the type of this attribute as AT_FULL_NAME_FOR_NETWORK with
a value of 141. Octet 2 is the length of this attribute in multiples of 4
octets as specified in RFC 4187 [33]. Octet 3 is the full name length field
and contains the length of the full name value field in octets. The full name
value field starts at octet 4 and its length is indicated by the full name
length field. The full name value field indicates the \"full length name of
the network\" that the network wishes the UE to associate with MCC and MNC in
the realm of the NAI used during authentication. The structure of the full
name value field is the same as the structure of the Network Name defined in
3GPP TS 24.008 [46] clause 10.5.3.5a except for the Network Name IEI and the
Length of Network Name contents which are not included. The optional padding
field starts after the last octet of the full name value field. Each octet of
this field is set to zero by sending entity and ignored by receiving entity.
* * *
#### 8.2.5.2 AT_SHORT_NAME_FOR_NETWORK attribute
The AT_SHORT_NAME_FOR_NETWORK attribute is coded according to figure 8.2.5.2-1
and table 8.2.5.2-1.
+------------------------------------------------+-----------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Attribute Type = AT_SHORT_NAME_FOR_NETWORK | octet 1 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Short name length | octet 3 | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Short name value | octet 4 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding | octet n+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +------------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 8.2.5.2-1: AT_SHORT_NAME_FOR_NETWORK attribute
Table 8.2.5.2-1: AT_SHORT_NAME_FOR_NETWORK attribute
* * *
Octet 1 indicates the type of this attribute as AT_SHORT_NAME_FOR_NETWORK with
a value of 140. Octet 2 is the length of this attribute in multiples of 4
octets as specified in RFC 4187 [33]. Octet 3 is the short name length field
and contains the length of the short name value field in octets. The short
name value field starts at octet 4 and its length is indicated by the short
name length field. The short name value field indicates the \"abbreviated name
of the network\" that the network wishes the UE to associate with MCC and MNC
in the realm of the NAI used during authentication. The structure of the short
name value field is the same as the structure of the Network Name defined in
3GPP TS 24.008 [46] clause 10.5.3.5a except for the Network Name IEI and the
Length of Network Name contents which are not included. The optional padding
field starts after the last octet of the short name value field. Each octet of
this field is set to zero by sending entity and ignored by receiving entity.
* * *
### 8.2.6 Handling of the unknown protocol data
If the receiving entity receives an unknown value in a recognized skippable
attribute in an EAP-AKA or EAP-AKA\' message, the receiving entity shall
ignore the attribute and shall handle the rest of the message. The definition
of skippable attribute see the RFC 4187 [33]. The receiving entity handling of
the unrecognized skippable attribute is as specified in RFC 4187 [33].
### 8.2.7 Attributes for TWAN connection modes
#### 8.2.7.1 AT_TWAN_CONN_MODE attribute
The AT_TWAN_CONN_MODE attribute is coded according to figure 8.2.7.1-1 and
table 8.2.7.1-1.
+---------------------------------------+-----------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Attribute type = AT_TWAN_CONN_MODE | octet 1 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding length | octet 3 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Message | octet 4 | | | | | | | | | | | | | | | | | | | | octet Y | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding | octet Y+1 | | | | | | | | | | | | | | | | | | | | octet Z | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 8.2.7.1-1: AT_TWAN_CONN_MODE attribute
Table 8.2.7.1-1: AT_TWAN_CONN_MODE attribute
* * *
Octet 1 indicates the type of attribute as AT_TWAN_CONN_MODE with a value of
144. This attribute is skippable. Octet 2 is the length of this attribute in
multiples of 4 octets as specified in RFC 4187 [33]. Padding length field
contains the length of the padding field. Message field is coded according to
clause 8.1.4.1. The length of the message field is determined from the length
field and the padding length field. Each octet of the padding field is set to
zero by sending entity and ignored by receiving entity.
* * *
### 8.2.8 Device Identity
#### 8.2.8.1 AT_DEVICE_IDENTITY attribute
The AT_DEVICE_IDENTITY attribute is coded according to figure 8.2.8.1-1 and
table 8.2.8.1-1.
+---------------------------------------+-----------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Attribute type = AT_DEVICE_IDENTITY | octet 1 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Length | octet 2 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Identity Type | octet 3 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Identity Length | octet 4 | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Identity Value | octet 5 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+ | Padding | octet n+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +---------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 8.2.8.1-1: AT_DEVICE_IDENTITY attribute
Table 8.2.8.1-1: AT_DEVICE_IDENTITY attribute
+----------------------------------------------------------------------+ | Octet 1 indicates the type of attribute as AT_DEVICE_IDENTITY with | | a value of xxx. This attribute is skippable. | +----------------------------------------------------------------------+ | Octet 2 is the length of this attribute in multiples of 4 octets as | | specified in RFC 4187 [33]. | +----------------------------------------------------------------------+ | Octet 3 indicates the type of Device Identity. | | | | ------ | | -------------------------- --- --- --- --- --- --- --- -- ---------- | | Identity Type (octet 3) | | Bits | | 7 6 5 4 3 2 1 0 | | 0 | | 0 0 0 0 0 0 0 Reserved | | | | 0 0 0 0 0 0 0 1 IMEI | | 0 | | 0 0 0 0 0 1 0 IMEISV | | | | All other values are reserved. | | ------ | | -------------------------- --- --- --- --- --- --- --- -- ---------- | +----------------------------------------------------------------------+ | Octet 4 is Identity length field and contains the length of the | | Identity value in octets. | +----------------------------------------------------------------------+ | The Identity Value field starts at octet 5 and its length is | | indicated by the Identity length field. The Identity value field | | represents the device identity digits of the corresponding Identity | | type and is coded using BCD coding. The Identity Value field is | | optional. | | | | For Identity Type \'IMEI\' and \'IMEISV\', Identity value digits are | | coded based on the IMEI and IMEISV structure defined in | | 3GPP TS 23.003 [3]. IMEI is 15 BCD digits and IMEISV is 16 BCD | | digits. Both IMEI and IMEISV are TBCD encoded. Bits 5 to 8 of octet | | i+4 (where i represents the octet of the IMEI(SV) being encoded) | | encodes digit 2i, bits 1 to 4 of octet i+4 encodes digit 2i-1 (i.e | | the order of digits is swapped in each octet compared to the digit | | order defined in 3GPP TS 23.003 [2]). Digits are packed | | contiguously with no internal padding. For IMEI, bits 5 to 8 of the | | last octet shall be filled with an end mark coded as \'1111\'. | +----------------------------------------------------------------------+ | The optional padding field starts after the last octet of the | | Identity value field. Each octet of this field is set to zero by | | sending entity and ignored by receiving entity. | +----------------------------------------------------------------------+
### 8.2.9 IKEv2 Notify payloads
#### 8.2.9.1 BACKOFF_TIMER Notify payload
The BACKOFF_TIMER Notify payload is used to indicate the value of the backoff
timer. The BACKOFF_TIMER Notify payload type is 41041 (see clause 8.1.2.3).
The length of the BACKOFF_TIMER Notify payload is 6 octets.
NOTE: The ePDG can include a BACKOFF_TIMER Notify payload with any error type
when needed.
The BACKOFF_TIMER Notify payload is coded according to figure 8.2.9.1-1 and
table 8.2.9.1-1.
+-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Protocol ID | > 1 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > SPI Size | > 2 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Notify Message Type | > 3-4 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Length=1 | > 5 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Backoff Timer Value | > 6 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.9.1-1: BACKOFF_TIMER Notify payload format
Table 8.2.9.1-1: BACKOFF_TIMER Notify payload value
+----------------------------------------------------------------------+ | Octet 1 is defined in IETF RFC 7296 [28] | +======================================================================+ | Octet 2 is SPI Size field. It is set to 0 and there is no Security | | Parameter Index field. | +----------------------------------------------------------------------+ | Octet 3 and Octet 4 is the Notify Message Type field. The Notify | | Message Type field is set to value 41041 to indicate the Backoff | | Timer. | +----------------------------------------------------------------------+ | Octet 5 is the Length field. This field indicates the length in | | octets of the Backoff Timer Value field. This field is set to 1. | +----------------------------------------------------------------------+ | Octet 6 is the Backoff Timer Value field. This field indicates the | | value of Backoff Timer. It is coded as the value part (as specified | | in 3GPP TS 24.007 [48] for type 4 IE) of the GPRS timer 3 | | information element defined in 3GPP TS 24.008 [46] | | clause 10.5.7.4a (Note 1). | +----------------------------------------------------------------------+ | NOTE 1: The GPRS Timer 3 IEI field and the length of GPRS Timer 3 | | contents field of the GPRS timer 3 information element are not | | included in the value of the Backoff Timer. | +----------------------------------------------------------------------+
#### 8.2.9.2 DEVICE_IDENTITY Notify payload
The DEVICE_IDENTITY Notify payload is used to indicate the device identity.
The DEVICE_IDENTITY Notify payload type is 41101 (see clause 8.1.2.3).
The DEVICE_IDENTITY Notify payload is coded according to figure 8.2.2.9-1 and
table 8.2.2.9-1.
+-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Protocol ID | > 1 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > SPI Size | > 2 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Notify Message Type | > 3-4 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Length | > 5-6 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Identity Type | > 7 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Identity Value | > 8-n | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.9.2-1: DEVICE_IDENTITY Notify payload format
Table 8.2.9.2-1: DEVICE_IDENTITY Notify payload value
+----------------------------------------------------------------------+ | Octet 1 is defined in IETF RFC 7296 [28] | +======================================================================+ | Octet 2 is SPI Size field. It is set to 0 and there is no Security | | Parameter Index field. | +----------------------------------------------------------------------+ | Octet 3 and Octet 4 is the Notify Message Type field. The Notify | | Message Type field is set to value 41101to indicate the | | DEVICE_IDENTITY. | +----------------------------------------------------------------------+ | Octet 5 and Octet 6 is the Length field. This field indicates the | | combined length in octets of the Identity Type and Identity Value | | fields. | +----------------------------------------------------------------------+ | Octet 7 is the Identity Type field. This field indicates the type of | | the device identity. | | | | ------ | | -------------------------- --- --- --- --- --- --- --- -- ---------- | | Identity Type (octet 7) | | Bits | | 7 6 5 4 3 2 1 0 | | 0 | | 0 0 0 0 0 0 0 Reserved | | | | 0 0 0 0 0 0 0 1 IMEI | | 0 | | 0 0 0 0 0 1 0 IMEISV | | | | All other values are reserved. | | ------ | | -------------------------- --- --- --- --- --- --- --- -- ---------- | +----------------------------------------------------------------------+ | Octet 8-n is the Identity Value field indicating the value of the | | device identity. The Identity value field represents the device | | identity digits of the corresponding Identity type and is coded | | using BCD coding. The Identity Value field is optional. | | | | For Identity Type \'IMEI\' and \'IMEISV\', Identity value digits are | | coded based on the IMEI and IMEISV structure defined in | | 3GPP TS 23.003 [3]. IMEI is 15 BCD digits and IMEISV is 16 BCD | | digits. Both IMEI and IMEISV are TBCD encoded. Bits 5 to 8 of octet | | i+5 (where i represents the octet of the IMEI(SV) being encoded) | | encodes digit 2i, bits 1 to 4 of octet i+5 encodes digit 2i-1 (i.e | | the order of digits is swapped in each octet compared to the digit | | order defined in 3GPP TS 23.003 [2]). Digits are packed | | contiguously with no internal padding. For IMEI, bits 5 to 8 of the | | last octet shall be filled with an end mark coded as \'1111\'. | +----------------------------------------------------------------------+
#### 8.2.9.3 NBIFOM_GENERIC_CONTAINER Notify payload
The NBIFOM_GENERIC_CONTAINER Notify payload is used to contain the NBIFOM
parameters.
The NBIFOM_GENERIC_CONTAINER Notify payload is coded according to figure
8.2.9.3-1 and table 8.2.9.3-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5 -- 6  
NBIFOM container contents 7 -- x
* * *
Figure 8.2.9.3-1: NBIFOM_GENERIC_CONTAINER Notify payload
Table 8.2.9.3-1: NBIFOM_GENERIC_CONTAINER Notify payload
Octet 1 is defined in IETF RFC 7296 [28].
* * *
Octet 2 is the SPI Size field. It is set to 0 and there is no Security
Parameter Index field. Octet 3 and Octet 4 is the Notify Message Type field.
The Notify Message Type field is set to value 41288 to indicate the
NBIFOM_GENERIC_CONTAINER. Octet 5 and octet 6 is the Length field. The Length
field indicates the length in octets of the NBIFOM container contents field.
Octet 7 to octet x is the NBIFOM container contents field containing the
NBIFOM parameter list as defined in 3GPP TS 24.161 [69], clause 6.1.
#### 8.2.9.4 P-CSCF_RESELECTION_SUPPORT Notify payload
The P-CSCF_RESELECTION_SUPPORT Notify payload is used to indicate the support
by the UE of the P-CSCF restoration extension for untrusted WLAN.
The P-CSCF_RESELECTION_SUPPORT Notify payload is coded according to figure
8.2.9.4-1 and table 8.2.9.4-1.
+-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Protocol ID | > 1 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > SPI Size | > 2 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Notify Message Type | > 3-4 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.9.4-1: P-CSCF_RESELECTION_SUPPORT Notify Payload format
Table 8.2.9.4-1: P-CSCF_RESELECTION_SUPPORT Notify Payload field values
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 41304 to indicate the
P-CSCF_RESELECTION_SUPPORT (see clause 8.1.2.3).
#### 8.2.9.5 PTI Notify payload
The PTI Notify payload is used to indicate that an INFORMATIONAL request
message of an ePDG-initiated modification procedure is initiated by another
INFORMATIONAL request message of an UE-initiated modification procedure.
The PTI Notify payload is coded according to figure 8.2.9.5-1 and table
8.2.9.5-1.
Bits
* * *
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5 -- 6  
Related Message ID 7 -- 10
Figure 8.2.9.5-1: PTI Notify payload
Table 8.2.9.5-1: PTI Notify payload
Octet 1 is defined in IETF RFC 7296 [28].
* * *
Octet 2 is the SPI Size field. It is set to 0 and there is no Security
Parameter Index field. Octet 3 and Octet 4 is the Notify Message Type field.
The Notify Message Type field is set to value 41501 (see clause 8.1.2.3) to
indicate the PTI. Octet 5 and octet 6 is the Length field. The Length field is
set to 4. Octet 7 to octet 10 is the Related Message ID field containing the
Message ID field of the INFORMATIONAL request message of the UE-initiated
modification procedure which initiated the ePDG-initiated modification
procedure.
#### 8.2.9.6 REACTIVATION_REQUESTED_CAUSE Notify payload
The REACTIVATION_REQUESTED_CAUSE Notify payload is used to indicate the UE to
re-establish the IPSec tunnel for the corresponding PDN connection after its
release.
The REACTIVATION_REQUESTED_CAUSE Notify payload is coded according to figure
8.2.9.6-1 and table 8.2.9.6-1.
+-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Protocol ID | > 1 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > SPI Size | > 2 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Notify Message Type | > 3-4 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.9.6-1: REACTIVATION_REQUESTED_CAUSE Notify payload format
Table 8.2.9.6-1: REACTIVATION_REQUESTED_CAUSE Notify payload field values
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 40961 to indicate the
REACTIVATION_REQUESTED_CAUSE (see clause 8.1.2.3).
#### 8.2.9.7 EMERGENCY_SUPPORT Notify payload
The EMERGENCY_SUPPORT Notify payload is used to indicate the ePDG support of
emergency service.
The EMERGENCY_SUPPORT Notify payload is coded according to figure 8.2.9.7-1
and table 8.2.9.7-1.
+-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Protocol ID | > 1 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > SPI Size | > 2 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+ | > Notify Message Type | > 3-4 | | | | | | | | +-----------------------+-------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.9.7-1: EMERGENCY_SUPPORT Notify Payload format
Table 8.2.9.7-1: EMERGENCY_SUPPORT Notify Payload field value
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 41112 to indicate the EMERGENCY_SUPPORT
(see clause 8.1.2.3).
#### 8.2.9.8 EMERGENCY_CALL_NUMBERS Notify payload
The EMERGENCY_CALL_NUMBERS Notify payload is used:
a) by the ePDG to provide local emergency call numbers for use within the
country indicated by the MCC information; and
b) by the UE to indicate support of retrieval of local emergency call numbers
via IKEv2 procedures.
The EMERGENCY_CALL_NUMBERS Notify payload is coded according to figure
8.2.9.8-1 and table 8.2.9.8-1 with a minimum length of 4 octets and a maximum
length of 55 octets.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
MCC information 5  
6  
Length 7  
Local emergency numbers 8 -- x
* * *
Figure 8.2.9.8-1: EMERGENCY_CALL_NUMBERS Notify payload
Table 8.2.9.8-1: EMERGENCY_CALL_NUMBERS Notify payload
Octet 1 is defined in IETF RFC 7296 [28].
* * *
Octet 2 is the SPI Size field. It is set to 0 and there is no Security
Parameter Index field. Octet 3 and Octet 4 is the Notify Message Type field.
The Notify Message Type field is set to value 41134 to indicate the
EMERGENCY_CALL_NUMBERS. Octet 5 to octet 6 contains the MCC information of the
country for which the emergency numbers indicated in the local emergency
numbers field are applicable. If the EMERGENCY_CALL_NUMBERS Notify payload is
included in the IKE_AUTH response message, then the MCC information field
shall be populated. Octet 7 is the Length field. The Length field indicates
the length in octets of the Local emergency numbers field. Octet 8 to octet x
is the Local emergency numbers field containing the emergency call numbers is
in the same format as the Emergency Number List defined in clause 10.5.3.13 of
3GPP TS 24.008 [46], starting with octet 3. The MCC information field, length
field and Local emergency numbers field are omitted when the UE sends the
EMERGENCY_CALL_NUMBERS Notify payload to the network to indicate support of
retrieval of local emergency call numbers.
The format of the MCC information item is shown in figure 8.2.9.8-2. Table
8.2.9.8-2 shows the coding of the MCC in the MCC information item.
* * *
7 6 5 4 3 2 1 0  
MCC digit 2 MCC digit 1 5  
reserved MCC digit 3 6
* * *
Figure 8.2.9.8-2:  _MCC information_ item
Table 8.2.9.8-2: _MCC information_ item
+----------------------------------------------------------------------+ | **MCC** , Mobile country code (octet 5, octet 6 bits 1 to 4) | | | | The MCC field is coded as in ITU-T Rec. E212 [63], Annex A. | | | | Bits 5 to 8 of 6 shall be coded as \"1111\". Mobile equipment shall | | ignore bits 5 to 8 of octet 6. | +----------------------------------------------------------------------+
#### 8.2.9.9 IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify payload
The IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify payload is used to indicate
UE\'s support of the IKEv2 multiple bearer PDN connectivity.
The IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify payload is coded according
to figure 8.2.9.9-1 and table 8.2.9.9-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4
* * *
Figure 8.2.9.9-1: IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify Payload format
Table 8.2.9.9-1: IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY Notify Payload field
value
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 42011 to indicate the
IKEV2_MULTIPLE_BEARER_PDN_CONNECTIVITY (see clause 8.1.2.3).
#### 8.2.9.10 EPS_QOS Notify payload
The EPS_QOS Notify payload is used to indicate EPS QoS.
The EPS_QOS Notify payload is coded according to figure 8.2.9.10-1 and table
8.2.9.10-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
EPS QoS Value 6 -- x
* * *
Figure 8.2.9.10-1: EPS_QOS Notify payload format
Table 8.2.9.10-1: EPS_QOS Notify payload value
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 42014 to indicate the EPS_QOS (see clause
8.1.2.3). Octet 5 is the Length field. This field indicates the length in
octets of the EPS QoS Value field. Octets 6 and later are the EPS QoS Value
field. This field indicates the EPS QoS. It is coded as the value part (as
specified in 3GPP TS 24.007 [48] for type 4 IE) of the EPS quality of service
information element defined in 3GPP TS 24.301 [10] clause 9.9.4.3 (Note 1).
NOTE 1: The EPS quality of service IEI field and the Length of EPS quality of
service contents field of the EPS quality of service information element are
not included in the value of the EPS QoS Value field.
#### 8.2.9.10A EXTENDED_EPS_QOS Notify payload
The EXTENDED_EPS_QOS Notify payload is used to indicate the extended EPS QoS.
The EXTENDED_EPS_QOS Notify payload is coded according to figure 8.2.9.10A-1
and table 8.2.9.10A-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
Extended EPS QoS Value 6 -- x
* * *
Figure 8.2.9.10A-1: EXTENDED_EPS_QOS Notify payload format
Table 8.2.9.10A-1: EXTENDED_EPS_QOS Notify payload value
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 42015 to indicate the EXTENDED_EPS_QOS (see
clause 8.1.2.3). Octet 5 is the Length field. This field indicates the length
in octets of the Extended EPS QoS Value field. Octets 6 and later are the
Extended EPS QoS Value field. This field indicates the extended EPS QoS. It is
coded as the value part (as specified in 3GPP TS 24.007 [48] for type 4 IE) of
the extended quality of service information element defined in 3GPP TS 24.301
[10] clause 9.9.4.30 (Note 1). NOTE 1: The Extended quality of service IEI
field and the Length of extended quality of service contents field of the
extended quality of service information element are not included in the value
of the Extended EPS QoS Value field.
#### 8.2.9.11 TFT Notify payload
The TFT Notify payload is used to indicate TFT.
The TFT Notify payload is coded according to figure 8.2.9.11-1 and table
8.2.9.11-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
TFT Value 6 -- x
* * *
Figure 8.2.9.11-1: TFT Notify payload format
Table 8.2.9.11-1: TFT Notify payload value
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 42017 to indicate the TFT (see clause
8.1.2.3). Octet 5 is the Length field. This field indicates the length in
octets of the TFT Value field. Octets 6 and later are the TFT Value field.
This field indicates the TFT. It is coded as the value part (as specified in
3GPP TS 24.007 [48] for type 4 IE) of the traffic flow template information
element defined in 3GPP TS 24.00 [46] clause 10.5.6.12 (Note 1). NOTE 1: The
Traffic flow template IEI field and the Length of traffic flow template IE
field of the traffic flow template information element are not included in the
value of the TFT Value field.
#### 8.2.9.12 MODIFIED_BEARER Notify payload
The MODIFIED_BEARER Notify payload is used to indicate ePDG\'s ESP SPI of the
modified child SA.
The MODIFIED_BEARER Notify payload is coded according to figure 8.2.9.12-1 and
table 8.2.9.12-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Security Parameter Index 5 -- 8
* * *
Figure 8.2.9.12-1: MODIFIED_BEARER Notify payload format
Table 8.2.9.12-1: MODIFIED_BEARER Notify payload value
Octet 1 is defined in IETF RFC 7296 [28] and is set to 3 to indicate ESP.
* * *
Octet 2 is SPI Size field. It is set to 4 and there is one Security Parameter
Index field. Octet 3 to Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 42020 to indicate the MODIFIED_BEARER (see
clause 8.1.2.3). Octet 5 to Octet 8 is the Security Parameter Index field. The
Security Parameter Index field contains the ePDG\'s ESP SPI of the modified
child SA.
#### 8.2.9.13 APN_AMBR Notify payload
The APN_AMBR Notify payload is used to indicate the APN-AMBR.
The APN_AMBR Notify payload is coded according to figure 8.2.9.13-1 and table
8.2.9.13-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
APN AMBR Value 6 -- x
* * *
Figure 8.2.9.13-1: APN_AMBR Notify payload format
Table 8.2.9.13-1: APN_AMBR Notify payload value
+----------------------------------------------------------------------+ | Octet 1 is defined in IETF RFC 7296 [28] | +======================================================================+ | Octet 2 is SPI Size field. It is set to 0 and there is no Security | | Parameter Index field. | +----------------------------------------------------------------------+ | Octet 3 and Octet 4 is the Notify Message Type field. The Notify | | Message Type field is set to value 42094 to indicate the APN_AMBR | | (see clause 8.1.2.3). | +----------------------------------------------------------------------+ | Octet 5 is the Length field. This field indicates the length in | | octets of the APN AMBR Value field. | +----------------------------------------------------------------------+ | Octets 6 and later are the APN AMBR Value field. This field | | indicates the APN-AMBR. It is coded as the value part (as specified | | in 3GPP TS 24.007 [48] for type 4 IE) of the APN aggregate maximum | | bit rate information element defined in 3GPP TS 24.301 [10] | | clause 9.9.4.2 (Note 1). | +----------------------------------------------------------------------+ | NOTE 1: The APN aggregate maximum bit rate IEI field and the Length | | of APN aggregate maximum bit rate contents field of the APN | | aggregate maximum bit rate information element are not included in | | the value of the APN AMBR Value field. | +----------------------------------------------------------------------+
#### 8.2.9.14 EXTENDED_APN_AMBR Notify payload
The EXTENDED_APN_AMBR Notify payload is used to indicate the extended APN-
AMBR.
The EXTENDED_APN_AMBR Notify payload is coded according to figure 8.2.9.14-1
and table 8.2.9.14-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
Extended APN AMBR Value 6 -- x
* * *
Figure 8.2.9.14-1: EXTENDED_APN_AMBR Notify payload format
Table 8.2.9.14-1: EXTENDED_APN_AMBR Notify payload value
+----------------------------------------------------------------------+ | Octet 1 is defined in IETF RFC 7296 [28] | +======================================================================+ | Octet 2 is SPI Size field. It is set to 0 and there is no Security | | Parameter Index field. | +----------------------------------------------------------------------+ | Octet 3 and Octet 4 is the Notify Message Type field. The Notify | | Message Type field is set to value 42095 to indicate the | | EXTENDED_APN_AMBR (see clause 8.1.2.3). | +----------------------------------------------------------------------+ | Octet 5 is the Length field. This field indicates the length in | | octets of the Extended APN AMBR Value field. | +----------------------------------------------------------------------+ | Octets 6 and later are the Extended APN AMBR Value field. This field | | indicates the extended APN-AMBR. It is coded as the value part (as | | specified in 3GPP TS 24.007 [48] for type 4 IE) of the extended | | APN aggregate maximum bit rate information element defined in | | 3GPP TS 24.301 [10] clause 9.9.4.29 (Note 1). | +----------------------------------------------------------------------+ | NOTE 1: The Extended APN aggregate maximum bit rate IEI field and | | the Length of extended APN aggregate maximum bit rate contents of | | the extended APN aggregate maximum bit rate are not included in the | | value of the Extended APN AMBR Value field. | +----------------------------------------------------------------------+
#### 8.2.9.15 N1_MODE_CAPABILITY Notify payload
The N1_MODE_CAPABILITY Notify payload is used to indicate support of N1 mode
or N1 mode capability is disabled, and to indicate the PDU session ID
allocated to the PDU session associated with the IKEv2 security association
being established by the IKEv2 message carrying the N1_MODE_CAPABILITY Notify
payload.
The N1_MODE_CAPABILITY Notify payload is coded according to figure 8.2.9.15-1
and table 8.2.9.15-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
PDU Session ID 6
* * *
Figure 8.2.9.15-1: N1_MODE_CAPABILITY Notify payload format
Table 8.2.9.15-1: N1_MODE_CAPABILITY Notify payload value
+----------------------------------------------------------------------+ | Octet 1 is defined in IETF RFC 7296 [28]. | +======================================================================+ | Octet 2 is SPI Size field. It is set to 0 and there is no Security | | Parameter Index field. | +----------------------------------------------------------------------+ | Octet 3 and Octet 4 is the Notify Message Type field. The Notify | | Message Type field is set to value 51015 to indicate the | | N1_MODE_CAPABILITY (see clause 8.1.2.3). | +----------------------------------------------------------------------+ | Octet 5 is the Length field. This field indicates the length in | | octets of the PDU Session ID field. | +----------------------------------------------------------------------+ | Octets 6 is the PDU Session ID field. This field indicates the PDU | | session ID. It is coded as the PDU session identity information | | element defined in 3GPP TS 24.007 [48] clause 11.2.3.1b. | +----------------------------------------------------------------------+
#### 8.2.9.16 N1_MODE_INFORMATION Notify payload
The N1_MODE_INFORMATION Notify payload is used to indicate the S-NSSAI for the
PDU session associated with the IKEv2 security association established by the
IKEv2 message carrying the N1_MODE_INFORMATION Notify payload.
The N1_MODE_INFORMATION Notify payload is coded according to figure 8.2.9.16-1
and table 8.2.9.16-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
S-NSSAI Value 6 -- x
* * *
Figure 8.2.9.16-1: N1_MODE_INFORMATION Notify payload format
Table 8.2.9.16-1: N1_MODE_INFORMATION Notify payload value
+----------------------------------------------------------------------+ | Octet 1 is defined in IETF RFC 7296 [28]. | +======================================================================+ | Octet 2 is the SPI Size field. It is set to 0 and there is no | | Security Parameter Index field. | +----------------------------------------------------------------------+ | Octet 3 and Octet 4 are the Notify Message Type field. The Notify | | Message Type field is set to value 51115 to indicate the | | N1_MODE_INFORMATION (see clause 8.1.2.3). | +----------------------------------------------------------------------+ | Octet 5 is the Length field. This field indicates the length in | | octets of the S-NSSAI Value field. | +----------------------------------------------------------------------+ | Octets 6 and later are the S-NSSAI Value field. This field indicates | | the S-NSSAI value. It is coded as the value part of the S-NSSAI | | information element defined in 3GPP TS 24.501 [76] | | clause 9.11.2.8. | +----------------------------------------------------------------------+
#### 8.2.9.17 N1_MODE_S_NSSAI_PLMN_ID Notify payload
The N1_MODE_S_NSSAI_PLMN_ID Notify payload is used to indicate the PLMN ID
that the S-NSSAI relates to for the PDU session associated with the IKEv2
security association established by the IKEv2 message carrying the
N1_MODE_S_NSSAI_PLMN_ID Notify payload.
The N1_MODE_S_NSSAI_PLMN_ID Notify payload is coded according to figure
8.2.9.17-1 and table 8.2.9.17-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length 5  
S-NSSAI PLMN ID 6 -- 8
* * *
Figure 8.2.9.17-1: N1_MODE_S_NSSAI_PLMN_ID Notify payload format
Table 8.2.9.17-1: N1_MODE_S_NSSAI_PLMN_ID Notify payload value
Octet 1 is defined in IETF RFC 7296 [28].
* * *
Octet 2 is the SPI Size field. It is set to 0 and there is no Security
Parameter Index field. Octet 3 and Octet 4 are the Notify Message Type field.
The Notify Message Type field is set to value 52216 to indicate the
N1_MODE_S_NSSAI_PLMN_ID (see clause 8.1.2.3). Octet 5 is the Length field.
This field indicates the length in octets of the S-NSSAI PLMN ID field. Octets
6, 7 and 8 are the S-NSSAI PLMN ID field. This field indicates the PLMN ID
that the S-NSSAI relates to. It is coded as the value part of the PLMN
identity of the CN operator information element defined in 3GPP TS 24.008 [46]
clause 10.5.5.36.
#### 8.2.9.18 DNS_SRV_SEC_INFO_IND Notify payload
The DNS_SRV_SEC_INFO_IND Notify payload is used to indicate that the UE
supports receiving DNS server security information.
The DNS_SRV_SEC_INFO_IND Notify payload is coded according to figure
8.2.9.18-1 and table 8.2.9.18-1.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Number of supported DNS server security protocols 5  
Supported DNS server security protocol 1 6*  
Supported DNS server security protocol 2 7*  
...  
Supported DNS server security protocol N (N+5)*
* * *
Figure 8.2.9.18-1: DNS_SRV_SEC_INFO_IND Notify payload format
Table 8.2.9.18-1: DNS_SRV_SEC_INFO_IND Notify payload value
Octet 1 is defined in IETF RFC 7296 [28]
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 52301 to indicate the DNS_SRV_SEC_INFO_IND
(see clause 8.1.2.3). Octet 5 is the Number of supported DNS server security
protocols field. This field indicates the number of the supported DNS server
security protocols fields. Octets 6 to octet N are the supported DNS server
security protocol fields. Each of these fields indicates the DNS server
security protocol supported by the UE and is coded as the security protocol
type field of the _container identifier contents_ field of a parameter with
the _container identifier_ field indicating DNS server security protocol
support, of the Protocol configuration options information element as
specified in 3GPP TS 24.008 [46] clause 10.5.6.3.1.
#### 8.2.9.19 DNS_SRV_SEC_INFO Notify payload
The DNS_SRV_SEC_INFO Notify payload is used to indicate the DNS server
security information.
The DNS_SRV_SEC_INFO Notify payload is coded according to figure 8.2.9.19-1,
figure 8.2.9.19-2, table 8.2.9.19-1 and table 8.2.9.19-2.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 -- 4  
Length of DNS server security parameters 5 -- 6  
DNS server security parameter 1 7 -- u  
DNS server security parameter 2 (u+1)* - v*  
... (v+1)* - w*  
DNS server security parameter N (w+1)* - x*
* * *
Figure 8.2.9.19-1: DNS_SRV_SEC_INFO Notify payload format
Table 8.2.9.19-1: DNS_SRV_SEC_INFO Notify payload value
Octet 1 is defined in IETF RFC 7296 [28].
* * *
Octet 2 is SPI Size field. It is set to 0 and there is no Security Parameter
Index field. Octet 3 and Octet 4 is the Notify Message Type field. The Notify
Message Type field is set to value 52302 to indicate the DNS_SRV_SEC_INFO (see
clause 8.1.2.3). Octet 5 and octet 6 are the Length of DNS server security
parameters field. This field indicates the length in octets of the DNS server
security parameter fields. Octets 7 to octet x are one or more DNS server
security parameter fields. Each DNS server security parameter field is encoded
according to figure 8.2.9.19-2 and table 8.2.9.19-2.
* * *
Bits  
7 6 5 4 3 2 1 0 Octets Length of DNS server security information (u+1) - (u+2)  
DNS server security information (u+3) - v
* * *
Figure 8.2.9.19-2: DNS server security parameter
Table 8.2.9.19-2: DNS server security parameter
Octet (u+1) and octet (u+2) are the length of DNS server security information
field. The length of DNS server security information field indicates the
length in octets of the DNS server security information field.
* * *
Octets (u+3) to octet v are the DNS server security information field. The DNS
server security information field indicates the DNS server security
information and is coded as the _container identifier contents_ field of a
parameter with the _container identifier_ field indicating the DNS server
security information with length of two octets, of the Protocol configuration
options information element as specified in 3GPP TS 24.008 [46] clause
10.5.6.3.1.
#### 8.2.9.20 ATSSS_REQUEST Notify payload
The ATSSS_REQUEST Notify payload is used to indicate the ATSSS request
information for user plane resources of the MA PDU session associated with the
IKEv2 security association established by the IKEv2 message carrying the
ATSSS_REQUEST Notify payload.
The ATSSS_REQUEST Notify payload is coded according to figure 8.2.9.20-1 and
table 8.2.9.20-1.
Bits
* * *
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 - 4  
Length 5  
ATSSS request information 6
Figure 8.2.9.20-1: ATSSS_REQUEST Notify payload format
Table 8.2.9.20-1: ATSSS_REQUEST Notify payload value
Octet 1 is defined in IETF RFC 7296 [28].
* * *
Octet 2 is the SPI Size field. It is set to 0 and there is no Security
Parameter Index field. Octet 3 and Octet 4 are the Notify Message Type field.
The Notify Message Type field is set to value 52331 to indicate the
ATSSS_REQUEST (see clause 8.1.2.3). Octet 5 is the Length field. This field
indicates the length in octets of the ATSSS request information field. Octets
6 is ATSSS request information field. This field indicates the ATSSS request
information. It is coded as the ATSSS request PCO parameter container contents
defined in 3GPP TS 24.193 [79] clause 6.1.6.2.
#### 8.2.9.21 ATSSS_RESPONSE Notify payload
The ATSSS_RESPONSE Notify payload is used to indicate the ATSSS response
information for user plane resources of the MA PDU session associated with the
IKEv2 security association established by the IKEv2 message carrying the
ATSSS_REQUEST Notify payload.
The ATSSS_RESPONSE Notify payload is coded according to figure 8.2.9.21-1,
figure 8.2.9.21-2 and table 8.2.9.21-1.
Bits
* * *
7 6 5 4 3 2 1 0 Octets Protocol ID 1  
SPI Size 2  
Notify Message Type 3 - 4  
Length 5 - 6  
ATSSS response information 7 -- n
Figure 8.2.9.21-1: ATSSS_RESPONSE Notify payload format
+------------+------------+-------+---+---+---+---+---+--------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | Octets | +============+============+=======+===+===+===+===+===+========+ | 0 | P2ind | P1ind | 7 | | | | | | | | | | | | | | | | | spare | | | | | | | | | +------------+------------+-------+---+---+---+---+---+--------+ | Length of | 8* -- 9* | | | | | | | | | ATSSS | | | | | | | | | | response | | | | | | | | | | i | | | | | | | | | | nformation | | | | | | | | | | part 1 | | | | | | | | | +------------+------------+-------+---+---+---+---+---+--------+ | ATSSS | 10* - q* | | | | | | | | | response | | | | | | | | | | i | | | | | | | | | | nformation | | | | | | | | | | part 1 | | | | | | | | | +------------+------------+-------+---+---+---+---+---+--------+ | Length of | (q+1)* -- | | | | | | | | | ATSSS | (q+2)* | | | | | | | | | response | | | | | | | | | | i | | | | | | | | | | nformation | | | | | | | | | | part 2 | | | | | | | | | +------------+------------+-------+---+---+---+---+---+--------+ | ATSSS | (q+3)* -- | | | | | | | | | response | n* | | | | | | | | | i | | | | | | | | | | nformation | | | | | | | | | | part 2 | | | | | | | | | +------------+------------+-------+---+---+---+---+---+--------+
Figure 8.2.9.21-2: ATSSS response information
Table 8.2.9.21-1: ATSSS_RESPONSE Notify payload value
Octet 1 is defined in IETF RFC 7296 [28].
* * *
Octet 2 is the SPI Size field. It is set to 0 and there is no Security
Parameter Index field.  
Octet 3 and Octet 4 are the Notify Message Type field. The Notify Message Type
field is set to value 52332 to indicate the ATSSS_RESPONSE (see clause
8.1.2.3).  
Octet 5 and Octet 6 are the Length field. This field indicates the length in
octets of the ATSSS response information field.  
ATSSS response information part 1 indication (P1ind) (bit 0 of octet 7)  
The P1ind indicates whether the ATSSS response information part 1 field is
included  
Bit  
**0**  
0 ATSSS response information part 1 field not included 1 ATSSS response
information part 1 field included
ATSSS response information part 2 indication (P2ind) (bit 1 of octet 7)  
The P2ind indicates whether the ATSSS response information part 2 field is
included  
Bit  
**1**  
0 ATSSS response information part 2 field not included 1 ATSSS response
information part 2 field included
Octets 10 to q are the ATSSS response information part 1 field. This field
indicates part 1 of the ATSSS response information. It is coded as the ATSSS
response with the length of two octets PCO parameter container contents
defined in 3GPP TS 24.193 [79] clause 6.1.6.3.  
Octets q+3 to n are the ATSSS response information part 2 field. This field
indicates part 2 of the ATSSS response information. It is coded as the ATSSS
parameter contents including one or more ATSSS rules defined in 3GPP TS 24.193
[79] clause 6.1.3.2.
#### 8.2.9.22 HPA_INFO Notify payload
The HPA_INFO Notify payload is used to indicate high priority access (e.g.,
MPS) related parameters.
The HPA_INFO Notify payload is coded according to Figure 8.2.9.22-1 and Table
8.2.9.22-1.
+---------------------+-------+-------+-------+-------+-------+----------+---------+--------+ | Bits | | | | | | | | | +=====================+=======+=======+=======+=======+=======+==========+=========+========+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | Octets | +---------------------+-------+-------+-------+-------+-------+----------+---------+--------+ | Protocol ID | 1 | | | | | | | | +---------------------+-------+-------+-------+-------+-------+----------+---------+--------+ | SPI Size | 2 | | | | | | | | +---------------------+-------+-------+-------+-------+-------+----------+---------+--------+ | Notify Message Type | 3-4 | | | | | | | | +---------------------+-------+-------+-------+-------+-------+----------+---------+--------+ | Length | 5 | | | | | | | | +---------------------+-------+-------+-------+-------+-------+----------+---------+--------+ | 0 | 0 | 0 | 0 | 0 | 0 | MPS_PRI | AC_PRI | 6 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | Spare | | | | +---------------------+-------+-------+-------+-------+-------+----------+---------+--------+
Figure 8.2.9.22-1: HPA_INFO Notify payload format
Table 8.2.9.22-1: HPA_INFO Notify payload value
+----------------------------------------------------------------------+ | Octet 1 is defined in IETF RFC 7296 [28] | +======================================================================+ | Octet 2 is the SPI Size field. It is set to 0 and there is no | | Security Parameter Index field. | +----------------------------------------------------------------------+ | Octet 3 and Octet 4 is the Notify Message Type field. The Notify | | Message Type field is set to value 55911 to indicate the HPA message | | type (see clause 8.1.2.3). | +----------------------------------------------------------------------+ | Octet 5 is the Length field. This field indicates the length in | | octets of the HPA_INFO field. | +----------------------------------------------------------------------+ | Octet 6 is the HPA_INFO field. This field contains priority related | | information and is coded as follows: | | | | The UE is configured with high priority access control classes 11 to | | 15 indicated in the USIM (AC_PRI) (octet 6, bit 0) | | | | 0 None of the access priority bits 11 to 15 in the USIM are set. | | | | 1 One or more of the access priority bits 11-15 in the USIM are set. | | | | The UE is configured for MPS in the HPLMN, EHPLMN or visited PLMN of | | the home country indicated in the USIM (MPS_PRI) (octet 6, bit 1) | | | | 0 The UE is not configured for MPS in the USIM | | | | 1 The UE is configured for MPS in the USIM | | | | Bit 2 to bit 7 of octet 6 are spare. | +----------------------------------------------------------------------+
### 8.2.10 EAP-3GPP-LimitedService method
#### 8.2.10.1 General
The messages of EAP-3GPP-LimitedService method are EAP requests and EAP
responses as specified in IETF RFC 3748 [29] clause 4.1 and use coding of the
expanded method type as described in IETF RFC 3748 [29] clause 5.7.
The sending entity shall set value of a spare bit to zero. The receiving
entity shall ignore value of a spare bit.
#### 8.2.10.2 Message format
##### 8.2.10.2.1 EAP-Request/3GPP-LimitedService-Init-Info message
EAP-Request/3GPP-LimitedService-Init-Info message is coded as specified in
figure 8.2.10.2.1-1 and table 8.2.10.2.1-1.
+-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Code | > 1 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Identifier | > 2 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Length | > 3 - 4 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Type | > 5 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Id | > 6 - 8 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Type | > 9 - 12 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Message-Id | > 13 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Spare | > 14 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > EAP-AKA attributes length | > 15 - 16 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > EAP-AKA attributes | > 17 - n | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Extensions | > n+1 - m | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.10.2.1-1: EAP-Request/3GPP-LimitedService-Init-Info message
Table 8.2.10.2.1-1: EAP-Request/3GPP-LimitedService-Init-Info message
Code field is set to 1 (decimal) as specified in IETF RFC 3748 [29] clause 4.1
and indicates request.
* * *
Identifier field is set as specified in IETF RFC 3748 [29] clause 4.1. Length
field is set as specified in IETF RFC 3748 [29] clause 4.1 and indicates the
length of the EAP-Request/3GPP-LimitedService-Init-Info message in octets.
Type field is set to 254 (decimal) as specified in IETF RFC 3748 [29] clause
5.7 and indicates the expanded type. Vendor-Id field is set to the 3GPP
Vendor-Id of 10415 (decimal) registered with IANA under the SMI Private
Enterprise Code registry. Vendor-Type field is set to EAP-3GPP-LimitedService
method identifier of 2 (decimal) as specified in 3GPP TS 33.402 [15] annex C.
Message-Id field is set to 3GPP-LimitedService-Init-Info-Id of 1 (decimal).
Spare field consists of spare bits. EAP-AKA attributes length field indicates
the length of EAP-AKA attributes field in octets. EAP-AKA attributes field
contains attributes as specified in IETF RFC 4187 [33]. Extensions field is an
optional field and consists of spare bits.
##### 8.2.10.2.2 EAP-Response/3GPP-LimitedService-Init-Info message
EAP-Response/3GPP-LimitedService-Init-Info message is coded as specified in
figure 8.2.10.2.2-1 and table 8.2.10.2.2-1.
+-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Code | > 1 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Identifier | > 2 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Length | > 3 - 4 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Type | > 5 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Id | > 6 - 8 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Type | > 9 - 12 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Message-Id | > 13 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Spare | > 14 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > EAP-AKA attributes length | > 15 - 16 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > EAP-AKA attributes | > 17 - n | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Extensions | > n+1 - m | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.10.2.2-1: EAP-Response/3GPP-LimitedService-Init-Info message
Table 8.2.10.2.2-1: EAP-Response/3GPP-LimitedService-Init-Info message
Code field is set to 2 (decimal) as specified in IETF RFC 3748 [29] clause 4.1
and indicates response.
* * *
Identifier field is set as specified in IETF RFC 3748 [29] clause 4.1. Length
field is set as specified in IETF RFC 3748 [29] clause 4.1 and indicates the
length of the EAP-Response/3GPP-LimitedService-Init-Info message in octets.
Type field is set to 254 (decimal) as specified in IETF RFC 3748 [29] clause
5.7 and indicates the expanded type. Vendor-Id field is set to the 3GPP
Vendor-Id of 10415 (decimal) registered with IANA under the SMI Private
Enterprise Code registry. Vendor-Type field is set to EAP-3GPP-LimitedService
method identifier of 2 (decimal) as specified in 3GPP TS 33.402 [15] annex C.
Message-Id field is set to 3GPP-LimitedService-Init-Info-Id of 1 (decimal).
Spare field consists of spare bits. EAP-AKA attributes length field indicates
the length of EAP-AKA attributes field in octets. EAP-AKA attributes field
contains attributes as specified in IETF RFC 4187 [33]. Extensions field is an
optional field and consists of spare bits.
##### 8.2.10.2.3 EAP-Request/3GPP-LimitedService-Notif message
EAP-Request/3GPP-LimitedService-Notif message is coded as specified in figure
8.2.10.2.3-1 and table 8.2.10.2.3-1.
+-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Code | > 1 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Identifier | > 2 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Length | > 3 - 4 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Type | > 5 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Id | > 6 - 8 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Type | > 9 - 12 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Message-Id | > 13 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Spare | > 14 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > EAP-AKA attributes length | > 15 - 16 | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > EAP-AKA attributes | > 17 - n | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+ | > Extensions | > n+1 - m | | | | | | | | +-----------------------------+-----------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.10.2.3-1: EAP-Request/3GPP-LimitedService-Notif message
Table 8.2.10.2.3-1: EAP-Request/3GPP-LimitedService-Notif message
Code field is set to 1 (decimal) as specified in IETF RFC 3748 [29] clause 4.1
and indicates request.
* * *
Identifier field is set as specified in IETF RFC 3748 [29] clause 4.1. Length
field is set as specified in IETF RFC 3748 [29] clause 4.1 and indicates the
length of the EAP-Request/3GPP-LimitedService-Notif message in octets. Type
field is set to 254 (decimal) as specified in IETF RFC 3748 [29] clause 5.7
and indicates the expanded type. Vendor-Id field is set to the 3GPP Vendor-Id
of 10415 (decimal) registered with IANA under the SMI Private Enterprise Code
registry. Vendor-Type field is set to EAP-3GPP-LimitedService method
identifier of 2 (decimal) as specified in 3GPP TS 33.402 [15] annex C.
Message-Id field is set to 3GPP-LimitedService-Notif-Id of 2 (decimal). Spare
field consists of spare bits. EAP-AKA attribute length field indicates the
length of EAP-AKA attributes field in octets. EAP-AKA attributes field
contains attributes as specified in IETF RFC 4187 [33]. Extensions field is an
optional field and consists of spare bits.
##### 8.2.10.2.4 EAP-Response/3GPP-LimitedService-Notif message
EAP-Response/3GPP-LimitedService-Notif message is coded as specified in figure
8.2.10.2.4-1 and table 8.2.10.2.4-1.
+---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Bits | | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | 7 | 6 | 5 | > 4 | > 3 | > 2 | > 1 | > 0 | > Octets | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Code | > 1 | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Identifier | > 2 | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Length | > 3 - 4 | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Type | > 5 | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Id | > 6 - 8 | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Vendor-Type | > 9 - 12 | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Message-Id | > 13 | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+ | > Extensions | > 14 -m | | | | | | | | +---------------+----------+---+-----+-----+-----+-----+-----+----------+
Figure 8.2.10.2.4-1: EAP-Response/3GPP-LimitedService-Notif message
Table 8.2.10.2.4-1: EAP-Response/3GPP-LimitedService-Notif message
Code field is set to 2 (decimal) as specified in IETF RFC 3748 [29] clause 4.1
and indicates response.
* * *
Identifier field is set as specified in IETF RFC 3748 [29] clause 4.1. Length
field is set as specified in IETF RFC 3748 [29] clause 4.1 and indicates the
length of the EAP-Response/3GPP-LimitedService-Notif message message in
octets. Type field is set to 254 (decimal) as specified in IETF RFC 3748 [29]
clause 5.7 and indicates the expanded type. Vendor-Id field is set to the 3GPP
Vendor-Id of 10415 (decimal) registered with IANA under the SMI Private
Enterprise Code registry. Vendor-Type field is set to EAP-3GPP-LimitedService
method identifier of 2 (decimal) as specified in 3GPP TS 33.402 [15] annex C.
Message-Id field is set to 3GPP-LimitedService-Notif-Id of 2 (decimal).
Extensions field is an optional field and consists of spare bits.
### 8.2.11 AT_HPA_INFO attribute
The AT_HPA_INFO attribute is coded according to Figure 8.2.11-1 and Table
8.2.11-1.
The AT_HPA_INFO attribute conveys the UE\'s priority subscription information
from the USIM file as specified in 3GPP TS 31.102 [35].
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | O | | | | | | | | | | ctets | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Attr | 1 | | | | | | | | | ibute | | | | | | | | | | Type | | | | | | | | | | = | | | | | | | | | | AT\ | | | | | | | | | | _HPA\ | | | | | | | | | | _INFO | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | 2 | | | | | | | | | ength | | | | | | | | | | = 1 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | MPS | AC | 3 | | | | | | | | _PRI | _PRI | | | Spare | Spare | Spare | Spare | Spare | Spare | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Pa | 4 | | | | | | | | | dding | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 8.2.11-1: AT_HPA_INFO attribute
Table 8.2.11-1: AT_HPA_INFO attribute
* * *
Octet 1 indicates the type of attribute as AT_ HPA_INFO with a value of zzz.
This attribute is skippable.  
Octet 2 is the length of this attribute which shall be set to 1 as per IETF
RFC 4187 [33].  
Octet 3, the HPA INFO Value, contains priority related information andis coded
as follows:  
The UE is configured with high priority access control classes 11 to 15
indicated in the USIM (AC_PRI) (octet 3, bit 0)  
0 None of the access priority bits 11 to 15 in the USIM are set. 1 One or more
of the access priority bits 11-15 in the USIM are set. The UE is configured
for MPS in the HPLMN, EHPLMN or visited PLMN of the home country indicated in
the USIM (MPS_PRI) (octet 3, bit 1)  
0 The UE is not configured for MPS in the USIM 1 The UE is configured for MPS
in the USIM Bit 2 to bit 7 of octet 3 are spare.
The optional padding field starts after the last octet of the HPA INFO Value
field. Each octet of this field is set to zero by sending entity and ignored
by receiving entity.
* * *
###### ## Annex A (informative): Example signalling flows for inter-system
change between 3GPP and non-3GPP systems using ANDSF
# A.1 Scope of signalling flows
This annex gives examples of signalling flows for mobility between 3GPP and
non-3GPP systems. These signalling flows provide as example detailed
information on Network Discovery and Selection aspects involving the use of
ANDSF.
# A.2 Signalling flow for inter-system change between 3GPP access network and
non-3GPP access network
Figure A1 below shows an inter-system change procedure between 3GPP access
network and non-3GPP access network using information obtained from ANDSF.
In this example the UE uses DHCP query to obtain the IP address of the ANDSF.
In this example flow, the communication between the UE and ANDSF does not
imply use of any specific protocol.
The steps involved in inter-system change between 3GPP access network and
non-3GPP access network are as follows.
Figure A1. Procedure for Inter-system change between 3GPP access and non-3GPP
using ANDSF
**1\. Initial connectivity**
The UE is connected to 3GPP network. The current applications are supported
over the 3GPP access network.
NOTE: The procedure remains the same if the UE is initially connected to
non-3GPP access network and wants to change to 3GPP access network.
**2\. Pre-provisioned policies**
The inter-system mobility policy is pre-provisioned on the UE. Based on pre-
provisioned operator policies the UE has preference for different non-3GPP
networks such as WLAN, and WiMAX. The UE can select these access networks when
they are available.
**3\. ANDSF Discovery**
ANDSF discovery is performed as described in clause 6.8.2.2.1. The UE can
discover ANDSF using DHCP query options as specified in IETF RFC 6153 [37],
where ANDSF may be identified with a specific sub-option code. Optionally, the
home operator can use OMA-DM\'s bootstrap mechanism as specified in OMA-ERELD-
DM-V1_2 [39] to provide ANDSF information and security parameters for
application layer authentication. Transport security is ensured by
establishing an https tunnel between the UE and ANDSF,
**4\. Policy Update based on Network Triggers**
Based on network triggers the ANDSF sends an updated inter-system mobility
policy to the UE. The inter-system mobility policy includes validity
conditions, i.e. conditions indicating when the policy is valid. Such
conditions can include time duration, location area, etc.
**5\. Evaluate which non-3GPP networks to discover**
The inter-system mobility policies specify the access networks that the UE can
select; the UE has both WLAN and WiMAX radios. In this case, the inter-system
mobility policy provided by the operator allows the UE to select either WLAN
or WiMAX networks under all conditions. The UE, taking into account of the
UE\'s local policy, e.g. user preference settings, access history, obtains
information about availability of both WLAN and WiMAX access networks in its
vicinity.
**6\. Access Network Information Request**
The UE sends a request to ANDSF to get information about available access
networks. The UE also includes its location information in the request. ANDSF
can limit the information sent to UE based on internal settings.
**7\. Access Network Information Response**
The ANDSF sends a response to the UE which includes the list of available
access networks types (in order of operator preferences), access network
identifier and PLMN identifier. In this case the ANDSF responds with
availability of both WLAN and WiMAX network in the vicinity of the UE.
**8\. Evaluate candidate non-3GPP networks**
Based on the received information and UE\'s local policy, the UE evaluates if
it is within the coverage area of the available access networks in the order
of preferences. In this case,based on the history and radio quality of WiMAX,
the UE prefers WiMAX over WLAN access type. The UE powers on the WiMAX radio
and checks for the presence of WiMAX network. The UE can listen to WiMAX
broadcast messages (uplink/downlink channel data messages) and determines the
presence of WiMAX network. Since the WiMAX network is the preferred network
and since the UE has verified the presence of WiMAX network, the UE does not
check for presence of WLAN network.
**9\. Non-3GPP Network Selection**
The UE selects the most preferred available access network for inter-system
mobility. In this case the UE selects the WiMAX access network.
**10\. Inter-system change Procedure**
The UE initiates inter-system change procedure to the selected non-3GPP access
network. The details of the inter-system change procedure are described
elsewhere, see 3GPP TS 23.402 [6].
###### ## Annex B (informative): Assignment of Access Network Identities in
3GPP
This annex describes the recommended assignment procedure of Access Network
Identities within 3GPP.
# B.1 Access Network Identities
According to 3GPP TS 23.003 [3] the encoding of the Access Network Identity is
specified within 3GPP, but the Access Network Identity definition for each
non-3GPP access network is under the responsibility of the corresponding
standardisation organisation respectively.
If a standardisation organisation for a non-3GPP access network determines
they need to define a new Access Network Identity Prefix or additional ANID
strings, they can contact the 3GPP TSG-CT WG 1 via a Liaison Statement and
indicate the specific values of the Access Network Identity Prefixes or the
specific values of, or construction principles for, the additional ANID
strings to be specified by 3GPP and give reference to the corresponding
specification(s) of the requesting organisation. 3GPP TSG CT WG 1 will then
specify the values for the Access Network Identities by updating Table 8.1.1.2
in this specification and inform the requesting standardisation organisation.
###### ## Annex C (informative): Example usage of ANDSF
# C.1 Scope of ANDSF Example
This Annex gives an example of organization of ANDSF database and how it can
be used to discover access network information. In this example the UE is in
3GPP network and is trying to discover available WiMAX networks. The ANDSF
database is provided by the 3GPP operator with PLMN = PLMN_3GPP.
# C.2 Organization of ANDSF Coverage Map for WiMAX Network discovery
Table C1 illustrates the organization of ANDSF database for discovering WiMAX
and WiFi networks. The ANDSF database provides the coverage mapping
information for WiMAX and WiFi networks based on 3GPP cell identifiers. In
this example the UE_Location can be specified either in terms of 3GPP
parameters (PLMN + Cell Identifier) or in terms of geo spatial co-ordinates.
Table C1: ANDSF Database Organization for PLMN = PLMN_3GPP
+--------------------+---------------------+---------------------------+ | UE_Location | AccessType = WiMAX | AccessType = WiFi | | | | | | - 3GPP (CellId) | | | | | | | | - Other (Geopriv) | | | +====================+=====================+===========================+ | Locn_1 | NSP-ID= NSP_1: | SSID = WiFi1, BSSID = BS1 | | | | | | Cell_Id = Cell_1 | -NAP_ID = NAP_1 | SSID = WiFi2, BSSID = BS2 | | | | | | | -NAP_ID = NAP_2 | | | | | | | | NSP-ID = NSP_2 | | | | | | | | -NAP_ID = NAP_2 | | | | | | | | -NAP_ID = NAP_3 | | +--------------------+---------------------+---------------------------+ | Locn_2 | NSP-ID = NSP_2 | N/A | | | | | | Cell_Id = Cell_2 | - NAP_ID = NAP_3 | | +--------------------+---------------------+---------------------------+ | Locn_3 | N/A | SSID = WiFi1, BSSID = BS3 | | | | | | Cell_Id = Cell_3 | | SSID = WiFi4, BSSID = BS4 | +--------------------+---------------------+---------------------------+ | ..... | ....... | ....... | +--------------------+---------------------+---------------------------+ | Locn_n | NSP-ID = NSP_1 | SSID = WiFi6, BSSID = BS5 | | | | | | Cell_Id = Cell_n | NAP_ID = NAP_2 | | +--------------------+---------------------+---------------------------+
For WiMAX network the database provides information about WiMAX NSP and NAP
that provide coverage in respective 3GPP cells. Thus for example in 3GPP
Cell_1, WiMAX Service provider NSP_1 provides service to WiMAX radio access
providers NAP_1 and NAP-2. Similarly WiMAX Service Provider NSP_2 provides
service to Network access providers NAP-2 and NAP_3 as well. Similarly in 3GPP
Cell_2 WiMAX Network Service Provider NSP_2 provides service to network Access
Provider NAP_3. Further it can be seen that no WiMAX coverage is available in
3GPP cell Cell_3.
# C.3 Parameters in Pull mode
The UE is currently in 3GPP network. The UE sends a query to OMA ANDSF server
as follows:
ANDSF_Query ( UE_Location, AccessNetworkType=WiMAX )
The UE specifies the UE_Location information in terms of current 3GPP Cell Id
(e.g. Cell_2)
On receipt of the query message the ANDSF looks up the UE_Location (Cell_2) in
the ANDSF database and searches for a prospective WiMAX entry. In this case
the ANDSF retrieves WiMAX Service provider identifier (NSP-ID) NSP_2 and WiMAX
Network Access Provider Identifier (NAP-ID) NAP_3. The ANDSF retrieves the
network parameters for this combination. The ANDSF fills these parameters in
the WNDS MO and sends the information back to the UE.
ANDSF_Response ( UE_Location, AccessNetworkInformationRef MO=WIMAXNDS).
###### ## Annex D (informative): Mismatch of static configuration of mobility
mechanism in the UE and in the network
This annex describes the possible cases of mismatch between the statically
configured mobility mechanisms in the UE and in the EPC as shown in table D1.
Additionally the table shows whether the UE would be able to access EPC
services as a consequence of the mismatch.
Table D1: Mismatch of static configuration of mobility mechanism in the UE and
in the network
+----------------+----------------+----------------+----------------+ | | NBM configured | DSMIPv6 | MIPv4 | | | in the network | configured in | configured in | | | | the network | the network | +----------------+----------------+----------------+----------------+ | NBM configured | No mismatch | Mismatch. The | Mismatch. The | | in the UE | | UE is not able | UE is not able | | | | to access EPC | to access EPC | | | | services | services | | | | because the UE | because the UE | | | | configures a | does not | | | | local IP | support | | | | address and | communication | | | | there is no | with the | | | | connectivity | Foreign Agent | | | | to the PGW in | in the trusted | | | | the EPC. | non-3GPP IP | | | | Depending on | access | | | | operator\'s | network. | | | | policy and | | | | | roaming | | | | | agreements, | | | | | local IP | | | | | access | | | | | services (e.g. | | | | | Internet | | | | | access) can be | | | | | provided in | | | | | the non-3GPP | | | | | network using | | | | | the local IP | | | | | address. | | | | | However, such | | | | | local IP | | | | | access | | | | | services, | | | | | where the user | | | | | traffic does | | | | | not traverse | | | | | the EPC, are | | | | | not described | | | | | in this | | | | | specification. | | +----------------+----------------+----------------+----------------+ | DSMIPv6 | Mismatch. The | No mismatch | Mismatch. The | | configured in | UE can be able | | UE is not able | | the UE | to access EPC | | to access EPC | | | services. | | services | | | After attach | | because the UE | | | to the | | does not | | | non-3GPP | | support | | | network, the | | communication | | | UE is on the | | with the | | | home link and | | Foreign Agent | | | configures an | | in the trusted | | | IP address | | non-3GPP IP | | | based on the | | access | | | HNP, however | | network. | | | in some cases | | | | | the UE cannot | | | | | detect the | | | | | home link. | | | | | Since the UE | | | | | is configured | | | | | with DSMIPv6, | | | | | the UE would | | | | | initiate a | | | | | DSMIPv6 | | | | | bootstrapping: | | | | | | | | | | - If the | | | | | network offers | | | | | a HA function | | | | | to the UE and | | | | | if the | | | | | bootstrapping | | | | | is successful, | | | | | the UE detects | | | | | that it is | | | | | attached to | | | | | the home link. | | | | | Depending of | | | | | the UE | | | | | capabilities | | | | | and the | | | | | network | | | | | configuration, | | | | | the UE can | | | | | access EPC via | | | | | the S2a or | | | | | S2b, but | | | | | session | | | | | continuity is | | | | | not supported. | | | | | | | | | | - If the | | | | | network does | | | | | not offer a HA | | | | | function or if | | | | | the | | | | | bootstrapping | | | | | to the HA is | | | | | not | | | | | successful, | | | | | the UE is not | | | | | able to | | | | | receive its | | | | | Home Network | | | | | Prefix and | | | | | hence the UE | | | | | cannot detect | | | | | that it is on | | | | | the home link. | | | | | If no APN | | | | | bound to the | | | | | configured IP | | | | | address was | | | | | received and | | | | | the access | | | | | network does | | | | | not support | | | | | APN delivery, | | | | | the UE would | | | | | not recognize | | | | | the mismatch | | | | | and cannot | | | | | access EPC | | | | | services. If | | | | | the access | | | | | network | | | | | supports APN | | | | | delivery and | | | | | the configured | | | | | IP address is | | | | | bound to an | | | | | APN, the UE | | | | | can access EPC | | | | | services. | | | +----------------+----------------+----------------+----------------+ | MIPv4 | Mismatch. The | Mismatch. The | No mismatch | | configured in | UE is not able | UE is not able | | | the UE | to access EPC | to access EPC | | | | services | services | | | | because no | because no | | | | Foreign Agent | Foreign Agent | | | | functionality | functionality | | | | is supported | is supported | | | | in the | in the | | | | non-3GPP | non-3GPP | | | | access | access | | | | network. | network. | | +----------------+----------------+----------------+----------------+
###### ## Annex E (informative): UE procedures based on preconfigured and
received information
The flow diagrams in figure E-1 and figure E-2 show examples of the procedures
that the UE can follow in order to establish a PDN connection based on
information available to the UE about the authentication method, received or
pre-configured access network trust relationship information or received or
preconfigured IP mobility mode selection information.
The following symbols are used:
AN_TRUST trust relationship between the non-3GPP access network and the 3GPP
EPC, considered to be applicable by the UE
IPMM IP mobility mode, considered applicable by the UE
Initially, at the entry to flow chart the UE has established contact with the
non-3GPP access network, but the UE does not know whether it is in a trusted
or untrusted non-3GPP IP access access network.
Figure E-1. Procedures to be followed by the UE depending on received and
preconfigured information - part 1
Figure E-2. Procedures to be followed by the UE depending on received and
preconfigured information - part 2
###### ## Annex F (Normative): Access to EPC via restrictive non-3GPP access
network
# F.1 General
This annex specifies protocol for access to EPC via restrictive non-3GPP
access network.
The procedures are specified for UE and ePDG. The UE may support the
procedures for access to EPC via restrictive non-3GPP access network. The ePDG
may support the procedures for access to EPC via restrictive non-3GPP access
network.
# F.2 UE -- EPC network protocols
## F.2.1 General
In order to access to EPC via restrictive non-3GPP access network, the UE and
the ePDG shall establish a firewall traversal tunnel (FTT) using the UE
requested FTT establishment procedure according to clause F.2.2. Once the FTT
is established, the UE shall _initiate establishment of an IPSec tunnel via
an_ IKEv2 protocol exchange according to IETF RFC 7296 [28].
The UE and the ePDG shall construct the IKEv2 messages according to clause 7
and according to clause F.2.3.
The UE and the ePDG shall send the IKEv2 messages using the IKEv2 message
transport procedure according to clause F.2.2.3.
The UE and the ePDG shall send the encapsulating security payloads using the
encapsulating security payload transport procedure according to clause
F.2.2.4.
If the UE has not sent a message over the FTT in the last FTT KAT seconds, the
UE shall perform the UE requested keep-alive procedure according to clause
F.2.2.5.
When all IKEv2 security associations are closed, the UE shall perform the UE
requested FTT release procedure according to clause F.2.2.6.
When all IKEv2 security associations are closed, the network can perform the
network requested FTT release procedure according to clause F.2.2.7.
## F.2.2 FTT protocol
### F.2.2.1 General
The FTT protocol consists of the UE requested FTT establishment procedure, the
IKEv2 message transport procedure, the encapsulating security payload
transport procedure, the UE requested keep-alive procedure, the UE requested
FTT release procedure and the network requested FTT release procedure.
### F.2.2.2 UE requested FTT establishment procedure
#### F.2.2.2.1 General
The purpose of the UE requested FTT establishment procedure is to establish an
FTT between the UE and the ePDG.
#### F.2.2.2.2 UE requested FTT establishment procedure initiation
If the UE is not configured with an HTTP proxy address, the UE shall follow
the procedures in clause F.2.2.2.3 _._
If the UE is configured with an HTTP proxy address, the UE shall follow the
procedures in clause F.2.2.2.4 _._
_NOTE: UE configuration of an_ HTTP proxy address is out of scope of 3GPP.
#### F.2.2.2.3 UE requested FTT establishment procedure initiation via
restrictive non-3GPP access network type I
In order to establish an FTT, the UE shall establish a TCP connection _to the
ePDG address and destination port 443._
If the TCP connection establishment is successful, the UE shall establish a
TLS connection over the TCP connection according to the TLS profile specified
in 3GPP TS 33.310 [65] annex E _. If the ePDG address is a FQDN, the UE shall
include a TLS extension of type \"server_name\" in the TLS client hello
message according to_ the TLS profile specified in 3GPP TS 33.310 [65] annex E
_._
_T_ he ePDG shall handle the TCP connection setup and shall handle the TLS
connection establishment according to the TLS profile specified in 3GPP TS
33.310 [65] annex E _._
#### F.2.2.2.4 UE requested FTT establishment procedure initiation via
restrictive non-3GPP access network type II
If the UE is configured with HTTP proxy address, in order to establish an FTT,
the UE shall send HTTP CONNECT request to the HTTP proxy address according to
IETF RFC 2817  _[53]_. The UE shall populate Request-URI of the HTTP CONNECT
request with the ePDG address and port 443.
_Upon receiving HTTP 2xx response to HTTP CONNECT request, the UE shall
establish_ TLS connection according to the TLS profile specified in 3GPP TS
33.310 [65] annex E _over the TCP connection used for the HTTP CONNECT request
transport. If the ePDG address is a FQDN, the UE shall include a TLS extension
of type \"server_name\" in the TLS client hello message according to_ the TLS
profile specified in 3GPP TS 33.310 [65] annex E _._
_T_ he ePDG shall handle the TCP connection setup and the TLS connection
establishment according to the TLS profile specified in 3GPP TS 33.310 [65]
annex E _._
#### F.2.2.2.5 UE requested FTT establishment procedure _accepted by the
network_
_When TLS Finished message is sent over the TCP connection according to_ the
TLS profile specified in 3GPP TS 33.310 [65] annex E _, the ePDG shall use the
connection as the FTT._
_When valid TLS Finished message is received over the TCP connection, the UE
shall use the connection as the FTT._
### F.2.2.3 IKEv2 message transport procedure
#### F.2.2.3.1 General
The purpose of the IKEv2 message transport procedure is to transport an IKEv2
message over an FTT.
#### F.2.2.3.2 IKEv2 message transport procedure initiation
In order to send an IKEv2 message, the UE or the ePDG shall create an IKEv2
envelope as described in clause F.3.2.2, shall populate the Non-ESP marker
field with zero value and shall populate the IKEv2 message field of the IKEv2
envelope with the IKEv2 message.
The UE shall send the IKEv2 envelope as TLS application data according to the
TLS profile specified in 3GPP TS 33.310 [65] annex E _:_
\- if the IKEv2 message is an IKEv2 request, over an FTT of the UE; and
\- if the IKEv2 message is an IKEv2 response of an IKEv2 request, over the FTT
over which the IKEv2 request was received.
The ePDG shall send the IKEv2 envelope as TLS application data according to
the TLS profile specified in 3GPP TS 33.310 [65] annex E _:_
\- if the IKEv2 message is an IKEv2 request of an IKEv2 security association,
over the FTT associated with the IKEv2 security association; and
\- if the IKEv2 message is an IKEv2 response of an IKEv2 request, over the FTT
over which the IKEv2 request was received.
#### F.2.2.3.3 IKEv2 message transport procedure accepted
Upon receiving the IKEv2 envelope as TLS application data over the FTT, the
ePDG or the UE shall extract the IKEv2 message from the IKEv2 envelope as
described in clause F.3.2.2 and shall handle it according to IETF RFC 7296
_[28]._ If the IKEv2 message is a validated IKEv2 packet, the ePDG shall
associate the FTT with the IKEv2 security association of the validated packet
(replacing any FTT previously associated with the IKEv2 security association).
### F.2.2.4 Encapsulating security payload transport procedure
#### F.2.2.4.1 General
The purpose of the encapsulating security payload transport procedure is to
transport an encapsulating security payload over an FTT.
#### F.2.2.4.2 Encapsulating security payload transport initiation
In order to send an encapsulating security payload, the UE or the ePDG shall
create a ESP envelope as described in clause F.3.2.3 and shall populate the
ESP message field of the ESP envelope with the encapsulating security payload.
The UE shall send the ESP envelope as TLS application data according to the
TLS profile specified in 3GPP TS 33.310 [65] annex E _over an FTT of the UE._
The ePDG shall send the ESP envelope as TLS application data according to the
TLS profile specified in 3GPP TS 33.310 [65] annex E _over_ the FTT associated
with the IKEv2 security association which established the child security
association of the encapsulating security payload.
#### F.2.2.4.3 Encapsulating security payload transport accepted
Upon receiving the ESP envelope over the FTT, the ePDG or the UE shall extract
the encapsulating security payload from the ESP envelope as described in
clause F.3.2.3 and shall handle it according to IETF RFC 4303  _[32]._
### F.2.2.5 UE requested keep-alive procedure
#### F.2.2.5.1 General
The purpose of the UE requested keep-alive procedure is to refresh binding in
firewall (possibly including NAT) deployed between the restrictive non-3GPP
access network and the EPC.
#### F.2.2.5.2 UE requested keep-alive procedure initiation
In order to send a keep-alive, the UE shall create a keep-alive envelope as
described in clause F.3.2.4.
The UE shall send the keep-alive envelope as TLS application data according to
the TLS profile specified in 3GPP TS 33.310 [65] annex E _over an FTT of the
UE._
#### F.2.2.5.3 UE requested keep-alive procedure _accepted by the network_
The ePDG shall discard any keep-alive envelope received over the FTT.
### F.2.2.6 UE requested FTT release procedure
#### F.2.2.6.1 General
The purpose of the UE requested FTT release procedure is to release an FTT
when all IKEv2 security associations are closed.
#### F.2.2.6.2 UE requested FTT release procedure initiation
In order to release the FTT, the UE shall send TLS close_notify alert
according to the TLS profile specified in 3GPP TS 33.310 [65] annex E _._
#### F.2.2.6.3 UE requested FTT release procedure _accepted by the network_
_T_ he ePDG shall handle the TLS close_notify alert according to the TLS
profile specified in 3GPP TS 33.310 [65] annex E _._
### F.2.2.7 Network requested FTT release procedure
#### F.2.2.7.1 General
The purpose of the network requested FTT release procedure is to release an
FTT when all IKEv2 security associations are closed.
#### F.2.2.7.2 Network requested FTT release procedure initiation
In order to release the FTT, the ePDG shall send TLS close_notify alert
according to the TLS profile specified in 3GPP TS 33.310 [r33310] annex E _._
#### F.2.2.7.3 Network requested FTT release procedure _accepted by the UE_
_T_ he UE shall handle the TLS close_notify alert according to the TLS profile
specified in 3GPP TS 33.310 [65] annex E _._
## F.2.3 Additional IKEv2 procedures when FTT is used
### F.2.3.1 FTT KAT negotiation during tunnel establishment
_The UE shall include the FTT_KAT configuration attribute according to clause_
_F.3.3.1 in the IKEv2 CFG_REQUEST configuration payload of the IKE_AUTH
request message sent via FTT._
_If the FTT_KAT configuration attribute is included in the IKEv2 CFG_REQUEST
configuration payload, ePDG shall include the FTT_KAT configuration attribute
according to clause_  _F.3.3.1 in the IKEv2 CFG_REPLY configuration payload._
_If the FTT_KAT configuration attribute is not included in the IKEv2 CFG_REPLY
configuration payload, the UE shall determine the firewall traversal tunnel
keep-alive time (FTT KAT) as a random number uniformly distributed between
lower bound and higher bound. The default value for lower bound is 672 seconds
and the default value for higher bound is 840 seconds._
_If the FTT_KAT configuration attribute is included in the IKEv2 CFG_REPLY
configuration payload, the UE shall set the FTT KAT to the value of the Keep-
alive time field of the FTT_KAT configuration attribute._
# F.3 PDUs and parameters specific to the present annex
## F.3.1 Void
## F.3.2 Message types of FTT messages
### F.3.2.1 Generic FTT envelope
Generic FTT envelope is coded according to figure F.3.2.1-1 and table
F.3.2.1-1.
+---------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=========+=========+===+===+===+===+===+===+===+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +---------+---------+---+---+---+---+---+---+---+ | Payload | octet 3 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +---------+---------+---+---+---+---+---+---+---+
Figure F.3.2.1-1: Generic FTT envelope
Table F.3.2.1-1: Generic FTT envelope
Length field is in the octet 1 and the octet 2. The Length field indicates the
length of the generic FTT envelope in octets.
* * *
Payload field is in octets starting from octet 3 and its value depends on the
message type.
### F.3.2.2 IKEv2 envelope
IKEv2 envelope is coded according to figure F.3.2.2-1 and table F.3.2.2-1.
+----------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +================+=========+===+===+===+===+===+===+===+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +----------------+---------+---+---+---+---+---+---+---+ | Non-ESP marker | octet 3 | | | | | | | | | | | | | | | | | | | | octet 6 | | | | | | | | +----------------+---------+---+---+---+---+---+---+---+ | IKEv2 message | octet 7 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +----------------+---------+---+---+---+---+---+---+---+
Figure F.3.2.2-1: IKEv2 envelope
Table F.3.2.2-1: IKEv2 envelope
Length field is described in clause F.3.2.1. The Length field value is bigger
than 6.
* * *
Non-ESP marker field is in the octet 3, the octet 4, the octet 5 and the octet
6. The Non-ESP marker field value is zero. IKEv2 message field is in octets
starting from octet 7. The IKEv2 message contains the IKEv2 message as defined
in IETF RFC 7296  _[_ 28 _], section_  _3.1 in format as for transmission from
UDP port 500_.
### F.3.2.3 ESP envelope
ESP envelope is coded according to figure F.3.2.3-1 and table F.3.2.3-1.
+-------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=============+=========+===+===+===+===+===+===+===+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +-------------+---------+---+---+---+---+---+---+---+ | ESP message | octet 3 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-------------+---------+---+---+---+---+---+---+---+
Figure F.3.2.3-1: ESP envelope
Table F.3.2.3-1: ESP envelope
Length field is described in clause F.3.2.1. The Length field value is bigger
than 6.
* * *
ESP message field is in octets starting from octet 3. The ESP message contains
the encapsulating security payload as defined in IETF RFC 4303 [32], section
2. The SPI field in the ESP header is not a zero value.
### F.3.2.4 Keep-alive envelope
Keep-alive envelope is coded according to figure F.3.2.4-1 and table
F.3.2.4-1.
+--------------------+---------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +====================+=========+===+===+===+===+===+===+===+ | Length | octet 1 | | | | | | | | | | | | | | | | | | | | octet 2 | | | | | | | | +--------------------+---------+---+---+---+---+---+---+---+ | Keep-alive payload | octet 3 | | | | | | | | +--------------------+---------+---+---+---+---+---+---+---+
Figure F.3.2.4-1: keep-alive envelope
Table F.3.2.4-1: keep-alive envelope
Length field is described in clause F.3.2.1. The Length field value is 3.
* * *
Keep-alive payload field is in octet 3. The Keep-alive payload field value is
255.
## F.3.3 IKEv2 configuration attributes
### F.3.3.1 FTT_KAT configuration attribute
The FTT_KAT configuration attribute is coded according to figure F.3.3.1-1 and
table F.3.3.1-1.
Bits
* * *
7 6 5 4 3 2 1 0 Octets R Attribute type 1  
Attribute type 2  
Length 3 - 4  
Keep alive time 5 - 6
Figure F.3.3.1-1: FTT_KAT configuration attribute
Table F.3.3.1-1: FTT_KAT configuration attribute
R field is defined in IETF RFC 7296 [28].
* * *
Attribute type field has value 22. Length field is defined in IETF RFC 7296
[28]. When FTT_KAT configuration attribute is included in the CFG_REQUEST
configuration payload of IKEv2 security association, packets of which are
transported via FTT, the Keep-alive time field indicates preferred maximum
time in seconds between two envelopes (any of those described in clause F.3.2)
sent via FTT. When FTT_KAT configuration attribute is included in the
CFG_REPLY configuration payload of IKEv2 security association, packets of
which are transported via FTT, the Keep-alive time field indicates actual
maximum time in seconds between two envelopes (any of those described in
clause F.3.2) sent via FTT.
###### ## Annex G (Informative): IANA registrations
# G.1 General
This annex contains information needed for registrations with IANA.
# G.2 EAP-AKA attributes
## G.2.1 General
This clause contains information needed for registrations of EAP-AKA
attributes with IANA.
## G.2.2 AT_TWAN_CONN_MODE EAP-AKA attribute
In order to register the AT_TWAN_CONN_MODE attribute, the following
information will be inserted in form at http://www.iana.org/cgi-
bin/assignments.pl:
Contact name:
\
Contact Email:
\
What type of assignment/registration are you requesting?
New item in the \"Attribute Types (Skippable Attributes 128-255)\" of the
\"EAP-AKA and EAP-SIM Parameters\" as shown at
http://www.iana.org/assignments/eapsimaka-numbers/eapsimaka-
numbers.xml#eapsimaka-numbers-3 and as specified in RFC 4187.
Which registry are you requesting this assignment/registration be made in?
The \"Attribute Types (Skippable Attributes 128-255)\" of the \"EAP-AKA and
EAP-SIM Parameters\" as shown at http://www.iana.org/assignments/eapsimaka-
numbers/eapsimaka-numbers.xml#eapsimaka-numbers-3 and as specified in RFC
4187.
If possible, please give a brief description of why you need this
assignment/registration:
Further information needs to be provided during authentication using EAP-
AKA\'.
Additional Information. Please include a reference to the specification or RFC
(if available) that defines this number or name space:
RFC 4187 defines the registry for the \"Attribute Types (Skippable Attributes
128-255)\" of the \"EAP-AKA and EAP-SIM Parameters\".
The following attribute is requested to be registered:
\- numbering space: EAP-AKA and EAP-SIM Parameters, Attribute Types (Skippable
Attributes 128-255)
\- attribute description: AT_TWAN_CONN_MODE
\- reference to specification where the attribute is described:
http://www.3gpp.org/ftp/Specs/html-info/24302.htm
\- attribute type: (number to be assigned by IANA)
## G.2.3 AT_DEVICE_IDENTITY EAP-AKA attribute
In order to register the AT_DEVICE_IDENTITY attribute, the following
information will be inserted in form at http://www.iana.org/cgi-
bin/assignments.pl:
Contact name:
\
Contact Email:
\
What type of assignment/registration are you requesting?
New item in the \"Attribute Types (Skippable Attributes 128-255)\" of the
\"EAP-AKA and EAP-SIM Parameters\" as shown at
http://www.iana.org/assignments/eapsimaka-numbers/eapsimaka-
numbers.xml#eapsimaka-numbers-3 and as specified in RFC 4187.
Which registry are you requesting this assignment/registration be made in?
The \"Attribute Types (Skippable Attributes 128-255)\" of the \"EAP-AKA and
EAP-SIM Parameters\" as shown at http://www.iana.org/assignments/eapsimaka-
numbers/eapsimaka-numbers.xml#eapsimaka-numbers-3 and as specified in RFC
4187.
If possible, please give a brief description of why you need this
assignment/registration:
Further information needs to be provided during authentication using EAP-
AKA\'.
Additional Information. Please include a reference to the specification or RFC
(if available) that defines this number or name space:
RFC 4187 defines the registry for the \"Attribute Types (Skippable Attributes
128-255)\" of the \"EAP-AKA and EAP-SIM Parameters\".
The following attribute is requested to be registered:
\- numbering space: EAP-AKA and EAP-SIM Parameters, Attribute Types (Skippable
Attributes 128-255)
\- attribute description: AT_DEVICE_IDENTITY
\- reference to specification where the attribute is described:
http://www.3gpp.org/ftp/Specs/html-info/24302.htm
\- attribute type: (number to be assigned by IANA)
# G.3 IKEv2 configuration attributes
## G.3.1 General
This clause contains information needed for registrations of IKEv2
configuration attributes with IANA.
## G.3.2 TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute
In order to register the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK IKEv2 attribute,
the following information will be inserted in form at http://www.iana.org/cgi-
bin/assignments.pl:
Contact name:
\
Contact Email:
\
What type of assignment/registration are you requesting?
New item in the \"IKEv2 Configuration Payload Attribute Types\" of the
\"Internet Key Exchange Version 2 (IKEv2) Parameters\" as shown at
http://www.iana.org/assignments/ikev2-parameters/ikev2-parameters.xhtml#ikev2-parameters-21
and as specified in IETF RFC 4306 [70A] and updated by IETF RFC 7296 [28] and
IETF RFC 7296 [70B].
Which registry are you requesting this assignment/registration be made in?
The \"IKEv2 Configuration Payload Attribute Types\" of the \"Internet Key
Exchange Version 2 (IKEv2) Parameters\" as shown at
http://www.iana.org/assignments/ikev2-parameters/ikev2-parameters.xhtml#ikev2-parameters-21
and as specified in IETF RFC 4306 [70A] and updated by IETF RFC 7296 [28] and
IETF RFC 7296 [70B].
If possible, please give a brief description of why you need this
assignment/registration:
This IKEv2 attribute is used to provide configuration for performing the
liveness checks.
Additional Information. Please include a reference to the specification or RFC
(if available) that defines this number or name space:
IETF RFC 4306 [70A] defines the registry for the \"IKEv2 Configuration Payload
Attribute Types\". IETF RFC 7296 [70B] and IETF RFC 7296 [28] refer to IETF
RFC 4306 for the definition of the registry.
The following attribute is requested to be registered:
\- value: (number to be assigned by IANA)
\- attribute type: TIMEOUT_PERIOD_FOR_LIVENESS_CHECK
\- multi-valued: no
\- length: 4 octets
\- reference: http://www.3gpp.org/ftp/Specs/html-info/24302.htm
###### ## Annex H (normative): Definition of generic container for ANQP
payload
# H.1 General
This clause describes the structure and contents of the generic container used
as the payload in the 3GPP Cellular Network ANQP-element specified in IEEE Std
802.11 [57].
# H.2 General structure
## H.2.1 Structure
The general structure of the generic container is shown in figure H.2.1-1.
+----------------------------+-------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +----------------------------+-------------+---+---+---+---+---+---+---+ | GUD | octet 1 | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | UDHL | octet 2 | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | IEI 1 | octet 3 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | | | | | | | | | | | | | octet i | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Length of contents of IE 1 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Contents of IE 1 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | IEI 2 | octet i+1* | | | | | | | | | | | | | | | | | | | | octet i+2 | | | | | | | | | | | | | | | | | | | | octet l | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Length of contents of IE 2 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Contents of IE 2 | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | ......... | octet l+1* | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | IEI q | octet m+1* | | | | | | | | | | | | | | | | | | | | octet m+2 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Length of contents of IE q | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+ | Contents of IE q | | | | | | | | | +----------------------------+-------------+---+---+---+---+---+---+---+
Figure H.2.1-1 -- Structure of IEEE Std 802.11 Generic Container
## H.2.2 Generic container User Data (GUD)
Indicates the protocol version of the generic container
00000000 Version 1
00000001
To
11111111 Reserved
## H.2.3 User Data Header Length (UDHL)
Indicates the number of octets in the generic container after the UDHL. This
indication is encoded in binary format.
## H.2.4 Information Elements
### H.2.4.1 Information Element Identity (IEI)
Indicates the information element identity. The following values for IEI are
defined in this version of the specification:
00000000 PLMN List
00000001 PLMN List with S2a connectivity
00000010 PLMN List with trusted 5G connectivity
00000011 PLMN List with trusted 5G connectivity-without-NAS
00000100 PLMN List with AAA connectivity to 5GC
00000101
To
00011111 Reserved
00100000 SNPN List with trusted 5G connectivity
00100001 SNPN List with AAA connectivity to 5GC
00100010 SNPN List with trusted 5G connectivity-without-NAS
00100011
To
11111111 Reserved
### H.2.4.2 PLMN List IE
The PLMN List information element is used by a WLAN to indicate the PLMNs, for
which the WLAN supports AAA connectivity to EPC, see clause 6.3.12.1 in 3GPP
TS 23.501 [6A]. The format of the PLMN List information element coded
according to 3GPP TS 24.007 [48] clause 11.2.2.1 is shown in figure H.2.4.2-1.
+------------------------------------+------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +====================================+============+===+===+===+===+===+===+===+ | PLMN List IEI | octet 1 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+ | Length of PLMN List value contents | octet 2 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+ | PLMN List | octet 3 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet 3N+3 | | | | | | | | +------------------------------------+------------+---+---+---+---+---+---+---+
Figure H.2.4.2-1:  _PLMN List_ information element
+--------------------------+------------+---+---+---+---+---+---+---+ | | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +==========================+============+===+===+===+===+===+===+===+ | Number of PLMNs | octet 3 | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+ | PLMN information, PLMN 1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet 5 | | | | | | | | | | | | | | | | | | | | octet 6 | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+ | | | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+ | PLMN information, PLMN N | octet 3N+1 | | | | | | | | | | | | | | | | | | | | octet 3N+2 | | | | | | | | | | | | | | | | | | | | octet 3N+3 | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+
Figure H.2.4.2-1a:  _PLMN List_
The \"Number of PLMNs\" (octet 3) contains the number of PLMN information
items in the list. Bit 7 of octet 3 is the most significant bit and bit 0 of
octet 3 the least significant bit.
The format of the PLMN information item according to 3GPP TS 24.007 [48]
clause 112.2.1 is shown in figure H.2.4.2-2:
* * *
7 6 5 4 3 2 1 0  
MCC digit 2 MCC digit 1 octet X  
MNC digit 3 MCC digit 3 octet X+1  
MNC digit 2 MNC digit 1 octet X+2
* * *
Figure H.2.4.2-2:  _PLMN information_ item of the PLMN List
Table H.2.4.2-1 shows the coding of the MCC and MNC in the PLMN information
item.
Table H.2.4.2-1: _PLMN information_ item of PLMN List
+----------------------------------------------------------------------+ | **MCC** , Mobile country code (octet X, octet X+1 bits 1 to 4) | | | | The MCC field is coded as in ITU-T Rec. E212 [63], Annex A. | | | | **MNC** , Mobile network code (octet X+2, octet X+1 bits 5 to 8). | | | | The coding of this field is the responsibility of each | | administration but BCD coding shall be used. The MNC shall consist | | of 2 or 3 digits. For PCS 1900 for North America, Federal Regulation | | mandates that a 3-digit MNC shall be used. However a network | | operator may decide to use only two digits in the MNC over the radio | | interface. In this case, bits 5 to 8 of octet X+1 shall be coded as | | \"1111\". Mobile equipment shall accept MNC coded in such a way. | +----------------------------------------------------------------------+
### H.2.4.3 PLMN List with S2a connectivity IE
The PLMN List with S2a connectivity information element is used by the WLAN to
indicate the PLMNs to which the WLAN provides S2a connectivity.
The format of the PLMN List with S2a connectivity information element is shown
in Figure H.2.4.3-1.
+---------------------+------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=====================+============+===+===+===+===+===+===+===+ | PLMN List with S2a | octet 1 | | | | | | | | | connectivity IEI | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Length of PLMN List | octet 2 | | | | | | | | | with S2a | | | | | | | | | | connectivity value | | | | | | | | | | contents | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | PLMN List | octet 3 | | | | | | | | | | | | | | | | | | | | octet 3N+3 | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+
Figure H.2.4.3-1:  _PLMN List with S2a connectivity_ information element
The format of the PLMN List is identical to the format of the PLMN List
defined in figure H.2.4.2-1a.
### H.2.4.4 PLMN List with trusted 5G connectivity IE
The PLMN List with trusted 5G connectivity information element is used by the
WLAN to indicate the PLMNs for which the WLAN provides connectivity to a 5GCN,
using trusted non-3GPP access.
The format of the PLMN List with trusted 5G connectivity information element
is shown in Figure H.2.4.4-1.
+---------------------+------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=====================+============+===+===+===+===+===+===+===+ | PLMN List with | octet 1 | | | | | | | | | trusted 5G | | | | | | | | | | connectivity IEI | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Length of PLMN List | octet 2 | | | | | | | | | with trusted 5G | | | | | | | | | | connectivity value | | | | | | | | | | contents | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | PLMN List | octet 3 | | | | | | | | | | | | | | | | | | | | octet 3N+3 | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+
Figure H.2.4.4-1:  _PLMN List with trusted 5G connectivity_ information
element
### The format of the PLMN List is identical to the format of the PLMN List
defined in figure H.2.4.2-1a.
### H.2.4.5 PLMN List with trusted 5G connectivity-without-NAS IE
The PLMN List with trusted 5G connectivity-without-NAS information element is
used by the WLAN to indicate the PLMNs for which the WLAN provides
connectivity to a 5GCN, for devices without NAS capability, using trusted
non-3GPP access.
The format of the PLMN List with trusted 5G connectivity-without-NAS
information element is shown in Figure H.2.4.5-1.
+---------------------+------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=====================+============+===+===+===+===+===+===+===+ | PLMN List with | octet 1 | | | | | | | | | trusted 5G | | | | | | | | | | conne | | | | | | | | | | ctivity-without-NAS | | | | | | | | | | IEI | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Length of PLMN List | octet 2 | | | | | | | | | with trusted 5G | | | | | | | | | | conne | | | | | | | | | | ctivity-without-NAS | | | | | | | | | | value contents | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | PLMN List | octet 3 | | | | | | | | | | | | | | | | | | | | octet 3N+3 | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+
Figure H.2.4.5-1:  _PLMN List with trusted 5G connectivity-without-NAS_
information element
The format of the PLMN List is identical to the format of the PLMN List
defined in figure H.2.4.2-1a.
### H.2.4.6 PLMN List with AAA connectivity to 5GC IE
The PLMN List with AAA connectivity to 5GC information element is used by the
WLAN to indicate the PLMNs, which support NSWO in 5GS as specified in annex S
of 3GPP TS 33.501 [78], for a UE served by the WLAN.
The format of the PLMN List with AAA connectivity to 5GC information element
is shown in Figure H.2.4.6-1.
+---------------------+------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=====================+============+===+===+===+===+===+===+===+ | PLMN List with AAA | octet 1 | | | | | | | | | connectivity to 5GC | | | | | | | | | | IEI | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Length of PLMN List | octet 2 | | | | | | | | | with AAA | | | | | | | | | | connectivity value | | | | | | | | | | contents | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | PLMN List | octet 3 | | | | | | | | | | | | | | | | | | | | octet 3N+3 | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+
Figure H.2.4.6-1:  _PLMN List with AAA connectivity to 5GC_ information
element
The format of the PLMN List is identical to the format of the PLMN List
information element defined in figure H.2.4.2-1a.
### H.2.4.7 SNPN List with trusted 5G Connectivity IE
The SNPN List with trusted 5G Connectivity information element is used by the
network to indicate the SNPNs that can be selected from the WLAN. The SNPN
List with trusted 5G Connectivity information element optionally includes per
SNPN access information, per SNPN supported GINs, per SNPN human-readable
network name, and a GIN list. [ ]{.underline} The SNPN List with trusted 5G
Connectivity information element is type 6 information element of format TLV-E
according to 3GPP TS 24.007 [48] and is coded as shown in figure H.2.4.7-1,
figure H.2.4.7-2, figure H.2.4.7-3, figure H.2.4.7-4, figure H.2.4.7-5, figure
H.2.4.7-6, figure H.2.4.7-7, figure H.2.4.7-8, figure H.2.4.7-9, figure
H.2.4.7-10 and table H.2.4.7-1.
+---------------------+-------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=====================+=============+===+===+===+===+===+===+===+ | SNPN List with | octet 1 | | | | | | | | | trusted 5G | | | | | | | | | | Connectivity IEI | | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | Length of SNPN List | octet 2 | | | | | | | | | with trusted 5G | | | | | | | | | | Connectivity value | octet 3 | | | | | | | | | contents | | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | SNPN information | octet 4 | | | | | | | | | List | | | | | | | | | | | octet d | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | GIN list | octet d+1* | | | | | | | | | | | | | | | | | | | | octet Z* | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+
Figure H.2.4.7-1: SNPN List with trusted 5G Connectivity information element
+---------------------------------+-----------+-------------+ | Length of SNPN information list | octet 4 | | | | | | | | octet 5 | | +=================================+===========+=============+ | SNPN information entry 1 | octet 6 | | | | | | | | octet b | | +---------------------------------+-----------+-------------+ | | .. | octet b+1* | | | | | | | | octet c-1* | +---------------------------------+-----------+-------------+ | SNPN information entry N | octet c* | | | | | | | | octet d* | | +---------------------------------+-----------+-------------+
Figure H.2.4.7-2: SNPN information List
+----------------------------------+-------------+ | Length of SNPN information entry | octet 6 | | | | | | octet 7 | +==================================+=============+ | SNPN identity | octet 8 | | | | | | octet 16 | +----------------------------------+-------------+ | SNPN access information | octet 17* | | | | | | octet 18* | +----------------------------------+-------------+ | Supported GINs | octet 19* | | | | | | octet a* | +----------------------------------+-------------+ | Human-readable network name | octet a+1* | | | | | | octet b* | +----------------------------------+-------------+
Figure H.2.4.7-3: SNPN information entry
+-------------+-------------+----------+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=============+=============+==========+===+===+===+===+===+===+ | MCC digit 2 | MCC digit 1 | octet 8 | | | | | | | +-------------+-------------+----------+---+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet 9 | | | | | | | +-------------+-------------+----------+---+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet 10 | | | | | | | +-------------+-------------+----------+---+---+---+---+---+---+ | NID | octet 11 | | | | | | | | | | | | | | | | | | | | octet 16 | | | | | | | | +-------------+-------------+----------+---+---+---+---+---+---+
Figure H.2.4.7-4: SNPN identity
7 6 5 4 3 2 1 0
* * *
Length of SNPN access information octet 17  
Spare Spare Spare Spare Spare OB CHWC CH octet 18
Figure H.2.4.7-5: SNPN access information
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=======+=======+=======+=======+=======+=======+=======+=======+=======+ | L | octet | | | | | | | | | ength | 19 | | | | | | | | | of | | | | | | | | | | Supp | | | | | | | | | | orted | | | | | | | | | | GINs | | | | | | | | | | value | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | G(8) | G(7) | G(6) | G(5) | G(4) | G(3) | G(2) | G(1) | octet | | | | | | | | | | 20* | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | .. | octet | | | | | | | | | | 21* | | | | | | | | | | | | | | | | | | | | octet | | | | | | | | | | a-1* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | G(n) | G | G | G | G | G | G | G | octet | | | (n-1) | (n-2) | (n-3) | (n-4) | (n-5) | (n-6) | (n-7) | a* | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure H.2.4.7-6: Supported GINs
+---------------------------------------+-------------+ | Length of Human-readable network name | octet a+1 | +---------------------------------------+-------------+ | Human-readable network name value | octet a+2* | | | | | | octet b* | +---------------------------------------+-------------+
Figure H.2.4.7-6a: HRNN
+-------------------------+-------------+ | Length of GIN list | octet d+1 | | | | | | octet d+2 | +=========================+=============+ | GIN information entry 1 | octet d+3 | | | | | | octet e | +-------------------------+-------------+ | .. | octet e+1* | | | | | | octet f-1* | +-------------------------+-------------+ | GIN information entry N | octet f* | | | | | | octet Z* | +-------------------------+-------------+
Figure H.2.4.7-7: GIN list
+---------------------------------+-------------+-----------+---+---+---+---+---+ | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=================================+=============+===========+===+===+===+===+===+ | Length of GIN information entry | octet d+3 | | | | | | | | | | | | | | | | | | octet d+4 | | | | | | | +---------------------------------+-------------+-----------+---+---+---+---+---+ | MCC digit 2 | MCC digit 1 | octet d+5 | | | | | | +---------------------------------+-------------+-----------+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet d+6 | | | | | | +---------------------------------+-------------+-----------+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet d+7 | | | | | | +---------------------------------+-------------+-----------+---+---+---+---+---+ | NID list | octet d+8 | | | | | | | | | | | | | | | | | | octet e | | | | | | | +---------------------------------+-------------+-----------+---+---+---+---+---+
Figure H.2.4.7-8: GIN information entry
+--------------------+--------------+ | Length of NID list | octet d+8 | | | | | | octet d+9 | +====================+==============+ | NID identity 1 | octet d+10 | | | | | | octet d+15 | +--------------------+--------------+ | .. | octet d+16* | | | | | | octet e-1* | +--------------------+--------------+ | NID identity N | octet e* | | | | | | octet e+5* | +--------------------+--------------+
Figure H.2.4.7-9: NID list
+-----+------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=====+============+===+===+===+===+===+===+===+ | NID | octet d+10 | | | | | | | | | | | | | | | | | | | | octet d+15 | | | | | | | | +-----+------------+---+---+---+---+---+---+---+
Figure H.2.4.7-10: NID identity
Table H.2.4.7-1: SNPN List with trusted 5G Connectivity information element
+----------------------------------------------------------------------+ | SNPN List with trusted 5G Connectivity information element (octets 1 | | to Z) | +======================================================================+ | SNPN identity (octets 8 to 16) | | | | MCC (octet 8, octet 9 bits 0 to 3) or (octet d+5, octet d+6 bits 0 | | to 3) | | | | The MCC (Mobile country code) field is coded as in ITU-T | | Recommendation E.212 [63], Annex A | | | | MNC (octet 10, octet 9 bits 4 to 7) or (octet d+7, octet d+6 bits 4 | | to 7). | | | | The coding of the MNC (Mobile network code) field is the | | responsibility of each administration but BCD coding shall be used. | | The MNC shall consist of 2 or 3 digits. If a network operator | | decides to use only two digits in the MNC, bits 4 to 7 of octet 9 or | | octet d+6 shall be coded as \"1111\". | +----------------------------------------------------------------------+ | NID (octet 11 to octet 16) or (octet d+10 to octet d+15) | | | | NID field is coded as the NID field of NID IE as specified in | | figure 9.2.7-2 and table 9.2.7-2 of 3GPP TS 24.502 [77] starting | | with the octet 3 and ending with the octet 8. | | | | SNPN access information (octets 17 to 18) | | | | CH (octet 18 bit 0) | | | | This bit indicates whether the SNPN supports access using | | credentials from a credentials holder. | | | | 0 access using credentials from a credentials holder supported. | | | | 1 access using credentials from a credentials holder not supported. | | | | CHWC (octet 18 bit 1) | | | | This bit indicates whether the SNPN allows registration attempts | | **with** credentials from a credentials holder from UEs that are not | | explicitly configured to select the SNPN. | | | | 0 registration attempts from UEs without configuration to select the | | SNPN not allowed. | | | | 1 registration attempts from UEs without configuration to select the | | SNPN allowed. | | | | OB (octet 18 bit 2) | | | | This bit indicates whether the SNPN allows onboarding. | | | | 0 onboarding is not allowed. | | | | 1 onboarding is allowed. | | | | octet 18 bits 3 to 7 are spare. | +----------------------------------------------------------------------+ | Supported GINs value (octets 19 to b) | | | | G(1) to G(n) is a bitmap indicating whether the SNPN identity in the | | SNPN information entry supports a corresponding GIN in the GIN list. | | G(1) bit corresponds to GIN index value one in the GIN list, G(2) | | corresponds to GIN index value two in the GIN list and so on. A bit | | set to 1 indicates that the GIN is supported by the SNPN and a bit | | set to 0 indicates that the GIN is not supported by the SNPN. The | | length of the Supported GINs value field in octets is the ceiling of | | the number of GINs in the GIN list divided by 8. The filling bits, | | if any, are set to 0. | | | | Human-readable network name value (octets a+2 to b) | | | | Human-readable network name value contains a Human-readable network | | name encoded in UTF-8 format with variable number of bytes per | | character as specified in 3GPP TS 23.003 [3] clause 4.11. | +----------------------------------------------------------------------+ | GIN list (octets d+1 to Z) | | | | The GIN list contains one or more GIN information entries. Each GIN | | information entry contains either one GIN, which is identified by a | | PLMN ID (MCC, MNC) and a single NID (NID list with a single NID | | entry), or multiple GINs that share the same PLMN ID with each GIN | | identified by the shared PLMN ID and a NID entry in the NID list. | | The GIN index m is defined as d1+d2+...+d(n-1)+i for the GIN | | included in the n-th entry of the GIN list and the i-th entry of its | | corresponding GIN information entry, where d(k) is the number of GIN | | index values used in the k-th GIN information entry. | +----------------------------------------------------------------------+
### H.2.4.8 SNPN List with AAA connectivity to 5GC IE
The SNPN List with AAA connectivity to 5GC information element is used by the
WLAN to indicate the SNPNs that can provide UE authentication for NSWO in 5GS
as specified in annex S of 3GPP TS 33.501 [78].
The SNPN List with AAA 5G connectivity to 5GC information element is type 6
information element of format TLV-E according to 3GPP TS 24.007 [48] and is
coded as shown in figure H.2.4.X-1. The SNPN List with AAA connectivity to 5GC
information element optionally includes:
\- SNPN information list, containing the list of SNPNs and coded according to
figure H.2.4.7-2; and
\- GIN list, containing the list of GINs and coded according to figure
H.2.4.7-7.
+---------------------+-------------+---+---+---+---+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +=====================+=============+===+===+===+===+===+===+===+ | SNPN List with AAA | octet 1 | | | | | | | | | connectivity to 5GC | | | | | | | | | | IEI | | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | Length of SNPN List | octet 2 | | | | | | | | | with AAA | | | | | | | | | | connectivity to 5GC | octet 3 | | | | | | | | | value contents | | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | SNPN information | octet 4* | | | | | | | | | list | | | | | | | | | | | octet d* | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | GIN list | octet d+1* | | | | | | | | | | | | | | | | | | | | octet e* | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+
Figure H.2.4.9-1: SNPN List with AAA connectivity to 5GC information element
### H.2.4.9 SNPN List with trusted 5G Connectivity-without-NAS IE
The SNPN List with trusted 5G Connectivity-without-NAS information element is
used by the network to indicate the SNPNs for which the WLAN provides
connectivity to a 5GCN, for devices without NAS capability, that can be
selected from the WLAN. The format of the SNPN List with trusted 5G
Connectivity-without-NAS information element is identical to the format of the
SNPN List with trusted 5G Connectivity information element defined in clause
H.2.4.7.
###### ## Annex I (normative): Definition of the Emergency Call Number
field\'s contents
# I.1 General
The Emergency Call Number field is a variable-length UTF-8 (see RFC 3629 [34])
formatted field. The purpose of this field is to encode emergency call
number(s) for use within the country where the field is received.
This clause describes the formatting of the Emergency Call Number Unit field
used in the Emergency Call Number ANQP-element specified in IEEE Std 802.11
[57].
NOTE: According to IEEE Std 802.11 [57] an ANQP server is not necessarily
collocated with an AP. Where the TWAN provides access to multiple PLMNs, where
a PLMN has configured the TWAN to provide different emergency numbers compared
to another PLMN, it is an implementation option to ensure the Emergency Call
Number field includes the emergency numbers configured by the PLMN the UE
successfully authenticated and authorized with.
# I.2 Formatting
### I.2.1 General
For the purposes of aiding in detection of emergency call number and assigning
the emergency type, the Emergency Call Number Unit field can contain an
emergency call number and one or more emergency call labels.
The emergency call number and one or more emergency call labels shall be
encoded as a namespace specific string for the namespace identifier equal to
3gpp (see RFC 5279 [74]). This specification further defines the namespace
identifier equal to sos-anqp and parameters.
For the purposes of aiding in determining of the country where these local
emergency numbers were provided, the Emergency Call Number field contains the
MCC. The MCC represents the country in which the AP is located.
### I.2.2 ABNF for the urn:3gpp:sos-anqp namespace and its parameters
Table I.2.2-1 contains the ABNF (RCF 2234 [73]) for the urn:3gpp:sos-anqp
namespace and its parameters.
Table I.2.2-1: Syntax of urn:3gpp:sos-anqp
emergency-information = \"urn:3gpp:sos-anqp:\" mcc *(\":\" number 1*(\":\"
label ))
mcc = \"mcc\" DIGIT DIGIT (DIGIT) ; exactly 2 or 3 digits
label = \"sos\" *(\".\" sub-label)
number = DIGIT*DIGIT ; at least one DIGIT
sub-label = let-dig [ *let-dig-hyp let-dig ]
let-dig-hyp = let-dig / \"-\"
let-dig = ALPHA / DIGIT
ALPHA = %x41-5A / %x61-7A ; A-Z / a-z
NOTE: While the syntax of table I.2.2-1 allows for many different sub-labels
following \"sos\", when originating an emergency IMS session (see TS 24.229
[67]) based on detecting a match with dialed digits, the SIP INVITE will only
contain one of the following service URNs: \"urn:service:sos\",
\"urn:service:sos.police\", \"urn:service:sos.ambulance\",
\"urn:service:sos.fire\", \"urn:service:sos.marine\",
\"urn:service:sos.mountain\".
### I.2.3 Semantics
According to the ABNF in table I.2.2-1:
\- \"urn:3gpp:sos-anqp:mcc310\" is a valid expression: this expression
indicates to the UE to overwrite any previously received list with Local WLAN
emergency numbers with an empty list;
\- \"urn:3gpp:sos-anqp:mcc222:112:sos.police:sos.ambulance\" is a valid
expression: this expression indicates to the UE to that in the country with
MCC 222 the number 112 is an emergency number. The corresponding labels
sos.police and sos.ambulance are mapped in accordance with annex I.2.4.
### I.2.4 Mapping Emergency Call Number field\'s contents to the Local WLAN
Emergency Numbers List
When the Local WLAN Emergency Numbers List is to be encoded in the Local
Emergency Numbers List format as defined in 3GPP TS 24.008 [46], clause
10.5.3.13, the Emergency Call Number field\'s contents conforming to the ABNF
for the urn:3gpp:sos-anqp namespace shall be mapped. The Local WLAN Emergency
Numbers List for the PLMN with which the UE is connected via WLAN shall only
be used when the contents are considered valid (see clause 6.4.1).
The contents of the Emergency Call Number Unit field map to 4 bit encoded
number digits and 5 bit encoded Emergency Service Category Value as follows.
In addition to the rules in 3GPP TS 24.008 [46], the following mapping shall
apply for a URN with UTF-8 (see RFC 3629 [34]) digits in the mcc ABNF portion
that match the MCC of the PLMN with which the UE is connected via WLAN :
1) each UTF-8 digit in the emergency-number ABNF portion of the URN is
converted into a corresponding 4-bit number digit of a set of octets part of
an emergency number information; and
2) the label ABNF portion of the URN maps as follows:
\"sos\": does not set bits of the 5 bit encoded Emergency Service Category
Value of the emergency number information;
\"sos.police\": sets bit 1 (police) of the 5 bit encoded Emergency Service
Category Value of the emergency number information;
\"sos.ambulance\": sets bit 2 (ambulance) of the 5 bit encoded Emergency
Service Category Value of the emergency number information;
\"sos.fire\": sets bit 3 (fire brigade) of the 5 bit encoded Emergency Service
Category Value of the emergency number information;
\"sos.marine\": sets bit 4 (marine guard) of the 5 bit encoded Emergency
Service Category Value of the emergency number information;
\"sos.mountain\": sets bit 5 (mountain rescue) of the 5 bit encoded Emergency
Service Category Value of the emergency number information.
###### ## Annex J (normative): Emergency Call Numbers from DNS procedure
# J.1 General
This clause describes the retrieval of the Emergency Call Numbers field using
DNS procedures.
The UE performs this procedure with a DNS server only, if the DNS server
address is acquired from the ePDG using procedures in 3GPP TS 24.302 [156]
clause 7.2.2.1 and clause 7.4.1, contained in the CFG_REPLY Configuration
payload, and after mutual authentication of the UE and the network.
NOTE: The message carrying the emergency information is sent through the
established IPsec tunnel to the 3GPP network.
The related Country based Emergency Numbers FQDN is specified in 3GPP TS
23.003 [3].
# J.2 Retrieval of emergency call numbers
When a UE is connected to WLAN access, the UE may support the DNS mechanisms
specified in this Annex to retrieve emergency call numbers and service types
for use within the country indicated by the MCC information.
The UE shall construct an emergency number FQDN based on the Country based
Emergency Numbers FQDN format as specified in 3GPP TS 23.003 [3] and then
perform the DNS NAPTR query using the constructed emergency number FQDN as
input.
If the result of this query is:
\- a set of one or more records containing the replacement field of the form
\"\.\.sos._en.epc.mcc\ ._visited-
country._pub.3gppnework.org_ \", the UE shall consider the list of emergency-
number(s) and type(s) as valid additional emergency call number(s) for the
country indicated by the MCC information and store the emergency call
number(s) and type(s) received;
NOTE: Even though a label named \"visited-country\" is present in the
replacement field, the UE can use the mechanism to obtain emergency numbers
and associated type(s) even when the UE is in its home country.
\- no records containing the replacement field of the form \"\.\.sos._en.epc.mcc\ ._visited-
country._pub.3gppnework.org_ \", the UE shall replace a Local Emergency
Numbers List storing emergency call number(s) and type(s) received over WLAN
with an empty Local Emergency Numbers List.
# J.3 Void
###### ## Annex K (normative): Local Emergency Call Numbers from IKEv2
procedure
# K.1 General
This clause describes the retrieval of the local emergency call numbers using
IKEv2 procedures.
The ePDG may support downloading local emergency call numbers using IKEv2
procedures.
The UE may support retrieval of local emergency call numbers using IKEv2
procedures.
# K.2 Retrieval of local emergency call numbers
## K.2.1 UE procedures
During the tunnel establishment procedure (see clause 7.2.2), if the UE
supports retrieval of local emergency call numbers via IKEv2 procedures, it
shall include the EMERGENCY_CALL_NUMBERS Notify payload without the MCC
information field, Length field and Local emergency numbers field (i.e. the
octet 5 to octet x in figure 8.2.9.8-1) in the IKE_AUTH request message to
indicate the support of retrieval of local emergency call numbers via IKEv2
procedures.
After the successful authentication with the 3GPP AAA server, the UE receives
from the ePDG an IKE_AUTH response message, if:
a) the EMERGENCY_CALL_NUMBERS Notify payload is included in that IKE_AUTH
response message; and
b) the UE supports retrieval of local emergency call numbers via IKEv2
procedures,
the UE shall store the local WLAN emergency call numbers and corresponding
emergency service categories contained in the EMERGENCY_CALL_NUMBERS Notify
payload as additional emergency call numbers and categories. The additional
emergency call numbers and categories can be used to detect a UE initiated
emergency call if the MCC information in the EMERGENCY_CALL_NUMBERS Notify
payload corresponds to the country in which the UE is located. The local WLAN
emergency call numbers and corresponding emergency service categories stored
in the user equipment shall be replaced on each receipt of an
EMERGENCY_CALL_NUMBERS Notify payload with a MCC information field that has a
non-zero value Length field.
If:
\- no MCC information field;
\- no Length field; or
\- a Length field, set to a non-zero value, is present but no Local emergency
numbers field;
is present in a received EMERGENCY_CALL_NUMBERS Notify payload, then the local
WLAN emergency call numbers and corresponding emergency service categories, if
available in the user equipment, shall be kept.
## K.2.2 ePDG procedures
The ePDG may be configured by the operator with the local emergency call
numbers and associated emergency service types along with the corresponding
country information.
After the successful authentication between the UE and the 3GPP AAA server,
if:
a) the ePDG is configured with the local emergency call numbers information;
and
b) the ePDG supports downloading of local emergency call numbers via IKEv2;
the ePDG shall based on local policy:
a) if the UE has indicated support of retrieval of local emergency call
numbers via IKEv2 procedures,
i) derive the current visited country from the IP address of the IKEv2
message, i.e. the IP address contained in the out most IP header field of the
received IKEv2 message; and
ii) include the configured local emergency call numbers and the associated
emergency service categories of the derived country, if available, in the
EMERGENCY_CALL_NUMBERS Notify payload in the final IKE_AUTH response message;
or
b) always
i) derive the current visited country from the IP address of the IKEv2
message, i.e. the IP address contained in the out most IP header field of the
received IKEv2 message; and
ii) include the configured local emergency call numbers and the associated
emergency service categories of the derived country, if available, in the
EMERGENCY_CALL_NUMBERS Notify payload in the final IKE_AUTH response message.
#
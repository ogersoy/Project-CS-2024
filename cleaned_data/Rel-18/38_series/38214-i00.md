# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies and establishes the characteristics of the
physicals layer procedures of data channels for 5G-NR.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\"
[2] 3GPP TS 38.201: \" NR; Physical Layer -- General Description\"
[3] 3GPP TS 38.202: \"NR; Services provided by the physical layer\"
[4] 3GPP TS 38.211: \"NR; Physical channels and modulation\"
[5] 3GPP TS 38.212: \"NR; Multiplexing and channel coding\"
[6] 3GPP TS 38.213: \"NR; Physical layer procedures for control\"
[7] 3GPP TS 38.215: \"NR; Physical layer measurements\"
[8] 3GPP TS 38.101: \"NR; User Equipment (UE) radio transmission and
reception\"
[9] 3GPP TS 38.104: \"NR; Base Station (BS) radio transmission and reception\"
[10] 3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol
specification\"
[11] 3GPP TS 38.133: \"NR; Requirements for support of radio resource
management\"
[12] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\"
[13] 3GPP TS 38.306: \"NR; User Equipment (UE) radio access capabilities\"
[14] 3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\"
[15] 3GPP TS 36.211: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical channels and modulation\"
[16] 3GPP TS 37.213: \"Physical layer procedures for shared spectrum channel
access\"
[17] 3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\"
[18] 3GPP TS 38.822: \"NR; User Equipment (UE) feature list\"
[19] 3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer procedures\"
[20] 3GPP TS 38.305: \"NG Radio Access Network (NG-RAN); Stage 2 functional
specification of User Equipment (UE) positioning in NG-RAN\"
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
> ARP Antenna Reference Point
BWP Bandwidth Part
CBG Code Block Group
CJT Coherent Joint Transmission
CLI Cross Link Interference
CP Cyclic Prefix
CQI Channel Quality Indicator
CPU CSI Processing Unit
CRB Common Resource Block
CRC Cyclic Redundancy Check
CRI CSI-RS Resource Indicator
CSI Channel State Information
CSI-RS Channel State Information Reference Signal
CSI-RSRP CSI Reference Signal Received Power
CSI-RSRQ CSI Reference Signal Received Quality
CSI-SINR CSI Signal-to-Interference-plus-Noise Ratio
CW Codeword
DCI Downlink Control Information
DL Downlink
DM-RS Demodulation Reference Signal
DRX Discontinuous Reception
EPRE Energy Per Resource Element
IAB-MT Integrated Access and Backhaul -- Mobile Termination
L1-RSRP Layer 1 Reference Signal Received Power
LI Layer Indicator
MCS Modulation and Coding Scheme
NCJT Non-Coherent Joint Transmission
PDCCH Physical Downlink Control Channel
PDSCH Physical Downlink Shared Channel
PSS Primary Synchronisation Signal
PUCCH Physical Uplink Control Channel
QCL Quasi Co-Location
PMI Precoding Matrix Indicator
PRB Physical Resource Block
PRG Precoding Resource block Group
PRS Positioning Reference Signal
PT-RS Phase-Tracking Reference Signal
RB Resource Block
RBG Resource Block Group
RI Rank Indicator
RIV Resource Indicator Value
RS Reference Signal
SCI Sidelink Control Information
> SL PRS Sidelink Positioning Reference Signal
SLIV Start and Length Indicator Value
SR Scheduling Request
SRS Sounding Reference Signal
SS Synchronisation Signal
SSS Secondary Synchronisation Signal
SS-RSRP SS Reference Signal Received Power
SS-RSRQ SS Reference Signal Received Quality
SS-SINR SS Signal-to-Interference-plus-Noise Ratio
TB Transport Block
TCI Transmission Configuration Indicator
TDCP Time Domain Channel Properties
TDM Time Division Multiplexing
UE User Equipment
UL Uplink
# 4 Power control
Throughout this specification, unless otherwise noted, statements using the
term \"UE\" in clauses 4, 5, or 6 are equally applicable to the IAB-MT part of
an IAB node.
## 4.1 Power allocation for downlink
The gNB determines the downlink transmit EPRE.
For the purpose of SS-RSRP, SS-RSRQ and SS-SINR measurements, the UE may
assume downlink EPRE is constant across the bandwidth. For the purpose of SS-
RSRP, SS-RSRQ and SS-SINR measurements, the UE may assume downlink EPRE is
constant over SSS carried in different SS/PBCH blocks. For the purpose of SS-
RSRP, SS-RSRQ and SS-SINR measurements, the UE may assume that the ratio of
SSS EPRE to PBCH DM-RS EPRE is 0 dB.
For the purpose of CSI-RSRP, CSI-RSRQ and CSI-SINR measurements, the UE may
assume downlink EPRE of a port of CSI-RS resource configuration is constant
across the configured downlink bandwidth and constant across all configured
OFDM symbols.
The downlink SS/PBCH SSS EPRE can be derived from the SS/PBCH downlink
transmit power given by the parameter _ss-PBCH-BlockPower_ provided by higher
layers. The downlink SSS transmit power is defined as the linear average over
the power contributions (in [W]) of all resource elements that carry the SSS
within the operating system bandwidth.
The downlink CSI-RS EPRE can be derived from the SS/PBCH block downlink
transmit power given by the parameter _ss-PBCH-BlockPower_ and CSI-RS power
offset given by the parameter _powerControlOffsetSS_ provided by higher layers
if the SS/PBCH block is associated with serving cell PCI, or derived from _ss-
PBCH-BlockPower-r17_ in _SSB-MTC-AdditionalPCI-r17_ and _powerControlOffsetSS_
provided by higher layers if the SS/PBCH block is associated with additional
PCI different from serving cell PCI, where the CSI-RS is QCLed with the
SS/PBCH block. The downlink reference-signal transmit power is defined as the
linear average over the power contributions (in [W]) of the resource elements
that carry the configured CSI-RS within the operating system bandwidth.
For downlink DM-RS associated with PDSCH, the UE may assume the ratio of PDSCH
EPRE to DM-RS EPRE ( [dB]) is given by Table 4.1-1 according to the number of
DM-RS CDM groups without data as described in Clause 5.1.6.2. The DM-RS
scaling factor specified in Clause 7.4.1.1.2 of [4, TS 38.211] is given by .
Table 4.1-1: The ratio of PDSCH EPRE to DM-RS EPRE
Number of DM-RS CDM groups without data DM-RS configuration type 1 and
enhanced type 1 DM-RS configuration type 2 and enhanced type 2
* * *
1 0 dB 0 dB 2 -3 dB -3 dB 3 - -4.77 dB
When the UE is scheduled with one or two PT-RS ports associated with the
PDSCH,
\- if the UE is configured with the higher layer parameter _epre-Ratio_ , the
ratio of PT-RS EPRE to PDSCH EPRE per layer per RE for each PT-RS port () is
given by Table 4.1-2 or Table 4.1-2A according to the _epre-Ratio_ , the PT-RS
scaling factor specified in clause 7.4.1.2.2 of [4, TS 38.211] is given by.
\- otherwise, the UE shall assume _epre-Ratio_ is set to state \'0\' in Table
4.1-2 if not configured.
Table 4.1-2: PT-RS EPRE to PDSCH EPRE per layer per RE (), if [_enhanced-dmrs-
Type_r18_] is not configured in _DMRS-DownlinkConfig_
_epre-Ratio_ The number of PDSCH layers with DM-RS associated to the PT-RS
port
* * *
                 1                                                                    2   3      4   5   6
0 0 3 4.77 6 7 7.78 1 0 0 0 0 0 0 2 reserved  
3 reserved
Table 4.1-2A: PT-RS EPRE to PDSCH EPRE per layer per RE (), if [_enhanced-
dmrs-Type_r18_] is configured in _DMRS-DownlinkConfig_
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | **The | | | | | | | | |** epr | n | | | | | | | | | e-Rat | umber | | | | | | | | | io** _| of | | | | | | | | | | PDSCH | | | | | | | | | | l | | | | | | | | | | ayers | | | | | | | | | | with | | | | | | | | | | DM-RS | | | | | | | | | | assoc | | | | | | | | | | iated | | | | | | | | | | to | | | | | | | | | | the | | | | | | | | | | PT-RS | | | | | | | | | | p | | | | | | | | | | ort_ * | | | | | | | | +=======+=======+=======+=======+=======+=======+=======+=======+=======+ | | **1**|** 2**|** 3**|** 4**|** 5**|** 6**|** 7**|** 8** | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 3 | 4.77 | 6 | 7 | 7.78 | 8.45 | 9 | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 2 | > res | | | | | | | | | | erved | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 3 | > res | | | | | | | | | | erved | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
For link recovery, as described in clause 6 of [6, TS 38.213] the ratio of the
PDCCH EPRE to NZP CSI-RS EPRE is assumed as 0 dB.
# 5 Physical downlink shared channel related procedures
## 5.1 UE procedure for receiving the physical downlink shared channel
For downlink, a maximum of 16 HARQ processes per cell are supported by the UE,
or subject to UE capability, **a maximum of 32 HARQ processes per cell as
defined in [13, TS 38.306].** The number of processes the UE may assume will
at most be used for the downlink is configured to the UE for each cell
separately by higher layer parameter _nrofHARQ-ProcessesForPDSCH_ or
_nrofHARQ-ProcessesForPDSCH-v1700_ , and when no configuration is provided the
UE may assume a default number of 8 processes.
A UE shall upon detection of a PDCCH with a configured DCI format 1_0, 1_1,
1_2, 1_3, 4_0, 4_1, or 4_2 decode the corresponding PDSCHs as indicated by
that DCI. When the UE is scheduled with multiple PDSCHs on a serving cell by a
DCI, HARQ process ID indicated by this DCI applies to the first PDSCH not
overlapping with a UL symbol indicated by _tdd-UL-DL-ConfigurationCommon_ or
_tdd-UL-DL-ConfigurationDedicated_ if provided, HARQ process ID is then
incremented by 1 for each subsequent PDSCH(s) in the scheduled order, with
modulo operation of _nrofHARQ-ProcessesForPDSCH_ applied if _nrofHARQ-
ProcessesForPDSCH_ is provided, or with modulo operation of _nrofHARQ-
ProcessesForPDSCH-v1700_ applied if or _nrofHARQ-ProcessesForPDSCH-v1700_ is
provided, or with modulo operation of 8 applied, otherwise. HARQ process ID is
not incremented for PDSCH(s) not received if at least one of the symbols
indicated by the indexed row of the used resource allocation table in the slot
overlaps with a UL symbol indicated by _tdd-UL-DL-ConfigurationCommon_ or
_tdd-UL-DL-ConfigurationDedicated_ if provided. When a UE is configured by the
higher layer parameter _repetitionScheme_ set to \'tdmSchemeA\', the PDSCH
includes two PDSCH transmission occasions. For each PDSCH, if either PDSCH
occasion overlaps with a UL symbol indicated by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ if provided, the
PDSCH is not received and HARQ process ID is not increment for the PDSCH. For
any HARQ process ID(s) in a given scheduled cell, the UE is not expected to
receive a PDSCH that overlaps in time with another PDSCH if the UE is not
capable of receiving FDMed unicast and multicast PDSCH per slot per carrier.
When HARQ feedback for the HARQ process ID is not disabled, or for the HARQ
process associated with the first SPS PDSCH when _HARQ-
feedbackEnablingforSPSactive_ is provided and enabled, the UE is not expected
to receive another PDSCH for a given HARQ process until after the end of the
expected transmission of HARQ-ACK for that HARQ process, where the timing is
given by Clause 9.2.3 of [6, TS 38.213]. For HARQ-ACK subject to HARQ-ACK
deferral described in Clause 9.2.5.4 of [6 TS 38.213], the expected
transmission of HARQ-ACK corresponds to the expected transmission HARQ-ACK in
a first slot. When HARQ feedback for the HARQ process ID is disabled, the UE
is not expected to receive another PDCCH carrying a DCI scheduling a PDSCH or
set of slot-aggregated PDSCH scheduled for the given HARQ process or to
receive another PDSCH without corresponding PDCCH for the given HARQ process
that starts until T~proc,1~ after the end of the reception of the last PDSCH
or slot-aggregated PDSCH for that HARQ process. Except for the case when a UE
is configured by higher layer parameter _PDCCH-Config_ that contains two
different values of _coresetPoolIndex_ in _ControlResourceSet_ and PDCCHs that
schedule two PDSCHs are associated to different _ControlResourceSets_ having
different values of _coresetPoolIndex,_ in a given scheduled cell, the UE is
not expected to receive a first PDSCH and a second PDSCH, starting later than
the first PDSCH, with its corresponding HARQ-ACK assigned to be transmitted on
a resource ending before the start of a different resource for the HARQ-ACK
assigned to be transmitted for the first PDSCH, where the two resources are in
different slots for the associated HARQ-ACK transmissions, each slot is
composed of symbols [4] or a number of symbols indicated by
_subslotLengthForPUCCH_ if provided, and the HARQ-ACK for the two PDSCHs are
associated with the HARQ-ACK codebook of the same priority. Except for the
case when a UE is configured by higher layer parameter _PDCCH-Config_ that
contains two different values of _coresetPoolIndex_ in _ControlResourceSet_
and PDCCHs that schedule two PDSCHs are associated to different
_ControlResourceSets_ having different values of _coresetPoolIndex,_ in a
given scheduled cell, the UE is not expected to receive a first PDSCH, and a
second PDSCH, starting later than the first PDSCH, with its corresponding
HARQ-ACK assigned to be transmitted on a resource ending before the start of a
different resource for the HARQ-ACK assigned to be transmitted for the first
PDSCH if the HARQ-ACK for the two PDSCHs are associated with HARQ-ACK
codebooks of different priorities. For any two HARQ process IDs in a given
scheduled cell, if the UE is scheduled to start receiving a first PDSCH
starting in symbol _j_ by a PDCCH ending in symbol _i on a scheduling cell_ ,
the UE is not expected to be scheduled to receive a PDSCH starting earlier
than the end of the first PDSCH with a PDCCH that ends later than symbol _i of
a scheduling cell_ ,. When the PDCCH reception includes two PDCCH candidates
from two respective search space sets, as described in clause 10.1 of [6, TS
38.213], the PDCCH ending in symbol _i_ is determined based on the PDCCH
candidate that ends later in time. In a given scheduled cell, for any PDSCH
corresponding to SI-RNTI, the UE is not expected to decode a re-transmission
of an earlier PDSCH with a starting symbol less than _N_ symbols after the
last symbol of that PDSCH, where the value of _N_ depends on the PDSCH
subcarrier spacing configuration _μ,_ with _N_ =13 for _μ_ =0, _N_ =13 for _μ_
=1, _N_ =20 for _μ_ =2, _N_ =24 for _μ_ =3, _N_ =96 for _μ_ =5, and _N_ =192
for _μ_ =6.
When receiving PDSCH scheduled with SI-RNTI, P-RNTI, G-RNTI for broadcast or
MCCH-RNTI, the UE may assume that the DM-RS port of PDSCH is quasi co-located
with the associated SS/PBCH block with respect to Doppler shift, Doppler
spread, average delay, delay spread, spatial RX parameters when applicable.
When receiving PDSCH scheduled with RA-RNTI, or MSGB-RNTI, the UE may assume
that the DM-RS port of PDSCH is quasi co-located with the SS/PBCH block or the
CSI-RS resource the UE used for RACH association as applicable, and
transmission with respect to Doppler shift, Doppler spread, average delay,
delay spread, spatial RX parameters when applicable. When receiving a PDSCH
scheduled with RA-RNTI in response to a random access procedure triggered by a
PDCCH order which triggers contention-free random access procedure for the
SpCell [10, TS 38.321], the UE may assume that the DM-RS port of the received
PDCCH order and the DM-RS ports of the corresponding PDSCH scheduled with RA-
RNTI are quasi co-located with the same SS/PBCH block or CSI-RS with respect
to Doppler shift, Doppler spread, average delay, delay spread, spatial RX
parameters when applicable. If a UE is configured with _SSB-MTC-AddtionalPCI_
and with _PDCCH-Config_ that contains two different values of
_coresetPoolIndex_ in _ControlResourceSet_ , and if the UE is configured with
[_twoTAGs_] for the SpCell, if the UE attempts to detect the DCI format 1_0
with CRC scrambled by the corresponding RA-RNTI or when receiving a PDSCH
scheduled with RA-RNTI in response to a random access procedure triggered by a
PDCCH order which triggers contention-free random access procedure for the
SpCell [10, TS 38.321], and if the CORESET used for the PDCCH order
transmission is not associated with the serving cell physical cell ID, the UE
may assume that the DM-RS ports of the received PDSCH are quasi co-located
with the DM-RS antenna port associated with PDCCH receptions in the CORESET
for Type1-PDCCH CSS set with respect to Doppler shift, Doppler spread, average
delay, delay spread, and spatial RX parameters when applicable.
When receiving PDSCH in response to a PUSCH transmission scheduled by a RAR UL
grant or corresponding PUSCH retransmission, or when receiving PDSCH in
response to a PUSCH for Type-2 random access procedure, or a PUSCH scheduled
by a fallbackRAR UL grant or corresponding PUSCH retransmission, the UE may
assume that the DM-RS port of PDSCH is quasi co-located with the SS/PBCH block
the UE selected for RACH association and transmission with respect to Doppler
shift, Doppler spread, average delay, delay spread, spatial RX parameters when
applicable.
If the UE is not configured for PUSCH/PUCCH transmission for at least one
serving cell configured with slot formats comprised of DL and UL symbols, and
if the UE is not capable of simultaneous reception and transmission on serving
cell _c~1~_ and serving cell _c~2~_ , the UE is not expected to receive PDSCH
on serving cell _c~1~_ if the PDSCH overlaps in time with SRS transmission
(including any interruption due to uplink or downlink RF retuning time [10])
on serving cell _c~2~_ not configured for PUSCH/PUCCH transmission.
The UE is not expected to decode a PDSCH in a serving cell scheduled by a
PDCCH with C-RNTI, CS-RNTI, MCS-C-RNTI, G-RNTI, G-CS-RNTI or MCCH-RNTI and one
or multiple PDSCH(s) required to be received according to this Clause in the
same serving cell without a corresponding PDCCH transmission if the PDSCHs
partially or fully overlap in time except if the PDCCH scheduling the PDSCH
ends at least 14$\bullet 2^{max(0,\mu - 3)}$ symbols before the earliest
starting symbol of the PDSCH(s) without the corresponding PDCCH transmission,
where _μ_ and the symbol duration are based on the smallest numerology between
the scheduling PDCCH and the PDSCH, in which case the UE shall decode the
PDSCH scheduled by the PDCCH. When the PDCCH reception incudes two PDCCH
candidates from two respective search space sets, as described in clause 10 of
[6, TS 38.213], for the purpose of determining the PDCCH with C-RNTI, CS-RNTI
or MCS-C-RNTI scheduling the PDSCH ends at least 14$\bullet 2^{max(0,\mu -
3)}$ symbols before the earliest starting symbol of the PDSCH(s) without the
corresponding PDCCH transmission, the PDCCH candidate that ends later in time
is used.
The UE is not expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI,
G-RNTI for multicast or broadcast, MCCH-RNTI, G-CS-RNTI or CS-RNTI if another
PDSCH in the same cell scheduled with RA-RNTI or MSGB-RNTI partially or fully
overlap in time.
Furthermore, a UE indicating _supportOfRedCap-r18_ capability but not
indicating FG 48-2 is not expected to decode a PDSCH scheduled with C-RNTI,
MCS-C-RNTI, G-RNTI for multicast or broadcast, MCCH-RNTI, G-CS-RNTI or CS-RNTI
in the same or next slot if another PDSCH in the same cell is scheduled with
RA-RNTI or MSGB-RNTI, when the PDSCH scheduled with RA-RNTI or MSGB-RNTI is
allocated more than 25 PRBs when configured with SCS μ = 0 or more than 12
PRBs when configured with SCS μ = 1.
The UE in RRC_IDLE and RRC_INACTIVE modes shall be able to decode two PDSCHs
each scheduled with SI-RNTI, P-RNTI, RA-RNTI or TC-RNTI, where the PDSCH
scheduled with TC-RNTI for a reduced capability UE
that indicates _supportOfRedCap-r18_ is allocated no more than 25 PRBs when
configured with SCS μ = 0 or no more than 12 PRBs when configured with SCS μ =
1, with the two PDSCHs partially or fully overlapping in time in non-
overlapping PRBs.
The UE:
\- is expected to decode PDSCH scheduled with MCCH-RNTI and PBCH in PCell that
partially or fully overlaps in time in non-overlapping PRBs in PCell.
\- is not expected to decode PDSCH scheduled with G-RNTI for broadcast and
PBCH in PCell that partially or fully overlaps in time in non-overlapping PRBs
in PCell.
\- is not expected to decode PDSCH scheduled with G-RNTI for multicast and
PBCH in PCell that partially or fully overlaps in time in non-overlapping PRBs
in PCell.
On a frequency range 1 cell, the UE shall be able to decode a PDSCH scheduled
with C-RNTI, MCS-C-RNTI, or CS-RNTI and, during a process of P-RNTI triggered
SI acquisition, another PDSCH scheduled with SI-RNTI that partially or fully
overlap in time in non-overlapping PRBs, unless the PDSCH scheduled with
C-RNTI, MCS-C-RNTI, or CS-RNTI requires Capability 2 processing time according
to clause 5.3 in which case the UE may skip decoding of the scheduled PDSCH
with C-RNTI, MCS-C-RNTI, or CS-RNTI.
On a frequency range 2 cell, the UE is not expected to decode a PDSCH
scheduled with C-RNTI, MCS-C-RNTI, or CS-RNTI if in the same cell, during a
process of P-RNTI triggered SI acquisition, another PDSCH scheduled with SI-
RNTI partially or fully overlap in time.
A UE that indicates _supportOfRedCap-r18_ capability but does not indicate FG
48-2, during a process of P-RNTI triggered SI acquisition, when the total
number of PRBs for the PDSCH scheduled with SI-RNTI and the PDSCH scheduled
with C-RNTI, MCS-C-RNTI, or CS-RNTI scheduled in the slot is larger than 25
PRBs if configured with SCS µ = 0 or larger than 12 PRBs if configured with
SCS µ = 1, the UE may skip decoding of the scheduled PDSCH with C-RNTI, MCS-C-
RNTI, or CS-RNTI.
The UE is expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, or CS-
RNTI during a process of autonomous SI acquisition.
The maximum number of PDSCHs scheduled per slot per component carrier with
C-RNTI/CS-RNTI and G-RNTI/G-CS-RNTI/MCCH-RNTI that the UE shall be able to
decode is the same as the indicated UE capability for the number of unicast
PDSCHs per slot per component carrier. If the UE is capable of receiving FDMed
unicast and multicast PDSCH per slot per carrier, the UE shall be able to
decode a PDSCH scheduled by a DCI format with C-RNTI or a PDSCH scheduled for
a retransmission of a TB by a DCI format with CS-RNTI and a PDSCH scheduled by
a DCI format with G-RNTI for multicast or a PDSCH scheduled for a
retransmission of a TB by a DCI format with G-CS-RNTI that partially or fully
overlap in time in non-overlapping PRBs. If the UE is capable of receiving
FDMed unicast and broadcast PDSCH per slot per carrier, the UE shall be able
to decode a PDSCH scheduled by a DCI format with C-RNTI or a PDSCH scheduled
for a retransmission of a TB by a DCI format with CS-RNTI and a PDSCH
scheduled with G-RNTI for broadcast/MCCH-RNTI that partially or fully overlap
in time in non-overlapping PRBs.
If the UE is configured by higher layers to decode a PDCCH with its CRC
scrambled by a CS-RNTI or G-CS-RNTI, the UE shall receive PDSCH transmissions
without corresponding PDCCH transmissions using the higher-layer-provided
PDSCH configuration for those PDSCHs.
The UE it is not expected to support reception of FDMed MCCH PDSCH and
broadcast MTCH PDSCH in PCell or SCell, or FDMed multiple broadcast MTCH
PDSCHs in PCell or SCell, or FDMed MCCH/broadcast MTCH/multicast PDSCH and SIB
PDSCH in PCell, or FDMed multicast PDSCHs in PCell or SCell, or FDMed
multicast PDSCH and MCCH/broadcast MTCH PDSCH in PCell or SCell, or FDMed
MCCH/broadcast MTCH/multicast PDSCH and paging PDSCH.
If a UE is configured by higher layer parameter _PDCCH-Config_ that contains
two different values of _coresetPoolIndex_ in _ControlResourceSet_ , the UE
may expect to receive multiple PDCCHs scheduling fully/partially/non-
overlapped PDSCHs in time and frequency domain. The UE may expect the
reception of full/partially-overlapped PDSCHs in time, only when PDCCHs that
schedule two PDSCHs are associated to different _ControlResourceSets_ having
different values of _coresetPoolIndex_. For a _ControlResourceSet_ without
_coresetPoolIndex_ , the UE may assume that the _ControlResourceSet_ is
assigned with _coresetPoolIndex_ as 0. When the UE is configured with _SSB-
MTC-AdditionalPCI_ , _ControlResourceSets_ corresponding to different
_coresetPoolIndex_ values may be associated with different physical cell IDs
via activated TCI states of the _ControlResourceSets_ , where
_ControlResourceSets_ corresponding to one _coresetPoolIndex_ is associated
with the serving cell physical cell ID and _ControlResourceSets_ corresponding
to another _coresetPoolIndex_ can be associated with another physical cell ID.
When the UE is scheduled with full/partially/non-overlapped PDSCHs in time and
frequency domain, the full scheduling information for receiving a PDSCH is
indicated and carried only by the corresponding PDCCH, the UE is expected to
be scheduled with the same active BWP and the same SCS. When the UE is
scheduled with full/partially-overlapped PDSCHs in time and frequency domain,
the UE can be scheduled with at most two codewords simultaneously. When PDCCHs
that schedule two PDSCHs are associated to different _ControlResourceSets_
having different values of _coresetPoolIndex,_ the following operations are
allowed:
\- For any two HARQ process IDs in a given scheduled cell, if the UE is
scheduled to start receiving a first PDSCH starting in symbol _j_ by a PDCCH
associated with a value of _coresetPoolIndex_ ending in symbol _i_ , the UE
can be scheduled to receive a PDSCH starting earlier than the end of the first
PDSCH with a PDCCH associated with a different value of _coresetPoolIndex_
that ends later than symbol _i_.
\- In a given scheduled cell, the UE can receive a first PDSCH in slot _i_ ,
with the corresponding HARQ-ACK assigned to be transmitted in slot _j_ , and a
second PDSCH associated with a value of _coresetPoolIndex_ different from that
of the first PDSCH starting later than the first PDSCH with its corresponding
HARQ-ACK assigned to be transmitted in a slot before slot _j_.
If PDCCHs that schedule corresponding PDSCHs are associated to the same or
different _ControlResourceSets_ having the same value of _coresetPoolIndex_ ,
the UE procedure for receiving the PDSCH upon detection of a PDCCH follows
Clause 5.1.
A UE does not expect to be configured with _repetitionScheme_ if the UE is
configured with higher layer parameter _repetitionNumber for the same PDSCH._
When a UE is configured by higher layer parameter _repetitionScheme_ set to
one of \'_fdmSchemeA\'_ , \'_fdmSchemeB\'_ , \'_tdmSchemeA\'_ , if the UE is
indicated with two TCI states in a codepoint of the DCI field _\'Transmission
Configuration Indication\'_ and DM-RS port(s) within one CDM group in the DCI
field \'_Antenna Port(s)\'_.
\- When two TCI states are indicated in a DCI and the UE is set to
\'_fdmSchemeA\',_ the UE shall receive a single PDSCH transmission occasion of
the TB with each TCI state associated to a non-overlapping frequency domain
resource allocation as described in Clause 5.1.2.3.
\- When two TCI states are indicated in a DCI and the UE is set to
\'_fdmSchemeB\'_ , the UE shall receive two PDSCH transmission occasions of
the same TB with each TCI state associated to a PDSCH transmission occasion
which has non-overlapping frequency domain resource allocation with respect to
the other PDSCH transmission occasion as described in Clause 5.1.2.3.
\- When two TCI states are indicated in a DCI and the UE is set to
\'_tdmSchemeA\'_ , the UE shall receive two PDSCH transmission occasions of
the same TB with each TCI state associated to a PDSCH transmission occasion
which has non-overlapping time domain resource allocation with respect to the
other PDSCH transmission occasion and both PDSCH transmission occasions shall
be received within a given slot as described in Clause 5.1.2.1.
When a UE is configured by the higher layer parameter _repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation_ , the UE may expect to be indicated with
one or two TCI states in a codepoint of the DCI field _\'Transmission
Configuration Indication\'_ together with the DCI field \'_Time domain
resource assignment_ \' indicating an entry _which contains repetitionNumber_
in _PDSCH-TimeDomainResourceAllocation_ and DM-RS port(s) within one CDM group
in the DCI field \'_Antenna Port(s)\'_.
\- When two TCI states are indicated in a DCI with \'_Transmission
Configuration Indication_ \' field, the UE may expect to receive multiple slot
level PDSCH transmission occasions of the same TB with two TCI states used
across multiple PDSCH transmission occasions in the _repetitionNumber_
consecutive slots as defined in Clause 5.1.2.1.
\- When one TCI state is indicated in a DCI with \'_Transmission Configuration
Indication_ \' field, the UE may expect to receive multiple slot level PDSCH
transmission occasions of the same TB with one TCI state used across multiple
PDSCH transmission occasions in the _repetitionNumber_ consecutive slots as
defined in Clause 5.1.2.1.
When a UE is not indicated with a DCI that DCI field \'_Time domain resource
assignment_ \' indicating an entry _which contains repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation_ , and it is indicated with two TCI states
in a codepoint of the DCI field _\'Transmission Configuration Indication\'_
and DM-RS port(s) within two CDM groups in the DCI field \'_Antenna Port(s)\'
and it is not configured with higher layer parameter sfnSchemePDSCH_ , the UE
may expect to receive a single PDSCH where the association between the DM-RS
ports and the TCI states are as defined in Clause 5.1.6.2.
When a UE is not indicated with a DCI that DCI field \'_Time domain resource
assignment_ \' indicating an entry _which contains repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation_ , and it is indicated with one TCI states
in a codepoint of the DCI field _\'Transmission Configuration Indication\',_
the UE procedure for receiving the PDSCH upon detection of a PDCCH follows
Clause 5.1.
When a UE _is configured with higher layer parameter sfnSchemePDSCH_ set to
either _\'_ sfnSchemeA _\'_ or _\'_ sfnSchemeB _\'_ and
\- if the UE reports its capability of _sfn-SchemeA-DynamicSwitching-r17_ or
_sfn-SchemeB-DynamicSwitching-r17_ , the UE is indicated with one or two TCI
state(s) in a codepoint of the DCI field _\'Transmission Configuration
Indication\' in DCI format 1_1/1_2_ , or
\- otherwise, the UE is not expected to be indicated with one TCI state per
any of TCI codepoint by MAC CE, and the UE is indicated with two TCI states in
a codepoint of the DCI field _\'Transmission Configuration Indication\' in DCI
format 1_1/1_2_ , and
the UE procedure for receiving the PDSCH upon detection of a PDCCH follows
clause 5.1 and the QCL assumption for the PDSCH as defined in clause 5.1.5.
When a UE is configured with both _sfnSchemePDSCH_ and _sfnSchemePDCCH_ , the
UE shall expect that _sfnSchemePDSCH_ and _sfnSchemePDCCH_ are set to the same
scheme, either _\'_ sfnSchemeA _\'_ or _\'_ sfnSchemeB _\'_.
If a UE is configured with _sfnSchemePDCCH_ set to \'sfnSchemeA\' and
activated with two TCI states by MAC CE, and the UE does not report its
capability of _sfn-SchemeA-PDCCH-only_ , the UE is expected to be configured
with _sfnSchemePDSCH_ set to _\'sfnSchemeA\'_ and indicated with two TCI
states in a codepoint of the DCI field _\'Transmission Configuration
Indication\',_ if the PDSCH is scheduled by DCI format 1_1/1_2.
If a UE is configured with _sfnSchemePDCCH_ set to \'sfnSchemeB\' and
activated with two TCI states by MAC CE, the UE is expected to be configured
with _sfnSchemePDSCH_ set to _\'sfnSchemeB\'_ and indicated with two TCI
states in a codepoint of the DCI field _\'Transmission Configuration
Indication\',_ if the PDSCH is scheduled by DCI format 1_1/1_2.
When a UE is configured with _sfnSchemePDSCH_ and/or _sfnSchemePDCCH_ , the UE
shall expect that the _sfnSchemePDSCH_ and/or _sfnSchemePDCCH_ configuration
are the same within a CC, and the UE shall expect that the _sfnSchemePDSCH_
and/or _sfnSchemePDCCH_ configuration are the same in all CCs in a same
frequency band if the UE is configured with CA, where the UE does not expect
to be configured with _sfnSchemePDSCH_ and/or _sfnSchemePDCCH_ in initial BWP
in each CC.
If more than one PDSCH on a serving cell each without a corresponding PDCCH
transmission are in a slot, after resolving overlapping with symbols in the
slot indicated as uplink by _tdd-UL-DL-ConfigurationCommon_ , or by _tdd-UL-
DL-ConfigurationDedicated_ , a UE receives one or more PDSCHs without
corresponding PDCCH transmissions in the slot as specified below.
‒ Step 0: set _j=0_ , where _j_ is the number of selected PDSCH(s) for
decoding. _Q_ is the set of activated PDSCHs without corresponding PDCCH
transmissions within the slot
‒ Step 1: A UE receives one PDSCH with the lowest configured _sps-ConfigIndex_
within _Q_ , set _j=j+1_. Designate the received PDSCH as survivor PDSCH.
‒ Step 2: The survivor PDSCH in step 1 and any other PDSCH(s) overlapping
(even partially) with the survivor PDSCH in step 1 are excluded from _Q_.
‒ Step 3: Repeat step 1 and 2 until _Q_ is empty or _j_ is equal to the number
of unicast/multicast PDSCHs in a slot supported by the UE
### 5.1.1 Transmission schemes
Only one transmission scheme is defined for the PDSCH, and is used for all
PDSCH transmissions.
#### 5.1.1.1 Transmission scheme 1
For transmission scheme 1 of the PDSCH, the UE may assume that a gNB
transmission on the PDSCH would be performed with up to 8 transmission layers
on antenna ports 1000-1023 as defined in Clause 7.3.1.4 of [4, TS 38.211],
subject to the DM-RS reception procedures in Clause 5.1.6.2.
### 5.1.2 Resource allocation
#### 5.1.2.1 Resource allocation in time domain
When the UE is scheduled to receive PDSCH by a DCI, the _Time domain resource
assignment_ field value _m_ for the scheduled PDSCH on the serving cell
provides a row index _m_ \+ 1 to a resource allocation table. The
determination of the used resource allocation table is defined in Clause
5.1.2.1.1. The indexed row defines the slot offset _K~0~_ , the start and
length indicator _SLIV_ , or directly the start symbol _S_ and the allocation
length _L_ , and the PDSCH mapping type to be assumed in the PDSCH reception.
Given the parameter values of the indexed row:
\- The slot allocated for the PDSCH is _K~s~_ , where , if UE is configured
with _ca-SlotOffset_ for at least one of the scheduled and scheduling cell,
and _K~s\ ~_ = {width="1.0284722222222222in" height="0.5145833333333333in"},
otherwise, and where _n_ is the slot with the scheduling DCI, and _K~0~_ is
based on the numerology of PDSCH, and and are the subcarrier spacing
configurations for PDSCH and PDCCH, respectively, and
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}$ are the $N_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset,_ for the cell receiving the PDCCH
respectively,$\ N_{\text{slot,\ offset,\
}\text{PD}\text{S}\text{CH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDSCH}}$ are the $N_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDSCH, as defined
in clause 4.5 of [4, TS 38.211].
\- The reference point _S~0~_ for starting symbol _S_ is defined as:
> \- if configured with _referenceOfSLIVDCI-1-2_ , and when receiving PDSCH
> scheduled by DCI format 1_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, CS-
> RNTI with _K~0~=0_ , and PDSCH mapping Type B, the starting symbol _S_ is
> relative to the starting symbol _S~0~_ of the PDCCH monitoring occasion
> where DCI format 1_2 is detected; when the PDCCH reception includes two
> PDCCH candidates from two respective search space sets, as described in
> clause 10.1 of [6, TS 38.213], the PDCCH candidate that starts later in time
> is used for the purpose of determining the starting symbol _S~0~_ ;
\- otherwise, the starting symbol _S_ is relative to the start of the slot
using _S~0~=0._
\- The number of consecutive symbols _L_ counting from the starting symbol _S_
allocated for the PDSCH are determined from the start and length indicator
_SLIV_ :
if then
else
where, and
\- the PDSCH mapping type is set to Type A or Type B as defined in Clause
7.4.1.1.2 of [4, TS 38.211].
The UE shall consider the _S_ and _L_ combinations defined in table 5.1.2.1-1
satisfying for normal cyclic prefix and for extended cyclic prefix as valid
PDSCH allocations:
Table 5.1.2.1-1: Valid _S_ and _L_ combinations
+---------+---------+---------+---------+---------+---------+---------+ | PDSCH | Normal | E | | | | | | mapping | cyclic | xtended | | | | | | type | prefix | cyclic | | | | | | | | prefix | | | | | +=========+=========+=========+=========+=========+=========+=========+ | | _S_ | _L_ | _S+L_ | _S_ | _L_ | _S+L_ | +---------+---------+---------+---------+---------+---------+---------+ | Type A | {0 | {3, | {3, | {0 | {3, | {3, | | | ,1,2,3} | ...,14} | ...,14} | ,1,2,3} | ...,12} | ...,12} | | | | | | | | | | | (Note | | | (Note | | | | | 1) | | | 1) | | | +---------+---------+---------+---------+---------+---------+---------+ | Type B | {0, | {2, | {2, | {0, | {2,4,6} | {2, | | | ...,12} | ...,13} | ...,14} | ...,10} | | ...,12} | +---------+---------+---------+---------+---------+---------+---------+ | Note 1: | | | | | | | | S = 3 | | | | | | | | is | | | | | | | | app | | | | | | | | licable | | | | | | | | only if | | | | | | | | _dmrs-T | | | | | | | | ypeA-Po | | | | | | | | sition_ | | | | | | | | = 3 | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
When configured with SCS **μ = 5 or μ = 6, t** _he_ UE does not expect to be
scheduled with more than one unicast PDSCH in a slot, by a single DCI
scheduling multiple PDSCHs or by multiple DCIs, where multiple DCIs are not
associated with CORESETs having different _coresetpoolIndex_.
When receiving PDSCH scheduled by DCI format 1_1, 1_2 or 1_3 in PDCCH with CRC
scrambled by C-RNTI, MCS-C-RNTI, or scheduled by DCI format 1_1 or 1_2 in
PDCCH with CRC scrambled by CS-RNTI with NDI=1, if the UE is configured with
_pdsch-AggregationFactor_ in _pdsch-config_ , the same symbol allocation is
applied across the _pdsch-AggregationFactor_ consecutive slots. When receiving
PDSCH scheduled by DCI format 1_1 or 1_2 in PDCCH with CRC scrambled by CS-
RNTI with NDI=0, or PDSCH scheduled without corresponding PDCCH transmission
using _sps-Config_ and activated by DCI format 1_1 or 1_2, the same symbol
allocation is applied across the _pdsch-AggregationFactor_ , in _sps-Config_
if configured, or across the _pdsch-AggregationFactor_ in _pdsch-config_
otherwise, consecutive slots. The UE may expect that the TB is repeated within
each symbol allocation among each of the _pdsch-AggregationFactor_ consecutive
slots and the PDSCH is limited to a single transmission layer. For PDSCH
scheduled by DCI format 1_1 or 1_2 in PDCCH with CRC scrambled by CS-RNTI with
NDI=0, or PDSCH scheduled without corresponding PDCCH transmission using _sps-
Config_ and activated by DCI format 1_1 or 1_2, the UE is not expected to be
configured with the time duration for the reception of _pdsch-
AggregationFactor_ repetitions, in _sps-Config_ if configured, or across the
_pdsch-AggregationFactor_ in _pdsch-config_ otherwise, larger than the time
duration derived by the periodicity P obtained from the corresponding _sps-
Config_. The redundancy version to be applied on the _n_ ^th^ transmission
occasion of the TB, where _n_ = 0, 1, ..._pdsch-AggregationFactor_ -1, is
determined according to table 5.1.2.1-2 and \"_rv~id~_ indicated by the DCI
scheduling the PDSCH\" in table 5.1.2.1-2 is assumed to be 0 for PDSCH
scheduled without corresponding PDCCH transmission using _sps-Config_ and
activated by DCI format 1_1 or 1_2.
When receiving PDSCH scheduled by DCI format 4_1, or 4_2 in PDCCH with CRC
scrambled by G-RNTI for multicast, if the UE is configured with _pdsch-
AggregationFactor_ in the _MBS-RNTI-SpecificConfig_ associated with the
corresponding G-RNTI for multicast, the same symbol allocation is applied
across the _pdsch-AggregationFactor_ consecutive slots. When receiving PDSCH
scheduled by DCI format 4_1 or 4_2 for multicast reception in PDCCH with CRC
scrambled by G-CS-RNTI, or PDSCH without corresponding PDCCH transmission
using associated _SPS-Config_ and activated by the DCI format 4_1 or 4_2 in
PDCCH with CRC scrambled by G-CS-RNTI, the same symbol allocation is applied
across the _pdsch-AggregationFactor_ , in associated _SPS-Config_ if
configured, or 1 otherwise, consecutive slots. The redundancy version to be
applied on the _n_ th transmission occasion of the TB, where _n_ = 0, 1,
..._pdsch-AggregationFactor_ -1, is determined according to table 5.1.2.1-2
and \"rvid indicated by the DCI scheduling the PDSCH\" in table 5.1.2.1-2 is
assumed to be 0 for PDSCH scheduled without corresponding PDCCH transmission
using _SPS-Config_ and activated by DCI format 4_1 or 4_2. When receiving
PDSCH scheduled by DCI format 4_0 in PDCCH with CRC scrambled by G-RNTI for
broadcast, if the UE is configured with _pdsch-AggregationFactor_ in the
_PDSCH-ConfigPTM_ , the same symbol allocation is applied across the _pdsch-
AggregationFactor_ consecutive slots, and the redundancy version to be applied
on the _nth_ transmission occasion of the TB, where _n_ = 0, 1, ..._pdsch-
AggregationFactor_ -1, is determined according to table 5.1.2.1-2.
When receiving PDSCH scheduled by DCI in PDCCH with CRC scrambled by G-CS-RNTI
for multicast reception or G-RNTI, if the DCI field \'Time domain resource
assignment\' indicates an entry _which contains repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ in the _pdsch-ConfigMulticast_ or _PDSCH-Config-
Broadcast_ , the same SLIV is applied for all PDSCH transmission occasions
across the _repetitionNumber_ consecutive slots. When receiving PDSCH
scheduled without corresponding PDCCH transmission using associated _SPS-
Config_ and activated by DCI in PDCCH with CRC scrambled by G-CS-RNTI for
multicast reception, if the DCI field \'Time domain resource assignment\' of
the activating DCI indicates an entry _which contains repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation_ in the _pdsch-ConfigMulticast_ , the same
SLIV is applied for all PDSCH transmission occasions across the
_repetitionNumber_ consecutive slots.
_If a UE is configured with higher layer parameter repetitionNumber or if the
UE is configured by repetitionScheme set to one of \' fdmSchemeA\', \'
fdmSchemeB\' and \'tdmSchemeA\', the_ UE does not expect to be configured with
_pdsch-AggregationFactor for the same PDSCH_.
If a UE is configured with _pdsch-TimeDomainAllocationListForMultiPDSCH in
which one or more rows contain multiple SLIVs for PDSCH_ , the UE does not
expect to be configured with higher layer parameter _repetitionNumber_ in
_pdsch-TimeDomainAllocationListForMultiPDSCH_.
If a UE is configured with _pdsch-TimeDomainAllocationListForMultiPDSCH_ in
which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a
serving cell, the UE does not apply _pdsch-AggregationFactor_ in _PDSCH-
config_ , if configured, to DCI format 1_1 on the DL BWP of the serving cell.
If a UE is configured with _pdsch-TimeDomainAllocationListForMultiPDSCH_ in
which one or more rows contain multiple _SLIV_ s for PDSCH on a DL BWP of a
serving cell, when any two DL DCIs end in the same symbol and at least one of
the DCIs schedules multiple PDSCHs, the UE does not expect that the scheduled
PDSCH(s) by the two DCIs have overlapping spans, where the span associated
with a DCI is defined from the beginning of the first scheduled PDSCH or up to
the end of the last scheduled PDSCH.
If a UE is configured with _pdsch-TimeDomainAllocationListForMultiPDSCH in
which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a
serving cell within a PUCCH group_ , the UE does not expect to be configured
with higher layer parameter _ScheduledCell-ListDCI-1-3_ on any serving cell
within the PUCCH group.
Table 5.1.2.1-2: Applied redundancy version when _pdsch-AggregationFactor_ is
present
_rv~id\ ~_ indicated by the DCI scheduling the PDSCH _rv~id~_ to be applied to
_n_ ^th^ transmission occasion
* * *
                                                        *n* mod 4 = 0                                             *n* mod 4 = 1   *n* mod 4 = 2   *n* mod 4 = 3
0 0 2 3 1 2 2 3 1 0 3 3 1 0 2 1 1 0 2 3
A PDSCH reception in a slot of a multi-slot PDSCH reception is omitted
according to the conditions in clause 11.1 and clause 17.2 of [6, TS38.213].
The UE is not expected to receive a PDSCH with mapping type A in a slot, if
the PDCCH scheduling the PDSCH was received in the same slot and was not
contained within the first three symbols of the slot. When the PDCCH reception
includes two PDCCH candidates from two respective search space sets, as
described in clause 10.1 of [6, TS 38.213], if the two PDCCH candidates
scheduling the PDSCH with mapping Type A were received in the same slot as the
PDSCH, **_both PDCCH candidates are expected to be contained within the first
three symbols of the slot._**
The UE is not expected to receive a PDSCH with mapping type B in a slot, if
the first symbol of the PDCCH scheduling the PDSCH was received in a later
symbol than the first symbol indicated in the PDSCH time domain resource
allocation. When the PDCCH reception includes two PDCCH candidates from two
respective search space sets, as described in clause 10.1 of [6, TS 38.213],
the UE is not expected to receive a PDSCH with mapping type B in a slot, if
the first symbol of the PDCCH candidate that starts later in time scheduling
the PDSCH was received in a later symbol than the first symbol indicated in
the PDSCH time domain resource allocation.
When the UE is configured with _minimumSchedulingOffsetK0_ in an active DL BWP
it applies a minimum scheduling offset restriction indicated by the \'Minimum
applicable scheduling offset indicator\' field in DCI format 0_1, 0_3, 1_1 or
1_3, if the same field is available. When the UE is configured with
_minimumSchedulingOffsetK0_ in an active DL BWP and it has not received
\'Minimum applicable scheduling offset indicator\' field in DCI format 0_1,
0_3, 1_1 or 1_3, the UE shall apply a minimum scheduling offset restriction
indicated based on \'Minimum applicable scheduling offset indicator\' value
\'0\'. When the _minimum scheduling offset restriction_ is applied the UE is
not expected to be scheduled with a DCI in slot _n_ to receive a PDSCH
scheduled with C-RNTI, CS-RNTI or MCS-C-RNTI with _K_ ~0~ smaller than $\
\left\lceil K_{0min} \cdot \frac{2^{\mu^{'}}}{2^{\mu}} \right\rceil$, where
_K_ ~0min~ and $\mu$ are the applied minimum scheduling offset restriction and
the numerology of the active DL BWP of the scheduled cell when receiving the
DCI in slot _n,_ respectively, and $\mu^{'}$ is the numerology of the new
active DL BWP in case of active DL BWP change in the scheduled cell and is
equal to $\mu$, otherwise. The minimum scheduling offset restriction is not
applied when PDSCH transmission is scheduled with C-RNTI, CS-RNTI or MCS-C-
RNTI in common search space associated with CORESET0 and default PDSCH time
domain resource allocation is used, in the search space set provided by
_recoverySearchSpaceId_ when monitoring PDCCH as described in [6, TS 38.213]
or when PDSCH transmission is scheduled with SI-RNTI, MSGB-RNTI or RA-RNTI.
The application delay of the change of the minimum scheduling offset
restriction is determined in Clause 5.3.1.
The UE is not expected to be configured with _referenceOfSLIVDCI-1-2_ for
serving cells configured for cross-carrier scheduling with a scheduling cell
of a different downlink SCS configuration.
When a UE is configured by the higher layer parameter _repetitionScheme_ set
to \'_tdmSchemeA\'_ and indicated DM-RS port(s) within one CDM group in the
DCI field \'_Antenna Port(s)\'_ , the number of PDSCH transmission occasions
is derived by the number of TCI states indicated by the DCI field
_\'Transmission Configuration Indication\'_ of the scheduling DCI _._
\- If two TCI states are indicated by the DCI field \'_Transmission
Configuration Indication_ \', the UE is expected to receive two PDSCH
transmission occasions, where the first TCI state is applied to the first
PDSCH transmission occasion and resource allocation in time domain for the
first PDSCH transmission occasion follows Clause 5.1.2.1. The second TCI state
is applied to the second PDSCH transmission occasion, and the second PDSCH
transmission occasion shall have the same number of symbols as the first PDSCH
transmission occasion. If the UE is configured by the higher layers with a
value$\ \overline{K}$ in _StartingSymbolOffsetK_ , it shall determine that the
first symbol of the second PDSCH transmission occasion starts after
$\overline{K}$ symbols from the last symbol of the first PDSCH transmission
occasion. If the value$\ \overline{K}$ is not configured via the higher layer
parameter _StartingSymbolOffsetK_ , $\overline{K}$ = 0 shall be assumed by the
UE. The UE is not expected to receive more than two PDSCH transmission layers
for each PDSCH transmission occasion. For two PDSCH transmission occasions,
the redundancy version to be applied is derived according to Table 5.1.2.1-2,
where $n = 0,\ 1$ applied respectively to the first and second TCI state. The
UE expects the PDSCH mapping type indicated by DCI field \'_Time domain
resource assignment_ \' to be mapping type B, and the indicated PDSCH mapping
type is applied to both PDSCH transmission occasions.
\- Otherwise, the UE is expected to receive a single PDSCH transmission
occasion, and the resource allocation in the time domain follows Clause
5.1.2.1.
When a UE configured by the higher layer parameter _PDSCH-config_ that
indicates at least one entry _contains_ _repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ ,
\- If two TCI states are indicated by the DCI field \'Transmission
Configuration Indication\' together with the DCI field \'Time domain resource
assignment\' indicating an entry _which contains repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ and DM-RS port(s) within one CDM group in the
DCI field \'Antenna Port(s)\', the same SLIV is applied for all PDSCH
transmission occasions across the _repetitionNumber_ consecutive slots, the
first TCI state is applied to the first PDSCH transmission occasion and
resource allocation in time domain for the first PDSCH transmission occasion
follows Clause 5.1.2.1.
When the value indicated by _repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ equals to two, the second TCI state is applied
to the second PDSCH transmission occasion. When the value indicated by
_repetitionNumber_ in _PDSCH-TimeDomainResourceAllocation_ is larger than two,
the UE may be further configured to enable _cyclicMapping_ or
_sequenticalMapping_ in _tciMapping_.
\- When _cyclicMapping_ is enabled, the first and second TCI states are
applied to the first and second PDSCH transmission occasions, respectively,
and the same TCI mapping pattern continues to the remaining PDSCH transmission
occasions.
\- When _sequenticalMapping_ is enabled, first TCI state is applied to the
first and second PDSCH transmission occasions, and the second TCI state is
applied to the third and fourth PDSCH transmission occasions, and the same TCI
mapping pattern continues to the remaining PDSCH transmission occasions.
The UE may expect that each PDSCH transmission occasion is limited to two
transmission layers. For all PDSCH transmission occasions associated with the
first TCI state, the redundancy version to be applied is derived according to
Table 5.1.2.1-2, where $n$ is counted only considering PDSCH transmission
occasions associated with the first TCI state. The redundancy version for
PDSCH transmission occasions associated with the second TCI state is derived
according to Table 5.1.2.1-3, where additional shifting operation for each
redundancy version $\text{rv}_{s}\ $is configured by higher layer parameter
_sequenceOffsetforRV_ and $n$ is counted only considering PDSCH transmission
occasions associated with the second TCI state.
Table 5.1.2.1-3: Applied redundancy version for the second TCI state when
_sequenceOffsetforRV_ is present
_rv~id\ ~_ indicated by the DCI scheduling the PDSCH _rv~id~_ to be applied to
_n_ ^th^ transmission occasion with second TCI state
* * *
                                                        *n* mod 4 = 0                                                                   *n* mod 4 = 1                              *n* mod 4 = 2                              *n* mod 4 = 3
$$0$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(2 + \ \text{rv}_{s})\
\text{mod}\ 4$$ $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(1 + \
\text{rv}_{s})\ \text{mod}\ 4$$ $$2$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$
$$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(1 + \ \text{rv}_{s})\ \text{mod}\
4$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$3$$ $$(3 + \ \text{rv}_{s})\
\text{mod}\ 4$$ $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(0 + \
\text{rv}_{s})\ \text{mod}\ 4$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$1$$
$$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\
4$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(3 + \ \text{rv}_{s})\
\text{mod}\ 4$$
\- If one TCI state is indicated by the DCI field \'Transmission Configuration
Indication\' together with the DCI field \'Time domain resource assignment\'
indicating an entry _which contains repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ and DM-RS port(s) within one CDM group in the
DCI field \'Antenna Port(s)\', the same SLIV is applied for all PDSCH
transmission occasions across the _repetitionNumber_ consecutive slots, the
first PDSCH transmission occasion follows Clause 5.1.2.1, the same TCI state
is applied to all PDSCH transmission occasions. The UE may expect that each
PDSCH transmission occasion is limited to two transmission layers. For all
PDSCH transmission occasions, the redundancy version to be applied is derived
according to Table 5.1.2.1-2, where $n$ is counted considering PDSCH
transmission occasions.
\- Otherwise, the UE is expected to receive a single PDSCH transmission
occasion, and the resource allocation in the time domain follows Clause
5.1.2.1.
For _pdsch-TimeDomainAllocationListForMultiPDSCH_ in _pdsch-Config_ each PDSCH
has a separate SLIV, mapping type and _K~0~_. The number of scheduled PDSCHs
is signalled by the number of indicated SLIVs in the row of the _pdsch-
TimeDomainAllocationListForMultiPDSCH_ signalled in DCI format 1_1.
If a UE is configured with _pdsch-TimeDomainAllocationListForMultiPDSCH_ in
which one or more rows contain multiple _SLIV_ s for PDSCH on a DL BWP of a
serving cell, and the UE is indicated re-transmission of PDSCH corresponding
to a DL SPS by DCI format 1_1, the UE does not expect that the number of
indicated _SLIV_ s in the row of **the** _pdsch-
TimeDomainAllocationListForMultiPDSCH by the DCI_ **is** more than one.
##### 5.1.2.1.1 Determination of the resource allocation table to be used for
PDSCH
Table 5.1.2.1.1-1 and Table 5.1.2.1.1-1A define which PDSCH time domain
resource allocation configuration to apply. Either a default PDSCH time domain
allocation A, B or C according to tables 5.1.2.1.1-2, 5.1.2.1.1-3, 5.1.2.1.1-4
and 5.1.2.1.1-5 is applied, or the higher layer configured _pdsch-
TimeDomainAllocationList_ or _pdsch-TimeDomainAllocationListForMultiPDSCH_ or
_pdsch-TimeDomainAllocationListDCI-1-2_ is applied. For operation with shared
spectrum channel access in frequency range 1, as described in [16, TS 37.213],
UE reinterprets _S_ and _L_ in row 9 of Table 5.1.2.1.1-2 as _S=6_ and _L=7_.
Table 5.1.2.1.1-1: Applicable PDSCH time domain resource allocation for DCI
formats 1_0, 1_1, 1_3, 4_0, 4_1 and 4_2
+-------+-------+-------+-------+-------+-------+-------+-------+ | **R | ** |** SS | ** | * | **_p |_** PD | ** | | NTI**| PDCCH | /PBCH |_PDSC |**PDS | dsch- | SCH-C | PDSCH | | | s | block | H-Con | CH-Co | Confi | onfig | time | | | earch | and | figCo | nfig _| gMCCH | inc | d | | | sp | CO | mmon_ | inc | / | ludes | omain | | | ace** | RESET | inc | ludes | pd | p | res | | | | mu | ludes | _pds | sch-C | dsch- | ource | | | | ltipl |_ pds | ch-Ti | onfig | TimeD | alloc | | | | exing | ch-Ti | meDom | MTCH _| omain | ation | | | | patt | meDom | ainAl | inc | Alloc | to | | | | ern_ _| ainAl | locat | ludes | ation | ap | | | | | locat | ionLi |_ pds | ListF | ply** | | | | | ionLi | st_** | ch-Ti | orMul | | | | | | st** _| | meDom | tiPDS | | | | | | | | ainAl | CH_** | | | | | | | | locat | | | | | | | | | ionLi | | | | | | | | | st** _| | | | | | | | | | | | | | | | | | *** | | | | | | | | | Or_** | | | | | | | | | | | | | | | | | | **_pd | | | | | | | | | sch-C | | | | | | | | | onfig | | | | | | | | | Multi | | | | | | | | | cast_ | | | | | | | | | inc | | | | | | | | | ludes | | | | | | | | | *pds | | | | | | | | | ch-Ti | | | | | | | | | meDom | | | | | | | | | ainAl | | | | | | | | | locat | | | | | | | | | ionLi | | | | | | | | | st** _| | | +=======+=======+=======+=======+=======+=======+=======+=======+ | SI | Type0 | 1 | - | - | - |_ -_| De | | -RNTI | c | | | | | | fault | | | ommon | | | | | | A for | | | | | | | | | n | | | | | | | | | ormal | | | | | | | | | CP | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 2 | - | - | - |_ -_| De | | | | | | | | | fault | | | | | | | | | B | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 3 | - | - | - |_ -_| De | | | | | | | | | fault | | | | | | | | | C | +-------+-------+-------+-------+-------+-------+-------+-------+ | SI | T | 1 | No | - | - |_ -_| De | | -RNTI | ype0A | | | | | | fault | | | c | | | | | | A | | | ommon | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 2 | No | - | - |_ -_| De | | | | | | | | | fault | | | | | | | | | B | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 3 | No | - | - |_ -_| De | | | | | | | | | fault | | | | | | | | | C | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | Yes | - | - |_ -_|_ P | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List _| | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | |_ PDSC | | | | | | | | | H-Con | | | | | | | | | figCo | | | | | | | | | mmon _| +-------+-------+-------+-------+-------+-------+-------+-------+ | RA- | Type1 | 1,2,3 | No | - | - |_ -_| De | | RNTI, | c | | | | | | fault | | MSGB- | ommon | | | | | | A | | RNTI, | | | | | | | | | TC | | | | | | | | | -RNTI | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | Yes | - | - |_ -_|_ P | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List _| | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | |_ PDSC | | | | | | | | | H-Con | | | | | | | | | figCo | | | | | | | | | mmon _| +-------+-------+-------+-------+-------+-------+-------+-------+ | P | Type2 | 1 | No | - | - |_ -_| De | | -RNTI | c | | | | | | fault | | | ommon | | | | | | A | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 2 | No | - | - |_ -_| De | | | | | | | | | fault | | | | | | | | | B | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 3 | No | - | - |_ -_| De | | | | | | | | | fault | | | | | | | | | C | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | Yes | - | - |_ -_|_ P | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List _| | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | |_ PDSC | | | | | | | | | H-Con | | | | | | | | | figCo | | | | | | | | | mmon _| +-------+-------+-------+-------+-------+-------+-------+-------+ | MCCH | Type | 1 | No | - | No |_ -_| De | | -RNTI | 0 | | | | | | fault | | | /0B/3 | | | | | | A | | | c | | | | | | | | | ommon | | | | | | | | | for | | | | | | | | | broa | | | | | | | | | dcast | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 2 | No | - | No |_ -_| De | | | | | | | | | fault | | | | | | | | | B | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 3 | No | - | No |_ -_| De | | | | | | | | | fault | | | | | | | | | C | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | Yes | - |_ No _|_ -_|_ p | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List _| | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | |_ PDSC | | | | | | | | | H-Con | | | | | | | | | figCo | | | | | | | | | mmon _| +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | N | - |_ Yes _|_ -_| * | | | | | o/Yes | | | | pdsch | | | | | | | | | -Time | | | | | | | | | Domai | | | | | | | | | nAllo | | | | | | | | | catio | | | | | | | | | nList | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | pd | | | | | | | | | sch-C | | | | | | | | | onfig | | | | | | | | | MCCH_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | G | Type | 1 | No | - | No | _-_ | De | | -RNTI | 0 | | | | | | fault | | for | /0B/3 | | | | | | A | | broa | c | | | | | | | | dcast | ommon | | | | | | | | | for | | | | | | | | | broa | | | | | | | | | dcast | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 2 | No | - | No | _-_ | De | | | | | | | | | fault | | | | | | | | | B | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 3 | No | - | No | _-_ | De | | | | | | | | | fault | | | | | | | | | C | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | Yes | - | _No_ | _-_ | _p | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _PDSC | | | | | | | | | H-Con | | | | | | | | | figCo | | | | | | | | | mmon_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | N | - | _Yes_ | _-_ | _p | | | | | o/Yes | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _pds | | | | | | | | | ch-Co | | | | | | | | | nfigM | | | | | | | | | TCH,_ | | | | | | | | | if | | | | | | | | | c | | | | | | | | | onfig | | | | | | | | | ured, | | | | | | | | | othe | | | | | | | | | rwise | | | | | | | | | _p | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _pd | | | | | | | | | sch-C | | | | | | | | | onfig | | | | | | | | | MCCH_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | C- | Any | 1, 2, | No | - | - | - | De | | RNTI, | c | 3 | | | | | fault | | M | ommon | | | | | | A | | CS-C- | s | | | | | | | | RNTI, | earch | | | | | | | | CS | space | | | | | | | | -RNTI | assoc | | | | | | | | | iated | | | | | | | | | with | | | | | | | | | CO | | | | | | | | | RESET | | | | | | | | | 0 | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1, 2, | Yes | - | - | _-_ | _p | | | | 3 | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _PDSC | | | | | | | | | H-Con | | | | | | | | | figCo | | | | | | | | | mmon_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | C- | Any | 1,2,3 | No | No | - | - | De | | RNTI, | c | | | | | | fault | | M | ommon | | | | | | A | | CS-C- | s | | | | | | | | RNTI, | earch | | | | | | | | CS | space | | | | | | | | -RNTI | not | | | | | | | | | assoc | | | | | | | | | iated | | | | | | | | | with | | | | | | | | | CO | | | | | | | | | RESET | | | | | | | | | 0 | | | | | | | | | | | | | | | | | | UE | | | | | | | | | spe | | | | | | | | | cific | | | | | | | | | s | | | | | | | | | earch | | | | | | | | | space | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | Yes | No | - | _-_ | _p | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _PDSC | | | | | | | | | H-Con | | | | | | | | | figCo | | | | | | | | | mmon_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | N | Yes | - | _-_ | _p | | | | | o/Yes | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _PDS | | | | | | | | | CH-Co | | | | | | | | | nfig_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | N | - | - | Yes | _pdsc | | | | | o/Yes | | | | h-Tim | | | | | | | | | eDoma | | | | | | | | | inAll | | | | | | | | | ocati | | | | | | | | | onLis | | | | | | | | | tForM | | | | | | | | | ultiP | | | | | | | | | DSCH_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _PD | | | | | | | | | SCH-C | | | | | | | | | onfig | | | | | | | | | (Note | | | | | | | | | 2)_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | G | Type | 1,2,3 | No | - | _No_ | - | _De | | -RNTI | 3 | | | | | | fault | | for | c | | | | | | A_ | | multi | ommon | | | | | | | | cast, | s | | | | | | | | G-CS | earch | | | | | | | | -RNTI | space | | | | | | | | | for | | | | | | | | | mult | | | | | | | | | icast | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | Yes | - | _No_ | - | _p | | | | | | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _PDS | | | | | | | | | CH-Co | | | | | | | | | nfigC | | | | | | | | | ommon | | | | | | | | | (Note | | | | | | | | | 1)_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | 1,2,3 | N | - | _Yes_ | - | _p | | | | | o/Yes | | | | dsch- | | | | | | | | | TimeD | | | | | | | | | omain | | | | | | | | | Alloc | | | | | | | | | ation | | | | | | | | | List_ | | | | | | | | | pro | | | | | | | | | vided | | | | | | | | | in | | | | | | | | | _pd | | | | | | | | | sch-C | | | | | | | | | onfig | | | | | | | | | Multi | | | | | | | | | cast_ | | | | | | | | | | | | | | | | | | * | | | | | | | | | (Note | | | | | | | | | 1)_| +-------+-------+-------+-------+-------+-------+-------+-------+ | Note | | | | | | | | | 1: | | | | | | | | | For a | | | | | | | | | UE | | | | | | | | | that | | | | | | | | | sup | | | | | | | | | ports | | | | | | | | | multi | | | | | | | | | cast, | | | | | | | | | the | | | | | | | | | same | | | | | | | | | TDRA | | | | | | | | | table | | | | | | | | | ap | | | | | | | | | plies | | | | | | | | | to | | | | | | | | | all | | | | | | | | | G- | | | | | | | | | RNTIs | | | | | | | | | and | | | | | | | | | G-CS- | | | | | | | | | RNTIs | | | | | | | | | ( | | | | | | | | | confi | | | | | | | | | gured | | | | | | | | | for | | | | | | | | | multi | | | | | | | | | cast) | | | | | | | | | if | | | | | | | | | confi | | | | | | | | | gured | | | | | | | | | on a | | | | | | | | | given | | | | | | | | | se | | | | | | | | | rving | | | | | | | | | cell. | | | | | | | | | | | | | | | | | | Note | | | | | | | | | 2: If | | | | | | | | |_ pdsc | | | | | | | | | h-Tim | | | | | | | | | eDoma | | | | | | | | | inAll | | | | | | | | | ocati | | | | | | | | | onLis | | | | | | | | | tForM | | | | | | | | | ultiP | | | | | | | | | DSCH* | | | | | | | | | is | | | | | | | | | prov | | | | | | | | | ided, | | | | | | | | | it is | | | | | | | | | appli | | | | | | | | | cable | | | | | | | | | to | | | | | | | | | DCI | | | | | | | | | f | | | | | | | | | ormat | | | | | | | | | 1_1 | | | | | | | | | only. | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+
Table 5.1.2.1.1-1A: Applicable PDSCH time domain resource allocation for DCI
format 1_2
_PDSCH-ConfigCommon_ includes _pdsch-TimeDomainAllocationList_ _PDSCH-Config
includes pdsch-TimeDomainAllocationList_ _PDSCH-Config_ includes _pdsch-
TimeDomainAllocationListDCI-1-2_ PDSCH time domain resource allocation to
apply
* * *
No No No Default A Yes No No _pdsch-TimeDomainAllocationList_ provided in
_PDSCH-ConfigCommon_ No/Yes Yes No _pdsch-TimeDomainAllocationList_ provided
in _PDSCH-Config_ No/Yes No/Yes Yes _pdsch-TimeDomainAllocationListDCI-1-2_
provided in _PDSCH-Config_
Table 5.1.2.1.1-2: Default PDSCH time domain resource allocation A for normal
CP
Row index _dmrs-TypeA-Position_ PDSCH mapping type _K~0~_ _S_ _L_
* * *
1 2 Type A 0 2 12 3 Type A 0 3 11 2 2 Type A 0 2 10 3 Type A 0 3 9 3 2 Type A
0 2 9 3 Type A 0 3 8 4 2 Type A 0 2 7 3 Type A 0 3 6 5 2 Type A 0 2 5 3 Type A
0 3 4 6 2 Type B 0 9 4 3 Type B 0 10 4 7 2 Type B 0 4 4 3 Type B 0 6 4 8 2,3
Type B 0 5 7 9 2,3 Type B 0 5 2 10 2,3 Type B 0 9 2 11 2,3 Type B 0 12 2 12
2,3 Type A 0 1 13 13 2,3 Type A 0 1 6 14 2,3 Type A 0 2 4 15 2,3 Type B 0 4 7
16 2,3 Type B 0 8 4
Table 5.1.2.1.1-3: Default PDSCH time domain resource allocation A for
extended CP
Row index _dmrs-TypeA-Position_ PDSCH mapping type _K~0~_ _S_ _L_
* * *
1 2 Type A 0 2 6 3 Type A 0 3 5 2 2 Type A 0 2 10 3 Type A 0 3 9 3 2 Type A 0
2 9 3 Type A 0 3 8 4 2 Type A 0 2 7 3 Type A 0 3 6 5 2 Type A 0 2 5 3 Type A 0
3 4 6 2 Type B 0 6 4 3 Type B 0 8 2 7 2 Type B 0 4 4 3 Type B 0 6 4 8 2,3 Type
B 0 5 6 9 2,3 Type B 0 5 2 10 2,3 Type B 0 9 2 11 2,3 Type B 0 10 2 12 2,3
Type A 0 1 11 13 2,3 Type A 0 1 6 14 2,3 Type A 0 2 4 15 2,3 Type B 0 4 6 16
2,3 Type B 0 8 4
Table 5.1.2.1.1-4: Default PDSCH time domain resource allocation B
**Row index** **_dmrs-TypeA-Position_** **PDSCH mapping type** **_K~0~_**
**_S_** **_L_**
* * *
1 2,3 Type B 0 2 2 2 2,3 Type B 0 4 2 3 2,3 Type B 0 6 2 4 2,3 Type B 0 8 2 5
2,3 Type B 0 10 2 6 2,3 Type B 1 2 2 7 2,3 Type B 1 4 2 8 2,3 Type B 0 2 4 9
2,3 Type B 0 4 4 10 2,3 Type B 0 6 4 11 2,3 Type B 0 8 4 12 (Note 1) 2,3 Type
B 0 10 4 13 (Note 1) 2,3 Type B 0 2 7 14 (Note 1) 2 Type A 0 2 12 3 Type A 0 3
11 15 2,3 Type B 1 2 4 16 Reserved  
Note 1: If the PDSCH was scheduled with SI-RNTI in PDCCH Type0 common search
space, the UE may assume that this PDSCH resource allocation is not applied
Table 5.1.2.1.1-5: Default PDSCH time domain resource allocation C
+----------+----------+----------+----------+---------+---------+ | **Row | * |** PDSCH | ** | **_S_** | **_L_** | | index**|** dmrs-T | mapping | _K~0~_**| | | | | ypeA-Pos | type** | | | | | | ition*** | | | | | +==========+==========+==========+==========+=========+=========+ | 1 (Note | 2,3 | Type B | 0 | 2 | 2 | | 1) | | | | | | +----------+----------+----------+----------+---------+---------+ | 2 | 2,3 | Type B | 0 | 4 | 2 | +----------+----------+----------+----------+---------+---------+ | 3 | 2,3 | Type B | 0 | 6 | 2 | +----------+----------+----------+----------+---------+---------+ | 4 | 2,3 | Type B | 0 | 8 | 2 | +----------+----------+----------+----------+---------+---------+ | 5 | 2,3 | Type B | 0 | 10 | 2 | +----------+----------+----------+----------+---------+---------+ | 6 (Note | 2,3 | Type B | 0 | 11 | 2 | | 2) | | | | | | +----------+----------+----------+----------+---------+---------+ | 7 | Reserved | | | | | +----------+----------+----------+----------+---------+---------+ | 8 | 2,3 | Type B | 0 | 2 | 4 | +----------+----------+----------+----------+---------+---------+ | 9 | 2,3 | Type B | 0 | 4 | 4 | +----------+----------+----------+----------+---------+---------+ | 10 | 2,3 | Type B | 0 | 6 | 4 | +----------+----------+----------+----------+---------+---------+ | 11 | 2,3 | Type B | 0 | 8 | 4 | +----------+----------+----------+----------+---------+---------+ | 12 | 2,3 | Type B | 0 | 10 | 4 | +----------+----------+----------+----------+---------+---------+ | 13 (Note | 2,3 | Type B | 0 | 2 | 7 | | 1) | | | | | | +----------+----------+----------+----------+---------+---------+ | 14 (Note | 2 | Type A | 0 | 2 | 12 | | 1) | | | | | | +----------+----------+----------+----------+---------+---------+ | | 3 | Type A | 0 | 3 | 11 | +----------+----------+----------+----------+---------+---------+ | 15 (Note | 2,3 | Type A | 0 | 0 | 6 | | 1) | | | | | | +----------+----------+----------+----------+---------+---------+ | 16 (Note | 2,3 | Type A | 0 | 2 | 6 | | 1) | | | | | | +----------+----------+----------+----------+---------+---------+ | Note 1: | | | | | | | The UE | | | | | | | may | | | | | | | assume | | | | | | | that | | | | | | | this | | | | | | | PDSCH | | | | | | | resource | | | | | | | al | | | | | | | location | | | | | | | is not | | | | | | | used, if | | | | | | | the | | | | | | | PDSCH | | | | | | | was | | | | | | | s | | | | | | | cheduled | | | | | | | with | | | | | | | SI-RNTI | | | | | | | in PDCCH | | | | | | | Type0 | | | | | | | common | | | | | | | search | | | | | | | space | | | | | | | | | | | | | | Note 2: | | | | | | | This | | | | | | | applies | | | | | | | for Case | | | | | | | F and | | | | | | | Case G | | | | | | | c | | | | | | | andidate | | | | | | | SS/PBCH | | | | | | | block | | | | | | | pattern | | | | | | | d | | | | | | | escribed | | | | | | | in | | | | | | | clause 4 | | | | | | | of [6, | | | | | | | TS | | | | | | | 38.213] | | | | | | +----------+----------+----------+----------+---------+---------+
#### 5.1.2.2 Resource allocation in frequency domain
Two downlink resource allocation schemes, type 0 and type 1, are supported.
The UE shall assume that when the scheduling grant is received with DCI format
1_0, 4_0 or 4_1 then downlink resource allocation type 1 is used.
If the scheduling DCI is configured to indicate the downlink resource
allocation type as part of the \'_Frequency domain resource assignment\'_
field by setting a higher layer parameter _resourceAllocation_ in _PDSCH-
Config_ to \'dynamicSwitch\', for DCI format 1_1 or setting a higher layer
parameter _resourceAllocationDCI-1-2_ in _PDSCH-Config_ to \'dynamicSwitch\'
for DCI format 1_2 or setting a higher layer parameter
_resourceAllocationDCI-1-3_ in _PDSCH-Config_ to \'dynamicSwitch\' for DCI
format 1_3 or setting a higher layer parameter _resourceAllocation_ in _pdsch-
ConfigMulticast_ to \'dynamicSwitch\' for DCI format 4_2, the UE shall use
downlink resource allocation type 0 or type 1 as defined by this DCI field.
Otherwise the UE shall use the downlink frequency resource allocation type as
defined by the higher layer parameter _resourceAllocation_ in _PDSCH-Config_
for DCI format 1_1 or by the higher layer parameter
_resourceAllocationDCI-1-2_ for DCI format 1_2 or by the higher layer
parameter _resourceAllocationDCI-1-3_ for DCI format 1_3 or by the higher
layer parameter _resourceAllocation_ in _pdsch-ConfigMulticast_ for DCI format
4_2.
If a bandwidth part indicator field is not configured in the scheduling DCI or
the UE does not support active BWP change via DCI, the RB indexing for
downlink type 0 and type 1 resource allocation is determined within the UE\'s
active bandwidth part. If a bandwidth part indicator field is configured in
the scheduling DCI and the UE supports active BWP change via DCI, the RB
indexing for downlink type 0 and type 1 resource allocation is determined
within the UE\'s bandwidth part indicated by bandwidth part indicator field
value in the DCI. The UE shall upon detection of PDCCH intended for the UE
determine first the downlink bandwidth part and then the resource allocation
within the bandwidth part.
For a PDSCH scheduled with a DCI format 1_0 in any type of PDCCH common search
space, regardless of which bandwidth part is the active bandwidth part, RB
numbering starts from the lowest RB of the CORESET in which the DCI was
received; otherwise RB numbering starts from the lowest RB in the determined
downlink bandwidth part. When the PDCCH reception includes two PDCCH
candidates from two respective search space sets, as described in clause 10.1
of [6, TS 38.213], for the purpose of determining the downlink RB set of a
PDSCH when scheduled by DCI format 1_0, the CORESET with lower ID among two
CORESETs associated with two PDCCH candidates is used.
##### 5.1.2.2.1 Downlink resource allocation type 0
In downlink resource allocation of type 0, the resource block assignment
information includes a bitmap indicating the Resource Block Groups (RBGs) that
are allocated to the scheduled UE where a RBG is a set of consecutive virtual
resource blocks defined by higher layer parameter _rbg-Size_ configured by
_PDSCH-Config_ for DCI format 1_1 or 1_2 or by higher layer parameter _rbg-
SizeDCI-1-3_ configured by _PDSCH-Config_ for DCI format 1­_3 and the size of
the bandwidth part as defined in Table 5.1.2.2.1-1.
Table 5.1.2.2.1-1: Nominal RBG size _P_
Bandwidth Part Size Configuration 1 Configuration 2 Configuration 3
* * *
1 -- 36 2 4 8 37 -- 72 4 8 16 73 -- 144 8 16 32 145 -- 275 16 16 32
The total number of RBGs ($N_{\text{RBG}}$) for a downlink bandwidth part _i_
of size $N_{\text{BWP,i}}^{\text{size}}$ PRBs is given by $N_{\text{RBG}} =
\left\lceil \left( N_{BWP,i}^{\text{size}} + \left(
N_{BWP,i}^{\text{start}}\text{mod}P \right) \right)/P \right\rceil$, where
\- the size of the first RBG is $\text{RB}G_{0}^{\text{size}} = P -
N_{BWP,i}^{\text{start}}\text{mod}P$,
\- the size of last RBG is $\text{RB}G_{\text{last}}^{\text{size}} = \left(
N_{BWP,i}^{\text{start}} + N_{BWP,i}^{\text{size}} \right)\text{mod}P$ if
$\left( N_{BWP,i}^{\text{start}} + N_{BWP,i}^{\text{size}} \right)\text{mod}P
> 0$ and _P_ otherwise,
\- the size of all other RBGs is _P_.
In downlink resource allocation of type 0 scheduled using a DCI with CRC
scrambled by G-RNTI for multicast or G-CS-RNTI, the resource block assignment
information bitmap is calculated based on the description above with the
following changes: the parameter $N_{BWP,i}^{\text{start}}$ is the starting
PRB of the CFR, $N_{BWP,i}^{\text{size}}$ is the size of the common frequency
resource (CFR) and the value of the higher layer parameter _rbg-Size is_
configured by _pdsch-ConfigMulticast_.
The bitmap is of size bits with one bitmap bit per RBG such that each RBG is
addressable. The RBGs shall be indexed in the order of increasing frequency
and starting at the lowest frequency of the bandwidth part. The order of RBG
bitmap is such that RBG 0 to RBG are mapped from MSB to LSB. The RBG is
allocated to the UE if the corresponding bit value in the bitmap is 1, the RBG
is not allocated to the UE otherwise.
##### 5.1.2.2.2 Downlink resource allocation type 1
In downlink resource allocation of type 1, the resource block assignment
information indicates to a scheduled UE a set of contiguously allocated non-
interleaved or interleaved virtual resource blocks within the active bandwidth
part of size PRBs except for the case when DCI format 1_0 is decoded in any
common search space in which case the size of CORESET 0 shall be used if
CORESET 0 is configured for the cell and the size of initial DL bandwidth part
shall be used if CORESET 0 is not configured for the cell.
A downlink type 1 resource allocation field consists of a resource indication
value (_RIV_) corresponding to a starting virtual resource block () and a
length in terms of contiguously allocated resource blocks. The resource
indication value is defined by
if then
else
where≥ 1 and shall not exceed .
When the DCI size for DCI format 1_0 in USS is derived from the size of DCI
format 1_0 in CSS but applied to an active BWP with size of , a downlink type
1 resource block assignment field consists of a resource indication value
(_RIV_) corresponding to a starting resource block and a length in terms of
virtually contiguously allocated resource blocks , where is given by
\- the size of CORESET 0 if CORESET 0 is configured for the cell;
\- the size of initial DL bandwidth part if CORESET 0 is not configured for
the cell.
The resource indication value is defined by:
if then
else
where, and where shall not exceed .
If , _K_ is the maximum value from set {1, 2, 4, 8} which satisfies ;
otherwise _K_ = 1.
When the scheduling grant is received with DCI format 1_2 or 1_3, a downlink
type 1 resource allocation field consists of a resource indication value
(_RIV_) corresponding to a starting resource block group _RBG~start~_ =0, 1,
..., _N~RBG~_ -1 and a length in terms of virtually contiguously allocated
resource block groups _L~RBGs~_ =1, ..., _N~RBG~_ , where the resource block
groups are defined as in 5.1.2.2.1 with _P_ defined by
_resourceAllocationType1GranularityDCI-1-2_ for DCI format 1_2 and
_resourceAllocationType1GranularityDCI-1-3_ for DCI format 1_3 if the UE is
configured with higher layer parameter
_resourceAllocationType1GranularityDCI-1-2_ or
_resourceAllocationType1GranularityDCI-1-3_ , and _P=1_ otherwise _._ The
resource indication value is defined by
if then
else
where≥ 1 and shall not exceed .
##### 5.1.2.2.3 Downlink resource allocation type 1 for multicast/broadcast
In downlink resource allocation of type 1 scheduled using DCI format 4_0 or
DCI format 4_1 with CRC scrambled by G-RNTI, G-CS-RNTI or MCCH-RNTI, the
resource block assignment information indicates to a scheduled UE a set of
contiguously allocated non-interleaved or interleaved virtual resource blocks.
A downlink type 1 resource block assignment field in the DCI format 4_0 or DCI
format 4_1 consists of a _RIV_ corresponding to a starting resource block in
reference to the lowest RB of the CFR and a length in terms of virtually
contiguously allocated resource blocks L~RBs~, where is given by
\- the size of CORESET 0 if CORESET 0 is configured for the cell;
\- the size of initial DL bandwidth part if CORESET 0 is not configured for
the cell.
The resource indication value is defined by:
if then
else
where, and where shall not exceed .
If $N_{\text{CFR}} > N_{\text{BWP}}^{\text{initial}}$, _K_ is the maximum
value from set {1, 2, 4, 6, 8, 10, 12} which satisfies $K \leq \left\lfloor
N_{\text{CFR}}/N_{\text{BWP}}^{\text{initial}} \right\rfloor$; otherwise _K_ =
1.
In downlink resource allocation of type 1 scheduled using DCI format 4_2 with
CRC scrambled by G-RNTI for multicast or G-CS-RNTI, the description in clause
5.1.2.2.2 with the following changes: corresponds to a starting resource block
in reference to the lowest RB of the CFR and is the size of the CFR.
#### 5.1.2.3 Physical resource block (PRB) bundling
The PRB bundling procedures for PDSCH scheduled by PDCCH with DCI format 1_1
described in this clause equally apply to PDSCH scheduled by PDCCH with DCI
format 1_2, by applying the parameters of _prb-BundlingTypeDCI-1-2_ instead of
_prb-BundlingType_ as well as _vrb-ToPRB-InterleaverDCI-1-2_ instead of _vrb-
ToPRB-Interleaver_. The PRB bundling procedures for PDSCH scheduled by PDCCH
with DCI format 1_1 described in this clause equally apply to PDSCH scheduled
by PDCCH with DCI format 1_3. The PRB bundling procedures for PDSCH scheduled
by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH
scheduled by PDCCH with DCI format 4_2, by applying the parameters of _prb-
BundlingType_ given by _pdsch-ConfigMulticast_ as well as _vrb-ToPRB-
Interleaver_ given by _pdsch-ConfigMulticast_.
A UE may assume that precoding granularity is consecutive resource blocks in
the frequency domain. can be equal to one of the values among {2, 4,
wideband}.
If is determined as \"wideband\", the UE is not expected to be scheduled with
non-contiguous PRBs and the UE may assume that the same precoding is applied
to the allocated resource associated with a same TCI state or a same QCL
assumption.
If is determined as one of the values among {2, 4}, Precoding Resource Block
Group (PRGs) partitions the bandwidth part _i_ with consecutive PRBs. Actual
number of consecutive PRBs in each PRG could be one or more.
The first PRG size is given by and the last PRG size given by if , and the
last PRG size is if . For PDSCH scheduled by PDCCH with DCI scrambled using
G-RNTI or G-CS-RNTI, $N_{BWP,i}^{\text{start}}$ is the starting PRB of the CFR
and $N_{BWP,i}^{\text{size}}$ is the CFR.
The UE may assume the same precoding is applied for any downlink contiguous
allocation of PRBs in a PRG.
For PDSCH carrying SIB1 scheduled by PDCCH with CRC scrambled by SI-RNTI, a
PRG is partitioned from the lowest numbered resource block of CORESET 0 if the
corresponding PDCCH is associated with CORESET 0 and Type0-PDCCH common search
space and is addressed to SI-RNTI; otherwise, a PRG is partitioned from common
resource block 0.
If a UE is scheduled a PDSCH with DCI format 1_0 or 4_0, the UE shall assume
that is equal to 2 PRBs.
When receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled
by C-RNTI, MCS-C-RNTI, or CS-RNTI, for bandwidth part is equal to 2 PRBs
unless configured by the higher layer parameter _prb-BundlingType_ given by
_PDSCH-Config_.
When receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled
by C-RNTI, MCS-C-RNTI, or CS-RNTI, if the higher layer parameter _prb-
BundlingType_ is set to \'dynamicBundling\', the higher layer parameters
_bundleSizeSet1_ and _bundleSizeSet2_ configure two sets of values, the first
set can take one or two values among {2, 4, wideband}, and the second set can
take one value among {2, 4, wideband}.
If the _PRB \'bundling size indicator\'_ signalled in DCI format 1_1 as
defined in Clause 7.3.1.2.2 of [5, TS 38.212]
\- is set to \'0\', the UE shall use the value from the second set of values
when receiving PDSCH scheduled by the same DCI.
\- is set to \'1\' and one value is configured for the first set of values,
the UE shall use this value when receiving PDSCH scheduled by the same DCI
\- is set to \'1\' and two values are configured for the first set of values
as \'n2-wideband\' (corresponding to two values 2 and wideband) or
\'n4-wideband\' (corresponding to two values 4 and wideband), the UE shall use
the value when receiving PDSCH scheduled by the same DCI as follows:
\- If the scheduled PRBs are contiguous and the size of the scheduled PRBs is
larger than , is the same as the scheduled bandwidth, otherwise is set to the
remaining configured value of 2 or 4, respectively.
When receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled
by C-RNTI, MCS-C-RNTI, or CS-RNTI, if the higher layer parameter _prb-
BundlingType_ is set to \'staticBundling\', the value is configured with the
single value indicated by the higher layer parameter _bundleSize_.
When a UE is configured with nominal RBG size $P = 2$ for bandwidth part _i_
according to Clause 5.1.2.2.1, or when a UE is configured with interleaving
unit of 2 for VRB to PRB mapping provided by the higher layer parameter _vrb-
ToPRB-Interleaver_ given by _PDSCH-Config_ for bandwidth part _i_ , the UE is
not expected to be configured with = 4.
For a UE configured by the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeA _\' or_ \'fdmSchemeB _\', and_ when the UE is indicated with two
TCI states in a codepoint of the DCI field _\'Transmission Configuration
Indication\'_ and DM-RS port(s) within one CDM group in the DCI field
\'_Antenna Port(s)_ \',
\- If is determined as \"wideband\", the first $\left\lceil
\frac{n_{\text{PRB}}}{2} \right\rceil$ PRBs are assigned to the first TCI
state and the remaining $\left\lfloor \frac{n_{\text{PRB}}}{2} \right\rfloor$
PRBs are assigned to the second TCI state, where $n_{\text{PRB}}\ $is the
total number of allocated PRBs for the UE.
\- If is determined as one of the values among {2, 4}, even PRGs within the
allocated frequency domain resources are assigned to the first TCI state and
odd PRGs within the allocated frequency domain resources are assigned to the
second TCI state, wherein the PRGs are numbered continuously in increasing
order with the first PRG index equal to 0.
\- The UE is not expected to receive more than two PDSCH transmission layers
for each PDSCH transmission occasion.
For a UE configured by the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeB _\',_ and when the UE is indicated with two TCI states in a
codepoint of the DCI field _\'Transmission Configuration Indication\'_ and DM-
RS port(s) within one CDM group in the DCI field \'_Antenna Port(s)\',_ each
PDSCH transmission occasion shall follow the Clause 7.3.1 of [4, TS 38.211]
with the mapping to resource elements determined by the assigned PRBs for
corresponding TCI state of the PDSCH transmission occasion, and the UE shall
only expect at most two code blocks per PDSCH transmission occasion when a
single transmission layer is scheduled and a single code block per PDSCH
transmission occasion when two transmission layers are scheduled. For two
PDSCH transmission occasions, the redundancy version to be applied is derived
according to Table 5.1.2.1-2, where $n = 0,\ 1$ are applied to the first and
second TCI state, respectively.
### 5.1.3 Modulation order, target code rate, redundancy version and transport
block size determination
To determine the modulation order, target code rate, and transport block
size(s) in the physical downlink shared channel, the UE shall first
\- read the 5-bit modulation and coding scheme field (_I~MCS~_) in the DCI to
determine the modulation order (_Q~m~_) and target code rate (_R_) based on
the procedure defined in Clause 5.1.3.1, and
\- read \'_redundancy version\'_ field (_rv_) in the DCI to determine the
redundancy version.
and second
\- the UE shall use the number of layers (ʋ), the total number of allocated
PRBs before rate matching (_n~PRB~_) to determine to the transport block size
based on the procedure defined in Clause 5.1.3.2.
The UE may skip decoding a transport block in an initial transmission if the
effective channel code rate is higher than 0.95, where the effective channel
code rate is defined as the number of downlink information bits (including CRC
bits) divided by the number of physical channel bits on PDSCH.
When the UE is scheduled with multiple PDSCHs on a serving cell by a DCI, as
described in clause 5.1.2.1, the bits of _rv_ field and NDI field,
respectively, in the DCI are one-to-one mapped to the scheduled PDSCH(s)
indicated by the TDRA information field with the corresponding transport
block(s) in the scheduled order, where the LSB bits of the _rv_ field and NDI
field, respectively, correspond to the last scheduled PDSCH indicated by the
TDRA information field.
The UE is not expected to handle any transport blocks (TBs) in a 14
consecutive-symbol duration for normal CP (or 12 for extended CP) ending at
the last symbol of the latest PDSCH transmission within an active BWP on a
serving cell whenever
$$2^{max(0,\mu - \mu^{'})}.\sum_{i \in S}^{}{\left\lfloor
\frac{C_{i}^{'}}{L_{i}} \right\rfloor x_{i}.F_{i}} > \left\lceil \frac{X}{4}
\right\rceil.\frac{1}{R_{\text{LBRM}}}.\text{TB}S_{\text{LBRM}}$$
where, for the serving cell,
\- S is the set of TBs belonging to PDSCH(s) that are partially or fully
contained in the consecutive-symbol duration
\- for the _i_ th TB
_\- C~i~\'_ is the number of scheduled code blocks for as defined in [5,
38.212].
_\- L~i~_ is the number of OFDM symbols assigned to the PDSCH
_\- x~i~_ is the number of OFDM symbols of the PDSCH contained in the
consecutive-symbol duration
\- $F_{i} = \max_{j = 0,...,J - 1}{(\min{(k_{0,i}^{j} + E_{i}^{j},\
N_{cb,i})})}$ based on the values defined in Clause 5.4.2.1 [5, TS 38.212]
\- $k_{0,i}^{j}$ is the starting location of RV for the $j$th transmission
\- $E_{\text{i\ }}^{j} = \min{(E_{r})\ }$_of the scheduled code_ blocks for
the $j\text{th}$ transmission
\- $N_{cb,i}$ is the circular buffer length
\- $J - 1$ is the current (re)transmission for the _i_ th TB
\- $\mu^{'}$ corresponds to the subcarrier spacing of the BWP (across all
configured BWPs of a carrier) that has the largest configured number of PRBs
\- in case there is more than one BWP corresponding to the largest configured
number of PRBs, _µ\'_ follows the BWP with the largest subcarrier spacing.
\- $\mu$ corresponds to the subcarrier spacing of the active BWP
\- R~LBRM~ = 2/3 as defined in Clause 5.4.2.1 [5, TS 38.212]
> \- TBS~LBRM~ as defined based on the parameters for unicast in Clause
> 5.4.2.1 [5, TS 38.212]
\- X as defined for downlink max MIMO layer for unicast in Clause 5.4.2.1 [5,
TS 38.212].
If the UE skips decoding, the physical layer indicates to higher layer that
the transport block is not successfully decoded.
Within a cell group, a UE is not required to handle PDSCH(s) transmissions
including unicast and/or multicast/broadcast in slot _s~j~_ in serving cell-
_j_ , and for _j_ = 0,1,2.. _J-1_ , slot _s~j~_ overlapping with any given
point in time, if the following condition is not satisfied at that point in
time:
$$\sum_{j = 0}^{J - 1}\frac{\sum_{m = 0}^{M -
1}V_{j,m}}{T_{\text{slot}}^{\mu(j)}} \leq \text{DataRate}$$
where,
\- _J_ is the number of configured serving cells belonging to a frequency
range
\- for the _j-th_ serving cell,
_\- M_ is the number of TB(s) transmitted in slot _s~j~_. If there are two
PDSCH transmission occasions of the same TB (in time domain or in frequency
domain) in the slot _s~j~_ , each transmission occasion is counted separately.
_\- T~slot~^μ(j)^_ =10^-3^/2 _^μ(j)^_ , where _μ(j)_ is the numerology for
PDSCH(s) in slot _s~j~_ of the _j_ -th serving cell.
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
_\- A_ is the number of bits in the transport block as defined in Clause 7.2.1
[5, TS 38.212]
_\- C_ _is the total number of code blocks for the transport block_ defined in
Clause 5.2.2 [5, TS 38.212].$\ $
_-_ $C'$ is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5, TS 38.212]
\- $\text{DataRate}$ [Mbps] is computed as the maximum data rate summed over
all the carriers in the frequency range for any signaled band combination and
feature set consistent with the configured servings cells, where the data rate
value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including
the scaling factor _f(i)._
For a _j-_ th serving cell, if higher layer parameter _processingType2Enabled_
of _PDSCH-ServingCellConfig_ is configured for the serving cell and set to
\'_enable\',_ or if at least one _I~MCS~ >_ _W_ for a PDSCH for unicast or
multicast, where _W_ = 28 for MCS tables 5.1.3.1-1 and 5.1.3.1-3, and _W_ = 27
for MCS table 5.1.3.1-2, and _W_ = 26 for MCS table 5.1.3.1-4, or for a j-th
serving cell where UE supports FDM-ed unicast and MBS PDSCH, the UE is not
required to handle PDSCH transmissions, if the following condition is not
satisfied:
$$\frac{\sum_{m = 0}^{M - 1}V_{j,m}}{L \times T_{s}^{\mu}} \leq
\text{DataRateCC}$$
_where_
\- $\text{L\ }$is the number of symbols assigned to the PDSCH(s). For a PDSCH
that consists of two PDSCH transmission occasions in time domain in one slot,
$L$ is the number of symbols of one transmission occasion. For FDMed unicast
and MBS PDSCHs in one slot, $L$ is the total number of symbols of the unicast
and MBS PDSCHs with fully or partially-overlapped in time domain.
\- M is the number of TB(s) in the PDSCH(s)
\- $T_{s}^{\mu} = \frac{10^{- 3}}{{2^{\mu} \bullet
N}_{\text{symb}}^{\text{slot}}}$ where _μ_ is the numerology of the PDSCH(s)
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
_\- A_ is the number of bits in the transport block as defined in Clause 7.2.1
[5, TS 38.212]
_\- C_ is the total number of code blocks for the transport block defined in
Clause 5.2.2 [5, TS 38.212]
_-_ $C'$ is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5, TS 38.212]
\- $\text{DataRateCC}$ [Mbps] is computed as the maximum data rate for a
carrier in the frequency band of the serving cell for any signaled band
combination and feature set consistent with the serving cell, where the data
rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306],
including the scaling factor _f(i)._
#### 5.1.3.1 Modulation order and target code rate determination
For the PDSCH scheduled by a PDCCH with DCI format 1_0, format 1_1, format
1_2, format 1_3, format 4_0, format 4_1 or format 4_2 with CRC scrambled by
C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, SI-RNTI, RA-RNTI, MSGB-RNTI, G-RNTI,
G-CS-RNTI, MCCH-RNTI or P-RNTI, or for the PDSCH scheduled without
corresponding PDCCH transmissions using the higher-layer-provided PDSCH
configuration _SPS-Config_ ,
if the higher layer parameter _mcs-Table-r17_ given by _PDSCH-Config_ is set
to \'qam1024\', and the PDSCH is scheduled by a PDCCH with DCI format 1_1 or
1_3 with CRC scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-4 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif _mcs-TableDCI-1-2-r17_ given by _PDSCH-Config_ is set to \'qam1024\',
and the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC scrambled
by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-4 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the higher layer parameter _mcs-TableDCI-1-2_ given by _PDSCH-Config_
is set to \'qam256\', and the PDSCH is scheduled by a PDCCH with DCI format
1_2 with CRC scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with MCS-C-RNTI, the higher layer parameter
_mcs-TableDCI-1-2_ given by _PDSCH-Config_ is set to \'qam64LowSE\', and the
PDSCH is scheduled by a PDCCH with DCI format 1_2 scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the higher layer parameter _mcs-Table_ given by _PDSCH-Config_ is set
to \'qam256\', and the PDSCH is scheduled by a PDCCH with DCI format 1_1 or
1_3 with CRC scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the higher layer parameter _mcs-Table_ given by _pdsch-ConfigMulticast_
is set to \'qam256\', and the PDSCH is scheduled by a PDCCH with DCI format
4_1 or 4_2 with CRC scrambled by G-RNTI for multicast
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the higher layer parameter _mcs-Table_ given by _pdsch-ConfigMCCH and
pdsch-ConfigMTCH_ is set to \'qam256\', and the PDSCH is scheduled by a PDCCH
with DCI format 4_0 with CRC scrambled by MCCH-RNTI or G-RNTI for broadcast
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the higher layer parameter _mcs-Table_ given by _pdsch-ConfigMulticast_
is set to \'qam64LowSE\', and the PDSCH is scheduled by a PDCCH with DCI
format 4_1 or 4_2 with CRC scrambled by G-RNTI for multicast
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with MCS-C-RNTI, the higher layer parameter
_mcs-Table_ given by _PDSCH-Config_ is set to \'qam64LowSE\', and the PDSCH is
scheduled by a PDCCH with a DCI format other than DCI format 1_2 in a UE-
specific search space with CRC scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is configured with MCS-C-RNTI, and the PDSCH is scheduled by a
PDCCH with CRC scrambled by MCS-C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with the higher layer parameter _mcs-Table_
given by _SPS-config_ , and the higher layer parameter _mcs-Table-r17_ given
by _PDSCH-Config_ is set to \'qam1024\',
\- if the PDSCH is scheduled by a PDCCH with DCI format 1_1 with CRC scrambled
by CS-RNTI or
\- if the PDSCH with SPS activated by DCI format 1_1 is scheduled without
corresponding PDCCH transmission using _SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-4 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with the higher layer parameter _mcs-Table_
given by _SPS-config_ , and the higher layer parameter _mcs-TableDCI-1-2-r17_
given by _PDSCH-Config_ is set to \'qam1024\',
\- if the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC scrambled
by CS-RNTI or
\- if the PDSCH with SPS activated by DCI format 1_2 is scheduled without
corresponding PDCCH transmission using _SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-4 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with the higher layer parameter _mcs-Table_
given by _SPS-config_ , and the higher layer parameter _mcs-TableDCI-1-2_
given by _PDSCH-Config_ is set to \'qam256\',
\- if the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC scrambled
by CS-RNTI or
\- if the PDSCH with SPS activated by DCI format 1_2 is scheduled without
corresponding PDCCH transmission using _SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with the higher layer parameter _mcs-Table_
given by _SPS-Config_ , and the higher layer parameter _mcs-Table_ given by
_PDSCH-Config_ is set to \'qam256\',
\- if the PDSCH is scheduled by a PDCCH with DCI format 1_1 with CRC scrambled
by CS-RNTI or
\- if the PDSCH with SPS activated by DCI format 1_1 is scheduled without
corresponding PDCCH transmission using _SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is configured with the higher layer parameter _mcs-Table_ given
by _SPS-Config_ set to \'qam64LowSE\'
\- if the PDSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if the PDSCH is scheduled without corresponding PDCCH transmission using
_SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is configured with the higher layer parameter _mcs-Table_ given
by _SPS-Config_ or _mcs-Table_ of _pdsch-ConfigMulticast_ in the same _CFR-
ConfigMulticast_ set to \'qam64LowSE\'
\- if the GC-PDSCH is scheduled by a GC-PDCCH with CRC scrambled by G-CS-RNTI
or
\- if the GC-PDSCH is scheduled without corresponding GC-PDCCH transmission
using _SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
else
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-1 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
end
The UE is not expected to decode a PDSCH scheduled with P-RNTI, RA-RNTI, SI-
RNTI and _Q~m~_ > 2
For a UE configured with the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeB\', and when the UE is indicated with two TCI states in a
codepoint of the DCI field _\'Transmission Configuration Indication\'_ and DM-
RS port(s) within one CDM group in the DCI field \'_Antenna Port(s)_ \', the
determined modulation order of PDSCH transmission occasion associated with the
first TCI state is applied to the PDSCH transmission occasion associated with
the second TCI state.
Table 5.1.3.1-1: MCS index table 1 for PDSCH
+------------+-------------------+---------------------------------+------------+ | MCS Index\ | Modulation Order\ | Target code Rate _R_ x [1024] | Spectral | | _I~MCS~_ | _Q~m~_ | | | | | | | efficiency | +============+===================+=================================+============+ | **0** | 2 | 120 | 0.2344 | +------------+-------------------+---------------------------------+------------+ | **1** | 2 | 157 | 0.3066 | +------------+-------------------+---------------------------------+------------+ | **2** | 2 | 193 | 0.3770 | +------------+-------------------+---------------------------------+------------+ | **3** | 2 | 251 | 0.4902 | +------------+-------------------+---------------------------------+------------+ | **4** | 2 | 308 | 0.6016 | +------------+-------------------+---------------------------------+------------+ | **5** | 2 | 379 | 0.7402 | +------------+-------------------+---------------------------------+------------+ | **6** | 2 | 449 | 0.8770 | +------------+-------------------+---------------------------------+------------+ | **7** | 2 | 526 | 1.0273 | +------------+-------------------+---------------------------------+------------+ | **8** | 2 | 602 | 1.1758 | +------------+-------------------+---------------------------------+------------+ | **9** | 2 | 679 | 1.3262 | +------------+-------------------+---------------------------------+------------+ | **10** | 4 | 340 | 1.3281 | +------------+-------------------+---------------------------------+------------+ | **11** | 4 | 378 | 1.4766 | +------------+-------------------+---------------------------------+------------+ | **12** | 4 | 434 | 1.6953 | +------------+-------------------+---------------------------------+------------+ | **13** | 4 | 490 | 1.9141 | +------------+-------------------+---------------------------------+------------+ | **14** | 4 | 553 | 2.1602 | +------------+-------------------+---------------------------------+------------+ | **15** | 4 | 616 | 2.4063 | +------------+-------------------+---------------------------------+------------+ | **16** | 4 | 658 | 2.5703 | +------------+-------------------+---------------------------------+------------+ | **17** | 6 | 438 | 2.5664 | +------------+-------------------+---------------------------------+------------+ | **18** | 6 | 466 | 2.7305 | +------------+-------------------+---------------------------------+------------+ | **19** | 6 | 517 | 3.0293 | +------------+-------------------+---------------------------------+------------+ | **20** | 6 | 567 | 3.3223 | +------------+-------------------+---------------------------------+------------+ | **21** | 6 | 616 | 3.6094 | +------------+-------------------+---------------------------------+------------+ | **22** | 6 | 666 | 3.9023 | +------------+-------------------+---------------------------------+------------+ | **23** | 6 | 719 | 4.2129 | +------------+-------------------+---------------------------------+------------+ | **24** | 6 | 772 | 4.5234 | +------------+-------------------+---------------------------------+------------+ | **25** | 6 | 822 | 4.8164 | +------------+-------------------+---------------------------------+------------+ | **26** | 6 | 873 | 5.1152 | +------------+-------------------+---------------------------------+------------+ | **27** | 6 | 910 | 5.3320 | +------------+-------------------+---------------------------------+------------+ | **28** | 6 | 948 | 5.5547 | +------------+-------------------+---------------------------------+------------+ | **29** | 2 | reserved | | +------------+-------------------+---------------------------------+------------+ | **30** | 4 | reserved | | +------------+-------------------+---------------------------------+------------+ | **31** | 6 | reserved | | +------------+-------------------+---------------------------------+------------+
Table 5.1.3.1-2: MCS index table 2 for PDSCH
+--------------+----------------+----------------+----------------+ | **MCS Index\ |** Modulation | **Target code |** Spectral**| |**_I~MCS~_ | Order\ | Rate _R_**x | | | | **_Q~m~_ | [1024] | **efficiency**| +==============+================+================+================+ |** 0**| 2 | 120 | 0.2344 | +--------------+----------------+----------------+----------------+ |** 1**| 2 | 193 | 0.3770 | +--------------+----------------+----------------+----------------+ |** 2**| 2 | 308 | 0.6016 | +--------------+----------------+----------------+----------------+ |** 3**| 2 | 449 | 0.8770 | +--------------+----------------+----------------+----------------+ |** 4**| 2 | 602 | 1.1758 | +--------------+----------------+----------------+----------------+ |** 5**| 4 | 378 | 1.4766 | +--------------+----------------+----------------+----------------+ |** 6**| 4 | 434 | 1.6953 | +--------------+----------------+----------------+----------------+ |** 7**| 4 | 490 | 1.9141 | +--------------+----------------+----------------+----------------+ |** 8**| 4 | 553 | 2.1602 | +--------------+----------------+----------------+----------------+ |** 9**| 4 | 616 | 2.4063 | +--------------+----------------+----------------+----------------+ |** 10**| 4 | 658 | 2.5703 | +--------------+----------------+----------------+----------------+ |** 11**| 6 | 466 | 2.7305 | +--------------+----------------+----------------+----------------+ |** 12**| 6 | 517 | 3.0293 | +--------------+----------------+----------------+----------------+ |** 13**| 6 | 567 | 3.3223 | +--------------+----------------+----------------+----------------+ |** 14**| 6 | 616 | 3.6094 | +--------------+----------------+----------------+----------------+ |** 15**| 6 | 666 | 3.9023 | +--------------+----------------+----------------+----------------+ |** 16**| 6 | 719 | 4.2129 | +--------------+----------------+----------------+----------------+ |** 17**| 6 | 772 | 4.5234 | +--------------+----------------+----------------+----------------+ |** 18**| 6 | 822 | 4.8164 | +--------------+----------------+----------------+----------------+ |** 19**| 6 | 873 | 5.1152 | +--------------+----------------+----------------+----------------+ |** 20**| 8 | 682.5 | 5.3320 | +--------------+----------------+----------------+----------------+ |** 21**| 8 | 711 | 5.5547 | +--------------+----------------+----------------+----------------+ |** 22**| 8 | 754 | 5.8906 | +--------------+----------------+----------------+----------------+ |** 23**| 8 | 797 | 6.2266 | +--------------+----------------+----------------+----------------+ |** 24**| 8 | 841 | 6.5703 | +--------------+----------------+----------------+----------------+ |** 25**| 8 | 885 | 6.9141 | +--------------+----------------+----------------+----------------+ |** 26**| 8 | 916.5 | 7.1602 | +--------------+----------------+----------------+----------------+ |** 27**| 8 | 948 | 7.4063 | +--------------+----------------+----------------+----------------+ |** 28**| 2 | reserved | | +--------------+----------------+----------------+----------------+ |** 29**| 4 | reserved | | +--------------+----------------+----------------+----------------+ |** 30**| 6 | reserved | | +--------------+----------------+----------------+----------------+ |** 31** | 8 | reserved | | +--------------+----------------+----------------+----------------+
Table 5.1.3.1-3: MCS index table 3 for PDSCH
+------------+-------------------+---------------------------------+------------+ | MCS Index\ | Modulation Order\ | Target code Rate _R_ x [1024] | Spectral | | _I~MCS~_ | _Q~m~_ | | | | | | | efficiency | +============+===================+=================================+============+ | **0** | 2 | 30 | 0.0586 | +------------+-------------------+---------------------------------+------------+ | **1** | 2 | 40 | 0.0781 | +------------+-------------------+---------------------------------+------------+ | **2** | 2 | 50 | 0.0977 | +------------+-------------------+---------------------------------+------------+ | **3** | 2 | 64 | 0.1250 | +------------+-------------------+---------------------------------+------------+ | **4** | 2 | 78 | 0.1523 | +------------+-------------------+---------------------------------+------------+ | **5** | 2 | 99 | 0.1934 | +------------+-------------------+---------------------------------+------------+ | **6** | 2 | 120 | 0.2344 | +------------+-------------------+---------------------------------+------------+ | **7** | 2 | 157 | 0.3066 | +------------+-------------------+---------------------------------+------------+ | **8** | 2 | 193 | 0.3770 | +------------+-------------------+---------------------------------+------------+ | **9** | 2 | 251 | 0.4902 | +------------+-------------------+---------------------------------+------------+ | **10** | 2 | 308 | 0.6016 | +------------+-------------------+---------------------------------+------------+ | **11** | 2 | 379 | 0.7402 | +------------+-------------------+---------------------------------+------------+ | **12** | 2 | 449 | 0.8770 | +------------+-------------------+---------------------------------+------------+ | **13** | 2 | 526 | 1.0273 | +------------+-------------------+---------------------------------+------------+ | **14** | 2 | 602 | 1.1758 | +------------+-------------------+---------------------------------+------------+ | **15** | 4 | 340 | 1.3281 | +------------+-------------------+---------------------------------+------------+ | **16** | 4 | 378 | 1.4766 | +------------+-------------------+---------------------------------+------------+ | **17** | 4 | 434 | 1.6953 | +------------+-------------------+---------------------------------+------------+ | **18** | 4 | 490 | 1.9141 | +------------+-------------------+---------------------------------+------------+ | **19** | 4 | 553 | 2.1602 | +------------+-------------------+---------------------------------+------------+ | **20** | 4 | 616 | 2.4063 | +------------+-------------------+---------------------------------+------------+ | **21** | 6 | 438 | 2.5664 | +------------+-------------------+---------------------------------+------------+ | **22** | 6 | 466 | 2.7305 | +------------+-------------------+---------------------------------+------------+ | **23** | 6 | 517 | 3.0293 | +------------+-------------------+---------------------------------+------------+ | **24** | 6 | 567 | 3.3223 | +------------+-------------------+---------------------------------+------------+ | **25** | 6 | 616 | 3.6094 | +------------+-------------------+---------------------------------+------------+ | **26** | 6 | 666 | 3.9023 | +------------+-------------------+---------------------------------+------------+ | **27** | 6 | 719 | 4.2129 | +------------+-------------------+---------------------------------+------------+ | **28** | 6 | 772 | 4.5234 | +------------+-------------------+---------------------------------+------------+ | **29** | 2 | reserved | | +------------+-------------------+---------------------------------+------------+ | **30** | 4 | reserved | | +------------+-------------------+---------------------------------+------------+ | **31** | 6 | reserved | | +------------+-------------------+---------------------------------+------------+
Table 5.1.3.1-4: MCS index table 4 for PDSCH
+----------------+----------------+----------------+----------------+ | [**MCS Index\ | [** Modulation | [**Target code |**[Spectral] | | **_I~MCS~ | Order\ | Rate_ R **_x | {.underline}__| |_]{.underline} | ** | [1024\ | | | | _Q~m~ | ]]{.underline} |__[efficiency] | | |_]{.underline} | | {.underline}**| +================+================+================+================+ |**[0] | [ | [12 | [0.234 | | {.underline}**| 2]{.underline} | 0]{.underline} | 4]{.underline} | +----------------+----------------+----------------+----------------+ |**[1] | [ | [19 | [0.377 | | {.underline}**| 2]{.underline} | 3]{.underline} | 0]{.underline} | +----------------+----------------+----------------+----------------+ |**[2] | [ | [44 | [0.877 | | {.underline}**| 2]{.underline} | 9]{.underline} | 0]{.underline} | +----------------+----------------+----------------+----------------+ |**[3] | [ | [37 | [1.476 | | {.underline}**| 4]{.underline} | 8]{.underline} | 6]{.underline} | +----------------+----------------+----------------+----------------+ |**[4] | [ | [49 | [1.914 | | {.underline}**| 4]{.underline} | 0]{.underline} | 1]{.underline} | +----------------+----------------+----------------+----------------+ |**[5] | [ | [61 | [2.406 | | {.underline}**| 4]{.underline} | 6]{.underline} | 3]{.underline} | +----------------+----------------+----------------+----------------+ |**[6] | [ | [46 | [2.730 | | {.underline}**| 6]{.underline} | 6]{.underline} | 5]{.underline} | +----------------+----------------+----------------+----------------+ |**[7] | [ | [51 | [3.029 | | {.underline}**| 6]{.underline} | 7]{.underline} | 3]{.underline} | +----------------+----------------+----------------+----------------+ |**[8] | [ | [56 | [3.322 | | {.underline}**| 6]{.underline} | 7]{.underline} | 3]{.underline} | +----------------+----------------+----------------+----------------+ |**[9] | [ | [61 | [3.609 | | {.underline}**| 6]{.underline} | 6]{.underline} | 4]{.underline} | +----------------+----------------+----------------+----------------+ |**[10] | [ | [66 | [3.902 | | {.underline}**| 6]{.underline} | 6]{.underline} | 3]{.underline} | +----------------+----------------+----------------+----------------+ |**[11] | [ | [71 | [4.212 | | {.underline}**| 6]{.underline} | 9]{.underline} | 9]{.underline} | +----------------+----------------+----------------+----------------+ |**[12] | [ | [77 | [4.523 | | {.underline}**| 6]{.underline} | 2]{.underline} | 4]{.underline} | +----------------+----------------+----------------+----------------+ |**[13] | [ | [82 | [4.816 | | {.underline}**| 6]{.underline} | 2]{.underline} | 4]{.underline} | +----------------+----------------+----------------+----------------+ |**[14] | [ | [87 | [5.115 | | {.underline}**| 6]{.underline} | 3]{.underline} | 2]{.underline} | +----------------+----------------+----------------+----------------+ |**[15] | [ | [682. | [5.332 | | {.underline}**| 8]{.underline} | 5]{.underline} | 0]{.underline} | +----------------+----------------+----------------+----------------+ |**[16] | [ | [71 | [5.554 | | {.underline}**| 8]{.underline} | 1]{.underline} | 7]{.underline} | +----------------+----------------+----------------+----------------+ |**[17] | [ | [75 | [5.890 | | {.underline}**| 8]{.underline} | 4]{.underline} | 6]{.underline} | +----------------+----------------+----------------+----------------+ |**[18] | [ | [79 | [6.226 | | {.underline}**| 8]{.underline} | 7]{.underline} | 6]{.underline} | +----------------+----------------+----------------+----------------+ |**[19] | [ | [84 | [6.570 | | {.underline}**| 8]{.underline} | 1]{.underline} | 3]{.underline} | +----------------+----------------+----------------+----------------+ |**[20] | [ | [88 | [6.914 | | {.underline}**| 8]{.underline} | 5]{.underline} | 1]{.underline} | +----------------+----------------+----------------+----------------+ |**[21] | [ | [916. | [7.160 | | {.underline}**| 8]{.underline} | 5]{.underline} | 2]{.underline} | +----------------+----------------+----------------+----------------+ |**[22] | [ | [94 | [7.406 | | {.underline}**| 8]{.underline} | 8]{.underline} | 3]{.underline} | +----------------+----------------+----------------+----------------+ |**[23] | [1 | [805. | [7.866 | | {.underline}**| 0]{.underline} | 5]{.underline} | 2]{.underline} | +----------------+----------------+----------------+----------------+ |**[24] | [1 | [85 | [8.330 | | {.underline}**| 0]{.underline} | 3]{.underline} | 1]{.underline} | +----------------+----------------+----------------+----------------+ |**[25] | [1 | [900. | [8.793 | | {.underline}**| 0]{.underline} | 5]{.underline} | 9]{.underline} | +----------------+----------------+----------------+----------------+ |**[26] | [1 | [94 | [9.257 | | {.underline}**| 0]{.underline} | 8]{.underline} | 8]{.underline} | +----------------+----------------+----------------+----------------+ |**[27] | [ | [reserve | | | {.underline}**| 2]{.underline} | d]{.underline} | | +----------------+----------------+----------------+----------------+ |**[28] | [ | [reserve | | | {.underline}**| 4]{.underline} | d]{.underline} | | +----------------+----------------+----------------+----------------+ |**[29] | [ | [reserve | | | {.underline}**| 6]{.underline} | d]{.underline} | | +----------------+----------------+----------------+----------------+ |**[30] | [ | [reserve | | | {.underline}**| 8]{.underline} | d]{.underline} | | +----------------+----------------+----------------+----------------+ |**[31] | [1 | [reserve | | | {.underline}** | 0]{.underline} | d]{.underline} | | +----------------+----------------+----------------+----------------+
#### 5.1.3.2 Transport block size determination
In case the higher layer parameter _maxNrofCodeWordsScheduledByDCI in PDSCH-
config_ indicates that two codeword transmission is enabled, then one of the
two transport blocks is disabled by DCI format 1_1 or 1_3 if _I~MCS\ ~_ = 26
and if _rv~id~_ = 1 for the corresponding transport block. In case the higher
layer parameter _maxNrofCodeWordsScheduledByDCI_ in _pdsch-ConfigMulticast_
indicates that two codeword transmission is enabled, then one of the two
transport blocks is disabled by DCI format 4_2 if _I~MCS\ ~_ = 26 and if
_rv~id~_ = 1 for the corresponding transport block. When the UE is configured
with higher layer parameter _pdsch-TimeDomainAllocationListForMultiPDSCH_ ,
either the first or the second transport block of all scheduled PDSCHs is
disabled by the DCI format 1_1 _if I~MCS~ = 26 and if rv~id~_ = 2 _for the
corresponding transport block of all scheduled PDSCHs._ If both transport
blocks are enabled, transport block 1 and 2 are mapped to codeword 0 and 1
respectively. If only one transport block is enabled, then the enabled
transport block is always mapped to the first codeword.
For the PDSCH assigned by a PDCCH with DCI format 1_0, 1_1, 1_2, 1_3, 4_0,
4_1, or 4_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI,
G-RNTI, G-CS-RNTI, MCCH-RNTI or SI-RNTI, if Table 5.1.3.1-2 is used and $0\
\leq \ I_{\text{MCS\ }} \leq 27$_,_ else if Table 5.1.3.1-4 is used and $0
\leq I_{\text{MCS}} \leq 26$ or a table other than Table 5.1.3.1-2 and Table
5.1.3.1-4 is used and $0\ \leq \ I_{\text{MCS\ }} \leq 28$_,_ the UE shall,
except if the transport block is disabled in DCI format 1_1 or 1_3, first
determine the TBS as specified below:
1) The UE shall first determine the number of REs (_N~RE~_)
$N_{\text{RE}})$within the slot.
\- A UE first determines the number of REs allocated for PDSCH within a PRB ()
by , where is the number of subcarriers in a physical resource block,
$N_{\text{symb}}^{\text{slot}}$ is the number of symbols of the PDSCH
allocation within the slot, $N_{\text{DMRS}}^{\text{PRB}}$ is the number of
REs for DM-RS per PRB in the scheduled duration including the overhead of the
DM-RS CDM groups without data, as indicated by DCI format 1_1, 1_2 or 1_3 or
as described for format 1_0 in Clause 5.1.6.2, and
$N_{\text{oh}}^{\text{PRB}}$is the overhead configured by higher layer
parameter _xOverhead in PDSCH-ServingCellConfig_. If the _xOverhead_ in
_PDSCH-ServingCellconfig_ is not configured (a value from 6, 12, or 18), the
is set to 0. If the PDSCH is scheduled by PDCCH with a CRC scrambled by SI-
RNTI, RA-RNTI, MSGB-RNTI or P-RNTI, $N_{oh}^{\text{PRB}}$ is assumed to be 0.
If the PDSCH is scheduled by PDCCH with a CRC scrambled by G-RNTI for
multicast or G-CS-RNTI or PDSCH without PDCCH is activated by PDCCH with a CRC
scrambled by G-CS-RNTI, $N_{oh}^{\text{PRB}}$ $N_{\text{oh}}^{\text{PRB}}$is
the overhead configured by higher layer parameter _xOverhead-Multicast in
pdsch-ConfigMulticast_. If the _xOverhead-Multicast_ in _pdsch-
ConfigMulticast_ is not configured, the $N_{oh}^{\text{PRB}}$ is set to 0. If
the PDSCH is scheduled by PDCCH with a CRC scrambled by G-RNTI for broadcast
or MCCH-RNTI, $N_{oh}^{\text{PRB}}$ $N_{\text{oh}}^{\text{PRB}}$is the
overhead configured by higher layer parameter _xOverhead in pdsch_
_-__ConfigBroadcast_. If the _xOverhead_ in _pdsch- ConfigBroadcast_ is not
configured, the $N_{oh}^{\text{PRB}}$ is set to 0.
\- A UE determines the total number of REs allocated for PDSCH
()$N_{\text{RE}})$ by $N_{\text{RE}} = \ {\overline{N}}_{\text{RE}}^{'}_\
n_{\text{PRB}}$, where_ n~PRB~* is the total number of allocated PRBs for the
UE.
2) Unquantized intermediate variable (_N~info~_) $\text{TBS}_{\text{temp}})\
$is obtained by $\text{TBS}_{\text{temp}} = \ N_{\text{RE}}_R_ Q_{m}*ʋ$.
If
Use step 3 as the next step of the TBS determination
else
Use step 4 as the next step of the TBS determination
end if
3) When , TBS is determined as follows
\- quantized intermediate number of information bits , where .
\- use Table 5.1.3.2-1 find the closest TBS that is not less than .
Table 5.1.3.2-1: TBS for
Index TBS Index TBS Index TBS Index TBS
* * *
1 24 31 336 61 1288 91 3624 2 32 32 352 62 1320 92 3752 3 40 33 368 63 1352 93
3824 4 48 34 384 64 1416  
5 56 35 408 65 1480  
6 64 36 432 66 1544  
7 72 37 456 67 1608  
8 80 38 480 68 1672  
9 88 39 504 69 1736  
10 96 40 528 70 1800  
11 104 41 552 71 1864  
12 112 42 576 72 1928  
13 120 43 608 73 2024  
14 128 44 640 74 2088  
15 136 45 672 75 2152  
16 144 46 704 76 2216  
17 152 47 736 77 2280  
18 160 48 768 78 2408  
19 168 49 808 79 2472  
20 176 50 848 80 2536  
21 184 51 888 81 2600  
22 192 52 928 82 2664  
23 208 53 984 83 2728  
24 224 54 1032 84 2792  
25 240 55 1064 85 2856  
26 256 56 1128 86 2976  
27 272 57 1160 87 3104  
28 288 58 1192 88 3240  
29 304 59 1224 89 3368  
30 320 60 1256 90 3496
4) When , TBS is determined as follows.
\- quantized intermediate number of information bits , where and ties in the
round function are broken towards the next largest integer.
\- if
, where
else
if
, where
else
end if
end if
else if Table 5.1.3.1-2 is used and _,_
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using $0\ \leq \ I_{\text{MCS\ }}
\leq 27$. If there is no PDCCH for the same transport block using $0\ \leq \
I_{\text{MCS\ }} \leq 27$, and if the initial PDSCH for the same transport
block is semi-persistently scheduled, the TBS shall be determined from the
most recent semi-persistent scheduling assignment PDCCH.
else if Table 5.1.3.1-4 is used and $27 \leq I_{\text{MCS}} \leq 31$_,_
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using $0 \leq I_{\text{MCS}} \leq
26$$0\ \leq \ I_{\text{MCS\ }} \leq 27$. If there is no PDCCH for the same
transport block using $0 \leq I_{\text{MCS}} \leq 26$$0\ \leq \ I_{\text{MCS\
}} \leq 27$, and if the initial PDSCH for the same transport block is semi-
persistently scheduled, the TBS shall be determined from the most recent semi-
persistent scheduling assignment PDCCH.
else
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using $0\ \leq \ I_{\text{MCS\ }}
\leq 28$. If there is no PDCCH for the same transport block using$\ 0\ \leq \
I_{\text{MCS\ }} \leq 28$, and if the initial PDSCH for the same transport
block is semi-persistently scheduled, the TBS shall be determined from the
most recent semi-persistent scheduling assignment PDCCH.
The UE is not expected to receive a PDSCH assigned by a PDCCH with CRC
scrambled by SI-RNTI with a TBS exceeding 2976 bits.
For a UE configured with the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeB\' and indicated with two TCI states in a codepoint of the DCI
field _\'Transmission Configuration Indication\'_ and DM-RS port(s) within one
CDM group in the DCI field \'_Antenna Port(s)_ \', the TBS determination
follows the steps 1-4 with the following modification in step 1: a UE
determines the total number of REs allocated for PDSCH ()$N_{\text{RE}})$ by
$N_{\text{RE}} = \ {\overline{N}}_{\text{RE}}^{'}_\ n_{\text{PRB}}$, where_
n~PRB~_is the total number of allocated PRBs corresponding to the first TCI
state, and the determined TBS of PDSCH transmission occasion associated with
the first TCI state is also applied to the PDSCH transmission occasion
associated with the second TCI state. For a UE configured with the higher
layer parameter_ repetitionScheme _set to \'tdmSchemeA\' and indicated with
two TCI states in a codepoint of the DCI field_ \'Transmission Configuration
Indication\'_and DM-RS port(s) within one CDM group in the DCI field \'_
Antenna Port(s)*\', the TBS determination follows the steps 1-4 with the
following modification in step 1: a UE determines the number of REs allocated
for PDSCH within a PRB () by , where is the number of symbols of the PDSCH
allocation within the slot corresponding to the first TCI state, and the
determined TBS of PDSCH transmission occasion associated with the first TCI
state is also applied to the PDSCH transmission occasion associated with the
second TCI state.
For the PDSCH assigned by a PDCCH with DCI format 1_0 with CRC scrambled by
P-RNTI, or RA-RNTI, MsgB-RNTI, TBS determination follows the steps 1-4 with
the following modification in step 2: a scaling is applied in the calculation
of _N~info~_ , where the scaling factor is determined based on the _TB
scaling_ field in the DCI as in Table 5.1.3.2-2.
Table 5.1.3.2-2: Scaling factor of _N~info~_ for P-RNTI, RA-RNTI and MSGB-RNTI
TB scaling field Scaling factor S
* * *
00 1 01 0.5 10 0.25 11
The NDI and HARQ process ID, as signalled on PDCCH, and the TBS, as determined
above, shall be reported to higher layers.
### 5.1.4 PDSCH resource mapping
When receiving the PDSCH scheduled with SI-RNTI and the system information
indicator in DCI is set to 0, the UE shall assume that no SS/PBCH block is
transmitted in REs used by the UE for a reception of the PDSCH.
When receiving the PDSCH scheduled with SI-RNTI and the system information
indicator in DCI is set to 1, RA-RNTI, MSGB-RNTI, P-RNTI or TC-RNTI, the UE
assumes SS/PBCH block transmission according to _ssb-PositionsInBurst_ , and
if the PDSCH resource allocation overlaps with PRBs containing SS/PBCH block
transmission resources the UE shall assume that the PRBs containing SS/PBCH
block transmission resources are not available for PDSCH in the OFDM symbols
where SS/PBCH block is transmitted.
A UE expects a configuration provided by _ssb-PositionsInBurst_ in
_ServingCellConfigCommon_ to be same as a configuration provided by _ssb-
PositionsInBurst_ in _SIB1_.
When receiving PDSCH scheduled by PDCCH with CRC scrambled by C-RNTI, MCS-C-
RNTI, CS-RNTI, G-RNTI, G-CS-RNTI, MCCH-RNTI or PDSCHs with SPS, the REs
corresponding to the configured or dynamically indicated resources in Clauses
5.1.4.1, 5.1.4.2 are not available for PDSCH. Furthermore, the UE assumes
SS/PBCH block transmission according to _ssb-PositionsInBurst_ if the PDSCH
resource allocation overlaps with PRBs containing SS/PBCH block transmission
resources, and the UE shall assume that the PRBs containing SS/PBCH block
transmission resources are not available for PDSCH in the OFDM symbols where
SS/PBCH block associated with the same PCI is transmitted.
A UE is not expected to handle the case where PDSCH DM-RS REs are overlapping,
even partially, with any RE(s) not available for PDSCH _._
For operation with shared spectrum channel access, SS/PBCH block transmission
according to _ssb-PositionsInBurst_ represents all of the candidate SS/PBCH
blocks corresponding to SS/PBCH block indices provided by _ssb-
PositionsInBurst_ as described in Clause 4.1 of [6, TS 38.213].
#### 5.1.4.1 PDSCH resource mapping with RB symbol level granularity
The procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in
this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by
applying only the parameters of _rateMatchPatternGroup1DCI-1-2_ ,
_rateMatchPatternGroup2DCI-1-2_ instead of _rateMatchPatternGroup1_ and
_rateMatchPatternGroup2_. The procedures for PDSCH scheduled by PDCCH with DCI
format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH
with DCI format 1_3. The procedures for PDSCH scheduled by PDCCH with DCI
format 1_0 described in this clause equally apply to PDSCH scheduled by PDCCH
with DCI format 4_0, by applying only the parameters of
_rateMatchPatternToAddModList_ configured in _pdsch-ConfigMCCH or pdsch-
ConfigMTCH_.
The procedures for PDSCH scheduled by PDCCH with DCI format 1_0 described in
this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_1, and
the procedures for PDSCH scheduled by DCI format 1_1 described in this clause
equally apply to PDSCH scheduled by PDCCH with DCI format 4_2 by applying only
the parameters of _rateMatchPatternToAddModList, rateMatchPatternGroup1_ and
_rateMatchPatternGroup2_ configured in _pdsch-ConfigMulticast_.
A UE may be configured with any of the following higher layer parameters
indicating REs declared as not available for PDSCH:
\- _rateMatchPatternToAddModList_ given by _PDSCH-Config, by pdsch-
ConfigMulticast_ , by _ServingCellConfig_ or by _ServingCellConfigCommon, or_
_by pdsch-ConfigMCCH or pdsch-ConfigMTCH_ and configuring up to 4
_RateMatchPattern(s)_ per BWP and up to 4 _RateMatchPattern(s)_ per serving-
cell. The _RateMatchPatterns_ configured for MBS multicast are counted into
the ones that are configured per BWP. The _RateMatchPattern(s)_ configured for
MBS broadcast is counted into the ones that are configured per serving-cell. A
_RateMatchPattern_ may contain:
\- within a BWP, when provided by _PDSCH-Config_ or _pdsch-ConfigMulticast_ or
within a serving cell when provided by _ServingCellConfig_ or
_ServingCellConfigCommon_ , _or_ _by pdsch-ConfigMCCH or pdsch-ConfigMTCH,_ a
pair of reserved resources with numerology provided by higher layer parameter
_subcarrierSpacing_ given by _RateMatchPattern_ when configured per serving
cell or by numerology of associated BWP when configured per BWP. The pair of
reserved resources are respectively indicated by an RB level bitmap (higher
layer parameter _resourceBlocks_ given by _RateMatchPattern_) with 1RB
granularity and a symbol level bitmap spanning one or two slots (higher layer
parameters _symbolsInResourceBlock_ given by _RateMatchPattern_) for which the
reserved RBs apply. A bit value equal to 1 in the RB and symbol level bitmaps
indicates that the corresponding resource is not available for PDSCH. For each
pair of RB and symbol level bitmaps, a UE may be configured with a time-domain
pattern (higher layer parameter _periodicityAndPattern_ given by
_RateMatchPattern_), where each bit of _periodicityAndPattern_ corresponds to
a unit equal to a duration of the symbol level bitmap, and a bit value equal
to 1 indicates that the pair is present in the unit. The
_periodicityAndPattern_ can be {1, 2, 4, 5, 8, 10, 20 or 40} units long, but
maximum of 40 msec. The first symbol of _periodicityAndPattern_ every 40
msec/P periods is a first symbol in frame $n_{f}$ mod 4 = 0, where P is the
duration of _periodicityAndPattern_ in units of msec. When
_periodicityAndPattern_ is not configured for a pair, for a symbol level
bitmap spanning two slots, the bits of the first and second slots correspond
respectively to even and odd slots of a radio frame, and for a symbol level
bitmap spanning one slot, the bits of the slot correspond to every slot of a
radio frame. The pair can be included in one or two groups of resource sets
(higher layer parameters _rateMatchPatternGroup1_ and
_rateMatchPatternGroup2_). The _rateMatchPatternToAddModList_ given by
_ServingCellConfig_ or _ServingCellConfigCommon_ configuration in numerology
_µ_ applies only to PDSCH of the same numerology _µ_.
\- within a BWP, a frequency domain resource of a CORESET configured by
_ControlResourceSet_ with _controlResourceSetId_ or _ControlResourceSetZero_
and time domain resource determined by the higher layer parameters
_monitoringSlotPeriodicityAndOffset,_ _duration_ and
_monitoringSymbolsWithinSlot_ of all search-space-sets configured by
_SearchSpace_ and time domain resource of search-space-set zero configured by
_searchSpaceZero_ associated with the CORESET as well as CORESET duration
configured by _ControlResourceSet_ with _controlResourceSetId_ or
_ControlResourceSetZero._ This resource not available for PDSCH can be
included in one or two groups of resource sets (higher layer parameters
_rateMatchPatternGroup1_ and _rateMatchPatternGroup2_).
A configured group _rateMatchPatternGroup1_ or _rateMatchPatternGroup2_
contains a list of indices of _RateMatchPattern(s)_ forming a union of
resource-sets not available for a PDSCH dynamically if a corresponding bit of
the \'_Rate matching indicator_ \' field of the DCI format 1_1 scheduling the
PDSCH is equal to 1. The REs corresponding to the union of resource-sets
configured by _RateMatchPattern(s)_ that are not included in either of the two
groups are not available for a PDSCH scheduled by a DCI format 1_0, a PDSCH
scheduled by a DCI format 1_1, and PDSCHs with SPS. When receiving a PDSCH
scheduled by a DCI format 1_0 or PDSCHs with SPS activated by a DCI format
1_0, the REs corresponding to configured resources in _rateMatchPatternGroup1_
or _rateMatchPatternGroup2_ are not available for the scheduled PDSCH or the
activated PDSCHs with SPS. When receiving PDSCHs with SPS activated by a DCI
format 1_1, the REs corresponding to configured resources in
_rateMatchPatternGroup1_ or _rateMatchPatternGroup2_ are not available for the
PDSCHs with SPS if a corresponding bit of the Rate matching indicator field of
the DCI format 1_1 activating the PDSCHs with SPS is equal to 1.
For a bitmap pair included in one or two groups of resource sets, the dynamic
indication of availability for PDSCH applies to a set of slot(s) where the
_rateMatchPatternToAddModList_ is present among the slots of scheduled PDSCH.
If a UE monitors PDCCH candidates of aggregation levels 8 and 16 with the same
starting CCE index in non-interleaved CORESET spanning one OFDM symbol:
\- and if a detected PDCCH scheduling the PDSCH has aggregation level 8, the
resources corresponding to the aggregation level 16 PDCCH candidate are not
available for the PDSCH;
_\- whe_ n at least one of the PDCCH candidates of aggregation levels 8 and 16
linked as indicated by higher layer parameter _searchSpaceLinkingId_ , the
PDCCH candidates of aggregation level 16 and any other PDCCH candidate(s)
linked with any of the PDCCH candidates of aggregation level 8 and 16 are not
available for the PDSCH reception at the UE, if a detected PDCCH scheduling
the PDSCH is associated with the PDCCH candidates of aggregation level 8 or
16.
If a PDSCH scheduled by a PDCCH would overlap with resources in the CORESET
containing the PDCCH, the resources corresponding to a union of the detected
PDCCH that scheduled the PDSCH and associated PDCCH DM-RS are not available
for the PDSCH. When the PDCCH reception includes two PDCCH candidates from two
respective search space sets, as described in clause 10.1 of [6, TS 38.213],
the resources corresponding to a union of the two PDCCH candidates scheduling
the PDSCH and the associated PDCCH DM-RS are not available for the PDSCH. When
_precoderGranularity_ configured in a CORESET where the PDCCH was detected is
set to \'_allContiguousRBs\'_ , the associated PDCCH DM-RS are DM-RS in all
REGs of the CORESET. Otherwise, the associated DM-RS are the DM-RS in REGs of
the PDCCH.
#### 5.1.4.2 PDSCH resource mapping with RE level granularity
The procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in
this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by
applying the parameters of _aperiodicZP-CSI-RS-
ResourceSetsToAddModListDCI-1-2_ instead of _aperiodic-ZP-CSI-RS-
ResourceSetsToAddModList_. The procedures for PDSCH scheduled by PDCCH with
DCI format 1_1 described in this clause equally apply to PDSCH scheduled by
PDCCH with DCI format 1_3.
The procedures for PDSCH scheduled by PDCCH with DCI format 1_0 described in
this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_1 and
the procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in
this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_2, by
applying the parameters of _aperiodicZP-CSI-RS-ResourceSetsToAddModList in
pdsch-ConfigMulticast_ instead of _aperiodic-ZP-CSI-RS-
ResourceSetsToAddModList in PDSCH-Config_.
A UE may be configured with any of the following higher layer parameters:
_-_ REs indicated by the \'_RateMatchPatternLTE-CRS\'_ in _lte-CRS-
ToMatchAround_ in _ServingCellConfig_ or _ServingCellConfigCommon_ configuring
cell-specific RS, in 15 kHz subcarrier spacing applicable only to 15 kHz
subcarrier spacing PDSCH, of one LTE carrier in a serving cell are declared as
not available for PDSCH.
_-_ REs indicated by _\'RateMatchPatternLTE-CRS\'_ in _lte-CRS-
PatternList1-r16_ or _lte-CRS-PatternList3-r18_ in _ServingCellConfig_
configuring cell-specific RS, in 15 kHz subcarrier spacing applicable only to
15 kHz subcarrier spacing PDSCH, of one LTE carrier in a serving cell are
declared as not available for PDSCH.
_\- For the UE for broadcast reception, REs indicated by
\'RateMatchPatternLTE-CRS\'_ in _pdsch-ConfigMCCH_ or _pdsch-ConfigMTCH_
configuring cell-specific RS, in 15 kHz subcarrier spacing applicable only to
15 kHz subcarrier spacing PDSCH, of one LTE carrier in a serving cell are
declared as not available for broadcast PDSCH. The total number of
_RateMatchPatternLTE-CRS_ for broadcast reception that a UE can be configured
with is the same as for unicast in Rel-15.
\- Each _RateMatchPatternLTE-CRS_ configuration contains _v-Shift_ consisting
of LTE-CRS-vshift(s), _nrofCRS-Ports_ consisting of LTE-CRS antenna ports 1, 2
or 4 ports, _carrierFreqDL_ representing the offset in units of 15 kHz
subcarriers from (reference) point A to the LTE carrier centre subcarrier
location, _carrierBandwidthDL_ representing the LTE carrier bandwidth, and may
also configure _mbsfn-SubframeConfigList_ representing MBSFN subframe
configuration. A UE determines the CRS position within the slot according to
Clause 6.10.1.2 in [15, TS 36.211], where slot corresponds to LTE subframe.
\- If the UE is configured by higher layer parameter _PDCCH-Config_ with two
different values of _coresetPoolIndex_ in _ControlResourceSet_ and is also
configured by the higher layer parameter _lte-CRS-PatternList1-r16_ and _lte-
CRS-PatternList2-r16_ in _ServingCellConfig_ , the following REs are declared
as not available for PDSCH:
\- if the UE is configured with _crs-RateMatch-PerCoresetPoolIndex_ , REs
indicated by the CRS pattern(s) in _lte-CRS-PatternList1-r16_ if the PDSCH is
associated with _coresetPoolIndex_ set to \'0\', or the CRS pattern(s) in
_lte-CRS-PatternList2-r16_ if PDSCH is associated with _coresetPoolIndex_ set
to \'1\';
\- otherwise, REs indicated by _lte-CRS-PatternList1-r16_ and _lte-CRS-
PatternList2-r16,_ in _ServingCellConfig_.
\- If the UE is not configured by higher layer parameter _PDCCH-Config_ with
two different values of _coresetPoolIndex_ in _ControlResourceSet_ , and if
the UE is configured by higher layer parameter _lte-CRS-PatternList3-r18_ and
_lte-CRS-PatternList4-r18_ in _ServingCellConfig_ , REs indicated by _lte-CRS-
PatternList3-r18_ and _lte-CRS-PatternList4-r18_ are declared as not available
for PDSCH.
\- If the UE is configured by higher layer parameter _PDCCH-Config_ with two
different values of _coresetPoolIndex_ in _ControlResourceSet_ and is also
configured by the higher layer parameter _lte-CRS-PatternList3-r18_ and _lte-
CRS-PatternList4-r18_ in _ServingCellConfig_ , the following REs are declared
as not available for PDSCH:
\- if the UE is configured with _crs-RateMatch-PerCoresetPoolIndex_ , REs
indicated by the CRS pattern(s) in _lte-CRS-PatternList3-r18_ if the PDSCH is
associated with _coresetPoolIndex_ set to '0', or the CRS pattern(s) in _lte-
CRS-PatternList4-r18_ if PDSCH is associated with _coresetPoolIndex_ set to
'1';
\- otherwise, REs indicated by _lte-CRS-PatternList3-r18_ and _lte-CRS-
PatternList4-r18,_ in _ServingCellConfig_.
\- Within a BWP, the UE can be configured with one or more ZP CSI-RS resource
set configuration(s) for aperiodic, semi-persistent and periodic time-domain
behaviours (higher layer parameters _aperiodic-ZP-CSI-RS-
ResourceSetsToAddModList,_ _sp-ZP-CSI-RS-ResourceSetsToAddModList_ and _p-ZP-
CSI-RS-ResourceSet_ respectively comprised in _PDSCH-Config_), with each ZP
CSI-RS resource set consisting of at most 16 ZP CSI-RS resources (higher layer
parameter _ZP-CSI-RS-Resource_) in numerology of the BWP. The REs indicated by
_p-ZP-CSI-RS-ResourceSet_ are declared as not available for PDSCH. The REs
indicated by _sp-ZP-CSI-RS-ResourceSetsToAddModList_ and aperiodic-ZP-CSI-RS-
ResourceSetsToAddModList are declared as not available for PDSCH when their
triggering and activation are applied, respectively. The following parameters
are configured via higher layer signaling for each ZP CSI-RS resource
configuration:
\- _zp-CSI-RS-ResourceId_ in _ZP-CSI-RS-Resource_ determines ZP CSI-RS
resource configuration identity.
\- _nrofPorts_ in _CSI-RS-ResourceMapping_ defines the number of CSI-RS ports,
where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211].
\- _cdm-Type_ in _CSI-RS-ResourceMapping_ _defines CDM values and pattern,
where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211]._
_\- resourceMapping in ZP-CSI-RS-Resource defines t_ he OFDM symbol and
subcarrier occupancy of the ZP CSI-RS resource within a slot that are given in
Clause 7.4.1.5 of [4, TS 38.211].
_\- periodicityAndOffset in_ _ZP-CSI-RS-Resource defines the ZP-CSI-RS
periodicity and slot offset for periodic/semi-persistent ZP CSI-RS._
\- For the UE in RRC_CONNECTED mode for multicast reception, _p-ZP-CSI-RS-
ResourceSet_ can be configured in _pdsch-ConfigMulticast_ for GC-PDSCH rate
matching, subject to UE capability. The REs indicated by _p-ZP-CSI-RS-
ResourceSet_ are declared as not available for GC-PDSCH. The REs indicated by
_p-ZP-CSI-RS-ResourceSet_ configured in _PDSCH-Config for unicast do not apply
for_ GC-PDSCH and the REs indicated by _p-ZP-CSI-RS-ResourceSet_ configured in
_pdsch-ConfigMulticast for multicast do not apply for unicast_ PDSCH. The
total number of periodic _ZP-CSI-RS-Resources_ that a UE can be configured
with is the same as for unicast in Rel-16. If _p-ZP-CSI-RS-ResourceSet_ is
configured in both _PDSCH-Config_ and _pdsch-ConfigMulticast_ , it is subject
to UE capability whether the _p-ZP-CSI-RS-ResourceSet_ configured in _pdsch-
ConfigMulticast_ can be different from the _p-ZP-CSI-RS-ResourceSet_
configured in _PDSCH-Config_.
\- For the UE in RRC_CONNECTED mode for multicast reception, s _p-ZP-CSI-RS-
ResourceSet_ can be configured in _pdsch-ConfigMulticast_ for GC-PDSCH rate
matching, subject to UE capability. The REs indicated by s _p-ZP-CSI-RS-
ResourceSet_ are declared as not available for GC-PDSCH when their triggering
and activation delivered by unicast PDSCH are applied. The REs indicated by s
_p-ZP-CSI-RS-ResourceSet_ configured in _PDSCH-Config for unicast do not apply
for_ GC-PDSCH and the REs indicated by s _p-ZP-CSI-RS-ResourceSet_ configured
in _pdsch-ConfigMulticast for multicast do not apply for unicast_ PDSCH. The
total number of semi-persistent _ZP-CSI-RS-Resources_ that a UE can be
configured with is the same as for unicast.
The UE may be configured with a DCI field for triggering the aperiodic ZP CSI-
RS. A list of _ZP-CSI-RS-ResourceSet(s)_ , provided by higher layer parameter
_aperiodic-ZP-CSI-RS-ResourceSetsToAddModList_ in _PDSCH-Config_ , is
configured for aperiodic triggering. The maximum number of aperiodic _ZP-CSI-
RS-ResourceSet(s)_ configured per BWP is 3. The bit-length of DCI field _ZP
CSI-RS trigger_ depends on the number of aperiodic _ZP-CSI-RS-ResourceSet(s)_
configured (up to 2 bits). Each non-zero codepoint of \'_ZP CSI-RS\' trigger_
in DCI format 1_1 triggers one aperiodic \'_ZP-CSI-RS-ResourceSet_ \' in the
list _aperiodic-ZP-CSI-RS-ResourceSetsToAddModList_ by indicating the
aperiodic ZP CSI-RS resource set ID. The DCI codepoint \'01\' triggers the
resource set with \'ZP-CSI-RS-ResourceSetId\' set to \'1\', the DCI codepoint
\'10\' triggers the resource set with \'ZP-CSI-RS-ResourceSetId\' set to
\'2\', and the DCI codepoint \'11\' triggers the resource set with \'ZP-CSI-
RS-ResourceSetId\' set to \'3\'. Codepoint \'00\' is reserved for not
triggering aperiodic ZP CSI-RS. When receiving PDSCH scheduled by DCI format
1_0 or PDSCHs with SPS activated by DCI format 1_0, the REs corresponding to
configured resources in _aperiodic-ZP-CSI-RS-ResourceSetsToAddModList_ or in
_aperiodicZP-CSI-RS-ResourceSetsToAddModListDCI-1-2_ are available for PDSCH.
When the UE is configured with multi-slot and single-slot PDSCH scheduling or
_pdsch-TimeDomainAllocationListForMultiPDSCH_ , the triggered aperiodic ZP
CSI-RS is applied to all the slot(s) of the PDSCH(s) scheduled or the PDSCHs
with SPS activated by the PDCCH containing the trigger.
For a UE configured with a list of semi-persistent _ZP-CSI-RS-ResourceSet(s)_
provided by higher layer parameter _sp-ZP-CSI-RS-ResourceSetsToAddModList_ :
\- when the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the activation command, as described in
clause 6.1.3.19 of [10, TS 38.321], for ZP CSI-RS resource(s), the
corresponding action in [10, TS 38.321] and the UE assumption on the PDSCH RE
mapping corresponding to the activated ZP CSI-RS resource(s) shall be applied
starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ} + {\frac{2^{\mu}}{2^{\mu_{K_{\text{mac}}}}}
\bullet k}_{\text{mac}}$ where _μ_ is the SCS configuration for the PUCCH and
$\mu_{K_{\text{mac}}}\ $is the subcarrier spacing configuration for
$k_{\text{mac}}$ with a value of 0 for frequency range 1, and $k_{\text{mac}}$
is provided by _K-Mac_ or $k_{\text{mac}} = 0$ if _K-Mac_ is not provided.
\- when the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the deactivation command, as described in
clause 6.1.3.19 of [10, TS 38.321], for activated ZP CSI-RS resource(s), the
corresponding action in [10, TS 38.321] and the UE assumption on cessation of
the PDSCH RE mapping corresponding to the de-activated ZP CSI-RS resource(s)
shall be applied starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ} + {\frac{2^{\mu}}{2^{\mu_{K_{\text{mac}}}}}
\bullet k}_{\text{mac}}$ where _μ_ is the SCS configuration for the PUCCH and
$\mu_{K_{\text{mac}}}\ $is the subcarrier spacing configuration for
$k_{\text{mac}}$ with a value of 0 for frequency range 1, and $k_{\text{mac}}$
is provided by _K-Mac_ or $k_{\text{mac}} = 0$ if _K-Mac_ is not provided.
### 5.1.5 Antenna ports quasi co-location
The UE can be configured with a list of up to _M_ _TCI-State_ configurations
within the higher layer parameter _PDSCH-Config_ to decode PDSCH according to
a detected PDCCH with DCI intended for the UE and the given serving cell,
where M depends on the UE capability _maxNumberConfiguredTCIstatesPerCC_. Each
_TCI-State_ contains parameters for configuring a quasi co-location
relationship between one or two downlink reference signals and the DM-RS ports
of the PDSCH, the DM-RS port of PDCCH or the CSI-RS port(s) of a CSI-RS
resource. The quasi co-location relationship is configured by the higher layer
parameter _qcl-Type1_ for the first DL RS, and _qcl-Type2_ for the second DL
RS (if configured). For the case of two DL RSs, the QCL types shall not be the
same, regardless of whether the references are to the same DL RS or different
DL RSs. The quasi co-location types corresponding to each DL RS are given by
the higher layer parameter _qcl-Type_ in _QCL-Info_ and may take one of the
following values:
\- \'typeA\': {Doppler shift, Doppler spread, average delay, delay spread}
\- \'typeB\': {Doppler shift, Doppler spread}
\- \'typeC\': {Doppler shift, average delay}
\- \'typeD\': {Spatial Rx parameter}
The UE can be configured with a list of up to _128_ _TCI-State_
configurations, within the higher layer parameter _dl-OrJointTCI-StateList_ in
_PDSCH-Config_ for providing a reference signal for the quasi co-location for
DM-RS of PDSCH and DM-RS of PDCCH in a BWP/CC, for CSI-RS, and to provide a
reference, if applicable, for determining UL TX spatial filter for dynamic-
grant and configured-grant based PUSCH and PUCCH resource in a BWP/CC, and
SRS.
If the _TCI-State_ or _TCI-UL-State_ configurations are absent in a BWP of the
CC, the UE can apply the _TCI-State_ or _TCI-UL-State_ configurations from a
reference BWP of a reference CC. The UE is not expected to be configured with
_tci-StatesToAddModList_ , _SpatialRelationInfo_ or _PUCCH-
SpatialRelationInfo_ , **except _SpatialRelationInfoPos in a CC in a band_ ,**
if the UE is configured with _dl-OrJointTCI-StateList_ or _ul-TCI-StateList_
in any CC in the same band. The UE can assume that when the UE is configured
with _tci-StatesToAddModList_ in any CC in the CC list configured by
_simultaneousTCI-UpdateList1-r16, simultaneousTCI-UpdateList2-r16,_
_simultaneousSpatial-UpdatedList1-r16, or simultaneousSpatial-
UpdatedList2-r16,_ the UE is not configured with _dl-OrJointTCI-StateList_ or
_ul-TCI-StateList_ in any CC within the same band in the CC list.
The UE receives an activation command, as described in clause 6.1.3.xx of [10,
TS 38.321], 6.1.3.47 of [10, TS 38.321] or 6.1.4.xx of [10, TS 38.321], used
to map up to 8 TCI states and/or pairs of TCI states, with one TCI state for
DL channels/signals and/or one TCI state for UL channels/signals to the
codepoints of the DCI field _\'Transmission Configuration Indication\'_ for
one or for a set of CCs/DL BWPs, [and/] or up to 8 sets of TCI states, where
each set is comprised of up to two TCI state(s) for DL and UL
signals/channels, or up to two TCI state(s) for DL channels/signals and up to
two TCI state(s) for UL channels/signals to the codepoints of the DCI field
_\'Transmission Configuration Indication\'_ for one or for a set of CCs/DL
BWPs, and if applicable, for one or for a set of CCs/UL BWPs. When a set of
TCI state IDs are activated for a set of CCs/DL BWPs and if applicable, for a
set of CCs/UL BWPs, where the applicable list of CCs is determined by the
indicated CC in the activation command, the same set of TCI state IDs are
applied for all DL and/or UL BWPs in the indicated CCs. If the activation
command maps _TCI-State(s)_ and/or _TCI-UL-State(s)_ to only one TCI
codepoint, the UE shall apply the indicated _TCI-State(s)_ and/or _TCI-UL-
State(s)_ to one or to a set of CCs /DL BWPs, and if applicable, to one or to
a set of CCs /UL BWPs once the indicated mapping for the one single TCI
codepoint is applied as described in [11, TS 38.133].
When the _bwp-id_ or _cell_ for QCL-TypeA/D source RS in a QCL-Info of the TCI
state is not configured, the UE assumes that QCL-TypeA/D source RS is
configured in the CC/DL BWP where TCI state applies.
When _tci-PresentInDCI_ is set as \'enabled\' or _tci-PresentDCI-1-2_ is
configured for the CORESET, a UE configured with _dl-OrJointTCI-StateList_
with activated _TCI-State_ or _ul-TCI-StateList_ with activated _TCI-UL-State_
receives DCI format 1_1/1_2/1_3 providing indicated _TCI-State(s)_ and/or
_TCI-UL-State(s)_ for a CC or all CCs in the same CC list configured by
_simultaneousU-TCI-UpdateList1-r17, simultaneousU-TCI-UpdateList2-r17,
simultaneousU-TCI-UpdateList3-r17, simultaneousU-TCI-UpdateList4-r17_. The DCI
format 1_1/1_2 can be with or without, if applicable, DL assignment. If the
DCI format 1_1/1_2/ is without DL assignment, the UE can assume the following:
\- CS-RNTI is used to scramble the CRC for the DCI
\- The values of the following DCI fields are set as follows:
\- RV = all \'1\'s
\- MCS = all \'1\'s
\- NDI = 0
\- Set to all \'0\'s for FDRA Type 0, or all \'1\'s for FDRA Type 1, or all
\'0\'s for dynamicSwitch (same as in Table 10.2-4 of [6, TS 38.213]).
After a UE receives an initial higher layer configuration of _dl-OrJointTCI-
StateList_ with more than one _TCI-State_ and before application of an
indicated TCI state from the configured TCI states:
\- The UE assumes that DM-RS of PDSCH and DM-RS of PDCCH and the CSI-RS
applying the indicated TCI state are quasi co-located with the SS/PBCH block
the UE identified during the initial access procedure
After a UE receives an initial higher layer configuration of _dl-OrJointTCI-
StateList_ with more than one _TCI-State_ or _ul-TCI-StateList_ with more than
one _TCI-UL-State_ and before application of an indicated TCI state from the
configured TCI states:
\- The UE assumes that the UL TX spatial filter, if applicable, for dynamic-
grant and configured-grant based PUSCH and PUCCH, and for SRS applying the
indicated TCI state, is the same as that for a PUSCH transmission scheduled by
a RAR UL grant during the initial access procedure
After a UE receives a higher layer configuration of _dl-OrJointTCI-StateList_
with more than one _TCI-State_ as part of a Reconfiguration with sync
procedure as described in [12, TS 38.331] and before applying an indicated TCI
state from the configured TCI states:
\- The UE assumes that DM-RS of PDSCH and DM-RS of PDCCH, and the CSI-RS
applying the indicated TCI state are quasi co-located with the SS/PBCH block
or the CSI-RS resource the UE identified during the random access procedure
initiated by the Reconfiguration with sync procedure as described in [12, TS
38.331].
After a UE receives a higher layer configuration of _dl-OrJointTCI-StateList_
with more than one _TCI-State_ or more than one _TCI-UL-State_ as part of a
Reconfiguration with sync procedure as described in [12, TS 38.331] and before
applying an indicated TCI state from the configured TCI states:
\- The UE assumes that the UL TX spatial filter, if applicable, for dynamic-
grant and configured-grant based PUSCH and PUCCH, and for SRS applying the
indicated TCI state, is the same as that for a PUSCH transmission scheduled by
a RAR UL grant during random access procedure initiated by the Reconfiguration
with sync procedure as described in [12, TS 38.331].
If a UE receives a higher layer configuration of _dl-OrJointTCI-StateList_
with a single _TCI-State_ , that can be used as an indicated TCI state _,_ the
UE obtains the QCL assumptions from the configured TCI state for DM-RS of
PDSCH and DM-RS of PDCCH, and the CSI -RS applying the indicated TCI state.
If a UE receives a higher layer configuration of _dl-OrJointTCI-StateList_
with a single _TCI-State_ or _ul-TCI-StateList_ with a single _TCI-UL-State_ ,
that can be used as an indicated TCI state, the UE determines an UL TX spatial
filter, if applicable, from the configured TCI state for dynamic-grant and
configured-grant based PUSCH and PUCCH, and SRS applying the indicated TCI
state.
When a UE configured with _dl-OrJointTCI-StateList_ would transmit a PUCCH
with positive HARQ-ACK or a PUSCH with positive HARQ-ACK corresponding to the
DCI carrying the TCI State indication and without DL assignment, or
corresponding to the PDSCH scheduled by the DCI carrying the TCI State
indication, and if the indicated TCI State(s) is/are different from the
previously indicated one(s), the indicated _TCI-State(s)_ and/or _TCI-UL-
State(s)_ should be applied starting from the first slot that is at least $\
\text{beamAppTime}$ symbols after the last symbol of the PUCCH or the PUSCH.
The first slot and the $\ \text{beamAppTime}$ symbols are both determined on
the active BWP with the smallest SCS among the BWP(s) from the CCs applying
the indicated _TCI-State(s)_ or _TCI-UL-State(s)_ that are active at the end
of the PUCCH or the PUSCH carrying the positive HARQ-ACK.
If a UE is configured with _pdsch-TimeDomainAllocationListForMultiPDSCH_ in
which one or more rows contain multiple _SLIV_ s for PDSCH on a DL BWP of a
serving cell, and the UE is receiving a DCI carrying the _TCI-State_
indication and without DL assignment, the UE does not expect that the number
of indicated _SLIV_ s in the row of **the** _pdsch-
TimeDomainAllocationListForMultiPDSCH_ by the DCI **is** more than one.
If the UE is configured with _SSB-MTC-AddtionalPCI_ and with _PDCCH-Config_
that contains two different values of _coresetPoolIndex_ in
_ControlResourceSet_ , the UE receives an activation command for CORESET
associated with each _coresetPoolIndex_ , as described in clause 6.1.3.14 of
[10, TS 38.321] or 6.1.3.xx of [10, TS 38.321], used to map up to 8 TCI states
and/or pairs of TCI states, with one TCI state for DL channels/signals and/or
one TCI state for UL channels/signals to the codepoints of the DCI field
_\'Transmission Configuration Indication\'_ in one CC/DL BWP. When a set of
TCI state IDs are activated for a _coresetPoolIndex_ , the activated TCI
states corresponding to one _coresetPoolIndex_ is associated with the serving
cell physical cell ID and activated TCI states corresponding to another
_coresetPoolIndex_ can be associated with another physical cell ID.
When a UE supports two TCI states in a codepoint of the DCI field
\'_Transmission Configuration Indication\'_ the UE may receive an activation
command, as described in clause 6.1.3.24 of [10, TS 38.321], the activation
command is used to map up to 8 combinations of one or two TCI states to the
codepoints of the DCI field _\'Transmission Configuration Indication\'_. The
UE is not expected to receive more than 8 TCI states in the activation
command.
When the DCI field _\'Transmission Configuration Indication\'_ is present in
DCI format 1_2 and when the number of codepoints S in the DCI field
_\'Transmission Configuration Indication\'_ of DCI format 1_2 is smaller than
the number of TCI codepoints that are activated by the activation command, as
described in clause 6.1.3.14 and 6.1.3.24 of [10, TS38.321], only the first S
activated codepoints are applied for DCI format 1_2.
When the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the activation command, the indicated
mapping between TCI states and codepoints of the DCI field _\'Transmission
Configuration Indication\'_ should be applied starting from the first slot
that is after slot$\ n + {3N}_{\text{slot}}^{subframe,µ} +
{\frac{2^{\mu}}{2^{\mu_{K_{\text{mac}}}}} \bullet k}_{\text{mac}}$ where _μ_
is the SCS configuration for the PUCCH and $\mu_{K_{\text{mac}}}\ $is the
subcarrier spacing configuration for $k_{\text{mac}}$ with a value of 0 for
frequency range 1, and $k_{\text{mac}}$ is provided by _K-Mac_ or
$k_{\text{mac}} = 0$ if _K-Mac_ is not provided. If _tci-PresentInDCI_ is set
to \'enabled\' or _tci-PresentDCI-1-2_ is configured for the CORESET
scheduling the PDSCH, and the time offset between the reception of the DL DCI
and the corresponding PDSCH is equal to or greater than _timeDurationForQCL_
if applicable, after a UE receives an initial higher layer configuration of
TCI states and before reception of the activation command, the UE may assume
that the DM-RS ports of PDSCH of a serving cell are quasi co-located with the
SS/PBCH block determined in the initial access procedure with respect to _qcl-
Type_ set to \'typeA\', and when applicable, also with respect to _qcl-Type_
set to \'typeD\'.
If a UE is configured with the higher layer parameter _tci-PresentInDCI_ that
is set as \'enabled\' for the CORESET scheduling a PDSCH, the UE assumes that
the TCI field is present in the DCI format 1_1 or format 1_3 of the PDCCH
transmitted on the CORESET. If a UE is configured with the higher layer
parameter _tci-PresentDCI-1-2_ for the CORESET scheduling the PDSCH, the UE
assumes that the TCI field with a DCI field size indicated by _tci-
PresentDCI-1-2_ is present in the DCI format 1_2 of the PDCCH transmitted on
the CORESET. If a UE is configured with the higher layer parameter _tci-
PresentInDCI_ that is set as \'enabled\' for the CORESET scheduling the
multicast PDSCH, the UE assumes that the TCI field is present in the DCI
format 4_2 of the PDCCH transmitted on the CORESET. If the PDSCH is scheduled
by a DCI format not having the TCI field present, and the time offset between
the reception of the DL DCI and the corresponding PDSCH of a serving cell is
equal to or greater than a threshold _timeDurationForQCL_ if applicable, where
the threshold is based on reported UE capability [13, TS 38.306], for
determining PDSCH antenna port quasi co-location, the UE assumes that the TCI
state or the QCL assumption for the PDSCH is identical to the TCI state or QCL
assumption whichever is applied for the CORESET used for the PDCCH
transmission within the active BWP of the serving cell.
When a UE is configured with both _sfnSchemePDCCH_ and _sfnSchemePDSCH_
scheduled by DCI format 1_0 or by DCI format 1_1/1_2, if the time offset
between the reception of the DL DCI and the corresponding PDSCH of a serving
cell is equal to or greater than a threshold _timeDurationForQCL_ if
applicable:
\- if the UE supports _sfn-DefaultDL-BeamSetup-r17_ for DCI scheduling without
TCI field, the UE assumes that the TCI state(s) or the QCL assumption(s) for
the PDSCH is identical to the TCI state(s) or QCL assumption(s) whichever is
applied for the CORESET used for the reception of the DL DCI within the active
BWP of the serving cell regardless of the number of active TCI states of the
CORESET. If the UE does not support _sfn-SchemeA-DynamicSwitching-r17_ or
_sfn-SchemeB-DynamicSwitching-r17_ , the UE should be activated with the
CORESET with two TCI states.
\- else if the UE does not support _sfn-DefaultDL-BeamSetup-r17_ for DCI
scheduling without TCI field, the UE shall expect TCI field present when
scheduled by DCI format 1_1/1_2.
When a UE is configured with _sfnSchemePDSCH_ and _sfnSchemePDCCH_ is not
configured, when scheduled by DCI format 1_1/1_2, if the time offset between
the reception of the DL DCI and the corresponding PDSCH of a serving cell is
equal to or greater than a threshold _timeDurationForQCL_ if applicable, the
UE shall expect TCI field present.
For PDSCH scheduled by DCI format 1_0, 1_1, 1_2, when a UE is configured with
_sfnSchemePDCCH_ set to \'sfnSchemeA\' and _sfnSchemePDSCH_ is not configured,
and there is no TCI codepoint with two TCI states in the activation command,
and if the time offset between the reception of the DL DCI and the
corresponding PDSCH is equal or larger than the threshold _timeDurationForQCL_
if applicable and the CORESET which schedules the PDSCH is indicated with two
TCI states, the UE assumes that the TCI state or the QCL assumption for the
PDSCH is identical to the first TCI state or QCL assumption which is applied
for the CORESET used for the PDCCH transmission within the active BWP of the
serving cell.
If a PDSCH is scheduled by a DCI format having the TCI field present, the TCI
field in DCI in the scheduling component carrier points to the activated TCI
states in the scheduled component carrier or DL BWP, the UE shall use the
_TCI-State_ according to the value of the \'_Transmission Configuration
Indication_ \' field in the detected PDCCH with DCI for determining PDSCH
antenna port quasi co-location. The UE may assume that the DM-RS ports of
PDSCH of a serving cell are quasi co-located with the RS(s) in the TCI state
with respect to the QCL type parameter(s) given by the indicated TCI state if
the time offset between the reception of the DL DCI and the corresponding
PDSCH is equal to or greater than a threshold _timeDurationForQCL_ , where the
threshold is based on reported UE capability [13, TS 38.306]. For a single
slot PDSCH, the indicated TCI state(s) should be based on the activated TCI
states in the slot with the scheduled PDSCH. For a multi-slot PDSCH or the UE
is configured with higher layer parameter _pdsch-
TimeDomainAllocationListForMultiPDSCH_ , the indicated TCI state(s) should be
based on the activated TCI states in the first slot with the scheduled
PDSCH(s), and UE shall expect the activated TCI states are the same across the
slots with the scheduled PDSCH(s). When the UE is configured with CORESET
associated with a search space set for cross-carrier scheduling and the UE is
not configured with _enableDefaultBeamForCCS_ , the UE expects _tci-
PresentInDCI_ is set as \'enabled\' or _tci-PresentDCI-1-2_ is configured for
the CORESET, and if one or more of the TCI states configured for the serving
cell scheduled by the search space set contains _qcl-Type_ set to \'typeD\',
the UE expects the time offset between the reception of the detected PDCCH in
the search space set and a corresponding PDSCH is larger than or equal to the
threshold _timeDurationForQCL._
Independent of the configuration of _tci-PresentInDCI_ and _tci-
PresentDCI-1-2_ in RRC connected mode, if the UE is not provided _dl-
OrJointTCI-StateList-r17_ , and if the offset between the reception of the DL
DCI and the corresponding PDSCH is less than the threshold
_timeDurationForQCL_ and at least one configured TCI state for the serving
cell of scheduled PDSCH contains _qcl-Type_ set to \'typeD\',
\- the UE may assume that the DM-RS ports of PDSCH(s) of a serving cell are
quasi co-located with the RS(s) with respect to the QCL parameter(s) used for
PDCCH quasi co-location indication of the CORESET associated with a monitored
search space with the lowest _controlResourceSetId_ in the latest slot in
which one or more CORESETs within the active BWP of the serving cell are
monitored by the UE. In this case, if the _qcl-Type_ is set to \'typeD\' of
the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they
overlap in at least one symbol, the UE is expected to prioritize the reception
of PDCCH associated with that CORESET. This also applies to the intra-band CA
case (when PDSCH and the CORESET are in different component carriers).
\- If a UE is configured with _enableDefaultTCI-StatePerCoresetPoolIndex_ and
the UE is configured by higher layer parameter _PDCCH-Config_ that contains
two different values of _coresetPoolIndex_ in different _ControlResourceSets,_
\- the UE may assume that the DM-RS ports of PDSCH associated with a value of
_coresetPoolIndex_ of a serving cell are quasi co-located with the RS(s) with
respect to the QCL parameter(s) used for PDCCH quasi co-location indication of
the CORESET associated with a monitored search space with the lowest
_controlResourceSetId_ among CORESETs, which are configured with the same
value of _coresetPoolIndex_ as the PDCCH scheduling that PDSCH, in the latest
slot in which one or more CORESETs associated with the same value of
_coresetPoolIndex_ as the PDCCH scheduling that PDSCH within the active BWP of
the serving cell are monitored by the UE. In this case, if the \'QCL-TypeD\'
of the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they
overlap in at least one symbol and they are associated with same value of
_coresetPoolIndex_ , the UE is expected to prioritize the reception of PDCCH
associated with that CORESET. This also applies to the intra-band CA case
(when PDSCH and the CORESET are in different component carriers).
\- If a UE is configured with _enableTwoDefaultTCI-States_ , and at least one
TCI codepoint indicates two TCI states, the UE may assume that the DM-RS ports
of PDSCH or PDSCH transmission occasions of a serving cell are quasi co-
located with the RS(s) with respect to the QCL parameter(s) associated with
the TCI states corresponding to the lowest codepoint among the TCI codepoints
containing two different TCI states. When the UE is configured by higher layer
parameter _repetitionScheme_ set to \'tdmSchemeA\' or is configured with
higher layer parameter _repetitionNumber_ , and the offset between the
reception of the DL DCI and the first PDSCH transmission occasion is less than
the threshold _timeDurationForQCL,_ the mapping of the TCI states to PDSCH
transmission occasions is determined according to clause 5.1.2.1 by replacing
the indicated TCI states with the TCI states corresponding to the lowest
codepoint among the TCI codepoints containing two different TCI states based
on the activated TCI states in the slot with the first PDSCH transmission
occasion. In this case, if the \'QCL-TypeD\' in both of the TCI states
corresponding to the lowest codepoint among the TCI codepoints containing two
different TCI states is different from that of the PDCCH DM-RS with which they
overlap in at least one symbol, the UE is expected to prioritize the reception
of PDCCH associated with that CORESET. This also applies to the intra-band CA
case (when PDSCH and the CORESET are in different component carriers)
\- If a UE is not configured with _sfnSchemePDSCH_ , and the UE is configured
with _sfnSchemePDCCH_ set to \'sfnSchemeA\' and there is no TCI codepoint with
two TCI states in the activation command and the CORESET with the lowest ID in
the latest slot is indicated with two TCI states, the UE may assume that the
DM-RS ports of PDSCH of a serving cell are quasi co-located with the RS(s)
with respect to the QCL parameter(s) associated with the first TCI state of
two TCI states indicated for the CORESET. In this case, if the _qcl-Type_ is
set to \'typeD\' of the PDSCH DM-RS is different from that of the PDCCH DM-RS
with which they overlap in at least one symbol, the UE is expected to
prioritize the reception of PDCCH associated with that CORESET with single
active TCI state. This also applies to the intra-band CA case (when PDSCH and
the CORESET are in different component carriers).
\- In all cases above, if none of configured TCI states for the serving cell
of scheduled PDSCH is configured with _qcl-Type_ set to \'typeD\', the UE
shall obtain the other QCL assumptions from the indicated TCI state(s) for its
scheduled PDSCH irrespective of the time offset between the reception of the
DL DCI and the corresponding PDSCH.
Independent of the configuration of _tci-PresentInDCI_ and _tci-
PresentDCI-1-2_ in RRC connected mode, if the UE is provided _dl-OrJointTCI-
StateList-r17_ , and if the offset between the reception of the DL DCI and the
corresponding PDSCH is less than the threshold _timeDurationForQCL_ and at
least one configured TCI state for the serving cell of scheduled PDSCH
contains _qcl-Type_ set to \'typeD\', regardless of configuration of
_followUnifiedTCI-State_ ,
\- if the indicated TCI state is associated with the PCI of the serving cell,
the indicated TCI state is applied to PDSCH reception.
\- if the indicated TCI state is associated with a PCI different from the
serving cell, the UE may assume that the DM-RS ports of PDSCH(s) of a serving
cell are quasi co-located with the RS(s) with respect to the QCL parameter(s)
used for PDCCH quasi co-location indication of the CORESET associated with a
monitored search space with the lowest _controlResourceSetId_ in the latest
slot in which one or more CORESETs within the active BWP of the serving cell
are monitored by the UE. In the CA case, if the \'QCL-TypeD\' of the PDSCH DM-
RSs from respective CCs in a band are different in a slot, the QCL-TypeD
assumption of the PDSCH DM-RS in the CC with lowest CC ID in the band is
applied to all the PDSCH DM-RSs in the CCs in the band. In this case, if the
_qcl-Type_ is set to \'typeD\' of the PDSCH DM-RS is different from that of
the PDCCH DM-RS with which they overlap in at least one symbol, the UE is
expected to prioritize the reception of PDCCH associated with that CORESET.
This also applies to the intra-band CA case (when PDSCH and the CORESET are in
different component carriers).
If the PDCCH carrying the scheduling DCI is received on one component carrier,
and a PDSCH scheduled by that DCI is on another component carrier:
\- The _timeDurationForQCL_ is determined based on the subcarrier spacing of
the scheduled PDSCH. If µ~PDCCH~ \ \- the UE may assume the sub-carrier spacing of the NZP CSI-RS resources
> configured by _TRS-ResourceSet_ to be same as the sub-carrier spacing of the
> initial DL BWP.
\- _powerControlOffsetSS_ given by a _TRS-ResourceSet_ applies to all
resources in a _TRS-ResourceSet_.
\- the QCL information for periodic NZP CSI-RS resources, is given by the
higher layer parameter _ssb-Index_ configured by a _TRS-ResourceSet_ , is a
SS/PBCH block, applies to all resources in a _TRS-ResourceSet_.
\- One or more scrambling IDs according to _scramblingID-Info_ where if a
single _scramblingIDforCommon_ is configured, it applies to all NZP-CSI-RS
resources in the resource set, otherwise, each NZP-CSI-RS resource is provided
with a scrambling IDs according to _scramblingIDperResourceListWith2_ or
_scramblingIDperResourceListWith4_.
\- the UE may assume the following quasi co-location type(s):
\- \'typeC\' with an SS/PBCH block and, when applicable, \'typeD\' with the
same SS/PBCH block.
For each _TRS-ResourceSet_ the index of the associated bit in TRS availability
indication field [5, TS 38.212], is given by the higher layer parameter
_indBitID_.
##### 5.1.6.1.1.1 Aperiodic CSI-RS for tracking for fast SCell activation
{#aperiodic-csi-rs-for-tracking-for-fast-scell-activation .H6}
A UE can be configured with aperiodic CSI-RS resources for tracking for an
SCell for fast SCell activation using _NZP-CSI-RS-ResourceSet(s)_ with the
higher layer parameter _scellActivationRS-ConfigToAddModList_ , with the QCL
relation, provided by higher layer parameter _qcl-Info_ given by
_SCellActivationRS-Config_ as with aperiodic CSI-RS for tracking in clause
5.1.6.1.1.
Each CSI-RS resource, defined in clause 7.4.1.5.3 of [4, TS 38.211], for fast
SCell activation is configured by the higher layer parameter _NZP-CSI-RS-
Resource_ with the same restrictions as defined for CSI-RS for tracking in
clause 5.1.6.1.1.
##### 5.1.6.1.2 CSI-RS for L1-RSRP and L1-SINR computation
If a UE is configured with a _NZP-CSI-RS-ResourceSet_ configured with the
higher layer parameter _repetition_ set to \'on\', the UE may assume that the
CSI-RS resources, described in Clause 5.2.2.3.1, within the _NZP-CSI-RS-
ResourceSet_ are transmitted with the same downlink spatial domain
transmission filter, where the CSI-RS resources in the _NZP-CSI-RS-
ResourceSet_ are transmitted in different OFDM symbols. If _repetition_ is set
to \'off\', the UE shall not assume that the CSI-RS resources within the _NZP-
CSI-RS-ResourceSet_ are transmitted with the same downlink spatial domain
transmission filter.
If the UE is configured with a _CSI-ReportConfig_ with _reportQuantity_ set to
\'cri-RSRP\', \'cri-SINR\' or \'none\' and if the _CSI-ResourceConfig_ for
channel measurement (higher layer parameter _resourcesForChannelMeasurement_)
contains a _NZP-CSI-RS-ResourceSet_ that is configured with the higher layer
parameter _repetition_ and without the higher layer parameter _trs-Info_ , the
UE can only be configured with the same number (1 or 2) of ports with the
higher layer parameter _nrofPorts_ for all CSI-RS resources within the set. If
the UE is configured with the CSI-RS resource in the same OFDM symbol(s) as an
SS/PBCH block, the UE may assume that the CSI-RS and the SS/PBCH block are
quasi co-located with \'typeD\' if \'typeD\' is applicable. Furthermore, the
UE shall not expect to be configured with the CSI-RS in PRBs that overlap with
those of the SS/PBCH block, and the UE shall expect that the same subcarrier
spacing is used for both the CSI-RS and the SS/PBCH block.
##### 5.1.6.1.3 CSI-RS for mobility
If a UE is configured with the higher layer parameter _CSI-RS-Resource-
Mobility_ and the higher layer parameter _associatedSSB_ is not configured,
the UE shall perform measurements based on _CSI-RS-Resource-Mobility_ and the
UE may base the timing of the CSI-RS resource on the timing of the serving
cell.
If a UE is configured with the higher layer parameters _CSI-RS-Resource-
Mobility_ and _associatedSSB_ , the UE may base the timing of the CSI-RS
resource on the timing of the cell given by the _cellId_ of the CSI-RS
resource configuration. Additionally, for a given CSI-RS resource, if the
associated SS/PBCH block is configured but not detected by the UE, the UE is
not required to monitor the corresponding CSI-RS resource. The higher layer
parameter _isQuasiColocated_ indicates whether the associated SS/PBCH block
given by the _associatedSSB_ and the CSI-RS resource(s) are quasi co-located
with respect to \'typeD\', when applicable.
If a UE is configured with the higher layer parameter _CSI-RS-Resource-
Mobility_ and with periodicity greater than 10 msec in paired spectrum, the UE
may assume the absolute value of the time difference between radio frame _i_
between any two cells, listed in the configuration with the higher layer
parameter _CSI-RS-CellMobility_ and with same _refFreqCSI-RS_ , is less than
153600 _T~s~_.
If the UE is configured with DRX, the UE is not required to perform
measurement of CSI-RS resources other than during the active time for
measurements based on _CSI-RS-Resource-Mobility_. When the UE is configured to
monitor DCI format 2_6, the UE is not required to perform measurements other
than during the active time and during the timer duration indicated by _drx-
onDurationTimer_ in _DRX-Config_ also outside active time based on _CSI-RS-
Resource-Mobility_.
If the UE is configured with DRX and DRX cycle in use is larger than 80 msec,
the UE may not expect CSI-RS resources are available other than during the
active time for measurements based on _CSI-RS-Resource-Mobility_. If the UE is
configured with DRX and configured to monitor DCI format 2_6 and DRX cycle in
use is larger than 80 msec, the UE may not expect that the CSI-RS resources
are available other than during the active time and during the time duration
indicated by _drx-onDurationTimer_ in _DRX-Config_ also outside active time
for measurements based on _CSI-RS-Resource-Mobility._ Otherwise, the UE may
assume CSI-RS are available for measurements based on _CSI-RS-Resource-
Mobility_.
A UE configured with the higher layer parameters _CSI-RS-Resource-Mobility_
may expect to be configured
\- with no more than 96 CSI-RS resources per higher layer parameter
_MeasObjectNR_ for UEs not supporting [_increasedNumberofCSIRSPerMO-r16_] when
all CSI-RS resources configured by the same higher layer parameter
_MeasObjectNR_ have been configured with _associatedSSB_ , or,
\- with no more than 192 CSI-RS resources per higher layer parameter
_MeasObjectNR_ for UEs supporting [_increasedNumberofCSIRSPerMO-r16_] when all
CSI-RS resources configured by the same higher layer parameter _MeasObjectNR_
have been configured with _associatedSSB_ , or,
\- with no more than 64 CSI-RS resources per higher layer parameter
_MeasObjectNR_ when all CSI-RS resources have been configured without
_associatedSSB_ or when only some of the CSI-RS resources have been configured
with associatedSSB by the same higher layer parameter _MeasObjectNR_
\- For frequency range 1 the _associatedSSB_ is optionally present for each
CSI-RS resource.
\- For frequency range 2 the _associatedSSB_ is either present for all
configured CSI-RS resources or not present for any configured CSI-RS resource
per higher layer parameter _MeasObjectNR_.
For any CSI-RS resource configuration, the UE shall assume that the value for
parameter _cdm-Type_ is \'noCDM\', and there is only one antenna port.
#### 5.1.6.2 DM-RS reception procedure
The DM-RS reception procedures for PDSCH scheduled by PDCCH with DCI format
1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with
DCI format 1_2, by applying the parameters of _dmrs-DownlinkForPDSCH-
MappingTypeA-DCI-1-2_ and _dmrs-DownlinkForPDSCH-MappingTypeB-DCI-1-2_ instead
of _dmrs-DownlinkForPDSCH-MappingTypeA_ and _dmrs-DownlinkForPDSCH-
MappingTypeB_. The DM-RS reception procedures for PDSCH scheduled by PDCCH
with DCI format 1_1 described in this clause equally apply to PDSCH scheduled
by PDCCH with DCI format 1_3.
The DM-RS reception procedures for PDSCH scheduled by PDCCH with DCI format
1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with
DCI format 4_2, by applying the parameters of _dmrs-DownlinkForPDSCH-
MappingTypeA_ and _dmrs-DownlinkForPDSCH-MappingTypeB_ in _pdsch-
ConfigMulticast_ instead of _dmrs-DownlinkForPDSCH-MappingTypeA_ and _dmrs-
DownlinkForPDSCH-MappingTypeB in PDSCH-Config_.
When receiving PDSCH scheduled by DCI format 1_0, 4_0, or 4_1, or receiving
PDSCH before dedicated higher layer configuration of any of the parameters
_dmrs-AdditionalPosition_ , _maxLength_ and _dmrs-Type,_ the UE shall assume
that the PDSCH is not present in any symbol carrying DM-RS except for PDSCH
with allocation duration of 2 symbols with PDSCH mapping type B (described in
clause 7.4.1.1.2 of [4, TS 38.211]), and a single symbol front-loaded DM-RS of
configuration type 1 on DM-RS port 1000 is transmitted, and that all the
remaining orthogonal antenna ports are not associated with transmission of
PDSCH to another UE and in addition
\- For PDSCH with mapping type A and type B, the UE shall assume _dmrs-
AdditionalPosition_ =\'pos2\' and up to two additional single-symbol DM-RS
present in a slot according to the PDSCH duration indicated in the DCI as
defined in Clause 7.4.1.1 of [4, TS 38.211], and
\- For PDSCH with allocation duration of 2 symbols with mapping type B, the UE
shall assume that the PDSCH is present in the symbol carrying DM-RS.
When receiving PDSCH scheduled by DCI format 1_1 or 1_3 by PDCCH with CRC
scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI or DCI format 4_2 by PDCCH with
CRC scrambled by G-RNTI for multicast or G-CS-RNTI,
\- the UE may be configured with the higher layer parameter _dmrs-Type and/or
enhanced-dmrs-Type_r18_ , and the configured DM-RS configuration type is used
for receiving PDSCH in as defined in Clause 7.4.1.1 of [4, TS 38.211].
\- the UE may be configured with the maximum number of front-loaded DM-RS
symbols for PDSCH by higher layer parameter _maxLength_ given by _DMRS-
DownlinkConfig.._
\- if _maxLength_ is set to \'len1\', single-symbol DM-RS can be scheduled for
the UE by DCI, and the UE can be configured with a number of additional DM-RS
for PDSCH by higher layer parameter _dmrs-AdditionalPosition,_ which can be
set to \'pos0\', \'pos1\', \'pos2\' or \'pos3\'.
\- if _maxLength_ is set to \'len2\', both single-symbol DM-RS and double
symbol DM-RS can be scheduled for the UE by DCI, and the UE can be configured
with a number of additional DM-RS for PDSCH by higher layer parameter _dmrs-
AdditionalPosition,_ which can be set to \'pos0\' or \'pos1\'.
\- and the UE shall assume to receive additional DM-RS as specified in Table
7.4.1.1.2-3 and Table 7.4.1.1.2-4 as described in Clause 7.4.1.1.2 of [4, TS
38.211].
For the UE-specific reference signals generation as defined in Clause 7.4.1.1
of [4, TS 38.211], a UE can be configured by higher layers with one or two
scrambling identity(s), $n_{\text{ID}}^{DMRS,i}\ $_i_ = 0,1 which are the same
for both PDSCH mapping Type A and Type B.
A UE may be scheduled with a number of DM-RS ports by the antenna port index
in DCI format 1_1 as described in Clause 7.3.1.2 of [5, TS 38.212].
For DM-RS configuration type 1,
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of {2, 9, 10, 11 or 30} in Table 7.3.1.2.2-1 and Table
7.3.1.2.2-2 of Clause 7.3.1.2 of [5, TS 38.212], or
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of {2, 9, 10, 11 or 12} in Table 7.3.1.2.2-1A and {2, 9,
10, 11, 30 or 31} in Table 7.3.1.2.2-2A of Clause 7.3.1.2 of [5, TS 38.212],
or
\- if a UE is scheduled with two codewords,
the UE may assume that all the remaining orthogonal antenna ports are not
associated with transmission of PDSCH to another UE.
For DM-RS configuration type 2,
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of {2, 10 or 23} in Table 7.3.1.2.2-3 and Table
7.3.1.2.2-4 of Clause 7.3.1.2 of [5, TS38.212], or
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of {2, 10, 23 or 24} in Table 7.3.1.2.2-3A and {2, 10, 23
or 58} in Table 7.3.1.2.2-4A of Clause 7.3.1.2 of [5, TS 38.212], or
\- if a UE is scheduled with two codewords,
the UE may assume that all the remaining orthogonal antenna ports are not
associated with transmission of PDSCH to another UE.
For DM-RS configuration enhanced type 1,
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of [{9, 10, 11 and 27 when applicable} in Table
7.3.1.2.27 and Table 7.3.1.2.2-7A] of Clause 7.3.1.2 of [5, TS 38.212], or
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of [{9, 10, 11, 24, 25, 26, 27, 28, 29, 30 and 66 when
applicable} in Table 7.3.1.2.2-8 and Table 7.3.1.2.2-8A] of Clause 7.3.1.2 of
[5, TS 38.212],
the UE may assume that all the remaining orthogonal antenna ports of the CDM
groups, from which the antenna ports are indicated to the UE, are not
associated with transmission of PDSCH to another UE, or
\- if a UE is scheduled with two codewords, the UE may assume that all the
remaining orthogonal antenna ports are not associated with transmission of
PDSCH to another UE.
For DM-RS configuration enhanced type 2,
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of [{9, 10, 20, 21, 22, 23 and 54 when applicable} in
Table 7.3.1.2.2-9 and Table 7.3.1.2.2-9A] of Clause 7.3.1.2 of [5, TS38.212],
or
\- if a UE is scheduled with one codeword and assigned with the antenna port
mapping with indices of [{9, 10, 20, 21, 22, 23, 42, 43, 44, 45, 46, 47 and
136 when applicable} in Table 7.3.1.2.2-10 and in Table 7.3.1.2.2-10A] of
Clause 7.3.1.2 of [5, TS 38.212],
The UE may assume that all the remaining orthogonal antenna ports of CDM
groups, from which the antenna ports are indicated to the UE, are not
associated with transmission of PDSCH to another UE, or
\- if a UE is scheduled with two codewords, the UE may assume that all the
remaining orthogonal antenna ports are not associated with transmission of
PDSCH to another UE.
For DM-RS configuration enhanced type 1, when UE is not indicating UE
capability of [_noSchedulingRestriction-r18_], the UE shall assume the number
of consecutively scheduled PRBs are even, and the offset of the scheduled PRB
from common resource block 0 is even number.
If a UE receiving PDSCH scheduled by DCI format 1_2 is configured with the
higher layer parameter _phaseTrackingRS_ in _dmrs-DownlinkForPDSCH-
MappingTypeA-DCI-1-2 or dmrs-DownlinkForPDSCH-MappingTypeB-DCI-1-2_ or a UE
receiving PDSCH scheduled by DCI format 1_0, 1_1 or 1_3 is configured with the
higher layer parameter _phaseTrackingRS_ in _dmrs-DownlinkForPDSCH-
MappingTypeA or dmrs-DownlinkForPDSCH-MappingTypeB_ , the UE may assume that
the following configurations are not occurring simultaneously for the received
PDSCH:
\- any DM-RS ports among
1004-1007 or 1006-1011 for DM-RS configurations type 1 and type 2,
respectively or,
1004-1007 or 1012-1015 for DM-RS configuration enhanced type 1 or,
1006-1011 or 1018-1023 for DM-RS configuration enhanced type 2,
are scheduled for the UE and the other UE(s) sharing the DM-RS REs on the same
CDM group(s), and
\- PT-RS is transmitted to the UE.
The UE is not expected to simultaneously be configured with the maximum number
of front-loaded DM-RS symbols for PDSCH by higher layer parameter _maxLength
being set_ equal to \'len2\' and more than one additional DM-RS symbol as
given by the higher layer parameter _dmrs-AdditionalPosition_.
_The UE is not expected to assume co-scheduled UE(s) with different DM-RS
configuration with respect to the actual number of front-loaded DM-RS
symbol(s), the actual number of additional DM-RS, the DM-RS symbol location,
and DM-RS configuration type as described in Clause 7.4.1.1 of [4, TS
38.211]._
_The UE does not expect the precoding of the potential co-scheduled UE(s) in
other DM-RS ports of the same CDM group to be different in the PRG-level grid
configured to this UE with PRG =2 or 4._
_When the UE is configured with the higher layer parameter enhanced-dmrs-
Type_r18, the UE does not expect that any co-scheduled UE(s) in the same CDM
group is not configured with the higher layer- parameter enhanced-dmrs-
Type_r18._
_The UE does not expect the resource allocation of the potential co-scheduled
UE(s) in other DM-RS ports of the same CDM group to be misaligned in the PRG-
level grid to this UE with PRG=2 or 4._
When receiving PDSCH scheduled by DCI format 1_1, the UE shall assume that the
CDM groups indicated in the configured index from Tables 7.3.1.2.2-1,
7.3.1.2.2-1A, [7.3.1.2.2-1B, 7.3.1.2.2-1C], 7.3.1.2.2-2, 7.3.1.2.2-2A,
[7.3.1.2.2-2B, 7.3.1.2.2-2C], 7.3.1.2.2-3, 7.3.1.2.2-3A, [7.3.1.2.2-3B,
7.3.1.2.2-3C], 7.3.1.2.2-4, 7.3.1.2.2-4A, [7.3.1.2.2-4B, 7.3.1.2.2-4C] of [5,
TS. 38.212] contain potential co-scheduled downlink DM-RS and are not used for
data transmission, where \"1\", \"2\" and \"3\" for the number of DM-RS CDM
group(s) in Tables 7.3.1.2.2-1, 7.3.1.2.2-1A, [7.3.1.2.2-1B, 7.3.1.2.2-1C],
7.3.1.2.2-2, 7.3.1.2.2-2A, [7.3.1.2.2-2B, 7.3.1.2.2-2C], 7.3.1.2.2-3,
7.3.1.2.2-3A, 7.3.1.2.2-4, 7.3.1.2.2-4A, [7.3.1.2.2-4B, 7.3.1.2.2-4C] of [5,
TS. 38.212] correspond to CDM group 0, {0,1}, {0,1,2}, respectively.
When receiving PDSCH scheduled by DCI format 1_0, 4_0, or 4_1, the UE shall
assume the number of DM-RS CDM groups without data is 1 which corresponds to
CDM group 0 for the case of PDSCH with allocation duration of 2 symbols, and
the UE shall assume that the number of DM-RS CDM groups without data is 2
which corresponds to CDM group {0,1} for all other cases.
The UE is not expected to receive PDSCH scheduling DCI which indicates CDM
group(s) with potential DM-RS ports which overlap with any configured CSI-RS
resource(s) for that UE.
If the UE receives the DM-RS for PDSCH and an SS/PBCH block associated with
the same PCI in the same OFDM symbol(s), then the UE may assume that the DM-RS
and SS/PBCH block are quasi co-located with \'typeD\', if \'typeD\' is
applicable. Furthermore, the UE shall not expect to receive DM-RS in resource
elements that overlap with those of the SS/PBCH block associated with the same
PCI as the DM-RS, and the UE can expect that the same or different subcarrier
spacing is configured for the DM-RS and SS/PBCH block in a CC except for the
case of 240 kHz where only different subcarrier spacing is supported. A DM-RS
for PDSCH is said to be associated with an additional PCI if the indicated TCI
state for the PDSCH is associated with the additional PCI, otherwise a DM-RS
for PDSCH is associated with serving cell PCI.
If at least one TCI codepoint indicates two TCI states and the UE receives the
DM-RS for PDSCH and an SS/PBCH block in the same OFDM symbol(s), then the UE
may assume that at least one DM-RS port for the PDSCH and SS/PBCH block are
quasi co-located with \'QCL-TypeD\', if \'QCL-TypeD\' is applicable.
If the UE is configured by higher layer parameter _PDCCH-Config_ that contains
two different values of CORESETPoolIndex in different ControlResourceSets, and
the UE receives the DM-RS for PDSCH(s) and an SS/PBCH block in the same OFDM
symbol(s), then the UE may assume that at least one DM-RS port for the
PDSCH(s) and SS/PBCH block are quasi co-located with \'QCL-TypeD\', if \'QCL-
TypeD\' is applicable.
If a UE is configured by the higher layer parameter _PDCCH-Config_ that
contains two different values of _coresetPoolIndex_ in _ControlResourceSet_ ,
the UE may be scheduled with fully or partially overlapping PDSCHs in the time
and frequency domain by multiple PDCCHs with the following restrictions,
\- the UE is not expected to assume different DM-RS configuration with respect
to the actual number of front-loaded DM-RS symbol(s), the actual number of
additional DM-RS symbol(s), the actual DM-RS symbol location, and DM-RS
configuration type.
\- the UE is not expected to assume DM-RS ports in a CDM group indicated by
two TCI states.
When a UE is not indicated with a DCI that DCI field \'_Time domain resource
assignment_ \' indicating an entry _which contains repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation, the UE is not configured with
sfnSchemePDSCH_ and it is indicated with two TCI states in a codepoint of the
DCI field _\'Transmission Configuration Indication\'_ and DM-RS port(s) within
two CDM groups in the DCI field \'_Antenna Port(s)\',_
\- the first TCI state corresponds to the CDM group of the first antenna port
indicated by the antenna port indication table, and the second TCI state
corresponds to the other CDM group.
If a UE is configured with higher layer parameter _dmrs-FD-OCC-
DisabledForRank1-PDSCH_ and the UE is scheduled with PDSCH with single DM-RS
port, the UE may assume that set of orthogonal DM-RS antenna ports from the
same CDM group using different set of _w_ ~f~(_k_ \') codes are not associated
with the transmission of PDSCH to another UE.
#### 5.1.6.3 PT-RS reception procedure
The procedures on PT-RS reception described in this clause apply to a UE
receiving PDSCH scheduled by DCI format 1_2 configured with the higher layer
parameter _phaseTrackingRS_ in _dmrs-DownlinkForPDSCH-MappingTypeA-DCI-1-2 or
dmrs-DownlinkForPDSCH-MappingTypeB-DCI-1-2_ and to a UE receiving PDSCH
scheduled by DCI format 1_0, 1_1 or 1_3 configured with the higher layer
parameter _phaseTrackingRS_ in _dmrs-DownlinkForPDSCH-MappingTypeA or dmrs-
DownlinkForPDSCH-MappingTypeB_. The procedures on PT-RS reception described in
this clause apply to a UE receiving PDSCH scheduled by DCI format 4_1 or 4_2
configured with the higher layer parameter _phaseTrackingRS_ in _dmrs-
DownlinkForPDSCH-MappingTypeA or dmrs-DownlinkForPDSCH-MappingTypeB_ in
_pdsch-ConfigMulticast_.
A UE shall report the preferred MCS and bandwidth thresholds based on the UE
capability at a given carrier frequency, for each subcarrier spacing
applicable to data channel at this carrier frequency, assuming the MCS table
with the maximum Modulation Order as it reported to support.
If a UE is configured with the higher layer parameter _phaseTrackingRS_ in
_DMRS-DownlinkConfig_ ,
\- the higher layer parameters _timeDensity_ and _frequencyDensity_ in _PTRS-
DownlinkConfig_ indicate the threshold values _ptrs-MCS~i~_ , _i_ =1,2,3 and
_N~RB,i~_ , _i_ =0,1, as shown in Table 5.1.6.3-1 and Table 5.1.6.3-2,
respectively.
\- if either or both of the additional higher layer parameters _timeDensity_
and _frequencyDensity_ are configured, and the RNTI equals MCS-C-RNTI, C-RNTI
or CS-RNTI, the UE shall assume the PT-RS antenna port\' presence and pattern
is a function of the corresponding scheduled MCS of the corresponding codeword
and scheduled bandwidth in corresponding bandwidth part as shown in Table
5.1.6.3-1 and Table 5.1.6.3-2,
\- if the higher layer parameter _timeDensity_ given by _PTRS-DownlinkConfig_
is not configured, the UE shall assume _L~PT-RS\ ~_ = 1.
\- if the higher layer parameter _frequencyDensity_ given by _PTRS-
DownlinkConfig_ is not configured, the UE shall assume _K~PT-RS~_ = 2.
\- otherwise, if neither of the additional higher layer parameters
_timeDensity_ and _frequencyDensity_ are configured and the RNTI equals MCS-C-
RNTI, C-RNTI or CS-RNTI, the UE shall assume the PT-RS is present with _L~PT-
RS\ ~_ = 1, _K~PT-RS~_ = 2, and the UE shall assume PT-RS is not present when
\- the scheduled MCS from Table 5.1.3.1-1 is smaller than 10, or
\- the scheduled MCS from Table 5.1.3.1-2 is smaller than 5, or
\- the scheduled MCS from Table 5.1.3.1-3 is smaller than 15, or
\- the scheduled MCS from Table 5.1.3.1-4 is smaller than 3, or
\- the number of scheduled RBs is smaller than 3, or
\- otherwise, if the RNTI equals RA-RNTI, [MSGB-RNTI], SI-RNTI, or P-RNTI, the
UE shall assume PT-RS is not present
Table 5.1.6.3-1: Time density of PT-RS as a function of scheduled MCS
Scheduled MCS Time density ()
* * *
I~MCS~ \ \- other interference signal on REs of NZP CSI-RS resource for channel
> measurement, NZP CSI-RS resource for interference measurement, or CSI-IM
> resource for interference measurement.
For L1-SINR measurement with dedicated interference measurement resources, a
UE assumes:
\- the total received power on dedicated NZP CSI-RS resource for interference
measurement or dedicated CSI-IM resource for interference measurement
corresponds to interference and noise.
##### 5.2.1.4.2 Report quantity configurations
A UE may be configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to either \'none\', \'cri-RI-PMI-CQI \', \'cri-
RI-i1\', \'cri-RI-i1-CQI\', \'cri-RI-CQI\', \'cri-RSRP\', \'cri-SINR\', \'ssb-
Index-RSRP\', \'ssb-Index-SINR\', \'cri-RI-LI-PMI-CQI\', _\'cri-RSRP- Index\',
\'ssb-Index-RSRP- Index\', \'cri-SINR- Index\', \'ssb-Index-SINR- Index\' or_
\'tdcp\'.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity set to \'none\', then the UE shall not report any
quantity for the CSI-ReportConfig._
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-PMI-CQI\', or \'cri-RI-LI-PMI-
CQI\', the UE shall report a preferred precoder matrix for the entire
reporting band, or a preferred precoder matrix per subband, according to
Clause 5.2.2.2.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-i1\',
\- the UE expects, for that _CSI-ReportConfig,_ to be configured with higher
layer parameter _codebookType_ set to \'typeI-SinglePanel\' and _pmi-
FormatIndicator_ set to \'widebandPMI\' and,
\- the UE shall report a PMI consisting of a single wideband indication ( in
Clause 5.2.2.2.1) for the entire CSI reporting band.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-i1-CQI\',
\- the UE expects, for that _CSI-ReportConfig,_ to be configured with higher
layer parameter _codebookType_ set to \'typeI-SinglePanel\' and _pmi-
FormatIndicator_ set to \'widebandPMI\' and,
\- the UE shall report a PMI consisting of a single wideband indication ( in
Clause 5.2.2.2.1) for the entire CSI reporting band. The CQI is calculated
conditioned on the reported assuming PDSCH transmission with precoders
(corresponding to the same but different in Clause 5.2.2.2.1), where the UE
assumes that one precoder is randomly selected from the set of precoders for
each PRG on PDSCH, where the PRG size for CQI calculation is configured by the
higher layer parameter _pdsch-BundleSizeForCSI_.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-CQI _\',_
\- if the UE is configured with higher layer parameter _non-PMI-
PortIndication_ contained in a _CSI-ReportConfig,_ _r_ ports are indicated in
the order of layer ordering for rank _r_ and each CSI-RS resource in the CSI
resource setting is linked to the _CSI-ReportConfig_ based on the order of the
associated _NZP-CSI-RS-ResourceId_ in the linked CSI resource setting for
channel measurement given by higher layer parameter
_resourcesForChannelMeasurement_. The configured higher layer parameter _non-
PMI-PortIndication_ contains a sequence of port indices, where are the CSI-RS
port indices associated with rank ν and where is the number of ports in the
CSI-RS resource. The UE shall only report RI corresponding to the configured
fields of _PortIndexFor8Ranks_.
\- if the UE is not configured with higher layer parameter _non-PMI-
PortIndication,_ the UE assumes, for each CSI-RS resource in the CSI resource
setting linked to the _CSI-ReportConfig_ , that the CSI-RS port indices are
associated with ranks where is the number of ports in the CSI-RS resource.
\- When calculating the CQI for a rank, the UE shall use the ports indicated
for that rank for the selected CSI-RS resource. The precoder for the indicated
ports shall be assumed to be the identity matrix scaled by .
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity set to \'cri-RSRP\', \'ssb-Index-RSRP\'_ , _\'cri-
RSRP- Index\' or \'ssb-Index-RSRP- Index\',_
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'disabled\', the UE is not required to
update measurements for more than 64 CSI-RS and/or SSB resources, and the UE
shall report in a single report _nrofReportedRS_ (higher layer configured)
different CRI or SSBRI for each report setting.
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'enabled\', the UE is not required to update
measurements for more than 64 CSI-RS and/or SSB resources, and the UE shall
report in a single reporting instance two different CRI or SSBRI for each
report setting, where CSI-RS and/or SSB resources can be received
simultaneously by the UE either with a single spatial domain receive filter,
or with multiple simultaneous spatial domain receive filters.
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting-r17_ , the UE is not required to update measurements
for more than 64 CSI-RS and/or SSB resources, and the UE shall report in a
single reporting instance _nrofReportedGroups,_ if configured, group(s) of two
CRIs or SSBRIs selecting one CSI-RS or SSB from each of the two CSI Resource
Sets for the report setting, where CSI-RS and/or SSB resources of each group
can be received simultaneously by the UE.
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting-v18_ set to _JointULandDL_ , the UE is not required
to update measurements for more than 64 CSI-RS and/or SSB resources, and the
UE shall report in a single reporting instance _nrofReportedGroups-r18,_ if
configured, group(s) of two CRIs or SSBRIs selecting one CSI-RS or SSB from
each of the two CSI Resource Sets for the report setting, where CSI-RS and/or
SSB resources of each group can be received simultaneously and applied for
simultaneous transmission with spatial filters by the UE subject to UE
capability.
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting-v18_ set to _ULOnly,_ the UE is not required to
update measurements for more than 64 CSI-RS and/or SSB resources, and the UE
shall report in a single reporting instance _nrofReportedGroups-r18,_ if
configured, group(s) of two CRIs or SSBRIs selecting one CSI-RS or SSB from
each of the two CSI Resource Sets for the report setting, where CSI-RS and/or
SSB resources of each group can be applied for simultaneous transmission with
spatial filters by the UE subject to UE capability.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity set to \'cri-SINR\', \'ssb-Index-SINR\'_ , _\'cri-
SINR- Index\' or \'ssb-Index-SINR- Index\',_
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'disabled\', _the UE shall report in a
single report_ _nrofReportedRS_ (higher layer configured) different CRI or
SSBRI for each report setting.
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'enabled\', the UE shall report in a single
reporting instance two different CRI or SSBRI for each report setting, where
CSI-RS and/or SSB resources can be received simultaneously by the UE.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity set to \'tdcp\'_
\- the value of $Y \in \left{ 1,2,3,4 \right}$ is configured by higher layer
parameter _Y_ , and $Y$ delay values, $\left{ D_{1},\ldots,D_{Y} \right}$, are
configured by higher layer parameter _D_ , such that the UE is expected to
report the amplitude of TDCP measurement, as defined in Clause 5.1 of [7, TS
38.215], for each of the configured delays. Values of $Y > 1$ can be
configured subject to UE capability. The configurable delay values are $D_{i}
\in \left{ 4 \right}_{\text{symbols}}\bigcup_{}^{}\left{ 1,2,3,4,5,6,10
\right}_{\text{slots}}$, $i = 1,\ldots,Y$, where the value $D_{i} = 10\
\text{slots}$ is restricted to subcarrier spacing configuration $\mu \geq 1$,
the values other than $D_{i} = 10\ \text{slots}$ are applicable to subcarrier
spacing configurations $\mu \geq 0$, and where the values $D_{i} >
D_{\text{basic}}$ can be configured subject to UE capability, with
$D_{\text{basic}} = 1\ \text{slot}$.
\- For $Y > 1$, if the higher layer parameter _phase_ is configured, the UE is
expected to report the amplitude and phase of TDCP measurement for each of the
configured delays, if supported by UE capability.
Except for a _CSI-ReportConfig_ configured with _reportQuantity_ set to \'cri-
RI-PMI-CQI\' and _codebookType_ set to \'typeII-CJT-r18\', \'typeII-CJT-
PortSelection-r18\', \'typeII-Doppler-r18\', or \'typeII-Doppler-
PortSelection-r18\', if the UE is configured with a _CSI-ReportConfig_ with
the higher layer parameter _reportQuantity_ set to \'cri-RSRP\', \'cri-RI-PMI-
CQI \', \'cri-RI-i1\', \'cri-RI-i1-CQI\', \'cri-RI-CQI\', \'cri-RI-LI-PMI-
CQI\', \'cri-SINR\', or \'cri-SINR _\- Index_ \', and $K_{s} > 1\ $resources
are configured in the corresponding resource set for channel measurement, then
the UE shall derive the CSI parameters other than CRI conditioned on the
reported CRI, where CRI _k_ (_k_ ≥ 0) corresponds to the configured (_k_
+1)-th entry of associated _nzp-CSI-RS-Resources_ in the corresponding _NZP-
CSI-RS-ResourceSet_ for channel measurement, and (_k_ +1)-th entry of
associated _csi-IM-Resource_ in the corresponding _csi-IM-ResourceSet_ (if
configured) or (_k_ +1)-th entry of associated _nzp-CSI-RS-Resources_ in the
corresponding _NZP-CSI-RS-ResourceSet_ (if configured for  _CSI-ReportConfig_
with  _reportQuantity_ set to \'cri-SINR\' or \'cri-SINR _\- Index_ \') for
interference measurement. If $K_{s} = 2\ $CSI-RS resources are configured,
each resource shall contain at most 16 CSI-RS ports. If $2  1$. A UE can be configured with
$N_{4} = 1$ if the higher layer parameter _codebookType_ is set to \'typeII-
Doppler-r18\', or \'typeII-Doppler-PortSelection-r18\'.
\- The reported CQI is associated with slot $l$ and the reported PMI.
\- For $N_{4} > 1$, the UE is expected to report a PMI which indicates
predicted precoder matrices associated with slot intervals $\lbrack l + j
\cdot d,\ l + (j + 1) \cdot d - 1\rbrack$, for $j = 0,\ldots,N_{4} - 1$. A UE
can be configured with $N_{4} > 1$ if the higher layer parameter
_codebookType_ is set to \'typeII-Doppler-r18\'.
\- The UE is configured by higher layer parameter _TDCQI_ to report $X \in {
1,2}$ CQIs for each subband in the CSI reporting band, if _cqi-
FormatIndicator_ is set to \'subbandCQI\', or $X \in { 1,2}$ CQIs for the
entire CSI reporting band, if _cqi-FormatIndicator_ is set to \'widebandCQI\'.
For $X = 2$, the second CQI includes a 4-bit wideband CQI index and, if
subband CQI reporting is configured, a 2-bit subband CQI index, calculated
independently from the first CQI, as described in Clause 5.2.2.1, and the two
CQIs are reported in the same CSI report.
\- If the higher layer parameter _TDCQI_ is set to \'1-1\', $X = 1$ and the
CQI is associated with slot $l$ and the precoder matrices for slot interval
$\lbrack l,l + d - 1\rbrack$.
\- If the higher layer parameter _TDCQI_ is set to \'1-2\', $X = 1$ and the
CQI is associated with slot $l$ and the precoder matrices for slot interval
$\lbrack l,l + d - 1\rbrack$ and with slot $l + N_{4} \cdot d - 1$ and the
precoder matrices for slot interval $\left\lbrack l + {(N}_{4} - 1 \right)
\cdot d,l + N_{4} \cdot d - 1\rbrack$.
\- If the higher layer parameter _TDCQI_ is set to \'2\', $X = 2$. The first
CQI is associated with slot $l$ and the precoder matrices for slot interval
$\lbrack l,l + d - 1\rbrack$. The second CQI is associated with slot $l +
\frac{N_{4}}{2} \cdot d$ and the precoder matrices for slot interval
$\left\lbrack l + \frac{N_{4}}{2} \cdot d,l + \left( \frac{N_{4}}{2} + 1
\right) \cdot d - 1 \right\rbrack$.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-PMI-CQI\', or \'cri-RI-LI-PMI-CQI\'
and the corresponding _NZP-CSI-RS-ResourceSet_ for channel measurement is
configured with $K_{s} \geq 2$ resources, two Resource Groups with $K_{1} \geq
1$ resources in Group 1, $K_{2} \geq 1$ resources in Group 2, $K_{1} + K_{2} =
K_{s}$, and $N$ Resource Pairs:
\- each resource can contain, subject to UE capability, at most 32 CSI-RS
ports. For two Resource Groups with $K_{i}$ resources (i=1,2), if $\max\left{
K_{1},K_{2} \right} = 1$, the resource in NZP-CSI-RS-ResourceSet shall contain
at most 32 CSI-RS ports; if $\text{\ max}\left{ K_{1},K_{2} \right} = 2$, each
resource in NZP-CSI-RS-ResourceSet shall contain at most 16 CSI-RS ports; if
$2  1$, if the higher layer parameter _phase_ is configured, the reported
TDCP phases are indicated by
$$c_{\text{TDCP}} = \lbrack c_{1}\ldots c_{Y}\rbrack$$
$$c_{i} \in { 0,1,\ldots,15}$$
and the corresponding phase values are given by: $e^{j2\pi\frac{c_{i}}{16}}$.
#### 5.2.1.5 Triggering/activation of CSI Reports and CSI-RS
##### 5.2.1.5.1 Aperiodic CSI Reporting/Aperiodic CSI-RS when the triggering
PDCCH and the CSI-RS have the same numerology
For CSI-RS resource sets associated with Resource Settings configured with the
higher layer parameter _resourceType_ set to \'aperiodic\', \'periodic\', or
\'semi-persistent\', trigger states for Reporting Setting(s) (configured with
the higher layer parameter _reportConfigType_ set to \'aperiodic\') and/or
Resource Setting for channel and/or interference measurement on one or more
component carriers are configured using the higher layer parameter _CSI-
AperiodicTriggerStateList_. For a reporting setting for which the _CSI-
ReportConfig_ contains a list of sub-configurations provided by the higher
layer parameter [_csi-ReportSubConfigList_], one or more trigger states can be
configured with each indicating one or more of the sub-configurations. For
aperiodic CSI report triggering, a single set of CSI triggering states are
higher layer configured, wherein the CSI triggering states can be associated
with any candidate DL BWP. A UE is not expected to receive more than one DCI
with non-zero _CSI request_ field per slot per cell. A UE is not expected to
receive DCI with non-zero _CSI request_ field within a cell group in a slot
overlapping with any slot receiving DCI with non-zero _CSI request_ field in
the same cell group. A UE is not expected to be configured with different
_TCI-StateId_ \'s for the same aperiodic CSI-RS resource ID configured in
multiple aperiodic CSI-RS resource sets with the same triggering offset in the
same aperiodic trigger state. A UE is not expected to receive more than one
aperiodic CSI report request for transmission in a given slot per cell. A UE
is not expected to receive an aperiodic CSI report request for transmission in
a slot overlapping with any slot having an aperiodic CSI report transmission
in the same cell group. If a UE does not indicate its capability of
_CSItriggerStateContainingNonactiveBWP_ the UE is not expected to be triggered
with a CSI report for a non-active DL BWP. Otherwise, when a UE is triggered
with a CSI report for a DL BWP that is non-active when expecting to receive
the most recent occasion, no later than the CSI reference resource, of the
associated NZP CSI-RS, the UE is not expected to report the CSI for the non-
active DL BWP and the CSI report associated with that BWP is omitted. When a
UE is triggered with aperiodic NZP CSI-RS in a DL BWP that is non-active when
expecting to receive the NZP CSI-RS, the UE is not expected to measure the
aperiodic CSI-RS. In the carrier of the serving cell expecting to receive that
associated NZP CSI-RS, if the active DL BWP when receiving the NZP CSI-RS is
different from the active DL BWP when receiving the triggering DCI,
\- the last symbol of the PDCCH span of the DCI carrying the BWP switching
shall be no later than the last symbol of the PDCCH span of the DCI carrying
the CSI trigger, irrespective of whether they are in the same carrier of a
serving cell or not and irrespective of whether they are in the same SCS or
not;
\- the UE is not expected to have any other BWP switching in that carrier
after the last symbol of the PDCCH span covering the DCI carrying the CSI
trigger and before the first symbol of the triggered NZP CSI-RS or CSI-IM.
\- when the PDCCH reception includes two PDCCH candidates from two respective
search space sets, as described in clause 10.1 of [6, TS 38.213], the span
that involves the PDCCH candidate that ends later in time is used.
A trigger state is initiated using the _CSI request_ field in DCI.
\- When all the bits of _CSI request_ field in DCI are set to zero, no CSI is
requested.
\- When the number of configured CSI triggering states in _CSI-
AperiodicTriggerStateList_ is greater than , where is the number of bits in
the DCI _CSI request_ field, the UE receives a subselection indication, as
described in clause 6.1.3.13 of [10, TS 38.321], used to map up to trigger
states to the codepoints of the _CSI request_ field in DCI. is configured by
the higher layer parameter _reportTriggerSize_ where . When the UE would
transmit a PUCCH with HARQ-ACK information in slot _n_ corresponding to the
PDSCH carrying the subselection indication, the corresponding action in [10,
TS 38.321] and UE assumption on the mapping of the selected CSI trigger
state(s) to the codepoint(s) of DCI CSI request field shall be applied
starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ} + {\frac{2^{\mu}}{2^{\mu_{K_{\text{mac}}}}}
\bullet k}_{\text{mac}}$ where _μ_ is the SCS configuration for the PUCCH and
$\mu_{K_{\text{mac}}}\ $is the subcarrier spacing configuration for
$k_{\text{mac}}$ with a value of 0 for frequency range 1, and $k_{\text{mac}}$
is provided by _K-Mac_ or $k_{\text{mac}} = 0$ if _K-Mac_ is not provided..
\- When the number of CSI triggering states in _CSI-AperiodicTriggerStateList_
is less than or equal to , the _CSI request_ field in DCI directly indicates
the triggering state.
\- For each aperiodic CSI-RS resource in a CSI-RS resource set associated with
each CSI triggering state, the UE is indicated the quasi co-location
configuration of quasi co-location RS source(s) and quasi co-location type(s),
as described in clause 5.1.5, through higher layer signaling of _qcl-info_
which contains a list of references to _TCI-State\'s_ for the aperiodic CSI-RS
resources associated with the CSI triggering state. If a _State_ referred to
in the list is configured with a reference to an RS configured with _qcl-Type_
set to \'_typeD_ \', that RS may be an SS/PBCH block located in the same or
different CC/DL BWP or a CSI-RS resource configured as periodic or semi-
persistent located in the same or different CC/DL BWP.
\- If the scheduling offset between the last symbol of the PDCCH carrying the
triggering DCI and the first symbol of the aperiodic CSI-RS resources in a
_NZP-CSI-RS-ResourceSet_ configured without higher layer parameter _trs-Info_
is smaller than the UE reported threshold _beamSwitchTiming,_ as defined in
[13, TS 38.306], when the reported value is one of the values of {14, 28,
48}$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ and
_enableBeamSwitchTiming_ is not provided, or is smaller than 48$\bullet
2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ when the UE provides
_beamSwitchTiming-r16_ , _enableBeamSwitchTiming_ is provided and the _NZP-
CSI-RS-ResourceSet_ is configured with the higher layer parameter _repetition_
set to \'off\' or configured without the higher layer parameter _repetition,_
or is smaller than the UE reported threshold _beamSwitchTiming-r16, when
enableBeamSwitchTiming_ is provided and the _NZP-CSI-RS-ResourceSet_ is
configured with the higher layer parameter _repetition_ set to \'on\'.
\- If a UE is configured with _enableDefaultTCI-StatePerCoresetPoolIndex_ and
the UE is configured by higher layer parameter _PDCCH-Config_ that contains
two different values of _coresetPoolIndex_ in _ControlResourceSet_
\- if there is any other DL signal with an indicated TCI state in the same
symbols as the CSI-RS, the UE applies the QCL assumption of the other DL
signal also when receiving the aperiodic CSI-RS. The other DL signal refers to
PDSCH scheduled by a PDCCH associated with the same _coresetPoolIndex_ as the
PDCCH triggering the aperiodic CSI-RS and scheduled with offset larger than or
equal to the threshold _timeDurationForQCL,_ as defined in [13, TS 38.306],
aperiodic CSI-RS triggered by a PDCCH associated with the same
_coresetPoolIndex_ as the PDCCH triggering the aperiodic CSI-RS and scheduled
with offset larger than or equal to the UE reported threshold
_beamSwitchTiming_ when the reported value is one of the values
{14,28,48}$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ and
_enableBeamSwitchTiming_ is not provided, aperiodic CSI-RS triggered by a
PDCCH associated with the same _coresetPoolIndex_ as the PDCCH triggering the
aperiodic CSI-RS and scheduled with offset larger than or equal to 48$\bullet
2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ when the reported value of
_beamSwitchTiming-r16_ is one of the values {224, 336}$\bullet 2^{{max(0,\
\mu}_{\text{CSIRS}} - 3)}$ and _enableBeamSwitchTiming_ is provided, periodic
CSI-RS, semi-persistent CSI-RS;
\- else, the UE applies the QCL parameter(s) of the CORESET associated with a
monitored search space with the lowest _controlResourceSetId_ among CORESETs,
which are configured with the same value of _coresetPoolIndex_ as the PDCCH
triggering that aperiodic CSI-RS, in the latest slot in which one or more
CORESETs are associated with the same value of _coresetPoolIndex_ as the PDCCH
triggering that aperiodic CSI-RS
\- else if **a UE is configured with** _enableTwoDefaultTCI-States_ **and at
least one TCI codepoint is mapped to two TCI states**
\- if there is any other DL signal with an indicated TCI state in the same
symbols as the CSI-RS, the UE applies the QCL assumption of the other DL
signal also when receiving the aperiodic CSI-RS. The other DL signal refers to
PDSCH scheduled with offset larger than or equal to the threshold
_timeDurationForQCL,_ as defined in [13, TS 38.306], aperiodic CSI-RS
scheduled with offset larger than or equal to the UE reported threshold
_beamSwitchTiming_ when the reported value is one of the values
{14,28,48}$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ and
_enableBeamSwitchTiming_ is not provided, aperiodic CSI-RS scheduled with
offset larger than or equal to 48$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} -
3)}$ when the reported value of _beamSwitchTiming-r16_ is one of the values
{224, 336}$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ and
_enableBeamSwitchTiming_ is provided, periodic CSI-RS, semi-persistent CSI-RS.
If there is a PDSCH indicated with two TCI states in the same symbols as the
CSI-RS, the UE applies the first TCI state of the two TCI states when
receiving the aperiodic CSI-RS.
\- else, the UE applies the first one of two TCI states corresponding to the
lowest TCI codepoint among those **mapped to two TCI states** and applicable
to the PDSCH within the active BWP of the cell in which the CSI-RS is to be
received when receiving the aperiodic CSI-RS.
\- else if **a UE is configured with _sfnSchemePdcch_ set to _\'_ sfnSchemeA\'
or \'sfnSchemeB\', it is not configured with** _enableTwoDefaultTCI-States,_
**and the two TCI states are activated for the CORESET by the activation
command as described in clause 6.1.3.44 of [10,** TS 38.321**]**
**-** if there is any other DL signal with an indicated TCI state in the same
symbols as the CSI-RS, the UE applies the QCL assumption of the other DL
signal also when receiving the aperiodic CSI-RS. The other DL signal refers to
PDSCH scheduled with an offset larger than or equal to the threshold
_timeDurationForQCL,_ as defined in [13, TS 38.306], periodic CSI-RS, semi-
persistent CSI-RS, aperiodic CSI-RS in a _NZP-CSI-RS-ResourceSet_ scheduled
with offset larger than or equal to the UE reported threshold
_beamSwitchTiming_ when the reported value is one of the values {14,28,48} and
when _enableBeamSwitchTiming_ is not provided or the _NZP-CSI-RS-ResourceSet_
is configured with the higher layer parameter _trs-Info_ , aperiodic CSI-RS in
a _NZP-CSI-RS-ResourceSet_ configured with the higher layer parameter
_repetition_ set to \'off\' or configured without the higher layer parameters
_repetition_ and _trs-Info_ scheduled with offset larger than or equal to 48
when the UE provides _beamSwitchTiming-r16_ and _enableBeamSwitchTiming_ is
provided, aperiodic CSI-RS in a _NZP-CSI-RS-ResourceSet_ configured with the
higher layer parameter _repetition_ set to \'on\' scheduled with offset larger
than or equal to the UE reported threshold _beamSwitchTiming-r16 and
enableBeamSwitchTiming_ is provided;
\- else, the UE applies the first one of TCI states indicated for the CORESET
with the lowest CORESET ID in the latest slot within the active BWP of the
cell in which the CSI-RS is to be received when receiving the aperiodic CSI-
RS, if two TCI states are activated for the CORESET. Otherwise, the UE applies
the single activated TCI state of the CORESET with the lowest CORESET ID in
the latest slot within the active BWP of the cell in which the CSI-RS is to be
received, when receiving the aperiodic CSI-RS
\- else if there is any other DL signal with an indicated TCI state in the
same symbols as the CSI-RS, the UE applies the QCL assumption of the other DL
signal also when receiving the aperiodic CSI-RS. The other DL signal refers to
PDSCH scheduled with offset larger than or equal to the threshold
_timeDurationForQCL,_ as defined in [13, TS 38.306], periodic CSI-RS, semi-
persistent CSI-RS, aperiodic CSI-RS in a _NZP-CSI-RS-ResourceSet_ scheduled
with offset larger than or equal to the UE reported threshold
_beamSwitchTiming_ when the reported value is one of the values
{14,28,48}$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ and when
_enableBeamSwitchTiming_ is not provided or the _NZP-CSI-RS-ResourceSet_ is
configured with the higher layer parameter _trs-Info_ , aperiodic CSI-RS in a
_NZP-CSI-RS-ResourceSet_ configured with the higher layer parameter
_repetition_ set to \'off\' or configured without the higher layer parameters
_repetition_ and _trs-Info_ scheduled with offset larger than or equal to
48$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ when the UE provides
_beamSwitchTiming-r16_ and _enableBeamSwitchTiming_ is provided, aperiodic
CSI-RS in a _NZP-CSI-RS-ResourceSet_ configured with the higher layer
parameter _repetition_ set to \'on\' scheduled with offset larger than or
equal to the UE reported threshold _beamSwitchTiming-r16 and
enableBeamSwitchTiming_ is provided;
\- else if the UE is not provided _dl-OrJointTCI-StateList_ , and if at least
one CORESET is configured for the BWP in which the aperiodic CSI-RS is
received, when receiving the aperiodic CSI-RS, the UE applies the QCL
assumption used for the CORESET associated with a monitored search space with
the lowest _controlResourceSetId_ in the latest slot in which one or more
CORESETs within the active BWP of the serving cell are monitored;
\- else if the UE is provided _dl-OrJointTCI-StateList_ and if the indicated
TCI state is associated with a PCI different from the serving cell, regardless
of configuration of _followUnifiedTCI-State_ , and if at least one CORESET is
configured for the BWP in which the aperiodic CSI-RS is received, when
receiving the aperiodic CSI-RS, the UE applies the QCL assumption used for the
CORESET associated with a monitored search space with the lowest
_controlResourceSetId_ in the latest slot in which one or more CORESETs within
the active BWP of the serving cell are monitored. In the CA case, if the
\'QCL-TypeD\' of the aperiodic CSI-RSs from respective CCs in a band are
different in a slot, the QCL-TypeD assumption of the CSI-RS in the CC with
lowest CC ID in the band is applied to all the aperiodic CSI-RSs in the CCs in
the band;
\- else if the UE is provided _dl-OrJointTCI-StateList_ and the indicated TCI
state is associated with the PCI of the serving cell, regardless of
configuration of _followUnifiedTCI-State_ , the indicated TCI state is applied
to the aperiodic CSI-RS;
> \- else if the UE is configured with _enableDefaultBeamForCCS_ and when
> receiving the aperiodic CSI-RS, the UE applies the QCL assumption of the
> lowest-ID activated TCI state applicable to the PDSCH within the active BWP
> of the cell in which the CSI-RS is to be received.
\- If the scheduling offset between the last symbol of the PDCCH carrying the
triggering DCI and the first symbol of the aperiodic CSI-RS resources in a
_NZP-CSI-RS-ResourceSet_ is equal to or greater than the UE reported threshold
_beamSwitchTiming_ when the reported value is one of the values of
{14,28,48}$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ and
_enableBeamSwitchTiming_ is not provided and the _NZP-CSI-RS-ResourceSet_ is
not configured with higher layer parameter _trs-Info_ , or is equal to or
greater than the UE reported threshold _beamSwitchTiming_ when the reported
value is one of the values of {14,28,48}$\bullet 2^{{max(0,\
\mu}_{\text{CSIRS}} - 3)}$ and the _NZP-CSI-RS-ResourceSet_ is configured with
higher layer parameter _trs-Info_ , or is equal to or greater than 48$\bullet
2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ when the UE provides
_beamSwitchTiming-r16_ and _enableBeamSwitchTiming_ is provided and the _NZP-
CSI-RS-ResourceSet_ is configured with the higher layer parameter _repetition_
set to \'off\' or configured without the higher layer parameters _repetition_
and _trs-Info_ , or is equal to or greater than the UE reported threshold
_beamSwitchTiming-r16, when enableBeamSwitchTiming_ is provided and the _NZP-
CSI-RS-ResourceSet_ is configured with the higher layer parameter _repetition_
set to \'on\', the UE is expected to apply the QCL assumptions in the
indicated TCI states for the aperiodic CSI-RS resources in the CSI triggering
state indicated by the CSI trigger field in DCI.
\- The UE is not expected to receive aperiodic CSI-RS and PDSCH/aperiodic CSI-
RS associated with different values of _coresetPoolIndex_ in overlapped
symbol(s). The UE is not expected to receive aperiodic CSI-RS and semi-
persistent/periodic CSI-RS with different \'QCL-type D\' in overlapped
symbol(s).
> \- If configured, the UE may assume that a CSI-RS resource in an aperiodic
> CSI-RS resource set configured without _trs-Info_ is quasi co-located with
> the RS(s) in the indicated TCI state.
\- A non-zero codepoint of the CSI request field in the DCI is mapped to a CSI
triggering state according to the order of the associated positions of the up
to $2^{N_{\text{TS}}} - 1$ trigger states in _CSI-AperiodicTriggerStateList_
with codepoint \'1\' mapped to the triggering state in the first position.
For a UE configured with the higher layer parameter _CSI-
AperiodicTriggerStateList_ , if a Resource Setting linked to a _CSI-
ReportConfig_ has multiple aperiodic resource sets, only one of the aperiodic
CSI-RS resource sets from the Resource Setting is associated with the trigger
state, and the UE is higher layer configured per trigger state per Resource
Setting to select the one CSI-IM/NZP CSI-RS resource set from the Resource
Setting.
When aperiodic CSI-RS is used with aperiodic reporting, the CSI-RS offset is
configured per resource set by the higher layer parameter
_aperiodicTriggeringOffset_ or _aperiodicTriggeringOffset-r16_ or
_aperiodicTriggeringOffset-r17_. The CSI-RS triggering offset has the values
of {0, 1, 2, 3, 4, 5, 6, ..., 15, 16, 24} slots for $\mu_{\text{CSIRS}} \leq
3$ or {0, 4, 8, 12, ..., 60, 64, 96} slots for $\mu_{\text{CSIRS}} = 5$ and
$\mu_{\text{CSIRS}} = 6$, where $\mu_{\text{CSIRS}}$ is the subcarrier spacing
configurations for CSI-RS. If the UE is not configured with
_minimumSchedulingOffsetK0_ for any DL BWP and _minimumSchedulingOffsetK2_ for
any UL BWP and if all the associated trigger states do not have the higher
layer parameter _qcl-Type_ set to \'typeD\' in the corresponding TCI states,
the CSI-RS triggering offset is fixed to zero. The aperiodic triggering offset
of the CSI-IM follows offset of the associated NZP CSI-RS for channel
measurement. The aperiodic CSI-RS is transmitted in a slot , $K_{s} = n + X +
\left\lfloor \left(
\frac{N_{slot,offset,PDCCH}^{\text{CA}}}{2^{\mu_{offset,PDCCH}}} -
\frac{N_{slot,offset,CSIRS}^{\text{CA}}}{2^{\mu_{offset,CSIRS}}} \right)
\bullet 2^{\mu_{\text{CSIRS}}} \right\rfloor$, if UE is configured with _ca-
SlotOffset_ for at least one of the triggered and triggering cell, and in slot
, otherwise, and where
_\- n_ is the slot containing the triggering DCI, _X_ is the CSI-RS triggering
offset according to the higher layer parameter _aperiodicTriggeringOffset_ or
_aperiodicTriggeringOffset-r16_ or _aperiodicTriggeringOffset-r17_ ,
_-_ $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}\ $and
$\mu_{\text{offset}\text{,PDCCH}}$ are the$\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the which are determined by higher-layer configured
_ca-SlotOffset_ for the cell receiving the PDCCH, $N_{\text{slot,\ offset,\
}\text{CSIRS}}^{\text{CA}}\ $and $\mu_{\text{offset}\text{,CSIRS}}$ are
the$\text{\ N}_{\text{slot,\ offset}}^{\text{CA}}$ and the which are
determined by higher-layer configured _ca-SlotOffset_ for the cell
transmitting the CSI-RS respectively, as defined in [4, TS 38.211] clause 4.5.
The UE does not expect that aperiodic CSI-RS is transmitted before the OFDM
symbol(s) carrying its triggering DCI. When the minimum scheduling offset
restriction is applied, UE is not expected to be triggered by CSI triggering
state indicated by the CSI request field in DCI in which CSI-RS triggering
offset is smaller than the currently applicable minimum scheduling offset
restriction _K_ ~0min~.
If interference measurement is performed on aperiodic NZP CSI-RS, a UE is not
expected to be configured with a different aperiodic triggering offset of the
NZP CSI-RS for interference measurement from the associated NZP CSI-RS for
channel measurement.
If the UE is configured with a single carrier for uplink, the UE is not
expected to transmit more than one aperiodic CSI report triggered by different
DCIs on overlapping OFDM symbols.
When the PDCCH reception includes two PDCCH candidates from two respective
search space sets, as described in clause 10.1 of [6, TS 38.213], for the
purpose of determining scheduling offset between the last symbol of the PDCCH
carrying the triggering DCI and the first symbol of the aperiodic CSI-RS
resources, the PDCCH candidate that ends later in time is used, and **_the UE
does not expect that the_** aperiodic **_CSI-RS is transmitted before the
first symbol of the PDCCH candidate that starts later in time._**
When a UE is configured with _dl-OrJointTCI-StateList_ and is having two
indicated TCI states, a higher layer configuration can be provided to an
aperiodic CSI-RS resource set or a CSI-RS resource in an aperiodic CSI-RS
resource set to inform that the UE shall apply the first or the second
indicated TCI-State to the aperiodic CSI-RS resource set or to the CSI-RS
resource in the aperiodic CSI-RS resource set, if the aperiodic CSI-RS
resource set for CSI or BM is configured with _followUnifiedTCI-State_ and if
the offset between the last symbol of the PDCCH carrying the triggering DCI
and the first symbol of the aperiodic CSI-RS resources in the aperiodic CSI-RS
resource set is equal to or larger than a threshold.
_-_ If the UE is configured by higher layer parameter PDCCH-Config that
contains two different values of CORESETPoolIndex in different
ControlResourceSets, the first and the second indicated TCI-States correspond
to the indicated TCI-States specific to coresetPoolIndex value 0 and value 1,
respectively.
When a UE is configured with _dl-OrJointTCI-StateList_ and is having two
indicated TCI states and if the offset between the last symbol of the PDCCH
carrying the triggering DCI and the first symbol of the aperiodic CSI-RS
resources in the aperiodic CSI-RS resource set is smaller than a threshold:
_-_ If there is no DL signal in the same symbols as the aperiodic CSI-RS
_-_ if the UE is in frequency range 1, or the UE reports its capability of
[two default beams for S-DCI based MTRP] in frequency range 2, the UE shall
apply the first or the second indicated joint/DL TCI state to the aperiodic
CSI-RS according to the higher layer configuration(s) provided to the
aperiodic CSI-RS resource or to the aperiodic CSI-RS resource set.
_-_ Otherwise, the UE shall apply the first indicated joint/DL TCI state to
the aperiodic CSI-RS.
When a UE is configured with _dl-OrJointTCI-StateList_ , is configured by
higher layer parameter _PDCCH-Config_ that contains two different values of
_coresetPoolIndex_ in different _ControlResourceSets,_ is having two indicated
TCI states and if the offset between the last symbol of the PDCCH carrying the
triggering DCI and the first symbol of the aperiodic CSI-RS resources in the
aperiodic CSI-RS resource set is smaller than a threshold:
_-_ If there is no DL signal in the same symbols as the aperiodic CSI-RS
_-_ if the UE is in frequency range 1, or the UE reports its capability of
[default beam per _coresetPoolIndex_ for M-DCI based MTRP] in frequency range
2, the UE shall apply the first or the second indicated joint/DL TCI state to
the aperiodic CSI-RS according to the higher layer configuration(s) provided
to the aperiodic CSI-RS resource or aperiodic CSI-RS resource set.
_-_ Otherwise, the UE shall apply the indicated joint/DL TCI state specific to
_coresetPoolIndex_ value 0 to the aperiodic CSI-RS resource set.
##### 5.2.1.5.1a Aperiodic CSI Reporting/Aperiodic CSI-RS when the triggering
PDCCH and the CSI-RS have different numerologies
When the triggering PDCCH and the triggered aperiodic CSI-RS are of different
numerologies, the behavior defined in 5.2.1.5.1 for the case where the
numerologies are the same applies with the following exceptions:
Beam switch timing:
\- If the scheduling offset between the last symbol of the PDCCH carrying the
triggering DCI and the first symbol of the aperiodic CSI-RS resources in a
_NZP-CSI-RS-ResourceSet_ configured without higher layer parameter _trs-Info_
is smaller than _beamSwitchTiming_ \+ _d_ $\bullet
2^{\mu_{\text{CSIRS}}}/2^{\mu_{\text{PDCCH}}}$ in CSI-RS symbols _,_ as
defined in [13, TS 38.306], when the reported value is one of the values of
{14, 28, 48}$\bullet 2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$ and
_enableBeamSwitchTiming_ is not provided, or is smaller than 48$\bullet
2^{{max(0,\ \mu}_{\text{CSIRS}} - 3)}$+ $d \bullet
2^{\mu_{\text{CSIRS}}}/2^{\mu_{\text{PDCCH}}}$ in CSI-RS symbols when the UE
provides _beamSwitchTiming-r16_ and _enableBeamSwitchTiming_ is provided and
the _NZP-CSI-RS-ResourceSet_ is configured with the higher layer parameter
_repetition_ set to \'off\' or configured without the higher layer parameter
_repetition,_ or is smaller than _beamSwitchTiming-r16 +_ $d \bullet
2^{\mu_{\text{CSIRS}}}/2^{\mu_{\text{PDCCH}}}$ in CSI-RS symbols _, when
enableBeamSwitchTiming_ is provided and the _NZP-CSI-RS-ResourceSet_ is
configured with the higher layer parameter _repetition_ set to \'on\', where
if the µ~PDCCH~ \
µ~CSIRS~.. The aperiodic CSI-RS is transmitted in a slot , if UE is configured
with _ca-SlotOffset_ for at least one of the triggered and triggering cell,
and _K~s\ ~_ = {width="1.0in" height="0.5145833333333333in"}, otherwise, and
where
_\- n_ is the slot containing the triggering DCI, _X_ is the CSI-RS triggering
offset in the numerology of CSI-RS according to the higher layer parameter
_aperiodicTriggeringOffset_ or _aperiodicTriggeringOffset-r16_ or
_aperiodicTriggeringOffset-r17_ ,
\- $\mu_{\text{CSIRS}}$ and $\mu_{\text{PDCCH}}$ are the subcarrier spacing
configurations for CSI-RS and PDCCH, respectively,
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}$are the$\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH
respectively, $N_{\text{slot,\ offset,\ }\text{CSIRS}}^{\text{CA}}\ $and
$\mu_{\text{offset}\text{,}\text{CSIRS}}$ are the$\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell transmitting the CSI-RS
respectively, as defined in [4, TS 38.211] clause 4.5
\- If the µ~PDCCH~ \ µ~CSIRS~, the UE is expected to be able to measure the
aperiodic CSI RS, if the CSI-RS starts no earlier than at least _Ncsirs_ PDCCH
symbols after the end of the PDCCH triggering the aperiodic CSI-RS.
When the PDCCH reception includes two PDCCH candidates from two respective
search space sets, as described in clause 10.1 of [6, TS 38.213], for the
purpose of determining _Ncsirs_ , the PDCCH candidate that ends later in time
is used.
Table 5.2.1.5.1a: _N~csirs~_ as a function of the subcarrier spacing of the
triggering PDCCH
**_µ~PDCCH~_** **_N~csirs~_ [symbols]**
* * *
0 4 1 5 2 10 3 14 5 56 6 112
When the triggering PDCCH and the triggered aperiodic CSI-RS are of different
numerologies, the CSI request constraint and CSI reporting constraint defined
in 5.2.1.5.1 for the case where the numerologies are the same applies with the
following additions:
\- CSI request constraints:
\- A UE is not expected to receive more than one CSI request per reference
slot length across all CCs in a cell group, where the SCS of the reference
slot is the minimum of SCS of the PDCCH with which the DCI was transmitted,
the SCS of the PUSCH with which the CSI report is to be transmitted, and the
SCS of the minimum SCS of the CSI-RS associated to the CSI reports triggered
by the DCI. The beginning of a slot length is defined according the PDCCH cell
with which the DCI carrying the CSI request is transmitted.
\- CSI reporting constraints:
\- A UE is not expected to receive more than one CSI request for transmission
in a given reference slot length across all CCs in a cell group, where the SCS
of the reference slot is the minimum of SCS of the PDCCH with which the DCI
was transmitted, the SCS of the PUSCH with which the CSI report is to be
transmitted, and the SCS of the minimum SCS of the CSI-RS associated to the
CSI reports triggered by the DCI. The beginning of a slot length is defined
according the PUSCH cell with which the CSI report is transmitted.
##### 5.2.1.5.2 Semi-persistent CSI/Semi-persistent CSI-RS
For semi-persistent reporting on PUSCH, a set of trigger states are higher
layer configured by _CSI-SemiPersistentOnPUSCH-TriggerStateList,_ where the
CSI request field in DCI scrambled with SP-CSI-RNTI activates one of the
trigger states. For a reporting setting for which the _CSI-ReportConfig_
contains a list of sub-configurations, provided by the higher layer parameter
[_csi-ReportSubConfigList_], one or more trigger states can be configured with
each indicating one or more of the sub-configurations. A UE is not expected to
receive a DCI scrambled with SP-CSI-RNTI activating one semi-persistent CSI
report with the same _CSI-ReportConfigId_ as in a semi-persistent CSI report
which is activated by a previously received DCI scrambled with SP-CSI-RNTI.
For semi-persistent reporting on PUCCH, the PUCCH resource used for
transmitting the CSI report are configured by _reportConfigType_. Semi-
persistent reporting on PUCCH is activated by an activation command as
described in clause 6.1.3.16 of [10, TS 38.321], which selects one of the
semi-persistent Reporting Settings for use by the UE on the PUCCH. For a
selected reporting setting for which the _CSI-ReportConfig_ contains a list of
sub-configurations provided by the higher layer parameter [_csi-
ReportSubConfigList_], [an/the] activation command can [also] select one or
more sub-configurations to use by the UE as described in clause 6.1.3.X of
[10, TS 38.321]. When the UE would transmit a PUCCH with HARQ-ACK information
in slot _n_ corresponding to the PDSCH carrying the activation command, the
indicated semi-persistent Reporting Setting should be applied starting from
the first slot that is after slot $n + {3N}_{\text{slot}}^{subframe,µ}$ where
_μ_ is the SCS configuration for the PUCCH.
For a UE configured with CSI resource setting(s) where the higher layer
parameter _resourceType_ set to \'semiPersistent\'.
\- when a UE receives an activation command, as described in clause 6.1.3.12
of [10, TS 38.321], for CSI-RS resource set(s) for channel measurement and
CSI-IM/NZP CSI-RS resource set(s) for interference measurement associated with
configured CSI resource setting(s), and when the UE would transmit a PUCCH
with HARQ-ACK information in slot _n_ corresponding to the PDSCH carrying the
selection command, the corresponding actions in [10, TS 38.321] and the UE
assumptions (including QCL assumptions provided by a list of reference to
_TCI-State\'s,_ one per activated resource) on CSI-RS/CSI-IM transmission
corresponding to the configured CSI-RS/CSI-IM resource configuration(s) shall
be applied starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ} + {\frac{2^{\mu}}{2^{\mu_{K_{\text{mac}}}}}
\bullet k}_{\text{mac}}$ where _μ_ is the SCS configuration for the PUCCH and
$\mu_{K_{\text{mac}}}\ $is the subcarrier spacing configuration for
$k_{\text{mac}}$ with a value of 0 for frequency range 1, and $k_{\text{mac}}$
is provided by _K-Mac_ or $k_{\text{mac}} = 0$ if _K-Mac_ is not provided. If
a _TCI-State_ referred to in the list is configured with a reference to an RS
configured with _qcl-Type_ set to \'_typeD_ \', that RS can be an SS/PBCH
block, periodic or semi-persistent CSI-RS located in same or different CC/DL
BWP.
\- when a UE receives a deactivation command, as described in clause 6.1.3.12
of [10, TS 38.321], for activated CSI-RS/CSI-IM resource set(s) associated
with configured CSI resource setting(s), and when the UE would transmit a
PUCCH with HARQ-ACK information in slot _n_ corresponding to the PDSCH
carrying the deactivation command, the corresponding actions in [10, TS
38.321] and UE assumption on cessation of CSI-RS/CSI-IM transmission
corresponding to the deactivated CSI-RS/CSI-IM resource set(s) shall apply
starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ} + {\frac{2^{\mu}}{2^{\mu_{K_{\text{mac}}}}}
\bullet k}_{\text{mac}}$ where _μ_ is the SCS configuration for the PUCCH and
$\mu_{K_{\text{mac}}}\ $is the subcarrier spacing configuration for
$k_{\text{mac}}$ with a value of 0 for frequency range 1, and $k_{\text{mac}}$
is provided by _K-Mac_ or $k_{\text{mac}} = 0$ if _K-Mac_ is not provided.
A codepoint of the CSI request field in the DCI is mapped to a SP-CSI
triggering state according to the order of the positions of the configured
trigger states in _CSI-SemiPersistentOnPUSCH-TriggerStateList_ , with
codepoint \'0\' mapped to the triggering state in the first position. A UE
validates, for semi-persistent CSI activation or release, a PDCCH on a DCI
only if the following conditions are met:
> \- the CRC parity bits of the DCI format are scrambled with a SP-CSI-RNTI
> provided by higher layer parameter _sp-CSI-RNTI_
\- Special fields for the DCI format are set according to Table 5.2.1.5.2-1 or
Table 5.2.1.5.2-2.
If validation is achieved, the UE considers the information in the DCI format
as a valid activation or valid release of semi-persistent CSI transmission on
PUSCH, and the UE activates or deactivates a CSI Reporting Setting indicated
by CSI request field in the DCI. If validation is not achieved, the UE
considers the DCI format as having been detected with a non-matching CRC.
**Table 5.2.1.5.2-1: Special fields for semi-persistent CSI activation PDCCH
validation**
+---------------------+----------------------+ | | DCI format 0_1/0_2 | +---------------------+----------------------+ | HARQ process number | set to all \'0\'s | | | | | (if present) | | +---------------------+----------------------+ | Redundancy version | set to all \'0\'s | | | | | (if present) | | +---------------------+----------------------+
Table 5.2.1.5.2-2: Special fields for semi-persistent CSI deactivation PDCCH
validation
+------------------------------+--------------------------------------+ | | DCI format 0_1/0_2 | +------------------------------+--------------------------------------+ | HARQ process number | set to all \'0\'s | | | | | (if present) | | +------------------------------+--------------------------------------+ | Modulation and coding scheme | set to all \'1\'s | +------------------------------+--------------------------------------+ | Resource block assignment | If higher layer configures RA type 0 | | | only, set to all \'0\'s; | | | | | | If higher layer configures RA type 1 | | | only, set to all \'1\'s; | | | | | | If higher layer configures dynamic | | | switch between RA type 0 and 1, then | | | if MSB is\'0\', set to all \'0\'s; | | | else, set to all \'1\'s | | | | | | For DCI 0_1, if higher layer | | | configures RA type 2, set to all | | | \'1\'s if _µ_ = 0; set to all \'0\'s | | | if _µ_ = 1 | +------------------------------+--------------------------------------+ | Redundancy version | set to all \'0\'s | | | | | (if present) | | +------------------------------+--------------------------------------+
If the UE has an active semi-persistent CSI-RS/CSI-IM resource configuration,
or an active semi-persistent ZP CSI-RS resource set configuration, and has not
received a deactivation command, the activated semi-persistent CSI-RS/CSI-IM
resource set or the activated semi-persistent ZP CSI-RS resource set
configurations are considered to be active when the corresponding DL BWP is
active, otherwise they are considered suspended.
If the UE is configured with carrier deactivation, the following
configurations in the carrier in activated state would also be deactivated and
need re-activation configuration(s): semi-persistent CSI-RS/CSI- IM resource,
semi-persistent CSI reporting on PUCCH, semi-persistent SRS, semi-persistent
ZP CSI-RS resource set.
##### 5.2.1.5.3 Aperiodic CSI-RS for tracking for fast SCell activation
When the UE receives an _Enhanced Scell Activation/Deactivation_ MAC-CE that
triggers one or two CSI-RS bursts for fast SCell activation for a (set of)
deactivated SCell(s),
\- if the MAC-CE indicates that the first CSI-RS burst for SCell activation is
present in an SCell, then the UE may assume that the first CSI-RS burst for
SCell activation is present in that SCell. The first slot of the first CSI-RS
burst starts at the _m~1~_ ^th^ SCell slot after the last SCell slot
coinciding with the reference slot _n+k_ , as defined in clause 4.3 of [6,
TS38.213].
\- if the MAC-CE indicates that the second CSI-RS burst for SCell activation
is present in an SCell, then the UE may assume that the second CSI-RS burst
for SCell activation is present in that SCell. The first slot of the second
CSI-RS burst starts at the _m~2~_ ^th^ SCell slot after the end of the first
CSI-RS burst. The CSI-RS of the second burst shall have the same antenna port
index, OFDM symbol allocations in a slot, same PRB allocation location as the
CSI-RS of the first burst.
_\- where_ the CSI-RS burst is defined as four CSI-RS resources in two
consecutive slots in clause 5.1.6.1.1.1, and _m~1~ and m~2~ are provided by
aperiodicTriggeringOffsetL2 in NZP-CSI-RS-ResourceSet and gapBetweenBursts,
respectively, associated with the CSI-RS burst(s) triggered by the MAC-CE._
#### 5.2.1.6 CSI processing criteria
The UE indicates the number of supported simultaneous CSI calculations
$N_{\text{CPU}}$ with parameter _simultaneousCSI-ReportsPerCC_ in a component
carrier, and _simultaneousCSI-ReportsAllCC_ across all component carriers. If
a UE supports $N_{\text{CPU}}$ simultaneous CSI calculations it is said to
have $N_{\text{CPU}}$ CSI processing units for processing CSI reports. If _L_
CPUs are occupied for calculation of CSI reports in a given OFDM symbol, the
UE has $N_{\text{CPU}} - L$ unoccupied CPUs. If _N_ CSI reports start
occupying their respective CPUs on the same OFDM symbol on which
$N_{\text{CPU}} - L$ CPUs are unoccupied, where each CSI report $n = 0,\
\ldots,\ N - 1$ corresponds to $O_{\text{CPU}}^{(n)}$, the UE is not required
to update the $N - M$ requested CSI reports with lowest priority (according to
Clause 5.2.5), where $0 \leq M \leq N\ $is the largest value such that
$\sum_{n = 0}^{M - 1}O_{\text{CPU}}^{(n)} \leq N_{\text{CPU}} - L\ $ holds.
A UE is not expected to be configured with an aperiodic CSI trigger state
containing more than $N_{\text{CPU}}$ Reporting Settings. Processing of a CSI
report occupies a number of CPUs for a number of symbols as follows:
\- $O_{\text{CPU}} = 0\ \ $for a CSI report with CSI-ReportConfig with higher
layer parameter _reportQuantity_ set to \'none\' and _CSI-RS-ResourceSet_ with
higher layer parameter _trs-Info_ configured
\- $O_{\text{CPU}} = 1\ $ for a CSI report with _CSI-ReportConfig_ with higher
layer parameter _reportQuantity_ set to \'cri-RSRP\', \'ssb-Index-RSRP\',
\'cri-SINR\', \'ssb-Index-SINR\', \'cri-RSRP- Index\', \'ssb-Index-RSRP-
Index\', \'cri-SINR- Index\', \'ssb-Index-SINR- Index \' or \'none\' (and
_CSI-RS-ResourceSet_ with higher layer parameter _trs-Info_ not configured)
\- $O_{\text{CPU}} = \left( Y + 1 \right) \cdot X$, for a CSI report with
_CSI-ReportConfig_ with higher layer parameter _reportQuantity_ set to
\'tdcp\' and with number of delays $Y$ configured by higher layer parameter
_Y_ , where the value of $X \in { 1,\ 2}$ is reported by UE capability.
\- for a CSI report with _CSI-ReportConfig_ with higher layer parameter
_reportQuantity_ set to \'cri-RI-PMI-CQI\', \'cri-RI-i1\', \'cri-RI-i1-CQI\',
\'cri-RI-CQI\', or \'cri-RI-LI-PMI-CQI\',
\- if max{ _µ~PDCCH~_ , _µ~CSI-RS~, µ~UL~_} ≤ 3, and if a CSI report is
aperiodically triggered without transmitting a PUSCH with either transport
block or HARQ-ACK or both when _L_ = 0 CPUs are occupied, where the CSI
corresponds to a single CSI with wideband frequency-granularity and to at most
4 CSI-RS ports in a single resource without CRI report and where
_codebookType_ is set to \'typeI-SinglePanel\' or where _reportQuantity_ is
set to \'cri-RI-CQI\', $O_{\text{CPU}} = N_{\text{CPU}}$$O_{\text{CPU}} =
N_{\text{CPU}}$,
\- if a _CSI-ReportConfig_ is configured with _codebookType_ set to \'typeI-
SinglePanel\' and the corresponding CSI-RS Resource Set for channel
measurement is configured with two Resource Groups and $N$ Resource Pairs,
$O_{\text{CPU}} = X \cdot N + M$, where $X$ is the number of CPUs occupied by
a pair of CMRs subject to _mTRP-CSI-numCPU-r17_ and $M$ is defined in clause
5.2.1.4.2,
\- if a _CSI-ReportConfig_ contains a list of _L_ sub-configurations provided
by the higher layer parameter [_csi-ReportSubConfigList_],
\- $O_{\text{CPU}} = \sum_{i = 1}^{\ L}K_{s}^{i}$ for periodic CSI reporting,
where $K_{s}^{i}$ is the total number of CSI-RS resources corresponding to the
_i_ -th sub-configuration.
\- $O_{\text{CPU}} = \sum_{i = 1}^{N}K_{s}^{i}$ for aperiodic and semi-
persistent CSI reporting, where $K_{s}^{i}$ is the total number of CSI-RS
resources corresponding to the _i_ -th sub-configuration, and where the _i_
-th sub-configuration is from _N_ indicated sub-configurations out of _L_ sub-
configurations contained in a _CSI-ReportConfig_ , where $N \leq L$ and $N
\geq 1$.
\- if a _CSI-ReportConfig_ is configured with the higher layer parameter
_reportQuantity_ set to \'cri-RI-PMI-CQI\', _codebookType_ set to \'typeII-
CJT-r18\' or \'typeII-CJT-PortSelection-r18\' and the corresponding _NZP-CSI-
RS-ResourceSet_ for channel measurement is configured with $1  1$, where the value of $N_{4}$ is configured by the
higher layer parameter _N4_ , and $Y_{2} \in { 2/3,\ 1,\ 2,\ 3}\ $is reported
by UE capability indication,
\- otherwise, $O_{\text{CPU}} = K_{s}$$O_{\text{CPU}} = K_{S}$, where $K_{s}\
$$K_{s}\ $is the number of CSI-RS resources in the CSI-RS resource set for
channel measurement.
For a CSI report with _CSI-ReportConfig_ with higher layer parameter
_reportQuantity_ not set to \'none\', the CPU(s) are occupied for a number of
OFDM symbols as follows:
\- A periodic or semi-persistent CSI report (excluding an initial semi-
persistent CSI report on PUSCH after the PDCCH triggering the report) occupies
CPU(s) from the first symbol of the earliest one of each CSI-RS/CSI-IM/SSB
resource for channel or interference measurement, respective latest CSI-
RS/CSI-IM/SSB occasion no later than the corresponding CSI reference resource,
until the last symbol of the configured PUSCH/PUCCH carrying the report.
\- An aperiodic CSI report occupies CPU(s) from the first symbol after the
PDCCH triggering the CSI report until the last symbol of the scheduled PUSCH
carrying the report. When the PDCCH reception includes two PDCCH candidates
from two respective search space sets, as described in clause 10.1 of [6, TS
38.213], for the purpose of determining the CPU occupation duration, the PDCCH
candidate that ends later in time is used.
\- An initial semi-persistent CSI report on PUSCH after the PDCCH trigger
occupies CPU(s) from the first symbol after the PDCCH until the last symbol of
the scheduled PUSCH carrying the report. When the PDCCH reception includes two
PDCCH candidates from two respective search space sets, as described in clause
10.1 of [6, TS 38.213], for the purpose of determining the CPU occupation
duration, the PDCCH candidate that ends later in time is used.
For a CSI report with _CSI-ReportConfig_ with higher layer parameter
_reportQuantity_ set to \'none\' and _CSI-RS-ResourceSet_ with higher layer
parameter _trs-Info_ not configured, the CPU(s) are occupied for a number of
OFDM symbols as follows:
\- A semi-persistent CSI report (excluding an initial semi-persistent CSI
report on PUSCH after the PDCCH triggering the report) occupies CPU(s) from
the first symbol of the earliest one of each transmission occasion of periodic
or semi-persistent CSI-RS/SSB resource for channel measurement for L1-RSRP
computation, until $Z_{3}^{'}$ symbols after the last symbol of the latest one
of the CSI-RS/SSB resource for channel measurement for L1-RSRP computation in
each transmission occasion.
\- An aperiodic CSI report occupies CPU(s) from the first symbol after the
PDCCH triggering the CSI report until the last symbol between $Z_{3}$ symbols
after the first symbol after the PDCCH triggering the CSI report and
$Z_{3}^{'}$ symbols after the last symbol of the latest one of each CSI-RS/SSB
resource for channel measurement for L1-RSRP computation.
where $(Z_{3},Z_{3}^{'})$ are defined in the table 5.4-2.
In any slot, the UE is not expected to have more active CSI-RS ports or active
CSI-RS resources in active BWPs than reported as capability. NZP CSI-RS
resource is active in a duration of time defined as follows. For aperiodic
CSI-RS, starting from the end of the PDCCH containing the request and ending
at the end of the scheduled PUSCH containing the report associated with this
aperiodic CSI-RS. When the PDCCH candidates are associated with a search space
set configured with _searchSpaceLinkingId_ , for the purpose of determining
the NZP CSI-RS resource active duration, the PDCCH candidate that ends later
in time among the two linked PDCCH candidates is used. For semi-persistent
CSI-RS, starting from the end of when the activation command is applied, and
ending at the end of when the deactivation command is applied. For periodic
CSI-RS, starting when the periodic CSI-RS is configured by higher layer
signalling, and ending when the periodic CSI-RS configuration is released.
If a CSI-RS resource is referred _N_ times by one or more CSI Reporting
Settings, the CSI-RS resource and the CSI-RS ports within the CSI-RS resource
are counted _N_ times.
For a CSI-RS Resource Set for channel measurement configured with two Resource
Groups and $N$ Resource Pairs, if a CSI-RS resource is referred $X$ times by
one of the $M$ CSI-RS resources, where $M$ is defined in clause 5.2.1.4.2,
and/or one or two Resource Pairs, the CSI-RS resource and the CSI-RS ports
within the CSI-RS resource are counted $X$ times.
For a CSI report configuration containing sub-configuration(s) indicated in a
_CSI-ReportConfig,_ **if a CSI-RS resource is referred by _M _sub-
configurations among_ X _sub-configurations,_ the CSI-RS resource is counted M
times and the CSI-RS ports within the CSI-RS resource are counted as
follows:_**
\- $\max\left( \sum_{s = 1}^{M}P_{s},\ P \right)$ if each sub-configuration,
of the **_M_ sub-configurations**, is configured with a CSI-RS antenna port
subset, provided by **_[port-subsetIndicator],_**
\- **_M × P_** if each sub-configuration, of the **_M_ sub-configurations**,
is configured with a list of one or more CSI-RS resources, provided by [_nzp-
CSI-RS-resourceList_], [and/] or is configured with a power offset, provided
by _[powerOffset]_ ,
**_Where P is the number of ports configured by nrofPorts and_** $P_{s}$ **_is
the number of CSI-RS ports in sub-configuration s derived from the
corresponding antenna port subset indicator [port-subsetIndicator]_**
according to clause 5.2.1.4.2** _._**
For a periodic or semi-persistent CSI-RS resource in a CSI-RS resource set for
channel measurement linked to a _CSI-ReportConfig_ configured with the higher
layer parameter _codebookType_ set to \'typeII-Doppler-r18\' or \'typeII-
Doppler-PortSelection-r18\', the CSI-RS resource and the CSI-RS ports within
the CSI-RS resource are counted $K_{P}$ times, where the value of $K_{P} \in {
1,2,4}$ is indicated by UE capability.
### 5.2.2 Channel state information
#### 5.2.2.1 Channel quality indicator (CQI)
The CQI indices and their interpretations are given in Table 5.2.2.1-2 or
Table 5.2.2.1-4 for reporting CQI based on QPSK, 16QAM and 64QAM. The CQI
indices and their interpretations are given in Table 5.2.2.1-3 for reporting
CQI based on QPSK, 16QAM, 64QAM and 256QAM. The CQI indices and their
interpretations are given in Table 5.2.2.1-5 for reporting CQI based on QPSK,
16QAM, 64QAM, 256QAM and 1024 QAM.
Based on an unrestricted observation interval in time unless specified
otherwise in this Clause, and an unrestricted observation interval in
frequency, the UE shall derive for each CQI value reported in uplink slot _n_
the highest CQI index which satisfies the following condition:
\- A single PDSCH transport block with a combination of modulation scheme,
target code rate and transport block size corresponding to the CQI index, and
occupying a group of downlink physical resource blocks termed the CSI
reference resource, could be received with a transport block error probability
not exceeding:
\- 0.1, if the higher layer parameter _cqi-Table_ in _CSI-ReportConfig_
configures \'table1\' (corresponding to Table 5.2.2.1-2), or \'table2\'
(corresponding to Table 5.2.2.1-3), or if the higher layer parameter _cqi-
Table_ in _CSI-ReportConfig_ configures \'table4-r17\' (corresponding to Table
5.2.2.1-5), or
\- 0.00001, if the higher layer parameter _cqi-Table_ in _CSI-ReportConfig_
configures \'table3\' (corresponding to Table 5.2.2.1-4).
If the higher layer parameter _timeRestrictionForChannelMeasurements_ is set
to \"_notConfigured_ \", the UE shall derive the channel measurements for
computing CSI value reported in uplink slot _n_ based on only the NZP CSI-RS,
no later than the CSI reference resource, (defined in TS 38.211[4]) associated
with the CSI resource setting.
If the higher layer parameter _timeRestrictionForChannelMeasurements_ in _CSI-
ReportConfig_ is set to \"_Configured_ \", the UE shall derive the channel
measurements for computing CSI reported in uplink slot _n_ based on only the
most recent, no later than the CSI reference resource, occasion of NZP CSI-RS
(defined in [4, TS 38.211]) associated with the CSI resource setting.
If the higher layer parameter _timeRestrictionForInterferenceMeasurements_ is
set to \"_notConfigured_ \", the UE shall derive the interference measurements
for computing CSI value reported in uplink slot _n_ based on only the CSI-IM
and/or NZP CSI-RS for interference measurement no later than the CSI reference
resource associated with the CSI resource setting.
If the higher layer parameter _timeRestrictionForInterferenceMeasurements_ in
_CSI-ReportConfig_ is set to \"_Configured_ \", the UE shall derive the
interference measurements for computing the CSI value reported in uplink slot
_n_ based on the most recent, no later than the CSI reference resource,
occasion of CSI-IM and/or NZP CSI-RS for interference measurement (defined in
[4, TS 38.211]) associated with the CSI resource setting.
If the higher layer parameter _cqi-BitsPerSubband_ in _CSI-ReportConfig_ is
not configured, for each sub-band index _s,_ a 2-bit sub-band differential CQI
is defined as:
\- Sub-band Offset level (_s_) = sub-band CQI index (_s_) - wideband CQI
index.
The mapping from the 2-bit sub-band differential CQI values to the offset
level is shown in Table 5.2.2.1-1
Table 5.2.2.1-1: Mapping sub-band differential CQI value to offset level
Sub-band differential CQI value Offset level
* * *
0 0 1 1 2 ≥ 2 3 ≤-1
If the higher layer parameter _cqi-BitsPerSubband_ in _CSI-ReportConfig_ is
configured, for each sub-band index _s_ , a 4-bit sub-band CQI is reported _._
The 4-bit sub-band CQI for each sub-band _s_ is a CQI index in Table
5.2.2.1-2, Table 5.2.2.1-3, or Table 5.2.2.1-4 as configured by the higher
layer parameter _cqi-Table_ in _CSI-ReportConfig_.
A combination of modulation scheme and transport block size corresponds to a
CQI index if:
\- the combination could be signaled for transmission on the PDSCH in the CSI
reference resource according to the Transport Block Size determination
described in Clause 5.1.3.2, and
\- the modulation scheme is indicated by the CQI index, and
\- the combination of transport block size and modulation scheme when applied
to the reference resource results in the effective channel code rate which is
the closest possible to the code rate indicated by the CQI index. If more than
one combination of transport block size and modulation scheme results in an
effective channel code rate equally close to the code rate indicated by the
CQI index, only the combination with the smallest of such transport block
sizes is relevant.
Table 5.2.2.1-2: 4-bit CQI Table
* * *
CQI index modulation code rate x 1024 efficiency 0 out of range  
1 QPSK 78 0.1523 2 QPSK 120 0.2344 3 QPSK 193 0.3770 4 QPSK 308 0.6016 5 QPSK
449 0.8770 6 QPSK 602 1.1758 7 16QAM 378 1.4766 8 16QAM 490 1.9141 9 16QAM 616
2.4063 10 64QAM 466 2.7305 11 64QAM 567 3.3223 12 64QAM 666 3.9023 13 64QAM
772 4.5234 14 64QAM 873 5.1152 15 64QAM 948 5.5547
* * *
Table 5.2.2.1-3: 4-bit CQI Table 2
* * *
CQI index modulation code rate x 1024 efficiency 0 out of range  
1 QPSK 78 0.1523 2 QPSK 193 0.3770 3 QPSK 449 0.8770 4 16QAM 378 1.4766 5
16QAM 490 1.9141 6 16QAM 616 2.4063 7 64QAM 466 2.7305 8 64QAM 567 3.3223 9
64QAM 666 3.9023 10 64QAM 772 4.5234 11 64QAM 873 5.1152 12 256QAM 711 5.5547
13 256QAM 797 6.2266 14 256QAM 885 6.9141 15 256QAM 948 7.4063
* * *
Table 5.2.2.1-4: 4-bit CQI Table 3
* * *
CQI index modulation code rate x 1024 efficiency 0 out of range  
1 QPSK 30 0.0586 2 QPSK 50 0.0977 3 QPSK 78 0.1523 4 QPSK 120 0.2344 5 QPSK
193 0.3770 6 QPSK 308 0.6016 7 QPSK 449 0.8770 8 QPSK 602 1.1758 9 16QAM 378
1.4766 10 16QAM 490 1.9141 11 16QAM 616 2.4063 12 64QAM 466 2.7305 13 64QAM
567 3.3223 14 64QAM 666 3.9023 15 64QAM 772 4.5234
* * *
Table 5.2.2.1-5: 4-bit CQI Table 4
* * *
CQI index modulation code rate x 1024 efficiency 0 out of range  
[1]{.underline} [QPSK]{.underline} [78]{.underline} [0.1523]{.underline}
[2]{.underline} [QPSK]{.underline} [193]{.underline} [0.377]{.underline}
[3]{.underline} [QPSK]{.underline} [449]{.underline} [0.877]{.underline}
[4]{.underline} [16QAM]{.underline} [378]{.underline} [1.4766]{.underline}
[5]{.underline} [16QAM]{.underline} [616]{.underline} [2.4063]{.underline}
[6]{.underline} [64QAM]{.underline} [567]{.underline} [3.3223]{.underline}
[7]{.underline} [64QAM]{.underline} [666]{.underline} [3.9023]{.underline}
[8]{.underline} [64QAM]{.underline} [772]{.underline} [4.5234]{.underline}
[9]{.underline} [64QAM]{.underline} [873]{.underline} [5.1152]{.underline}
[10]{.underline} [256QAM]{.underline} [711]{.underline} [5.5547]{.underline}
[11]{.underline} [256QAM]{.underline} [797]{.underline} [6.2266]{.underline}
[12]{.underline} [256QAM]{.underline} [885]{.underline} [6.9141]{.underline}
[13]{.underline} [256QAM]{.underline} [948]{.underline} [7.4063]{.underline}
[14]{.underline} [1024QAM]{.underline} [853]{.underline} [8.3301]{.underline}
[15]{.underline} [1024QAM]{.underline} [948]{.underline} [9.2578]{.underline}
* * *
##### 5.2.2.1.1 (void)
#### 5.2.2.2 Precoding matrix indicator (PMI)
##### 5.2.2.2.1 Type I Single-Panel Codebook
For 2 antenna ports {3000, 3001} and the UE configured with higher layer
parameter _codebookType_ set to \'typeI-SinglePanel\' each PMI value
corresponds to a codebook index given in Table 5.2.2.2.1-1. The UE is
configured with the higher layer parameter _twoTX-CodebookSubsetRestriction_.
The bitmap parameter _twoTX-CodebookSubsetRestriction_ forms the bit sequence
where is the LSB and is the MSB and where a bit value of zero indicates that
PMI reporting is not allowed to correspond to the precoder associated with the
bit. Bits 0 to 3 are associated respectively with the codebook indices 0 to 3
for layer, and bits 4 and 5 are associated respectively with the codebook
indices 0 and 1 for layers.
Table 5.2.2.2.1-1: Codebooks for 1-layer and 2-layer CSI reporting using
antenna ports 3000 to 3001
Codebook index Number of layers
* * *
                   1                  2
0  
1  
2 - 3 -
For 4 antenna ports {3000, 3001, 3002, 3003}, 8 antenna ports {3000, 3001,
..., 3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000,
3001, ..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna
ports {3000, 3001, ..., 3031}, and the UE configured with higher layer
parameter _codebookType_ set to \'typeI-SinglePanel\', except when the number
of layers (where is the associated RI value), each PMI value corresponds to
three codebook indices ,,. When the number of layers , each PMI value
corresponds to four codebook indices ,,,. The composite codebook index is
defined by
The codebooks for 1-8 layers are given respectively in Tables 5.2.2.2.1-5,
5.2.2.2.1-6, 5.2.2.2.1-7, 5.2.2.2.1-8, 5.2.2.2.1-9, 5.2.2.2.1-10,
5.2.2.2.1-11, and 5.2.2.2.1-12. The mapping from to and for 2-layer reporting
is given in Table 5.2.2.2.1-3. The mapping from to and for 3-layer and 4-layer
reporting when is given in Table 5.2.2.2.1-4. The quantities , , , , and are
given by
\- The values of and are configured with the higher layer parameter _n1-n2_ ,
respectively. The supported configurations of for a given number of CSI-RS
ports and the corresponding values of are given in Table 5.2.2.2.1-2. The
number of CSI-RS ports, , is.
\- UE shall only use and shall not report if the value of _N~2~_ is 1.
The bitmap parameter _n1-n2_ forms the bit sequence where is the LSB and is
the MSB and where a bit value of zero indicates that PMI reporting is not
allowed to correspond to any precoder associated with the bit. The number of
bits is given by . Except when the number of layers and the number of antenna
ports is 16, 24, or 32, bit is associated with all precoders based on the
quantity , , . When the number of layers and the number of antenna ports is
16, 24, or 32,
\- bits , , and are each associated with all precoders based on the quantity ,
, ;
\- if one or more of the associated bits is zero, then PMI reporting is not
allowed to correspond to any precoder based on .
For UE configured with higher layer parameter _codebookType_ set to \'typeI-
SinglePanel\', the bitmap parameter _typeI-SinglePanel-ri‑Restriction_ forms
the bit sequence where is the LSB and is the MSB. When is zero, , PMI and RI
reporting are not allowed to correspond to any precoder associated with
layers.
For UE configured with higher layer parameter _reportQuantity_ set to \'cri-
RI-i1-CQI\', the bitmap parameter _typeI-SinglePanel-
codebookSubsetRestriction-i2_ forms the bit sequence $b_{15},\ldots$,$b_{1},\
b_{0}$ where $b_{0}$ is the LSB and $b_{15}$ is the MSB. The bit $b_{i}$ is
associated with precoders corresponding to codebook index $i_{2} = i$. When
$b_{i}$ is zero, the randomly selected precoder for CQI calculation is not
allowed to correspond to any precoder associated with the bit $b_{i}$.
Table 5.2.2.2.1-2: Supported configurations of and
* * *
Number of\  
CSI-RS antenna ports,
4 (2,1) (4,1)
8 (2,2) (4,4)
                          (4,1)    (4,1)
12 (3,2) (4,4)
                          (6,1)    (4,1)
16 (4,2) (4,4)
                          (8,1)    (4,1)
24 (4,3) (4,4)
                          (6,2)    (4,4)
                          (12,1)   (4,1)
32 (4,4) (4,4)
                          (8,2)    (4,4)
                          (16,1)   (4,1)
* * *
Table 5.2.2.2.1-3: Mapping of to and for 2-layer CSI reporting
* * *
0 0 0 0 0 0 0 0 0 1 0 0 0 0 2 0 0 0 3 0 0
* * *
Table 5.2.2.2.1-4: Mapping of to and for 3-layer and 4-layer CSI reporting
when
* * *
0 0 0 0 0 0 1 0 0 0 0  
2 0 0  
3 0 0
* * *
Table 5.2.2.2.1-5: Codebook for 1-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1
* * *
where .
_codebookMode_ = 2,
* * *
                           0    1    2    3
                           4    5    6    7
                           8    9    10   11
                           12   13   14   15
where .
_codebookMode =_ 2,
* * *
                           0    1    2    3
                           4    5    6    7
                           8    9    10   11
                           12   13   14   15
where .
Table 5.2.2.2.1-6: Codebook for 2-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+ | _codebookMode_ = 1 | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | +------------------------------------------------------------+---+---+---+
+------------------------------------------------------------+---+---+---+ | _codebookMode =_ 2, | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 0 | 1 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 2 | 3 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 4 | 5 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 6 | 7 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | +------------------------------------------------------------+---+---+---+
+--------------------------------------------------------+---+---+---+---+---+ | _codebookMode =_ 2, | | | | | | +========================================================+===+===+===+===+===+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | | | 0 | 1 | 2 | 3 | +--------------------------------------------------------+---+---+---+---+---+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | | | 4 | 5 | 6 | 7 | +--------------------------------------------------------+---+---+---+---+---+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | where . | | | | | | | | | | | | | | and the mapping from to is given in Table 5.2.2.2.1-3. | | | | | | +--------------------------------------------------------+---+---+---+---+---+
Table 5.2.2.2.1-7: Codebook for 3-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+ | _codebookMode =_ 1-2, | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-4. | | | | +------------------------------------------------------------+---+---+---+
_codebookMode_ = 1-2,
* * *
where .
Table 5.2.2.2.1-8: Codebook for 4-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+ | _codebookMode =_ 1-2, | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-4. | | | | +------------------------------------------------------------+---+---+---+
_codebookMode_ = 1-2,
* * *
where .
Table 5.2.2.2.1-9: Codebook for 5-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
Table 5.2.2.2.1-10: Codebook for 6-layer CSI reporting using antenna ports
3000 to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
Table 5.2.2.2.1-11: Codebook for 7-layer CSI reporting using antenna ports
3000 to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
Table 5.2.2.2.1-12: Codebook for 8-layer CSI reporting using antenna ports
3000 to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
##### 5.2.2.2.2 Type I Multi-Panel Codebook
For 8 antenna ports {3000, 3001, ..., 3007}, 16 antenna ports {3000, 3001,
..., 3015}, and 32 antenna ports {3000, 3001, ..., 3031}, and the UE
configured with higher layer parameter _codebookType_ set to \'typeI-
MultiPanel\',
\- The values of , and are configured with the higher layer parameters
_ng-n1-n2_. The supported configurations of for a given number of CSI-RS ports
and the corresponding values of are given in Table 5.2.2.2.2-1. The number of
CSI-RS ports, , is .
\- When , _codebookMode_ shall be set to either \'1\' or \'2\'. When ,
_codebookMode_ shall be set to \'1\'.
The bitmap parameter _ng-n1-n2_ forms the bit sequence where is the LSB and is
the MSB and where a bit value of zero indicates that PMI reporting is not
allowed to correspond to any precoder associated with the bit. The number of
bits is given by . Bit is associated with all precoders based on the quantity
, , , as defined below. The bitmap parameter _ri‑Restriction_ forms the bit
sequence where is the LSB and is the MSB. When is zero, , PMI and RI reporting
are not allowed to correspond to any precoder associated with layers.
Table 5.2.2.2.2-1: Supported configurations of and
* * *
Number of\  
CSI-RS antenna ports,
8 (2,2,1) (4,1)
16 (2,4,1) (4,1)
                          (4,2,1)   (4,1)
                          (2,2,2)   (4,4)
32 (2,8,1) (4,1)
                          (4,4,1)   (4,1)
                          (2,4,2)   (4,4)
                          (4,2,2)   (4,4)
* * *
Each PMI value corresponds to the codebook indices and , where is the vector
and is the associated RI value. When _codebookMode_ is set to \'1\', is
.
When _codebookMode_ is set to \'2\', and are
.
The mapping from to and for 2-layer reporting is given in Table 5.2.2.2.1-3.
The mapping from to and for 3-layer and 4-layer reporting is given in Table
5.2.2.2.2-2.
\- UE shall only use and shall not report if the value of _N~2~_ is 1.
Table 5.2.2.2.2-2: Mapping of to and for 3-layer and 4-layer CSI reporting
* * *
0 0 0 0 0 0 1 0 0 0 0  
2 0 0  
3 0 0
* * *
Several quantities are used to define the codebook elements. The quantities ,
, , , and are given by
Furthermore, the quantities and () are given by
where
,
and the quantities and () are given by
where
.
The codebooks for 1-4 layers are given respectively in Tables 5.2.2.2.2-3,
5.2.2.2.2-4, 5.2.2.2.2-5, and 5.2.2.2.2-6.
Table 5.2.2.2.2-3: Codebook for 1-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1,
* * *
                           ,
where .
_codebookMode_ = 2,
* * *
where .
Table 5.2.2.2.2-4: Codebook for 2-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 1, | | | | | +============================================================+===+===+===+===+ | | | , | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | | +------------------------------------------------------------+---+---+---+---+
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 2, | | | | | +============================================================+===+===+===+===+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | | +------------------------------------------------------------+---+---+---+---+
Table 5.2.2.2.2-5: Codebook for 3-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 1, | | | | | +============================================================+===+===+===+===+ | | | , | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 2, | | | | | +============================================================+===+===+===+===+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
Table 5.2.2.2.2-6: Codebook for 4-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 1, | | | | | +============================================================+===+===+===+===+ | | | , | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 2, | | | | | +============================================================+===+===+===+===+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
##### 5.2.2.2.3 Type II Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and the UE configured with higher layer parameter
_codebookType_ set to \'typeII\'
\- The values of and are configured with the higher layer parameter
_n1-n2-codebookSubsetRestriction_. The supported configurations of for a given
number of CSI-RS ports and the corresponding values of are given in Table
5.2.2.2.1-2. The number of CSI-RS ports, , is .
\- The value of is configured with the higher layer parameter _numberOfBeams_
, where when and when .
\- The value of is configured with the higher layer parameter
_phaseAlphabetSize_ , where .
\- The UE is configured with the higher layer parameter _subbandAmplitude_ set
to \'true\' or \'false\'.
\- The UE shall not report RI > 2.
When , where is the associated RI value, each PMI value corresponds to the
codebook indices and where
..
The vectors combined by the codebook are identified by the indices and , where
.
Let
and
.
where the values of are given in Table 5.2.2.2.3-1.
Then the elements of and are found from using the algorithm:
> for
>
> Find the largest in Table 5.2.2.2.3-1 such that
When and are known, is found using:
> where the indices are assigned such that increases as increases
>
> , where is given in Table 5.2.2.2.3-1.
\- If , and for , and is not reported.
\- When , and , and is not reported.
\- When and , and , and is not reported.
\- When and , and, and is not reported.
Table 5.2.2.2.3-1: Combinatorial coefficients
       1    2     3     4
* * *
0 0 0 0 0 1 1 0 0 0 2 2 1 0 0 3 3 3 1 0 4 4 6 4 1 5 5 10 10 5 6 6 15 20 15 7 7
21 35 35 8 8 28 56 70 9 9 36 84 126 10 10 45 120 210 11 11 55 165 330 12 12 66
220 495 13 13 78 286 715 14 14 91 364 1001 15 15 105 455 1365
The strongest coefficient on layer is identified by .
The amplitude coefficient indicators and are
for . The mapping from to the amplitude coefficient is given in Table
5.2.2.2.3-2 and the mapping from to the amplitude coefficient is given in
Table 5.2.2.2.3-3. The amplitude coefficients are represented by
for .
Table 5.2.2.2.3-2: Mapping of elements of : to
* * *
0  
1  
2  
3  
4  
5  
6  
7
* * *
Table 5.2.2.2.3-3: Mapping of elements of : to
* * *
0  
1
* * *
The phase coefficient indicators are
for .
The amplitude and phase coefficient indicators are reported as follows:
\- The indicators , , and (). , , and are not reported for .
\- The remaining elements of () are reported, where . Let () be the number of
elements of that satisfy .
\- The remaining elements of and () are reported as follows:
\- When _subbandAmplitude_ is set to \'false\',
\- for , and . is not reported for .
\- For , the elements of corresponding to the coefficients that satisfy , , as
determined by the reported elements of , are reported, where and the remaining
elements of are not reported and are set to .
\- When _subbandAmplitude_ is set to \'true\',
\- For , the elements of and corresponding to the strongest coefficients
(excluding the strongest coefficient indicated by), as determined by the
corresponding reported elements of , are reported, where and . The values of
are given in Table 5.2.2.2.3-4. The remaining elements of are not reported and
are set to . The elements of corresponding to the weakest non-zero
coefficients are reported, where . The remaining elements of are not reported
and are set to .
\- When two elements, and , of the reported elements of are identical (), then
element is prioritized to be included in the set of the strongest coefficients
for and () reporting.
Table 5.2.2.2.3-4: Full resolution subband coefficients when
_subbandAmplitude_ is set to \'true\'
* * *
2 4 3 4 4 6
* * *
The codebooks for 1-2 layers are given in Table 5.2.2.2.3-5, where the indices
and are given by
for , and the quantities , , and are given by
.
Table 5.2.2.2.3-5: Codebook for 1-layer and 2-layer CSI reporting using
antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+-----------------------------------------------------------------+---+ | Layers | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | where , | | | | | | and the mappings from to , , , , , and , and from to , , and | | | are as described above, including the ranges of the constituent | | | indices of and . | | +-----------------------------------------------------------------+---+
When the UE is configured with higher layer parameter _codebookType_ set to
\'typeII\', thebitmap parameter _typeII-RI‑Restriction_ forms the bit sequence
where is the LSB and is the MSB. When is zero, , PMI and RI reporting are not
allowed to correspond to any precoder associated with layers. The bitmap
parameter _n1-n2‑codebookSubsetRestriction_ forms the bit sequence where bit
sequences , and are concatenated to form . To define and , first define the
vector groups as
for
.
The UE shall be configured with restrictions for 4 vector groups indicated by
for and identified by the group indices
for , where the indices are assigned such that increases as increases. The
remaining vector groups are not restricted.
\- If , for , and is empty.
\- If , is the binary representation of the integer where is the MSB and is
the LSB. is found using:
,
> where is defined in Table 5.2.2.2.3-1. The group indices and indicators for
> may be found from using the algorithm:
>
> for
>
> Find the largest such that
The bit sequence is the concatenation of the bit sequences for , corresponding
to the group indices . The bit sequence is defined as
Bits indicate the maximum allowed amplitude coefficient for the vector in
group indexed by , where the maximum amplitude coefficients are given in Table
5.2.2.2.3-6. A UE that does not report parameter _amplitudeSubsetRestriction_
= \'supported\' in its capability signaling is not expected to be configured
with = 01 or 10.
Table 5.2.2.2.3-6: Maximum allowed amplitude coefficients for restricted
vectors
* * *
Bits Maximum Amplitude Coefficient
00  
01  
10  
11
* * *
##### 5.2.2.2.4 Type II Port Selection Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and the UE configured with higher layer parameter
_codebookType_ set to \'typeII-PortSelection\'
\- The number of CSI-RS ports is given by as configured by higher layer
parameter _nrofPorts_.
\- The value of is configured with the higher layer parameter _numberOfBeams_
, where when and when .
\- The value of is configured with the higher layer parameter
_portSelectionSamplingSize_ , where and .
\- The value of is configured with the higher layer parameter
_phaseAlphabetSize_ , where .
\- The UE is configured with the higher layer parameter _subbandAmplitude_ set
to \'true\' or \'false\'.
\- The UE shall not report RI > 2.
The UE is also configured with the higher layer parameter _typeII-
PortSelectionRI‑Restriction_. The bitmap parameter _typeII-
PortSelectionRI‑Restriction_ forms the bit sequence where is the LSB and is
the MSB. When is zero, , PMI and RI reporting are not allowed to correspond to
any precoder associated with layers.
When , where is the associated RI value, each PMI value corresponds to the
codebook indices and where
.
The antenna ports per polarization are selected by the index , where
.
The strongest coefficient on layer is identified by .
The amplitude coefficient indicators and are
for . The mapping from to the amplitude coefficient is given in Table
5.2.2.2.3-2 and the mapping from to the amplitude coefficient is given in
Table 5.2.2.2.3-3. The amplitude coefficients are represented by
for .
The phase coefficient indicators are
for .
The amplitude and phase coefficient indicators are reported as follows:
\- The indicators , , and (). , , and are not reported for .
\- The remaining elements of () are reported, where . Let () be the number of
elements of that satisfy .
\- The remaining elements of and () are reported as follows:
\- When _subbandAmplitude_ is set to \'false\',
\- for , and . is not reported for .
\- For , the elements of corresponding to the coefficients that satisfy , , as
determined by the reported elements of , are reported, where and the remaining
elements of are not reported and are set to .
\- When _subbandAmplitude_ is set to \'true\',
\- For , the elements of and corresponding to the strongest coefficients
(excluding the strongest coefficient indicated by), as determined by the
corresponding reported elements of , are reported, where and . The values of
are given in Table 5.2.2.2.3-4. The remaining elements of are not reported and
are set to . The elements of corresponding to the weakest non-zero
coefficients are reported, where . The remaining elements of are not reported
and are set to .
\- When two elements, and , of the reported elements of are identical (), then
element is prioritized to be included in the set of the strongest coefficients
for and () reporting.
The codebooks for 1-2 layers are given in Table 5.2.2.2.4-1, where the
quantity is given by
and is a -element column vector containing a value of 1 in element and zeros
elsewhere (where the first element is element 0).
Table 5.2.2.2.4-1: Codebook for 1-layer and 2-layer CSI reporting using
antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+-----------------------------------------------------------------+---+ | Layers | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | where , | | | | | | and the mappings from to , , and and from to , , , and are as | | | described above, including the ranges of the constituent | | | indices of and . | | +-----------------------------------------------------------------+---+
##### 5.2.2.2.5 Enhanced Type II Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and UE configured with higher layer parameter
_codebookType_ set to \' typeII-r16\'
\- The values of $N_{1}$ and $N_{2}$ are configured with the higher layer
parameter _n1-n2-codebookSubsetRestriction-r16_. The supported configurations
of $\left( N_{1},N_{2} \right)$ for a given number of CSI-RS ports and the
corresponding values of $\left( O_{1},O_{2} \right)$ are given in Table
5.2.2.2.1-2. The number of CSI-RS ports, $P_{CSI - RS}$, is $2N_{1}N_{2}$.
\- The values of $L$, $\beta$ and $p_{\upsilon}$ are determined by the higher
layer parameter _paramCombination-r16_ , where the mapping is given in Table
5.2.2.2.5-1.
\- The UE is not expected to be configured with _paramCombination-r16_ equal
to
\- 3, 4, 5, 6, 7, or 8 when $P_{CSI - RS} = 4$,
\- 7 or 8 when $P_{CSI - RS}  1$.
\- 7 or 8 when $R = 2$.
\- The parameter $R$ is configured with the higher-layer parameter
_numberOfPMI-SubbandsPerCQI-Subband_. This parameter controls the total number
of precoding matrices $N_{3}$ indicated by the PMI as a function of the number
of configured subbands in _csi-ReportingBand_ , the subband size configured by
the higher-level parameter **_subbandSize and of the total number of PRBs in
the bandwidth part according to Table 5.2.1.4-2_** , as follows:
\- When $R = 1$:
\- One precoding matrix is indicated by the PMI for each subband in _csi-
ReportingBand_.
\- When $R = 2$:
\- For each subband in _csi-ReportingBand_ that is not the first or last
subband of a BWP, two precoding matrices are indicated by the PMI: the first
precoding matrix corresponds to the first $N_{\text{PRB}}^{\text{SB}}/2$ PRBs
of the subband and the second precoding matrix corresponds to the last
$N_{\text{PRB}}^{\text{SB}}/2$ PRBs of the subband.
\- For each subband in _csi-ReportingBand_ that is the first or last subband
of a BWP
\- If $\left( N_{\text{BWP},i}^{\text{start}}\text{\ mod\
}N_{\text{PRB}}^{\text{SB}} \right) \geq
\frac{N_{\text{PRB}}^{\text{SB}}}{2}$, one precoding matrix is indicated by
the PMI corresponding to the first subband. If $\left(
N_{\text{BWP},i}^{\text{start}}\text{\ mod\ }N_{\text{PRB}}^{\text{SB}}
\right) 
\frac{N_{\text{PRB}}^{\text{SB}}}{2}$, two precoding matrices are indicated by
the PMI corresponding to the last subband: the first precoding matrix
corresponds to the first $\frac{N_{\text{PRB}}^{\text{SB}}}{2}$ PRBs of the
last subband and the second precoding matrix corresponds to the last $1 +
\left( N_{\text{BWP},i}^{\text{start}} + N_{\text{BWP},i}^{\text{size}} - 1
\right){\text{mod\ }N}_{\text{PRB}}^{\text{SB}} -
\frac{N_{\text{PRB}}^{\text{SB}}}{2}$ PRBs of the last subband.
Table 5.2.2.2.5-1: Codebook parameter configurations for $\mathbf{L}\mathbf{,\
}$ $\mathbf{\beta}$ and $\mathbf{p}_{\mathbf{\upsilon}}$
_paramCombination-r16_ $$L$$ $$p_{\upsilon}$$ $$\beta$$
* * *
                                   $$\upsilon\  \in \left\{ 1,2 \right\}$$   $$\upsilon\  \in \left\{ 3,4 \right\}$$
1 2 ¼ 1/8 ¼ 2 2 ¼ 1/8 ½ 3 4 ¼ 1/8 ¼ 4 4 ¼ 1/8 ½ 5 4 ¼ ¼ ¾ 6 4 ½ ¼ ½ 7 6 ¼ - ½
8 6 ¼ - ¾
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-RI-Restriction-r16_. The UE shall not report
$\upsilon > 4$.
The PMI value corresponds to the codebook indices of and where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
\begin{matrix} i_{1,1} & i_{1,2} & i_{1,5} \ \end{matrix} & \begin{matrix}
i_{1,6,1} & i_{1,7,1} & i_{1,8,1} \ \end{matrix} \ \end{bmatrix} & \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\upsilon = 1 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,2} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} & i_{1,7,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} & i_{1,6,2}\text{\ \ \ \ \
}i_{1,7,2}\text{\ \ \ \ \ }i_{1,8,2} \ \end{matrix} \right\rbrack & \upsilon =
2 \ \end{matrix} \ \begin{matrix} \left\lbrack \begin{matrix} i_{1,1} &
i_{1,2} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} &
i_{1,7,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} &
i_{1,6,2}\text{\ \ \ \ \ }i_{1,7,2}\text{\ \ \ \ \ }i_{1,8,2}\text{\ \ \ \ \
}i_{1,6,3} \ \end{matrix}\text{\ \ \ \ \ }i_{1,7,3}\text{\ \ \ \ \ }i_{1,8,3}
\right\rbrack & \ \ \ \upsilon = 3 \ \left\lbrack \begin{matrix} i_{1,1} &
i_{1,2} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} &
i_{1,7,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} & i_{1,6,2} &
i_{1,7,2} \ \end{matrix}\text{\ \ \ \ \ }i_{1,8,2}\text{\ \ \ \ \
}\begin{matrix} i_{1,6,3} & i_{1,7,3} & i_{1,8,3}\text{\ \ \ \ \
}\begin{matrix} i_{1,6,4} & i_{1,7,4}\text{\ \ \ \ \ }i_{1,8,4} \ \end{matrix}
\ \end{matrix} \right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix}
\right.\ \ i_{2} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 1 \ \left\lbrack
\begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix} \right\rbrack
& \upsilon = 2 \ \end{matrix} \ \begin{matrix} \left\lbrack \begin{matrix}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \ \end{matrix} \right\rbrack & \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 3 \
\left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{2,3,4} & i_{2,4,4} & i_{2,5,4}
\ \end{matrix} \right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix}
\right.\ \ \end{matrix}$$
The precoding matrices indicated by the PMI are determined from $L +
M_{\upsilon}$ vectors.
$L$ vectors, $v_{m_{1}^{\left( i \right)},m_{2}^{(i)}},i = 0,1,\ldots,L - 1$,
are identified by the indices $q_{1},q_{2},\ n_{1}$, $n_{2}$, indicated by
$i_{1,1}$, $i_{1,2}$, obtained as in 5.2.2.2.3, where the values of $C\left(
x,y \right)$ are given in Table 5.2.2.2.5-4.
$M_{\upsilon} = \left\lceil p_{\upsilon}\frac{N_{3}}{R} \right\rceil$ vectors,
$\left\lbrack y_{0,l}^{\left( f \right)},y_{1,l}^{\left( f
\right)},\ldots,y_{N_{3} - 1,l}^{\left( f \right)} \right\rbrack^{T}$, $f =
0,1,\ldots,M_{\upsilon} - 1$, are identified by $M_{\text{initial}}$ (for
$N_{3} > 19$) and $n_{3,l}\ \left( l = 1,\ldots,\ \upsilon \right)\ $where
$$M_{\text{initial}} \in \left{ - 2M_{\upsilon} + 1, - 2M_{\upsilon} +
2,\ldots,0 \right}$$
$$n_{3,l} = \left\lbrack n_{3,l}^{(0)},\ldots,n_{3,l}^{(M_{\upsilon} - 1)}
\right\rbrack$$
$${\ n}_{3,l}^{\left( f \right)} \in \left{ 0,1,\ldots,N_{3} - 1 \right}$$
which are indicated by means of the indices $i_{1,5}$ (for $N_{3} > 19$) and
$i_{1,6,l}$ $\left( \text{for\ }M_{\upsilon} > 1\text{\ and\ }l = 1,\ldots,\
\upsilon \right)$, where
$$i_{1,5} \in \left{ 0,1,\ldots,2M_{\upsilon} - 1 \right}$$
$${\ i}_{1,6,l} \in \left{ \begin{matrix} \left{ 0,1,\ldots,\begin{pmatrix}
N_{3} - 1 \ M_{\upsilon} - 1 \ \end{pmatrix} - 1 \right} & N_{3} \leq 19 \
\left{ 0,1,\ldots,\begin{pmatrix} 2M_{\upsilon} - 1 \ M_{\upsilon} - 1 \
\end{pmatrix} - 1 \right} & N_{3} > 19 \ \end{matrix} \right.\ $$
The amplitude coefficient indicators $i_{2,3,l}$ and $i_{2,4,l}$ are
$$i_{2,3,l} = \begin{bmatrix} k_{l,0}^{\left( 1 \right)} & k_{l,1}^{\left( 1
\right)} \ \end{bmatrix}$$
$$i_{2,4,l} = \left\lbrack k_{l,0}^{(2)}\ldots k_{l,M_{\upsilon} - 1}^{(2)}
\right\rbrack$$
$$k_{l,f}^{(2)} = \left\lbrack k_{l,0,f}^{(2)}\ldots k_{l,2L - 1,f}^{(2)}
\right\rbrack$$
$$k_{l,p}^{(1)} \in \left{ 1,\ldots,15 \right}$$
$$k_{l,i,f}^{(2)} \in \left{ 0,\ldots,7 \right}$$
for $l = 1,\ldots,\upsilon$.
The phase coefficient indicator $i_{2,5,l}\ $is
$$i_{2,5,l} = \left\lbrack c_{l,0}\ldots c_{l,M_{\upsilon} - 1}
\right\rbrack$$
$$c_{l,f} = \left\lbrack c_{l,0,f}\ldots c_{l,2L - 1,f} \right\rbrack$$
$$c_{l,i,f} \in \left{ 0,\ldots,15 \right}$$
for $l = 1,\ldots,\upsilon.$
Let $K_{0} = \left\lceil \beta 2LM_{1} \right\rceil$. The bitmap whose nonzero
bits identify which coefficients in $i_{2,4,l}$ and $i_{2,5,l}\ $are reported,
is indicated by $i_{1,7,l}$
$$i_{1,7,l} = \left\lbrack k_{l,0}^{\left( 3 \right)}\ldots k_{l,M_{\upsilon}
- 1}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,f}^{\left( 3 \right)} = \left\lbrack k_{l,0,f}^{\left( 3 \right)}\ldots
k_{l,2L - 1,f}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,i,f}^{(3)} \in \left{ 0,1 \right}$$
for $l = 1,\ldots,\upsilon$, such that $K_{l}^{\text{NZ}} = \sum_{i = 0}^{2L -
1}{\sum_{f = 0}^{M_{\upsilon} - 1}k_{l,i,f}^{(3)}} \leq K_{0}$ is the number
of nonzero coefficients for layer $l = 1,\ldots,\upsilon$ and $K^{\text{NZ}} =
\sum_{l = 1}^{\upsilon}K_{l}^{\text{NZ}} \leq 2K_{0}$ is the total number of
nonzero coefficients.
The indices of $i_{2,4,l}$, $i_{2,5,l}$ and $i_{1,7,l}$ are associated to the
$M_{\upsilon}$ codebook indices in $n_{3,l}$.
The mapping from $k_{l,p}^{(1)}$ to the amplitude coefficient $p_{l,p}^{(1)}$
is given in Table 5.2.2.2.5-2 and the mapping from $k_{l,i,f}^{(2)}$ to the
amplitude coefficient $p_{l,i,f}^{(2)}$ is given in Table 5.2.2.2.5-3. The
amplitude coefficients are represented by
$$p_{l}^{\left( 1 \right)} = \begin{bmatrix} p_{l,0}^{\left( 1 \right)} &
p_{l,1}^{\left( 1 \right)} \ \end{bmatrix}$$
$$p_{l}^{(2)} = \left\lbrack p_{l,0}^{(2)}\ldots p_{l,M_{\upsilon} - 1}^{(2)}
\right\rbrack$$
$$p_{l,f}^{(2)} = \left\lbrack p_{l,0,f}^{(2)}\ldots p_{l,2L - 1,f}^{(2)}
\right\rbrack$$
for$\ l = 1,\ldots,\upsilon$.
Let $f_{l}^{_} \in \left{ 0,1,\ldots,M_{\upsilon} - 1 \right}$ be the index of
$i_{2,4,l}$ and $i_{l}^{_} \in \left{ 0,1,\ldots,2L - 1 \right}$ be the index
of $k_{l,f_{l}^{_}}^{(2)}$ which identify the strongest coefficient of layer
$l$, i.e., the element $k_{l,i_{l}^{_},f_{l}^{_}}^{(2)}$ of $i_{2,4,l}$, for
$\text{\ l} = 1,\ldots,\upsilon$. The codebook indices of $n_{3,l}$$k_{m_{i}}$
are remapped with respect to $n_{3,l}^{(f_{l}^{_})}$ as $n_{3,l}^{(f)} =
\left( n_{3,l}^{(f)} - n_{3,l}^{(f_{l}^{_})} \right)\text{mod\
}N_{3}$${\widetilde{k}}_{m_{i}^{_}} = 0$, such that $n_{3,l}^{(f_{l}^{_})} =
0$, after remapping. The index $f$ is remapped with respect to $f_{l}^{_}$ as
$f = \left( f - f_{l}^{_} \right)\text{mod\ }M_{\upsilon}$, such that the
index of the strongest coefficient is $f_{l}^{_} = 0$ ($l =
1,\ldots,\upsilon$), after remapping. The indices of $i_{2,4,l}$, $i_{2,5,l}$
and $i_{1,7,l}$ indicate amplitude coefficients, phase coefficients and bitmap
after remapping.
The strongest coefficient of layer $l$ is identified by $i_{1,8,l} \in \left{
0,1,\ldots,2L - 1 \right}$, which is obtained as follows
$i_{1,8,l} = \left{ \begin{matrix} \sum_{i = 0}^{i_{1}^{_}}k_{1,i,0}^{(3)} - 1
& \upsilon\mathbf{=}1 \ i_{l}^{_} & 1  19$, $M_{\text{initial}}$ is identified by $i_{1,5}$.
For all values of $N_{3}$, $n_{3,l}^{(0)} = 0$ for $l = 1,\ldots,\upsilon$. If
$M_{\upsilon} > 1$, the nonzero elements of $n_{3,l}$, identified by
$n_{3,l}^{(1)},\ \ldots,\ n_{3,l}^{\left( M_{\upsilon} - 1 \right)},\ $are
found from $i_{1,6,l}$ $(l = 1,\ldots,\upsilon)$, for $N_{3} \leq 19$, and
from $i_{1,6,l}$ $(l = 1,\ldots,\upsilon)$ and $M_{\text{initial}}$, for
$N_{3} > 19$, using $C\left( x,y \right)$ as defined in Table 5.2.2.2.5-4 and
the algorithm:
$s_{0} = 0$
for $f = 1,\ldots,M_{\upsilon} - 1$
Find the largest $x^{*} \in \left{ M_{\upsilon} - 1 - f,\ldots,N_{3} - 1 - f
\right}$ in Table 5.2.2.2.5-4 such that
$i_{1,6,l}\ - s_{f - 1} \geq C\left( x^{*},M_{\upsilon} - f \right)$
$e_{f} = C\left( x^{*},M_{\upsilon} - f \right)$
$s_{f} = s_{f - 1} + e_{f}$
if $N_{3} \leq 19$
$n_{3,l}^{(f)} = N_{3} - 1 - x^{*}$
else
$n_{l}^{(f)} = 2M_{\upsilon} - 1 - x^{*}$
if $n_{l}^{(f)} \leq M_{\text{initial}} + 2M_{\upsilon} - 1$
$n_{3,l}^{(f)} = n_{l}^{(f)}$
else
$n_{3,l}^{(f)} = n_{l}^{(f)} + (N_{3} - 2M_{\upsilon})$
end if
end if
Table 5.2.2.2.5-4: Combinatorial coefficients $\mathbf{C}\left(
\mathbf{x}\mathbf{,y} \right)$
       **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**
* * *
0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 2 2 1 0 0 0 0 0 0 0 3 3 3 1 0 0 0 0 0
0 4 4 6 4 1 0 0 0 0 0 5 5 10 10 5 1 0 0 0 0 6 6 15 20 15 6 1 0 0 0 7 7 21 35
35 21 7 1 0 0 8 8 28 56 70 56 28 8 1 0 9 9 36 84 126 126 84 36 9 1 10 10 45
120 210 252 210 120 45 10 11 11 55 165 330 462 462 330 165 55 12 12 66 220 495
792 924 792 495 220 13 13 78 286 715 1287 1716 1716 1287 715 14 14 91 364 1001
2002 3003 3432 3003 2002 15 15 105 455 1365 3003 5005 6435 6435 5005 16 16 120
560 1820 4368 8008 11440 12870 11440 17 17 136 680 2380 6188 12376 19448 24310
24310 18 18 153 816 3060 8568 18564 31824 43758 48620
When $n_{3,l}$ and $M_{\text{initial}}$ are known, $i_{1,5}\ $and $i_{1,6,l}\
(l = 1,\ldots,\upsilon)$ are found as follows:
\- If $N_{3} \leq 19$, $i_{1,5} = 0$ and is not reported. If $M_{\nu} = 1$,
$i_{1,6,l} = 0$, for $l = 1,\ldots,\nu$, and is not reported. If $M_{\nu} >
1$, $i_{1,6,l} = \sum_{f = 1}^{M_{\upsilon} - 1}{C\left( N_{3} - 1 -
n_{3,l}^{\left( f \right)},M_{\upsilon} - f \right)}$, where $C\left( x,y
\right)$ is given in Table 5.2.2.2.5-4 and where the indices $f =
1,\ldots,M_{\upsilon} - 1$ are assigned such that $n_{3,l}^{(f)}$ increases as
$f$ increases.
\- If $N_{3} > 19$, $M_{\text{initial}}$ is indicated by $i_{1,5}$, which is
reported and given by
$i_{1,5} = \left{ \begin{matrix} M_{\text{initial}} & M_{\text{initial}} = 0\
\ M_{\text{initial}} + 2M_{\upsilon} & M_{\text{initial}}  M_{\text{initial}} + N_{3} - \ 1 \ \end{matrix} \right.\ ,$
then $i_{1,6,l} = \sum_{f = 1}^{M_{\upsilon} - 1}{C\left( 2M_{\upsilon} - 1 -
n_{l}^{\left( f \right)},M_{\upsilon} - f \right)}$, where $C\left( x,y
\right)$ is given in Table 5.2.2.2.5-4.
The codebooks for 1-4 layers are given in Table 5.2.2.2.5-5, where
$m_{1}^{(i)}$, $m_{2}^{(i)}$, for $i = 0,1,\ldots,L - 1,$ $v_{m_{1}^{\left( i
\right)},m_{2}^{(i)}}\ $ are obtained as in clause 5.2.2.2.3, and the
quantities $\varphi_{l,i,f}$ and $y_{t,l}\ $are given by
$$\varphi_{l,i,f} = \ e^{j\frac{2\pi c_{l,i,f}}{16}}$$
$$y_{t,l} = \left\lbrack y_{t,l}^{(0)}\text{\ \ \ \ }y_{t,l}^{(1)}\ \ \
\ldots\ \ \ \ y_{t,l}^{(M_{\upsilon} - 1)} \right\rbrack$$
where $t = \left{ 0,1,\ldots,N_{3} - 1 \right}$, is the index associated with
the precoding matrix, $l = \left{ 1,\ldots,\ \upsilon \right}$, and with
${y_{t,l}^{(f)} = e}^{j\frac{2\pi tn_{3,l}^{(f)}}{N_{3}}}\text{\ \ \ }$
for$\ f = 0,1,\ldots,M_{\upsilon} - 1$.
Table 5.2.2.2.5-5: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI
reporting using antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+----------------------------------+----------------------------------+ | **Layers** | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | $$ | $ | | {\upsilon = 1}$$ | $W_{q_{1},q_{2},\ n_{1},\ n_{2}, | | | n_{3,1},p_{1}^{(1)},p_{1}^{\left | | | ( 2 \right)},i_{2,5,1},t}^{(1)} | | | = W_{q_{1},q_{2},\ n_{1},\ n_{2} | | | ,n_{3,1},p_{1}^{(1)},p_{1}^{\lef | | | t( 2 \right)},i_{2,5,1},t}^{1}$$ | +----------------------------------+----------------------------------+ | $$ | $$W_{q_{1},q_{ | | {\upsilon = 2}$$ | 2},\ n_{1},\ n_{2},n_{3,1},p_{1} | | | ^{(1)},p_{1}^{\left( 2 \right)}, | | | i_{2,5,1},\ n_{3,2},p_{2}^{(1)}, | | | p_{2}^{\left( 2 \right)},i_{2,5, | | | 2},t}^{(2)} = \frac{1}{\sqrt{2}} | | | \left\lbrack W_{q_{1},q_{2},\ n_ | | | {1},\ n_{2},n_{3,1},p_{1}^{(1)}, | | | p_{1}^{\left( 2 \right)},i_{2,5, | | | 1},t}^{1}\text{\ \ }W_{q_{1},q_{ | | | 2},\ n_{1},\ n_{2},n_{3,2},p_{2} | | | ^{(1)},p_{2}^{\left( 2 \right)}, | | | i_{2,5,2},t}^{2} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 3$$ | $$W_{q_{1} | | | ,q_{2},\ n_{1},\ n_{2},n_{3,1},p | | | _{1}^{(1)},p_{1}^{\left( 2 \righ | | | t)},i_{2,5,1},n_{3,2},p_{2}^{(1) | | | },p_{2}^{\left( 2 \right)},i_{2, | | | 5,2},n_{3,3},p_{3}^{(1)},p_{3}^{ | | | \left( 2 \right)},i_{2,5,3},t}^{ | | | (3)} = \frac{1}{\sqrt{3}}\left\l | | | brack W_{q_{1},q_{2},\ n_{1},\ n | | | _{2},n_{3,1},p_{1}^{(1)},p_{1}^{ | | | \left( 2 \right)},i_{2,5,1},t}^{ | | | 1}\text{\ \ }W_{q_{1},q_{2},\ n_ | | | {1},\ n_{2},n_{3,2},p_{2}^{(1)}, | | | p_{2}^{\left( 2 \right)},i_{2,5, | | | 2},t}^{2}\text{\ \ }W_{q_{1},q_{ | | | 2},\ n_{1},\ n_{2},n_{3,3},p_{3} | | | ^{(1)},p_{3}^{\left( 2 \right)}, | | | i_{2,5,3},t}^{3} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 4$$ | $$W | | | _{q_{1},q_{2},\ n_{1},\ n_{2},n_ | | | {3,1},p_{1}^{(1)},p_{1}^{\left( | | | 2 \right)},i_{2,5,1},n_{3,2},p_{ | | | 2}^{(1)},p_{2}^{\left( 2 \right) | | | },i_{2,5,2},n_{3,3},p_{3}^{(1)}, | | | p_{3}^{\left( 2 \right)},i_{2,5, | | | 3},{n_{3,4},p}_{4}^{(1)},p_{4}^{ | | | \left( 2 \right)},i_{2,5,4},t}^{ | | | (4)} = \frac{1}{2}\left\lbrack W | | | _{q_{1},q_{2},\ n_{1},\ n_{2},n_ | | | {3,1},p_{1}^{(1)},p_{1}^{\left( | | | 2 \right)},i_{2,5,1},t}^{1}\text | | | {\ \ }W_{q_{1},q_{2},\ n_{1},\ n | | | _{2},n_{3,2},p_{2}^{(1)},p_{2}^{ | | | \left( 2 \right)},i_{2,5,2},t}^{ | | | 2}\text{\ \ }W_{q_{1},q_{2},\ n_ | | | {1},\ n_{2},n_{3,3},p_{3}^{(1)}, | | | p_{3}^{\left( 2 \right)},i_{2,5, | | | 3},t}^{3}\text{\ \ }W_{q_{1},q_{ | | | 2},\ n_{1},\ n_{2},n_{3,4},p_{4} | | | ^{(1)},p_{4}^{\left( 2 \right)}, | | | i_{2,5,4},t}^{4} \right\rbrack$$ | +----------------------------------+----------------------------------+ | Where | | | $W_{q_{1},q_{2},\ n_{1 | | | },\ n_{2},n_{3,l},p_{l}^{(1)},p_ | | | {l}^{\left( 2 \right)},i_{2,5,l} | | | ,t}^{l} = \frac{1}{\sqrt{N_{1}N_ | | | {2}\gamma_{t,l}}}\begin{bmatrix} | | | \sum_{i = 0}^{L - 1}{v_{m_ | | | {1}^{\left( i \right)},m_{2}^{(i | | | )}}p_{l,0}^{(1)}\sum_{f = 0}^{M_ | | | {\upsilon} - 1}{y_{t,l}^{(f)}p_{ | | | l,i,f}^{(2)}\varphi_{l,i,f}}} \ | | | \s | | | um_{i = 0}^{L - 1}{v_{m_{1}^{\le | | | ft( i \right)},m_{2}^{(i)}}p_{l, | | | 1}^{(1)}\sum_{f = 0}^{M_{\upsilo | | | n} - 1}{y_{t,l}^{(f)}p_{l,i + L, | | | f}^{(2)}\varphi_{l,i + L,f}}} \ | | | \end{bmatrix},\ l = 1,2,3,4,$ | | | | | | $$\gamma_{t,l} = {\sum_{i = 0 | | | }^{2L - 1}{\left( p_{l,\left\lfl | | | oor \frac{i}{L} \right\rfloor}^{ | | | \left( 1 \right)} \right)^{2}\le | | | ft| \sum_{f = 0}^{M_{\upsilon} - | | | 1}{y_{t,l}^{(f)}p_{l,i,f}^{(2)} | | | \varphi_{l,i,f}} \right|}}^{2}$$ | | | | | | and the mappings from $i_{1}$ to | | | $q_{1}$, $q_{2}$, $n_{1}$, | | | $n_{2}$, $n_{3,1}$, $n_{3,2}$, | | | $n_{3,3}$, $n_{3,4}$, and from | | | $i_{2}$ to $i_{2,5,1}$, | | | $i_{2,5,2}$, | | | $i_{2,5,3}$,$\ i_{2,5,4},$ | | | $p_{1}^{(1)}$, $p_{2}^{(1)}$, | | | $p_{3}^{(1)}$and | | | $p_{4}^{(1)},\ \ p_{1}^{(2)}$, | | | $p_{2}^{(2)}$, $p_{3}^{(2)}$ and | | | $p_{4}^{(2)}$ are as described | | | above, including the ranges of | | | the constituent indices of | | | $i_{1}$ and $i_{2}$. | | +----------------------------------+----------------------------------+
For coefficients with $k_{l,i,f}^{(3)} = 0$, amplitude and phase are set to
zero, i.e., $p_{l,i,f}^{(2)} = 0$ and $\varphi_{l,i,f} = 0$.
The bitmap parameter _typeII-RI‑Restriction-r16_ forms the bit sequence
$r_{3},r_{2},r_{1},r_{0}$ where $r_{0}$ is the LSB and $r_{3}$ is the MSB.
When $r_{i}$ is zero, $i \in \left{ 0,1,\ldots,3 \right}$, PMI and RI
reporting are not allowed to correspond to any precoder associated with
$\upsilon = i + 1$ layers.
The bitmap parameter _n1-n2‑codebookSubsetRestriction-r16_ forms the bit
sequence $B = B_{1}B_{2}$ and configures the vector group indices $g^{(k)}$ as
in clause 5.2.2.2.3. Bits $b_{2}^{\left( k,{2(N}_{1}x_{2} + x_{1} \right) +
1)}b_{2}^{\left( k,{2(N}_{1}x_{2} + x_{1} \right))}$ indicate the maximum
allowed average amplitude, $\gamma_{i + pL}$ ($p = 0,1$), with $i \in {
0,1,\ldots,L - 1}$, of the coefficients associated with the vector in group
$g^{(k)}$ indexed by $x_{1},x_{2}$, where the maximum amplitudes are given in
Table 5.2.2.2.5-6 and the average coefficient amplitude is restricted as
follows
$\sqrt{\frac{1}{\sum_{f = 0}^{M_{\upsilon} - 1}k_{l,i +
\text{pL},f}^{(3)}}\sum_{f = 0}^{M_{\upsilon} - 1}{k_{l,i +
\text{pL},f}^{(3)}\left( p_{l,p}^{\left( 1 \right)}p_{l,i +
\text{pL},f}^{\left( 2 \right)} \right)^{2}}} \leq \gamma_{i + \text{pL}}$
for $l = 1,\ldots,\upsilon$, and $p = 0,1$. A UE that does not report the
parameter _amplitudeSubsetRestriction-r16_ = \'supported\' in its capability
signaling is not expected to be configured with $b_{2}^{\left(
k,{2(N}_{1}x_{2} + x_{1} \right) + 1)}b_{2}^{\left( k,{2(N}_{1}x_{2} + x_{1}
\right))} = 01$ or $10$.
Table 5.2.2.2.5-6: Maximum allowed average coefficient amplitudes for
restricted vectors
+----------------------------------+----------------------------------+ | Bit | Maximum | | | | | $$\ma | Average Coefficient Amplitude | | thbf{b}_{\mathbf{2}}^{\left( \ma | $\mathbf{\gamma}_{\mathbf{ | | thbf{k,}\mathbf{2(N}_{\mathbf{1} | i}\mathbf{+}\mathbf{\text{pL}}}$ | | }\mathbf{x}_{\mathbf{2}}\mathbf{ | | | +}\mathbf{x}_{\mathbf{1}} \right | | | )\mathbf{+ 1)}}\mathbf{b}_{\math | | | bf{2}}^{\left( \mathbf{k,}\mathb | | | f{2(N}_{\mathbf{1}}\mathbf{x}_{\ | | | mathbf{2}}\mathbf{+}\mathbf{x}_{ | | | \mathbf{1}} \right)\mathbf{)}}$$ | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | 00 | 0 | +----------------------------------+----------------------------------+ | 01 | $$\sqrt{1/4}$$ | +----------------------------------+----------------------------------+ | 10 | $$\sqrt{1/2}$$ | +----------------------------------+----------------------------------+ | 11 | 1 | +----------------------------------+----------------------------------+
##### 5.2.2.2.6 Enhanced Type II Port Selection Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and the UE configured with higher layer parameter
_codebookType_ set to \' typeII-PortSelection-r16 \'
\- The number of CSI-RS ports is configured as in Clause 5.2.2.2.4
\- The value of $d$ is configured with the higher layer parameter
_portSelectionSamplingSize-r16_ , where $d \in \left{ 1,2,3,4 \right}$ and $d
\leq L$.
\- The values $L$, $\beta$ and $p_{\upsilon}$ are configured as in Clause
5.2.2.2.5, where the supported configurations are given in Table 5.2.2.2.6-1.
Table 5.2.2.2.6-1: Codebook parameter configurations for $\mathbf{L}$,
$\mathbf{\beta}$ and$\mathbf{p}_{\mathbf{\upsilon}}$
_paramCombination-r16_ $$L$$ $$p_{\upsilon}$$ $$\beta$$
* * *
                                   $$\upsilon\  \in \left\{ 1,2 \right\}$$   $$\upsilon\  \in \left\{ 3,4 \right\}$$
1 2 ¼ 1/8 ¼ 2 2 ¼ 1/8 ½ 3 4 ¼ 1/8 ¼ 4 4 ¼ 1/8 ½ 5 4 ¼ ¼ ¾ 6 4 ½ ¼ ½
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-PortSelectionRI-Restriction-r16_. The UE shall
not report $\upsilon > 4$.
\- The value of $R$ is configured as in Clause 5.2.2.2.5.
The UE is also configured with the higher layer bitmap parameter _typeII-
PortSelectionRI-Restriction-r16_ , which forms the bit sequence
$r_{3},r_{2},r_{1},r_{0}$, where $r_{0}\ $is the LSB and $r_{3}$ is the MSB.
When $r_{i}$ is zero, $i \in \left{ 0,1,\ldots,\ 3 \right}$, PMI and RI
reporting are not allowed to correspond to any precoder associated with
$\upsilon = i + 1$ layers.
The PMI value corresponds to the codebook indices $i_{1}$ and $i_{2}$ where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
i_{1,1}\text{\ \ \ \ \ }i_{1,5} & \begin{matrix} i_{1,6,1} & i_{1,7,1} &
i_{1,8,1} \ \end{matrix} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\upsilon = 1 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,5} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,1} & i_{1,7,1} & i_{1,8,1}
\ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,6,2} & i_{1,7,2}\text{\ \ \ \
\ }i_{1,8,2} \ \end{matrix} \right\rbrack & \ \upsilon = 2 \ \end{matrix} \
\begin{matrix} \left\lbrack \begin{matrix} i_{1,1} & i_{1,5} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,1} & i_{1,7,1} & i_{1,8,1}
\ \end{matrix}\text{\ \ \ }\begin{matrix} i_{1,6,2} & i_{1,7,2}\text{\ \ \ \ \
}i_{1,8,2}\text{\ \ \ \ \ }i_{1,6,3} \ \end{matrix}\text{\ \ \ \ \
}i_{1,7,3}\text{\ \ \ \ \ }i_{1,8,3} \right\rbrack & \ \ \ \ \ \ \ \ \ \ \
\upsilon = 3 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,5} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,1} & i_{1,7,1} & i_{1,8,1}
\ \end{matrix}\text{\ \ \ }\begin{matrix} i_{1,6,2} & i_{1,7,2} & i_{1,8,2} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,3} & \ i_{1,7,3} & \
i_{1,8,3}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,4} & i_{1,7,4}\text{\ \ \ \ \
}i_{1,8,4} \ \end{matrix} \ \end{matrix} \right\rbrack & \upsilon = 4 \
\end{matrix} \ \end{matrix} \right.\ \ i_{2} = \left{ \begin{matrix}
\begin{matrix} \begin{bmatrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \upsilon = 1 \ \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} &
i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} &
i_{2,5,2} \ \end{matrix} \right\rbrack & \upsilon = 2 \ \end{matrix} \
\begin{matrix} \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix} \right\rbrack & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \upsilon = 3 \ \left\lbrack \begin{matrix} i_{2,3,1} &
i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} &
i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} &
i_{2,4,3} & i_{2,5,3} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{2,3,4}
& i_{2,4,4} & i_{2,5,4} \ \end{matrix} \right\rbrack & \upsilon = 4 \
\end{matrix} \ \end{matrix} \right.\ \ \end{matrix}$$
The $2L$ antenna ports are selected by the index $i_{1,1}$ as in clause
5.2.2.2.4.
Parameters $N_{3},\ M_{\upsilon}$, $M_{\text{initial}}$ (for $N_{3} > 19$) and
$K_{0}$ are defined as in clause 5.2.2.2.5.
For layer $l$, $l = 1,\ldots,\upsilon$, the strongest coefficient $i_{1,8,l},$
the amplitude coefficient indicators $i_{2,3,l}$ and $i_{2,4,l}$, the phase
coefficient indicator $i_{2,5,l}$ and the bitmap indicator $i_{1,7,l}$ are
defined and indicated as in clause 5.2.2.2.5, where the mapping from
$k_{l,p}^{(1)}$ to the amplitude coefficient $p_{l,p}^{(1)}$ is given in Table
5.2.2.2.5-2 and the mapping from $k_{l,i,f}^{(2)}$ to the amplitude
coefficient $p_{l,i,f}^{(2)}$ is given in Table 5.2.2.2.5-3.
The number of nonzero coefficients for layer $l$, $K_{l}^{\text{NZ}}$, and the
total number of nonzero coefficients $K^{\text{NZ}}$ are defined as in Clause
5.2.2.2.5.
The amplitude coefficients $p_{l}^{(1)}$ and $p_{l}^{(2)}$ $\left( l =
1,\ldots,\upsilon\ \right)$ are represented as in clause 5.2.2.2.5.
The amplitude and phase coefficient indicators are reported as in clause
5.2.2.2.5.
Codebook indicators $i_{1,5}\ $and $i_{1,6,l}\ (l = 1,\ldots,\upsilon)$ are
found as in clause 5.2.2.2.5.
The codebooks for 1-4 layers are given in Table 5.2.2.2.6-2, where $v_{m}$ is
a $P_{CSI - RS}/2\ $-element column vector containing a value of 1 in element
$\left( \text{m\ }\text{mod}\ P_{CSI - RS}/2\ \right)$ and zeros elsewhere
(where the first element is element 0), and the quantities $\varphi_{l,i,f}$
and $y_{t,l}\ \ $are defined as in clause 5.2.2.2.5.
Table 5.2.2.2.6-2: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI
reporting using antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+----------------------------------+----------------------------------+ | **Layers** | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | $$ | $$W_{i_{1,1},n_{3,1},p_{1 | | {\upsilon = 1}$$ | }^{(1)},p_{1}^{\left( 2 \right)} | | | ,i_{2,5,1},t}^{(1)} = W_{i_{1,1} | | | ,n_{3,1},p_{1}^{(1)},p_{1}^{\lef | | | t( 2 \right)},i_{2,5,1},t}^{1}$$ | +----------------------------------+----------------------------------+ | $$ | $$W_{i_{1,1},n_{3, | | {\upsilon = 2}$$ | 1},p_{1}^{(1)},p_{1}^{\left( 2 \ | | | right)},i_{2,5,1},\ n_{3,2},p_{2 | | | }^{(1)},p_{2}^{\left( 2 \right)} | | | ,i_{2,5,2},t}^{(2)} = \frac{1}{\ | | | sqrt{2}}\left\lbrack W_{i_{1,1}, | | | n_{3,1},p_{1}^{(1)},p_{1}^{\left | | | ( 2 \right)},i_{2,5,1},t}^{1}\te | | | xt{\ \ }W_{i_{1,1},n_{3,2},p_{2} | | | ^{(1)},p_{2}^{\left( 2 \right)}, | | | i_{2,5,2},t}^{2} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 3$$ | $$W_{i_{1,1},n_{3,1},p_{1} | | | ^{(1)},p_{1}^{\left( 2 \right)}, | | | i_{2,5,1},n_{3,2},p_{2}^{(1)},p_ | | | {2}^{\left( 2 \right)},i_{2,5,2} | | | ,n_{3,3},p_{3}^{(1)},p_{3}^{\lef | | | t( 2 \right)},i_{2,5,3},t}^{(3)} | | | = \frac{1}{\sqrt{3}}\left\lbrac | | | k W_{i_{1,1},n_{3,1},p_{1}^{(1)} | | | ,p_{1}^{\left( 2 \right)},i_{2,5 | | | ,1},t}^{1}\text{\ \ }W_{i_{1,1}, | | | n_{3,2},p_{2}^{(1)},p_{2}^{\left | | | ( 2 \right)},i_{2,5,2},t}^{2}\te | | | xt{\ \ }W_{i_{1,1},n_{3,3},p_{3} | | | ^{(1)},p_{3}^{\left( 2 \right)}, | | | i_{2,5,3},t}^{3} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 4$$ | $$W_{i_{1,1},n_{3,1},p_{1}^{(1) | | | },p_{1}^{\left( 2 \right)},i_{2, | | | 5,1},n_{3,2},p_{2}^{(1)},p_{2}^{ | | | \left( 2 \right)},i_{2,5,2},n_{3 | | | ,3},p_{3}^{(1)},p_{3}^{\left( 2 | | | \right)},i_{2,5,3},{n_{3,4},p}_{ | | | 4}^{(1)},p_{4}^{\left( 2 \right) | | | },i_{2,5,4},t}^{(4)} = \frac{1}{ | | | 2}\left\lbrack W_{i_{1,1},n_{3,1 | | | },p_{1}^{(1)},p_{1}^{\left( 2 \r | | | ight)},i_{2,5,1},t}^{1}\text{\ \ | | | }W_{i_{1,1},n_{3,2},p_{2}^{(1)} | | | ,p_{2}^{\left( 2 \right)},i_{2,5 | | | ,2},t}^{2}\text{\ \ }W_{i_{1,1}, | | | n_{3,3},p_{3}^{(1)},p_{3}^{\left | | | ( 2 \right)},i_{2,5,3},t}^{3}\te | | | xt{\ \ }W_{i_{1,1},n_{3,4},p_{4} | | | ^{(1)},p_{4}^{\left( 2 \right)}, | | | i_{2,5,4},t}^{4} \right\rbrack$$ | +----------------------------------+----------------------------------+ | Where | | | $W_{i_{1,1},n_{3,l},p_{l | | | }^{(1)},p_{l}^{\left( 2 \right)} | | | ,i_{2,5,l},t}^{l} = \frac{1}{\sq | | | rt{\gamma_{t,l}}}\begin{bmatrix} | | | \s | | | um_{i = 0}^{L - 1}{v_{i_{1,1}d + | | | i}p_{l,0}^{(1)}\sum_{f = 0}^{M_ | | | {\upsilon} - 1}{y_{t,l}^{(f)}p_{ | | | l,i,f}^{(2)}\varphi_{l,i,f}}} \ | | | \sum_{i = | | | 0}^{L - 1}{v_{i_{1,1}d + i}p_{l, | | | 1}^{(1)}\sum_{f = 0}^{M_{\upsilo | | | n} - 1}{y_{t,l}^{(f)}p_{l,i + L, | | | f}^{(2)}\varphi_{l,i + L,f}}} \ | | | \end{bmatrix},\ \ l = 1,2,3,4$, | | | | | | $$\gamma_{t,l} = {\sum_{i = 0 | | | }^{2L - 1}{\left( p_{l,\left\lfl | | | oor \frac{i}{L} \right\rfloor}^{ | | | \left( 1 \right)} \right)^{2}\le | | | ft| \sum_{f = 0}^{M_{\upsilon} - | | | 1}{y_{t,l}^{(f)}p_{l,i,f}^{(2)} | | | \varphi_{l,i,f}} \right|}}^{2}$$ | | | | | | and the mappings from $i_{1}$ | | | to$\ i_{1,1}$, $n_{3,1}$, | | | $n_{3,2}$, $n_{3,3}$, $n_{3,4}$, | | | and from $i_{2}$ to $i_{2,5,1}$, | | | $i_{2,5,2}$, | | | $i_{2,5,3}$,$\ i_{2,5,4},$ | | | $p_{1}^{(1)}$, $p_{2}^{(1)}$, | | | $p_{3}^{(1)}$and $p_{4}^{(1)}$, | | | $\ p_{1}^{(2)}$, $p_{2}^{(2)}$, | | | $p_{3}^{(2)}$ and $p_{4}^{(2)}$ | | | are as described above, | | | including the ranges of the | | | constituent indices of $i_{1}$ | | | and $i_{2}$. | | +----------------------------------+----------------------------------+
For coefficients with $k_{l,i,f}^{(3)} = 0$, amplitude and phase are set to
zero, i.e., $p_{l,i,f}^{(2)} = 0$ and $\varphi_{l,i,f} = 0$.
##### 5.2.2.2.7 Further enhanced Type II port selection codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and the UE configured with higher layer parameter
_codebookType_ set to \' typeII-PortSelection-r17 \'
\- The number of CSI-RS ports, $P_{CSI - RS}$, is configured as in clause
5.2.2.2.4.
\- The values $\alpha$, $M$ and $\beta$ are determined by the higher layer
parameter _paramCombination-r17_ , where the mapping is given in Table
5.2.2.2.7-1.
\- The UE is not expected to be configured with _paramCombination-r17_ equal
to
\- 1 or 6 when $P_{\text{CSI} - \text{RS}} \in { 4,12}$,
\- 7 or 8 when $P_{\text{CSI} - \text{RS}} = 32$,
\- 5 when $P_{\text{CSI} - \text{RS}} = 4$ and higher layer parameter t
_ypeII-PortSelectionRI-Restriction-r17_ is configured with $r_{i} = 1$ for any
$i > 1$.
Table 5.2.2.2.7-1: Codebook parameter configurations for $\mathbf{\alpha}$,
$\mathbf{M}$ and $\mathbf{\beta}$
_paramCombination-r17_ $$M$$ $$\alpha$$ $$\beta$$
* * *
1 1 ¾ ½ 2 1 1 ½ 3 1 1 ¾ 4 1 1 1 5 2 ½ ½ 6 2 ¾ ½ 7 2 1 ½ 8 2 1 ¾
\- The parameter $N \in { 2,4}$ is configured with the higher-layer parameter
_valueOfN_ , when $M = 2$.
\- The parameter $R \in { 1,2}$ is configured with the higher-layer parameter
_numberOfPMI-SubbandsPerCQI-Subband-r17_ , when $M = 2$, and $R = 1$ when $M =
1$, where $R$ is defined as in clause 5.2.2.2.5.
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-PortSelectionRI-Restriction-r17_. The UE shall
not report $\upsilon > 4$. The bitmap parameter _typeII-PortSelectionRI-
Restriction-r17_ forms the bit sequence $r_{3},r_{2},r_{1},r_{0}$, where
$r_{0}\ $is the LSB and $r_{3}$ is the MSB. When $r_{i}$ is zero, $i \in
\left{ 0,1,\ldots,\ 3 \right}$, PMI and RI reporting are not allowed to
correspond to any precoder associated with $\upsilon = i + 1$ layers.
The PMI value corresponds to the codebook indices $i_{1}$ and $i_{2}$ where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
i_{1,2} & \begin{matrix} i_{1,6} & i_{1,7,1} & i_{1,8,1} \ \end{matrix} \
\end{bmatrix} & \upsilon = 1 \ \begin{bmatrix} i_{1,2} & i_{1,6} & i_{1,7,1} &
i_{1,8,1} & i_{1,7,2} & i_{1,8,2} \ \end{bmatrix} & \upsilon = 2 \
\end{matrix} \ \begin{matrix} \begin{bmatrix} i_{1,2} & i_{1,6} & i_{1,7,1} &
i_{1,8,1} & i_{1,7,2} & i_{1,8,2} & i_{1,7,3} & i_{1,8,3} \ \end{bmatrix} &
\upsilon = 3 \ \begin{bmatrix} i_{1,2} & i_{1,6} & i_{1,7,1} & i_{1,8,1} &
i_{1,7,2} & i_{1,8,2} & i_{1,7,3} & i_{1,8,3} & i_{1,7,4} & i_{1,8,4} \
\end{bmatrix} & \upsilon = 4 \ \end{matrix} \ \end{matrix} \right.\ \ i_{2} =
\left{ \begin{matrix} \begin{matrix} \begin{bmatrix} i_{2,3,1} & i_{2,4,1} &
i_{2,5,1} \ \end{bmatrix} & \upsilon = 1 \ \left\lbrack \begin{matrix}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix} \right\rbrack & \upsilon = 2
\ \end{matrix} \ \begin{matrix} \left\lbrack \begin{matrix} i_{2,3,1} &
i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} &
i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} &
i_{2,4,3} & i_{2,5,3} \ \end{matrix} \right\rbrack & \upsilon = 3 \
\left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{2,3,4} & i_{2,4,4} & i_{2,5,4}
\ \end{matrix} \right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix}
\right.\ \ \end{matrix}$$
The precoding matrices indicated by the PMI are determined from $L + M$
vectors, where $L = K_{1}/2$ and $K_{1} = \alpha P_{CSI - RS}$.
$K_{1}$ ports are selected from $P_{CSI - RS}$ ports based on $L$ vectors,
$v_{m^{(i)}},i = 0,1,\ldots,L - 1$, which are identified by
$$m = \lbrack m^{\left( 0 \right)}\ldots m^{(L - 1)}\rbrack$$
$$m^{(i)} \in \left{ 0,1,\ldots,\frac{P_{CSI - RS}}{2} - 1 \right}$$
which are indicated by the index $i_{1,2}$, where
$$i_{1,2} \in \left{ 0,1,\ldots,\begin{pmatrix} P_{CSI - RS}/2 \ L \
\end{pmatrix} - 1 \right}.$$
The elements of $m$ are found from $i_{1,2}$ using $C\left( x,y \right)$ as
defined in Tables 5.2.2.2.5-4 and 5.2.2.2.7-2 and the algorithm:
$s_{- 1} = 0$
for $i = 0,\ldots,L - 1$
> Find the largest $x^{_} \in \left{ L - 1 - i,\ldots,\frac{P_{CSI - RS}}{2} -
> 1 - i \right}$ in Table 5.2.2.2.5-4, if $L - i \leq 9$, or in Table
> 5.2.2.2.7-2, if $L - i > 9$, such that $i_{1,2}\ - s_{i - 1} \geq C\left(
> x^{_},L - i \right)$
$e_{i} = C\left( x^{*},L - i \right)$
$s_{i} = s_{i - 1} + e_{i}$
$m^{(i)} = \frac{P_{CSI - RS}}{2} - 1 - x^{*}.$
When $m^{(i)}$ are known, $i_{1,2}$ is found using $i_{1,2} = \sum_{i = 0}^{L
- 1}{C\left( \frac{P_{CSI - RS}}{2} - 1 - m^{(i)},L - i \right)}$, where
$C\left( x,y \right)$ is given in Tables 5.2.2.2.5-4 and 5.2.2.2.7-2, and
where the indices $i = 0,\ldots,L - 1$ are assigned such that $m^{(i)}$
increases as $i$ increases.
\- If $\alpha = 1$, $m^{(i)} = i$, $i = 0,1,\ldots,\frac{P_{\text{CSI} -
\text{RS}}}{2} - 1$, and $i_{1,2}$ is not reported.
Table 5.2.2.2.7-2: Combinatorial coefficients $\mathbf{C}\left(
\mathbf{x}\mathbf{,y} \right)$
+--------+--------+--------+--------+ | $$y$$ | **10** | **11** | **12** | | | | | | | $$x$$ | | | | +========+========+========+========+ | **0** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **1** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **2** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **3** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **4** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **5** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **6** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **7** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **8** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **9** | 0 | 0 | 0 | +--------+--------+--------+--------+ | **10** | 1 | 0 | 0 | +--------+--------+--------+--------+ | **11** | 11 | 1 | 0 | +--------+--------+--------+--------+ | **12** | 66 | 12 | 1 | +--------+--------+--------+--------+ | **13** | 286 | 78 | 13 | +--------+--------+--------+--------+ | **14** | 1001 | 364 | 91 | +--------+--------+--------+--------+ | **15** | 3003 | 1365 | 455 | +--------+--------+--------+--------+
$M$ vectors, $\left\lbrack y_{0}^{\left( f \right)},y_{1}^{\left( f
\right)},\ldots,y_{N_{3} - 1}^{\left( f \right)} \right\rbrack^{T}$, $f \in {
0,\ldots,M - 1}$, are identified by $n_{3}$, where $N_{3}$ is defined as in
clause 5.2.2.2.5, and where
$$n_{3} = \left\lbrack n_{3}^{\left( 0 \right)}\ldots\ n_{3}^{\left( M - 1
\right)} \right\rbrack$$
$$n_{3}^{(f)} \in \left{ \begin{matrix} { 0} & M = 1 \ \left{
0,1,\ldots,min(N,N_{3}) - 1 \right} & M = 2 \ \end{matrix} \right.\ .$$
with the indices $f \in { 0,\ldots,M - 1}$ assigned such that $n_{3}^{(f)}$
increases with $f$. $n_{3}$ is indicated by the index $i_{1,6}$, when $M = 2$
and $N = 4$, where
$$i_{1,6} \in \left{ 0,1,2 \right}.$$
\- If $M = 1$, or $M = 2$ and $N = 2$, $i_{1,6}$ is not reported.
\- If $M = 2$ and $N = 4$, the nonzero offset between $n_{3}^{(0)}$ and
$n_{3}^{(1)}$ is reported with $i_{1,6}$ assuming that $n_{3}^{(0)}$
(reference for the offset) is 0. The nonzero offset values are mapped to the
index values of $i_{1,6}$ in increasing order with offset value 1 mapped to
index value \'0\'.
The amplitude coefficient indicators $i_{2,3,l}$ and $i_{2,4,l}$, for $l =
1,\ldots,\upsilon$, are
$$i_{2,3,l} = \begin{bmatrix} k_{l,0}^{\left( 1 \right)} & k_{l,1}^{\left( 1
\right)} \ \end{bmatrix}$$
$$i_{2,4,l} = \left\lbrack k_{l,0}^{(2)}\ldots k_{l,M - 1}^{(2)}
\right\rbrack$$
$$k_{l,f}^{(2)} = \left\lbrack k_{l,0,f}^{(2)}\ldots k_{l,K_{1} - 1,f}^{(2)}
\right\rbrack$$
$$k_{l,p}^{(1)} \in \left{ 1,\ldots,15 \right}$$
$$k_{l,i,f}^{(2)} \in \left{ 0,\ldots,7 \right}.$$
The phase coefficient indicator $i_{2,5,l}$, for $l = 1,\ldots,\nu$, is
$$i_{2,5,l} = \left\lbrack c_{l,0}\ldots c_{l,M - 1} \right\rbrack$$
$$c_{l,f} = \left\lbrack c_{l,0,f}\ldots c_{l,K_{1} - 1,f} \right\rbrack$$
$$c_{l,i,f} \in \left{ 0,\ldots,15 \right}.$$
Let $K_{0} = \left\lceil \beta K_{1}M \right\rceil$. The bitmap whose nonzero
bits identify which coefficients in $i_{2,4,l}$ and $i_{2,5,l}\ $are reported,
is indicated by $i_{1,7,l}$, for $l = 1,\ldots,\nu$
$$i_{1,7,l} = \left\lbrack k_{l,0}^{\left( 3 \right)}\ldots k_{l,M -
1}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,f}^{\left( 3 \right)} = \left\lbrack k_{l,0,f}^{\left( 3 \right)}\ldots
k_{l,K_{1} - 1,f}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,i,f}^{(3)} \in \left{ 0,1 \right}$$
such that $K_{l}^{\text{NZ}} = \sum_{i = 0}^{K_{1} - 1}{\sum_{f = 0}^{M -
1}k_{l,i,f}^{(3)}} \leq K_{0}$ is the number of nonzero coefficients for layer
$l = 1,\ldots,\upsilon$ and $K^{\text{NZ}} = \sum_{l =
1}^{\upsilon}K_{l}^{\text{NZ}} \leq 2K_{0}$ is the total number of nonzero
coefficients.
\- If $\nu \leq 2$ and $K^{\text{NZ}} = K_{1}\text{Mν}$, $i_{1,7,l}$ is not
reported, for $l = 1,\ldots,\nu$.
The indices of $i_{2,4,l}$, $i_{2,5,l}$ and $i_{1,7,l}$ are associated to the
$M$ codebook indices in $n_{3}$.
The mapping from $k_{l,p}^{(1)}$ to the amplitude coefficient $p_{l,p}^{(1)}$
is given in Table 5.2.2.2.5-2 and the mapping from $k_{l,i,f}^{(2)}$ to the
amplitude coefficient $p_{l,i,f}^{(2)}$ is given in Table 5.2.2.2.5-3. The
amplitude coefficients are represented by
$$p_{l}^{\left( 1 \right)} = \begin{bmatrix} p_{l,0}^{\left( 1 \right)} &
p_{l,1}^{\left( 1 \right)} \ \end{bmatrix}$$
$$p_{l}^{(2)} = \left\lbrack p_{l,0}^{(2)}\ldots p_{l,M - 1}^{(2)}
\right\rbrack$$
$$p_{l,f}^{(2)} = \left\lbrack p_{l,0,f}^{(2)}\ldots p_{l,K_{1} - 1,f}^{(2)}
\right\rbrack.$$
Let $f_{l}^{_} \in \left{ 0,\ldots,M - 1 \right}$ be the index of $i_{2,4,l}$
and $i_{l}^{_} \in \left{ 0,1,\ldots,K_{1} - 1 \right}$ be the index of
$k_{l,f_{l}^{_}}^{(2)}$ which identify the strongest coefficient of layer $l$,
i.e., the element $k_{l,i_{l}^{_},f_{l}^{*}}^{(2)}$ of $i_{2,4,l}$, for
$\text{\ l} = 1,\ldots,\upsilon$. The strongest coefficient of layer $l =
1,\ldots,\nu$ is identified by the index
$$i_{1,8,l} \in \left{ 0,1,\ldots,K_{1}M - 1 \right}$$
which is found from
$$i_{1,8,l} = K_{1}f_{l}^{_} + i_{l}^{_}.$$
The amplitude and phase coefficient indicators are reported as follows:
\- $k_{l,\left\lfloor \frac{i_{l}^{_}}{L} \right\rfloor}^{(1)} = 15$,
$k_{l,i_{l}^{_},f_{l}^{_}}^{(2)} = 7$, $k_{l,i_{l}^{_},f_{l}^{_}}^{(3)} = 1$
and $c_{l,i_{l}^{_},f_{l}^{_}} = 0$ $\left( l = 1,\ldots,\upsilon \right)$.
The elements $k_{l,\left\lfloor \frac{i_{l}^{_}}{L} \right\rfloor}^{(1)}$,
$k_{l,i_{l}^{_},f_{l}^{_}}^{(2)}$ and $c_{l,i_{l}^{_},f_{l}^{_}}$ are not
reported for $l = 1,\ldots,\upsilon$.
\- The element $k_{l,\left( \left\lfloor \frac{i_{l}^{*}}{L} \right\rfloor + 1
\right)\ \text{mod}\ 2}^{(1)}$ is reported for $l = 1,\ldots,\upsilon$.
\- The $K^{\text{NZ}} - \upsilon$ elements $k_{l,i,f}^{(2)}$ for which
$k_{l,i,f}^{(3)} = 1$, $i \neq i_{l}^{_},\ f \neq f_{l}^{_}$ are reported.
\- The $K^{\text{NZ}} - \upsilon$ elements $c_{l,i,f}$ for which
$k_{l,i,f}^{(3)} = 1$, $i \neq i_{l}^{_},\ f \neq f_{l}^{_}$ are reported.
\- The remaining $K_{1}\text{Mν} - K^{\text{NZ}}$ elements $k_{l,i,f}^{(2)}$
are not reported.
\- The remaining $K_{1}M\nu - K^{\text{NZ}}$ elements $c_{l,i,f}$ are not
reported.
The codebooks for 1-4 layers are given in Table 5.2.2.2.7-3, where
$v_{m^{(i)}}$ is a $P_{CSI - RS}/2\ $-element column vector containing a value
of 1 in the element of index $m^{(i)}$ and zeros elsewhere (where the first
element is the element of index 0), the quantities $y_{t}\ $are given by
$$y_{t} = \left\lbrack y_{t}^{(0)}\ldots\ y_{t}^{(M - 1)} \right\rbrack$$
where $t = \left{ 0,1,\ldots,N_{3} - 1 \right}$, is the index associated with
the precoding matrix and where
$${y_{t}^{(f)} = e}^{j\frac{2\pi tn_{3}^{(f)}}{N_{3}}}$$
for $f = 0,\ldots,M - 1$, and the quantities $\varphi_{l,i,f}$ are given by
$$\varphi_{l,i,f} = \ e^{j\frac{2\pi c_{l,i,f}}{16}}.$$
Table 5.2.2.2.7-3: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI
reporting using antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+----------------------------------+----------------------------------+ | **Layers** | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | $$ | $$W_{m,n_ | | {\upsilon = 1}$$ | {3},p_{1}^{(1)},p_{1}^{\left( 2 | | | \right)},i_{2,5,1},t}^{(1)} = W_ | | | {m,n_{3},p_{1}^{(1)},p_{1}^{\lef | | | t( 2 \right)},i_{2,5,1},t}^{1}$$ | +----------------------------------+----------------------------------+ | $$ | $$W_{m,n_{3},p_{ | | {\upsilon = 2}$$ | 1}^{(1)},p_{1}^{\left( 2 \right) | | | },i_{2,5,1},p_{2}^{(1)},p_{2}^{\ | | | left( 2 \right)},i_{2,5,2},t}^{( | | | 2)} = \frac{1}{\sqrt{2}}\left\lb | | | rack W_{m,n_{3},p_{1}^{(1)},p_{1 | | | }^{\left( 2 \right)},i_{2,5,1},t | | | }^{1}\text{\ \ }W_{m,n_{3},p_{2} | | | ^{(1)},p_{2}^{\left( 2 \right)}, | | | i_{2,5,2},t}^{2} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 3$$ | $$W_{m,n_{ | | | 3},p_{1}^{(1)},p_{1}^{\left( 2 \ | | | right)},i_{2,5,1},p_{2}^{(1)},p_ | | | {2}^{\left( 2 \right)},i_{2,5,2} | | | ,p_{3}^{(1)},p_{3}^{\left( 2 \ri | | | ght)},i_{2,5,3},t}^{(3)} = \frac | | | {1}{\sqrt{3}}\left\lbrack W_{m,n | | | _{3},p_{1}^{(1)},p_{1}^{\left( 2 | | | \right)},i_{2,5,1},t}^{1}\text{ | | | \ \ }W_{m,n_{3},p_{2}^{(1)},p_{2 | | | }^{\left( 2 \right)},i_{2,5,2},t | | | }^{2}\text{\ \ }W_{m,n_{3},p_{3} | | | ^{(1)},p_{3}^{\left( 2 \right)}, | | | i_{2,5,3},t}^{3} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 4$$ | $$W_{m,n_{3},p_{1}^{(1)},p_{1 | | | }^{\left( 2 \right)},i_{2,5,1},p | | | _{2}^{(1)},p_{2}^{\left( 2 \righ | | | t)},i_{2,5,2},p_{3}^{(1)},p_{3}^ | | | {\left( 2 \right)},i_{2,5,3},p_{ | | | 4}^{(1)},p_{4}^{\left( 2 \right) | | | },i_{2,5,4},t}^{(4)} = \frac{1}{ | | | 2}\left\lbrack W_{m,n_{3},p_{1}^ | | | {(1)},p_{1}^{\left( 2 \right)},i | | | _{2,5,1},t}^{1}\text{\ \ }W_{m,n | | | _{3},p_{2}^{(1)},p_{2}^{\left( 2 | | | \right)},i_{2,5,2},t}^{2}\text{ | | | \ \ }W_{m,n_{3},p_{3}^{(1)},p_{3 | | | }^{\left( 2 \right)},i_{2,5,3},t | | | }^{3}\text{\ \ }W_{m,n_{3},p_{4} | | | ^{(1)},p_{4}^{\left( 2 \right)}, | | | i_{2,5,4},t}^{4} \right\rbrack$$ | +----------------------------------+----------------------------------+ | Where | | | $W_{m,n_{3},p_{l | | | }^{(1)},p_{l}^{\left( 2 \right)} | | | ,i_{2,5,l},t}^{l} = \frac{1}{\sq | | | rt{\gamma_{t,l}}}\begin{bmatrix} | | | \sum_{i = 0}^{L | | | - 1}{v_{m^{(i)}}p_{l,0}^{(1)}\su | | | m_{f = 0}^{M - 1}{y_{t}^{(f)}p_{ | | | l,i,f}^{(2)}\varphi_{l,i,f}}} \ | | | \sum_{i = 0}^{L - 1}{v_{ | | | m^{(i)}}p_{l,1}^{(1)}\sum_{f = 0 | | | }^{M - 1}{y_{t}^{(f)}p_{l,i + L, | | | f}^{(2)}\varphi_{l,i + L,f}}} \ | | | \end{bmatrix},\ \ l = 1,2,3,4$, | | | | | | $$\gamma_{t,l} = | | | {\sum_{i = 0}^{2L - 1}{\left( p | | | _{l,\left\lfloor \frac{i}{L} \ri | | | ght\rfloor}^{\left( 1 \right)} \ | | | right)^{2}\left| \sum_{f = 0}^{M | | | - 1}{y_{t}^{(f)}p_{l,i,f}^{(2)} | | | \varphi_{l,i,f}} \right|}}^{2}$$ | | | | | | and the mappings from $i_{1}$ | | | to$\ m$, $n_{3}$, and from | | | $i_{2}$ to $i_{2,5,1}$, | | | $i_{2,5,2}$, | | | $i_{2,5,3}$,$\ i_{2,5,4},$ | | | $p_{1}^{(1)}$, $p_{2}^{(1)}$, | | | $p_{3}^{(1)}$, $p_{4}^{(1)}$, | | | $\ p_{1}^{(2)}$, $p_{2}^{(2)}$, | | | $p_{3}^{(2)}$, $p_{4}^{(2)}$ are | | | as described above, including | | | the ranges of the constituent | | | indices of $i_{1}$ and $i_{2}$. | | +----------------------------------+----------------------------------+
For coefficients with $k_{l,i,f}^{(3)} = 0$, amplitude and phase are set to
zero, i.e., $p_{l,i,f}^{(2)} = 0$ and $\varphi_{l,i,f} = 0$.
##### 5.2.2.2.8 Enhanced Type II codebook for CJT
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031} per CSI-RS resource, and the UE configured with
$N_{\text{TRP}} \in { 1,2,3,4}$ CSI-RS resources in a resource set for channel
measurement and with higher layer parameter _codebookType_ set to \'typeII-
CJT-r18\'
\- the values of $N_{1}$, $N_{2}$ and $O_{1}$, $O_{2}$ are the same for all
$N_{\text{TRP}}$ CSI-RS resources and configured with the higher layer
parameter. The supported configurations of $\left( N_{1},N_{2} \right)$ for a
given number of CSI-RS ports and the corresponding values of $\left(
O_{1},O_{2} \right)$ are given in Table 5.2.2.2.1-2. The number of CSI-RS
ports, $P_{CSI - RS}$, is $2N_{1}N_{2}$ for each of the $N_{\text{TRP}}$ CSI-
RS resources.
A set of $N_{L} \in { 1,2,4}$ combinations of values of ${
L_{1},\ldots,L_{N_{\text{TRP}}}}$ is configured by the higher layer parameter
_paramCombination-CJT-L-r18_ , where the value of $N_{L}$ is configured by the
higher layer parameter _numberOfSDCombinations_ and the mapping is given in
Table 5.2.2.2.8-1, with the value of $L_{n}$ corresponding to CSI-RS resource
$n$, for $n = 1,\ldots,N_{\text{TRP}}$. A single value of $p_{\nu}$ and
$\beta$ is configured by the higher layer parameter _paramCombination-CJT-r18_
, where the mapping is given in Table 5.2.2.2.8-2. The configurable
combinations of ${ L_{1},\ldots,L_{N_{\text{TRP}}}}$ and ${
p_{\upsilon},\beta}$ are marked with \'x\' in Table 5.2.2.2.8-3.
\- The UE is not expected to be configured with _paramCombination-CJT-L-r18_
equal to
\- 2, 3, 5, 6, 7, 9, 10, 11, 12, 14, 15 or 16 when $P_{CSI - RS} = 4$,
\- 3 when $P_{CSI - RS}  1$.
\- 3 when $R = 2$.
\- If $N_{L} > 1$, the UE is expected to select one of the $N_{L}$ configured
combinations of ${ L_{1},\ldots,L_{N_{\text{TRP}}}}$ and report the index of
the selected combination, where the index value 0 corresponds to the first
configured combination and the index value $N_{L} - 1$ corresponds to the
$N_{L}$-th configured combination. If $N_{L} = 1$, a single combination of ${
L_{1},\ldots,L_{N_{\text{TRP}}}}$ is configured and the selection is not
reported.
Table 5.2.2.2.8-1: Codebook parameter configurations for
$\mathbf{{}\mathbf{L}_{\mathbf{1}}\mathbf{,\ldots,\
}\mathbf{L}_{\mathbf{N}_{\mathbf{\text{TRP}}}}\mathbf{}}$
$$N_{\text{TRP}}$$ _paramCombination-CJT-L-r18_
$$\mathbf{{}\mathbf{L}_{\mathbf{1}}\mathbf{,\ldots,\
}\mathbf{L}_{\mathbf{N}_{\mathbf{\text{TRP}}}}\mathbf{}}$$
* * *
1 1 {2} 2 {4} 3 {6} 2 4 {2,2} 5 {2,4} 6 {4,2} 7 {4,4} 3 8 {2,2,2} 9 {2,2,4} 10
{2,4,2} 11 {4,2,2} 12 {4,4,4} 4 13 {2,2,2,2} 14 {2,2,2,4} 15 {2,2,4,4} 16
{4,4,4,4}
Table 5.2.2.2.8-2: Codebook parameter configurations for
$\mathbf{{}\mathbf{p}_{\mathbf{\upsilon}}\mathbf{,}\mathbf{\beta}\mathbf{}}$
_paramCombination-CJT-r18_ $$p_{\upsilon}$$ $$\beta$$
* * *
                               $$\upsilon\  \in \left\{ 1,2 \right\}$$   $$\upsilon\  \in \left\{ 3,4 \right\}$$
1 1/8 1/16 ¼ 2 1/8 1/16 ½ 3 ¼ 1/8 ¼ 4 ¼ 1/8 ½ 5 ¼ ¼ ¾ 6 ½ ¼ ½ 7 ½ ½ ½
Table 5.2.2.2.8-3: Configurable combinations of
$\mathbf{{}\mathbf{L}_{\mathbf{1}}\mathbf{,\ldots,\
}\mathbf{L}_{\mathbf{N}_{\mathbf{\text{TRP}}}}\mathbf{}}$ and
$\mathbf{{}\mathbf{p}_{\mathbf{\upsilon}}\mathbf{,}\mathbf{\beta}\mathbf{}}$
_paramCombination-CJT-L-r18_ _paramCombination-CJT-r18_
* * *
                                 1                            2   3   4   5   6   7
1 x x  
2 x x x x  
3 x x  
4 x  
5 x  
6 x  
7 x x x 8 x x  
9 x x  
10 x x  
11 x x  
12 x x x x x x 13 x  
14 x  
15 x x  
16 x x x
\- The value of $R \in { 1,2}$ is configured with the higher-layer parameter
_numberOfPMI-SubbandsPerCQI-Subband-CJT-r18_ , where $R$ and the corresponding
value of $N_{3}$ are defined as in clause 5.2.2.2.5.
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-CJT-RI-Restriction-r18_. The UE shall not
report $\upsilon > 4$. The bitmap parameter _typeII-CJT-RI-Restriction-r18_
forms the bit sequence $r_{3},r_{2},r_{1},r_{0}$ where $r_{0}$ is the LSB and
$r_{3}$ is the MSB. When $r_{i}$ is zero, $i \in \left{ 0,1,\ldots,3 \right}$,
PMI and RI reporting are not allowed to correspond to any precoder associated
with $\upsilon = i + 1$ layers.
\- The UE may be configured with higher layer parameter _restrictedCMR-
Selection_. If _restrictedCMR-Selection_ is configured, the number of selected
CSI-RS resources is $N = N_{\text{TRP}}$. Otherwise, the UE is expected to
select $N$ CSI-RS resources, with $1 \leq N \leq N_{\text{TRP}}$, and the
selection is reported with an $N_{\text{TRP}}$-bit bitmap,
$b_{N_{\text{TRP}}},\ \ldots,b_{1}$, where the CSI-RS resources are mapped
from bit $b_{1}$ to bit $b_{N_{\text{TRP}}}$ by their ordering in the resource
set and the first of the $N$ selected CSI-RS resources corresponds to the
nonzero bit with lowest index.
The PMI value for the $N$ selected CSI-RS resources corresponds to the
codebook indices of $i_{1}$ and $i_{2}$ where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
\begin{matrix} i_{1,1} & i_{1,2} & i_{1,5} \ \end{matrix} & \begin{matrix}
i_{1,6,1} & i_{1,7,1} & i_{1,8,1}\ & i_{1,9} \ \end{matrix} \ \end{bmatrix} &
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \upsilon = 1 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,2} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} & i_{1,7,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} & i_{1,6,2}\text{\ \ \ \ \
}i_{1,7,2}\text{\ \ \ \ \ }i_{1,8,2}\text{\ \ \ \ \ }i_{1,9} \ \end{matrix}
\right\rbrack & \upsilon = 2 \ \end{matrix} \ \begin{matrix} \left\lbrack
\begin{matrix} i_{1,1} & i_{1,2} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix}
i_{1,5} & i_{1,6,1} & i_{1,7,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{1,8,1} & i_{1,6,2}\text{\ \ \ \ \ }i_{1,7,2}\text{\ \ \ \ \
}i_{1,8,2}\text{\ \ \ \ \ }i_{1,6,3} \ \end{matrix}\text{\ \ \ \ \
}i_{1,7,3}\text{\ \ \ \ \ }i_{1,8,3}\text{\ \ \ \ \ }i_{1,9} \right\rbrack & \
\ \ \upsilon = 3 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,2} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} & i_{1,7,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} & i_{1,6,2} & i_{1,7,2} \
\end{matrix}\text{\ \ \ \ \ }i_{1,8,2}\text{\ \ \ \ \ }\begin{matrix}
i_{1,6,3} & i_{1,7,3} & i_{1,8,3}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,4} &
i_{1,7,4}\text{\ \ \ \ \ }i_{1,8,4} & i_{1,9} \ \end{matrix} \ \end{matrix}
\right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix} \right.\ \ i_{2} =
\left{ \begin{matrix} \begin{matrix} \begin{bmatrix} i_{2,3,1} & i_{2,4,1} &
i_{2,5,1} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 1 \ \left\lbrack
\begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix} \right\rbrack
& \upsilon = 2 \ \end{matrix} \ \begin{matrix} \left\lbrack \begin{matrix}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \ \end{matrix} \right\rbrack & \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\upsilon = 3 \ \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{2,3,4} & i_{2,4,4} & i_{2,5,4}
\ \end{matrix} \right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix}
\right.\ \ \end{matrix}$$
The precoding matrices indicated by the PMI are determined from $\sum_{j =
1}^{N}L_{\sigma_{j}} + M_{\upsilon}$ vectors, where
${\sigma_{1},\ldots,\sigma_{N}}$ are the indices of the $N$ selected CSI-RS
resources in increasing order, such that $1 \leq \sigma_{1}  19$) and $i_{1,6,l}$ $\left( \text{for\ }M_{\upsilon} > 1\text{\ and\
}l = 1,\ldots,\ \upsilon \right)$, which are obtained as described in Clause
5.2.2.2.5, where $i_{1,6,l}$ is derived from the selected vectors identified
by the indices $n_{3,l}^{(f)}$, $f = 0,1,\ldots,M_{\upsilon} - 1$. The
$M_{\upsilon}$ vectors\' elements are given by
$${y_{t,l}^{(f)} = e}^{j\frac{2\text{πt}n_{3,l}^{(f)}}{N_{3}}}$$
for $t = 0,1,\ldots N_{3} - 1$, and $f = 0,1,\ldots,M_{\upsilon} - 1$.
If the higher layer parameter _codebookMode_ is set to \'mode1\', an offset
$d_{j}$ is reported for the $j$-th selected CSI-RS resource, with $j =
2,\ldots,N$, relative to the first of the $N$ selected CSI-RS resources. The
$N - 1$ reported offsets are common for all $\nu$ layers and are indicated by
$i_{1,9}$, given by
$$i_{1,9} = \lbrack d_{2}\ldots\ d_{N}\rbrack d_{j} \in { 0,\
1,\ldots,N_{3}O_{3} - 1}$$
where the value of $O_{3} \in { 1,4}$ is configured by higher layer parameter
_numberOfO3_. The offsets are represented by
$$\psi = \lbrack\psi_{2}\ldots\ \psi_{N}\rbrack$$
$$\psi_{j} = \frac{d_{j}}{O_{3}}$$
If _codebookMode_ is set to \'mode2\', the offset indicator, $i_{1,9}$, is not
reported and $\psi_{j} = 0$ for $j = 2,\ldots,N$.
The reference amplitude coefficient indicator $i_{2,3,l}$, for layer $l =
1,\ldots\upsilon$, is given by
$$i_{2,3,l} = \begin{bmatrix} k_{l,0}^{\left( 1 \right)} & k_{l,1}^{\left( 1
\right)} \ \end{bmatrix}$$
$$k_{l,p}^{(1)} \in \left{ 1,\ldots,15 \right}$$
The reference amplitude coefficients for layer $l = 1,\ldots,\upsilon$ are
represented by
$$p_{l}^{(1)} = \lbrack p_{l,0}^{\left( 1 \right)}\ p_{l,1}^{(1)}\rbrack$$
and the mapping from $k_{l,p}^{(1)}$, to $p_{l,p}^{(1)}$ is given in Table
5.2.2.2.5-2.
The amplitude coefficient indicator $i_{2,4,l}$, for layer $l =
1,\ldots,\upsilon$, is given by
$$i_{2,4,l} = \lbrack i_{2,4,l,1}\ldots i_{2,4,l,N}\rbrack$$
$$i_{2,4,l,j} = \left\lbrack k_{l,0,j}^{(2)}\ldots k_{l,M_{\upsilon} -
1,j}^{(2)} \right\rbrack$$
$$k_{l,f,j}^{(2)} = \left\lbrack k_{l,0,f,j}^{(2)}\ldots k_{l,2L_{\sigma_{j}}
- 1,f,j}^{(2)} \right\rbrack$$
$$k_{l,i,f,j}^{(2)} \in \left{ 0,\ldots,7 \right}$$
The amplitude coefficients for layer $l = 1,\ldots,\upsilon$ are represented
by
$$p_{l}^{(2)} = \lbrack p_{l,1}^{\left( 2 \right)}\ \ldots\
p_{l,N}^{(2)}\rbrack$$
$$p_{l,j}^{(2)} = \lbrack p_{l,0,j}^{\left( 2 \right)}\ldots p_{l,M_{\nu} -
1,j}^{(2)}\rbrack$$
$$p_{l,f,j}^{(2)} = \lbrack p_{l,0,f,j}^{\left( 2 \right)}\ldots
p_{l,2L_{\sigma_{j}} - 1,f,j}^{(2)}\rbrack$$
and the mapping from $k_{l,i,f,j}^{(2)}$ to $p_{l,i,f,j}^{(2)}$ is given in
Table 5.2.2.2.5-3.
The phase coefficient indicator $i_{2,5,l}$, for $l = 1,\ldots,\upsilon$, is
given by
$$i_{2,5,l} = \lbrack i_{2,5,l,1}\ldots i_{2,5,l,N}\rbrack$$
$$i_{2,5,l,j} = \left\lbrack c_{l,0,j}\ldots c_{l,M_{\upsilon} - 1,j}
\right\rbrack$$
$$c_{l,f,j} = \left\lbrack c_{l,0,f,j}\ldots c_{l,2L_{\sigma_{j}} - 1,f,j}
\right\rbrack$$
$$c_{l,i,f,j} \in \left{ 0,\ldots,15 \right}$$
The phase coefficients for layer $l = 1,\ldots,\upsilon$ are represented by
$$\varphi_{l} = \lbrack\varphi_{l,1}\ldots\varphi_{l,N}\rbrack$$
$$\varphi_{l,j} = \left\lbrack \varphi_{l,0,j}\ldots\varphi_{l,M_{\upsilon} -
1,j} \right\rbrack$$
$$\varphi_{l,f,j} = \left\lbrack
\varphi_{l,0,f,j}\ldots\varphi_{l,2L_{\sigma_{j}} - 1,f,j} \right\rbrack$$
and the mapping from $c_{l,i,f,j}$ to $\varphi_{l,i,f,j}$ is given by
$$\varphi_{l,i,f,j} = e^{j2\pi\frac{c_{l,i,f,j}}{16}}$$
Let $K_{0} = \left\lceil 2\beta M_{1}\sum_{j = 1}^{N}L_{\sigma_{j}}
\right\rceil$. The bitmap whose nonzero bits identify which coefficients in
$i_{2,4,l}$ and $i_{2,5,l}\ $are reported for layer $l = 1,\ldots,\upsilon$,
is indicated by $i_{1,7,l}$
$$i_{1,7,l} = \lbrack i_{1,7,l,1}\ldots i_{1,7,l,N}\rbrack$$
$$i_{1,7,l,j} = \left\lbrack k_{l,0,j}^{\left( 3 \right)}\ldots
k_{l,M_{\upsilon} - 1,j}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,f,j}^{\left( 3 \right)} = \left\lbrack k_{l,0,f,j}^{\left( 3
\right)}\ldots k_{l,2L_{\sigma_{j}} - 1,f,j}^{\left( 3 \right)}
\right\rbrack$$
$$k_{l,i,f,j}^{(3)} \in \left{ 0,1 \right}$$
Let $K_{l}^{\text{NZ}} = \sum_{j = 1}^{N}{\sum_{i = 0}^{2L_{\sigma_{j}} -
1}{\sum_{f = 0}^{M_{\upsilon} - 1}k_{l,i,f,j}^{(3)}}} \leq K_{0}$ be the
number of nonzero coefficients for layer $l = 1,\ldots,\upsilon$, the total
number of nonzero coefficients is reported and given by $K^{\text{NZ}} =
\sum_{l = 1}^{\upsilon}K_{l}^{\text{NZ}} \leq 2K_{0}$.
The indices of $i_{2,4,l}$, $i_{2,5,l}$ and $i_{1,7,l}$ are associated to the
$N$ selected CSI-RS resources.
Let $f_{l}^{_} \in \left{ 0,1,\ldots,M_{\upsilon} - 1 \right}$ and $i_{l}^{_}
\in \left{ 0,1,\ldots,2\sum_{j = 1}^{N}L_{\sigma_{j}} - 1 \right}$ be the
indices which identify the strongest coefficient of layer $l$, for $\text{\ l}
= 1,\ldots,\upsilon$, _i.e._ , the element
$k_{l,y_{l}^{_},f_{l}^{_},j_{l}^{_}}^{(2)}$ of $i_{2,4,l}$, where the indices
$j_{l}^{_} \in { 1,\ldots,N}$, $y_{l}^{_} \in \left{
0,\ldots,2L_{\sigma_{j_{l}^{_}}} - 1 \right}$ are such that $i_{l}^{_} =
2\sum_{k = 1}^{j_{l}^{_} - 1}L_{\sigma_{k}} + y_{l}^{_}$. The codebook indices
of $n_{3,l}$$k_{m_{i}}$ are remapped with respect to $n_{3,l}^{(f_{l}^{_})}$
as $n_{3,l}^{(f)} = \left( n_{3,l}^{(f)} - n_{3,l}^{(f_{l}^{_})}
\right)\text{mod\ }N_{3}$${\widetilde{k}}_{m_{i}^{_}} = 0$, such that
$n_{3,l}^{(f_{l}^{_})} = 0$, after remapping. The index $f$ is remapped with
respect to $f_{l}^{_}$ as $f = \left( f - f_{l}^{_} \right)\text{mod\
}M_{\upsilon}$, such that the index of the strongest coefficient is $f_{l}^{_}
= 0$, for each layer $l = 1,\ldots,\upsilon$, after remapping. The indices of
$i_{2,4,l}$, $i_{2,5,l}$ and $i_{1,7,l}$ indicate amplitude coefficients,
phase coefficients and bitmap after remapping.
The strongest coefficient of layer $l = 1,\ldots,\ \upsilon$ is identified by
$i_{1,8,l} \in \left{ 0,1,\ldots,2\sum_{j = 1}^{N}L_{\sigma_{j}} - 1
\right}$and is obtained as follows, where, for $\upsilon = 1$,
$\kappa_{1,I,0}^{(3)} = k_{1,i,0,j}^{(3)}$ and index $I$ is such that $I =
2\sum_{k = 1}^{j - 1}L_{\sigma_{k}} + i$
$i_{1,8,l} = \left{ \begin{matrix} \sum_{I =
0}^{i_{1}^{_}}\kappa_{1,I,0}^{(3)} - 1 & \upsilon\mathbf{=}1 \ i_{l}^{_} & 1  1$.
\- If $N_{L} > 1$, the UE is expected to select one of the $N_{L}$ configured
combinations of ${\alpha_{1},\ldots,\alpha_{N_{\text{TRP}}}}$ and report the
index of the selected combination, where the index value 0 corresponds to the
first configured combination and the index value $N_{L} - 1$ corresponds to
the $N_{L}$-th configured combination. If $N_{L} = 1$, a single combination of
${\alpha_{1},\ldots,\alpha_{N_{\text{TRP}}}}$ is configured and the selection
is not reported.
Table 5.2.2.2.9-1: Codebook parameter configurations for
$\mathbf{{}\mathbf{\alpha}_{\mathbf{1}}\mathbf{,\ldots,\
}\mathbf{\alpha}_{\mathbf{N}_{\mathbf{\text{TRP}}}}\mathbf{}}$
$$N_{\text{TRP}}$$ _paramCombination-CJT-PS-alpha-r18_
$$\mathbf{{}\mathbf{\alpha}_{\mathbf{1}}\mathbf{,\ldots,\
}\mathbf{\alpha}_{\mathbf{N}_{\mathbf{\text{TRP}}}}\mathbf{}}$$
* * *
1 1 {1/2} 2 {3/4} 3 {1} 2 4 {1/2,1/2} 5 {1/2,1} 6 {1,1/2} 7 {3/4,3/4} 8 {1,1}
3 9 {1/2,1/2,1/2} 10 {1/2,1/2,3/4} 11 {1/2,3/4,1/2} 12 {3/4,1/2,1/2} 13
{1/2,1/2,1} 14 {1/2,1,1/2} 15 {1,1/2,1/2} 16 {1,1,1} 4 17 {1/2,1/2,1/2,1/2} 18
{1/2,1/2,1/2,1} 19 {1/2,1/2,1,1} 20 {1,1,1,1}
Table 5.2.2.2.9-2: Codebook parameter configurations for
$\mathbf{{}\mathbf{M}\mathbf{,}\mathbf{\beta}\mathbf{}}$
_paramCombination-CJT-PS-r18_ $$M$$ $$\beta$$
* * *
1 1 ½ 2 1 ¾ 3 1 1 4 2 ½ 5 2 ¾
Table 5.2.2.2.9-3: Configurable combinations of
$\mathbf{{}\mathbf{\alpha}_{\mathbf{1}}\mathbf{,\ldots,\
}\mathbf{\alpha}_{\mathbf{N}_{\mathbf{\text{TRP}}}}\mathbf{}}$ and
$\mathbf{{}\mathbf{M}\mathbf{,}\mathbf{\beta}\mathbf{}}$
_paramCombination-CJT-PS-alpha-r18_ _paramCombination-CJT-PS-r18_
* * *
                                        1                               2   3   4   5
1 x  
2 x x  
3 x x x x x 4 x x  
5 x  
6 x  
7 x  
8 x x  
9 x x  
10 x  
11 x  
12 x  
13 x x  
14 x x  
15 x x  
16 x x 17 x  
18 x  
19 x x x  
20 x
\- The value of $N_{M} \in { 2,4}$ is configured with the higher-layer
parameter _valueOfN-CJT-r18_ , when $M = 2$.
\- The value of $R \in { 1,2}$ is configured with the higher-layer parameter
_numberOfPMI-SubbandsPerCQI-Subband-CJT-PS-r18_ , when $M = 2$, and $R = 1$
when $M = 1$, where $R$ and the corresponding value of $N_{3}$ are defined as
in clause 5.2.2.2.5.
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-CJT-PS-RI-Restriction-r18_. The UE shall not
report $\upsilon > 4$. The bitmap parameter _typeII-CJT-PS-RI-Restriction-r18_
forms the bit sequence $r_{3},r_{2},r_{1},r_{0}$, where $r_{0}\ $is the LSB
and $r_{3}$ is the MSB. When $r_{i}$ is zero, $i \in \left{ 0,1,\ldots,\ 3
\right}$, PMI and RI reporting are not allowed to correspond to any precoder
associated with $\upsilon = i + 1$ layers.
\- The UE may be configured with higher layer parameter _restrictedCMR-
Selection_. If _restrictedCMR-Selection_ is configured, the number of selected
CSI-RS resources is $N = N_{\text{TRP}}$. Otherwise, the UE is expected to
select $N$ CSI-RS resources, with $1 \leq N \leq N_{\text{TRP}}$, and the
selection is reported with an $N_{\text{TRP}}$-bit bitmap,
$b_{N_{\text{TRP}}},\ \ldots,b_{1}$, where the CSI-RS resources are mapped
from bit $b_{1}$ to bit $b_{N_{\text{TRP}}}$ by their ordering in the resource
set and the first of the $N$ selected CSI-RS resources corresponds to the
nonzero bit with lowest index.
The PMI value for the $N$ selected CSI-RS resources corresponds to the
codebook indices of $i_{1}$ and $i_{2}$ where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
i_{1,2} & \begin{matrix} i_{1,6} & i_{1,7,1} & i_{1,8,1} & i_{1,9} \
\end{matrix} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\upsilon = 1 \ \begin{bmatrix} i_{1,2} & i_{1,6} & i_{1,7,1} & i_{1,8,1} &
i_{1,7,2} & i_{1,8,2} & i_{1,9} \ \end{bmatrix} & \upsilon = 2 \ \end{matrix}
\ \begin{matrix} \begin{bmatrix} i_{1,2} & i_{1,6} & i_{1,7,1} & i_{1,8,1} &
i_{1,7,2} & i_{1,8,2} & i_{1,7,3} & i_{1,8,3} & i_{1,9} \ \end{bmatrix} &
\upsilon = 3 \ \begin{bmatrix} i_{1,2} & i_{1,6} & i_{1,7,1} & i_{1,8,1} &
i_{1,7,2} & i_{1,8,2} & i_{1,7,3} & i_{1,8,3} & i_{1,7,4} & i_{1,8,4} &
i_{1,9} \ \end{bmatrix} & \upsilon = 4 \ \end{matrix} \ \end{matrix} \right.\
\ i_{2} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix} i_{2,3,1} &
i_{2,4,1} & i_{2,5,1} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \upsilon = 1 \ \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} &
i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} &
i_{2,5,2} \ \end{matrix} \right\rbrack & \upsilon = 2 \ \end{matrix} \
\begin{matrix} \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix} \right\rbrack & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 3 \ \left\lbrack
\begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \ \end{matrix}\text{\ \ \ \
\ }\begin{matrix} i_{2,3,4} & i_{2,4,4} & i_{2,5,4} \ \end{matrix}
\right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix} \right.\ \
\end{matrix}$$
The precoding matrices indicated by the PMI are determined from $\sum_{j =
1}^{N}L_{\sigma_{j}} + M$ vectors, where ${\sigma_{1},\ldots,\sigma_{N}}$ are
the indices of the $N$ selected CSI-RS resources in increasing order, such
that $1 \leq \sigma_{1}  1$.
\- 8 or 9 when $R = 2$.
Table 5.2.2.2.10-1: Codebook parameter configurations for
$\mathbf{L}\mathbf{,\ }$ $\mathbf{\beta}$ and $\mathbf{p}_{\mathbf{\upsilon}}$
_paramCombination-Doppler-r18_ $$L$$ $$p_{\upsilon}$$ $$\beta$$
* * *
                                           $$\upsilon\  \in \left\{ 1,2 \right\}$$   $$\upsilon\  \in \left\{ 3,4 \right\}$$
1 2 1/8 1/16 ¼ 2 2 ¼ 1/8 ½ 3 4 ¼ 1/8 ¼ 4 4 ¼ ¼ ¼ 5 4 ¼ ¼ ½ 6 4 ¼ ¼ ¾ 7 4 ½ ¼ ½
8 6 ¼ - ½ 9 6 ¼ - ¾
\- The value of $R \in { 1,2}$ is configured with the higher-layer parameter
_numberOfPMI-SubbandsPerCQI-Subband-Doppler-r18_ , where $R$ and the
corresponding value of $N_{3}$ are defined as in clause 5.2.2.2.5.
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-Doppler-RI-Restriction-r18_. The UE shall not
report $\upsilon > 4$. The bitmap parameter _typeII-Doppler-RI-
Restriction-r18_ forms the bit sequence $r_{3},r_{2},r_{1},r_{0}$ where
$r_{0}$ is the LSB and $r_{3}$ is the MSB. When $r_{i}$ is zero, $i \in \left{
0,1,\ldots,3 \right}$, PMI and RI reporting are not allowed to correspond to
any precoder associated with $\upsilon = i + 1$ layers.
\- The value of $N_{4} \in { 1,2,4,8}$ is configured by the higher layer
parameter _N4_ , such that the PMI indicates $N_{3}$ precoder matrices for
each of the $N_{4}$ consecutive slot intervals of duration $d$ slots, as
defined in Clause 5.2.1.4.2.
If $N_{4} = 1$, the PMI value corresponds to the codebook indices of $i_{1}$
and $i_{2}$ as described in Clause 5.2.2.2.5 and the precoder matrices for 1-4
layers are obtained from the PMI codebook as in Table 5.2.2.2.5-5.
If $N_{4} \in { 2,4,8}$, the PMI value corresponds to the codebook indices of
$i_{1}$ and $i_{2}$, where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
\begin{matrix} i_{1,1} & i_{1,2} & i_{1,5} \ \end{matrix} & \begin{matrix}
i_{1,6,1} & i_{1,7,1} & i_{1,8,1}\ & i_{1,10,1} \ \end{matrix} \ \end{bmatrix}
& \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 1 \
\left\lbrack \begin{matrix} i_{1,1} & i_{1,2} \ \end{matrix}\text{\ \ \ \ \
}\begin{matrix} i_{1,5} & i_{1,6,1} & i_{1,7,1} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{1,8,1} & i_{1,10,1} & i_{1,6,2}\text{\ \ \ \ \
}i_{1,7,2}\text{\ \ \ \ \ }i_{1,8,2}\text{\ \ \ \ \ }i_{1,10,2} \ \end{matrix}
\right\rbrack & \upsilon = 2 \ \end{matrix} \ \begin{matrix} \left\lbrack
\begin{matrix} i_{1,1} & i_{1,2} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix}
i_{1,5} & i_{1,6,1} & i_{1,7,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{1,8,1} & i_{1,10,1} & i_{1,6,2}\text{\ \ \ \ \ }i_{1,7,2}\text{\ \ \ \ \
}i_{1,8,2}\text{\ \ \ \ \ }i_{1,10,2} & i_{1,6,3} \ \end{matrix}\text{\ \ \ \
\ }i_{1,7,3}\text{\ \ \ \ \ }i_{1,8,3}\text{\ \ \ \ \ }i_{1,10,3}
\right\rbrack & \ \ \ \ \ \ \ \ \ \ \ \upsilon = 3 \ \frac{\left\lbrack
\begin{matrix} i_{1,1} & i_{1,2} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix}
i_{1,5} & i_{1,6,1} & i_{1,7,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{1,8,1} & i_{1,10,1} & i_{1,6,2} & i_{1,7,2} \ \end{matrix}\text{\ \ \ \ \
}i_{1,8,2}\text{\ \ \ \ \ \ }i_{1,10,2} \right.\ \text{\ \ \ \
}i_{1,6,3}\text{\ \ \ \ \ }i_{1,7,3}\text{\ \ \ \ \ }i_{1,8,3}\text{\ \ \ \ \
}i_{1,10,3}}{\text{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\left. \
i_{1,6,4}\text{\ \ \ \ \ }i_{1,7,4}\text{\ \ \ \ \ }i_{1,8,4}\text{\ \ \ \ \
}i_{1,10,4} \right\rbrack} & \upsilon = 4 \ \end{matrix} \ \end{matrix}
\right.\ \ i_{2} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\upsilon = 1 \ \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix} \right\rbrack & \upsilon = 2 \ \end{matrix} \ \begin{matrix}
\left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix} \right\rbrack & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 3 \ \left\lbrack
\begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \ \end{matrix}\text{\ \ \ \
\ }\begin{matrix} i_{2,3,4} & i_{2,4,4} & i_{2,5,4} \ \end{matrix}
\right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix} \right.\ \
\end{matrix}$$
The precoding matrices indicated by the PMI are determined from $L +
M_{\upsilon} + Q$ vectors, where $Q = 2$.
The $L$ vectors, $v_{m_{1}^{\left( i \right)},m_{2}^{(i)}},i = 0,1,\ldots,L -
1$, indicated by $i_{1,1}$, $i_{1,2}$ and the $M_{\upsilon}$ vectors,
$\left\lbrack y_{0,l}^{\left( f \right)},y_{1,l}^{\left( f
\right)},\ldots,y_{N_{3} - 1,l}^{\left( f \right)} \right\rbrack^{T}$, $f =
0,1,\ldots,M_{\upsilon} - 1$, for layer $l = 1,\ldots,\nu$, indicated by
$i_{1,5}$ (for $N_{3} > 19$) and $i_{1,6,l}$ $\left( \text{for\ }M_{\upsilon}
> 1\text{\ and\ }l = 1,\ldots,\ \upsilon \right)$, are obtained as in Clause
5.2.2.2.5.
The $Q = 2$ vectors, $\left\lbrack z_{0,l}^{\left( \tau
\right)},z_{1,l}^{\left( \tau \right)},\ldots,z_{N_{4} - 1,l}^{\left( \tau
\right)} \right\rbrack^{T}$, $\tau = 0,1$, for layer $l = 1,\ldots,\nu$ are
identified by $n_{4,l}$, where
$$n_{4,l} = \left\lbrack n_{4,l}^{\left( 0 \right)}\ n_{4,l}^{\left( 1
\right)} \right\rbrack$$
$$n_{4,l}^{(\tau)} \in { 0,1,\ldots,N_{4} - 1}$$
with the indices $\tau \in { 0,1}$ assigned such that $n_{4,l}^{(\tau)}$
increases with $\tau$. $n_{4,l}$ is indicated by the index $i_{1,10,l}$, for
layer $l = 1,\ldots,\upsilon$, where
$$i_{1,10,l} \in \left{ 0,1,\ldots,N_{4} - 2 \right}$$
\- If $N_{4} = 2$, $i_{1,10,l}$, for layer $l = 1,\ldots,\upsilon$ are not
reported.
\- If$\ N_{4} \in { 4,8}$, the nonzero offset between $n_{4,l}^{(0)}$ and
$n_{4,l}^{(1)}$ is reported with $i_{1,10,l}$ assuming that $n_{4,l}^{(0)}$
(reference for the offset) is 0. The nonzero offset values are mapped to the
index values of $i_{1,10,l}$ in increasing order with offset value 1 mapped to
index value \'0\'.
The $Q = 2$ vectors\' elements are given by
$${z_{\iota,l}^{(\tau)} = e}^{j\frac{2\pi \cdot \iota \cdot
n_{4,l}^{(\tau)}}{N_{4}}}$$
for $\iota = 0,1,\ldots N_{4} - 1$, and $\tau = 0,1$.
The reference amplitude coefficient indicator $i_{2,3,l}$, for layer $l =
1,\ldots\upsilon$, is given by
$$i_{2,3,l} = \begin{bmatrix} k_{l,0}^{\left( 1 \right)} & k_{l,1}^{\left( 1
\right)} \ \end{bmatrix}$$
$$k_{l,p}^{(1)} \in \left{ 1,\ldots,15 \right}$$
The reference amplitude coefficients for layer $l = 1,\ldots,\upsilon$ are
represented by
$$p_{l}^{(1)} = \lbrack p_{l,0}^{\left( 1 \right)}\ p_{l,1}^{(1)}\rbrack$$
and the mapping from $k_{l,p}^{(1)}$ to $p_{l,p}^{(1)}$ is given in Table
5.2.2.2.5-2.
The amplitude coefficient indicator $i_{2,4,l}$, for layer $l =
1,\ldots,\upsilon$, is given by
$$i_{2,4,l} = \lbrack i_{2,4,l,0}\ i_{2,4,l,1}\rbrack$$
$$i_{2,4,l,\tau} = \left\lbrack k_{l,0,\tau}^{(2)}\ldots k_{l,M_{\upsilon} -
1,\tau}^{(2)} \right\rbrack$$
$$k_{l,f,\tau}^{(2)} = \left\lbrack k_{l,0,f,\tau}^{(2)}\ldots k_{l,2L -
1,f,\tau}^{(2)} \right\rbrack$$
$$k_{l,i,f,\tau}^{(2)} \in \left{ 0,\ldots,7 \right}$$
The amplitude coefficients for layer $l = 1,\ldots,\upsilon$ are represented
by
$$p_{l}^{(2)} = \lbrack p_{l,0}^{\left( 2 \right)}\text{\ \
}p_{l,1}^{(2)}\rbrack$$
$$p_{l,\tau}^{(2)} = \lbrack p_{l,0,\tau}^{\left( 2 \right)}\ldots
p_{l,M_{\nu} - 1,\tau}^{(2)}\rbrack$$
$$p_{l,f,\tau}^{(2)} = \lbrack p_{l,0,f,j}^{\left( 2 \right)}\ldots p_{l,2L -
1,f,\tau}^{(2)}\rbrack$$
and the mapping from $k_{l,i,f,\tau}^{(2)}$ to $p_{l,i,f,\tau}^{(2)}$ is given
in Table 5.2.2.2.5-3.
The phase coefficient indicator $i_{2,5,l}$, for $l = 1,\ldots,\upsilon$, is
given by
$$i_{2,5,l} = \lbrack i_{2,5,l,0}\ i_{2,5,l,1}\rbrack$$
$$i_{2,5,l,\tau} = \left\lbrack c_{l,0,\tau}\ldots c_{l,M_{\upsilon} - 1,\tau}
\right\rbrack$$
$$c_{l,f,\tau} = \left\lbrack c_{l,0,f,\tau}\ldots c_{l,2L - 1,f,\tau}
\right\rbrack$$
$$c_{l,i,f,\tau} \in \left{ 0,\ldots,15 \right}$$
The phase coefficients for layer $l = 1,\ldots,\upsilon$ are represented by
$$\varphi_{l} = \lbrack\varphi_{l,0}\ \varphi_{l,1}\rbrack$$
$$\varphi_{l,\tau} = \left\lbrack
\varphi_{l,0,\tau}\ldots\varphi_{l,M_{\upsilon} - 1,\tau} \right\rbrack$$
$$\varphi_{l,f,\tau} = \left\lbrack \varphi_{l,0,f,\tau}\ldots\varphi_{l,2L -
1,f,\tau} \right\rbrack$$
and the mapping from $c_{l,i,f,\tau}$ to $\varphi_{l,i,f,\tau}$ is given by
$$\varphi_{l,i,f,\tau} = e^{j2\pi\frac{c_{l,i,f,\tau}}{16}}$$
Let $K_{0} = \left\lceil 2\beta LM_{1}Q \right\rceil$. The bitmap whose
nonzero bits identify which coefficients in $i_{2,4,l}$ and $i_{2,5,l}\ $are
reported for layer $l = 1,\ldots,\upsilon$, is indicated by $i_{1,7,l}$
$$i_{1,7,l} = \lbrack i_{1,7,l,0}\ i_{1,7,l,1}\rbrack$$
$$i_{1,7,l,\tau} = \left\lbrack k_{l,0,\tau}^{\left( 3 \right)}\ldots
k_{l,M_{\upsilon} - 1,\tau}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,f,\tau}^{\left( 3 \right)} = \left\lbrack k_{l,0,f,\tau}^{\left( 3
\right)}\ldots k_{l,2L - 1,f,\tau}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,i,f,\tau}^{(3)} \in \left{ 0,1 \right}$$
Let $K_{l}^{\text{NZ}} = \sum_{\tau = 0}^{Q - 1}{\sum_{i = 0}^{2L - 1}{\sum_{f
= 0}^{M_{\upsilon} - 1}k_{l,i,f,\tau}^{(3)}}} \leq K_{0}$ be the number of
nonzero coefficients for layer $l = 1,\ldots,\upsilon$, the total number of
nonzero coefficients is reported and given by $K^{\text{NZ}} = \sum_{l =
1}^{\upsilon}K_{l}^{\text{NZ}} \leq 2K_{0}$.
The indices of $i_{2,4,l}$, $i_{2,5,l}$ and $i_{1,7,l}$ are associated to the
$Q$ codebook indices in $n_{4,l}$.
Let $\tau_{l}^{_} \in { 0,1}$, $f_{l}^{_} \in \left{ 0,1,\ldots,M_{\upsilon} -
1 \right}$ and $i_{l}^{_} \in \left{ 0,1,\ldots,2L - 1 \right}$ be the indices
which identify the strongest coefficient of layer $l$, for $\text{\ l} =
1,\ldots,\upsilon$,_ i.e._, the element
$k_{l,i_{l}^{_},f_{l}^{_},\tau_{l}^{_}}^{(2)}$ of $i_{2,4,l}$. The codebook
indices of $n_{3,l}$$k_{m_{i}}$ are remapped with respect to
$n_{3,l}^{(f_{l}^{_})}$ as $n_{3,l}^{(f)} = \left( n_{3,l}^{(f)} -
n_{3,l}^{(f_{l}^{_})} \right)\text{mod\ }N_{3}$${\widetilde{k}}_{m_{i}^{_}} =
0$, such that $n_{3,l}^{(f_{l}^{_})} = 0$, after remapping. The index $f$ is
remapped with respect to $f_{l}^{_}$ as $f = \left( f - f_{l}^{_}
\right)\text{mod\ }M_{\upsilon}$, such that the index of the strongest
coefficient is $f_{l}^{*} = 0$ ($l = 1,\ldots,\upsilon$), after remapping. The
indices of $i_{2,4,l}$, $i_{2,5,l}$ and $i_{1,7,l}$ indicate amplitude
coefficients, phase coefficients and bitmap after remapping.
The strongest coefficient of layer $l = 1,\ldots,\upsilon$ is identified by
$i_{1,8,l} \in \left{ 0,1,\ldots,2\text{LQ} - 1 \right}$, which is obtained as
follows, where, for $\upsilon = 1$, $\kappa_{1,I,0}^{(3)} =
k_{1,i,0,\tau}^{(3)}$ and index $I$ is such that $I = 2\text{Lτ} + i$
$i_{1,8,l} = \left{ \begin{matrix} \sum_{I = 0}^{{2L\tau_{1}^{_} +
i}_{1}^{_}}\kappa_{1,I,0}^{(3)} - 1 & \upsilon\mathbf{=}1 \ {2L\tau_{l}^{_} +
i}_{l}^{_} & 1  4$. The bitmap parameter _typeII-Doppler-RI-
Restriction-r18_ forms the bit sequence $r_{3},r_{2},r_{1},r_{0}$ where
$r_{0}$ is the LSB and $r_{3}$ is the MSB. When $r_{i}$ is zero, $i \in \left{
0,1,\ldots,3 \right}$, PMI and RI reporting are not allowed to correspond to
any precoder associated with $\upsilon = i + 1$ layers.
\- The value of $N_{4} = 1$ is configured by the higher layer parameter _N4_ ,
such that the PMI indicates $N_{3}$ precoder matrices for one slot interval of
duration $d$ slots, as defined in Clause 5.2.1.4.2.
The PMI value corresponds to the codebook indices of $i_{1}$ and $i_{2}$ as
described in Clause 5.2.2.2.7 and the precoder matrices for 1-4 layers are
obtained from the PMI codebook as in Table 5.2.2.2.7-3.
#### 5.2.2.3 Reference signal (CSI-RS)
##### 5.2.2.3.1 NZP CSI-RS
The UE can be configured with one or more NZP CSI-RS resource set
configuration(s) as indicated by the higher layer parameters _CSI-
ResourceConfig, and NZP-CSI-RS-ResourceSet._ Each NZP CSI-RS resource set
consists of _K_ ≥1 NZP CSI-RS resource(s).
The following parameters for which the UE shall assume non-zero transmission
power for CSI-RS resource are configured via the higher layer parameter _NZP-
CSI-RS-Resource, CSI-ResourceConfig_ and _NZP-CSI-RS-ResourceSet_ for each
CSI-RS resource configuration:
_\- nzp-CSI-RS-ResourceId determines CSI-RS resource configuration identity._
_\- periodicityAndOffset defines the CSI-RS periodicity and slot offset for
periodic/semi-persistent CSI-RS. All the CSI-RS resources within one set are
configured with the same periodicity, while the slot offset can be same or
different for different CSI-RS resources._
_\- resourceMapping defines t_ he number of ports, CDM-type, and OFDM symbol
and subcarrier occupancy of the CSI-RS resource within a slot that are given
in Clause 7.4.1.5 of [4, TS 38.211].
_\- nrofPorts_ in _resourceMapping_ _defines the number of CSI-RS ports, where
the allowable values are given in_ Clause 7.4.1.5 of [4, TS 38.211].
_\- density in resourceMapping_ _defines CSI-RS frequency density of each CSI-
RS port per PRB_ , _and CSI-RS PRB offset in case of the density value of
1/2,_ where the _allowable values are given in_ Clause 7.4.1.5 of [4, TS
38.211]. For density 1/2, the odd/even PRB allocation indicated in _density_
is with respect to the common resource block grid.
_\- cdm-Type_ _in resourceMapping_ _defines CDM values and pattern, where the
allowable values are given in Clause 7.4.1.5 of [4, TS 38.211]._
_\- powerControlOffset: which is the assumed ratio of PDSCH EPRE to_ NZP _CSI-
RS EPRE when UE derives CSI feedback and takes values in the range of [-8, 15]
dB with 1 dB step size. For CQI calculation based on a pair of NZP CSI-RS
resources, powerControlOffset of each NZP CSI-RS resource in the pair of NZP
CSI-RS resources for channel measurement is the assumed ratio of EPRE when UE
derives CSI feedback and takes values in the range of [-8, 15] dB with 1 dB
step size._
_\- powerControlOffsetSS: which is the assumed ratio of_ NZP _CSI-RS EPRE to
SS/PBCH block EPRE._
_\- scramblingID defines scrambling ID of CSI-RS with length of 10 bits._
_\- BWP-Id in CSI-ResourceConfig defines which bandwidth part the configured
CSI-RS is located in._
\- _repetition_ in _NZP-CSI-RS-ResourceSet_ is associated with a CSI-RS
resource set and defines whether UE can assume the CSI-RS resources within the
NZP CSI-RS Resource Set are transmitted with the same downlink spatial domain
transmission filter or not as described in Clause 5.1.6.1.2. and can be
configured only when the higher layer parameter _reportQuantity_ associated
with all the reporting settings linked with the CSI-RS resource set is set to
\'cri-RSRP\', \'cri-SINR\', _\'cri-RSRP- Index\', \'cri-SINR- Index\'_ or
\'none\'.
\- _qcl-InfoPeriodicCSI-RS_ contains a reference to a _TCI-State_ indicating
QCL source RS(s) and QCL type(s). If the _TCI-State_ is configured with a
reference to an RS configured with _qcl-Type_ set to \'typeD\' association,
that RS may be an SS/PBCH block located in the same or different CC/DL BWP or
a CSI-RS resource configured as periodic located in the same or different
CC/DL BWP. The reference RS may additionally be an SS/PBCH block associated
with a PCI different from the PCI of the serving cell.
\- _trs-Info_ in _NZP-CSI-RS-ResourceSet_ is associated with a CSI-RS resource
set and for which the UE can assume that the antenna port with the same port
index of the configured NZP CSI-RS resources in the _NZP-CSI-RS-ResourceSet_
is the same as described in Clause 5.1.6.1.1 and can be configured when
reporting setting is not configured or when the higher layer parameter
_reportQuantity_ associated with all the reporting settings linked with the
CSI-RS resource set is set to \'tdcp\' or \'none\'.
All CSI-RS resources within one set are configured with same _density_ and
same _nrofPorts_ , except for the NZP CSI-RS resources used for interference
measurement.
The UE expects that all the CSI-RS resources of a resource set are configured
with the same starting RB and number of RBs and the same _cdm-type_.
For a CSI-RS Resource Set for channel measurement configured with two Resource
Groups and $N$ Resource Pairs, the slot offsets of the two resources in a
Resource Pair are configured within $\ X \in { 1,2}\ $ slots, without DL/UL
switching in between the two resources, where $X = 1$ implies that the two
resources are configured in the same slot, and $X = 2$ implies that the two
resources are configured within two adjacent slots.
For a _NZP-CSI-RS-ResourceSet for channel measurement with_ $1 
N_{\text{BWP}}^{\text{size}} + N_{\text{BWP}}^{\text{start}} -
N_{\text{initial}\ \text{RB}}$, the UE shall assume that the bandwidth of the
CSI-RS resource is $N_{\text{CSI} - \text{RS}}^{\text{BW}} =
N_{\text{BWP}}^{\text{size}} + N_{\text{BWP}}^{\text{start}} -
N_{\text{initial}\ \text{RB}}$, otherwise $N_{\text{CSI} -
\text{RS}}^{\text{BW}} = \text{nrofRBs}$. In all cases, the UE shall expect
that $N_{\text{CSI} - \text{RS}}^{\text{BW}} \geq min(24,\
N_{\text{BWP}}^{\text{size}})$.
#### 5.2.2.4 Channel State Information -- Interference Measurement (CSI-IM)
The UE can be configured with one or more CSI-IM resource set configuration(s)
as indicated by the higher layer parameter _CSI-IM-ResourceSet_. Each CSI-IM
resource set consists of _K_ ≥1 CSI-IM resource(s).
The following parameters are configured via higher layer parameter _CSI-IM-
Resource_ for each CSI-IM resource configuration:
_\- csi-IM-ResourceId_ determines CSI-IM resource configuration identity
_\- subcarrierLocation-p0_ or _subcarrierLocation-p1_ defines subcarrier
occupancy of the CSI-IM resource within a slot for _csi-IM-
ResourceElementPattern_ set to \'pattern0\' or \'pattern1\', respectively.
_\- symbolLocation-p0_ or _symbolLocation-p1_ defines OFDM symbol location of
the CSI-IM resource within a slot for _csi-IM-ResourceElementPattern_ set to
\'pattern0\' or \'pattern1\', respectively.
_\- periodicityAndOffset_ defines the CSI-IM periodicity and slot offset for
periodic/semi-persistent CSI-IM.
_-_ f _reqBand_ includes parameters to enable configuration of frequency-
occupancy of CSI-IM
In each of the PRBs configured by f _reqBand,_ the UE shall assume each CSI-IM
resource is located in,
\- resource elements , , and , if _csi-IM-ResourceElementPattern_ is set to
\'pattern0\',
\- resource elements , , and if _csi-IM-ResourceElementPattern_ is set to
\'pattern1\',
where and are the configured frequency-domain location and time-domain
location, respectively, given by the higher layer parameters in the above
list.
#### 5.2.2.5 CSI reference resource definition
The CSI reference resource for a serving cell is defined as follows:
\- In the frequency domain, the CSI reference resource is defined by the group
of downlink physical resource blocks corresponding to the band to which the
derived CSI relates.
\- In the time domain, the CSI reference resource for a CSI reporting in
uplink slot _n\'_ is defined by a single downlink slot $n - n_{CSI_ ref} -
K_{\text{offset}} \cdot
\frac{2^{\mu_{\text{DL}}}}{2^{\mu_{K_{\text{offset}}}}}$_,_ where
$K_{\text{offset}}$ is a parameter configured by higher layer as specified in
clause 4.2 of [6 TS 38.213], and where $\mu_{K_{\text{offset}}}$is the
subcarrier spacing configuration for $K_{\text{offset}}$ with a value of 0 for
frequency range 1,
\- where $+ \left\lfloor \left(
\frac{N_{\text{slot},\text{offset},\text{UL}}^{\text{CA}}}{2^{\mu_{\text{offset},\text{UL}}}}
-
\frac{N_{\text{slot},\text{offset},\text{DL}}^{\text{CA}}}{2^{\mu_{\text{offset},\text{DL}}}}
\right) \bullet 2^{\mu_{\text{DL}}} \right\rfloor\ $and and are the subcarrier
spacing configurations for DL and UL, respectively, and $N_{\text{slot,\
offset}}^{\text{CA}}$ and are determined by higher-layer configured _ca-
SlotOffset_ for the cells transmitting the uplink and downlink, as defined in
clause 4.5 of [4, TS 38.211]
\- where for periodic and semi-persistent CSI reporting
\- if a single CSI-RS/SSB resource is configured for channel measurement
_n~CSI_ref~_ is the smallest value greater than or equal to $4 \cdot
2^{µ_{\text{DL}}}$, such that it corresponds to a valid downlink slot, or
\- if multiple CSI-RS/SSB resources are configured for channel measurement
_n~CSI_ref~_ is the smallest value greater than or equal to , such that it
corresponds to a valid downlink slot.
\- where for aperiodic CSI reporting, if the UE is indicated by the DCI to
report CSI in the same slot as the CSI request, _n~CSI_ref~_ is such that the
reference resource is in the same valid downlink slot as the corresponding CSI
request, otherwise _n~CSI_ref~_ is the smallest value greater than or equal to
, such that slot _n_ \- _n~CSI_ref~_ corresponds to a valid downlink slot,
where _Z\'_ corresponds to the delay requirement as defined in Clause 5.4.
\- when periodic or semi-persistent CSI-RS/CSI-IM or SSB is used for
channel/interference measurements, the UE is not expected to measure
channel/interference on the CSI-RS/CSI-IM/SSB whose last OFDM symbol is
received up to _Z\'_ symbols before transmission time of the first OFDM symbol
of the aperiodic CSI reporting.
A slot in a serving cell shall be considered to be a valid downlink slot if:
\- it comprises at least one higher layer configured downlink or flexible
symbol, and
\- it does not fall within a configured measurement gap for that UE
If there is no valid downlink slot for the CSI reference resource
corresponding to a CSI Report Setting in a serving cell, CSI reporting is
omitted for the serving cell in uplink slot _n\'_.
After the CSI report (re)configuration, serving cell activation, BWP change,
or activation of SP-CSI, the UE reports a CSI report only after receiving at
least one CSI-RS transmission occasion for channel measurement and CSI-RS
and/or CSI-IM occasion for interference measurement no later than CSI
reference resource and drops the report otherwise.
For a _CSI-ReportConfig_ configured with _codebookType_ set to \'typeII-
CJT-r18\' or \'typeII-CJT-PortSelection-r18\', the UE reports a CSI report
only after receiving at least one CSI-RS transmission occasion for each of the
CSI-RS resources in the corresponding CSI-RS Resource Set for channel
measurement and/or one CSI-IM occasion for interference measurement no later
than the CSI reference resource and within the same DRX Active Time, when DRX
is configured, and drops the report otherwise.
_For a CSI-ReportConfig_ configured with _codebookType_ set to \'typeII-
Doppler-r18\' or \'typeII-Doppler-PortSelection-r18\'_, the UE reports a CSI
report only if receiving at least one aperiodic or_ $K_{p}$ _periodic or
semipersistent consecutive CSI-RS transmission occasions for each CSI-RS
resource in the corresponding CSI-RS Resource Set for channel measurement
and/or one CSI-IM occasion for interference measurement no later than the CSI
reference resource_ and within the same DRX Active Time, when DRX is
configured, _and drops the report otherwise. The value of_ $K_{p} \in {
1,2,4}$ _is indicated by UE capability, as defined in clause 5.2.1.6._
When DRX is configured, the UE reports a CSI report only if receiving at least
one CSI-RS transmission occasion for channel measurement and CSI-RS and/or
CSI-IM occasion for interference measurement in DRX Active Time no later than
CSI reference resource and drops the report otherwise. When DRX is configured
and the CSI-RS Resource Set for channel measurement corresponding to a CSI
report is configured with two Resource Groups and $N$ Resource Pairs, as
described in clause 5.2.1.4.1, the UE reports a CSI report only if receiving
at least one CSI-RS transmission occasion for each CSI-RS resource in a
Resource Pair within the same DRX Active Time no later than CSI reference
resource and drops the report otherwise. When the UE is configured to monitor
DCI format 2_6 and if the UE configured by higher layer parameter _ps-
TransmitOtherPeriodicCSI_ to report CSI with the higher layer parameter
_reportConfigType_ set to \'periodic\' and _reportQuantity_ set to quantities
other than \'cri-RSRP\', \'ssb-Index-RSRP\', \'cri-RSRP- Index\', and \'ssb-
Index-RSRP- Index \' when _drx-onDurationTimer_ is not started, the UE shall
report CSI during the time duration indicated by _drx-onDurationTimer_ in
_DRX-Config also outside active time according to the procedure described in
Clause 5.2.1.4_ if receiving at least one CSI-RS transmission occasion for
channel measurement and CSI-RS and/or CSI-IM occasion for interference
measurement during the time duration indicated by _drx-onDurationTimer_ in
_DRX-Config_ outside DRX active time or in DRX Active Time [ ]{.underline} no
later than CSI reference resource and drops the report otherwise. When the UE
is configured to monitor DCI format 2_6 and if the UE configured by higher
layer parameter _ps-TransmitPeriodicL1-RSRP_ to report L1-RSRP with the higher
layer parameter _reportConfigType_ set to \'periodic\' and _reportQuantity_
set to \'cri-RSRP\', \'ssb-Index-RSRP\', \'cri-RSRP- Index\', or \'ssb-Index-
RSRP- Index\' when _drx-onDurationTimer_ is not started, the UE shall report
L1-RSRP during the time duration indicated by _drx-onDurationTimer_ in _DRX-
Config_ _also outside active time according to the procedure described in
clause 5.2.1.4_ and when _reportQuantity_ set to \'_cri-RSRP\'_ or _\'cri-
RSRP_ \- _Index\'_ if receiving at least one CSI-RS transmission occasion for
channel measurement during the time duration indicated by _drx-
onDurationTimer_ in _DRX-Config_ outside DRX active time or in DRX Active Time
no later than CSI reference resource and drops the report otherwise.
When deriving CSI feedback, the UE is not expected that a NZP CSI -RS resource
for channel measurement overlaps with CSI-IM resource for interference
measurement or NZP CSI -RS resource for interference measurement.
##### 5.2.2.5.1 UE assumptions for CQI/PMI/RI calculation
If configured to report CQI index, in the CSI reference resource, the UE shall
assume the following for the purpose of deriving the CQI index, and if also
configured, for deriving PMI and RI:
\- The first 2 OFDM symbols are occupied by control signaling.
\- The number of PDSCH and DM-RS symbols is equal to 12.
\- The same bandwidth part subcarrier spacing configured as for the PDSCH
reception
\- The bandwidth as configured for the corresponding CQI report.
\- The IAB-MT shall only assume the frequency resources as indicated by the DL
TX power adjustment MAC CE, if indicated for the slot of the CSI reference
resource by DL Tx Power Adjustment MAC CE as described in [10, TS 38.321].
\- The reference resource uses the CP length and subcarrier spacing configured
for PDSCH reception
\- No resource elements used by primary or secondary synchronization signals
or PBCH.
\- Redundancy Version 0.
\- The ratio of PDSCH EPRE to CSI-RS EPRE is as given in Clause 5.2.2.3.1.
\- In addition, the IAB-MT shall apply the provided DL TX power adjustment, if
indicated for the slot of the CSI reference resource by DL Tx Power Adjustment
MAC CE as described in [10, TS 38.321].
\- Assume no REs allocated for NZP CSI-RS and ZP CSI-RS.
\- Assume the same number of front-loaded DM-RS symbols as the maximum front-
loaded symbols configured by the higher layer parameter _maxLength_ in _DMRS-
DownlinkConfig._
\- Assume the same number of additional DM-RS symbols as the additional
symbols configured by the higher layer parameter _dmrs-AdditionalPosition_.
\- Assume the PDSCH symbols are not containing DM-RS.
\- Assume PRB bundling size of 2 PRBs.
\- The PDSCH transmission scheme where the UE may assume that PDSCH
transmission would be performed with up to 8 transmission layers as defined in
Clause 7.3.1.4 of [4, TS 38.211]. For CQI calculation, the UE should assume
that PDSCH signals on antenna ports in the set [1000,..., 1000+ν-1] for ν
layers would result in signals equivalent to corresponding symbols transmitted
on antenna ports [3000,..., 3000+_P_ -1], as given by
$\begin{bmatrix} y^{\left( 3000 \right)}(i) \ \cdots \ y^{\left( 3000 + P - 1
\right)}(i) \ \end{bmatrix} = W(i)\begin{bmatrix} x^{\left( 0 \right)}(i) \
\cdots \ x^{\left( \nu - 1 \right)}(i) \ \end{bmatrix}$
where is a vector of PDSCH symbols from the layer mapping defined in Clause
7.3.1.4 of [4, TS 38.211], is the number of CSI-RS ports. If only one CSI-RS
port is configured, _W(i)_ is 1. If the higher layer parameter
_reportQuantity_ in _CSI-ReportConfig_ for which the CQI is reported is set to
either \'cri-RI-PMI-CQI\' or \'cri-RI-LI-PMI-CQI\', _W(i)_ is the precoding
matrix corresponding to the reported PMI applicable to _x(i)_. If the higher
layer parameter _reportQuantity_ in _CSI-ReportConfig_ for which the CQI is
reported is set to \'cri-RI-CQI\', _W(i)_ is the precoding matrix
corresponding to the procedure described in Clause 5.2.1.4.2. If the higher
layer parameter _reportQuantity_ in _CSI-ReportConfig_ for which the CQI is
reported is set to \'cri-RI-i1-CQI\', _W(i)_ is the precoding matrix
corresponding to the reported i1 according to the procedure described in
Clause 5.2.1.4.2 _._ The corresponding PDSCH signals transmitted on antenna
ports [3000,...,3000 + _P_ \- 1] would have a ratio of EPRE to CSI-RS EPRE
equal to the ratio given in Clause 5.2.2.3.1.
##### 5.2.2.5.1a UE assumptions for CQI/PMI/RI calculation for NCJT
If the higher layer parameter _reportQuantity_ in _CSI-ReportConfig_ for which
the CQI is reported is set to either \'cri-RI-PMI-CQI\' or \'cri-RI-LI-PMI-
CQI\', the corresponding CSI-RS Resource Set for channel measurement is
configured with two Resource Groups and $N$ Resource Pairs, as described in
clause 5.2.1.4.1, the reported CRI corresponds to an entry of the $N$ Resource
Pairs, and the reported rank combination is ${\nu_{1},\nu_{2}}$, as described
in clause 5.2.1.4.2, for CQI calculation, the UE should assume that
\- PDSCH signals on antenna ports in the set $\lbrack 1000,\ldots,1000 +
\nu_{1} - 1\rbrack$ for $\nu_{1}$ layers would result in signals equivalent to
corresponding symbols transmitted on antenna ports $\lbrack 3000,\ldots,3000 +
P - 1\rbrack$ of the Group 1 CSI-RS resource in the Resource Pair indicated by
the CRI, and PDSCH signals on antenna ports in the set $\lbrack 1000 +
\nu_{1},\ldots,1000 + \nu_{1} + \nu_{2} - 1\rbrack$ for $\nu_{2}$ layers would
result in signals equivalent to corresponding symbols transmitted on antenna
ports $\lbrack 3000,\ldots,3000 + P - 1\rbrack$ of the Group 2 CSI-RS resource
in the Resource Pair indicated by the CRI, as given by
$\begin{bmatrix} y_{j}^{\left( 3000 \right)}(i) \ \cdots \ y_{j}^{\left( 3000
+ P - 1 \right)}(i) \ \end{bmatrix} = W_{j}\left( i \right)\begin{bmatrix}
x^{\left( (j - 1) \cdot \nu_{1} \right)}\left( i \right) \ \cdots \ x^{\left(
\nu_{1} + (j - 1) \cdot \nu_{2} - 1 \right)}\left( i \right) \ \end{bmatrix}$
where $W_{j}(i)$, $j = 1,2$ are the two precoding matrices corresponding to
the two reported PMIs applicable to $x(i)$, as described in clause 5.2.1.4.2;
and the indices $j = 1,2$ are associated to the two Resource Groups configured
in the corresponding CSI-RS Resource Set for channel measurement; that the
signals $y_{j}$, $j = 1,2$, fully overlap in time and frequency, and that, for
the calculation of RI, PMI and LI (if configured) of $\nu_{j}$ layers, $j =
1,2$, the interference from the other $\nu_{\left( \text{j\ }\text{mod}\ 2
\right) + 1}$ layers is derived from channel measurement and precoding matrix
corresponding to the other $\nu_{\left( \text{j\ }\text{mod}\ 2 \right) + 1}$
layers.
\- The UE shall assume that the corresponding PDSCH signals for $\nu_{j}$
layers transmitted on the $P$ antenna ports of the CSI-RS resource in Group
$j$ would have a ratio of EPRE to CSI-RS EPRE equal to the
_powerControlOffset_ of the respective CSI-RS resource, for $j = 1,2$.
\- For a UE configured with a _CSI-ReportConfig_ that contains a list of sub-
configurations provided by the higher layer parameter [_csi-
ReportSubConfigList_],
\- if a sub-configuration indicates a CSI-RS antenna port subset using the
higher layer bitmap parameter [_port-subsetIndicator_], as described in clause
5.2.1.4.2, for CQI calculation for the sub-configuration with the antenna port
subset represented by vector [3000 + _p_ ^(_0_)^, ..., 3000 + _p_ ^(_P_ \ --\
1)^]_^T^_ of size _P_ , where _P_ corresponds to the number of bits with value
1 in the bitmap [_port-subsetIndicator_], the UE should assume that PDSCH
signals on antenna ports in the set [1000,..., 1000+ν-1] for ν layers would
result in signals equivalent to corresponding symbols transmitted on antenna
ports [3000 + _p_ ^(_0_)^, ..., 3000 + _p_ ^(_P_ \ --\ 1)^] _^T^_ , as given
by
$$\begin{bmatrix} y^{\left( 3000 + \text{\ p}^{\left( 0 \right)}
\right)}\left( i \right) \ \cdots \ y^{\left( 3000 + \text{\ p}^{\left( P - 1
\right)} \right)}\left( i \right) \ \end{bmatrix} = W\left( i
\right)\begin{bmatrix} x^{\left( 0 \right)}\left( i \right) \ \cdots \
x^{\left( \nu - 1 \right)}\left( i \right) \ \end{bmatrix}$$
where _p_ ^(_j_)^ $\in \left\lbrack 0,\ldots,31 \right\rbrack\ $corresponds to
the _j_ -th enabled port in the bitmap [_port-subsetIndicator_], with _p_
^(_j_)^~\ 1$ (see Clause
5.2.2.2.10), Part 1 contains RI (if reported), the CQI (if the higher layer
parameter _TDCQI_ is set to \'1-1\' or \'1-2\') or the first CQI (if the
higher layer parameter _TDCQI_ is set to \'2\') and the total number of
reported non-zero amplitude coefficients across layers. The fields of Part 1
-- RI (if reported), CQI, and the total number of reported non-zero amplitude
coefficients across layers -- are separately encoded. Part 2 contains the
second CQI (if the higher layer parameter _TDCQI_ is set to \'2\') and the PMI
of the Enhanced Type II for predicted PMI. Part 1 and 2 are separately
encoded.
A Type II CSI report that is carried on the PUSCH shall be computed
independently from any Type II CSI report that is carried on the PUCCH formats
3 or 4 (see Clause 5.2.4 and 5.2.2).
When the higher layer parameter _reportQuantity_ is configured with one of the
values \'cri-RSRP\', \'ssb-Index-RSRP\', \'cri-SINR\' or \'ssb-Index-SINR\',
or \'cri-RSRP-Index\', \'ssb-Index-RSRP-Index\', \'cri-SINR-Index\', \'ssb-
Index-SINR-Index\', \'tdcp\', the CSI feedback consists of a single part.
For both Type I and Type II reports configured for PUCCH but transmitted on
PUSCH, the determination of the payload for CSI part 1 and CSI part 2 follows
that of PUCCH as described in Clause 5.2.4.
When CSI reporting on PUSCH comprises two parts, the UE may omit a portion of
the Part 2 CSI. Omission of Part 2 CSI is according to the priority order
shown in Table 5.2.3-1, where is the number of CSI reports configured to be
carried on the PUSCH. Priority 0 is the highest priority and priority is the
lowest priority and the CSI report _n_ corresponds to the CSI report with the
_n_ th smallest Pri~i,CSI~(_y,k,c,s_) value among the CSI reports as defined
in Clause 5.2.5. The subbands for a given CSI report _n_ indicated by the
higher layer parameter _csi-ReportingBand_ with value \'1\' are numbered
continuously in increasing order with the lowest subband of _csi-
ReportingBand_ with value set to \'1\' as subband 0. When omitting Part 2 CSI
information for a particular priority level, the UE shall omit all of the
information at that priority level, except when the corresponding CSI report
contains multiple Part 2 CSIs each of which corresponding to a sub-
configuration from a list of sub-configurations contained in the _CSI-
ReportConfig_ as described in Clause 5.2.1.1.
\- For Enhanced Type II reports and Enhanced Type II for predicted PMI
configured with higher layer parameter $N_{4} = 1$, for a given CSI report
$n$, each reported element of indices $i_{2,4,l}$ $i_{2,5,l}\ $and
$i_{1,7,l}$, indexed by $l,i$ and $f$, is associated with a priority value
$\text{Pri}\left( l,i,f \right) = 2 \cdot L \cdot \upsilon \cdot \pi\left( f
\right) + \upsilon \cdot i + l$, with $\pi(f) = min(2 \cdot n_{3,l}^{\left( f
\right)},2 \cdot \left( N_{3} - n_{3,l}^{(f)} \right) - 1)$ with $l =
1,2,\ldots,\upsilon$, $i = 0,1,\ldots,2L - 1$, and $f =
0,1,\ldots,M_{\upsilon} - 1$, and where $n_{3,l}^{(f)}$ is defined in Clause
5.2.2.2.5. The element with the highest priority has the lowest associated
value $\text{Pri}\left( l,i,f \right)$. Omission of Part 2 CSI is according to
the priority order shown in Table 5.2.3-1, where
\- Group 0 includes indices $i_{1,1}$ (if reported), $i_{1,2}$ (if reported)
and $i_{1,8,l}$ ($l = 1,\ldots,\upsilon$).
\- Group 1 includes indices $i_{1,5}$ (if reported), $i_{1,6,l}$ (if
reported), the $\upsilon 2LM_{\upsilon} - \left\lfloor K^{\text{NZ}}/2
\right\rfloor$ highest priority elements of $i_{1,7,l}$, $i_{2,3,l}$, the
$\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon
\right)$ highest priority elements of $i_{2,4,l}$ and the $\max\left(
0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon \right)$ highest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
\- Group 2 includes the $\left\lfloor K^{\text{NZ}}/2 \right\rfloor$ lowest
priority elements of $i_{1,7,l}$, the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,4,l}$ and the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
\- For Further Enhanced Type II Port Selection reports and Further Enhanced
Type II Port Selection for predicted PMI, for a given CSI report $n$, each
reported element of $i_{2,4,l}$ $i_{2,5,l}\ $and $i_{1,7,l}$, indexed by $l$,
$i$ and $f$, is associated with a priority value $\text{Pri}\left( l,i,f
\right) = K_{1} \cdot \upsilon \cdot f + \upsilon \cdot i + l$, with $l =
1,2,\ldots,\upsilon$, $i = 0,1,\ldots,K_{1} - 1$ and $f = 0,\ldots,M - 1$. The
element with the highest priority has the lowest associated value
$\text{Pri}\left( l,i,f \right)$. Omission of Part 2 CSI is according to the
priority order shown in Table 5.2.3-1, where:
\- Group 0 includes $i_{1,2}$ (if reported), $i_{1,8,l}$ ($l =
1,\ldots,\upsilon$) and $i_{1,6}$ (if reported).
\- Group 1 includes the $\upsilon K_{1}M - \left\lfloor K^{\text{NZ}}/2
\right\rfloor$ highest priority elements of $i_{1,7,l}$ (if reported),
$i_{2,3,l}$, the $\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2}
\right\rceil - \upsilon \right)$ highest priority elements of $i_{2,4,l}$ and
the $\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon
\right)$ highest priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
\- Group 2 includes the $\left\lfloor K^{\text{NZ}}/2 \right\rfloor$ lowest
priority elements of $i_{1,7,l}$ (if reported), the $\min\left( K^{\text{NZ}}
- \upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,4,l}$ and the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
\- For Enhanced Type II for CJT reports, for a given CSI report $n$, each
reported element of $i_{2,4,l}$ $i_{2,5,l}\ $and $i_{1,7,l}$, indexed by
$l,i_{j}$, $f$ and $j$, is associated with a priority value $\text{Pri}\left(
l,i_{j},f,j \right) = 2 \cdot \sum_{k = 1}^{N}L_{\sigma_{k}} \cdot \upsilon
\cdot \pi\left( f \right) + \upsilon \cdot \left( 2\sum_{k = 1}^{j -
1}L_{\sigma_{k}} + i_{j} \right) + l$, with $\pi(f) = min(2 \cdot
n_{3,l}^{\left( f \right)},2 \cdot \left( N_{3} - n_{3,l}^{(f)} \right) - 1)$,
for $l = 1,\ldots,\upsilon$, $i_{j} = 0,1,\ldots,2L_{\sigma_{j}} - 1$, $f =
0,1,\ldots,M_{\upsilon} - 1$ and $j = 1,\ldots,N$, and where $n_{3,l}^{(f)}$
and $L_{\sigma_{j}}$ are defined in Clause 5.2.2.2.8. The element with the
highest priority has the lowest associated value $\text{Pri}\left( l,i_{j},f,j
\right)$. Omission of Part 2 CSI is according to the priority order shown in
Table 5.2.3-1, where
\- Group 0 includes indices $i_{1,1}$ (if reported), $i_{1,2}$ (if reported)
and $i_{1,8,l}$ ($l = 1,\ldots,\upsilon$).
\- Group 1 includes indices $i_{1,5}$ (if reported), $i_{1,6,l}$ (if
reported), the $\upsilon 2M_{\upsilon}\sum_{k = 1}^{N}L_{\sigma_{k}} -
\left\lfloor K^{\text{NZ}}/2 \right\rfloor$ highest priority elements of
$i_{1,7,l}$, $i_{2,3,l}$, the $\max\left( 0,\left\lceil
\frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon \right)$ highest priority
elements of $i_{2,4,l}$, the $\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2}
\right\rceil - \upsilon \right)$ highest priority elements of $i_{2,5,l}$ ($l
= 1,\ldots,\upsilon$) and $i_{1,9}$ (if reported).
\- Group 2 includes the $\left\lfloor K^{\text{NZ}}/2 \right\rfloor$ lowest
priority elements of $i_{1,7,l}$, the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,4,l}$ and the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
\- For Further Enhanced Type II Port Selection for CJT reports, for a given
CSI report $n$, each reported element of $i_{2,4,l}$ $i_{2,5,l}\ $and
$i_{1,7,l}$, indexed by $l$, $i_{j}$, $f$ and $j$, is associated with a
priority value $\text{Pri}\left( l,i_{j},f,j \right) = \sum_{k = 1}^{N}K_{1,k}
\cdot \upsilon \cdot f + \upsilon \cdot \left( \sum_{k = 1}^{j - 1}K_{1,k} +
i_{j} \right) + l$, for $l = 1,\ldots,\upsilon$, $i_{j} = 0,1,\ldots,K_{1,j} -
1$, $f = 0,\ldots,M - 1$ and $j = 1,\ldots,N$, and where $K_{1,j}$ is defined
in Clause 5.2.2.2.8. The element with the highest priority has the lowest
associated value $\text{Pri}\left( l,i_{j},f,j \right)$. Omission of Part 2
CSI is according to the priority order shown in Table 5.2.3-1, where:
\- Group 0 includes $i_{1,2}$ (if reported), $i_{1,8,l}$ ($l =
1,\ldots,\upsilon$) and $i_{1,6}$ (if reported).
\- Group 1 includes the $\text{υM}\sum_{k = 1}^{N}K_{1,k} - \left\lfloor
K^{\text{NZ}}/2 \right\rfloor$ highest priority elements of $i_{1,7,l}$ (if
reported), $i_{2,3,l}$, the $\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2}
\right\rceil - \upsilon \right)$ highest priority elements of $i_{2,4,l}$, the
$\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon
\right)$ highest priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$)
and $i_{1,9}$ (if reported).
\- Group 2 includes the $\left\lfloor K^{\text{NZ}}/2 \right\rfloor$ lowest
priority elements of $i_{1,7,l}$ (if reported), the $\min\left( K^{\text{NZ}}
- \nu,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,4,l}$ and the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
\- For Enhanced Type II for predicted PMI configured with $N_{4} > 1$, for a
given CSI report $n$, each reported element of $i_{2,4,l}$ $i_{2,5,l}\ $and
$i_{1,7,l}$, indexed by $l,i$, $f$ and $j$, is associated with a priority
value $\text{Pri}\left( l,i,f,j \right) = 2L \cdot \upsilon \cdot M_{\nu}
\cdot j + 2L \cdot \upsilon \cdot f + \upsilon \cdot i + l$, for $l =
1,\ldots,\upsilon$, $i = 0,1,\ldots,2L - 1$, $f = 0,1,\ldots,M_{\upsilon} - 1$
and $j = 0,1$. The element with the highest priority has the lowest associated
value $\text{Pri}\left( l,i,f,j \right)$. Omission of Part 2 CSI is according
to the priority order shown in Table 5.2.3-1, where
\- Group 0 includes indices $i_{1,1}$ (if reported), $i_{1,2}$ (if reported),
$i_{1,8,l}$ ($l = 1,\ldots,\upsilon$) and the second wideband CQI (if
reported).
\- Group 1 includes indices $i_{1,5}$ (if reported), $i_{1,6,l}$ (if
reported), the $\upsilon 2LM_{\upsilon}Q - \left\lfloor K^{\text{NZ}}/2
\right\rfloor$ highest priority elements of $i_{1,7,l}$, $i_{2,3,l}$, the
$\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon
\right)$ highest priority elements of $i_{2,4,l}$, the $\max\left(
0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon \right)$ highest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$), $i_{1,10,l}$ (if
reported) and the second subband CQI of even subbands (if reported).
\- Group 2 includes the $\left\lfloor K^{\text{NZ}}/2 \right\rfloor$ lowest
priority elements of $i_{1,7,l}$, the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,4,l}$, the $\min\left( K^{\text{NZ}} -
\upsilon,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$) and the second
subband CQI of odd subbands (if reported).
\- For a Reporting Setting for which the _CSI-ReportConfig_ contains a list of
sub-configurations provided by the higher layer parameter [_csi-
ReportSubConfigList_], for a corresponding CSI report $n$ which contains one
or more CSIs, omission of Part 2 CSI is done at a sub-configuration level
within the same priority level defined by Table 5.2.3-1 where a sub-
configuration with an index, provided by [_csi-ReportSubConfigID_], with lower
value has higher priority.
Table 5.2.3-1: Priority reporting levels for Part 2 CSI
+----------------------------------------------------------------------+ | Priority 0: | | | | For CSI reports 1 to $N_{\text{Rep}}$, Group 0 CSI for CSI reports | | configured as \'typeII-r16\', \'typeII-PortSelection-r16\', | | \'typeII-PortSelection-r17\', \'typeII-CJT-r18\', | | \'typeII-CJT-PortSelection-r18\', \'typeII-Doppler-r18\' or | | \'typeII-Doppler-PortSelection-r18\'; Part 2 wideband CSI for CSI | | reports configured otherwise | +======================================================================+ | Priority 1: | | | | Group 1 CSI for CSI report 1, if configured as \'typeII-r16\', | | \'typeII-PortSelection-r16\', \'typeII-PortSelection-r17\', | | \'typeII-CJT-r18\', \'typeII-CJT-PortSelection-r18\', | | \'typeII-Doppler-r18\' or \'typeII-Doppler-PortSelection-r18\'; Part | | 2 subband CSI of even subbands for CSI report 1, if configured | | otherwise | +----------------------------------------------------------------------+ | Priority 2: | | | | Group 2 CSI for CSI report 1, if configured as \'typeII-r16\', | | \'typeII-PortSelection-r16\', \'typeII-PortSelection-r17\', | | \'typeII-CJT-r18\', \'typeII-CJT-PortSelection-r18\', | | \'typeII-Doppler-r18\' or \'typeII-Doppler-PortSelection-r18\'; Part | | 2 subband CSI of odd subbands for CSI report 1, if configured | | otherwise | +----------------------------------------------------------------------+ | Priority 3: | | | | Group 1 CSI for CSI report 2, if configured as \'typeII-r16\', | | \'typeII-PortSelection-r16\', \'typeII-PortSelection-r17\', | | \'typeII-CJT-r18\', \'typeII-CJT-PortSelection-r18\', | | \'typeII-Doppler-r18\' or \'typeII-Doppler-PortSelection-r18\'; Part | | 2 subband CSI of even subbands for CSI report 2, if configured | | otherwise | +----------------------------------------------------------------------+ | Priority 4: | | | | Group 2 CSI for CSI report 2, if configured as \'typeII-r16\', | | \'typeII-PortSelection-r16\', \'typeII-PortSelection-r17\', | | \'typeII-CJT-r18\', \'typeII-CJT-PortSelection-r18\', | | \'typeII-Doppler-r18\' or \'typeII-Doppler-PortSelection-r18\'; Part | | 2 subband CSI of odd subbands for CSI report 2, if configured | | otherwise | +----------------------------------------------------------------------+ | ⁞ | +----------------------------------------------------------------------+ | Priority $2N_{\text{Rep}} - 1$: | | | | Group 1 CSI for CSI report $N_{\text{Rep}}$, if configured as | | \'typeII-r16\', \'typeII-PortSelection-r16\', | | \'typeII-PortSelection-r17\', \'typeII-CJT-r18\', | | \'typeII-CJT-PortSelection-r18\', \'typeII-Doppler-r18\' or | | \'typeII-Doppler-PortSelection-r18\'; Part 2 subband CSI of even | | subbands for CSI report $N_{\text{Rep}}$, if configured otherwise | +----------------------------------------------------------------------+ | Priority $2N_{\text{Rep}}$: | | | | Group 2 CSI for CSI report $N_{\text{Rep}}$, if configured as | | \'typeII-r16\', \'typeII-PortSelection-r16\', | | \'typeII-PortSelection-r17\', \'typeII-CJT-r18\', | | \'typeII-CJT-PortSelection-r18\', \'typeII-Doppler-r18\' or | | \'typeII-Doppler-PortSelection-r18\'; Part 2 subband CSI of odd | | subbands for CSI report $N_{\text{Rep}}$, if configured otherwise | +----------------------------------------------------------------------+
When the UE is scheduled to transmit a transport block on PUSCH not using
repetition type B multiplexed with a CSI report(s) and if _numberOfSlotsTBoMS_
is not present in the resource allocation table, or if _numberOfSlotsTBoMS_ is
present in the resource allocation table and the value of _numberOfSlotsTBoMS_
in the row indicated by the Time domain resource assignment field in DCI is
equal to 1, Part 2 CSI is omitted only when {width="2.8506944444444446in"
height="0.4673611111111111in"} is larger than $\left\lceil \alpha \bullet
\sum_{l = 0}^{N_{\text{symb,all}}^{\text{PUSCH}} -
1}{M_{\text{sc}}^{\text{UCI}}\left( l \right)} \right\rceil - Q_{ACK/CG -
UCI}^{'} - Q_{\text{CSI-1}}^{'}$ or $\left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,all}}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{ACK/\lbrack UTO - UCI\rbrack}^{'} -
Q_{\text{CSI-1}}^{'}\ $when the higher layer parameter [_nrof_UTO_UCI]_ is
configured, where parameters {width="0.38958333333333334in"
height="0.2534722222222222in"}, {width="0.325in"
height="0.23402777777777778in"}, {width="0.49375in"
height="0.2465277777777778in"}, {width="0.4284722222222222in"
height="0.2534722222222222in"}, {width="0.50625in"
height="0.2534722222222222in"}, {width="0.5194444444444445in"
height="0.2534722222222222in"}, {width="0.22708333333333333in"
height="0.2534722222222222in"}, {width="0.44166666666666665in"
height="0.2534722222222222in"}, $Q_{ACK/CG - UCI}^{'}$, $Q_{ACK/\lbrack UTO -
UCI\rbrack}^{'}\ $and {width="0.15555555555555556in"
height="0.1361111111111111in"}are defined in Clause 6.3.2.4 of [5, TS 38.212].
Part 2 CSI is omitted level by level, beginning with the lowest priority level
until the lowest priority level is reached which causes the
{width="2.8506944444444446in" height="0.4673611111111111in"} to be less than
or equal to $\left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,all}}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{ACK/CG - UCI}^{'} - Q_{\text{CSI-1}}^{'}$ or
$\left\lceil \alpha \bullet \sum_{l = 0}^{N_{symb,all}^{\text{PUSCH}} -
1}{M_{\text{sc}}^{\text{UCI}}\left( l \right)} \right\rceil - - Q_{ACK/\lbrack
UTO - UCI\rbrack}^{'} - Q_{CSI - 1}^{'}$ when the higher layer parameter
[_nrof_UTO_UCI]_ is configured.
When the UE is scheduled to transmit a transport block on PUSCH not using
repetition type B multiplexed with a CSI report(s) and if _numberOfSlotsTBoMS_
is present in the resource allocation table and the value of
_numberOfSlotsTBoMS_ in the row indicated by the Time domain resource
assignment field in DCI is larger than 1, Part 2 CSI is omitted only when
$\left\lceil \frac{\left( O_{\text{CSI} - 2} + L_{CSI - 2} \right) \bullet
\beta_{\text{offset}}^{\text{PUSCH}} \bullet \sum_{l =
0}^{N_{symb,all}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)}}{\frac{1}{N_{s}}\sum_{r = 0}^{C_{UL - SCH} - 1}K_{r}} \right\rceil$
is larger than $\left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,all}}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{ACK/CG - UCI}^{'} - Q_{\text{CSI-1}}^{'}$, where
parameters {width="0.38958333333333334in" height="0.2534722222222222in"},
{width="0.325in" height="0.23402777777777778in"}, {width="0.49375in"
height="0.2465277777777778in"}, {width="0.4284722222222222in"
height="0.2534722222222222in"}, {width="0.50625in"
height="0.2534722222222222in"}, {width="0.5194444444444445in"
height="0.2534722222222222in"}, {width="0.22708333333333333in"
height="0.2534722222222222in"}, $N_{s}\ $,{width="0.44166666666666665in"
height="0.2534722222222222in"}, $Q_{ACK/CG - UCI}^{'}$ and
{width="0.15555555555555556in" height="0.1361111111111111in"}are defined in
Clause 6.3.2.4 of [5, TS 38.212].
Part 2 CSI is omitted level by level, beginning with the lowest priority level
until the lowest priority level is reached which causes the $\left\lceil
\frac{\left( O_{\text{CSI} - 2} + L_{CSI - 2} \right) \bullet
\beta_{\text{offset}}^{\text{PUSCH}} \bullet \sum_{l =
0}^{N_{symb,all}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)}}{\frac{1}{N_{s}}\sum_{r = 0}^{C_{UL - SCH} - 1}K_{r}} \right\rceil\
$to be less than or equal to $\left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,all}}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{ACK/CG - UCI}^{'} - Q_{\text{CSI-1}}^{'}$.
When the UE is scheduled to transmit a transport block on PUSCH using
repetition type B multiplexed with a CSI report(s), Part 2 CSI is omitted only
when
$$\left\lceil \frac{\left( O_{\text{CSI-2}} + L_{\text{CSI-2}} \right) \bullet
\beta_{\text{offset}}^{\text{PUSCH}} \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)}}{\sum_{r =
0}^{C_{\text{UL-SCH}} - 1}K_{r}} \right\rceil$$
is larger than
$\min\begin{Bmatrix} \left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)} \right\rceil -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'}\ ,\ \ \
\sum_{l = 0}^{N_{\text{symb,actual}}^{\text{PUSCH}} -
1}{M_{\text{sc,actual}}^{\text{UCI}}\left( l \right)} -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'} \
\end{Bmatrix}$,
or
$\min\begin{Bmatrix} \left\lceil \alpha \bullet \sum_{l =
0}^{N_{symb,nominal}^{\text{PUSCH}} - 1}{M_{sc,nominal}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{\text{ACK}/\lbrack UTO - UCI\rbrack}^{'} - Q_{CSI -
1}^{'}\ ,\ \ \ \sum_{l = 0}^{N_{symb,actual}^{\text{PUSCH}} -
1}{M_{sc,actual}^{\text{UCI}}\left( l \right)} - Q_{\text{ACK}/\lbrack UTO -
UCI\rbrack}^{'} - Q_{CSI - 1}^{'} \ \end{Bmatrix}$,
when the higher layer parameter [_nrof_UTO_UCI]_ is configured, where
parameters {width="0.38958333333333334in" height="0.2534722222222222in"},
{width="0.325in" height="0.23402777777777778in"}, {width="0.49375in"
height="0.2465277777777778in"},
$N_{\text{symb}\text{,nominal}}^{\text{PUSCH}}$,
$N_{\text{symb}\text{,actual}}^{\text{PUSCH}}$,
$M_{\text{sc}\text{,nominal}}^{\text{UCI}}\left( l \right)$,
$M_{\text{sc}\text{,actual}}^{\text{UCI}}\left( l \right)$,
{width="0.5194444444444445in" height="0.2534722222222222in"},
{width="0.22708333333333333in" height="0.2534722222222222in"}, $Q_{ACK/CG -
UCI}^{'}$, $Q_{ACK/\lbrack UTO - UCI\rbrack}^{'},\
${width="0.44166666666666665in" height="0.2534722222222222in"}, and
{width="0.15555555555555556in" height="0.1361111111111111in"}are defined in
Clause 6.3.2.4 of [5, TS 38.212].
Part 2 CSI is omitted level by level, beginning with the lowest priority level
until the lowest priority level is reached which causes
$$\left\lceil \frac{\left( O_{\text{CSI-2}} + L_{\text{CSI-2}} \right) \bullet
\beta_{\text{offset}}^{\text{PUSCH}} \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)}}{\sum_{r =
0}^{C_{\text{UL-SCH}} - 1}K_{r}} \right\rceil$$
to be less than or equal to
$\min\begin{Bmatrix} \left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)} \right\rceil -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'}\ ,\ \ \
\sum_{l = 0}^{N_{\text{symb,actual}}^{\text{PUSCH}} -
1}{M_{\text{sc,actual}}^{\text{UCI}}\left( l \right)} -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'} \
\end{Bmatrix}$,
or
$\min\begin{Bmatrix} \left\lceil \alpha \bullet \sum_{l =
0}^{N_{symb,nominal}^{\text{PUSCH}} - 1}{M_{sc,nominal}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{\text{ACK}/\lbrack UTO - UCI\rbrack}^{'} - Q_{CSI -
1}^{'}\ ,\ \ \ \sum_{l = 0}^{N_{symb,actual}^{\text{PUSCH}} -
1}{M_{sc,actual}^{\text{UCI}}\left( l \right)} - Q_{\text{ACK}/\lbrack UTO -
UCI\rbrack}^{'} - Q_{CSI - 1}^{'} \ \end{Bmatrix}$,
when the higher layer parameter [_nrof_UTO_UC]I_ is configured.
When part 2 CSI is transmitted on PUSCH with no transport block, lower
priority bits are omitted until Part 2 CSI code rate, which is given by
$\left( O_{\text{CSI-2}} + L_{\text{CSI-2}} \right)/(N_{L} \cdot
Q'_{\text{CSI,2}} \cdot Q_{m})$ where $O_{\text{CSI-2}}$, $L_{\text{CSI-2}}$,
$N_{L},Q'_{\text{CSI,2}},Q_{m}$ are given in clause 6.3.2.4 of [5, 38.212]
before HARQ-ACK puncturing part 2 CSI if any, is below a threshold code rate
lower than one, where
\- is the CSI offset value from Table 9.3-2 of [6, TS 38.213]
\- _R_ is signaled code rate in DCI
If the UE is in an active semi-persistent CSI reporting configuration on
PUSCH, the CSI reporting is deactivated when either the downlink BWP or the
uplink BWP is changed. Another activation command is required to enable the
semi-persistent CSI reporting.
### 5.2.4 CSI reporting using PUCCH
A UE is semi-statically configured by higher layers to perform periodic CSI
Reporting on the PUCCH. A UE can be configured by higher layers for multiple
periodic CSI Reports corresponding to multiple higher layer configured CSI
Reporting Settings, where the associated CSI Resource Settings are higher
layer configured. For a Reporting Setting for which the _CSI-ReportConfig_
contains a list of sub-configurations provided by the higher layer parameter
[_csi-ReportSubConfigList_], CSI reporting is provided for all the sub-
configurations in each corresponding reporting instance. Periodic CSI
reporting on PUCCH formats 2, 3, 4 supports Type I CSI with wideband
granularity.
A UE shall perform semi-persistent CSI reporting on the PUCCH applied starting
from the first slot that is after slot $n + {3N}_{\text{slot}}^{subframe,µ}$
when the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the activation command described in clause
6.1.3.16 of [10, TS 38.321] where _μ_ is the SCS configuration for the PUCCH.
The activation command will contain one or more Reporting Settings, [with or
without containing one or more sub-configurations for each Reporting Setting
for which the _CSI-ReportConfig_ contains a list of sub-configurations
provided by the higher layer parameter [_csi-ReportSubConfigList_]], where the
associated CSI Resource Settings are configured. Semi-persistent CSI reporting
on the PUCCH supports Type I CSI. Semi-persistent CSI reporting on the PUCCH
format 2 supports Type I CSI with wideband frequency granularity. Semi-
persistent CSI reporting on PUCCH formats 3 or 4 supports Type I CSI with
wideband and sub-band frequency granularities and Type II CSI Part 1.
When the PUCCH carry Type I CSI with wideband frequency granularity, the CSI
payload carried by the PUCCH format 2 and PUCCH formats 3, or 4 are identical
and the same irrespective of RI (if reported), CRI (if reported). A CSI-
ReportConfig with _codebookType_ set to \'typeI-SinglePanel\' and the
corresponding CSI-RS Resource Set for channel measurement configured with two
Resource Groups and $N$ Resource Pairs can be configured with wideband
frequency granularity only with _csi-ReportMode_ set to \'Mode1\' and
_numberOfSingleTRP-CSI-Mode1_ set to $X = 0$. For type I CSI sub-band
reporting on PUCCH formats 3, or 4, the payload is split into two parts. The
first part contains RI (if reported), CRI (if reported), CQI for the first
codeword. The second part contains PMI (if reported), LI (if reported) and
contains the CQI for the second codeword (if reported) when RI > 4\. For a
_CSI-ReportConfig_ configured with subband reporting, _codebookType_ set to
\'typeI-SinglePanel\' and the corresponding CSI-RS Resource Set for channel
measurement configured with two Resource Groups and $N$ Resource Pairs, Part 1
contains RI(s), CRI(s), CQI(s) for the first codeword and is zero padded to a
fixed payload size (if needed). Part 2 contains the CQI(s) for the second
codeword (if reported) when RI is larger than 4, LIs (if reported) and PMI(s).
For a _CSI-ReportConfig_ containing a list of sub-configurations provided by
the higher layer parameter [_csi-ReportSubConfigList_], and configured with
subband reporting, for Type I CSI for one or more of the sub-configurations,
Part 1 for a sub-configuration contains corresponding RI (if reported), CRI
(if reported), CQI for the first codeword (if reported) and is zero padded to
a fixed payload size (if needed). Part 2 for a sub-configuration contains the
corresponding CQI for the second codeword (if reported) when RI is larger than
4, LI (if reported) and PMI (if reported).
A semi-persistent report carried on the PUCCH formats 3 or 4 supports Type II
CSI feedback, but only Part 1 of Type II CSI feedback (See Clause 5.2.2 and
5.2.3). Supporting Type II CSI reporting on the PUCCH formats 3 or 4 is a UE
capability _type2-SP-CSI-Feedback-LongPUCCH_. A Type II CSI report (Part 1
only) carried on PUCCH formats 3 or 4 shall be calculated independently of any
Type II CSI reports carried on the PUSCH (see Clause 5.2.3).
When the UE is configured with CSI Reporting on PUCCH formats 2, 3 or 4, each
PUCCH resource is configured for each candidate UL BWP.
If the UE is in an active semi-persistent CSI reporting configuration on PUCCH
and has not received a deactivation command, the CSI reporting takes place
when the BWP in which the reporting is configured to take place is the active
BWP, otherwise the CSI reporting is suspended.
A UE is not expected to report CSI with a total number of UCI bits and CRC
bits larger than 115 bits when configured with PUCCH format 4. For CSI reports
transmitted on a PUCCH, if all CSI reports consist of one part, the UE may
omit a portion of CSI reports. Omission of CSI is according to the priority
order determined from the Pri~i,CSI~(_y,k,c,s_) value as defined in Clause
5.2.5. CSI report is omitted beginning with the lowest priority level until
the CSI report code rate is less or equal to the one configured by the higher
layer parameter _maxCodeRate_.
If any of the CSI reports consist of two parts, the UE may omit a portion of
Part 2 CSI. Omission of Part 2 CSI is according to the priority order shown in
Table 5.2.3-1. For a Reporting Setting for which the _CSI-ReportConfig_
contains a list of sub-configurations provided by the higher layer parameter
[_csi-ReportSubConfigList_], for a given CSI report which contains one or more
CSIs, omission of Part 2 CSI is defined in Clause 5.2.3. Part 2 CSI is omitted
beginning with the lowest priority level until the Part 2 CSI code rate is
less or equal to the one configured by higher layer parameter _maxCodeRate_.
### 5.2.5 Priority rules for CSI reports
For two overlapping PUSCHs, the priority rules in this clause are applied for
physical channels with same priority index according to clause 9 in [6, TS
38.213] if a UE is not configured with _enableSTx2PofmDCI_ or a UE is
configured by higher layer parameter _PDCCH-Config_ that contains two
different values of _coresetPoolIndex_ in _ControlResourceSet_ and the UE is
configured with _enableSTx2PofmDCI_ and the two overlapping PUSCHs are
associated with same value of _coresetPoolIndex_.
CSI reports are associated with a priority value
$\text{Pri}_{\text{iCSI}}\left( y,k,c,s \right) = 2 \bullet N_{\text{cells}}
\bullet M_{s} \bullet y + N_{\text{cells}} \bullet M_{s} \bullet k + M_{s}
\bullet c + s$ where
\- for aperiodic CSI reports to be carried on PUSCH for semi-persistent CSI
reports to be carried on PUSCH, for semi-persistent CSI reports to be carried
on PUCCH and for periodic CSI reports to be carried on PUCCH;
\- for CSI reports carrying L1-RSRP or L1-SINR and for CSI reports not
carrying L1-RSRP or L1-SINR;
\- _c_ is the serving cell index and $N_{\text{cells}}$ is the value of the
higher layer parameter _maxNrofServingCells_ ;
> \- _s_ is the _reportConfigID_ and is the value of the higher layer
> parameter _maxNrofCSI-ReportConfigurations._
A first CSI report is said to have priority over second CSI report if the
associated value is lower for the first report than for the second report.
Two CSI reports are said to collide if the time occupancy of the physical
channels scheduled to carry the CSI reports overlap in at least one OFDM
symbol and are transmitted on the same carrier. When a UE is configured to
transmit two colliding CSI reports,
\- if _y_ values are different between the two CSI reports, the following
rules apply except for the case when one of the _y_ value is 2 and the other
_y_ value is 3 (for CSI reports transmitted on PUSCH, as described in Clause
5.2.3; for CSI reports transmitted on PUCCH, as described in Clause 5.2.4):
\- The CSI report with higher value shall not be sent by the UE.
\- otherwise, the two CSI reports are multiplexed or either is dropped based
on the priority values, as described in Clause 9.2.5.2 in [6, TS 38.213].
If a semi-persistent CSI report to be carried on PUSCH overlaps in time with
PUSCH data transmission in one or more symbols on the same carrier, and if the
earliest symbol of these PUSCH channels starts no earlier than N~2~+d~2,1~
symbols after the last symbol of the DCI scheduling the PUSCH where d~2,1~ is
the maximum of the d~2,1~ associated with the PUSCH carrying semi-persistent
CSI report and the PUSCH with data transmission, the CSI report shall not be
transmitted by the UE. Otherwise, if the timeline requirement is not satisfied
this is an error case.
If a UE would transmit a first PUSCH that includes semi-persistent CSI reports
and a second PUSCH that includes an UL-SCH on the same carrier, and the first
PUSCH transmission would overlap in time with the second PUSCH transmission,
the UE does not transmit the first PUSCH and transmits the second PUSCH. The
UE expects that the first and second PUSCH transmissions satisfy the above
timing conditions for PUSCH transmissions that overlap in time when at least
one of the first or second PUSCH transmissions is in response to a DCI format
detection by the UE.
## 5.3 UE PDSCH processing procedure time
If the first uplink symbol of the PUCCH which carries the HARQ-ACK
information, as defined by the assigned HARQ-ACK timing _K~1\ ~_ and
K~offset~, if configured, and the PUCCH resource to be used and including the
effect of the timing advance, starts no earlier than at symbol _L~1~_ , where
_L~1~_ is defined as the next uplink symbol with its CP starting after after
the end of the last symbol of the PDSCH carrying the TB being acknowledged,
then the UE shall provide a valid HARQ-ACK message.
_\- N~1~_ is based on _µ_ of table 5.3-1 and table 5.3-2 for UE processing
capability 1 and 2 respectively, where _µ_ corresponds to the one of
(_µ~PDCCH~_ , _µ~PDSCH~_ , _µ~UL~_) resulting with the largest _T~proc,1~_ ,
where the _µ~PDCCH~_ corresponds to the subcarrier spacing of the PDCCH
scheduling the PDSCH, the _µ~PDSCH~_ corresponds to the subcarrier spacing of
the scheduled PDSCH, and _µ~UL~_ corresponds to the subcarrier spacing of the
uplink channel with which the HARQ-ACK is assumed to be transmitted regardless
of whether or not the PDSCH reception provides a transport block for a HARQ
process with disabled HARQ-ACK information as indicated by _HARQ-
feedbackEnabling-disablingperHARQprocess_ , if provided, and κ is defined in
clause 4.1 of [4, TS 38.211].
_-_ For operation with shared spectrum channel access in FR1, is calculated
according to [4, TS 38.211], otherwise =0.
_-_ If the PDSCH DM-RS position $l_{1}$ for the additional DM-RS in Table
7.4.1.1.2-3 in clause 7.4.1.1.2 of [4, TS 38.211] is $l_{1} = 12$ then
_N~1,0~=14_ in Table 5.3-1 _,_ otherwise _N~1,0~=13._
\- If the UE is configured with multiple active component carriers, the first
uplink symbol which carries the HARQ-ACK information further includes the
effect of timing difference between the component carriers as given in [11, TS
38.133].
\- For the PDSCH mapping type A as given in clause 7.4.1.1 of [4, TS 38.211]:
if the last symbol of PDSCH is on the _i-_ th symbol of the slot where _i_ \ 1$, _codebookType_ is set to \'typeII-Doppler-r18\' and the
corresponding _NZP-CSI-RS-ResourceSet_ for channel measurement is aperiodic
with $K$ CSI-RS resources, or
\- $(Z_{2} + w,Z_{2}^{'})$ or $(Z_{2} + w + Z_{2}^{'},{2Z}_{2}^{'})$,
according to UE reported capability, with $(Z_{2},Z_{2}^{'})$ of table 5.4-2,
if the CSI report is configured with $N_{4} > 1$, _codebookType_ is set to
\'typeII-Doppler-r18\' and the corresponding _NZP-CSI-RS-ResourceSet_ for
channel measurement is periodic or semi-persistent with a single CSI-RS
resource, or
\- $(Z_{2},Z_{2}^{'})$ of table 5.4-2 otherwise.
_\- µ_ of table 5.4-1 and table 5.4-2 corresponds to the min (_µ~PDCCH~_ ,
_µ~CSI-RS~, µ~UL~_) where the _µ~PDCCH~_ corresponds to the subcarrier spacing
of the PDCCH with which the DCI was transmitted and _µ~UL~_ corresponds to the
subcarrier spacing of the PUSCH with which the CSI report is to be transmitted
and _µ~CSI-RS~_ corresponds to the minimum subcarrier spacing of the aperiodic
CSI-RS triggered by the DCI
Table 5.4-1: CSI computation delay requirement 1
      *Z~1~* \[symbols\]
* * *
      *Z~1~*               *Z\'~1~*
0 10 8 1 13 11 2 25 21 3 43 36
Table 5.4-2: CSI computation delay requirement 2
      *Z~1~* \[symbols\]   *Z~2~* \[symbols\]   *Z~3~* \[symbols\]
* * *
      *Z~1~*               *Z\'~1~*             *Z~2~*               *Z\'~2~*   *Z~3~*                                                              *Z\'~3~*
0 22 16 40 37 22 _X_ ~0~ 1 33 30 72 69 33 _X_ ~1~ 2 44 42 141 140
[min(44,]{.underline}$\text{\ X}_{3}$[_X_ ~2~+ KB~1~)]{.underline} _X_ ~2~ 3
97 85 152 140 [min(97, _X_ ~3~+ KB~2~)]{.underline} _X_ ~3~ 5 388 340 608 560
[min(388, X5+ KB3) ]{.underline} _X5 * 6 776 680 1216 1120 [min(776, X6+ KB4)
]{.underline}_ X6 *
## 5.5 UE PDSCH reception preparation time with cross carrier scheduling with
different subcarrier spacings for PDCCH and PDSCH
This clause applies only if the PDCCH carrying the scheduling DCI is received
on one carrier with one OFDM subcarrier spacing (µ~PDCCH~), and the PDSCH
scheduled to be received by the DCI is on another carrier with another OFDM
subcarrier spacing (µ~PDSCH~).
If the µ~PDCCH~ \ µ~PDSCH~, the UE is expected to receive the scheduled PDSCH,
if the first symbol in the PDSCH allocation, including the DM-RS, as defined
by the slot offset _K~0~_ and the start and length indicator _SLIV_ of the
scheduling DCI starts no earlier than _N~pdsch~_ PDCCH symbols after the end
of the PDCCH scheduling the PDSCH, not taking into account the effect of
receive timing difference between the scheduling cell and the scheduled cell.
When the PDCCH reception includes two PDCCH candidates from two respective
search space sets, as described in clause 10.1 of [6, TS 38.213], for the
purpose of determining _N~pdsch~_ , the PDCCH candidate that ends later in
time is used.
Table 5.5-1: _N~pdsch~_ as a function of the subcarrier spacing of the
scheduling PDCCH
**_µ~PDCCH~_** **_N~pdsch~_ [symbols]**
* * *
0 4 1 5 2 10 3 14 5 56 6 112
# 6 Physical uplink shared channel related procedure
## 6.1 UE procedure for transmitting the physical uplink shared channel
PUSCH transmission(s) can be dynamically scheduled by an UL grant in a DCI, or
the transmission can correspond to a configured grant Type 1 or Type 2. The
configured grant Type 1 PUSCH transmission is semi-statically configured to
operate upon the reception of higher layer parameter of _configuredGrantConfig
including rrc-ConfiguredUplinkGrant_ without the detection of an UL grant in a
DCI. The configured grant Type 2 PUSCH transmission is semi-persistently
scheduled by an UL grant in a valid activation DCI according to clause 10.2 of
[6, TS 38.213] after the reception of higher layer parameter
_configuredGrantConfig_ not including _rrc-ConfiguredUplinkGrant_. If
_configuredGrantConfigToAddModList_ is configured, more than one configured
grant configuration of configured grant Type 1 and/or configured grant Type 2
may be active at the same time on an active BWP of a serving cell.
The UE can be configured with a list of up to 64 _TCI-UL-State_ configurations
within the higher layer parameter _BWP-UplinkDedicated._ Each _TCI-UL-State_
configuration contains a parameter for configuring one reference signal, if
applicable, for determining UL TX spatial filter for dynamic-grant and
configured-grant based PUSCH and PUCCH resource in a CC, and SRS.
If a UE is configured by higher layer parameter _PDCCH-Config_ that contains
_ControlResourceSets_ with two different values of _coresetPoolIndex_ for the
active BWP of a serving cell, or if a UE is configured with _SSB-MTC-
AddtionalPCI_ and with _PDCCH-Config_ that contains two different values of
_coresetPoolIndex_ in _ControlResourceSet_ , and if the UE is configured with
[_twoTAGs_] and is configured with _dl-OrJointTCI-StateList_ or _TCI-UL-State_
for a serving cell, each _TCI-State_ or _TCI-UL-State_ is associated with a
[_TAG-ID_] for determining timing adjustment for a corresponding UL
transmission as described in Clause 4.2 of [6, TS 38.213]. The UE does not
expect that _TCI-states_ or _TCI-UL-States_ associated with one
_coresetPoolIndex_ to correspond to two TAGs [except if reported by [UE
capability]].
For the PUSCH transmission corresponding to a Type 1 configured grant or a
Type 2 configured grant activated by DCI format 0_0 or 0_1, the parameters
applied for the transmission are provided by _configuredGrantConfig_ except
for _dataScramblingIdentityPUSCH_ , _txConfig_ , _codebookSubset_ , _maxRank_
, _scaling_ of _UCI-OnPUSCH,_ which are provided by _pusch-Config_. For the
PUSCH transmission corresponding to a Type 2 configured grant activated by DCI
format 0_2, the parameters applied for the transmission are provided by
_configuredGrantConfig_ except for _dataScramblingIdentityPUSCH_ , _txConfig_
, _codebookSubsetDCI-0-2_ , _maxRankDCI-0-2_ , _scaling_ of _UCI-OnPUSCH,
resourceAllocationType1GranularityDCI-0-2_ provided by _pusch-Config_. If the
UE is provided with _transformPrecoder in configuredGrantConfig, the UE
applies the higher layer parameter tp-pi2BPSK_ , if provided in _pusch-Config_
, according to the procedure described in clause 6.1.4 for the PUSCH
transmission corresponding to a configured grant.
When the UE is configured _dl-OrJointTCI-StateList_ or _ul-TCI-StateList_ ,
the UE shall perform PUSCH transmission corresponding to a Type 1 configured
grant or a Type 2 configured grant or a dynamic grant according to the spatial
relation, if applicable, with a reference to the RS for determining UL Tx
spatial filter. The RS is determined based on an RS configured with _qcl-Type_
set to \'typeD\' of the indicated _TCI-State_ or an RS in the indicated _TCI-
UL-State_. The reference RS in the indicated _TCI-State_ can be a CSI-RS
resource in a _NZP-CSI-RS-ResourceSet_ configured with higher layer parameter
_repetition_ , or a CSI-RS resource in an _NZP-CSI-RS-ResourceSet_ configured
with higher layer parameter _trs-Info._ The reference RS in the indicated
_TCI-UL-State_ can be a CSI-RS resource in a _NZP-CSI-RS-ResourceSet_
configured with higher layer parameter _repetition_ , a CSI-RS resource in an
_NZP-CSI-RS-ResourceSet_ configured with higher layer parameter _trs-Info_ ,
an SRS resource in an SRS resource set with the higher layer parameter _usage_
set to \'beamManagement\', or SS/PBCH block associated with the same or
different PCI from the PCI of the serving cell. When _[nrofSlots_InCGperiod]_
is configured for Type 1 configured grant or Type 2 configured grant, HARQ
process ID for the K^th^ (1 \ if then
>
> else
>
> where, and
\- For PUSCH repetition Type B, the starting symbol _S_ relative to the start
of the slot, and the number of consecutive symbols _L_ counting from the
symbol _S_ allocated for the PUSCH are provided by _startSymbol_ and _length_
of the indexed row of the resource allocation table, respectively.
\- For PUSCH repetition Type A and TB processing over multiple slots, the
PUSCH mapping type is set to Type A or Type B as defined in Clause 6.4.1.1.3
of [4, TS 38.211] as given by the indexed row.
\- For PUSCH repetition Type B, the PUSCH mapping type is set to Type B.
The UE shall consider the _S_ and _L_ combinations defined in table 6.1.2.1-1
as valid PUSCH allocations
Table 6.1.2.1-1: Valid _S_ and _L_ combinations
PUSCH mapping type Normal cyclic prefix Extended cyclic prefix
* * *
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
Type A (repetition Type A only) 0 {4,...,14} {4,...,14} 0 {4,...,12}
{4,...,12} Type B {0,...,13} {1,...,14} {1,...,14} for repetition Type A,
{1,...,27} for repetition Type B {0,..., 11} {1,...,12} {1,...,12} for
repetition Type A, {1,...,23} for repetition Type B
For TB processing over multiple slots, when transmitting PUSCH scheduled by
DCI format 0_1 or 0_2 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI, or
CS-RNTI with NDI=1,
> \- the number of slots used for TBS determination _N_ is indicated by
> _numberOfSlotsTBoMS._
>
> \- the number of repetitions _K_ of the number of slots _N_ used for TBS
> determination is determined as
>
> \- if _numberOfRepetitions_ is present in the resource allocation table, the
> number of repetitions _K_ is equal to _numberOfRepetitions_ ;
>
> \- otherwise, _K=1_.
>
> \- when the UE supports repetition of TB processing over multiple slots, the
> UE does not expect that $N \bullet K$ is larger than 32.
When configured **with μ= 5 or 6** _the_ UE does not expect to be scheduled
with more than one PUSCH in a slot, by a single DCI or multiple DCIs[, where
multiple DCIs are not associated with CORESETs having different
_coresetpoolIndex_]{.underline}.
For PUSCH repetition Type A, when transmitting PUSCH scheduled by DCI format
0_1, 0_2 or 0_3 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI, or
scheduled by DCI format 0_1 or 0_2 in PDCCH with CRC scrambled CS-RNTI with
NDI=1, the number of repetitions _K_ is determined as
\- if _numberOfRepetitions_ is present in the resource allocation table, the
number of repetitions K is equal to _numberOfRepetitions_ ;
\- elseif the UE is configured with _pusch-AggregationFactor_ , the number of
repetitions _K_ is equal to _pusch-AggregationFactor_ ;
\- otherwise _K=1_.
\- the number of slots used for TBS determination _N_ is equal to 1.
For PUSCH repetition type A, when transmitting PUSCH scheduled by RAR UL
grant, the 2 MSBs of the MCS information field of the RAR UL grant provide a
codepoint to determine the number of repetitions _K_ according to Table
6.1.2.1-1A, based on whether or not the higher layer parameter
_numberOfMsg3-RepetitionsList_ is configured. The number of slots used for TBS
determination N is equal to 1.
For PUSCH repetition type A, when transmitting PUSCH scheduled by DCI format
0_0 with CRC scrambled by TC-RNTI, the 2 MSBs of the MCS information field of
the DCI format 0_0 with CRC scrambled by TC-RNTI provide a codepoint to
determine the number of repetitions _K_ according to Table 6.1.2.1-1A, based
on whether or not the higher layer parameter _numberOfMsg3-RepetitionsList_ is
configured. The number of slots used for TBS determination N is equal to 1.
Table 6.1.2.1-1A: Number of repetition _K_ as a function of 2 MSBs of MCS
information field
_numberOfMsg3-RepetitionsList is configured_ _numberOfMsg3-RepetitionsList is
not configured_
* * *
_Codepoint_ _K_ Codepoint _K_ 00 First value of _numberOfMsg3-RepetitionsList_
00 1 01 Second value of _numberOfMsg3-RepetitionsList_ 01 2 10 Third value of
_numberOfMsg3-RepetitionsList_ 10 3 11 Fourth value of
_numberOfMsg3-RepetitionsList_ 11 4
If a UE is configured with higher layer parameter _pusch-
TimeDomainAllocationListForMultiPUSCH_ , the UE does not expect to be
configured with _pusch-AggregationFactor._
If a UE is configured with _extendedK2 in_ _pusch-
TimeDomainAllocationListForMultiPUSCH_ in which one or more rows contain
multiple SLIVs for PUSCH on a UL BWP of a serving cell, the UE does not apply
_pusch-AggregationFactor,_ if configured, to DCI format 0_1 on the UL BWP of
the serving cell and the UE does not expect to be configured with
_numberOfRepetitions_ in _pusch-TimeDomainAllocationListForMultiPUSCH_.
If a UE is configured with _extendedK2 in_ _pusch-
TimeDomainAllocationListForMultiPUSCH_ in which one or more rows contain
multiple _SLIV_ s for PUSCH on a UL BWP of a serving cell, when any two UL
DCIs end in the same symbol and at least one of the DCIs scheduling multiple
PUSCHs, the UE does not expect that the any scheduled multiple PUSCHs have
overlapping spans, where the span associated with a DCI is defined from the
beginning of the first scheduled PUSCH till the end of the last scheduled
PUSCH.
For unpaired spectrum:
\- When _AvailableSlotCounting_ is enabled, and in case _K >1,_ the UE
determines $N \bullet K$ slots for a PUSCH transmission of a PUSCH repetition
type A scheduled by DCI format 0_1 or 0_2, based on _tdd-UL-DL-
ConfigurationCommon_ , _tdd-UL-DL-ConfigurationDedicated_ _and ssb-
PositionsInBurst_ , and the TDRA information field value in the DCI format 0_1
or 0_2.
\- A slot is not counted in the number of $N \bullet K$ slots for PUSCH
transmission of a PUSCH repetition Type A scheduled by DCI format 0_1 or 0_2
if at least one of the symbols indicated by the indexed row of the used
resource allocation table in the slot overlaps with a DL symbol indicated by
_tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ if
provided, or a symbol of an SS/PBCH block with index provided by _ssb-
PositionsInBurst_.
\- Otherwise, the UE determines $N \bullet K$ consecutive slots for a PUSCH
transmission of a PUSCH repetition type A scheduled by DCI format 0_1 or 0_2,
based on the TDRA information field value in the DCI format 0_1 or 0_2.
\- The UE determines $N \bullet K$ slots for a PUSCH transmission of TB
processing over multiple slots scheduled by DCI format 0_1 or 0_2, based on
_tdd-UL-DL-ConfigurationCommon_ , _tdd-UL-DL-ConfigurationDedicated_ and _ssb-
PositionsInBurst_ , and the TDRA information field value in the DCI format 0_1
or 0_2.
\- A slot is not counted in the number of $N \bullet K$ slots for a PUSCH
transmission of TB processing over multiple slots if at least one of the
symbols indicated by the indexed row of the used resource allocation table in
the slot overlaps with a DL symbol indicated by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ if provided, or a
symbol of an SS/PBCH block with index provided by _ssb-PositionsInBurst_.
\- The UE determines $N \bullet K$ slots for a PUSCH transmission of a PUSCH
repetition Type A scheduled by RAR UL grant, based on _tdd-UL-DL-
ConfigurationCommon_ and _ssb-PositionsInBurst,_ and the TDRA information
field value in the RAR UL grant.
\- A slot is not counted in the number of $N \bullet K$ slots for a PUSCH
transmission of a PUSCH repetition Type A scheduled by RAR UL grant, if at
least one of the symbols indicated by the indexed row of the used resource
allocation table in the slot overlaps with a DL symbol indicated by _tdd-UL-
DL-ConfigurationCommon_ if provided, or a symbol of an SS/PBCH block with
index provided by _ssb-PositionsInBurst_.
\- The UE determines $N \bullet K$ slots for a PUSCH transmission of a PUSCH
repetition Type A scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI,
based on _tdd-UL-DL-ConfigurationCommon_ and _ssb-PositionsInBurst_ and the
TDRA information field value in the DCI scheduling the PUSCH.
\- A slot is not counted in the number of $N \bullet K$ slots for a PUSCH
transmission of a PUSCH repetition Type A scheduled by DCI format 0_0
scrambled by TC-RNTI, if at least one of the symbols indicated by the indexed
row of the used resource allocation table in the slot overlaps with a DL
symbol indicated by _tdd-UL-DL-ConfigurationCommon_ if provided, or a symbol
of an SS/PBCH block with index provided by _ssb-PositionsInBurst_.
For paired spectrum and SUL band:
\- The UE determines $N \bullet K$ consecutive slots for a PUSCH transmission
of a PUSCH repetition type A scheduled by DCI format 0_1 or 0_2, or 0_3 for
paired spectrum only, or for a PUSCH transmission of TB processing over
multiple slots scheduled by DCI format 0_1 or 0_2, based on the TDRA
information field value in the DCI format 0_1, 0_2 or 0_3.
\- For the case of a reduced capability half-duplex UE, the UE determines $N
\bullet K$ slots for a PUSCH transmission of a PUSCH repetition type A
scheduled by DCI format 0_1 or 0_2 when _AvailableSlotCounting_ is enabled and
K>1, or for a PUSCH transmission of TB processing over multiple slots
scheduled by DCI format 0_1 or 0_2, based on the TDRA information field value
in the DCI format 0_1 or 0_2. A slot is not counted in the number of $N
\bullet K$ slots if at least one of the symbols indicated by the indexed row
of the used resource allocation table in the slot does not start or end at
least $N_{\text{R}\text{x-}\text{T}\text{x}} \cdot T_{\text{c}}$ or
$N_{\text{T}\text{x-}\text{R}\text{x}} \cdot T_{\text{c}}$, respectively, from
the last or first symbol of an SS/PBCH block with index provided by _ssb-
PositionsInBurst_.
\- The UE determines $N \bullet K$ consecutive slots for a PUSCH transmission
of a PUSCH repetition Type A scheduled by RAR UL grant, based on the TDRA
information field value in the RAR UL grant.
\- The UE determines $N \bullet K$ consecutive slots for a PUSCH transmission
of a PUSCH repetition Type A scheduled by DCI format 0_0 with CRC scrambled by
TC-RNTI, based on the TDRA information field value in the DCI scheduling the
PUSCH.
If a UE would transmit a PUSCH of PUSCH repetition Type A when
_AvailableSlotCounting_ is enabled and K>1 or a TB processing over multiple
slots over $N \bullet K$ slots, and the UE does not transmit the PUSCH of a TB
processing over multiple slots or the PUSCH repetition Type A in a slot from
the $N \bullet K$ slots, according to Clause 9, Clause 11.1, Clause 11.2A,
Clause 15 and Clause 17.2 of [6, TS 38.213], the UE counts the slots in the
number of $N \bullet K$ slots.
For PUSCH repetition Type A, in case _K >1,_
\- If the PUSCH is scheduled by DCI format 0_1 or 0_2
\- if _AvailableSlotCounting_ is enabled, the same symbol allocation is
applied across the $N \bullet K$ slots determined for the PUSCH transmission
and the PUSCH is limited to a single transmission layer. The UE shall repeat
the TB across the $N \bullet K$ slots determined for the PUSCH transmission,
applying the same symbol allocation in each slot.
\- Otherwise, _t_ he same symbol allocation is applied across the $N \bullet
K$ consecutive slots and the PUSCH is limited to a single transmission layer.
The UE shall repeat the TB across the $N \bullet K$ consecutive slots applying
the same symbol allocation in each slot.
\- Else if the PUSCH is scheduled by RAR UL grant or by DCI format 0_0 with
CRC scrambled by TC-RNTI, the same symbol allocation is applied across the $N
\bullet K$ slots determined for the PUSCH transmission and the PUSCH is
limited to a single transmission layer. The UE shall repeat the TB across the
$N \bullet K$ slots determined for the PUSCH transmission, applying the same
symbol allocation in each slot.
For PUSCH repetition Type B:
\- If _pusch-DMRS-Bundling_ is enabled, the PUSCH is limited to a single
transmission layer.
For TB processing over multiple slots:
\- For unpaired spectrum, the same symbol allocation is applied across the $N
\bullet K$ slots determined for the PUSCH transmission and the PUSCH is
limited to a single transmission layer. The UE shall transmit the TB across
the $N \bullet K$ slots determined for the PUSCH transmission, applying the
same symbol allocation in each slot.
\- For paired spectrum or supplementary uplink band, the same symbol
allocation is applied across the $\ N \bullet K$ consecutive slots and the
PUSCH is limited to a single transmission layer. The UE shall transmit the TB
across the $N \bullet K$ consecutive slots applying the same symbol allocation
in each slot.
\- For the case of reduced capability half-duplex UE, the same symbol
allocation is applied across the $N \bullet K$ slots determined for the PUSCH
transmission and the PUSCH is limited to a single transmission layer. The UE
shall transmit the TB across the $N \bullet K$ slots determined for the PUSCH
transmission, applying the same symbol allocation in each slot.
For a PUSCH transmission scheduled by DCI format 0_1, 0_2 or 0_3, or 0_0 with
CRC scrambled by TC-RNTI, the redundancy version to be applied on the _n_ th
transmission occasion of the TB, where n = 0, 1, ... $N \bullet K$ -1, is
determined according to table 6.1.2.1-2.
For a PUSCH transmission of a PUSCH repetition Type A scheduled by RAR UL
grant, the redundancy version to be applied on the _n_ th transmission
occasion of the TB, where n = 0, 1, ... $N \bullet K$ -1, is determined
according to the first row of Table 6.1.2.1-2.
Table 6.1.2.1-2: Redundancy version for PUSCH transmission
_rv~id\ ~_ indicated by the DCI scheduling the PUSCH _rv~id~_ to be applied to
_n_ ^th^ transmission occasion (repetition Type A) or TB processing over
multiple slots) or _n_ ^th^ actual repetition (repetition Type B)
* * *
                                                        *((n-(n mod N))/N)* mod 4 = 0                                                                                                                                        *((n-(n mod N))/N)* mod 4 = 1   *((n-(n mod N))/N)* mod 4 = 2   *((n-(n mod N))/N)* mod 4 = 3
0 0 2 3 1 2 2 3 1 0 3 3 1 0 2 1 1 0 2 3
When transmitting MsgA PUSCH on a non-initial UL BWP, if the UE is configured
with _startSymbolAndLengthMsgA-PO_ , the UE shall determine the _S_ and _L_
from _startSymbolAndLengthMsgA-PO_.
When transmitting MsgA PUSCH, if the UE is not configured with
_startSymbolAndLengthMsgA-PO_ , and if the TDRA list _PUSCH-
TimeDomainResourceAllocationList_ is provided in _PUSCH-ConfigCommon_ , the UE
shall use _msgA-PUSCH-TimeDomainAllocation_ to indicate which values are used
in the list. If _PUSCH-TimeDomainResourceAllocationList_ is not provided in
_PUSCH-ConfigCommon_ , the UE shall use parameters _S_ and _L_ from table
6.1.2.1.1-2 or table 6.1.2.1.1-3 where _msgA-PUSCH-TimeDomainAllocation_
indicates which values are used in the list. The time offset for PUSCH
transmission is described in [6, TS 38.213].
For PUSCH repetition Type A and TB processing over multiple slots, a PUSCH
transmission in a slot of a multi-slot PUSCH transmission is omitted according
to the conditions in Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause
17.2 of [6, TS 38.213].
For PUSCH repetition Type B, except for PUSCH transmitting CSI report(s) with
no transport block, the number of nominal repetitions is given by
_numberOfRepetitions_. For the _n_ -th nominal repetition, _n_ = _0_ , ...,
_numberOfRepetitions_ \- 1,
\- The slot where the nominal repetition starts is given by , and the starting
symbol relative to the start of the slot is given by .
\- The slot where the nominal repetition ends is given by , and the ending
symbol relative to the start of the slot is given by .
Here is the slot where the PUSCH transmission starts, and is the number of
symbols per slot as defined in Clause 4.3.2 of [4, TS38.211].
For PUSCH repetition Type B, the UE determines invalid symbol(s) for PUSCH
repetition Type B transmission as follows:
\- A symbol that is indicated as downlink by _tdd-UL-DL-ConfigurationCommon_
or _tdd-UL-DL-ConfigurationDedicated_ is considered as an invalid symbol for
PUSCH repetition Type B transmission.
\- For operation in unpaired spectrum, symbols indicated by _ssb-
PositionsInBurst_ in SIB1 or _ssb-PositionsInBurst_ in
_ServingCellConfigCommon_ or by _NonCellDefiningSSB_ for reception of SS/PBCH
blocks are considered as invalid symbols for PUSCH repetition Type B
transmission.
\- For a reduced capability half-duplex UE in paired spectrum, symbols that do
not start or end at least $N_{\text{Rx-Tx}} \cdot T_{\text{c}}$ or
$N_{\text{Tx-Rx}} \cdot T_{\text{c}}$, respectively, from the last or first
symbol of an SS/PBCH block with index indicated by _ssb-PositionsInBurst_ in
SIB1 or by _ssb-PositionsInBurst_ in _ServingCellConfigCommon_ or by
_NonCellDefiningSSB_ , or by _ssb-PositionsInBurst_ in _SSB-MTC-AdditionalPCI_
associated to physical cell ID with active TCI states for PDCCH or PDSCH, or
for a set of symbols of a slot corresponding to SS/PBCH blocks configured for
L1 beam measurement/reporting for reception of SS/PBCH blocks are considered
as invalid symbols for PUSCH repetition Type B transmission.
\- For operation in unpaired spectrum, symbol(s) indicated by _pdcch-
ConfigSIB1_ in _MIB_ for a CORESET for Type0-PDCCH CSS set are considered as
invalid symbol(s) for PUSCH repetition Type B transmission.
\- For operation in unpaired spectrum, if _numberOfInvalidSymbolsForDL-UL-
Switching_ is configured, _numberOfInvalidSymbolsForDL-UL-Switching_ symbol(s)
after the last symbol that is indicated as downlink in each consecutive set of
all symbols that are indicated as downlink by _tdd-UL-DL-ConfigurationCommon_
or _tdd-UL-DL-ConfigurationDedicated_ are considered as invalid symbol(s) for
PUSCH repetition Type B transmission. The symbol(s) given by
_numberOfInvalidSymbolsForDL-UL-Switching_ are defined using the reference SCS
configuration _referenceSubcarrierSpacing_ provided in _tdd-UL-DL-
ConfigurationCommon_.
\- For operation with shared spectrum channel access with semi-static channel
occupancy, symbols in an idle duration associated with a periodic channel
occupancy as described in Clause 4.3.1.1 of [16, 37.213], or in an idle
duration in a period associated with an initiated channel occupancy as
described in Clause 4.3.2. of [16, TS 37.213] are considered as invalid
symbol(s) for PUSCH repetition Type B transmission.
\- The UE may be configured with the higher layer parameter
_invalidSymbolPattern_ , which provides a symbol level bitmap spanning one or
two slots (higher layer parameter _symbols_ given by _invalidSymbolPattern_).
A bit value equal to 1 in the symbol level bitmap _symbols_ indicates that the
corresponding symbol is an invalid symbol for PUSCH repetition Type B
transmission. The UE may be additionally configured with a time-domain pattern
(higher layer parameter _periodicityAndPattern_ given by
_invalidSymbolPattern_), where each bit of _periodicityAndPattern_ corresponds
to a unit equal to a duration of the symbol level bitmap _symbols_ , and a bit
value equal to 1 indicates that the symbol level bitmap _symbols_ is present
in the unit. The _periodicityAndPattern_ can be {1, 2, 4, 5, 8, 10, 20 or 40}
units long, but maximum of 40 msec. The first symbol of
_periodicityAndPattern_ every 40 msec/P periods is a first symbol in frame 𝑛𝑓
mod 4 = 0, where P is the duration of _periodicityAndPattern-r16_ in units of
msec. When _periodicityAndPattern_ is not configured, for a symbol level
bitmap spanning two slots, the bits of the first and second slots correspond
respectively to even and odd slots of a radio frame, and for a symbol level
bitmap spanning one slot, the bits of the slot correspond to every slot of a
radio frame. If _invalidSymbolPattern_ is configured, when the UE applies the
invalid symbol pattern is determined as follows:
\- if the PUSCH is scheduled by DCI format 0_1, or corresponds to a Type 2
configured grant activated by DCI format 0_1, and if
_invalidSymbolPatternIndicatorDCI-0-1_ is configured,
\- if invalid symbol pattern indicator field is set 1, the UE applies the
invalid symbol pattern;
\- otherwise, the UE does not apply the invalid symbol pattern;
\- if the PUSCH is scheduled by DCI format 0_2, or corresponds to a Type 2
configured grant activated by DCI format 0_2, and if
_invalidSymbolPatternIndicatorDCI-0-2_ is configured,
\- if invalid symbol pattern indicator field is set 1, the UE applies the
invalid symbol pattern;
\- otherwise, the UE does not apply the invalid symbol pattern;
\- otherwise, the UE applies the invalid symbol pattern.
\- If the UE
\- is configured with multiple serving cells within a cell group and is
provided with _directionalCollisionHandling-r16_ = \'enabled\' for a set of
serving cell(s) among the multiple serving cells, and
\- indicates support of _half-DuplexTDD-CA-SameSCS-r16_ capability, and
\- is not configured to monitor PDCCH for detection of DCI format 2-0 on any
of the multiple serving cells,
\- a symbol indicated to the UE for reception of SS/PBCH blocks in a first
cell of the multiple serving cells by _ssb-PositionsInBurst_ in _SIB1,_ or by
_ssb-PositionsInBurst_ in _ServingCellConfigCommon,_ or by
_NonCellDefiningSSB_ , or by _ssb-PositionsInBurst_ in _SSB-MTC-AdditionalPCI_
associated to physical cell ID with active TCI states for PDCCH or PDSCH, or
for a set of symbols of a slot corresponding to SS/PBCH blocks configured for
L1 beam measurement/reporting _is considered as an invalid symbol for PUSCH
repetition Type B transmission in_
\- any of the multiple serving cells if the UE is not capable of simultaneous
transmission and reception as indicated by _simultaneousRxTxInterBandCA_ among
the multiple serving cells, and
\- any one of the cells corresponding to the same band as the first cell,
irrespective of any capability indicated by _simultaneousRxTxInterBandCA_
and
\- a symbol is considered as an invalid symbol in another cell among the set
of serving cell(s) provided with **_directionalCollisionHandling-r16_** for
PUSCH repetition Type B transmission with Type 1 or Type 2 configured grant
except for the first Type 2 PUSCH transmission (including all repetitions)
after activation if the symbol is indicated as downlink by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ on the reference
cell as defined in Clause 11.1 of [6, TS 38.213], or the UE is configured by
higher layers to receive PDCCH, PDSCH, or CSI-RS on the reference cell in the
symbol.
For PUSCH repetition Type B, after determining the invalid symbol(s) for PUSCH
repetition type B transmission for each of the _K_ nominal repetitions, the
remaining symbols are considered as potentially valid symbols for PUSCH
repetition Type B transmission. If the number of potentially valid symbols for
PUSCH repetition type B transmission is greater than zero for a nominal
repetition, the nominal repetition consists of one or more actual repetitions,
where each actual repetition consists of a consecutive set of all potentially
valid symbols that can be used for PUSCH repetition Type B transmission within
a slot. An actual repetition with a single symbol is omitted except for the
case of _L_ =1. An actual repetition is omitted according to the conditions in
Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS
38.213]. The UE shall repeat the TB across actual repetitions. The redundancy
version to be applied on the _n_ th actual repetition (with the counting
including the actual repetitions that are omitted) is determined according to
table 6.1.2.1-2, where _N_ =1.
For PUSCH repetition Type B, when a UE receives a DCI that schedules aperiodic
CSI report(s) or activates semi-persistent CSI report(s) on PUSCH with no
transport block by a \'_CSI request\'_ field on a DCI, the number of nominal
repetitions is always assumed to be 1, regardless of the value of
_numberOfRepetitions_. When the UE is scheduled to transmit a PUSCH repetition
Type B with no transport block and with aperiodic or semi-persistent CSI
report(s) by a \'_CSI request\'_ field on a DCI, the first nominal repetition
is expected to be the same as the first actual repetition. For PUSCH
repetition Type B carrying semi-persistent CSI report(s) without a
corresponding PDCCH after being activated on PUSCH by a \'_CSI request\'_
field on a DCI, if the first nominal repetition is not the same as the first
actual repetition, the first nominal repetition is omitted; otherwise, the
first nominal repetition is omitted according to the conditions in Clause 9,
Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS 38.213].
For PUSCH repetition Type B, when a UE is scheduled to transmit a transport
block and aperiodic CSI report(s) on PUSCH by a \'_CSI request\'_ field on a
DCI, the CSI report(s) is multiplexed only on the first actual repetition. The
UE does not expect that the first actual repetition has a single symbol
duration.
For _pusch-TimeDomainAllocationListForMultiPUSCH_ in _pusch-Config, if a_ row
indicates resource allocation for two to eight contiguous PUSCHs and
_extendedK2_ is not configured, _K~2~_ given by _k2-r16_ indicates the slot
where UE shall transmit the first PUSCH of the multiple PUSCHs. **Each PUSCH
has a separate SLIV and mapping type. The number of scheduled PUSCHs is
signalled by the number of indicated valid SLIVs in the row of the** _pusch-
TimeDomainAllocationListForMultiPUSCH_ **signalled in DCI format 0_1.**
For _pusch-TimeDomainAllocationListForMultiPUSCH_ in _pusch-Config,_ _if a row
indicates resource allocation of more than one PUSCH and extendedK2 is
configured,_ e**ach PUSCH has a separate SLIV, mapping type and** _K~2\ ~_
given by _extendedK2_**. If a row indicates resource allocation of a single
PUSCH, the PUSCH has a single SLIV, mapping type, and** _K~2~_**, where**
_K~2~_ **is given by _extendedK2_ , if configured, otherwise** _K~2~_ **is
given by _k2-r16_. The number of scheduled PUSCHs is signalled by the number
of indicated SLIVs in the row of the** _pusch-
TimeDomainAllocationListForMultiPUSCH_ **signalled in DCI format 0_1.**
If a UE is configured with _extendedK2 in_ _pusch-
TimeDomainAllocationListForMultiPUSCH_ in which one or more rows contain
multiple _SLIV_ s for PUSCH on a UL BWP of a serving cell, and the UE is
indicated re-transmission of PUSCH by DCI format 0_1, where the PUSCH is
correspond to a configured grant Type 1 or Type 2, the UE does not expect that
the number of indicated _SLIV_ s in the row of **the** _pusch-
TimeDomainAllocationListForMultiPUSCH_ by the DCI **is** more than one.
When the UE is configured with _minimumSchedulingOffsetK2_ in an active UL BWP
it applies a minimum scheduling offset restriction indicated by the \'_Minimum
applicable scheduling offset indicator_ \' field in DCI format 0_1, 0_3, 1_1
or 1_3 if the same field is available. When the UE is configured with
_minimumSchedulingOffsetK2_ in an active UL BWP and it has not received
\'_Minimum applicable scheduling offset indicator_ \' field in DCI format 0_1,
0_3, 1_1 or 1_3, the UE shall apply a minimum scheduling offset restriction
indicated based on \'_Minimum applicable scheduling offset indicator_ \' value
\'0\'. When the minimum scheduling offset restriction is applied the UE is not
expected to be scheduled with a DCI in slot _n_ to transmit a PUSCH scheduled
with C-RNTI, CS-RNTI, MCS-C-RNTI or SP-CSI-RNTI with _K_ ~2~ smaller than
$\left\lceil K_{2min} \cdot \frac{2^{\mu^{'}}}{2^{\mu}} \right\rceil$, where
_K_ ~2min~ and $\mu$ are the applied minimum scheduling offset restriction and
the numerology of the active UL BWP of the scheduled cell when receiving the
DCI in slot _n_ , respectively, and $\mu^{'}$ is the numerology of the new
active UL BWP in case of active UL BWP change in the scheduled cell and is
equal to $\mu$, otherwise. The minimum scheduling offset restriction is not
applied when PUSCH transmission is scheduled by RAR UL grant or fallbackRAR UL
grant for RACH procedure, or when PUSCH is scheduled with TC-RNTI. The
application delay of the change of the minimum scheduling offset restriction
is determined in Clause 5.3.1.
When two SRS resource sets are configured in _srs-ResourceSetToAddModList_ or
_srs-ResourceSetToAddModListDCI-0-2_ with higher layer parameter _usage_ in
_SRS-ResourceSet_ set to \'codebook\' or \'noncodebook\', for PUSCH repetition
Type A, in case _K >1,_ the same symbol allocation is applied across the _K_
consecutive slots and the PUSCH is limited to a single transmission layer. The
UE shall repeat the TB across the _K_ consecutive slots applying the same
symbol allocation in each slot, and the association of the first and second
SRS resource set in _srs-ResourceSetToAddModList_ or _srs-
ResourceSetToAddModListDCI-0-2 to_ each slot is determined as follows:
\- if a DCI format 0_3 schedules the PUSCH, the first SRS resource set is
associated with all K consecutive slots,
\- if a DCI format 0_1 or DCI format 0_2 indicates codepoint \"00\" for the
_SRS resource set indicator_ , the first SRS resource set is associated with
all K consecutive slots,
\- if a DCI format 0_1 or DCI format 0_2 indicates codepoint \"01\" for the
_SRS resource set indicator_ , the second SRS resource set is associated with
all K consecutive slots,
\- if a DCI format 0_1 or DCI format 0_2 indicates codepoint \"10\" for the
_SRS resource set indicator_ , the first and second SRS resource set
association to K consecutive slots is determined as follows:
\- When K = 2, the first and second SRS resource sets are applied to the first
and second slot of 2 consecutive slots, respectively.
\- When K > 2 and _cyclicMapping_ in _PUSCH-Config_ is enabled, the first and
second SRS resource sets are applied to the first and second slot of K
consecutive slots, respectively, and the same SRS resource set mapping pattern
continues to the remaining slots of K consecutive slots.
\- When K > 2 and _sequentialMapping_ in _PUSCH-Config_ is enabled, first SRS
resource set is applied to the first and second slots of K consecutive slots,
and the second SRS resource set is applied to the third and fourth slot of K
consecutive slots, and the same SRS resource set mapping pattern continues to
the remaining slots of K consecutive slots.
\- Otherwise, a DCI format 0_1 or DCI format 0_2 indicates codepoint \"11\"
for the _SRS resource set indicator_ , and the first and second SRS resource
set association to K consecutive slots is determined as follows,
\- When K = 2, the second and first SRS resource set are applied to the first
and second slot of 2 consecutive slots, respectively.
\- When K > 2 and _cyclicMapping_ in _PUSCH-Config_ is enabled, the second and
first SRS resource sets are applied to the first and second slot of K
consecutive slots, respectively, and the same SRS resource set mapping pattern
continues to the remaining slots of the K consecutive slots.
\- When K > 2 and _sequentialMapping_ in _PUSCH-Config_ is enabled, the second
SRS resource set is applied to the first and second slot of K consecutive
slots, and the first SRS resource set is applied to the third and fourth slot
of K consecutive slots, and the same SRS resource set mapping pattern
continues to the remaining slots of the K consecutive slots.
For PUSCH repetition Type B, when two SRS resource sets are configured in
_srs-ResourceSetToAddModList_ or _srs-ResourceSetToAddModListDCI-0-2_ with
higher layer parameter _usage_ in _SRS-ResourceSet_ set to \'codebook\' or
\'noncodebook\', the SRS resource set association to nominal PUSCH repetitions
follows the same method as SRS resource set association to slots in PUSCH Type
A repetition by considering nominal repetitions instead of slots.
When a UE is configured with _dl-OrJointTCI-StateList_ or _TCI-UL-State_ and
is having two indicated TCI-States or TCI-UL-States, and two SRS resource sets
are configured in _srs-ResourceSetToAddModList_ or _srs-
ResourceSetToAddModListDCI-0-2_ with higher layer parameter _usage_ in _SRS-
ResourceSet_ set to \'codebook\' or \'noncodebook\', for PUSCH repetition Type
A or Type B as described above, or for PUSCH transmission when the higher
layer parameter _multipanelScheme_ is set to 'SDMscheme' or 'SFNscheme', the
association of the first and second indicated joint/UL TCI states to PUSCH
transmission occasions or to corresponding PUSCH antenna ports is determined
as follows:
\- if a DCI format 0_1 or DCI format 0_2 indicates codepoint "00" or "01" for
the _SRS resource set indicator_ , the first or second indicated joint/UL TCI
state is applied to all PUSCH transmission occasions, respectively.
\- if a DCI format 0_1 or DCI format 0_2 indicates codepoint "10" or "11" for
the _SRS resource set indicator_ , and the _multipanelScheme_ is not
configured,
\- the first indicated joint/UL TCI state is applied to the PUSCH transmission
occasion(s) associated with the first SRS resource set and the second
indicated joint/UL TCI state is applied to the PUSCH transmission occasion(s)
associated with the second SRS resource set, where the association of PUSCH
transmission occasions to SRS resource sets is determined for K = 2 and K > 2,
and depending on whether _cyclicMapping_ or _sequentialMapping_ in _PUSCH-
Config_ is enabled, based on the above description in this Clause.
\- if a DCI format 0_1 or DCI format 0_2 indicates codepoint "10" for the _SRS
resource set indicator_ and the higher layer parameters _multipanelScheme_ is
configured and set to 'SDMscheme' or 'SFNscheme',
\- the first indicated TCI state is applied to the PUSCH antenna port(s), of
corresponding PUSCH transmission occasion, associated with the first SRS
resource set, and the second indicated TCI state is applied to the PUSCH
antenna port(s), of corresponding PUSCH transmission occasion, associated with
the second SRS resource set, where the association of PUSCH antenna ports to
SRS resource sets is determined according to Clauses 6.1.1.1 and 6.1.1.2.
For both PUSCH repetition Type A and PUSCH repetition Type B, when a DCI
format 0_1 or DCI format 0_2 indicates codepoint \"10\" or \"11\" for the _SRS
resource set indicator_ , the redundancy version to be applied on the _n_ th
transmission occasion (for PUSCH repetition Type A) of the TB, where n = 0, 1,
... _K_ -1, or _n_ th actual repetition (for PUSCH repetition Type B, with the
counting including the actual repetitions that are omitted) is determined
according to Table 6.1.2.1-2 and Table 6.1.2.1-3. For all PUSCH repetitions
associated with the SRS resource set of the first transmission occasion or
actual repetition, the redundancy version to be applied is derived according
to Table 6.1.2.1-2, where n is counted only considering PUSCH transmission
occasions or actual repetitions associated with the same SRS resource set as
the first transmission occasion or actual repetition. The redundancy version
for PUSCH transmission occasions or actual repetitions that are associated
with an SRS resource set other than the SRS resource set of the first
transmission occasion or actual repetition is derived according to Table
6.1.2.1-3, where additional shifting operation for each redundancy version
$\text{rv}_{s}\ $is configured by higher layer parameter _sequenceOffsetforRV_
in _PUSCH-Config_ and $n$ is counted only considering PUSCH transmission
occasions or actual repetitions that are not associated with the SRS resource
set of the first transmission occasion or actual repetition.
Table 6.1.2.1-3: Applied redundancy version for the other SRS resource set
(SRS resource set not associated with the first transmission occasion or
actual repetition) when _sequenceOffsetforRV_ is present
_rv~id\ ~_ indicated by the DCI scheduling the PUSCH _rv~id~_ to be applied to
_n_ ^th^ transmission occasion (repetition Type A) or _n_ ^th^ actual
repetition (repetition Type B)
* * *
                                                        *n* mod 4 = 0                                                                                                                  *n* mod 4 = 1                              *n* mod 4 = 2                              *n* mod 4 = 3
$$0$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(2 + \ \text{rv}_{s})\
\text{mod}\ 4$$ $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(1 + \
\text{rv}_{s})\ \text{mod}\ 4$$ $$2$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$
$$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(1 + \ \text{rv}_{s})\ \text{mod}\
4$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$3$$ $$(3 + \ \text{rv}_{s})\
\text{mod}\ 4$$ $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(0 + \
\text{rv}_{s})\ \text{mod}\ 4$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$1$$
$$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\
4$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(3 + \ \text{rv}_{s})\
\text{mod}\ 4$$
For PUSCH repetition Type A, when a DCI format 0_1 and DCI format 0_2 indicate
codepoint \"10\" or \"11\" for the _SRS resource set indicator_ and schedule
aperiodic CSI report(s) on PUSCH with transport block by a \'_CSI request\'_
field on a DCI, the CSI report(s) multiplexing is determined as follows
\- if higher layer parameter _ap-CSI-MultiplexingMode_ in _CSI-
AperiodicTriggerState_ is enabled and UCI other than CSI report(s) are not
multiplexed on PUSCH, the CSI report(s) is transmitted separately only on the
first transmission occasion associated with the first SRS resource set and the
first transmission occasion associated with the second SRS resource set.
\- otherwise, the CSI report(s) is transmitted only on the first transmission
occasion.
For PUSCH transmissions of TB processing over multiple slots, when a DCI
format 0_1 and DCI format 0_2 schedule aperiodic CSI report(s) on PUSCH with
transport block by a \'CSI request\' field on a DCI, the CSI report(s) is
transmitted only on the first slot of the 𝑁 ∙ 𝐾 slots determined for the PUSCH
transmission.
For PUSCH repetition Type B, when a DCI format 0_1 and DCI format 0_2 indicate
codepoint \"10\" or \"11\" for the _SRS resource set indicator_ and schedule
aperiodic CSI report(s) on PUSCH with transport block by a \'_CSI request\'_
field on a DCI, CSI report(s) multiplexing is determined as follows
\- if higher layer parameter _ap-CSI-MultiplexingMode_ in _CSI-
AperiodicTriggerState_ is enabled and the first actual repetition associated
with the first SRS resource set and the first actual repetition associated
with the second SRS resource set have the same number of symbols and UCI other
than CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is
multiplexed separately only on the first actual repetition associated with the
first SRS resource set and first actual repetition associated with the second
SRS resource set.
\- otherwise, the CSI report(s) is multiplexed only on the first actual
repetition.
The UE does not expect a different number of actual PT-RS ports for the two
actual repetitions when the CSI report(s) is transmitted separately on two
actual repetitions.
For PUSCH repetition Type A, when a DCI format 0_1 and DCI format 0_2 indicate
codepoint \"10\" or \"11\" for the _SRS resource set indicator_ and schedule
aperiodic CSI report(s) on PUSCH with no transport block by a \'_CSI
request\'_ field on a DCI, the number of repetitions is assumed to be 2
regardless of the value of _numberOfRepetitions_ or _pusch-AggregationFactor_
(if _numberOfRepetitions_ is not present in the time domain resource
allocation table), and transmission of CSI report(s) is determined as follows
\- if higher layer parameter _ap-CSI-MultiplexingMode_ in _CSI-
AperiodicTriggerState_ is enabled and UCI other than CSI report(s) are not
multiplexed on PUSCH, the CSI report(s) is transmitted separately on the first
transmission occasion and the second transmission occasion
\- otherwise, the CSI report(s) is transmitted only on the first transmission
occasion.
For PUSCH repetition Type B, when a DCI format 0_1 and DCI format 0_2 indicate
codepoint \"10\" or \"11\" for the _SRS resource set indicator_ and schedule
aperiodic CSI report(s) or activates semi-persistent CSI report(s) on PUSCH
with no transport block by a \'_CSI request\'_ field on a DCI, the number of
nominal repetitions is always assumed to be 2 regardless of the value of
_numberOfRepetitions_ , and the first and second nominal repetitions are
expected to be the same as the first and second actual repetitions, and
transmission of CSI report(s) is determined as follows:
\- if higher layer parameter _ap-CSI-MultiplexingMode_ in _CSI-
AperiodicTriggerState_ is enabled for aperiodic CSI report(s) or higher layer
paremeter _SP-CSI-MultiplexingMode_ in _CSI-SemiPersistentOnPUSCH-
TriggerState_ is enabled for semi-persistent CSI report(s) and UCI other than
CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is transmitted
separately on the first actual repetition and the second actual repetition
\- otherwise, the CSI report(s) is transmitted only on the first actual
repetition.
The UE does not expect a different number of actual PT-RS ports for the two
actual repetitions when the CSI report(s) is transmitted separately on two
actual repetitions.
For PUSCH repetition Type A, when a DCI format 0_1 and DCI format 0_2 indicate
codepoint \"10\" or \"11\" for the _SRS resource set indicator_ and activate
semi-persistent CSI report(s) on PUSCH with no transport block by a \'_CSI
request\'_ field on a DCI, _or indicate the PUSCH repetition Type A carrying
semi-persistent CSI report(s) without a corresponding PDCCH after being
activated on PUSCH by a \'CSI request\' field on a DCI_ , the number of
repetitions is always assumed to be 2 regardless of the value of
_numberOfRepetitions_ or _pusch-AggregationFactor_ (if _numberOfRepetitions_
is not present in the time domain resource allocation table), and transmission
of CSI report(s) is determined as follows
\- if higher layer parameter _SP-CSI-MultiplexingMode_ in _CSI-
SemiPersistentOnPUSCH-TriggerState_ is enabled and UCI other than CSI
report(s) are not multiplexed on PUSCH, the CSI report(s) is transmitted
separately on the first transmission occasion and the second transmission
occasion
\- otherwise, the CSI report(s) is transmitted only on the first transmission
occasion.
For PUSCH repetition Type B, when a DCI format 0_1 and DCI format 0_2 indicate
codepoint \"10\" or \"11\" for the _SRS resource set indicator_ and the PUSCH
repetition Type B carrying semi-persistent CSI report(s) without a
corresponding PDCCH after being activated on PUSCH by a \'_CSI request\'_
field on a DCI, the number of nominal repetitions is always assumed to be 2
regardless of the value of _numberOfRepetitions_ , and transmission of CSI
report(s) is determined as follows
\- if higher layer parameter _SP-CSI-MultiplexingMode_ in _CSI-
SemiPersistentOnPUSCH-TriggerState_ is enabled and one of the first or second
nominal repetition is the same as corresponding first or second actual
repetition, the nominal repetition that is not having same actual repetition
is omitted and the CSI report(s) is transmitted on the actual repetition that
is not omitted.
\- if higher layer parameter _SP-CSI-MultiplexingMode_ in _CSI-
SemiPersistentOnPUSCH-TriggerState_ is enabled and the first and second
nominal repetitions are the same as the first and second actual repetitions
and the UCI other than CSI report(s) are not multiplexed on PUSCH, the CSI
report(s) is transmitted separately on the first actual repetition and the
second actual repetition
\- otherwise, the CSI report(s) is transmitted only on the first actual
repetition.
##### 6.1.2.1.1 Determination of the resource allocation table to be used for
PUSCH
Table 6.1.2.1.1-1, Table 6.1.2.1.1-1A, Table 6.1.2.1.1-1B and Table
6.1.2.1.1-1C define which PUSCH time domain resource allocation configuration
to apply.
Table 6.1.2.1.1-4 defines the subcarrier spacing specific values _j_. _j_ is
used in determination of _K~2~_ in conjunction to table 6.1.2.1.1-2, for
normal CP or table 6.1.2.1.1.-3 for extended CP, where $µ_{\text{PUSCH}}$ is
the subcarrier spacing configurations for PUSCH.
Table 6.1.2.1.1-5 defines the additional subcarrier spacing specific slot
delay value for the first transmission of PUSCH scheduled by the RAR or by the
fallbackRAR. When the UE transmits a PUSCH scheduled by RAR or by the
fallbackRAR, the _Δ_ value specific to the PUSCH subcarrier spacing _µ~PUSCH~_
is applied in addition to the _K~2~_ value.
Table 6.1.2.1.1-1: Applicable PUSCH time domain resource allocation for common
search space and DCI format 0_0 in UE specific search space
+-------------+-------------+-------------+-------------+-------------+ | RNTI | PDCCH | _pusch-Co |_ pu | PUSCH time | | | search | nfigCommon _| sch-Config_ | domain | | | space | includes | includes | resource | | | | _pusch-Tim |_ pusch-Tim | allocation | | | | eDomainAllo | eDomainAllo | to apply | | | | cationList _| cationList_ | | +=============+=============+=============+=============+=============+ | PUSCH | No | - | Default A | | | scheduled | | | | | | by MAC RAR | | | | | | as | | | | | | described | | | | | | in clause | | | | | | 8.2 of [6, | | | | | | TS 38.213] | | | | | | or MAC | | | | | | fallbackRAR | | | | | | as | | | | | | described | | | | | | in clause | | | | | | 8.2A of | | | | | | [6, | | | | | | 38.213] or | | | | | | for MsgA | | | | | | PUSCH | | | | | | t | | | | | | ransmission | | | | | +-------------+-------------+-------------+-------------+-------------+ | | Yes | | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pusch-Co | | | | | | nfigCommon_ | | +-------------+-------------+-------------+-------------+-------------+ | C-RNTI, | Any common | No | - | Default A | | MCS-C-RNTI, | search | | | | | TC-RNTI, | space | | | | | CS-RNTI | associated | | | | | | with | | | | | | CORESET 0 | | | | +-------------+-------------+-------------+-------------+-------------+ | | | Yes | | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pusch-Co | | | | | | nfigCommon_ | +-------------+-------------+-------------+-------------+-------------+ | C-RNTI, | Any common | No | No | Default A | | MCS-C-RNTI, | search | | | | | TC-RNTI, | space not | | | | | CS-RNTI | associated | | | | | | with | | | | | | CORESET 0, | | | | | | | | | | | | DCI format | | | | | | 0_0 in | | | | | | | | | | | | UE specific | | | | | | search | | | | | | space | | | | +-------------+-------------+-------------+-------------+-------------+ | | | Yes | No | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pusch-Co | | | | | | nfigCommon_ | +-------------+-------------+-------------+-------------+-------------+ | | | No/Yes | Yes | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pu | | | | | | sch-Config_ | +-------------+-------------+-------------+-------------+-------------+
Table 6.1.2.1.1-1A: Applicable PUSCH time domain resource allocation for DCI
format 0_1 in UE specific search space scrambled with C-RNTI, MCS-C-RNTI, CS-
RNTI or SP-CSI-RNTI
_pusch-ConfigCommon_ includes _pusch-TimeDomainAllocationList_ _pusch-Config_
includes _pusch-TimeDomainAllocationList_ _pusch-Config_ includes _pusch-
TimeDomainAllocationListDCI-0-1_ _pusch-Config_ includes _pusch-
TimeDomainAllocationListForMultiPUSCH_ PUSCH time domain resource allocation
to apply
* * *
No No No No Default A Yes No No No _pusch-TimeDomainAllocationList_ provided
in _pusch-ConfigCommon_ No/Yes Yes No No _pusch-TimeDomainAllocationList_
provided in _pusch-Config_ No/Yes No Yes - _pusch-
TimeDomainAllocationListDCI-0-1_ provided in _pusch-Config_ No/Yes No - Yes
_pusch-TimeDomainAllocationListForMultiPUSCH_ provided in _pusch-Config_
Table 6.1.2.1.1-1B: Applicable PUSCH time domain resource allocation for DCI
format 0_2 in UE specific search space scrambled with C-RNTI, MCS-C-RNTI, CS-
RNTI or SP-CSI-RNTI
_pusch-ConfigCommon_ includes _pusch-TimeDomainAllocationList_ _pusch-Config_
includes _pusch-TimeDomainAllocationList_ _pusch-Config_ includes _pusch-
TimeDomainAllocationListDCI-0-2_ PUSCH time domain resource allocation to
apply
* * *
No No No Default A Yes No No _pusch-TimeDomainAllocationList_ provided in
_pusch-ConfigCommon_ No/Yes Yes No _pusch-TimeDomainAllocationList_ provided
in _pusch-Config_ No/Yes No Yes _pusch-TimeDomainAllocationListDCI-0-2_
provided in _pusch-Config_
Table 6.1.2.1.1-1C: Applicable PUSCH time domain resource allocation for DCI
format 0_3 in UE specific search space scrambled with C-RNTI or MCS-C-RNTI
**_pusch-ConfigCommon_ includes *pusch-TimeDomainAllocationList** __**pusch-
Config _includes *pusch-TimeDomainAllocationList_** **_pusch-Config_ includes
*pusch-TimeDomainAllocationListDCI-0-1** ___PUSCH time domain resource
allocation to apply_ *
* * *
No No No Default A Yes No No _pusch-TimeDomainAllocationList_ provided in
_pusch-ConfigCommon_ No/Yes Yes No _pusch-TimeDomainAllocationList_ provided
in _pusch-Config_ No/Yes No Yes _pusch-TimeDomainAllocationListDCI-0-1_
provided in _pusch-Config_
Table 6.1.2.1.1-2: Default PUSCH time domain resource allocation A for normal
CP
Row index PUSCH mapping type _K~2~_ _S_ _L_
* * *
1 Type A _j_ 0 14 2 Type A _j_ 0 12 3 Type A _j_ 0 10 4 Type B _j_ 2 10 5 Type
B _j_ 4 10 6 Type B _j_ 4 8 7 Type B _j_ 4 6 8 Type A _j_ +1 0 14 9 Type A _j_
+1 0 12 10 Type A _j_ +1 0 10 11 Type A _j_ +2 0 14 12 Type A _j_ +2 0 12 13
Type A _j_ +2 0 10 14 Type B _j_ 8 6 15 Type A _j_ +3 0 14 16 Type A _j_ +3 0
10
Table 6.1.2.1.1-3: Default PUSCH time domain resource allocation A for
extended CP
Row index PUSCH mapping type _K~2~_ _S_ _L_
* * *
1 Type A _j_ 0 8 2 Type A _j_ 0 12 3 Type A _j_ 0 10 4 Type B _j_ 2 10 5 Type
B _j_ 4 4 6 Type B _j_ 4 8 7 Type B _j_ 4 6 8 Type A _j_ +1 0 8 9 Type A _j_
+1 0 12 10 Type A _j_ +1 0 10 11 Type A _j_ +2 0 6 12 Type A _j_ +2 0 12 13
Type A _j_ +2 0 10 14 Type B _j_ 8 4 15 Type A _j_ +3 0 8 16 Type A _j_ +3 0
10
Table 6.1.2.1.1-4: Definition of value _j_
_µ~PUSCH~_ _j_
* * *
0 1 1 1 2 2 3 3 5 11 6 21
Table 6.1.2.1.1-5: Definition of value _Δ_
_µ~PUSCH~_ _Δ_
* * *
0 2 1 3 2 4 3 6 5 24 6 48
#### 6.1.2.2 Resource allocation in frequency domain
The UE shall determine the resource block assignment in frequency domain using
the resource allocation field in the detected PDCCH DCI except for a PUSCH
transmission scheduled by a RAR UL grant or fallbackRAR UL grant, in which
case the frequency domain resource allocation is determined according to
clause 8.3 of [6, 38.213] or a MsgA PUSCH transmission with frequency domain
resource allocation determined according to clause 8.1A of [6, 38.213]. Three
uplink resource allocation schemes type 0, type 1 and type 2 are supported.
Uplink resource allocation scheme type 0 is supported for PUSCH only when
transform precoding is disabled. Uplink resource allocation scheme type 1 and
type 2 are supported for PUSCH for both cases when transform precoding is
enabled or disabled.
If the scheduling DCI is configured to indicate the uplink resource allocation
type as part of the \'_Frequency domain resource\'_ assignment field by
setting a higher layer parameter r _esourceAllocation_ in _pusch-Config_ to
\'dynamicSwitch\', for DCI format 0_1 or setting a higher layer parameter
_resourceAllocationDCI-0-2_ in _pusch-Config_ to \'dynamicSwitch\' for DCI
format 0_2 or setting a higher layer parameter _resourceAllocationDCI-0-3_ in
_pusch-Config_ to \'dynamicSwitch\' for DCI format 0_3, the UE shall use
uplink resource allocation type 0 or type 1 as defined by this DCI field.
Otherwise the UE shall use the uplink frequency resource allocation type as
defined by the higher layer parameter _resourceAllocation_ for DCI format 0_1
or the higher layer parameter _resourceAllocationDCI-0-2_ for DCI format 0_2.
The UE shall assume that when the scheduling PDCCH is received with DCI format
0_1 and _useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is configured_ ,
uplink type 2 resource allocation is used.
The UE shall assume that when the scheduling PDCCH is received with DCI format
0_0, then uplink resource allocation type 1 is used, except when any of the
higher layer parameters _useInterlacePUCCH-PUSCH in BWP-UplinkCommon and
useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is configured_ in which case
uplink resource allocation type 2 is used.
The UE expects that either none or both of _useInterlacePUCCH-PUSCH in BWP-
UplinkCommon and useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is
configured_.
If a bandwidth part indicator field is not configured in the scheduling DCI or
the UE does not support active bandwidth part change via DCI, the RB indexing
for uplink type 0, type 1 and type 2 resource allocation is determined within
the UE\'s active bandwidth part. If a bandwidth part indicator field is
configured in the scheduling DCI and the UE supports active bandwidh part
change via DCI, the RB indexing for uplink type 0, type 1, type 2 resource
allocation is determined within the UE\'s bandwidth part indicated by
bandwidth part indicator field value in the DCI. The UE shall upon detection
of PDCCH intended for the UE determine first the uplink bandwidth part and
then the resource allocation within the bandwidth part. RB numbering starts
from the lowest RB in the determined uplink bandwidth part.
##### 6.1.2.2.1 Uplink resource allocation type 0
In uplink resource allocation of type 0, the resource block assignment
information includes a bitmap indicating the Resource Block Groups (RBGs) that
are allocated to the scheduled UE where a RBG is a set of consecutive virtual
resource blocks defined by higher layer parameter _rbg-Size_ for DCI format
0_1/0_2 or _rbg-SizeDCI-0-3_ for DCI format 0_3 configured in _pusch-Config_
and the size of the bandwidth part as defined in Table 6.1.2.2.1-1.
Table 6.1.2.2.1-1: Nominal RBG size _P_
Bandwidth Part Size Configuration 1 Configuration 2 Configuration 3
* * *
1 -- 36 _2_ 4 8 37 -- 72 4 8 16 73 -- 144 8 16 32 145 -- 275 16 16 32
The total number of RBGs () for a uplink bandwidth part _i_ of sizePRBs is
given by where
\- the size of the first RBG is ,
\- the size of the last RBG is if and _P_ otherwise.
\- the size of all other RBG is _P_.
The bitmap is of size bits with one bitmap bit per RBG such that each RBG is
addressable. The RBGs shall be indexed in the order of increasing frequency of
the bandwidth part and starting at the lowest frequency. The order of RBG
bitmap is such that RBG 0 to RBG are mapped from MSB to LSB of the bitmap. The
RBG is allocated to the UE if the corresponding bit value in the bitmap is 1,
the RBG is not allocated to the UE otherwise.
In frequency range 1, only \'almost contiguous allocation\' defined in [8, TS
38.101-1] is allowed as non-contiguous allocation per component carrier for UL
RB allocation for CP-OFDM.
In frequency range 2, non-contiguous allocation per component carrier for UL
RB allocation for CP-OFDM is not supported.
##### 6.1.2.2.2 Uplink resource allocation type 1
In uplink resource allocation of type 1, the resource block assignment
information indicates to a scheduled UE a set of contiguously allocated non-
interleaved virtual resource blocks within the active bandwidth part of size
PRBs except for the case when DCI format 0_0 is decoded in any common search
space in which case the size of the initial UL bandwidth part shall be used.
An uplink type 1 resource allocation field consists of a resource indication
value (_RIV_) corresponding to a starting virtual resource block () and a
length in terms of contiguously allocated resource blocks. The resource
indication value is defined by
if then
else
where≥ 1 and shall not exceed.
When the DCI size for DCI format 0_0 in USS is derived from the initial UL BWP
with size but applied to another active BWP with size of , an uplink type 1
resource block assignment field consists of a resource indication value
(_RIV_) corresponding to a starting resource block and a length in terms of
virtually contiguously allocated resource blocks .
The resource indication value is defined by
if then
else
where, and where shall not exceed .
If , _K_ is the maximum value from set {1, 2, 4, 8} which satisfies ;
otherwise _K_ = 1.
When the scheduling grant is received with DCI format 0_2 or 0_3, an uplink
type 1 resource allocation field consists of a resource indication value
(_RIV_) corresponding to a starting resource block group _RBG~start~_ =0, 1,
..., _N~RBG~_ -1 and a length in terms of virtually contiguously allocated
resource block groups _L~RBGs~_ =1, ..., _N~RBG~_ , where the resource block
groups are defined as in 6.1.2.2.1 with _P_ defined by
_resourceAllocationType1GranularityDCI-0-2_ for DCI format 0_2 and by
_resourceAllocationType1GranularityDCI-0-3_ for DCI format 0_3 if the UE is
configured with higher layer parameter
_resourceAllocationType1GranularityDCI-0-2_ or
_resourceAllocationType1GranularityDCI-0-3_ , and _P=1 otherwise._ The
resource indication value is defined by
if then
else
where≥ 1 and shall not exceed .
##### 6.1.2.2.3 Uplink resource allocation type 2
In uplink resource allocation of type 2, the resource block assignment
information defined in [5, TS 38.212] indicates to a UE a set of up to _M_
interlace indices, and for DCI 0_0 monitored in a UE-specific search space and
DCI 0_1 a set of up to $\ N_{\text{RB}\text{-}set,UL}^{\text{BWP}}$ contiguous
RB sets, where _M_ and interlace indexing are defined in Clause 4.4.4.6 in [4,
TS 38.211]. Within the active UL BWP, the assigned physical resource block $n$
is mapped to virtual resource block $\text{n.}$ For DCI 0_0 monitored in a UE-
specific search space and DCI 0_1, the UE shall determine the resource
allocation in frequency domain as an intersection of the resource blocks of
the indicated interlaces and the union of the indicated set of RB sets and
intra-cell guard bands defined in Clause 7 between the indicated RB sets, if
any. For DCI 0_0 monitored in a common search space, the UE shall determine
the resource allocation in frequency domain as an intersection of the resource
blocks of the indicated interlaces and a single uplink RB set of the active UL
BWP. For DCI 0_0 monitored in a CSS with CRC scrambled by an RNTI other than
TC-RNTI, the uplink RB set is the lowest indexed one amongst uplink RB set(s)
that intersects the lowest-indexed CCE of the PDCCH in which the UE detects
the DCI 0_0 in the active downlink BWP. When the PDCCH reception includes two
PDCCH candidates from two respective search space sets, as described in clause
10.1 of [6, TS 38.213], for the purpose of determining the uplink RB set of a
PUSCH when scheduled by DCI 0_0 monitored in a CSS with CRC scrambled by an
RNTI other than TC-RNTI, the CORESET with lower ID among two CORESETs
associated with two PDCCH candidates is used. If there is no intersection, the
uplink RB set is RB set 0 in the active uplink BWP. For DCI 0_0 with CRC
scrambled by TC-RNTI, the uplink RB set is the same one in which the UE
transmits the PRACH associated with the RAR UL grant, in which case the UE
assumes that the uplink RB set is defined as when the UE is not configured
with _intraCellGuardBandsUL-List_ (see Clause 7).
For µ=0, the X=6 MSBs of the resource block assignment information indicates
to a UE a set of allocated interlace indices $m_{0} + l$, where the indication
consists of a resource indication value (_RIV_). For $0 \leq RIV  2 and _cyclicMapping_ in _ConfiguredGrantConfig_ is enabled, the
first and second SRS resource sets are applied to the first and second
(nominal) repetitions, respectively, and the same SRS resource set mapping
pattern continues to the remaining (nominal) repetitions.
\- When K > 2 and _sequentialMapping_ in _ConfiguredGrantConfig_ is enabled,
first SRS resource set is applied to the first and second (nominal)
repetitions, and the second SRS resource set is applied to the third and
fourth (nominal) repetitions, and the same SRS resource set mapping pattern
continues to the remaining (nominal) repetitions.
For PUSCH transmissions with a Type 1 configured grant, when two SRS resource
sets are configured in _srs-ResourceSetToAddModList_ or _srs-
ResourceSetToAddModListDCI-0-2_ , if configuredGrantConfig contains only one
_pathlossReferenceIndex, p0-PUSCH-Alpha, powerControlLoopToUse, srs-
ResourceIndicator and precodingAndNumberOfLayers_ (applicable when higher
layer parameter usage in _SRS-ResourceSet_ set to \'codebook\'), PUSCH
repetitions are associated only with the first SRS resource set.
If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList or
srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\', and the UE is not provided p0-PUSCH-Alpha2 and
powerControlLoopToUse2_ , for a retransmission of a configured grant Type 1
PUSCH, or for activation or retransmission of a configured grant Type 2 PUSCH,
scheduled by a DCI format that includes an SRS resource set indicator field,
the UE expects the value of the SRS resource set indicator field to be set to
\'00\', and PUSCH repetitions are associated only with the first SRS resource
set.
The UE shall not transmit anything on the resources configured by
_configuredGrantConfig_ if the higher layers did not deliver a transport block
to transmit on the resources allocated for uplink transmission without grant.
A set of allowed periodicities _P_ are defined in [12, TS 38.331]. The higher
layer parameter _cg-nrofSlots_ , provides the number of consecutive slots
allocated within a configured grant period. The higher layer parameter _cg-
nrofPUSCH-InSlot_ provides the number of consecutive PUSCH allocations within
a slot, where the first PUSCH allocation follows the higher layer parameter
_timeDomainAllocation_ for Type 1 PUSCH transmission or the higher layer
configuration according to [10, TS 38.321], and UL grant received on the DCI
for Type 2 PUSCH transmissions, and the remaining PUSCH allocations have the
same length and PUSCH mapping type, and are appended following the previous
allocations without any gaps. The higher layer parameter
_[nrofSlots_InCGperiod]_ provides the number of consecutive slots allocated
within a configured grant period. The same combination of start symbol and
length and PUSCH mapping type repeats over the consecutively allocated slots.
If [_nrofSlots_InCGperiod_] is configured, the PUSCH allocation in each
consecutive slot follows the higher layer parameter _timeDomainAllocation_ for
Type 1 PUSCH transmission or the higher layer configuration according to [10,
TS 38.321], and UL grant received in the DCI for Type 2 PUSCH transmissions.
If a UE is configured with higher layer parameter [_nrofSlots_InCGperiod_]
_[in a configuredGrantConfig]{.underline}_ , the UE does not expect to be
configured with _cg-nrofSlots_ and _cg-nrofPUSCH-InSlot [in the
configuredGrantConfig]{.underline}_.
For operation with shared spectrum channel access, and when the higher layer
parameter _semiStaticChannelAccessConfigUE_ is not configured, where a UE is
performing uplink transmission with configured grants in contiguous OFDM
symbols on all resource blocks of an RB set, for the first such UL
transmission the UE determines a duration of a cyclic prefix extension
_T~ext~_ to be applied for transmission according to [4, TS 38.211] where the
index for $\Delta_{i}$ [4, TS 38.211] is chosen randomly from a set of values
configured by higher layers according to the following rule:
\- If the first such UL transmission is within a channel occupancy initiated
by the gNB (defined in Clause 4 of [16, TS 37.213]), the set of values is
determined by _cg-StartingFullBW-InsideCOT_ ;
\- otherwise, the set of values is determined by _cg-StartingFullBW-
OutsideCOT_.
For operation with shared spectrum channel access, and when the higher layer
parameter _semiStaticChannelAccessConfigUE_ is not configured, where a UE is
performing uplink transmission with configured grants in contiguous OFDM
symbols on fewer than all resource blocks of an RB set, for the first such UL
transmission the UE determines a duration of a cyclic prefix extension
_T~ext~_ to be applied for transmission according to [4, TS 38.211] according
to the following rule:
\- If the first such UL transmission is within a channel occupancy initiated
by the gNB (defined in Clause 4 of [16, TS 37.213]), the index for
$\Delta_{i}$ [4, TS 38.211] is equal to _cg-StartingPartialBW-InsideCOT_ ;
\- otherwise, the index for $\Delta_{i}$ [4, TS 38.211] is equal to _cg-
StartingPartialBW-OutsideCOT._
##### 6.1.2.3.1 Transport Block repetition for uplink transmissions of PUSCH
repetition Type A with a configured grant
The procedures described in this clause apply to PUSCH transmissions of PUSCH
repetition Type A with a Type 1 or Type 2 configured grant.
The higher layer parameter _repK-RV_ defines the redundancy version pattern to
be applied to the repetitions. If _cg-RetransmissionTimer_ is provided, the
redundancy version for uplink transmission with a configured grant is
determined by the UE. If the parameter _repK-RV_ is not provided in the
_configuredGrantConfig_ and _cg-RetransmissionTimer_ is not provided, the
redundancy version for uplink transmissions with a configured grant shall be
set to 0. If the parameter _repK-RV_ is provided in the
_configuredGrantConfig_ and _cg-RetransmissionTimer_ is not provided, for the
_n_ th transmission occasion among _K_ repetitions, _n_ =1, 2, ..., _K_ , it
is associated with _(mod(((n-mod(n, N))/N)-1,4)+1)^th^_ value in the
configured RV sequence, where _N_ =1. If a configured grant configuration is
configured with _startingFromRV0_ set to _\'off\'_ , the initial transmission
of a transport block may only start at the first transmission occasion of the
_K_ repetitions. Otherwise, the initial transmission of a transport block may
start at
\- the first transmission occasion of the _K_ repetitions if the configured RV
sequence is {0,2,3,1},
\- any of the transmission occasions of the _K_ repetitions that are
associated with RV=0 if the configured RV sequence is {0,3,0,3},
\- any of the transmission occasions of the _K_ repetitions if the configured
RV sequence is {0,0,0,0}, except the last transmission occasion when _K≥8_.
When the transmission occasions are associated with the first and second SRS
resource sets, if the parameter _repK-RV_ is provided in the
_configuredGrantConfig_ , for the _n_ th transmission occasion among _all_
transmission occasions that are associated with the SRS resource set of the
first transmission occasion, it is associated with _(mod(n-1,4)+1)^th^_ value
in the configured RV sequence, and for the _n_ th transmission occasion among
all transmission occasions that are not associated with the SRS resource set
of the first transmission occasion, it is associated with _(mod(n-1,4)+1)^th^_
value in the adjusted RV sequence and the adjustment is based on additional
shifting operation on the configured RV sequence, where the shifting operation
is defined as $\left( \text{rv}_{i} + \ \text{rv}_{s} \right)\text{mod}\ 4$
where $\text{rv}_{i}\ $is the _i^th^_ RV value (_i_ =1, 2, 3, 4) in the
configured RV sequence and $\text{rv}_{s}$ is configured by the higher layer
parameter _sequenceOffsetforRV_ in _configuredGrantConfig_. When the
transmission occasions are associated with the first and second SRS resource
sets, if a configured grant configuration is configured with _startingFromRV0_
set to _\'off\'_ , the initial transmission of a transport block may only
start at the first transmission occasion of the _K_ repetitions. Otherwise,
the initial transmission of a transport block may start at
\- the first transmission occasion associated with RV = 0 corresponding to the
first or second SRS resource set of the _K_ repetitions if the configured RV
sequence is {0,2,3,1},
\- any of the transmission occasions of the _K_ repetitions that are
associated with RV=0 if the configured RV sequence is {0,3,0,3},
\- any of the transmission occasions of the _K_ repetitions if the configured
RV sequence is {0,0,0,0}, except the last transmission occasion when _K≥8_.
After the initial transmission of a transport block, later transmission
occasions among the _K_ repetitions associated with any RV value and
associated to any of the first or second SRS resource set can be used for
transmitting the transport block.
For any RV sequence, the repetitions shall be terminated after transmitting
_K_ repetitions, or at the last transmission occasion among the _K_
repetitions within the period _P_ , or from the starting symbol of the
repetition that overlaps with a PUSCH with the same HARQ process scheduled by
DCI format 0_0, 0_1, 0_2 or 0_3, whichever is reached first. In addition, the
UE shall terminate the repetition of a transport block in a PUSCH transmission
if the UE receives a DCI format 0_1 with DFI flag provided and set to \'1\',
and if in this DCI the UE detects ACK for the HARQ process corresponding to
that transport block.
The UE is not expected to be configured with the time duration for the
transmission of _K_ repetitions larger than the time duration derived by the
periodicity _P_. If the UE determines that, for a transmission occasion, the
number of symbols available for the PUSCH transmission in a slot is smaller
than transmission duration _L_ , the UE does not transmit the PUSCH in the
transmission occasion.
For both Type 1 and Type 2 PUSCH transmissions with a configured grant, when
_K > 1,_
\- For unpaired spectrum:
\- If _AvailableSlotCounting_ is enabled, the UE shall repeat the TB across
the $N \bullet K$ slots determined for the PUSCH transmission applying the
same symbol allocation in each slot.
\- A slot is not counted in the number of $N \bullet K$ slots if at least one
of the symbols indicated by the indexed row of the used resource allocation
table in the slot overlaps with a DL symbol indicated by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ if provided, or a
symbol of an SS/PBCH block with index provided by _ssb-PositionsInBurst_.
\- Otherwise, the UE shall repeat the TB across the $N \bullet K$ consecutive
slots applying the same symbol allocation in each slot, except if the UE is
provided with higher layer parameters _cg-nrofSlots_ and _cg-nrofPUSCH-InSlot_
, in which case the UE repeats the TB in the _repK_ earliest consecutive
transmission occasion candidates within the same configuration.
\- For paired spectrum and SUL band:
\- The UE shall repeat the TB across the $N \bullet K$ consecutive slots
applying the same symbol allocation in each slot, except if the UE is provided
with higher layer parameters _cg-nrofSlots_ and _cg-nrofPUSCH-InSlot_ , in
which case the UE repeats the TB in the _repK_ earliest consecutive
transmission occasion candidates within the same configuration.
\- If _AvailableSlotCounting_ is enabled, and in case of reduced capability
half-duplex UE, the UE shall repeat the TB across the $N \bullet K$ slots
applying the same symbol allocation in each slot. A slot is not counted in the
number of $N \bullet K$ slots if at least one of the symbols indicated by the
indexed row of the used resource allocation table in the slot does not start
or end at least $N_{\text{R}\text{x-}\text{T}\text{x}} \cdot T_{\text{c}}$ or
$N_{\text{T}\text{x-}\text{R}\text{x}} \cdot T_{\text{c}}$, respectively, from
the last or first symbol of an SS/PBCH block with index provided by _ssb-
PositionsInBurst_.
A Type 1 or Type 2 PUSCH transmission with a configured grant in a slot is
omitted according to the conditions in Clause 9, Clause 11.1, Clause 11.2A,
Clause 15 and Clause 17.2 of [6, TS 38.213].
##### 6.1.2.3.2 Transport Block repetition for uplink transmissions of PUSCH
repetition Type B with a configured grant
The procedures described in this Clause apply to PUSCH transmissions of PUSCH
repetition type B with a Type 1 or Type 2 configured grant.
For PUSCH transmissions with a Type 1 or Type 2 configured grant, the nominal
repetitions and the actual repetitions are determined according to the
procedures for PUSCH repetition Type B defined in Clause 6.1.2.1. The higher
layer configured parameters _repK-RV_ defines the redundancy version pattern
to be applied to the repetitions. If the parameter _repK-RV_ is not provided
in the _configuredGrantConfig_ , the redundancy version for each actual
repetition with a configured grant shall be set to 0. Otherwise, for the _n_
th transmission occasion among all the actual repetitions (including the
actual repetitions that are omitted) of the _K_ nominal repetitions, it is
associated with _(mod(((n-mod(n, N))/N)-1,4)+1)^th^_ value in the configured
RV sequence, where _N_ = 1. If a configured grant configuration is configured
with _startingFromRV0_ set to _\'off\'_ , the initial transmission of a
transport block may only start at the first transmission occasion of the
actual repetitions. Otherwise, the initial transmission of a transport block
may start at
\- the first transmission occasion of the actual repetitions if the configured
RV sequence is {0,2,3,1},
\- any of the transmission occasions of the actual repetitions that are
associated with RV=0 if the configured RV sequence is {0,3,0,3},
\- any of the transmission occasions of the actual repetitions if the
configured RV sequence is {0,0,0,0}, except the actual repetitions within the
last nominal repetition when _K≥8_.
When the transmission occasions are associated with the first and second SRS
resource sets, if the parameter _repK-RV_ is provided in the
_configuredGrantConfig_ , for the _n_ th transmission occasion among _all_
actual repetitions (including the actual repetitions that are omitted) that
are associated with the SRS resource set of the first transmission occasion,
it is associated with _(mod(n-1,4)+1)^th^_ value in the configured RV
sequence, and for the _n_ th transmission occasion among all actual
repetitions that are not associated with the SRS resource set of the first
transmission occasion, it is associated with _(mod(n-1,4)+1)^th^_ value in the
adjusted RV sequence and the adjustment is based on additional shifting
operation on the configured RV sequence, where the shifting operation is
defined as $\left( \text{rv}_{i} + \ \text{rv}_{s} \right)\text{mod}\ 4$ where
$\text{rv}_{i}\ $is the _i^th^_ RV value (_i_ =1, 2, 3, 4) in the configured
RV sequence and $\text{rv}_{s}$ is configured by the higher layer parameter
_sequenceOffsetforRV_ in _configuredGrantConfig_. When the transmission
occasions are associated with the first and second SRS resource sets, if a
configured grant configuration is configured with _startingFromRV0_ set to
_\'off\'_ , the initial transmission of a transport block may only start at
the first transmission occasion of the _K_ repetitions. Otherwise, the initial
transmission of a transport block may start at
\- the first transmission occasion associated with RV = 0 corresponding to the
first or second SRS resource set of the _K_ repetitions if the configured RV
sequence is {0,2,3,1},
\- any of the transmission occasions of the _K_ repetitions that are
associated with RV=0 if the configured RV sequence is {0,3,0,3},
\- any of the transmission occasions of the _K_ repetitions if the configured
RV sequence is {0,0,0,0}, except the last transmission occasion when _K≥8_.
After the initial transmission of a transport block, later transmission
occasions among the _K_ repetitions associated with any RV value and
associated to any of the first or second SRS resource set can be used for
transmitting the transport block.
For any RV sequence, the repetitions shall be terminated after transmitting K
nominal repetitions, or at the last transmission occasion among the _K_
nominal repetitions within the period _P_ , or from the starting symbol of an
actual repetition that overlaps with a PUSCH with the same HARQ process
scheduled by DCI format 0_0, 0_1, 0_2 or 0_3, whichever is reached first. The
UE is not expected to be configured with the time duration for the
transmission of _K_ nominal repetitions larger than the time duration derived
by the periodicity _P_.
##### 6.1.2.3.3 Transport Block repetition for uplink transmissions of TB
processing over multiple slots with a configured grant
The procedures described in this clause apply to PUSCH transmissions of TB
processing over multiple slots with a Type 2 configured grant.
The higher layer parameter _repK-RV_ defines the redundancy version pattern to
be applied to the repetitions. If the parameter _repK-RV_ is not provided in
the _configuredGrantConfig_ , the redundancy version for uplink transmissions
with a configured grant shall be set to 0. If the parameter _repK-RV_ is
provided in the _configuredGrantConfig_ , the _n_ th transmission occasion
among $N \bullet K$ transmissions occasions, _n_ =0,1, ..., $N \bullet K$ _-1_
, is associated with _(mod((n-mod(n, N))/N,4)+1)^th^_ value in the configured
RV sequence. When _K_ =1, or when _K_ >1 and the configured grant
configuration is configured with startingFromRV0 set to \'off\', the initial
transmission of the transport block may only start at the first transmission
occasion of the $N \bullet K$ transmission occasions. Otherwise, the initial
transmission of the transport block may start at
\- The first transmission occasion of the $N \bullet K$ transmission occasions
if the configured RV sequence is {0,2,3,1}.
\- Any transmission occasion n associated with RV=0, and for which n mod N =0,
if the configured RV sequence is {0,3,0,3} or {0,0,0,0}.
The UE is not expected to be configured with the time duration for $N \bullet
K$ transmissions larger than the time duration derived by the periodicity _P_.
If the UE determines that, for a transmission occasion, the number of symbols
available in a slot for the PUSCH transmission of TB processing over multiple
slots is smaller than transmission duration _L_ , the UE does not transmit the
PUSCH in the transmission occasion.
For unpaired spectrum:
\- The UE determines $N \bullet K$ slots for a PUSCH transmission of TB
processing over multiple slots with a Type 2 configured grant activated by DCI
format 0_1 or 0_2, based on _tdd-UL-DL-ConfigurationCommon_ , _tdd-UL-DL-
ConfigurationDedicated_ and _ssb-PositionsInBurst_ , and the TDRA information
field value in the DCI format 0_1 or 0_2.
\- A slot is not counted in the number of $N \bullet K$ slots for a PUSCH
transmission of TB processing over multiple slots with a Type 2 configured
grant activated by DCI format 0_1 or 0_2 if at least one of the symbols
indicated by the indexed row of the used resource allocation table in the slot
overlaps with a DL symbol indicated by _tdd-UL-DL-ConfigurationCommon_ or
_tdd-UL-DL-ConfigurationDedicated_ if provided, or a symbol of an SS/PBCH
block with index provided by _ssb-PositionsInBurst_.
For paired spectrum and SUL band:
\- The UE determines $N \bullet K$ consecutive slots for a PUSCH transmission
of TB processing over multiple slots with a Type 2 configured grant activated
by DCI format 0_1 or 0_2, based on the TDRA information field value in the DCI
format 0_1 or 0_2.
\- For the case of a reduced capability half-duplex UE, the UE determines $N
\bullet K$ slots for a PUSCH transmission of TB processing over multiple slots
with a Type 2 configured grant activated by DCI format 0_1 or 0_2, based on
the TDRA information field value in the DCI format 0_1 or 0_2. A slot is not
counted in the number of $N \bullet K$ slots if at least one of the symbols
indicated by the indexed row of the used resource allocation table in the slot
does not start or end at least $N_{\text{R}\text{x-}\text{T}\text{x}} \cdot
T_{\text{c}}$ or $N_{\text{T}\text{x-}\text{R}\text{x}} \cdot T_{\text{c}}$,
respectively, from the last or first symbol of an SS/PBCH block with index
provided by _ssb-PositionsInBurst_.
For Type 2 PUSCH transmission with a configured grant of TB processing over
multiple slots _,_ the UE shall transmit the TB across the $N \bullet K$ slots
determined for the PUSCH transmission applying the same symbol allocation in
each slot. A Type 2 PUSCH transmission with a configured grant of TB
processing over multiple slots is omitted in a slot according to the
conditions in Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2
of [6, TS 38.213].
### 6.1.3 UE procedure for applying transform precoding on PUSCH
For a PUSCH scheduled by RAR UL grant, or for a PUSCH scheduled by fallbackRAR
UL grant, or for a PUSCH scheduled by DCI format 0_0 with CRC scrambled by TC-
RNTI, the UE shall consider the transform precoding either \'enabled\' or
\'disabled\' according to the higher layer configured parameter
_msg3-transformPrecoder._
For a MsgA PUSCH, the UE shall consider the transform precoding either
\'enabled\' or \'disabled\' according to the higher layer configured parameter
_msgA-TransformPrecoder. If higher layer parameter msgA-TransformPrecoder is
not configured,_ the UE shall consider the transform precoding either
\'enabled\' or \'disabled\' according to the higher layer configured parameter
_msg3-transformPrecoder._
For PUSCH transmission scheduled by a PDCCH with CRC scrambled by CS-RNTI with
NDI=1, C-RNTI, or MCS-C-RNTI or SP-CSI-RNTI:
\- If the DCI with the scheduling grant was received with DCI format 0_0, the
UE shall, for this PUSCH transmission, consider the transform precoding either
enabled or disabled according to the higher layer configured parameter
_msg3-transformPrecoder_.
\- If the DCI with the scheduling grant was not received with DCI format 0_0
\- If the DCI with the scheduling grant was received with DCI format 0_1 or
0_2 with CRC scrambled by C-RNTI, MCS-RNTI, or CS-RNTI with NDI=1 and if the
UE is configured with a higher layer parameter
[_dynamicTransformPrecoderIndicationDCI-0-1]_ in _pusch-Config_ for DCI format
0_1 or [_dynamicTransformPrecoderIndicationDCI-0-2]_ in _pusch-Config_ for DCI
format 0_2 and the higher layer parameter is set to 'enabled', the UE shall,
for this PUSCH transmission, consider the transform precoding either enabled
or disabled according to the Transform precoder indicator field in the DCI
with the scheduling grant.
\- For _pusch-TimeDomainAllocationListForMultiPUSCH_ in _pusch-Config,_ the UE
shall, for all PUSCH transmissions, consider the transform precoding either
enabled or disabled according to Transform precoder indicator field in the DCI
format 0_1 with the scheduling grant.
\- Otherwise,
\- If the UE is configured with the higher layer parameter _transformPrecoder
in pusch-Config_ , the UE shall, for this PUSCH transmission, consider the
transform precoding either enabled or disabled according to this parameter.
\- If the UE is not configured with the higher layer parameter
_transformPrecoder in pusch-Config_ , the UE shall, for this PUSCH
transmission, consider the transform precoding either enabled or disabled
according to the higher layer configured parameter _msg3-transformPrecoder_.
For PUSCH transmission with a configured grant
\- If the UE is configured with the higher layer parameter _transformPrecoder
in configuredGrantConfig_ , the UE shall, for this PUSCH transmission,
consider the transform precoding either enabled or disabled according to this
parameter.
\- If the UE is not configured with the higher layer parameter
_transformPrecoder in configuredGrantConfig_ , the UE shall, for this PUSCH
transmission, consider the transform precoding either enabled or disabled
according to the higher layer configured parameter _msg3-transformPrecoder_.
### 6.1.4 Modulation order, redundancy version and transport block size
determination
To determine the modulation order, target code rate, redundancy version and
transport block size for the physical uplink shared channel, the UE shall
first
\- read the 5-bit modulation and coding scheme field in the DCI scheduling
PUSCH or provided in a DCI activating a configured grant Type 2 PUSCH, or as
provided by _mcsAndTBS_ as described in Clause 6.1.2.3 for a configured grant
Type 1 PUSCH to determine the modulation order and target code rate (_R_)
based on the procedure defined in Clause 6.1.4.1
\- read redundancy version field (_rv_) in the DCI to determine the redundancy
version for PUSCH scheduled by DCI, or determine the redundancy version
according to Clause 6.1.2.3.1 for configured grant Type 1 and Type 2 PUSCH,
and second
\- use the number of layers , the total number of allocated PRBs to determine
the transport block size based on the procedure defined in Clause 6.1.4.2.
When the UE is scheduled with multiple PUSCHs on a serving cell by a DCI, as
described in clause 6.1.2.1, the bits of _rv_ field and NDI field,
respectively, in the DCI are one to one mapped to the scheduled PUSCH(s)
indicated by the TDRA information field with the corresponding transport
block(s) in the scheduled order where the LSB bits of the _rv_ field and NDI
field, respectively, correspond to the last scheduled PUSCH indicated by the
TDRA information field.
Within a cell group, a UE is not required to handle PUSCH(s) transmissions in
slot _s~j~_ in serving cell-_j_ , and for _j_ = 0,1,2.. _J-1_ , slot _s~j~_
overlapping with any given point in time, if the following condition is not
satisfied at that point in time:
$\sum_{j = 0}^{J - 1}\frac{\sum_{m = 0}^{M -
1}V_{j,m}}{T_{\text{slot}}^{\mu(j)}} \leq \text{DataRate}$,
where
_\- J_ is the number of configured serving cells belong to a frequency range
\- for the _j-th_ serving cell,
_\- M_ is the number of TB(s) transmitted in slot-_s~j~_. For PUSCH repetition
Type B, each actual repetition is counted separately.
_\- T~slot~^μ(j)^_ =10^-3^/2^_μ(j_)^, where _μ(j)_ is the numerology for
PUSCH(s) in slot _s~j~_ of the _j_ -th serving cell.
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
_\- A_ is the number of bits in the transport block as defined in Clause 6.2.1
[5, TS 38.212]
_\- C_ _is the total number of code blocks for the transport block_ defined in
Clause 5.2.2 [5, TS 38.212].$\ $
\- $C'$is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5,38.212]
\- $\text{DataRate}$ [Mbps] is computed as the maximum data rate summed over
all the carriers in the frequency range for any signaled band combination and
feature set consistent with the configured servings cells, where the data rate
value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including
the scaling factor _f(i)._
For a _j_ -th serving cell, if higher layer parameter _processingType2Enabled_
of _PUSCH-ServingCellConfig_ is configured for the serving cell and set to
\'_enable\',_ or if at least one _I~MCS~ > W_ for [ ]{.underline} a PUSCH,
where _W_ = 28 for MCS tables 5.1.3.1-1 and 5.1.3.1-3, and _W_ = 27 for MCS
tables 5.1.3.1-2, 6.1.4.1-1, and 6.1.4.1-2, or if it is an actual repetition
for PUSCH repetition Type B, the UE is not required to handle PUSCH
transmissions, if the following condition is not satisfied:
$$\frac{\sum_{m = 0}^{M - 1}V_{j,m}}{L \times T_{s}^{\mu}} \leq
\text{DataRateCC}$$
_where_
\- $\text{L\ }$is the number of symbols assigned to the PUSCH
\- _M_ is the number of TB in the PUSCH
\- $T_{s}^{\mu} = \frac{10^{- 3}}{{2^{\mu} \bullet
N}_{\text{symb}}^{\text{slot}}}$ where μ is the numerology of the PUSCH
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
\- _A_ is the number of bits in the transport block as defined in Clause 6.2.1
[5, TS 38.212]
\- _C_ is the total number of code blocks for the transport block defined in
Clause 5.2.2 [5, TS 38.212]
\- $C'$ is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5, TS 38.212]
\- $\text{DataRateCC}$ [Mbps] is computed as the maximum data rate for a
carrier in the frequency band of the serving cell for any signaled band
combination and feature set consistent with the serving cell, where the data
rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306],
including the scaling factor _f(i)_
\- _each actual repetition for PUSCH repetition type B is treated as one
PUSCH._
#### 6.1.4.1 Modulation order and target code rate determination
For a PUSCH scheduled by RAR UL grant or
for a PUSCH scheduled by a fallbackRAR UL grant or
for a MsgA PUSCH transmission, or
for a PUSCH scheduled by a DCI format 0_0 with CRC scrambled by C-RNTI, MCS-C-
RNTI, TC-RNTI, CS-RNTI, or
for a PUSCH scheduled by a DCI format 0_1 or DCI format 0_2 with CRC scrambled
by C-RNTI, MCS-C-RNTI, CS-RNTI, SP-CSI-RNTI, or
for a PUSCH scheduled by a DCI format 0_3 with CRC scrambled by C-RNTI, MCS-C-
RNTI, or
for a PUSCH with configured grant using CS-RNTI, and
if transform precoding is disabled for this PUSCH transmission according to
Clause 6.1.3
\- if _mcs-TableDCI-0-2_ in _pusch-Config_ is set to \'qam256\', and PUSCH is
scheduled by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-
CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel;
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-TableDCI-0-2_ in
_pusch-Config_ is set to \'qam64LowSE\', and the PUSCH is scheduled by a PDCCH
by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-CSI-RNTI,
> \- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif _mcs-Table_ in _pusch-Config_ is set to \'qam256\', and PUSCH is
scheduled by a PDCCH with DCI format 0_1 or 0_3with CRC scrambled by C-RNTI or
SP-CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-Table_ in _pusch-
Config_ is set to \'qam64LowSE\', and the PUSCH is scheduled by a PDCCH with a
DCI format other than DCI format 0_2 in a UE-specific search space with CRC
scrambled by C-RNTI or SP-CSI-RNTI,
> \- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif the UE is configured with MCS-C-RNTI, and the PUSCH is scheduled by
a PDCCH with CRC scrambled by MCS-C-RNTI,
> \- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif _mcs-Table_ in _configuredGrantConfig_ is set to \'qam256\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif _mcs-Table_ in _configuredGrantConfig_ is set to \'qam64LowSE\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif for a MsgA PUSCH transmission,
\- the UE shall use higher layer parameter _msgA-MCS_ for _I~MCS~_ and Table
5.1.3.1-1 to determine the Target code rate (_R_) used in the physical uplink
shared channel.
\- elseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10,
TS 38.321], when transmitting PUSCH scheduled by RAR UL grant,
\- the 2 LSBs of the MCS information field of the RAR UL grant provide a
codepoint to determine the MCS index _I~MCS~_ according to Table 6.1.4.1-3,
based on whether or not the higher layer parameter _mcs-Msg3-Repetitions_ is
configured. The UE shall use the determined _I~MCS~_ and Table 5.1.3.1-1 to
determine the modulation order (_Q~m~_) and Target code rate (_R_) used in the
physical uplink shared channel.
\- elseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10,
TS 38.321], when transmitting PUSCH scheduled by DCI format 0_0 with CRC
scrambled by the TC-RNTI,
\- the 3 LSBs of the MCS information field of the DCI format 0_0 with CRC
scrambled by the TC-RNTI provide a codepoint to determine the MCS index
_I~MCS~_ according to Table 6.1.4.1-4, based on whether or not the higher
layer parameter _mcs-Msg3-Repetitions_ is configured. The UE shall use the
determined _I~MCS~_ and Table 5.1.3.1-1 to determine the modulation order
(_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- else
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-1 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
else
\- if _mcs-TableTransformPrecoderDCI-0-2_ in _pusch-Config_ is set to
\'qam256\', and PUSCH is scheduled by a PDCCH with DCI format 0_2 with CRC
scrambled by C-RNTI or SP-CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1.-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-
TableTransformPrecoderDCI-0-2_ in _pusch-Config_ is set to \'qam64LowSE\', and
the PUSCH is scheduled by a PDCCH with DCI format 0_2 with CRC scrambled by
C-RNTI or SP-CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif _mcs-TableTransformPrecoder_ in _pusch-Config_ is set to \'qam256\',
and PUSCH is scheduled by a PDCCH with DCI format 0_1 or 0_3 with CRC
scrambled by C-RNTI or SP-CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1.-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-
TableTransformPrecoder_ in _pusch-Config_ is set to \'qam64LowSE\', and the
PUSCH is scheduled by a PDCCH with a DCI format other than DCI format 0_2 in a
UE-specific search space with CRC scrambled by C-RNTI or SP-CSI-RNTI,
> \- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif the UE is configured with MCS-C-RNTI, and the PUSCH is scheduled by
a PDCCH with CRC scrambled by MCS-C-RNTI,
> \- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif _mcs-TableTransformPrecoder_ in _configuredGrantConfig_ is set to
\'qam256\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif _mcs-TableTransformPrecoder_ in _configuredGrantConfig_ is set to
\'qam64LowSE\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant,
\- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif for a MsgA PUSCH transmission,
\- the UE shall use higher layer parameter _MsgA-MCS_ for _I~MCS~_ and Table
6.1.4.1-1 to determine the Target code rate (_R_) used in the physical uplink
shared channel.
\- the UE shall use _q=2_ for determining modulation order _Q~m~_ in Table
6.1.4.1-1.
\- elseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10,
TS 38.321], when transmitting PUSCH scheduled by RAR UL grant,
\- the 2 LSBs of the MCS information field of the RAR UL grant provide a
codepoint to determine the MCS index _I~MCS~_ according to Table 6.1.4.1-3,
based on whether or not the higher layer parameter _mcs-Msg3-Repetitions_ is
configured. The UE shall use the determined _I~MCS~_ and Table 6.1.4.1-1 to
determine the modulation order (_Q~m~_) and Target code rate (_R_) used in the
physical uplink shared channel.
\- elseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10,
TS 38.321], when transmitting PUSCH scheduled by DCI format 0_0 with CRC
scrambled by the TC-RNTI,
\- the 3 LSBs of the MCS information field of the DCI format 0_0 with CRC
scrambled by the TC-RNTI provide a codepoint to determine the MCS index
_I~MCS~_ according to Table 6.1.4.1-4, based on whether or not the higher
layer parameter _mcs-Msg3-Repetitions_ is configured. The UE shall use the
determined _I~MCS~_ and Table 6.1.4.1-1 to determine the modulation order
(_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
> \- else
\- the UE shall use _I~MCS~_ and Table 6.1.4.1-1to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
end
For Table 6.1.4.1-1 and Table 6.1.4.1-2, if higher layer parameter _tp-
pi2BPSK_ is configured, _q_ = 1 otherwise _q_ =2.
Table 6.1.4.1-1: MCS index table for PUSCH with transform precoding and 64QAM
+--------------+----------------+----------------+----------------+ | **MCS Index\ |** Modulation | **Target code |** Spectral**| |**_I~MCS~_ | Order\ | Rate R**x | | | | **_Q~m~_ | 1024**\ | **efficiency** | | | | ** | | +==============+================+================+================+ | **0** | q | 240/ q | 0.2344 | +--------------+----------------+----------------+----------------+ | **1** | q | 314/ q | 0.3066 | +--------------+----------------+----------------+----------------+ | **2** | 2 | 193 | 0.3770 | +--------------+----------------+----------------+----------------+ | **3** | 2 | 251 | 0.4902 | +--------------+----------------+----------------+----------------+ | **4** | 2 | 308 | 0.6016 | +--------------+----------------+----------------+----------------+ | **5** | 2 | 379 | 0.7402 | +--------------+----------------+----------------+----------------+ | **6** | 2 | 449 | 0.8770 | +--------------+----------------+----------------+----------------+ | **7** | 2 | 526 | 1.0273 | +--------------+----------------+----------------+----------------+ | **8** | 2 | 602 | 1.1758 | +--------------+----------------+----------------+----------------+ | **9** | 2 | 679 | 1.3262 | +--------------+----------------+----------------+----------------+ | **10** | ~~4~~ | 340 | 1.3281 | +--------------+----------------+----------------+----------------+ | **11** | 4 | 378 | 1.4766 | +--------------+----------------+----------------+----------------+ | **12** | 4 | 434 | 1.6953 | +--------------+----------------+----------------+----------------+ | **13** | 4 | 490 | 1.9141 | +--------------+----------------+----------------+----------------+ | **14** | 4 | 553 | 2.1602 | +--------------+----------------+----------------+----------------+ | **15** | 4 | 616 | 2.4063 | +--------------+----------------+----------------+----------------+ | **16** | 4 | 658 | 2.5703 | +--------------+----------------+----------------+----------------+ | **17** | 6 | 466 | 2.7305 | +--------------+----------------+----------------+----------------+ | **18** | 6 | 517 | 3.0293 | +--------------+----------------+----------------+----------------+ | **19** | 6 | 567 | 3.3223 | +--------------+----------------+----------------+----------------+ | **20** | 6 | 616 | 3.6094 | +--------------+----------------+----------------+----------------+ | **21** | 6 | 666 | 3.9023 | +--------------+----------------+----------------+----------------+ | **22** | 6 | 719 | 4.2129 | +--------------+----------------+----------------+----------------+ | **23** | 6 | 772 | 4.5234 | +--------------+----------------+----------------+----------------+ | **24** | 6 | 822 | 4.8164 | +--------------+----------------+----------------+----------------+ | **25** | 6 | 873 | 5.1152 | +--------------+----------------+----------------+----------------+ | **26** | 6 | 910 | 5.3320 | +--------------+----------------+----------------+----------------+ | **27** | 6 | 948 | 5.5547 | +--------------+----------------+----------------+----------------+ | **28** | q | reserved | | +--------------+----------------+----------------+----------------+ | **29** | 2 | reserved | | +--------------+----------------+----------------+----------------+ | **30** | 4 | reserved | | +--------------+----------------+----------------+----------------+ | **31** | 6 | reserved | | +--------------+----------------+----------------+----------------+
Table 6.1.4.1-2: MCS index table 2 for PUSCH with transform precoding and
64QAM
+--------------+----------------+----------------+----------------+ | **MCS Index\ |** Modulation | **Target code |** Spectral**| |**_I~MCS~_ | Order\ | Rate R**x | | | | **_Q~m~_ | 1024**\ | **efficiency** | | | | ** | | +==============+================+================+================+ | **0** | _q_ | 60/_q_ | 0.0586 | +--------------+----------------+----------------+----------------+ | **1** | _q_ | 80/_q_ | 0.0781 | +--------------+----------------+----------------+----------------+ | **2** | _q_ | 100/_q_ | 0.0977 | +--------------+----------------+----------------+----------------+ | **3** | _q_ | 128/_q_ | 0.1250 | +--------------+----------------+----------------+----------------+ | **4** | _q_ | 156/_q_ | 0.1523 | +--------------+----------------+----------------+----------------+ | **5** | _q_ | 198/_q_ | 0.1934 | +--------------+----------------+----------------+----------------+ | **6** | 2 | 120 | 0.2344 | +--------------+----------------+----------------+----------------+ | **7** | 2 | 157 | 0.3066 | +--------------+----------------+----------------+----------------+ | **8** | 2 | 193 | 0.3770 | +--------------+----------------+----------------+----------------+ | **9** | 2 | 251 | 0.4902 | +--------------+----------------+----------------+----------------+ | **10** | 2 | 308 | 0.6016 | +--------------+----------------+----------------+----------------+ | **11** | 2 | 379 | 0.7402 | +--------------+----------------+----------------+----------------+ | **12** | 2 | 449 | 0.8770 | +--------------+----------------+----------------+----------------+ | **13** | 2 | 526 | 1.0273 | +--------------+----------------+----------------+----------------+ | **14** | 2 | 602 | 1.1758 | +--------------+----------------+----------------+----------------+ | **15** | 2 | 679 | 1.3262 | +--------------+----------------+----------------+----------------+ | **16** | 4 | 378 | 1.4766 | +--------------+----------------+----------------+----------------+ | **17** | 4 | 434 | 1.6953 | +--------------+----------------+----------------+----------------+ | **18** | 4 | 490 | 1.9141 | +--------------+----------------+----------------+----------------+ | **19** | 4 | 553 | 2.1602 | +--------------+----------------+----------------+----------------+ | **20** | 4 | 616 | 2.4063 | +--------------+----------------+----------------+----------------+ | **21** | 4 | 658 | 2.5703 | +--------------+----------------+----------------+----------------+ | **22** | 4 | 699 | 2.7305 | +--------------+----------------+----------------+----------------+ | **23** | 4 | 772 | 3.0156 | +--------------+----------------+----------------+----------------+ | **24** | 6 | 567 | 3.3223 | +--------------+----------------+----------------+----------------+ | **25** | 6 | 616 | 3.6094 | +--------------+----------------+----------------+----------------+ | **26** | 6 | 666 | 3.9023 | +--------------+----------------+----------------+----------------+ | **27** | 6 | 772 | 4.5234 | +--------------+----------------+----------------+----------------+ | **28** | q | reserved | | +--------------+----------------+----------------+----------------+ | **29** | 2 | reserved | | +--------------+----------------+----------------+----------------+ | **30** | 4 | reserved | | +--------------+----------------+----------------+----------------+ | **31** | 6 | reserved | | +--------------+----------------+----------------+----------------+
Table 6.1.4.1-3: MCS index _I~MCS~_ as a function of 2 LSBs of MCS information
field in RAR UL grant
_mcs-Msg3-Repetitions is configured_ _mcs-Msg3-Repetitions is not configured_
* * *
_Codepoint_ _I~MCS~_ Codepoint _I~MCS~_ 00 First value of _mcs-
Msg3-Repetitions_ 00 0 01 Second value of _mcs-Msg3-Repetitions_ 01 1 10 Third
value of _mcs-Msg3-Repetitions_ 10 2 11 Fourth value of _mcs-Msg3-Repetitions_
11 3
Table 6.1.4.1-4: MCS index _I~MCS~_ as a function of 3 LSBs of MCS information
field in DCI format 0_0 with CRC scrambled by the TC-RNTI
_mcs-Msg3-Repetitions is configured_ _mcs-Msg3-Repetitions is not configured_
* * *
_Codepoint_ _I~MCS~_ Codepoint _I~MCS~_ 000 First value of _mcs-
Msg3-Repetitions_ 000 0 001 Second value of _mcs-Msg3-Repetitions_ 001 1 010
Third value of _mcs-Msg3-Repetitions_ 010 2 011 Fourth value of _mcs-
Msg3-Repetitions_ 011 3 100 Fifth value of _mcs-Msg3-Repetitions_ 100 4 101
Sixth value of _mcs-Msg3-Repetitions_ 101 5 110 Seventh value of _mcs-
Msg3-Repetitions_ 110 6 111 Eighth value of _mcs-Msg3-Repetitions_ 111 7
#### 6.1.4.2 Transport block size determination
For eight antenna ports PUSCH transmission, when the number of PUSCH
transmission layers is greater than 4, two codewords are transmitted.
If the higher layer parameter _maxRank_ or _maxMIMO-Layers in PUSCH-config_ is
greater than 4, then one of the two transport blocks is disabled by DCI format
0_1 if _I~MCS\ ~_ = 26 and if _rv~id~_ = 1 for the corresponding transport
block. If both transport blocks are enabled, transport block 1 and 2 are
mapped to codeword 0 and 1 respectively. If only one transport block is
enabled, then the enabled transport block is always mapped to the first
codeword.
For a PUSCH scheduled by RAR UL grant or
for a PUSCH scheduled by fallbackRAR UL grant or
for a PUSCH scheduled by a DCI format 0_0 with CRC scrambled by C-RNTI, MCS-C-
RNTI, TC-RNTI, CS-RNTI, or
for a PUSCH scheduled by a DCI format 0_1 or DCI format 0_2 with CRC scrambled
by C-RNTI, MCS-C-RNTI, CS-RNTI, or
for a PUSCH scheduled by a DCI format 0_3 with CRC scrambled by C-RNTI, MCS-C-
RNTI, or
for a PUSCH transmission with configured grant, or
for a MsgA PUSCH transmission,
if
\- and transform precoding is disabled and Table 5.1.3.1-2 is used, or
\- and transform precoding is disabled and a table other than Table 5.1.3.1-2
is used, or
\- and transform precoding is enabled, the UE shall first determine the TBS as
specified below:
> The UE shall first determine the number of REs (_N~RE~_) within the slot:
\- A UE first determines the number of REs allocated for PUSCH within a PRB by
\- , where is the number of subcarriers in the frequency domain in a physical
resource block, $N_{\text{symb}}^{\text{slot}}$is the number of symbols _L_ of
the PUSCH allocation according to Clause 6.1.2.1 for scheduled PUSCH or Clause
6.1.2.3 for configured PUSCH, is the number of REs for DM-RS per PRB in the
allocated duration including the overhead of the DM-RS CDM groups without
data, as described for PUSCH with a configured grant in Clause 6.1.2.3 or as
indicated by DCI format 0_1, 0_2 or 0_3 or as described for DCI format 0_0 in
Clause 6.2.2, and is the overhead configured by higher layer parameter
_xOverhead in_ _PUSCH-ServingCellConfig_. If the is not configured (a value
from 6, 12, or 18), the is assumed to be 0. For Msg3 or MsgA PUSCH
transmission the is always set to 0. In case of PUSCH repetition Type B, is
determined assuming a nominal repetition with the duration of _L_ symbols
without segmentation.
\- A UE determines the total number of REs allocated for PUSCH as follows
\- For TB processing over multiple slots, $N_{\text{RE}} = N _\min\left(
156,N_{\text{RE}}^{'} \right) \cdot n_{\text{PRB}}$ where is the total number
of allocated PRBs for the UE and_ N _is the number of slots used for TBS
determination indicated by_ numberOfSlotsTBoMS*.
\- Otherwise, $N_{\text{RE}} = \min\left( 156,N_{\text{RE}}^{'} \right) \cdot
n_{\text{PRB}}$.
\- Next, proceed with steps 2-4 as defined in Clause 5.1.3.2
\- For a PUSCH scheduled by fallbackRAR UL grant, UE assumes the TB size
determined by the UL grant in the fallbackRAR shall be the same as the TB size
used in the corresponding MsgA PUSCH transmission.
else if
\- and transform precoding is disabled and Table 5.1.3.1-2 is used, or
\- and transform precoding is enabled,
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using . If there is no PDCCH for the
same transport block using , and if the initial PUSCH for the same transport
block is scheduled by a RAR UL grant, the TBS shall be determined from the RAR
UL grant. If there is no PDCCH for the same transport block using , and if the
initial PUSCH for the same transport block is transmitted with configured
grant,
\- the TBS shall be determined from _configuredGrantConfig_ for a configured
grant Type 1 PUSCH.
\- the TBS shall be determined from the most recent PDCCH scheduling a
configured grant Type 2 PUSCH.
> else
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using . If there is no PDCCH for the
same transport block using , and if the initial PUSCH for the same transport
block is scheduled by a RAR UL grant, the TBS shall be determined from the RAR
UL grant. If there is no PDCCH for the same transport block using , and if the
initial PUSCH for the same transport block is transmitted with configured
grant,
\- the TBS shall be determined from _configuredGrantConfig_ for a configured
grant Type 1 PUSCH.
\- the TBS shall be determined from the most recent PDCCH scheduling a
configured grant Type 2 PUSCH.
### 6.1.5 Code block group based PUSCH transmission
If a UE is configured to transmit code block group (CBG) based transmissions
by receiving the higher layer parameter _codeBlockGroupTransmission_ in
_PUSCH-ServingCellConfig on a serving cell in a PUCCH group_ , the UE does not
expect to be configured with higher layer parameter _ScheduledCell-
ListDCI-0-3_ on any serving cell within the PUCCH group.
#### 6.1.5.1 UE procedure for grouping of code blocks to code block groups
If a UE is configured to transmit code block group (CBG) based transmissions
by receiving the higher layer parameter _codeBlockGroupTransmission_ in
_PUSCH-ServingCellConfig_ , the UE shall determine the number of CBGs for a
PUSCH transmission as
,
where _N_ is the maximum number of CBGs per transport block as configured by
_maxCodeBlockGroupsPerTransportBlock_ in _PUSCH-ServingCellConfig_ , and _C_
is the number of code blocks in the PUSCH according to the procedure defined
in Clause 6.2.3 of [5, TS 38.212].
Define , , and .
If , CBG _m_ , , consists of code blocks with indices . CBG _m_ , , consists
of code blocks with indices .
#### 6.1.5.2 UE procedure for transmitting code block group based
transmissions
If a UE is configured to transmit code block group-based transmissions by
receiving the higher layer parameter _codeBlockGroupTransmission_ in _PUSCH-
ServingCellConfig_ ,
\- For an initial transmission of a TB as indicated by the \'_New Data
Indicator\'_ field of the scheduling DCI, the UE may expect that the _CBGTI_
field indicates all the CBGs of the TB are to be transmitted, and the UE shall
include all the code block groups of the TB.
\- For a retransmission of a TB as indicated by the \'_New Data Indicator\'_
field of the scheduling DCI, the UE shall include only the CBGs indicated by
the _CBGTI_ field of the scheduling DCI.
A bit value of \'0\' in the _CBGTI_ field indicates that the corresponding CBG
is not to be transmitted and \'1\' indicates that it is to be transmitted. The
order of _CBGTI_ field bits is such that the CBGs are mapped in order from
CBG#0 onwards starting from the MSB.
### 6.1.6 Uplink switching
The UE may omit uplink transmission during the uplink switching gap
$N_{\text{Tx1-Tx2}}$ if the conditions defined in this clause are met and the
UE is configured with _uplinkTxSwitching_. The switching gap
$N_{\text{Tx1-Tx2}}$ is indicated by UE capability
_uplinkTxSwitchingPeriod2T2T_ if _uplinkTxSwitching-2T-Mode_ is configured,
and _uplinkTxSwitchingPeriod otherwise_ :
\- If a UE indicated a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ for a band combination, and if it is for that band combination
\- Configured with a MCG using E-UTRA radio access and with a SCG using NR
radio access (EN-DC), or
\- Configured with uplink carrier aggregation, or
\- Configured in a serving cell with two uplink carriers with higher layer
parameter _supplementaryUplink_.
The conditions under which the switching gap may be present are defined for
each of the cases in clauses 6.1.6.1, 6.1.6.2, and 6.1.6.3 respectively.
If an uplink switching is triggered for an uplink transmission starting at
_T~0~_ , after _T~0~-T~offset~_ , the UE is not expected to cancel the uplink
switching, or to trigger any other new uplink switching occurring before
_T~0~_ for any other uplink transmission that is scheduled after
_T~0~-T~offset~_ , where _T~offset~_ is the UE processing procedure time
defined for the uplink transmission triggering the switch given in clause 5.3,
clause 5.4, clause 6.2.1, clause 6.4 and in clause 9 of [6, TS 38.213].
The UE does not expect to perform more than one uplink switching in a slot
with _µ~UL\ ~_ = max(_µ~UL,\ 1,~ µ~UL,\ 2~_), where the _µ~UL,\ 1~_
corresponds to the subcarrier spacing of the active UL BWP of one uplink
carrier before the switching gap and the _µ~UL,\ 2~_ corresponds to the
subcarrier spacing of the active UL BWP of the other uplink carrier after the
switching gap.
#### 6.1.6.1 Uplink switching for EN-DC
For a UE indicating a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ for a band combination, and if it is for that band combination
configured with a MCG using E-UTRA radio access and with a SCG using NR radio
access (EN-DC), if the UE is configured with uplink switching with parameter
_uplinkTxSwitching_ ,
\- for the UE configured with _switchedUL_ by the parameter
_uplinkTxSwitchingOption_ , when the UE is to transmit in the uplink based on
DCI(s) received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s):
\- when the UE is to transmit an NR uplink that takes place after an E-UTRA
uplink on another uplink carrier then the UE is not expected to transmit for
the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- when the UE is to transmit an E-UTRA uplink that takes place after an NR
uplink on another uplink carrier then the UE is not expected to transmit for
the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
_\- t_ he UE is not expected to transmit simultaneously on the NR uplink and
the E-UTRA uplink. I _f the UE is scheduled or configured to transmit any NR
uplink transmission overlapping with an_ E-UTRA _uplink transmission, the NR
uplink transmission is dropped,_
\- for the UE configured with _uplinkTxSwitchingOption_ set to \'dualUL\'_,_
when the UE is to transmit in the uplink based on DCI(s) received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s):
\- when the UE is to transmit an NR two-port uplink that takes place after an
E-UTRA uplink on another uplink carrier then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- when the UE is to transmit an E-UTRA uplink that takes place after an NR
two-port uplink on another uplink carrier then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
_\- t_ he UE is not expected to transmit simultaneously a two- port
transmission on the NR uplink and the E-UTRA uplink.
\- in all other cases the UE is expected to transmit normally all uplink
transmissions without interruptions.
\- when the UE is configured with _tdm-PatternConfig_ or by _tdm-
PatternConfig2_
\- for the E-UTRA subframes designated as uplink by the configuration, the UE
assumes the operation state in which one-port E-UTRA uplink can be
transmitted.
\- for the E-UTRA subframes other than the ones designated as uplink by the
configuration, the UE assumes the operation state in which two-port NR uplink
can be transmitted.
#### 6.1.6.2 Uplink switching for carrier aggregation
For a UE indicating a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ _or uplinkTxSwitchingPeriod2T2T_ for a band combination, and
if it is for that band combination configured with uplink carrier aggregation:
\- If the UE is configured with uplink switching with parameter
_uplinkTxSwitching_ , when the UE is to transmit in the uplink based on DCI(s)
received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s):
\- When the UE is to transmit a 2-port transmission on one uplink carrier on
one band and if the preceding uplink transmission is a 1-port transmission on
another uplink carrier on another band, then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the carriers.
\- When the UE is to transmit a 1-port transmission on one uplink carrier on
one band and if the preceding uplink transmission is a 2-port transmission on
another uplink carrier on another band, then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the carriers.
\- For the UE configured with _uplinkTxSwitchingOption_ set to
\'_switchedUL\'_ , when the UE is to transmit a 1-port transmission on one
uplink carrier on one band and if the preceding uplink transmission was a
1-port transmission on another uplink carrier on another band, then the UE is
not expected to transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of
the carriers.
\- For the UE configured with _uplinkTxSwitchingOption_ set to \'_dualUL\'_ ,
when the UE is to transmit a 2-port transmission on one uplink carrier on one
band and if the preceding uplink transmission was a 1-port transmission on a
carrier on the same band and the UE is under the operation state in which
2-port transmission cannot be supported in the same band, then the UE is not
expected to transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the
carriers.
\- For the UE configured with _uplinkTxSwitchingOption_ set to \'_dualUL\'_ ,
when the UE is to transmit a 1-port transmission on one uplink carrier on one
band and if the preceding uplink transmission was a 1-port transmission on
another uplink carrier on another band and the UE is under the operation state
in which 2-port transmission can be supported in the same band, then the UE is
not expected to transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of
the carriers.
\- For the UE configured with _uplinkTxSwitchingOption_ set to \'_dualUL\'_ ,
if the UE is configured with _uplinkTxSwitching-DualUL-TxState set to
\'oneT\'_ , when the UE is under the operation state in which 2-port
transmission can be supported on one carrier on one band followed by no
transmission on any carrier on the same band and 1-port transmission on the
other carrier on another band the UE shall consider this as if 1-port
transmission was transmitted on both uplinks, otherwise the UE shall consider
this as if 2-port transmission took place on the transmitting carrier.
\- If _uplinkTxSwitching-2T-Mode_ is configured, when the UE is to transmit a
2-port transmission on one uplink carrier on one band and if the preceding
uplink transmission is a 2-port transmission on another uplink carrier on
another band, then the UE is not expected to transmit for the duration of
$N_{\text{Tx1-Tx2}}$ on any of the carriers.
\- The UE is not expected to be scheduled or configured with uplink
transmissions that result in simultaneous transmission on two antenna ports on
one uplink carrier on one band, and any transmission on another uplink carrier
on another band.
\- In all other cases the UE is expected to transmit normally all uplink
transmissions without interruptions.
##### 6.1.6.2.1 void
#### 6.1.6.3 Uplink switching for supplementary uplink
For a UE indicating a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ for a band combination, and if it is for that band combination
configured in a serving cell with two uplink carriers with higher layer
parameter _supplementaryUplink_ :
\- If the UE is configured with uplink switching with parameter
_uplinkTxSwitching_ ,
\- If the UE is to transmit any uplink channel or signal on a different uplink
on a different band from the preceding transmission occasion based on DCI(s)
received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s), then the UE assumes that an uplink
switching is triggered in a duration of switching gap
$\mathbf{N}_{\text{Tx1-Tx2}}$, where $\mathbf{T}_{\text{0}}$ is the start time
of the first symbol of the transmission occasion of the uplink channel or
signal and $\mathbf{T}_{\mathbf{\text{offset}}}$ is the preparation procedure
time of the transmission occasion of the uplink channel or signal given in
clause 5.3, clause 5.4, clause 6.2.1, clause 6.4 and in clause 9 of [6, TS
38.213], respectively. During the switching gap $\mathbf{N}_{\text{Tx1-Tx2}}$,
the UE is not expected to transmit on any of the two uplinks.
\- In all other cases the UE is expected to transmit normally all uplink
transmissions without interruptions.
### 6.1.7 UE procedure for determining time domain windows for bundling DM-RS
For PUSCH transmissions of PUSCH repetition Type A scheduled by DCI format 0_1
or 0_2, PUSCH repetition Type A with a configured grant, PUSCH repetition Type
B and TB processing over multiple slots, when _pusch-DMRS-Bundling_ is
enabled, and for PUCCH transmissions of PUCCH repetition, when _PUCCH-DMRS-
Bundling_ is enabled, the UE determines one or multiple nominal TDWs, as
follows:
\- For PUSCH transmissions of repetition Type A, PUSCH repetition Type B and
TB processing over multiple slots, the duration of each nominal TDW except the
last nominal TDW, in number of consecutive slots, is:
\- Given by _pusch-TimeDomainWindowLength_ , if configured.
\- Computed as min (_maxDurationDMRS-Bundling_ , _M_), if _pusch-
TimeDomainWindowLength_ is not configured, where _maxDurationDMRS-Bundling_ is
maximum duration for a nominal TDW subject to UE capability [13, TS 38.306],
_M_ is the time duration in consecutive slots of $N \bullet K$ PUSCH
transmissions, and where:
\- For PUSCH transmissions of PUSCH repetition Type A, _N_ =1 and _K_ is the
number of repetitions, as defined in Clause 6.1.2.1 or in Clause 6.1.2.3.
\- For PUSCH transmissions of PUSCH repetition Type B, _N_ =1 and _K_ is the
number of nominal repetitions, as defined in Clause 6.1.2.1 or in Clause
6.1.2.3.
\- For PUSCH transmissions of TB processing over multiple slots, _N_ is the
number of slots used for TBS determination and K is the number of repetitions
of the number of slots _N_ used for TBS determination, as defined in Clause
6.1.2.1 or in Clause 6.1.2.3.
\- For PUCCH transmissions of PUCCH repetition, the duration of each nominal
TDW except the last nominal TDW, in number of consecutive slots, is:
\- Given by _pucch-TimeDomainWindowLength_ , if configured.
\- Computed as min (_maxDurationDMRS-Bundling_ , _M_), if _pucch-
TimeDomainWindowLength_ is not configured, where _maxDurationDMRS-Bundling_ is
maximum duration for a nominal TDW subject to UE capability [13, TS 38.306],
_M_ is the time duration in consecutive slots from the first slot determined
for PUCCH transmissions of PUCCH repetition to the last slot determined for
PUCCH transmissions of PUCCH repetition according to clause 9.2.6 of [6, TS
38.213].
\- For PUSCH transmission of a PUSCH repetition Type A scheduled by DCI format
0_1 or 0_2 and PUSCH repetition Type A with a configured grant, when
_AvailableSlotCounting_ is enabled, and for TB processing over multiple slots:
\- The start of the first nominal TDW is the first slot determined for the
first PUSCH transmission.
\- The end of the last nominal TDW is the last slot determined for the last
PUSCH transmission.
\- The start of any other nominal TDWs is the first slot determined for PUSCH
transmission after the last slot determined for PUSCH transmission of a
previous nominal TDW.
\- For PUSCH transmissions of a PUSCH repetition type A scheduled by DCI
format 0_1 or 0_2 and PUSCH repetition Type A with a configured grant, when
the UE is not configured with _AvailableSlotCounting_ or when
_AvailableSlotCounting_ is disabled, and for PUSCH repetition type B:
\- The start of the first nominal TDW is the first slot for the first PUSCH
transmission.
\- The end of the last nominal TDW is the last slot for the last PUSCH
transmission.
\- The start of any other nominal TDWs is the first slot after the last slot
of a previous nominal TDW.
\- For PUCCH transmissions of a PUCCH repetition:
\- The start of the first nominal TDW is the first slot determined for the
first PUCCH transmission.
\- The end of the last nominal TDW is the last slot determined for the last
PUCCH transmission.
\- The start of any other nominal TDWs is the first slot determined for PUCCH
transmission after the last slot determined for PUCCH transmission of a
previous nominal TDW.
For PUSCH transmissions of a PUSCH repetition Type A scheduled by DCI format
0_1 or 0_2, PUSCH repetition Type A with a configured grant, PUSCH repetition
Type B and TB processing over multiple slots, a nominal TDW consists of one or
multiple actual TDWs. The UE determines the actual TDWs as follows:
\- The start of the first actual TDW is the first symbol of the first PUSCH
transmission in a slot for PUSCH transmission of PUSCH repetition type A
scheduled by DCI format 0_1 or 0_2, or PUSCH repetition Type A with a
configured grant, or PUSCH repetition type B or TB processing over multiple
slots within the nominal TDW.
\- The end of an actual TDW is
\- The last symbol of the last PUSCH transmission in a slot for PUSCH
transmission of PUSCH repetition type A scheduled by DCI format 0_1 or 0_2, or
PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or
TB processing over multiple slots within the nominal TDW, if the actual TDW
reaches the end of the last PUSCH transmission within the nominal TDW.
\- The last symbol of a PUSCH transmission before the event, if an event
occurs which causes power consistency and phase continuity not to be
maintained across PUSCH transmissions of PUSCH repetition type A scheduled by
DCI format 0_1 or 0_2, or PUSCH repetition Type A with a configured grant, or
PUSCH repetition type B or TB processing over multiple slots within the
nominal TDW, and the PUSCH transmission is in a slot for PUSCH transmission of
PUSCH repetition type A scheduled by DCI format 0_1 or 0_2, or PUSCH
repetition Type A with a configured grant, or PUSCH repetition type B or TB
processing over multiple slots.
\- When _pusch-WindowRestart_ is enabled, the start of a new actual TDW is the
first symbol of the PUSCH transmission after the event which causes power
consistency and phase continuity not to be maintained across PUSCH
transmissions of PUSCH repetition type A scheduled by DCI format 0_1 or 0_2,
or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B
or TB processing over multiple slots within the nominal TDW, and the PUSCH
transmission is in a slot for PUSCH transmission of PUSCH repetition type A
scheduled by DCI format 0_1 or 0_2, or PUSCH repetition Type A with a
configured grant, or PUSCH repetition type B or TB processing over multiple
slots.
For PUCCH transmissions of PUCCH repetition, a nominal TDW consists of one or
multiple actual TDWs. The UE determines the actual TDWs as follows:
\- The start of the first actual TDW is the first symbol of the first PUCCH
transmission in a slot determined for PUCCH transmission within the nominal
TDW.
\- The end of an actual TDW is
\- The last symbol of the last PUCCH transmission in a slot determined for
transmission of the PUCCH within the nominal TDW, if the actual TDW reaches
the end of the last PUCCH transmission within the nominal TDW.
\- The last symbol of a PUCCH transmission before the event, if an event
occurs which causes power consistency and phase continuity not be maintained
across PUCCH transmissions of PUCCH repetition within the nominal TDW, and the
PUCCH transmission is in a slot determined for transmission of the PUCCH.
\- When _pucch-WindowRestart_ is enabled, the start of a new actual TDW is the
first symbol of the PUCCH transmission after the event which causes power
consistency and phase continuity not to be maintained across PUCCH
transmissions of PUCCH repetition within the nominal TDW, and the PUCCH
transmission is in a slot determined for transmission of the PUCCH.
Events which cause power consistency and phase continuity not to be maintained
across PUSCH transmissions of PUSCH repetition type A scheduled by DCI format
0_1 or 0_2, or PUSCH repetition Type A with a configured grant, or PUSCH
repetition type B or TB processing over multiple slots, or PUCCH transmissions
of PUCCH repetition, within the nominal TDW, are:
\- A downlink slot or downlink reception or downlink monitoring based on _tdd-
UL-DL-ConfigurationCommon_ and  _tdd-UL-DL-ConfigurationDedicated_ for
unpaired spectrum.
\- The gap between any two consecutive PUSCH transmissions, or the gap between
any two consecutive PUCCH transmissions, exceeds 13 symbols for normal cyclic
prefix or exceeds 11 symbols for extended cyclic prefix.
\- The gap between any two consecutive PUSCH transmissions, or the gap between
any two consecutive PUCCH transmissions, does not exceed 13 symbols but other
uplink transmissions are scheduled between the two consecutive PUSCH
transmissions or the two consecutive PUCCH transmissions.
\- For PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition
type B or TB processing over multiple slots, a dropping or cancellation of a
PUSCH transmission according to clause 9, clause 11.1 and clause 11.2A of [6,
TS 38.213].
\- For PUCCH transmissions of PUCCH repetition, a dropping or cancellation of
a PUCCH transmission according to clause 9, clause 9.2.6 and clause 11.1 of
[6, TS 38.213].
\- For any two consecutive PUSCH transmissions of PUSCH repetition type A, or
PUSCH repetition type B, and when two SRS resource sets are configured in
_srs-ResourceSetToAddModList_ or _srs-ResourceSetToAddModListDCI-0-2_ with
higher layer parameter _usage_ in _SRS-ResourceSet_ set to \'codebook\' or
\'noncodebook\', a different SRS resource set association is used for the two
PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition type B,
according to Clause 6.1.2.1.
\- For any two consecutive PUCCH transmissions of PUCCH repetition, and when a
PUCCH resource used for repetitions of a PUCCH transmission by a UE includes
first and second spatial relations or first and second sets of power control
parameters, as described in [10, TS 38.321] and in clause 7.2.1 of [6, TS
38.213], different spatial relations or different power control parameters are
used for the two PUCCH transmissions of PUCCH repetition, according to Clause
9.2.6 of [6, TS 38.213].
\- Uplink timing adjustment in response to a timing advance command according
to clause 4.2 of [6, TS 38.213].
\- Frequency hopping.
\- For reduced capability half-duplex UEs,
\- a dropping or cancellation of a PUSCH or PUCCH transmission according to
clause 17.2 of [6, TS 38.213] or
\- an overlapping of the gap between two consecutive PUSCH or two consecutive
PUCCH transmissions and any symbol of downlink reception or downlink
monitoring
The UE shall maintain power consistency and phase continuity within an actual
TDW, across PUSCH transmissions of PUSCH repetition Type A scheduled by DCI
format 0_1 or 0_2, or PUSCH repetition Type A with a configured grant, or
PUSCH repetition type B or TB processing over multiple slots, or across PUCCH
transmissions of PUCCH repetition, in case the actual TDW is created in
response to frequency hopping, or in response to the use of a different SRS
resource set association for the two PUSCH transmissions of PUSCH repetition
type A, or PUSCH repetition type B, or in response to the use of different
spatial relations or different power control parameters for the two PUCCH
transmissions of PUCCH repetition, or in response to any event not triggered
by DCI or MAC-CE. The UE maintains power consistency and phase continuity
within an actual TDW, across PUSCH transmissions of PUSCH repetition Type A
scheduled by DCI format 0_1 or 0_2, or PUSCH repetition Type A with a
configured grant, or PUSCH repetition type B or TB processing over multiple
slots, or across PUCCH transmissions of PUCCH repetition, in case the actual
TDW is created in response to an event triggered by DCI other than frequency
hopping or the use of a different SRS resource set association for the two
PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition type B, or
the use of different spatial relations or different power control parameters
for the two PUCCH transmissions of PUCCH repetition, or in response to an
event triggered by MAC-CE, subject to UE capability. of _dmrs-BundlingRestart_
[13, TS 38.306] and when _pusch-WindowRestart_ or _pucch-WindowRestart_ is
enabled.
## 6.2 UE reference signal (RS) procedure
### 6.2.1 UE sounding procedure
The UE may be configured with one or more Sounding Reference Signal (SRS)
resource sets as configured by the higher layer parameter _SRS-ResourceSet_ or
_SRS-PosResourceSet_. For each SRS resource set configured by _SRS-
ResourceSet_ , a UE may be configured with SRS resources (higher layer
parameter _SRS-Resource_), where the maximum value of K is indicated by UE
capability [13, 38.306]. When SRS resource set is configured with the higher
layer parameter _SRS-PosResourceSet,_ a UE may be configured with _K_ ≥1 SRS
resources (higher layer parameter _SRS-PosResource_), where the maximum value
of K is 16. The SRS resource set applicability is configured by the higher
layer parameter _usage_ in _SRS-ResourceSet._ When the higher layer parameter
_usage_ is set to \'beamManagement\'_,_ only one SRS resource in each of
multiple SRS resource sets may be transmitted at a given time instant, but the
SRS resources in different SRS resource sets with the same time domain
behaviour in the same BWP may be transmitted simultaneously.
During non-active periods of cell DRX, the UE configured with cell DRX is not
expected to transmit the periodic SRS, or semi-persistent SRS for channel
acquisition. SRS for positioning is not impacted by cell DRX operation.
For the SRS resource set(s) configured _in srs-ResourceSetToAddModListDCI-0-2_
with higher layer parameter _usage_ set to \'_antennaSwitching_ \' or
\'_beamManagement_ \', the UE expects the same SRS resource set(s) with the
same _usage_ being configured in _srs-ResourceSetToAddModList._
When the UE is configured _dl-OrJointTCI-StateList_ or _ul-TCI-StateList,_ the
UE can assume that SRS resource(s) in any SRS resource set, except SRS
resource set for positioning and an SRS resource set configured with
_followUnifiedTCI-StateSRS_ , can be configured with _TCI-State_ or _TCI-UL-
State_ or updated as described in clause 6.1.3.59 or 6.1.3.60 of [10, TS
38.321]. The reference RS in the _TCI-State_ can be a CSI-RS resource in a
_NZP-CSI-RS-ResourceSet_ configured with higher layer parameter _repetition_ ,
or a CSI-RS resource in an _NZP-CSI-RS-ResourceSet_ configured with higher
layer parameter _trs-Info_. The reference RS in the _TCI-UL-State(s)_ can be a
CSI-RS resource in a _NZP-CSI-RS-ResourceSet_ configured with higher layer
parameter _repetition_ , a CSI-RS resource in an _NZP-CSI-RS-ResourceSet_
configured with higher layer parameter _trs-Info_ , an SRS resource with the
higher layer parameter _usage_ set to \'beamManagement\', or SS/PBCH block
associated with the same or different PCI from the PCI of the serving cell.
If an SRS resource set, except an SRS resource set for positioning, is
configured with _followUnifiedTCI-StateSRS_ , the UE shall transmit the target
SRS resource(s) within the SRS resource set according to the spatial relation,
if applicable, with a reference to the RS used for determining UL TX spatial
filter. The RS is determined based on an RS configured with _qcl-Type_ set to
\'typeD\' in _QCL-Info_ of the indicated _TCI-State_ or an RS in the indicated
_TCI-UL-State_. The reference RS in the indicated _TCI-State_ can be a CSI-RS
resource in a _NZP-CSI-RS-ResourceSet_ configured with higher layer parameter
_repetition_ , or a CSI-RS resource in an _NZP-CSI-RS-ResourceSet_ configured
with higher layer parameter _trs-Info._ The reference RS in the indicated
_TCI-UL-State_ can be a CSI-RS resource in a _NZP-CSI-RS-ResourceSet_
configured with higher layer parameter _repetition_ , a CSI-RS resource in an
_NZP-CSI-RS-ResourceSet_ configured with higher layer parameter _trs-Info,_ an
SRS resource with the higher layer parameter _usage_ set to
\'beamManagement\', or SS/PBCH block associated with the same or different PCI
from the PCI of the serving cell.
When the UE is configured _dl-OrJointTCI-StateList_ or _TCI-UL-State_ and is
having two indicated TCI-States or TCI-UL-States, and if the UE is configured
with [[_followUnifiedTCI-StateSRS]]_ to _,_ a periodic, semi-persistent or
aperiodic SRS resource set with higher layer parameter _usage_ in _SRS-
ResourceSet_ set to '_codebook_ ', '_nonCodebook_ ' or '_antennaSwitching_ '
or to an aperiodic SRS resource set with higher layer parameter _usage_ in
_SRS-ResourceSet_ set to '_beamManagement_ '
\- The UE may be configured by higher layer parameter _applyIndicatedTCIState_
to the SRS resource set to indicate whether the UE shall apply the first or
the second indicated _TCI-State_ or _TCI-UL-State_ to the SRS resource set.
\- When a UE is configured by higher layer parameter _PDCCH-Config_ that
contains two different values of _coresetPoolIndex_ in _ControlResourceSet_ ,
the first and second indicated _TCI-States_ or _TCI-UL-States_ correspond to
the indicated _TCI-States_ or _TCI-UL-States_ specific to _coresetPoolIndex_
value 0 and value 1, respectively.
\- When a UE is configured by higher layer parameter _PDCCH-Config_ that
contains two different values of _coresetPoolIndex_ in _ControlResourceSet_ ,
and the aperiodic SRS resource set which is not configured with higher layer
parameter _applyIndicatedTCIState_ and the aperiodic SRS resource set is
triggered by PDCCH on a CORESET associated with a _coresetPoolIndex_ value,
the UE shall apply the indicated _TCI-State_ or _TCI-UL-State_ specific to the
_coresetPoolIndex_ value to the aperiodic SRS resource set.
\- When two SRS resource sets with higher layer parameter _usage_ in _SRS-
ResourceSet_ set to \'codebook\' or 'nonCodebook' are configured, the UE does
not expectthat the first indicated _TCI-State_ or _TCI-UL-State_ is applied to
the second SRS resource set and that the second indicated _TCI-State_ or _TCI-
UL-State_ is applied to the first SRS resource set.
For aperiodic SRS at least one state of the DCI field is used to select at
least one out of the configured SRS resource set(s).
The following SRS parameters are semi-statically configurable by higher layer
parameter _SRS-Resource_ or _SRS-PosResource_.
_\- srs-ResourceId_ or _SRS-PosResourceId determines SRS resource
configuration identity._
_-_ Number of SRS ports, as defined by the higher layer parameter _nrofSRS-
Ports_ and described in clause 6.4.1.4 of [4, TS 38.211]. If not configured,
_nrofSRS-Ports_ is 1.
_-_ Time domain behaviour of SRS resource configuration as indicated by the
higher layer parameter _resourceType_ , which may be periodic, semi-
persistent, aperiodic SRS transmission as defined in clause 6.4.1.4 of [4, TS
38.211].
\- Slot level periodicity and slot level offset as defined by the higher layer
parameters _periodicityAndOffset-p_ or _periodicityAndOffset-sp_ for an SRS
resource of type periodic or semi-persistent. The UE is not expected to be
configured with SRS resources in the same SRS resource set _SRS-ResourceSet_
or _SRS-PosResourceSet_ with different slot level periodicities. For an _SRS-
ResourceSet_ configured with higher layer parameter _resourceType_ set to
\'aperiodic\', a slot level offset is defined by the higher layer parameter
_slotOffset._ For an _SRS-ResourceSet_ configured with higher layer parameter
_resourceType_ set to \'aperiodic\', a list of up to four different available
slot offset values from the reference slot _n_ \+ _k_ to the slot where the
aperiodic SRS resource set is transmitted where _n_ is the slot with
triggering DCI and _k_ is _slotOffset,_ can be configured by the higher layer
parameter _availableSlotOffsetList. The parameter availableSlotOffsetList can
be configured up to 4 different values._ For an _SRS-PosResourceSet configured
w_ ith higher layer parameter r _esourceType_ set to \'aperiodic\', the slot
level offset is defined by the higher layer parameter _slotOffset for each S_
RS resource.
\- Support of time division mapping subsets of ports of the SRS resource into
_S_ symbols (_S=2)_ , as defined by the higher layer parameter [_tdm_], where
the SRS ports are evenly distributed in two symbols. This applies when the SRS
resource set is configured with higher layer parameter _usage_ in _SRS-
ResourceSet_ set to '_codebook_ ', or '_antennaSwitching_ ', and _nrofSRS-
Ports_ is set to '_n8_ '.
\- Comb offset hopping pattern with repetition, as defined by the higher layer
parameter [_combOffsetHoppingWithRepetition_], where the parameter can be set
to either '[per-symbol]' or '[per-R-repetition]' subject to UE capability.
When the parameter is set to '[per-symbol]', the comb offset hopping pattern
is determined by the symbol index, and the comb offset hopping pattern is
determined by the symbol index of the first symbol of the repetition when the
parameter is set to '[per-R-repetition]'.
\- Number of OFDM symbols in the SRS resource, starting OFDM symbol of the SRS
resource within a slot including repetition factor R as defined by the higher
layer parameter _resourceMapping_ and described in clause 6.4.1.4 of [4, TS
38.211]. If _R_ is not configured, then _R_ is equal to the number of OFDM
symbols in the SRS resource.
\- SRS bandwidth and , as defined by the higher layer parameter _freqHopping_
and described in clause 6.4.1.4 of [4, TS 38.211]. If not configured, then= 0.
\- Frequency hopping bandwidth , as defined by the higher layer parameter
_freqHopping_ and described in clause 6.4.1.4 of [4, TS 38.211]. If not
configured, then = 0.
\- Defining partial frequency sounding factor and start RB index for partial
frequency sounding as defined by the higher layer parameters
_FreqScalingFactor_ P~F~ and _StartRBIndex k_ ~F~_, respectively,_ and
described in Clause 6.4.1.4 of [4, TS 38.211]. If not configured, then _P_ ~F~
= 1 and _k_ ~F~_,= 0_.
\- Defining start RB index hopping for partial frequency sounding in different
SRS frequency hopping periods for aperiodic/periodic/semi-persistent SRS based
on the hopping pattern _k_ ~hop~ as described in clause 6.4.1.4.3 in [4, TS
38.211. If not configured, then start RB hopping is not enabled and _k_ ~hop~
is fixed to be 0 for all SRS symbols.
\- Defining frequency domain position and configurable shift, as defined by
the higher layer parameters _freqDomainPosition_ and _freqDomainShift,
respectively,_ and described in clause 6.4.1.4 of [4, TS 38.211]. If
_freqDomainPosition_ is not configured, _freqDomainPosition_ is zero.
\- Cyclic shift, as defined by the higher layer parameter _cyclicShift-n2_ ,
_cyclicShift-n4, or cyclicShift-n8_ for transmission comb value 2, 4 or 8, and
described in clause 6.4.1.4 of [4, TS 38.211]. When cyclic shift hopping is
configured by the higher layer parameter [_cyclicShiftHopping_] for an SRS
resource in an SRS resource set with the usage configured as
\'_antennaSwitching_ \', subject to UE capabilities, cyclic shift is updated
at every symbol as described in [clause 6,4,1,4 of [4, TS 38.211]]. For the
cyclic shift hopping, a UE can be configured with a subset of cyclic shifts by
the higher layer parameter [_cyclicShiftHoppingSubset_], where the cyclic
shift hopping is performed only across the cyclic shifts configured in the
subset. The UE is not expecting that the cyclic shift hopping and the higher
layer parameter [_tdm_] are configured simultaneously.
\- Transmission comb value, as defined by the higher layer parameter
_transmissionComb_ described in clause 6.4.1.4 of [4, TS 38.211].
\- Transmission comb offset, as defined by the higher layer parameter
_combOffset-n2_ , _combOffset-n4,_ and _combOffset-n8_ for transmission comb
value 2, 4, or 8, and described in clause 6.4.1.4 of [4, TS 38.211]. When comb
offset hopping is configured by the higher layer parameter
[_combOffsetHopping_] for an SRS resource in an SRS resource set with the
usage configured as \'_antennaSwitching_ \', subject to UE capabilities,
transmission comb offset(s) are updated as described in [clause 6,4,1,4 of [4,
TS 38.211]]. For the comb offset hopping, a UE can be configured with a subset
of comb offsets by the higher layer parameter [c _ombOffsetHoppingSubset_],
where the comb offset hopping is performed only across the comb offsets
configured in the subset. The UE is not expecting that the comb offset hopping
and the higher layer parameter [_tdm_] are configured simultaneously.
\- SRS sequence ID, as defined by the higher layer parameter _sequenceId_ in
clause 6.4.1.4 of [4, TS 38.211].
\- SRS cyclic shift and/or comb offset hopping ID, as defined by the higher
layer parameter [_hoppingID_]
\- The configuration of the spatial relation between a reference RS and the
target SRS, where the higher layer parameter _spatialRelationInfo_ or
_spatialRelationInfoPos_ , if configured, contains the ID of the reference RS.
The reference RS may be an SS/PBCH block, CSI-RS configured on serving cell
indicated by higher layer parameter _servingCellId_ if present, same serving
cell as the target SRS otherwise, or an SRS configured on uplink BWP indicated
by the higher layer parameter _uplinkBWP_ , and serving cell indicated by the
higher layer parameter _servingCellId_ if present, same serving cell as the
target SRS otherwise. When the target SRS is configured by the higher layer
parameter _SRS-PosResourceSet,_ the reference RS may also be a DL PRS
configured on a serving cell or a non-serving cell indicated by the higher
layer parameter _dl-PRS_ , or an SS/PBCH block of a non-serving cell indicated
by the higher layer parameter _ssb-Ncell_. If the UE is configured with _dl-
OrJointTCI-StateList_ or _ul-TCI-StateList_ , the reference RS may
additionally be an SS/PBCH block associated with a PCI different from the PCI
of the serving cell.
The UE may be configured by the higher layer parameter _resourceMapping_ in
_SRS-Resource_ with an SRS resource occupying adjacent OFDM symbols within the
last 6 symbols of the slot, or at any symbol location within the slot if
_resourceMapping-r16_ is provided subject to UE capability, where all antenna
ports of the SRS resources are mapped to each symbol of the resource. When the
SRS is configured with the higher layer parameter _SRS-PosResourceSet_ the
higher layer parameter _resourceMapping-r16_ in _SRS-PosResource_ indicates an
SRS resource occupying $N_{S} \in \left{ 1,2,4,8,12 \right}$ adjacent symbols
anywhere within the slot. When the SRS is configured with the higher layer
parameter _SRS-ResourceSet,_ the higher layer parameter _resourceMapping-r17_
in _SRS-Resource_ indicates an SRS resource occupying $N_{S} \in \left{
1,2,4,8,10,12,14 \right}$ adjacent symbols anywhere within the slot.
If a PUSCH with a priority index 0 and SRS configured by _SRS-Resource_ are
transmitted in the same slot on a serving cell, the UE may only be configured
to transmit SRS after the transmission of the PUSCH and the corresponding DM-
RS.
If a PUSCH transmission with a priority index 1 or a PUCCH transmission with a
priority index 1 would overlap in time with an SRS transmission on a serving
cell, the UE does not transmit the SRS in the overlapping symbol(s).
_For a UE configured with one or more SRS resource configuration(s), and when
the higher layer parameter_ _resourceType_ in _SRS-Resource_ or _SRS-
PosResource is set to \'periodic\':_
\- if the UE is configured with the higher layer parameter
_spatialRelationInfo, spatialRelationInfo-PDC_ or _spatialRelationInfoPos_
containing the ID of a reference \'ssb-Index\', \'ssb-IndexServing\', or
\'ssb-IndexNcell\', the UE shall transmit the target SRS resource with the
same spatial domain transmission filter used for the reception of the
reference SS/PBCH block, if the higher layer parameter _spatialRelationInfo,
spatialRelationInfo-PDC_ or _spatialRelationInfoPos_ contains the ID of a
reference \'csi-RS-Index\' or \'csi-RS-IndexServing\', the UE shall transmit
the target SRS resource with the same spatial domain transmission filter used
for the reception of the reference periodic CSI-RS or of the reference semi-
persistent CSI-RS, if the higher layer parameter _spatialRelationInfo,
spatialRelationInfo-PDC_ or _spatialRelationInfoPos_ containing the ID of a
reference \'srs\' or \'srs-spatialRelation\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
transmission of the reference periodic SRS. When the SRS is configured by the
higher layer parameter _SRS-PosResource_ and if the higher layer parameter
_spatialRelationInfoPos_ contains the ID of a reference \'dl-PRS\', the UE
shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference DL PRS. When the
SRS is configured by the higher layer parameter _SRS-Resource_ and if the
higher layer parameter _spatialRelationInfo-PDC_ contains the ID of a
reference \'dl-PRS-PDC\', the UE shall transmit the target SRS resource with
the same spatial domain transmission filter used for the reception of the
reference DL PRS for _RTT-based propagation delay compensation_ according to
clause 9.
_For a UE configured with one or more SRS resource configuration(s), and when
the higher layer parameter resourceType_ in _SRS-Resource_ or _SRS-PosResource
is set to \'semi-persistent\':_
\- when a UE receives an activation command, as described in clause 6.1.3.17
or 6.1.3.36 of [10, TS 38.321], for an SRS resource, and when the UE would
transmit a PUCCH with HARQ-ACK information in slot _n_ corresponding to the
PDSCH carrying the activation command, the corresponding actions in [10, TS
38.321] and the UE assumptions on SRS transmission corresponding to the
configured SRS resource set shall be applied starting from the first slot that
is after slot $n + {3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS
configuration for the PUCCH. The activation command also contains spatial
relation assumptions provided by a list of references to reference signal IDs,
one per element of the activated SRS resource set. When the SRS is configured
with the higher layer parameter _SRS-ResourceSet_ , each ID in the list refers
to a reference SS/PBCH block, NZP CSI-RS resource configured on serving cell
indicated by _Resource Serving Cell ID_ field in the activation command if
present, same serving cell as the SRS resource set otherwise, or SRS resource
configured on serving cell and uplink bandwidth part indicated by Resource
_Serving Cell ID_ field and _Resource BWP ID_ field in the activation command
if present, same serving cell and bandwidth part as the SRS resource set
otherwise. When the SRS is configured with the higher layer parameter _SRS-
PosResourceSet_ , each ID in the list of reference signal IDs may refer to a
reference SS/PBCH block on a serving or non-serving cell indicated by _PCI_
field in the activation command, NZP CSI-RS resource configured on serving
cell indicated by _Resource Serving Cell ID_ field in the activation command
if present, same serving cell as the SRS resource set otherwise, SRS resource
configured on serving cell and uplink bandwidth part indicated by Resource
_Serving Cell ID_ field and _Resource BWP ID_ field in the activation command
if present, same serving cell and bandwidth part as the SRS resource set
otherwise, or DL PRS resource of a serving or non-serving cell associated with
a _dl-PRS-ID_ indicated by _DL-PRS ID_ field in the activation command.
\- if an SRS resource in the activated resource set is configured with the
higher layer parameter _spatialRelationInfo_ or _spatialRelationInfoPos_ , the
UE shall assume that the ID of the reference signal in the activation command
overrides the one configured in _spatialRelationInfo_ or
_spatialRelationInfoPos._
\- when a UE receives a deactivation command [10, TS 38.321] for an activated
SRS resource set, and when the UE would transmit a PUCCH with HARQ-ACK
information in slot _n_ corresponding to the PDSCH carrying the deactivation
command, the corresponding actions in [10, TS 38.321] and UE assumption on
cessation of SRS transmission corresponding to the deactivated SRS resource
set shall apply starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS configuration for the
PUCCH.
\- if the UE is configured with the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ containing the ID of a
reference \'ssb-Index\', \'ssb-IndexServing\', or \'ssb-IndexNcell\' the UE
shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference SS/PBCH block, if
the higher layer parameter _spatialRelationInfo_ or _spatialRelationInfoPos_
contains the ID of a reference \'csi-RS-Index\' or \'csi-RS-IndexServing\',
the UE shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference periodic CSI-RS or
of the reference semi-persistent CSI-RS, if the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ contains the ID of a
reference \'srs\' or \'srs-SpatialRelation\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
transmission of the reference periodic SRS or of the reference semi-persistent
SRS. When the SRS is configured by the higher layer parameter _SRS-
PosResourceSet_ and if the higher layer parameter _spatialRelationInfoPos_
contains the ID of a reference \'dl-PRS\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
reception of the reference DL PRS.
If the UE has an active semi-persistent SRS resource configuration and has not
received a deactivation command, the semi-persistent SRS configuration is
considered to be active in the UL BWP which is active, otherwise it is
considered suspended.
For a UE configured with one or more SRS resource configuration(s), and when
the higher layer parameter _resourceType_ in _SRS-Resource_ or _SRS-
PosResource_ is set to \'aperiodic\':
\- the UE receives a configuration of SRS resource sets,
\- the UE receives a downlink DCI, a group common DCI, or an uplink DCI based
command where a codepoint of the DCI may trigger one or more SRS resource
set(s). For SRS in a resource set with usage set to \'codebook\' or
\'antennaSwitching\', the minimal time interval between the last symbol of the
PDCCH triggering the aperiodic SRS transmission and the first symbol of SRS
resource is _N~2\ ~_ symbols and an additional time duration _T~switch~_.
Otherwise, the minimal time interval between the last symbol of the PDCCH
triggering the aperiodic SRS transmission and the first symbol of SRS resource
is _N~2~_ +14 symbols and an additional time duration _T~switch~_. The minimal
time interval unit of OFDM symbol is counted based on the minimum subcarrier
spacing given by min(_µ~PDCCH,~ µ~UL~_) where _µ~UL~_ is given by
min(_µ~UL,carrier1,~ µ~UL,carrier2,~ µ~SRS~_) when the UE is configured with
the higher layer parameter _uplinkTxSwitchingOption set to \'dualUL\' for
uplink carrier aggregation_ , _and by µ~SRS\ ~_ otherwise. _µ~SRS~ and
µ~PDCCH\ ~_ are the subcarrier spacing configurations for triggered SRS and
PDCCH carrying the triggering command respectively.
\- _T~switch~_ , _µ~UL,carrier1~ and µ~UL,carrier2~_ are defined in clause
6.4.
\- A UE reporting its UE capability \'srs-TriggeringDCI\' can be indicated
with DCI 0_1 and 0_2 to trigger aperiodic SRS without data and without CSI as
described in clause 7.3.1.1 of [5, TS 38.212]. Otherwise, except for DCI
format 0_1/0_2 with CRC scrambled by SP-CSI-RNTI, a UE is not expected to
receive a DCI format 0_1/0_2 with UL-SCH indicator of \"0\" and CSI request of
all zero(s) as described in clause 7.3.1.1 of [5, TS 38.212].
\- If the UE receives the DCI triggering aperiodic SRS in slot _n and_ at
least one resource set is configured with parameter _availableSlotOffset_
across all configured BWPs in a component carrier except when SRS is
configured with the higher layer parameter _SRS-PosResource_ ,
\- If ca-_SlotOffset_ is configured, the UE transmits aperiodic SRS in each of
the triggered SRS resource set(s) in the (_t_ \+ 1)-th available slot counting
from slot ,
\- otherwise the UE transmits aperiodic SRS in each of the triggered SRS
resource set(s) in the (_t_ \+ 1)-th available slot counting from slot
$\left\lfloor n \cdot \frac{2^{\mu_{\text{SRS}}}}{2^{\mu_{\text{PDCCH}}}}
\right\rfloor + k$, where
_\- k_ is configured via higher layer parameter _slotOffset_ for each
triggered SRS resources set and is based on the subcarrier spacing of the
triggered SRS transmission, _µ~SRS~_ and _µ~PDCCH~_ are the subcarrier spacing
configurations for triggered SRS and PDCCH carrying the triggering command,
respectively;
_-_ $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}$ are the $N_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH,
$N_{\text{slot,\ offset,\ }\text{SRS}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{SRS}}$ are the $N_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell transmitting the SRS, as defined
in [4, TS 38.211] clause 4.5.
\- An available slot is a slot satisfying there are UL or flexible symbol(s)
for the time-domain location(s) for all the SRS resources in the resource set
and it satisfies UE capability on the minimum timing requirement between
triggering PDCCH and all the SRS resources in the resource set. From the first
symbol carrying the SRS request DCI to the last symbol of the triggered SRS
resource set, UE does not expect to receive SFI indication, UL cancellation
indication or dynamic scheduling of DL channel/signal(s) on flexible symbol(s)
that may change the determination of available slot.
_\- t is configured via higher layer parameter availableSlotOffsetList with up
to four different values of AvailableSlotOffset_ for each triggered SRS
resources set and it is based on the subcarrier spacing of the triggered SRS
transmission. When one or more SRS resource sets across all configured BWPs in
a component carrier are configured, and at least one resource set is
configured with _availableSlotOffsetList_ parameter of more than one values,
the indicated value of _t_ is indicated by SOI field in DCI scheduling
PUSCH/PDSCH and DCI 0_1/0_2 without data and without CSI request described in
[5, TS 38.212]. The UE shall apply indicated value _t_ specifically for those
sets with configured _availableSlotOffsetList_ parameter. When one or more SRS
resource sets across all configured BWPs in a component carrier are configured
and at least one resource set is configured with _availableSlotOffsetList_
parameter, and the _availableSlotOffsetList_ parameter for each SRS resource
set has only one value, the UE shall apply the configured value specifically
for those sets with configured _availableSlotOffsetList_ parameter. _For SRS
resource set configured with availableSlotOffsetList parameter, each of
resource set is configured with K values of AvailableSlotOffset. For SRS
resource set configured without availableSlotOffsetList parameter, t = 0 is
applied for the resource set._
\- If the UE receives the DCI triggering aperiodic SRS in slot _n and_ none of
the resource sets is configured with parameter _availableSlotOffsetList_
across all configured BWPs in a component carrier except when SRS is
configured with the higher layer parameter _SRS-PosResource_
\- if the UE is configured with _ca-SlotOffset_ for at least one of the
triggered and triggering cell, the UE transmits aperiodic SRS in each of the
triggered SRS resource set(s) in slot _,_
\- otherwise, the UE transmits aperiodic SRS in each of the triggered resource
set(s) in slot $K_{s} = \left\lfloor n \cdot
\frac{2^{\mu_{\text{SRS}}}}{2^{\mu_{\text{PDCCH}}}} \right\rfloor + k +
K_{\text{offset}} \cdot
\frac{2^{\mu_{\text{SRS}}}}{2^{\mu_{K_{\text{offset}}}}}$, where
$K_{\text{offset}}$ is a parameter configured by higher layer as specified in
clause 4.2 of [6 TS 38.213], and where
_\- k_ is configured via higher layer parameter _slotOffset_ for each
triggered SRS resources set and is based on the subcarrier spacing of the
triggered SRS transmission, _µ~SRS~_ and _µ~PDCCH~_ are the subcarrier spacing
configurations for triggered SRS and PDCCH carrying the triggering command
respectively;
_-_ $\mu_{K_{\text{offset}}}$is the subcarrier spacing configuration for
$K_{\text{offset}}$ with a value of 0 for frequency range 1.
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}\ $are the $\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH,
$N_{slot,offset,SRS}^{\text{CA}}$ and $\mu_{offset,SRS}$ are the
{width="0.5833333333333334in" height="0.2777777777777778in"} and the
{width="0.3347222222222222in" height="0.21666666666666667in"}, respectively,
which are determined by higher-layer configured _ca-SlotOffset_ for the cell
transmitting the SRS, as defined in [4, TS 38.211] clause 4.5.
\- If the UE receives the DCI triggering aperiodic SRS in slot _n_ and when
SRS is configured with the higher layer parameter _SRS-PosResource_ , the UE
transmits every aperiodic SRS resource in each of the triggered SRS resource
set(s) in slot , if UE is configured with _ca-SlotOffset_ for at least one of
the triggered and triggering cell, $K_{s} = \left\lfloor n \cdot
\frac{2^{\mu_{\text{SRS}}}}{2^{\mu_{\text{PDCCH}}}} \right\rfloor + k +
K_{\text{offset}} \cdot
\frac{2^{\mu_{\text{SRS}}}}{2^{\mu_{K_{\text{offset}}}}}$, otherwise, where
$K_{\text{offset}}$ is a parameter configured by higher layer as specified in
clause 4.2 of [6 TS 38.213], and where
_\- k_ is configured via higher layer parameter _slotOffset_ for each
aperiodic SRS resource in each triggered SRS resources set and is based on the
subcarrier spacing of the triggered SRS transmission, _µ~SRS~_ and _µ~PDCCH~_
are the subcarrier spacing configurations for triggered SRS and PDCCH carrying
the triggering command respectively;
_-_ $\mu_{K_{\text{offset}}}$ is the subcarrier spacing configuration for
$K_{\text{offset}}$ with a value of 0 for frequency range 1.
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}\ $are the $\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH,
$N_{slot,offset,SRS}^{\text{CA}}$ and $\mu_{offset,SRS}$ are the
{width="0.5833333333333334in" height="0.2777777777777778in"} and the
{width="0.3347222222222222in" height="0.21666666666666667in"}, respectively,
which are determined by higher-layer configured _ca-SlotOffset_ for the cell
transmitting the SRS, as defined in [4, TS 38.211] clause 4.5.
\- if the UE is configured with the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ containing the ID of a
reference \'ssb-Index\', \'ssb-IndexServing\' or \'ssb-IndexNcell\', the UE
shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference SS/PBCH block, if
the higher layer parameter _spatialRelationInfo_ or _spatialRelationInfoPos_
contains the ID of a reference \'csi-RS-Index\' or \'csi-RS-IndexServing\',
the UE shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference periodic CSI-RS or
of the reference semi-persistent CSI-RS, or of the latest reference aperiodic
CSI-RS. If the higher layer parameter _spatialRelationInfo_ or
_spatialRelationInfoPos_ contains the ID of a reference \'srs\' or \'srs-
SpatialRelation\', the UE shall transmit the target SRS resource with the same
spatial domain transmission filter used for the transmission of the reference
periodic SRS or of the reference semi-persistent SRS or of the reference
aperiodic SRS. When the SRS is configured by the higher layer parameter _SRS-
PosResourceSet_ and if the higher layer parameter _spatialRelationInfoPos_
contains the ID of a reference \'dl-PRS\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
reception of the reference DL PRS.
\- when a UE receives an spatial relation update command, as described in
clause 6.1.3.26 of [10, TS 38.321], for an SRS resource configured with the
higher layer parameter _SRS-Resource_ , and when the HARQ-ACK corresponding to
the PDSCH carrying the update command is transmitted in slot _n_ , the
corresponding actions in [10, TS 38.321] and the UE assumptions on updating
spatial relation for the SRS resource shall be applied for SRS transmission
starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}\ $where _μ_ is the SCS configuration for the
PUCCH. The update command contains spatial relation assumptions provided by a
list of references to reference signal IDs, one per element of the updated SRS
resource set. Each ID in the list refers to a reference SS/PBCH block, NZP
CSI-RS resource configured on serving cell indicated by _Resource Serving Cell
ID_ field in the update command if present, same serving cell as the SRS
resource set otherwise, or SRS resource configured on serving cell and uplink
bandwidth part indicated by _Resource_ _Serving Cell ID_ field and _Resource
BWP ID_ field in the update command if present, same serving cell and
bandwidth part as the SRS resource set otherwise. When the UE is configured
with the higher layer parameter _usage_ in _SRS-ResourceSet_ set to
\'antennaSwitching\', the UE shall not expect to be configured with different
spatial relations for SRS resources in the same SRS resource set.
The UE is not expected to be configured with different time domain behavior
for SRS resources in the same SRS resource set. The UE is also not expected to
be configured with different time domain behavior between SRS resource and
associated SRS resources set.
For operation in the same carrier, the UE is not expected to be configured on
overlapping symbols with a SRS resource configured by the higher layer
parameter _SRS-PosResource_ and a SRS resource configured by the higher layer
parameter _SRS-Resource_ with _resourceType_ of both SRS resources as
\'periodic\'.
For operation in the same carrier, the UE is not expected to be activated or
triggered to transmit SRS on overlapping symbols with a SRS resource
configured by the higher layer parameter _SRS-PosResource_ and a SRS resource
configured by the higher layer parameter _SRS-Resource_ with _resourceType_ of
both SRS resources as \'semi-persistent\' or \'aperiodic\'.
For operations in the same carrier, the UE is not expected to be configured on
overlapping symbols with more than one SRS resources configured by the higher
layer parameter _SRS-PosResource_ with _resourceType_ of the SRS resources as
\'periodic\'.
For operations in the same carrier, the UE is not expected to be activated or
triggered to transmit SRS on overlapping symbols with more than one SRS
resources configured by the higher layer parameter _SRS-PosResource_ with
_resourceType_ of the SRS resources as \'semi-persistent\' or \'aperiodic\'.
For intra-band and inter-band CA operations, a UE can simultaneously transmit
more than one SRS resource configured by _SRS-PosResource_ on different CCs,
subject to UE\'s capability
For intra-band and inter-band CA operations, a UE can simultaneously transmit
more than one SRS resource configured by _SRS-PosResource_ and _SRS-Resource_
on different CCs, subject to UE\'s capability.
The SRS request field [5, TS38.212] in DCI format 0_1, 1_1, 0_2 (if SRS
request field is present), 1_2 (if SRS request field is present), 0_3, 1_3
indicates the triggered SRS resource set given in Table 7.3.1.1.2-24 of [5, TS
38.212]. The 2-bit SRS request field in DCI format 2_3 indicates the triggered
SRS resource set given in clause 7.3 of [5, TS 38.212] and defined by the
entries of the higher layer parameter _srs-ResourceSetToAddModList_ if the UE
is configured with higher layer parameter _srs-TPC-PDCCH-Group_ set to
\'typeB\', or indicates the SRS transmission on a set of serving cells
configured by higher layers if the UE is configured with higher layer
parameter _srs-TPC-PDCCH-Group_ set to \'typeA\'.
For PUCCH and SRS on the same carrier, a UE shall not transmit SRS when semi-
persistent or periodic SRS is configured in the same symbol(s) with PUCCH
carrying only CSI report(s), or only L1-RSRP report(s), or only L1-SINR
report(s). A UE shall not transmit SRS when semi-persistent or periodic SRS is
configured or aperiodic SRS is triggered to be transmitted in the same
symbol(s) with PUCCH carrying HARQ-ACK, link recovery request (as defined in
clause 9.2.4 of [6, 38.213]) and/or SR. In the case that SRS is not
transmitted due to overlap with PUCCH, only the SRS symbol(s) that overlap
with PUCCH symbol(s) are dropped. PUCCH shall not be transmitted when
aperiodic SRS is triggered to be transmitted to overlap in the same symbol
with PUCCH carrying semi-persistent/periodic CSI report(s) or semi-
persistent/periodic L1-RSRP report(s) only, or only L1-SINR report(s).
In case of intra-band contiguous carrier aggregation, or in inter-band or
intra-band non-contiguous CA band combination if simultaneous SRS and
PUCCH/PUSCH transmissions are not supported by UE, the UE is not expected to
be indicated with a SRS transmission from a carrier and to be configured or
scheduled with a PUSCH/UL DM-RS/UL PT-RS/PUCCH transmission from a different
carrier in the same symbol.
In case of intra-band contiguous carrier aggregation, or in inter-band CA band
combination if simultaneous SRS and PRACH transmissions are not supported by
UE, or in case of intra-band non-contiguous CA band combination if the UE is
not configured with higher layer parameter _intraBandNC-PRACH-simulTx-r17,_
the UE shall not transmit simultaneously SRS resource(s) from a carrier and
PRACH from a different carrier.
In case of intra-band contiguous carrier aggregation, or in inter-band CA band
combination if simultaneous SRS and MsgA transmissions are not supported by
UE, the UE shall not transmit simultaneously SRS resource(s) from a carrier
and MsgA from a different carrier.
In case a SRS resource with _resourceType_ set as \'aperiodic\' is triggered
on the OFDM symbol(s) configured with periodic/semi-persistent SRS
transmission, the UE shall transmit the aperiodic SRS resource and only the
periodic/semi-persistent SRS symbol(s) overlapping within the symbol(s) are
dropped, while the periodic/semi-persistent SRS symbol(s) that are not
overlapped with the aperiodic SRS resource are transmitted. In case a SRS
resource with _resourceType_ set as \'semi-persistent\' is triggered on the
OFDM symbol(s) configured with periodic SRS transmission, the UE shall
transmit the semi-persistent SRS resource and only the periodic SRS symbol(s)
overlapping within the symbol(s) are dropped, while the periodic SRS symbol(s)
that are not overlapped with the semi-persistent SRS resource are transmitted.
When the UE is configured with the higher layer parameter _usage_ in _SRS-
ResourceSet_ set to \'antennaSwitching\', and a guard period of Y symbols is
configured according to Clause 6.2.1.2, the UE shall use the same priority
rules as defined above during the guard period as if SRS was configured.
When a _spatialRelationInfo_ is activated/updated for a semi-persistent or
aperiodic SRS resource configured by the higher layer parameter _SRS-Resource_
by a MAC CE for a set of CCs/BWPs, where the applicable list of CCs provided
by higher layer parameter _simultaneousSpatial-UpdatedList1_ or
_simultaneousSpatial-UpdatedList2_ is determined by the indicated CC in the
MAC CE, the _spatialRelationInfo_ is applied for the semi-persistent or
aperiodic SRS resource(s) with the same SRS resource ID for all the BWPs in
the determined CCs.
When the higher layer parameter _enableDefaultBeamPL-ForSRS_ is set
\'enabled\', and if the higher layer parameter _spatialRelationInfo_ for the
SRS resource, except for the SRS resource with the higher layer parameter
_usage_ in SRS-ResourceSet set to \'beamManagement\' or for the SRS resource
with the higher layer parameter _usage_ in SRS-ResourceSet set to
\'nonCodebook\' with configuration of _associatedCSI-RS_ or for the SRS
resource configured by the higher layer parameter _SRS-PosResourceSet_ , is
not configured in frequency range 2 and if the UE is not configured with
higher layer parameter(s) _pathlossReferenceRS_ , and if the UE is not
configured with different values of _coresetPoolIndex_ in
_ControlResourceSets_ , and is not provided at least one TCI codepoint mapped
with two TCI states, the UE shall transmit the target SRS resource in an
active UL BWP of a CC,
\- according to the spatial relation, if applicable, with a reference to the
RS configured with _qcl-Type_ set to \'typeD\' corresponding to the QCL
assumption of the CORESET with the lowest _controlResourceSetId_ in the active
DL BWP in the CC. If the CORESET is activated with two TCI states,
_sfnSchemePdcch_ is configured and the UE supports _sfn-DefaultUL-
BeamSetup-r17_ , UE shall use the first TCI state as the QCL assumption.
\- according to the spatial relation, if applicable, with a reference to the
RS configured with _qcl-Type_ set to \'typeD\' in the activated TCI state with
the lowest ID applicable to PDSCH in the active DL BWP of the CC if the UE is
not configured with any CORESET in the active DL BWP of the CC.
#### 6.2.1.1 UE SRS frequency hopping procedure
For a given SRS resource, the UE is configured with repetition factor
R∈{1,2,4} or R∈{1,2,3,4,5,6,7,8,10,12,14} by higher layer parameter
_resourceMapping_ in _SRS-Resource_ where _R_ ≤ _N~s~_. When frequency hopping
within an SRS resource in each slot is not configured (_R=N~s~_), each of the
antenna ports of the SRS resource in each slot is mapped in all the symbols to
the same set of subcarriers in the same set of PRBs. When frequency hopping
within an SRS resource in each slot is configured without repetition (_R=1_),
according to the SRS hopping parameters , and defined in clause 6.4.1.4 of [4,
TS 38.211], each of the antenna ports of the SRS resource in each slot is
mapped to different sets of subcarriers in each OFDM symbol, where the same
transmission comb value is assumed for different sets of subcarriers. When
both frequency hopping and repetition within an SRS resource in each slot are
configured (_N~s~ ≥ 4, R ≥ 2_), each of the antenna ports of the SRS resource
in each slot is mapped to the same set of subcarriers within each set of R
adjacent OFDM symbols, and frequency hopping across the $\frac{N_{s}}{R}$ sets
is according to the SRS hopping parameters , and , where $N_{s}$ should be
divisible by $R$.
For operation with shared spectrum channel access in FR1, the UE does not
expect that multiple hops of an SRS resource transmission are in different RB
sets.
A UE may be configured $N_{s} = 2,4,8,10,12\ or\ 14\ $ adjacent symbol
aperiodic SRS resource with intra-slot frequency hopping within a bandwidth
part, where the full hopping bandwidth is sounded with an equal-size subband
across symbols when frequency hopping is configured with _R=1_. A UE may be
configured _N~s~ ≥ 4_ adjacent symbols aperiodic SRS resource with intra-slot
frequency hopping within a bandwidth part, where the full hopping bandwidth is
sounded with an equal-size subband across $\frac{N_{s}}{R}$ sets of _R_
adjacent OFDM symbols, when frequency hopping is configured with _R ≥ 2, N~s~
≥ R and N~s~ should be divisible by R_. Each of the antenna ports of the SRS
resource is mapped to the same set of subcarriers within each set of R
adjacent OFDM symbols of the resource.
A UE may be configured symbol periodic or semi-persistent SRS resource with
inter-slot hopping within a bandwidth part, where the SRS resource occupies
the same symbol location in each slot. A UE may be configured $N_{s} =
2,4,8,10,12\ or\ 14$ symbol periodic or semi-persistent SRS resource with
intra-slot and inter-slot hopping within a bandwidth part, where the SRS
resource occupies the same symbol location(s) in each slot. For _N~s~ ≥ 4_ ,
when frequency hopping is configured with _R ≥ 2_ , intra-slot and inter-slot
hopping is supported with each of the antenna ports of the SRS resource mapped
to different sets of subcarriers across $\frac{N_{s}}{R}$ sets of _R_ adjacent
OFDM symbol(s) of the resource in each slot, where $N_{s}$ should be divisible
by _R_. Each of the antenna ports of the SRS resource is mapped to the same
set of subcarriers within each set of _R_ adjacent OFDM symbols of the
resource in each slot. For _N~s~= R_ , when frequency hopping is configured,
inter-slot frequency hopping is supported with each of the antenna ports of
the SRS resource mapped to the same set of subcarriers in _R_ adjacent OFDM
symbol(s) of the resource in each slot.
#### 6.2.1.2 UE sounding procedure for DL CSI acquisition
When the UE is configured with the higher layer parameter _usage_ in _SRS-
ResourceSet_ set as \'antennaSwitching\', the UE may be configured with only
one of the following configurations depending on the indicated UE capability
_supportedSRS-TxPortSwitch_ (\'t1r2\' for 1T2R, _\'t1r1-t1r2\' for
1T=1R/1T2R,_ \'t2r4\' for 2T4R, \'t1r4\' for 1T4R, \'t8r8\' for 8T8R,
_\'t1r1-t1r2-t1r4\' for 1T=1R/1T2R/1T4R,_ \'t1r4-t2r4\' for 1T4R/2T4R,
_\'t1r1-t1r2-t2r2-t2r4\' for 1T=1R/1T2R/2T=2R/2T4R, \'__t1r1-t1r2_
_-__t2r2-t1r4-t2r4_ _\' for 1T=1R/1T2R/2T=2R/1T4R/2T4R,_ \'t1r1\' for 1T=1R,
\'t2r2\' for 2T=2R, _\'t1r1-t2r2\' for 1T=1R/2T=2R,_ \'t4r4\' for 4T=4R, or
_\'t1r1-t2r2-t4r4\' for 1T=1R/2T=2R/4T=4R_) or the UE may be configured with
only one of the following configurations depending on the indicated UE
capability _supportedSRS-TxPortSwitchBeyond4Rx_ (\'t1r1\' for 1T=1R, \'t2r2\'
for 2T=2R, \'t1r2\' for 1T2R, \'t4r4\' for 4T=4R, \'t2r4\' for 2T4R, \'t1r4\'
for 1T4R, \'t2r6\' for 2T6R, \'t1r6\' for 1T6R, \'t4r8\' for 4T8R, \'t2r8\'
for 2T8R, \'t1r8\' for 1T8R):
\- For 1T2R, if the UE is indicating _srs-AntennaSwitching2SP-1Periodic_
and/or _srs-ExtensionAperiodicSRS_ :
\- when the UE is indicating _srs-AntennaSwitching2SP-1Periodic_ only, then up
to two SRS resource sets with _resourceType_ in _SRS-ResourceSet_ set to
\'semi-persistent\' and up to one SRS resource set with _resourceType_ in
_SRS-ResourceSet_ set to \'periodic\' can be configured, or up to two SRS
resource sets configured with a different value for the higher layer parameter
_resourceType_ in _SRS-ResourceSet_ can be configured, where the two SRS
resource sets configured with \'semi-persistent\' are not activated at the
same time, each SRS resource set has two SRS resources transmitted in
different symbols, each SRS resource in a given set consisting of a single SRS
port, and the SRS port of the second resource in the set is associated with a
different UE antenna port than the SRS port of the first resource in the same
set.
\- when the UE is indicating _srs-ExtensionAperiodicSRS_ only, then up to two
SRS resource sets with _resourceType_ in _SRS-ResourceSet_ set to
\'aperiodic\' and up to one SRS resource set with _resourceType_ in _SRS-
ResourceSet_ set to \'periodic\' or \'semi-persistent\' can be configured, or
up to two SRS resource sets configured with a different value for the higher
layer parameter _resourceType_ in _SRS-ResourceSet_ can be configured. In the
case of two resource sets with _resourceType_ in _SRS-ResourceSet_ set to
\'aperiodic\', a total of two SRS resources are transmitted in different
symbols of two different slots, the SRS port of each SRS resource in the given
two sets is associated with a different UE antenna port pair and the two sets
are each configured with one SRS resource. In the case of the one resource set
with _resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\' is configured, a
total of two SRS resources transmitted in different symbols of one slot and
where the SRS port of the second resource in the given set is associated with
a different UE antenna port than the SRS port of the first resource in the
same set. Each SRS resource set with \'resourceType\' in _SRS-ResourceSet_ set
to \'periodic\' or \'semi-persistent\' has two SRS resources transmitted in
different symbols, each SRS resource in a given set consisting of a single SRS
port, and the SRS port of the second resource in the set is associated with a
different UE antenna port than the SRS port of the first resource in the same
set.
\- zero or one or two SRS resource sets configured with different value of
_resourceType_ in _SRS-ResourceSet_ set to \'periodic\' or \'semi-persistent\'
if the UE is not indicating _srs-AntennaSwitching2SP-1Periodic_ , or up to two
SRS resource sets configured with resourceType in SRS-ResourceSet set to
\'semi-persistent\' and up to one SRS resource set configured with
resourceType in SRS-ResourceSet set to \'periodic\' if the UE is indicating
_srs-AntennaSwitching2SP-1Periodic_ , where the two SRS resource sets
configured with \'semi-persistent\' are not activated at the same time. An SRS
resource set has two SRS resources transmitted in different symbols, each SRS
resource in a given set consisting of a single SRS port, and the SRS port of
the second resource in the set is associated with a different UE antenna port
than the SRS port of the first resource in the same set, and
\- zero or one SRS resource set with _resourceType_ in _SRS-ResourceSet_ set
to \'aperiodic\' if the UE is not indicating _srs-ExtensionAperiodicSRS_ , or
up to two SRS resource sets configured with _resourceType_ in _SRS-
ResourceSet_ set to \'aperiodic\' if the UE is indicating _srs-
ExtensionAperiodicSRS_ , where in the case of one resource set, a total of two
SRS resources transmitted in different symbols of one slot and where the SRS
port of the second resource in the given set is associated with a different UE
antenna port than the SRS port of the first resource in the same set. In the
case of two resource sets, a total of two SRS resources are transmitted in
different symbols of two different slots, the SRS port of each SRS resource in
the given two sets is associated with a different UE antenna port. The two
sets are each configured with one SRS resource, or
_-_ otherwise, _for 1T2R, up to two SRS resource sets configured with a
different value for the higher layer parameter resourceType in SRS-ResourceSet
set, where each set has_ two SRS resources transmitted in different symbols,
each SRS resource in a given set consisting of a single SRS port, and the SRS
port of the second resource in the set is associated with a different UE
antenna port than the SRS port of the first resource in the same set, or
_\- For 2T4R, if the UE is indicating srs-AntennaSwitching2SP-1Periodic and/or
srs-ExtensionAperiodicSRS:_
\- when the UE is indicating _srs-AntennaSwitching2SP-1Periodic_ only, then up
to two SRS resource sets with _resourceType_ in _SRS-ResourceSet_ set to
\'semi-persistent\' and up to one SRS resource set with _resourceType_ in
_SRS-ResourceSet_ set to \'periodic\' can be configured, or up to two SRS
resource sets configured with a different value for the higher layer parameter
_resourceType_ in _SRS-ResourceSet_ can be configured, where the two SRS
resource sets configured with \'semi-persistent\' are not activated at the
same time, each SRS resource set has two SRS resources transmitted in
different symbols, each SRS resource in a given set consisting of two SRS
ports, and the SRS port pair of the second resource is associated with a
different UE antenna port pair than the SRS port pair of the first resource.
\- when the UE is indicating _srs-ExtensionAperiodicSRS_ only, then up to two
SRS resource sets with _resourceType_ in _SRS-ResourceSet_ set to
\'aperiodic\' and up to one SRS resource set with _resourceType_ in _SRS-
ResourceSet_ set to \'periodic\' or \'semi-persistent\' can be configured, or
up to two SRS resource sets configured with a different value for the higher
layer parameter _resourceType_ in _SRS-ResourceSet_ can be configured. In the
case of two resource sets with _resourceType_ in _SRS-ResourceSet_ set to
\'aperiodic\', a total of two SRS resources are transmitted in different
symbols of two different slots, the SRS port pair of each SRS resource in the
given two sets is associated with a different UE antenna port pair and the two
sets are each configured with one SRS resource. In the case of one resource
set with _resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\' is
configured, a total of two SRS resources transmitted in different symbols in
the same slot, each SRS resource in a given set consisting of two SRS ports,
and the SRS port pair of the second resource is associated with a different UE
antenna port pair than the SRS port pair of the first resource. Each SRS
resource set with \'resourceType\' in _SRS-ResourceSet_ set to \'periodic\' or
\'semi-persistent\' has two SRS resources transmitted in different symbols,
each SRS resource in a given set consisting of two SRS ports, and the SRS port
pair of the second resource is associated with a different UE antenna port
pair than the SRS port pair of the first resource.
\- zero or one or two SRS resource sets configured with a different value for
the higher layer parameter _resourceType_ in _SRS-ResourceSet_ set to
\'periodic\' or \'semi-persistent\' if the UE is not indicating _srs-
AntennaSwitching2SP-1Periodic_ , or up to two SRS resource sets configured
with _resourceType_ in _SRS-ResourceSet_ set to \'semi-persistent\' and up to
one SRS resource set configured with _resourceType_ in _SRS-ResourceSet_ set
to \'periodic\' if the UE is indicating _srs-AntennaSwitching2SP-1Periodic_ ,
where the two SRS resource sets configured with \'semi-persistent\' are not
activated at the same time. Each SRS resource set has two SRS resources
transmitted in different symbols, each SRS resource in a given set consisting
of two SRS ports, and the SRS port pair of the second resource is associated
with a different UE antenna port pair than the SRS port pair of the first
resource, and,
\- zero or one SRS resource set configured with _resourceType_ in _SRS-
ResourceSet_ set to \'aperiodic\' if the UE is not indicating _srs-
ExtensionAperiodicSRS_ , or up to two SRS resource sets configured with
_resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\' if the UE is
indicating _srs-ExtensionAperiodicSRS_ , where in the case of one resource
set, a total of two SRS resources transmitted in different symbols in the same
slot, each SRS resource in a given set consisting of two SRS ports, and the
SRS port pair of the second resource is associated with a different UE antenna
port pair than the SRS port pair of the first resource. In the case of two
resource sets, a total of two SRS resources are transmitted in different
symbols of two different slots, the SRS port pair of each SRS resource in the
given two sets is associated with a different UE antenna port pair. The two
sets are each configured with one SRS resource, or
> _\- otherwise, up to two SRS resource sets configured with a different value
> for the higher layer parameter resourceType in SRS-ResourceSet, where each
> SRS resource set has two SRS resources transmitted in different symbols,
> each SRS resource in a given set consisting of two SRS ports, and the SRS
> port pair of the second resource is associated with a different UE antenna
> port pair than the SRS port pair of the first resource,_ or
_\- For 1T4R, if the UE is indicating srs-AntennaSwitching2SP-1Periodic and/or
srs-ExtensionAperiodicSRS and/or srs-OneAP-SRS,_
\- _zero or one SRS resource set configured with resourceType in SRS-
ResourceSet set to \'periodic\' or \'semi-persistent\'_ if the UE is not
indicating _srs-AntennaSwitching2SP-1Periodic_ , or up to two SRS resource
sets configured with _resourceType_ in _SRS-ResourceSet_ set to \'_semi-
persistent_ \' and up to one SRS resource set configured with _resourceType_
in _SRS-ResourceSet_ set to \'_periodic_ \' if the UE is indicating _srs-
AntennaSwitching2SP-1Periodic_ , where the two SRS resource sets configured
with \'semi-persistent\' are not activated at the same time. _Each SRS
resource set has four SRS resources transmitted in different symbols, each SRS
resource in a given set consisting of a single SRS port, and the SRS port of
each resource is associated with a different UE antenna port, and_
_\- zero or two SRS resource sets each configured with resourceType in SRS-
ResourceSet set to \'aperiodic\',_ if the UE is not indicating _srs-
ExtensionAperiodicSRS_ or _srs-OneAP-SRS_ , _or zero or one or two_ or _four
SRS resource sets each configured with resourceType in SRS-ResourceSet set to
\'aperiodic\'_ if the UE is indicating _srs-ExtensionAperiodicSRS_ and _srs-
OneAP-SRS_ , or zero or two or four SRS resource sets _each configured with
resourceType in SRS-ResourceSet set to \'aperiodic\'_ if the UE is indicating
_srs-ExtensionAperiodicSRS_ only, or zero or one or two SRS resource sets
_each configured with resourceType in SRS-ResourceSet set to \'aperiodic\'_ if
the UE is indicating _srs-OneAP-SRS_ only _._ In the case of one resource set,
a total of four SRS resources are transmitted in different symbols in the same
slot, and the SRS port of each resource in the given set is associated with a
different UE antenna port _. In the case of two resource sets, a total of four
SRS resources are transmitted in different symbols of two different slots, and
the SRS port of each SRS resource in the given two sets is associated with a
different UE antenna port. The two sets are each configured with two SRS
resources, or one set is configured with one SRS resource and the other set is
configured with three SRS resources. In the case of four resource sets,_ if UE
is capable if supporting four sets, _a total of four SRS resources are
transmitted in different symbols of four different slots, and the SRS port of
each SRS resource in the given four sets is associated with a different UE
antenna port. The four sets are each configured with one SRS resource. The UE
shall expect that the value of the higher layer parameter aperiodicSRS-
ResourceTrigger_ or the value of an entry in _AperiodicSRS-
ResourceTriggerList_ _in each SRS-ResourceSet is the same, and the value of
the higher layer parameter slotOffset in each SRS-ResourceSet is different_
when none of the SRS resource sets is configured with parameter
_availableSlotOffsetList_ across all configured BWPs in a component carrier _.
Or,_
> _\- otherwise, for 1T4R,_
\- zero or one SRS resource set configured with higher layer parameter
_resourceType_ in _SRS-ResourceSet_ set to \'periodic\' or \'semi-persistent\'
with four SRS resources transmitted in different symbols, each SRS resource in
a given set consisting of a single SRS port, and the SRS port of each resource
is associated with a different UE antenna port, and
\- zero or two SRS resource sets each configured with higher layer parameter
_resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\' and with a total of
four SRS resources transmitted in different symbols of two different slots,
and where the SRS port of each SRS resource in the given two sets is
associated with a different UE antenna port. The two sets are each configured
with two SRS resources, or one set is configured with one SRS resource and the
other set is configured with three SRS resources. The UE shall expect that the
value of the higher layer parameter _aperiodicSRS-ResourceTrigger_ or the
value of an entry in _AperiodicSRS-ResourceTriggerList_ in each _SRS-
ResourceSet_ is the same, and the value of the higher layer parameter
_slotOffset_ in each _SRS-ResourceSet_ is different when none of the SRS
resource sets is configured with parameter _availableSlotOffsetList_ across
all configured BWPs in a component carrier. Or,
_\- For 1T=1R, 2T=2R, 4T=4R or 8T=8R, up to two SRS resource sets each with
one SRS resource can be configured, where the number of SRS ports for each
resource is equal to 1, 2, 4 or 8_ if the UE is not indicating _srs-
AntennaSwitching2SP-1Periodic_. Two SRS resource sets configured with
_resourceType_ in _SRS-ResourceSet_ set to \'_semi-persistent_ \' and one SRS
resource set configured with _resourceType_ in _SRS-ResourceSet_ set to
\'_periodic_ \' can be configured and the two SRS resource sets configured
with \'_semi-persistent_ \' are not activated at the same time, or up to two
SRS resource sets can be configured, if the UE is indicating _srs-
AntennaSwitching2SP-1Periodic_ , where each SRS resource set has one SRS
resource, the number of SRS ports for each resource is equal to 1, 2, 4[_,_ or
8 _] or_
_\- For 1T6R, zero or one SRS resource set configured with resourceType in
SRS-ResourceSet set to \'periodic\', where in the case of one resource set has
six_ SRS resources transmitted in different symbols, each SRS resource in a
given set consisting of a single SRS port, and the SRS port of the resource in
the set is associated with a different UE antenna port, and
_\- For 1T6R, zero or one SRS resource sets configured with resourceType in
SRS-ResourceSet set to \'semi-persistent\'_ if the UE is not indicating _srs-
AntennaSwitching2SP-1Periodic_ , _or up to two SRS resource sets configured
with resourceType in SRS-ResourceSet set to \'semi-persistent\'_ if the UE is
indicating _srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets
configured with \'semi-persistent\' are not activated at the same time. Each
SRS resource set has six_ SRS resources transmitted in different symbols, each
SRS resource in a given set consisting of a single SRS port, and the SRS port
of the resource in the set is associated with a different UE antenna port _,_
and
_\- For 1T6R, zero or one or two or three SRS resource sets configured with
resourceType in SRS-ResourceSet set to \'aperiodic\', where in the case of one
resource set a total of six SRS resources transmitted_ in different symbols,
each SRS resource in a given set consisting of a single SRS port, and the SRS
port of each resource in the set is associated with a different UE antenna
port. _In the case of two resource sets a total of six SRS resources are
transmitted in different symbols of two different slots, and the SRS port of
each SRS resource in the given two sets is associated with a different UE
antenna port. In the case of three resource sets, a total of six SRS resources
are transmitted in different symbols of three different slots, and the SRS
port of each SRS resource in the given three sets is associated with a
different UE antenna port, or_
\- For 1T8R, zero or one SRS resource set configured with _resourceType_ in
_SRS-ResourceSet_ set to \'periodic\', where in the case of one resource set
has eight SRS resources transmitted in different symbols, each SRS resource in
a given set consisting of a single SRS port, and the SRS port of the resource
in the set is associated with a different UE antenna port, and
\- For 1T8R, zero or one SRS resource sets configured with _resourceType_ in
_SRS-ResourceSet_ set to \'semi-persistent\' if the UE is not indicating _srs-
AntennaSwitching2SP-1Periodic_ , or up to two SRS resource sets configured
with _resourceType_ in _SRS-ResourceSet_ set to \'semi-persistent\' if the UE
is indicating _srs-AntennaSwitching2SP-1Periodic_ , where the two SRS resource
sets configured with \'semi-persistent\' are not activated at the same time.
Each SRS resource set has eight SRS resources transmitted in different
symbols, each SRS resource in a given set consisting of a single SRS port, and
the SRS port of the resource in the set is associated with a different UE
antenna port, and
_\- For 1T8R, zero or two or three or four SRS resource sets configured with
resourceType in SRS-ResourceSet set to \'aperiodic\', where_ _in the case of
two resource sets a total of eight SRS resources transmitted in different
symbols of two different slots, and where the SRS port of each SRS resource in
the given two sets is associated with a different UE antenna port. In the case
of three resource sets a total of eight SRS resources are transmitted in
different symbols of three different slots, and the SRS port of each SRS
resource in the given three sets is associated with a different UE antenna
port. In the case of four resource sets a total of eight SRS resources are
transmitted in different symbols of four different slots, and the SRS port of
each SRS resource in the given four sets is associated with a different UE
antenna port,_ or
_\- For 2T6R, zero or one SRS resource set configured with resourceType in
SRS-ResourceSet set to \'periodic\', where in the case of one resource set has
three_ SRS resources transmitted in different symbols, each SRS resource in a
given set consisting of a two SRS ports, and the SRS port pair of the resource
in the set is associated with a different UE antenna port pair, and
_\- For 2T6R, zero or one SRS resource sets configured resourceType in SRS-
ResourceSet set to \'semi-persistent\'_ if the UE is not indicating _srs-
AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with
\'semi-persistent\' and up to one SRS resource set configured with
\'periodic\'_ if the UE is indicating _srs-AntennaSwitching2SP-1Periodic,_
where the two SRS resource sets configured with \'semi-persistent\' are not
activated at the same time. _Each SRS resource set has three_ SRS resources
transmitted in different symbols, each SRS resource in a given set consisting
of a two SRS ports, and the SRS port pair of the resource in the set is
associated with a different UE antenna port pair, _and_
_\- For 2T6R, zero or one or two or three SRS resource sets configured with
resourceType in SRS-ResourceSet set to \'aperiodic, where in the case of one
resource set has three_ SRS resources transmitted in different symbols, each
SRS resource in a given set consisting of a two SRS ports, and the SRS port
pair of the resource in the set is associated with a different UE antenna port
pair. _In the case of two resource sets a total of three SRS resources are
transmitted in different symbols of two different slots, and the SRS port pair
of each SRS resource in the given two sets is associated with a different UE
antenna port pair. One set is configured with two SRS resources and another
set with one resource. In the case of three resource sets a total of three SRS
resources are transmitted in different symbols of three different slots, and
the SRS port pair of each SRS resource in the given three sets is associated
with a different UE antenna port pair, or_
_\- For 2T8R, zero or one SRS resource set configured with resourceType in
SRS-ResourceSet set to \'periodic\', where in the case of one resource set has
four_ SRS resources transmitted in different symbols, each SRS resource in a
given set consisting of a two SRS ports, and the SRS port pair of the resource
in the set is associated with a different UE antenna port pair, and
_\- For 2T8R, zero or one SRS resource sets configured with resourceType in
SRS-ResourceSet set to \'semi-persistent\'_ if the UE is not indicating _srs-
AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with
\'semi-persistent\' and up to one SRS resource set configured with
\'periodic\'_ if the UE is indicating _srs-AntennaSwitching2SP-1Periodic,_
where the two SRS resource sets configured with \'semi-persistent\' are not
activated at the same time. _Each SRS resource set has four_ SRS resources
transmitted in different symbols, each SRS resource in a given set consisting
of a two SRS ports, and the SRS port pair of the resource in the set is
associated with a different UE antenna port pair, _and_
_\- For 2T8R, zero or one or two or three or four SRS resource sets configured
with resourceType in SRS-ResourceSet set to \'aperiodic\', where in the case
of one resource set has four_ SRS resources transmitted in different symbols,
each SRS resource in a given set consisting of a two SRS ports, and the SRS
port pair of the resource in the set is associated with a different UE antenna
port pair. _In the case of two resource sets a total of four SRS resources
transmitted in different symbols of two different slots, and where the SRS
port pair of each SRS resource in the given two sets is associated with a
different UE antenna port pair. In the case of three resource sets a total of
four SRS resources transmitted in different symbols of three different slots,
and where the SRS port pair of each SRS resource in the given three sets is
associated with a different UE antenna port pair. Two sets are configured with
one SRS resource in each set and one resource set is configured with two
resources. In the case of four resource sets a total of four SRS resources
transmitted in different symbols of four different slots, and where the SRS
port pair of each SRS resource in the given four sets is associated with a
different UE antenna port pair. Four sets are configured with one SRS resource
in each set, or_
_\- For 4T8R, zero or one or two SRS resource set configured with a different
value of resourceType in SRS-ResourceSet set to \'periodic\' or \'semi-
persistent\'_ if the UE is not indicating _srs-AntennaSwitching2SP-1Periodic,
or up to two SRS resource sets configured with \'semi-persistent\' and up to
one SRS resource set configured with \'periodic\'_ if the UE is indicating
_srs-AntennaSwitching2SP-1Periodic,_ where the two SRS resource sets
configured with \'semi-persistent\' are not activated at the same time. _Each
SRS resource set has two_ SRS resources transmitted in different symbols, each
SRS resource in a given set consisting of a four SRS ports, and the SRS ports
of the resource in the set are associated with a different UE antenna ports,
or
_\- For 4T8R, zero or one or two SRS resource sets configured with
resourceType in SRS-ResourceSet set to \'aperiodic\', where in the case of one
resource set has two_ SRS resources transmitted in different symbols, each SRS
resource in a given set consisting of a four SRS ports, and the SRS ports of
the resource in the set are associated with a different UE antenna ports. _In
the case of two resource sets a total of two SRS resources are transmitted in
different symbols of two different slots, and where the SRS ports of each SRS
resource in the given two sets are associated with a different UE antenna
ports._
The UE is configured with a guard period of _Y_ symbols, in which the UE does
not transmit any other signal, in the case the SRS resources of a set are
transmitted in the same slot. The guard period is in-between the SRS resources
of the set. _For two SRS resource sets of an antenna switching located in two
consecutive slots, if UE is capable of transmitting SRS in all symbols in one
slot, a guard period of Y symbols exists between the last OFDM symbol occupied
by the SRS resource set in the first slot and the first OFDM symbol occupied
by the SRS resource set in the second slot._
**For the inter-set guard period, the** UE does not transmit any other signal
on any symbols of the interval if the interval between SRS resource sets is
_Y_ symbols.
\- When both the SRS resource on all of the corresponding symbols prior to the
gap and the SRS resource on all of the corresponding symbols after the gap are
dropped due to collision handling, the gap period is also dropped with same
priority and can be used for UL transmission.
The UE shall expect to be configured with the same number of SRS ports for all
SRS resources in the SRS resource set(s) with higher layer parameter _usage_
set as \'_antennaSwitching_ \'.
In the case that more than one SRS resource set configured with _resourceType_
in _SRS-ResourceSet_ set to \'aperiodic\', the UE shall expect that the more
than one set are configured with the same values of the higher layer
parameters _alpha_ , _p0_ , _pathlossReferenceRS_ , and _srs-
PowerControlAdjustmentStates_ in _SRS-ResourceSet_.
For 1T2R, 1T4R, 2T4R, 1T6R, 1T8R, 2T6R, 2T8R, 4T8R, or 8T8R, the UE shall not
expect to be configured or triggered with more than one SRS resource set with
higher layer parameter _usage_ set as \'_antennaSwitching_ \' in the same
slot. For 1T=1R, 2T=2R, 4T=4R, or 8T8R, the UE shall not expect to be
configured or triggered with more than one SRS resource set with higher layer
parameter _usage_ set as \'_antennaSwitching_ \' in the same symbol.
The value of _Y_ is defined by Table 6.2.1.2-1.
Table 6.2.1.2-1: The minimum guard period between two SRS resources of an SRS
resource set for antenna switching
* * *
            *Y* \[symbol\]
0 15 1 1 30 1 2 60 1 3 120 2 5 480 7 6 960 14
* * *
#### 6.2.1.3 UE sounding procedure between component carriers
For a carrier of a serving cell _c~1~_ with slot formats comprised of DL and
UL symbols, not configured for PUSCH/PUCCH transmission, denote $c_{2}$ as the
corresponding carrier of a serving cell whose UL transmissions are temporarily
suspended as signalled by higher layer parameter _srs-SwitchFromServCellIndex_
and _srs-SwitchFromCarrier_. Define the set $S\left( c_{2} \right) = { c_{2},\
s_{1}(c_{2})\ldots s_{N - 1}(c_{2})}$ as the set of carriers of serving cells
that each carrier meets one of the following conditions:
\- $s_{i}(c_{2})$ is in the same band and same TAG as $c_{2}$_;_
\- $s_{i}(c_{2})$ is a carrier of inter-band CA with $c_{2}$ and
$s_{i}(c_{2})$ is indicated through the capability signalling _srs-
SwitchingAffectedBandsListNR-r17_ to be affected by the SRS switch from
$c_{2}$ to $c_{1}$;
where $1 \leq i \leq N - 1$.
A UE can be configured with SRS resource(s) on a carrier _c~1~_ with slot
formats comprised of DL and UL symbols and not configured for PUSCH/PUCCH
transmission. For carrier _c~1~_ , the UE is configured with higher layer
parameter _srs-SwitchFromServCellIndex_ and _srs-SwitchFromCarrier_ the
switching from carrier _c~2~_ which is configured for PUSCH/PUCCH
transmission. During SRS transmission on carrier _c~1\ ~_(including any
interruption due to uplink or downlink RF retuning time [11, TS 38.133] as
defined by higher layer parameters _switchingTimeUL_ and _switchingTimeDL_ of
_SRS-SwitchingTimeNR_), the UE temporarily suspends the uplink transmission on
carriers in the set _S(c~2~)_.
For an SRS transmission starting in symbol $N_{c_{1}}$ of carrier $c_{1}$ and
a conflicting transmission in any carrier $\text{within\ the\ set\ }S\left(
c_{2} \right)\ $ starting in symbol$\ N_{S}$, the UE shall apply the
prioritization / dropping rules in the remainder of this clause taking into
account:
\- DCI(s) for which the time interval between the last symbol of PDCCH and
$N_{c_{1}}$ is at least$\text{\ N}_{2}\ $_symbols and an additional time
duration_ $T_{\text{SR}S_{\text{CS}}}$_, and the time interval between the
last symbol of PDCCH and_ $N_{S}$ is at least $\text{\ N}_{2}$ _symbols; and_
\- semi-persistent CSI reports or SRS considered _active at least_ $N_{2}$
_symbols and an additional time duration_ $T_{\text{SR}S_{\text{CS}}}$
_before_ $N_{c_{1}}$_, and considered active at least_ $N_{2}$ _symbols
before_ $N_{S}$_._
_where_ $T_{\text{SR}S_{\text{CS}}} = max{ switchingTimeUL,switchingTimeDL}$_,
and t_ he time interval unit of OFDM symbol is counted based on the smaller
subcarrier spacing across any carrier within the set $S\left( c_{2} \right)$,
$c_{1}$ and their corresponding scheduling cells.
The following prioritization rules shall be applied in case of collision
between a transmission of SRS over carrier $c_{1}\ $ and transmission of a
physical signal/channel over a carrier of a serving cell in set $S\left( c_{2}
\right)$
\- the UE shall not transmit SRS whenever SRS transmission (including any
interruption due to uplink or downlink RF retuning time [11, TS 38.133] as
defined by higher layer parameters _switchingTimeUL_ and _switchingTimeDL_ of
_SRS-SwitchingTimeNR)_ on the carrier of the serving cell $c_{2}$ and
PUSCH/PUCCH transmission carrying HARQ-ACK/positive SR/RI/CRI/SSBRI and/or
PRACH on a carrier of a serving cell in set $S\left( c_{2} \right)\ $happen to
overlap in the same symbol
\- the UE shall not transmit a periodic/semi-persistent SRS whenever
periodic/semi-persistent SRS transmission (including any interruption due to
uplink or downlink RF retuning time [11, TS 38.133] as defined by higher layer
parameters _switchingTimeUL_ and _switchingTimeDL_ of _SRS-SwitchingTimeNR)_
on the carrier of the serving cell $c_{2}$ and PUSCH transmission carrying
aperiodic CSI on a carrier of a serving cell in set $S\left( c_{2} \right)$
happen to overlap in the same symbol
\- the UE shall drop PUCCH/PUSCH transmission carrying periodic/semi-
persistent CSI comprising only CQI/PMI/L1-RSRP/L1-SINR, and/or SRS
transmission on a carrier of a serving cell in set $S\left( c_{2} \right)$
configured for PUSCH/PUCCH transmission whenever the transmission and SRS
transmission (including any interruption due to uplink or downlink RF retuning
time [11, TS 38.133] as defined by higher layer parameters _switchingTimeUL_
and _switchingTimeDL_ of _SRS-SwitchingTimeNR)_ on the carrier of the serving
cell $c_{2}$ happen to overlap in the same symbol
\- the UE shall drop PUSCH transmission carrying aperiodic CSI comprising only
CQI/PMI/L1-RSRP/L1-SINR on a carrier of a serving cell in set $S\left( c_{2}
\right)\ $whenever the transmission and aperiodic SRS transmission (including
any interruption due to uplink or downlink RF retuning time [11, TS 38.133])
as defined by higher layer parameters _switchingTimeUL_ and _switchingTimeDL_
of _SRS-SwitchingTimeNR)_ on the carrier of the serving cell $c_{2}$ happen to
overlap in the same symbol.
For an aperiodic SRS triggered in DCI format 2_3 and if the UE is configured
with higher layer parameter _srs-TPC-PDCCH-Group_ set to \'typeA\', and given
by _SRS-CarrierSwitching,_ without PUSCH/PUCCH transmission, the order of the
triggered SRS transmission on the serving cells follow the order of the
serving cells in the indicated set of serving cells configured by higher
layers, where the UE in each serving cell transmits the configured one or two
SRS resource set(s) from _srs-ResourceSetToAddModList_ with higher layer
parameter _usage_ set to \'antennaSwitching\' and higher layer parameter
_resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\'.
For an aperiodic SRS triggered in DCI format 2_3 and if the UE is configured
with higher layer parameter _srs-TPC-PDCCH-Group_ set to \'typeB\' without
PUSCH/PUCCH transmission, the order of the triggered SRS transmission on the
serving cells follow the order of the serving cells with aperiodic SRS
triggered in the DCI, and the UE in each serving cell transmits the configured
one or two SRS resource set(s) from _srs-ResourceSetToAddModList_ with higher
layer parameter _usage_ set to \'antennaSwitching\' and higher layer parameter
_resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\'.
If the UE is not configured for PUSCH/PUCCH transmission on carrier _c~1\ ~_
with slot formats comprised of DL and UL symbols, and if the UE is not capable
of simultaneous reception and transmission on carrier _c~1~_ and serving cell
_c~2~_ , the UE is not expected to be configured or indicated with SRS
resource(s) such that SRS transmission on carrier _c~1~_ (including any
interruption due to uplink or downlink RF retuning time [11, TS 38.133] as
defined by higher layer parameters _switchingTimeUL_ and _switchingTimeDL_ of
_SRS-SwitchingTimeNR_) would collide with the REs corresponding to the SS/PBCH
blocks configured for the UE or the slots belonging to a control resource set
indicated by _MIB_ or _SIB1_ on serving cell _c~2~_.
For _n_ -th (_n ≥_ 1) aperiodic SRS transmission on a cell _c_ , upon
detection of a positive SRS request on a grant, the UE shall commence this SRS
transmission on the configured symbol and slot provided
\- it is no earlier than the summation of
\- the maximum time duration between the two durations spanned by N OFDM
symbols of the numerology of cell _c_ and the cell carrying the grant
respectively, and
\- the UL or DL RF retuning time [11, TS 38.133] as defined by higher layer
parameters _switchingTimeUL_ and _switchingTimeDL_ of _SRS-SwitchingTimeNR,_
\- it does not collide with any previous SRS transmissions, or interruption
due to UL or DL RF retuning time, except if the previous SRS transmission is
in the same cell _c_ and the UE reports _SRS-StayInTargetCC_ for the
corresponding band combination.
otherwise, _n_ -th SRS transmission is dropped, where N is the reported
capability as the minimum time interval in unit of symbols, between the DCI
triggering and aperiodic SRS transmission.
In case of inter-band carrier aggregation, a UE can simultaneously transmit
SRS and PUCCH/PUSCH across component carriers in different bands subject to
the UE\'s capability.
In case of inter-band carrier aggregation, a UE can simultaneously transmit
PRACH and SRS across component carriers in different bands subject to UE\'s
capability.
If the UE is not configured for PUSCH/PUCCH transmission for at least one
serving cell configured with slot formats comprised of DL and UL symbols, and
if the UE is not capable of simultaneous reception and transmission on serving
cell _c~1~_ and serving cell s(_c~2~_), and if a UE
\- is configured with multiple serving cells and is provided with
_directionalCollisionHandling-r16_ = \'enabled\' for a set of serving cell(s)
among the configured multiple serving cells including serving cell _c~1~_ and
s(_c~2~_), and
\- indicates support of _half-DuplexTDD-CA-SameSCS-r16_ capability, and
\- is not configured to monitor PDCCH for detection of DCI format 2_0 on any
of the multiple serving cells,
the UE shall apply first the prioritization/dropping rules described above for
sounding procedure between component carriers and then apply the procedures
for directional collision handling in clause 11.1 of [6, TS 38.213].
#### 6.2.1.4 UE sounding procedure for positioning purposes
When the SRS is configured by the higher layer parameter _SRS-PosResource_ and
if the higher layer parameter _spatialRelationInfoPos_ is configured _,_ it
contains the ID of the configuration fields of a reference RS according to
Clause 6.3.2 of [TS 38.331]. The reference RS can be an SRS configured by the
higher layer parameter _SRS-Resource_ or _SRS-PosResource_ , CSI-RS, SS/PBCH
block, or a DL PRS configured on a serving cell or a SS/PBCH block or a DL PRS
configured on a non-serving cell. If the UE is configured for transmission of
_SRS-PosResource_ in RRC_INACTIVE mode, the configured
_spatialRelationInfoPos_ is also applicable.
The UE is not expected to transmit multiple SRS resources with different
spatial relations in the same OFDM symbol.
If the UE is not configured with the higher layer parameter
_spatialRelationInfoPos_ the UE may use a fixed spatial domain transmission
filter for transmissions of the SRS configured by the higher layer parameter
_SRS-PosResource_ across multiple SRS resources or it may use a different
spatial domain transmission filter across multiple SRS resources.
In RRC_CONNECTED mode, the UE is only expected to transmit an SRS configured
by the higher layer parameter _SRS-PosResource_ within the active UL BWP of
the UE.
When the configuration of SRS is done by the higher layer parameter _SRS-
PosResource_ , the UE can only be provided with a single RS source in
_spatialRelationInfoPos_ per SRS resource for positioning.
For operation on the same carrier, if an SRS configured by the higher
parameter _SRS-PosResource_ collides with a scheduled PUSCH, the SRS is
dropped in the symbols where the collision occurs.
Unless specified otherwise, the UE does not expect to be configured with _SRS-
PosResource_ on a carrier of a serving cell with slot formats comprised of DL
and UL symbols, not configured for PUSCH/PUCCH transmission.
Timing Error Group (TEG) at UE side is defined:
\- UE Tx TEG is associated with the transmissions of one or more UL SRS
resources for the positioning purpose, which have the Tx timing error
difference within a certain margin.
The UE may be configured to report, via high layer parameter _nr-UE-RxTxTEG-
Request_ or _ue-TxTEG-RequestUL-TDOA-Config_ , subject to UE capability,
association information of the already transmitted SRS resource(s) configured
by the higher layer parameter _SRS-PosResource_ with UE Tx TEG(s) via higher
layer parameter _nr-SRS-TxTEG-Set_ or _ue-TxTEG-AssociationList_.
The UE may report, via high layer parameter _ue-TxTEG-TimingErrorMarginValue_
, the UE Tx TEG timing error margin value of all the UE Tx TEGs within one
_UEPositioningAssistanceInfo_.
If the UE reports a UE Tx TEG ID with a UE Rx-Tx time difference measurement,
as defined in clause 5.1.6.5, the UE shall report the association information
of the already transmitted SRS resources configured by the higher layer
parameter _SRS-PosResource_ with the UE Tx TEG ID.
If the UE is configured with SRS resources configured by the higher layer
parameter _SRS-PosResource_ in multiple CCs, the UE should report the
_carrierFreq or servCellId_ of the SRS resources when it reports the UE Tx TEG
associations.
If the UE reports a UE RxTx TEG ID with a UE Rx-Tx time difference
measurement, the UE may report a UE Tx TEG ID.
If the UE reports a UE Tx TEG ID with a UE Rx-Tx time difference measurement,
the UE may report a UE Tx TEG timing error margin value, via high layer
parameter _nr-UE-TxTEG-TimingErrorMargin_ , for all the UE Tx TEGs within one
_NR-Multi-RTT-SignalMeasurementInformation_.
Subject to UE capability, the UE may be configured with an SRS resource for
positioning associated with the initial UL BWP, and the SRS resource is
transmitted inside the initial UL BWP during RRC_INACTIVE mode with the same
CP and subcarrier spacing as configured for the initial UL BWP. Subject to UE
capability, the UE may be configured with an SRS resource for positioning
outside the initial BWP including frequency location and bandwidth, subcarrier
spacing, and CP length for transmission of the SRS in RRC_INACTIVE mode. If
the transmission of SRS for positioning outside the initial BWP in
RRC_INACTIVE mode along with the switching time, indicated in higher layer
parameter _switchingTimeSRS-TX-OtherTX_ , in unpaired spectrum, subject to UE
capability, collides in time domain with other DL signals or channels or UL
signals or channels, the SRS for positioning transmission is dropped in the
symbol(s) where the collision occurs. If the transmission of SRS for
positioning outside the initial BWP in RRC_INACTIVE mode along with the
switching time, indicated in higher layer parameter _switchingTimeSRS-TX-
OtherTX_ , in paired spectrum or SUL band, subject to UE capability, collides
in time domain with UL signals or channels on the same carrier, the SRS for
positioning transmission is dropped in the symbol(s) where the collision
occurs. The SRS resource for positioning outside the initial BWP in
RRC_INACTIVE mode is configured in the same band and CC as the initial UL BWP.
If the UE in RRC_INACTIVE mode determines that the UE is not able to
accurately measure the configured DL RS in _SRS-SpatialRelationInfoPos_ for a
SRS resource for positioning where the DL RS is semi-persistent or periodic,
the UE stops transmission of the SRS resource for positioning.
The UE is not expected to simultaneously transmit SRS resources configured by
the higher layer parameter _SRS-PosResource_ on NUL and SUL band in
RRC_INACTIVE mode.
The reduced capability UE may be configured via [_higher layer parameter_],
subject to UE capability, to perform transmit frequency hopping separate from
the UL BWP configuration and outside of the UL BWP, where the UE may be
configured with subcarrier spacing, CP and bandwidth that are different from
the UL active BWP. The reduced capability UE transmit frequency hopping is
configured within one SRS resource for positioning, that may be configured
with a bandwidth larger than the maximum bandwidth of the reduced capability
UE, in RRC_CONNECTED or RRC_INACTIVE mode. The reduced capability UE transmit
frequency hopping, may be configured with overlapping or non-overlapping
frequency hops in the frequency domain. When the reduced capability UE is
configured to perform transmit frequency hopping it expects to be configured
via [higher layer parameter] with the starting PRB of the first frequency hop.
The reduced capability UE may be configured, via [higher layer parameter],
subject to UE capability, with an UL time window where the UE is not expected
to transmit other signals/channels and is only expected to transmit the SRS
for positioning using frequency hopping.
The UE is expected to be configured with linkage information [_linkage_] on
SRS resource sets for positioning across two or three CCs which are linked for
bandwidth aggregation. For the linked SRS resource sets, the UE is expected to
be configured with the same values of _startPosition, nrofSymbols,_
_periodicityAndOffset, slotOffset, alpha, p0,_ subcarrier spacing, CP, and
comb size, and the UE is expected to maintain phase continuity for the SRS
transmission. The UE may assume that SRS resources across the linked SRS
resource sets which satisfy the above conditions are linked for bandwidth
aggregation, otherwise, the UE does not assume that SRS resources of the
linked SRS resource sets are linked for bandwidth aggregation. For the linked
SRS resource sets for bandwidth aggregation across CCs, if an SRS configured
by the higher layer parameter _SRS-PosResource,_ along with the [switching
period] when applicable _,_ collides with other signals or channels on a
symbol and is the SRS in that symbol that is dropped, SRS transmission of the
linked SRS resource sets across all CCs is dropped on that symbol.
A UE in RRC_INACTIVE mode is expected to be configured with [frequency
information] on additional component carrier(s) with respective SRS
configuration(s) for bandwidth aggregation.
When an SRS resource configured in a CC without PUSCH or PUCCH is linked for
bandwidth aggregation with an SRS resource configured in an active UL BWP of
another [UL data transmission] CC, there is a [guard period] during which the
UE is not expected to transmit or receive other signals or channels.
The UE may be configured with SRS, via [_SRS-PosRRC-InactiveConfig-
ValidityArea_], subject to UE capability, valid in multiple cells within a
validity area for RRC_INACTIVE mode. For the configured SRS via [_SRS-PosRRC-
InactiveConfig-ValidityArea_], if the UE in RRC_INACTIVE mode determines that
the UE is not able to accurately measure the configured DL RS in [_SRS-
SpatialRelationInfoPos]_ for a SRS resource for positioning where the DL RS is
semi-persistent or periodic, the UE would not perform SRS transmission of the
SRS resource for positioning. If the UE determines that the configured DL RS
in [_SRS-SpatialRelationInfoPos]_ for a SRS resource for positioning is being
accurately measured, the UE is expected to perform the SRS transmission.
### 6.2.2 UE DM-RS transmission procedure
The DM-RS transmission procedures for PUSCH scheduled by PDCCH with DCI format
0_1 described in this clause equally apply to PUSCH scheduled by PDCCH with
DCI format 0_2, by applying the parameters of _dmrs-UplinkForPUSCH-
MappingTypeA-DCI-0-2_ and _dmrs-UplinkForPUSCH-MappingTypeB-DCI-0-2_ instead
of _dmrs-UplinkForPUSCH-MappingTypeA_ and _dmrs-UplinkForPUSCH-MappingTypeB_.
The DM-RS transmission procedures for PUSCH scheduled by PDCCH with DCI format
0_1 described in this clause equally apply to PUSCH scheduled by PDCCH with
DCI format 0_3.
When transmitted PUSCH is neither scheduled by DCI format 0_1/0_2 with CRC
scrambled by C-RNTI, CS-RNTI, SP-CSI-RNTI or MCS-C-RNTI, nor corresponding to
a configured grant, nor being a PUSCH for Type-2 random access procedure, the
UE shall use single symbol front-loaded DM-RS of configuration type 1 on DM-RS
port 0 and the remaining REs not used for DM-RS in the symbols are not used
for any PUSCH transmission except for PUSCH with allocation duration of 2 or
less OFDM symbols with transform precoding disabled, additional DM-RS can be
transmitted according to the scheduling type and the PUSCH duration as
specified in Table 6.4.1.1.3-3 of [4, TS38.211] for frequency hopping disabled
and as specified in Table 6.4.1.1.3-6 of [4, TS38.211] for frequency hopping
enabled, and
If frequency hopping is disabled:
\- The UE shall assume _dmrs-AdditionalPosition_ equals to \'pos2\' and up to
two additional DM-RS can be transmitted according to PUSCH duration, or
If frequency hopping is enabled:
\- The UE shall assume _dmrs-AdditionalPosition_ equals to \'pos1\' and up to
one additional DM-RS can be transmitted according to PUSCH duration.
When transmitted PUSCH is scheduled by activation DCI format 0_0 with CRC
scrambled by CS-RNTI, the UE shall use single symbol front-loaded DM-RS of
configuration type provided by higher layer parameter _dmrs-Type_ in _DMRS-
UplinkConfig_ on DM-RS port 0 and the remaining REs not used for DM-RS in the
symbols are not used for any PUSCH transmission except for PUSCH with
allocation duration of 2 or less OFDM symbols with transform precoding
disabled, and additional DM-RS with _dmrs-AdditionalPosition_ from C
_onfiguredGrantConfig_ can be transmitted according to the scheduling type and
the PUSCH duration as specified in Table 6.4.1.1.3-3 of [4, TS38.211] for
frequency hopping disabled and as specified in Table 6.4.1.1.3-6 of [4,
TS38.211] for frequency hopping enabled.
For the UE-specific reference signals generation as defined in Clause 6.4.1.1
of [4, TS 38.211], a UE can be configured by higher layers with one or two
scrambling identity(s), $n_{\text{ID}}^{DMRS,i}\ $_i_ = 0,1 which are the same
for both PUSCH mapping Type A and Type B.
When transmitted PUSCH is scheduled by DCI format 0_1 with CRC scrambled by
C-RNTI, CS-RNTI, SP-CSI-RNTI or MCS-C-RNTI, or corresponding to a configured
grant, or being a PUSCH for Type-2 random access procedure,
\- for a configured-grant based PUSCH transmission in RRC_INACTIVE state, the
UE is provided with a set of DM-RS port(s) by _sdt-DMRSports_. The DM-RS port
for the PUSCH is determined by the mapping between SS/PBCH block(s) and a
PUSCH occasion and the associated DM-RS resource as described in Clause 19.1
of [6, TS 38.213].
\- the UE may be configured with higher layer parameter _dmrs-Type_ in _DMRS-
UplinkConfig_ , and the configured DM-RS configuration type is used for
transmitting PUSCH in as defined in Clause 6.4.1.1 of [4, TS 38.211].
\- the UE may be configured with the maximum number of front-loaded DM-RS
symbols for PUSCH by higher layer parameter _maxLength_ in _DMRS-
UplinkConfig,_ or by higher layer parameter _msgA-MaxLength_ in _msgA-DMRS-
Config_ ,
\- if _maxLength_ is not configured, single-symbol DM-RS can be scheduled for
the UE by DCI or configured by the configured grant configuration, and the UE
can be configured with a number of additional DM-RS for PUSCH by higher layer
parameter _dmrs-AdditionalPosition,_ which can be \'pos0\', \'pos1\',
\'pos2\', \'pos3\'.
\- if _maxLength_ is configured, either single-symbol DM-RS or double symbol
DM-RS can be scheduled for the UE by DCI or configured by the configured grant
configuration, and the UE can be configured with a number of additional DM-RS
for PUSCH by higher layer parameter _dmrs-AdditionalPosition,_ which can be
\'pos0\' or \'pos1\'.
\- for MsgA PUSCH for Type-2 random access procedure the UE can be configured
with a number of additional DM-RS for PUSCH by higher layer parameter _msgA-
DMRS-AdditionalPosition,_ which can be \'pos0\', \'pos1\', \'pos2\', \'pos3\'
for single-symbol DM-RS or \'pos0\', \'pos1\' for double-symbol DM-RS.
\- and, the UE shall transmit a number of additional DM-RS as specified in
Table 6.4.1.1.3-3 and Table 6.4.1.1.3-4 in -Clause 6.4.1.1.3 of [4, TS
38.211].
If a UE transmitting PUSCH scheduled by DCI format 0_2 is configured with the
higher layer parameter _phaseTrackingRS_ in _dmrs-UplinkForPUSCH-MappingTypeA-
DCI-0-2_ or _dmrs-UplinkForPUSCH-MappingTypeB-DCI-0-2_ , or a UE transmitting
PUSCH scheduled by DCI format 0_0, 0_1 or 0_3 is configured with the higher
layer parameter _phaseTrackingRS_ in _dmrs-UplinkForPUSCH-MappingTypeA_ or
_dmrs-UplinkForPUSCH-MappingTypeB_ , the UE may assume that the following
configurations are not occurring simultaneously for the transmitted PUSCH
\- any DM-RS ports among
4-7 or 6-11 for DM-RS configurations type 1 and type 2, respectively, or
4-7 or 12-15 for DM-RS configuration enhanced type 1, or
6-11 or 18-23 for DM-RS configuration enhanced type 2,
are scheduled for the UE and PT-RS is transmitted from the UE.
For PUSCH scheduled by DCI format 0_1, by activation DCI format 0_1 with CRC
scrambled by CS-RNTI, or configured by configured grant Type 1 configuration,
the UE shall assume the DM-RS CDM groups indicated in Tables 7.3.1.1.2-6 to
[7.3.1.1.2-23] of Clause 7.3.1.1 of [5, TS38.212] are not used for data
transmission, where \"1\", \"2\" and \"3\" for the number of DM-RS CDM
group(s) correspond to CDM group 0, {0,1}, {0,1,2}, respectively.
For PUSCH scheduled by DCI format 0_0 or by activation DCI format 0_0 with CRC
scrambled by CS-RNTI, the UE shall assume the number of DM-RS CDM groups
without data is 1 which corresponds to CDM group 0 for the case of PUSCH with
allocation duration of 2 or less OFDM symbols with transform precoding
disabled, the UE shall assume that the number of DM-RS CDM groups without data
is 3 which corresponds to CDM group {0,1,2} for the case of PUSCH scheduled by
activation DCI format 0_0 and the _dmrs-Type_ in _DMRS-UplinkConfig_ equal to
\'type2\' and the PUSCH allocation duration being more than 2 OFDM symbols,
and the UE shall assume that the number of DM-RS CDM groups without data is 2
which corresponds to CDM group {0,1} for all other cases.
For MsgA PUSCH transmission, if the UE is not configured with _msgA-PUSCH-
DMRS-CDM-group, the UE_ shall assume that 2 DM-RS CDM groups are configured.
Otherwise, _msgA-PUSCH-DMRS-CDM-group indicates which DM-RS CDM group to use
from the set of {0,1}._
For MsgA PUSCH transmission, if the UE is not configured with _msgA-PUSCH-
NrofPorts, the UE_ shall assume that 4 ports are configured per DM-RS CDM
group for double-symbol DM-RS. Otherwise, _msgA-PUSCH-NrofPorts with value of
0 indicates the first port per DM-RS CDM group, while a value of 1 indicates
the first two ports per DM-RS CDM group_.
[For MsgA PUSCH transmission, the UE is not expected to be configured with the
higher layer parameters [_enhanced-dmrs-Type_r18_] set to 'enabled'.]
For uplink DM-RS with PUSCH, the UE may assume the ratio of PUSCH EPRE to DM-
RS EPRE ( [dB]) is given by Table 6.2.2-1 according to the number of DM-RS CDM
groups without data. The DM-RS scaling factor specified in clause 6.4.1.1.3 of
[4, TS 38.211] is given by .
Table 6.2.2-1: The ratio of PUSCH EPRE to DM-RS EPRE
Number of DM-RS CDM groups without data DM-RS configuration type 1 and
enhanced type 1 DM-RS configuration type 2 and enhanced type 2
* * *
1 0 dB 0 dB 2 -3 dB -3 dB 3 - -4.77 dB
For PUSCH repetition Type B, the DM-RS transmission procedure is applied for
each actual repetition separately based on the allocation duration of the
actual repetition. A UE is not expected to be indicated with an antenna port
configuration that is invalid for the allocated duration of any actual
repetition.
### 6.2.3 UE PT-RS transmission procedure
The procedures on PT-RS transmission described in this clause as well as
clauses 6.2.3.1 and 6.2.3.2 apply to a UE PUSCH transmission scheduled by DCI
format 0_2 if the higher layer parameter _phaseTrackingRS_ in _dmrs-
UplinkForPUSCH-MappingTypeA-DCI-0-2 or dmrs-UplinkForPUSCH-MappingTypeB-
DCI-0-2_ is configured, to PUSCH transmissions scheduled by DCI format 0_0,
0_1 or 0_3 if the higher layer parameter _phaseTrackingRS_ in _dmrs-
UplinkForPUSCH-MappingTypeA or dmrs-UplinkForPUSCH-MappingTypeB_ is configured
and PUSCH transmissions corresponding to a configured grant if the higher
layer parameter _phaseTrackingRS_ in _cg-DMRS-Configuration_ is configured. If
a UE is not configured with the higher layer parameter _phaseTrackingRS_ in
the respective _DMRS-UplinkConfig_ , the UE shall not transmit PT-RS. The PT-
RS is only present on PUSCH scheduled by PDCCH with CRC scrambled by MCS-C-
RNTI, C-RNTI, CS-RNTI, SP-CSI-RNTI and on PUSCH corresponding to a configured
grant. For PUSCH repetition Type B, the PT-RS transmission procedure is
applied for each actual repetition separately based on the allocation duration
of the actual repetition.
#### 6.2.3.1 UE PT-RS transmission procedure when transform precoding is not
enabled
When transform precoding is not enabled and if a UE is configured with the
higher layer parameter _phaseTrackingRS_ in _DMRS-UplinkConfig,_
\- the higher layer parameters _timeDensity_ and _frequencyDensity_ in _PTRS-
UplinkConfig_ indicate the threshold values _ptrs-MCS~i~_ , _i_ =1,2,3 and
_N~RB,i~_ , _i_ =0,1, as shown in Table 6.2.3.1-1 and Table 6.2.3.1-2,
respectively.
\- if either or both higher layer parameters _timeDensity_ and/or
_frequencyDensity_ in _PTRS-UplinkConfig_ are configured, the UE shall assume
the PT-RS antenna ports\' presence and pattern are a function of the
corresponding scheduled MCS of the codeword associated with the PT-RS and
scheduled bandwidth in a corresponding bandwidth part as shown in Table
6.2.3.1-1 and Table 6.2.3.1-2, respectively,
\- if the higher layer parameter _timeDensity_ is not configured, the UE shall
assume _L~PT-RS\ ~_ = 1.
\- if the higher layer parameter _frequencyDensity_ is not configured, the UE
shall assume _K~PT-RS~_ = 2.
\- if none of the higher layer parameters _timeDensity_ and _frequencyDensity_
in _PTRS-UplinkConfig_ are configured, the UE shall assume _L~PT-RS~_ = 1 and
_K~PT-RS~_ = 2.
Table 6.2.3.1-1: Time density of PT-RS as a function of scheduled MCS
Scheduled MCS Time density()
* * *
I~MCS~ \ _V_ , where _V_ = 28 for MCS Table 5.1.3.1-1 and MCS
Table 5.1.3.1-3 and _V_ = 27 for MCS Table 5.1.3.1-2, respectively, the MCS
for PT-RS time-density determination is obtained from the DCI for the same
transport block in the initial transmission, which is smaller than or equal to
V.
The maximum number of configured PT-RS ports is given by the higher layer
parameter _maxNrofPorts_ in _PTRS-UplinkConfig._ The UE is not expected to be
configured with a larger number of UL PT-RS ports than it has reported need
for.
If a UE has reported the capability of supporting full-coherent UL
transmission and the higher layer parameter _multipanelScheme_ is not set to
'sdmscheme', the UE shall expect the number of UL PT-RS ports to be configured
as one if ULPT-RS is configured. If a UE has reported the capability of
supporting full-coherent UL transmission and when the higher layer parameter
_multipanelScheme_ is set to 'sdmscheme', subject to UE capability, the UE can
be configured with _maxNrofPortsforSDM_ in _PTRS-UplinkConfig set to n2, where
at most one PT-RS port is associated with each SRS resource set with higher
layer parameter usage set to 'codebook'/'nonCodebook'_.
For codebook or non-codebook based UL transmission, the association between UL
PT-RS port(s) and DM-RS port(s) is signalled by _PTRS-DMRS association_
field(s) in DCI format 0_1, 0_2 and 0_3. For a PUSCH corresponding to a
configured grant Type 1 transmission, the UE may assume the association
between UL PT-RS port(s) and DM-RS port(s) defined by value 0 in Table
7.3.1.1.2-25, or value \"00\" in Table 7.3.1.1.1.2-26 [or value \"00\" in
Table 7.3.1.1.1.2-25a] described in Clause 7.3.1 of [5, TS38.212].[ For a
PUSCH corresponding to a configured grant Type 1 transmission and when the
higher layer parameter _multipanelScheme_ is set to 'SFNscheme', the UE may
assume the association between UL PT-RS port(s) and DM-RS port(s) defined by
value 0 in Table 7.3.1.1.2-25 or value \"00\" in Table 7.3.1.1.1.2-26
described in Clause 7.3.1 of [5, TS38.212]. For a PUSCH corresponding to a
configured grant Type 1 transmission and when the higher layer parameter
_multipanelScheme_ is set to 'sdmscheme', the UE may assume the association
between UL PT-RS port(s) and DM-RS port(s) defined by value 0 in Table
7.3.1.1.2-25 or value \"00\" in Table 7.3.1.1.1.2-25a described in Clause
7.3.1 of [5, TS38.212].]
For PUSCH scheduled by DCI format 0_0 or by activation DCI format 0_0, the UL
PT-RS port is associated to DM-RS port 0.
For non-codebook based UL transmission, the actual number of UL PT-RS port(s)
to transmit is determined based on SRI(s) in DCI format 0_1, 0_2 or 0_3 or
higher layer parameter _sri-ResourceIndicator_ in _rrc-ConfiguredUplinkGrant_.
When two SRS resource sets are configured in _srs-ResourceSetToAddModList_ or
_srs-ResourceSetToAddModListDCI-0-2_ with higher layer parameter _usage_ in
_SRS-ResourceSet_ set to \'noncodebook\', the actual number of UL PT-RS
port(s) to transmit corresponding to each SRS resource set is determined based
on SRI(s) corresponding to the associated SRS resource set or higher layer
parameter _sri-ResourceIndicator or sri-ResourceIndicator2_ corresponding to
the associated SRS resource set in _rrc-ConfiguredUplinkGrant_. A UE is
configured with the PT-RS port index for each configured SRS resource by the
higher layer parameter _ptrs-PortIndex_ configured by _SRS-Config_ if the UE
is configured with the higher layer parameter _phaseTrackingRS in DMRS-
UplinkConfig_. If the PT-RS port index associated with different SRIs are the
same, the corresponding UL DM-RS ports are associated to the one UL PT-RS
port.
When the higher layer parameter _multipanelScheme_ is set to 'sdmscheme' and
two SRS resource sets are configured in _srs-ResourceSetToAddModList_ or _srs-
ResourceSetToAddModListDCI-0-2_ with higher layer parameter _usage_ in _SRS-
ResourceSet_ set to \'codebook\'/'nonCodebook' and higher layer parameter
_maxNrofPortsforSDM_ in _PTRS-UplinkConfig set to n2_ , the actual number of
UL PT-RS port(s) to transmit corresponding to SRS resource sets is _2_.
When the higher layer parameter _multipanelScheme_ is set to 'SFNscheme' and
two SRS resource sets are configured in _srs-ResourceSetToAddModList_ or _srs-
ResourceSetToAddModListDCI-0-2_ with higher layer parameter _usage_ in _SRS-
ResourceSet_ set to \'codebook\'/'nonCodebook' and the higher layer parameter
_maxNrofPorts_ in _PTRS-UplinkConfig_ is _set to n2,_ the actual number of UL
PT-RS port(s) to transmit corresponding to each SRS resource set is determined
based on 1st TPMI codepoint field for 'codebook' or 1^st^ SRI(s) codepoint
field for 'nonCodebook'.
For partial-coherent and non-coherent codebook-based UL transmission, the
actual number of UL PT-RS port(s) is determined based on TPMI(s) and/or number
of layers which are indicated by \'_Precoding information and number of
layers\'_ field(s) in DCI format 0_1, 0_2 or 0_3 or configured by higher layer
parameter _precodingAndNumberOfLayers_ :
\- if the UE is configured with the higher layer parameter _maxNrofPorts_ in
_PTRS-UplinkConfig_ set to \'n2\', the actual UL PT-RS port(s) and the
associated transmission layer(s) are derived from indicated TPMI(s) as:
\- PUSCH antenna port 1000 and 1002 in indicated TPMI(s) share PT-RS port 0,
and PUSCH antenna port 1001 and 1003 in indicated TPMI(s) share PT-RS port 1.
> \- UL PT-RS port 0 is associated with the UL layer \'x\' of layers which are
> transmitted with PUSCH antenna port 1000 and PUSCH antenna port 1002 in
> indicated TPMI(s), and UL PT-RS port 1 is associated with the UL layer \'y\'
> of layers which are transmitted with PUSCH antenna port 1001 and PUSCH
> antenna port 1003 in indicated TPMI(s), where \'x\' and/or \'y\' are given
> by DCI parameter \'_PTRS-DMRS association\'_ as shown in DCI format 0_1, 0_2
> and 0_3 described in Clause 7.3.1 of [5, TS38.212].
If a UE is scheduled with two codewords,
\- if the UE is configured with the higher layer parameter _maxNrofPorts_ in
_PTRS-UplinkConfig_ set to \'n1\', the PT-RS port is associated with the one
of DM-RS ports indicated by DCI field _PTRS-DMRS association_ for the codeword
with the higher MCS. If the MCS indices of the two codewords are the same, the
PT-RS antenna port is associated with codeword 0. When a codeword is scheduled
to transmit PUSCH for retransmission, the MCS for determining PT-RS
association to codeword is obtained from the DCI for the same transport block
in the initial transmission.
\- if the UE is configured with the higher layer parameter _maxNrofPorts_ in
_PTRS-UplinkConfig_ set to \'n2\', each PT-RS port is associated with the one
of DM-RS pors indicated by DCI field PTRS-DMRS association. [PUSCH antenna
port 1000, 1001, 1004 and 1005 share PT-RS port 0, and PUSCH antenna port
1002, 1003, 1006 and 1007 share PT-RS port 1.]
When the UE is scheduled with _Q~p~_ ={1,2} PT-RS port(s) in uplink and the
number of scheduled layers is ,
\- If the UE is configured with higher layer parameter _ptrs-Power_ , the
PUSCH to PT-RS power ratio per layer per RE is given by , where is shown in
the Table 6.2.3.1-3 and Table 6.2.3.1-3A according to the higher layer
parameter _ptrs-Power_ , the PT-RS scaling factor specified in clause
6.4.1.2.2.1 of [4, TS 38.211] is given by and also on the \'_Precoding
Information and Number of Layers\'_ field in DCI.
\- The UE shall assume _ptrs-Power_ in _PTRS-UplinkConfig_ is set to state
\"00\" in Table 6.2.3.1-3 if not configured or in case of non-codebook based
PUSCH.
\- For partial coherent codebook for 8TX PUSCH transmission, _L~x~_ is the
number of PUSCH layers in the antenna group which are precoded coherently with
the PUSCH layer/DM-RS port that PT-RS port x is associated with, and _Q~p~_ is
the number of PT-RS ports scheduled to the UE.
Table 6.2.3.1-3: Factor related to PUSCH to PT-RS power ratio per layer per RE
other than 8TX PUSCH transmission
_UL-PTRS-power /_ The number of PUSCH layers ( )
* * *
                      1           2                                3                                                  4                                                                                                     
                      All cases   Full coherent                    Partial and non- coherent and non-codebook based   Full coherent   Partial and non- coherent and non-codebook based   Full coherent   Partial coherent   Non-coherent and non-codebook based
00 0 3 3 _Q~p~_ -3 4.77 3 _Q~p~_ -3 6 3 _Q~p~_ 3 _Q~p~_ -3 01 0 3 3 4.77 4.77
6 6 6 10 Reserved  
11 Reserved
Table 6.2.3.1-3A: Factor related to PUSCH to PT-RS power ratio per layer per
RE {width="0.5027777777777778in" height="0.20833333333333334in"} for 8TX PUSCH
transmission
**_UL-PTRS-power /_** **The number of PUSCH layers (**
$\mathbf{n}_{\mathbf{\text{layer}}}^{\mathbf{\text{PUSCH}}}$**)**
* * *
                          **1-8**                                                                                                                                                                                                                                     
                          Full coherent                                                                                                         Partial coherent                                                                                                      Non-coherent and non-codebook based
00 $$\mathbf{10}\mathbf{\log}_{\mathbf{10}}\left(
\mathbf{n}_{\mathbf{\text{layer}}}^{\mathbf{\text{PUSCH}}} \right)$$
$$\mathbf{10}\mathbf{\log}_{\mathbf{10}}\left(
\mathbf{L}_{\mathbf{x}}\mathbf{Q}_{\mathbf{p}} \right)$$
$$\mathbf{10}\mathbf{\log}_{\mathbf{10}}\left( \mathbf{Q}_{\mathbf{p}}
\right)$$ 01 $$\mathbf{10}\mathbf{\log}_{\mathbf{10}}\left(
\mathbf{n}_{\mathbf{\text{layer}}}^{\mathbf{\text{PUSCH}}} \right)$$
$$\mathbf{10}\mathbf{\log}_{\mathbf{10}}\left(
\mathbf{n}_{\mathbf{\text{layer}}}^{\mathbf{\text{PUSCH}}} \right)$$
$$\mathbf{10}\mathbf{\log}_{\mathbf{10}}\left(
\mathbf{n}_{\mathbf{\text{layer}}}^{\mathbf{\text{PUSCH}}} \right)$$ 10
Reserved  
11 Reserved
#### 6.2.3.2 UE PT-RS transmission procedure when transform precoding is
enabled
When transform precoding is enabled and if a UE is configured with the higher
layer parameter _transformPrecoderEnabled_ in _PTRS-UplinkConfig,_
\- the UE shall be configured with the higher layer parameters _sampleDensity_
and the UE shall assume the PT-RS antenna ports\' presence and PT-RS group
pattern are a function of the corresponding scheduled bandwidth in a
corresponding bandwidth part, as shown in Table 6.2.3.2-1. The UE shall assume
no PT-RS is present when the number of scheduled RBs is less than N~RB0~ if
N~RB0~ > 1 or if the RNTI equals TC-RNTI.
\- and the UE may be configured PT-RS time density _L~PT-RS~_ = 2 with the
higher layer parameter _timeDensityTransformPrecoding._ Otherwise, the UE
shall assume _L~PT-RS~_ = 1.
\- if the higher layer parameter _sampleDensity_ indicates that the sample
density thresholds _N~RB,i~_ = _N~RB,i+1~_ , then the associated row where
both these thresholds appear in Table 6.2.3.2-1 is disabled.
Table 6.2.3.2-1: PT-RS group pattern as a function of scheduled bandwidth
+------------------------------+------------------------+-------------------+ | Scheduled bandwidth | Number of PT-RS groups | Number of samples | | | | | | | | per PT-RS group | +==============================+========================+===================+ | _N~RB0~ N~RB~_ \ 1$. For $\mu = 0$,
the UE expects the number of RBs within a RB set is between 100 and 110. For
$\mu = 1$, the UE expects the number of RBs within a RB set is between 50 and
55 except for at most one RB set which may contain 56 RBs.
# 8 Physical sidelink shared channel related procedures
A UE can be configured by higher layers with one or more sidelink resource
pools. A sidelink resource pool can be for transmission of PSSCH, as described
in Clause 8.1, and/or SL PRS, as described in Clause 8.2.4, or for reception
of PSSCH, as described in Clause 8.3, and/or SL PRS, as described in Clause
8.4.4, and can be associated with either sidelink resource allocation mode 1
or sidelink resource allocation mode 2.
A sidelink resource pool which can be used for transmission of both SL PRS and
PSSCH will be referred to as shared resource pool.
A sidelink resource pool which can be used for transmission of SL PRS and
cannot be used for transmission of PSSCH will be referred to as dedicated SL
PRS resource pool.
In the frequency domain,
\- If the higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is
not provided, or it is set to 'contiguousRB\', a sidelink resource pool
consists of _sl-NumSubchannel_ contiguous sub-channels. A sub-channel consists
of _sl-SubchannelSize_ contiguous PRBs, where _sl-NumSubchannel_ and _sl-
SubchannelSize_ are higher layer parameters.
\- If the higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is
set to 'interlaceRB', in the frequency domain, a sidelink resource pool
consists of sl-NumSubchannel sub-channels, where each sub-channel consists of
_numInterlacePerSubchannel_ interlaces having contiguous interlace indices.
For operation with shared spectrum channel access for frequency range 1, a
sidelink resource pool can be (pre-)configured to include integer number of RB
sets. A UE can be configured with intra-cell guard bands according to the
higher layer parameter _intraCellGuardBandsSL-List_. The configured intra-cell
guard band PRBs between any two adjacent RB sets can be used only for PSSCH
transmission, if and only if, the UE has successfully performed channel access
procedure in both adjacent RB sets, and the UE uses both of these RB sets for
PSSCH transmission.The set of slots that may belong to a sidelink resource
pool is denoted by $(t_{0}^{\text{SL}},t_{1}^{\text{SL}},\cdots,t_{T_{\max} -
1}^{\text{SL}})$ where
\- ${0 \leq t}_{i}^{\text{SL}}  A UE is not expected to receive an SCI indicating $28 \leq I_{\text{MCS}}
> \leq 31$ if Table 5.1.3.1-2 is used, or $29 \leq I_{\text{MCS}} \leq 31$
> otherwise.
### 8.1.4 UE procedure for determining the subset of resources to be reported
to higher layers in PSSCH resource selection in sidelink resource allocation
mode 2
In resource allocation mode 2, the higher layer can request the UE to
determine a subset of resources from which the higher layer will select
resources for PSSCH/PSCCH transmission. To trigger this procedure, in slot
_n,_ the higher layer provides the following parameters for this PSSCH/PSCCH
transmission:
\- the resource pool from which the resources are to be reported;
\- L1 priority, $\text{pri}o_{\text{TX}}$;
\- the remaining packet delay budget;
\- If the higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is
not provided, the number of sub-channels to be used for the PSSCH/PSCCH
transmission in a slot is $L_{\text{subCH}}$. If the higher layer parameter
_transmissionStructureForPSCCHandPSSCH_ is set to 'contiguousRB\',
$L_{\text{subCH}}$ _corresponds to_ the number of sub-channels within all used
RB sets to be used for the PSCCH/PSSCH transmission in a slot. I _f_ the
higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is set to
'interlaceRB', $L_{\text{subCH}}$ _corresponds to_ the number of sub-channels
to be used for the PSSCH/PSCCH transmission in a slot in each RB set,
\- I _f_ the higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is
set to 'interlaceRB', the number of used RB sets for one PSCCH/PSSCH
transmission, L~RBset~.
\- optionally, the number of consecutive slots for Multi-consecutive slots
transmission, $N_{\text{slot},\text{MCSt}}$.
\- the number of sub-channels to be used for the PSSCH/PSCCH transmission in a
slot, $L_{\text{subCH}}$;
\- optionally, the resource reservation interval, $P_{\text{rsvp_TX}}$, in
units of msec.
\- if the higher layer requests the UE to determine a subset of resources from
which the higher layer will select resources for PSSCH/PSCCH transmission as
part of re-evaluation or pre-emption procedure, the higher layer provides a
set of resources $(r_{0},r_{1},r_{2},\ldots)\ $which may be subject to re-
evaluation and a set of resources $(r_{0}^{'},r_{1}^{'},r_{2}^{'},\ldots)\
$which may be subject to pre-emption.
\- it is up to UE implementation to determine the subset of resources as
requested by higher layers before or after the slot $r_{i}^{''}$ - $T_{3}$,
where $r_{i}^{''}$ is the slot with the smallest slot index among
$(r_{0},r_{1},r_{2},\ldots)\ $and $(r_{0}^{'},r_{1}^{'},r_{2}^{'},\ldots)\ $,
and $T_{3}$ is equal to $T_{proc,1}^{\text{SL}}$, _where_
$T_{proc,1}^{\text{SL}}\ $_is defined in slots in Table 8.1.4-2 where_
$\mu_{\text{SL}}$ _is the SCS configuration of the SL BWP._
\- Optionally, the indication of resource selection mechanism.
\- Optionally, _rbSetsWithConsecutiveLBTFailure_ , which indicates the RB sets
where consistent LBT failure has been indicated.
\- $N_{\text{slot,MCSt}}$_,_ which indicates the number of consecutive slots
for MCSt.
The following higher layer parameters affect this procedure:
_\- sl-SelectionWindowList:_ internal parameter $T_{2min}$ is set to the
corresponding value from higher layer parameter _sl-SelectionWindowList_ for
the given value of $\text{pri}o_{\text{TX}}$.
_\- sl-Thres-RSRP-List_ : this higher layer parameter provides an RSRP
threshold for each combination $\left( p_{i},\, p_{j} \right)$, where $p_{i}$
is the value of the priority field in a received SCI format 1-A and $p_{j}$ is
the priority of the transmission of the UE selecting resources; for a given
invocation of this procedure, $p_{j}\ = \ \text{pri}o_{\text{TX}}$.
_\- sl-RS-ForSensing_ selects if the UE uses the PSSCH-RSRP or PSCCH-RSRP
measurement, as defined in clause 8.4.2.1.
_\- sl-ResourceReservePeriodList_
_\- sl-SensingWindow_ : internal parameter $T_{0}$ is defined as the number of
slots corresponding to _sl-SensingWindow_ msec
_\- sl-TxPercentageList: internal parameter_ $X$ _for a given_
$\text{pri}o_{\text{TX}}$ _is defined as sl-TxPercentageList (_
$\text{pri}o_{\text{TX}}$_) converted from percentage to ratio_
_\- sl-PreemptionEnable: if sl-PreemptionEnable is provided, and if it is not
equal to \'enabled\', internal parameter_ $\text{pri}o_{\text{pre}}$ _is set
to the higher layer provided parameter sl-PreemptionEnable._
\- Optionally, minimum number of _Y_ slots as $Y_{\min}$ (_sl_
-_MinNumCandidateSlotsPeriodic_), which indicates the minimum number of _Y_
slots that are included in the candidate resources corresponding to periodic-
based partial sensing and contiguous partial sensing for resource
(re)selection triggered by periodic transmission ($P_{\text{rsvp_TX}} \neq
0$).
\- Optionally, minimum number of $Y'$ slots as ${Y'}_{\text{min\ }\ }$ (_sl_
-_MinNumCandidateSlotsAperiodic_), which indicates the minimum number of $Y'$
slots that are included in the candidate resources corresponding to periodic-
based partial sensing and/or contiguous partial sensing results (if available)
for resource (re)selection triggered by aperiodic transmission
($P_{\text{rsvp_TX}} = 0$).
\- Optionally, sensing occasion as _sl-PBPS-OccasionReservePeriodList,_ which
indicates the subset of periodicity values from _sl-ResourceReservePeriodList_
used to determine periodic sensing occasions in periodic-based partial
sensing. If not configured, all periodicity values from _sl-
ResourceReservePeriodList_ are used to determine periodic sensing occasions in
periodic-based partial sensing.
\- Optionally, additional sensing occasions as _sl-Additional-PBPS-Occasion_ ,
which indicates that UE additionally monitors periodic sensing occasions that
correspond to a set of values. The possible values of the set at least
includes the most recent sensing occasion before the first slot of the
candidate slots for a given reservation periodicity and the last periodic
sensing occasion prior to the most recent one for the given reservation
periodicity. If not (pre-)configured, the UE monitors the most recent sensing
occasion before the first slot of the candidate slots for the given
periodicity used to determine periodic sensing occasions in periodic-based
partial sensing.
> \- Optionally, _indication of the size in logical slots of contiguous
> partial sensing window for periodic transmissions as defined by the
> parameter sl-CPS-WindowPeriodic._
>
> Optionally, indication of the size in logical slots of contiguous partial
> sensing window for aperiodic transmissions as _defined by the parameter_
> _sl-CPS-WindowAperiodic._
>
> \- Optionally, _indication of whether UE is required to perform SL reception
> of PSCCH and RSRP measurement for partial sensing on slots in SL DRX
> inactive time as sl-PartialSensingInactiveTime._
>
> In case of dynamic co-channel coexistence of LTE sidelink and NR sidelink,
> that is coexistence over time and frequency resources that are shared
> between NR sidelink and LTE sidelink:
\- _sl-NRPSSCH-EUTRA-ThresRSRP-List_ : this higher layer parameter provides an
RSRP threshold for each combination $\left( p_{i},\, p_{j} \right)$, where
$p_{i}$ is the value of the priority field in a received LTE SCI format 1, and
$p_{j}$ is the priority of the transmission of the UE selecting resources; for
a given invocation of this procedure, $p_{j}\ = \ \text{pri}o_{\text{TX}}$.
\- _sl-NRPSFCH-EUTRA-ThresRSRP-List_ : this higher layer parameter, if
provided, provides an RSRP threshold for each combination $\left( p_{i},\,
p_{j} \right)$, where $p_{i}$ is the value of the priority field in a received
LTE SCI format 1, and $p_{j}$ is the priority of the transmission of the UE
selecting resources; for a given invocation of this procedure, $p_{j}\ = \
\text{pri}o_{\text{TX}}$.
The resource reservation interval, $P_{\text{rsvp_TX}}$, if provided, is
converted from units of msec to units of logical slots, resulting in
$P_{\text{rsvp}\text{_}\text{TX}}^{'}$ according to clause 8.1.7.
When the resource pool is (pre-)configured with _sl-
AllowedResourceSelectionConfig_ including full sensing, and full sensing is
configured in the UE by higher layers, the UE performs full sensing.
When periodic reservation for another TB (_sl-MultiReserveResource_) is
enabled for the resource pool, the resource pool is (pre-)configured with _sl-
AllowedResourceSelectionConfig_ including partial sensing, and partial sensing
is configured by higher layer, the UE performs periodic-based partial sensing,
unless other conditions state otherwise in the specification.
When a UE is triggered by higher layer to report resources for resource
(re-)selection in a mode 2 Tx pool, the resource pool is (pre-)configured with
_sl-AllowedResourceSelectionConfig_ including partial sensing, and partial
sensing is configured by higher layer, the UE performs contiguous partial
sensing, unless stated otherwise in the specification.
Notation:
$\left( {t'}_{0}^{\text{SL}},\ {t'}_{1}^{\text{SL}},\
{t'}_{2}^{\text{SL}},\ldots \right)$ denotes the set of slots which belongs to
the sidelink resource pool and is defined in Clause 8.
For dynamic co-channel coexistence of LTE sidelink and NR sidelink, $\left(
t_{0}^{\text{LTESL}},t_{1}^{\text{LTESL}},\ldots,t_{T_{\max} -
1}^{\text{LTESL}} \right)$ denotes the set of subframes that may belong to an
LTE sidelink resource pool as defined in clause 14.1.5 of [19, TS36.213].
The following steps are used:
1) If a number of consecutive slots $N_{\text{slot},\text{MCSt}}\ $is provided
with a value larger than 1, the candidate multi-slot resource definition is
applied. Otherwise, the candidate single-slot resource definition is applied.
> If the higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is set
> to 'contiguousRB\', a candidate multi-slot resource $R_{\text{x,y}}$ is
> defined as a set of $L_{\text{subCH}}$ contiguous sub-channels starting from
> sub-channel $x$ in $N_{slot,MCSt}$ consecutive slots starting from slot
> ${t'}_{y}^{\text{SL}}$.
>
> If the higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is set
> to 'interlaceRB', a candidate multi-slot resource $R_{\text{x,y,z}}$ is
> defined as a set of $L_{\text{subCH}}$ contiguous sub-channels starting from
> sub-channel $x$ in $N_{slot,MCSt}$ consecutive slots starting from slot
> ${t'}_{y}^{\text{SL}}$ in $L_{\text{RBset}}$ contiguous RB sets starting
> from RB set z.
>
> _If the higher layer parameter transmissionStructureForPSCCHandPSSCH is not
> provided,_ a candidate single-slot resource for transmission
> $R_{\text{x,y}}$ is defined as a set of $L_{\text{subCH}}$ contiguous sub-
> channels with sub-channel _x+j_ in slot ${t'}_{y}^{\text{SL}}$ where $j =
> 0,...,L_{\text{subCH}} - 1$. The UE shall assume that any set of
> $L_{\text{subCH}}$ contiguous sub-channels or $L_{\text{subCH}}$ _contiguous
> sub-channels_ in $L_{\text{RBset}}$ contiguous RB sets included in the
> corresponding resource pool within the time interval $\lbrack n + T_{1},n +
> T_{2}\rbrack$ correspond to one candidate single-slot resource for UE
> performing full sensing, in a set of _Y_ candidate slots within the time
> interval $\left\lbrack n + T_{1},n + T_{2} \right\rbrack$ correspond to one
> candidate single-slot resource or one candidate multi-slot resource for UE
> performing periodic-based partial sensing together with contiguous partial
> sensing and resource (re)selection triggered by periodic transmission
> ($P_{\text{rsvp_TX}} \neq 0$), or in a set of _Y\'_ candidate slots within
> the time interval $\lbrack n + T_{1},n + T_{2}\rbrack$ correspond to one
> candidate single-slot resource for UE performing at least contiguous partial
> sensing and resource (re)selection triggered by aperiodic transmission
> ($P_{\text{rsvp_TX}} = 0$), where
\- selection of $T_{1}$ is up to UE implementation under $0\ \leq \ T_{1}
\leq$ $T_{proc,1}^{\text{SL}}\ $ , where $T_{proc,1}^{\text{SL}}\ $ is defined
in slots in Table 8.1.4-2 where $\mu_{\text{SL}}$ is the SCS configuration of
the SL BWP;
\- if $\text{\ T}_{2min}$ is shorter than the remaining packet delay budget
(in slots) then $T_{2}\ $is up to UE implementation subject to $T_{2min}\ \leq
\ T_{2}$ $\leq$ remaining packet delay budget (in slots); otherwise $T_{2}\
$is set to the remaining packet delay budget (in slots).
\- $Y$ is selected by UE where $Y \geq Y_{\min}$.
\- $Y'$ is selected by UE where $Y' \geq Y_{\min}^{'}$. When the UE performs
at least contiguous partial sensing and if $P_{\text{rsvp_TX}} = 0$, the UE
selects a set of $Y'$ candidate slots with corresponding PBPS and/or CPS
results (if available). If the number of candidate slots $Y'$ is smaller than
$Y_{\min}^{'}$, it is up to UE implementation to include other candidate
slots.
> If the higher layer parameter _transmissionStructureForPSCCHandPSSCH_ is set
> to 'contiguousRB\', the UE shall exclude candidate single-slot or candidate
> multi-slot resources with the lowest sub-channel including resource blocks
> of the intra-cell guardband PRBs, configured by higher layer parameter,
> _intraCellGuardBandsSL-List_.
>
> The total number of remaining candidate single-slot resources or candidate
> multi-slot resources is denoted by $M_{\text{total}}$.
2) The sensing window is defined by the range of slots [$n\,
–T_{0},n–T_{\text{proc},0}^{\text{SL}}$), when the UE performs full sensing,
where $T_{0}$ is defined above and $T_{\text{proc},0}^{\text{SL}}$ is defined
in slots in Table 8.1.4-1 where $\mu_{\text{SL}}$ is the SCS configuration of
the SL BWP. The UE shall monitor slots which belongs to a sidelink resource
pool within the sensing window except for those in which its own transmissions
occur. The UE shall perform the behaviour in the following steps based on
PSCCH decoded and RSRP measured in these slots.
When the UE performs periodic-based partial sensing, the UE shall monitor
slots at $t_{y - k \times P_{\text{reserve}}^{'}}^{'\text{SL}}$, where
${t'}_{y}^{\text{SL}}$ is a slot of the selected candidate slots and
$P_{\text{reserve}}^{'}$ is $P_{\text{reserve}}$ converted to units of logical
slot according to clause 8.1.7. The UE shall perform the behaviour in the
following steps based on PSCCH decoded and RSRP measured in these slots.
The value of $P_{\text{reserve}}$ corresponds to _sl-PBPS-
OccasionReservePeriodList_ if (pre-)configured, otherwise, the values
correspond to all periodicity from _sl-ResourceReservePeriodList._
The UE monitors sensing occasion(s) determined by _sl-Additional-PBPS-
Occasion_ , as previously described, and not earlier than $n\, –T_{0}$. For a
given periodicity $P_{\text{reserve}}$, the values of _k_ correspond to the
most recent sensing occasion earlier than ${t'}_{y0}^{\text{SL}} -
{(T}_{proc,0}^{\text{SL}} + T_{proc,1}^{\text{SL}}\ )\ $if _sl-Additional-
PBPS-Occasion_ is not (pre-)configured, and additionally includes the value of
_k_ corresponding to the last periodic sensing occasion prior to the most
recent one if _sl-Additional-PBPS-Occasion_ is (pre-)configured.
${t'}_{y0}^{\text{SL}}$ is the first slot of the selected _Y_ candidate slots
of PBPS.
When the UE performs periodic-based partial sensing and contiguous partial
sensing with periodic reservation for another TB (_sl-MultiReserveResource_)
enabled and $P_{\text{rsvp_TX}} \neq 0$, the contiguous partial sensing window
is defined by the range of slots $\lbrack n + T_{A},\ n + T_{B}\rbrack$. _n_
+_T_ ~A~ is _M_ consecutive logical slots earlier than slot
${t'}_{y0}^{\text{SL}}$, and _n_ +_T_ ~B~ is $T_{proc,0}^{\text{SL}} +
T_{proc,1}^{\text{SL}}$ slots earlier than ${t'}_{y0}^{\text{SL}}$, where
${t'}_{y0}^{\text{SL}}$ is the first slot of the selected _Y_ candidate slots
of PBPS, and $T_{proc,0}^{\text{SL}}$, $T_{proc,1}^{\text{SL}}$ are in units
of physical time/slots. The value of _M_ is (pre-)configured with the _sl-CPS-
WindowPeriodic_. The UE shall perform the behaviour in the following steps
based on PSCCH decoded and RSRP measured in these slots. If _sl-CPS-
WindowPeriodic_ is not (pre-)configured, _M_ equals to 31.
When the UE performs at least contiguous partial sensing and if
$P_{\text{rsvp_TX}} = 0$, the contiguous partial sensing window is defined by
the range of slots $\lbrack n + T_{A},\ n + T_{B}\rbrack$. $T_{A}$ and $T_{B}$
are both selected such that the UE has sensing results starting at least _M_
consecutive logical slots before ${t'}_{y0}^{\text{SL}}$ and ending at
$T_{proc,0}^{\text{SL}} + T_{proc,1}^{\text{SL}}$ slots earlier than
${t'}_{y0}^{\text{SL}}$, where ${t'}_{y0}^{\text{SL}}$ is the first slot of
the selected $Y'$candidate slots. The value of _M_ is (pre-)configured with
the _sl-CPS-WindowAperiodic_. The UE shall perform the behaviour in the
following steps based on PSCCH decoded and RSRP measured in these slots. If
_sl-CPS-WindowAperiodic_ is not (pre-)configured, _M_ equals to 31. When the
minimum _M_ slots for CPS cannot be guaranteed and when $P_{\text{rsvp_TX}} =
0$, it is up to UE implementation to either continue with step 3) or perform
random selection.
Whether the UE is required to performs SL reception of PSCCH and RSRP
measurement for partial sensing on slots in SL DRX inactive time is
enabled/disabled by higher layer parameter _sl-PartialSensingInactiveTime._
When it is enabled, if UE performs periodic-based partial sensing on the slots
in SL DRX inactive time for a given periodicity corresponding to
$P_{\text{reserve}}$, UE monitors only the default periodic sensing occasions
(most recent sensing occasion) from the slots; if UE performs contiguous
partial sensing on the slots in SL DRX inactive time, UE monitors a minimum of
_M_ slots from the slots.
2LTE) In case of dynamic co-channel coexistence of LTE sidelink and NR
sidelink: The [LTE sensing window is defined by] the range of LTE subframes
[$n_{\text{LTE}}\, –T_{\text{start}},n_{\text{LTE}}–T_{\text{end}}$], where
$n_{\text{LTE}}\ $is the LTE subframe in which this procedure is triggered and
which overlaps slot _n_ , $T_{\text{start}}$ is 1100 msec and $T_{\text{end}}$
is up to UE implementation under $T_{\text{end}} \leq \
T_{\text{proc},2}^{\text{SL}}$; $T_{\text{proc},2}^{\text{SL}}$is 4+T msec,
where T ≤ 4 msec. The UE shall perform the procedures in 5LTE3 and 6LTE based
on PSCCH decoded and RSRP measured in these LTE subframes.
3) The internal parameter $Th(p_{i},p_{j})\ $ is set to the corresponding
value of RSRP threshold indicated by the _i_ -th field in _sl-Thres-RSRP-List_
, where $i = p_{i} + \left( p_{j} - 1 \right)*8$.
3LTE) In case of dynamic co-channel coexistence of LTE sidelink and NR
sidelink:
\- The internal parameter $T\text{hLTE}\left( p_{i},p_{j} \right)$ is set to
the corresponding value of RSRP threshold indicated by the _i_ -th field in
_sl-NRPSSCH-EUTRA-ThresRSRP-List_ , where $i = p_{i} + \left( p_{j} - 1
\right)*8$.
\- The internal parameter $T\text{hLTEPSFCH}\left( p_{i},p_{j} \right)$ is set
to the corresponding value of RSRP threshold indicated by the _i_ -th field in
_sl-NRPSFCH-EUTRA-ThresRSRP-List_ , if provided, where $i = p_{i} + \left(
p_{j} - 1 \right)_8$. If_ sl-NRPSFCH-EUTRA-ThresRSRP-List* is not provided
then each element of $T\text{hLTEPSFCH}\left( p_{i},p_{j} \right)$ is set to
minus Infinity dBm.
4) The set $S_{A}$ is initialized to the set of all the candidate single-slot
resources or candidate multi-slot resources.
5) The UE shall exclude any candidate single-slot resource $R_{x,y}$ or
$R_{\text{x,y,z}}$, or _candidate multi-slot resource_ $R_{\text{x,y}}$ or
$R_{\text{x,y,z}}$ from the set $S_{A}$ if it meets all the following
conditions:
\- the UE has not monitored slot ${t^{'}}_{m}^{\text{SL}}$ in Step 2.
\- for any periodicity value allowed by the higher layer parameter _sl-
ResourceReservePeriodList_ and a hypothetical SCI format 1-A received in slot
${t^{'}}_{m}^{\text{SL}}$ with \'_Resource reservation period_ \' field set to
that periodicity value and indicating all subchannels of the resource pool in
this slot, condition c in step 6 would be met.
5LTE1) In case of dynamic co-channel coexistence of LTE sidelink and NR
sidelink: The UE shall exclude any candidate single-slot resource
$R_{\text{x,y}}$ from the set $S_{A}$ if all the following conditions are met:
\- the resource pool overlaps with an LTE sidelink resource pool;
\- the UE has not monitored LTE subframe $t_{m}^{\text{LTESL}}$ .
\- for any periodicity value allowed by the LTE higher layer parameter
_restrictResourceReservationPeriod_ and a hypothetical LTE SCI format 1
received in LTE subframe $t_{m}^{\text{LTESL}}$ with \'_Resource reservation'_
field set to that periodicity value and indicating all subchannels of the LTE
sidelink resource pool in this LTE subframe, condition c in step 6LTE would be
met.
5LTE2) In case of dynamic co-channel coexistence of LTE sidelink and NR
sidelink: The UE shall exclude any candidate single-slot resource $R_{x,y}$
from the set $S_{A}$ if all the following conditions are met:
\- the UE has a selected sidelink grant for LTE V2X according to [19, TS
36.321] .
\- the selected sidelink grant for LTE V2X determines the set of LTE resource
blocks and LTE subframes which overlaps in time with $R_{x,y + j \times
P_{\text{rsv}p_{\text{TX}}}^{'}}$ for _j=_ 0, 1, ..., $C_{\text{resel}} - 1$;
\- the priority value associated with the selected sidelink grant for LTE V2X
is lower than $\text{pri}o_{\text{TX}}$; It is up to UE implementation whether
or not to apply this exclusion step if the priority value associated with
selected sidelink grant for LTE V2X is higher than or equal to
$\text{pri}o_{\text{TX}}$.
5LTE3) In case of dynamic co-channel coexistence of LTE sidelink and NR
sidelink: The UE shall exclude any candidate single-slot resource $R_{x,y}$
from the set $S_{A}$ if all the following conditions are met:
a) the resource pool is configured with PSFCH resources;
b) an LTE SCI format 1 is received in LTE subframe $t_{m}^{\text{LTESL}}$, and
the \'_Resource reservation\'_ field and \'_Priority_ \' field in the received
LTE SCI format 1 indicate the values $P_{\text{rsvp_RX}}$ and
$\text{pri}o_{\text{RX}}$, respectively according to Clause 14.2.1 in [19, TS
36.213], where LTE subframes are indexed according to Clause 14.1.5 in [19, TS
36.213];
c) the LTE PSSCH-RSRP measurement according to the received LTE SCI format 1
is higher than $T\text{hLTEPSFCH}\left(
\text{pri}o_{\text{RX}},prio_{\text{TX}} \right);$
d) the SCI format received in LTE subframe $t_{m}^{\text{LTESL}}\ $or the same
SCI format which is assumed to be received in LTE subframe(s) $t_{m + q \times
P_{\text{rsvp}\text{_}\text{RX}}^{'}}^{\text{LTESL}}$ determines according to
clause 14.1.1.4C or clause 14.2.4 in [19, TS 36.213] the set of LTE subframes
which overlaps with PSFCH slots associated with $R_{x,y + j \times
P_{\text{rsv}p_{\text{TX}}}^{'}}$ for _q_ =1, 2, ..., _Q_ and _j=_ 0, 1, ...,
$C_{\text{resel}} - 1\ ,\ $where the PSFCH association is according to [6, TS
38.213]. $P_{\text{rsv}p_{\text{TX}}}^{'}\ $and _Q_ are determined as in
condition c) of step 6LTE.
5a) If the number of candidate single-slot resources $R_{\text{x,y}}$ or
$R_{\text{x,y,z}}$, or the number of _candidate multi-slot resource_
$R_{\text{x,y}}$ or $R_{\text{x,y,z}}$ remaining in the set $S_{A}$ is smaller
than $X \cdot M_{\text{total}}$, the set $S_{A}$ is initialized to the set of
all the candidate single-slot resources as in step 4.
6) The UE shall exclude any candidate single-slot resource $R_{x,y}$ or
$R_{\text{x,y,z}}$, or _candidate multi-slot resource_ $R_{\text{x,y}}$ or
$R_{\text{x,y,z}}$ from the set $S_{A}$ if it meets all the following
conditions:
a) the UE receives an SCI format 1-A in slot ${t'}_{m}^{\text{SL}}$, and
\'_Resource reservation period\'_ field, if present, and \'_Priority_ \' field
in the received SCI format 1-A indicate the values $P_{\text{rsvp_RX}}$ and
$\text{pri}o_{\text{RX}}$, respectively according to Clause 16.4 in [6, TS
38.213];
b) the RSRP measurement performed, according to clause 8.4.2.1 for the
received SCI format 1-A, is higher than $Th\left(
\text{pri}o_{\text{RX}},prio_{\text{TX}} \right);$
c) the SCI format received in slot ${t'}_{m}^{\text{SL}}\ $or the same SCI
format which, if and only if the \'_Resource reservation period_ \' field is
present in the received SCI format 1-A, is assumed to be received in slot(s)
${t'}_{m + q \times P_{\text{rsvp}\text{_}\text{RX}}^{'}}^{\text{SL}}$
determines according to clause 8.1.5 the set of resource blocks and slots
which overlaps with $R_{x,y + j \times P_{rsvp_ TX}^{'}}$ for _q_ =1, 2, ...,
_Q_ and _j=_ 0, 1, ..., $C_{\text{resel}} - 1$. Here,
$P_{\text{rsvp}\text{_}\text{RX}}^{'}$ is $P_{\text{rsvp_RX}}$ converted to
units of logical slots according to clause 8.1.7, $Q = \left\lceil
\frac{T_{\text{scal}}}{P_{\text{rsvp}\text{_}\text{RX}}} \right\rceil\ $ if
$P_{rsvp_ RX}  7) If the number of candidate single-slot resources or candidate multi-slot
> resources remaining in the set $S_{A}$ is smaller than $X \cdot
> M_{\text{total}}$, then $Th\left( p_{i},p_{j} \right)$ [ and
> $T\text{hLTE}\left( p_{i},p_{j} \right)$, if set, ] is increased by 3 dB for
> each priority value $\left( p_{i},p_{j} \right)$ and the procedure continues
> with step 4.
>
> 7a) If sidelink DRX active time of RX UE is provided by the higher layer and
> there is no candidate single-slot or multi-slot resource remained within the
> sidelink DRX active time in the set $S_{A}$, the UE based on its
> implementation additionally selects and includes at least one candidate
> single-slot resources within the sidelink DRX active time in the set
> $S_{A}$.
The UE shall report set $S_{A}$ to higher layers.
If a resource $r_{i}$ from the set $(r_{0},r_{1},r_{2},\ldots)$ is not a
member of $S_{A}$, then the UE shall report re-evaluation of the resource
$r_{i}$ to higher layers.
If a resource $r_{i}^{'}$ from the set
$(r_{0}^{'},r_{1}^{'},r_{2}^{'},\ldots)$ meets the conditions below then the
UE shall report pre-emption of the resource $r_{i}^{'}$ to higher layers.
\- $r_{i}^{'}$ is not a member of $S_{A}$, and
\- $r_{i}^{'}$ meets the conditions for exclusion in step 6, with $Th\left(
\text{pri}o_{\text{RX}},prio_{\text{TX}} \right)$ set to the final threshold
after executing steps 1)-7), i.e. including all necessary increments for
reaching $X \cdot M_{\text{total}}$, and
\- the associated priority $\text{pri}o_{\text{RX}},$ satisfies one of the
following conditions:
\- _sl-PreemptionEnable_ is provided and is equal to \'enabled\' and
$\text{pri}o_{\text{TX}} > \text{pri}o_{\text{RX}}$
\- _sl-PreemptionEnable_ is provided and is not equal to \'enabled\', and
$\text{pri}o_{\text{RX}}  \text{pri}o_{\text{RX}}$
Table 8.1.4-1: $\mathbf{T}_{\mathbf{proc,0}}^{\mathbf{\text{SL}}}$ depending
on sub-carrier spacing
$$\mathbf{\mu}_{\mathbf{\text{SL}}}$$
$\mathbf{T}_{\mathbf{proc,0}}^{\mathbf{\text{SL}}}$ **[slots]**
* * *
0 1 1 1 2 2 3 4
Table 8.1.4-2: $\mathbf{T}_{\mathbf{proc,1}}^{\mathbf{\text{SL}}}$ depending
on sub-carrier spacing
$$\mathbf{\mu}_{\mathbf{\text{SL}}}$$
$\mathbf{T}_{\mathbf{proc,1}}^{\mathbf{\text{SL}}}$ **[slots]**
* * *
0 3 1 5 2 9 3 17
When the UE performs periodic-based partial sensing and contiguous partial
sensing, and when the UE is triggered to perform re-evaluation and/or pre-
emption checking, and if $P_{\text{rsvp_TX}} \neq 0$,
\- During the _q_ ^th^ reservation period (_q_ =0,1,2,..., _Cresel_ -1),
candidate resource set (_S~A~_) is initialized to the remaining _Y_ candidate
slots starting from slot ${t'}_{\text{yi}}^{\text{SL}}$ and ending at the last
slot of the _Y_ candidate slots, where the slot indices of the remaining _Y_
candidate slots are equal to ${t'}_{y + q \times
P_{\text{rsvp}\text{_}\text{TX}}^{'}}^{\text{SL}}$, where
${t'}_{y}^{\text{SL}}$ is a slot index of _Y_ candidate slots used in the
initial resource (re)selection.
_-_ ${t'}_{\text{yi}}^{\text{SL}}$ is the first candidate slot starting from
slot _n+T~3~_.
\- The UE performs PBPS for the remaining _Y_ candidate slots according to
$t_{y' - k \times P_{\text{reserve}}^{'}}^{'\text{SL}}$ except for those in
which its own transmissions occur, where${t'}_{\mathbf{y'}}^{\text{SL}}$ is a
slot belonging to the remaining _Y_ candidate slots, and  _k_ and _P~reserve~_
are the same as resource (re)selection, where the values _of k_ correspond to
the most recent sensing occasion earlier than ${t'}_{\text{yi}}^{\text{SL}} -
{(T}_{\text{proc},0}^{\text{SL}} + T_{\text{proc},1}^{\text{SL}}\ )\ $if _sl-
Additional-PBPS-Occasion_ is not (pre-)configured, and additionally includes
the value of _k_ corresponding to the last periodic sensing occasion prior to
the most recent one if _sl-Additional-PBPS-Occasion_ is (pre-)configured.
\- The UE performs CPS starting from _M_ logical slots earlier than
${t'}_{\text{yi}}^{\text{SL}}$ to $T_{proc,0}^{\text{SL}} +
T_{proc,1}^{\text{SL}}$ slots earlier than ${t'}_{\text{yi}}^{\text{SL}}$
except for those in which its own transmissions occur.
\- By default, _M_ is 31 unless (pre-)configured with another value by _sl-
CPS-WindowPeriodic_.
When the UE is triggered to perform re-evaluation and/or pre-emption checking,
performs at least contiguous partial sensing, and if $P_{\text{rsvp_TX}} = 0$,
\- Candidate resource set (_S~A~_) is initialized to the remaining _Y\'_
candidate slots starting from slot ${t'}_{\text{yi}}^{\text{SL}}$ and ending
at the last slot of the _Y\'_ candidate slots, where
${t'}_{\text{yi}}^{\text{SL}}$ is the first candidate slot starting from slot
_n+T~3~_.
\- It is up to UE implementation that UE may perform PBPS for periodic sensing
occasions after the resource (re)selection when higher layer parameter _sl-
MultiReserveResource_ is enabled.
\- UE performs CPS starting from at least _M_ consecutive logical slots
earlier than ${t'}_{\text{yi}}^{\text{SL}}$_to_ $T_{proc,0}^{\text{SL}} +
T_{proc,1}^{\text{SL}}$ _slots earlier than_ ${t'}_{\text{yi}}^{\text{SL}}$
except for those in which its own transmissions occur.
\- For minimum size _M_ of the contiguous partial sensing window $\lbrack n +
T_{A},\ n + T_{B}\rbrack$, by default, _M_ is 31 unless (pre-)configured with
another value, by _sl-CPS-WindowAperiodic_.
When the minimum _M_ slots for CPS cannot be guaranteed, UE senses in all
available slots starting from the resource (re)selection trigger slot of the
same TB to $T_{proc,0}^{\text{SL}} + T_{proc,1}^{\text{SL}}$ slots earlier
than ${t'}_{\text{yi}}^{\text{SL}}$. The UE re-evaluation and pre-emption
checking is based on all available sensing results after $n\, –T_{0}$.
### 8.1.4A UE procedure for determining a set of preferred or non-preferred
resources for another UE\'s transmission
When this procedure is triggered, the following parameters are provided by the
higher layer:
\- the resource pool from which the preferred or non-preferred resources are
to be determined;
\- the resource selection window $\lbrack n + T_{1},n + T_{2}\rbrack$ within
which the preferred or non-preferred resources are to be determined;
\- the resource set type (either preferred or non-preferred resource set);
\- if the resource set type indicates preferred set, then the higher layer
additionally provides the following parameters:
\- L1 priority, $\text{pri}o_{\text{TX}}$;
\- the number of sub-channels to be used for the PSSCH/PSCCH transmission in a
slot, $L_{\text{subCH}}$;
\- the resource reservation period, $P_{\text{rsvp_TX}}$, if present.
The value of $C_{\text{resel}}$ is determined by the UE according to clause
8.1.5.
When this procedure is triggered by another UE\'s explicit request, the fields
in the request are interpreted as follows:
> \- The field \'Resource selection window location\' is the concatenation of
> the starting time location and the ending time location of the resource
> selection window. The starting and ending time locations of the resource
> selection window are each encoded in the same way as the reference slot as
> described in clause 8.1.5A.
>
> \- The field \'Resource reservation period\' is encoded in the same way as
> the field of the same name in SCI format 1-A.
When determining a preferred resource set, the UE applies the procedure
described in clause 8.1.4 with the above parameters and the following
modifications:
\- Step 6a) The UE excludes candidate single-slot resource(s) belonging to
slot(s) where the UE does not expect to perform SL reception of a TB due to
half-duplex operation, if all the following conditions are met:
\- the UE is a destination UE of the TB for whose transmission the preferred
resource set is being determined;
\- the higher layer parameter _sl-Condition1-A-2_ is not set to \'Disabled\'.
When determining a non-preferred resource set, the UE considers any
resource(s) within the resource selection window, if indicated by a received
explicit request, and satisfying at least one of the following conditions as
non-preferred resource(s):
\- resource(s) indicated by a received [SCI format 1-A], satisfying at least
one of the following criteria:
\- the RSRP measurement performed, according to clause 8.4.2.1, for the
received [SCI format 1-A], is higher than $\text{Th}\left(
\text{pri}o_{\text{RX}} \right)$ where $\text{pri}o_{\text{RX}}$ is the value
of the priority field in the received [SCI format 1-A]. The internal parameter
$Th(p_{i})$ is set to the corresponding value of RSRP threshold indicated by
the _k_ -th field in _sl-ThresholdRSRP-Condition1-B-1-Option1List_ , where $k
= p_{i}$.
\- the UE is a destination UE of a TB associated with the received [SCI format
1-A] and the RSRP measurement performed, according to clause 8.4.2.1 for the
received [SCI format 1-A], is lower than $Th'\left( \text{pri}o_{\text{RX}}
\right)$ where $\text{pri}o_{\text{RX}}$ is the value of the priority field in
the received [SCI format 1-A]. The internal parameter $Th'(p_{i})$ is set to
the corresponding value of RSRP threshold indicated by the _k_ -th field in
_sl-ThresholdRSRP-Condition1-B-1-Option2List_ , where $k = p_{i}$.
\- resources(s) in slot(s) in which the UE does not expect to perform SL
reception due to half duplex operation, if the UE is a destination UE of a TB
for whose transmission the non-preferred resource set is being determined.
### 8.1.4B Void
### 8.1.4C UE procedure for using a received non-preferred resource set
A UE configured with the higher layer parameter _sl-InterUE-
CoordinationScheme1_ uses a received non-preferred resource set as follows
when performing resource (re-)selection:
\- the UE excludes in Step 6b) of clause 8.1.4 resource(s) overlapping with
the non-preferred resource set.
If it is not possible to meet the requirement that the number of candidate
single-slot resources remaining in the set $S_{A}$ be at least $X \cdot
M_{\text{total}}$ after excluding resource(s) overlapping with the received
non-preferred resource set, it is up to UE implementation whether or not to
take into account the received non-preferred resource set to meet such
requirement.
The UE is not required to use any resource from the non-preferred resource set
in its resource (re-)selection if that resource is earlier than
($T_{proc,0}^{\text{SL}}$+ $T_{proc,1}^{\text{SL}}$+ $T_{proc,2}^{\text{SL}}$)
after the resource of inter-UE coordination information transmission, where
$T_{proc,2}^{\text{SL}}$ is equal to ($T_{proc,0}^{\text{SL}}$+
$T_{proc,1}^{\text{SL}}$) when only MAC CE is used for inter-UE coordination
information transmission, or $T_{proc,2}^{\text{SL}}$ is equal to
$T_{proc,0}^{\text{SL}}$ when MAC CE and SCI format 2-C are both used for
inter-UE coordination information transmission.
The case when $T_{proc,2}^{\text{SL}}$ is equal to $T_{proc,0}^{\text{SL}}$ is
assuming that SCI format 2-C is received.
### 8.1.5 UE procedure for determining slots and resource blocks for PSSCH
transmission associated with an SCI format 1-A
The set of slots and resource blocks for PSSCH transmission is determined by
the resource used for the PSCCH transmission containing the associated SCI
format 1-A, and fields \'_Frequency resource assignment_ \', \'_Time resource
assignment_ \' of the associated SCI format 1-A as described below.
\'_Time resource assignment_ \' carries logical slot offset indication of N =
1 or 2 actual resources when _sl-MaxNumPerReserve_ is 2, and N = 1 or 2 or 3
actual resources when _sl-MaxNumPerReserve_ is 3, in a form of time RIV (TRIV)
field which is determined as follows:
if $N = 1$
$\text{TRIV} = 0$
elseif $N = 2$
$\text{TRIV} = t_{1}$
else
if $\left( t_{2} - t_{1} - 1 \right) \leq 15$
$\text{TRIV} = 30\left( t_{2} - t_{1} - 1 \right) + t_{1} + 31$
else
$\text{TRIV} = 30\left( 31 - t_{2} + t_{1} \right) + 62 - t_{1}$
end if
end if
where the first resource is in the slot where SCI format 1-A was received, and
$t_{i}$ denotes i-th resource time offset in logical slots of a resource pool
with respect to the first resource where for N = 2, $1 \leq t_{1} \leq 31$;
and for N = 3, $1 \leq t_{1} \leq 30$, $t_{1}  1$ _is
indicated by a slot offset_ $t_{m}$ _in logical slots with respect to the
reference slot_ $t_{\text{ref}}$; the slot offset $t_{m}$ is indicated by the
\'first resource location\' field; the first resource location of
$\text{TRIV}_{1}$ is at slot offset 0 with respect to the reference slot.
\- \"the received SCI format 1-A, except the resource in the slot where SCI
format 1-A was received\" is replaced by \"each tuple\"
\- the starting sub-channel $n_{subCH,0}^{\text{start}}$ of the first resource
of each tuple is separately indicated.
The starting sub-channel $n_{subCH,0}^{\text{start}}$ of the first resource of
each tuple is indicated by the \'Lowest subChannel indices\' field. The
resource reservation period $P_{rsvp,m}$ is encoded as in SCI format 1-A.
If the set is indicated by an SCI format 2-C, the number of tuples is $M = 2$.
A UE forms the union of the subsets indicated by each tuple
$(\text{TRIV}_{m},\text{FRIV}_{m},P_{rsvp,m})$ to obtain the set $\left{
r_{0},r_{1},r_{2},\ldots \right}$.
### 8.1.6 Sidelink congestion control in sidelink resource allocation mode 2
If a UE is configured with higher layer parameter _sl-CR-Limit_ and transmits
PSSCH in slot _n_ , the UE shall ensure the following limits for any priority
value k;
$\sum_{i \geq k}^{}{\text{CR}\left( i \right)} \leq CR_{\text{Limit}}\left( k
\right)$
where $\text{CR}\left( i \right)$ is the CR evaluated in slot _n_ -_N_ for the
PSSCH transmissions with \'_Priority_ \' field in the SCI set to _i_ , and
$CR_{\text{Limit}}\left( k \right)$ corresponds to the high layer parameter
_sl-CR-Limit_ that is associated with the priority value _k_ and the CBR range
which includes the CBR measured in slot _n_ -_N_ , where _N_ is the congestion
control processing time.
The congestion control processing time _N_ is based on µ of Table 8.1.6-1 and
Table 8.1.6-2 for UE processing capability 1 and 2 respectively, where µ
corresponds to the subcarrier spacing of the sidelink channel with which the
PSSCH is to be transmitted. A UE shall only apply a single processing time
capability in sidelink congestion control.
Table 8.1.6-1: Congestion control processing time for processing timing
capability 1
**µ** Congestion control processing time N [slots]
* * *
0 2 1 2 2 4 3 8
Table 8.1.6-2: Congestion control processing time for processing timing
capability 2
**µ** Congestion control processing time N [slots]
* * *
0 2 1 4 2 8 3 16
It is up to UE implementation how to meet the above limits, including dropping
the transmissions in slot _n_.
### 8.1.7 UE procedure for determining the number of logical slots for a
reservation period
A given resource reservation period $P_{\text{rsvp}}$ in milliseconds is
converted to a period $P_{\text{rsvp}}^{'}$ in logical slots as:
$$P_{\text{rsvp}}^{'} = \left\lceil \frac{{T'}_{\max}\ }{10240\ ms} \times
P_{\text{rsvp}} \right\rceil$$
where ${T'}_{\max}$ is the number of slots that belong to a resource pool as
defined in Clause 8.
## 8.2 UE procedure for transmitting sidelink reference signals
### 8.2.1 CSI-RS transmission procedure
A UE transmits sidelink CSI-RS within a unicast PSSCH transmission if the
following conditions hold:
\- CSI reporting is enabled by higher layer parameter _sl-CSI-Acquisition_ ;
and
\- the \'_CSI request_ \' field in the corresponding SCI format 2-A or 2-C is
set to 1.
The following parameters for CSI-RS transmission are configured for each CSI-
RS configuration:
\- _sl-CSI-RS-FirstSymbol_ indicates the first OFDM symbol in a PRB used for
SL CSI-RS
\- _sl-CSI-RS-FreqAllocation_ indicates the number of antenna ports and the
frequency domain allocation for SL CSI-RS.
When the UE is configured with _Q~p~_ ={1,2} CSI-RS port(s) in sidelink and
the number of scheduled layers is $n_{\text{layer}}^{\text{PSSCH}}$,
\- The CSI-RS scaling factor $\beta_{\text{CSIRS}}$ specified in clause
8.4.1.5.3 of [4, TS 38.211] is given by $\beta_{\text{CSIRS}} =
\beta_{\text{DMRS}}^{\text{PSSCH}} \bullet
\sqrt{\frac{n_{\text{layer}}^{\text{PSSCH}}}{Q_{p}}}\ $ where
$\beta_{\text{DMRS}}^{\text{PSSCH}}$ is the scaling factor for the
corresponding PSSCH specified in clause 8.3.1.5 of [4, TS 38.211].
### 8.2.2 PSSCH DM-RS transmission procedure
The UE selects the DM-RS time domain pattern out of the patterns configured
using the higher layer parameter _sl-PSSCH-DMRS-TimePatternList_ for the
resource pool on which the PSSCH is to be transmitted. If more than one DM-RS
time domain pattern is configured, the selected pattern is indicated by the
\'_DMRS pattern\'_ field in the SCI format 1-A associated with the PSSCH
transmission.
If PSSCH DM-RS and PSCCH are mapped to the same OFDM symbol, then this mapping
within a single sub-channel is only supported if higher layer parameter _sl-
SubchannelSize_ >= 20, i.e. the sub-channel size is at least 20 PRBs.
When a sub-channel size is less than 20 PRBs and the size of PSCCH is less
than the sub-channel size, a UE is not expected to choose a PSSCH DM-RS
pattern to be transmitted in the same OFDM symbol with PSCCH.
### 8.2.3 PT-RS transmission procedure
Transmission of PT-RS is only supported in frequency range 2.
The UE PT-RS transmission procedure specified in clause 6.2.3.1 applies for
derivation of the PT-RS parameters _L~PT-RS~_ and _~,~ K~PT-RS\ ~_ and for
determination of PT-RS presence, with the following changes:
\- _timeDensity_ and _frequencyDensity_ in _PTRS-UplinkConfig_ are replaced by
_sl-PTRS-TimeDensity_ and _sl-PTRS-FreqDensity_ in _SL-PTRS-Config_
respectively, and _SL-PTRS-Config_ is (pre)configured per resource pool;
\- the number of antenna ports is the same as the number of PSSCH DM-RS
antenna ports and the association between a PT-RS antenna port and a PSSCH DM-
RS antenna port is fixed.
### 8.2.4 SL PRS transmission procedure
The following parameters for SL PRS transmission are associated with each SL
PRS resource:
\- [_SL PRS resource ID_] indicates an identity of a SL PRS resource. The SL
PRS resource is identified by the SL PRS resource ID that is unique within a
slot of a dedicated SL PRS resource pool. For a shared resource pool, _a SL
PRS resource is uniquely identified by a combination of the SL PRS resource ID
and a SL PRS frequency domain allocation within a slot._
\- _[SL PRS comb offset and comb size] indicates a comb offset and a comb size
of the SL PRS resource_
\- _[Starting symbol and the number of SL PRS symbols] indicates the starting
symbol index within a slot and the number of symbols of the SL PRS resource._
\- [_SL PRS frequency domain allocation_] _indicates the frequency location
[and the number of resource blocks for SL PRS transmission in a shared
resource pool.]_
Each SL PRS transmission is associated with an PSCCH transmission in the same
slot.
In the case of dedicated pool for SL positioning, that PSCCH carries the SCI
format 1-B associated with the SL PRS transmission.
The UE may report the association information of the already transmitted SL
PRS resources with UE Tx ARP ID.
#### 8.2.4.1 Resource allocation
In sidelink resource allocation mode 1:
\- For SL PRS transmission, a UE may be configured with dynamic grant,
configured grant type 1, or configured grant type 2
##### 8.2.4.1.1 Resource allocation in time domain
The UE shall transmit the SL PRS in the same slot as the associated PSCCH.
The UE shall transmit the SL PRS in consecutive symbols within the slot.
A UE does not transmit multiple SL PRS resources in the same slot.
For a shared resource pool, the UE transmits the SL PRS in PSSCH symbols
according to clause 8.1.2.1, [with the following restrictions:
\- the number of contiguous symbols for SL PRS transmission, 'M', shall
correspond to one of the SL PRS resources in parameter.
\- the UE shall not transmit SL PRS in symbols where associated PSCCH is
transmitted.
\- the UE shall not transmit SL PRS and PSSCH DMRS in the same symbol.
\- the UE shall transmit SL PRS on contiguous symbols either in between or
after symbols where PSSCH DMRS is transmitted.
\- the UE shall transmit SL PRS only after the last symbol with second stage
SCI.
\- For a given value of 'M', SL PRS resource is mapped to the last consecutive
'M' SL symbols in the slot that meet all the other restrictions
\- The UE shall not transmit PSSCH and SL PRS in the same symbol.]
A SL-PRS resource and PSFCH (including the preceding gap symbol) are not
mapped on the same symbols
For a dedicated resource pool, the UE transmits SL PRS subject to the
following restrictions:
\- the UE shall not transmit SL PRS and associated PSCCH in the same symbol;
\- the number of contiguous symbols and the starting symbol for SL PRS
transmission shall correspond to one of the SL PRS resources in parameter [].
In sidelink resource allocation mode 1 for a shared resource pool, the time
domain behaviour for sidelink dynamic grants and sidelink configured grants
for SL PRS follows the behaviour in clause 8.1.2.1.
In sidelink resource allocation mode 1 for a dedicated resource pool, the time
domain behaviour for sidelink dynamic grants and sidelink configured grants
for SL PRS follows the behaviour in clause 8.1.2.1, with the following
modifications:
\- [\"DCI format 3_0\" is replaced by \"DCI format 3_2\"].
\- \"PSSCH\" is replaced by \"SL PRS\".
##### 8.2.4.1.2 Resource allocation in frequency domain
For a shared resource pool, the frequency domain resource assignment of a SL
PRS resource is the same as PSSCH in the same slot.
For a dedicated resource pool, the frequency domain resource assignment of a
SL PRS resource is same as frequency resources of a resource pool.
#### 8.2.4.2 UE procedure for determining the subset of resources to be
reported to higher layers in SL PRS resource selection in a dedicated resource
pool in sidelink resource allocation mode 2
In resource allocation mode 2 in a dedicated resource pool, the higher layer
can request the UE to determine a subset of resources from which the higher
layer will select resources for SL PRS[/PSCCH] transmission. To trigger this
procedure, in slot _n,_ the higher layer provides the following parameters for
this SL PRS[/PSCCH] transmission:
\- the resource pool from which the resources are to be reported;
\- L1 priority, $\text{pri}o_{\text{TX}}$;
\- the remaining [delay budget];
\- Set of SL-PRS resource ID(s);
\- optionally, the resource reservation interval, $P_{\text{rsvp_TX}}$, in
units of msec.
\- if the higher layer requests the UE to determine a subset of resources from
which the higher layer will select resources for SL PRS[/PSCCH] transmission
as part of re-evaluation or pre-emption procedure, the higher layer provides a
set of resources $(r_{0},r_{1},r_{2},\ldots)\ $which may be subject to re-
evaluation and a set of resources $(r_{0}^{'},r_{1}^{'},r_{2}^{'},\ldots)\
$which may be subject to pre-emption.
\- it is up to UE implementation to determine the subset of resources as
requested by higher layers before or after the slot $r_{i}^{''}$ - $T_{3}$,
where $r_{i}^{''}$ is the slot with the smallest slot index among
$(r_{0},r_{1},r_{2},\ldots)\ $and $(r_{0}^{'},r_{1}^{'},r_{2}^{'},\ldots)\ $,
and $T_{3}$ is equal to $T_{proc,1}^{\text{SL}}$, _where_
$T_{proc,1}^{\text{SL}}\ $_is defined in slots in Table 8.1.4-2 where_
$\mu_{\text{SL}}$ _is the SCS configuration of the SL BWP._
The following higher layer parameters affect this procedure:
_\- [sl-SelectionWindowList:_ internal parameter $T_{2min}$ is set to the
corresponding value from higher layer parameter _sl-SelectionWindowList_ for
the given value of $\text{pri}o_{\text{TX}}$.]
_\- [sl-Thres-RSRP-List]_ : this higher layer parameter provides an RSRP
threshold for each combination $\left( p_{i},\, p_{j} \right)$, where $p_{i}$
is the value of the priority field in a received SCI format 1-B and $p_{j}$ is
the priority of the transmission of the UE selecting resources; for a given
invocation of this procedure, $p_{j}\ = \ \text{pri}o_{\text{TX}}$.
_\- [reservationPeriodAllowed-Dedicated-SL-PRS-RP]_
_\- [sl-SensingWindow]_ : internal parameter $T_{0}$ is defined as the number
of slots corresponding to _sl-SensingWindow_ msec
_\- [sl-TxPercentageLis]: internal parameter_ $X$ _for a given_
$\text{pri}o_{\text{TX}}$ _is defined as sl-TxPercentageList (_
$\text{pri}o_{\text{TX}}$_) converted from percentage to ratio_
_\- [sl-PreemptionEnable]: if sl-PreemptionEnable is provided, and if it is
not equal to \'enabled\', internal parameter_ $\text{pri}o_{\text{pre}}$ _is
set to the higher layer provided parameter sl-PreemptionEnable._
The UE shall perform this procedure according to clause 8.1.4, with the
following modifications:
\- Partial sensing is not applicable in a dedicated SL PRS resource pool;
\- A candidate single-slot resource for transmission $R_{\text{x,}\text{y}}$
is defined as the SL PRS resource with index $\text{x}$ within the Set of SL-
PRS resource ID(s) provided by the higher layer and in slot
${t'}_{y}^{\text{SL}}$
\- \"SCI format 1-A" is replaced by "SCI format 1-B\",
\- In step 5 []
\- In condition b of step 6, the RSRP measurement is the PSCCH-RSRP over the
DM-RS resource elements of the PSSCH;
\- In condition c of step 6 \"determines according to clause 8.1.5 the set of
resource blocks and slots\" is replaced by \"determines according to clause
8.2.4.X the set of slots and SL PRS resources\".
#### 8.2.4.2 UE procedure for determining slots and SL PRS resource(s)
associated with an SCI format 1-B in a dedicated resource pool
The set of slots and SL PRS resources for SL PRS transmission is determined by
the PSCCH containing the associated SCI format 1-B, and fields \'[_SL-PRS
resource ID (s))_ \', \'[_Time resource assignment]_ \' of the associated SCI
format 1-B as described below.
The set of slots is determined as in clause 8.1.5, with the following
modifications:
\- \"SCI format 1-A\" is replaced by \"SCI format 1-B\",
\- [ potential parameter name changes].
The first SL PRS resource is determined according to the sub-channel used for
the PSCCH transmission containing the associated SCI format 1-B: The index of
the sub-channel in the resource pool is identical to the index of the SL PRS
resource provided by [higher layer parameter].
If [_sl-MaxNumPerReserve]_ is 2 then the index of the second SL PRS resource
is indicated by the field [Resource ID indication].
[ If [_sl-MaxNumPerReserve] is_ 3 then the index of the second / third SL PRS
resource is indicated by the field [ Resource ID indication].]
If TRIV determined according to clause 8.1.5 indicates _N_ \ where is a vector of PSSCH symbols from the layer mapping defined in Clause
> 8.3.1.4 of [4, TS 38.211], $P \in \left\lbrack 1,2 \right\rbrack$ is the
> number of CSI-RS ports. If only one CSI-RS port is configured, _W(i)_ is 1.
> Otherwise, _W(i)_ is the identity matrix _._
### 8.5.3 CSI reporting
The UE can be configured with one CSI reporting latency bound as indicated by
the higher layer parameter _sl-LatencyBoundCSI-Report_. CSI reporting is
aperiodic and is described in [10, TS 38.321].
## 8.6 UE PSSCH preparation procedure time
For sidelink dynamic grant and for SL configured grant type 2 activation, if
the first sidelink symbol in the sidelink allocation for a PSSCH for a
transport block and the associated PSCCH, including the DM-RS and the
duplicated symbol, as defined by the slot offset $K_{\text{SL}}$ of the
scheduling DCI for dynamic grant or the activating DCI for SL configured grant
type 2, is no earlier than at symbol _L_ , where _L_ is defined as the next
sidelink symbol with its CP starting $T_{\text{proc}} = (N_{2} + d_{2,1})(2048
+ 144) \cdot \kappa 2^{- \mu} \cdot T_{C}$ after the end of the reception of
the last symbol of the PDCCH carrying the DCI scheduling the sidelink
transmissions for dynamic grant or activating the SL configured grant type 2,
then the UE shall transmit the PSSCH and the associated PSCCH.
_\- N~2~_ is based on _µ_ of Table 8.6-1, where _µ_ corresponds to the one of
(_µ~DL~_ , _µ~SL~_) resulting with the largest _T~proc~_ , where the _µ~DL~_
corresponds to the subcarrier spacing of the downlink with which the PDCCH
carrying the DCI scheduling the PSSCH for dynamic grant or activating the SL
configured grant type 2 was transmitted and _µ~SL~_ corresponds to the
subcarrier spacing of the sidelink channel with which the PSSCH and the
associated PSCCH are to be transmitted, and _κ_ is defined in Clause 4.1 of
[4, TS 38.211].
\- _d~2,1\ ~_ = 1.
Otherwise the UE may ignore the scheduling DCI for dynamic grant or the
activating DCI for SL configured grant type 2.
The value of $T_{\text{proc}}$ is used both in the case of normal and extended
cyclic prefix.
Table 8.6-1: PSSCH preparation time
      PSSCH preparation time *N~2~* \[symbols\]
* * *
0 10 1 12 2 23 3 36
For sidelink resource allocation mode 1, the UE does not expect that the first
sidelink symbol in the sidelink allocation for a PSSCH for retransmission of a
transport block and the associated PSCCH, including the DM-RS and the
duplicated symbol as defined by the \"Time resource assignment\" field of the
corresponding DCI for dynamic grant or for SL configured grant type 2, or by
_sl-TimeResourceCG-Type1_ for configured grant type 1 starts earlier than at
symbol $L$ where $L$ is defined as the next sidelink symbol with its CP
starting $T_{\text{prep}} + \delta$ after the end of the last symbol of the
PSFCH occasion corresponding to the most recent transmission of PSSCH for the
same transport block, where $T_{\text{prep}}$ is defined in Clause 16.5 of [6,
TS 38.213] and $\delta = {5 \bullet 10}^{- 4}\text{\ s}$. Otherwise the UE may
skip the retransmission of the PSSCH and the transmission of the corresponding
PSCCH.
# 9 UE procedures for transmitting and receiving for RTT-based propagation
delay compensation
For operation with RTT-based propagation delay compensation, the UE may be
configured with either:
_\- one CSI-RS for tracking with higher layer parameter pdc-Info for Rx \-- Tx
time difference estimation at UE side and one SRS resource set with usage-PDC_
, or
_\- one PRS configuration of higher layer parameter nr-DL-PRS-PDC-ResourceSet
[12, TS 38.331] for Rx -- Tx time difference estimation at UE side and one SRS
resource set with usage-PDC._
The related UE procedures for transmitting uplink reference signals and
receiving downlink reference signals for RTT-based propagation delay
compensation are defined as follows:
_-_ for reception of CSI-RS for tracking with higher layer parameter _pdc-
Info, the UE follows the procedures for reception of CSI-RS for tracking
defined in Clause 5.1.6.1.1._
_-_ for reception of the one PRS configuration provided by RRC _[12, TS
38.331] for RTT-based propagation delay compensation, the UE follows the
procedure for PRS reception for RTT-based propagation delay compensation
defined in Clause 9.1._
_-_ for transmission of an SRS resource set configured with _usage-PDC, the UE
follows the procedures for SRS transmission defined in Clause 6.2.1._
## 9.1 PRS reception procedure for RTT-based propagation delay compensation
The DL PRS resource set for RTT-based propagation delay compensation consists
of K≥1 DL PRS resource(s) where each has an associated spatial transmission
filter. Each DL PRS resource is configured via higher layer parameters _NR-DL-
PRS-Resource and is uniquely_ defined by _nr-DL-PRS-ResourceID_. The
subcarrier spacing and the cyclic prefix of the DL PRS resources are defined
by the subcarrier spacing and the cyclic prefix of the DL active bandwidth
part of the serving cell.
The DL PRS resource set for RTT-based propagation delay compensation is
configured by _nr-DL-PRS-PDC-ResourceSet_ , consists of one or more DL PRS
resource(s) and it is defined by:
_\- periodicityAndOffset_ defines the DL PRS resource periodicity and takes
values $T_{\text{per}}^{\text{PRS}} \in 2^{\mu}\left{ 4,\ 5,\ 8,\ 10,\ 16,\
20,\ 32,\ 40,\ 64,\ 80,\ 160,\ 320,\ 640,\ 1280,\ 2560,\ 5120,\ 10240 \right}\
$slots, where $\mu = 0,\ 1,\ 2,\ 3\ $for 15, 30, 60 and 120 kHz subcarrier
spacing respectively and the slot offset for DL PRS resource set with respect
to SFN0 slot 0. All the DL PRS resources are configured with the same DL PRS
resource periodicity.
_\- repetitionFactor_ defines how many times each DL-PRS resource is repeated
for a single instance of the DL-PRS resource set and takes values
$T_{\text{rep}}^{\text{PRS}} \in \left{ 1,2,4,6,8,16,32 \right}$. All the DL
PRS resources within the resource set have the same resource repetition
factor.
_\- timeGap_ defines the offset in number of slots between two repeated
instances of a DL PRS resource with the same _nr-DL-PRS-ResourceID_ within a
single instance of the DL PRS resource set. The UE only expects to be
configured with _timeGap_ if _repetitionFactor_ is configured with value
greater than 1. The time duration spanned by one instance of a _nr-DL-PRS-
ResourceSet_ is not expected to exceed the configured value of DL PRS
periodicity. All the DL PRS resources within the resource set have the same
value of _timeGap._
_\- resourceList_ determines the DL PRS resources that are contained within
the DL PRS resource set.
_\- dl-PRS-ResourceBandwidth_ defines the number of resource blocks configured
for DL PRS transmission. The parameter has a granularity of 4 PRBs with a
minimum of 24 PRBs and a maximum of 272 PRBs. All the DL PRS resources within
the resource set have the same value of _dl-PRS-ResourceBandwidth._
_\- dl-PRS-StartPRB_ defines the starting PRB index of the DL PRS resource
with respect to subcarrier 0 in common resource block 0. The starting PRB
index has a granularity of one PRB with a minimum value of 0 and a maximum
value of 2176 PRBs. All the DL PRS resources within the resource set have the
same value of _dl-PRS-StartPRB._
_\- numSymbols_ defines the number of symbols of the DL PRS resource within a
slot where the allowable values are given in Clause 7.4.1.7.3 of [4,
TS38.211]. All the DL PRS resources within the resource set have the same
value of _numSymbols._
A DL PRS resource is defined by:
_\- nr-DL-PRS-ResourceID_ determines the DL PRS resource configuration
identity. All DL PRS resource IDs are locally defined within the DL PRS
resource set.
_\- dl-PRS-SequenceID_ is used to initialize c~init~ value used in pseudo
random generator as described in Clause 7.4.1.7.2 of [4, TS 38.211] for
generation of DL PRS sequence for a given DL PRS resource.
_\- dl-PRS-CombSizeN-AndReOffset_ defines the comb size of a DL PRS resource,
where the allowable values are given in Clause 7.4.1.7.3 of [TS38.211], and
the starting RE offset of the first symbol within a DL PRS resource in
frequency. The UE may expect the same comb size to be configured for all DL
PRS resources of the PRS resource set. The relative RE offsets of the
remaining symbols within a DL PRS resource are defined based on the initial
offset and the rule described in Clause 7.4.1.7.3 of [4, TS 38.211].
_\- dl-PRS-ResourceSlotOffset_ determines the starting slot of the DL PRS
resource with respect to corresponding DL PRS resource set slot offset.
_\- dl-PRS-ResourceSymbolOffset_ determines the starting symbol of a slot
configured with the DL PRS resource.
_\- dl-PRS-QCL-Info_ defines any quasi co-location information of the DL PRS
resource with other reference signals. The DL PRS may be configured with QCL
\'typeD\' with a DL PRS in the same PRS resource set, or with _rs-Type_ set to
\'typeC\', \'typeD\', or \'typeC-plus-typeD\' with a SS/PBCH Block from the
serving cell.
The UE assumes constant EPRE is used for all REs of a given DL PRS resource.
The UE assumes that the DL PRS from the serving cell is not mapped to any
symbol that contains SS/PBCH block from the serving cell.
The UE does not expect to be scheduled or configured for reception of any
downlink channel or any other downlink signal(s) in the OFDM symbol(s) and
PRBs of the DL PRS resource for RTT-based propagation delay compensation to be
received.
The UE is expected to receive the DL PRS for RTT-based propagation delay
compensation only in RRC_CONNECTED state and within the DL active bandwidth
part of the serving cell.
#
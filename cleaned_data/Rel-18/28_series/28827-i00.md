# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
# 1 Scope
The present document studies the potential use cases, requirements, and
solutions for the 5G charging for additional roaming scenarios and actors, in
regards to roaming local break out and home routed and taking the requirements
brought by adoption of GSMA BCE (Billing Charging Evolution), as a replacement
for TAP.
The study will cover and identify gaps for:
\- charging _in the visited MNO network for the purpose of wholesale charging
towards the home MNO_
\- capabilities for _reconciliation of wholesale charging reports from the
visited MNO network with MNO home network information_
\- _charging in the visited MNO network_ and convey it _to the home MNO
network for the purpose of retail charging_
_\- charging in the MNO's network for the purpose of wholesale charging
towards an additional charging model actor e.g. MVNO_
\- _charging in the visited MNO network_ and convey it _to the home MNO's
network for the purpose of home MNO wholesale charging towards an additional
charging model actor e.g. MVNO_
\- _charging in the visited MNO network_ and convey it _to an MVNO hosted by a
home MNO for the purpose of retail charging_
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501:\"System Architecture for the 5G System\".
[3] GSMA TD.201: \"Common Billing and Charging Processes \".
[4] 3GPP TS 32.255:\" Charging management;5G Data connectivity domain
charging; stage 2\".
[5] 3GPP TS 32.256:\" Charging management; 5G connection and mobility domain
charging; Stage 2\".
[6] 3GPP TS 23.502: \"Procedures for the 5G System (5GS)\".
[7] GSMA WA.51: \"5G SA Implementation Guidelines\".
[8] 3GPP TS 32.274: \" Charging management; Short Message Service (SMS)
charging\".
[9] 3GPP TS 32.256: \"Charging management; 5G connection and mobility domain
charging; Stage 2\".
[10] 3GPP TS 23.540: \"5G System: Technical realization of Service Based Short
Message Service \"
[11] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[12] 3GPP TS 32.240: \"Charging management; Charging architecture and
principles".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
**\ :** \.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
BCE Billing and Charging Evolution
CHF Charging Function
HR Home Routed
LBO Local Breakout
SDF Service Data Flow
# 4 Business roles
5G roaming scenarios involves the services or capabilities provided by
multiple actors and entities in the form of following business roles:
> \- Home Mobile Network Operator (home MNO): This is an operator of PLMN
> where the MCC and MNC of the PLMN identity is same as the MCC and MNC of the
> UE's SUPI, , also referred to as HPLMN.
>
> \- Visited Mobile Network Operator (visited MNO): This is an operator of
> PLMN where the MCC and MNC of the PLMN identity is different from the MCC
> and MNC of the UE's SUPI, also referred to as VPLMN
>
> \- Additional actor: This is a retailer or a wholesaler of mobile services
> but does not own licensed radio spectrum, an additional actor that is a
> retailer is often referred to as Mobile Virtual Network Operator (MVNO).
In deployments, there could be scenarios where one or more of the business
roles are supported by a single enterprise, i.e., one enterprise may play a
single business role or multiple business roles. The present document does not
impose any restrictions to the possible deployment scenarios.
There could be various business models in terms of charging for the network
services provided and between the entities being served, for example (but not
limited to):
\- Home MNO charges the subscribers for usage of network services in visited
MNO.
\- Home MNO charges the MVNO for its subscribers' network service usage in
home MNO, or network service usage in visited MNO
\- MVNO charges the subscribers for usage of network services in visited MNO
and/or home MNO.
\- Visited MNO charges home MNO for its subscribers' usage of network services
in visited MNO.
The solutions described in the present TR aim to flexibly support the charging
scenarios without restriction to any specific business model.
# 5 Concepts and overview
## 5.1 General
The 5G charging for additional roaming scenarios and actors includes the
following aspects:
\- HR Roaming (Home Routed), refer to TS 23.501 [2];
\- LBO Roaming (Local Breakout), refer to TS 23.501 [2];
\- BCE (Billing and Charging Evolution), refer to GSMA TD 201 [3].
## 5.2 Home Routed
The 5G System roaming architecture in the case of home routed scenario with
service-based interfaces within the Control Plane, as defined by TS 23.501[2]
Figure 4.2.4-3.
The 5G System roaming architecture in the case of home routed scenario using
the reference point representation, as defined by TS 23.501[2] Figure 4.2.4-6.
## 5.3 Local Breakout
The 5G System roaming architecture with local breakout with service-based
interfaces within the Control Plane as defined by TS 23.501[2] Figure 4.2.4-1.
The 5G System roaming architecture in the case of local break out scenario
using the reference point representation, as specified in TS 23.501 [2] Figure
4.2.4-4.
## 5.4 Billing and Charging Evolution (BCE)
The BCE process is a simplified and flexible optional settlement method,
tailor made for future wholesale roaming settlement needs of operators. The
process is driven by new formats like Usage Data Report, Billing Statement
Report and Detailed Data Record which together build a robust framework for
seamless revenue assurance.
The BCE process is specified in GSMA TD.201 [3] clause 2.2.
The BCE and TAP (Transferred Account Procedures) process will continue to work
in parallel for the foreseeable future.
According to GSMA WA.51 [7]. clause 12, there is no support for 5G SA
Wholesale charging using the legacy TAP process. The operators must support
BCE in order to launch 5G SA roaming and inter-PLMN charging. This document
only considers the requirements from BCE.
# 6 Architecture considerations
## 6.1 Non-roaming reference architecture
Figure 6.1.1 shows the non-roaming 5G system high level architecture in the
service-based representation, as defined in TS 23.501 [3] with SMSF, CEF and
CHF added:
**Figure 6.1-1: Non-roaming 5G system architecture**
## 6.2 Roaming reference architecture
Figure 6.2.1 shows the roaming home routed 5G system high level architecture
in the service-based representation, as defined in TS 23.501 [3] with CHF
added:
**Figure 6.2.1: Roaming home routed 5G system architecture**
Figure 6.2.2 shows the roaming local breakout 5G system high level
architecture in the service-based representation, as defined in TS 23.501 [3]
with CHF added:
**Figure 6.2.2: Roaming local breakout 5G system architecture**
# 7 Charging scenarios and key issues
## 7.1 Charging in visited MNO for wholesale charging towards home MNO
### 7.1.1 Use cases
#### 7.1.1.1 Use case #1a: Visited MNO charging home MNO for 5G data
connectivity provided to the home MNO's subscribers
This use case focuses on visited MNO and home MNO business roles.
A CSC (UE) has a subscription with the home MNO which allows usage of 5G data
connectivity.
The visited MNO to home MNO charging could be based on data volume that the
home MNO UE has used in the visited MNO's.
This use case is applicable for the Home Routed Roaming and Local Breakout
Roaming.
For the Home Routed Roaming using QBC, the visited MNO to home MNO charging
could be based on \"Roaming Charging Profile\", which may be negotiated
between the VPLMN and the HPLMN.
#### 7.1.1.2 Use case #1b: Visited MNO charging home MNO for 5G connection and
mobility provided to the home MNO's CSCs
This use case focuses on visited MNO and home MNO business roles.
A CSC (UE) has a subscription with the home MNO which allows usage of 5G data
connectivity connection and mobility.
The visited MNO to home MNO charging is based on number of home MNO's UEs
(i.e. unique SUPI) connected to the visited MNO's network over a specific
period of time.
#### 7.1.1.3 Use case #1c: Visited MNO charging home MNO for SMS provided to
the home MNO's subscribers
This use case focuses on visited MNO and home MNO business roles.
A CCS (UE) has a subscription with the home MNO which allows usage of SMS over
NAS in 5GS.
The visited MNO to home MNO charging could be based on number of SMS sent or
received by the home MNO UEs served by the visited MNO's network considering
of the following aspects:
> \- RAT type;
>
> \- Location
### 7.1.2 Potential charging requirements
**REQ-CH_VMNO-01:** The charging mechanism in visited MNO should support
charging based on the 5G data connectivity usage for each home MNO.
**REQ-CH_VMNO-02:** The charging mechanism in visited MNO should support
collecting charging information related to 5G data connectivity usage for each
home MNO.
**REQ-CH_VMNO-03:** The charging mechanism in visited MNO should support
charging based on the 5G connection and mobility usage for each home MNO.
**REQ-CH_VMNO-04:** The charging mechanism in visited MNO should support
collecting charging information related to 5G connection and mobility usage
for each home MNO.
**REQ-CH_VMNO-05:** The charging mechanism in visited MNO may support roaming
charging profile negotiation related to 5G data connectivity charging with
each home MNO.
**REQ-CH_VMNO-06:** The charging mechanism in visited MNO should support
charging based on SMS usage for each home MNO.
**REQ-CH_VMNO-07:** The charging mechanism in visited MNO should support
collecting charging information related to SMS usage for each home MNO.
**REQ-CH_VMNO-08:** The charging triggers to be used in visited MNO may be
negotiation with each home MNO.
### 7.1.3 Key issues
The following key issues are identified:
\- **Key Issue #1a** : Aggregation of charging information in visited MNO for
5G data connectivity usage per home MNO.
\- **Key Issue #1b** : Aggregation of charging information in visited MNO for
5G connection and mobility usage per home MNO.
\- **Key Issue #1c** : Aggregation of charging information in visited MNO for
SMS usage per home MNO.
\- **Key Issue #1d** : Whether the FBC should be negotiated between visited
MNO and home MNO. If needed, how to provide the negotiation mechanism for FBC
triggers synchronization, including the charging information and triggers.
\- **Key Issue #1e** : How to handle QoS flow level triggers in relationship
to QFIs.
\- **Key Issue #1f** : How to handle PDU session level triggers when both FBC
and QBC are applicable.
\- **Key Issue #1g** : How to handle charging trigger negotiation between
visited and home MNO.
### 7.1.4 Potential solutions
#### 7.1.4.1 Solution #1.1: CDR in VPLMN for wholesale of 5G data connectivity
##### 7.1.4.1.1 General
A possible solution for key issue 1a and #1g covering requirements REQ-
CH_VMNO-01 and REQ-CH_VMNO-02, wholesale charging for 5G data connectivity
provided to the home MNO by the visited MNO, covering both home routed and
local breakout case.
##### 7.1.4.1.2 Reference architecture
Figure 7.1.4.1.2-1: Roaming 5G data connectivity scenario in service-based
interface representation
Figure 7.1.4.1.2-2: Roaming 5G data connectivity scenario in reference point
representation
The SMF with CTF interact with CHF using Nchf interface. The CDRs produced by
CHF may be sent for interconnect charging (shown as dashed in the figures),
which then can be used to aggregate and calculate the amount of data per home
MNO, the interconnect part is only included for completeness and is currently
outside the scope of 3GPP SA5.
##### 7.1.4.1.3 Message flows
For both home routed roaming and LBO, the flows for 5G data connectivity
charging would be the same as in clause 5.2.2.12 of TS 32.255 [4] with the
difference that for the LBO case would be that there would be no interaction
with the home PLMN's UPF, SMF and CHF.
#### 7.1.4.2 Solution #1.2: CDR in VPLMN for wholesale of 5G connection and
mobility
##### 7.1.4.2.1 General
A possible solution for key issues 1b covering requirements REQ-CH_VMNO-03 and
REQ-CH_VMNO-04, wholesale charging for 5G connection and mobility provided to
the home MNO by the visited MNO, covering both home routed and local breakout
case.
##### 7.1.4.2.2 Reference architecture
Figure 7.1.4.2.2-1: Roaming 5G connection and mobility scenario in service-
based interface representation
Figure 7.1.4.2.2-2: Roaming 5G connection and mobility scenario in reference
point representation
The AMF with CTF interact with CHF using Nchf interface. The CDRs produced by
CHF may be sent for interconnect charging (shown as dashed in the figures),
which then can be used to aggregate and calculate the number of connected UEs
per home MNO, the interconnect part is only included for completeness and is
currently outside the scope of 3GPP SA5.
##### 7.1.4.2.3 Message flows
The flows for 5G connection and mobility charging would be the same as in
clause 5.2.2.5 of TS 32.256 [5], with the exception that the there is no need
to interact with the home PLMN's CHF and that only PEC is required. The CDRs
generated in the CHF in VPLMN would in this case be used as input to the
wholesale charging of the HPLMN. The following figure 7.1.4.2.2-1 describes a
Registration charging message flow in PEC in VPLMN scenario for roaming, based
on figure 4.2.2.2.2-1 of TS 23.502 [6] description
Figure 7.1.4.2.3-1: Roaming Registration -- PEC in VPLMN
1-20a. Registration procedure initiated by UE per steps 1 to 20a of figure
4.2.2.2.2-1 of TS 23.502 [6], with PCF, AUSF and UDM in HPLMN.
21\. Upon successful procedure, Registration Accept sent to the UE.
21ch-a. The AMF in VPLMN sends Charging Data Request [Event] to the CHF in
VPLMN for the UE successful registration, indicating \"roamer in\".
21ch-b. The CHF in VPLMN creates the CDR for this registration.
21ch-c. The CHF in VPLMN acknowledges by sending Charging Data Response
[Event] to the AMF in VPLMN.
21b to 24. Same steps as in figure 4.2.2.2.2-1 of TS 23.502 [6].
#### 7.1.4.3 Solution #1.3: Nchf to VPLMN for wholesale of 5G data
connectivity
##### 7.1.4.3.1 General
A possible solution for key issue #1a covering requirements REQ-CH_VMNO-01 and
REQ-CH_VMNO-02, wholesale charging for 5G data connectivity provided to the
home MNO by the visited MNO, covering local breakout case. In this case there
is also charging information generated in the home MNO for retail purposes.
##### 7.1.4.3.2 Reference architecture
Figure 7.1.4.3.2-1: Roaming 5G data connectivity scenario in service-based
interface representation
Figure 7.1.4.3.2-2: Roaming 5G data connectivity scenario in reference point
representation
##### 7.1.4.3.3 Message flows
For local breakout roaming, the flows for 5G data connectivity charging are
present as the following figure 7.1.4.3.3-1.
**Figure 7.1.4.3.3-1: Local breakout roaming for 5G data connectivity
charging**
1-3a. UE initiates a new PDU session. V-SMF selection by the AMF.
4ch-a. The UE is identified as a roamer (PLMN ID of the received SUPI is
different from VPLMN PLMN ID), the V-CHF is selected accordingly. A Charging
Data Request [Initial, Roaming Charging profile] is sent to V-CHF, indicating
\"in-bound roamer\".
4ch-b. The V-CHF opens a CDR (indicating \"in-bound roamer\")
4ch-c. The V-CHF acknowledges by sending Charging Data Response [Initial,
Roaming Charging profile] to the V-SMF.
7ch-a. A Charging Data Request [Update] is sent to V-CHF with charging
information received from V-SMF.
7ch-b. The V-CHF updates the CDR.
7ch-c. The V-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
10ch-a. A Charging Data Request [Termination] is sent to V-CHF.
10ch-b. The V-CHF closes the CDR
10ch-c. The V-CHF acknowledges by sending Charging Data Response [Termination]
to the V-SMF.
Step 5, Step 8 and Step 11 are detailed in Figure 7.2.4.2.1-2 clause 7.2.
#### 7.1.4.4 Solution #1.4: Roaming Charging Profile update
##### 7.1.4.4.1 General
A possible solution for key issue #1g covering requirement REQ-CH_VMNO-05,
Roaming Charging Profile negotiation enhancement for 5G data connectivity
charging provided to the home MNO by the visited MNO.
##### 7.1.4.4.2 Reference architecture
The reference architecture would be the same as the home routed architecture
in figure 4.2.4 of TS 32.255 [4].
##### 7.1.4.4.3 Message flows
The message flows about roaming charging profile negotiation for 5G data
connectivity charging are present in the figure 5.2.2.12.2.1, PDU session
establishment, of TS 32.255 [4].
In the step 13,
_13ch-a. Based on \"received PDU session conditions\" trigger, a Charging Data
Request [Update] is sent to CHF with charging information received from H-SMF,
which includes the HPLMN selected \"Roaming Charging Profile\" and counts per
QFI are started._
_13ch-b. The CHF updates the CDR._
_13ch-c. The CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF._
During PDU session establishment, for Home Routed Roaming using QBC, the
roaming charging profile is sent from the V-CHF to the V-SMF which is then
forwarded to the H-CHF (using the H-SMF). The H-CHF may respond with a new
roaming charging profile. The H-CHF provided roaming charging profile is then
used by the V-SMF (as well as the H-SMF) for the QBC, the new charging roaming
profile is also sent to the V-CHF from V-SMF. The corresponding trigger
\"received PDU session conditions\" in the step 13ch-a should be clarified.
The message flows about roaming charging profile negotiation for Roaming Home
routed PDU session - inter-PLMN V-SMF change, specified in the figure
5.2.2.14.9.1, of TS 32.255[4],
In the step 8ach-a,
_8ach-a. A Charging Data Request [Update] is sent to H-CHF in HPLMN,
indicating the V-SMF change and \"Roaming Charging Profile\" received from the
VPLMN._
_8ach-b. The H-CHF in HPLMN updates the CDR._
_8ach-c. The H-CHF in HPLMN acknowledges by sending Charging Data Response
[Update] to the H-SMF and supplies the HPLMN selected \"Roaming Charging
Profile\" for this VPLMN._
In the step 8cch-a,
_8cch-a. A Charging Data Request [Update] is sent to V-CHF with charging
information received from H-SMF, which includes the HPLMN selected \"Roaming
Charging Profile\"._
_8cch-b. The V-CHF updates the CDR._
_8cch-c. The V-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF._
The updated \"Roaming Charging Profile\" will be reported to the V-CHF in the
next Charging Data Request [Update] which is enabled by subsequent triggers.
#### 7.1.4.5 Solution #1.5: CDR in VPLMN for wholesale of SMS
##### 7.1.4.5.1 General
A possible solution for key issue 1c covering requirements REQ-CH_VMNO-06 and
REQ-CH_VMNO-07, wholesale charging for SMS provided to the home MNO by the
visited MNO.
This solution is based on the architecture in clause 4.4.2 of TS 23.501 [2].
##### 7.1.4.5.2 Reference architecture
Figure 7.1.4.5.2-1: Roaming SMS in service-based interface representation
Figure 7.1.4.5.2-2: Roaming SMS in reference point representation
The SMSF with CTF interact with CHF using Nchf interface. The CDRs produced by
CHF may be sent for interconnect charging (shown as dashed in the figures),
which then can be used to aggregate and calculate the amount of SMSs per home
MNO, the interconnect part is only included for completeness and is currently
outside the scope of 3GPP SA5.
##### 7.1.4.5.3 Message flows
Figure 7.1.4.5.3-1 shows a scenario for Home MNO UE SMS submission in visited
MNO SMSF for PEC mode, based on clause 5.4.2.5 of TS 32.274 [8]
The CDRs generated in the CHF in VPLMN are used as input for wholesale
charging of the HPLMN.
Figure 7.1.4.5.3-1: Roaming SMS submission to SMSF -- PEC in VPLMN
1- 3. Initial procedures as per clause 5.4.2.5 of TS 32.274 [8].
4\. The SMSF in VPLMN sends Charging Data Request [Event] to CHF in VPLMN for
the SMS indicating \"roamer in\".
5\. The CHF in VPLMN creates a CDR for this SMS.
6\. The CHF in VPLMN acknowledges by sending Charging Data Response [Event] to
the SMSF in VPLMN.
7\. Forward SMS as per clause 5.4.2.5 of TS 32.274 [8].
#### 7.1.4.6 Solution #1.6: Nchf to VPLMN for wholesale of 5G connection and
mobility
##### 7.1.4.6.1 General
A possible solution for key issue #1b covering requirements REQ-CH_VMNO-03 and
REQ-CH_VMNO-04, wholesale charging for 5G connection and mobility provided to
the home MNO by the visited MNO. In this case there is also charging
information generated in the home MNO for retail purposes, studied in clause
7.2.
##### 7.1.4.6.2 Reference architecture
Figure 7.1.4.6.2-1: Roaming 5G connection and mobility scenario in service-
based interface representation
Figure 7.1.4.6.2-2: Roaming 5G connection and mobility scenario in reference
point representation
##### 7.1.4.6.3 Message flows
The flows for 5G connection and mobility charging would be the same as in
clause 5.2.2.5 of TS 32.256 [5],
#### 7.1.4.7 Solution #1.7: Roaming charging trigger preconfigured in VPLMN
based on negotiation with HPLMN
##### 7.1.4.7.1 General
A possible solution for key issue #1g covering requirements REQ-CH_VMNO-05 and
REQ-CH_VMNO-08, using preconfigured roaming charging triggers.
##### 7.1.4.7.2 Reference architecture
The reference architecture would be the same as in clauses7.1.4.1.2,
7.1.4.2.2, and 7.1.4.5.2.
##### 7.1.4.7.3 Message flows
The negotiation of how the charging triggers should be configured is done as
part of the roaming agreement between the VPLMN and HPLMN outside the scope of
3GPP SA5.
The negotiated roaming charging triggers are configured in the VPLMN's V-CHF,
V-SMF, AMF, and SMSF. These preconfigured charging triggers could be specific
to the HPLMN of the UE. In SMF case the roaming charging triggers would only
be exchanged between the V-SMF and V-CHF.
#### 7.1.4.8 Solution #1.8: Only QBC trigger negotiation towards the V-CHF
##### 7.1.4.8.1 General
A possible solution for key issue #1d covering requirements REQ-CH_VMNO-01,
and REQ-CH_VMNO -02, about the FBC negotiation between visited MNO and home
MNO.
The FBC (Flow Based Charging) is not used for wholesale and settlement between
visited MNO and home MNO. The triggers of FBC are not used for negotiation
between visited MNO and home MNO. The V-CHF sets the FBC triggers independent
of HPLMN.
##### 7.1.4.8.2 Reference architecture
The reference architecture would be the same as in solution #1.3 clause
7.1.4.3.2.
##### 7.1.4.8.3 Message flows
The detailed message flows would be the same as in clause 5.2.2.18.2 of TS
32.255 [4]. V-CHF receives charging information based on FBC triggers and
generates records. There is no negotiation of FBC triggers between visited MNO
and Home MNO.
#### 7.1.4.9 Solution #1.9: V-SMF connects to V-CHF with two charging sessions
##### 7.1.4.9.1 General
A possible solution for key issue #1a, covering requirements REQ-CH_VMNO-01,
and REQ-CH_VMNO-02, the charging information for 5G data connectivity provided
to the CHF in the visited MNO and CHF in home MNO (via V-CHF), From the
standpoint of the V-SMF, there are two charging sessions between V-SMF and
V-CHF, covering local breakout case.
##### 7.1.4.9.2 Reference architecture
The reference architecture would be the same as Figure 7.2.4.1.2-2.
##### 7.1.4.9.3 Message flows
For the V-SMF communicating with the H-CHF, the V-CHF is responsible for
sending the charging messages between V-SMF and H-CHF.
**Figure 7.1.4.9.3-1: Message flow for two charging sessions**
During the PDU session establishment, V-SMF establishes the two charging
sessions in the separate charging resource with V-CHF.
In the interaction between the V-SMF and V-CHF, V-SMF reports the charging
information to V-CHF.
In the interaction between the V-SMF and H-CHF, V-SMF reports the charging
information to the V-CHF in the charging session between the V-SMF and V-CHF,
V-CHF sends the charging information to H-CHF in the charging session between
the H-CHF and V-CHF. For QBC, the triggers and charging information are same
for both charging sessions.
For FBC, trigger does not have synchronization mechanism, i.e. for V-CHF and
H-CHF, it's possible that the FBC charging information and trigger are not
same for the two charging sessions.
#### 7.1.4.10 Solution #1.10: Separate QBC and FBC PDU session level triggers
##### 7.1.4.10.1 General
A possible solution for key issue #1f covering requirements REQ-CH_VMNO-01,
and REQ-CH_VMNO -02, about the PDU Session level setting for QBC triggers.
The QBC triggers and FBC triggers have separate PDU session level triggers
i.e., there will be QBC specific PDU session triggers and FBC specific PDU
session triggers.
##### 7.1.4.10.2 Reference architecture
The reference architecture would be the same as the local breakout
architecture in solution #1.3 clause 7.1.4.3.2, or home routed architecture in
Figure 4.2.4 of TS 32.255.
##### 7.1.4.10.3 Message flows
For home routed scenario, the message flow is same with the PDU session
establishment message flow in clause 5.2.2.12.2 of TS 32.255 [4]. In step
11ch-d of Figure 5.2.2.12.2.1 in TS 32.255 [4], the H-CHF acknowledges by
sending Charging Data Response to the H-SMF and optionally includes a
\"Roaming Charging Profile\". The \"Roaming Charging Profile\" may include
both QoS flow and PDU session level triggers (e.g. , both QoS change and user
location change) for QBC, for FBC both rating group and PDU session level
triggers may be included in the trigger elements of Charging Data Response.
For local breakout scenario, the message flow is same with the PDU session
establishment message flow in clause 5.2.2.18.2 of TS 32.255 [4]. In step
9ch-d2 of Figure 5.2.2.18.2-1 in TS 32.255 [4], the H-CHF acknowledges by
sending Charging Data Response to the V-SMF and optionally includes a
\"Roaming Charging Profile\". The \"Roaming Charging Profile\" may include
both QoS flow and PDU session level triggers (e.g. , both QoS change and user
location change) for QBC, for FBC both rating group and PDU session level
triggers may be included in the trigger element of Charging Data Response.
This means that the values and status of PDU session level triggers may be
different for QBC and FBC. For example, a PDU Session level \"Expiry of data
time limit per PDU session\" for FBC is set to 600 seconds while it for QBC is
set to 900 seconds, this means that after 600 seconds all the rating groups
shall be reported but no QoS flows, then after another 300 seconds all QoS
flows shall be reported but no rating groups. While updates can in some cases
coincide, it would be difficult to sort out the reason for and order of the
trigger and would therefore preferably always be separate for FBC and QBC.
#### 7.1.4.11 Solution #1.11: QBC triggers common for all QoS flows
##### 7.1.4.11.1 General
A possible solution for key issue #1e covering requirements REQ-CH_VMNO-05,
about the QoS flow level trigger setting during the PDU session.
The QBC triggers mechanism is specified in the clause 5.2.1.6 TS 32.255 [4]
and Roaming Charging Profile is specified in clause 5.2.1.7 of TS 32.255 [4].
The QBC triggers include PDU session level triggers and QoS Flow level
triggers.
##### 7.1.4.11.2 Reference architecture
The reference architecture would be the same as the local breakout
architecture in solution #1.3 clause 7.1.4.3.2 or Home Routed architecture in
Figure 4.2.4 of TS 32.255 [4].
##### 7.1.4.11.3 Message flows
The message flow is same with the PDU session establishment message flow in
clause 5.2.2.12.2 or 5.2.2.18.2 of TS 32.255 [4]. In a Roaming Charging
Profile negotiation, a QBC triggers is common for all QFIs, and applies
individually for each QFI.
#### 7.1.4.12 Solution #1.12: QBC and FBC common PDU session level triggers
##### 7.1.4.12.1 General
A possible solution for key issue #1f covering requirement REQ-CH_VMNO-08
about the PDU session level setting for QBC triggers.
The QBC triggers and FBC triggers share PDU session level triggers, this means
that there is one set of PDU session level triggers from the CHF, even when
both QBC and FBC is applicable at the same time. The roaming charging profile
is controlled by the H-CHF, since it is the H-CHF that is the last network
function to update the roaming charging profile, and the V-CHF will only be
informed of the update. For FBC it is only the H-CHF that sets the triggers.
This means that H-CHF that controls both the QBC and FBC triggers and can
synchronise the PDU session level triggers. To ensure that the QBC triggers
for both home and visited MNO are the same, the QBC triggers settings would
overwrite any setting based on FBC for the PDU session level triggers, if they
would differ.
##### 7.1.4.12.2 Reference architecture
The reference architecture would be the same as in solution #1.3 clause
7.1.4.3.2 or figure 4.2.4 of TS 32.255 [4].
##### 7.1.4.12.3 Message flows
For home routed scenario, the message flow is same as the PDU session
establishment message flow in clause 5.2.2.12.2 of TS 32.255 [4]. In step
11ch-d of Figure 5.2.2.12.2.1 in TS 32.255 [4], the H-CHF acknowledges by
sending Charging Data Response to the H-SMF and optionally includes a
\"Roaming Charging Profile\". The \"Roaming Charging Profile\" may include
both QoS flow and PDU session level triggers (e.g., both QoS change and user
location change) for QBC, for FBC both rating group and PDU session level
triggers may be included in the trigger element of Charging Data Response. For
FBC the PDU session level triggers may be replaced by the QBC PDU session
level triggers.
For local breakout scenario, the message flow is same with the PDU session
establishment message flow in clause 5.2.2.18.2 of TS 32.255 [4]. In step
9ch-d2 of Figure 5.2.2.18.2-1 in TS 32.255 [4], the H-CHF acknowledges by
sending Charging Data Response to the V-SMF and optionally includes a
\"Roaming Charging Profile\". The \"Roaming Charging Profile\" include both
QoS flow and PDU session level triggers (e.g., both QoS change and user
location change) for QBC, for FBC both rating group and PDU session level
triggers may be included in the trigger element of Charging Data Response. For
FBC the PDU session level triggers are replaced by the QBC PDU session level
triggers, if included.
This means that the trigger category, if they are enabled/disabled and the
values of PDU session level triggers will be the same for both QBC and FBC.
For example, a PDU Session level \"Expiry of data time limit per PDU session\"
for FBC is set to 600 seconds while it for QBC is set to 900 seconds, then the
900 seconds value will be used for all.
### 7.1.5 Evaluation
Solutions #1.1, #1.3, and #1.9 all solves key issue #1a.
\- Solution #1.1 has CDRs for the interconnect charging generated in the
visited MNO using V-SMF to V-CHF. The CDR will only be generated in the
visited network. This is currently supported, but not described.
\- Solution #1.3 has CDRs for the interconnect charging generated in the
visited MNO using V-SMF to V-CHF and requires retail charging in the home
using V-SMF to H-CHF. This is currently supported.
\- Solution #1.9 has CDRs for the interconnect charging generated in the
visited MNO using V-SMF to V-CHF and requires retail charging in the home
using V-SMF via the V-CHF to H-CHF.
The main difference from an interconnect perspective is that solutions #1.3
and #1.9 requires a V-SMF to H-CHF interaction while solution #1.1 don't.
Solutions #1.2 and #1.6 both solves key issue #1b.
\- Solution #1.2 has CDRs for the interconnect charging generated in the
visited MNO using AMF to V-CHF. The CDR will only be generated in the visited
network. This is currently supported, but not described.
\- Solution #1.6 has CDRs for the interconnect charging generated in the
visited MNO using AMF to V-CHF and requires retail charging in the home using
AMF to H-CHF. This is currently supported.
The main difference from an interconnect perspective is that solution #1.6
requires a V-SMF to H-CHF interaction while solution #1.2 don't.
Solution #1.5 solves key issue #1c.
\- Solution #1.5 has CDRs for the interconnect charging generated in the
visited MNO using V-SMSF to V-CHF.
Solutions #1.8 solves key issue #1d.
\- Solution #1.8 allows for negotiation of roaming charging profile with
triggers for QBC.
Solution #1.11 solve key issue #1e.
\- Solution #1.11 aims to clarify the QBC triggers mechanism on QoS flow level
as specified in TS 32.255 [4] and have the QBC triggers common for all QFIs
and applies individually to each QFI.
Solutions #1.10 and #1.12 both solve key issue #1f.
\- Solution #1.10 have separate PDU session level triggers for FBC and QBC. It
allows the settings of PDU session level triggers to be independent for QBC
and FBC, whether the settings are same or different is eventually controlled
by Home MNO. Reuses the current information elements and use the same charging
data requests for QBC and FBC.
\- Solution #1.12 have common PDU session level triggers for FBC and QBC. It
allows the settings of PDU session level triggers to be same for QBC and FBC.
Reuses the current information elements and will use the same charging data
requests for QBC and FBC.
Solutions #1.1, #1.4 and #1.7 all solve key issue #1g.
\- Solution #1.1 would require solution #1.7 to solve the key issue since
there is no connection to the home NMO.
Solution #1.4 aims to clarify the trigger for reporting updates in roaming
charging profile for 5G data connectivity during PDU session establishment and
roaming home routed PDU session with inter-PLMN V-SMF change as specified in
TS 32.255 [4]and would require solution #1.3 or #1.9 since there is a need to
have a connection to the home NMO. This is a detailing of the usage of the
current information elements.
\- Solution #1.7 aims to clarify the roaming charging profile for 5G data
connectivity during PDU session establishment and roaming home routed PDU
session as specified in TS 32.255 [4]and is currently supported but not
described in detail the specifications.
### 7.1.6 Conclusion
For the key issues #1a, #1b, and #1c, the possibility for the visited MNO to
only interact with the V-CHF in the case of local breakout i.e., all the
solutions #1.1, #1.2, #1.5 should be taken into normative work, in addition to
solutions implying interaction with H-CHF.
For the key issue #1d there is only one solution proposed without FBC trigger
i.e., solution #1.8 should be supported.
For key issues #1e there is only one solution proposed with applied
individually to each QFI is to be taken into normative work i.e., this means
solution #1.11.
For key issue #1f, the handling of PDU session level triggers for QBC and FBC
can follow the existing specifications.
For key issues #1g both solutions are to detail the current solutions i.e.,
solutions #1.4 and #1.7.
## 7.2 Convey charging information from visited MNO to home MNO
### 7.2.1 Use cases
#### 7.2.1.1 Use case #2a: Home MNO charging subscriber for 5G data
connectivity at roaming using local breakout
This use case focuses on home MNO and subscriber business roles.
A subscriber has a UE and a subscription with the home MNO which allows usage
of 5G data connectivity while roaming. The subscriber is roaming in a visited
network and is allowed to use local breakout.
The home MNO charging of the subscriber could be based on data volume that the
home MNO UE has used in the visited MNO's network considering of the following
aspects:
> \- Visited network
>
> \- RAT type;
>
> \- S-NSSAI;
>
> \- DNN;
>
> \- QoS information.
#### 7.2.1.2 Use case #2b: Home MNO charging subscriber for 5G data
connectivity at roaming using home routed
This use case focuses on home MNO and subscriber business roles.
A subscriber has a UE and a subscription with the home MNO which allows usage
of 5G data connectivity while roaming. The subscriber is roaming in a visited
network and the connection is home routed.
The home MNO charging of the subscriber could be based on data volume that the
home MNO UE has used in the visited MNO's network considering of the following
aspects:
> \- Visited network
>
> \- RAT type;
>
> \- S-NSSAI;
>
> \- DNN;
>
> \- QoS information.
#### 7.2.1.3 Use case #2c: Home MNO charging subscriber for SMS provided at
roaming
This use case focuses on visited MNO and home MNO business roles.
The visited MNO to home MNO charging is based on number of SMS sent or
received by the home MNO UEs served by the visited MNO's network considering
of the following aspects:
> \- RAT type;
>
> \- Location
Number of SMS sent or received under the above aspects needs to be
reconciliated between home MNO and visited MNO.
#### 7.2.1.4 Use case #2d: Home MNO charging subscriber for 5G connection and
mobility provided to home MNO's subscribers in roaming scenario
This use case focuses on visited MNO and home MNO business roles.
The visited MNO to home MNO charging is based on connection and mobility sent
or received by the home MNO UEs served by the visited MNO's network
considering of the following aspects:
> \- RAT type;
>
> \- Location
### 7.2.2 Potential charging requirements
**REQ-CH_CVTOH-01:** The charging mechanism in visited MNO should support
conveying charging information for the 5G data connectivity usage to the home
MNO for each UE.
**REQ-CH_ CVTOH-02:** The charging mechanism in visited MNO should support
collecting charging information related to 5G data connectivity usage for each
UE.
**REQ-CH_ CVTOH-03:** The charging mechanism in visited MNO should support
conveying charging information for SMS usage to the home MNO for each UE.
**REQ-CH_ CVTOH-04:** The charging mechanism in visited MNO should support
collecting charging information related to SMS usage for each UE.
**REQ-CH_ CVTOH-05:** The charging mechanism in visited MNO should support
conveying charging information for 5G connection and mobility to the home MNO
for each UE.
**REQ-CH_ CVTOH-06:** The charging mechanism in visited MNO should support
collecting charging information related to 5G connection and mobility for each
UE.
### 7.2.3 Key issues
The following key issues are identified:
\- **Key Issue #2a** : Collection of charging mechanism in visited MNO about
the 5G data connectivity usage.
\- **Key Issue #2b:** Conveying the charging information to the home MNO for
5G data connectivity usage.
\- **Key Issue #2c:** Finding the correct CHF
**\- Key Issue #2d:** Service based interface to use between visited CHF and
home CHF
**\- Key Issue #2e:** Trigger handling between visited CHF and home CHF for 5G
data connectivity usage.
\- **Key Issue #2f** : Collection of charging mechanism in visited MNO for SMS
usage.
\- **Key Issue #2g:** Conveying the charging information to the home MNO for
SMS usage
\- **Key Issue #2h** : Collection of charging mechanism in visited MNO for 5G
connection and mobility.
\- **Key Issue #2i:** Conveying the charging information to the home MNO for
5G connection and mobility.
**\- Key Issue #2j:** The granularity of charging session between visited CHF
and home CHF.
### 7.2.4 Potential solutions
#### 7.2.4.1 Solution #2.1: V-CHF communicating with H-CHF for retail charging
of 5G, single charging session to V-CHF
##### 7.2.4.1.1 General
A possible solution for key issues #2a, #2b, #2f, #2g, #2h and #2i covering
requirements REQ-CH_CVTOH-01, REQ-CH_CVTOH-02, REQ-CH_CVTOH-03, REQ-
CH_CVTOH-04, REQ-CH_CVTOH-05, and REQ-CH_CVTOH-06, retail charging for 5G data
connectivity provided, 5G connection and mobility, and SMS usage to the home
MNO's users by the visited MNO, in the case of local breakout.
There is a single charging session between NF (e.g. V-SMF) and V-CHF. For the
NF communicating with the H-CHF, the V-CHF is responsible for generating the
charging information to H-CHF and handling its own charging information.
There is a one-to-one relationship between the PDU session and the charging
session towards the V-CHF.
For SMS, this solution is based on the architecture in clause 4.4.2 of TS
23.501 [2].
##### 7.2.4.1.2 Reference architecture
Figure 7.2.4.1.2-1: Roaming 5G scenario in service-based interface
representation
The visited CHF does converged charging for interconnect (wholesale), while
the home CHF does converged charging for the subscriber (retail).
Figure 7.2.4.1.2-2: Roaming 5G scenario in reference point representation
##### 7.2.4.1.3 Message flows
Figure 7.2.4.1.3-1 shows a scenario for Session Based Charging (SBC) with CHF-
to-CHF communication. Applicable for SMF, without update and termination also
applicable for SMSF and AMF. During the PDU session establishment, NF (e.g.
V-SMF) establishes the single charging session for reporting charging
information to V-CHF and H-CHF.
Figure 7.2.4.1.3-1: SBC - Session based charging with CHF-to-CHF communication
**1) Request for service delivery:** A request for session establishment is
received in NF (CTF). The service is configured to be authorized by V-CHF
before start.
**2) Units determination:** NF (CTF) determines the number of units depending
on the service requested by the UE in \"Decentralized Units determination\"
scenario.
**3) Charging data request [Initial, Quota requested]:** NF (CTF) sends an
initial charging data request to V-CHF for the service to be granted
authorization to start, and to reserve the number of units if determined in
item 2.
**4) Determine H-CHF:** V-CHF creates a charging resource for the NF (CTF),
determines that it need to interact with H-CHF and which H-CHF it should
contact and generates an initial charging home request to H-CHF.
**5) Charging home request [Initial, Quota requested]:** V-CHF sends the
request to H-CHF for the service to be granted authorization to start, and to
reserve the number of units if determined in item 2.
**6) Account, Rating, Reservation control:** H-CHF rates the charging home
requests either based on the number of units requested or on internal unit
determination, checks if corresponding funds can be reserved on the user\'s
account balance. If the account has sufficient funds, H-CHF performs the
corresponding reservations.
**7) Open CDR:** based on policies, H-CHF opens a CDR related to the service.
**8) Charging home response [Initial, Quota granted]:** H-CHF grants
authorization to V-CHF for the service to start, with the reserved number of
units.
**9) Open CDR:** based on policies, V-CHF opens a CDR related to the service.
**10) Charging data response [Initial, Quota granted]:** V-CHF grants
authorization to NF (CTF) for the service to start, with the reserved number
of units.
**11) Granted units supervision:** NF (CTF) monitors the consumption of the
granted units.
**12) Start of service delivery:** NF (CTF) starts to deliver the
content/service based on the reserved number of units.
**13) Quota management trigger:** A trigger associated to quota management is
met. Unit determination is performed when applicable.
**14) Charging data request [Update, Unit used, Quota requested]:** NF (CTF)
sends an intermediate charging data request to V-CHF, for more units to be
granted for the service to continue and reporting the used units.
**15) Charging home request [Update, Unit used, Quota requested]:** V-CHF
sends an intermediate charging home request to H-CHF, for more units to be
granted for the service to continue and reporting the used units.
**16) Account, Rating, Reservation control:** H-CHF performs the process
related to the reported usage and the requested reservation, involving rating
entity and user\'s account balance.
**17) Update CDR:** based on policies, H-CHF updates the CDR with charging
data related to the service.
**18) Charging home response [Update, Quota granted]:** H-CHF grants quota to
V-CHF for the service to continue, with the reserved number of units.
**19) Update CDR:** based on policies, V-CHF updates the CDR with charging
data related to the service.
**20) Charging data response [Update, Quota granted]:** V-CHF grants quota to
NF (CTF) for the service to continue, with the reserved number of units.
**21) Granted units supervision:** NF (CTF) monitors the consumption of the
granted units.
**22) Service delivery ongoing:** NF (CTF) continues the service delivery
based on the granted quota.
**23) Service released:** the service is terminated or released.
**24) Charging data request [Termination,** **Unit used]:** NF (CTF) sends a
terminate charging data request to the V-CHF, for charging data related to the
service termination with the final consumed units.
**25) Charging home request [Termination,** **Unit used]:** V-CHF sends a
terminate charging home request to the H-CHF, for charging data related to the
service termination with the final consumed units.
**26) Account, Rating control:** H-CHF performs the service termination
process involving rating entity and user\'s account balance.
**27) Close CDR:** based on policies, H-CHF closes the CDR with charging data
related to the service termination and the last reported units.
**28) Charging home response [Termination]:** H-CHF informs the V-CHF on the
result of the terminate charging home request.
**29) Close CDR:** based on policies, V-CHF closes the CDR with charging data
related to the service termination and the last reported units.
**30) Charging data response [Termination]:** V-CHF informs the NF (CTF) on
the result of the terminate charging data request.
Figure 7.2.4.1.3-2 shows a scenario for Immediate Event Charging (IEC) with
CHF-to-CHF communication. Applicable for SMSF and AMF. When a trigger for IEC
is met, NF (e.g. AMF) issues a charging data request to V-CHF and H-CHF.
Figure 7.2.4.1.3-2: IEC - Immediate event charging with CHF-to-CHF
communication
**1) Request for content/service delivery:** A request for session
establishment is received in NF (CTF). The service is configured to be
authorized by V-CHF before start.
**2) Units determination:** NF (CTF) determines the number of units depending
on the service requested by the UE in \"Decentralized Units determination\"
scenario.
**3) Charging data request [Event, Units]:** NF (CTF) sends the request to
V-CHF for the service to be granted authorization to start, and to allow the
number of units if determined in item 2.
**4) Determine H-CHF:** V-CHF creates a charging resource for NF (CTF),
determines that it need to interact with H-CHF and which H-CHF it should
contact, and generates a charging home request to H-CHF.
**5) Charging home request [Event, Units]:** V-CHF sends the request to H-CHF
for the service to be granted authorization to start, and to allow the number
of units if determined in step 2.
**6) Account, Rating control:** H-CHF rates the charging home requests and
checks if corresponding funds are available on the user\'s account balance. If
the account has sufficient funds, H-CHF performs the corresponding
reservations.
**7) Create CDR:** based on policies, H-CHF creates a CDR related to the
service.
**8) Charging home response [Event, Units]:** H-CHF grants authorization to
V-CHF for the service to start, with the allowed number of units.
**9) Create CDR:** based on policies, V-CHF creates a CDR related to the
service.
**10) Charging data response [Event, Units]:** V-CHF grants authorization to
NF (CTF) for the service to start, with the allowed number of units.
**11) Granted units supervision:** NF (CTF) monitors the consumption of the
allowed units.
**12) Content/service delivery:** NF (CTF) starts to deliver the
content/service based on the allowed number of units.
Figure 7.2.4.1.3-3 shows a scenario for Post Event Charging (PEC) with CHF-to-
CHF communication. Applicable for SMSF and AMF. D When a trigger for PEC is
met, NF (e.g. AMF) issues a charging data request to V-CHF and H-CHF.
Figure 7.2.4.1.3-3: PEC - Post event charging with CHF-to-CHF communication
**1) Request for content/service delivery:** A request for session
establishment is received in NF (CTF). The service is configured not to be
authorized by CHF before start.
**2) Content/service delivery:** NF (CTF) starts to deliver the
content/service.
**3) Charging data request [Event, Units]:** NF (CTF) sends a charging data
request to V-CHF with the units used for recording, and possibly accounting
and rating control.
**4) Determine H-CHF:** V-CHF creates a charging resource for NF (CTF),
determines that it need to interact with H-CHF and which H-CHF it should
contact, and generates a charging home request to H-CHF.
**5) Charging home request [Event, Units]:** V-CHF sends the request to H-CHF
with the units used for recording, and possibly accounting and rating control.
**6) Account, Rating control:** H-CHF may rate the charging home request based
on the number of units used and update the user\'s account balance.
**7) Create CDR:** based on policies, H-CHF creates a CDR related to the
service.
**8) Charging home response [Event]:** H-CHF informs V-CHF on the result of
the charging home request.
**9) Create CDR:** based on policies, V-CHF creates a CDR related to the
service.
**10) Charging data response [Event]:** V-CHF informs NF (CTF) on the result
of the charging data request.
#### 7.2.4.2 Solution #2.2: Visited SMF (CTF) communicating with both H-CHF
and V-CHF
##### 7.2.4.2.1 General
A possible solution for key issues #2a and #2b covering requirements REQ-
CH_CVTOH-01, and REQ-CH_CVTOH-02, retail charging for 5G data connectivity
provided to the home MNO's user by the visited MNO.
The visited CHF does converged charging for interconnect, while the home CHF
does converged charging for the subscriber.
##### 7.2.4.2.2 Reference architecture
Figure 7.2.4.2.2-1: Roaming 5G data connectivity scenario in service-based
interface representation
Figure 7.2.4.2.2-2: Roaming 5G data connectivity scenario in reference point
representation
##### 7.2.4.2.3 Message flows
This would be same as for solution #1.3 in clause 7.1.4.3.
#### 7.2.4.3 Solution #2.3: V-CHF communicating with H-CHF for SMS charging
reconciliation between MNOs
Covered by clause 7.2.4.1.
#### 7.2.4.4 Solution #2.4: Visited SMSF (CTF) communicating with both H-CHF
and V-CHF
##### 7.2.4.4.1 General
A possible solution for key issues #2f and #2g covering requirements REQ-
CH_CVTOH-03, and REQ-CH_CVTOH-04, charging for SMS provided to the home MNO's
users by the visited MNO, in roaming scenario.
The visited CHF performs converged charging for interconnect, while the home
CHF performs converged charging for reconciliation.
This solution is based on the architecture in clause 4.4.2 of TS 23.501 [2].
##### 7.2.4.4.2 Reference architecture
The Roaming SMS architecture in service-based interface representation is the
same as in Figure 7.2.4.4.2-1
Figure 7.2.4.4.2-1: Roaming SMS in reference point representation
##### 7.2.4.4.3 Message flows
Figure 7.2.4.4.3-1 shows a scenario for SMS PEC with CTF to both CHFs
communication.
Figure 7.2.4.4.3-1: Roaming PEC SMS - two CHFs communication
1- 3. Initial procedures as per clause 5.4.2.5 of TS 32.274 [8].
4\. The SMSF in VPLMN sends Charging Data Request [Event] to H-CHF for the
SMS.
5\. The H-CHF creates a CDR for this SMS.
6\. The H-CHF acknowledges by sending Charging Data Response[Event] to the
SMSF in VPLMN.
7\. The SMSF in VPLMN sends Charging Data Request [Event] to V-CHF for the
SMS.
8\. The V-CHF creates a CDR for this SMS.
9\. The V-CHF acknowledges by sending Charging Data Response[Event] to the
SMSF in VPLMN.
10\. Forward SMS as per clause 5.4.2.5 of TS 32.274 [8].
#### 7.2.4.5 Solution #2.5: Visited AMF (CTF) communicating with both H-CHF
and V-CHF
##### 7.2.4.5.1 General
A possible solution for key issues #2h and #2i covering requirements REQ-
CH_CVTOH-05, and REQ-CH_CVTOH-06, retail charging for 5G connection and
mobility provided to the home MNO's user by the visited MNO.
The visited CHF does converged charging for interconnect, while the home CHF
does converged charging for the subscriber.
##### 7.2.4.5.2 Reference architecture
Figure 7.2.4.5.2-1: Roaming 5G connection and mobility scenario in service-
based interface representation
Figure 7.2.4.5.2-2: Roaming 5G connection and mobility scenario in reference
point representation
##### 7.2.4.5.3 Message flows
This would be same as TS 32.256 [9] clause 5.2.2.5.
#### 7.2.4.6 Solution #2.6: Reusing Nchf_ConvergedCharging service API between
CHFs
##### 7.2.4.6.1 General
A possible solution for key issue #2d covering requirements REQ-CH_CVTOH-01,
REQ-CH_CVTOH-02, REQ-CH_CVTOH-03, REQ-CH_CVTOH-04, REQ-CH_CVTOH-05, and REQ-
CH_CVTOH-06, service based interface to use between visited CHF and home CHF,
would be to reuse the Nchf_ConvergedCharging service API. This would mean that
the V-CHF would proxy the request from the AMF, SMF or SMSF to the H-CHF, and
the same with the response. The V-CHF could do some changes to message like:
filter (e.g. trigger), enrich, or convert (e.g., rating groups).
##### 7.2.4.6.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1.
#### 7.2.4.7 Solution #2.7: New Nchf service API between CHFs
##### 7.2.4.7.1 General
A possible solution for key issue #2d covering requirements REQ-CH_CVTOH-01,
REQ-CH_CVTOH-02, REQ-CH_CVTOH-03, REQ-CH_CVTOH-04, REQ-CH_CVTOH-05, and REQ-
CH_CVTOH-06, service based interface to use between visited CHF and home CHF,
would be to create a new service API. This would mean that the V-CHF would
translate the request from the AMF, SMF or SMSF to the new service API towards
the H-CHF. This would mean that the message could look completely different
and even the triggers in the V-CHF for sending the message towards the H-CHF
wouldn't have to be related to the request from AMF, SMF or SMSF.
##### 7.2.4.7.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1.
#### 7.2.4.8 Solution #2.8: Using NRF to find H-CHF
##### 7.2.4.8.1 General
A possible solution for key issue #2c, finding the correct CHF for solutions
#2.1 and #2.3 where V-CHF communicating with H-CHF.
##### 7.2.4.8.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1 and #2.3 clause 7.2.4.3.
##### 7.2.4.8.3 Message flows
The V-CHF would in this case use the vNRF provided service to find the H-CHF,
where the vNRF and hNRF may communicate according to TS 23.501 clause 6.2.6.
#### 7.2.4.9 Solution #2.9: Using SUPI to find H-CHF
##### 7.2.4.9.1 General
A possible solution for key issue #2c, finding the correct CHF for solutions
#2.1 and #2.3 where V-CHF communicating with H-CHF.
##### 7.2.4.9.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1 and #2.3 clause 7.2.4.3.
##### 7.2.4.9.3 Message flows
The V-CHF would in this case use the SUPI i.e., the IMSI number series, to
find the V-CHF. In this case the H-CHF address would be pre-provisioned in the
V-CHF and allocated to a IMSI series.
#### 7.2.4.10 Solution #2.10: Charging session between V-CHF and H-CHF per UE
##### 7.2.4.10.1 General
A possible solution for key issue #2j, would be to have the charging session
between V-CHF and H-CHF on a per UE basis for 5G data connectivity. In
specific, V-CHF establishes a charging session with H-CHF based on that the
V-CHF gets a charging data request containing a SUPI that the V-CHF don't have
a session with a H-CHF setup. V-CHF releases the charging session with H-CHF
when it receives the charging data request for service release from the last
PDU session for the SUPI. This requires the UE to reach the same V-CHF.
##### 7.2.4.10.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1.
##### 7.2.4.10.3 Message flows
In this case, the SMF, AMF, and SMSF establish the charging session and events
with the V-CHF per as specified in the TS 32.255 [4], TS 32.256 [5], and TS
32.274 [8]. The V-CHF would establish the charging session with the H-CHF
based on the SUPI i.e., on a per UE basis.
Figure 7.1.4.10.3-1 shows the message flow of V-CHF-to-H-CHF communication per
UE for Session Based Charging (SCUR). Applicable for SMF. Regarding the PDU
session establishment request for a UE, the V-CHF determines to establishes a
charging session with H-CHF per UE. The additional PDU sessions for this UE
continue to exchange messages using the same charging session between V-CHF
and H-CHF. Upon receiving the service release request from the last PDU
session for this UE, the V-CHF determines to terminate the charging session
between V-CHF and H-CHF.
For event-based charging scenario, it is not applicable to wait for multiple
charging data requests [event] per UE. Hence, the message flow for event-based
charging scenario is the same as the figure 7.2.4.1.3-2 (IEC) and figure
7.2.4.1.3-3 (PEC) in solution #2.1. Applicable to SMSF and AMF.
Step 1 to 11 describe the message flow of the delivery procedure for
establishing the first PDU session by a UE. At the establishment of the first
PDU session for a UE, V-CHF setups an interaction session with H-CHF for
exchanging charging information for the current UE as shown in step 4. Step 12
summarizes ongoing service delivery for the #1 PDU session.
**1) Request for service delivery:** A request for session establishment is
received in NF (CTF).
**2) Units determination:** NF (CTF) determines the number of units depending
on the service requested by the UE in \"Decentralized Units determination\"
scenario.
**3) Charging data request [Initial, Quota requested]:** NF (CTF) sends an
initial charging data request to V-CHF for the service to be granted
authorization to start, and to reserve the number of units if determined in
item 2.
**4) Determine H-CHF:** V-CHF determines whether there is an existing session
to interact with H-CHF for the current UE (based on SUPI). If no session has
been created for the current UE, it creates a charging resource for the NF
(CTF), determines which H-CHF it should contact, and generates an initial
charging home request to H-CHF.
**5) Charging home request [Initial, Quota requested]:** V-CHF sends the
request to H-CHF for the service to be granted authorization to start, and to
reserve the number of units.
**6) Account, Rating, Reservation control:** H-CHF rates the charging home
requests either based on the number of units requested or on internal unit
determination, checks if corresponding funds can be reserved on the user\'s
account balance. If the account has sufficient funds, H-CHF performs the
corresponding reservations.
**7) Open CDR:** based on policies, H-CHF opens a CDR related to the service.
**8) Charging home response [Initial, Quota granted]:** H-CHF grants
authorization to V-CHF for the service to start, with the reserved number of
units.
**9) Open CDR:** based on policies, V-CHF opens a CDR related to the service.
**10) Charging data response [Initial, Quota granted]:** V-CHF grants
authorization to NF (CTF) for the service to start, with the reserved number
of units.
**11) Granted units supervision:** NF (CTF) monitors the consumption of the
granted units.
**12) Ongoing service delivery:** ongoing messages within the quota management
and usage reporting procedure for the first PDU session. The messages that
need interaction between V-CHF to H-CHF are exchanged in the existing session
between V-CHF and H-CHF for the current UE.
Step 13 to 22 describe the message flow of the delivery procedure for
establishing another PDU session for this UE. Given that the UE already has an
ongoing PDU session, the step to determine H-CHF is not required. The messages
between V-CHF and H-CHF continues to exchange in the existing session between
V-CHF and H-CHF that has been created for this UE. Step 23 summarizes ongoing
service delivery for the first and/or the second PDU session.
**13) Request for service delivery:** Another request for session
establishment for the current UE is received in NF (CTF).
**214) Units determination:** NF (CTF) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.
**15) Charging data request [Initial, Quota requested]:** NF (CTF) sends an
initial charging data request to V-CHF for the service to be granted
authorization to start, and to reserve the number of units if determined in
item 14.
**16) Charging home request [Update, Quota requested]:** V-CHF sends the
request to H-CHF for the service to be granted authorization to start, and to
reserve the number of units.
**17) Account, Rating, Reservation control:** H-CHF rates the charging home
requests either based on the number of units requested or on internal unit
determination, checks if corresponding funds can be reserved on the user\'s
account balance. If the account has sufficient funds, H-CHF performs the
corresponding reservations.
**18) Update CDR:** based on policies, H-CHF updates the CDR with charging
data related to the service.
**19) Charging home response [Update, Quota granted]:** H-CHF grants
authorization to V-CHF for the service to start, with the reserved number of
units.
**20) Open CDR:** based on policies, V-CHF opens a CDR related to the service.
**21) Charging data response [Initial, Quota granted]:** V-CHF grants
authorization to NF (CTF) for the service to start, with the reserved number
of units.
**22) Granted units supervision:** NF (CTF) monitors the consumption of the
granted units.
**23) Ongoing service delivery:** ongoing messages within the quota management
and usage reporting procedure for the first and/or second PDU session.
Similarly, the messages that need interaction between V-CHF to H-CHF are
exchanged in the existing session between V-CHF and H-CHF for this UE.
Step 24 to 31 describe the message flow of the post delivery procedures
regarding the first PDU session. Since it is not the last PDU session for this
UE, the session between V-CHF and H-CHF continues to support the message
exchanges afterwards this release request. Step 23 summarizes ongoing service
delivery for the second PDU session.
**24) Service release:** the service for the first PDU session is terminated
or released.
**25) Charging data request [Termination,** **Unit used]:** NF (CTF) sends a
terminate charging data request to the V-CHF, for charging data related to the
service termination with the final consumed units.
**26) Charging home request [Update,** **Unit used]:** V-CHF sends an update
charging home request to the H-CHF, for charging data related to the service
termination with the final consumed units for this PDU session.
**27) Account, Rating control:** H-CHF performs the service termination
process involving rating entity and user\'s account balance regarding this PDU
session.
**28) Update CDR:** based on policies, H-CHF update the CDR with charging data
related to the service termination and the last reported units for the this
PDU session.
**29) Charging home response [Update]:** H-CHF informs the V-CHF on the result
of the update charging home request.
**30) Close CDR:** based on policies, V-CHF closes the CDR with charging data
related to the service termination and the last reported units.
**31) Charging data response [Termination]:** V-CHF informs the NF (CTF) on
the result of the terminate charging data request.
**32) Ongoing service delivery:** ongoing messages within the quota management
and usage reporting procedure for the second PDU session. Similarly, the
messages that need interaction between V-CHF to H-CHF are exchanged in the
existing session between V-CHF and H-CHF for this UE.
Step 33 to 41 describe the message flow of the post delivery procedures
regarding the second PDU session. Since it is the last PDU session for this
UE, V-CHF terminates the session to interact with H-CHF as shown in step 35.
**33) Service release:** the service for the second PDU session is terminated
or released.
**34) Charging data request [Termination,** **Unit used]:** NF (CTF) sends a
terminate charging data request to the V-CHF, for charging data related to the
service termination with the final consumed units.
**35) Determine to release the session with H-CHF:** V-CHF identifies that it
is the last PDU session for this UE. It determines to release the session with
H-CHF.
**36) Charging home request [Termination,** **Unit used]:** V-CHF sends an
update charging home request to the H-CHF, for charging data related to the
service termination with the final consumed units.
**37) Account, Rating control:** H-CHF performs the service termination
process involving rating entity and user\'s account balance.
**38) Close CDR:** based on policies, H-CHF closes the CDR with charging data
related to the service termination and the last reported units.
**39) Charging home response [Termination]:** H-CHF informs the V-CHF on the
result of the terminate charging home request.
**40) Close CDR:** based on policies, V-CHF closes the CDR with charging data
related to the service termination and the last reported units.
**41) Charging data response [Termination]:** V-CHF informs the NF (CTF) on
the result of the terminate charging data request.
#### 7.2.4.11 Solution #2.11: Charging data message exchange between V-CHF and
H-CHF per charging data request
##### 7.2.4.11.1 General
A possible solution for key issue #2e and #2x, the trigger for interaction for
V-CHF communicating with H-CHF, i.e. message exchange within a charging
session between V-CHF and H-CHF, is based on the reception of a charging data
request by the V-CHF.
In this case, the charging session between V-CHF and H-CHF is on the same
granularity as the interaction between NF(CTF) and V-CHF. In specific,
  * Regarding the session-based charging scenario (e.g. SCUR), V-CHF would establish the charging session with H-CHF on a per PDU session basis.
  * Regarding the event-based charging scenario (e.g. IEC, PEC), V-CHF would establish the charging session with H-CHF on a per event basis.
##### 7.2.4.11.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1.
##### 7.2.4.11.3 Message flows
In this case V-CHF as the NF consumer towards the H-CHF, triggers a charging
data request based on the reception of a charging data request from another NF
consumer. The V-CHF to may filter or convert the trigger from the V-CHF's NF
consumer i.e., for 5G data connectivity charging the V-CHF may use either FBC
or QBC triggers to trigger a charging data request towards the H-CHF.
The message flow is the same as the figure 7.2.4.1.3-1 in solution #2.1.
#### 7.2.4.12 Solution #2.12: Roaming charging profile update
##### 7.2.4.12.1 General
A possible solution for key issue #2e covering requirements REQ-CH_CVTOH-01,
and REQ-CH_CVTOH-02, trigger handling between VPLMN and HPLMN, is to use the
roaming charging profile and allow it to be updated.
##### 7.2.4.12.2 Reference architecture
The reference architecture would be the same as in solution #2.2 clause
7.2.4.2.
##### 7.2.4.12.3 Message flows
The Roaming charging profile may be requested at any time by the V-SMF. This
means that the V-SMF could include it in every charging data request, allowing
the V-SMF, V-CHF or H-CHF to change it:
1\. The V-SMF includes Roaming charging profile in a Charging data request
[Update] to V-CHF
2\. Changed by V-CHF and transferred to V-SMF
3\. Transferred from V-SMF to H-CHF
4\. Changed by H-CHF and transferred to V-SMF
5\. Applied in V-SMF
#### 7.2.4.13 Solution #2.13: V-CHF selected charging information for
reporting to H-CHF
##### 7.2.4.13.1 General
A possible solution for key issues #2a, #2b, #2f, #2g, #2h, and #2i, the
charging information provided to the CHF in the visited MNO and CHF in home
MNO (via V-CHF) in single charging session (From the standpoint of V-SMF, all
the charging information for V-CHF and H-CHF are exchanged in one charging
session between V-SMF and V-CHF), V-CHF is responsible for the charging
reporting for H-CHF.
##### 7.2.4.13.2 Reference architecture
The reference architecture would be the same as figure 7.2.4.1.2-2.
##### 7.2.4.13.3 Message flows
During the PDU session establishment, V-SMF establishes the charging session
with V-CHF, same with the figure 7.2.4.1.3-1 in solution #2.1.
V-CHF is responsible for distinguishing the charging information for H-CHF and
V-CHF.
1\. The V-SMF sends Charging data request to V-CHF with the charging
information;
2\. V-CHF determines the charging information for V-CHF and handled it.
3\. Based on the triggers on V-CHF, V-CHF constructs and reports the charging
information to H-CHF;
4\. H-CHF sends the charging data response to V-CHF;
5\. V-CHF sends charging data response from H-CHF and/or sends the charging
response from V-CHF.
#### 7.2.4.14 Solution #2.14: V-SMF selected charging information for
reporting to H-CHF
##### 7.2.4.14.1 General
A possible solution for key issue #2a and #2b, the charging information for 5G
data connectivity provided to the CHF in the visited MNO and CHF in home MNO
(via V-CHF) in single charging session, V-SMF is responsible for the charging
reporting for the V-CHF and H-CHF.
##### 7.2.4.14.2 Reference architecture
The reference architecture would be the same as figure 7.2.4.1.2-2.
##### 7.2.4.14.3 Message flows
During the PDU session establishment, V-SMF establishes the single charging
session with V-CHF, same with the figure 7.2.4.1.3-1 in solution #2.1.
V-SMF is responsible for distinguishing the charging information for H-CHF and
V-CHF. The V-CHF sends the charging information between V-SMF and H-CHF.
1\. The V-SMF sends charging data request to V-CHF with both the charging
information for V-CHF and charging information for H-CHF with the indication;
2\. Based on the indication, V-CHF handles the charging information for V-CHF;
3\. Based on the indication, V-CHF sends charging information to H-CHF;
4\. H-CHF sends the charging data response to V-CHF;
5\. V-CHF sends charging data response from H-CHF and/or sends the charging
data response from V-CHF its own.
#### 7.2.4.15 Solution #2.15: V-SMF setting charging information indication by
information element group
##### 7.2.4.15.1 General
A possible solution for key issue #2a and #2b, the charging information for 5G
data connectivity provided to the CHF in the visited MNO and CHF in home MNO
(via V-CHF) in single charging session, V-SMF is responsible for the charging
reporting for the V-CHF and H-CHF, V-SMF sets an indication for a group of
information elements for V-CHF, and sets another indication for the other
group of information elements for H-CHF.
##### 7.2.4.15.2 Reference architecture
The reference architecture would be the same as figure 7.2.4.1.2-2.
##### 7.2.4.15.3 Message flows
In step 1 of message flow figure 7.2.4.1.3-1, take the following charging
information of FBC for example, the V-SMF set two indications for two groups
of information elements, one indication is for V-CHF, the other indication is
for H-CHF.
Table 7.2.4.15.3-1: Structure of Roaming QBC Information
+----------------------------------------+ | Multiple Unit Usage (Group2 for V-CHF) | +========================================+ | > Rating Group | +----------------------------------------+ | > Used Unit Containerr | +----------------------------------------+ | > Target Indication: V-CHF | +----------------------------------------+ | Multiple Unit Usage (Group2 for H-CHF) | +----------------------------------------+ | > Rating Group | +----------------------------------------+ | > Requested Unit | +----------------------------------------+ | > Used Unit Container | +----------------------------------------+ | > Target Indication: H-CHF | +----------------------------------------+
#### 7.2.4.16 Solution #2.16: CDF and OCF communicating with SMS-SC for retail
charging of SMS
##### 7.2.4.16.1 General
A possible solution for key issues #2f and #2g covering requirements REQ-
CH_CVTOH-03, and REQ-CH_CVTOH-04, wholesale charging for SMS provided to the
home MNO by the visited MNO. In this case the home MNO uses charging
architecture defined in TS 32.240 [12] annex E, to generate charging
information.
This solution is based on the architecture in clause 4.4.2 of TS 23.501 [2].
##### 7.2.4.16.2 Reference architecture
In the below architectures the CHF in home MNO is only added for completes and
the SMS-SC will only interact with the CDF and OCF.
Figure 7.2.4.16.2-1: Roaming SMS scenario in service-based interface
representation
Figure 7.2.4.16.2-2: Roaming SMS scenario in reference point representation
##### 7.1.4.16.3 Message flows
The flows for SMS charging would be the same as in TS 32.274 [8], that are
based on the interactions specified in TS 23.540 [10] and TS23.040 [11].
#### 7.2.4.17 Solution #2.17: configure the roaming charging profile update
##### 7.2.4.17.1 General
A possible solution for key issue #2e covering requirements REQ-CH_CVTOH-01,
and REQ-CH_CVTOH-02.
In some 5G use case, PDU session may keep for a long time, it's possible that
triggers in HPLMN change during PDU session for some reason like user
subscription change, if so, the triggers in VPLMN needs to keep alignment with
HPLMN.
##### 7.2.4.17.2 Reference architecture
The reference architecture would be the same as the local breakout
architecture in solution #2.2 clause 7.2.4.2 or Home Routed architecture in
Figure 4.2.4 of TS 32.255.
##### 7.2.4.17.3 Message flows
The message flow is same with the PDU session establishment message flow in
clause 5.2.2.12.2 or 5.2.2.18.2 of TS 32.255 [4]. If the roaming charging
profile is requested at the PDU session establishment by the V-SMF, the H-CHF
may provide multiple Roaming Charging Profiles in the charging data response
at the PDU session establishment, some Roaming Charging Profiles are with
Profile change time, some Roaming Charging Profiles are without Profile change
time, the Roaming Charging Profiles without Profile change time are applied
immediately, the Roaming Charging Profiles with Profile change time are
applied at the Profile change time.
Table 7.2.4.x.3-1 is an example of two Roaming Charing Profiles. One Roaming
Charging Profile is with Profile change time, the other Roaming Charging
Profile is without Profile change time, the Roaming Charging Profile without
Profile change time is applied immediately, the Roaming Charging Profile with
Profile change time is applied at the Profile change time.
Table 7.2.4.17.3-1: Multiple Roaming Charing Profiles
+--------------------------------------------+ | Roaming Charging Profile | +--------------------------------------------+ | > Trigger | +--------------------------------------------+ | > Trigger type | +--------------------------------------------+ | > Trigger category | +--------------------------------------------+ | > Time Limit | +--------------------------------------------+ | > Volume Limit | +--------------------------------------------+ | > Max Number of charging condition changes | +--------------------------------------------+ | > Partial record method | +--------------------------------------------+ | Roaming Charging Profile | +--------------------------------------------+ | > Trigger | +--------------------------------------------+ | > Trigger type | +--------------------------------------------+ | > Trigger category | +--------------------------------------------+ | > Time Limit | +--------------------------------------------+ | > Volume Limit | +--------------------------------------------+ | > Max Number of charging condition changes | +--------------------------------------------+ | > Partial record method | +--------------------------------------------+ | > Profile change time | +--------------------------------------------+
#### 7.2.4.18 Solution #2.18: Roaming charging profile update CHF-to-CHF
##### 7.2.4.18.1 General
A possible solution for key issue #2e covering requirements REQ-CH_CVTOH-01,
and REQ-CH_CVTOH-02, trigger handling between VPLMN and HPLMN, is to use the
roaming charging profile and allow it to be updated.
##### 7.2.4.18.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1.
##### 7.2.4.18.3 Message flows
The Roaming charging profile may be requested at any time by the V-SMF. This
means that the V-SMF could include it in every charging data request, allowing
the V-SMF, V-CHF or H-CHF to change it:
1\. The V-SMF includes Roaming charging profile in a Charging data request
[Update] to V-CHF
2\. Changed by V-CHF and transferred to H-CHF
3\. Changed by H-CHF and transferred to V-CHF
4\. Transferred from V-CHF to V-SMF
5\. Applied in V-SMF
#### 7.2.4.19 Solution #2.19: Charging session between V-CHF and H-CHF per
charging session between NF and V-CHF
##### 7.2.4.19.1 General
A possible solution for key issue #2j, would be to have the charging session
between V-CHF and H-CHF with the same granularity as the interaction between
NF(CTF) and V-CHF.
  * Regarding the session-based charging scenario (e.g. SCUR), V-CHF would establish the charging session with H-CHF on a per PDU session basis.
  * Regarding the event-based charging scenario (e.g. IEC, PEC), V-CHF would establish the charging session with H-CHF on a per event basis.
##### 7.2.4.19.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1.
##### 7.2.4.19.3 Message flows
In this case, the SMF, AMF, and SMSF establish the charging session and events
with the V-CHF per as specified in the TS 32.255 [4], TS 32.256 [5], and TS
32.274 [8]. The V-CHF would establish the charging session with the H-CHF
based on the charging session between NF(CTF) and V-CHF.
The message flow for session-based charging scenario is the same as the figure
7.2.4.1.3-1 in solution #2.1. Applicable for SMF.
The message flow for event-based charging scenario is the same as the figure
7.2.4.1.3-2 (IEC) and figure 7.2.4.1.3-3 (PEC) in solution #2.1. Applicable
for SMSF and AMF.
#### 7.2.4.20 Solution #2.20: Charging message exchange between V-CHF and
H-CHF based on quota management
##### 7.2.4.20.1 General
A possible solution for key issue #2e, the trigger for interaction for V-CHF
communicating with H-CHF, i.e. message exchange between V-CHF and H-CHF, is
based on the quota management. In other words, V-CHF may trigger a charging
data request to H-CHF only when receiving a charging data requests from
NF(CTF) that the requested units exceed the granted quota managed at V-CHF.
\- Quota management at V-CHF: V-CHF could reserve a large amount of quota
granted by H-CHF and distribute quota to NF(CTF) based on the units requested
in a charging data request. This requires V-CHF to manage a large amount of
quota granted by H-CHF.
\- The reservation for a large amount of quota could either initiated by H-CHF
or V-CHF. V-CHF could request for a large amount of quota from H-CHF upon the
reception of the first charging data request per PDU session. Alternatively,
H-CHF could assign a large amount of quota upon receiving the charging data
requests from V-CHF based on internal unit determination, e.g. estimating the
upcoming unit requests from a roaming subscriber within a short period of
time.
\- The interaction between V-CHF and H-CHF for requesting and granting a large
amount of quota reuses the Nchf_ConvergedCharing service API.
NOTE: Large amount of quota refers to that the V-CHF request a larger amount
from the H-CHF than it is requested from the NF(CTF).
##### 7.2.4.20.2 Reference architecture
The reference architecture would be the same as in solution #2.1 clause
7.2.4.1.
##### 7.2.4.20.3 Message flows
Figure 7.2.4.20.3-1 shows the message flow of charging message exchanges
between V-CHF and H-CHF based on quota management for Session Based Charging
(SCUR). Applicable for SMF. V-CHF interacts with H-CHF when granted quota is
not enough to support the request from NF. As noted, there are two possible
ways of initiating the reservation of a large amount of quota by V-CHF, either
triggered by V-CHF or H-CHF. This figure assumes that V-CHF triggers the
request for a large amount of quota from H-CHF. The alternative way where
H-CHF actively grant a large amount of quota to V-CHF is also applicable.
The message flow for event-based charging scenario is the same as the figure
7.2.4.1.3-2 (IEC) and figure 7.2.4.1.3-3 (PEC) in solution #2.1. Applicable
for AMF and SMSF.
Step 1 to 12 describe the message flow of the delivery procedure for
establishing a PDU session. At the establishment of the PDU session, V-CHF
setup an interaction session with H-CHF for exchanging charging information.
In addition, V-CHF request for a large amount of quota from H-CHF that are
expected to support multiple requests from NF. Step 13 starts to deliver
service.
  1. **Request for service delivery:** A request for session establishment is received in NF (CTF).
  2. **Units determination:** NF (CTF) determines the number of units depending on the service requested by the UE in \"Decentralized Units determination\" scenario.
  3. **Charging data request [Initial, Quota requested]:** NF (CTF) sends an initial charging data request to V-CHF for the service to be granted authorization to start, and to reserve the number of units if determined in item b.
  4. **Determine H-CHF:** V-CHF creates a charging resource for the NF (CTF), determines which H-CHF it should contact, and generates an initial charging home request to H-CHF.
  5. **Charging home request [Initial, Quota-2 requested]:** V-CHF sends the request to H-CHF for the service to be granted authorization to start, and to reserve a large number of units that might support ongoing services.
  6. **Account, Rating, Reservation control:** H-CHF rates the charging home requests either based on the number of units requested or on internal unit determination, checks if corresponding funds can be reserved on the user\'s account balance. If the account has sufficient funds, H-CHF performs the corresponding reservations.
  7. **Open CDR:** based on policies, H-CHF opens a CDR related to the service.
  8. **Charging home response [Initial, Quota-2 granted]:** H-CHF grants authorization to V-CHF for the service to start, with the requested large number of units for V-CHF to supervise.
  9. **Quota management:** V-CHF checks if the units requested by NF is sufficient based on the available number of units that has been granted by H-CHF. If the account has sufficient funds, V-CHF performs the corresponding unit reservations.
  10. **Open CDR:** based on policies, V-CHF opens a CDR related to the service.
  11. **Charging data response [Initial, Quota granted]:** V-CHF grants authorization to NF (CTF) for the service to start, with the reserved number of units.
  12. **Granted units supervision:** NF (CTF) monitors the consumption of the granted units.
  13. **Start of service delivery:** NF (CTF) starts to deliver the content/service based on the reserved number of units.
Step 14 to 19 describe the message flow of a quota management and usage
reporting procedure where V-CHF has enough units reserved by H-CHF to support
the current request. Step 20 describes ongoing services that could be
supported by the granted large amount of quota.
  1. **Quota management trigger:** A trigger associated to quota management is met. Unit determination is performed when applicable.
  2. **Charging data request [Update, Unit used, Quota requested]:** NF (CTF) sends an intermediate charging data request to V-CHF, for more units to be granted for the service to continue and reporting the used units.
  3. **Quota management:** V-CHF checks if the units requested by NF is sufficient based on the available number of units that has been granted by H-CHF. If the account has sufficient funds, V-CHF performs the corresponding unit reservations.
  4. **Update CDR:** based on policies, H-CHF updates the CDR with charging data related to the service.
  5. **Charging data response [Update, Quota granted]:** V-CHF grants quota to NF (CTF) for the service to continue, with the reserved number of units.
  6. **Granted units supervision:** NF (CTF) monitors the consumption of the granted units.
  7. **Service delivery ongoing:** ongoing service delivery for additional requests.
Step 21 to 33 describe the message flow of a quota management and usage
reporting procedure where V-CHF does not have enough units reserved by H-CHF
to support the current request. Step 33 describes ongoing services. Step 34
release the service, followed with the post delivery procedure.
  1. **Quota management trigger:** A trigger associated to quota management is met. Unit determination is performed when applicable.
  2. **Charging data request [Update, Unit used, Quota requested]:** NF (CTF) sends an intermediate charging data request to V-CHF, for more units to be granted for the service to continue and reporting the used units.
  3. **Quota management:** V-CHF checks if the units requested by NF is sufficient based on the available number of units that has been granted by H-CHF. If the account has sufficient funds, V-CHF performs the corresponding unit reservations. Otherwise, V-CHF initiates to request for additional large amount of quota from H-CHF.
  4. **Q request trigger:** A trigger associated to request a large amount of quota is met. A large amount of unit determination is performed when applicable.
  5. **Charging home request [Update, Unit used, Quota-2 requested]:** V-CHF sends an intermediate charging home request to H-CHF, for additional large bundle of units to be granted for the service to continue and reporting the used units.
  6. **Account, Rating, Reservation control:** H-CHF performs the process related to the reported usage and the requested reservation, involving rating entity and user\'s account balance.
  7. **Update CDR:** based on policies, H-CHF updates the CDR with charging data related to the service.
  8. **Charging home response [Update, Quota-2 granted]:** H-CHF grants quota to V-CHF for the service to continue, with the reserved large number of units for V-CHF to supervise.
  9. **Bundled quota management:** V-CHF checks if the units requested by NF is sufficient based on the available number of units that has been granted by H-CHF. If the account has sufficient funds, V-CHF performs the corresponding unit reservations.
  10. **Update CDR:** based on policies, V-CHF updates the CDR with charging data related to the service.
  11. **Charging data response [Update, Quota granted]:** V-CHF grants quota to NF (CTF) for the service to continue, with the reserved number of units.
  12. **Granted units supervision:** NF (CTF) monitors the consumption of the granted units.
  13. **Service delivery ongoing:** describes ongoing service delivery, which might contain additional requests for quota.
  14. **Service release:** release the service.
### 7.2.5 Evaluation
Solutions #2.1 and #2.2 both solves key issues #2a and #2b and handles the
transport of the charging information.
\- Solution #2.1 uses a new CHF-to-CHF communication, requires CHF
enhancements, and solves more key issues. Allowing the CHF to also be a
consumer of the Nchf_ConvergedCharging service would allow for more
integration possibilities.
\- Solution #2.2 uses V-SMF to both V-CHF and H-CHF communication and is
supported in the scope of 5G connectivity charging.
Solutions #2.13, #2.14 and #2.15 all solves key issues #2a and #2b and handles
selection of charging information.
\- Solution #2.13 the V-CHF selects the information to be reported to H-CHF.
Put new requirements on the V-CHF to select information to be sent to the
H-CHF.
\- Solution #2.14 the V-SMF marks the information elements to be sent to the
H-CHF. This will require more data sent between the V-SMF and V-CHF, and it
will be the V-CHF that is responsible for using this information to select
information to be sent to the H-CHF.
\- Solution #2.15 the V-SMF sends separate information elements for the
information to be sent to the H-CHF. This will duplicate data sent between the
V-SMF and V-CHF, and it will be the V-CHF that is responsible for using this
information to select information to be sent to the H-CHF.
Solutions #2.8 and 2.9 both solves key issues #2c.
\- Solution #2.8 uses NRF to find the H-CHF.
\- Solution #2.9 uses SUPI to find the H-CHF and can supported the case when
there is limited H-NRF access.
\- Both solutions can be supported at the same time depending on the visitor
MNO and agreement with home MNO.
Solutions #2.6 and #2.7 both solves key issues #2d.
\- Solution #2.6 reuses the Nchf_ConvergedCharging between CHFs and may add
additional charging information to better support CHF-to-CHF communication.
\- Solution #2.7 uses a new Nchf service and would have different messages as
well as triggers.
The H-CHF will still do converged charging for the UE in the current scenario,
meaning that a new service isn't required.
Solutions #2.10, #2.11, #2.12, #2.17, #2.18, and #2.20 all solves key issues
#2e.
\- Solution #2.10 the trigger for the CHF-to-CHF communication is based on the
UE identity, this will mean that from the both the V-CHF and H-CHF the CHF-to-
CHF session will have a different lifetime and trigger handling than the V-SMF
to V-CHF and the AMF to V-CHF.
\- Solution #2.11 the trigger for the CHF-to-CHF communication is based on the
reception of a charging data request, this will mean that from the H-CHF point
of view the triggers will happen like it would be directly from the V-SMF or
from AMF. The V-CHF would forward some sessions to the H-CHF.
\- Solution #2.20 allows the frequency of CHF-to-CHF communication based on
quota management. This implies that V-CHF would manage a large amount of quota
and only triggers request to H-CHF when quota is not enough to support the
requested units from NF. This solution would reduce the amount of V-CHF-to-H-
CHF message exchanges and quota management latency in LBO scenario. It
requires V-CHF to be included in a CCS with functions such as ABMF to support
quota management.
\- Solution #2.12 handles how the roaming charging profile could be updated in
the case where the V-SMF communicated with both V-CHF and H-CHF.
\- Solution #2.17 allows a time-based change of the Roaming charging profile,
by adding more information (i.e. pending changes) in the roaming charging
profile. There are currently no use case, requirement or key issues defined
for this.
\- Solution #2.18 handles how the roaming charging profile updated in the case
where the CHF-to-CHF scenario.
Solutions #2.1, #2.4, #2.16 all solves key issues #2f and #2g.
\- Solution #2.1 uses a new CHF-to-CHF communication, requires CHF
enhancements, and solves more key issues. Allowing the CHF to also be a
consumer of the Nchf_ConvergedCharging service would allow for more
integration possibilities.
\- Solution #2.4 uses a new SMSF to both V-CHF and H-CHF communication.
\- Solution #2.16 uses Diameter communication between SMS-SC and charging
system and is supported in the scope of SMS charging.
Solutions #2.1 and #2.5 both solves key issues #2h and #2i.
\- Solution #2.1 uses a new CHF-to-CHF communication, requires CHF
enhancements, and solves more key issues. Allowing the CHF to also be a
consumer of the Nchf_ConvergedCharging service would allow for more
integration possibilities.
\- Solution #2.5 uses AMF to both V-CHF and H-CHF communication and is
supported in the scope of 5G connection and mobility charging as is.
Solutions #2.19 and #2.10 solves key issue 1j.
  * Solution #2.11 allows the granularity of charging session between V-CHF and H-CHF aligns with the charging session between NF(CTF) and V-CHF.
  * Solution #2.10 allows to have the charging session between V-CHF and H-CHF for each UE (i.e. identified by SUPI). In this case, the granularity of charging session might not align with the charging session between NF(CTF) and V-CHF, i.e. containing multiple charging sessions between NF(CTF) and V-CHF for each UE.
### 7.2.6 Conclusion
For key issues #2a and 2b, 5G connectivity charging, solution using CHF-to-CHF
communication can be an additional solution in normative work i.e., allowing
both solutions #2.1 and #2.2.
For key issues #2h and 2i,5G connection and mobility charging, solution using
CHF-to-CHF communication can be an additional solution in normative work i.e.,
allowing both solutions #2.1 and #2.5.
For key issues #2f and 2g, SMS charging, solution using Diameter connection
from SMS-SC can be a solution in normative work i.e., solution #2.16.
For key issue #2e allowing the Roaming charging profile to be updated at any
time should be taken into normative work i.e., solutions #2.12 and 2.18.
For solution #2.1 the following conclusions apply:
\- based on solution #2.1, using a single session between NF (e.g. AMF, SMF or
SMSF) and V-CHF carrying both the information for V-CHF and H-CHF, should be
taken into normative work;
\- based on solution #2.6, Nchf_ConvergedCharging service API reused to the
interaction between V-CHF and H-CHF should be taken into normative work;
\- based on both solution #2.8 and #2.9, finding the H-CHF can allow the use
of both NRF and SUPI, should be taken into normative work;
\- based on solution #2.11, the trigger for the CHF-to-CHF communication based
on the reception of a charging data request, should be taken into normative
work;
\- based on solution #2.20, allowing the V-CHF to request more quota from the
H-CHF than was requested from the NF, should be taken into normative work. The
handling of the quota, that is in excess of what was requested by the NF, in
the visited network CCS is considered outside the scope;
\- based on solution #2.13, V-CHF selected charging information for reporting
to H-CHF should be taken into normative work.
## 7.3 Charging in an MNO for the purpose of wholesale charging towards an
additional actor
### 7.3.1 Use cases
#### 7.3.1.1 Use case #3a: MNO does wholesale charging for 5G data
connectivity towards additional actors
This use case focuses on MNO and MVNO business roles.
A subscriber has a UE and a subscription with the MVNO which allows usage of
5G data connectivity while in the home MNO.
The MNO to MVNO charging could be based on data volume that the MVNO UE has
used in the MNO's network considering of the following aspects:
\- RAT type;
\- S-NSSAI;
\- DNN;
\- QoS information.
#### 7.3.1.2 Use case #3b: MNO does wholesale charging for 5G connection and
mobility towards additional actors
This use case focuses on MNO and MVNO (additional actor) business roles.
A CSC (UE) has a subscription with the additional actor which allows usage of
5G data connectivity connection and mobility.
The home MNO to additional actor charging is based number of home MNO's UEs
(i.e. unique SUPI) connected to the visited MNO's network over a specific
period of time.
#### 7.3.1.3 Use case #3c: MNO does wholesale charging for 5G SMS towards
additional actors
This use case focuses on MNO and MVNO (additional actor) business roles.
A CCS (UE) has a subscription with the MVNO which allows usage of SMS over NAS
in 5GS.
The home MNO to additional actor charging could be based on number of SMS sent
or received by the additional actor's UEs served by the home MNO's network
considering of the following aspects:
\- RAT type;
\- Location
### 7.3.2 Potential charging requirements
**REQ-CH_MNOMVNO-01:** The charging mechanism in MNO should support collecting
charging information related to 5G data connectivity usage for each MVNO.
**REQ-CH_MNOMVNO-02:** The charging mechanism in MNO should support collecting
charging information related to 5G connection and mobility usage for each
MVNO.
**REQ-CH_MNOMVNO-03:** The charging mechanism in MNO should support collecting
charging information related to SMS usage for each MVNO.
### 7.3.3 Key issues
The following key issues are identified:
\- **Key Issue #3a** : Collection of charging information in home MNO about
the 5G data connectivity usage per MVNO.
\- **Key Issue #3b** : Collection of charging information in home MNO about
the 5G connection and mobility usage per MVNO.
\- **Key Issue #3c** : Collection of charging information in home MNO about
the SMS usage per MVNO.
7.3.4 Potential solutions
#### 7.3.4.1 Solution #3.1: CDR in home MNO for wholesale of non-roaming 5G of
additional actor without CHF
##### 7.3.4.1.1 General
A possible solution for key issue #3a, #3b, and #3c covering requirements REQ-
CH_MNOMVNO-01, REQ-CH_MNOMVNO-02, and REQ-CH_MNOMVNO-03, charging for 5G data
connectivity, connection and mobility, SMS, provided to the additional actor
by the home MNO, covering non-roaming case.
##### 7.3.4.1.2 Reference architecture
Figure 7.3.4.2-1: Additional actor 5G scenario in service-based interface
representation
Figure 7.3.4.1.2-2: Additional actor 5G scenario in reference point
representation
The AMF, SMF, and SMSF with CTF interact with CHF using Nchf interface,
without any requirement of quota management. The CCS produces CDRs which may
be send for wholesale charging which then can be used to aggregate and
calculate the amount of data per additional actor, it could be done based on
SUPI, IMSI series, SNSSAI(s), DNN(s) etc., the wholesale part is only included
for completeness and is currently outside the scope of 3GPP SA5.
##### 7.3.4.1.3 Message flows
The flows would be the same as the non-roaming cases in clause 5.2.2 of TS
32.255 [4], clause 5.2.2 of TS 32.256 [5] and clause 5.4.2 of TS 32.274 [8].
#### 7.3.4.2 Solution #3.2: CDR in home MNO for wholesale of non-roaming 5G of
additional actor with CHF
##### 7.3.4.2.1 General
A possible solution for key issue #3a, #3b, and #3c covering requirements REQ-
CH_MNOMVNO-01, REQ-CH_MNOMVNO-02, and REQ-CH_MNOMVNO-03, charging for 5G data
connectivity, connection and mobility, SMS, provided to the additional actor
(owning a CHF) by the home MNO, covering non-roaming case.
##### 7.3.4.2.2 Reference architecture
The architecture would be the same as in solution #1.3, clause 7.1.4.3.2, and
solution #1.6, clause 7.1.4.6.2, where the Visited MNO is replaced by the Home
MNO and the Home MNO is replaced by the Additional Actor.
##### 7.3.4.2.3 Message flows
The flow would be the same as clauses 7.1.4.3.3 and 7.1.4.6.3 where the V-CHF
corresponds to the home MNO's CHF and the H-CHF corresponds to the additional
actor's CHF.
### 7.3.5 Evaluation
Solutions #3.1 and #3.2 both solves key issues #3a, #3b, and #3c.
\- Solution #3.1 doesn't require the additional actor to have a CHF.
\- Solution #3.2 requires the additional actor to have a CHF.
Both can be supported at the same time depending on the home MNO and agreement
with additional actor.
### 7.3.6 Conclusion
Both solutions (#3.1 and #3.2) should be taken into normative work and
described in informational annexes in TS 32.255 [4] and TS 32.256 [9] as a
deployment options.
## 7.4 Convey charging information from an MNO to an additional actor
### 7.4.1 Use cases
#### 7.4.1.1 Use case #4a: Additional actor does retail charging for 5G data
connectivity
This use case focuses on additional actor (e.g., MVNO) and subscriber business
roles.
A subscriber has a UE and a subscription with the additional actor which
allows usage of 5G data connectivity. The additional actor has their own
billing system and charging function (CHF), but no other NFs.
The additional actor charging of the subscriber could be based on data volume
that the UE has used in the MNO's network considering of the following
aspects:
\- RAT type;
\- S-NSSAI;
\- DNN;
\- QoS information.
#### 7.4.1.2 Use case #4b: Additional actor does retail billing for 5G data
connectivity
This use case focuses on additional actor (e.g., MVNO) and subscriber business
roles.
A subscriber has a UE and a subscription with the additional actor which
allows usage of 5G data connectivity. The additional actor has their own
billing system, but no CHFs.
The additional actor charging of the subscriber could be based on data volume
that the UE has used in the home MNO's network considering of the following
aspects:
\- RAT type;
\- S-NSSAI;
\- DNN;
\- QoS information.
#### 7.4.1.3 Use case #4c: Use case for additional actor does wholesale
charging for 5G data connectivity towards another additional actor
This use case focuses on home MNO and additional actor (wholesaler] roles.
A subscriber has a UE and a subscription with an additional actor (retailer)
which allows usage of 5G data connectivity. The additional actor (retailer)
has an agreement with another additional actor (wholesaler) for usage of 5G
data connectivity, the other additional actor (wholesaler) in turn has
agreement with the home MNO for 5G data connectivity, this allows the
additional actor's (retailer) subscribers (UEs) to use the home MNO's network.
The additional actors have their own billing system and charging function
(CHFs), but no other NFs.
The additional actor (wholesaler) charging of the additional actor (retailer)
could be based on data volume that additional actor's (retailer) subscribers
(UEs) has used in the home MNO's network considering of the following aspects:
\- RAT type;
\- S-NSSAI;
\- DNN;
\- QoS information.
### 7.4.2 Potential charging requirements
**REQ-CH_CHTOA-01:** The charging mechanism in MNO should support conveying
charging information for the 5G data connectivity usage to the MVNO for each
UE.
**REQ-CH_ CHTOA-02:** The charging mechanism in MNO should support collecting
charging information related to 5G data connectivity usage for each UE.
### 7.4.3 Key issues
The following key issues are identified:
\- **Key Issue #4a** : Collection of charging mechanism in MNO about the 5G
data connectivity usage.
\- **Key Issue #4b:** Conveying the charging information to the MVNO
\- **Key Issue #4c:** Finding the additional actor's CHF
**\- Key Issue #4d:** Service based interface to use towards the additional
actor's CHF
**\- Key Issue #4e:** Trigger handling towards the additional actor's CHF
### 7.4.4 Potential solutions
#### 7.4.4.1 Solution #4.1: Home SMF (CTF) communicating with both H-CHF and
A-CHF for retail charging of 5G data connectivity
##### 7.4.4.1.1 General
The possible solutions for key issues #4a and #4b covering requirements REQ-
CH_CHTOA-01, and REQ-CH_CHTOA-02, retail charging for 5G data connectivity
provided by the additional actor, to the MVNO by the home MNO.
##### 7.4.4.1.2 Reference architecture
Figure 7.4.4.1.2-1: Additional actor with only CHF 5G data connectivity
scenario in service-based interface representation
Figure 7.4.4.1.2-2: Additional actor with only CHF 5G data connectivity
scenario in service-based interface representation
The MNO CHF interacts with the additional actor CHF does converged charging
for the subscriber.
##### 7.4.4.1.3 Potential charging flows
The flows would be the same as in clause 7.2.4.2 where the V-CHF corresponds
to the home MNO's CHF and the H-CHF corresponds to the additional actor's CHF.
#### 7.4.4.2 Solution #4.2: Additional actor only does retail billing of
subscribers
##### 7.4.4.2.1 General
The possible solutions for key issues #4a and #4b covering requirements REQ-
CH_CHTOA-01, and REQ-CH_CHTOA-02, retail billing for 5G data connectivity by
the additional actor, the 5G data connectivity is provided by the home MNO.
##### 7.4.4.2.2 Reference architecture
Figure 7.4.4.2.2-1: Additional actor with only billing 5G data connectivity
scenario in service-based interface representation
Figure 7.4.4.2.2-2: Additional actor with only billing 5G data connectivity
scenario in service-based interface representation
The home MNO CCS produces CDRs that the additional actor uses for billing of
the subscriber.
##### 7.4.4.2.3 Potential charging flows
The flows would be the same as in clause 7.1.4.1.2 where the V-CHF corresponds
to the home MNO's CHF and the interconnect would be replaced by sending
information for retail charging.
#### 7.4.4.3 Solution #4.3: H-CHF communicating with A-CHF for retail charging
of 5G
##### 7.4.4.3.1 General
A possible solution for key issues #4a and #4b covering requirements REQ-
CH_CHTOA-01, and REQ-CH_CHTOA-02, retail charging for 5G data connectivity, 5G
connection and mobility, and SMS usage provided to the additional actor's
users by the home MNO.
The home CHF does converged charging for interconnect, while the additional
actor CHF does converged charging for the subscriber.
##### 7.4.4.3.2 Reference architecture
Figure 7.2.4.3.2-1: MNO -- Additional actor5G scenario in service-based
interface representation
Figure 7.2.4.3.2-2: MNO -- Additional actor5G scenario in reference point
representation
##### 7.4.4.3.3 Message flows
This would be same as for solution #2.1 in clause 7.2.4.1 where the H-CHF is
changed to A-CHF, and the V-CHF is changed to CHF.
#### 7.4.4.4 Solution #4.4: Reusing Nchf_ConvergedCharging service API between
CHFs
##### 7.4.4.4.1 General
A possible solution for key issue #4d covering requirements REQ-CH_CVTOA-01
and REQ-CH_CVTOA-02, service based interface to use between home CHF and
additional actor CHF, would be to reuse the Nchf_ConvergedCharging service
API. This would mean that the H-CHF would proxy the request from the AMF, SMF
or SMSF to the A-CHF, and the same with the response. The H-CHF could do some
changes to message like: filter (e.g. trigger), enrich, or convert (e.g.,
rating groups).
##### 7.4.4.4.2 Reference architecture
The reference architecture would be the same as in solution #4.3 clause
7.4.4.3.
#### 7.4.4.5 Solution #4.5: New Nchf service API between CHFs
##### 7.4.4.5.1 General
A possible solution for key issue #4d covering requirements REQ-CH_CVTOA-01
and REQ-CH_CVTOA-02, service based interface to use between home CHF and
additional actor CHF, would be to create a new service API. This would mean
that the H-CHF would translate the request from the AMF, SMF or SMSF to the
new service API towards the H-CHF. This would mean that the message could look
completely different and even the triggers in the H-CHF for sending the
message towards the A-CHF wouldn't have to be related to the request from AMF,
SMF or SMSF.
##### 7.4.4.5.2 Reference architecture
The reference architecture would be the same as in solution #4.3 clause
7.4.4.3.
#### 7.4.4.6 Solution #4.6: Using NRF to find A-CHF
##### 7.4.4.6.1 General
A possible solution for key issue #4c, finding the correct CHF for solution
#4.3 where H-CHF communicating with A-CHF.
##### 7.4.4.6.2 Reference architecture
The reference architecture would be the same as in solution #4.3 clause
7.4.4.3.
##### 7.4.4.6.3 Message flows
The H-CHF would in this case use the NRF provided service to find the A-CHF,
the selection can be based on any available attribute such as SUPI, CHF group,
etc., where the A-CHF would be registered in the NRF.
#### 7.4.4.7 Solution #4.7: Using local configuration to find A-CHF
##### 7.4.4.7.1 General
A possible solution key issue #4c, finding the correct CHF for solution #4.3
where H-CHF communicating with A-CHF.
##### 7.4.4.7.2 Reference architecture
The reference architecture would be the same as in solution #4.3 clause
7.4.4.3.
##### 7.4.4.7.3 Message flows
The H-CHF would in this case use the SUPI e.g., SUPI lists, IMSI number
series, to find the A-CHF. In this case the A-CHF address would be pre-
provisioned in the H-CHF and allocated for example to a SUPI list or an IMSI
series.
#### 7.4.4.8 Solution #4.8: Charging data request triggered CHF and A-CHF
communication
##### 7.4.4.8.1 General
A possible solution for key issue #4e, the trigger for interaction for CHF
communicating with A-CHF is based on the reception of a charging data request
by the CHF.
##### 7.4.4.8.2 Reference architecture
The reference architecture would be the same as in solution #4.3 clause
7.4.4.31.
##### 7.4.4.8.3 Message flows
This would be same as for solution #2.11 in clause 7.2.4.11 where the H-CHF is
changed to A-CHF, and the V-CHF is changed to CHF.
### 7.4.5 Evaluation
Solutions #4.1, #4.2, and #4.3 all solves key issues #4a and #4b.
\- Solution #4.1 uses V-SMF to both H-CHF and A-CHF communication and is
supported in the scope of non-roaming 5G connectivity charging.
\- Solution #4.2 is outside the current scope of 3GPP SA5.
\- Solution #4.3 uses a new CHF-to-CHF communication and requires CHF
enhancements. Allowing the CHF to also be a consumer of the
Nchf_ConvergedCharging service would allow for more integration possibilities.
Solutions #4.6 and #4.7 both solves key issues #4c.
\- Solution #4.6 uses NRF to find the A-CHF.
\- Solution #4.7 uses local configuration to find the A-CHF and can support
the case when there is no A-NRF.
\- Both solutions can be supported at the same time depending on the home MNO
and agreement with additional actor.
Solutions #4.4 and #4.5 both solves key issues #4d.
\- Solution #4.4 reuses the Nchf_ConvergedCharging between CHFs and may add
additional charging information to better support CHF-to-CHF communication.
\- Solution #4.5 uses a new Nchf service and would have different messages as
well as triggers.
Solution #4.8 solves key issue #4e.
\- Solution #4.8 reuses the solution #2.11 where the trigger for interaction
for V-CHF communicating with H-CHF is based on the reception of a charging
data request by the A-CHF.
### 7.4.6 Conclusion
For key issues #4a and #4b, 5G connectivity charging, solution using CHF-to-
CHF communication can be an additional solution in normative work i.e.,
allowing both solutions #4.1 and #4.3.
For solution #4.3 the following conclusions apply:
\- based on solution #4.4, where Nchf_ConvergedCharging service API is reused
for the interaction between H-CHF and A-CHF should be taken into normative
work;
\- based on both solution #4.6 and #4.7, finding the H-CHF can allow the use
of both NRF and SUPI, should be taken into normative work;
\- based on solution #4.8, the trigger for the CHF-to-CHF communication based
on the reception of a charging data request, should be taken into normative
work;
## 7.5 Convey charging information from visited MNO to home MNO, and home MNO
to an additional actor
### 7.5.1 Use cases
#### 7.5.1.1 Use case #5a: Use case for additional actor does retail changing
for 5G data connectivity while roaming
This use case focuses on visited MNO, home MNO, MVNO and subscriber business
roles.
A subscriber has a UE and a subscription with the MVNO which allows usage of
5G data connectivity. The MVNO has their own billing system and charging
function (CHF), but no other NFs. The MVNO has an agreement with the home MNO
that allows its subscribers roaming and the home MNO as a roaming agreement
with the visited MNO.
The MVNO charging of the subscriber could be based on data volume that the UE
has used in the visited MNO's network considering of the following aspects:
> \- RAT type;
>
> \- S-NSSAI;
>
> \- DNN;
>
> \- QoS information.
### 7.5.2 Potential charging requirements
**REQ-CH_CVTOHTOA-01:** The charging mechanism in visited MNO should support
conveying charging information for the 5G data connectivity usage to home MNO,
allowing further conveying it to the MVNO for each UE.
**REQ-CH_ CVTOHTOA-02:** The charging mechanism in home MNO should support
conveying charging information for the 5G data connectivity usage to MVNO for
each UE.
**REQ-CH_ CVTOHTOA-03:** The charging mechanism in MVNO should support
receiving charging information related to 5G data connectivity usage for each
UE.
### 7.5.3 Key issues
The following key issues are identified:
\- **Key Issue #5a** : Collection of charging mechanism in visited MNO about
the 5G data connectivity usage.
\- **Key Issue #5b:** Conveying the charging information from visited to the
home MNO
\- **Key Issue #5c:** Conveying the charging information to the home MNO and
MVNO
\- **Key Issue #5d:** Finding the correct CHF in home MNO and MVNO
**\- Key Issue #5e:** Service based interface to use between visited CHF, home
CHF and MVNO
**\- Key Issue #5f:** Trigger handling between visited CHF, home CHF and MVNO
### 7.5.4 Potential solutions
#### 7.5.4.1 Solution #5.1: CHF to CHF communication
##### 7.5.4.1.1 General
A possible solution for key issue #5a, #5b, and #5c covering requirements REQ-
CH_CVTOHTOA-01, REQ-CH_CVTOHTOA-02, and REQ-CH_CVTOHTOA-03, charging for 5G
roaming provided to the additional actor by the visited MNO through the home
MNO.
##### 7.5.4.1.2 Reference architecture
Figure 7.5.4.1.2-1: Additional actor with only CHF 5G roaming scenario in
service-based interface representation
Figure 7.5.4.1.2-2: Additional actor with only CHF 5G roaming scenario in
reference point representation
The visited and home MNO CHF does converged charging for interconnect, while
the additional actor CHF does converged charging for the subscriber.
##### 7.5.4.1.3 Message flows
This would be a combination of the flows in clauses 7.2.4.1 and 7.4.4.3.
#### 7.5.4.2 Solution #5.2: SMF to multiple CHF communication
##### 7.5.4.2.1 General
A possible solution for key issue #5a, #5b, and #5c covering requirements REQ-
CH_CVTOHTOA-01, REQ-CH_CVTOHTOA-02, and REQ-CH_CVTOHTOA-03, charging for 5G
data connectivity provided to the additional actor by the visited MNO through
the home MNO.
##### 7.5.4.2.2 Reference architecture
Figure 7.5.4.2.2-1: Additional actor with only CHF 5G data connectivity
roaming scenario in service-based interface representation
Figure 7.5.4.2.2-2: Additional actor with only CHF 5G data connectivity
roaming scenario in reference point representation
The visited and home MNO CHF does converged charging for interconnect, home
MNO CHF does converged charging for wholesale, and the additional actor CHF
does converged charging for the subscriber.
##### 7.5.4.2.3 Message flows
This would be a combination of the flows in clauses 7.2.4.2 and 7.4.4.1.
#### 7.5.4.3 Solution #5.3: Using NRF to find H-CHF and A-CHF
##### 7.5.4.3.1 General
A possible solution for key issue #5d, finding the correct CHF for solution
#5.1 where V-CHF communicates with the A-CHF through the H-CHF.
##### 7.5.4.4.2 Reference architecture
The reference architecture would be the same as in solution #5.1 clause
7.5.4.1.
##### 7.5.4.5.3 Message flows
The V-CHF would in this case use the solution #2.8 in clause 7.2.4.8 and the
H-CHF would use solution #4.6 in clause 7.4.4.6. Meaning that the V-CHF may
use NRF to find H-CHF as solution #2.8 and then H-CHF uses NRF to find A-CHF
as solution #4.6.
#### 7.5.4.4 Solution #5.4: Using SUPI to find H-CHF and local configuration
to find A-CHF
##### 7.5.4.4.1 General
A possible solution for key issue #5d, finding the correct CHF for solution
#5.1 where V-CHF communicates with the A-CHF through the H-CHF.
##### 7.5.4.4.2 Reference architecture
The reference architecture would be the same as in solution #5.1 clause
7.5.4.1.
##### 7.5.4.4.3 Message flows
The V-CHF would in this case use the solution #2.9 in clause 7.2.4.9 and the
H-CHF would use solution #4.7 in clause 7.4.4.7. Meaning that the V-CHF may
use SUPI to find H-CHF as solution #2.9 and then H-CHF use local configuration
to find A-CHF as solution #4.7.
#### 7.5.4.5 Solution #5.5: Reusing Nchf_ConvergedCharging service API between
CHFs
##### 7.5.4.5.1 General
A possible solution for key issue #5e covering requirements REQ-
CH_CVTOHTOA-01, REQ-CH_CVTOHTOA-02, and REQ-CH_CVTOHTOA-03, is to use
solutions #2.6 clause 7.2.4.6 and solution #4.4 clause 7.4.4.4.
#### 7.5.4.6 Solution #5.6: New Nchf service API between CHFs
##### 7.5.4.6.1 General
A possible solution for key issue #5e covering requirements REQ-
CH_CVTOHTOA-01, REQ-CH_CVTOHTOA-02, and REQ-CH_CVTOHTOA-03, is to use solution
#2.7 clause 7.2.4.7 and solution #4.5 clause 7.4.4.5.
#### 7.5.4.7 Solution #5.7: Charging data request triggered V-CHF, H-CHF, and
A-CHF communication
##### 7.5.4.7.1 General
A possible solution for key issue #5f, the trigger for interaction for V-CHF
communicating with A-CHF through H-CHF is based on the reception of a charging
data request by the V-CHF and H-CHF.
##### 7.5.4.7.2 Reference architecture
The reference architecture would be the same as in solution #5.1 clause
7.5.4.1.
##### 7.5.4.7.3 Message flows
In this case V-CHF would use the solution #2.11 clause 7.2.4.11, and the H-CHF
would the solution #2.11 clause 7.2.4.11, where V-CHF is replaced by H-CHF and
the H-CHF is replaced by A-CHF. This means that V-CHF and H-CHF communication
is triggered by charging data request from another NF consumer as solution
#2.11, then H-CHF and A-CHF communication is triggered by charging data
request from V-CHF, working as a NF consumer, as solution #4.3.
#### 7.5.8.1 Solution #5.8: CHF to CHF communication between home MNO and
additional actor
##### 7.5.8.1.1 General
A possible solution for key issue #5a, #5b, and #5c covering requirements REQ-
CH_CVTOHTOA-01, REQ-CH_CVTOHTOA-02, and REQ-CH_CVTOHTOA-03, charging for 5G
roaming provided to the additional actor by the visited MNO through the home
MNO.
##### 7.5.8.1.2 Reference architecture
Figure 7.5.8.1.2-1: Additional actor with only CHF 5G roaming scenario in
service-based interface representation
Figure 7.5.8.1.2-2: Additional actor with only CHF 5G roaming scenario in
reference point representation
The visited and home MNO CHF does converged charging for interconnect, while
the additional actor CHF does converged charging for the subscriber.
##### 7.5.8.1.3 Message flows
This would be a combination of the flows in clauses 7.2.4.2, 7.2.4.5, and
7.4.4.3.
### 7.5.5 Evaluation
Solutions #5.1, #5.2, and #5.8 all solves key issues #5a, #5b, and #5c.
\- Solution #5.1 uses a new CHF-to-CHF communication. This requires CHF
enhancements.
\- Solution #5.2 uses V-SMF to both V-CHF and H-CHF, with a new reference
point to A-CHF. This requires knowledge of the additional actor by the visited
MNO.
\- Solution #5.8 uses V-SMF to both V-CHF and H-CHF, together with a new CHF-
to-CHF communication between the H-CHF and A-CHF.
\- Both solutions #5.1 and #5.8 can be supported at the same time depending on
the visited MNO, home MNO and agreement with additional actor.
Solutions #5.3 and #5.4 both solves key issue #5d.
\- Solution #5.3 uses NRF to find H-CHF and A-CHF.
\- Solution #5.4 uses SUPI to find the H-CHF and local configuration to find
the A-CHF and can support the case when there is no A-NRF.
\- Both solutions can be supported at the same time depending on the visited
MNO, home MNO and agreement with additional actor.
Solutions #5.5 and #5.6 both solves key issue #5e.
\- Solution #5.5 reuses the Nchf_ConvergedCharging between CHFs and may add
additional charging information to better support CHF-to-CHF communication.
\- Solution #5.6 uses a new Nchf service and would have different messages as
well as triggers.
Solution #5.7 solves key issue #5f.
\- Solution #5.7 reuses the solution #2.11 where the trigger for interaction
for V-CHF communicating with H-CHF is based on the reception of a charging
data request by the V-CHF. The A-CHF interaction is like the V-CHF to H-CHF.
### 7.5.6 Conclusion
For key issues #5a, #5b and 5c, the solution using CHF-to-CHF communication
can be an additional solution in normative work i.e., allowing both solutions
#5.1 and #5.8.
For solutions #5.1 and 5.8 the following conclusions apply for the CHF-to-CHF
communication:
\- based on solution #5.5, Nchf_ConvergedCharging service API can be reused
for the interaction between H-CHF and A-CHF should be taken into normative
work;
\- based on both solutions #5.3 and #5.4, finding the H-CHF and/or A-CHF, can
allow the use of both NRF and SUPI, should be taken into normative work;
\- based on solution #5.7, the trigger for the CHF-to-CHF communication based
on the reception of a charging data request, should be taken into normative
work;
## 7.6 Reconciliation of wholesale charging from the visited MNO with home MNO
information
### 7.6.1 Use cases
#### 7.6.1.1 Use case #6a: support for validation of usage information
received from visited MNO at the home MNO
This use case focuses on visited MNO and home MNO business roles.
When the home MNO receives the interconnect charges it would like to have the
possibility to validate the received information with information controlled
by itself.
### 7.6.2 Potential charging requirements
**REQ-CH_RECON-01:** The charging mechanism should allow the home MNO to
monitor the usage without any involvement of the visited MNO.
### 7.6.3 Key issues
The following key issues are identified:
\- **Key Issue #6a** : Collection of usage of home MNO independent and without
control of the visited MNO.
### 7.6.4 Potential solutions
#### 7.6.4.1 Solution #6.1: Use home routing
##### 7.6.4.1.1 General
A possible solution for key issue #6a covering requirements REQ-CH_RECON-01,
would be to use home routed, where the connection is sent to the home MNO, see
TS 32.255 [4].
#### 7.6.4.2 Solution #6.2: Using user reported usage information reporting
##### 7.6.4.2.1 General
A possible solution for key issue #6a covering requirements REQ-CH_RECON-01,
would be to have selected users or IoT devices, collect usage information and
report this to the home MNO. The reporting can be done through an app provided
by the operator (or an internal function in the UE or IoT device) and
collected by the charging or billing system. The home MNO would have agreement
with specific users for the collection and reporting.
##### 7.6.4.2.2 Reference architecture
This could reuse the distributed charging trigger function mechanism described
in TS 32.240 [12] annex D. The UE would have Accounting Metrics Collection
(AMC), which could be implemented as an app, which would do usage information
reporting towards the Accounting Data Forwarding (ADF). The ADF could then be
a function residing in an AF, within the home MNO.
The AF holding the CTF (ADF) could interact with the MNO's charging or billing
system. The UE CTF (AMC) would use another new reference point Nyy to
communicate with the AF CTF (ADF). The Nyy would rely on 5GC user plane for
transport (i.e., an \"over IP\" reference point).
Figure 7.6.4.2.2-1: Reconciliation using UE usage reporting in reference point
representation
Figure 7.6.4.2.2-2: Reconciliation using UE measurements in service-based
interface representation
Both the interface between UE and AF as well as between AF and billing or
charging system could be considered outside the scope of 3GPP SA5.
##### 7.6.4.2.3 Potential message flows
This assumes that the UE would be configured with the address of the AF which
holds the CTF (ADF) to be able to know where to send the reports.
Figure 7.6.4.2.3-1: Message flows for UE usage reporting - PEC
1\. UE is configured with reporting to the AF, this would include AF address
and reporting criteria. The reporting triggers criteria could be based on
e.g., PLMNs, volumes. Both the AF address, and reporting criteria could be
provisioned to the UE when the UE is allowed to do local breakout roaming.
2\. UE (CTF-AMC) decides that reporting criteria are met, according to the
configuration, the UE (CTF-AMC) creates the corresponding usage information
report.
3\. UE triggers the usage reporting procedure sends the usage information
report to the AF (CTF-ADF).
4\. AF decides that it should report the information received form the UE to a
billing or charging system, this can be due to a reception of a usage
information report from the UE (CTF-AMC), or some internal trigger e.g., after
several received reports from the UE.
5\. AF (CTF-ADF) sends the collected information to the billing or charging
system.
6\. The Billing or charging system can then use this in the reconciliation
process.
### 7.6.5 Evaluation
Solution #6.1 and #6.2 both solves key issues #6a.
\- Solution #6.1 it is specified, only covers roaming home routed and does not
cover local breakout scenario.
\- Solution #6.2 covers both roaming home routed and local breakout scenarios,
but is outside 3GPP SA5
### 7.6.6 Conclusion
There is no solution specified by 3GPP for solving retrieving reconciliation
information in the local breakout roaming scenario by the home MNO, that
cannot be influenced by the visited MNO. This means that in the case of local
breakout roaming the home MNO will have to rely on the visited MNOs usage
reports. It should be noted that the case of local breakout roaming the home
MNO will rely on the visited MNOs usage reports for reconciliation in TS
32.240 [12].
# 8 Conclusions and recommendations
_Local Breakout has been present in the standards for a long time but a
solution for charging has been missing until now. The deployment of Network
Slices, Edge Computing and different use cases that need local traffic routing
have created the necessity of addressing all the gaps for deployments of local
breakout. In this TR some use cases have been covered and some solutions
provided._
_For release 17 considering the different solutions to the use cases, the
solutions where the SMF communicates with both the V-CHF and H-CHF at the same
point in time i.e., solutions #2.2 (Visited NF (CTF) communicating with both
H-CHF and V-CHF) and #4.1 (Additional actor has CHF and does retail charging),
are preferred. The focus for the specified solution will be to limit and
minimize the impact on and to the CHF and SMF._
_For_ charging in visited MNO for wholesale charging towards home MNO _the
conclusions in clause 7.1.6 applies._
_To_ convey charging information from visited MNO to home MNO _the conclusions
in clause 7.2.6 applies._
_For c_ harging in an MNO for the purpose of wholesale charging towards an
additional actor _the conclusions in clause 7.3.6 applies._
_To convey charging information from an MNO to an additional actor the
conclusions in clause 7.4.6 applies._
_To_ convey charging information from visited MNO to home MNO, and home MNO to
an additional actor _the conclusions in clause 7.5.6 applies._
_For r_ econciliation of wholesale charging from the visited MNO with home MNO
information _the conclusions in clause 7.6.6 applies i.e.,_ should be noted
that the case of local breakout roaming the home MNO will rely on the visited
MNOs usage reports for reconciliation.
#
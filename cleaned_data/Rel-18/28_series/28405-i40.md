# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
The present document is part of a TS-family covering the 3^rd^ Generation
Partnership Project; Technical Specification Group Services and System
Aspects; Telecommunication management, as identified below:
TS 28.404: \"Quality of Experience (QoE) measurement collection; Concepts, use
cases and requirements\";
**TS 28.405: \"Quality of Experience (QoE) measurement collection; Control and
configuration\";**
TS 28.406: \"Quality of Experience (QoE) measurement collection; Information
definition and transport\".
One main motivation of mobile network evolution is to improve the user
experience, which is why the evaluation of the user experience at the UE side
is vital to network operators. This is especially true when the operators
provide high bit rate real-time services like streaming services (typically
video services), where even intermittent quality degradation is very annoying.
Many of these streaming services are a significant part of the commercial
traffic growth rate, therefore the focus is on the end users\' experience.
Quality of Experience (QoE) information collection provides detailed
information at session level on a number of UEs.
The capability to log information within a UE, and in particular the QoE of an
end user service, initiated by an operator, provides the operator with QoE
information. The collected information (specified in 3GPP TS 26.247 [6])
cannot be deduced from performance measurements in the mobile network.
The QoE information is information collected by the end user application in
the UE.
The QoE information is collected by the management system for analysis and/or
KPI calculations.
# 1 Scope
The present document addresses the mechanisms used for the function Quality of
Experience (QoE) measurement collection in 3GPP networks . The measurements
that are collected are DASH [6], MTSI [7] and Virtual Reality (VR) (see TS
26.118 [13]) measurements.
The function includes collecting QoE information from UEs frequenting a
specified area or an individual UE for a specified end user service/end user
service type. The document describes the activation and deactivation of a
network request session, UE request session and recording session and also the
reporting of recorded information [2].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 28.404: \"Telecommunication management;Quality of Experience (QoE)
measurement collection; Concepts, use cases and requirements\".
[3] 3GPP TS 28.308: \"Management of Quality of Experience (QoE) measurement
collection Integration Reference Point (IRP); Information Service (IS)\".
[4] 3GPP TS 25.331: \"Radio Resource Control (RRC) protocol specification\".
[5] 3GPP TS 27.007: \"AT command set for User Equipment (UE)\".
[6] 3GPP TS 26.247: \"Transparent end-to-end Packet-switched Streaming Service
(PSS); Progressive Download and Dynamic Adaptive Streaming over HTTP (3GP-
DASH)\".
[7] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony;
Media handling and interaction\".
[8] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC) protocol specification\".
[9] 3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network
(E-UTRAN); S1 Application Protocol (S1AP)\".
[10] 3GPP TS 25.413: \"UTRAN Iu interface Radio Access Network Application
Part (RANAP) signalling\".
[11] 3GPP TS 38.331: \" NR; Radio Resource Control (RRC); Protocol
specification\".
[12] 3GPP TS 38.413: \" NG-RAN; NG Application Protocol (NGAP)\".
[13] 3GPP TS 26.118: \"Virtual Reality (VR) profiles for streaming
applications\".
[14] Void
[15] 3GPP TS 28.622: \"Telecommunication management; Generic Network Resource
Model (NRM) Integration Reference Point (IRP); Information Service (IS)\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
Network session: A network session is used when a NF requests a UE to perform
QoE Measurement Collection for a specified end user service type. Supported
end user service types are defined in clause 5.8.
## 3.2 Symbols
Void.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
DM Domain Manager
MCE Measurement Collector Entity
NB Node B
QMC QoE Measurement Collection
QoE Quality of Experience
VR Virtual Reality
# 4 Quality of Experience (QoE) measurement collection
## 4.1 _Management based activation in UTRAN_
### 4.1.1 Activation of measurement collection job and reporting of collected
information in UTRAN
The parameters for the network request session are sent from the management
system to the RNCs that host the cells that are included in the collection job
request in the activateAreaQMCJob operation [3]. The RNC starts a network
request session, with the Network request session id [3] given in
activateAreaQMCJob operation [3]. For the duration of the network request
session, the RNC(s) checks for connections where the UE has the UE Application
Layer Measurement Capability [10]. The UE Application Layer Measurement
Capability is sent from the UE to RNC (via the core network) in message
INITIAL UE MESSAGE [10].
When a session is found that has a UE with the UE Application Layer
Measurement Capability, the RNC starts a UE request session by sending a
MEASUREMENT CONTROL message [4] to the UE via the NB.
The AT command +CAPPLEVMC [5] activates provisioning of measurement reporting
from the lower layers to the application within the UE by an unsolicited
result code +CAPPLEVMC. When information about a measurement report is
received in the UE from the network, the unsolicited result code +CAPPLEVMC
contains the relevant parameters (service_type, start_stop-indication and
config-file & config-file length if applicable) that are provided from the
lower layers in the UE to the application.
{width="5.866666666666666in" height="2.64375in"}
Figure 4.1.1-1: QMC activation and reporting in UTRAN
1\. The NM sends activateAreaQMCJob to DM/EM that controls the impacted
RNC(s), and includes the parameters: serviceType, areaScope,
qoECollectionEntityAddress, pLMNTarget, qMCTarget, qoEReference and QMC
configuration file.
2\. The DM/EM forwards activateAreaQMCJob to impacted RNC(s), and includes the
parameters: serviceType, areaScope, qoECollectionEntityAddress, pLMNTarget,
qMCTarget, qoEReference and QMC configuration file.
3\. The RNC checks for connections where the UE has the UE Application Layer
Measurement Capability [10] that match the criteria for serviceType in the
activateAreaQMCJob.
4\. When a connection is found that has the UE Application Layer Measurement
Capability [10], the RNC start a UE request session and stores the associated
QoECollectionEntityAddress, sends the message RRCConnectionReconfiguration to
the UE, and includes the following: serviceType, qoEReference and QMC
configuration file.
5\. The access stratum in the UE sends the AT command +CAPPLEVMC to
application level and includes the following: serviceType, qoEReference and
QMC configuration file.
6\. When the application in the serviceType starts, the QMC is initiated.
7\. The application layer sends the AT command +CAPPLEVMR including a
recording session indication that a session has started to the access stratum.
8\. The UE sends the message MeasurementReport including the recording session
indication to the RNC.
9\. The RNC sends a notification including the recording session indication to
the NM.
10\. When the QMC is completed, the recorded information is collected in a QMC
report [6], [7], including qoEReference and recordingSessionId. The
qoEReference, Client Id [6], [7] in the reporting container (that represent
the UE request session), and recordingSessionId are needed in the QMC
collection entity for post processing purposes.
11\. The application layer sends the AT command +CAPPLEVMR including
qoEReference and the QMC report to the access stratum.
12\. The UE sends the message MeasurementReport including qoEReference and the
QMC report to the RNC.
13\. The RNC sends the QMC report to the MCE associated to the qoEReference.
### 4.1.2 Handling of measurement collection at handover in UTRAN
#### 4.1.2.1 Handover between cells within an RNC
When handover is made, the measurement area is checked.
\- If the mobile is inside the measurement area after the handover, the RNC
sends in an indication that the UE is inside the measurement area in the
RRCConnectionReconfiguration message [4] to the UE. The UE send the +CAPPLEVMC
AT command [5] to the application to inform that recording shall start if the
application becomes active (when the UE moves into the measurement area).
\- If the mobile has moved outside the measurement area, there is no
indication that the UE is inside the measurement area in the
RRCConnectionReconfiguration message [4] from the RNC to the UE. The UE sends
the +CAPPLEVMC AT command [5] to the application to inform that recording
shall not be started even if the application becomes active.
#### 4.1.2.2 Handover between RNCs
The figure 4.1.2.2-1 and the text below describes the handling at handover
between RNCs.
{width="6.25in" height="3.59375in"}
Figure 4.1.2.2-1: Handling of QMC activation in case of handover in UTRAN
1\. Source RNC sends the message HandoverRequest to Target RNC and includes
areaScope, qoECollectionEntityAddress and a recording session indication
indicating whether a recording session has started.
2\. If a recording session has not started, the target RNC checks if the
target cell is inside the areaScope or not.
3\. The target RNC sends the message Handover Request Ack to the source RNC.
4\. The source RNC sends the message RRCReconfiguration to the UE.
5\. The access stratum in the UE sends the AT command +CAPPLEVMC to
application level.
6\. The UE sends the message RRCReconfigurationComplete to the RNC.
7\. When the application becomes active, QMC is initiated if the UE is inside
the areaScope.
8\. The application layer sends the AT command +CAPPLEVMR including a
recording session indication to the access stratum.
9\. The UE sends the message MeasurementReport including the recording session
indication to the RNC.
10\. The RNC sends a notification including the recording session indication
to the NM.
11\. When the QMC is completed, the recorded information is collected in a QMC
report [6] and [7] including qoEReference and recordingSessionId. The
qoEReference, Client Id [6] and [7] in the reporting container (that represent
the UE request session) and recordingSessionId are needed in the QoE
collection entity for post processing purposes.
12\. The application layer sends the AT command +CAPPLEVMR including
qoEReference and the QMC report to the access stratum.
13\. The UE sends the message MeasurementReport including qoEReference and the
QMC report to the RNC.
14\. The RNC sends the QMC report to the MCE associated to the qoEReference.
### 4.1.3 Deactivation of measurement collection job in UTRAN
#### 4.1.3.1 Forced deactivation in UTRAN
If the operator technician or the management application wants to deactivate a
measurement collection job before the pre-set time has expired, the management
system sends the deactivateQMCJob operation [3] to the RNC. The RNC sets the
network request session to ended, but does not delete the UE request session
id and the Collection Entity Address parameters [3], as the UE still may send
reports which shall be send to the collection centre. For UE request sessions
which have reported that a recording session is started, the RNC sends the
MeasurementControl message [4] with the DeactivateJob request to relevant UEs.
The Access stratum sends +CAPPLEVMC AT command [5] to the application with the
DeactivateJob request. The application stops the recording session and stops
recording of the requested information. The UE request session id and the
Collection Entity Address parameters [3] in the RNC are deleted when the UE
request session is ended.
#### 4.1.3.2 Deactivation of recording session in UTRAN
Regardless of whether the pre-set time has elapsed or not, the recording
session continues to be active until the session for the application is ended.
## 4.2 _Management based activation in LTE_
### 4.2.1 Activation of measurement collection job and reporting of collected
information in LTE
The parameters for the network request session are sent from the management
system to the eNBs that host the cells that are included in the collection job
request in the activateAreaQMCJob operation [3]. The eNB starts a network
request session, with the Network request session id [3] given in
activateAreaQMCJob operation [3]. For the duration of the network request
session, the eNB(s) checks for connections where the UE has the QoE-MeasReport
capability [8] for collection of streaming services or the QoE-MTSI-MeasReport
capability [8] for collection of MTSI services. The UE capability is sent from
the UE to eNB via the core network in message UE CAPABILITY INFO INDICATION
[9].
When a session is found that has a UE with the wanted UE capability, the eNB
starts a UE request session and sends a RRCConnectionReconfiguration [8] to
the UE.
The AT command +CAPPLEVMC [5] activates provisioning of measurement reporting
from the lower layers to the application within the UE by an unsolicited
result code +CAPPLEVMC. When information about a measurement report is
received in the UE from the network, the unsolicited result code +CAPPLEVMC
contains the relevant parameters (service_type, start_stop-indication and
config-file & config-file length if applicable) that are provided from the
lower layers in the UE to the application.
{width="6.486805555555556in" height="2.6395833333333334in"}
Figure 4.2.1-1: QMC activation and reporting in LTE
1\. The NM sends activateAreaQMCJob to DM/EM that controls the impacted
eNB(s), and includes the parameters: serviceType, areaScope,
qoECollectionEntityAddress, pLMNTarget, qoETarget, qoEReference and QMC
configuration file.
2\. The DM/EM forwards activateAreaQMCJob to impacted eNB(s), and includes the
parameters: serviceType, areaScope, qoECollectionEntityAddress, pLMNTarget,
qoETarget, qoEReference and QMC configuration file.
3\. The eNB checks for connections where the UE has the UE capability [9] that
match the criteria for serviceType in the activateAreaQMCJob.
4\. When a connection is found that has the wanted UE capability [9], the eNB
starts a UE request session and stores the associated
QoECollectionEntityAddress, sends the message RRCConnectionReconfiguration to
the UE, and includes the following: serviceType, qoEReference and QMC
configuration file.
5\. The access stratum in the UE sends the AT command +CAPPLEVMC to
application level and includes the following: serviceType, qoEReference and
QMC configuration file.
6\. When the application in the serviceType starts, the QMC is initiated.
7\. The application layer sends the AT command +CAPPLEVMR including a
recording session indication that indicates that a session is started to the
access stratum.
8\. The UE sends the message MeasReportAppLayer including the recording
session indication to the eNB.
9\. The eNB sends a notification including the recording session indication to
the NM.
10\. When the QMC is completed, the recorded information is collected in a QMC
report [6], [7], including qoEReference and recordingSessionId. The
qoEReference, Client Id [6] and [7] in the reporting container (that represent
the UE request session), and recordingSessionId are needed in the QMC
collection entity for post processing purposes.
11\. The application layer sends the AT command +CAPPLEVMR including
qoEReference and the QMC report to the access stratum.
12\. The UE sends the message MeasReportAppLayer including qoEReference and
the QMC report to the eNB.
13\. The eNB sends the QMC report to the MCE associated to the qoEReference.
### 4.2.2 Handling of measurement collection at handover in LTE
#### 4.2.2.1 Handover between cells within an eNB
When handover is made and no Recording session id is provided, the measurement
area is checked.
\- If the mobile is inside the measurement area after the handover, the eNB
sends in an indication that the UE is inside the measurement area in the
RRCConnectionReconfiguration message [8] to the UE. The UE send the +CAPPLEVMC
AT command [5] to the application to inform that recording shall start if the
application becomes active (when the UE moves into the measurement area).
\- If the mobile has moved outside the measurement area, there is no
indication that the UE is inside the measurement area in the
RRCConnectionReconfiguration message [8] from the eNB to the UE. The UE sends
the +CAPPLEVMC AT command [5] to the application to inform that recording
shall not be started even if the application becomes active.
#### 4.2.2.2 Handover between eNBs
The figure 4.2.2.2-1 and the text below describes the handling at handover
between eNBs.
{width="6.21875in" height="3.6875in"}
Figure 4.2.2.2-1: Handling of QMC activation in case of handover in LTE
1\. Source eNB sends the message HandoverRequest to Target eNB and includes
areaScope and qoECollectionEntityAddress.
2\. The target eNB checks if the target cell is inside the areaScope or not.
3\. The target eNB sends the message HandoverRequestAcknowledge to the source
eNB.
4\. The source eNB sends the message RRCConnectionReconfiguration to the UE.
5\. The access stratum in the UE sends the AT command +CAPPLEVMC to
application level.
6\. The UE sends the message RRCConnectionReconfigurationComplete to the eNB.
7\. When the application becomes active, QMC is initiated if the UE is inside
the areaScope.
8\. The application layer sends the AT command +CAPPLEVMR including a
recording session indication indicating that a session has started to the
access stratum.
9\. The UE sends the message MeasReportAppLayer including the recording
session indication to the eNB.
10\. The eNB sends a notification including the recording session indication
to the NM.
11\. When the QMC is completed, the recorded information is collected in a QMC
report [6] and [7] including qoEReference and recordingSessionId. The
qoEReference, Client Id [6] and [7] in the reporting container (that represent
the UE request session) and recordingSessionId are needed in the QoE
collection entity for post processing purposes.
12\. The application layer sends the AT command +CAPPLEVMR including
qoEReference and the QMC report to the access stratum.
13\. The UE sends the message MeasReportAppLayer including qoEReference and
the QMC report to the eNB.
14\. The eNB sends the QMC report to the MCE associated to the qoEReference.
### 4.2.3 Deactivation of measurement collection job in LTE
#### 4.2.3.1 Forced deactivation
When the operator technician or the management application wants to deactivate
a measurement collection job, the management system sends the deactivateQMCJob
operation [3] to the eNB. The eNB sets the network request session to ended,
but does not delete the UE request session id and the Collection Entity
Address parameters [3], as the UE still may send reports which shall be send
to the collection centre. For UE request sessions which have reported that a
recording session is started, the eNB sends the RRCConnectionReconfiguration
message [8] to relevant UEs. The RRCConnectionReconfiguration message is
including _measConfigAppLayer_ set to discard application layer measurement
report information in _otherConfig [8]_. The Access stratum sends +CAPPLEVMC
AT command [5] to the application with the discard request. The application
stops the recording session and stops recording of the requested information.
The UE request session id and the Collection Entity Address parameters [3] in
the eNB are deleted when the UE request session is ended.
#### 4.2.3.2 Deactivation of recording session
Regardless of whether the pre-set time has elapsed or not, the recording
session continues to be active until the session for the application is ended.
### 4.2.4 Void
## 4.3 _Signalling based activation_ in UTRAN
### 4.3.1 Activation of measurement collection job in UTRAN
In Signalling based activation, the QoE measurement collection is sent to the
UE from the OAM via CN. The messages from EMS propagated to HSS, MSE
Server/SGSN and RNC. QoE measurement collection activation request is
propagated to UE.
When HSS activates the QoE measurement collection for a job, the MSC
Server/SGSN can send the QoE measurement collection to the UE through RNC, the
following configuration parameters shall be included in the message:
serviceType, areaScope, qoECollectionEntityAddress, pLMNTarget, qoETarget,
qoEReference and QMC configuration file.
{width="6.6875in" height="3.6979166666666665in"}
1) The NM sends activateAreaQMCJob to DM/EM that controls the impacted RNC(s),
and includes the parameters: serviceType, areaScope,
qoECollectionEntityAddress, pLMNTarget, qMCTarget, Individual UE Id,
qoEReference and QMC configuration file.
2) The DM/EM sends activateAreaQMCJob to HSS that controls the impacted
RNC(s), and includes the parameters: serviceType, areaScope,
qoECollectionEntityAddress, pLMNTarget, qoETarget, Individual UE
Id,qoEReference and QMC configuration file.
3) The HSS sends an Insert Subscriber Data to the MSC Server/SGSN that is
registered in the HSS in a previous Update Location Request message.
4) The MSC Server/SGSN starts finding the UE and check if that the UE
capability matches the criteria for ServiceType in activateAreaQMCJob
5) The MSC Server/SGSN sends message CN INVOKE TRACE to the RNC and includes
the parameters: serviceType, areaScope, qoECollectionEntityAddress,
pLMNTarget, qoETarget,qoEReference and QMC configuration file.
6) The RNC checks for connections where the UE has the UE Application Layer
Measurement Capability that match the criteria for serviceType in the
activateAreaQMCJob.
7) The RNC start a UE request session and stores the associated
QoECollectionEntityAddress, sends the message RRCConnectionReconfiguration to
the UE, and includes the following: serviceType, qoEReference and QMC
configuration file.
8) The access stratum in the UE sends the AT command +CAPPLEVMC to application
level and includes the following: serviceType, qoEReference and QMC
configuration file.
9) When the application in the serviceType starts, the QMC is initiated.
10) The application layer sends the AT command +CAPPLEVMR including a
recording session indication that a session has started to the access stratum.
11) The UE sends the message MeasurementReport including the recording session
indication to the RNC.
12) The RNC sends a notification including the recording session indication to
the NM.
13) When the QMC is completed, the recorded information is collected in a QMC
report, including qoEReference and recordingSessionId. The qoEReference,
Client Id, in the reporting container (that represent the UE request session),
and recordingSessionId are needed in the QMC collection entity for post
processing purposes.
14) The application layer sends the AT command +CAPPLEVMR including
qoEReference and the QMC report to the access stratum.
15) The UE sends the message MeasurementReport including qoEReference and the
QMC report to the RNC.
16) The RNC sends the QMC report to the MCE associated to the qoEReference.
### 4.3.2 Handling of measurement collection at handover in UTRAN
See clause 4.1.2.
### 4.3.3 Deactivation of measurement collection job in UTRAN
#### 4.3.3.1 Pre-set time has elapsed in UTRAN
When the pre-set time is elapsed, the HSS or SGSN and the RNC sets the network
request session to ended, but do not delete the UE request session id and the
Collection Entity Address parameters [3], due to that reports still can come
from the UE that has to be transferred to the collection centre. The UE
request session id and the Collection Entity Address parameters [3] are
deleted when the session is ended.
#### 4.33.2 Forced deactivation in UTRAN
If the operator technician or the management application wants to deactivate a
measurement collection job, the management system sends the deactivateQoEJob
operation [3] to the HSS or SGSN, that propagate it to the RNC. The RNC sets
the network request session to ended, but does not delete the UE request
session id and the Collection Entity Address parameters [3], as the UE still
may send reports which shall be send to the collection centre. For UE request
sessions which have reported that a recording session is started, the RNC
sends the MeasurementControl message [4] with the DeactivateJob request to
relevant UEs. The Access stratum sends +CAPPLEVMC AT command [5] to the
application with the DeactivateJob request. The application stops the
recording session and stops recording of the requested information. The UE
request session id and the Collection Entity Address parameters [3] in the RNC
are deleted when the UE request session is ended.
#### 4.3.3.3 Deactivation of recording session in UTRAN
See clause 4.1.3.3.
## 4.4 _Signalling based activation in LTE_
### 4.4.2 Activation of measurement collection for a UE in LTE
#### 4.4.2.0 General
Activation of measurement collection for a UE can be done before UE attachment
or after UE is attached.
#### 4.4.2.1 Activation of QoE measurement task before UE attaches to the
network
When HSS activates the QoE measurement collection for a job, to the MME the
following configuration parameters shall be included in the message:
serviceType, areaScope, qoECollectionEntityAddress, pLMNTarget, qoETarget,
qoEReference and QMC configuration file.
At UE attachment the configuration parameters for the QoE measurement
collection for a job is propagated to the UE.
The MME receives and stores QoE measurement collection job as part of Update
Location Answer (or Insert Subscriber Information). Then the same procedure
for activation of measurement collection job is applied as after UE is
attached, described in see 4.4.2.2.
{width="6.6875in" height="3.65625in"}
#### 4.4.2.2 Activation of QoE measurement task after UE attachement to the
network
The QoE measurement collection is sent to the UE from the OAM via CN. The
messages from EMS propagated to HSS, MME and eNodeB are the same as previous
section. QoE measurement collection activation request is propagated to UE
finally.
When MME can send the QoE measurement collection to the UE through eNodeB, the
following configuration parameters shall be included in the message:
serviceType, areaScope, qoECollectionEntityAddress, pLMNTarget, qoETarget,
qoEReference and QMC configuration file. QoE measurement collection activation
request is propagated to UE.
{width="6.6875in" height="3.7083333333333335in"}
1) The EMS sends activateAreaQMCJob to HSS that controls the impacted eNB(s),
and includes the parameters: serviceType, areaScope,
qoECollectionEntityAddress, pLMNTarget, qoETarget, qoEReference and QMC
configuration file.
2) The HSS inserts subscriber related data and forwards it to the MME.
3) The MME forwards activateAreaQMCJob to impacted eNB(s), and includes the
parameters: serviceType, areaScope, qoECollectionEntityAddress, pLMNTarget,
qoETarget, qoEReference and QMC configuration file.
4) The eNB checks if the UE capability that matches the criteria for
serviceType in the activateAreaQMCJob.
5) If the UE has the wanted UE capability, the eNB starts a UE request session
and stores the associated QoECollectionEntityAddress, sends the message
RRCConnectionReconfiguration to the UE, and includes the following:
serviceType, qoEReference and QMC configuration file.
6) The access stratum in the UE sends the AT command +CAPPLEVMC to application
level and includes the following: serviceType, qoEReference and QMC
configuration file.
7) When the application in the serviceType starts, the QMC is initiated.
8) The application layer sends the AT command +CAPPLEVMR including a recording
session indication that indicates that a session is started to the access
stratum.
9) The UE sends the message MeasReportAppLayer including the recording session
indication to the eNB.
10) The eNB sends a notification including the recording session indication to
the NM.
11) When the QMC is completed, the recorded information is collected in a QMC
report [6], [7], including qoEReference and recordingSessionId. The
qoEReference, Client Id [6] and [7] in the reporting container (that represent
the UE request session), and recordingSessionId are needed in the QMC
collection entity for post processing purposes.
12) The application layer sends the AT command +CAPPLEVMR including
qoEReference and the QMC report to the access stratum.
13) The UE sends the message MeasReportAppLayer including qoEReference and the
QMC report to the eNB.
14) The eNB sends the QMC report to the MCE associated to the qoEReference.
### 4.4.3 Handling of measurement collection at handover in LTE
See clause 4.2.2.
### 4.4.4 Deactivation of measurement collection for a UE in LTE
#### 4.4.4.1 Pre-set time has elapsed in LTE
When the pre-set time is elapsed, the MME and the eNB sets the network request
session to ended, but do not delete the UE request session id and the
Collection Entity Address parameters [3], due to that reports still can come
from the UE that has to be transferred to the collection centre. The UE
request session id and the Collection Entity Address parameters [3] are
deleted when the session is ended.
#### 4.4.4.2 Forced deactivation in LTE
When the operator technician or the management application wants to deactivate
a measurement collection job, the management system sends the deactivateQMCJob
operation [3] to the MME that propgates to the eNB . The eNB sets the network
request session to ended, but does not delete the UE request session id and
the Collection Entity Address parameters [3], as the UE still may send reports
which shall be send to the collection centre. For UE request sessions which
have reported that a recording session is started, the eNB sends the
RRCConnectionReconfiguration message [8] to relevant UEs. The
RRCConnectionReconfiguration message is including _measConfigAppLayer_ set to
discard application layer measurement report information in _otherConfig [8]_.
The Access stratum sends +CAPPLEVMC AT command [5] to the application with the
discard request. The application stops the recording session and stops
recording of the requested information. The UE request session id and the
Collection Entity Address parameters [3] in the eNB are deleted when the UE
request session is ended.
#### 4.4.4.3 Deactivation of recording session in LTE
See clause 4.2.3.2.
## _4.5 Management based activation in NR_
### 4.5.1 Activation of measurement collection job and reporting of collected
information in NR
Management Based Activation enables collection of application layer
measurements from the UEs in the specified area for specified end user service
type.
The parameters for the network request session are sent from the MnS Consumer
via the management system to the gNBs that host the cells that are included in
the QoE Measurement Collection job request in the Create MOI QMC operation
[15]. A QMC Job is activated by creating a QMCJob object instance in the MnS
producer.
Figure 4.5.1-1 and the text below describe the activation of QoE measurement
collection.
{width="6.691666666666666in" height="5.320833333333334in"}
Figure 4.5.1-1: QMC activation example for Management Based Activation and
Reporting in NR
1) A QoE Measurement Collection Job begins when the MnS Consumer sends
createMOI request for QMCJob to the MnS Producer serving the impacted gNB(s),
and includes the parameters: serviceType, areaScope,
qoECollectionEntityAddress, qoEReference, mDTAlignmentInformation,
availableRANqoEMetrics and qMCConfigFile. Step 2 and step 3 are asynchronous
in time with respect to Step 1; they may occur before or after step 1.
> NOTE: The RAN visible QoE measurements are supported for the DASH streaming
> and VR services.
2) Application level measurement configuration. The Application in the UE
shall send AT command +CAPPLEVMCNR [5] containing the parameter \ set to 1
to the Access Stratum. This enables the the Access Stratum to present an
unsolicited result code to the Application at a later time. Step 2 and step 3
are asynchronous in time with respect to Step 1; they may occur before or
after step 1.
3) UE registration procedure. The UE shall register QMC capability with the
gNB by setting qoe-Streaming-MeasReport to "supported" in UE-NR-Capability
[11]. Step 2 and step 3 are asynchronous in time with respect to Step 1; they
may occur before or after step 1.
4) The gNB starts a network request session, with the QoE Reference [3] given
in createMOI for QMCJob [3]. For the duration of the network request session,
the gNB(s) checks for connections where the UE has qoe-Streaming-MeasReport
set to "supported" [11] in step 2.
5) If a UE has the wanted capability, the gNB stores the associated
qoECollectionEntityAddress and starts a UE request session by sending
RRCReconfiguration to the UE including serviceType, measConfigAppLayerId (set
to the value of qoEReference from step 3) and measConfigAppLayerContainer.\ \
NOTE: The IE measConfigAppLayerId indicates the identity of the application
layer measurement configuration, see [11].
6) The access stratum in the UE sends an unsolicited response to the
Application including app‑meas_service_type, meas_config_app_layer_id and app-
meas_config_file. These IEs map directly to the IEs in step 5. The unsolicited
response is for the AT command +CAPPLEVMCNR [5] which is sent from Application
in step 2.
7) The QMC Job remains inactive until the Application for the specified
serviceType initiates service.
8) When the Application begins service, it sends the AT command +CAPPLEVMRNR
[5], including meas_config_app_layer_id and qoe_measurement_status to indicate
a recording session has started, to the access stratum.
9) The UE sends the message MeasurementReportAppLayer including
measConfigAppLayerId and appLayerSessionStatus to the gNB to indicate a
recording session has started.
10) While active, the Application collects measurement reports. When the QMC
is completed or at the end of period for periodic report, the recorded
information is formatted in a QMC report, see [6] for DASH, [7] for MTSI or
[13] for VR.
11) When a formatted measurement report is available, the Application sends
the AT command +CAPPLEVMRNR [5] including meas_config_app_layer_id,
qoe_measurement_status and app-meas_report to the Access Stratum. If the QMC
Job has ended, qoe_measurement_status is set to indicate the Job has ended.
12) When the AT command +CAPPLEVMRNR is received from the Application, the
Access Stratum sends the message MeasurementReportAppLayer including
measConfigAppLayerId, appLayerSessionStatus and measReportAppLayerContainer to
the gNB.
13) The gNB sends the QMCRecord to the MCE associated to the
qoECollectionEntityAddress. The report contains the QoE Reference from step 3
and measReportAppLayerContainer _from step 12._
### 4.5.3 Deactivation of measurement collection job in NR
#### 4.5.3.1 Forced deactivation
When the operator technician or the management application wants to deactivate
a measurement collection job, the management system sends the deactivateQMCJob
operation [3] to the gNB. The gNB sets the network request session to ended,
but does not delete the UE request session id and the Collection Entity
Address parameters [3], as the UE still may send reports which shall be sent
to the collection centre. For UE request sessions which have reported that a
recording session is started, the gNB sends the RRCReconfiguration message
[11] to relevant UEs. The RRCReconfiguration message is including
_measConfigAppLayerId_ set to discard application layer measurement report
information in _otherConfig [11]_. The Access Stratum sends +CAPPLEVMC AT
command [5] to the application with the discard request. The application stops
the recording session and stops recording of the requested information. The
QoE Reference Id and the QoE Collection Entity Address parameters [3] in the
gNB are deleted when the UE request session is ended.
#### 4.5.3.2 Deactivation of recording session
The recording session continues to be active until the session for the
Application is ended.
### 4.5.4 Temporary stop and restart of QoE information reporting during RAN
overload in NR
In case of overload in RAN, the gNB may temporarily stop the reporting from
the UE by sending the RRCReconfiguration message [11] to relevant UEs. The
RRCReconfiguration message [11] includes _pauseReporting_ set to TRUE in
_appLayerMeasConfig_ to temporarily stop application layer measurement
reporting. The access stratum continues recording further information until
the data storage capacity for the reporting is fully used or the UE request
session ends. Then the recorded data is kept until it is reported to the gNB
or when the UE request session is ended.
When the overload situation in RAN is ended the gNB restart the reporting from
the UE by sending the RRCReconfiguration message [11] to relevant UEs. The
RRCReconfiguration message is including _pauseReporting_ set to FALSE in
_appLayerMeasConfig_ to restart application layer measurement reporting.
The UE application level is not directly affected by the RAN overload.
## 4.6 _Signalling based activation in NR_
### 4.6.1 Activation of measurement collection for a UE in NR
#### 4.6.1.0 General
Activation of measurement collection for a UE can be done after UE is
registered or before UE Registration procedure.
#### 4.6.1.1 Activation of QoE measurement task after completion of UE
registration procedure
Figure 4.6.1.1-1 and the text below describe the activation of QoE measurement
collection after completion of UE registration procedure.
{width="6.684027777777778in" height="3.6951388888888888in"}
Figure 4.6.1.1-1: QMC activation and reporting example in NR after UE is
registered
1\. The MnS Consumer sends createMOI request for QMCJob to UDM that controls
the impacted gNB(s), and includes the parameters: serviceType, sliceScope,
qoECollectionEntityAddress, qoETarget, qoEReference, mDTAlignmentInformation,
availableRANqoEMetrics and qMCConfigFile.
2\. The UDM inserts subscriber related data and forwards it to the AMF.
3\. The AMF forwards the configuration parameters serviceType,
sliceSupportListQMC, measCollEntityIPAddress, qoEReference, nGRANTraceId,
availablerANqoEMetrics and containerForAppLayerMeasConfig in message UE
Context Modification Request to the impacted gNB.
4\. The gNB checks if the UE capability matches the criteria for serviceType
in the QoE measurement configuration information.
5\. If the UE has the wanted UE capability, the gNB starts a UE request
session and stores the associated qoECollectionEntityAddress, sends the
message RRCReconfiguration to the UE including serviceType,
measConfigAppLayerId, transmissionOfSessionStartStop, ran-VisibleParameters
and measConfigAppLayerContainer.
NOTE: The IE measConfigAppLayerId indicates the identity of the application
layer measurement configuration, see [11].
6\. The access stratum in the UE sends an unsolicited response to the
application level including app-meas_service_type, meas_config_app_layer_id,
transmission_of_session_start-end, ran_visible_periodicity,
number_of_buffer_level_entries, report_playout_delay_for_media_startup, and
app-meas_config_file. The unsolicited response is for the AT command
+CAPPLEVMCNR which is sent from UE Application Level to UE Access Stratum
during Registration procedure.
7\. When the application for the specified serviceType starts, the QMC is
initiated. To specify the session which is started, the application generates
a recordingSessionId.
8\. The application layer sends the AT command +CAPPLEVMRNR [7] including
meas_config_app_layer_id and qoe_measurement_status that indicates that a
session is started to the access stratum.
9\. The UE sends the message MeasurementReportAppLayer including
measConfigAppLayerId and appLayerSessionStatus to the gNB.
10\. When the QMC is completed or at the end of period for periodic report,
the recorded information is collected in a QMC report, see [6], [7] or [13].
11\. The application layer sends the AT command +CAPPLEVMRNR [7] including
meas_config_app_layer_id, playout_delay_for_media_startup,
number_of_buffer_level_entries, qoe_measurement_status indicating that session
has ended and app-meas_report including recordingSessionId to the access
stratum.
12\. The UE sends the message MeasurementReportAppLayer including
measConfigAppLayerId, appLayerSessionStatus, ran-VisibleMeasurements and
measReportAppLayerContainer including recordingSessionId to the gNB.
13\. The gNB sends the QMC report to the MCE associated to the qoEReference.
The report contains the qoEReference and the RAN transparent container
including the recordingSessionId and sliceScope, which contains only the
S-NSSAI used. _Note that the_ qoEReference _is mapped to the_
measConfigAppLayerId at gNB _on the previous step and is included in QMC
report._
#### 4.6.1.2 Activation of QoE measurement task before UE Registration
procedure to the network
Figure 4.6.1.2-1 and the text below describe the activation of QoE measurement
collection before UE registration procedure to the network.
The AMF receives and stores QoE measurement collection job as part of API:
Numd_SDM . Then the same procedure for activation of measurement collection
job is applied as after completion of UE registration procedure, except that
instead of UE Context Modification Request the message Initial Context Setup
Request is sent, see 4.6.1.1.
{width="6.684027777777778in" height="3.6354166666666665in"}
Figure 4.6.1.2-1: QMC activation and reporting example in NR before UE
Registration procedure to the network
### 4.6.2 Handling of measurement collection at handover in NR
#### 4.6.2.1 NG Based Handover for Signalling Based Activation
The figure 4.6.2.1-1 and the text below describe the handling at NG Based
handover between gNBs for Signalling Based Activation case.
{width="6.690277777777778in" height="3.9694444444444446in"}
Figure 4.6.2.1-1: Handling of QMC activation example in case of NG Based
handover in NR for Signalling Based Activation
> 1\. Source gNB sends the message HANDOVER REQUIRED to AMF. The message
> includes the Source to Target Transparent Container which contains
> qoEReference, serviceType, measConfigAppLayerID, measCollEntityIPAddress,
> qoEMeasurementStatus, sliceSupportListQMC, nGRANTraceId,
> availableRANVisibleqoEMetrics and containerForAppLayerMeasConfig.
>
> 2\. AMF sends the message HANDOVER REQUEST to the Target gNB. The message
> includes the Source to Target Transparent Container which contains the same
> parameters as in step 1.
>
> 3\. The target gNB checks if the measurements will be continued or not.
>
> 4\. The target gNB sends the message HANDOVER REQUEST ACKNOWLEDGE to the
> AMF.
>
> 5\. The AMF sends the message HANDOVER COMMAND to the source gNB.
>
> 6\. The source gNB sends the message RRCReconfiguration to the UE.
>
> 7\. The UE sends the message RRCReconfigurationComplete to the gNB.
>
> 8\. When the ongoing QMC is completed or end of periodic reporting is
> reached, the recorded information is collected in a QMC report, see [6], [7]
> or [13], at UE Application Level.
>
> 9\. The application layer sends the AT command +CAPPLEVMRNR including
> meas_config_app_layer_id, qoe_measurement_status
> playout_delay_for_media_startup, number_of_buffer_level_entries,
> report_initial_playout_delay, and the app-meas_report to the access stratum.
>
> 10\. The UE sends the message MeasurementReportAppLayer including
> measConfigAppLayerId, appLayerSessionStatus and measReportAppLayerContainer
> to the gNB.
>
> 11\. The gNB sends the QMC report to the MCE associated to the qoEReference.
> The report contains the qoEReference and the RAN transparent container
> including the recordingSessionId and sliceScope (which contains only S-NSSAI
> that is used). _Note that the_ qoEReference _is mapped to the_
> measConfigAppLayerId at gNB _on the previous step and is included in QMC
> report._
# 5 Quality of Experience (QoE) measurement management parameters
## 5.1 QoE collection entity address (M)
This is a parameter which defines the IP address to which the QMC records
shall be transferred. Ipv4 or Ipv6 address(es) may be used.
## 5.2 QoE reference (M)
The QoE reference parameter specify the network request session. The QoE
reference shall be globally unique therefore it is composed as follows:
MCC+MNC+QMC ID, where the MCC and MNC are coming with the QMC activation
request from the management system to identify one PLMN containing the
management system, and QMC ID is a 3 byte Octet String.
The QMC ID is generated by the management system or the operator.
It is used to identify the QoE measurement collection job in the traffic nodes
and in the measurement collection centre.
## 5.3 PLMN target (CM)
This parameter defines the PLMN for which sessions shall be selected in the
network request session in case of area based QMC when several PLMNs are
supported in the RAN (this means that shared cells and not shared cells are
allowed for the specified PLMN. Furthermore, several PLMNs can be used for not
shared RAN cases as well as for shared RAN cases.). Only the sessions may be
selected where the PLMN that the UE reports as selected PLMN is the same as
the PLMN Target.
Note that the PLMN Target might differ from the PLMN specified in the Network
Request Session Id, as that specifies the PLMN that is containing the
management system requesting the Network Request Session from the NE.
The parameter is mandatory if network sharing is deployed.
## 5.4 Area scope (CM)
The area scope parameter defines the area in terms or cells or Tracking
Area/Routing Area/Location Area where the QMC shall take place. If the
parameter is not present the QMC shall be done throughout the PLMN specified
in PLMN target.
The area scope parameter in UMTS is either:
\- List of cells, identified by CGI. Maximum 32 CGI can be defined.
\- List of Routing Area, identified by RAI. Maximum of 8 RAIs can be defined.
\- List of Location Area, identified by LAI. Maximum of 8 LAIs can be defined.
The area scope parameter in LTE is either:
\- list of cells, identified by E-UTRAN-CGI. Maximum 32 CGI can be defined.
\- List of Tracking Area, identified by TAC. Maximum of 8 TAC can be defined.
The area scope parameter in NR is either:
\- list of cells, identified by N-CGI. Maximum 32 NCGI can be defined.
\- List of Tracking Area, identified by TAC. Maximum of 8 TAC can be defined.
The parameter is mandatory if area based QMC is requested.
## 5.5 QMC configuration file (container) (M)
The QMC configuration file is a container that is specified in Annex L of TS
26.247 [6], clause 16.5 of TS 26.114[7] or clause 9.4 of TS 26.118 [13].
The corresponding parameter name for this container in Radio Resource Control
(RRC) Protocol specification is measConfigAppLayerContainer in case of NR and
LTE, see TS 38.331 [11], TS 25.331 [4] or \"Container for application layer
measurement configuration\" in case of UTRAN, see TS 36.331 [8]
For NR, the QMC configuration file parameter in the management interface
defines the location of the container..
## 5.6 QMC target (M)
The QMC target parameter specifies it the QMC is area based or individual UE
based.
\- Area based QMC (0)
\- Individual UE based QMC (1)
NOTE: Void.
## 5.7 Recording session id (M)
This parameter shall be a 2 byte octet string. The recording session id shall
be the same for the whole session in the application, while for each different
session in the application the recording session id shall be changed. The
recording session id is generated by the application in the UE.
It is used in the measurement collection centre to identify which session
within a UE has collected information in the application.
## 5.8 Service type (M)
Which kind of service that shall be recorded.
\- DASH (0)
\- MTSI (1)
\- VR (2)
DASH measurements are specified in [6]. MTSI measurements are specific in [7].
VR measurements are specified in TS 26.118 [13].
## _5.9 Slice scope (CM)_
This parameter contains a list of S-NSSIAs (Single Network Slice Selection
Assistance Information). A Network Slice end to end is identified by S-NSSAI.
## 5.10 QoE Target (CM)
This parameter specifies the target object (individual UE) for the QMC in case
of signalling based QMC. The qoETarget parameter shall be able to carry
\"IMSI" or \"SUPI\".
## 5.11 jobId (O)
This parameter presents the job identifier of a QMCJob instance. The jobId can
be used to associate multiple QMCJob instances.
## 5.12 Available RAN visible QoE metrics (O)
This parameter indicate available RAN visible QoE metrics to the gNB. The list
of available RAN visible metrics are outside the legacy QoE configuration
file. This parameter is optional and is valid for NR only.
The gNB configures the RAN visible QoE measurement to collect all or some of
the available RAN visible QoE metrics, where the indication of metric
availability is received from the OAM or the 5GC. Available RAN visible QoE
Metrics are: \"Application Layer Buffer Level List\" and \"Playout Delay for
Media Startup\".
The RAN visible QoE measurements are supported for the DASH streaming and VR
services.
5.13 MDT Alignment information (O)
This parameter indicates the MDT measurements with which alignment of QoE
measurement is required. This parameter is optional and is valid for NR only.
The gNB may activate the MDT measurements upon/after receiving the MDT
activation message from the OAM.
The gNB includes time stamp information to the QoE measurement reports to
enable the correlation of corresponding measurement results of MDT and QoE at
the MCE/TCE. In addition, the gNB includes the MDT session identifiers (Trace
Reference and Trace Recording Session Reference) in the corresponding QoE
measurement report.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
Y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document is part of a series of documents that specify charging
functionality and charging management in 3GPP networks. The 3GPP core network
charging architecture and principles are specified in TS 32.240 [1], which
provides an umbrella for other charging management TSs that specify:
\- the content of the CDRs per domain / subsystem / service (offline
charging);
\- the content of real-time charging messages per domain / subsystem / service
(online charging);
\- the functionality of online and offline charging for those domains /
subsystems / services;
\- the interfaces that are used in the charging framework to transfer the
charging information (i.e. CDRs or charging events).
The complete document structure for these TSs is defined in TS 32.240 [1].
The present document specifies the offline, online and converged charging
description for Northbound Application Program Interfaces (API), based on the
functional stage 2 description in TS 23.682 [243] for transaction over T8
reference point between SCEF and SCS/AS and in TS 23.501 [200] for Network
Exposure Function (NEF). This charging description includes the offline,
online and converged charging architecture and scenarios specific to
Northbound Application Program Interfaces (API), as well as the mapping of the
common 3GPP charging architecture specified in TS 32.240 [1] onto the
Northbound Application Program Interfaces (API). It further specifies the
structure and content of the CDRs for offline charging. The present document
is related to other 3GPP charging TSs as follows:
\- The common 3GPP charging architecture is specified in TS 32.240 [1].
\- The parameters, abstract syntax and encoding rules for the CDRs are
specified in TS 32.298 [51].
\- A transaction based mechanism for the transfer of CDRs within the network
is specified in TS 32.295 [54].
\- The file based mechanism used to transfer the CDRs from the network to the
operator\'s billing domain (e.g. the billing system or a mediation device) is
specified in TS 32.297 [52].
\- The 3GPP Diameter application that is used for Northbound Application
Program Interfaces (API) offline and online charging is specified in TS 32.299
[50].
\- The services, operations and procedures of charging, using Service Based
Interface are specified in TS 32.290 [57].
\- The charging service of 5G system is specified in TS 32.291 [58].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[2] -- [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[53] 3GPP TS 32.296: \"Telecommunication management; Charging management;
Online Charging System (OCS): Applications and interfaces\".
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55] -- [56] Void.
[57] 3GPP TS 32.290: \"Telecommunication management; Charging management; 5G
system; Services, operations and procedures of charging using Service Based
Interface (SBI)\".
[58] 3GPP TS 32.291: \"Telecommunication management; Charging management; 5G
system; Charging service, stage 3\".
[59] -- [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] -- [199] Void
[200] 3GPP TS 23.501:\"System Architecture for the 5G System\".
[201] 3GPP TS 23.502:\"Procedures for the 5G System\".
[202] -- [229] Void
[230] 3GPP TS 29.122: \"T8 reference point for northbound Application
Programming Interfaces (APIs)\".
[231] -- [2235] Void
[236] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage
3\".
[237] -- [242] Void
[243] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
with packet data networks and applications\".
[244] -- [299] Void
[300] -- [399] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [100], TS 32.240 [1] and the following apply. A term defined in
the present document takes precedence over the definition of the same term, if
any, in either 3GPP TR 21.905 [100] or TS 32.240 [1].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Bea Reference point for the CDR file transfer from the Exposure function API
CGF to the BD.
Ga Reference point for CDR transfer between a CDF and the CGF.
Nchf Service based interface exhibited by CHF.
N44 Reference point between the NEF and the CHF
Rf Offline charging reference point between a SCEF and the CDF.
Ro Online charging reference point between a SCEF and the CDF.
T8 Reference point between the SCEF and SCS/AS.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [100] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [100].
AS Application Server
BD Billing Domain
CDF Charging Data Function
CGF Charging Gateway Function
CTF Charging Trigger Function
ECUR Event Charging with Unit Reservation
IE Information Element
IEC Immediate Event Charging
NEF Network Exposure Function
PEC Post Event Charging
SCEF Service Capability Exposure Function
SCS Services Capability Server
SGSN Serving GPRS Support Node
RCAF RAN Congestion Awareness Function
# 4 Architecture considerations
## 4.1 High-level Service Exposure Function architecture
The overall architecture and detailed description for Service Capability
Exposure which enables the 3GPP network to securely expose its services and
capabilities provided by 3GPP network interfaces to external 3^rd^ party
service provider applications are defined in 3GPP TS 23.682 [243], and figure
4.1.1 is highlighting T8 involved for interworking between SCEF and SCS/AS.
Figure 4.1.1: Northbound API of 3GPP Architecture Service Capability Exposure
## 4.2 Northbound API offline charging architecture
_As described in TS 32.240 [1], the CTF (an integrated component in each
charging relevant NE) generates charging events and forwards them to the CDF.
The CDF, in turn, generates CDRs which are then transferred to the CGF.\
Finally, the CGF creates CDR files and forwards them to the BD._
For offline charging, SCEF functioning as the CTF, may generate accounting
metrics sets for Northbound Application Program Interfaces (APIs) CDRs:
\- the SCEF, to record Application Program Interfaces transaction.
If the SCEF generating the charging information has an integrated CDF, then
the SCEF can produce CDRs. The CGF may also be integrated in the SCEF, or it
may exist as a physically separate entity.\ If the CGF is external to the SCEF
/CDF, then the SCEF/CDF forwards the CDRs to the CGF across the Ga interface.
If the CDF is external to the SCEF, the charging events are transferred from
the SCEF to the CDF via the Rf interface specified in TS 32.299 [50].
When an external CGF is used, this CGF may also be used by other. It should be
noted that the CGF may also be an integrated component of the BD -- in this
case, the Bea interface does not exist and is replaced by a proprietary
solution internal to the BD.
Figure 4.2.1 depicts the architectural options described above.
Figure 4.2.1: Northbound API offline charging architecture
It is mandatory to support at least one of the Rf, Ga or Bea interfaces from
the SCEF as described in the present document.
## 4.3 Northbound API online charging architecture
Northbound API online charging is based on SCEF utilizing Ro interface and
application towards the OCS as specified in TS 32.299 [50]. The Ro reference
point covers all online charging functionality required for SCEF.
.
Figure 4.3.1: Northbound API online charging architecture
Details on the interfaces and functions can be found in TS 32.240 [1] for the
general architecture components,\ TS 32.296 [53] for the OCS, and TS 32.299
[50] for the Ro application.
## 4.4 Northbound API converged charging architecture
The architectural options for Northbound API converged charging are depicted
in figure 4.4.1 in service-based representation:
Figure 4.4.1: Northbound API converged charging architecture
Architectural options of figure 4.4.1 apply to any Northbound API converged
charging architecture of this clause.
Details on the interfaces and functions can be found in TS 32.240 [1] for the
general architecture components, Ga is described in clause 5.2.4 and Bea in
clause 5.2.5 of this document, and Nchf is described in TS 32.290 [57].
Figure 4.4.2 depicts the Northbound API converged charging architecture for
non-roaming in reference point representation:
Figure 4.4.2: Northbound API converged charging architecture non-roaming
reference point representation
# 5 Northbound API charging principles and scenarios
## 5.1 Northbound API charging principles
### 5.1.0 General
The following are high level charging requirements for northbound API for
Exposure Function which are specified in TS 23.682 [243] and TS 23.501 [200]:
For northbound API invocation/notification, the SCEF or NEF shall collect the
following charging information:
\- invocations/notifications count of the northbound APIs.
\- identification of the SCS/AS or AF and the associated northbound API
invocation/notification.
\- timestamp of the northbound API invocation/notification.
\- northbound API related information, e.g. location.
### 5.1.1 Northbound API procedures
All procedures that operate across the T8 reference point, as specified in
3GPP TS 23.682 [243] and TS 29.122 [230], are covered, which are the
following:
\- Monitoring
\- Resource management of Background Data Transfer
\- Changing the chargeable party at session set up or during the session
\- Non-IP Data Delivery
\- Device Triggering
\- Group Message Delivery
\- Reporting of Network Status
\- Communication Pattern Parameters Provisioning
\- PFD Management
\- Enhanced Coverage Restriction Control
\- Network Parameter Configuration
\- Setting up an AS session with required QoS
\- MSISDN-less Mobile Originated SMS
The following clauses 5.2 and 5.3 describe the trigger conditions and
simplified message flows for Event Based Charging(IEC/ECUR), with interfaces
specified in 3GPP TS 32.299 [50].
The **Northbound** APIs supported by the NEF via the set of exposed services
defined in 3GPP TS 23.502 [201] are covered for converged charging, with the
trigger conditions and message flows defined in clause 5.4.
## 5.2 Northbound API offline charging scenarios
### 5.2.1 Basic principles
If charging is supported by an SCEF, it shall be able to collect charging
information per T8 transaction.
The SCS/AS is identified by the SCS Identifier, which T8 transaction between
SCEF and SCS/AS can be determined by a T8 Long Term Transaction Reference ID
(TLTRI). The Identifiers are stored on both the SCEF and the SCS/AS for the
duration of the transaction.
The following chargeable events are defined for SCEF charging for all
Northbound APIs:
\- Northbound API invocation/ notification per T8 transaction.
\- Expiry of an operator configured time limit per T8 transaction.
\- Expiry of an operator configured Northbound API invocation limit per T8
transaction.
Management intervention may also force trigger a chargeable event.
The subscriber is the API invoker (e.g. SCS, AS) of the Northbound APIs.
### 5.2.2 Rf message flows
#### 5.2.2.1 Triggers for charging events from SCEF
When a charging event is reported to the CDF, it includes the details such as
SCEF address, charging information with corresponding charging events to the
CDF.
The trigger conditions specified in Table 5.2.2.1.1 are applicable for
charging information collection.
Table 5.2.2.1.1: Triggers for Charging Data Request from SCEF
* * *
message Triggering conditions Charging Data Request[Event] T8 transaction
creation via HTTP POST T8 transaction update via HTTP PATCH message, HTTP PUT
message received by SCEF T8 transaction termination via HTPP DELETE
* * *
### 5.2.3 CDR generation
#### 5.2.3.1 Introduction
For the exposure functions SCEF, an exposure function API CDR is generated for
subsequent transfer to the Charging Gateway Function (CGF).
The following clauses describe the trigger conditions for these exposure
function API CDRs creation, update and closure.
#### 5.2.3.2 Triggers for EA-SCE-CDR creation and closure
##### 5.2.3.2.1 Triggers for EA-SCE-CDR generation
A EA-SCE-CDR is used to collect charging information related to API
invocation/notification offline charging from the SCEF.
A single EA-SCE-CDR shall be generated for each event when the API invocation
or notification is encountered.
### 5.2.4 Ga record transfer flows
Details of the Ga protocol application are specified in TS 32.295 [54].
### 5.2.5 Bea CDR file transfer
Details of the Bea protocol application are specified in TS 32.297 [52].
## 5.3 Northbound API online charging scenarios
### 5.3.1 Basic principles
#### 5.3.1.1 General
Northbound API online charging is performed by the SCEF using the common Ro
based Credit-Control application specified in TS 32.299 [50]. In order to
provide the data required for the management activities outlined in TS 32.240
[1], the SCEF shall be able to perform online charging for the following:
\- Charging data related to northbound API invocation;
\- Charging data related to northbound API notification.
Event based online charging IEC and ECUR are applicable scenarios for the
SCEF.
### 5.3.2 Ro message flows
#### 5.3.2.1 Event Based Charging
This clause contains message flows for the different operation models IEC and
ECUR, when the one-time API invocation is per T8 interaction is activated.
e.g. Enhanced Coverage Restriction Control API, MSISDN-less Mobile Originated
SMS API.
Figure 5.3.2.1.1: Online charging in API Invocation for IEC
1) SCEF receives an API invocation Request.
2) The SCEF triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SCEF.
5) If authorized, the SCEF continues the API invocation processing and send
out the API Invocation Response.
Figure 5.3.2.1.2: Online charging in API Notification for IEC
1) SCEF receives a notification from 3GPP network element.
2) The SCEF triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SCEF.
5) SCEF sends the notification to SCS/AS.
6) SCEF receives acknowledgement for the notification.
Figure 5.3.2.1.3: Online charging in API Invocation for ECUR
1) SCEF receives an API invocation Request.2) The SCEF triggers a Reserve
Units Request [Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SCEF.
5) If authorized, the SCEF continues the API invocation processing and send
out the API Invocation Response.
6) The SCEF triggers a Debit Units Request [Terminate] message to the OCS
reporting the successful event transaction.
7) The OCS performs the appropriate credit processing based on the received
request.
8) The OCS responds with a Debit Units Response message to the SCEF.
Figure 5.3.2.1.4: Online charging in API Notification for ECUR
1) SCEF receives a notification from 3GPP network entities.
2) The SCEF triggers a Reserve Units Request [Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SCEF.
5) SCEF sends the notification to SCS/AS.
6) SCEF receives acknowledgement for the notification.
7) The SCEF triggers a Debit Units Request [Terminate] message to the OCS
reporting the successful event transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Debit Units Response message to the SCEF.
## 5.4 Northbound API converged online and offline charging scenarios
### 5.4.1 Basic principles
#### 5.4.1.1 General
Converged charging may be performed by the NEF interacting with CHF using Nchf
specified in TS 32.290 [57] and TS 32.291 [58]. In order to provide the data
required for the management activities outlined in TS 32.240 [1] (Credit-
Control, accounting, billing, statistics etc.), the NEF shall be able to
perform converged charging for the northbound API access.
The NEF shall be able to perform convergent charging by interacting with CHF,
for charging data related to Northbound API access. The Charging Data Request
and Charging Data Response are exchanged between the NEF and the CHF, based on
PEC, either IEC or ECUR scenarios specified in TS 32.290 [57]. The Charging
Data Request is issued by the NEF towards the CHF when certain conditions
(chargeable events) are met.
Converged charging uses centralized or decentralized unit determination and
centralized rating scenarios for event based convergent charging specified in
TS 32.290 [57].
The contents and purpose of each charging event that triggers interaction with
CHF, as well as the chargeable events that trigger them, are described in the
following clauses.
A detailed formal description of the converged charging parameters defined in
the present document is to be found in TS 32.291 [58].
A detailed formal description of the CDR parameters defined in the present
document is to be found in TS 32.298 [51].
The selection of the CHF can be configured in the NEF but may also rely on
NRF.
#### 5.4.1.2 Applicable Triggers in the NEF
##### 5.4.1.2.1 General
When a charging event is issued towards the CHF, it includes details such as
Subscriber identifier (e.g. identifier of the AF).
Each trigger condition (i.e. chargeable event) defined for the NEF converged
charging functionality, is specified with the associated behaviour when they
are met.
Table 5.4.1.2.1.1 summarizes the set of default trigger conditions and their
category which shall be supported by the NEF when charging is active for the
corresponding NEF functionality. For \"immediate report\" category, the table
also provides the corresponding Charging Data Request message sent from NEF
towards the CHF.
Table 5.4.1.2.1.1: Default Trigger conditions in NEF
+----------+----------+----------+----------+----------+----------+ | Trigger | Trigger | Default | CHF | CHF | Message | | Co | level | category | allowed | allowed | when | | nditions | | | to | to | \"i | | | | | change | enable | mmediate | | | | | category | and | rep | | | | | | disable | orting\" | | | | | | | category | +----------+----------+----------+----------+----------+----------+ | API | - | I | Not | Not | IEC: | | In | | mmediate | Ap | Ap | Charging | | vocation | | | plicable | plicable | Data | | | | | | | Request | | | | | | | \ | | | | | | | [Event] | | | | | | | | | | | | | | ECUR: | | | | | | | Charging | | | | | | | Data | | | | | | | Request | | | | | | | [I | | | | | | | nitial] | +----------+----------+----------+----------+----------+----------+ | API | - | I | Not | Not | PEC: | | In | | mmediate | Ap | Ap | Charging | | vocation | | | plicable | plicable | Data | | Response | | | | | Request | | | | | | | \ | | | | | | | [Event] | | | | | | | | | | | | | | ECUR: | | | | | | | Charging | | | | | | | Data | | | | | | | Request | | | | | | | [Termi | | | | | | | nation] | +----------+----------+----------+----------+----------+----------+ | API | - | I | Not | Not | IEC: | | Noti | | mmediate | Ap | Ap | Charging | | fication | | | plicable | plicable | Data | | | | | | | Request | | | | | | | \ | | | | | | | [Event] | | | | | | | | | | | | | | ECUR: | | | | | | | Charging | | | | | | | Data | | | | | | | Request | | | | | | | [I | | | | | | | nitial] | +----------+----------+----------+----------+----------+----------+ | API | - | I | Not | Not | PEC: | | Noti | | mmediate | Ap | Ap | Charging | | fication | | | plicable | plicable | Data | | to NF | | | | | Request | | | | | | | \ | | | | | | | [Event] | +----------+----------+----------+----------+----------+----------+ | API | - | I | Not | Not | ECUR: | | Noti | | mmediate | Ap | Ap | Charging | | fication | | | plicable | plicable | Data | | acknowl | | | | | Request | | edgement | | | | | [Termi | | | | | | | nation] | +----------+----------+----------+----------+----------+----------+
### 5.4.2 Message flows
#### 5.4.2.1 Introduction
The different scenarios below focus on the different messages from/to the NEF
and corresponding interaction with the CHF, based on scenarios specified in TS
23.222 [202].
#### 5.4.2.2 API Invocation - IEC
Figure 5.4.2.2.1 describes the scenario where there is an API invocation
request at the NEF for IEC mode
Figure 5.4.2.2.1: API Invocation Request to NEF using IEC
> 1\. NEF receives an API invocation Request from an AF.
>
> 1ch-a. The NEF sends Charging Data Request [Event] to CHF for the received
> API Invocation.
>
> 1ch-b. The CHF creates a CDR for this API Invocation.
>
> 1ch-c. The CHF acknowledges and grants authorization by sending Charging
> Data Response [Event] to the NEF.
>
> 2\. NEF performs the actions needed to fulfil the API invoked.
>
> 3\. If authorized, the NEF continues the API invocation processing and sends
> the API Invocation Response.
#### 5.4.2.3 API Invocation - ECUR
Figure 5.4.2.3.1 describes the scenario where there is an API invocation
request at the NEF for ECUR mode.
Figure 5.4.2.3.1: API Invocation Request to NEF using ECUR
1\. NEF receives an API invocation Request from an AF.
1ch-a. The NEF sends Charging Data Request [Initial] to CHF for the received
API Invocation.
1ch-b. The CHF opens CDR for this API Invocation.
1ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
NEF.
> 2\. NEF performs the actions needed to fulfil the API invoked.
3\. If authorized, the NEF continues the API invocation processing and sends
the API Invocation Response.
3ch-a. The NEF sends Charging Data Request [Termination] to the CHF for
terminating the charging associated with the API Invocation.
3ch-b. The CHF closes the CDR for this API Invocation.
3ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to
the NEF.
#### 5.4.2.4 API Notification - IEC
Figure 5.4.2.4.1 describes the scenario where an API Notification is delivered
from the NEF for IEC mode
Figure 5.4.2.4.1 API Notification from NEF using IEC
1\. The NEF receives a notification from an NF.
1ch-a. The NEF sends Charging Data Request [Event] to CHF for the
Notification.
1ch-b. The CHF creates a CDR for this Notification.
1ch-c. The CHF acknowledges and grant authorization by sending Charging Data
Response [Event] to the NEF.
2\. The NEF sends the notification to AF.
3\. The NEF receives acknowledgement for the notification.
#### 5.4.2.5 API event Notification - ECUR
Figure 5.4.2.5.1 describes the scenario where an API event Notification is
delivered from the NEF for ECUR mode.
Figure 5.4.2.4.1: API Notification from NEF using ECUR
1\. The NEF receives a notification from an NF.
1ch-a. The NEF sends Charging Data Request [Initial] to CHF for the
Notification.
1ch-b. The CHF opens CDR for this API Notification.
1ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
NEF.
2\. The NEF sends the notification to AF.
3\. The NEF receives acknowledgement for the notification.
3ch-a. The NEF sends Charging Data Request [Termination] to the CHF for
terminating the charging associated with the API event Notification.
3ch-b. The CHF closes the CDR for this API Notification.
3ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to
the NEF.
#### 5.4.2.6 API Invocation - PEC
Figure 5.4.2.6.1 describes the scenario where there is an API invocation
request at the NEF for PEC mode
Figure 5.4.2.6.1: API Invocation Request to NEF using PEC
> 1\. NEF receives an API invocation Request from an AF.
>
> 2\. NEF performs the actions needed to fulfil the API invoked.
>
> 3\. If authorized, the NEF continues the API invocation processing and sends
> the API Invocation Response.
>
> 3ch-a. The NEF sends Charging Data Request [Event] to CHF for the received
> API Invocation.
>
> 3ch-b. The CHF creates a CDR for this API Invocation.
>
> 3ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
> NEF.
#### 5.4.2.7 API Notification - PEC
Figure 5.4.2.7.1 describes the scenario where an API Notification is delivered
from the NEF for PEC mode
Figure 5.4.2.7.1 API Notification from NEF using PEC
1\. The NEF receives a notification from an NF.
2\. The NEF sends the notification to AF.
2ch-a. The NEF sends Charging Data Request [Event] to CHF for the
Notification.
2ch-b. The CHF creates a CDR for this Notification.
2ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
NEF.
3\. The NEF receives acknowledgement for the notification.
### 5.4.3 CDR generation
#### 5.4.3.1 Introduction
The CHF CDRs for NEF charging are generated by the CHF to collect charging
information that they subsequently transfer to the Charging Gateway Function
(CGF).
The following clauses describe in details the conditions for generating,
opening and closing the CHF CDR, which shall be supported by the CHF.
#### 5.4.3.2 Triggers for CHF CDR
##### 5.4.3.2.1 General
A Northbound API charging CHF CDR is used to collect charging information
related to northbound API invocation and notifications chargeable events for
PEC, IEC and ECUR.
##### 5.4.3.2.2 Triggers for CHF CDR generation
A CHF CDR is generated by the CHF for each received Charging Data
Request[Event].
##### 5.4.3.2.3 Triggers for CHF CDR opening
A CHF CDR shall be opened when the CHF receives Charging Data
Request[Initial].
##### 5.4.3.2.4 Triggers for CHF CDR closure
The CHF CDR shall be closed when the CHF receives Charging Data
Request[Termination].
### 5.4.4 Ga record transfer flows
Details of the Ga protocol application are specified in TS 32.295 [6].
### 5.4.5 Bea CDR file transfer
Details of the Bea protocol application are specified in TS 32.297 [5].
# 6\. Definition of charging information
## 6.1 Data description for Northbound API offline charging
### 6.1.1 Rf message contents
#### 6.1.1.1 General
The Exposure Function API offline charging uses the Charging Data Transfer
messages Charging Data Request and Charging Data Response defined in TS 32.299
[50].
The Charging Data Request can be of type event and includes all charging
information. The Charging Data Response is an acknowledgement of the Charging
Data Request.
Table 6.1.1.1.1 describes the use of these messages for offline charging.
Table 6.1.1.1.1: Offline charging messages reference table
* * *
**Message** **Source** **Destination** Charging Data Request SCEF CDF Charging
Data Response CDF SCEF
* * *
The following clauses describe the different fields used in the Charging Data
messages and the category in the tables is used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [1].
#### 6.1.1.2 Charging data request message
Table 6.1.1.2.1 illustrates the basic structure of a Charging Data Request
message from the SCEF as used for Exposure Function API offline charging.
Table 6.1.1.2.1: Charging Data Request message contents
* * *
**Information Element** **Category** **Description** Session Identifier M
Described in TS 32.299 [50] Originator Host M Described in TS 32.299 [50]
Originator Domain M Described in TS 32.299 [50] Destination Domain M Described
in TS 32.299 [50] Operation Type M Described in TS 32.299 [50] Operation
Number M Described in TS 32.299 [50] Operation Identifier O~C~ Described in TS
32.299 [50] User Name O~C~ Described in TS 32.299 [50] Destination Host O~C~
Described in TS 32.299 [50] Operation Interval O~C~ Described in TS 32.299
[50] Origination State O~C~ Described in TS 32.299 [50] Origination Timestamp
O~C~ Described in TS 32.299 [50] Proxy Information O~C~ Described in TS 32.299
[50] Route Information O~C~ Described in TS 32.299 [50] Operation Token O~M~
This field identifies the Exposure Function API domain service. Service
Information O~M~ This field holds the Exposure Function API specific
information described in clause 6.3.
* * *
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
#### 6.1.1.3 Charging data response message
Table 6.1.1.3.1 illustrates the basic structure of a Charging Data Response
message as used for Exposure Function API offline charging.
Table 6.1.1.3.1: Charging Data Response message contents
* * *
**Information Element** **Category** **Description** Session Identifier M
Described in TS 32.299 [50] Operation Result M Described in TS 32.299 [50]
Originator Host M Described in TS 32.299 [50] Originator Domain M Described in
TS 32.299 [50] Operation Type M Described in TS 32.299 [50] Operation Number
O~C~ Described in TS 32.299 [50] Operation Identifier O~C~ Described in TS
32.299 [50] Operation Interval O~C~ Described in TS 32.299 [50] Error
Reporting Host O~C~ Described in TS 32.299 [50] Origination State O~C~
Described in TS 32.299 [50] Origination Timestamp O~C~ Described in TS 32.299
[50] Proxy Information O~C~ Described in TS 32.299 [50]
* * *
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
### 6.1.2 Ga message contents
Refer to clause 5.2.4 for further information.
### 6.1.3 CDR description on the Bea interface
#### 6.1.3.1 General
The following standard CDRs content and format are considered:
\- EA-SCE-CDR generated for exposure function API from the SCEF.
For each of the CDR types, a parameter table, which gives a short description
of the parameters, is provided. The category in the tables is used according
to the charging data configuration defined in clause 5.4 of TS 32.240 [1].
Full definitions of the CDR parameters, sorted by the name in alphabetical
order, are provided in TS 32.298 [51].
#### 6.1.3.2 Exposure Function API charging data (EA-SCE-CDR)
Exposure function API record shall be produced for each API invocation to the
SCEF. The fields in the record are specified in table 6.1.3.2.1.
Table 6.1.3.2.1: Exposure function API from SCEF charging data (EA-SCE-CDR)
* * *
**Field** **Category** **Description** Record Type M SCEF exposure function
API record. Retransmission O**~c~** This parameter, when present, indicates
that information from retransmitted Accounting Requests has been used in this
CDR. Service Context Id OM This parameter indicates the CDR is applicable to
exposure function API service. Node Id O~**M** M~ Name of the recording
entity. SCEF ID M This parameter holds the identity of the SCEF used for this
API invocation. SCEF Address O**~c~** This parameter holds the IP address of
SCEF. API Identifier M This field holds the identity of API for each API
invocation. TLTRI O**~c~** This field holds the T8 Long Term Transaction
Reference ID. SCS/AS Address M This field holds the IP address of SCS/AS Event
Timestamp M This field holds the time stamp of the event reported. API
Invocation Timestamp This field holds the time stamp when the API invocation
request is submitted to the SCEF from SCS/AS. API Direction O**~c~** This
field holds the direction to indicate the API invocation or API notification.
API Network Service Node O**~c~** This field holds the identifier of the
network element (e.g. SGSN, RCAF)that triggers the API notification as defined
in TS 23.682 [243]. API Content O**~c~** This field holds the API content
(e.g. location, Monitoring Type) used in the T8 transaction for the API
invocation request, if available. API Size O**~c~** This field holds the size
of API payload. API Result Code O**~c~** This field holds the result of API
Invocation. External Identifier O**~c~** This field holds the external
Identifier identifying the served party associated to the IMSI or MSISDN or
External Group ID, if available. Local Record Sequence Number O**~M~**
Consecutive record number created by this node. The number is allocated
sequentially including all CDR types. Record Extensions O**~c~** A set of
network operator/manufacturer specific extensions to the record. Conditioned
upon the existence of an extension.
* * *
## 6.2 Data description for Northbound API online charging
### 6.2.1 Ro message contents
#### 6.2.1.0 Introduction
The SCEF generates Debit / Reserve Units information that can be transferred
from the CTF to the OCF. For this purpose, SCEF online charging utilizes the
_Debit Units and Reserve Units_ procedure that is specified in the 3GPP Debit
/ Reserve Units operation in TS 32.299 [50].
#### 6.2.1.1 Summary of message formats
Table 6.2.1.1.1 describes the use of these messages for SCEF online charging.
Table 6.2.1.1.1: SCEF online charging messages contents
* * *
Command-Name Source Destination Debit / Reserve Units Request SCEF OCF Debit /
Reserve Units Response OCF SCEF
* * *
This clause describes the different fields used in the Debit / Reserve Units
Request and Debit / Reserve Units Reponses messages and the category in the
tables are used according to the charging data configuration defined in clause
5.4 of TS 32.240 [1].
Detailed descriptions of the fields are provided in TS 32.299 [50].
#### 6.2.1.2 Structure for the Credit-Control message formats
##### 6.2.1.2.1 Debit/Reserve Units Request message
Table 6.2.1.2.1.1 illustrates the basic structure of a _Debit / Reserve Units
Request_ message from SCEF as used for exposure function API online charging.
Table 6.2.1.2.1.1: Debit / Reserve Units Request message contents for exposure
function API
* * *
Information Element Category Description Session Identifier M Described in TS
32.299 [50] Originator Host M Described in TS 32.299 [50] Originator Domain M
Described in TS 32.299 [50] Destination Domain M Described in TS 32.299 [50]
Operation Identifier M Described in TS 32.299 [50] Operation Token M Described
in TS 32.299 [50] Operation Type M Described in TS 32.299 [50] Operation
Number M Described in TS 32.299 [50] Destination Host O**~C~** Described in TS
32.299 [50] User Name O**~C~** Described in TS 32.299 [50] Origination State
O**~C~** Described in TS 32.299 [50] Origination Timestamp O**~C~** Described
in TS 32.299 [50] Subscriber Identifier O**~M~** This field contains the
identification of the subscriber (i.e. SCS/AS Identifier) that uses the
requested service. Termination Cause O**~C~** Described in TS 32.299 [50]
Requested-Action O**~C~** This field contains the requested action, used for
IEC only. Multiple Operation O**~M~** This field indicate the occurrence of
multiple operations. Multiple Unit Operation O**~C~** This field contains the
parameter for the quota management. Proxy Information O**~C~** This field
contains the parameter of the proxy. Route Information O**~C~** This field
contains the parameter of the route. Service Information O**~M~** This field
holds the SCEF specific parameter and is described in clause 6.3.
* * *
##### 6.2.1.2.2 Debit / Reserve Units Response message
Table 6.2.1.2.2.1 illustrates the basic structure of a Debit / Reserve Units
Response message as used for SCEF charging.
This message is always used by the OCS as specified below, independent of the
receiving SCEF and the operation type that is being replied to.
Table 6.2.1.2.2.1: Debit / Reserve Units Response message contents for
exposure function API
* * *
Information Element Category Description Session Identifier M Described in TS
32.299 [50] Operation Result M Described in TS 32.299 [50] Originator Host M
Described in TS 32.299 [50] Originator Domain M Described in TS 32.299 [50]
Operation Identifier M Described in TS 32.299 [50] Operation Type M Described
in TS 32.299 [50] Operation Number M Described in TS 32.299 [50] Multiple Unit
Operation O**~C~** Described in TS 32.299 [50] Operation Failure Action
O**~C~** Described in TS 32.299 [50] Operation Event Failure Action O~C~
Described in TS 32.299 [50] Redirection Host O~C~ Described in TS 32.299 [50]
Redirection Host Usage O~C~ Described in TS 32.299 [50] Route Information O~C~
Described in TS 32.299 [50] Failed parameter O~C~ Described in TS 32.299 [50]
Service Information O~C~ Described in TS 32.299 [50]
* * *
## 6.2a Data description for NEF converged charging
### 6.2a.1 Message contents
#### 6.2a.1.1 General
The Charging Data Request and Charging Data Response are specified in TS
32.290 [57] and include charging information. The Charging Data Request can be
of type [Event, Initial, Termination].
Table 6.2a.1.1.1 describes the use of these messages for converged charging.
Table 6.2a.1.1.1: Converged charging messages reference table
* * *
**Message** **Source** **Destination** **Charging Data Request** NEF CHF
**Charging Data Response** CHF NEF
* * *
The following clauses describe the different fields used in the Charging Data
messages and the category in the tables is used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [2].
#### 6.2a.1.2 Structure for the converged charging message formats
##### 6.2a.1.2.1 Charging Data Request message
Table 6.2a.1.2.1.1 illustrates the basic structure of a _Charging Data
Request_ message as used for NEF converged charging.
Table 6.2a.1.2.1.1: Charging Data Request message contents
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | **Session Identifier** | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Subscriber | O~M~ | Described in TS 32.290 | | Identifier** | | [57], and holds the | | | | identifier of the AF | +--------------------------+--------------+--------------------------+ | **NF Consumer | M | Described in TS 32.290 | | Identification** | | [57] | +--------------------------+--------------+--------------------------+ | Charging Identifier | O~M~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Invocation Timestamp** | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Invocation Sequence | M | Described in TS 32.290 | | Number** | | [57] | +--------------------------+--------------+--------------------------+ | Retransmission Indicator | - | This field is not | | | | applicable. | +--------------------------+--------------+--------------------------+ | **One-time Event** | O~C~ | Described in TS 32.290 | | | | [57]. | +--------------------------+--------------+--------------------------+ | One-time Event Type | O~C~ | Described in TS 32.290 | | | | [57]. | +--------------------------+--------------+--------------------------+ | **Notify URI** | - | This field is only | | | | applicable for the | | | | notification of abort | | | | charging.. | +--------------------------+--------------+--------------------------+ | Supported Features | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Triggers** | O~C~ | This field is described | | | | in TS 32.290 [57] and | | | | holds the NEF specific | | | | triggers described in | | | | clause 5.4.1.2 | +--------------------------+--------------+--------------------------+ | **Multiple Unit Usage** | O~C~ | This field contains the | | | | parameters for the quota | | | | management request | | | | and/or usage reporting. | +--------------------------+--------------+--------------------------+ | > Rating Group | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Requested Unit | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Used Unit Container | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **NEF API Charging | O~M~ | This field holds the NEF | | Information** | | API specific information | | | | described in clause | | | | 6.3.1.4 | +--------------------------+--------------+--------------------------+
##### 6.2a.1.2.2 Charging Data Response message
Table 6.2a.1.2.2.1 illustrates the basic structure of a _Charging Data
Response_ message as used for NEF converged charging.
Table 6.2a.1.2.2.1: Charging Data Response message content
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | **Session Identifier** | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Invocation Timestamp** | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Invocation Result** | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Invocation Sequence | M | Described in TS 32.290 | | Number** | | [57] | +--------------------------+--------------+--------------------------+ | **Session Failover** | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Supported Features | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | **Triggers** | - | This field is not | | | | applicable. | +--------------------------+--------------+--------------------------+ | **Multiple Unit | O~C~ | This field holds the | | Information** | | parameters for the quota | | | | management information. | +--------------------------+--------------+--------------------------+ | > Result Code | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Rating Group | O~M~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Granted Unit | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Validity Time | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+
### 6.2a.2 G~a~ message contents
Refer to clause 5.4.4.
### 6.2a.3 CDR description on the B~ea~ interface
#### 6.2a.3.1 General
This clause describes the CDR content and format generated for NEF converged
charging.
The following tables provide a brief description of each CDR parameter. The
category in the tables is used according to the charging data configuration
defined in clause 5.4 of TS 32.240 [2]. Full definitions of the CDR
parameters, sorted by the name in alphabetical order, are provided in TS
32.298 [3].
#### 6.2a.3.2 NEF charging CHF CDR data
If enabled, CHF CDRs for NEF charging shall be produced for NEF chargeable
events.
The fields of NEF charging CHF CDR are specified in table 6.2a.3.2.1.
Table 6.2a.3.2.1: NEF charging CHF record data
* * *
**Field** **Category** **Description** **Record Type** **M** **Described in TS
32.298 [3]** **Recording Network Function ID** **O~M~** **Described in TS
32.298 [3]** **Subscriber Identifier** **M** This field contains the
identification of the API user (e.g. SCS Identifier) **NF Consumer
Information** **O~C~** **This field holds the information of the NEF that used
the charging service** **Triggers** **O~C~** **This field is described in TS
32.298 [3] and holds the NEF specific triggers described in clause 5.4.1.2**
**List of Multiple Unit Usage** **O~M~** **Described in TS 32.298 [3]**
**Record Opening Time** **O~C~** **Described in TS 32.298 [3]** **Duration**
**M** **Described in TS 32.298 [3]** **Record Sequence Number** **O~C~**
**Described in TS 32.298 [3]** **Cause for Record Closing** **M** **Described
in TS 32.298 [3]** **Local Record Sequence Number** **O~M~** **Described in TS
32.298 [3]** **Record Extensions** **O~C~** **Described in TS 32.298 [3]**
**NEF API Charging Information** **O~M~** **This field holds the NEF specific
information defined in clause 6.3.1.4**
* * *
## 6.3 Northbound API charging specific parameters
### 6.3.1 Definition of Northbound API charging information
#### 6.3.1.1 Exposure Function API charging information assignment for Service
Information
The components in the Service Information that are used for Exposure Function
API charging can be found in table 6.3.1.1.1.
Table 6.3.1.1.1: Service Information used for Exposure Function API charging
* * *
Information Element Category Description
Service Information O~M~ This is a structured field and holds the 3GPP
specific parameter as defined in TS 32.299 [50].
Subscriber Identifier O~M~ This field contains the identification of the user
(i.e. SCS Identifier).
IMS Information O~M~ This is a structured field and holds IMS specific
parameters.\ The complete structure is defined in TS 32.260 [20].
Node Functionality O**~c~** This IE Identifies the type of record.
Exposure Function API Information O~M~ This is a structured field and holds
the Exposure Function API specific parameters.\ The details are defined in
clause 6.3.1.2.
* * *
#### 6.3.1.2 Definition of the Exposure Function API Information
Exposure Function API specific charging information is provided within the
Exposure Function API Information. The fields of the Exposure Function API
Information are indicated with the SCEF from which the information is sent.
The detailed structure of the Exposure Function API Information can be found
in table 6.3.1.2.1.
Table 6.3.1.2.1: Structure of the Exposure Function API Information
* * *
Information Element Category Description Supported Features O**~c~** This
field holds the list of features supported by the SCEF, CDF or OCF as defined
in clause 6.3.1.3. External Identifier O**~c~** This parameter holds the
external Identifier identifying the served party associated to the IMSI or
MSISDN or External Group ID, if available SCEF ID O**~c~** This parameter
holds the Diameter identity of the SCEF used for API invocation. SCEF Address
O**~c~** This parameter holds the IP address of SCEF. API Identifier O**~M~**
This parameter holds the identity of API SCS/AS Address O**~M~** This
parameter holds the IP address of SCS/AS which invoke the API via T8 interface
TLTRI O**~c~** This parameter holds T8 Long Term Transaction Reference ID is
which refers to long term transaction (e.g. NIDD Configuration, Group Message
Request, Monitoring Event configuration) between the SCEF and the SCS/AS when
using T8 interface. Event Timestamp M This field holds the time stamp of the
event reported. API Invocation Timestamp O**~c~** This parameter holds the
time stamp when API Invocation request was submitted to the SCEF from SCS/AS.
API Direction O**~c~** This field holds the direction to indicate the API
invocation or API notification. API Network Service Node O**~c~** This field
holds the identifier the network element (e.g. SGSN, RCAF) that triggers the
API notification, as defined in 23.682 [243]. API Content O**~c~** This
parameter holds the API content (e.g. Location, Monitoring Type) used in the
T8 transaction for the API invocation request, if available. API Size O**~c~**
This parameter holds size of API payload. API Result Code O**~c~** This
parameter holds the result of API Invocation.
* * *
#### 6.3.1.3 Supported features
The Supported features information that is used for Exposure Function API
charging is based on the information defined for the supported features
mechanism specified in clause 6.5.10 of TS 32.299 [50].
The following table defines the features applicable for the feature lists with
a Feature-List-ID of 1.
Table 6.3.1.3.1: Features of Feature-List-ID 1 used in Exposure Function API
charging
+------------------+---------+------------------+----------------+ | Feature bit | Feature | Description | Online/Offline | +------------------+---------+------------------+----------------+ | 0 | NAPS-CH | This feature | Both | | | | indicates the | | | | | support Exposure | | | | | Function API | | | | | charging. | | +------------------+---------+------------------+----------------+ | Feature bit: The | | | | | order number of | | | | | the bit within | | | | | the Feature-List | | | | | AVP where the | | | | | least | | | | | significant bit | | | | | is assigned | | | | | number \"0\". | | | | | | | | | | Feature: A short | | | | | name that can be | | | | | used to refer to | | | | | the bit and to | | | | | the feature, | | | | | e.g., \"EPS\". | | | | | | | | | | Feature in this | | | | | table is always | | | | | mandatory since | | | | | it relates to | | | | | the charging | | | | | functionality of | | | | | a network | | | | | feature. | | | | | | | | | | Description: A | | | | | clear textual | | | | | description of | | | | | the feature. | | | | +------------------+---------+------------------+----------------+
#### 6.3.1.4 Definition of the NEF API Information
##### 6.3.1.4.1 Definition of the NEF API Charging Information
Network Exposure Function API specific charging information is provided within
the NEF API Charging Information. The detailed structure of the NEF API
Charging Information can be found in table 6.3.1.4.1.
Table 6.3.1.4.1: Structure of the NEF API Charging Information
* * *
Information Element Category Description External Individual Identifier O~C~
This parameter holds the external Identifier of the individual UE, e.g., the
GPSI. Internal Individual Identifier O~C~ This parameter holds the internal
Identifier of the individual UE e.g., the SUPI. External Group Identifier
**O~C~** This parameter holds the external identifier for a group of
individual UE(s), if available. Internal Group Identifier **O~C~** The
internal Identifier identifying a group of individual UE(s). API Direction M
This field holds the direction to indicate if it is an API invocation from an
AF or notification to an AF. API Target Network Function O~C~ This field holds
the identifier of the network function that either is the destination of the
API invocation or triggers the notification: e.g. PCF, UDM, AMF, SMF, UPF. API
Result Code O~C~ This parameter holds the result of API Invocation. API Name M
This field holds the name of the API invoked. API Operation O~C~ This field
holds the operation of the API invoked, together with detailed description.
API Reference O~C~ This field holds the reference to the definition of the
format of the API invocation, this can be a URI or refence to the standard
where it\'s specified API Content O~C~ This field holds the actual content of
the API invocation, in the format described by the API Reference
* * *
### 6.3.2 Detailed message format for offline charging
The following clause specifies per Operation Type the charging data that are
sent by SCEF for Exposure Function API offline charging.
The Operation Types are listed in the following order: S (Start)/I (Interim)/S
(Stop)/E (Event). Therefore, when all Operation Types are possible it is
marked as SISE. If only some Operation Types are allowed for a node, only the
appropriate letters are used (i.e. SIS or E) as indicated in the table
heading. The omission of an Operation Type for a particular field is marked
with \"-\" (i.e. SI-E). Also, when an entire field is not allowed in a node
the entire cell is marked as \"-\".
Table 6.3.2.1 illustrates the basic structure of the supported fields in the
_Charging Data_ Request message for Exposure Function API offline charging.
Table 6.3.2.1: Supported fields in _Charging Data Request message_
* * *
**Information Element** **Node Type** **SCEF** **Supported Operation Types**
**S/I/S/E** Session Identifier ---E  
Originator Host ---E  
Originator Domain ---E  
Destination Domain ---E  
Operation Type ---E  
Operation Number ---E  
Operation Identifier ---E  
User Name ---E  
Destination Host ---E  
Operation Interval ---E  
Origination State ---E  
Origination Timestamp ---E  
Proxy Information ---E  
Route Information ---E  
Operation Token ---E  
Subscriber Identifier ---E  
**Service Information with IMS Information and Exposure Function API
Information**  
Supported Features ---E  
Node Functionality ---E  
External Identifier ---E  
SCEF ID ---E  
SCEF Address ---E  
TLTRI ---E  
API Identifier ---E  
SCS/AS Address ---E  
Event Timestamp ---E  
API Invocation Timestamp ---E  
API Direction ---E  
API Network Service Node ---E  
API Content ---E  
API Size ---E  
API Result Code ---E
* * *
Table 6.3.2.2 illustrates the basic structure of the supported fields in the
_Charging Data_ Response message for Exposure function API offline charging.
Table 6.3.2.2: Supported fields in _Charging Data_ Response message
* * *
Information Element **Node Type** SCEF Supported Operation Types S/I/S/E
Session Identifier ---E  
Operation Result ---E  
Originator Host ---E  
Originator Domain ---E  
Operation Type ---E  
Operation Number ---E  
Operation Identifier ---E  
Operation Interval ---E  
Error Reporting Host ---E  
Origination State ---E  
Origination Timestamp ---E  
Proxy Information ---E  
Session Identifier ---E  
Service Information with Exposure Function API Information  
Supported Features ---E
* * *
### 6.3.3 Detailed message format for online charging
The Operation types are listed in the following order: I [initial] /U
[update]/ T [terminate]/E [event]. Therefore, when all Operation types are
possible it is marked as IUTE. If only some Operation types are allowed for a
node, only the appropriate letters are used (i.e. IT or E) as indicated in the
table heading. The omission of an Operation type for a particular field is
marked with \"-\" (i.e. I-E). Also, when an entire field is not allowed in a
node the entire cell is marked as \"-\".
Table 6.3.3.1 illustrates the basic structure of the supported fields in the
Debit / Reserve Units Request for exposure function API online charging.
Table 6.3.3.1: Supported fields in Debit / Reserve Units Request message
* * *
**Information Element** **Service Type** **SCEF** **Supported Operation
Types** **I/U/T/E** Session Identifier ---E  
Originator Host ---E  
Originator Domain ---E  
Destination Domain ---E  
Operation Identifier ---E  
Operation Token ---E  
Operation Type ---E  
Operation Number ---E  
Destination Host ---E  
User Name ---E  
Origination State ---E  
Origination Timestamp ---E  
Subscriber Identifier ---E  
Termination Cause ---E  
Requested Action ---E  
Multiple Operation ---E  
Multiple Unit Operation ---E  
Proxy Information ---E  
Route Information ---E  
Service Information ---E  
**Service Information with IMS and Exposure Function API Information**  
Supported Features ---E  
Node Functionality ---E  
SCEF Node ---E  
SCEF Address ---E  
SCS/AS Address ---E  
API Identifier ---E  
TLTRI ---E  
Event Timestamp ---E  
API Invocation Timestamp ---E  
API Direction ---E  
API Network Service Node ---E  
API Content ---E  
API Size ---E  
API Result Code ---E  
External Identifier ---E
* * *
Table 6.3.3.2 illustrates the basic structure of the supported fields in the
Debit / Reserve Units Response for exposure function API online charging.
Table 6.3.3.2: Supported fields in _Debit / Reserve Units Response_ Message
* * *
Information Element **Node Type** **SCEF** Supported Operation Types I/U/T/E
Session Identifier ---E  
Operation Result ---E  
Originator Host ---E  
Originator Domain ---E  
Operation Identifier ---E  
Operation Type ---E  
Operation Number ---E  
Operation Failover ---E  
Multiple Unit Operation ---E  
Operation Failure Action ---E  
Redirection Host ---E  
Redirection Host Usage ---E  
Redirection Cache Time ---E  
Route Information ---E  
Failed parameter ---E  
Service Information ---E  
**Service Information with Exposure Function API Information**  
Supported Features I---
* * *
### 6.3.4 Detailed message format for converged charging
The operation types are listed in the following order: I (Initial) / U
(Update)/T (Termination)/E (Event). Therefore, when all Operation types are
possible it is marked as IUTE. If only some operation types are allowed for a
node, only the appropriate letters are used ( e.g., IUT or E) as indicated in
the table heading. The omission of an operation type for a particular field is
marked with \"-\" ( e.g., I-E). Also, when an entire field is not allowed in a
node the entire cell is marked as \"-\".
Table 6.3.4.1 illustrates the basic structure of the supported fields in the
Charging Data Request for exposure function API online charging.
Table 6.3.4.1: Supported fields in Charging Data Request message
* * *
Information Element **Node Type** **NEF** Supported Operation Types IUTE
**Session Identifier** I-TE  
**Subscriber Identifier** I-TE  
**NF Consumer Identification** I-TE  
Charging Identifier I-TE  
**Invocation Timestamp** I-TE  
**Invocation Sequence Number** I-TE  
Retransmission Indicator -  
**One-time Event** \---E  
One-time Event Type ---E  
**Notify URI** I---  
Supported Features I--E  
**Triggers** I-TE  
**Multiple Unit Usage** I-TE  
**NEF API Charging Information**  
External Individual Identifier I-TE  
Internal Individual Identifier ITE  
External Group Identifier I-TE  
Internal Group Identifier I-TE  
API Direction I-TE  
API Target Network Function I-TE  
API Result Code I-TE  
API Name I-TE  
API Operation ITE  
API Reference I-TE  
API Content I-TE
* * *
Table 6.3.4.2 illustrates the basic structure of the supported fields in the
Charging Data Response for exposure function API converged charging.
Table 6.3.4.2: Supported fields in _Charging Data Response_ Message
* * *
Information Element **Node Type** **NEF** Supported Operation Types IUTE
**Session Identifier** I-TE  
**Invocation Timestamp** I-TE  
**Invocation Result** I-TE  
**Invocation Sequence Number** I-TE  
**Session Failover** I-TE  
Supported Features I--E  
**Triggers** \-  
**Multiple Unit Information** I--E
* * *
## 6.4 Bindings for Northbound API offline charging
This clause aims to describe the mapping between the Service Information
fields, AVPs, Ies and CDR parameters for exposure function API online and
offline charging.
Table 6.4.1 describes the mapping of the Diameter Accounting AVP, Ies and CDR
to the CDR parameters of EA-SCE-CDR.
Table 6.4.1: Bindings of CDR Parameters, Information Elements and AVPs
* * *
**CDR Parameter** **Information Element** **AVP** Service Context Id Service
Context Id Service-Context-Id **Service Information** **Service-Information**
**IMS Information** **IMS-Information** Record Type Node Functionality Node-
Functionality **API invocation Information** **API-invocation-Information** \-
Supported Features Supported-Features External Identifier External Identifier
External-Identifier SCEF ID SCEF ID SCEF-ID SCEF Address SCEF Address SCEF-
Address SCS/AS Address SCS/AS Address SCS/AS- Address API Identifier
APIIdentifier API-Identifier TLTRI TLTRI TLTRI Event Timestamp Event Timestamp
Event-Timestamp API Invocation Timestamp API Invocation Timestamp API-
Invocation-Timestamp API Direction API Direction API-Direction API Network
Service Node API Network Service Node API-Network-Service-Node API Content API
Content API -Content API Size API Size API-Size API Result Code API Result
Code API-Result-Code
* * *
## 6.5 Bindings for NEF Northbound API converged charging
This mapping between the Information Elements, resource attributes and CHF CDR
parameters for NEF Northbound API converged charging is described in clause 7
of TS 32.291 [58].
###### ## Annex A (normative): Charging characteristics
# A.1 General
A subscriber (The API Invoker) may have Charging Characteristics assigned to
his subscription. Default charging characteristics may be pre-provisioned on
the SCEF. The charging information content is configured for each API,
including charging method (online and offline charging), Event based charging,
whether report the message content or not.
The Charging Characteristics parameter format is specified TS 32.298 [51].
Each bit of the string of 16 bits corresponds to a specific charging behaviour
which is defined on a per operator basis, configured within the SCEF and
pointed when bit is set to \"1\" value.
One way to define a charging behaviour could be to associate it to a specific
usage, which may consist of a set of trigger profiles associated to CDR types
e.g.:
**\- EA-SCE-CDR:** activate/deactivate CDRs, time limit, data volume limit,
maximum number of API invocation.
In addition to these trigger sets, a CDF/CGF address may also be included.
###### ## Annex B (normative): Support 5G VN group management charging
# B.1 General
This Annex describes the CEF (with UDM) support the 5G VN group management
charging which specified in clause 6.2 TS 32.240 [1].
The CEF based 5G VN group management charging is an alternative to the NEF
based, and may be used instead of the NEF based for the 5G VN group management
charging.
# B.2 Charging Architecture for 5G VN group management charging
## B.2.1 General
The 5G VN group management converged charging architecture including CEF based
charging specified in the following clause B.2.1.1.
### B.2.1.1 Logical Charging architecture - CEF based charging
The logical ubiquitous charging architecture and the reference points for 5G
VN group management with the CEF architecture is shown in figure B.2.1-1.
Figure B.2.1.1-1: Logical ubiquitous charging architecture for 5G VN group
management with the CEF architecture
## B.2.2 Void
## B.2.3 Charging principles and scenarios
### B.2.3.1 Basic principles
5G VN group management charging is performed by the NEF or CEF interacting
with CHF using Nchf specified in TS 32.290 [57] and TS 32.291 [58]. In order
to provide the data required for the charging management activities, the
converged charging can be performed for each of the following:
\- The CEF are able to get the 5G VN group information (e.g. GroupIdentifiers)
from UDM via Nudm_SubscriberDataManagement service, specified in the TS 23.502
[214] and TS 29.503[236]. The Charging Data Request and Charging Data Response
are exchanged between the CEF and the CHF, based on PEC scenarios as specified
in TS 32.290 [57]. The Charging Data Request is issued by the CEF towards the
CHF when certain conditions (chargeable events) are met.
> The CEF only uses the GET operation of Nudm_SubscriberDataManagement service
> to obtain the 5G VN group information.
\- The NEF are able to report the 5G VN group information (e.g. add/delete 5G
VN Group members) to CHF based on the API invocation (i.e.
5GLANParameterProvision API) chargeable events.
In order to avoid the duplicate charging, the NEF based and CEF based 5G VN
group management charging will not be invoked at the same time, which depend
on the implementation based on the operator policy.
The 5G VN group management charging information is collected per VN group. The
message contents and purpose of each charging event that triggers interaction
with CHF, as well as the chargeable events that trigger them, are described in
following clauses.
A detailed formal description of the converged charging parameters to CHF
defined in the present document can be found in TS 32.291 [58].
A detailed formal description of the CDR parameters defined in the present
document can be found in TS 32.298 [51].
### B.2.3.2 Applicable triggers in 5G VN group management charging
#### B.2.3.2.1 5G VN group management charging via UDM
A set of trigger conditions are defined for the CEF to invoke a Charging Data
Request [Event] towards the CHF.
Table B.2.3.2.1-1 summarizes the set of default trigger conditions and their
category which shall be supported by the CEF.
Table B.2.3.2.1-1: Default Trigger conditions in CEF
* * *
Trigger Conditions Trigger level Default category CHF allowed to change
category CHF allowed to enable and disable Message when \"immediate
reporting\" category Receive the 5G VN group information from UDM - Immediate
Not Applicable Not Applicable Charging Data Request [Event]
* * *
### B.2.3.3 Message flows
#### B.2.3.3.1 5G VN group management charging via UDM
The following message flow specifies the interaction between the CEF and the
CHF for 5G VN group management charging. This interaction is based on Charging
Data Request /Response specified in TS 32.290 [57].
Figure B.2.3.3.1-1: Message flow for CEF interation for 5G VN group charging
---PEC
> 1\. The CEF decides to get the 5G VN group management information based on
> the charging requirement.
>
> 2\. The CEF sends the 5G VN group management information Request to the UDM
> via Nudm_SubscriberDataManagement service.
>
> 3\. The UDM sends the 5G VN group management information successful Response
> to the CEF, including current VN group information, e.g. the Internal Group
> ID, External Group ID, and UE Id List.
>
> 3ch-a. The CEF sends Charging Data Request [Event] to CHF for 5G VN group
> management information.
>
> 3ch-b. The CHF creates a CDR.
>
> 3ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
> CEF.
### B.2.3.4 CDR generation
The CHF CDRs for 5G VN group management charging are generated by the CHF to
collect charging information that they subsequently transfer to the Charging
Gateway Function (CGF).
A 5G VN group management CHF CDR is used to capture charging information
related to 5G VN group management chargeable events and is generated by the
CHF for each received Charging Data Request [Event].
## B.2.4 Charging Information
### B.2.4.1 Data description for 5G VN group management charging
The Charging Data Request and Charging Data Response are specified in
subclause 5.1.2.2.1 of TS 32.290 [57].
Table B.2.4.1-1 describes the use of these messages for 5G VN group management
charging.
Table B.2.4.1-1: 5G LAN VN group management messages reference table
* * *
**Message** **Source** **Destination** Charging Data Request CEF/NEF CHF
Charging Data Response CHF CEF/NEF
* * *
Table B.2.4.1-2 illustrates the basic structure of a Charging Data Request
message from the CEF as used for 5G VN group management charging.
Table B.2.4.1-2: Charging Data Request message contents
* * *
**Information Element** **Category for converged charging** **Description**
Session Identifier O~C~ Described in TS 32.290 [57] Subscriber Identifier -
This field is not applicable. NF Consumer Identification O~C~ Described in TS
32.290 [57] Charging Identifier - This field is not applicable. Invocation
Timestamp M Described in TS 32.290 [57] Invocation Sequence Number M Described
in TS 32.290 [57] One-time Event O~C~ Described in TS 32.290 [57] One-time
Event Type O~C~ Described in TS 32.290 [57] Retransmission Indicator O~C~
Described in TS 32.290 [57] Notify URI - This field is not applicable.
Supported Features O~C~ Described in TS 32.290 [57] Service Specification
Information O~C~ Described in TS 32.290 [57] Triggers O~C~ This field holds
the specific triggers described in clause B.2.3.2.1. Multiple Unit Usage -
This field is not applicable. 5G VNGM Charging Information O~M~ This field is
mapped to the NEF API Charging information defined in clause 6.3 for 5G VN
group management charging
* * *
Table B.2.4.1-3 illustrates the basic structure of a Charging Data Response
message from the CHF to CEF as used for 5G VN group management charging.
Table B.2.4.1-3: Charging Data Response message contents
* * *
**Information Element** **Category for converged charging** **Description**
Session Identifier O~C~ Described in TS 32.290 [57] Invocation Timestamp M
Described in TS 32.290 [57] Invocation Result O~C~ Described in TS 32.290 [57]
Invocation Sequence Number M Described in TS 32.290 [57] Session Failover -
This field is not applicable. Supported Features O~C~ Described in TS 32.290
[57] Triggers - This field is not applicable. Multiple Unit Information - This
field is not applicable.
* * *
Details of the Ga message contents are specified in TS 32.295 [54].
The following table B.2.4.1-4 provide a brief description of each CDR
parameter. The category in the tables is used according to the charging data
configuration defined in clause 5.4. Full definitions of the CDR parameters,
sorted by the name in alphabetical order, are provided in TS 32.298 [51].
Table B.2.4.1-4 5G VN group management charging CHF record data
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | CHF record. | +----------------------------+----------+----------------------------+ | Recording Network Function | O~M~ | This field holds the name | | ID | | of the recording entity, | | | | i.e. the CEF id. | +----------------------------+----------+----------------------------+ | Subscriber Identifier | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | NF Consumer Information | M | This field holds the | | | | information of the entity | | | | that used the charging | | | | service (i.e. NF consumer | | | | (CTF), CEF). | +----------------------------+----------+----------------------------+ | > NF Functionality | M | This field contains the | | | | function of the entity: | | | | Service Producer (CTF) or | | | | CEF | +----------------------------+----------+----------------------------+ | > NF Name | O~C~ | This field holds the name | | | | of the entity. | +----------------------------+----------+----------------------------+ | > NF Address | O~C~ | This field holds the IP | | | | Address of the entity | +----------------------------+----------+----------------------------+ | > NF PLMN ID | O~C~ | This field holds the PLMN | | | | identifier (MCC MNC) of | | | | the entity. | +----------------------------+----------+----------------------------+ | Record Opening Time | M | Described in TS 32.298 | | | | [57] | +----------------------------+----------+----------------------------+ | Duration | M | Described in TS 32.298 | | | | [57] | +----------------------------+----------+----------------------------+ | Record Sequence Number | C | Described in TS 32.298 | | | | [57] | +----------------------------+----------+----------------------------+ | Cause for Record Closing | M | Described in TS 32.298 | | | | [57] | +----------------------------+----------+----------------------------+ | Diagnostics | O~M~ | Described in TS 32.298 | | | | [57] | +----------------------------+----------+----------------------------+ | Local Record Sequence | O~M~ | Described in TS 32.298 | | Number | | [57] | +----------------------------+----------+----------------------------+ | Record Extensions | O~C~ | Described in TS 32.298 | | | | [57] | +----------------------------+----------+----------------------------+ | 5G VNGM Charging | O~M~ | This field is mapped to | | Information | | the NEF API Charging | | | | information defined in | | | | clause 6.3 for 5G VN group | | | | management charging. | +----------------------------+----------+----------------------------+
### B.2.4.2 Definition of 5G VN group management charging information
The 5G VN Group Management Charging information is mapped to in the \"**NEF
API Charging Information** \" in the table B.2.4.2-1.
Table B.2.4.2-1: Structure of NEF API Charging Information for 5G VNGM
Charging Information
+----------------------------+----------+----------------------------+ | 5G VNGM Charging | Category | Description | | Information | | | | | | | | (Mapped to NEF API | | | | Charging Information) | | | +----------------------------+----------+----------------------------+ | External Group Identifier | O~C~ | This field contains the | | | | External Group ID | | | | associated to the provided | | | | Internal Group ID | +----------------------------+----------+----------------------------+ | Internal Group Identifier | O~C~ | This field contain the | | | | Internal Group ID | | | | associated to the provided | | | | External Group ID. | +----------------------------+----------+----------------------------+ | External Individual | O~C~ | The list of the UE | | Identifier | | identifiers in the 5G VN | | | | group. | +----------------------------+----------+----------------------------+ | API Direction | - | This fiels is not | | | | applicable | +----------------------------+----------+----------------------------+ | API Target Network | - | This fiels is not | | Function | | applicable | +----------------------------+----------+----------------------------+ | API Result Code | - | This fiels is not | | | | applicable | +----------------------------+----------+----------------------------+ | API Name | - | This fiels is not | | | | applicable | +----------------------------+----------+----------------------------+ | API Reference | - | This fiels is not | | | | applicable | +----------------------------+----------+----------------------------+ | API Content | O~C~ | The API content includes | | | | the 5G VN group data, | | | | including the Single Nssai | | | | | | | | DNN and PDU Session Types. | +----------------------------+----------+----------------------------+
### B.2.4.3 Detailed message format for converged charging
The following clause specifies per Operation Type the charging data that are
sent by CEF for 5G VN group management converged charging.
The Operation Types are listed in the following order: I (Initial)/T
(Termination)/E (Event). Therefore, when all Operation Types are possible it
is marked as ITE. If only some Operation Types are allowed for a node, only
the appropriate letters are used (i.e. IT or E) as indicated in the table
heading. The omission of an Operation Type for a particular field is marked
with \"-\" (i.e. I-E). Also, when an entire field is not allowed in a node the
entire cell is marked as \"-\".
Table B.2.4.3-1 defines the basic structure of the supported fields in the
_Charging Data Request_ message for CEF converged charging.
Table B.2.4.3-1: Supported fields in _Charging Data Request message_
* * *
Information Element Analytics and Performance CEF Supported Operation Types E
Session Identifier E  
Subscriber Identifier -  
NF Consumer Identification E  
Charging Identifier -  
Invocation Timestamp E  
Invocation Sequence Number E  
One-time Event E  
One-time Event Type E  
Retransmission Indicator E  
Notify URI -  
Supported Features E  
Service Specification Information E  
Triggers E  
Multiple Unit Usage -  
5G VNGM Charging Information E
* * *
Table B.2.4.3-2 defines the basic structure of the supported fields in the
_Charging Data Response_ message for CEF converged charging.
Table B.2.4.3-2: Supported fields in _Charging Data Response message_
* * *
Information Element **Analytics and Performance** CEF Supported Operation
Types E Session Identifier E  
Invocation Timestamp E  
Invocation Result E  
Invocation Sequence Number E  
Session Failover -  
Supported Features E  
Triggers E  
Multiple Unit information -
* * *
## B.2.5 Bindings for 5G VN group management converged charging
This mapping between the Information Elements, resource attributes and CHF CDR
parameters for 5G VN group management and communication converged charging is
described in clause 7 of TS 32.291 [51].
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the stage 3 protocol and data model for the
Npanf Service Based Interface. It provides stage 3 protocol definitions and
message flows, and specifies the API for each service offered by the 5G PAnF.
The 5G System stage 2 architecture and procedures are specified in TS 23.501
[2] and TS 23.502 [3].
The Technical Realization of the Service Based Architecture and the Principles
and Guidelines for Services Definition are specified in TS 29.500 [4] and TS
29.501 [5].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 29.500: \"5G System; Technical Realization of Service Based
Architecture; Stage 3\".
[5] 3GPP TS 29.501: \"5G System; Principles and Guidelines for Services
Definition; Stage 3\".
[6] OpenAPI: \"OpenAPI Specification Version 3.0.0\",
https://spec.openapis.org/oas/v3.0.0.
[7] 3GPP TR 21.900: \"Technical Specification Group working methods\".
[8] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[9] IETF RFC 6749: \"The OAuth 2.0 Authorization Framework\".
[10] 3GPP TS 29.510: \"5G System; Network Function Repository Services; Stage
3\".
[11] IETF RFC 7540: \"Hypertext Transfer Protocol Version 2 (HTTP/2)\".
[12] IETF RFC 8259: \"The JavaScript Object Notation (JSON) Data Interchange
Format\".
[13] IETF RFC 7807: \"Problem Details for HTTP APIs\".
[14] 3GPP TS 33.503: \"Security Aspects of Proximity based Services (ProSe) in
the 5G System (5GS)\".
[15] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces; Stage 3\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
PAnF Prose Anchor Function
# 4 Overview
The Prose Anchor Function (PAnF) is the network entity in the 5G Core Network
(5GC) supporting security procedure over Control Plane for the 5G ProSe UE-to-
Network relay as specified in 3GPP TS 33.503 [14]. Within the 5GC, the PAnF
offers services to the AUSF via the Npanf service based interface.
Figure 4-1 provides the reference model (in service based interface
representation and in reference point representation), with focus on the PAnF:
Figure 4-1: Reference model -- PAnF
The PAnF supports the following functionalities:
\- Storage and retrieval of ProSe context information of the 5G ProSe Remote
UE;
\- Checking whether the 5G ProSe Remote UE is authorized to use the UE-to-
Network Relay service.
\- Resolving the ProSe Remote User ID to SUPI.
# 5 Services offered by the 5G PAnF
## 5.1 Introduction
Table 5.1-1 shows the PAnF Services and PAnF Service Operations:
Table 5.1-1: List of 5G PAnF Services
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | N | Register | Re | AUSF | | panf_ProseKey | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Retrieve | Re | AUSF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | Npanf_Resol | **Get** | Re | SMF | | veRemoteUserId | | quest/Response | | +----------------+----------------+----------------+----------------+
Table 5.1-2 summarizes the corresponding APIs defined for this specification.
Table 5.1-2: API Descriptions
Service Name Clause Description OpenAPI Specification File apiName Annex
* * *
Npanf_ProseKey 6.1 PAnF Prose Key Service TS29553_Npanf_ProseKey.yaml npanf-
prosekey A.2 Npanf_ResolveRemoteUserId 6.2 Resolve Remote User ID Service
TS29553_Npanf_ResolveRemoteUserId.yaml npanf-userid A.3
## 5.2 Npanf_ProseKey Service
### 5.2.1 Service Description
The Npanf_ProseKey service enables an NF to request the PAnF to store the
ProSe context information for a 5G ProSe Remote UE or to request CP-PRUK from
the PAnF. The following are the key functionalities of this NF service.
\- Store the Prose context information;
\- Retrieve the Prose Key.
### 5.2.2 Service Operations
#### 5.2.2.1 Introduction
The service operations defined for the Npanf_ProseKey service are as follows:
\- Register: It allows a consumer NF to store the Prose Context information;
\- Retrieve: It provides to the NF service consumer of the CP-PRUK matching
input criteria.
#### 5.2.2.2 Register
##### 5.2.2.2.1 General
The Register service operation is invoked by a NF Service Consumer to request
the PAnF to store the ProSe context information for a 5G ProSe Remote UE.
The Register service operation is used during the following procedure:
\- PC5 security establishment for 5G ProSe UE-to-Network relay communication
over Control Plane (see 3GPP TS 33.503 [14], clause 6.3.3.3.2)
The NF Service Consumer (i.e. AUSF) shall request the PAnF to store the ProSe
context information for a 5G ProSe Remote UE as shown in Figure 5.2.2.2.1-1
Figure 5.2.2.2.1-1: Prose Keys registration
1\. The NF service consumer (e.g. AUSF) sends a POST request to the resource
representing the Prose Context Info for a 5G ProSe Remote UE.
2a. On success, the PAnF responds with \"204 No Content\".
2b. If the user does not exist, HTTP status code \"404 Not Found\" shall be
returned including additional error information in the response body (in the
\"ProblemDetails\" element).
On failure, the appropriate HTTP status code indicating the error shall be
returned and appropriate additional error information should be returned in
the POST response body.
#### 5.2.2.3 Retrieve
##### 5.2.2.3.1 General
Figure 5.2.2.3.1-1 shows a scenario where the NF service consumer (e.g. AUSF)
sends a request to the PAnF to retrieve the CP-PRUK. The request contains the
CP-PRUK ID and Relay Service Code.
Figure 5.2.2.3.1-1: Prose Keys retrieval
1\. The NF service consumer (e.g. AUSF) sends a POST request to the resource
representing the Prose Key.
2a. On success, the PAnF responds with \"200 OK\" with the message body
containing the ProseKeyResponse.
2b. If the user does not exist, or the ProSe Key does not exist in the in the
PAnF, HTTP status code \"404 Not Found\" shall be returned and additional
error information should be included in the response body (in the
\"ProblemDetails\" element).
On failure, the appropriate HTTP status code indicating the error shall be
returned and appropriate additional error information should be returned in
the POST response body.
## 5.3 Npanf_ResolveRemoteUserId Service
### 5.3.1 Service Description
This service enables an NF service consumer (i.e. SMF) to request the PANF to
resolve the Remote User ID. The following are the key functionalities of this
NF service.
\- Resolve the Remote User ID
### 5.3.2 Service Operations
#### 5.3.2.1 Introduction
#### 5.3.2.2 ResolveRemoteUserId
##### 5.3.2.2.1 General
The ResolveRemoteUserId service operation is invoked by a NF Service Consumer,
i.e. SMF, towards the PANF to Resolve the Remote User ID.
The ResolveRemoteUserId service operation is used during the following
procedure:
\- PC5 security establishment for 5G ProSe UE-to-Network relay communication
over Control Plane (see 3GPP TS 33.503 [14], clause 6.3.3.3.2)
The NF Service Consumer (i.e. SMF) shall resolve the Remote User ID by
invoking the \"get\" custom method on the resource URI of \"Resolve Remote
User ID\" resource, see clause 6.y.3.2.4. See also Figure 5.3.2.2.1-1.
Figure 5.3.2.2-1: Resolve the Remote User ID
1\. The NF service consumer sends a POST request to the resource representing
the get custom operation. The request body shall contain the Remote User ID
(CP-PRUK ID).
2a. On success, \"200 OK\" shall be returned. The response body shall contain
the SUPI.
2b. If the user does not exist, HTTP status code \"404 Not Found\" shall be
returned including additional error information in the response body (in the
\"ProblemDetails\" element).
On failure, the appropriate HTTP status code indicating the error shall be
returned and appropriate additional error information should be returned in
the POST response body.
# 6 API Definitions
## 6.1 Npanf_ProseKey Service API
### 6.1.1 Introduction
The Npanf_ProseKey service shall use the Npanf_ProseKey API.
The API URI of the Npanf_ProseKey API shall be:
**{apiRoot}/\ /\**
The request URIs used in HTTP requests from the NF service consumer towards
the NF service producer shall have the Resource URI structure defined in
clause 4.4.1 of 3GPP TS 29.501 [5], i.e.:
**{apiRoot}/\ /\/\**
with the following components:
\- The {apiRoot} shall be set as described in 3GPP TS 29.501 [5].
\- The \ shall be \"npanf-prosekey\".
\- The \ shall be \"v1\".
\- The \ shall be set as described in clause
6.1.3.
### 6.1.2 Usage of HTTP
#### 6.1.2.1 General
HTTP/2, IETF RFC 7540 [11], shall be used as specified in clause 5 of 3GPP TS
29.500 [4].
HTTP/2 shall be transported as specified in clause 5.3 of 3GPP TS 29.500 [4].
The OpenAPI [6] specification of HTTP messages and content bodies for the
Npanf_ProseKey API is contained in Annex A.
#### 6.1.2.2 HTTP standard headers
##### 6.1.2.2.1 General
See clause 5.2.2 of 3GPP TS 29.500 [4] for the usage of HTTP standard headers.
##### 6.1.2.2.2 Content type
JSON, IETF RFC 8259 [12], shall be used as content type of the HTTP bodies
specified in the present specification as specified in clause 5.4 of 3GPP TS
29.500 [4]. The use of the JSON format shall be signalled by the content type
\"application/json\".
\"Problem Details\" JSON object shall be used to indicate additional details
of the error in a HTTP response body and shall be signalled by the content
type \"application/problem+json\", as defined in IETF RFC 7807 [13].
#### 6.1.2.3 HTTP custom headers
The mandatory HTTP custom header fields specified in clause 5.2.3.2 of 3GPP TS
29.500 [4] shall be supported, and the optional HTTP custom header fields
specified in clause 5.2.3.3 of 3GPP TS 29.500 [4] may be supported.
### 6.1.3 Resources
#### 6.1.3.1 Overview
This clause describes the structure for the Resource URIs and the resources
and methods used for the service.
Figure 6.1.3.1-1 depicts the resource URIs structure for the Npanf_ProseKey
API.
Figure 6.1.3.1-1: Resource URI structure of the Npanf_ProseKey API
Table 6.1.3.1-1 provides an overview of the resources and applicable HTTP
methods.
Table 6.1.3.1-1: Resources and methods overview
+---------------+----------------+----------------+----------------+ | Resource name | Resource URI | HTTP method or | Description | | | | custom | | | | | operation | | +===============+================+================+================+ | Prose Keys | /prose | register | Store the | | | -keys/register | | Prose Context | | | | (POST) | | +---------------+----------------+----------------+----------------+ | | /prose | retrieve | Retrieve the | | | -keys/retrieve | | CP-PRUK | | | | (POST) | | +---------------+----------------+----------------+----------------+
#### 6.1.3.2 Resource: Prose Keys
##### 6.1.3.2.1 Description
This resource is used to represent Prose Keys Registration and Retrieval.
##### 6.1.3.2.2 Resource Definition
Resource URI: {apiRoot}/npanf-prosekey/**\ ** /prose-keys
This resource shall support the resource URI variables defined in table
6.1.3.2.2-1.
Table 6.1.3.2.2-1: Resource URI variables for this resource
Name Data type Definition
* * *
apiRoot string See clause 6.1.1
##### 6.1.3.2.3 Resource Standard Methods
No HTTP method has been defined for the Prose Keys resource.
##### 6.1.3.2.4 Resource Custom Operations
##### 6.1.3.2.4.1 Overview {#overview-2 .H6}
Table 6.1.3.2.4.1-1: Custom operations
Operation name Custom operation URI Mapped HTTP method Description
* * *
register /prose-keys/register POST Store the Prose Context Info retrieve
/prose-keys/retrieve POST Retrieve the CP-PRUK
##### 6.1.3.2.4.2 Operation: register {#operation-register .H6}
##### 6.1.3.2.4.2.1 Description {#description-1 .H6}
The registration custom operation is used by the NF service consumer (AUSF) to
store the Prose context info. For details see 3GPP TS 33.503 [14].
##### 6.1.3.2.4.2.2 Operation Definition {#operation-definition .H6}
This operation shall support the request data structures specified in table
6.1.3.2.4.2.2-1 and the response data structure and response codes specified
in table 6.1.3.2.4.2.2-2.
Table 6.1.3.2.4.2.2-1: Data structures supported by the POST Request Body on
this resource
Data type P Cardinality Description
* * *
ProseContextInfo M 1 Contains the SUPI, CP-PRUK, CP-PRUK ID, RSC.
Table 6.1.3.2.4.2.2-2: Data structures supported by the POST Response Body on
this resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | | | | | | | codes | | +===============+===+=============+===============+===============+ | n/a | | | 204 No | Upon success, | | | | | Content | an empty | | | | | | response body | | | | | | shall be | | | | | | returned. | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 404 Not Found | The \"cause\" | | roblemDetails | | | | attribute may | | | | | | be used to | | | | | | indicate one | | | | | | of the | | | | | | following | | | | | | application | | | | | | errors: | | | | | | | | | | | | - | | | | | | USE | | | | | | R_NOT_FOUND | +---------------+---+-------------+---------------+---------------+ | NOTE: The | | | | | | mandatory | | | | | | HTTP error | | | | | | status code | | | | | | for the POST | | | | | | method listed | | | | | | in | | | | | | Ta | | | | | | ble 5.2.7.1-1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | also apply. | | | | | +---------------+---+-------------+---------------+---------------+
##### 6.1.3.2.4.3 Operation: retrieve {#operation-retrieve .H6}
##### 6.1.3.2.4.3.1 Description {#description-2 .H6}
The retrieval custom operation is used by the NF service consumer (AUSF) to
retrieve the Prose Key. For details see 3GPP TS 33.503 [14].
##### 6.1.3.2.4.3.2 Operation Definition {#operation-definition-1 .H6}
This operation shall support the request data structures specified in table
6.1.3.2.4.3.2-1 and the response data structure and response codes specified
in table 6.1.3.2.4.3.2-2.
Table 6.1.3.2.4.3.2-1: Data structures supported by the POST Request Body on
this resource
Data type P Cardinality Description
* * *
ProseKeyRequest M 1 Contains the 5GPRUK ID, RSC.
Table 6.1.3.2.4.3.2-2: Data structures supported by the POST Response Body on
this resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | | | | | | | codes | | +===============+===+=============+===============+===============+ | Pro | M | 1 | 200 OK | Upon success, | | seKeyResponse | | | | a response | | | | | | body | | | | | | containing | | | | | | the Prose Key | | | | | | shall be | | | | | | returned. | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 404 Not Found | The \"cause\" | | roblemDetails | | | | attribute may | | | | | | be used to | | | | | | indicate one | | | | | | of the | | | | | | following | | | | | | application | | | | | | errors: | | | | | | | | | | | | - | | | | | | USE | | | | | | R_NOT_FOUND | | | | | | | | | | | | - | | | | | | DAT | | | | | | A_NOT_FOUND | +---------------+---+-------------+---------------+---------------+ | NOTE: The | | | | | | mandatory | | | | | | HTTP error | | | | | | status code | | | | | | for the POST | | | | | | method listed | | | | | | in | | | | | | Ta | | | | | | ble 5.2.7.1-1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | also apply. | | | | | +---------------+---+-------------+---------------+---------------+
### 6.1.4 Custom Operations without associated resources
There is no custom operation without associated resources supported in
Npanf_ProseKey Service.
### 6.1.5 Notifications
There is no notification defined for Npanf_ProseKey service.
### 6.1.6 Data Model
#### 6.1.6.1 General
This clause specifies the application data model supported by the API.
Table 6.1.6.1-1 specifies the data types defined for the Npanf_ProseKey
service based interface protocol.
Table 6.1.6.1-1: Npanf_ProseKey specific Data Types
Data type Clause defined Description Applicability
* * *
ProseContextInfo 6.1.6.2.2 ProSe Context Information  
ProseKeyRequest 6.1.6.2.3 Contains the CP-PRUK ID, RSC.  
ProseKeyResponse 6.1.6.2.4 Contains the CP-PRUK  
5GPruk 6.1.6.3.2 ProSe Remote User Key over Control Plane
Table 6.1.6.1-2 specifies data types re-used by the Npanf_ProseKey service
based interface protocol from other specifications, including a reference to
their respective specifications and when needed, a short description of their
use within the Npanf_ProseKey service based interface.
Table 6.1.6.1-2: Npanf_ProseKey re-used Data Types
Data type Reference Comments Applicability
* * *
RelayServiceCode 3GPP TS 29.571 [15] Relay Service Code  
Supi 3GPP TS 29.571 [15] see 3GPP TS 23.501 [2] clause 5.9.2  
5GPrukId 3GPP TS 29.571 [15] ProSe Remote User Key ID over Control Plane
#### 6.1.6.2 Structured data types
##### 6.1.6.2.1 Introduction
This clause defines the structures to be used in resource representations.
##### 6.1.6.2.2 Type: ProseContextInfo
Table 6.1.6.2.2-1: Definition of type ProseContextInfo
Attribute name Data type P Cardinality Description Applicability
* * *
supi Supi M 1 The SUPI of the UE  
5gPrukId 5GPrukId M 1 This IE shall indicate the CP-PRUK ID of the 5G ProSe
Remote UE.  
5gPruk 5GPruk M 1 This IE shall indicate the CP-PRUK of the 5G ProSe Remote
UE.  
relayServiceCode RelayServiceCode M 1 This IE shall indicate the Relay Service
Code from the 5G ProSe Remote UE.
##### 6.1.6.2.3 Type: ProseKeyRequest
Table 6.1.6.2.3-1: Definition of type ProseKeyRequest
Attribute name Data type P Cardinality Description Applicability
* * *
5gPrukId 5GPrukId M 1 This IE shall indicate the CP-PRUK ID of the 5G ProSe
Remote UE.  
relayServiceCode RelayServiceCode M 1 This IE shall indicate the Relay Service
Code from the 5G ProSe Remote UE.
##### 6.1.6.2.4 Type: ProseKeyResponse
Table 6.1.6.2.4-1: Definition of type ProseKeyResponse
Attribute name Data type P Cardinality Description Applicability
* * *
5gPruk 5GPruk M 1 This IE shall indicate the CP-PRUK of the 5G ProSe Remote
UE.
#### 6.1.6.3 Simple data types and enumerations
##### 6.1.6.3.1 Introduction
This clause defines simple data types and enumerations that can be referenced
from data structures defined in the previous clauses.
##### 6.1.6.3.2 Simple data types
The simple data types defined in table 6.1.6.3.2-1 shall be supported.
Table 6.1.6.3.2-1: Simple data types
+-----------+-----------------+-------------------+---------------+ | Type Name | Type Definition | Description | Applicability | +===========+=================+===================+===============+ | 5GPruk | string | ProSe Remote User | | | | | Key over Control | | | | | Plane | | | | | | | | | | String value | | | | | carrying the | | | | | CP-PRUK in | | | | | hexadecimal | | | | | presentation. | | | | | | | | | | pattern: | | | | | \"\^[A- | | | | | Fa-f0-9]{64}\$\" | | +-----------+-----------------+-------------------+---------------+
#### 6.1.6.4 Data types describing alternative data types or combinations of
data types
There is no data type describing alternative data types or combinations of
data types in Npanf_ProseKey Service.
#### 6.1.6.5 Binary data
There is no binary data type in Npanf_ProseKey Service.
### 6.1.7 Error Handling
#### 6.1.7.1 General
For the Npanf_ProseKey API, HTTP error responses shall be supported as
specified in clause 4.8 of 3GPP TS 29.501 [5]. Protocol errors and application
errors specified in table 5.2.7.2-1 of 3GPP TS 29.500 [4] shall be supported
for an HTTP method if the corresponding HTTP status codes are specified as
mandatory for that HTTP method in table 5.2.7.1-1 of 3GPP TS 29.500 [4].
In addition, the requirements in the following clauses are applicable for the
Npanf_ProseKey API.
#### 6.1.7.2 Protocol Errors
No specific procedures for the Npanf_ProseKey service are specified.
#### 6.1.7.3 Application Errors
The application errors defined for the Npanf_ProseKey service are listed in
Table 6.1.7.3-1.
Table 6.1.7.3-1: Application errors
Application Error HTTP status code Description
* * *
USER_NOT_FOUND 404 Not Found The provided subscriber identifier is not found.
DATA_NOT_FOUND 404 Not Found The requested data is not found/does not exist.
### 6.1.8 Feature negotiation
The optional features in table 6.1.8-1 are defined for the Npanf_ProseKey API.
They shall be negotiated using the extensibility mechanism defined in clause
6.6 of 3GPP TS 29.500 [4].
Table 6.1.8-1: Supported Features
Feature number Feature Name Description
* * *
### 6.1.9 Security
As indicated in 3GPP TS 33.501 [8] and 3GPP TS 29.500 [4], the access to the
Npanf_ProseKey API may be authorized by means of the OAuth2 protocol (see IETF
RFC 6749 [9]), based on local configuration, using the \"Client Credentials\"
authorization grant, where the NRF (see 3GPP TS 29.510 [10]) plays the role of
the authorization server.
If OAuth2 is used, an NF Service Consumer, prior to consuming services offered
by the Npanf_ProseKey API, shall obtain a \"token\" from the authorization
server, by invoking the Access Token Request service, as described in 3GPP TS
29.510 [10], clause 5.4.2.2.
NOTE: When multiple NRFs are deployed in a network, the NRF used as
authorization server is the same NRF that the NF Service Consumer used for
discovering the Npanf_ProseKey service.
The Npanf_ProseKey API defines the followingscopes for OAuth2 authorization as
specified in 3GPP TS 33.501 [8]:
Table 6.1.9-1: OAuth2 scopes defined in Npanf_ProseKey API
Scope Description
* * *
\"npanf_prosekey\" Access to the Npanf_ProseKey API.
\"npanf_prosekey:register:invoke\" Access to invoke register Prose Context
\"npanf_prosekey:retrieve:invoke\" Access to invoke retrieve CP-PRUK
## 6.2 Npanf_ResolveRemoteUserId Service API
### 6.2.1 Introduction
The Npanf_ResolveRemoteUserId shall use the Npanf_ResolveRemoteUserId API.
The API URI of the Npanf_ResolveRemoteUserId API shall be:
**{apiRoot}/\ /\**
The request URIs used in HTTP requests from the NF service consumer towards
the NF service producer shall have the Resource URI structure defined in
clause 4.4.1 of 3GPP TS 29.501 [6], i.e.:
**{apiRoot}/\ /\/\**
with the following components:
\- The {apiRoot} shall be set as described in 3GPP TS 29.501 [6].
\- The \ shall be \"npanf-userid\".
\- The \ shall be \"v1\".
\- The \ shall be set as described in clause
6.2.3.
### 6.2.2 Usage of HTTP
#### 6.2.2.1 General
HTTP/2, IETF RFC 7540 [8], shall be used as specified in clause 5 of 3GPP TS
29.500 [5].
HTTP/2 shall be transported as specified in clause 5.3 of 3GPP TS 29.500 [5].
The OpenAPI [7] specification of HTTP messages and content bodies for the
Npanf_ResolveRemoteUserId API is contained in Annex A.
#### 6.2.2.2 HTTP standard headers
##### 6.2.2.2.1 General
See clause 5.2.2 of 3GPP TS 29.500 [5] for the usage of HTTP standard headers.
##### 6.2.2.2.2 Content type
JSON, IETF RFC 8259 [9], shall be used as content type of the HTTP bodies
specified in the present specification as specified in clause 5.4 of 3GPP TS
29.500 [5]. The use of the JSON format shall be signalled by the content type
\"application/json\".
\"Problem Details\" JSON object shall be used to indicate additional details
of the error in a HTTP response body and shall be signalled by the content
type \"application/problem+json\", as defined in IETF RFC 7807 [10].
#### 6.2.2.3 HTTP custom headers
The mandatory HTTP custom header fields specified in clause 5.2.3.2 of 3GPP TS
29.500 [4] shall be supported, and the optional HTTP custom header fields
specified in clause 5.2.3.3 of 3GPP TS 29.500 [4] may be supported.
### 6.2.3 Resources
#### 6.2.3.1 Overview
This clause describes the structure for the Resource URIs and the resources
and methods used for the service.
Figure 6.2.3.1-1 describes the resource URI structure of the
Npanf_ResolveRemoteUserId API.
Figure 6.2.3.1-1: Resource URI structure of the Npanf_ResolveRemoteUserId API
Table 6.2.3.1-1 provides an overview of the resources and applicable HTTP
methods.
Table 6.2.3.1-1: Resources and methods overview
+----------------+----------------+----------------+----------------+ | Resource name | Resource URI | HTTP method or | Description | | | | custom | | | | | operation | | +================+================+================+================+ | Resolve Remote | /pr | get | Resol | | User ID | ose-resolution | | veRemoteUserId | | | | (POST) | service | | | | | operation | +----------------+----------------+----------------+----------------+
#### 6.2.3.2 Resource: Resolve Remote User ID
##### 6.2.3.2.1 Description
This resource represents resolving Remote User ID by the PAnF.
##### 6.2.3.2.2 Resource Definition
Resource URI: **{apiRoot}/\ /\/prose-resolution**
This resource shall support the resource URI variables defined in table
6.2.3.2.2-1.
Table 6.2.3.2.2-1: Resource URI variables for this resource
Name Data type Definition
* * *
apiRoot string See clause 6.2.1
##### 6.2.3.2.3 Resource Standard Methods
There is no standard method supported by the resource.
##### 6.2.3.2.4 Resource Custom Operations
###### 6.2.3.2.4.1 Overview
Table 6.2.3.2.4.1-1: Custom operations
Operation name Custom operaration URI Mapped HTTP method Description
* * *
get {resourceUri}/get POST ResolveRemoteUserId service operation
###### 6.2.3.2.4.2 Operation: get
###### # 6.2.3.2.4.2.1 Description
This custom operation requests to resolve the Remote User ID by the PAnF.
###### # 6.2.3.2.4.2.2 Operation Definition
This operation shall support the request data structures specified in table
6.2.3.2.4.2.2-1 and the response data structure and response codes specified
in table 6.2.3.2.4.2.2-2.
Table 6.2.3.2.4.2.2-1: Data structures supported by the POST Request Body on
this resource
Data type P Cardinality Description
* * *
ResolveReqData M 1 Resolve Request Data, including the Remote User ID of the
5G ProSe Remote UE.
Table 6.2.3.2.4.2.2-2: Data structures supported by the POST Response Body on
this resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | | | | | | | codes | | +===============+===+=============+===============+===============+ | R | M | 1 | 200 OK | Resolve | | esolveRspData | | | | Response | | | | | | Data, | | | | | | including the | | | | | | SUPI of the | | | | | | 5G ProSe | | | | | | Remote UE. | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 404 Not Found | The \"cause\" | | roblemDetails | | | | attribute | | | | | | shall be set | | | | | | to one of the | | | | | | following | | | | | | application | | | | | | error: | | | | | | | | | | | | - | | | | | | USE | | | | | | R_NOT_FOUND | | | | | | | | | | | | See table | | | | | | 6.2.7.3-1 for | | | | | | the | | | | | | description | | | | | | of these | | | | | | errors. | +---------------+---+-------------+---------------+---------------+ | NOTE1: The | | | | | | manadatory | | | | | | HTTP error | | | | | | status code | | | | | | for the POST | | | | | | method listed | | | | | | in Table | | | | | | 5.2.7.1-1 of | | | | | | 3GPP TS | | | | | | 29.500 [5] | | | | | | also apply. | | | | | | | | | | | | NOTE 2: | | | | | | Red | | | | | | irectResponse | | | | | | may be | | | | | | inserted by | | | | | | an SCP, see | | | | | | cl | | | | | | ause 6.10.9.1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4]. | | | | | +---------------+---+-------------+---------------+---------------+
### 6.2.4 Custom Operations without associated resources
There is no custom operation without associated resources supported in
Npanf_ResolveRemoteUserId Service.
### 6.2.5 Notifications
There is no notification defined for Npanf_ResolveRemoteUserId service.
### 6.2.6 Data Model
#### 6.2.6.1 General
This clause specifies the application data model supported by the API.
Table 6.2.6.1-1 specifies the data types defined for the
Npanf_ResolveRemoteUserId service based interface protocol.
Table 6.2.6.1-1: Npanf_ResolveRemoteUserId specific Data Types
Data type Clause defined Description Applicability
* * *
ResolveReqData 6.2.6.2.2 Resolve Request Data, including the Remote User ID of
the 5G ProSe Remote UE.  
ResolveRspData 6.2.6.2.3 Resolve Response Data, including the SUPI of the 5G
ProSe Remote UE.
Table 6.2.6.1-2 specifies data types re-used by the Npanf_ResolveRemoteUserId
service based interface protocol from other specifications, including a
reference to their respective specifications and when needed, a short
description of their use within the Npanf_ResolveRemoteUserId service based
interface.
Table 6.2.6.1-2: Npanf_ResolveRemoteUserId re-used Data Types
Data type Reference Comments Applicability
* * *
Supi 3GPP TS 29.571 [15] Supi  
5GPrukId 3GPP TS 29.571 [15] ProSe Remote User Key ID over Control Plane
#### 6.2.6.2 Structured data types
##### 6.2.6.2.1 Introduction
This clause defines the structures to be used in resource representations.
##### 6.2.6.2.2 Type: ResolveReqData
Table 6.2.6.2.2-1: Definition of type ResolveReqData
Attribute name Data type P Cardinality Description Applicability
* * *
cpPrukId 5GPrukId M 1 This IE shall indicate the CP-PRUK ID of the 5G ProSe
Remote UE.
##### 6.2.6.2.3 Type: ResolveRspData
Table 6.2.6.2.3-1: Definition of type ResolveRspData
Attribute name Data type P Cardinality Description Applicability
* * *
supi Supi M 1 This IE shall indicate the SUPI.
#### 6.2.6.3 Simple data types and enumerations
##### 6.2.6.3.1 Introduction
This clause defines simple data types and enumerations that can be referenced
from data structures defined in the previous clauses.
##### 6.2.6.3.2 Simple data types
The simple data types defined in table 6.2.6.3.2-1 shall be supported.
Table 6.2.6.3.2-1: Simple data types
Type Name Type Definition Description Applicability
* * *
#### 6.2.6.4 Data types describing alternative data types or combinations of
data types
There is no data type describing alternative data types or combinations of
data types in Npanf_ResolveRemoteUserId Service.
#### 6.2.6.5 Binary data
There is no binary data type in Npanf_ResolveRemoteUserId Service.
### 6.2.7 Error Handling
#### 6.2.7.1 General
For the Npanf_ResolveRemoteUserId API, HTTP error responses shall be supported
as specified in clause 4.8 of 3GPP TS 29.501 [6]. Protocol errors and
application errors specified in table 5.2.7.2-1 of 3GPP TS 29.500 [5] shall be
supported for an HTTP method if the corresponding HTTP status codes are
specified as mandatory for that HTTP method in table 5.2.7.1-1 of 3GPP TS
29.500 [5].
In addition, the requirements in the following clauses are applicable for the
Npanf_ResolveRemoteUserId API.
#### 6.2.7.2 Protocol Errors
Protocol errors handling shall be supported as specified in clause 5.2.7 of
3GPP TS 29.500 [5].
#### 6.2.7.3 Application Errors
The application errors defined for the Npanf_ResolveRemoteUserId service are
listed in Table 6.2.7.3-1.
Table 6.2.7.3-1: Application errors
Application Error HTTP status code Description
* * *
USER_NOT_FOUND 404 Not Found The provided subscriber identifier is not found.
### 6.2.8 Feature negotiation
The optional features in table 6.2.8-1 are defined for the
Npanf_ResolveRemoteUserId API. They shall be negotiated using the
extensibility mechanism defined in clause 6.6 of 3GPP TS 29.500 [5].
Table 6.2.8-1: Supported Features
Feature number Feature Name Description
* * *
N/A
### 6.2.9 Security
As indicated in 3GPP TS 33.501 [11] and 3GPP TS 29.500 [5], the access to the
Npanf_ResolveRemoteUserId API may be authorized by means of the OAuth2
protocol (see IETF RFC 6749 [12]), based on local configuration, using the
\"Client Credentials\" authorization grant, where the NRF (see 3GPP TS 29.510
[13]) plays the role of the authorization server.
If OAuth2 is used, an NF Service Consumer, prior to consuming services offered
by the Npanf_ResolveRemoteUserId API, shall obtain a \"token\" from the
authorization server, by invoking the Access Token Request service, as
described in 3GPP TS 29.510 [13], clause 5.4.2.2.
NOTE: When multiple NRFs are deployed in a network, the NRF used as
authorization server is the same NRF that the NF Service Consumer used for
discovering the Npanf_ResolveRemoteUserId service.
The Npanf_ResolveRemoteUserId API defines a single scope \"npanf-userid\" for
OAuth2 authorization (as specified in 3GPP TS 33.501 [11]) for the entire
service, and it does not define any additional scopes at resource or operation
level.
###### ## Annex A (normative): OpenAPI specification
# A.1 General
This Annex specifies the formal definition of the API(s) defined in the
present specification. It consists of OpenAPI specifications in YAML format.
This Annex takes precedence when being discrepant to other parts of the
specification with respect to the encoding of information elements and methods
within the API(s).
NOTE 1: The semantics and procedures, as well as conditions, e.g. for the
applicability and allowed combinations of attributes or values, not expressed
in the OpenAPI definitions but defined in other parts of the specification
also apply.
Informative copies of the OpenAPI specification files contained in this 3GPP
Technical Specification are available on a Git-based repository that uses the
GitLab software version control system (see clause 5.3.1 of 3GPP TS 29.501 [5]
and clause 5B of 3GPP TR 21.900 [7]).
# A.2 Npanf_ProseKey API
openapi: 3.0.0
info:
title: Npanf_ProseKey
version: 1.1.0-alpha.2
description: \|
PAnF ProseKey Service.
Â© 2023, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA,
TTC).
All rights reserved.
externalDocs:
description: 3GPP TS 29.553 V18.1.0; 5G System; 5G ProSe Anchor Services;
Stage 3.
url: https://www.3gpp.org/ftp/Specs/archive/29_series/29.553/
servers:
\- url: \'{apiRoot}/npanf-prosekey/**\ ** \'
variables:
apiRoot:
default: https://example.com
description: apiRoot as defined in clause 4.4 of 3GPP TS 29.501
security:
\- {}
\- oAuth2ClientCredentials:
\- npanf-prosekey
paths:
/prose-keys/register:
post:
summary: Register the Prose Key
operationId: ProseKeyRegistration
tags:
\- prosekey registration
security:
\- {}
\- oAuth2ClientCredentials:
\- npanf_prosekey
\- oAuth2ClientCredentials:
\- npanf_prosekey
\- npanf_prosekey:register:invoke
requestBody:
content:
application/json:
schema:
\$ref: \'#/components/schemas/ProseContextInfo\'
required: true
responses:
\'204\':
description: Successful Response
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'502\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/502\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
description: Unexpected error
/prose-keys/retrieve:
post:
summary: retrieve the prose key
operationId: ProseKeyRetrieval
tags:
\- Prose Key Retrieval
security:
\- {}
\- oAuth2ClientCredentials:
\- npanf_prosekey
\- oAuth2ClientCredentials:
\- npanf_prosekey
\- npanf_prosekey:retrieve:invoke
requestBody:
content:
application/json:
schema:
\$ref: \'#/components/schemas/ProseKeyRequest\'
required: true
responses:
\'200\':
description: Expected response to a valid request
content:
application/json:
schema:
\$ref: \'#/components/schemas/ProseKeyResponse\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'502\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/502\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
description: Unexpected error
components:
securitySchemes:
oAuth2ClientCredentials:
type: oauth2
flows:
clientCredentials:
tokenUrl: \'{nrfApiRoot}/oauth2/token\'
scopes:
npanf-prosekey: Access to the Npanf_ProseKey API
npanf-prosekey:register:invoke: Access to invoke register Prose Context
npanf-prosekey:retrieve:invoke: Access to invoke retrieve CP-PRUK
schemas:
#
# Structured Data Types
#
ProseContextInfo:
description: Prose Context Info.
type: object
properties:
supi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
5gPruk:
\$ref: \'#/components/schemas/5GPruk\'
5gPrukId:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/5GPrukId\'
relayServiceCode:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/RelayServiceCode\'
required:
\- supi
\- 5gPruk
\- 5gPrukId
\- relayServiceCode
ProseKeyRequest:
description: Prose Key Request.
type: object
properties:
5gPrukId:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/5GPrukId\'
relayServiceCode:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/RelayServiceCode\'
required:
\- 5gPrukId
\- relayServiceCode
ProseKeyResponse:
description: Prose Key Response.
type: object
properties:
5gPruk:
\$ref: \'#/components/schemas/5GPruk\'
required:
\- 5gPruk
#
# Simple Data Types
#
5GPruk:
description: ProSe Remote User Key over Control Plane
type: string
pattern: \'\^[A-Fa-f0-9]{64}\$\'
#
# Enumeration Data Types
#
# A.3 Npanf_ResolveRemoteUserId API
openapi: 3.0.0
info:
version: \'1.0.0\'
title: \'Npanf_ResolveRemoteUserId\'
description: \|
PANF Resolve Remote User Id Service.
Â© 2023, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA,
TTC).
All rights reserved.
externalDocs:
description: 3GPP TS 29.559 V17.2.0; 5G System; 5G ProSe Key Management
Services; Stage 3.
url: https://www.3gpp.org/ftp/Specs/archive/29_series/29.559/
servers:
\- url: \'{apiRoot}/npanf-userid/v1\'
variables:
apiRoot:
default: https://example.com
description: apiRoot as defined in clause 4.4 of 3GPP TS 29.501
security:
\- {}
\- oAuth2ClientCredentials:
\- npanf-userid
paths:
/prose-resolution/get:
post:
summary: Request to resolve the Remote User ID
operationId: ProseResolve
tags:
\- Resolve Remote User ID
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/ResolveReqData\'
responses:
\'200\':
description: Success
content:
application/json:
schema:
\$ref: \'#/components/schemas/ResolveRspData\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'502\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/502\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
description: Unexpected error
components:
securitySchemes:
oAuth2ClientCredentials:
type: oauth2
flows:
clientCredentials:
tokenUrl: \'{nrfApiRoot}/oauth2/token\'
scopes:
npanf-userid: Access to the Npanf_ResolveRemoteUserId API
schemas:
#
# Structured Data Types
#
ResolveReqData:
description: Representation of the Resolve Request Data.
type: object
properties:
cpPrukId:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/5GPrukId\'
required:
\- cpPrukId
ResolveRspData:
description: Representation of the Resolve Response Data.
type: object
properties:
supi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
required:
\- supi
#
# Simple Data Types
#
#
# Enumeration Data Types
#
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides the description of the Subnetwork Dependent
Convergence Protocol (SNDCP) for the General Packet Radio Service (GPRS).
The user of the services provided by SNDCP is a packet data protocol (PDP) at
the mobile Station (MS) or the Relay at the Serving GPRS Support Node (SGSN).
Additionally, a control entity, e.g. AT command interpreter, may be an SNDCP
user. SNDCP uses the services provided by the Logical Link Control (LLC) layer
[4] and the Session Management (SM) sub-layer [2].
The main functions of SNDCP are:
\- Multiplexing of several PDPs.
\- Compression / decompression of user data.
\- Compression / decompression of protocol control information.
\- Segmentation of a network protocol data unit (N‑PDU) into Logical Link
Control Protocol Data Units (LL‑PDUs) and re-assembly of LL‑PDUs into an
N‑PDU.
3GPP TS 44.065 is applicable to GPRS MS and SGSN.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.060: \"General Packet Radio Service (GPRS); Service
Description; Stage 1\".
[3] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
Description; Stage 2\".
[4] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[5] 3GPP TS 44.018: \"Mobile radio interface; Layer 3 specification; Radio
Resource Control Protocol\".
[5a] 3GPP TS 24.008: \"Mobile radio interface; Layer 3 specification; Core
Network Protocols; Stage 3\".
[6] 3GPP TS 44.064: \"General Packet Radio Service (GPRS); Mobile Station -
Serving GPRS Support Node (MS-SGSN) Logical Link Control (LLC) layer
specification\".
[7] 3GPP TS 29.060: \"General Packet Radio Service (GPRS); GPRS Tunnelling
Protocol (GTP) across the Gn and Gp Interface\".
[8] ITU-T Recommendation V.42 bis: \"Data compression procedures for data
circuit-terminating equipment (DCE) using error correcting procedures\".
[9] IETF RFC 1144: \"Compressing TCP/IP headers for low-speed serial links\".
[10] IETF RFC 2507: \"IP Header Compression\".
[11] ITU-T Recommendation V.44: \"Data compression procedures\".
[12] IETF RFC 5795: \"RObust Header Compression (ROHC): Framework\"..
[13] IETF RFC 3241: \"Robust Header Compression (ROHC) over PPP\"..
[14] \"RObust Header Compression (ROHC) Profile Identifiers\". IANA registry
at:\ _http://www.iana.org/assignments/rohc-pro-ids_
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TS 21.905 [1] and 3GPP TS 22.060 [2] and the following apply:
**Feedback N‑PDU:** an N-PDU which is generated by an SNDCP protocol control
information compression entity or data compression entity and contains only
control information for its peer compression entity, but no payload from any
SNDCP user.
**N201:** LLC layer parameter (see 3GPP TS 44.064 [6] for clarity).\ Defines
maximum number of octets in the information field of LL‑PDU. Separate values
are applicable for I\ (see N201-I), U and UI (see N201-U) LL‑PDUs.
**N201-I:** LLC layer parameter (see 3GPP TS 44.064 [6] for clarity).\ Defines
maximum number of octets available to a SN‑DATA PDU for a specific SAPI.
**N201-U:** LLC layer parameter (see 3GPP TS 44.064 [6] for clarity).\ Defines
maximum number of octets available to a SN‑UNITDATA PDU for a specific SAPI.
If integrity protection is used, (N201-U -- 4) defines maximum number of
octets available to an SN-UNITDATA PDU for a specific SAPI.
**N‑PDU number:** a sequence number assigned to N‑PDUs per NSAPI.
**NSAPI:** for each SN‑PDU the NSAPI is an index to the PDP context of the PDP
that is using the services provided by the SNDCP layer.
**Receive N‑PDU number:** the value of the N‑PDU number expected in the next
N‑PDU received by an NSAPI using acknowledged peer-to-peer LLC operation.
**Recovery state:** a state for an NSAPI in which duplicated received N‑PDUs
shall be detected and discarded.\ The recovery state only applies to NSAPIs
using acknowledged peer-to-peer LLC operation.
**SAPI:** identifies the Service Access Point that the SN‑PDU is using at the
LLC layer.
**Segment number:** a sequence number assigned to SN‑UNITDATA PDUs carrying
segments of an N‑PDU.
**Send N‑PDU number:** the value to be assigned as the N‑PDU number to the
next N‑PDU received from the SNDCP user by an NSAPI using acknowledged peer-
to-peer LLC operation.
**Send N‑PDU number (unacknowledged):** the value to be assigned as the N‑PDU
number to the next N‑PDU received from the SNDCP user by an NSAPI using
unacknowledged peer-to-peer LLC operation**.**
**SNDCP entity:** handles the service functions provided by the SNDCP layer.
The SNDCP entity is temporary logical link identity specific.
**SNDCP management entity:** handles communication with SM sub-layer and
controls the operation of the SNDCP entity.
**SNDCP user:** protocol entity that is using the services provided by the
SNDCP layer. PDP entities and control entities, e.g. AT command interpreter,
are the SNDCP users at the MS. Relay entity is the SNDCP user at the SGSN.
**SNDCP XID block:** the collection of SNDCP XID parameters being negotiated.
It is transferred by the LL‑XID and LL‑ESTABLISH primitives between SNDCP and
LLC.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TS
21.905 [1], 3GPP TS 22.060 [2], and 3GPP TS 23.060 [3], and the following
apply:
CID Context Identifier
DCOMP Identifier of the user data compression algorithm used for the N‑PDU
ESP Encapsulating Security Payload
F First segment indicator bit
GMM GPRS Mobility Management
IP Internet Protocol
LLC Logical Link Control
LSB Least Significant Bits
M More bit used to indicate the last segment of N‑PDU
N‑PDU Network Protocol Data Unit
MRRU Maximum Reconstructed Reception Unit
MSB Most Significant Bits
NSAPI Network Layer Service Access Point Identifier
P Propose bit
PCOMP Identifier of the protocol control information compression algorithm
used for the N‑PDU
PDP Packet Data Protocol (e.g. IPv4 or IPv6)
PDU Protocol Data Unit
PID Protocol Identifier
PTP Point to Point
QoS Quality of Service
ROHC RObust Header Compression
RTP Real Time Protocol
SAPI Service Access Point Identifier
SDU Service Data Unit
SGSN Serving GPRS Support Node
SM Session Management
SNDCP Subnetwork Dependent Convergence Protocol
SNSM SNDCP-SM
TCP Transmission Control Protocol
TLLI Temporary Logical Link Identifier
X Spare bit
# 4 General
The present document describes the functionality of the GPRS SNDCP. The
overall GPRS logical architecture is defined in 3GPP TS 23.060 [3]. Location
of the SNDCP in GPRS protocol stack can be seen in figure 1.
Figure 1: GPRS protocol stack
Network layer protocols are intended to be capable of operating over services
derived from a wide variety of subnetworks and data links. GPRS supports
several network layer protocols providing protocol transparency for the users
of the service. Introduction of new network layer protocols to be transferred
over GPRS shall be possible without any changes to GPRS. Therefore, all
functions related to transfer of Network layer Protocol Data Units (N‑PDUs)
shall be carried out in a transparent way by the GPRS network entities. This
is one of the requirements for GPRS SNDCP.
Another requirement for the SNDCP is to provide functions that help to improve
channel efficiency. This requirement is fulfilled by means of compression
techniques.
The set of protocol entities above SNDCP consists of commonly used network
protocols. They all use the same SNDCP entity, which then performs
multiplexing of data coming from different sources to be sent using the
service provided by the LLC layer (figure 2). The Network Service Access Point
Identifier (NSAPI) is an index to the PDP context (see 3GPP TS 23.060 [3]) of
the PDP that is using the services provided by SNDCP. One PDP may have several
PDP contexts and NSAPIs. However, it is possible that each allocated NSAPI is
used by separate PDP. Each active NSAPI shall use the services provided by the
Service Access Point Identifier (SAPI) in the LLC layer. Several NSAPIs may be
associated with the same SAPI.
Since the adaptation of different network layer protocols to SNDCP is
implementation dependent, it is not defined in the present document.
Figure 2: Example for multiplexing of different protocols
# 5 Service primitives and functions
## 5.1 Service primitives
This subclause explains the service primitives used for communication between
the SNDCP layer and other layers. See also 3GPP TS 24.007 [4] to get an
overall picture of the service primitives. Figure 3 illustrates the service
access points through which the primitives are carried out.
Figure 3: Service Access Points provided and used by SNDCP
### 5.1.1 SNDCP service primitives
The primitives provided by the SNDCP layer are listed in table 1.
Table 1: SNDCP layer service primitives
* * *
Generic Name Type Parameters  
Request Indication Response Confirm  
**SNDCP User (PDP or the SGSN Relay) ↔ SNDCP**  
SN-DATA X - - - N‑PDU, NSAPI, N‑PDU Number SN‑DATA - X - - N‑PDU, NSAPI
SN‑UNITDATA X X - - N‑PDU, NSAPI SN‑XID X X - - Requested SNDCP XID Parameters
SN‑XID - - X X Negotiated SNDCP XID Parameters
* * *
#### 5.1.1.1 SN‑DATA.request
Request used by the SNDCP user for acknowledged transmission of N‑PDU. The
successful transmission of SN‑PDU shall be confirmed by the LLC layer. The
SN‑DATA.request primitive conveys NSAPI to identify the PDP using the service.
N‑PDU Number, if present, indicates the N‑PDU number previously assigned to
this N‑PDU.
NOTE: An N‑PDU number may have been assigned to an N‑PDU by the old SGSN
before an inter-SGSN routeing area update.
#### 5.1.1.2 SN‑DATA.indication
Indication used by the SNDCP entity to deliver the received N‑PDU to the SNDCP
user. Successful reception has been acknowledged by the LLC layer.
#### 5.1.1.3 SN‑UNITDATA.request
Request used by the SNDCP user for unacknowledged transmission of N‑PDU. The
SN‑UNITDATA.request primitive conveys NSAPI to identify the PDP using the
service.
#### 5.1.1.4 SN‑UNITDATA.indication
Indication used by the SNDCP entity to deliver the received N‑PDU to the SNDCP
user.
#### 5.1.1.5 SN‑XID.request
Request used by the SNDCP user at the initiating entity to deliver the list of
requested XID parameters to the peer entity.
#### 5.1.1.6 SN‑XID.indication
Indication used by the SNDCP entity to deliver the list of requested XID
parameters to the SNDCP user.
#### 5.1.1.7 SN‑XID.response
Response used by the SNDCP user to deliver the list of negotiated XID
parameters to the peer entity.
#### 5.1.1.8 SN‑XID.confirm
Confirm used by the SNDCP entity to deliver the list of negotiated XID
parameters to the SNDCP user.
### 5.1.2 Service primitives used by SNDCP layer
The SNDCP layer uses the service primitives provided by the SM sublayer and
the LLC layer (see table 2). SM is specified in 3GPP TS 24.008 [5a] and LLC in
3GPP TS 44.064 [6].
Table 2: Service primitives used by the SNDCP entity
* * *
Generic Name Type Parameters  
Request Indication Response Confirm  
**SNDCP ↔ LLC**  
LL‑RESET - X - - TLLI, old XID indicator LL‑ESTABLISH X - - - TLLI, XID
Requested LL‑ESTABLISH - X - - TLLI, XID Requested, N201-I, N201-U
LL‑ESTABLISH - - X - TLLI, XID Negotiated LL‑ESTABLISH - - - X TLLI, XID
Negotiated, N201-I, N201-U LL‑RELEASE X - - - TLLI, Local LL‑RELEASE - X - -
TLLI, Cause LL‑RELEASE - X TLLI LL‑XID X - - - TLLI, XID Requested LL‑XID - X
- - TLLI, XID Requested, N201-I, N201-U LL‑XID - - X - TLLI, XID Negotiated
LL‑XID - - - X TLLI, XID Negotiated, N201-I, N201-U LL‑DATA X - - - TLLI,
SN‑PDU, Reference, QoS Parameters, Radio Priority LL‑DATA - X - - TLLI, SN‑PDU
LL‑DATA - - - X TLLI, Reference LL‑UNITDATA X - - - TLLI, SN‑PDU, QoS
Parameters, Radio Priority, Cipher LL‑UNITDATA - X - - TLLI, SN‑PDU LL-STATUS
- X - - TLLI, Cause **SNDCP ↔ SM**  
SNSM-ACTIVATE X - - TLLI, NSAPI, QoS profile, SAPI, Radio Priority SNSM-
ACTIVATE - - X TLLI, NSAPI SNSM-DEACTIVATE - X - - TLLI, NSAPI(s), LLC Release
Indicator, XID Negotiation Indicator SNSM-DEACTIVATE - - X - TLLI, NSAPI SNSM-
MODIFY - X - - TLLI, NSAPI, QoS Profile, SAPI, Radio Priority, Send N‑PDU
Number, Receive N‑PDU Number SNSM-MODIFY - - X - TLLI, NSAPI SNSM-STATUS X - -
- TLLI, SAPI, Cause SNSM-SEQUENCE - X X - TLLI, NSAPI, Receive N‑PDU Number
SNSM-STOP-ASSIGN - X - - TLLI, NSAPI
* * *
#### 5.1.2.1 LL‑RESET.indication
Indication used by the LLC layer in the SGSN to indicate to the SNDCP layer
that the Reset XID parameter has been transmitted, and by the LLC layer in the
MS to indicate to the SNDCP layer that the Reset XID parameter has been
received.
Upon receipt of the LL‑RESET.indication, the SNDCP layer shall:
\- treat all outstanding SNDCP ↔ LLC request type primitives as not sent;
\- if the old XID indicator is set, keep the SNDCP XID parameters that were
applicable before the receipt of the LL-RESET.indication and re-initialize any
negotiated compression entities . Otherwise, if the old XID indicator is not
set, reset all SNDCP XID parameters to their default values (for the
definition of default values see subclause 6.8.2 and clause 8, table 8);
\- in the MS, for every NSAPI using unacknowledged peer-to-peer LLC operation,
set the Send N‑PDU number (unacknowledged) to 0; and
\- for every NSAPI using acknowledged peer-to-peer LLC operation, enter the
recovery state and suspend the transmission of SN‑PDUs until an SNSM-
SEQUENCE.indication primitive is received for the NSAPI. In the SGSN the SNDCP
layer shall re-establish acknowledged peer-to-peer operation for the affected
SAPIs in the LLC layer.
#### 5.1.2.2 LL‑ESTABLISH.request
Request used by the SNDCP layer to establish or re-establish acknowledged
peer-to-peer operation for a SAPI in the LLC layer. XID Requested is used to
deliver the requested SNDCP XID parameters to the LLC layer.
#### 5.1.2.3 LL‑ESTABLISH.indication
Indication used by the LLC layer to inform the SNDCP layer about establishment
or re-establishment of acknowledged peer-to-peer operation for a SAPI in the
LLC layer. XID Requested is used to deliver the requested SNDCP XID parameters
to the SNDCP layer. In case of a re-establishment, all NSAPIs mapped to the
affected SAPI shall enter the recovery state, and all buffered N‑PDUs (i.e.
the ones whose complete reception has not been acknowledged and the ones that
have not been transmitted yet), except the feedback N-PDUs, shall be
transmitted starting with the oldest N‑PDU when the link is re-established.
Also all compression entities using acknowledged peer-to-peer LLC operation on
this SAPI are reset.
Before the transmission of N-PDUs is resumed, any feedback N-PDUs shall be
removed from the buffered N‑PDUs. If feedback N-PDUs are removed, the SNDCP
layer shall reassign the N-PDU numbers of the remaining N-PDUs, so that
consecutive numbering is restored and transmission is started with the N-PDU
number expected by the peer SNDCP entity. If the LL‑ESTABLISH.indication
primitive is used to re-establish acknowledged peer-to-peer LLC operation
during an inter-SGSN routeing area update, the N-PDU numbers shall be
reassigned only after receipt of the SNSM-SEQUENCE.indication.
#### 5.1.2.4 LL‑ESTABLISH.response
Response used by the SNDCP layer after reception of the
LL‑ESTABLISH.indication. XID Negotiated is used to deliver the negotiated
SNDCP XID parameters to the LLC layer.
#### 5.1.2.5 LL‑ESTABLISH.confirm
Confirmation used by the LLC layer to inform the SNDCP layer about successful
initiation of acknowledged peer-to-peer operation for a SAPI in the LLC layer.
XID Negotiated is used to deliver the negotiated SNDCP XID parameters to the
SNDCP layer. In case of a re-establishment, all NSAPIs mapped to the affected
SAPI shall enter the recovery state, and all buffered N‑PDUs (i.e. the ones
whose complete reception has not been acknowledged and the ones that have not
been transmitted yet), except the feedback N-PDUs, shall be transmitted
starting with the oldest N‑PDU when the link is re-established. Also all
compression entities using acknowledged peer-to-peer LLC operation on this
SAPI are reset.
Before the transmission of N-PDUs is resumed, any feedback N-PDUs shall be
removed from the buffered N‑PDUs. If feedback N-PDUs are removed, the SNDCP
layer shall reassign the N-PDU numbers of the remaining N-PDUs, so that
consecutive numbering is restored and transmission is started with the N-PDU
number expected by the peer SNDCP entity. If the LL‑ESTABLISH.confirm
primitive is used to re-establish acknowledged peer-to-peer LLC operation
during an inter-SGSN routeing area update, the N-PDU numbers shall be
reassigned only after receipt of the SNSM-SEQUENCE.indication.
#### 5.1.2.6 LL‑RELEASE.request
Request used by the SNDCP layer to release acknowledged peer-to-peer operation
for a SAPI in the LLC layer. The Local parameter indicates whether the
termination shall be local (see 3GPP TS 44.064 [6] for details).
#### 5.1.2.7 LL‑RELEASE.indication
Indication used by the LLC layer to inform the SNDCP layer about termination
of acknowledged peer-to-peer operation for a SAPI in the LLC layer. The Cause
parameter indicates the cause for the termination.
On receipt of LL‑RELEASE.indication, compressed N‑PDUs queuing to be forwarded
to the affected SAPI are deleted from the SNDCP layer. Also all compression
entities using acknowledged peer-to-peer LLC operation on this SAPI are reset.
#### 5.1.2.8 LL‑RELEASE.confirm
Confirmation used by the LLC layer to inform the SNDCP layer about termination
of acknowledged peer-to-peer operation for a SAPI in the LLC layer. On receipt
of LL‑RELEASE.confirm, compressed N‑PDUs queuing to be forwarded to the
affected SAPI are deleted from the SNDCP layer. Also all compression entities
using acknowledged peer-to-peer LLC operation on this SAPI are reset.
#### 5.1.2.9 LL‑XID.request
Request used by the SNDCP layer to deliver the requested SNDCP XID parameters
to the LLC layer.
#### 5.1.2.10 LL‑XID.indication
Indication used by the LLC layer to deliver the requested SNDCP XID parameters
to the SNDCP layer.
#### 5.1.2.11 LL‑XID.response
Response used by the SNDCP layer to deliver the negotiated SNDCP XID
parameters to the LLC layer.
#### 5.1.2.12 LL‑XID.confirm
Confirm used by the LLC layer to deliver the negotiated SNDCP XID parameters
to the SNDCP layer.
#### 5.1.2.13 LL‑DATA.request
Request used by the SNDCP layer for acknowledged transmission of an SN‑PDU.
The SNDCP entity shall associate a reference parameter for each
LL‑DATA.request. QoS Parameters in the SGSN includes precedence class, delay
class, and peak throughput. QoS Parameters in the MS includes peak throughput.
QoS Parameters is defined as part of the Quality of Service information
element in 3GPP TS 24.008 [5a]. Radio Priority is included only in the MS, and
indicates the radio priority level to be used by RLC/MAC.
Acknowledged peer-to-peer LLC operation for the SAPI used shall be established
using the LL‑ESTABLISH primitives, before the LL‑DATA.request may be used.
#### 5.1.2.14 LL‑DATA.indication
Indication used by the LLC layer to deliver the successfully received SN‑PDU
to the SNDCP layer.
#### 5.1.2.15 LL‑DATA.confirm
Confirm used by the LLC layer to inform SNDCP layer about successful
transmission of SN‑PDU. The primitive includes a reference parameter from
which the SNDCP entity shall identify the LL‑DATA.request this confirmation
was associated with. All buffered N‑PDUs whose complete reception is confirmed
are deleted.
#### 5.1.2.16 LL‑UNITDATA.request
Request used by the SNDCP layer for unacknowledged transmission of a SN‑PDU.
Unconfirmed transmission shall be used by the LLC layer.
Acknowledged peer-to-peer LLC operation does not need to be established before
unacknowledged transmission is allowed.
QoS Parameters in the SGSN includes precedence class, delay class, reliability
class, and peak throughput. QoS Parameters in the MS includes peak throughput
and reliability class. Reliability class indicates whether the LLC frame
carrying the SN‑PDU shall be transmitted in protected or unprotected mode, and
whether RLC/MAC acknowledged or unacknowledged mode shall be used. Radio
Priority is included only in the MS, and indicates the radio priority level to
be used by RLC/MAC.
#### 5.1.2.17 LL‑UNITDATA.indication
Indication used by the LLC layer to deliver the received SN‑PDU to the SNDCP
layer. There is no need for acknowledged peer-to-peer LLC operation for
unacknowledged transmission of SN‑PDU.
#### 5.1.2.18 LL‑STATUS.indication
Indication used by the LLC layer to inform SNDCP when an LLC error that cannot
be corrected by the LLC layer has occurred. The Cause parameter indicates the
cause of the failure.
On receipt of LL‑STATUS.indication, SNDCP shall inform the SM sub-layer by
means of the SNSM-STATUS.request primitive.
#### 5.1.2.19 SNSM-ACTIVATE.indication
Indication used by the SM entity to inform the SNDCP entity that an NSAPI has
been activated for data transfer. It also informs the SNDCP entity about the
negotiated QoS profile (see 3GPP TS 24.008 [5a]), the SAPI assigned for this
NSAPI, and, in the MS, the radio priority level to be used by RLC/MAC.
If the NSAPI activated uses the acknowledged peer-to-peer LLC operation, the
NSAPI shall enter the recovery state.
Upon reception of the SNSM-ACTIVATE.indication from the SM sublayer, the SNDCP
entity shall, if necessary, establish the acknowledged peer-to-peer LLC
operation for the indicated SAPI. The establishment criteria and procedure are
described in subclause 6.2.1.
#### 5.1.2.20 SNSM-ACTIVATE.response
Response used by the SNDCP layer to inform SM entity that the indicated NSAPI
is now in use and that the acknowledged peer-to-peer LLC operation for the
indicated SAPI is established, if necessary.
#### 5.1.2.21 SNSM-DEACTIVATE.indication
Indication used by the SM entity to inform the SNDCP entity that an NSAPI has
been deallocated and cannot be used by the SNDCP entity anymore. All buffered
N‑PDUs corresponding to this NSAPI are deleted.
Upon reception of the SNSM-DEACTIVATE.indication, the SNDCP entity shall, if
necessary, release the acknowledged peer-to-peer LLC operation for the
associated SAPI. The release criteria and procedure are described in subclause
6.2.2. If the XID Negotiation Indicator is included in the the SNSM-
DEACTIVATE.indication and compression entities have been negotiated for the
NSAPI, the NSAPI shall be removed from the Applicable NSAPIs of these
compression entities by explicit XID negotiation. If no XID Negotiation
Indicator is included, the NSAPI shall be removed locally, without XID
negotiation (see subclause 6.8).
#### 5.1.2.22 SNSM-DEACTIVATE.response
Response used by the SNDCP layer to inform SM entity that the NSAPI indicated
is no longer in use and that the acknowledged peer-to-peer LLC operation for
the associated SAPI is released, if necessary.
#### 5.1.2.23 SNSM-MODIFY.indication
Indication used by the SM entity to trigger change of the QoS profile (see
3GPP TS 24.008 [5a]) for an NSAPI and indication of the SAPI to be used. It is
also used by the SM entity in the SGSN to inform the SNDCP entity that an
NSAPI shall be created, together with the (re‑)negotiated QoS profile, the
SAPI assigned, and, in the MS, the radio priority level to be used by RLC/MAC.
NOTE: The latter is performed in the new SGSN during an Inter-SGSN Routeing
Area Update.
Upon reception of the SNSM-MODIFY.indication from the SM sublayer:
\- the SNDCP entity shall, if necessary, establish the acknowledged peer-to-
peer LLC operation for the indicated SAPI (the establishment criteria and
procedure are described in subclause 6.2.1); and
\- the SNDCP entity shall also, if necessary, release the acknowledged peer-
to-peer LLC operation for the originally-assigned SAPI (the release criteria
and procedure are described in subclause 6.2.2).
If the SNSM-MODIFY.indication applies to an existing NSAPI, and:
\- if the peer-to-peer LLC operation mode is changed from acknowledged to
unacknowledged, then all buffered N‑PDUs shall be deleted, and the Send N‑PDU
number (unacknowledged) shall be set to 0; and
\- if the peer-to-peer LLC operation mode is changed from unacknowledged to
acknowledged, then the Send N‑PDU number and Receive N‑PDU number shall be set
to 0.
In addition, if the newly-assigned SAPI is different from the original SAPI:
\- LL‑DATA.indication, LL‑DATA.confirm and LL‑UNITDATA.indication received on
the old SAPI shall be ignored;
\- LL‑DATA.request and LL‑UNITDATA.request shall be sent on the new SAPI; and
\- if acknowledged peer-to-peer LLC operation is used both before and after
the receipt of the SNSM-MODIFY.indication, then the NSAPI shall enter the
recovery state, and all buffered N‑PDUs (i.e. the ones whose complete
reception has not been acknowledged and the ones that have not been
transmitted yet) shall be transmitted starting from the oldest N‑PDU.
If the SNSM-MODIFY.indication signifies the creation of an NSAPI (i.e. the
specified NSAPI does not exist), and:
\- if unacknowledged peer-to-peer LLC operation is specified in the QoS
profile, then the Send N‑PDU number (unacknowledged) shall be set to 0; and
\- if acknowledged peer-to-peer LLC operation is specified in the QoS profile,
then the Send N‑PDU number and the Receive N‑PDU number variables shall be set
to the values stated in the primitive.
#### 5.1.2.24 SNSM-MODIFY.response
Response used by the SNDCP entity to inform the SM entity that the indicated
NSAPI and QoS profile are now in use and the acknowledged peer-to-peer LLC
operations for the appropriate SAPIs are established and/or released, if
necessary.
#### 5.1.2.25 SNSM-STATUS.request
This primitive is used by the SNDCP layer to inform the SM sub-layer that
SNDCP cannot continue its operation due to errors at the LLC layer (as
indicated with LL‑RELEASE.indication) or at the SNDCP layer. The Cause
parameter indicates the cause of the error.
#### 5.1.2.26 SNSM-SEQUENCE.indication
This primitive is used during an inter-SGSN routeing area update and applies
only to NSAPIs using acknowledged peer-to-peer LLC operation. When the
primitive is used in the MS, the Receive N‑PDU number parameter indicates the
Receive N‑PDU number in the SGSN. When the primitive is used in the SGSN, the
Receive N‑PDU number parameter indicates the Receive N‑PDU number in the MS.
If a buffered N‑PDU is confirmed by the Receive N‑PDU number parameter to have
been received by the peer SNDCP entity, the N‑PDU shall be deleted from the
buffer. In addition, the receipt of this primitive by the SNDCP entity resumes
the transmission of SN‑PDUs for the NSAPI, and all buffered N‑PDUs (i.e. the
ones whose complete reception has not been acknowledged and the ones that have
not been transmitted yet), except the feedback N-PDUs, shall be transmitted
starting from the oldest N‑PDU. Before the transmission is resumed, any
feedback N-PDUs shall be removed from the buffered N‑PDUs. If feedback N-PDUs
are removed, the SNDCP layer shall reassign the N-PDU numbers of the remaining
N-PDUs, so that consecutive numbering is restored and transmission is started
with the N-PDU number expected by the peer SNDCP entity. If acknowledged peer-
to-peer LLC operation has not yet been established for the SAPI used by this
NSAPI, the transmission of the buffered N‑PDUs shall begin only after the
receipt of the LL‑ESTABLISH.indication or LL‑ESTABLISH.confirm primitive.
#### 5.1.2.27 SNSM-SEQUENCE.response
This primitive is used during an inter-SGSN routeing area update and applies
only to NSAPIs using acknowledged peer-to-peer LLC operation. The primitive is
used by the SNDCP layer in the MS following receipt of an SNSM-
SEQUENCE.indcation, in order to return the Receive N‑PDU number to the SGSN
during an ongoing inter-SGSN routeing area update.
#### 5.1.2.28 SNSM-STOP-ASSIGN.indication
This primitive is used during an inter-SGSN routeing area update in the old
SGSN by the SM entity to inform the SNDCP entity to stop assigning N‑PDU
numbers to N‑PDUs received through the SN‑DATA.request primitive. The
primitive is sent before the Send N‑PDU number and the Receive N‑PDU number
are transferred to the new SGSN.
## 5.2 Service functions
SNDCP shall perform the following functions (see figure 4):
\- Mapping of SN‑DATA primitives onto LL‑DATA primitives.
\- Mapping of SN‑UNITDATA primitives onto LL‑UNITDATA primitives.
\- Multiplexing of N‑PDUs from one or several network layer entities onto the
appropriate LLC connection.
\- Establishment, re-establishment and release of acknowledged peer-to-peer
LLC operation.
\- Supplementing the LLC layer in maintaining data integrity for acknowledged
peer-to-peer LLC operation by buffering and retransmission of N‑PDUs.
\- Management of delivery sequence for each NSAPI, independently.
\- Compression of redundant protocol control information (e.g. TCP/IP header)
at the transmitting entity and decompression at the receiving entity. The
compression method is specific to the particular network layer or transport
layer protocols in use.
\- Compression of redundant user data at the transmitting entity and
decompression at the receiving entity. Data compression is performed
independently for each SAPI, and may be performed independently for each PDP
context. Compression parameters are negotiated between the MS and the SGSN.
\- Segmentation and reassembly. The output of the compressor functions is
segmented to the maximum length of LL‑PDU. These procedures are independent of
the particular network layer protocol in use.
\- Negotiation of the XID parameters between peer SNDCP entities using XID
exchange.
Figure 4 shows the transmission flow through SNDCP layer. The order of
functions is the following:
\- Protocol control information compression.
\- User data compression.
\- Segmentation of compressed information into SN‑DATA or SN‑UNITDATA PDUs.
The order of functions is vice versa in the reception flow:
\- Reassembly of SN‑PDUs to N‑PDUs.
\- User data decompression.
\- Protocol control information decompression.
Figure 4: SNDCP model
The SNDCP layer expects the following services to be provided by the LLC
layer. LLC layer functionality is defined in 3GPP TS 44.064 [6]:
\- Acknowledged and unacknowledged data transfer.
\- Point-to-point and point-to-multipoint data transfer.
\- In-order delivery of SN‑PDUs per SAPI (i.e. SN‑PDUs using the same SAPI
shall appear at the receiving end in the same order as transmitted). This is
required only for acknowledged service.
\- QoS profile-based transfer of SN‑PDUs.
\- Support for variable length SN‑PDUs.
\- Transfer of SNDCP XID parameters.
The SNDCP layer expects the following services to be provided by the SM
sublayer. SM sublayer functionality is defined in 3GPP TS 24.008 [5a]:
\- Activation and deactivation of PDP Contexts and informing the SNDCP layer
when change in PDP context has happened.
\- Carrying out Inter SGSN Routing Area Update and informing the SNDCP layer
in the SGSN when the N‑PDUs shall be tunnelled to the new SGSN.
\- Notifying the SNDCP layer when there is need to change the QoS profile
parameters of the PDP contexts.
# 6 Protocol functions
## 6.1 Multiplexing of N‑PDUs
The NSAPI field shall be used for the identification of the specific PDP type
and PDP address pair that is using the services provided by the SNDCP layer.
The MS allocates NSAPIs dynamically at the PDP Context Activation. The NSAPI
is delivered by the SM sub-layer to the SNDCP layer with the SNSM-
ACTIVATE.indication primitive. The transmitting SNDCP entity shall insert the
NSAPI value for each N‑PDU. The peer SNDCP entity uses the NSAPI to identify
the SNDCP user the N‑PDU is targeted. Table 3 shows an example for the
allocation of the NSAPIs.
Table 3: Example of the NSAPI allocation
* * *
PDP type Allocated NSAPI PDP address IPv4 12 133.12.75.111 (4 octets) IPv6 13
133.12. ... .11.123 (16 octets)
* * *
## 6.2 Establishment and release of acknowledged peer-to-peer LLC operation
The SNDCP layer shall be responsible for establishing, re-establishing and
releasing the acknowledged peer-to-peer LLC operation.
Re-establishment and release of the acknowledged peer-to-peer LLC operation
may also be initiated by the LLC layer. The conditions under which this may
happen are described in 3GPP TS 44.064 [6].
Negotiation of SNDCP XID parameters may be carried out in conjunction with the
establishment or re-establishment procedure. It is also possible to negotiate
SNDCP XID parameters independently from the establishment or re-establishment
procedure, by using the LL‑XID primitives.
### 6.2.1 Establishment of acknowledged peer-to-peer LLC operation
#### 6.2.1.1 Establishment criteria
If acknowledged peer-to-peer LLC operation is required by an NSAPI (as
indicated by the QoS profile) but is not yet established for the SAPI used by
the NSAPI, then the SNDCP layer shall initiate the establishment procedure.
The SNDCP layer at the MS shall initiate the establishment, using the
procedure in subclause 6.2.1.3, upon receipt of the SNSM-ACTIVATE.indication
primitive.
The SNDCP layer at the SGSN shall initiate the establishment upon receipt of
the SNSM-MODIFY.indication primitive.
#### 6.2.1.2 Re-establishment of the acknowledged peer-to-peer LLC operation
The SNDCP layer may initiate re-establishment of the acknowledged peer-to-peer
LLC operation for a SAPI under certain situations, for example when an error
is detected by a V.42 bis data compression entity used for acknowledged data
transfer.
The LLC layer may also initiate re-establishment of the acknowledged peer-to-
peer LLC operation for a SAPI under situations described in 3GPP TS 44.064
[6]. The LLC layer informs the SNDCP layers of link re-establishment using the
LL‑ESTABLISH.indication primitive. This is shown in figure 5.
Figure 5: LLC-initiated re-establishment
#### 6.2.1.3 Establishment procedure
The SNDCP layer shall initiate the establishment or re-establishment by
sending an LL‑ESTABLISH.request primitive to the relevant LLC SAP. SNDCP XID
parameters may be included in an SNDCP XID block in the LL‑ESTABLISH.request
primitive. If no SNDCP XID parameter is to be included, an empty SNDCP XID
block shall be included.
Following the sending of the LL‑ESTABLISH.request primitive, the SNDCP layer
shall suspend the transfer of LL‑DATA and may continue the transfer of
LL‑UNITDATA primitives to the LLC SAP to which the LL‑ESTABLISH.request is
sent. Transfer of LL‑DATA primitives shall be resumed when the establishment
procedure has been successfully completed.
The establishment procedure ends through one of the following means:
\- successful (receiving LL‑ESTABLISH.confirm);
\- failure (receiving LL‑RELEASE.indication); or
\- successful following collision resolution (receiving
LL‑ESTABLISH.indication and sending LL‑ESTABLISH.response, see subclause
6.2.1.4).
Upon receipt of an LL‑ESTABLISH.indication primitive, if an SNDCP XID block is
present, the peer SNDCP entity shall respond with an LL‑ESTABLISH.response
primitive. SNDCP XID parameters may be included in an SNDCP XID block in the
LL‑ESTABLISH.response primitive. If no SNDCP XID parameter is to be included,
an empty SNDCP XID block shall be included. If there is no SNDCP XID block in
the LL‑ESTABLISH.indication primitive, the peer SNDCP entity shall not respond
with an LL‑ESTABLISH.response primitive.
Figure 6: SNDCP-initiated establishment / re-establishment
#### 6.2.1.4 Exceptional situations
If the originator of the establishment procedure receives an
LL‑RELEASE.indication with Cause \"DM received\", it shall inform the SM sub-
layer using the SNSM-STATUS.request primitive with Cause \"DM received\". SM
shall then deactivate all PDP contexts for that SAPI requiring acknowledged
peer-to-peer LLC operation.
If the originator of the establishment procedure receives an
LL‑RELEASE.indication with Cause \"invalid XID response\" or an
LL‑STATUS.indication with Cause \"invalid XID response\", then it shall inform
the SM sub-layer using the SNSM-STATUS.request primitive with Cause \"invalid
XID response\". SM shall then deactivate all PDP contexts for that SAPI.
If the originator of the establishment procedure receives an
LL‑RELEASE.indication with Cause \"no peer response\" or an
LL‑STATUS.indication with Cause \"no peer response\", then it shall inform the
SM sub-layer using the SNSM-STATUS.request primitive with Cause \"no peer
response\", wait for an implementation-specific amount of time, and re-invoke
the establishment procedure. Before the establishment procedure is re-invoked,
N‑PDUs arriving at the SNDCP layer for delivery to the LLC layer shall be
buffered, if possible.
If the SNDCP layer receives an LL‑RELEASE.indication with Cause \"normal
release\", it shall buffer, if possible, all downlink N‑PDUs for NSAPIs using
the affected SAPI that requires acknowledged peer-to-peer LLC operation.
Transfer of N‑PDUs for NSAPIs that do not require acknowledged peer-to-peer
LLC operation shall not be affected.
If the originator of the establishment procedure detects a collision
(receiving an LL‑ESTABLISH.indication primitive after sending an
LL‑ESTABLISH.request or LL‑XID.request primitive, or receiving an
LL‑XID.indication primitive after sending an LL‑XID.request primitive), it
shall treat the LL‑ESTABLISH.request or LL‑XID.request primitive sent as not
transmitted, and process the LL‑ESTABLISH.indication or LL‑XID.indication
primitive received. If the LL‑ESTABLISH.request or LL‑XID.request contains one
or more XID parameters, or one or more compression fields in an XID parameter,
or one or more parameters in a compression field, that are not negotiated as
part of the collision resolution, then negotiation of these XID parameters
shall be performed at the earliest opportunity after conclusion of the
collision resolution.
### 6.2.2 Release of acknowledged peer-to-peer LLC operation
#### 6.2.2.1 Release criteria
If acknowledged peer-to-peer LLC operation is established for the SAPI used by
a PDP context that is going to be deactivated or mapped to another SAPI, and
if there is no other NSAPIs that require acknowledged peer-to-peer LLC
operation using the original SAPI, then the SNDCP layer shall initiate the
release procedure.
The SNDCP layer shall initiate the release, using the procedure described in
subclause 6.2.2.2, upon receipt of the SNSM-DEACTIVATE.indication primitive.
The SNDCP layer at the SGSN shall also initiate the release upon receipt of
the SNSM-MODIFY.indication primitive if an existing NSAPI is specified.
#### 6.2.2.2 Release procedure
The SNDCP layer shall initiate the release by sending a LL‑RELEASE.request
primitive to the relevant LLC SAP. The Local parameter shall be set if the
release is the result of receipt of the SNSM-DEACTIVATE.indication primitive,
otherwise it shall not be set.
#### 6.2.2.3 Release initiated by the LLC layer
The LLC layer may initiate release of the acknowledged peer-to-peer LLC
operation for a SAPI under situations described in 3GPP TS 44.064 [6]. The LLC
layer shall inform the SNDCP layers of the release of acknowledged peer-to-
peer LLC operation using the LL‑RELEASE.indication primitive. SNDCP shall
process the LL‑RELEASE.indication primitive as described in subclause 6.2.1.4.
## 6.3 N‑PDU buffering
The N‑PDUs shall be buffered in the SNDCP layer before they are compressed
segmented and transmitted to the LLC layer. The reception of an SNSM-
DEACTIVATE.indication shall trigger the deletion of the buffer for the related
NSAPI.
For acknowledged data transfer, the SNDCP entity shall buffer an N‑PDU until
successful reception of all SN‑PDUs carrying segments of the N‑PDU have been
confirmed. The confirmation is carried out using the LL‑DATA.confirm primitive
from the LLC layer or the SNSM-SEQUENCE.indication primitive from the SM
layer. Buffered N‑PDUs which have been completely received as indicated by the
acknowledgements in an LL‑DATA.confirm primitive shall be discarded. During
the Inter-SGSN RA Update, buffered N‑PDUs whose complete reception by the MS
has been confirmed in the SNSM-SEQUENCE.indication primitive shall be
discarded, as defined in 3GPP TS 29.060 [7] and 3GPP TS 23.060 [3].
For unacknowledged data transfer, the SNDCP shall delete an N‑PDU immediately
after it has been delivered to the LLC layer.
## 6.4 Management of delivery sequence
The SNDCP layer shall retain the delivery sequence of N‑PDUs of each NSAPI
between the peer entities. The delivery sequence of N‑PDUs from different
NSAPIs may be changed according to the QoS profiles.
## 6.5 Protocol control information compression
Protocol control information compression is an optional SNDCP feature except
for Multimedia Broadcast/Multicast Service (MBMS) where the support of ROHC
decompression is mandatory in the MS.
Negotiation of the supported algorithms and their parameters is carried out
between MS and SGSN using the SNDCP XID parameters (see clause 8).
For MBMS, where no negotiation is possible, subclause 6.5.1does not apply.
Compression parameters are pre-configured as defined in subclause 6.5.5.
### 6.5.1 Negotiation of multiple protocol control information compression
types
Each SNDCP entity that supports protocol control information compression shall
be able to negotiate one or several protocol control information compression
entities with the compression field format shown in figure 7. The negotiation
shall be carried out using the XID parameter negotiation specified in
subclause 6.8. The initiating entity defines a set of requested compression
entities, together with the algorithm and parameters for each compression
entity. The set of entities and their algorithms and parameters shall be
transmitted to the peer entity. The peer entity responds with the set of
negotiated entities and their algorithms and parameters. The peer entity shall
select the proposed parameter values or other appropriate values for the
negotiated entities. If more than one protocol control information compression
algorithm for a specific NSAPI is proposed during the XID negotiation then the
receiving peer entity shall only choose one algorithm for that NSAPI.
#### 6.5.1.1 Format of the protocol control information compression field
* * *
Bit 8 7 6 5 4 3 2 1 Octet 1 P X X Entity number  
Octet 2 X X X Algorithm identifier  
Octet 3 Length=n-3  
Octet 4 PCOMP1 PCOMP2  
... ... ...  
Octet x High-order octet  
... ...  
Octet n Low-order octet
* * *
NOTE: The two octets x and x+1, if included, contain the \"Applicable NAPIs\"
parameter (see subclause 7.1.3).
Figure 7: Protocol control information compression field format for SNDCP XID
negotiation
##### 6.5.1.1.1 Spare bit (X)
The X bit shall be set to 0 by the transmitting SNDCP entity and shall be
ignored by the receiving SNDCP entity.
##### 6.5.1.1.2 Propose bit (P)
The P bit shall be set to 1 if a new compression entity is being proposed,
otherwise it shall be set to 0. If the P bit is set to 1, then all octets
shall be included, otherwise octet 2 and octets 4 to x‑1 shall not be
included. If the P bit is set to 1, then only enough number of octets shall be
included to contain the number of PCOMP values needed by the corresponding
compression algorithm (e.g. PCOMP3 and PCOMP4 shall not be included if the
number of PCOMP values needed by a compression algorithm is one or two). If an
odd number of PCOMP values are used by a compression algorithm, then the last
PCOMP value shall be set to 0 in the compression field by the transmitting
SNDCP entity, and it shall be ignored by the receiving SNDCP entity.
##### 6.5.1.1.3 Entity number
The entity number shall be used to identify a protocol control information
compression entity on a SAPI. The entity number shall be assigned using the
following rules:
\- The entity number shall be an integer from 0 to 31.
\- The entity number shall be assigned independently on each of the SAPIs.
\- An entity number shall be in one of the three states: unassigned, selected,
or assigned.
\- When a new compression entity is to be proposed, an unassigned entity
number shall become selected. If there is no unassigned entity number left,
the compression entity shall not be proposed.
\- A selected entity number shall become assigned if the corresponding
proposed compression entity is created as a result of the XID negotiation,
otherwise it shall become unassigned.
\- An assigned entity number shall become unassigned when the corresponding
compression entity is deleted as a result of an XID negotiation, or upon the
receipt of the LL-RESET.indication primitive.
\- In the case of a collision (see subclause 6.2.1.4) in which an entity
number is currently selected:
\- If the selected entity number is included with the P bit set to 0 in the
incoming SNDCP XID block, then it shall be assumed that the peer SNDCP entity
agreed to the creation of the proposed entity but the response was lost.
Therefore the selected entity number shall become assigned, any selected PCOMP
and DCOMP values for the algorithm of the entity shall become assigned, and
the compression entity shall be created, before the incoming SNDCP XID block
is processed. After the incoming SNDCP XID block is processed, the compression
entity shall be negotiated again if necessary, as defined in subclause
6.2.1.4.
\- Otherwise (i.e. if the selected entity number is not included, or is
included with the P bit set to 1 in the incoming SNDCP XID block), the
selected entity number shall become unassigned, and any selected PCOMP and
DCOMP values for the algorithm of the entity shall become unassigned, before
the incoming SNDCP XID block, if any, is processed. Following the collision
resolution procedure, the originally-proposed compression entity shall be
proposed again (i.e. the originally-proposed compression entity shall not be
considered created even if the originally-selected entity number is proposed
in the incoming SNDCP XID block) by sending the appropriate primitive
(LL‑ESTABLISH.request or LL‑XID.request). The originally-selected entity
number, PCOMP and DCOMP values shall be used for the compression entity being
re-proposed if they are unassigned, otherwise a new entity number, PCOMP or
DCOMP value shall be selected.
\- In the case of a collision in which an entity number is currently assigned:
\- If the peer SNDCP entity proposes a new compression entity with the same
entity number, then it shall be assumed that the peer SNDCP entity negotiated
the deletion of the entity but the response was lost, and the entity number is
being reused. Therefore the original compression entity shall be deleted, the
entity number shall become unassigned, PCOMP and DCOMP values shall be
unassigned if necessary (see subclause 6.5.1.1.5), and then the proposed
compression entity shall be responded to as usual.
\- Otherwise (i.e. if the assigned entity number is not included, or is
included with the P bit set to 0 in the incoming SNDCP XID block), the usual
rules regarding collision handling shall apply.
\- In the case of a collision in which a PCOMP or DCOMP value is currently
assigned to a compression algorithm:
\- If the peer SNDCP entity proposes a new compression entity with the same
PCOMP or DCOMP assigned to a different algorithm, then it shall be assumed
that the peer SNDCP entity negotiated the deletion of all entities using the
algorithm to which the PCOMP or DCOMP value was assigned, but the response was
lost, and the PCOMP or DCOMP value is being reused. Therefore, all compression
entities using that algorithm shall be deleted, all corresponding entity
numbers shall become unassigned, and all PCOMP or DCOMP values assigned to the
algorithm shall become unassigned, and then the proposed compression entity
shall be responded to as usual.
\- Otherwise (i.e. if the assigned PCOMP or DCOMP is not included, or is
included and assigned to the same algorithm), the usual rules regarding
collision handling shall apply.
##### 6.5.1.1.4 Algorithm identifier
Table 4 show the list of protocol control information compression algorithms
supported by the SNDCP layer. When new compression algorithms are needed for
SNDCP, table 4 shall be updated.
Table 4: List of protocol control information compression algorithms supported
by SNDCP
* * *
Compression algorithm Algorithm identifier (Range 0 to 31) RFC 1144 0 RFC 2507
1 ROHC 2 \- Other values Reserved
* * *
##### 6.5.1.1.5 PCOMP
One or more PCOMP values shall be assigned dynamically to a compression
algorithm, based on the negotiation of the XID parameters for protocol control
information compression. Each of the assigned PCOMP values denotes one
compressed frame type of that compression algorithm.
The assignment of the PCOMP values follows the following general rules:
\- PCOMP shall be an integer from 0 to 15.
\- PCOMP value 0 is reserved permanently for no compression.
\- PCOMP shall be assigned independently on each of the SAPIs.
\- An assigned PCOMP value applies to all NSAPIs mapped to the same SAPI.
\- PCOMP values shall be assigned to compression algorithms, not to
compression entities (i.e. the same PCOMP value(s) shall be used by different
compression entities on the same SAPI using the same compression algorithm).
\- A PCOMP value shall be in one of the three states: unassigned, selected, or
assigned.
\- When a new compression entity is to be proposed, and if PCOMP values have
not yet been assigned to the corresponding compression algorithm, then the
appropriate number of unassigned PCOMP values shall be selected. If there is
not enough unassigned PCOMP values left, the compression entity shall not be
proposed.
\- A selected PCOMP value shall become assigned if the corresponding proposed
compression entity is created as a result of the XID negotiation, otherwise it
shall become unassigned.
\- An assigned PCOMP value shall become unassigned when the corresponding
compression algorithm is no longer in use by any compression entity, or upon
the receipt of the LL‑RESET.indication primitive.
\- In the case of a collision (see subclause 6.2.1.4), the handling of PCOMP
values shall be in accordance with subclause 6.5.1.1.3.
While transferring data, the compressed frame type for an N‑PDU is conveyed in
the PCOMP field of the SNDCP header of the first SN‑PDU belonging to the
N‑PDU. Any successfully negotiated algorithm may be used for compression of an
N‑PDU.
#### 6.5.1.2 Resetting compression entities following SNDCP XID negotiation
The LL‑Establish primitives shall be used for the negotiation of protocol
control information compression if:
\- one or more parameters, excluding the applicable NSAPIs, of existing
compression entities used with acknowledged peer-to-peer LLC operation are
changed by the originator of the negotiation; or
\- one or more NSAPIs are removed, by the originator of the negotiation, from
existing compression entities used with acknowledged peer-to-peer LLC
operation, except when all NSAPIs using the compression entity are removed, or
when LLC is already in ADM.
Otherwise, either the LL‑Establish primitives or the LL‑XID primitives may be
used.
If the LL‑XID primitives are used for XID negotiation, then in addition to
restrictions specified elsewhere in the present document, the following
parameters of the protocol control information compression entities are non-
negotiable by the responding SNDCP entity:
\- any parameter of existing compression entities used with acknowledged peer-
to-peer LLC operation.
If one or more parameters, other than the applicable NSAPIs, of a compression
entity used with unacknowledged peer-to-peer LLC operation are changed, the
compression entity shall be reset locally upon completion of the SNDCP XID
negotiation.
#### 6.5.1.3 Parameters for compression entities
On negotiating a compression entity, not all the parameters of the entity have
to be specified. If a parameter is to be included, all the preceding
parameters shall also be specified, and the length field shall be set to the
sum of the lengths of all the parameters specified. If any of the parameters
is not specified, the rules in subclause 6.8.2 shall apply.
### 6.5.2 TCP/IP header compression (RFC1144)
The protocol control information compression method is specific for each
network layer protocol type. TCP/IP (IPv4) header compression is specified in
RFC 1144 [9].
#### 6.5.2.1 Parameters
Table 5 contains the parameters defined for a compression entity using TCP/IP
header compression. They may be negotiated during SNDCP XID negotiation.
Table 5: RFC 1144 TCP/IP header compression parameters
* * *
                                                                      **Parameters**
Algorithm Name Algorithm Identifier Length Parameter Name Format Range Sense
of Negotiation Default Value
RFC 1144 0 0, 2 or 3 if P bit is 0,\ Applicable NSAPIs bbbbbbbb bbb00000 0,
32, 64, ... , 65504 down (each bit separately) 0 1, 3 or 4 if P bit is 1.
                                                                      S~0~ - 1            bbbbbbbb            0 through 255            down                         15
* * *
##### 6.5.2.1.1 Applicable NSAPIs
See subclause 7.1.3.
##### 6.5.2.1.2 S~0~
The number of state slots, as defined in [9]. The S~0~ range is 1 through 256,
with 16 as default value.
#### 6.5.2.2 Assignment of PCOMP values
The underlying service shall be able to distinguish the three types of
compressed N‑PDUs (i.e. Type IP, Uncompressed TCP, and Compressed TCP), as
defined in RFC 1144 [9]. These three N‑PDU types are differentiated by using
different PCOMP values.
Two PCOMP values shall be assigned to the TCP/IP header compression algorithm.
PCOMP1 shall contain the PCOMP value for the frame type \"Uncompressed TCP\",
and PCOMP2 shall contain the PCOMP value for the frame type \"Compressed
TCP\".
The PCOMP value of 0 shall be used for the frame type \"Type IP\".
#### 6.5.2.3 Error Recovery
When TCP/IP header compression is used with unacknowledged peer-to-peer LLC
operation, the decompression entity shall be notified in case an N‑PDU is
dropped, so that error recovery procedure (see RFC 1144 [9]) can be invoked.
### 6.5.3 TCP/IP and UDP/IP header compression (RFC 2507)
Detailed operation of the RFC 2507 header compression for IPv4 and IPv6 is
described in clause 3 of the IETF specification RFC 2507 [10].
#### 6.5.3.1 Parameters
Table 6 contains the parameters defined for a compression entity using RFC2507
header compression. They may be negotiated during SNDCP XID negotiation.
Table 6: RFC 2507 TCP/IP and UDP/IP header compression parameters
+-------+-------+-------+-------+-------+-------+-------+-------+ | | | | Param | | | | | | | | | eters | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Algo | Algo | L | Para | F | Range | Sense | De | | rithm | rithm | ength | meter | ormat | | of | fault | | Name | Ident | | Name | | | N | Value | | | ifier | | | | | egoti | | | | | | | | | ation | | +-------+-------+-------+-------+-------+-------+-------+-------+ | RFC | 1 | 0, 2, | Appli | bbb | 0, | down | 0 | | 2507 | | 4, 5, | cable | bbbbb | 32, | (each | | | | | 6, 7 | N | bbb | 64, | bit | | | | | or 9 | SAPIs | 00000 | ... , | s | | | | | if P | | | 65504 | epara | | | | | bit | | | | tely) | | | | | is 0, | | | | | | | | | | | | | | | | | | 3, 5, | | | | | | | | | 7, 8, | | | | | | | | | 9, 10 | | | | | | | | | or 12 | | | | | | | | | if P | | | | | | | | | bit | | | | | | | | | is 1. | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | F_M | bbb | 1- | down | 256 | | | | | AX_P | bbbbb | 65535 | | | | | | | ERIOD | | | | | | | | | | bbb | | | | | | | | | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | F\ | bbb | 1-255 | down | 5 | | | | | _MAX\ | bbbbb | | | | | | | | _TIME | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | M | bbb | 6 | down | 168 | | | | | AX_H | bbbbb | 0-255 | | | | | | | EADER | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | TCP_ | bbb | 3-255 | down | 15 | | | | | SPACE | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | NON_ | bbb | 3- | down | 15 | | | | | TCP_ | bbbbb | 65535 | | | | | | | SPACE | | | | | | | | | | bbb | | | | | | | | | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+
The explanation of the individual parameters can be found in the clause 14 of
the IETF specification RFC 2507 [10].
##### 6.5.3.1.1 Applicable NSAPIs
See subclause 7.1.3.
#### 6.5.3.2 Assignment of PCOMP values for RFC2507
The following PCOMP values shall be assigned to the RFC 2507 header
compression. The PCOMP value 0 shall be used for regular IPv4 and IPv6
packets.
Table 7: PCOMP values assigned to RFC 2507 header compression algorithm
* * *
PID value Packet type PCOMP1 Full header PCOMP2 Compressed TCP PCOMP3
Compressed TCP non-delta PCOMP4 Compressed non-TCP PCOMP5 Context state
* * *
#### 6.5.3.3 Error Recovery
The mechanisms related to error recovery and packet reordering are described
in clauses 10 and 11 of the RFC 2507[10].
### 6.5.4 Robust Header Compression (ROHC)
Robust Header Compression (ROHC) is a framework for header compression, on top
of which compression schemes can be defined for the compression of various
protocol headers. Both the SNDCP ROHC negotiation mechanisms and the SN-PDU
ROHC identifiers are generally defined for the ROHC framework, and therefore
capable of handling both existing and future ROHC compression protocols
(profiles). RFC 5795 [12] defines the ROHC framework, as well as the
compression schemes and profiles for RTP/UDP/IP, UDP/IP, ESP/IP and
uncompressed.
#### 6.5.4.1 Parameters
Table 10 contains the parameters defined for a compression entity using ROHC.
They may be negotiated during SNDCP XID negotiation.
Table 10: Robust Header Compression (ROHC) parameters
+-------+-------+-------+-------+-------+-------+-------+-------+ | | | | Param | | | | | | | | | eters | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Algo | Algo | L | Para | F | Range | Sense | De | | rithm | rithm | ength | meter | ormat | | of | fault | | Name | Ident | | Name | | | N | Value | | | ifier | | | | | egoti | | | | | | | | | ation | | +-------+-------+-------+-------+-------+-------+-------+-------+ | ROHC | 2 | 0, 2, | Appli | bbb | 0, | down | 0 | | | | 4, 6, | cable | bbbbb | 32, | (each | | | | | 8, | N | bbb | 64, | bit | | | | | 8 | SAPIs | 00000 | ... , | s | | | | | +n*2 | | | 65504 | epara | | | | | if P | | | | tely) | | | | | bit | | | | | | | | | is 0, | | | | | | | | | | | | | | | | | | 1, 3, | | | | | | | | | 5, 7, | | | | | | | | | 9, | | | | | | | | | 9 | | | | | | | | | +n*2 | | | | | | | | | if P | | | | | | | | | bit | | | | | | | | | is 1. | | | | | | | | | | | | | | | | | | ( | | | | | | | | | where | | | | | | | | | n is | | | | | | | | | the | | | | | | | | | n | | | | | | | | | umber | | | | | | | | | of | | | | | | | | | prof | | | | | | | | | iles, | | | | | | | | | the | | | | | | | | | max. | | | | | | | | | n | | | | | | | | | umber | | | | | | | | | of | | | | | | | | | pro | | | | | | | | | files | | | | | | | | | is | | | | | | | | | 16) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | MAX | 00b | 0- | down | 15 | | | | | _CID | bbbbb | 16383 | | | | | | | | | | | | | | | | | bbb | | | | | | | | | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | M | 000 | 6 | down | 168 | | | | | AX_H | 00000 | 0-255 | | | | | | | EADER | bbb | | | | | | | | | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | PR | bbbb | 0- | (see | 0 | | | | | OFILE | bbbb\ | 65535 | 6.5.4 | | | | | | 1 | bbb | | .1.5) | | | | | | | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | PR | bbbb | 0- | (see | 0 | | | | | OFILE | bbbb\ | 65535 | 6.5.4 | | | | | | 2 | bbb | | .1.5) | | | | | | | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | ... | ... | ... | ... | ... | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | PR | bbbb | 0- | (see | 0 | | | | | OFILE | bbbb\ | 65535 | 6.5.4 | | | | | | 16 | bbb | | .1.5) | | | | | | | bbbbb | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | NOTE: | | | | | | | | | ROHC | | | | | | | | | para | | | | | | | | | meter | | | | | | | | | MRRU | | | | | | | | | is | | | | | | | | | not | | | | | | | | | negot | | | | | | | | | iated | | | | | | | | | and | | | | | | | | | shall | | | | | | | | | be | | | | | | | | | set | | | | | | | | | to 0, | | | | | | | | | i.e. | | | | | | | | | ROHC | | | | | | | | | se | | | | | | | | | gment | | | | | | | | | ation | | | | | | | | | shall | | | | | | | | | not | | | | | | | | | be | | | | | | | | | used. | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+
##### 6.5.4.1.1 Applicable NSAPIs
See subclause 7.1.3.
##### 6.5.4.1.2 MAX_CID
The MAX_CID parameter indicates the maximum context ID number the compressor
is allowed to use. A MAX_CID value of N means CID values of 0 through N are
valid. Thus, the number of contexts allowed is N+1, e.g. MAX_CID of 15 means
16 contexts are allowed.
##### 6.5.4.1.3 MAX_HEADER
The MAX_HEADER parameter indicates the maximum number of octets of the
protocol control information that may be compressed.
NOTE: The MAX_HEADER parameter is neither defined nor used by RTP/UDP/IP,
UDP/IP, ESP/IP and uncompressed profiles as defined in RFC 5795 [12]. For
those profiles, this parameter is not used by SNDCP when performing Robust
Header Compression (ROHC).
##### 6.5.4.1.4 (Void)
##### 6.5.4.1.5 PROFILE
The PROFILE parameter indicates the profile identifier. A list of up to 16
PROFILEs, indicating which ROHC profiles [14] are supported may be included.
The negotiated list which is used for compression consists of the list of
profiles supported by both peer entities, reduced to include at most ONE
profile identifier with the same 8-bit LSB part. If both peer entities support
more than one profile with the same 8-bit LSB part in its profile identifier,
the set of these profiles shall be reduced to the profile with the highest
MSB-value in its profile identifier.
Note: The reason for this is that the 8-bit MSB part of the profile identifier
indicates the \"variant\" of the profile, and since only the 8-bit LSB part is
sent in compressed headers, the set of available profiles must not include two
profiles with the same 8-bit LSB part of the profile identifier.
#### 6.5.4.2 Assignment of PCOMP values for ROHC
As opposed to other header compression schemes, the whole ROHC framework has
only one packet type that has to be identified by the PDU format, and this
packet type can be used by any ROHC compression profile. However, ROHC has two
different context identification (CID) sizes. To avoid having to negotiate and
potentially re-negotiate CID size, the mechanism from ROHC-over-PPP [13] is
adopted in SNDCP, i.e. as shown in table 9, two packet types are defined for
ROHC, one for small and one for large CIDs.
This implies that all CIDs within one ROHC packet shall be of the same size as
indicated by the PID value, either small or large. In particular, embedded
feedback shall have a CID of the same size as indicated by the PID value. For
piggybacking feedback, a compressor must be able to control the feedback CID
size used by the associated decompressor, ensure that all CIDs are of the same
size, and indicate this size with the appropriate PID value.
Table 9: PCOMP values assigned to Robust Header Compression (ROHC)
* * *
PID value Packet type PCOMP1 ROHC small-CIDs PCOMP2 ROHC large-CIDs
* * *
#### 6.5.4.3 Error Recovery and other feedback
ROHC has built-in robustness mechanisms to avoid error events, as well as
error recovery mechanisms using decompressor to compressor feedback. Such ROHC
feedback is carried according to alternative 6) in section 5.2.1 of RFC 5795
[12].
### 6.5.5 Pre-defined Protocol control information ROHC compression types for
MBMS
An SGSNsupporting compression for MBMS shall not negotiate compression
information with the MSes. An MS which is capable of MBMS shall support pre-
defined compression types and associated configuration information.
An SNDCP entity performing Robust Header Compression (ROHC) for MBMS data
traffic shall use the following parameter values:
\- Only Unidirectional mode (U-mode) as defined in RFC 5795 [12] shall be
used.
\- Only profiles for RTP/UDP/IP, UDP/IP and uncompressed as specified in RFC
5795 [12] shall be used.
\- Applicable NSAPI = 1.
\- MAX_CID set to 511 (i.e. 512 contexts are allowed). The MS shall handle
CIDs in the value range of 0 to 511 as used by the SGSN. However, the maximum
number of ROHC decompressor contexts the MS simultaneously supports is
implementation specific.
The SNDCP PCOMP values assigned to ROHC for MBMS are preconfigured to PCOMP =
0 which indicates that header compression is not used, PCOMP = 1: ROHC small-
CIDs, and PCOMP = 2: ROHC large-CIDs.
MAX_CID, and PCOMP parameters are described in subclauses 6.5.4.1.2 and
6.5.4.2, respectively.
If decompression fails, e.g. due to a cell change, the MS shall reconfigure
and re-initialise the SNDCP entity, reusing the static part of the header
decompressor context previously used. Also, after receiving an IR-DYN or IR
packet (see RFC 5795 [12]), the MS shall re-initialise header
decompression~~.~~
The compressor entity in the SGSN shall periodically transit to lower
compression states in order for the decompressor entities in the MSes to
synchronise with the compressor. For further details about this mechanism,
please refer to RFC 5795 [12].
## 6.6 Data compression
Data compression is an optional SNDCP feature. Data compression applies to
both SN‑DATA and SN‑UNITDATA primitives.
Data compression, if used, shall be performed on the entire N‑PDU, including
the possibly compressed protocol control information.
Figure 8 shows an example how the SNDCP functions may be used. Several NSAPIs
may use a common data compression entity, i.e. the same compression algorithm
and the same dictionary. Separate data compression entities shall be used for
acknowledged (SN‑DATA) and unacknowledged (SN‑UNITDATA) data transfer. Several
NSAPIs may be associated with one SAPI, i.e. they may use the same QoS
profile.
Figure 8: An example for the usage of NSAPIs, SNDCP functions, and SAPIs
### 6.6.1 Negotiation of multiple data compression types
Each SNDCP entity that supports data compression shall be able to negotiate
one or several data compression entities with the compression field format
shown in figure 9. The negotiation shall be carried out using the XID
parameter negotiation specified in subclause 6.8. The initiating entity
defines a set of requested compression entities, together with the algorithm
and parameters for each compression entity. The set of entities and their
algorithms and parameters shall be transmitted to the peer entity. The peer
entity responds with the set of negotiated entities and their algorithms and
parameters. The peer entity shall select the proposed parameter values or
other appropriate values for the negotiated entities. If more than one data
compression algorithm for a specific NSAPI is proposed during the XID
negotiation then the receiving peer entity shall only choose one algorithm for
that NSAPI.
#### 6.6.1.1 Format of the data compression field
* * *
Bit 8 7 6 5 4 3 2 1 Octet 1 P X X Entity number  
Octet 2 X X X Algorithm identifier  
Octet 3 Length=n-3  
Octet 4 DCOMP1 DCOMP2  
... ... ...  
Octet x High-order octet  
... ...  
Octet n Low-order octet
* * *
NOTE: The two octets x and x+1, if included, contain the \"Applicable NAPIs\"
parameter (see subclause 7.1.3).
Figure 9: Data compression field format for SNDCP XID negotiation
##### 6.6.1.1.1 Spare bit (X)
The X bit shall be set to 0 by the transmitting SNDCP entity and shall be
ignored by the receiving SNDCP entity.
##### 6.6.1.1.2 Propose bit (P)
The P bit shall be set to 1 if a new compression entity is being proposed,
otherwise it shall be set to 0. If the P bit is set to 1, then all octets
shall be included, otherwise octet 2 and octets 4 to x-1 shall not be
included. If the P bit is set to 1, then only enough number of octets shall be
included to contain the number of DCOMP values needed by the corresponding
compression algorithm (e.g. DCOMP3 and DCOMP4 shall not be included if the
number of DCOMP values needed by a compression algorithm is one or two). If an
odd number of DCOMP values are used by a compression algorithm, then the last
DCOMP value shall be set to 0 in the compression field by the transmitting
SNDCP entity, and it shall be ignored by the receiving SNDCP entity.
##### 6.6.1.1.3 Entity number
The entity number shall be used to identify a data compression entity on a
SAPI. See subclause 6.5.1.1.3 for the rules for assigning entity numbers. The
assignment of entity numbers for protocol control information compression
entities and data compression entities shall be independent.
##### 6.6.1.1.4 Algorithm identifier
Table 6a shows the list of data compression algorithms supported by the SNDCP
layer. When new compression algorithms are needed for SNDCP, table 6a shall be
updated.
Table 6a: List of data compression algorithms supported by SNDCP
+----------------------------+-----------------------+ | Data compression algorithm | Algorithm identifier | | | | | | (Range 0-31) | +----------------------------+-----------------------+ | V.42 bis | 0 | +----------------------------+-----------------------+ | V.44 | 1 | +----------------------------+-----------------------+ | - | Other values Reserved | +----------------------------+-----------------------+
##### 6.6.1.1.5 DCOMP
One or more DCOMP values shall be assigned dynamically to a compression
algorithm, based on the negotiation of the XID parameters for data
compression. Each of the assigned DCOMP values denotes one compressed frame
type of that compression algorithm.
The assignment of the DCOMP values shall follow the rules for the assignment
of PCOMP values in subclause 6.5.1.1.5.
While transferring data, the compressed frame type for an N‑PDU is conveyed in
the DCOMP field of the SNDCP header of the first SN‑PDU belonging to the
N‑PDU. Any successfully negotiated algorithm may be used for compression of an
N‑PDU.
#### 6.6.1.2 Resetting compression entities following SNDCP XID negotiation
The LL‑Establish primitives shall be used for the negotiation of data
compression if:
\- one or more parameters, excluding the applicable NSAPIs, of existing
compression entities used with acknowledged peer-to-peer LLC operation are
changed by the originator of the negotiation; or
\- one or more NSAPIs are removed, by the originator of the negotiation, from
existing compression entities used with acknowledged peer-to-peer LLC
operation, except when all NSAPIs using the compression entity are removed, or
when LLC is already in ADM.
Otherwise, either the LL‑Establish primitives or the LL‑XID primitives may be
used.
If the LL‑XID primitives are used for XID negotiation, then in addition to
restrictions specified elsewhere in the present document, the following
parameters of the data compression entities are non-negotiable by the
responding SNDCP entity:
\- any parameter of existing compression entities used with acknowledged peer-
to-peer LLC operation.
If one or more parameters, other than the applicable NSAPIs, of a compression
entity used with unacknowledged peer-to-peer LLC operation are changed, the
compression entity shall be reset locally upon completion of the SNDCP XID
negotiation.
#### 6.6.1.3 Parameters for compression entities
On negotiating a compression entity, not all the parameters of the entity have
to be specified. If a parameter is to be included, all the preceding
parameters shall also be specified, and the length field shall be set to the
sum of the lengths of all the parameters specified. If any of the parameters
is not specified, the rules in subclause 6.8.2 shall apply.
### 6.6.2 Management of V.42 bis data compression
ITU‑T Recommendation V.42 bis [8] data compression may be used with SN‑DATA
primitives and SN‑UNITDATA primitives.
#### 6.6.2.1 Parameters
Table 7a contains the parameters defined for a compression entity using ITU-T
Recommendation V.42 bis data compression. They may be negotiated during SNDCP
XID negotiation.
Table 7a: V.42 bis data compression parameters
* * *
                                                                             **Parameters**
Algorithm Name Algorithm Identifier Length Parameter Name Format Range Sense
of Negotiation Default Value
V.42 bis 0 0, 2, 3, 5, or 6 if P bit is 0,\ Applicable NSAPIs bbbbbbbb
bbb00000 0, 32, 64, ... , 65504 down (each bit separately) 0 1, 3, 4, 6, or 7
if P bit is 1.
                                                                             P0                  000000bb            0 through 3              down (each direction separately)   3
                                                                             P1                  bbbbbbbb bbbbbbbb   512 through 65535        down                               2048
                                                                             P2                  bbbbbbbb            6 through 250            down                               20
* * *
##### 6.6.2.1.1 Applicable NSAPIs
See subclause 7.1.3.
##### 6.6.2.1.2 P0
Two bits are used to indicate the usage of compression, one bit for each
direction.
00 compress neither direction.
01 compress MS-to-SGSN direction only.
10 compress SGSN‑to-MS direction only.
11 compress both directions.
##### 6.6.2.1.3 P1
Maximum number of codewords in the compressor dictionary (see [8]).
##### 6.6.2.1.4 P2
Maximum number of characters in an uncompressed data string that is accepted
to be encoded.
#### 6.6.2.2 Assignment of DCOMP values
One DCOMP value shall be assigned (as DCOMP1) to the V.42 bis data compression
algorithm.
#### 6.6.2.3 Operation of V.42 bis data compression
When V.42 bis is used with SN‑DATA primitives, the data in the compression
entity shall be flushed (using the C‑FLUSH primitive defined in [8]) and added
to the compressed N‑PDU before the compressed N‑PDU is sent.
When V.42 bis is used with SN‑UNITDATA primitives, the compression entity
shall be reset (using the C‑INIT primitive defined in [8]) before an N‑PDU is
compressed or decompressed. After compression, the data in the compression
entity shall be flushed (using the C‑FLUSH primitive defined in [8]) and added
to the compressed N‑PDU before the compressed N‑PDU is sent. The LLC protocol
shall operate in the protected mode of operation.
When V.42 bis is used with SN‑DATA primitives and an error is detected by the
decoder, the SNDCP entity shall use LL‑ESTABLISH.request primitive to reset
the acknowledged peer-to-peer LLC operation for the SAPI used.
### 6.6.3 Management of V.44 data compression
ITU‑T Recommendation V.44 data compression, as described in [11], may be used
with SN‑DATA primitives and SN‑UNITDATA primitives. Annex B of ITU-T
Recommendation V.44 describes two methods of implementation and operation of
V.44 in packet networks: Packet Method and Multi-Packet Method. Multi-Packet
Method is a superset of Packet Method and an MS or SGSN that supports Multi-
Packet Method must also support Packet Method.
#### 6.6.3.1 Parameters
Table 7c contains the parameters defined for a compression entity using V.44
data compression. They may be negotiated during SNDCP XID negotiation. During
V.44 data compression negotiation, unless both the MS and SGSN support Multi-
Packet Method, Packet Method is used. Parameter C0 indicates support of Packet
Method (10000000) or both methods (11000000).
NOTE 1: V.44 data compression negotiation is not required. If V.44 is selected
and no compression parameters are specified, then Packet Method with defaults
as defined in subclauses 6.6.3.1.4 and 6.6.3.1.5 and in [11] annex B, clause
B.1.2, is used.
Table 7c: V.44 data compression parameters
+-------+-------+-------+-------+-------+-------+-------+-------+ | | | | **Pa | | | | | | | | | ramet | | | | | | | | | ers** | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Algo | Algo | L | Para | F | Range | Sense | De | | rithm | rithm | ength | meter | ormat | | of | fault | | Name | Ident | | Name | | | N | Value | | | ifier | | | | | egoti | | | | | | | | | ation | | +-------+-------+-------+-------+-------+-------+-------+-------+ | V.44 | 1 | 0, 2, | Appli | bbb | 0, | down | 0 | | | | 3, 4, | cable | bbbbb | 32, | (each | | | | | 6, 8, | N | bbb | 64, | bit | | | | | 10, | SAPIs | 00000 | ... , | s | | | | | or 12 | | | 65504 | epara | | | | | if P | | | | tely) | | | | | bit | | | | | | | | | is 0, | | | | | | | | | 1, 3, | | | | | | | | | 4, 5, | | | | | | | | | 7, 9, | | | | | | | | | 11, | | | | | | | | | or 13 | | | | | | | | | if P | | | | | | | | | bit | | | | | | | | | is 1 | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | C0 | bb0 | 100 | 110 | 100 | | | | | | 00000 | 00000 | 00000 | 00000 | | | | | | | or | down | | | | | | | | | to | | | | | | | | 110 | | | | | | | | | 00000 | 100 | | | | | | | | | 00000 | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | P0 | 000 | 0 | down | 3 | | | | | | 000bb | th | (each | | | | | | | | rough | dire | | | | | | | | 3 | ction | | | | | | | | | s | | | | | | | | | epara | | | | | | | | | tely) | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | P1T | bbb | 256 | down | Refer | | | | | | bbbbb | th | | to | | | | | | bbb | rough | | subc | | | | | | bbbbb | 65535 | | lause | | | | | | | | | 6.6. | | | | | | | | | 3.1.4 | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | P1R | bbb | 256 | down | Refer | | | | | | bbbbb | th | | to | | | | | | bbb | rough | | subc | | | | | | bbbbb | 65535 | | lause | | | | | | | | | 6.6. | | | | | | | | | 3.1.5 | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | P3T | bbb | [≥ | down | 3 x | | | | | | bbbbb | (]{.s | | P1T | | | | | | | mallc | | | | | | | | bbb | aps}2 | | | | | | | | bbbbb | x | | | | | | | | | P1T) | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | P3R | bbb | [≥ | down | 3 x | | | | | | bbbbb | (]{.s | | P1R | | | | | | | mallc | | | | | | | | bbb | aps}2 | | | | | | | | bbbbb | x | | | | | | | | | P1R) | | | +-------+-------+-------+-------+-------+-------+-------+-------+
NOTE 2: V.44 parameters P2T and P2R are set to 255 and not negotiated in
packet networks.
##### 6.6.3.1.1 Applicable NSAPIs
See subclause 7.1.3.
##### 6.6.3.1.2 C0
Two bits are used to indicate the V.44 method of operation supported (refer to
[11] Annex B).
10 Packet Method supported.
11 Packet Method and Multi-Packet Method supported.
If parameter C0 is not specified then Packet Method is selected with its
default parameter values (refer to subclauses 6.6.3.1.4 and 6.6.3.1.5 and in
[11] annex B, clause B.1.2).
##### 6.6.3.1.3 P0
Two bits are used to indicate the usage of compression, one bit for each
direction.
00 compress neither direction.
01 compress MS-to-SGSN direction only.
10 compress SGSN‑to-MS direction only.
11 compress both directions.
##### 6.6.3.1.4 P1T
Maximum number of codewords for the transmit direction (i.e. in the encoder
dictionary). Refer to ITU-T Recommendation V.44 [11].
The Packet Method default is 1 600 codewords.
The Multi-Packet Method default is 2 048 codewords.
NOTE: Both defaults above are different from the defaults specified in ITU-T
Recommendation V.44 [11] annex B. This is partially due to the fact that data
compression in SNDCP includes the control header as well as the information
field.
##### 6.6.3.1.5 P1R
Maximum number of codewords for the receive direction (i.e. in the decoder
dictionary). Refer to [11].
The Packet Method default is 1 600 codewords.
The Multi-Packet Method default is 2 048 codewords.
NOTE: Both defaults above are different from the defaults specified in ITU-T
Recommendation V.44 [11] annex B. This is partially due to the fact that data
compression in SNDCP includes the control header as well as the information
field.
##### 6.6.3.1.6 P3T
Number of characters in the history for the transmit direction. Refer to [11].
This parameter is not used in Packet Method.
##### 6.6.3.1.7 P3R
Number of characters in the history for the receive direction. Refer to [11].
This parameter is not used in Packet Method.
#### 6.6.3.2 Assignment of DCOMP values
The underlying service shall be able to distinguish three types of N‑PDUs
processed by V.44 data compression (i.e. not V.44 compressed, V.44 Packet
Method compressed, and V.44 Multi-Packet Method compressed). These three V.44
processed N‑PDU types are differentiated by using different DCOMP values.
Two DCOMP values shall be assigned to the V.44 compression algorithm, the
smaller one of which for Packet Method compressed, and the larger one for
Multi-Packet Method compressed.
The DCOMP value of 0 shall be used for SN‑PDUs belonging to N‑PDUs that
expanded during V.44 compression and are sent in their original form (i.e. not
V.44 compressed).
#### 6.6.3.3 Operation of V.44 data compression
V.44 data compression has two possible methods of operation in SNDCP, Packet
Method and Multi-Packet Method.
##### 6.6.3.3.1 Packet Method
Refer to [11] annex B, clause B.1, for a general description of the operation
of V.44 packet method.
When V.44 Packet Method is used with SN‑DATA primitives:
\- the data in the compression entity shall be flushed (using the C-FLUSH
primitive defined in [11]) after the last character of an N‑PDU is passed to
the encoder.
\- If the length of the N-PDU after compression is greater or equal to the
length of the original N-PDU, the original N-PDU is sent and the DCOMP field
in the SN-PDU header of the first segment of the N-PDU is set to 0, not V.44
compressed.
\- In between processing of N-PDU, the dictionary shall be re-initialised as
defined in [11].
\- If an error is detected by the decoder, the SNDCP entity shall use
LL‑ESTABLISH.request primitive to reset the acknowledged peer-to-peer LLC
operation for the SAPI used.
When V.44 Packet Method is used with SN‑UNITDATA primitives:
\- the data in the compression entity shall be flushed (using the C-FLUSH
primitive defined in [11]) after the last character of an N‑PDU is passed to
the encoder.
\- If the length of the N-PDU after compression is greater or equal to the
length of the original N-PDU, the original N-PDU is sent and the DCOMP field
in the SN-PDU header of the first segment of the N-PDU is set to 0, not V.44
compressed.
\- After an N-PDU is sent, the dictionary shall be re-initialised as defined
in [11].
\- The LLC protocol shall operate in the protected mode of operation.
##### 6.6.3.3.2 Multi-Packet Method
Refer to [11] annex B, clause B.2, for a general description of the operation
of V.44 multi-packet method.
When V.44 Multi-Packet Method is used with SN‑DATA primitive:
\- the data in the compression entity shall be flushed (using the C-FLUSH
primitive defined in [11]) after the last character of an N‑PDU is passed to
the encoder.
\- If the length of the N-PDU after compression is greater than the length of
the original N-PDU, the original N-PDU is sent and the DCOMP field in the SN-
PDU header of the first segment of the N-PDU is set to 0, not V.44 compressed.
\- In the case above of not V.44 compressed where the original N-PDU is sent,
after the N-PDU is sent the encoder dictionary shall be re-initialised as
defined in [11]. The peer entity, upon receipt of an N-PDU with the DCOMP
field set to 0, not V.44 compressed, shall re-initialise its decoder
dictionary.
\- If an error is detected by the decoder, the SNDCP entity shall use
LL‑ESTABLISH.request primitive to reset the acknowledged peer-to-peer LLC
operation for the SAPI used.
When V.44 Multi-Packet Method is used with SN‑UNITDATA primitives:
\- the data in the compression entity shall be flushed (using the C-FLUSH
primitive defined in [11]) after the last character of an N‑PDU is passed to
the encoder.
\- After an N‑PDU is sent the dictionary shall be re-initialised as defined in
[11].
\- If the length of the N-PDU after compression is greater or equal to the
length of the original N-PDU, the original N-PDU is sent and the DCOMP field
in the SN-PDU header of the first segment of the N-PDU is set to 0, not V.44
compressed.
\- The LLC protocol shall operate in the protected mode of operation.
## 6.7 Segmentation and reassembly
Segmentation shall be performed by the SNDCP entity to ensure that any SN‑PDU
transmitted is no longer than N201 (no longer than (N201-U -- 4), if integrity
protection is used) (see 3GPP TS 44.064 [6]). The receiving SNDCP entity shall
reassemble the segments back to the original (possibly compressed) N‑PDU.
The segmentation and reassembly procedures are different for acknowledged and
unacknowledged mode of operation.
### 6.7.1 General
#### 6.7.1.1 Segmentation
A (possibly compressed) N‑PDU shall be segmented into one or more SN‑PDUs. The
length of each SN‑PDU shall not be greater than N201-I (for acknowledged mode)
or N201-U (N201-U -- 4, if integrity protection is used) (for unacknowledged
mode).
The F bit in the SNDCP header shall be set to 1 for the first segment, and 0
for all subsequent segments.
For unacknowledged peer-to-peer LLC operation, DCOMP and PCOMP shall be
included in the header when the F bit is set to 1, and shall not be included
when the F bit is set to 0.
For acknowledged peer-to-peer LLC operation, DCOMP, PCOMP and N‑PDU number
shall be included in the header when the F bit is set to 1, and shall not be
included when the F bit is set to 0.
If an SN‑PDU is received with the F bit set to 1 when a non-first segment is
expected, and if DCOMP, PCOMP and (in the acknowledged mode) the N‑PDU number
all remain unchanged comparing to the first segment, then the SN‑PDU shall be
processed as normal.
The M bit in the SNDCP header shall be set to 0 for the last segment, and 1
for all previous segments.
If only one SN‑PDU is generated for an N‑PDU, the F bit shall be set to 1 and
the M bit set to 0.
#### 6.7.1.2 Reassembly
During reassembly, DCOMP and PCOMP for an N‑PDU shall be retrieved from the
first segment (F bit set to 1). For acknowledged peer-to-peer LLC operation,
the N‑PDU number shall also be retrieved from the first segment.
The receiving SNDCP entity shall be in one of the following three receiving
states:
\- the Receive First Segment state, in which the SNDCP entity shall expect the
F bit set to 1 in the next received SN‑PDU;
\- the Receive Subsequent Segment state, in which the SNDCP entity shall
expect the F bit set to 0 in the next received SN‑PDU; or
\- the Discard state, in which the SNDCP entity shall discard any SN‑PDU
received.
The Receive First Segment state shall be entered:
\- upon receipt of an SNSM-ACTIVATE.indication;
\- upon receipt of an SNSM-MODIFY.indication which indicates a change in SAPI
or a change in peer-to-peer LLC operation mode;
\- upon receipt of an LL‑ESTABLISH.indication or an LL‑ESTABLISH.confirm; or
\- when the M bit is set to 0 in the received SN‑PDU, except for situations
specified in subclause 6.7.4.
The Receive Subsequent Segment state shall be entered:
\- when the M bit is set to 1 in the received SN‑PDU, except for situations
specified in subclause 6.7.4.
### 6.7.2 Segmentation and reassembly in acknowledged mode
Segmentation and reassembly in acknowledged mode shall follow the general
procedures stated in subclause 6.7.1.
### 6.7.3 Segmentation and reassembly in unacknowledged mode
In addition to the general procedure in subclause 6.7.1, a segment number
shall be used due to the unreliable nature of the unacknowledged mode.
The Segment number is a sequence number assigned to each SN‑UNITDATA PDU. The
sequence number shall be set to 0 in the first SN‑UNITDATA PDU of an N‑PDU,
and incremented by 1 for each subsequent SN‑UNITDATA PDU. Modulo 16 operation
is applied.
The received segments belonging to the same N‑PDU shall be re-ordered, if
possible. If a timer (implementation dependent) elapses before all segments
are received, the segments shall be discarded. Reassembly operation described
in subclauses 6.7.1 and 6.7.4 shall be performed after re-ordering.
### 6.7.4 Exception situations
#### 6.7.4.1 Receive First Segment state
If an SN‑UNITDATA PDU is received with the F bit set to 0, the SN‑UNITDATA PDU
shall be discarded. The Receive First Segment state shall be entered if the M
bit is set to 0, otherwise the Discard state shall be entered.
If an SN‑DATA PDU is received with the F bit set to 0, the SN‑DATA PDU shall
be discarded, and the acknowledged LLC operation shall be re-established for
the SAPI used.
#### 6.7.4.2 Receive Subsequent Segment state
If an SN‑UNITDATA PDU is received with the F bit set to 1, and if DCOMP or
PCOMP is different from those in the first segment, then the SN‑UNITDATA PDU
and all previous segments belonging to the same N‑PDU shall be discarded. The
Received First Segment state shall be entered if the M bit is set to 0,
otherwise the Discard state shall be entered.
If an SN‑DATA PDU is received with the F bit set to 1, and if DCOMP, PCOMP or
N‑PDU number is different from those in the first segment, then the SN‑DATA
PDU and all previous segments belonging to the same N‑PDU shall be discarded,
and the acknowledged LLC operation shall be re-established for the SAPI used.
#### 6.7.4.3 Discard state
If an SN‑PDU is received with the M bit set to 1, the SN‑PDU shall be
discarded and the SNDCP entity shall remain in the Discard state.
If an SN‑PDU is received with the M bit set to 0, the SN‑PDU shall be
discarded and the Receive First Segment state entered.
## 6.8 XID parameter negotiation
Negotiation of XID parameters between peer SNDCP entities may be carried out
to ensure optimal information transfer. The parameters are called SNDCP
exchange identity (XID) parameters.
SNDCP XID parameter negotiation may be initiated by the SNDCP entity at the MS
or at the SGSN. The MS shall initiate SNDCP XID negotiation upon receipt of
SNSM-ACTIVATE.indication, if SNDCP XID parameters are to be changed. The SGSN
shall initiate SNDCP XID negotiation upon receipt of the SNSM-
MODIFY.indication primitive if an NSAPI has been put into use (in the case of
an Inter-SGSN Routeing Area Update), or if the change in QoS profile to an
existing NSAPI results in a change in compressor(s) used by the NSAPI.
When an NSAPI no longer uses a compression entity due to a PDP context
deactivation or a PDP context modification, an SNDCP XID negotiation shall be
performed to remove the NSAPI from the Applicable NSAPIs of the compression
entity. The negotiation shall be initiated by the MS upon receipt of the SNSM-
DEACTIVATE.indication with XID Negotiation Indicator in the case of explicit
PDP context deactivation by peer-to-peer signalling between the SM entities.
The negotiation shall be initiated by the SGSN upon receipt of the SNSM-
MODIFY.indication in the case of PDP context modification. If a PDP context is
deactivated locally, without peer-to-peer signalling between the SM entities,
the SM entity at the MS and the SM entity at the SGSN each shall send an SNSM-
DEACTIVATE.indication without XID Negotiation Indicator to its respective
SNDCP entity. Upon receipt of this primitive without XID Negotiation Indicator
the SNDCP entity shall remove the NSAPI from the Applicable NSAPIs of the
compression entity without any XID negotiation.
The XID negotiation is a one-step procedure; i.e. the initiating end proposes
parameter values, and the responding end either accepts these or offers
different values in their place according to the XID negotiation rules
described in the present document; the rules limit the range of parameter
values as well as the sense of negotiation. The initiating end accepts (or
rejects) the values in the response; this concludes the negotiation.
The block format for the SNDCP XID parameter negotiation is shown in figure
10. Not all parameters have to be included in the XID block, only parameters
that are negotiated. Parameters may be included in any order. Also it shall be
possible to negotiate parameters for more than one NSAPI in one XID block
since more than one NSAPI can use the same SAPI.
* * *
Bit 8 7 6 5 4 3 2 1 Octet 1 Parameter type=0  
Octet 2 Length=1  
Octet 3 Version number  
Octet 4 Parameter type=1  
Octet 5 Length=n-5  
Octet 6 P X X Entity number  
Octet 7 (optional)  
Octet 8 Length=k-8  
Octet 9 ... (optional)  
Octet j High-order octet  
... ...  
Octet k Low-order octet  
Octet k+1 P X X Entity number  
Octet k+2 (optional)  
Octet k+3 Length=m-(k+3)  
Octet k+4... (optional)  
Octet k+y High-order octet  
... ...  
Octet m Low-order octet  
... ...  
Octet n Low-order octet  
Octet n+1 Parameter type=2  
Octet n+2 Length=r-(n+2)  
Octet n+3 P X X Entity number  
Octet n+4 (optional)  
Octet n+5 Length=p-(n+5)  
Octet n+6... (optional)  
Octet n+w High-order octet  
... ...  
Octet p Low-order octet  
Octet p+1 P X X Entity number  
Octet p+2 (optional)  
Octet p+3 Length=q-(p+3)  
Octet p+4... (optional)  
Octet p+v High-order octet  
... ...  
Octet q Low-order octet  
... ...  
Octet r Low-order octet
* * *
Figure 10: Example of SNDCP XID block format
The SNDCP user uses SN‑XID.request to initiate the negotiation of the XID
parameters. The SNDCP entity sends the proposed SNDCP XID parameters to the
LLC SAP with the LL‑XID.request or LL‑ESTABLISH.request. The LLC SAP shall
issue an XID command containing the SNDCP XID parameters (see 3GPP TS 44.064
[6]). The peer LLC SAP shall, upon receipt of the XID command, indicate the
SNDCP XID parameters to SNDCP entity using LL‑XID.indication or
LL‑ESTABLISH.indication. The peer SNDCP entity shall select appropriate values
for the proposed parameters or negotiate the appropriate values with the SNDCP
user entity with the SN‑XID.indication and SN‑XID.response primitives. When
the appropriate parameter values are known by the peer SNDCP entity, it shall
use the LL‑XID.response or LL‑ESTABLISH.response primitive to continue
negotiation. Upon reception of the response, the LLC SAP shall send the
received parameters to the SNDCP entity using the LL‑XID.confirm or
LL‑ESTABLISH.confirm primitive. The SNDCP entity delivers the negotiated
parameters to the SNDCP user. This is illustrated in figure 11. The originator
of the negotiation shall apply the new parameter values after it has received
the \'confirm\' primitive. The responding end of the negotiation shall apply
the new parameter values after it has sent the replying \'response\'
primitive.
Following the sending of the LL‑XID.request or LL-ESTABLISH.request primitive
with requested SNDCP XID parameters, the SNDCP layer shall suspend the
transfer of LL‑DATA primitives to the LLC SAP to which the LL‑XID.request or
LL-ESTABLISH.request is sent, but may continue the transfer of LL-UNITDATA
primitives to that LLC SAP with the following restrictions:
\- if the transfer of a compressed N-PDU is ongoing when the SN-XID.request is
received, the SNDCP layer shall complete the transfer of this N-PDU before
sending the LL‑XID.request or LL-ESTABLISH.request primitive with requested
SNDCP XID parameters; and
\- the SN-PDUs transferred in the LL‑UNITDATA primitives during the SNDCP XID
negotiation shall be uncompressed.
When the SNDCP XID negotiation has been successfully completed, the SNDCP
layer shall resume the transfer of LL‑DATA primitives. If the transfer of
LL‑UNITDATA primitives was suspended, it shall also be resumed.
The SNDCP XID negotiation ends through one of the following means:
\- successful (receiving LL‑XID.confirm or LL‑ESTABLISH.confirm);
\- failure (receiving LL‑RELEASE.indication, or LL‑STATUS.indication); or
\- successful following collision resolution (receiving
LL‑ESTABLISH.indication and sending LL‑ESTABLISH.response, or receiving
LL‑XID.indication and sending LL‑XID.response, see subclause 6.2.1.4).
LLC may also initiate LLC XID negotiation, in which case LLC may send an
LL‑XID.indication to inform SNDCP the values of N201-I and N201-U. This is
illustrated in figure 12. If the SNDCP entity receives an LL‑XID.indication
without an SNDCP XID block, it shall not respond with the LL‑XID.response
primitive.
Negotiation of SNDCP version number is always between the peer SNDCP entities.
The version number is not known by the SNDCP user. However, negotiation of the
parameters for compression algorithms may be carried out between the SNDCP
user entities.
Negotiation of SNDCP XID parameters for an NSAPI shall be carried out in the
SAPI to which the NSAPI is mapped.
Figure 11: SNDCP XID negotiation procedure
Figure 12: LLC XID negotiation procedure
### 6.8.1 Negotiation of compression entities
For parameter type 1 and 2, multiple compression fields (as shown in figure 7
and figure 9) may be specified. Each compression field corresponds to a
compression entity.
In each compression field, the \"Applicable NSAPIs\" parameter indicates the
NSAPIs that uses the compression entity. The parameter, if included, shall
consist of 2 octets. Multiple NSAPIs may share the same compression entity by
setting multiple bits in the parameter. NSAPIs requiring acknowledged peer-to-
peer LLC operation and unacknowledged peer-to-peer LLC operation shall not
share the same compressor (see subclause 6.10).
During SNDCP XID negotiation or re-negotiation, if a parameter type is
specified in the SNDCP XID block, compression entities currently in use and
compression entities proposed to be added may be included in the SNDCP XID
block. Not all entities need to be included in the SNDCP XID block. If a
compression entity is not included, the value of its parameters shall be
determined by the rules defined in subclause 6.8.2.
If, implicitly or explicitly (see subclause 6.8.2), a compression entity is
specified in the responding SNDCP XID block with one or more bits set to 1 in
the \"Applicable NSAPIs\" parameter, the compression entity shall be created
(if it does not exist yet).
If, implicitly or explicitly, a compression entity is specified in the
responding SNDCP XID block with no bit set to 1 in the \"Applicable NSAPIs\"
parameter, the compression entity shall be deleted (if it currently exists).
If an SNDCP entity receives a proposal for a compression entity containing an
unknown algorithm, it shall reject this compression entity explicitly by
setting the bits in the \"Applicable NSAPIs\" parameter in the responding
SNDCP XID block to 0.
NOTE: Some legacy MS implementations of SDNCP version 0 will ignore a proposed
compression entity containing an unknown algorithm and will not reply with an
explicit rejection.
If, implicitly or explicitly, one or more bits are set to 1 in the
\"Applicable NSAPIs\" parameter of a compression entity in the responding
SNDCP XID block, the NSAPIs corresponding to these bits shall start using (or
continue to use) the compression entity.
If, implicitly or explicitly, one or more bits are set to 0 in the
\"Applicable NSAPIs\" parameter of a compression entity in the responding
SNDCP XID block, the NSAPIs corresponding to these bits shall release the
compression entity (if they have been using the compression entity).
### 6.8.1a Negotiation of SNDCP version
An SNDCP entity supporting this version of SNDCP shall set the version number
in the originating SNDCP XID block to 1. For the sense of negotiation of the
version number see clause 8, table 8.
### 6.8.2 Values of SNDCP XID parameters
In this subclause, the term \"parameter\" refers to an SNDCP XID parameter, a
compression field (for parameter type 1 or 2), or a parameter for a
compression field.
If an SNDCP XID parameter has not been negotiated, default values shall apply.
The default value for a compression field (entity) is \"non-existing\".
If the originating SNDCP XID block does not include a parameter (implicit
command), it shall be treated as equivalent to requesting for the current
value for the parameter. The responder may explicitly include this parameter
in its response. If the responder explicitly includes the parameter in the
response, then it shall also explicitly include this parameter in every SNDCP
XID response until the parameter has been explicitly negotiated, either by
responding to an SNDCP XID command that included the parameter, or by
explicitly including the parameter the next time an SNDCP XID command is
transmitted.
If a parameter is included in the originating SNDCP XID block and the
responder does not include the parameter in its response (implicit response),
it shall be treated as equivalent to responding with the value proposed by the
originator.
If both the originator and the responder do not include a parameter in the
negotiation, the value of the parameter is not changed.
### 6.8.3 Exception handling
In this subclause, the term \"parameter\" may refer, wherever applicable, to
an SNDCP XID parameter, a compression field (for parameter type 1 or 2), or a
parameter for a compression field.
If the originating SNDCP XID block includes an SNDCP XID parameter with
unrecognised Parameter Type field (as specified in clause 8, table 8), the
parameter shall be ignored by the responder.
If the originating SNDCP XID block includes a parameter with unsupported
length or an out-of-range value, then the responder shall respond to the
parameter with lengths and values set according to the responder\'s
preference.
If the originating SNDCP XID block includes parameter type 1 or 2 which
violates the rules in subclause 6.8.1, the responder shall treat the parameter
as not transmitted by the originator, and responds according to subclause
6.8.2.
If the originating SNDCP XID block includes a parameter with duplicated
instances, the subsequent instances of the duplicated parameter shall be
ignored.
If the originating SNDCP XID block is sent on LL‑XID primitives and contains
prohibited changes (see subclauses 6.5.1.2 and 6.6.1.2) to the parameters of
compression entities used with acknowledged peer-to-peer LLC operation, then
the responder shall respond with these parameters set to their previously-
negotiated values.
In the originating SNDCP XID block, excluding the collision scenarios
described in subclause 6.5.1.1.3, when an assigned entity number is included
with the P bit set to 1, the algorithm and the PCOMP and DCOMP fields shall be
ignored if they are the same as the previously-assigned values. If the
algorithm and PCOMP or DCOMP fields are not the same as the previously-
assigned values, then the Applicable NSAPIs field of the compression field in
question shall be set to 0 in the response, and an SNSM-STATUS.request
primitive with Cause \"invalid XID command\" shall be sent to the SM sub-
layer. SM shall then deactivate all PDP contexts for this SAPI.
In the originating SNDCP XID block, if an unassigned entity number is included
with the P bit set to 0, then the Applicable NSAPIs field in the response
shall be set to 0.
In the originating SNDCP XID block, excluding the collision scenarios
described in subclause 6.5.1.1.3, if one or more of the PCOMP or DCOMP
specified is already assigned to a different compression algorithm, then the
Applicable NSAPIs field of the compression field in question shall be set to 0
in the response, and an SNSM-STATUS.request primitive with Cause \"invalid XID
command\" shall be sent to the SM sub-layer. SM shall then deactivate all PDP
contexts for this SAPI.
In the originating SNDCP XID block, if one or more new PCOMP or DCOMP values
are specified for an existing compression algorithm, then the Applicable
NSAPIs field of the compression field in question shall be set to 0 in the
response, and an SNSM-STATUS.request primitive with Cause \"invalid XID
command\" shall be sent to the SM sub-layer. SM shall then deactivate all PDP
contexts for this SAPI.
If the responding SNDCP XID block includes an SNDCP XID parameter with
unrecognised Parameter Type field (see clause 8, table 8), unsupported length,
an out-of-range value or a value violating the sense of negotiation, a
parameter type 1 or 2 which violates the rules in subclause 6.8.1, a parameter
with duplicated instances, contains prohibited changes (see subclauses 6.5.1.2
and 6.6.1.2) to the parameters of compression entities used with acknowledged
peer-to-peer LLC operation when the SNDCP XID block is sent on LL‑XID
primitives, or a compression field with the P bit set to 1, then the
originator shall ignore the block and reinitiate the negotiation. If the
renegotiation fails for an implementation-specific number of times, the
originating SNDCP layer shall send an SNSM-STATUS.request primitive with Cause
\"invalid XID response\" to the SM sub-layer. SM shall then deactivate all PDP
contexts for this SAPI.
If the LLC layer indicates that the XID parameter negotiation failed, by
sending an LL‑RELEASE.indication with Cause \"no peer response\" or an
LL‑STATUS.indication with Cause \"no peer response\", then, as an
implementation option, the SNDCP layer may wait for an implementation-specific
amount of time and re-invoke the XID negotiation procedure.
## 6.9 Data transfer
### 6.9.1 Acknowledged mode
The SNDCP entity shall initiate acknowledged data transmission only if the PDP
context for the NSAPI identified in the SN‑DATA.request has been activated and
if acknowledged LLC operation has been established.
The N‑PDU number in acknowledged mode is a number assigned to each N‑PDU
received by SNDCP through an SN‑DATA.request and to each feedback N-PDU
generated by a local compression entity. N‑PDU numbers for different NSAPIs
shall be assigned independently. The N‑PDU number shall be included in the
SNDCP header of the first segment of an N‑PDU.
NOTE: A feedback N-PDU can be e.g. a context state packet generated by a
protocol control information compression entity using RFC 2507 [10] or a
standalone feedback packet generated by a protocol control information
compression entity using RFC 5795 [12].
Two variables, the Send N‑PDU number and the Receive N‑PDU number, shall be
maintained for each NSAPI using acknowledged peer-to-peer LLC operation. When
an NSAPI using acknowledged peer-to-peer LLC operation is activated, the Send
N‑PDU number and the Receive N‑PDU number shall be set to 0. The Send N‑PDU
number and Receive N‑PDU number shall also be set as described in subclause
5.1.2.22. Modulo 256 operation shall be applied to the Send N‑PDU number and
the Receive N‑PDU number.
Upon reception of an SN‑DATA.request, the SNDCP entity shall assign to the
N‑PDU received the current value of the Send N‑PDU number as the N‑PDU number,
increment the Send N‑PDU number by 1, perform the compression and segmentation
functions, then forward the SN‑PDU(s) in LL‑DATA.request to the LLC layer. If
an N‑PDU number is already present in the SN‑DATA.request, then no new N‑PDU
number shall be assigned to the N‑PDU, and the Send N‑PDU number shall not be
incremented. The N‑PDU shall be stored into a buffer in the SNDCP entity. The
buffered N‑PDU shall be deleted when the SN‑DATA PDU carrying the last segment
of the N‑PDU is confirmed by an LL‑DATA.confirm primitive, or when the entire
N‑PDU is confirmed by an SNSM-SEQUENCE.indication primitive.
Upon reception of a feedback N-PDU generated by a local compression entity,
the SNDCP entity shall assign to the feedback N‑PDU the current value of the
Send N‑PDU number as the N‑PDU number, increment the Send N‑PDU number by 1,
perform segmentation functions if required, then forward the SN‑PDU(s) in
LL‑DATA.request to the LLC layer.
During normal operation (i.e. not in the recovery state), when the peer SNDCP
entity receives the SN‑PDU(s) in an LL‑DATA.indication primitive, the SNDCP
entity shall reassemble and decompress the SN‑PDU(s), increment the Receive
N‑PDU number by 1, and, if the decompression is successful, forward the N‑PDU
to the SNDCP user with the SN‑DATA.indication. The correct SNDCP user is
identified by the NSAPI field in the SN‑PDU(s).
In the recovery state, after reassembling and decompressing the SN‑PDU(s):
\- if the N‑PDU number of the received N‑PDU is equal to the Receive N‑PDU
number, then the Receive N‑PDU number shall be incremented by 1, the recovery
state shall be exited and normal operation shall resume for the received N‑PDU
and all subsequently-received N‑PDUs; and
\- otherwise, the N‑PDU shall be discarded.
After the SNDCP entity in the SGSN receives an SNSM-STOP-ASSIGN.indication
primitive for an NSAPI using acknowledged peer-to-peer LLC operation, it shall
stop assigning N‑PDU number to N‑PDUs received through the SN‑DATA.request
primitive.
If an SN‑DATA PDU (T bit set to 0) is received by an NSAPI that does not use
acknowledged mode, the PDU shall be ignored without error notification.
Figure 13: SNDCP acknowledged data transfer
### 6.9.2 Unacknowledged mode
The SNDCP entity shall initiate unacknowledged data transmission only if the
PDP context for the NSAPI identified in the SN‑DATA.request has been
activated. The SNDCP entity may initiate unacknowledged data transmission even
if the acknowledged peer-to-peer operation is not established for that NSAPI.
The N‑PDU number in unacknowledged mode is a number assigned to each N‑PDU
received by SNDCP through an SN‑UNITDATA.request and to each feedback N-PDU
generated by a local compression entity. N‑PDU numbers for different NSAPIs
shall be assigned independently. The N‑PDU number shall be included in the
SNDCP header of every SN‑UNITDATA PDU.
NOTE: A feedback N-PDU can be e.g. a context state packet generated by a
protocol control information compression entity using RFC 2507 [10] or a
standalone feedback packet generated by a protocol control information
compression entity using RFC 5795 [12].
A variable, the Send N‑PDU number (unacknowledged), shall be maintained for
each NSAPI using unacknowledged peer-to-peer LLC operation. When an NSAPI
using unacknowledged peer-to-peer LLC operation is activated, the Send N‑PDU
number (unacknowledged) shall be set to 0. The Send N‑PDU number
(unacknowledged) shall also be set as described in subclauses 5.1.2.1 and
5.1.2.22. Modulo 4096 operation shall be applied to the Send N‑PDU number
(unacknowledged).
Upon reception of an SN‑UNITDATA.request, the SNDCP entity shall assign the
current value of the Send N‑PDU number (unacknowledged) as the N‑PDU number of
the N‑PDU received, increment Send N‑PDU number (unacknowledged) by 1,
compress and segment the information, then forward the SN‑PDU(s) in
LL‑UNITDATA.request to the LLC layer. The N‑PDU shall be deleted immediately
after the data has been delivered to the LLC layer.
Upon reception of a feedback N-PDU generated by a local compression entity,
the SNDCP entity shall assign the current value of the Send N‑PDU number
(unacknowledged) as the N‑PDU number of the feedback N‑PDU, increment the Send
N‑PDU number (unacknowledged) by 1, perform segmentation functions if
required, then forward the SN‑PDU(s) in LL‑UNITDATA.request to the LLC layer.
The N‑PDU shall be deleted immediately after the data has been delivered to
the LLC layer.
When the peer SNDCP entity receives the SN‑PDU(s) in the
LL‑UNITDATA.indication primitive, the SNDCP entity shall reassemble and
decompress the SN‑PDU(s), then forwards the N‑PDU to the SNDCP user with the
SN‑UNITDATA.indication. The correct SNDCP user is identified by the NSAPI
field in the SN‑PDU(s).
If an SN‑UNITDATA PDU (T bit set to 1) is received by an NSAPI that does not
use unacknowledged mode, the PDU shall be ignored without error notification.
The SNDCP entity shall detect lost SN‑PDUs. The SNDCP entity shall discard
duplicate SN‑PDUs and re-order out-of-sequence SN‑PDUs, if possible.
Figure 14: SNDCP unacknowledged data transfer
## 6.10 Possible combinations of SNDCP protocol functions and their connection
to service access points
The following combinations of SNDCP protocol functions are allowed:
\- One or several NSAPIs may use one SAPI.
\- Only one SAPI shall be used by one NSAPI.
\- One or several NSAPIs may use the same protocol control information
compression entity.
\- One NSAPI may use zero or one protocol control information compression
entities.
\- One or several NSAPIs may use the same data compression entity.
\- One NSAPI may use zero or one data compression entities.
\- Separate data compression entities shall be used for SN‑DATA and
SN‑UNITDATA PDUs.
\- Separate protocol control information compression entities shall be used
for SN‑DATA and SN‑UNITDATA PDUs.
\- One data compression entity shall be connected to one SAPI.
\- One protocol control information compression entity shall be connected to
one SAPI.
\- One or several protocol control information compression entities may be
connected to the same data compression entity.
\- One protocol control information compression entity shall be connected to
zero, one, or several data compression entities.
# 7 Definition of SN‑PDU
## 7.1 Format convention
### 7.1.1 Numbering convention
The convention used in the present document is illustrated in figure 15. The
bits are grouped into octets. The bits of an octet are shown horizontally and
are numbered from 1 to 8. Multiple octets are shown vertically and are
numbered from 1 to N.
* * *
Bit 8 7 6 5 4 3 2 1 Oct 1  
2  
...  
N-1  
N
* * *
Figure 15: Format convention
### 7.1.2 Order of transmission
SN‑PDUs are transferred between the SNDCP layer and LLC layer in units of
octets, in ascending numerical octet order (i.e. octet 1, 2, ..., N‑1, N). The
order of bit transmission is specific to the underlying protocols used across
the Um interface and the Gb interface.
### 7.1.3 Field mapping convention
When a field is contained within a single octet, the lowest bit number of the
field represents the lowest order value. When a field spans more than one
octet, the order of bit values within each octet progressively decreases as
the octet number increases. In that part of the field contained in a given
octet the lowest bit number represents the lowest order value.
For example, a bit number can be identified as a couple (o, b) where o is the
octet number and b is the relative bit number within the octet. Figure 16
illustrates a field that spans from bit (1, 3) to bit (2, 7). The high order
bit of the field is mapped on bit (1, 3) and the low order bit is mapped on
bit (2, 7).
* * *
Bit 8 7 6 5 4 3 2 1 1st octet of field 2^4^ 2^3^ 2^2^  
2nd octet of field 2^1^ 2^0^
* * *
Figure 16: Field mapping convention
Figure 17 illustrates an NSAPI field that spans from bit (1,8) to bit (2,1).
NSAPI 15 is mapped to bit (1,8) and the other NSAPIs are mapped in
decreasingly order until NSAPI 0 that is mapped to bit (2,1). A bit set to 0
means that the compression entity is not applicable to the corresponding
NSAPI. A bit set to 1 means that the compression entity is applicable to the
corresponding NSAPI.
* * *
Bit 8 7 6 5 4 3 2 1 1st octet of field 15 14 13 12 11 10 9 8 2nd octet of
field 7 6 5 4 3 2 1 0
* * *
Figure 17: NSAPI mapping convention
## 7.2 SN‑PDU Formats
Each SN‑PDU shall contain an integral number of octets, and shall comprise a
header part and a data part. An SN‑PDU shall contain data from a single N‑PDU
only. Two different SN‑PDU formats are defined. The SN‑DATA PDU shall be used
for acknowledged data transfer and SN‑UNITDATA PDU for unacknowledged data
transfer.
* * *
Bit 8 7 6 5 4 3 2 1 Oct 1 X F T M NSAPI  
2 DCOMP PCOMP  
3 N‑PDU number - acknowledged mode  
... Data segment  
N
* * *
Figure 18: SN‑DATA PDU format
* * *
Bit 8 7 6 5 4 3 2 1 Oct 1 X F T M NSAPI  
2 DCOMP PCOMP  
3 Segment number N‑PDU number - unacknowledged mode  
4 N‑PDU number - unacknowledged mode (continued)  
... Data segment  
N
* * *
Figure 19: SN‑UNITDATA PDU format
**More bit (M):**
0 Last segment of N‑PDU.
1 Not the last segment of N‑PDU, more segments to follow.
**SN‑PDU Type (T):**
0 SN‑DATA PDU.
1 SN‑UNITDATA PDU.
**First segment indicator bit (F):**
0 This SN‑PDU is not the first segment of an N‑PDU.
The octet including DCOMP and PCOMP is not included in the SN‑DATA PDU or
SN‑UNITDATA PDU format. Also the octet for N‑PDU number for acknowledged mode
is not included in the SN‑DATA PDU format.
1 This SN‑PDU is the first segment of an N‑PDU. The octet for DCOMP and PCOMP
is included in the SN‑DATA PDU or SN‑UNITDATA PDU format. Also the octet for
N‑PDU number for acknowledged mode is included in the SN‑DATA PDU format.
**Spare bit (X):**
0 Shall be set to 0 by the transmitting SNDCP entity and ignored by the
receiving SNDCP entity.
**NSAPI:**
0 Escape mechanism for future extensions.
1 Point-to-Multipoint Multicast (PTM-M) information for Multimedia
Broadcast/Multicast Service (MBMS).
2-4 Reserved for future use.
5-15 Dynamically allocated NSAPI value (see subclause 6.1).
The SGSN shall ignore any uplink data traffic of SN-PDUs with an NSAPI = 1.
SN‑PDU with an unallocated NSAPI value shall be ignored by the receiving SNDCP
entity without error notification.
**Data compression coding (DCOMP):**
0 No compression.
1-14 Points to the data compression identifier negotiated dynamically (see
subclause 6.6).
15 Reserved for future extensions.
SN‑PDU with an unallocated DCOMP value shall be ignored by the receiving SNDCP
entity without error notification.
**Protocol control information compression coding (PCOMP):**
0 No compression.
1-14 Points to the protocol control information compression identifier
negotiated dynamically (see subclause 6.5).
15 Reserved for future extensions.
SN‑PDU with an unallocated PCOMP value shall be ignored by the receiving SNDCP
entity without error notification.
**Segment number:**
0-15 Sequence number for segments carrying an N‑PDU.
**N‑PDU number - acknowledged mode:**
0-255 N‑PDU number of the N‑PDU.
**N‑PDU number - unacknowledged mode:**
0-4095 N‑PDU number of the N‑PDU.
# 8 SNDCP XID parameters
The SNDCP XID parameters are shown in table 8:
Table 8: SNDCP XID parameters
* * *
Parameter name Parameter Type Length Format Range Default value Units Sense of
negotiation Version number 0 1 0000bbbb 0-15 0 - down Data Compression 1
variable See subclause 6.6.1  
Protocol Control Information Compression 2 variable See subclause 6.5.1
* * *
NOTE: The current version of SNDCP is 1. The default value for the version
number is 0.
###### Sept 2003  
NP-21 | NP-030420 | N1-031283 | 44.065 | 008 | 1 | Rel-6 | F | 6.0.0 | 6.1.0 | Corrections on Compression details | TEI6 | 
##### Sept 2003  
NP-22 | NP-030486 | N1-031652 | 44.065 | 012 | 1 | Rel-6 | F | 6.1.0 | 6.2.0 | Disabling of ROHC segmentation | TEI6 | 
##### December 2003  
NP-22 | NP-030486 | N1-031650 | 44.065 | 013 | 1 | Rel-6 | F | 6.1.0 | 6.2.0 | XID negotiation for IP compression | TEI6 | 
##### December 2003  
NP-25 | NP-040387 | N1-041408 | 44.065 | 014 |  | Rel-6 | B | 6.2.0 | 6.3.0 | Update of SNDCP - MBMS | MBMS | 
##### Sept 2004  
NP-25 | NP-040374 | N1-041636 | 44.065 | 017 | 2 | Rel-6 | A | 6.2.0 | 6.3.0 | Negotiation of compression entities with unknown algorithm type | TEI4 | 
##### Sept 2004  
CP-28 | CP-050062 | C1-050787 | 44.065 | 21 | 2 | Rel-6 | B | 6.3.0 | 6.4.0 | Pre-defined Protocol control information compression types for MBMS | MBMS | 
##### June 2005  
CP-29 | CP-050356 | C1-051205 | 44.065 | 025 | 4 | Rel-6 | F | 6.4.0 | 6.5.0 | Recommendation for FOHC context when used for MBMS ROHC | MBMS | 
##### Sept 2005  
CP-29 | CP-050356 | C1-050862 | 44.065 | 026 |  | Rel-6 | F | 6.4.0 | 6.5.0 | MAX_HEADER is not used by ROHC as per RFC 3095 | MBMS | 
##### Sept 2005  
CP-29 | CP-050449 | C1-050921 | 44.065 | 027 | 2 | Rel-6 | B | 6.4.0 | 6.5.0 | Modifications for PS HO in A/Gb mode | SPSHAGB | 
##### Sept 2005  
CP-32 | CP-060267 | C1-060958 | 44.065 | 0030 | 1 | Rel-6 | F | 6.5.0 | 6.6.0 | Handling of feedback N-PDU | TEI6 | 
##### June 2006  
CP-32 | CP-060268 | C1-061035 | 44.065 | 0032 | 1 | Rel-6 | F | 6.5.0 | 6.6.0 | Correction of the XID parameter negotiation sub-clause for LL-UNITDATA | SCSAGB | 
##### June 2006  
CP-33 | CP-060506 | C1-061624 | 44.065 | 0034 |  | Rel-7 | F | 6.6.0 | 7.0.0 | Clean-up for ROHC segmentation | TEI7 | 
##### Sept 2006  
CP-42 |  |  |  |  |  | Rel-8 |  | 7.0.0 | 8.0.0 | Upgrade to Rel-8 |  | 
##### Dec 2008  
CP-46 |  |  |  |  |  | Rel-9 |  | 8.0.0 | 9.0.0 | Upgrade to Rel-9 |  | 
##### Dec 2009  
CP-51 |  |  |  |  |  | Rel-10 |  | 9.0.0 | 10.0.0 | Upgrade to Rel-10 |  | 
##### March 2011  
CP-57 |  |  |  |  |  | Rel-11 |  | 10.0.0 | 11.0.0 | Upgrade to Rel-11 | 
#####
|
##### Sept 2012  
CP-65 |  |  |  |  |  | Rel-12 |  | 11.0.0 | 12.0.0 | Upgrade to Rel-12 | 
#####
|
##### Sept 2014  
CP-70 |  |  |  |  |  | Rel-13 |  | 12.0.0 | 13.0.0 | Upgrade to Rel-13 | 
#####
|
##### Dec 2015  
* * *
**Change history**  
**Date** **Meeting** **TDoc** **CR** **Rev** **Cat** **Subject/Comment** **New
version** 2016-09 CT#73 CP-160491 0035 F Modification of N201-U due to the
introduction of Integrity protection 13.1.0 2016-11 Correction of typo in the
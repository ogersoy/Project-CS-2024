# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, certain modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" shall not to be used as substitutes
for \"may\" and \"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
The present document is the fifth part of a multi-part conformance
specification valid for 3GPP Release 15 and later releases:
3GPP TS 34.229-1 [2]: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 1:
Protocol conformance specification\".
3GPP TS 34.229-2 [3]: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 2:
Implementation Conformance Statement (ICS) proforma specification\".
3GPP TS 34.229-3 [4]: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 3:
Abstract Test Suites (ATS)\".
3GPP TS 34.229-4 [5]: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 4: Enabler
for IP multimedia applications testing\".
**3GPP TS 34.229-5 (the present document): \"Internet Protocol (IP) multimedia
call control protocol based on Session Initiation Protocol (SIP) and Session
Description Protocol (SDP); User Equipment (UE) conformance specification;
Part 5: Protocol conformance specification using 5G System (5GS)\".**
NOTE 1: The ATS is written in a standard testing language, TTCN-3, as defined
in ETSI ES 201 873, Parts 1 to 3 [8], [9] and [10].
NOTE 2: Further information on testing can be found in ETSI ETS 300 406 [11]
and ISO/IEC 9646-1 [12].
For at least a minimum set of services, the prose descriptions of test cases
will have a matching detailed test case implemented in TTCN-3 (and provided in
3GPP TS 34.229-3 [4]).
# 1 Scope
The present document specifies the protocol conformance testing for the User
Equipment (UE) supporting the Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP) when using the 5G System (5GS).
This is the fifth part of a multi-part test specification. The following
information can be found in this part:
\- the overall test structure;
\- the test configurations;
\- the conformance requirement and reference to the core specifications;
\- the test purposes; and
\- the test procedure.
The following information relevant to testing can be found in accompanying
specifications:
\- Implementation Conformance Statement (ICS) pro-forma and the applicability
of each test case [3].
The present document is valid for UE implemented according to 3GPP Releases
starting from Release 15 up to the Release indicated on the cover page of the
present document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 34.229-1: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 1:
Protocol conformance specification\".
[3] 3GPP TS 34.229-2: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 2:
Implementation Conformance Statement (ICS) proforma specification\".
[4] 3GPP TS 34.229-3: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 3:
Abstract Test Suites (ATS)\".
[5] 3GPP TS 34.229-4: \"Internet Protocol (IP) multimedia call control
protocol based on Session Initiation Protocol (SIP) and Session Description
Protocol (SDP); User Equipment (UE) conformance specification; Part 4: Enabler
for IP multimedia applications testing\".
[6] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[7] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[8] ETSI ES 201 873-1: \"Methods for Testing and Specification (MTS); The
Testing and Test Control Notation version 3; Part 1: TTCN-3 Core Language\".
[9] ETSI ES 201 873-2: \"Methods for Testing and Specification (MTS); The
Testing and Test Control Notation version 3; Part 2: TTCN-3 Tabular
Presentation Format (TFT)\".
[10] ETSI TR 201 873-3: \"Methods for Testing and Specification (MTS); The
Testing and Test Control Notation version 3; Part 3: TTCN-3 Graphical
Presentation Format (GFT)\".
[11] ETSI ETS 300 406: \"Methods for testing and Specification (MTS); Protocol
and profile conformance testing specifications; Standardization methodology\".
[12] ISO/IEC 9646-1: \"Information technology - Open systems interconnection -
Conformance testing methodology and framework - Part 1: General concepts\".
[13] ISO/IEC 9646-7: \"Information technology - Open systems interconnection -
Conformance testing methodology and framework - Part 7: Implementation
Conformance Statements\".
[14] 3GPP TS 24.341: \"Support of SMS over IP networks; Stage 3\".
[15] IETF RFC 3310: \"Hypertext Transfer Protocol (HTTP) Digest Authentication
Using Authentication and Key Agreement (AKA)\".
[16] 3GPP TS 33.203: \"3G security;Access security for IP-based services\".
[17] IETF RFC 3329: \"Security Mechanism Agreement for the Session Initiation
Protocol (SIP)\".
[18] IETF RFC 3680: \"A Session Initiation Protocol (SIP) Event Package for
Registrations\".
[19] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[20] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[21] 3GPP TS 38.508-1: \"5GS; User Equipment (UE) conformance specification;
Part 1: Common test environment\".
[22] 3GPP TS 27.007: \"AT command set for User Equipment (UE)\".
[23] IETF RFC 2617: \"HTTP Authentication: Basic and Digest Access
Authentication\".
[24] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[25] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[26] 3GPP TS 24.237: \"IP Multimedia (IM) Core Network (CN) subsystem IP
Multimedia Subsystem (IMS) Service Continuity\".
[27] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[28] IETF RFC 6665: "SIP-Specific Event Notification".
[29] IETF RFC 3312: "Integration of Resource Management and SIP".
[30] IETF RFC 3262: "Reliability of Provisional Responses in the Session
Initiation Protocol (SIP)".
[31] GSMA PRD NG.114: \"IMS Profile for Voice, Video and Messaging over 5GS\".
[32] 3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core
Network (CN) subsystem\".
[33] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia telephony;
Media handling and interaction\".
[34] 3GPP TS 24.606: \"Message Waiting Indication (MWI) using IP Multimedia
(IM) Core Network (CN) subsystem\".
[35] 3GPP TS 24.147: \"Conferencing using the IP Multimedia (IM) Core Network
(CN) subsystem\".
[36] 3GPP TS 24.629: \"Explicit Communication Transfer (ECT) using IP
Multimedia (IM) Core Network (CN) subsystem\".
[37] IETF RFC 4028: \"Session Timers in the Session Initiation Protocol
(SIP)\".
[38] IETF RFC 4566: \"SDP: Session Description Protocol\".
[39] IETF RFC 7462: \"URNs for the Alert-Info Header Field of the Session
Initiation Protocol (SIP) \".
[40] IETF RFC 3891: \"The Session Initiation Protocol (SIP) \"Replaces\"
Header\".
[41] IETF RFC 3986: \"Uniform Resource Identifier (URI): Generic Syntax\".
[42] IETF RFC 3326: \"The Reason Header Field for the Session Initiation
Protocol (SIP)\".
[43] 3GPP TS 24.109: \"Bootstrapping interface (Ub) and network application
function interface (Ua); Protocol details\".
[44] 3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture\".
[45] IETF RFC 4825: \"The Extensible Markup Language (XML) Configuration
Access Protocol (XCAP)\".
[46] IETF RFC 2616: \"Hypertext Transfer Protocol -- HTTP/1.1\".
[47] IETF RFC 3310: \"Hypertext Transfer Protocol (HTTP) Digest Authentication
Using Authentication and Key Agreement (AKA)\".
[48] 3GPP TS 38.509: \"5GS; Special conformance testing functions for User
Equipment (UE)\".
[49] IETF RFC 6228: \"Session Initiation Protocol (SIP) Response Code for
Indication of Terminated Dialog\".
[50] IETF RFC 3323: \"A Privacy Mechanism for the Session Initiation Protocol
(SIP)\".
[51] IETF RFC 3325: \"Private Extensions to the Session Initiation Protocol
(SIP) for Asserted Identity within Trusted Networks\".
[52] 3GPP TS 38.508-2: \"5GS; User Equipment (UE) conformance specification;
Part 2: Common\ Implementation Conformance Statement (ICS) proforma\".
[53] 3GPP TS 36.523-3: \"LTE; Evolved Universal Terrestrial Radio Access
(E-UTRA) and Evolved Packet Core (EPC); User Equipment (UE) conformance
specification; Part 3: Test suites\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
Void
## 3.2 Symbols
Void
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in 3GPP
TR 21.905 [1].
SS System Simulator
# 4 Overview
## 4.1 Test Methodology
### 4.1.1 Testing of optional functions and procedures
Any function or procedure which is optional, as indicated in the present
document may be subject to a conformance test if it is implemented in the UE.
A declaration by the apparatus supplier (Implementation Conformance Statement
(ICS)) is used to determine whether an optional function/procedure has been
implemented (see ISO/IEC 9646-7 [13] for general information about ICS).
## 4.2 Implicit Testing
For some 3GPP signalling and protocol features conformance is not verified
explicitly in the present document. This does not imply that correct
functioning of these features is not essential, but that these are implicitly
tested to a sufficient degree in other tests.
## 4.3 Conformance Requirements
The Conformance Requirements clauses in the present document are copy/paste
from the relevant core specification where skipped text has been replaced with
\"...\". References to clauses in the Conformance Requirements clause of the
test body refers to clauses in the referred specification, not clauses in the
present document.
# 5 Reference Conditions
## 5.1 General
The test cases are expected to be executed through the 3GPP radio interface.
Details of the radio interfaces are outside the scope of this specification.
The reference environments used by tests are specified in the test.
## 5.2 Generic setup procedures
A set of basic generic procedures for different IMS usage scenarios are
described in Annex A of this specification. These procedures are used in
numerous test cases throughout the present document. Default Messages are used
from and maintained in Annex A of TS 34.229-1 [2].
## 5.3 Transport protocols applied
For simplicity, UDP (_User Datagram Protocol_) is applied to IMS testing as
default DL transport protocol, except for the test cases in clause 6 where TCP
(_Transmission Control Protocol_) is applied as DL transport protocol.
NOTE: Which UL transport protocol is used in the test is decided by the UE.
# 6 Registration
## 6.1 Initial Registration / 5GS
##### 6.1.1 Test Purpose (TP) {#test-purpose-tp .H6}
##### (1) {#section .H6}
**with** { UE has an ISIM or USIM inserted, is registered for 5GS, and has
acquired P-CSCF address(es) }
**ensure that** {
**when** { _UE is made to register for IMS_ }
**then** { UE sends a correctly composed initial REGISTER request to the
P-CSCF }
}
##### (2) {#section-1 .H6}
**with** { UE having sent unprotected REGISTER request }
**ensure that** {
**when** { UE receiving a valid 401 (Unauthorized) response for the initial
REGISTER request sent }
**then** { UE correctly authenticates itself by sending another REGISTER
request with a correctly composed Authorization header using the AKAv1-MD5
algorithm }
}
##### (3) {#section-2 .H6}
**with** { UE having sent unprotected and then protected REGISTER request }
**ensure that** {
**when** { UE receiving a valid 200 OK response from S-CSCF for the REGISTER
sent for authentication }
**then** { UE subscribes to the reg event package for the public user identity
registered, using the stored service route for routing the SUBSCRIBE request }
}
##### (4) {#section-3 .H6}
**with** { UE having subscribed to reg event }
**ensure that** {
**when** { _UE receives NOTIFY request for reg event_ }
**then** { UE responds with a valid 200 OK response }
}
##### 6.1.2 Conformance Requirements {#conformance-requirements-1 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause C.2]:
In case the UE is loaded with a UICC that contains a USIM but does not contain
an ISIM, the UE shall:
\- generate a private user identity;
\- generate a temporary public user identity; and
\- generate a home network domain name to address the SIP REGISTER request to.
All these three parameters are derived from the IMSI parameter in the USIM,
according to the procedures described in TS 23.003 [3]. Also in this case, the
UE shall derive new values every time the UICC is changed, and shall discard
existing values if the UICC is removed.
NOTE: If there is an ISIM and a USIM on a UICC, the ISIM is used for
authentication to the IM CN subsystem, as described in TS 33.203 [19]. See
also clause 5.1.1.1A.
[TS 24.229, clause 5.1.1.1A]:
The ISIM shall always be used for authentication to the IM CN subsystem, if it
is present, as described in 3GPP TS 33.203 [19].
The ISIM is preconfigured with all the necessary parameters to initiate the
registration to the IM CN subsystem. These parameters include:
\- the private user identity;
\- one or more public user identities; and
\- the home network domain name used to address the SIP REGISTER request
The first public user identity in the list stored in the ISIM is used in
emergency registration requests.
In case the UE does not contain an ISIM, the UE shall:
\- generate a private user identity;
\- generate a temporary public user identity; and
\- generate a home network domain name to address the SIP REGISTER request to;
in accordance with the procedures in clause C.2.
The temporary public user identity is only used in REGISTER requests, i.e.
initial registration, re-registration, UE-initiated deregistration.
The UE shall not reveal to the user the temporary public user identity if the
temporary public user identity is barred. The temporary public user identity
is not barred if received by the UE in the P-Associated-URI header field.
If the UE is unable to derive the parameters in this clause for any reason,
then the UE shall not proceed with the request associated with the use of
these parameters and will not be able to register to the IM CN subsystem.
[TS 24.229, clause 5.1.1.2.1]:
The initial registration procedure consists of the UE sending an unprotected
REGISTER request and, if challenged depending on the security mechanism
supported for this UE, sending the integrity-protected REGISTER request or
other appropriate response to the challenge. The UE can register a public user
identity with any of its contact addresses at any time after it has acquired
an IP address, discovered a P-CSCF, and established an IP-CAN bearer that can
be used for SIP signalling. However, the UE shall only initiate a new
registration procedure when it has received a final response from the
registrar for the ongoing registration, or the previous REGISTER request has
timed out.
...
The UE shall send the unprotected REGISTER requests to the port advertised to
the UE during the P-CSCF discovery procedure. If the UE does not receive any
specific port information during the P-CSCF discovery procedure, or if the UE
was pre-configured with the P-CSCF\'s IP address or domain name and was unable
to obtain specific port information, the UE shall send the unprotected
REGISTER request to the SIP default port values as specified in RFC 3261 [26].
NOTE 1: The UE will only send further registration and subsequent SIP messages
towards the same port of the P-CSCF for security mechanisms that do not
require to use negotiated ports for exchanging protected messages.
The UE shall extract or derive a public user identity, the private user
identity, and the domain name to be used in the Request-URI in the
registration, according to the procedures described in subclause 5.1.1.1A or
subclause 5.1.1.1B. A public user identity may be input by the end user.
On sending an unprotected REGISTER request, the UE shall populate the header
fields as follows:
a) a From header field set to the SIP URI that contains:
...
2) the public user identity to be registered;
b) a To header field set to the SIP URI that contains:
...
2) the public user identity to be registered;
c) a Contact header field set to include SIP URI(s) containing the IP address
or FQDN of the UE in the hostport parameter. If the UE:
1) supports GRUU (see table A.4, item A.4/53);
...
3) has an IMEI available; or
...
the UE shall include a \"+sip.instance\" header field parameter containing the
instance ID. ...
NOTE 2: The requirement placed on the UE to include an instance ID based on
the IMEI or the MEID when the UE does not support GRUU and does not support
multiple registrations does not imply any additional requirements on the
network.
...
The UE shall include all supported ICSI values (coded as specified in
subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in
subclause 7.9.2 and RFC 3840 [62] for the IMS communication services it
intends to use, and IARI values (coded as specified in subclause 7.2A.9.2),
for the IMS applications it intends to use in a g.3gpp.iari-ref media feature
tag as defined in subclause 7.9.3 and RFC 3840 [62].
The UE shall include the media feature tags as defined in RFC 3840 [62] for
all supported streaming media types.
...
If the UE has no specific reason not to include a user part in the URI of the
contact address (e.g. some UE performing the functions of an external attached
network), the UE should include a user part in the URI of the contact address
such that the user part is globally unique and does not reveal any private
information;
NOTE 3: A time-based UUID (Universal Unique Identifier) generated as per
subclause 4.2 of RFC 4122 [154] is globally unique and does not reveal any
private information.
d) a Via header field set to include the sent-by field containing the IP
address or FQDN of the UE and the port number where the UE expects to receive
the response to this request when UDP is used. For TCP, the response is
received on the TCP connection on which the request was sent. For the UDP, the
UE shall also include a \"rport\" header field parameter with no value in the
Via header field. Unless the UE has been configured to not send keep-alives,
and unless the UE is directly connected to an IP-CAN for which usage of NAT is
not defined, it shall include a \"keep\" header field parameter with no value
in the Via header field, in order to indicate support of sending keep-alives
associated with the registration, as described in RFC 6223 [143];
NOTE 4: When sending the unprotected REGISTER request using UDP, the UE
transmit the request from the same IP address and port on which it expects to
receive the response to this request.
e) a registration expiration interval value of 600 000 seconds as the value
desired for the duration of the registration;
NOTE 5: The registrar (S-CSCF) might decrease the duration of the registration
in accordance with network policy. Registration attempts with a registration
period of less than a predefined minimum value defined in the registrar will
be rejected with a 423 (Interval Too Brief) response.
f) a Request-URI set to the SIP URI of the domain name of the home network
used to address the REGISTER request;
g) the Supported header field containing the option-tag \"path\", and
1) if GRUU is supported, the option-tag \"gruu\"; and
2) if multiple registrations is supported, the option-tag \"outbound\".
h) if a security association or TLS session exists, and if available to the UE
(as defined in the access technology specific annexes for each access
technology), a P-Access-Network-Info header field set as specified for the
access network technology (see subclause 7.2A.4);
...
On receiving the 200 (OK) response to the REGISTER request, the UE shall:
a) store the expiration time of the registration for the public user
identities found in the To header field value and bind it either to the
respective contact address of the UE or to the registration flow and the
associated contact address (if the multiple registration mechanism is used);
...
b) store as the default public user identity the first URI on the list of URIs
present in the P-Associated-URI header field and bind it to the respective
contact address of the UE and the associated set of security associations or
TLS session;
...
d) store the list of service route values contained in the Service-Route
header field and bind the list either to the contact address or to the
registration flow and the associated contact address (if the multiple
registration mechanism is used), and the associated set of security
associations or TLS session over which the REGISTER request was sent;
NOTE 10: When multiple registration mechanism is not used, there will be only
one list of service route values bound to a contact address. However, when
multiple registration mechanism is used, there will be different list of
service route values bound to each registration flow and the associated
contact address.
NOTE 11: The UE will use the stored list of service route values to build a
proper preloaded Route header field for new dialogs and standalone
transactions (other than REGISTER method) when using either the respective
contact address or the registration flow and the associated contact address
(if the multiple registration mechanism is used), and the associated set of
security associations or TLS session.
e) if the UE indicated support for GRUU in the Supported header field of the
REGISTER request then:
\- if the UE did not use the procedures specified in RFC 6140 [191] for
registration, find the Contact header field within the response that matches
the one included in the REGISTER request. If this contains a \"pub-gruu\"
header field parameter or a \"temp-gruu\" header field parameter or both, then
store the value of those parameters as the GRUUs for the UE in association
with the public user identity and the contact address that was registered; and
...
NOTE 12: When allocating public GRUUs to registering UAs the functionality
within the UE that performs the role of registrar will add an \"sg\" SIP URI
parameter that uniquely identifies that UA to the public GRUU it received in
the \"pub-gruu\" header field parameter. The procedures for generating a
temporary GRUU using the \"temp-gruu-cookie\" header field parameter are
specified in subclause 7.1.2.2 of RFC 6140 [191].
f) if the REGISTER request contained the \"reg-id\" and \"+sip.instance\"
Contact header field parameter and the \"outbound\" option tag in a Supported
header field, the UE shall check whether the option-tag \"outbound\" is
present in the Require header field:
\- if no option-tag \"outbound\" is present, the UE shall conclude that the
S-CSCF does not support the registration procedure as described in RFC 5626
[92], and the S-CSCF has followed the registration procedure as described in
RFC 5627 [93] or RFC 3261 [26], i.e., if there is a previously registered
contact address, the S-CSCF replaced the old contact address and associated
information with the new contact address and associated information (see
bullet e) above). Upon detecting that the S-CSCF does not support the
registration procedure as defined in RFC 5626 [92], the UE shall refrain from
registering any additional IMS flows for the same private identity as
described in RFC 5626 [92]; or
NOTE 13: Upon replaces the old contact address with the new contact address,
the S-CSCF performs the network initiated deregistration procedure for the
previously registered public user identities and the associated old contact
address as described in subclause 5.4.1.5. Hence, the UE will receive a NOTIFY
request informing the UE about the deregistration of the old contact address.
\- if an option-tag \"outbound\" is present, the UE may establish additional
IMS flows for the same private identity, as defined in RFC 5626 [92];
g) if available, store the announcement of media plane security mechanisms the
P-CSCF (IMS-ALG) supports labelled with the \"mediasec\" header field
parameter specified in subclause 7.2A.7 and received in the Security-Server
header field, if any. Once the UE chooses a media security mechanism from the
list received in the Security-Server header field from the server, it may
initiate that mechanism on a media level when it initiates new media in an
existing session;
NOTE 14: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
[TS 24.229, clause 5.1.1.2.2]:
On sending a REGISTER request, as defined in subclause 5.1.1.2.1, the UE shall
additionally populate the header fields as follows:
a) an Authorization header field, with:
\- the \"username\" header field parameter, set to the value of the private
user identity;
\- the \"realm\" header field parameter, set to the domain name of the home
network;
\- the \"uri\" header field parameter, set to the SIP URI of the domain name
of the home network;
\- the \"nonce\" header field parameter, set to an empty value; and
\- the \"response\" header field parameter, set to an empty value;
NOTE 1: If the UE specifies its FQDN in the hostport parameter in the Contact
header field and in the sent-by field in the Via header field, then it has to
ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the
IP address that is bound to the security association.
NOTE 2: The UE associates two ports, a protected client port and a protected
server port, with each pair of security association. For details on the
selection of the port values see 3GPP TS 33.203 [19].
b) additionally for the Contact header field, if the REGISTER request is
protected by a security association, include the protected server port value
in the hostport parameter;
c) additionally for the Via header field, for UDP, if the REGISTER request is
protected by a security association, include the protected server port value
in the sent-by field; and
d) a Security-Client header field set to specify the signalling plane security
mechanism the UE supports, the IPsec layer algorithms the UE supports and the
parameters needed for the security association setup. The UE shall support the
setup of two pairs of security associations as defined in 3GPP TS 33.203 [19].
The syntax of the parameters needed for the security association setup is
specified in annex H of 3GPP TS 33.203 [19]. The UE shall support the
\"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The UE shall
support the IPsec layer algorithms for integrity and confidentiality
protection as defined in 3GPP TS 33.203 [19], and shall announce support for
them according to the procedures defined in RFC 3329 [48].
[TS 24.229, clause 5.1.1.5.1]:
Authentication is performed during initial registration. A UE can be re-
authenticated during subsequent reregistrations, deregistrations or
registrations of additional public user identities. When the network requires
authentication or re-authentication of the UE, the UE will receive a 401
(Unauthorized) response to the REGISTER request.
On receiving a 401 (Unauthorized) response to the REGISTER request, the UE
shall:
1) extract the RAND and AUTN parameters;
2) check the validity of a received authentication challenge, as described in
3GPP TS 33.203 [19] i.e. the locally calculated XMAC must match the MAC
parameter derived from the AUTN part of the challenge; and the SQN parameter
derived from the AUTN part of the challenge must be within the correct range;
and
3) check the existence of the Security-Server header field as described in RFC
3329 [48]. If the Security-Server header field is not present or it does not
contain the parameters required for the setup of the set of security
associations (see annex H of 3GPP TS 33.203 [19]), the UE shall abandon the
authentication procedure and send a new REGISTER request with a new Call-ID.
In the case that the 401 (Unauthorized) response to the REGISTER request is
deemed to be valid the UE shall:
1) calculate the RES parameter and derive the keys CK and IK from RAND as
described in 3GPP TS 33.203 [19];
2) set up a temporary set of security associations for this registration based
on the static list and parameters the UE received in the 401 (Unauthorized)
response and its capabilities sent in the Security-Client header field in the
REGISTER request. The UE sets up the temporary set of security associations
using the most preferred mechanism and algorithm returned by the P-CSCF and
supported by the UE and using IK and CK (only if encryption enabled) as the
shared key. The UE shall use the parameters received in the Security-Server
header field to setup the temporary set of security associations. The UE shall
set a temporary SIP level lifetime for the temporary set of security
associations to the value of reg-await-auth timer;
...
4) send another REGISTER request towards the protected server port indicated
in the response using the temporary set of security associations to protect
the message. The header fields are populated as defined for the initial
REGISTER request that was challenged with the received 401 (Unauthorized)
response, with the addition that the UE shall include an Authorization header
field containing:
\- the \"realm\" header field parameter set to the value as received in the
\"realm\" WWW-Authenticate header field parameter;
\- the \"username\" header field parameter, set to the value of the private
user identity;
\- the \"response\" header field parameter that contains the RES parameter, as
described in RFC 3310 [49];
\- the \"uri\" header field parameter, set to the SIP URI of the domain name
of the home network;
\- the \"**algorithm\" header field parameter,** set to the value received in
the 401 (Unauthorized) response; and
\- the \"nonce\" header field parameter, set to the value received in the 401
(Unauthorized) response.
The UE shall also insert the Security-Client header field that is identical to
the Security-Client header field that was included in the previous REGISTER
request (i.e. the REGISTER request that was challenged with the received 401
(Unauthorized) response). The UE shall also insert the Security-Verify header
field into the request, by mirroring in it the content of the Security-Server
header field received in the 401 (Unauthorized) response. The UE shall set the
Call-ID of the security association protected REGISTER request which carries
the authentication challenge response to the same value as the Call-ID of the
401 (Unauthorized) response which carried the challenge.
NOTE 2: The Security-Client header field contains signalling plane security
mechanism and if the UE supports media plane security, then media plane
security mechanisms are contained, too.
[TS 24.229, clause 5.1.1.5.1]:
On receiving the 200 (OK) response for the security association protected
REGISTER request registering a public user identity with the associated
contact address, the UE shall:
\- change the temporary set of security associations to a newly established
set of security associations, i.e. set its SIP level lifetime to the longest
of either the previously existing set of security associations SIP level
lifetime, or the lifetime of the just completed registration plus 30 seconds;
and
\- if this is the only set of security associations available toward the
P-CSCF, use the newly established set of security associations for further
messages sent towards the P-CSCF. If there are additional sets of security
associations (e.g. due to registration of multiple contact addresses), the UE
can either use them or use the newly established set of security associations
for further messages sent towards the P-CSCF as appropriate.
NOTE 3: If the UE has registered multiple contact addresses, the UE can either
send requests towards the P-CSCF over the newly established set of security
associations, or use different UE\'s contact address and associated set of
security associations when sending the requests towards the P-CSCF. Responses
towards the P-CSCF that are sent via UDP will be sent over the same set of
security associations that the related request was received on. Responses
towards the P-CSCF that are sent via TCP will be sent over the same set of
security associations that the related request was received on.
When the first request or response protected with the newly established set of
security associations is received from the P-CSCF or when the lifetime of the
old set of security associations expires, the UE shall delete the old set of
security associations and related keys it may have with the P-CSCF after all
SIP transactions that use the old set of security associations are completed.
[TS 24.229, clause 5.1.1.3]:
Upon receipt of a 2xx response to the initial registration, the UE shall
subscribe to the reg event package for the public user identity registered at
the user\'s registrar (S-CSCF) as described in RFC 3680 [43] and RFC 6665
[28].
...
The UE shall subscribe to the reg event package upon registering a new contact
address via an initial registration procedure. If the UE receives a NOTIFY
request via the newly established subscription dialog and via the previously
established subscription dialogs (there will be at least one), the UE may
terminate the previously established subscription dialogs and keep only the
newly established subscription dialog.
The UE shall use the default public user identity for subscription to the
registration-state event package.
NOTE 2: The subscription information stored in the HSS ensures that the
default public user identity is a SIP URI.
On sending a SUBSCRIBE request, the UE shall populate the header fields as
follows:
a) a Request-URI set to the resource to which the UE wants to be subscribed
to, i.e. to the SIP URI that is the default public user identity used for
subscription;
b) a From header field set to the SIP URI that is the default public user
identity used for subscription;
c) a To header field set to the SIP URI that is the default public user
identity used for subscription;
d) an Event header field set to the \"reg\" event package;
e) an Expires header field set to 600 000 seconds as the value desired for the
duration of the subscription;
f) void; and
g) void.
[TS 24.229, clause 5.1.2.1]:
Upon receipt of a NOTIFY request for the dialog associated with the
subscription to the reg event package the UE shall perform the following
actions:
\- store the information for the established dialog;
\- store the expiration time as indicated in the \"expires\" header field
parameter of the Subscription-State header field, if present, of the NOTIFY
request. Otherwise the expiration time is retrieved from the Expires header
field of the 2xx response to SUBSCRIBE request;
\- if a \ element with state attribute \"active\", i.e.
registered, is received for one or more public user identities, the UE shall
store the indicated public user identities as registered;
\- if a \ element with state attribute \"active\" is received,
and the UE supports GRUU (see table A.4, item A.4/53), then for each public
user identity indicated in the notification that contains a \
element or a \ element or both (as defined in RFC 5628 [94]), the
UE shall store the value of those elements in association with the public user
identity;
[TS 24.229, clause 5.1.2A.1.1]:
When the UE sends any request, the UE shall use either a given contact address
that has been previously registered or a registration flow and the associated
contact address (if the multiple registration mechanism is used) and shall:
\- if IMS AKA is in use as a security mechanism:
a) if the UE has not obtained a GRUU, populate the Contact header field of the
request with the protected server port and the respective contact address; and
b) include the protected server port and the respective contact address in the
Via header field entry relating to the UE;
> ...
The UE shall determine the public user identity to be used for this request as
follows:
1) if a P-Preferred-Identity was included, then use that as the public user
identity for this request; or
2) if no P-Preferred-Identity was included, then use the default public user
identity for the security association or TLS session and the associated
contact address as the public user identity for this request;
> ...
If this is a request for a new dialog, the Contact header field is populated
as follows:
> 1) a contact header value which is one of:
\- if a public GRUU value (\"pub-gruu\" header field parameter) has been saved
associated with the public user identity to be used for this request, and the
UE does not indicate privacy of the P-Asserted-Identity, then the UE should
insert the public GRUU (\"pub-gruu\" header field parameter) value as
specified in RFC 5627 [93]; or
\- if a temporary GRUU value (\"temp-gruu\" header field parameter) has been
saved associated with the public user identity to be used for this request,
and the UE does indicate privacy of the P-Asserted-Identity, then the UE
should insert the temporary GRUU (\"temp-gruu\" header field parameter) value
as specified in RFC 5627 [93];
\- otherwise, a SIP URI containing the contact address of the UE that has been
previously registered without any contact parameters dedicated to registration
procedure;
NOTE 7: The above items are mutually exclusive.
> ...
If available to the UE (as defined in the access technology specific annexes
for each access technology), the UE shall insert a P-Access-Network-Info
header field into any request for a dialog, any subsequent request (except
CANCEL requests) or response (except CANCEL responses) within a dialog or any
request for a standalone method (see subclause 7.2A.4). Insertion of the
P-Access-Network-Info header field into the ACK request is optional.
NOTE 13: During the dialog, the points of attachment to the IP-CAN of the UE
can change (e.g. UE connects to different cells). The UE will populate the
P-Access-Network-Info header field in any request or response within a dialog
with the current point of attachment to the IP-CAN (e.g. the current cell
information).
NOTE 14: The value of the P-Access-Network-Info header field could be stale if
the point of attachment of the UE with the network changes before the message
is received by the network.
The UE shall build a proper preloaded Route header field value for all new
dialogs and standalone transactions. The UE shall build a list of Route header
field values made out of the following, in this order:
a) the P-CSCF URI containing the IP address acquired at the time of the P-CSCF
discovery procedures which was used in registration of the contact address (or
registration flow); and
NOTE 15: If the UE is provisioned with or receives a FQDN at the time of the
P-CSCF discovery procedures, the FQDN is resolved to an IP address at the time
of the P-CSCF discovery procedures.
b) the P-CSCF port based on the security mechanism in use:
\- if IMS AKA or SIP digest with TLS is in use as a security mechanism, the
protected server port learnt during the registration procedure;
> ...
c) and the values received in the Service-Route header field saved from the
200 (OK) response to the last registration or re-registration of the public
user identity with associated contact address.
NOTE 16: When the UE registers multiple contact addresses, there will be a
list of Service-Route headers for each contact address. When sending a request
using a given contact address and the associated security associations or TLS
session, the UE will use the corresponding list of Service-Route headers to
construct a list of Route headers.
[TS 24.341, clause 5.3.2.2]
On sending a REGISTER request, the SM-over-IP receiver shall indicate its
capability to receive traditional short messages over IMS network by including
a \"+g.3gpp.smsip\" parameter into the Contact header according to RFC 3840
[16].
##### 6.1.3 Test description {#test-description .H6}
##### 6.1.3.1 Pre-test conditions {#pre-test-conditions .H6}
##### System Simulator: {#system-simulator .H6}
\- SS is configured with the IMSI within the USIM application, the home domain
name, public and private user identities together with the shared secret key
of IMS AKA algorithm, related to the IMS private user identity (IMPI) that is
configured on the UICC card equipped into the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- SS is able to perform IMS AKA authentication for the IMPI, according to
3GPP TS 33.203 [16] clause 6.1.
\- 1 NR Cell
##### UE: {#ue .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is switched off.
##### Preamble: {#preamble .H6}
\- None
##### 6.1.3.2 Test procedure sequence {#test-procedure-sequence .H6}
Table 6.1.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 The UE is switched on.  
2 Check: does the UE send an initial registration request? --> REGISTER 1 P 3
SS sends 401 Unauthorized. \ REGISTER 2 P
5 SS sends 200 OK for REGISTER. \ SUBSCRIBE 3 P 7 SS sends 200
OK for SUBSCRIBE. \ 200 OK 4 P NOTE: The
associated NR/5GC signalling is specified in TS 38.508-1 [21] generic
procedure 4.5.2.
* * *
Table 6.1.3.2-2: Parallel Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE sends a PUBLISH request. --> PUBLISH  
2 SS sends a 503 Service Unavailable response \ a) use the mechanism defined in subclause 4.5 of RFC 5626 [92] for
> determination of the retry delay time before each new registration attempt;
>
> b) mark the currently used P-CSCF address as unavailable for the last
> duration of the retry delay time computed by the algorithm defined in
> subclause 4.5 of RFC 5626 [92] plus 5 minutes; and
>
> c) initiate an initial registration as specified in subclause 5.1.1.2 after
> the amount of time of the last retry delay time computed by the algorithm
> defined in subclause 4.5 of RFC 5626 [92]; and
>
> \- if there is a locally stored P-CSCF address as specified in subclause
> 5.1.9 which is different from the currently used P-CSCF address and which is
> not marked as unavailable, may initiate the initial registration using that
> P-CSCF; and
>
> \- if there is no locally stored P-CSCF address as specified in subclause
> 5.1.9 which is different from the currently used P-CSCF address and which is
> not marked as unavailable, may get a new set of P-CSCF addresses as
> described in subclause 9.2.1 unless otherwise specified in the access
> specific annexes (as described in annex B, annex L or annex U) and initiate
> the initial registration as specified in subclause 5.1.1.2.
The values of max-time and base-time (if all failed) may be provided by the
network to the UE with the management objects specified in 3GPP TS 24.167
[8G]. If no values of the parameters max-time and base-time (if all failed)
have been provided to the UE by the network, the default values defined in
subclause 4.5 of RFC 5626 [92] shall be used. Other mechanisms may be used as
well and are outside the scope of the present document.
[TS 24.229, clause 5.1.1.2.1]:
On receiving a 503 response with a Retry-After header field to the REGISTER
request and the Retry-After header field indicates time bigger than the value
for timer F as specified in table 7.7.1, the UE:
a) shall mark the currently used P-CSCF address as unavailable for the time
indicated by the Retry-After header field;
b) if there is a locally stored P-CSCF address as specified in subclause 5.1.9
which is different than the currently used P-CSCF address and which is not
marked as unavailable, may initiate an initial registration as specified in
subclause 5.1.1.2 using that P-CSCF; and
c) if there is no locally stored P-CSCF address as specified in subclause
5.1.9 which is different than the currently used P-CSCF address and which is
not marked as unavailable, may get a new set of P-CSCF addresses as described
in subclause 9.2.1 unless otherwise specified in the access specific annexes
(as described in annex B, annex L or annex U) and initiate an initial
registration as specified in subclause 5.1.1.2.
NOTE 19: if the Retry-After header field indicates time smaller than the value
for timer F as specified in table 7.7.1, the UE continues using the currently
used P-CSCF address.
[TS 24.229, clause 5.1.1.2.1]:
On receiving a 423 (Interval Too Brief) response to the REGISTER request, the
UE shall:
\- send another REGISTER request populating the registration expiration
interval value with an expiration timer of at least the value received in the
Min-Expires header field of the 423 (Interval Too Brief) response.
##### 6.2.3 Test description {#test-description-1 .H6}
##### 6.2.3.1 Pre-test conditions {#pre-test-conditions-1 .H6}
##### System Simulator: {#system-simulator-1 .H6}
\- SS is configured with the IMSI within the USIM application, the home domain
name, public and private user identities together with the shared secret key
of IMS AKA algorithm, related to the IMS private user identity (IMPI) that is
configured on the UICC card equipped into the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- SS is able to perform IMS AKA authentication for the IMPI, according to
3GPP TS 33.203 [16] clause 6.1.
\- 1 NR Cell
\- UE provided with a second P-CSCF in the PDU SESSION ESTABLISHMENT ACCEPT
according to Table 4.7.2-2 (conditions Additional_P-CSCF_IPv6 and
Additional_P-CSCF_IPv4) of TS 38.508-1 [21].
##### UE: {#ue-1 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is switched off.
##### Preamble: {#preamble-1 .H6}
\- None
##### 6.2.3.2 Test procedure sequence {#test-procedure-sequence-1 .H6}
Table 6.2.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 The UE is switched on - - 2 UE sends an initial registration request. -->
REGISTER - - 3 SS sends 503 Service Unavailable without Retry-After header.
\ REGISTER 1 P 5 SS sends 503 Service Unavailable with Retry-After
header set to 10 seconds. \ REGISTER 2 P 7 SS sends 423 Interval Too Brief. \ REGISTER 3 P 9 SS
sends 401 Unauthorized. \ REGISTER - - 11 SS sends 200 OK for REGISTER \ PUBLISH - - 2 SS sends a 503 Service
Unavailable response \ elements is set to
\"active\";
\- the value of the \ sub-element inside the \ sub-element is
set to the Contact address that the UE registered; and
\- the event attribute of that \ sub-element(s) is set to
\"shortened\";
the UE shall:
1) use the expires attribute of the \ sub-element that the UE
registered to adjust the expiration time for that public user identity; and
2) start the re-authentication procedures at the appropriate time (as a result
of the S-CSCF procedure described in subclause 5.4.1.6) by initiating a
reregistration as described in subclause 5.1.1.4, if required.
NOTE: When authenticating a given private user identity, the S-CSCF will only
shorten the expiry time within the \ sub-element that the UE
registered using its private user identity. The \ elements for the
same public user identity, if registered by another UE using different private
user identities remain unchanged. The UE will not initiate a reregistration
procedure, if none of its \ sub-elements was modified.
##### 6.3.3 Test description {#test-description-2 .H6}
##### 6.3.3.1 Pre-test conditions {#pre-test-conditions-2 .H6}
##### System Simulator: {#system-simulator-2 .H6}
\- SS is configured with the IMSI within the USIM application, the home domain
name, public and private user identities together with the shared secret key
of IMS AKA algorithm, related to the IMS private user identity (IMPI) that is
configured on the UICC card equipped into the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- SS is able to perform IMS AKA authentication for the IMPI, according to
3GPP TS 33.203 [16] clause 6.1.
\- 1 NR Cell
##### UE: {#ue-2 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is switched off.
##### Preamble: {#preamble-2 .H6}
\- None
##### 6.3.3.2 Test procedure sequence {#test-procedure-sequence-2 .H6}
Table 6.3.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is switched on.  
2-9 Steps 1-8 from clause A.2: initial IMS registration happens, with SS
giving 120 seconds expiration interval.  
10 UE re-registers 60 seconds later. --> REGISTER 1 P 11 SS declines re-
registration attempt. \
REGISTER 2 P 13-19 Steps 2-8 from clause A.2, with SS giving 360 seconds
expiration interval.  
20 UE re-registers 180 seconds later. --> REGISTER 3 P 21 SS responds with
1600 seconds expiration interval \ REGISTER 4 P 23 SS responds with 423
Interval Too Brief with Min-Expires value of 800000 seconds \ REGISTER 5 P 25 SS responds with 200 OK. \ 200 OK  
28 30 seconds before new expiry time, UE re-registers --> REGISTER 6 P 29 SS
responds with authentication challenge and security mechanism supported by the
network \ REGISTER  
31 SS responds with 200 OK \_ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _same value | | | | | | as in Contact | | | | | | header of REGISTER | | | | | | request _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | +---------------------+------+---------------------+-----+-----------+ | | A4 | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _callid=\"Call-Id | | | | | | of most recent | | | | | | REGISTER\"_ | | | | | | | | | | | | _cseq=\"CSeq value | | | | | | of most recent | | | | | | REGISTER\" >_ | | | | | | | | | | | | _\ _same value | | | | | | as in Contact | | | | | | header of REGISTER | | | | | | request _\ _ | | | | | | | | | | | | _\  | | | | | | \"Instance ID of | | | | | | the UE;\" | | | | | | \_ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | +---------------------+------+---------------------+-----+-----------+
Table 6.3.3.3-11: 200 OK for other requests than REGISTER or SUBSCRIBE (step
27, Table 6.3.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.3.1, Conditions A5,
A11, A22
* * *
Table 6.3.3.3-12: REGISTER (step 28, Table 6.3.3.2-1)
Derivation path: TS 34.229-1 [2], Table in subclause A.1.1, Conditions A2,
A17, A32
* * *
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **Contact**  
expires _800000_ (if present)  
**Expires** present if no expires parameter in Contact header  
delta-seconds _800000_  
**Authorization**  
nonce-count **5**
Table 6.3.3.3-13: 401 Unauthorized (step 29, Table 6.3.3.2-1)
Derivation path: TS 34.229-1 [2], Table in subclause A.1.2, Condition A1
* * *
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **WWW-
Authenticate** **RFC 2617 [23]** nonce **Base 64 encoding of new RAND and new
AUTN (different from the values used in step 3)** **TS 24.229 [7]**
Table 6.3.3.3-14: REGISTER (step 30, Table 6.3.3.2-1)
Derivation path: TS 34.229-1 [2], Table in subclause A.1.1, Conditions A2,
A17, A32
* * *
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **Contact**  
expires _800000_ (if present)  
**Expires** present if no expires parameter in Contact header  
delta-seconds _800000_  
**Authorization**  
nonce-count **1**
Table 6.3.3.3-15: 200 OK for REGISTER (step 31, Table 6.3.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.1.3, Condition A2
* * *
## 6.4 De-Registration Scenarios / 5GS
##### 6.4.1 Test Purpose (TP) {#test-purpose-tp-3 .H6}
##### (1) {#section-13 .H6}
**Void**
##### (2) {#section-14 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE receiving a NOTIFY request containing de-registration
information with contact elements being \"deactivated\" }
**then** { UE acknowledges de-registration }
}
##### (3) {#section-15 .H6}
**with** { UE being de-registered from IMS by the network with contact
elements being \"deactivated\" }
**ensure that** {
**when** { UE acknowledging de-registration }
**then** { UE performs initial registration to IMS }
}
##### (4) {#section-16 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE is made to de-register its contact address }
**then** { UE performs de-registration from IMS }
}
##### 6.4.2 Conformance Requirements {#conformance-requirements-4 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 5.4.1.5]:
For any registered public user identity, the S-CSCF can deregister:
\- all contact addresses bound to the indicated public user identity (i.e.
deregister the respective public user identity);
\- some contact addresses bound to the indicated public user identity;
\- a particular contact address bound to the indicated public user identity;
or
\- one or more registration flows and the associated contact address bound to
the indicated public user identity, when the UE supports multiple registration
procedure;
by sending a single NOTIFY request.
...
When a network-initiated deregistration event occurs for one or more public
user identities that are bound either to one or more contact addresses or
registration flows and the associated contact addresses (if the multiple
registration mechanism is used), the S-CSCF shall send a NOTIFY request to all
subscribers that have subscribed to the respective reg event package. For each
NOTIFY request, the S-CSCF shall:
1) set the Request-URI and Route header field to the saved route information
during subscription;
2) set the Event header field to the \"reg\" value;
3) in the body of the NOTIFY request, include as many \ elements
as many public user identities the S-CSCF is aware of the user owns;
4) set the aor attribute within each \ element to one public
user identity:
a) set the \ sub-element inside each \ sub-element of each
\ element to the respective contact address provided by the UE;
b) if the public user identity:
i) has been deregistered (i.e. all contact addresses and all registration
flows and associated contact addresses bound to the indicated public user
identity are removed) then:
\- set the state attribute within the \ element to
\"terminated\";
\- set the state attribute within each \ element belonging to this UE
to \"terminated\"; and
\- set the event attribute within each \ element belonging to this UE
to either \"unregistered\", or \"deactivated\" if the S-CSCF expects the UE to
reregister or \"rejected\" if the S-CSCF does not expect the UE to reregister;
or
...
When sending a final NOTIFY request with all \ element(s) having
their state attribute set to \"terminated\" (i.e. all public user identities
have been deregistered or expired), the S-CSCF shall also terminate the
subscription to the registration event package by setting the Subscription-
State header field to the value of \"terminated\".
[TS 24.229, clause 5.1.1.7]:
Upon receipt of a NOTIFY request, on any dialog which was generated during the
subscription to the reg event package as described in subclause 5.1.1.3,
including one or more \ element(s) which were registered by this
UE, with:
1) the state attribute within the \ element set to
\"terminated\", and within each \ element belonging to this UE, the
state attribute set to \"terminated\" and the event attribute set either to
\"unregistered\", or \"rejected\", or \"deactivated\", the UE shall remove all
registration details relating to the respective public user identity (i.e.
consider the public user identity indicated in the aor attribute of the
\ element as deregistered); or
...
In case of a \"deactivated\" event attribute, the UE shall start the initial
registration procedure as described in subclause 5.1.1.2. In case of a
\"rejected\" event attribute, the UE shall release all dialogs related to
those public user identities.
Upon receipt of a NOTIFY request, the UE shall delete all security
associations or TLS sessions towards the P-CSCF either:
\- if all \ element(s) have their state attribute set to
\"terminated\" (i.e. all public user identities are deregistered) and the
Subscription-State header field contains the value of \"terminated\"; or
\- if each \ element that was registered by this UE has either
the state attribute set to \"terminated\", or the state attribute set to
\"active\" and the state attribute within the \ element belonging to
this UE set to \"terminated\".
When all UE\'s public user identities are registered via a single P-CSCF and
the subscription dialog to the reg event package of the UE is set via the
respective P-CSCF, the UE shall delete these security associations or TLS
sessions towards the respective P-CSCF when all public user identities have
been deregistered and after the server transaction (as defined in RFC 3261
[26]) pertaining to the received NOTIFY request terminates.
NOTE 3: Deleting a security association or TLS session is an internal
procedure of the UE and does not involve any SIP procedures.
NOTE 4: If all the public user identities (i.e. \ elements)
registered by this UE are deregistered and the security associations or TLS
sessions have been removed, the UE considers the subscription to the reg event
package terminated since the NOTIFY request was received with Subscription-
State header field containing the value of \"terminated\".
[TS 24.229, clause 5.1.1.6.1]:
For any public user identity that the UE has previously registered, the UE can
deregister via a single registration procedure:
\- all contact addresses bound to the indicated public user identity;
\- some contact addresses bound to the indicated public user identity;
\- a particular contact address bound to the indicated public user identity;
or
\- when the UE supports multiple registrations (i.e. the \"outbound\" option
tag is included in the Supported header field) one or more flows bound to the
indicated public user identity.
The UE can deregister a public user identity that it has previously registered
with its contact address at any time. The UE shall protect the REGISTER
request using a security association or TLS session that is associated with
contact address, see 3GPP TS 33.203 [19], established as a result of an
earlier registration, if one is available.
The UE shall extract or derive a public user identity, the private user
identity, and the domain name to be used in the Request-URI in the
registration, according to the procedures described in subclause 5.1.1.1A or
subclause 5.1.1.1B.
Prior to sending a REGISTER request for deregistration, the UE shall release
all dialogs that were using the contact addresses or the flow that is going to
be deregistered and related to the public user identity that is going to be
deregistered or to one of the implicitly registered public user identities.
However:
\- if the dialog that was established by the UE subscribing to the reg event
package used the public user identity that is going to be deregistered; and
\- this dialog is the only remaining dialog used for subscription to reg event
package of the user, i.e. there are no other contact addresses registered with
associated subscription to the reg event package of the user;
then the UE shall not release this dialog.
On sending a REGISTER request that will remove the binding between the public
user identity and one of its contact addresses or one of its flows, the UE
shall populate the header fields as follows:
a) a From header field set to the SIP URI that contains:
1) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, the main URI of the UE; else
2) the public user identity to be deregistered;
b) a To header field set to the SIP URI that contains:
1) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, the main URI of the UE; else
2) the public user identity to be deregistered;
c) a Contact header field set to the SIP URI(s) that contain(s) in the
hostport parameter the IP address of the UE or FQDN, and:
1) if the UE is removing the binding between the public user identity
indicated in the To header field, (together with the associated implicitly
registered public user identities), and the contact address indicated in the
Contact header field; and
\- if the UE supports GRUU, or multiple registrations (i.e. the \"outbound\"
option tag is included in the Supported header field), or has an IMEI
available, or has an MEID available, the Contact header field also contains
the \"+sip.instance\" header field parameter. Only the IMEI shall be used for
generating an instance ID for a multi-mode UE that supports both 3GPP and
3GPP2 defined radio access networks;
\- if the UE supports multiple registrations (i.e. the \"outbound\" option tag
is included in the Supported header field), the Contact header field does not
contain the \"reg-id\" header field parameter;
\- if the UE does not supports GRUU and does not support multiple
registrations (i.e. the \"outbound\" option tag is not included in the
Supported header field), and does not have an IMEI available, and does not
have an MEID available, the Contact header field does not contain either the
\"+sip.instance\" header field parameter or the \"reg-id\" header field
parameter;
NOTE 1: Since the contact address is deregistered, if there are any flows that
were previously registered with the respective contact address, all flows
terminating at the respective contact address are removed.
2) if the UE is removing the binding between the public user identity
indicated in the To header field, (together with the associated implicitly
registered public user identities) and one of its flows, the Contact header
field contains the \"+sip.instance\" header field parameter and the \"reg-id\"
header field parameter that identifies the flow; and
NOTE 2: The requirement placed on the UE to include an instance ID based on
the IMEI when the UE does not support GRUU and does not support multiple
registrations does not imply any additional requirements on the network.
3) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Contact URI without a user portion and containing the \"bnc\" URI
parameter;
d) a Via header field set to include the IP address or FQDN of the UE in the
sent-by field;
e) a registration expiration interval value set to the value of zero,
appropriate to the deregistration requirements of the user;
f) a Request-URI set to the SIP URI of the domain name of the home network
used to address the REGISTER request;
g) if available to the UE (as defined in the access technology specific
annexes for each access technology), a P-Access-Network-Info header field set
as specified for the access network technology (see subclause 7.2A.4);
h) a Security-Client header field to announce the media plane security
mechanisms the UE supports, if any;
NOTE 3: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
i) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Require header field containing the option-tag \"gin\"; and
j) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Proxy-Require header field containing the option-tag \"gin\".
For a public user identity that the UE has registered with multiple contact
addresses or multiple flows (e.g. via different P-CSCFs), the UE shall also be
able to deregister multiple contact addresses or multiple flows, bound to its
public user identity, via single deregistration procedure as specified in RFC
3261 [26]. The UE shall send a single REGISTER request, using one of its
contact addresses and the associated set of security associations or TLS
session, containing a list of Contact headers. Each Contact header field is
populated as specified above in bullets a) through i).
The UE can deregister all contact addresses bound to its public user identity
and associated with its private user identity. The UE shall send a single
REGISTER request, using one of its contact addresses and the associated set of
security associations or TLS session, containing a public user identity that
is being deregistered in the To header field, and a single Contact header
field with value of \"*\" and the Expires header field with a value of \"0\".
The UE shall not include the \"instance-id\" feature tag and the \"reg-id\"
header field parameter in the Contact header field in the REGISTER request.
NOTE 4: All entities subscribed to the reg event package of the user will be
informed via NOTIFY request which contact addresses bound to the public user
identity have been deregistered.
When a 401 (Unauthorized) response to a REGISTER request is received the UE
shall behave as described in subclause 5.1.1.5.1.
On receiving the 200 (OK) response to the REGISTER request, the UE shall:
\- remove all registration details relating to this public user identity and
the associated contact address.
\- store the announcement of the media plane security mechanisms the P-CSCF
(IMS-ALG) supports labelled with the \"mediasec\" header field parameter
specified in subclause 7.2A.7 and received in the Security-Server header
field, if any.
NOTE 5: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
If there are no more public user identities registered with this contact
address, the UE shall delete any stored media plane security mechanisms and
related keys and any security associations or TLS sessions and related keys it
may have towards the IM CN subsystem.
If all public user identities are deregistered and all security association or
TLS session is removed, then the UE shall consider subscription to the reg
event package cancelled (i.e. as if the UE had sent a SUBSCRIBE request with
an Expires header field containing a value of zero).
[TS 24.229, clause 5.1.1.6.2]:
On sending a REGISTER request, as defined in subclause 5.1.1.6.1, the UE shall
additionally populate the header fields as follows:
a) an Authorization header field, with:
\- the \"username\" header field parameter, set to the value of the private
user identity;
\- the \"realm\" header field parameter, set to the value as received in the
\"realm\" WWW-Authenticate header field parameter;
\- the \"uri\" header field parameter, set to the SIP URI of the domain name
of the home network;
\- the \"nonce\" header field parameter, set to last received nonce value; and
\- the response directive, set to the last calculated response value;
b) additionally for each Contact header field and associated contact address,
include the associated protected server port value in the hostport parameter;
c) additionally for the Via header field, include the protected server port
value bound to the security association in the sent-by field;
NOTE 1: If the UE specifies its FQDN in the hostport parameter in the Contact
header field and in the sent-by field in the Via header field, then it has to
ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the
IP address that is bound to the security association.
d) a Security-Client header field, set to specify the signalling plane
security mechanisms it supports, the IPsec layer algorithms for integrity and
confidentiality protection it supports and the new parameter values needed for
the setup of two new pairs of security associations. For further details see
3GPP TS 33.203 [19] and RFC 3329 [48]; and
e) a Security-Verify header field that contains the content of the Security-
Server header field received in the 401 (Unauthorized) response of the last
successful authentication.
NOTE 2: When the UE has received the 200 (OK) response for the REGISTER
request of the only public user identity currently registered with this
contact address and its associated set of implicitly registered public user
identities (i.e. no other public user identity is registered), the UE removes
the security association (between the P-CSCF and the UE) that were using this
contact address. Therefore further SIP signalling using this security
association (e.g. the NOTIFY request containing the deregistration event) will
not reach the UE.
##### 6.4.3 Test description {#test-description-3 .H6}
##### 6.4.3.1 Pre-test conditions {#pre-test-conditions-3 .H6}
##### System Simulator: {#system-simulator-3 .H6}
\- SS is configured with the IMSI within the USIM application, the home domain
name, public and private user identities together with the shared secret key
of IMS AKA algorithm, related to the IMS private user identity (IMPI) that is
configured on the UICC card equipped into the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- SS is able to perform IMS AKA authentication for the IMPI, according to
3GPP TS 33.203 [16] clause 6.1.
\- 1 NR Cell
##### UE: {#ue-3 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is switched off.
##### Preamble: {#preamble-3 .H6}
\- None
##### 6.4.3.2 Test procedure sequence {#test-procedure-sequence-3 .H6}
Table 6.4.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is switched on. - - - - 2-9 Steps 1-8 from Annex A.2: initial IMS
registration happens. - - - - 10-12 Void - - - 13 SS de-registers the UE\'s
contact address. \ 200 OK 2 P 15-22
Steps 1-8 from Annex A.2: initial IMS registration happens. - - 3 P \-
EXCEPTION: Steps 23a1-23a8 describe behaviour that depends on UE
configuration; the \"lower case letter\" identifies a step sequence that takes
place if data centric mode is configured - - - - 23a1 IF [52] pc_data_centric
THEN UE is made to de-register its contact address. - - - - 23a2-23a8 Steps
0A-2 defined in Annex A.11 - - 4 P 24-29 Void - - - - \- EXCEPTION: Steps 30a1
to 30a2 may be performed depending on UE implementation; the \"lower case
letter\" identifies a step sequence that take place if the UE performs a
specific action. - - - - 30a1 The UE transmits a PDU SESSION RELEASE REQUEST
message to release 'ims' PDU session. --> PDU SESSION RELEASE REQUEST - - 30a2
PDU session release procedure defined in clause 4.9.21 of TS 38.508-1 [4] is
performed. - - - - \- EXCEPTION: Step 31a1 may be performed depending on UE
implementation; the \"lower case letter\" identifies a step sequence that take
place if the UE performs a specific action. - - - - 31a1 The UE transmits a
DEREGISTRATION REQUEST message. --> DEREGISTRATION REQUEST - - NOTE: The
associated NR/5GC signalling is specified in TS 38.508-1 [21] generic
procedure 4.5.2.
* * *
##### 6.4.3.3 Specific message contents {#specific-message-contents-3 .H6}
Table 6.4.3.3-0: Void
Table 6.4.3.3-1: NOTIFY (step 13, Table 6.4.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.1.6, Conditions A1 AND
((A3 AND A6) OR (A4 AND A6))
* * *
Table 6.4.3.3-2: 200 OK for other requests than REGISTER or SUBSCRIBE (step
14, Table 6.4.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.3.1, Conditions A5,
A11, A22
* * *
## 6.5 Void
## 6.6 Re-Registration after capability update / 5GS
##### 6.6.1 Test Purpose (TP) {#test-purpose-tp-4 .H6}
##### (1) {#section-17 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE is made to update its capabilities }
**then** { UE re-registers }
}
##### 6.6.2 Conformance Requirements {#conformance-requirements-5 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 5.1.1.4.1]:
Unless either the user or the application within the UE has determined that a
continued registration is not required the UE shall reregister an already
registered public user identity either 600 seconds before the expiration time
if the previous registration was for greater than 1200 seconds, or when half
of the time has expired if the previous registration was for 1200 seconds or
less, or when the UE intends to update its capabilities according to RFC 3840
[62] or when the UE needs to modify the ICSI values that the UE intends to use
in a g.3gpp.icsi-ref media feature tag or IARI values that the UE intends to
use in the g.3gpp.iari-ref media feature tag.
##### 6.6.3 Test description {#test-description-4 .H6}
##### 6.6.3.1 Pre-test conditions {#pre-test-conditions-4 .H6}
##### System Simulator: {#system-simulator-4 .H6}
\- SS is configured with the shared secret key of IMS AKA algorithm, related
to the IMS private user identity (IMPI) that is configured on the UICC card
equipped into the UE.
\- SS is able to perform AKAv1-MD5 authentication algorithm for that IMPI,
according to 3GPP TS 33.203 [16] clause 6.1 and RFC 3310 [15].
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- 1 NR Cell
##### UE: {#ue-4 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is registered to IMS services, by executing the generic test procedure
in Annex A.2 up to the last step.
\- UE is able to be made change its capabilities, manifested through a
specific instance which is setting the AT Command +CASIMS (Availability for
SMS using IMS, defined in 3GPP TS 27.007 [22] 8.72) to 0.
##### Preamble: {#preamble-4 .H6}
\- UE complete the registration procedure and IMS PDU session establishment
procedure according to Steps 2-19a1 of TS 38.508-1 table 4.5.2.2-2.
##### 6.6.3.2 Test procedure sequence {#test-procedure-sequence-4 .H6}
Table 6.6.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is made to turn off its SMS over IMS capability.  
2 Check: does the UE initiate a re-registration procedure, and indicating the
changed capabilities in the REGISTER message? --> REGISTER 1 P 3 Void  
4 Void  
5 SS responds with 200 OK for REGISTER \ | REGISTER | | | | | initial | | | | | | | re | | | | | | | gistration | | | | | | | for IMS | | | | | | | services. | | | | | +------------+------------+------------+------------+---------+---+ | 3 | SS | \ | REGISTER | 1 | P | | | does the | | | | | | | UE send a | | | | | | | REGISTER | | | | | | | request: | | | | | | | | | | | | | | - | | | | | | | contains | | | | | | | no AUTS | | | | | | | directive | | | | | | | and an | | | | | | | empty | | | | | | | response | | | | | | | directive, | | | | | | | i.e. no | | | | | | | auth | | | | | | | entication | | | | | | | challenge | | | | | | | response | | | | | | | | | | | | | | - UE | | | | | | | populates | | | | | | | a new | | | | | | | Secur | | | | | | | ity-Client | | | | | | | header set | | | | | | | to specify | | | | | | | the | | | | | | | security | | | | | | | mechanism | | | | | | | it | | | | | | | supports, | | | | | | | the IPsec | | | | | | | layer | | | | | | | algorithms | | | | | | | it | | | | | | | supports | | | | | | | and the | | | | | | | parameters | | | | | | | needed for | | | | | | | the new | | | | | | | security | | | | | | | a | | | | | | | ssociation | | | | | | | setup | | | | | +------------+------------+------------+------------+---------+---+ | 5 | SS | \ | REGISTER | 2 | P | | | does the | | | | | | | UE send | | | | | | | another | | | | | | | REGISTER | | | | | | | request: | | | | | | | | | | | | | | - | | | | | | | contains | | | | | | | no AUTS | | | | | | | directive | | | | | | | and an | | | | | | | empty | | | | | | | response | | | | | | | directive, | | | | | | | i.e. no | | | | | | | auth | | | | | | | entication | | | | | | | challenge | | | | | | | response | | | | | | | | | | | | | | - UE | | | | | | | populates | | | | | | | a new | | | | | | | Secur | | | | | | | ity-Client | | | | | | | header set | | | | | | | to specify | | | | | | | the | | | | | | | security | | | | | | | mechanism | | | | | | | it | | | | | | | supports, | | | | | | | the IPsec | | | | | | | layer | | | | | | | algorithms | | | | | | | it | | | | | | | supports | | | | | | | and the | | | | | | | parameters | | | | | | | needed for | | | | | | | the new | | | | | | | security | | | | | | | a | | | | | | | ssociation | | | | | | | setup | | | | | +------------+------------+------------+------------+---------+---+ | 7 | Void | | | | | +------------+------------+------------+------------+---------+---+ | 8 | Void | | | | | +------------+------------+------------+------------+---------+---+ | 9-15 | Steps 2-8 | | | | | | | from | | | | | | | Clause A.2 | | | | | | | are | | | | | | | performed. | | | | | +------------+------------+------------+------------+---------+---+ | NOTE: The | | | | | | | associated | | | | | | | NR/5GC | | | | | | | signalling | | | | | | | is | | | | | | | specified | | | | | | | in TS | | | | | | | 38.508-1 | | | | | | | [21] | | | | | | | generic | | | | | | | procedure | | | | | | | 4.5.2. | | | | | | +------------+------------+------------+------------+---------+---+
##### 6.7.3.3 Specific message contents {#specific-message-contents-5 .H6}
Table 6.7.3.3-1: REGISTER (step 2, table 6.7.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.1, Condition A1
* * *
Table 6.7.3.3-2: 401 Unauthorized for REGISTER (step 3/5, table 6.7.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.2, Condition A1  
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **WWW-
Authenticate**  
nonce **Base 64 encoding of RAND and AUTN, generated using invalid MAC value**
* * *
Table 6.7.3.3-3: REGISTER (step 4/6, table 6.7.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.1, Condition A1  
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **CSeq**  
value must be incremented from previous REGISTER  
**Call-ID**  
callid **same value as in REGISTER at Step 2**  
**Authorization**  
response **present, but empty**  
auts **not present**  
**Security-Client**  
spi-c new SPI number of the inbound SA at the protected client port, shall be
different from previously used number(s)  
spi-s new SPI number of the inbound SA at the protected server port, shall be
different from previously used number(s)  
port-c new protected client port, shall be different from previously used
number(s)
* * *
## 6.8 Authentication / Security-Server missing / SQN out of range / 5GS
##### 6.8.1 Test Purpose (TP) {#test-purpose-tp-6 .H6}
##### (1) {#section-21 .H6}
**with** { UE starting registration procedure }
**ensure** **that** {
**when** { UE receiving a challenge response without Security-Server header }
**then** { UE abandons the authentication procedure and sends a new REGISTER
request with new Call-ID }
}
##### (2) {#section-22 .H6}
**with** { UE having sent a new initial REGISTER request }
**ensure** **that** {
**when** { UE receiving a challenge response with SQN out of range }
**then** { UE sends another REGISTER request with challenge response AUTS and
populates a new Security-Client header }
}
##### 6.8.2 Conformance Requirements {#conformance-requirements-7 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.1.5.1]:
Authentication is performed during initial registration. A UE can be re-
authenticated during subsequent reregistrations, deregistrations or
registrations of additional public user identities. When the network requires
authentication or re-authentication of the UE, the UE will receive a 401
(Unauthorized) response to the REGISTER request.
On receiving a 401 (Unauthorized) response to the REGISTER request, the UE
shall:
1) extract the RAND and AUTN parameters;
2) check the validity of a received authentication challenge, as described in
3GPP TS 33.203 [19] i.e. the locally calculated XMAC must match the MAC
parameter derived from the AUTN part of the challenge; and the SQN parameter
derived from the AUTN part of the challenge must be within the correct range;
and
3) check the existence of the Security-Server header field as described in RFC
3329 [48]. If the Security-Server header field is not present or it does not
contain the parameters required for the setup of the set of security
associations (see annex H of 3GPP TS 33.203 [19]), the UE shall abandon the
authentication procedure and send a new REGISTER request with a new Call-ID.
...
In the case that the 401 (Unauthorized) response is deemed to be invalid then
the UE shall behave as defined in subclause 5.1.1.5.3.
[TS 24.229, clause 5.1.1.5.3]
If, in a 401 (Unauthorized) response, either the MAC or SQN is incorrect the
UE shall respond with a further REGISTER indicating to the S-CSCF that the
challenge has been deemed invalid as follows:
\- in the case where the UE deems the MAC parameter to be invalid the
subsequent REGISTER request shall contain no \"auts\" Authorization header
field parameter and an empty \"response\" Authorization header field
parameter, i.e. no authentication challenge response;
\- in the case where the UE deems the SQN to be out of range, the subsequent
REGISTER request shall contain the \"auts\" Authorization header field
parameter (see 3GPP TS 33.102 [18]).
NOTE: In the case of the SQN being out of range, a \"response\" Authorization
header field parameter can be included by the UE, based on the procedures
described in RFC 3310 [49].
Whenever the UE detects any of the above cases, the UE shall:
\- send the REGISTER request using an existing set of security associations,
if available (see 3GPP TS 33.203 [19]);
\- populate a new Security-Client header field within the REGISTER request and
associated contact address, set to specify the security mechanisms it
supports, the IPsec layer algorithms for integrity and confidentiality
protection it supports and the parameters needed for the new security
association setup. These parameters shall contain new values for spi_uc,
spi_us and port_uc; and
\- not create a temporary set of security associations.
##### 6.8.3 Test description {#test-description-6 .H6}
##### 6.8.3.1 Pre-test conditions {#pre-test-conditions-6 .H6}
##### System Simulator: {#system-simulator-6 .H6}
\- SS is configured with the shared secret key of IMS AKA algorithm, related
to the IMS private user identity (IMPI) configured on the UICC card equipped
into the UE.
\- SS is able to perform AKAv1-MD5 authentication algorithm for that IMPI,
according to 3GPP TS 33.203 [16] clause 6.1 and RFC 3310 [15].
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- 1 NR Cell
##### UE: {#ue-6 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is switched off.
##### Preamble: {#preamble-6 .H6}
\- None.
##### 6.8.3.2 Test procedure sequence {#test-procedure-sequence-6 .H6}
Table 6.8.3.2-1: Main Behaviour
+------------+------------+------------+------------+---------+---+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +------------+------------+------------+------------+---------+---+ | | | U - S | Message | | | +------------+------------+------------+------------+---------+---+ | 1 | The UE is | | | | | | | switched | | | | | | | on. | | | | | +------------+------------+------------+------------+---------+---+ | 2 | UE sends | --> | REGISTER | | | | | initial | | | | | | | re | | | | | | | gistration | | | | | | | for IMS | | | | | | | services. | | | | | +------------+------------+------------+------------+---------+---+ | 3 | SS | \ | REGISTER | 1 | P | | | does the | | | | | | | UE sends a | | | | | | | new | | | | | | | REGISTER | | | | | | | request | | | | | | | with new | | | | | | | Call-ID | | | | | +------------+------------+------------+------------+---------+---+ | 5 | SS | \ | REGISTER | 2 | P | | | does the | | | | | | | UE send | | | | | | | another | | | | | | | REGISTER | | | | | | | request: | | | | | | | | | | | | | | - | | | | | | | contains | | | | | | | AUTS | | | | | | | directive | | | | | | | | | | | | | | - UE | | | | | | | populates | | | | | | | a new | | | | | | | Secur | | | | | | | ity-Client | | | | | | | header set | | | | | | | to specify | | | | | | | the | | | | | | | security | | | | | | | mechanism | | | | | | | it | | | | | | | supports, | | | | | | | the IPsec | | | | | | | layer | | | | | | | algorithms | | | | | | | it | | | | | | | supports | | | | | | | and the | | | | | | | parameters | | | | | | | needed for | | | | | | | the new | | | | | | | security | | | | | | | a | | | | | | | ssociation | | | | | | | setup. | | | | | +------------+------------+------------+------------+---------+---+ | 7-13 | Continue | - | | | | | | with Annex | | | | | | | A.2 step | | | | | | | 2-8 in | | | | | | | order to | | | | | | | get the UE | | | | | | | in a | | | | | | | stable | | | | | | | registered | | | | | | | state. | | | | | +------------+------------+------------+------------+---------+---+ | NOTE: The | | | | | | | associated | | | | | | | NR/5GC | | | | | | | signalling | | | | | | | is | | | | | | | specified | | | | | | | in TS | | | | | | | 38.508-1 | | | | | | | [21] | | | | | | | generic | | | | | | | procedure | | | | | | | 4.5.2. | | | | | | +------------+------------+------------+------------+---------+---+
##### 6.8.3.3 Specific message contents {#specific-message-contents-6 .H6}
Table 6.8.3.3-1: REGISTER (step 2, table 6.8.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.1, Condition A1
* * *
Table 6.8.3.3-2: 401 Unauthorized for REGISTER (step 3, table 6.8.3.2-1)
Derivation path: TS 34.229-1 [2], Table in subclause A.1.2, Condition A1
* * *
Header/param Cond Value/remark Rel Reference **Security-Server** not present.
Table 6.8.3.3-3: REGISTER (step 4, table 6.8.3.2-1)
Derivation path: TS 34.229-1 [2], Table in subclause A.1.1, Condition A1 and
A32
* * *
Header/param Cond Value/remark Rel Reference **Call-ID**  
**callid** Value differs from the one sent in in Step 2 of table 6.8.3.2-1.
Table 6.8.3.3-4: 401 Unauthorized for REGISTER (step 5, table 6.8.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.2, Condition A1  
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **WWW-
Authenticate**  
nonce **Base 64 encoding of RAND and AUTN, generated with SQN out of range
with the AMF information field set to AMF~RESYNCH~ value to trigger SQN re-
synchronisation procedure in test ISIM/USIM, see TS 34.108 clause 8.1.2.2.**
* * *
Table 6.8.3.3-5: REGISTER (step 6, table 6.8.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.1, Conditions A1  
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **CSeq**  
value must be incremented from previous REGISTER  
**Call-ID**  
callid **same value as in REGISTER at Step 4**  
**Authorization**  
nonce **same as in previous 401 UNAUTHORIZED message**  
opaque **same as in previous 401 UNAUTHORIZED message**  
auts **any value**  
**Security-Client**  
spi-c new SPI number of the inbound SA at the protected client port, shall be
different from previously used number  
spi-s new SPI number of the inbound SA at the protected server port, shall be
different from previously used number  
port-c new protected client port, shall be different from previously used
number
* * *
## 6.9 Subscription / 503 Service Unavailable / 5GS
##### 6.9.1 Test Purpose (TP) {#test-purpose-tp-7 .H6}
##### (1) {#section-23 .H6}
**with** { UE subscribing to reg event }
**ensure** **that** {
**when** { UE receives 503 Service unavailable containing a Retry-After header
field }
**then** { UE does not reattempt the request for the indicated time period }
}
##### 6.9.2 Conformance Requirements {#conformance-requirements-8 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2.2]:
If the UE receives a 503 (Service Unavailable) response to an initial
SUBSCRIBE request containing a Retry-After header field, then the UE shall not
automatically reattempt the request until after the period indicated by the
Retry-After header field contents.
##### 6.9.3 Test description {#test-description-7 .H6}
##### 6.9.3.1 Pre-test conditions {#pre-test-conditions-7 .H6}
##### System Simulator: {#system-simulator-7 .H6}
\- SS is configured with the shared secret key of IMS AKA algorithm, related
to the IMS private user identity (IMPI) configured on the UICC card equipped
into the UE.
\- SS has performed AKAv1-MD5 authentication with the UE and accepted the
registration (IMS security).
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- 1 NR Cell
##### UE: {#ue-7 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is switched off.
##### Preamble: {#preamble-7 .H6}
\- None.
##### 6.9.3.2 Test procedure sequence {#test-procedure-sequence-7 .H6}
Table 6.9.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 The UE is switched on.  
2-5 Steps 1-4 of Annex A.2 happen.  
6 UE subscribes to its registration event package. --> SUBSCRIBE  
7 SS responds with 503 response containing a Retry-After header with period
set to T=128s. \ SUBSCRIBE  
10-12 Continue with Annex A.2 step 6-8 in order to get the UE in a stable
registered state. -  
NOTE: The associated NR/5GC signalling is specified in TS 38.508-1 [21]
generic procedure 4.5.2.
* * *
##### 6.9.3.3 Specific message contents {#specific-message-contents-7 .H6}
Table 6.9.3.3-1: SUBSCRIBE for reg-event package (step 6, table 6.9.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.4, Conditions A1 and
A7
* * *
Table 6.9.3.3-2: 503 Service Unavailable (step 7, table 6.9.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.4.2  
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **Retry-
After** RFC 3261 [6] **period** 128
* * *
Table 6.9.3.3-3: SUBSCRIBE for reg-event package (step 9, table 6.9.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.1.4, Conditions A1 and
A7  
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **Call-ID**
RFC 3261 [6] **callid** value different from the previous SUBSCRIBE request
* * *
# 7 Call Control
## 7.1 MTSI MO Voice Call / 503 Service Unavailable / 5GS
##### 7.1.1 Test Purpose (TP) {#test-purpose-tp-8 .H6}
##### (1) {#section-24 .H6}
**with** { UE being registered to IMS and UE having sent an initial INVITE
request for MO Voice call }
**ensure that** {
**when** { UE receiving a 503 Service Unavailable response containing a Retry-
After header indicating a period of 20 seconds }
**then** { UE does not reattempt the request until after the indicated period
}
}
##### (2) {#section-25 .H6}
Void
##### 7.1.2 Conformance Requirements {#conformance-requirements-9 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 5.1.3.1]:
Upon receiving a 503 (Service Unavailable) response to an initial INVITE
request containing a Retry-After header, then the originating UE shall not
automatically reattempt the request until after the period indicated by the
Retry-After header contents.
[TS 24.229, clause 6.1.2]:
An INVITE request generated by a UE shall contain a SDP offer and at least one
media description. This SDP offer shall reflect the calling user\'s terminal
capabilities and user preferences for the session.
...
NOTE 2: If the originating UE does not use the precondition mechanism (see
subclause 5.1.3.1), it will not include any precondition information in the
SDP message body.
##### 7.1.3 Test description {#test-description-8 .H6}
##### 7.1.3.1 Pre-test conditions {#pre-test-conditions-8 .H6}
##### System Simulator: {#system-simulator-8 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-8 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is either configured to use preconditions or to not use
preconditions or does not support preconditions..
##### Preamble: {#preamble-8 .H6}
\- UE is in state 1N-A and registered to IMS
##### 7.1.3.2 Test procedure sequence {#test-procedure-sequence-8 .H6}
Table 7.1.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is made to attempt an IMS voice call - - - - 2-7 Steps 2-7 of generic
procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21] are performed. -
- - - \- EXCEPTION: In parallel with Step 8, parallel behaviour defined in
table 7.1.3.2-2 takes place - - - - \- EXCEPTION: Steps 8a to 8b describe
behaviour that depends on UE configuration; the "lower case letter" identifies
a step sequence that takes place if such configuration was conducted. - - - -
8a IF the UE is configured to use preconditions THEN step1 of Annex A.4.1
takes place. --> INVITE - - 8b ELSE step 1 of Annex A.4.2 takes place. -->
INVITE - - 9 SS sends 503 (Service Unavailable) with Retry-After header
indicating a period of 20 seconds. \ ACK - -
11 The SS starts timer t_Waits=20s. - - - - 12 Check: Does the UE reattempt
the INVITE request? --> INVITE 1 F 13 The SS waits for expiry of t_Waits. - -
- - \- EXCEPTION: Steps 14a1 to 14b8 happen if the UE choses to reattempt the
INVITE request, i.e., these steps are optional. The SS waits at most 30 more
seconds for such INVITE request before it terminates the test case. - - - - \-
EXCEPTION: Steps 14a1 to 14b11 describe behaviour that depends on UE
configuration; the "lower case letter" identifies a step sequence that takes
place if such configuration was conducted. - - - - 14a1-14a5 IF the UE is
configured to use preconditions THEN steps 1 to 5 of Annex A.4.1 take place. -
- - - 14a6 Step 10 of generic procedure specified in Table 4.9.15.2.2-1 of TS
38.508-1 [21] is performed. - - - - \- EXCEPTION: In parallel to steps 14a7
and 14a8 below, step 14a9 occurs. - - - - 14a7-14a8 Steps 11-12 of generic
procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21] are performed. -
- - - 14a9-14a15 steps 6 to 12 of Annex A.4.1 take place - - - - 14b1-14b5
ELSE steps 1 to 5 of Annex A.4.2 takes place - - - - 14b6-14b8 Steps 10-12 of
generic procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21] are
performed. - - - - 14b9-14b11 Steps 6 to 8 of Annex A.4.2 take place - - - -
* * *
Table 7.1.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.1.3.3 Specific message contents {#specific-message-contents-8 .H6}
Table 7.1.3.3-1: 503 Service Unavailable (step 9, table 7.1.3.2-1)
Derivation path: TS 34.229-1 [2], Annex A.4.2
* * *
Header/param Cond Value/remark Rel Reference **Retry-After**  
delta-seconds 20
## 7.2 MTSI MO Voice Call / 504 Server Time-out / 5GS
##### 7.2.1 Test Purpose (TP) {#test-purpose-tp-9 .H6}
##### (1) {#section-26 .H6}
**with** { UE being registered to IMS and UE having sent an INVITE request }
**ensure that** {
**when** { UE receives 504 Server Time-out response }
**then** { UE performs initial registration to IMS }
}
##### 7.2.2 Conformance Requirements {#conformance-requirements-10 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 5.1.2A.1.6]
In the event the UE receives a 504 (Server Time-out) response containing:
1) a P-Asserted-Identity header field set to a value equal to a URI:
a) from the Service-Route header field value received during registration; or
b) from the Path header field value received during registration; and
NOTE 1: If there are multiple registration flows associated with the
registration, then the UE has received from the P-CSCF during registration
multiple sets of Path header field and Service-Route header field values. The
Path header field value and Service-Route header field value corresponding to
the flow on which the 504 (Server Time-out) response was received are checked.
2) a Content-Type header field set according to subclause 7.6 (i.e.
\"application/3gpp-ims+xml\"), independent of the value or presence of the
Content-Disposition header field, independent of the value or presence of
Content-Disposition parameters,
then the following treatment is applied:
a) if the 504 (Server Time-out) response includes an IM CN subsystem XML body
as described in subclause 7.6 with the \ element, including a
version attribute, with the \ child element:
A) with the \ child element set to \"restoration\" (see table 7.6.2);
and
B) with the \ child element set to \"initial-registration\" (see table
7.6.3);
then the UE:
\- shall initiate S-CSCF restoration procedures by performing an initial
registration as specified in subclause 5.1.1.2; and
\- may provide an indication to the user based on the text string contained in
the \ child element of the \ child element of the
\ element.
NOTE 2: If the UE has discovered multiple P-CSCF addresses and has information
that the P-CSCF was unable to forward the request resulting in sending back
the 504 (Server Time-out) response, when starting the initial registration it
is appropriate for the UE to select a P-CSCF address different from the one
used for the registration binding on which the 504 (Server Time-out) response
was received.
##### 7.2.3 Test description {#test-description-9 .H6}
##### 7.2.3.1 Pre-test conditions {#pre-test-conditions-9 .H6}
##### System Simulator: {#system-simulator-9 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-9 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- The UE is either configured to use preconditions or to not use
preconditions or does not support preconditions.
##### Preamble: {#preamble-9 .H6}
\- UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.2.3.2 Test procedure sequence {#test-procedure-sequence-9 .H6}
Table 7.2.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is made to attempt an IMS voice call. - - - - 2-7 Steps 2-7 of generic
procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21] are performed. -
- - - \- EXCEPTION: In parallel to INVITE at Steps 8 a or 8b, step described
in Table 7.2.3.2-2: Parallel behaviour takes place. --> \- - - \- EXCEPTION:
Steps 8a to 8b describe behaviour that depends on UE configuration; the "lower
case letter" identifies a step sequence that takes place if such configuration
was conducted. - - - - 8a IF the UE is configured to use preconditions THEN
step 1 of Annex A.4.1 takes place. --> INVITE - - 8b ELSE step 1 of Annex
A.4.2 takes place. --> INVITE - - 9 SS sends 504 Server Time-out \ ACK - - 10 Check: Does the UE send an initial registration request? -->
REGISTER 1 P 11-17 Continue with Annex A.2 steps 2-8 in order to get the UE in
a stable registered state. - - - -
* * *
Table 7.2.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
Table 7.2.3.3-3: ACK (step 9A, Table 7.2.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.2.7 Conditions A1 and
A4
* * *
##### 7.2.3.3 Specific message contents {#specific-message-contents-9 .H6}
Table 7.2.3.3-1: 504 Server Time-out (step 3, Table 7.2.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.4.6
* * *
Table 7.2.3.3-2: REGISTER (step 4, Table 7.2.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.1.1 conditions A1 and
A32
* * *
7.3 Void
## 7.4 Void
## 7.4a MTSI MO Voice Call with preconditions at both originating UE and
terminating UE / Default Configuration / 5GS
##### 7.4a.1 Test Purpose (TP) {#a.1-test-purpose-tp .H6}
##### (1) {#section-27 .H6}
**with** { UE being registered to IMS and configured to use preconditions and
configured to use the EVS default configuration included first in the initial
SDP offer }
**ensure that** {
**when** { UE is being made to initiate a voice call }
**then** { UE sends INVITE for voice call with preconditions and EVS default
configuration }
}
##### (2) {#section-28 .H6}
**with** { UE having sent INVITE with preconditions }
**ensure that** {
**when** { UE receives 100 Trying followed by 183 Session Progress }
**then** { UE sends PRACK for 183 Session Progress }
}
##### (3) {#section-29 .H6}
**with** { UE having sent PRACK }
**ensure that** {
**when** { UE receives 200 OK for PRACK and resources are available }
**then** { UE sends UPDATE }
}
##### (4) {#section-30 .H6}
**with** { UE having sent UPDATE }
**ensure that** {
**when** { UE receives 200 OK for UPDATE followed by 180 Ringing sent reliably
}
**then** { UE sends PRACK for 180 Ringing }
}
##### (5) {#section-31 .H6}
**with** { UE having sent PRACK for 180 Ringing }
**ensure that** {
**when** { UE receives 200 OK for PRACK followed by 200 OK for INVITE }
**then** { UE sends ACK }
}
##### 7.4a.2 Conformance Requirements {#a.2-conformance-requirements .H6}
Same as test case 7.4.
##### 7.4a.2A Profile requirements (Informative) {#a.2a-profile-requirements-
informative .H6}
Same as test case 7.4 with the following additions:
[NG.114 Version 1.0 and 2.0, clause 3.2.2.3]:
The configuration of the EVS payload type to be included first in the initial
SDP offer for EVS is defined by the EVS/Br and EVS/Bw parameters as specified
in Annex C.3, which must be configured to one of the five above EVS
Configurations.
[NG.114 Version 1.0 and 2.0, clause C.3]:
Table C.3-1 contains the configuration parameters with their default values,
that must be supported by the UE and the network. The UE must use the default
value for each parameter in Table C.3-1 unless configured differently as
described in Annex C.2.
...
+--------+----------+-------------------------------------+---------+ | EVS/Br | 5.9-24.4 | Section 15.2 of 3GPP TS 26.114 | 3.2.2.3 | | | | [16] | | | | | | | | | | (/\/Speech/\/EVS/Br) and | | | | | section 5 of 3GPP TS 26.441 [56] | | | | | (Table 1) | | +========+==========+=====================================+=========+ | EVS/Bw | nb-swb | Section 15.2 of 3GPP TS 26.114 | 3.2.2.3 | | | | [16] | | | | | | | | | | (/\/Speech/\/EVS/Bw) and | | | | | section 5 of 3GPP TS 26.441 [56] | | | | | (Table 1) | | +--------+----------+-------------------------------------+---------+
##### 7.4a.3 Test description {#a.3-test-description .H6}
##### 7.4a.3.1 Pre-test conditions {#a.3.1-pre-test-conditions .H6}
##### System Simulator: {#system-simulator-10 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-10 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
##### Preamble: {#preamble-10 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.4a.3.2 Test procedure sequence {#a.3.2-test-procedure-sequence .H6}
Table 7.4a.3.2-1: Main Behaviour
+--------+------------+------------+------------+------------+----+ | **St** | **P |** Message | **TP** | * | | | | rocedure**| Sequence** | | _Verdict_ _| | +--------+------------+------------+------------+------------+----+ | | |__U - S_ _| * | | | | | | |_ Message** | | | +--------+------------+------------+------------+------------+----+ | 1 | UE is made | - | - | - | - | | | to attempt | | | | | | | an IMS | | | | | | | voice | | | | | | | call. | | | | | +--------+------------+------------+------------+------------+----+ | 1A-1F | Steps 2-7 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +--------+------------+------------+------------+------------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | with Step | | | | | | | 2, | | | | | | | parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 7.4a.3.2-2 | | | | | | | takes | | | | | | | place | | | | | +--------+------------+------------+------------+------------+----+ | 2 | UE sends | --> | INVITE | 1 | P | | | INVITE | | | | | | | with first | | | | | | | SDP offer\ | | | | | | | (Step 1 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +--------+------------+------------+------------+------------+----+ | 3 | SS sends a | \ | PRACK | 2 | P | | | 183 | | | | | | | Session | | | | | | | Progress\ | | | | | | | (Step 4 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +--------+------------+------------+------------+------------+----+ | 6 | SS | \ | UPDATE | 3 | P | | | UPDATE | | | | | | | with | | | | | | | second SDP | | | | | | | offer\ | | | | | | | (Step 6 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +--------+------------+------------+------------+------------+----+ | 8 | SS sends | \ | PRACK | 4 | P | | | 180 | | | | | | | Ringing\ | | | | | | | (Step 9 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +--------+------------+------------+------------+------------+----+ | 11 | SS | \ | ACK | 5 | P | | | 200 OK for | | | | | | | INVITE\ | | | | | | | (Step 12 | | | | | | | of Annex | | | | | | | A.4.1a) | | | | | +--------+------------+------------+------------+------------+----+ | 14-15 | SS | - | - | - | - | | | releases | | | | | | | the call. | | | | | | | | | | | | | | (Annex | | | | | | | A.8) | | | | | +--------+------------+------------+------------+------------+----+
Table 7.4a.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.4a.3.3 Specific message contents {#a.3.3-specific-message-contents
.H6}
None.
## 7.5 MTSI MO Voice Call without preconditions at both originating UE and
terminating UE / 5GS
##### 7.5.1 Test Purpose (TP) {#test-purpose-tp-10 .H6}
##### (1) {#section-32 .H6}
**with** { UE being registered to IMS and configured to not use preconditions
}
**ensure that** {
**when** { UE is being made to initiate a voice call }
**then** { UE sends INVITE for voice call without preconditions }
}
##### (2) {#section-33 .H6}
**with** { UE having sent INVITE without preconditions }
**ensure that** {
**when** { UE receives 183 Session Progress without preconditions }
**then** { UE sends PRACK for 183 Session Progress }
}
##### (3) {#section-34 .H6}
**with** { UE having sent PRACK }
**ensure that** {
**when** { UE receives 200 OK for PRACK followed by 180 Ringing followed by
200 OK for INVITE }
**then** { UE sends ACK }
}
##### 7.5.2 Conformance Requirements {#conformance-requirements-11 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
As described in 7.4.2 except:
[TS 24.229, clause 5.1.3.1]:
The \"integration of resource management and SIP\" extension is hereafter in
this subclause referred to as \"the precondition mechanism\" and is defined in
RFC 3312 [30] as updated by RFC 4032 [64].
The preconditions mechanism should be supported by the originating UE.
If the precondition mechanism is disabled as specified in subclause 5.1.5A,
the UE shall not use the precondition mechanism.
[TS 24.229, clause 5.1.5A]:
The precondition disabling policy indicates whether the UE is allowed to use
the precondition mechanism or whether the UE is not allowed to use the
precondition mechanism.
If the precondition disabling policy is not configured, the precondition
disabling policy is assumed to indicate that the UE is allowed to use the
precondition mechanism.
The UE may support the precondition disabling policy.
If the UE supports the precondition disabling policy, the UE may support being
configured with the precondition disabling policy using one or more of the
following methods:
a) the Precondition_disabling_policy node of the EF~IMSConfigDat~a file
described in 3GPP TS 31.102 [15C];
b) the Precondition_disabling_policy node of the EF~IMSConfigData~ file
described in 3GPP TS 31.103 [15B]; and
c) the Precondition_disabling_policy node of 3GPP TS 24.167 [8G].
If the UE is configured with both the Precondition_disabling_policy node of
3GPP TS 24.167 [8G] and the Precondition_disabling_policy node of the
EF~IMSConfigData~ file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103
[15B], then the Precondition_disabling_policy node of the EF~IMSConfigData~
file shall take precedence.
NOTE: Precedence for files configured on both the USIM and ISIM is defined in
3GPP TS 31.103 [15B].
The precondition mechanism is disabled, if the UE supports the precondition
disabling policy and the precondition disabling policy indicates that the UE
is not allowed to use the precondition mechanism.
The precondition mechanism is enabled, if:
1) the UE does not support the precondition disabling policy; or
2) the UE supports the precondition disabling policy and the precondition
disabling policy indicates that the UE is allowed to use the precondition
mechanism.
[TS 24.229, clause 6.1.2]:
An INVITE request generated by a UE shall contain a SDP offer and at least one
media description. This SDP offer shall reflect the calling user\'s terminal
capabilities and user preferences for the session.
...
NOTE 2: If the originating UE does not use the precondition mechanism (see
subclause 5.1.3.1), it will not include any precondition information in the
SDP message body.
##### 7.5.3 Test description {#test-description-10 .H6}
##### 7.5.3.1 Pre-test conditions {#pre-test-conditions-10 .H6}
##### System Simulator: {#system-simulator-11 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-11 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- The UE is configured to not use preconditions.
##### Preamble: {#preamble-11 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.5.3.2 Test procedure sequence {#test-procedure-sequence-10 .H6}
Table 7.5.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is made to attempt an IMS voice call. - - - - 1A-1F Steps 2-7 of generic
procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21] are performed. -
- - - \- EXCEPTION: In parallel with Step 2, parallel behaviour defined in
table 7.5.3.2-2 takes place - - - - 2 Step 1 of Annex A.4.2 happens --> INVITE
1 P 3 Step 2 of Annex A.4.2 happens \ PRACK 2 P 6 Step 5 of Annex A.4.2 happens \ ACK 3 P
* * *
Table 7.5.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.5.3.3 Specific message contents {#specific-message-contents-10 .H6}
None as fully described in annex A.4.2.
## 7.6 Void
## 7.7 MTSI MT Voice Call without preconditions at both originating UE and
terminating UE / 5GS
##### 7.7.1 Test Purpose (TP) {#test-purpose-tp-11 .H6}
##### (1) {#section-35 .H6}
**with** { UE being registered to IMS and configured to not use preconditions
}
**ensure** **that** {
**when** { UE receives INVITE for voice call }
**then** { UE may respond with 100 Trying and then sends 183 Session Progress
with SDP without preconditions }
}
##### (2) {#section-36 .H6}
**with** { UE having sent 183 Session Progress }
**ensure** **that** {
**when** { UE receives PRACK for 183 Session Progress }
**then** { UE sends 200 OK for PRACK }
}
##### (3) {#section-37 .H6}
**with** { UE having sent 200 OK for PRACK }
**ensure** **that** {
**when** { UE is ready to start the call }
**then** { UE sends 180 Ringing followed by 200 OK for INVITE }
}
##### 7.7.2 Conformance Requirements {#conformance-requirements-12 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, annex U.3.1.4]:
Upon receiving an INVITE request not including the \"precondition\" option-tag
in the Supported header field and not including the \"precondition\" option-
tag in the Require header field, and the IP-CAN performs network-initiated
resource reservation for the UE, the UE:
1) if the INVITE request contains an SDP offer and the local resources
required at the terminating UE for the received SDP offer are not available:
a) shall not alert the user; and
b) shall send 183 (Session Progress) response to the INVITE request without
waiting for resource reservation and without alerting the user. If the INVITE
request includes a Supported header field indicating support of reliable
provisional responses, the UE shall send the 183 (Session Progress) response
reliably. In the 183 (Session Progress) response, the UE shall include an SDP
answer; and
2) if the INVITE request does not contain an SDP offer and the INVITE request
includes a Supported header field indicating support of reliable provisional
responses:
a) shall generate an SDP offer;
b) if the local resources required at the terminating UE for the generated SDP
offer are not available:
A) shall not alert the user; and
B) shall reliably send 183 (Session Progress) response to the INVITE request
without waiting for resource reservation and without alerting the user. In the
183 (Session Progress) response, the UE shall include the generated SDP offer.
Upon successful reservation of local resources, if the precondition mechanism
is not used by the terminating UE, the UE can send 180 (Ringing) response to
the INVITE request and can alert the user.
##### 7.7.3 Test description {#test-description-11 .H6}
##### 7.7.3.1 Pre-test conditions {#pre-test-conditions-11 .H6}
##### System Simulator: {#system-simulator-12 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-12 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- The UE is configured to not use preconditions.
##### Preamble: {#preamble-12 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.7.3.2 Test procedure sequence {#test-procedure-sequence-11 .H6}
Table 7.7.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict
                                                                                                                  U - S              Message
0A-0H Steps 1-8 of generic procedure specified in Table 4.9.16.2.2-1 of TS
38.508-1 [21] are performed. - -
1 SS sends INVITE with SDP offer\ \
100 Trying
3 UE sends SDP answer\ --> 183 Session Progress 1 P (Step 3 of Annex A.5.2a)
4 SS acks reception of 183 Session Progress\ \ 200 OK 2 P (Step 5 of Annex A.5.2a)
5A-5C Steps 10-12 of generic procedure specified in Table 4.9.16.2.2-1 of TS
38.508-1 [21] are performed. - - - -
6 UE sends 180 Ringing\ --> 180 Ringing 3 P (Step 6 of Annex A.5.2a)
7 SS sends PRACK (Step 7 of Annex A.5.2a) \ 200 OK
8A Make the UE accept the voice call.
9 UE accepts the voice call\ --> 200 OK  
(Step 9 of Annex A.5.2a)
10 SS acknowledges\ \ 200 OK 1 P 18 Step 10 of Annex A.5.2a happens.
\ ...
>
> 2) if the INVITE request does not contain an SDP offer and the INVITE
> request includes a Supported header field indicating support of reliable
> provisional responses:
>
> a) shall generate an SDP offer;
>
> b) if the local resources required at the terminating UE for the generated
> SDP offer are not available:
>
> A) shall not alert the user; and
>
> B) shall reliably send 183 (Session Progress) response to the INVITE request
> without waiting for resource reservation and without alerting the user. In
> the 183 (Session Progress) response, the UE shall include the generated SDP
> offer.
Upon successful reservation of local resources, if the precondition mechanism
is not used by the terminating UE, the UE can send 180 (Ringing) response to
the INVITE request and can alert the user.
##### 7.10.3 Test description {#test-description-14 .H6}
##### 7.10.3.1 Pre-test conditions {#pre-test-conditions-14 .H6}
##### System Simulator: {#system-simulator-15 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-15 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to not use preconditions.
##### Preamble: {#preamble-15 .H6}
\- UE is in state 1N-A (38.508-1[21]) and registered to IMS
##### 7.10.3.2 Test procedure sequence {#test-procedure-sequence-14 .H6}
Table 7.10.3.2-1: Main Behaviour
+-------+------------+------------+------------+---------+-------+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+------------+------------+------------+---------+-------+ | | | U - S | Message | | | +-------+------------+------------+------------+---------+-------+ | 1 | Steps 1-8 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+------------+------------+------------+---------+-------+ | 2 | Step 1 of | \ | (Optional) | - | - | | | Annex | | 100 Trying | | | | | A.5.2 | | | | | | | happens | | | | | | | | | | | | | | (Note: | | | | | | | this step | | | | | | | is | | | | | | | optional.) | | | | | +-------+------------+------------+------------+---------+-------+ | 4 | Check: | --> | 183 | 1 | P | | | Does the | | Session | | | | | UE send | | Progress | | | | | 183 | | | | | | | Session | | | | | | | Progress | | | | | | | reliably | | | | | | | and | | | | | | | containing | | | | | | | an SDP | | | | | | | offer? | | | | | | | | | | | | | | (Step 3 of | | | | | | | Annex | | | | | | | A.5.2 | | | | | | | happens) | | | | | +-------+------------+------------+------------+---------+-------+ | 5 | Step 4 of | \ | 200 OK | 2 | P | | | Annex | | | | | | | A.5.2 | | | | | | | happens | | | | | | | | | | | | | | (Check: | | | | | | | does the | | | | | | | UE send | | | | | | | 200 OK for | | | | | | | PRACK?) | | | | | +-------+------------+------------+------------+---------+-------+ | 6A-6C | Steps | **-** | **-** | **-** | **-** | | | 10-12 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+------------+------------+------------+---------+-------+ | 7 | Step 6 of | --> | 180 | 3 | P | | | Annex | | Ringing | | | | | A.5.2 | | | | | | | happens | | | | | | | | | | | | | | (Check: | | | | | | | does the | | | | | | | UE send | | | | | | | 180 | | | | | | | Ringing | | | | | | | followed | | | | | | | by 200 OK | | | | | | | for | | | | | | | INVITE?) | | | | | +-------+------------+------------+------------+---------+-------+ | 8 | Step 7 of | \ | (Co | - | - | | | Annex | | nditional) | | | | | A.5.2 | | 200 OK | | | | | happens | | | | | | | | | | | | | | (C | | | | | | | onditional | | | | | | | step: if | | | | | | | UE sent | | | | | | | 180 | | | | | | | Ringing | | | | | | | reliably, | | | | | | | UE | | | | | | | responds | | | | | | | to PRACK) | | | | | +-------+------------+------------+------------+---------+-------+ | 10 | Step 9 of | --> | 200 OK | - | - | | | Annex | | | | | | | A.5.2 | | | | | | | happens | | | | | +-------+------------+------------+------------+---------+-------+ | 11 | Step 10 of | \
(Optional) 100 Trying  
10 UE sends a 420 Bad Extension response with an Unsupported header field
containing the precondition option-tag. --> 420 Bad Extension 1 P 11 SS
acknowledges the reception of 420 Bad Extension. \ a) the received response with an SDP body includes a Require header field
> with \"precondition\" option-tag, the originating UE shall include a Require
> header field with the \"precondition\" option-tag:
>
> \- in subsequent requests that include an SDP body, that the originating UE
> sends in the same dialog as the response is received from; and
>
> \- in responses with an SDP body to subsequent requests that include an SDP
> body and include \"precondition\" option-tag in Supported header field or
> Require header field received in-dialog; or
>
> b) the received response with an SDP body does not include the
> \"precondition\" option-tag in the Require header field,
>
> \- in subsequent requests that include an SDP body, the originating UE shall
> not include a Require or Supported header field with \"precondition\"
> option-tag in the same dialog;
>
> \- in responses with an SDP body to subsequent requests with an SDP body but
> without \"precondition\" option-tag in the Require or Supported header
> field, the originating UE shall not include a Require or Supported header
> field with \"precondition\" option-tag in the same dialog; and
>
> \- in responses with an SDP body to subsequent requests with an SDP body and
> with \"precondition\" option-tag in the Require or Supported header field,
> the originating UE shall include a Require header field with
> \"precondition\" option-tag in the same dialog.
##### 7.12.3 Test description {#test-description-16 .H6}
##### 7.12.3.1 Pre-test conditions {#pre-test-conditions-16 .H6}
##### System Simulator: {#system-simulator-17 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-17 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
##### Preamble: {#preamble-17 .H6}
\- UE is in state 1N-A and registered to IMS
##### 7.12.3.2 Test procedure sequence {#test-procedure-sequence-16 .H6}
Table 7.12.3.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to attempt | | | | | | | an IMS | | | | | | | voice call. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2 | Steps 2-7 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | with Step | | | | | | | 3, parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 7.12.3.2-2 | | | | | | | takes place | | | | | +-------+-------------+-------------+-------------+---------+----+ | 3 | Step 1 of | --> | INVITE | 1 | P | | | Annex A.4.1 | | | | | | | happens | | | | | | | | | | | | | | (Check: | | | | | | | does the UE | | | | | | | send INVITE | | | | | | | for voice | | | | | | | call with | | | | | | | prec | | | | | | | onditions?) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 4 | Step 2 of | \ | PRACK | 2 | P | | | Annex A.4.2 | | | | | | | happens | | | | | | | | | | | | | | (Check: | | | | | | | does the UE | | | | | | | send | | | | | | | PRACK?) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 7 | Step 5 of | \ | ACK | 3 | P | | | Annex A.4.2 | | | | | | | happens | | | | | | | | | | | | | | (Check: | | | | | | | does the UE | | | | | | | send ACK?) | | | | | +-------+-------------+-------------+-------------+---------+----+
**Table 7.12.3.2-2: Parallel behaviour**
**St** **Procedure** **Message Sequence** **TP** **Verdict**
* * *
                                                                       **U - S**              **Message**
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.12.3.3 Specific message contents {#specific-message-contents-16 .H6}
None as fully described in Annex A.4.1 and A.4.2.
## 7.13 MTSI MT Voice Call with RTCP disabled / 5GS
##### 7.13.1 Test Purpose (TP) {#test-purpose-tp-17 .H6}
##### (1) {#section-47 .H6}
**with** { UE being registered to IMS and configured to use preconditions }
**ensure that** {
**when** { UE receives INVITE for voice call with both b=RS and b=RR
attributes set to zero }
**then** { UE may respond with 100 Trying and then sends 183 Session Progress
with SDP with both b=RS and b=RR set to zero and completes setup of voice call
with preconditions }
}
##### 7.13.2 Conformance Requirements {#conformance-requirements-18 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 26.114, clause 7.3.1]
Point-to-point speech only sessions may not require the above functionalities
and may therefore turn off RTCP by setting the SDP bandwidth modifiers (RR and
RS) to zero. When RTCP is turned off (for point-to-point speech only sessions)
and the media is put on hold, the MTSI client should re-negotiate the RTCP
bandwidth with the SDP bandwidth modifier RR value set greater than zero, and
send RTCP packets (i.e., Receiver Reports) to the other end. This allows the
remote end to detect link aliveness during hold. When media is resumed, the
resuming MTSI client should request to turn off the RTCP sending again through
a re-negotiation of the RTCP bandwidth with SDP bandwidth modifiers equal to
zero.
When RTCP is turned off (for point-to-point speech only sessions) and if
sending of an additional associated RTP stream becomes required and both RTP
streams need to be synchronized, or if transport feedback due to lack of end-
to-end QoS guarantees is needed, a MTSI client should re-negotiate the
bandwidth for RTCP by sending an SDP with the RR bandwidth modifier greater
than zero. Setting the RR bandwidth modifier greater than zero allows sending
of RTCP Receiver Reports even when the session is put on hold and neither
terminal is actively sending RTP media.
##### 7.13.3 Profile requirements (Informative) {#profile-requirements-
informative .H6}
[GSMA NG.114 V1.0, cl3.6.3]
The RTP implementation must include an RTP Control Protocol (RTCP)
implementation according to section 7.3.1 of 3GPP TS 26.114 [16].
The UE and the entities in the IMS core network that terminate the user plane
must use symmetric RTCP as defined in IETF RFC 4961 [77], and section 7.3.1 of
3GPP TS 26.114 [16].
The bandwidth for RTCP traffic must be described using the \"RS\" and \"RR\"
SDP bandwidth modifiers at media level, as specified by IETF RFC 3556 [78],
and section 7.3.1 of 3GPP TS 26.114 [16]. Therefore, a UE must include the
\"b=RS:\" and \"b=RR:\" fields in SDP, and a UE and the entities in the IMS
core network that terminate the user plane must be able to interpret them. If
the "b=RS:" field or "b=RR:" field or both these fields are not included in a
received SDP (offer or answer), then the UE must use the recommended default
value for the missing field(s) as defined in IETF RFC 3556 [78].
RTCP is controlled on a per session basis by the SDP offer/answer exchange as
defined in section 7.3 of 3GPP TS 26.114 [16] with the following
clarifications:
1\. If the UE receives an SDP offer that contains "b=RS:" attribute set to
zero, then the UE must set the "b=RS:" attribute to zero in an SDP answer to
that SDP offer. If the UE receives an SDP offer that contains "b=RR:"
attribute set to zero, then the UE must set the "b=RR:" attribute to zero in
an SDP answer to that SDP offer. If the UE receives an SDP offer that contains
both \"b=RR:\" and \"b=RS:\" attributes set to zero, then the UE must not send
RTCP packets and must consider RTCP to be disabled for the session.
2\. If the UE received an SDP answer containing zero values in both of the
"b=RS:" and "b=RR:" attributes, then (regardless of the values assigned to
these attributes in the corresponding SDP offer) the UE must not send RTCP
packets and must consider RTCP to be disabled for the session.
3\. The UE must accept receiving RTCP packets for a session that the UE
considers RTCP to be disabled. The UE is not required to process these
received RTCP packets.
...
##### 7.13.4 Test description {#test-description-17 .H6}
##### 7.13.4.1 Pre-test conditions {#pre-test-conditions-17 .H6}
##### System Simulator: {#system-simulator-18 .H6}
> \- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-18 .H6}
> \- The UE contains either ISIM and USIM applications or only USIM
> application on UICC.
>
> \- The UE is configured to register for IMS after switch on.
>
> \- The UE is configured to use preconditions.
##### Preamble: {#preamble-18 .H6}
\- UE is in state 1N-A and registered to IMS
##### 7.13.4.2 Test procedure sequence {#test-procedure-sequence-17 .H6}
Table 7.13.4.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+---+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+-------------+-------------+-------------+---------+---+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+---+ | 0A-0H | Steps 1-8 | - | - | | | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+---+ | 1 | SS sends | \ | 100 Trying | | | | | step: UE | | | | | | | may send a | | | | | | | 100 Trying | | | | | | | provisional | | | | | | | response. | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex | | | | | | | A.5.1a) | | | | | +-------+-------------+-------------+-------------+---------+---+ | 3 | Check: Does | --> | 183 Session | 1 | P | | | the UE send | | Progress | | | | | 183 Session | | | | | | | Progress | | | | | | | with both | | | | | | | b=RS and | | | | | | | b=RR set to | | | | | | | zero in | | | | | | | SDP? | | | | | +-------+-------------+-------------+-------------+---------+---+ | 4 | SS | \ | 200 OK | 1 | P | | | to PRACK. | | | | | | | (Step 5 of | | | | | | | Annex | | | | | | | A.5.1a) | | | | | +-------+-------------+-------------+-------------+---------+---+ | 5A-5C | Steps 10-12 | - | - | | | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+---+ | 6 | SS sends a | | UPDATE | | | | | second SDP | | | | | | | offer. | | | | | | | (Step 6 of | | | | | | | Annex | | | | | | | A.5.1a) | | | | | +-------+-------------+-------------+-------------+---------+---+ | 7 | UE responds | | 200 OK | | | | | to UPDATE, | | | | | | | including | | | | | | | an SDP | | | | | | | answer. | | | | | | | | | | | | | | (Step 7 of | | | | | | | Annex | | | | | | | A.5.1a) | | | | | +-------+-------------+-------------+-------------+---------+---+ | 8 | UE sends | --> | 180 Ringing | 1 | P | | | 180 | | | | | | | Ringing. | | | | | | | (Step 8 of | | | | | | | Annex | | | | | | | A.5.1a) | | | | | +-------+-------------+-------------+-------------+---------+---+ | 9 | Conditional | \ | 200 OK | | | | | step: if UE | | | | | | | sent 180 | | | | | | | Ringing | | | | | | | reliably, | | | | | | | UE responds | | | | | | | to PRACK. | | | | | | | (Step 10 of | | | | | | | Annex | | | | | | | A.5.1a) | | | | | +-------+-------------+-------------+-------------+---------+---+ | 11 | Make UE | | | | | | | accept the | | | | | | | voice call. | | | | | +-------+-------------+-------------+-------------+---------+---+ | 12 | UE responds | --> | 200 OK | | | | | to INVITE. | | | | | | | (Step 11 of | | | | | | | Annex | | | | | | | A.5.1a) | | | | | +-------+-------------+-------------+-------------+---------+---+ | 13 | SS | \ | INVITE | 1 | P | | | UE send | | | | | | | INVITE with | | | | | | | the first | | | | | | | SDP offer? | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex | | | | | | | A.15.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 4 | SS sends a | \ | PRACK | 2 | P | | | UE | | | | | | | acknowledge | | | | | | | reception | | | | | | | of 183 | | | | | | | Session | | | | | | | Progress? | | | | | | | | | | | | | | (Step 4 of | | | | | | | Annex | | | | | | | A.15.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 7 | SS responds | \ | UPDATE | 3 | P | | | UE send a | | | | | | | second SDP | | | | | | | offer in an | | | | | | | UPDATE | | | | | | | request? | | | | | | | | | | | | | | (Step 6 of | | | | | | | Annex | | | | | | | A.15.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 9 | SS responds | \ | PRACK | 4 | P | | | UE | | | | | | | acknowledge | | | | | | | reception | | | | | | | of 180 | | | | | | | Ringing? | | | | | | | | | | | | | | (Step 9 of | | | | | | | Annex | | | | | | | A.15.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 12 | SS responds | \ | ACK | 5 | P | | | UE | | | | | | | a | | | | | | | cknowledge? | | | | | | | | | | | | | | (Step 12 of | | | | | | | Annex | | | | | | | A.15.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 7.14.3.3 Specific message contents {#specific-message-contents-18 .H6}
None.
## 7.15 MTSI MO Video call without preconditions at both originating UE and
terminating UE / 5GS
##### 7.15.1 Test Purpose (TP) {#test-purpose-tp-19 .H6}
##### (1) {#section-53 .H6}
**with** { UE being registered to IMS and configured to not use preconditions
}
**ensure** **that** {
**when** { UE is being made to initiate a video call }
**then** { UE sends INVITE for video call without preconditions }
}
##### (2) {#section-54 .H6}
**with** { UE having send INVITE without preconditions }
**ensure** **that** {
**when** { UE receives 183 Session Progress without preconditions }
**then** { UE sends PRACK for 183 Session Progress }
}
##### (3) {#section-55 .H6}
**with** { UE having sent PRACK }
**ensure** **that** {
**when** { UE receives 200 OK for PRACK followed by 180 Ringing followed by
200 OK for INVITE }
**then** { UE sends ACK }
}
##### 7.15.2 Conformance Requirements {#conformance-requirements-20 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 6.1.1]:
For \"video\" and \"audio\" media types that utilize the RTP/RTCP, the UE
shall specify the proposed bandwidth for each media stream utilizing the
\"b=\" media descriptor and the \"AS\" bandwidth modifier in the SDP.
...
If the media line in the SDP indicates the usage of RTP/RTCP, and if the UE is
configured to request an RTCP bandwidth level for the session is different
than the default RTCP bandwidth as specified in RFC 3556, then in addition to
the \"AS\" bandwidth modifier in the media-level \"b=\" line, the UE shall
include two media-level \"b=\" lines, one with the \"RS\" bandwidth modifier
and the other with the \"RR\" bandwidth modifier as described in RFC 3556 to
specify the required bandwidth allocation for RTCP. The bandwidth-value in the
b=RS: and b=RR: lines may include transport overhead as described in subclause
6.1 of RFC 3890.
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in 3GPP TS 29.208.
[TS 24.229, clause 6.1.3]:
Upon sending an SDP answer to an SDP offer, with the SDP answer including one
or more media streams for which the originating side did indicate its local
preconditions as not met, if the precondition mechanism is used by the
terminating UE (see subclause 5.1.4.1), the terminating UE shall indicate its
local preconditions and request the confirmation for the result of the
resource reservation at the originating end point.
...
Upon receiving an initial INVITE request that includes the SDP offer
containing an IP address type (in the \"c=\" parameter) that is not supported
by the UE, the UE shall:
\- if the UE is a UE performing the functions of an external attached network
and
1) if the received SDP offer contains an \"altc\" SDP attribute indicating an
alternative and supported IP address; and
2) the UE supports the \"altc\" SDP attribute;
select an IP address type in accordance with RFC 6947 [228]; or
\- otherwise respond with a 488 (Not Acceptable Here) response including a 301
Warning header field indicating \"incompatible network address format\".
NOTE 2: Upon receiving an initial INVITE request that does not include an SDP
offer, the UE can accept the request and include an SDP offer in the first
reliable response. The SDP offer will reflect the called user\'s terminal
capabilities and user preferences for the session.
If the UE receives an SDP offer that specifies different IP address type for
media (i.e. specify it in the \"c=\" parameter of the SDP offer) that the UE
is using for signalling, and if the UE supports both IPv4 and IPv6 addresses
simultaneously, the UE shall accept the received SDP offer. Subsequently, the
UE shall either acquire an IP address type or use an existing IP address type
as specified in the SDP offer, and include it in the \"c=\" parameter in the
SDP answer.
NOTE 3: Upon receiving an initial INVITE request, that includes an SDP offer
containing connection addresses (in the \"c=\" parameter) equal to zero, the
UE will select the media streams that is willing to accept for the session,
reserve the QoS resources for accepted media streams, and include its valid
connection address in the SDP answer.
...
If the terminating UE uses the precondition mechanism (see subclause 5.1.4.1),
if the desired QoS resources for one or more media streams have not been
reserved at the terminating UE when constructing the SDP offer, the
terminating UE shall indicate the related local preconditions for QoS as not
met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032
[64], as well as the strength-tag value \"mandatory\" for the local segment
and the strength-tag value either \"optional\" or as specified in RFC 3312
[30] and RFC 4032 [64] for the remote segment.
NOTE 7: It is out of scope of this specification which media streams are to be
included in the SDP offer.
If the terminating UE uses the precondition mechanism (see subclause 5.1.4.1)
and if the desired QoS resources for one or more media streams are available
at the terminating UE when the SDP offer is sent, the UE shall indicate the
related local preconditions as met, using the segmented status type, as
defined in RFC 3312 [30] and RFC 4032 [64], as well as the strength-tag value
\"mandatory\" for the local segment and the strength-tag value either
\"optional\" or as specified in RFC 3312 [30] and RFC 4032 [64] for the remote
segment.
If the terminating UE sends an UPDATE request to remove one or more media
streams negotiated in the session for which a final response to the INVITE
request has not been sent yet, the terminating UE sets the ports of the media
streams to be removed from the session to zero in the new SDP offer.
NOTE 8: Upon receiving an initial INVITE request with one or more media
streams which the terminating UE supports and one or more media streams which
the UE does not support, the UE is not expected to reject the INVITE request
just because of the presence of the unsupported media stream.
NOTE 9: Previous versions of this document mandated the use of the SDP
inactive attribute in the SDP offer if the desired QoS resources for one or
more media streams had not been reserved at the originating UE when
constructing the SDP offer unless the originating UE knew that the
precondition mechanism was supported by the remote UE. The use can still occur
when interoperating with devices based on earlier versions of this document.
[TS 26.114, clause 5.2.2]:
MTSI clients in terminals offering video communication shall support:
\- H.264 (AVC) [24] Constrained Baseline Profile (CBP) Level 1.2;
\- H.265 (HEVC) [119] Main Profile, Main Tier, Level 3.1.
In addition they should support:
\- H.264 (AVC) [24] Constrained High Profile (CHP) Level 3.1.
[TS 26.114, clause 6.2.3.2]:
If video is used in a session, the session setup shall determine the
applicable bandwidth(s) as defined in clause 6.2.5, RTP profile, video codec,
profile and level. The \"imageattr\" attribute as specified in [76] should be
supported. The \"framesize\" attribute as specified in [60] shall not be used
in the session setup.
An MTSI client shall offer AVPF for all media streams containing video. RTP
profile negotiation shall be done as described in clause 6.2.1a.
An MTSI client is required to support the AVPF feedback messages trr-int, NACK
and PLI [40] and the CCM feedback messages FIR, TMMBR and TMMBN [43], see
Clauses 7.3.3 and 10.3. These feedback messages can only be used together with
AVPF and shall be negotiated in SDP offer/answer before they can be used in
the session [40]. An MTSI client sending an SDP offer for AVPF shall also
include these AVPF and CCM feedback messages in the offer. An MTSI client
accepting an SDP offer for AVPF for video shall also accept these AVPF and CCM
feedback messages if they are offered.
If an MTSI client offers to use ECN for video in RTP streams then the MTSI
client shall offer ECN Capable Transport as defined below. If an MTSI client
accepts an offer for ECN for video then the MTSI client shall declare ECN
Capable Transport in the SDP answer as defined below. The SDP negotiation of
ECN Capable Transport is described in [84].
The use of ECN for a video stream in RTP is negotiated with the \"ecn-capable-
rtp\" SDP attribute, [84]. ECN is enabled when both clients agree to use ECN
as configured below. An MTSI client using ECN shall therefore also include the
following parameters and parameter values for the ECN attribute:
\- 'leap', to indicate that the leap-of-faith initiation method shall be used;
\- 'ect=0', to indicate that ECT(0) shall be set for every packet.
An MTSI client offering ECN for video shall indicate support of TMMBR [43] by
including the \"ccm tmmbr\" value within an \"rtcp-fb\" SDP attribute [40]. An
MTSI client offering ECN for video may indicate support for RTCP AVPF ECN
feedback messages [84] using the \"rtcp-fb\" SDP attribute with the \"nack\"
feedback parameter and the \"ecn\" feedback parameter value. An MTSI client
offering ECN for video may indicate support for RTCP XR ECN summary reports
[84] using the \"rtcp-xr\" SDP attribute and the \"ecn-sum\" parameter.
An MTSI client receiving an offer for ECN for video with an indication of
support of TMMBR [43] within an \"rtcp-fb\" attribute should accept the offer
if it supports ECN. It shall then indicate support for TMMBR using an \"rtcp-
fb\" attribute in the SDP answer.
An MTSI client receiving an offer for ECN for video with an indication of
support of RTCP AVPF ECN feedback message but without support for TMMBR should
accept the offer if it supports ECN and also the RTCP AVPF ECN feedback
message. It shall then indicate support of the RTCP AVPF ECN feedback message
using the \"rtcp-fb\" attribute in the SDP answer.
An MTSI client receiving an offer for ECN for video with an indication of
support of RTCP XR ECN summary reports [84] without support for TMMBR should
accept the offer if it supports ECN and also the RTCP XR ECN summary reports.
It shall then indicate support of RTCP XR ECN summary reports in the SDP
answer.
The use of ECN is disabled when a client sends an SDP without the \"ecn-
capable-rtp\" SDP attribute.
An MTSI client may initiate a session re-negotiation to disable ECN to resolve
ECN-related error cases. An ECN-related error case may be, for example,
detecting non-ECT in the received packets when ECT(0) was expected or
detecting a very high packet loss rate when ECN is used.
Examples of SDP offers and answers for video can be found in clause A.4. SDP
examples for offering and accepting ECT are shown in Annex A.12.2.
NOTE: For H.264 / MPEG-4 (Part 10) AVC, the optional max-rcmd-nalu-size
receiver-capability parameter of RFC 6184 [25] should be set to the smaller of
the MTU size (if known) minus header size or 1 400 bytes (otherwise).
The \"framerate\" attribute as specified in [8] indicates the maximum frame
rate the offerer wishes to receive. If the \"framerate\" attribute is present
in the SDP offer, its value may be modified in the SDP answer when the
answerer wishes to receive video with a different maximum frame rate than what
was indicated in the offer.
An MTSI client in terminal setting up asymmetric video streams with H.264
(AVC) should use both the 'level-asymmetry-allowed' parameter and the 'max-
recv-level' parameter that are defined in the H.264 payload format, [25]. When
the 'max-recv-level' parameter is used then the level offered for the
receiving direction using the 'max-recv-level' parameter must be higher than
the default level that is offered with the 'profile-level-id' parameter.
An SDP offer-answer example showing the usage of the 'level-asymmetry-allowed'
and 'max-recv-level' parameters is included in Annex A.4.5.
An MTSI client in terminal setting up asymmetric video streams with H.265
(HEVC) should use the 'max-recv-level-id' parameter that is defined in the
H.265 payload format, [120]. The level offered for the receiving direction
using the 'max-recv-level-id' parameter must be higher than the default level
that is offered with the 'level-id' parameter.
An SDP offer-answer example showing the usage of the 'max-recv-level-id'
parameter is included in Annex A.4.8.
The resolutions in the \"imageattr\" attribute correspond to the image size
information in the encoded video bitstream such that the x-component
corresponds to the image width, and the y-component corresponds to the height
component. When the bit-rate is being adapted, values of image width or image
height smaller than the x- or y-component(s) in the negotiated \"imageattr\"
attribute may be temporarily used.
##### 7.15.3 Profile requirements (Informative) {#profile-requirements-
informative-1 .H6}
[GSMA NG.114 V1.0, clause 3.3.1]:
The entities in the IMS core network that terminate the user plane must
support ITU-T Recommendation H.264 [83] Constrained Baseline Profile (CBP)
Level 1.2 implemented as specified in section 5.2.2 of 3GPP TS 26.114 [16].
The UE must support ITU-T Recommendation H.264 [83] Constrained High Profile
(CHP) Level 3.1 as specified in section 5.2.2 of 3GPP TS 26.114 [16].
The UE must support ITU-T Recommendation H.265 [84] Main Profile, Main Tier
Level 3.1 as specified in section 5.2.2 of 3GPP TS 26.114 [16].
For backward compatibility, the UE must also support ITU-T Recommendation
H.264 [83] Constrained Baseline Profile (CBP) Level 3.1 as specified in
section 5.2.2 of 3GPP TS 26.114 [16], and when H.264 [83] (Advanced Video
Coding (AVC)) CHP Level 3.1 is offered, then H.264 [83] CBP Level 3.1 must
also be offered.
[GSMA NG.114 V1.0, clause 3.3.2.1]:
The Session Description Protocol (SDP) offer/answer for video media must be
formatted as specified in section 6.2.3 of 3GPP TS 26.114 [16], along with the
restrictions included in the present document.
Unless preconfigured otherwise by the home operator with the
Media_type_restriction_policy parameter as specified in Annex C.3 and when
offering video media that is not already part of the session, regardless if it
is at the start of the session or at some later point in time, the UE must
include in the SDP offer at least:
> 1\. One H.265 (HEVC) Main Profile, Main Tier, Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
>
> 2\. One H.264 (AVC) Constrained High Profile Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
>
> 3\. One H.264 (AVC) Constrained Baseline Profile Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
The payload type preference order on the SDP m= line must be as specified by
the numbered list above.
Coordination of Video Orientation (CVO) as specified in 3GPP TS 26.114 [16]
shall be supported with two (2) bits granularity by the UE and the entities in
the IMS core network which terminate the user plane. The support for CVO shall
be included in SDP offer and SDP answer as specified in section 6.2.3 of 3GPP
TS 26.114 [16].
[GSMA NG.114 V1.0, clause 3.3.2.2]:
If an asymmetric video stream for H.265 (HEVC) is supported, the parameter
'max-recv-level-id' should be included in the SDP offer and SDP answer, and
the level offered with it must be higher than the default level offered with
the 'level-id' parameter in the SDP offer/answer respectively, as specified in
section 7.1 of IETF RFC 7798 [86] and section 6.2.3 of 3GPP TS 26.114 [16].
##### 7.15.4 Test description {#test-description-19 .H6}
##### 7.15.4.1 Pre-test conditions {#pre-test-conditions-19 .H6}
##### System Simulator: {#system-simulator-20 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-20 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to not use preconditions.
##### Preamble: {#preamble-20 .H6}
\- UE is in state 1N-A and registered to IMS
##### 7.15.4.2 Test procedure sequence {#test-procedure-sequence-19 .H6}
Table 7.15.4.2-1: Main Behaviour
+-------+---------------+---------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+---------------+---------------+---------+---------+----+ | | | U - S | Message | | | +-------+---------------+---------------+---------+---------+----+ | 0A | UE is made to | - | | - | - | | | attempt an | | | | | | | IMS video | | | | | | | call. | | | | | +-------+---------------+---------------+---------+---------+----+ | 0B-0H | Steps 2-8 | - | | - | - | | | from generic | | | | | | | procedure | | | | | | | specified in | | | | | | | TS 38.508-1 | | | | | | | [21] Table | | | | | | | 4.9.24.2.2-1 | | | | | | | are | | | | | | | performed. | | | | | +-------+---------------+---------------+---------+---------+----+ | 1 | UE sends | -> | INVITE | 1 | P | | | INVITE with | | | | | | | the first SDP | | | | | | | offer, | | | | | | | without | | | | | | | p | | | | | | | reconditions. | | | | | | | (Step 1 of | | | | | | | Annex A.15.2) | | | | | +-------+---------------+---------------+---------+---------+----+ | 2-3 | Step 2-3 of | - | - | - | - | | | Annex A.15.2 | | | | | +-------+---------------+---------------+---------+---------+----+ | 4 | UE | -> | PRACK | 2 | P | | | acknowledges | | | | | | | the receipt | | | | | | | of 183 | | | | | | | response. | | | | | | | | | | | | | | (Step 4 of | | | | | | | Annex A.15.2) | | | | | +-------+---------------+---------------+---------+---------+----+ | - | EXCEPTION: In | - | - | - | - | | | parallel with | | | | | | | step 5-9, | | | | | | | parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 7.15.4.2-2 is | | | | | | | executed | | | | | +-------+---------------+---------------+---------+---------+----+ | 5-9 | Step 5-9 of | \ | ACK | 3 | P | | | acknowledges. | | | | | | | (Step 10 of | | | | | | | Annex A.15.2) | | | | | +-------+---------------+---------------+---------+---------+----+
Table 7.15.4.2-2: Parallel Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1-3 Steps 10-12 from generic procedure specified in TS 38.508-1 [21] Table
4.9.24.2.2-1 are performed. - - -
* * *
##### 7.15.4.3 Specific message contents {#specific-message-contents-19 .H6}
None as fully specified in Annex A.15.2.
## 7.16 MTSI MT Video call with preconditions at both originating UE and
terminating UE / 5GS
##### 7.16.1 Test Purpose (TP) {#test-purpose-tp-20 .H6}
##### (1) {#section-56 .H6}
**with** { UE being registered to IMS and configured to use preconditions }
**ensure** **that** {
**when** { UE receives INVITE for video call }
**then** { UE may respond with 100 Trying }
}
##### (2) {#section-57 .H6}
**with** { UE being registered to IMS and configured to use preconditions }
**ensure** **that** {
**when** { UE receives INVITE for video call }
**then** { UE responds with 183 Session Progress including SDP }
}
##### (3) {#section-58 .H6}
**with** { UE having sent 183 Session Progress }
**ensure** **that** {
**when** { UE receives PRACK for 183 Session Progress }
**then** { UE sends 200 OK for PRACK }
}
##### (4) {#section-59 .H6}
**with** { UE having sent 200 OK for PRACK }
**ensure** **that** {
**when** { UE receives UPDATE including SDP }
**then** { UE sends 200 OK for UPDATE including SDP and 180 Ringing }
}
##### (5) {#section-60 .H6}
**with** { UE having sent 180 Ringing, possibly reliably }
**ensure** **that** {
**when** { 180 Ringing was sent reliably and consequently UE receives PRACK
for 180 Ringing }
**then** { UE sends 200 OK for PRACK }
}
##### (6) {#section-61 .H6}
**with** { UE having sent 180 Ringing }
**ensure** **that** {
**when** { User accepts the incoming video call request }
then { UE sends 200 OK for INVITE }
}
##### (7) {#section-62 .H6}
**with** { UE having sent 200 OK for INVITE }
**ensure** **that** {
**when** { UE receives ACK followed by BYE }
**then** { UE sends 200 OK for BYE }
}
##### 7.16.2 Conformance Requirements {#conformance-requirements-21 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 6.1.1]:
For \"video\" and \"audio\" media types that utilize the RTP/RTCP, the UE
shall specify the proposed bandwidth for each media stream utilizing the
\"b=\" media descriptor and the \"AS\" bandwidth modifier in the SDP.
...
If the media line in the SDP indicates the usage of RTP/RTCP, and if the UE is
configured to request an RTCP bandwidth level for the session is different
than the default RTCP bandwidth as specified in RFC 3556, then in addition to
the \"AS\" bandwidth modifier in the media-level \"b=\" line, the UE shall
include two media-level \"b=\" lines, one with the \"RS\" bandwidth modifier
and the other with the \"RR\" bandwidth modifier as described in RFC 3556 to
specify the required bandwidth allocation for RTCP. The bandwidth-value in the
b=RS: and b=RR: lines may include transport overhead as described in subclause
6.1 of RFC 3890.
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in 3GPP TS 29.208.
[TS 24.229, clause 6.1.3]:
Upon sending an SDP answer to an SDP offer, with the SDP answer including one
or more media streams for which the originating side did indicate its local
preconditions as not met, if the precondition mechanism is used by the
terminating UE (see subclause 5.1.4.1), the terminating UE shall indicate its
local preconditions and request the confirmation for the result of the
resource reservation at the originating end point.
...
Upon receiving an initial INVITE request that includes the SDP offer
containing an IP address type (in the \"c=\" parameter) that is not supported
by the UE, the UE shall:
\- if the UE is a UE performing the functions of an external attached network
and
1) if the received SDP offer contains an \"altc\" SDP attribute indicating an
alternative and supported IP address; and
2) the UE supports the \"altc\" SDP attribute;
select an IP address type in accordance with RFC 6947 [228]; or
\- otherwise respond with a 488 (Not Acceptable Here) response including a 301
Warning header field indicating \"incompatible network address format\".
NOTE 2: Upon receiving an initial INVITE request that does not include an SDP
offer, the UE can accept the request and include an SDP offer in the first
reliable response. The SDP offer will reflect the called user\'s terminal
capabilities and user preferences for the session.
If the UE receives an SDP offer that specifies different IP address type for
media (i.e. specify it in the \"c=\" parameter of the SDP offer) that the UE
is using for signalling, and if the UE supports both IPv4 and IPv6 addresses
simultaneously, the UE shall accept the received SDP offer. Subsequently, the
UE shall either acquire an IP address type or use an existing IP address type
as specified in the SDP offer, and include it in the \"c=\" parameter in the
SDP answer.
NOTE 3: Upon receiving an initial INVITE request, that includes an SDP offer
containing connection addresses (in the \"c=\" parameter) equal to zero, the
UE will select the media streams that is willing to accept for the session,
reserve the QoS resources for accepted media streams, and include its valid
connection address in the SDP answer.
...
If the terminating UE uses the precondition mechanism (see subclause 5.1.4.1),
if the desired QoS resources for one or more media streams have not been
reserved at the terminating UE when constructing the SDP offer, the
terminating UE shall indicate the related local preconditions for QoS as not
met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032
[64], as well as the strength-tag value \"mandatory\" for the local segment
and the strength-tag value either \"optional\" or as specified in RFC 3312
[30] and RFC 4032 [64] for the remote segment.
NOTE 7: It is out of scope of this specification which media streams are to be
included in the SDP offer.
If the terminating UE uses the precondition mechanism (see subclause 5.1.4.1)
and if the desired QoS resources for one or more media streams are available
at the terminating UE when the SDP offer is sent, the UE shall indicate the
related local preconditions as met, using the segmented status type, as
defined in RFC 3312 [30] and RFC 4032 [64], as well as the strength-tag value
\"mandatory\" for the local segment and the strength-tag value either
\"optional\" or as specified in RFC 3312 [30] and RFC 4032 [64] for the remote
segment.
If the terminating UE sends an UPDATE request to remove one or more media
streams negotiated in the session for which a final response to the INVITE
request has not been sent yet, the terminating UE sets the ports of the media
streams to be removed from the session to zero in the new SDP offer.
NOTE 8: Upon receiving an initial INVITE request with one or more media
streams which the terminating UE supports and one or more media streams which
the UE does not support, the UE is not expected to reject the INVITE request
just because of the presence of the unsupported media stream.
NOTE 9: Previous versions of this document mandated the use of the SDP
inactive attribute in the SDP offer if the desired QoS resources for one or
more media streams had not been reserved at the originating UE when
constructing the SDP offer unless the originating UE knew that the
precondition mechanism was supported by the remote UE. The use can still occur
when interoperating with devices based on earlier versions of this document.
[TS 26.114, clause 5.2.2]:
MTSI clients in terminals offering video communication shall support:
\- H.264 (AVC) [24] Constrained Baseline Profile (CBP) Level 1.2;
\- H.265 (HEVC) [119] Main Profile, Main Tier, Level 3.1.
In addition they should support:
\- H.264 (AVC) [24] Constrained High Profile (CHP) Level 3.1.
[TS 26.114, clause 6.2.3.2]:
If video is used in a session, the session setup shall determine the
applicable bandwidth(s) as defined in clause 6.2.5, RTP profile, video codec,
profile and level. The \"imageattr\" attribute as specified in [76] should be
supported. The \"framesize\" attribute as specified in [60] shall not be used
in the session setup.
An MTSI client shall offer AVPF for all media streams containing video. RTP
profile negotiation shall be done as described in clause 6.2.1a.
An MTSI client is required to support the AVPF feedback messages trr-int, NACK
and PLI [40] and the CCM feedback messages FIR, TMMBR and TMMBN [43], see
Clauses 7.3.3 and 10.3. These feedback messages can only be used together with
AVPF and shall be negotiated in SDP offer/answer before they can be used in
the session [40]. An MTSI client sending an SDP offer for AVPF shall also
include these AVPF and CCM feedback messages in the offer. An MTSI client
accepting an SDP offer for AVPF for video shall also accept these AVPF and CCM
feedback messages if they are offered.
If an MTSI client offers to use ECN for video in RTP streams then the MTSI
client shall offer ECN Capable Transport as defined below. If an MTSI client
accepts an offer for ECN for video then the MTSI client shall declare ECN
Capable Transport in the SDP answer as defined below. The SDP negotiation of
ECN Capable Transport is described in [84].
The use of ECN for a video stream in RTP is negotiated with the \"ecn-capable-
rtp\" SDP attribute, [84]. ECN is enabled when both clients agree to use ECN
as configured below. An MTSI client using ECN shall therefore also include the
following parameters and parameter values for the ECN attribute:
\- 'leap', to indicate that the leap-of-faith initiation method shall be used;
\- 'ect=0', to indicate that ECT(0) shall be set for every packet.
An MTSI client offering ECN for video shall indicate support of TMMBR [43] by
including the \"ccm tmmbr\" value within an \"rtcp-fb\" SDP attribute [40]. An
MTSI client offering ECN for video may indicate support for RTCP AVPF ECN
feedback messages [84] using the \"rtcp-fb\" SDP attribute with the \"nack\"
feedback parameter and the \"ecn\" feedback parameter value. An MTSI client
offering ECN for video may indicate support for RTCP XR ECN summary reports
[84] using the \"rtcp-xr\" SDP attribute and the \"ecn-sum\" parameter.
An MTSI client receiving an offer for ECN for video with an indication of
support of TMMBR [43] within an \"rtcp-fb\" attribute should accept the offer
if it supports ECN. It shall then indicate support for TMMBR using an \"rtcp-
fb\" attribute in the SDP answer.
An MTSI client receiving an offer for ECN for video with an indication of
support of RTCP AVPF ECN feedback message but without support for TMMBR should
accept the offer if it supports ECN and also the RTCP AVPF ECN feedback
message. It shall then indicate support of the RTCP AVPF ECN feedback message
using the \"rtcp-fb\" attribute in the SDP answer.
An MTSI client receiving an offer for ECN for video with an indication of
support of RTCP XR ECN summary reports [84] without support for TMMBR should
accept the offer if it supports ECN and also the RTCP XR ECN summary reports.
It shall then indicate support of RTCP XR ECN summary reports in the SDP
answer.
The use of ECN is disabled when a client sends an SDP without the \"ecn-
capable-rtp\" SDP attribute.
An MTSI client may initiate a session re-negotiation to disable ECN to resolve
ECN-related error cases. An ECN-related error case may be, for example,
detecting non-ECT in the received packets when ECT(0) was expected or
detecting a very high packet loss rate when ECN is used.
Examples of SDP offers and answers for video can be found in clause A.4. SDP
examples for offering and accepting ECT are shown in Annex A.12.2.
NOTE: For H.264 / MPEG-4 (Part 10) AVC, the optional max-rcmd-nalu-size
receiver-capability parameter of RFC 6184 [25] should be set to the smaller of
the MTU size (if known) minus header size or 1 400 bytes (otherwise).
The \"framerate\" attribute as specified in [8] indicates the maximum frame
rate the offerer wishes to receive. If the \"framerate\" attribute is present
in the SDP offer, its value may be modified in the SDP answer when the
answerer wishes to receive video with a different maximum frame rate than what
was indicated in the offer.
An MTSI client in terminal setting up asymmetric video streams with H.264
(AVC) should use both the 'level-asymmetry-allowed' parameter and the 'max-
recv-level' parameter that are defined in the H.264 payload format, [25]. When
the 'max-recv-level' parameter is used then the level offered for the
receiving direction using the 'max-recv-level' parameter must be higher than
the default level that is offered with the 'profile-level-id' parameter.
An SDP offer-answer example showing the usage of the 'level-asymmetry-allowed'
and 'max-recv-level' parameters is included in Annex A.4.5.
An MTSI client in terminal setting up asymmetric video streams with H.265
(HEVC) should use the 'max-recv-level-id' parameter that is defined in the
H.265 payload format, [120]. The level offered for the receiving direction
using the 'max-recv-level-id' parameter must be higher than the default level
that is offered with the 'level-id' parameter.
An SDP offer-answer example showing the usage of the 'max-recv-level-id'
parameter is included in Annex A.4.8.
The resolutions in the \"imageattr\" attribute correspond to the image size
information in the encoded video bitstream such that the x-component
corresponds to the image width, and the y-component corresponds to the height
component. When the bit-rate is being adapted, values of image width or image
height smaller than the x- or y-component(s) in the negotiated \"imageattr\"
attribute may be temporarily used.
##### 7.16.3 Profile requirements (Informative) {#profile-requirements-
informative-2 .H6}
[GSMA NG.114 V1.0, cluse 3.3.1]:
The entities in the IMS core network that terminate the user plane must
support ITU-T Recommendation H.264 [83] Constrained Baseline Profile (CBP)
Level 1.2 implemented as specified in section 5.2.2 of 3GPP TS 26.114 [16].
The UE must support ITU-T Recommendation H.264 [83] Constrained High Profile
(CHP) Level 3.1 as specified in section 5.2.2 of 3GPP TS 26.114 [16].
The UE must support ITU-T Recommendation H.265 [84] Main Profile, Main Tier
Level 3.1 as specified in section 5.2.2 of 3GPP TS 26.114 [16].
For backward compatibility, the UE must also support ITU-T Recommendation
H.264 [83] Constrained Baseline Profile (CBP) Level 3.1 as specified in
section 5.2.2 of 3GPP TS 26.114 [16], and when H.264 [83] (Advanced Video
Coding (AVC)) CHP Level 3.1 is offered, then H.264 [83] CBP Level 3.1 must
also be offered.
[GSMA NG.114 V1.0, cluse 3.3.2.1]:
The Session Description Protocol (SDP) offer/answer for video media must be
formatted as specified in section 6.2.3 of 3GPP TS 26.114 [16], along with the
restrictions included in the present document.
Unless preconfigured otherwise by the home operator with the
Media_type_restriction_policy parameter as specified in Annex C.3 and when
offering video media that is not already part of the session, regardless if it
is at the start of the session or at some later point in time, the UE must
include in the SDP offer at least:
> 1\. One H.265 (HEVC) Main Profile, Main Tier, Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
>
> 2\. One H.264 (AVC) Constrained High Profile Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
>
> 3\. One H.264 (AVC) Constrained Baseline Profile Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
The payload type preference order on the SDP m= line must be as specified by
the numbered list above.
Coordination of Video Orientation (CVO) as specified in 3GPP TS 26.114 [16]
shall be supported with two (2) bits granularity by the UE and the entities in
the IMS core network which terminate the user plane. The support for CVO shall
be included in SDP offer and SDP answer as specified in section 6.2.3 of 3GPP
TS 26.114 [16].
[GSMA NG.114 V1.0, cluse 3.3.2.2]:
If an asymmetric video stream for H.265 (HEVC) is supported, the parameter
'max-recv-level-id' should be included in the SDP offer and SDP answer, and
the level offered with it must be higher than the default level offered with
the 'level-id' parameter in the SDP offer/answer respectively, as specified in
section 7.1 of IETF RFC 7798 [86] and section 6.2.3 of 3GPP TS 26.114 [16].
##### 7.16.4 Test description {#test-description-20 .H6}
##### 7.16.4.1 Pre-test conditions {#pre-test-conditions-20 .H6}
##### System Simulator: {#system-simulator-21 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-21 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
##### Preamble: {#preamble-21 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 7.16.4.2 Test procedure sequence {#test-procedure-sequence-20 .H6}
Table 7.16.4.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+-------------+-------------+-------------+---------+----+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 0A-0H | Steps 1-8 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.26.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | SS sends | \ | 100 Trying | 1 | -P | | | (Optional) | | | | | | | Does the UE | | | | | | | respond | | | | | | | with a 100 | | | | | | | Trying | | | | | | | provisional | | | | | | | response? | | | | | | | (Step 2 of | | | | | | | Annex | | | | | | | A.16.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 3 | Check: Does | -> | 183 Session | 2 | P | | | the UE send | | Progress | | | | | 183 | | | | | | | response | | | | | | | reliably | | | | | | | with the | | | | | | | SDP answer | | | | | | | to the | | | | | | | offer in | | | | | | | INVITE? | | | | | | | (Step 3 of | | | | | | | Annex | | | | | | | A.16.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 4 | SS | \ | 200 OK | 3 | P | | | the UE | | | | | | | responds to | | | | | | | PRACK with | | | | | | | 200 OK. | | | | | | | | | | | | | | (Step 5 of | | | | | | | Annex | | | | | | | A.16.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 5A | SS triggers | - | - | - | - | | | resource | | | | | | | reservation | | | | | | | by | | | | | | | executing | | | | | | | steps 10-12 | | | | | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.26.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21]. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 6 | SS sends an | \ | 200 OK | 4 | P | | | the UE | | | | | | | a | | | | | | | cknowledges | | | | | | | the UPDATE | | | | | | | with 200 OK | | | | | | | and | | | | | | | includes | | | | | | | SDP answer | | | | | | | to | | | | | | | acknowledge | | | | | | | its current | | | | | | | p | | | | | | | recondition | | | | | | | status. | | | | | | | (Step 7 of | | | | | | | Annex | | | | | | | A.16.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 8 | Check: | -> | 180 Ringing | - | - | | | (Optional) | | | | | | | Does the UE | | | | | | | responds to | | | | | | | INVITE with | | | | | | | 180 | | | | | | | Ringing? | | | | | | | (Step 8 of | | | | | | | Annex | | | | | | | A.16.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 9 | (Optional) | \ | 200 OK | 5 | P | | | (Optional) | | | | | | | Does the UE | | | | | | | a | | | | | | | cknowledges | | | | | | | the PRACK | | | | | | | with 200 | | | | | | | OK? (Step | | | | | | | 10 of Annex | | | | | | | A.16.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 11 | UE is made | - | - | - | - | | | to answer | | | | | | | the call. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 12 | Check: Does | -> | 200 OK | 6 | P | | | the UE | | | | | | | responds to | | | | | | | INVITE with | | | | | | | a 200 OK | | | | | | | final | | | | | | | response | | | | | | | after the | | | | | | | user | | | | | | | answers the | | | | | | | call? | | | | | | | | | | | | | | (Step 12 of | | | | | | | Annex | | | | | | | A.16.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 13 | The SS | \ | 200 OK | 7 | P | | | the UE | | | | | | | sends 200 | | | | | | | OK for BYE. | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.8) | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 7.16.4.3 Specific message contents {#specific-message-contents-20 .H6}
None as fully specified in A.16.1a and A.8.
## 7.17 MTSI MT Video call without preconditions at both originating UE and
terminating UE / 5GS
##### 7.17.1 Test Purpose (TP) {#test-purpose-tp-21 .H6}
##### (1) {#section-63 .H6}
**with** { UE being registered to IMS and configured to not use preconditions
}
**ensure** **that** {
**when** { UE receives INVITE for video call }
**then** { UE may respond with 100 Trying and then sends 183 Session Progress
with SDP without preconditions }
}
##### (2) {#section-64 .H6}
**with** { UE having sent 183 Session Progress }
**ensure** **that** {
**when** { UE receives PRACK for 183 Session Progress }
**then** { UE sends 200 OK for PRACK }
}
##### (3) {#section-65 .H6}
**with** { UE having sent 200 OK for PRACK }
**ensure** **that** {
**when** { UE is ready to start the call }
**then** { UE sends 180 Ringing followed by 200 OK for INVITE }
}
##### 7.17.2 Conformance Requirements {#conformance-requirements-22 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 6.1.1]:
For \"video\" and \"audio\" media types that utilize the RTP/RTCP, the UE
shall specify the proposed bandwidth for each media stream utilizing the
\"b=\" media descriptor and the \"AS\" bandwidth modifier in the SDP.
...
If the media line in the SDP indicates the usage of RTP/RTCP, and if the UE is
configured to request an RTCP bandwidth level for the session is different
than the default RTCP bandwidth as specified in RFC 3556, then in addition to
the \"AS\" bandwidth modifier in the media-level \"b=\" line, the UE shall
include two media-level \"b=\" lines, one with the \"RS\" bandwidth modifier
and the other with the \"RR\" bandwidth modifier as described in RFC 3556 to
specify the required bandwidth allocation for RTCP. The bandwidth-value in the
b=RS: and b=RR: lines may include transport overhead as described in subclause
6.1 of RFC 3890.
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in 3GPP TS 29.208.
[TS 24.229, clause 6.1.3]:
Upon sending an SDP answer to an SDP offer, with the SDP answer including one
or more media streams for which the originating side did indicate its local
preconditions as not met, if the precondition mechanism is used by the
terminating UE (see subclause 5.1.4.1), the terminating UE shall indicate its
local preconditions and request the confirmation for the result of the
resource reservation at the originating end point.
...
Upon receiving an initial INVITE request that includes the SDP offer
containing an IP address type (in the \"c=\" parameter) that is not supported
by the UE, the UE shall:
\- if the UE is a UE performing the functions of an external attached network
and
1) if the received SDP offer contains an \"altc\" SDP attribute indicating an
alternative and supported IP address; and
2) the UE supports the \"altc\" SDP attribute;
select an IP address type in accordance with RFC 6947 [228]; or
\- otherwise respond with a 488 (Not Acceptable Here) response including a 301
Warning header field indicating \"incompatible network address format\".
NOTE 2: Upon receiving an initial INVITE request that does not include an SDP
offer, the UE can accept the request and include an SDP offer in the first
reliable response. The SDP offer will reflect the called user\'s terminal
capabilities and user preferences for the session.
If the UE receives an SDP offer that specifies different IP address type for
media (i.e. specify it in the \"c=\" parameter of the SDP offer) that the UE
is using for signalling, and if the UE supports both IPv4 and IPv6 addresses
simultaneously, the UE shall accept the received SDP offer. Subsequently, the
UE shall either acquire an IP address type or use an existing IP address type
as specified in the SDP offer, and include it in the \"c=\" parameter in the
SDP answer.
NOTE 3: Upon receiving an initial INVITE request, that includes an SDP offer
containing connection addresses (in the \"c=\" parameter) equal to zero, the
UE will select the media streams that is willing to accept for the session,
reserve the QoS resources for accepted media streams, and include its valid
connection address in the SDP answer.
...
If the terminating UE uses the precondition mechanism (see subclause 5.1.4.1),
if the desired QoS resources for one or more media streams have not been
reserved at the terminating UE when constructing the SDP offer, the
terminating UE shall indicate the related local preconditions for QoS as not
met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032
[64], as well as the strength-tag value \"mandatory\" for the local segment
and the strength-tag value either \"optional\" or as specified in RFC 3312
[30] and RFC 4032 [64] for the remote segment.
NOTE 7: It is out of scope of this specification which media streams are to be
included in the SDP offer.
If the terminating UE uses the precondition mechanism (see subclause 5.1.4.1)
and if the desired QoS resources for one or more media streams are available
at the terminating UE when the SDP offer is sent, the UE shall indicate the
related local preconditions as met, using the segmented status type, as
defined in RFC 3312 [30] and RFC 4032 [64], as well as the strength-tag value
\"mandatory\" for the local segment and the strength-tag value either
\"optional\" or as specified in RFC 3312 [30] and RFC 4032 [64] for the remote
segment.
If the terminating UE sends an UPDATE request to remove one or more media
streams negotiated in the session for which a final response to the INVITE
request has not been sent yet, the terminating UE sets the ports of the media
streams to be removed from the session to zero in the new SDP offer.
NOTE 8: Upon receiving an initial INVITE request with one or more media
streams which the terminating UE supports and one or more media streams which
the UE does not support, the UE is not expected to reject the INVITE request
just because of the presence of the unsupported media stream.
NOTE 9: Previous versions of this document mandated the use of the SDP
inactive attribute in the SDP offer if the desired QoS resources for one or
more media streams had not been reserved at the originating UE when
constructing the SDP offer unless the originating UE knew that the
precondition mechanism was supported by the remote UE. The use can still occur
when interoperating with devices based on earlier versions of this document.
[TS 26.114, clause 5.2.2]:
MTSI clients in terminals offering video communication shall support:
\- H.264 (AVC) [24] Constrained Baseline Profile (CBP) Level 1.2;
\- H.265 (HEVC) [119] Main Profile, Main Tier, Level 3.1.
In addition they should support:
\- H.264 (AVC) [24] Constrained High Profile (CHP) Level 3.1.
[TS 26.114, clause 6.2.3.2]:
If video is used in a session, the session setup shall determine the
applicable bandwidth(s) as defined in clause 6.2.5, RTP profile, video codec,
profile and level. The \"imageattr\" attribute as specified in [76] should be
supported. The \"framesize\" attribute as specified in [60] shall not be used
in the session setup.
An MTSI client shall offer AVPF for all media streams containing video. RTP
profile negotiation shall be done as described in clause 6.2.1a.
An MTSI client is required to support the AVPF feedback messages trr-int, NACK
and PLI [40] and the CCM feedback messages FIR, TMMBR and TMMBN [43], see
Clauses 7.3.3 and 10.3. These feedback messages can only be used together with
AVPF and shall be negotiated in SDP offer/answer before they can be used in
the session [40]. An MTSI client sending an SDP offer for AVPF shall also
include these AVPF and CCM feedback messages in the offer. An MTSI client
accepting an SDP offer for AVPF for video shall also accept these AVPF and CCM
feedback messages if they are offered.
If an MTSI client offers to use ECN for video in RTP streams then the MTSI
client shall offer ECN Capable Transport as defined below. If an MTSI client
accepts an offer for ECN for video then the MTSI client shall declare ECN
Capable Transport in the SDP answer as defined below. The SDP negotiation of
ECN Capable Transport is described in [84].
The use of ECN for a video stream in RTP is negotiated with the \"ecn-capable-
rtp\" SDP attribute, [84]. ECN is enabled when both clients agree to use ECN
as configured below. An MTSI client using ECN shall therefore also include the
following parameters and parameter values for the ECN attribute:
\- 'leap', to indicate that the leap-of-faith initiation method shall be used;
\- 'ect=0', to indicate that ECT(0) shall be set for every packet.
An MTSI client offering ECN for video shall indicate support of TMMBR [43] by
including the \"ccm tmmbr\" value within an \"rtcp-fb\" SDP attribute [40]. An
MTSI client offering ECN for video may indicate support for RTCP AVPF ECN
feedback messages [84] using the \"rtcp-fb\" SDP attribute with the \"nack\"
feedback parameter and the \"ecn\" feedback parameter value. An MTSI client
offering ECN for video may indicate support for RTCP XR ECN summary reports
[84] using the \"rtcp-xr\" SDP attribute and the \"ecn-sum\" parameter.
An MTSI client receiving an offer for ECN for video with an indication of
support of TMMBR [43] within an \"rtcp-fb\" attribute should accept the offer
if it supports ECN. It shall then indicate support for TMMBR using an \"rtcp-
fb\" attribute in the SDP answer.
An MTSI client receiving an offer for ECN for video with an indication of
support of RTCP AVPF ECN feedback message but without support for TMMBR should
accept the offer if it supports ECN and also the RTCP AVPF ECN feedback
message. It shall then indicate support of the RTCP AVPF ECN feedback message
using the \"rtcp-fb\" attribute in the SDP answer.
An MTSI client receiving an offer for ECN for video with an indication of
support of RTCP XR ECN summary reports [84] without support for TMMBR should
accept the offer if it supports ECN and also the RTCP XR ECN summary reports.
It shall then indicate support of RTCP XR ECN summary reports in the SDP
answer.
The use of ECN is disabled when a client sends an SDP without the \"ecn-
capable-rtp\" SDP attribute.
An MTSI client may initiate a session re-negotiation to disable ECN to resolve
ECN-related error cases. An ECN-related error case may be, for example,
detecting non-ECT in the received packets when ECT(0) was expected or
detecting a very high packet loss rate when ECN is used.
Examples of SDP offers and answers for video can be found in clause A.4. SDP
examples for offering and accepting ECT are shown in Annex A.12.2.
NOTE: For H.264 / MPEG-4 (Part 10) AVC, the optional max-rcmd-nalu-size
receiver-capability parameter of RFC 6184 [25] should be set to the smaller of
the MTU size (if known) minus header size or 1 400 bytes (otherwise).
The \"framerate\" attribute as specified in [8] indicates the maximum frame
rate the offerer wishes to receive. If the \"framerate\" attribute is present
in the SDP offer, its value may be modified in the SDP answer when the
answerer wishes to receive video with a different maximum frame rate than what
was indicated in the offer.
An MTSI client in terminal setting up asymmetric video streams with H.264
(AVC) should use both the 'level-asymmetry-allowed' parameter and the 'max-
recv-level' parameter that are defined in the H.264 payload format, [25]. When
the 'max-recv-level' parameter is used then the level offered for the
receiving direction using the 'max-recv-level' parameter must be higher than
the default level that is offered with the 'profile-level-id' parameter.
An SDP offer-answer example showing the usage of the 'level-asymmetry-allowed'
and 'max-recv-level' parameters is included in Annex A.4.5.
An MTSI client in terminal setting up asymmetric video streams with H.265
(HEVC) should use the 'max-recv-level-id' parameter that is defined in the
H.265 payload format, [120]. The level offered for the receiving direction
using the 'max-recv-level-id' parameter must be higher than the default level
that is offered with the 'level-id' parameter.
An SDP offer-answer example showing the usage of the 'max-recv-level-id'
parameter is included in Annex A.4.8.
The resolutions in the \"imageattr\" attribute correspond to the image size
information in the encoded video bitstream such that the x-component
corresponds to the image width, and the y-component corresponds to the height
component. When the bit-rate is being adapted, values of image width or image
height smaller than the x- or y-component(s) in the negotiated \"imageattr\"
attribute may be temporarily used.
##### 7.17.3 Profile requirements (Informative) {#profile-requirements-
informative-3 .H6}
[GSMA NG.114 V1.0, cluse 3.3.1]:
The entities in the IMS core network that terminate the user plane must
support ITU-T Recommendation H.264 [83] Constrained Baseline Profile (CBP)
Level 1.2 implemented as specified in section 5.2.2 of 3GPP TS 26.114 [16].
The UE must support ITU-T Recommendation H.264 [83] Constrained High Profile
(CHP) Level 3.1 as specified in section 5.2.2 of 3GPP TS 26.114 [16].
The UE must support ITU-T Recommendation H.265 [84] Main Profile, Main Tier
Level 3.1 as specified in section 5.2.2 of 3GPP TS 26.114 [16].
For backward compatibility, the UE must also support ITU-T Recommendation
H.264 [83] Constrained Baseline Profile (CBP) Level 3.1 as specified in
section 5.2.2 of 3GPP TS 26.114 [16], and when H.264 [83] (Advanced Video
Coding (AVC)) CHP Level 3.1 is offered, then H.264 [83] CBP Level 3.1 must
also be offered.
[GSMA NG.114 V1.0, cluse 3.3.2.1]:
The Session Description Protocol (SDP) offer/answer for video media must be
formatted as specified in section 6.2.3 of 3GPP TS 26.114 [16], along with the
restrictions included in the present document.
Unless preconfigured otherwise by the home operator with the
Media_type_restriction_policy parameter as specified in Annex C.3 and when
offering video media that is not already part of the session, regardless if it
is at the start of the session or at some later point in time, the UE must
include in the SDP offer at least:
> 1\. One H.265 (HEVC) Main Profile, Main Tier, Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
>
> 2\. One H.264 (AVC) Constrained High Profile Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
>
> 3\. One H.264 (AVC) Constrained Baseline Profile Level 3.1 payload type as
> defined in sections 5.2.2 and 7.4.3 of 3GPP TS 26.114 [16].
The payload type preference order on the SDP m= line must be as specified by
the numbered list above.
Coordination of Video Orientation (CVO) as specified in 3GPP TS 26.114 [16]
shall be supported with two (2) bits granularity by the UE and the entities in
the IMS core network which terminate the user plane. The support for CVO shall
be included in SDP offer and SDP answer as specified in section 6.2.3 of 3GPP
TS 26.114 [16].
[GSMA NG.114 V1.0, cluse 3.3.2.2]:
If an asymmetric video stream for H.265 (HEVC) is supported, the parameter
'max-recv-level-id' should be included in the SDP offer and SDP answer, and
the level offered with it must be higher than the default level offered with
the 'level-id' parameter in the SDP offer/answer respectively, as specified in
section 7.1 of IETF RFC 7798 [86] and section 6.2.3 of 3GPP TS 26.114 [16].
##### 7.17.4 Test description {#test-description-21 .H6}
##### 7.17.4.1 Pre-test conditions {#pre-test-conditions-21 .H6}
##### System Simulator: {#system-simulator-22 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-22 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to not use preconditions.
##### Preamble: {#preamble-22 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 7.17.4.2 Test procedure sequence {#test-procedure-sequence-21 .H6}
Table 7.17.4.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
0A-0H Steps 1-8 of generic procedure specified in Table 4.9.26.2.2-1 of TS
38.508-1 [21] are performed. - - - - 1 SS sends INVITE with the first SDP
offer. \ 100 Trying 1 -P 3 The UE sends 183 response
reliably with the SDP answer to the offer in INVITE -> 183 Session Progress -
- 4 SS acknowledges the receipt of 183 response from the UE. \ 200 OK 2 P 5A SS triggers
resource reservation by executing steps 10-12 of generic procedure specified
in Table 4.9.26.2.2-1 of TS 38.508-1 [21]. - - - - 6 Check: Does the UE
respond to INVITE with 180 Ringing? -> 180 Ringing 3 P 7 (Conditional) If the
180 response contains 100rel option tag within the Require header, then the SS
shall send PRACK. \ 200 OK - - 9 Make UE accept the
video call. - - - - 10 The UE responds to INVITE with a 200 OK final response
after the user answers the call. -> 200 OK - - 11 The SS acknowledges the
receipt of 200 OK for INVITE. \ \- .AMR speech codec (3GPP TS 26.071 [11], 3GPP TS 26.090 [12], 3GPP TS
> 26.073 [13] and 3GPP TS 26.104 [14]) including all 8 modes and source
> controlled rate operation â€Ž3GPP TS 26.093 [15]. The MTSI client in terminal
> shall be capable of operating with any subset of these 8 codec modes. More
> detailed codec requirements for the AMR codec are defined in clause 5.2.1.2.
MTSI clients in terminals offering wideband speech communication at 16 kHz
sampling frequency shall support:
> \- AMR-WB codec (3GPP TS 26.171 â€Žâ€Ž[17], 3GPP TS 26.190 â€Ž[18], 3GPP TS 26.173
> â€Ž[19] and 3GPP TS 26.204 [20]) including all 9 modes and source controlled
> rate operation â€Ž3GPP TS 26.193 [21]. The MTSI client in terminal shall be
> capable of operating with any subset of these 9 codec modes. More detailed
> codec requirements for the AMR-WB codec are defined in clause 5.2.1.3. When
> the EVS codec is supported, the EVS AMR-WB IO mode may serve as an
> alternative implementation of AMR-WB as defined in clause 5.2.1.4.
MTSI clients in terminals offering super-wideband or fullband speech
communication shall support:
> \- EVS codec ( TS 26.441 [121], TS 26.444 [124], TS 26.445 [125], TS 26.447
> [127], TS 26.451 [131], TS 26.442 [122], TS 26.452 [165] and TS 26.443
> [123]) as described below including functions for backwards compatibility
> with AMR-WB ( TS 26.446 [126]) and discontinuous transmission ( TS 26.449
> [129] and TS 26.450 [130]). More detailed codec requirements for the EVS
> codec are defined in clause 5.2.1.4.
Encoding of DTMF is described in Annex G.
[TS 26.114, clause 6.2.2.1]:
For AMR or AMR-WB encoded media, the session setup shall determine the
applicable bandwidth(s) as defined in clause 6.2.5, what RTP profile to use;
if all codec modes can be used or if the operation needs to be restricted to a
subset; if the bandwidth-efficient payload format can be used or if the octet-
aligned payload format must be used; if codec mode changes shall be restricted
to be aligned to only every other frame border or if codec mode changes can
occur at any frame border; if codec mode changes must be restricted to only
neighbouring modes within the negotiated codec mode set or if codec mode
changes can be performed to any mode within the codec mode set; the number of
speech frames that should be encapsulated in each RTP packet and the maximum
number of speech frames that may be encapsulated in each RTP packet. For EVS
encoded media, the session setup shall determine the RTP profile to use in the
session.
If the session setup negotiation concludes that multiple configuration
variants are possible in the session then the default operation should be used
as far as the agreed parameters allow, see clause 7.5.2.1. It should be noted
that the default configurations are slightly different for different access
types.
An MTSI client offering a speech media session for narrow-band speech and/or
wide-band speech should generate an SDP offer according to the examples in
Annexes A.1 to A.3. An MTSI client offering EVS should generate an SDP offer
according to the examples in Annex A.14.
An MTSI client in terminal supporting EVS should support the RTCP-APP
signalling for speech adaptation defined clause 10.2.1, and shall support the
RTCP-APP signalling when the MTSI client in terminal supports adaptation for
call cases where the RTP-based CMR cannot be used.
NOTE 1: Examples of call cases where the RTP-based CMR cannot be used are:
when the RTP-based CMR is disabled; or for uni-directional media (sendonly or
recvonly).
Some of the request messages are generic for all speech codecs while other
request messages are codec-specific. Request messages that can be used in a
session are negotiated in SDP, see clause 10.2.3.
[TS 26.114, clause 6.2.2.3]:
An MTSI client in terminal must understand all the payload format options that
are defined in RFC 4867 [28], and in [125]. It does not have to support
operating according to all these options but must be capable to properly
accepting or rejecting all options.
The SDP answer depends on many factors, for example:
\- what is included in the SDP offer and in what preference order that is
defined. The SDP offer will probably be different if it is generated by
another MTSI client in terminal, by an MTSI MGW, a TISPAN client or some other
VoIP client that does not follow this specification;
\- if terminal and/or network resources are available; and:
\- if there are other configurations, for example defined with OMA-DM, that
mandate, recommend or prevent some configurations.
Table 6.3 describes requirements and recommendations for handling of the AMR
payload format parameters and for how to generate the SDP answer.
NOTE 1: An MTSI client in terminal may support more features than what is
required by this specification, e.g. crc, robust sorting and interleaving.
Table 6.3 describes the handling of the AMR payload format parameters when the
MTSI client implementation supports only those features that are required by
this specification. Tables 6.3a-6.3c describe the handling of the EVS payload
format parameters.
Table 6.3: Handling of the AMR-NB and AMR-WB SDP parameters in the received
SDP offer and in the SDP answer
+----------------------+----------------------+----------------------+ | Parameter in the | Comments | Handling | | received SDP offer | | | +======================+======================+======================+ | Codec | Wide-band speech is | If both AMR-WB and | | | preferable over | AMR-NB are offered | | | narrow-band speech | and if AMR-WB is | | | | supported by the | | | | answering MTSI | | | | client in terminal | | | | then it shall select | | | | to use the AMR-WB | | | | codec and include | | | | this codec in the | | | | SDP answer, unless | | | | another preference | | | | order is indicated | | | | in the SDP offer. If | | | | the MTSI client in | | | | terminal only | | | | supports AMR-NB then | | | | this codec shall be | | | | selected to be used | | | | and shall be | | | | included in the SDP | | | | answer. | | | | | | | | The SDP answer shall | | | | only include one RTP | | | | Payload Type for | | | | speech, see NOTE 1. | +----------------------+----------------------+----------------------+ | octet-align | Both the | The offer shall not | | | bandwidth-efficient | be rejected purely | | | and the | based on the offered | | | octet-aligned | payload format | | | payload formats are | variant. | | | supported by the | | | | MTSI client in | If both | | | terminal. | bandwidth-efficient | | | | and octet-aligned | | | MTSI MGWs for GERAN | are included in the | | | or UTRAN are likely | received SDP offer | | | to either not | then the MTSI client | | | include the | in terminal shall | | | octet-align | select the | | | parameter or to | bandwidth-efficient | | | offer octet-align=0. | payload format and | | | | include it in the | | | The | configuration in the | | | bandwidth-efficient | SDP answer. | | | payload format is | | | | preferable over the | | | | octet-aligned | | | | payload format. | | +----------------------+----------------------+----------------------+ | mode-set | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate | based on the offered | | | properly with | mode-set. | | | whatever mode-set | | | | the other end-point | If only one mode-set | | | offers or if no | is offered then the | | | mode-set is offered. | MTSI client in | | | | terminal shall | | | The possibilities to | select to use this | | | use the higher bit | and include the same | | | rate codec modes | mode-set in the SDP | | | also depend on the | answer. | | | offered bandwidth. | | | | | If several different | | | MTSI MGWs for GERAN | payload types for | | | or UTRAN | the same codec with | | | inter-working are | different mode-sets | | | likely to include | (possibly including | | | the mode-set in the | one or more payload | | | offer if in case the | type without mode | | | intention is to use | set) are included in | | | TFO or TrFO. | the received SDP | | | | offer, then the MTSI | | | Mode sets that give | client in terminal | | | more adaptation | should select in the | | | possibilities are | first hand the | | | preferable over | mode-set that | | | mode-sets with fewer | provides the largest | | | or no adaptation | degrees of freedom | | | possibilities. | for codec mode | | | | adaptation and in | | | An MTSI client in | the second hand the | | | terminal may be | mode-set that is | | | configured with a | closest to the | | | preferred mode set. | preferred mode sets. | | | Otherwise, the | | | | preferred mode-set | If only a payload | | | for AMR-NB is {12.2, | type without | | | 7.4, 5.9, 4.75} and | mode-set has been | | | for AMR-WB it is | offered, or if an | | | {12.65, 8.85 and | MTSI client in | | | 6.60}. | terminal selects a | | | | payload type without | | | | mode-set from among | | | | the offered ones, | | | | and the MTSI client | | | | in terminal intends | | | | to use only some | | | | modes (e.g. one of | | | | the preferred mode | | | | sets defined at | | | | left), then the MTSI | | | | client in terminal | | | | should include these | | | | modes as the | | | | mode-set. | | | | | | | | There are also | | | | dependencies between | | | | the mode-set and the | | | | SDP b=AS bandwidth | | | | parameter; see | | | | Clause 6.2.5.2. | +----------------------+----------------------+----------------------+ | mode-change-period | **The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate | based on the offered | | | properly with |** m | | | whatever | ode-change-period.**| | | mode-change-period | | | | the other end-point |** If the received | | | offers.**| SDP offer defines | | | | mode-change-period=2 | | |** MTSI MGWs for | then this | | | GERAN or UTRAN | information shall be | | | inter-working are | used to determine | | | likely to include | the mode changes for | | | mode-change-period=2 | AMR-NB or AMR-WB | | | in the offer**if in | encoded media that | | | case the intention | the MTSI client in | | | is to use TFO or | terminal sends.** | | | TrFO**.** | | | | | **The MTSI client in | | | | terminal should not | | | | include the | | | | mode-change-period | | | | parameter in the SDP | | | | answer since it has | | | | no corresponding | | | | limitations.** | +----------------------+----------------------+----------------------+ | mo | The MTSI client in | The offer shall not | | de-change-capability | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever | mod | | | capabilities the | e-change-capability. | | | other end-point | | | | declares. | The | | | | mo | | | | de-change-capability | | | | information should | | | | be used to determine | | | | a proper value, or | | | | prevent using an | | | | improper value, for | | | | mode-change-period | | | | in the SDP answer, | | | | see above. If the | | | | offer includes | | | | mode- | | | | change-capability=1, | | | | then the MTSI client | | | | in terminal shall | | | | not offer | | | | mode-change-period=2 | | | | in the answer. | | | | | | | | The MTSI client in | | | | terminal shall | | | | include | | | | mode | | | | -change-capability=2 | | | | in the SDP answer | | | | since it is required | | | | to support | | | | restricting mode | | | | changes to every | | | | other frame. | +----------------------+----------------------+----------------------+ | mode-change-neighbor | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever limitations | m | | | the other end-point | ode-change-neighbor. | | | offers. | | | | | The MTSI client in | | | | terminal shall use | | | | this information to | | | | determine how mode | | | | changes can be | | | | performed for AMR-NB | | | | or AMR-WB encoded | | | | media that the MTSI | | | | client in terminal | | | | sends. | | | | | | | | The MTSI client in | | | | terminal shall not | | | | include the | | | | mode-change-neighbor | | | | parameter in the SDP | | | | answer since it has | | | | no corresponding | | | | limitations. | +----------------------+----------------------+----------------------+ | maxptime | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever value that | maxptime. | | | is offered. | | | | | The MTSI client in | | | The MTSI client in | terminal shall use | | | terminal may also | this information to | | | use this information | control the | | | to determine a | packetization when | | | suitable value for | sending RTP packets | | | max-red in the SDP | to the other | | | answer. | end-point, see also | | | | clause 7.4.2. | | | | | | | | The maxptime | | | | parameter shall be | | | | included in the SDP | | | | answer and shall be | | | | an integer multiple | | | | of 20. | | | | | | | | If the received SDP | | | | offer includes both | | | | the max-red and | | | | ptime parameter then | | | | the MTSI client in | | | | terminal may choose | | | | to use this | | | | information to | | | | define a suitable | | | | value for maxptime | | | | in the SDP answer, | | | | see NOTE 2. The MTSI | | | | client in terminal | | | | may also choose to | | | | set the maxptime | | | | value to 240, | | | | regardless of the | | | | ptime and/or max-red | | | | parameters in the | | | | SDP offer. | | | | | | | | The maxptime value | | | | in the SDP answer | | | | shall not be smaller | | | | than ptime value in | | | | the SDP answer. The | | | | maxptime value | | | | should be selected | | | | to give at least | | | | some room for | | | | adaptation. | +----------------------+----------------------+----------------------+ | crc | The MTSI client in | The MTSI client in | | | terminal is not | terminal may have to | | | required to support | reject offered RTP | | | this option. | payload types | | | | including this | | | | option. | +----------------------+----------------------+----------------------+ | robust-sorting | The MTSI client in | The MTSI client in | | | terminal is not | terminal may have to | | | required to support | reject offered RTP | | | this option. | payload types | | | | including this | | | | option. | +----------------------+----------------------+----------------------+ | interleaving | The MTSI client in | The MTSI client in | | | terminal is not | terminal may have to | | | required to support | reject offered RTP | | | this option. | payload types | | | | including this | | | | option. | +----------------------+----------------------+----------------------+ | ptime | The MTSI client in | The offer shall not | | | terminal can | be rejected purely | | | interoperate with | based on the offered | | | whatever value that | ptime. | | | is offered. | | | | | The MTSI client in | | | | terminal should use | | | | this information and | | | | should use the | | | | requested | | | | packetization when | | | | sending RTP packets | | | | to the other | | | | end-point. The MTSI | | | | client should use | | | | the ptime value to | | | | determine how many | | | | non-redundant speech | | | | frames that can be | | | | packed into the RTP | | | | packets. The | | | | requirements in | | | | clause 7.4.2 shall | | | | be followed even if | | | | ptime in the SDP | | | | offer is larger than | | | | 80. | | | | | | | | The ptime parameter | | | | shall be included in | | | | the SDP answer and | | | | shall be an integer | | | | multiple of 20. | | | | | | | | If the received SDP | | | | offer includes the | | | | ptime parameters | | | | then the MTSI client | | | | in terminal may | | | | choose to use this | | | | information to | | | | define a suitable | | | | value for ptime in | | | | the SDP answer, see | | | | NOTE 3. The MTSI | | | | client in terminal | | | | may also choose to | | | | set the ptime value | | | | in the SDP answer | | | | according to Table | | | | 7.1, regardless of | | | | the ptime parameter | | | | in the SDP offer. | | | | | | | | The ptime value in | | | | the SDP answer shall | | | | not be larger than | | | | the maxptime value | | | | in the SDP answer. | +----------------------+----------------------+----------------------+ | channels | The number of | When the MTSI client | | | channels may either | in terminal accepts | | | be explicitly | an offer for | | | indicated in the SDP | single-channel audio | | | by including \'/1\', | then the SDP answer | | | \'/2\', etc. on the | shall either | | | a=rtpmap line, but | explicitly indicate | | | the number of | \'/1\' or omit the | | | channels may also be | channels parameter. | | | omitted. When the | | | | number of channels | When the MTSI client | | | is omitted then the | in terminal accepts | | | default rule is that | an offer for | | | one channel is being | multi-channel audio | | | offered. | then the number of | | | | channels shall be | | | The MTSI client in | included in the SDP | | | terminal is only | answer. | | | required to support | | | | audio media using | | | | one channel. Offered | | | | RTP payload types | | | | with more than one | | | | channel may | | | | therefore have to be | | | | rejected. | | +----------------------+----------------------+----------------------+ | max-red | The MTSI client in | The max-red | | | terminal may use | parameter shall be | | | this information to | included in the SDP | | | bound the delay for | answer and shall be | | | receiving redundant | an integer multiple | | | frames. | of 20. | | | | | | | The MTSI client in | If the received SDP | | | terminal may also | offer includes both | | | use this information | the ptime and | | | to determine a | maxptime parameters | | | suitable value for | then the MTSI client | | | maxptime in the SDP | in terminal may | | | answer. | choose to use this | | | | information to | | | | define a suitable | | | | value for max-red in | | | | the SDP answer, see | | | | NOTE 2. The MTSI | | | | client in terminal | | | | may also choose to | | | | set the max-red | | | | value to 220. | | | | | | | | The max-red value in | | | | the SDP answer | | | | should be selected | | | | to give at least | | | | some room for | | | | adaptation. | +----------------------+----------------------+----------------------+ | ecn-capable-rtp: | An MTSI client in | Shall be included in | | leap ect=0 | terminal uses this | the SDP answer if | | | SDP attribute to | accepting an offer | | | offer ECN for | to use ECN and if | | | RTP-transported | the session setup | | | media | allows for bit-rate | | | | adaptation | +----------------------+----------------------+----------------------+ | NOTE 1: An MTSI | | | | client may include | | | | both a speech coded, | | | | e.g. AMR-NB or | | | | AMR-WB, and | | | | 'telephone-events' | | | | for DTMF in the SDP | | | | answer, see 3GPP TS | | | | 24.229 Clause 6.1, | | | | [7]. | | | | | | | | NOTE 2: It is | | | | possible to use the | | | | following | | | | relationship between | | | | maxptime, ptime and | | | | max-red:\ | | | | maxptime = ptime + | | | | max-red.\ | | | | There is however no | | | | mandatory | | | | requirement that | | | | these parameters | | | | must be aligned in | | | | this way. | | | | | | | | NOTE 3: It may be | | | | wise to use the same | | | | ptime value in the | | | | SDP answer as was | | | | given in the SDP | | | | offer, especially if | | | | the ptime in the SDP | | | | offer is larger than | | | | 20, since a value | | | | larger than the | | | | frame length | | | | indicates that the | | | | other end-point is | | | | somehow packet rate | | | | limited. | | | +----------------------+----------------------+----------------------+
If an SDP offer is received from another MTSI client in terminal using the
AMR-NB or AMR-WB codec, then the SDP offer will include configurations as
described in Table 6.1 and Table 6.2. If the MTSI client in terminal chooses
to accept the offer for using the AMR-NB or AMR-WB codec, as configured in
Table 6.1 or Table 6.2 then the MTSI client in terminal shall support a
configuration where the MTSI client in terminal creates an SDP answer
containing an RTP payload type for the AMR-NB and AMR-WB codec as shown in
Table 6.4.
...
Table 6.3b: Handling of the EVS Primary SDP parameters in the received SDP
offer and in the SDP answer
+------------+---------------------------+---------------------------+ | Parameter | Comments | Handling | +============+===========================+===========================+ | br | | An MTSI client in | | | | terminal supporting the | | | | EVS codec is required to | | | | support the entire | | | | bit-rate range but may | | | | offer a smaller bit-rate | | | | range or even a single | | | | bit-rate. | +------------+---------------------------+---------------------------+ | br-send | | | +------------+---------------------------+---------------------------+ | br-recv | | | +------------+---------------------------+---------------------------+ | bw | The session should start | Both the offerer and the | | | with the maximum | answerer shall send | | | bandwidth supported by | according to the | | | the initial bit-rate up | bandwidth parameter in | | | to the maximum negotiated | the answer. | | | bandwidth. If a range of | | | | bandwidth is negotiated, | | | | the codec can operate in | | | | any bandwidth in the | | | | session but the maximum | | | | bandwidth in the range | | | | should be used after the | | | | start of or update of the | | | | session. If a single | | | | audio bandwidth higher | | | | than narrowband is | | | | negotiated, the codec | | | | operates in the | | | | negotiated bandwidth but | | | | can use lower | | | | bandwidth(s) in the | | | | session, depending on the | | | | input signal. | | +------------+---------------------------+---------------------------+ | bw-send | | | +------------+---------------------------+---------------------------+ | bw-recv | | | +------------+---------------------------+---------------------------+ | ch-send | | | +------------+---------------------------+---------------------------+ | ch-recv | | | +------------+---------------------------+---------------------------+ | cmr | In EVS AMR-WB IO mode, | If cmr=-1 and the session | | | CMR to the bit-rates of | is in the EVS Primary | | | EVS AMR-WB IO mode and | mode, MTSI client in | | | NO_REQ is always | terminal shall not | | | enabled. | transmit CMR. If cmr=-1 | | | | and the session is in the | | | | EVS AMR-WB IO, MTSI | | | | client in terminal shall | | | | restrict CMR to values of | | | | EVS AMR-WB-IO bit-rates | | | | and NO_REQ in the | | | | session. | | | | | | | | MTSI client in terminal | | | | is required to accept CMR | | | | even when cmr=-1. MTSI | | | | client in terminal is | | | | required to accept RTP | | | | payload without CMR even | | | | when cmr=1. | +------------+---------------------------+---------------------------+ | ch-aw-recv | | If a positive (2, 3, 5, | | | | or 7) value of ch-aw-recv | | | | is declared for a payload | | | | type and the payload type | | | | is accepted, the receiver | | | | of the parameter shall | | | | send partial redundancy | | | | (channel-aware mode) at | | | | the start of the session | | | | using the value as the | | | | offset. If ch-aw-recv=0 | | | | is declared or not | | | | present for a payload | | | | type and the payload type | | | | is accepted, the receiver | | | | of the parameter shall | | | | not send partial | | | | redundancy (channel-aware | | | | mode) at the start of the | | | | session. If ch-aw-recv=-1 | | | | is declared for a payload | | | | type and the payload type | | | | is accepted, the receiver | | | | of the parameter shall | | | | not send partial | | | | redundancy (channel-aware | | | | mode) in the session. If | | | | not present or a | | | | non-negative (0, 2, 3, 5, | | | | or 7) value of ch-aw-recv | | | | is declared for a payload | | | | type and the payload type | | | | is accepted, partial | | | | redundancy (channel-aware | | | | mode) can be activated or | | | | deactivated during the | | | | session based on the | | | | expected or estimated | | | | channel condition through | | | | adaptation signalling, | | | | such as CMR (see Annex | | | | A.2 of [125]) or RTCP | | | | based signalling (see | | | | clause 10.2). If not | | | | present or a non-negative | | | | (0, 2, 3, 5, or 7) value | | | | of ch-aw-recv is declared | | | | for a payload type and | | | | the payload type is | | | | accepted, the partial | | | | redundancy offset value | | | | can also be adjusted | | | | during the session based | | | | on the expected or | | | | estimated channel | | | | condition through | | | | adaptation signalling. | +------------+---------------------------+---------------------------+
...
Table 6.4: SDP parameters for AMR-NB or AMR-WB for SDP answer when the SDP
offer is received from another MTSI client in terminal
Parameter Usage
* * *
octet-align Shall not be included mode-set See Table 6.3 mode-change-period
Shall not be included mode-change-capability May be included. If it is
included then it shall be set to 2 mode-change-neighbor Shall not be included
maxptime Shall be set to 240, see also Table 7.1 crc Shall not be included
robust-sorting Shall not be included interleaving Shall not be included ptime
Shall be set according to Table 7.1 channels Shall either be set to 1 or be
omitted max-red Shall be included and shall be set to 220 or less ecn-capable-
rtp: leap ect=0 Shall be included in the SDP answer if accepting an offer to
use ECN and if the session setup allows for bit-rate adaptation
##### 7.18.3 Test description {#test-description-22 .H6}
##### 7.18.3.1 Pre-test conditions {#pre-test-conditions-22 .H6}
##### System Simulator: {#system-simulator-23 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-23 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use the precondition mechanism.
##### Preamble: {#preamble-23 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.18.3.2 Test procedure sequence {#test-procedure-sequence-22 .H6}
Table 7.18.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is made to attempt an IMS voice call. - -  
2-7 Steps 2-7 of generic procedure specified in Table 4.9.15.2.2-1 of TS
38.508-1 [21] are performed. - -  
\- EXCEPTION: In parallel with Step 8, parallel behaviour defined in table
7.18.3.2-2 takes place - - - - 8 Step 1 of Annex A.4.1a happens --> INVITE 1 P
9 Step 2 of Annex A.4.1a happens \ PRACK  
12 Step 5 of Annex A.4.1a happens \ UPDATE 2 P 14 Step 7 of Annex A.4.1a
happens \ PRACK  
17 Step 10 of Annex A.4.1a happens \ ACK
* * *
Table 7.18.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.18.3.3 Specific message contents {#specific-message-contents-22 .H6}
183 Session Progress (Step 10)
Use the default message \"183 Session Progress\" in annex A.4.1a with the
following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Require | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:38_ | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) [Note | | | 1, 2] | | | | | | _b=AS:38_ | | | | | | _b=RS:_ **(bandwidth-value)** [Note 3] | | | | | | _b=RR:_ **(bandwidth-value)** [Note 3] | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ **(payload type)** _AMR-WB/16000/1_ | | | [Note 1] | | | | | | _a=fmtp:_ **(format)** | | | _mode-change-capability=2; max-red=220_ [Note | | | 1] | | | | | | _a=ecn-capable-rtp: leap ect=0_ [Note 4] | | | | | | _a=rtcp-fb:* nack ecn_ [Note 4] | | | | | | _a=rtcp-xr:ecn-sum_ [Note 4] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | **_a=3ge2ae: requested_ [Note 5]** | | | | | | **_a=c | | | rypto:1 AES_CM_128_HMAC_SHA1_80inline:PS1uQ | | | CVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR\|2\^20\|1:4_ | | | [Note 5]** | | | | | | **Attributes for preconditions:** | | | | | | _a=curr:qos local none_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | _a=conf:qos remote sendrecv_ | | | | | | Note 1: The values for fmt, payload type and | | | format are copied from step 2. | | | | | | Note 2: Transport port is the port number of the | | | SS (see RFC 3264 clause 6). | | | | | | Note 3: The bandwidth-value is copied from step | | | 2. | | | | | | _Note 4:_ Attributes for ECN Capability are | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 5: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | +------------------+--------------------------------------------------+
##### UPDATE (Step 13) {#update-step-13 .H6}
Use the default message \"UPDATE\" in annex A.4.1a with the following
exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Require | _precondition_ | | | | | option-tag | | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(username)_ (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) [Note 2] | | | | | | _s=_(session name) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) [Note | | | 3] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _AMR-WB/16000_ [Note | | | 3] [Note 5] | | | | | | _a=fmtp:_ (format) [Note 3] [Note 4] | | | | | | **Attributes for preconditions:** | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos optional remote sendrecv_ or | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: \"o=\" line identical to previous SDP | | | sent by UE except that sess-version is | | | incremented by one | | | | | | Note 3: **The value for fmt, payload type and | | | format is not checked** | | | | | | **Note 4: Parameters for the AMR codec are not | | | checked** | | | | | | **Note 5: The AMR channel number shall be \"/1\" | | | or omitted.** | +------------------+--------------------------------------------------+
## 7.19 MTSI MT Voice Call / EVS / AMR-WB IO mode / 5GS
##### 7.19.1 Test Purpose (TP) {#test-purpose-tp-23 .H6}
##### (1) {#section-68 .H6}
**with** { UE having set up a voice call using EVS and being configured to use
preconditions }
**ensure** **that** {
**when** { UE receives INVITE indicating to switch to EVS AMR-WB IO mode }
**then** { UE responds by accepting this switch }
}
##### 7.19.2 Conformance Requirements {#conformance-requirements-24 .H6}
[TS 26.114, clause 5.2.1.1]:
MTSI clients in terminals offering speech communication shall support
narrowband, wideband and super-wideband communication. The only exception to
this requirement is for the MTSI client in constrained terminal offering
speech communication, in which case the MTSI client in constrained terminal
shall support narrowband and wideband, and should support super-wideband
communication.
In addition, MTSI clients in terminals offering speech communication shall
support:
> \- .AMR speech codec (3GPP TS 26.071 [11], 3GPP TS 26.090 [12], 3GPP TS
> 26.073 [13] and 3GPP TS 26.104 [14]) including all 8 modes and source
> controlled rate operation â€Ž3GPP TS 26.093 [15]. The MTSI client in terminal
> shall be capable of operating with any subset of these 8 codec modes. More
> detailed codec requirements for the AMR codec are defined in clause 5.2.1.2.
MTSI clients in terminals offering wideband speech communication at 16 kHz
sampling frequency shall support:
> \- AMR-WB codec (3GPP TS 26.171 â€Žâ€Ž[17], 3GPP TS 26.190 â€Ž[18], 3GPP TS 26.173
> â€Ž[19] and 3GPP TS 26.204 [20]) including all 9 modes and source controlled
> rate operation â€Ž3GPP TS 26.193 [21]. The MTSI client in terminal shall be
> capable of operating with any subset of these 9 codec modes. More detailed
> codec requirements for the AMR-WB codec are defined in clause 5.2.1.3. When
> the EVS codec is supported, the EVS AMR-WB IO mode may serve as an
> alternative implementation of AMR-WB as defined in clause 5.2.1.4.
MTSI clients in terminals offering super-wideband or fullband speech
communication shall support:
> \- EVS codec ( TS 26.441 [121], TS 26.444 [124], TS 26.445 [125], TS 26.447
> [127], TS 26.451 [131], TS 26.442 [122], TS 26.452 [165] and TS 26.443
> [123]) as described below including functions for backwards compatibility
> with AMR-WB ( TS 26.446 [126]) and discontinuous transmission ( TS 26.449
> [129] and TS 26.450 [130]). More detailed codec requirements for the EVS
> codec are defined in clause 5.2.1.4.
Encoding of DTMF is described in Annex G.
[TS 26.114, clause 5.2.1.4]:
When the EVS codec is supported, the MTSI client in terminal may support dual-
mono encoding and decoding.
When the EVS codec is supported, EVS AMR-WB IO may serve as an alternative
implementation of the AMR-WB codec, [125]. In this case, the requirements and
recommendations defined in this specification for the AMR-WB codec also apply
to EVS AMR-WB IO.
NOTE: The DTX operation of EVS Primary and AMR-WB IO can be configured in
sending direction with either a fixed SID update interval (from 3 to 100
frames) or an adaptive SID update interval - more details can be found in
clauses 4.4.3 and 5.6.1.1 of TS 26.445 [125]. Implementers of MTSI clients are
advised to take into account this SID flexibility of EVS.
[TS 26.114, clause 6.2.2.3]:
An MTSI client in terminal must understand all the payload format options that
are defined in RFC 4867 [28], and in [125]. It does not have to support
operating according to all these options but must be capable to properly
accepting or rejecting all options.
...
Table 6.3a: Handling of SDP parameters common to EVS Primary and EVS AMR-WB IO
in the received SDP offer and in the SDP answer
**Parameter** **Comments** **Handling**
* * *
ptime  
maxptime  
dtx MTSI client in terminal shall not include dtx in the initial SDP offer.
MTSI MGW may modify SDP offer to include dtx in order to disable DTX in the
session. dtx-recv MTSI client in terminal shall not include dtx-recv. MTSI MGW
may modify SDP offer or answer in order to disable DTX for the send direction
of the receiver of dtx-recv. hf-only - evs-mode-switch This parameter is used
by MTSI MGW either when starting in EVS AMR-WB IO mode instead of EVS Primary
mode or when switching between EVS Primary mode and EVS AMR-WB IO mode, e.g.,
for SRVCC. MTSI client in terminal shall not include evs-mode-switch in the
initial SDP offer. When including evs-mode-switch in the SDP offer during a
session, the offerer shall use the requested mode when sending EVS packets.
However, if a media stream is already being received, the offerer needs to be
prepared to receive packets in both EVS primary and EVS AMR-WB IO modes until
receiving the answer. When including evs-mode-switch in the SDP answer during
a session, the answerer shall use the requested mode when sending EVS packets.
When receiving SDP answer including evs-mode-switch during a session, the
offerer shall use the requested mode when sending EVS packets. max-red See
Table 6.3  
channels See Table 6.3
Table 6.3b: Handling of the EVS Primary SDP parameters in the received SDP
offer and in the SDP answer
+------------+---------------------------+---------------------------+ | Parameter | Comments | Handling | +============+===========================+===========================+ | br | | An MTSI client in | | | | terminal supporting the | | | | EVS codec is required to | | | | support the entire | | | | bit-rate range but may | | | | offer a smaller bit-rate | | | | range or even a single | | | | bit-rate. | +------------+---------------------------+---------------------------+ | br-send | | | +------------+---------------------------+---------------------------+ | br-recv | | | +------------+---------------------------+---------------------------+ | bw | The session should start | Both the offerer and the | | | with the maximum | answerer shall send | | | bandwidth supported by | according to the | | | the initial bit-rate up | bandwidth parameter in | | | to the maximum negotiated | the answer. | | | bandwidth. If a range of | | | | bandwidth is negotiated, | | | | the codec can operate in | | | | any bandwidth in the | | | | session but the maximum | | | | bandwidth in the range | | | | should be used after the | | | | start of or update of the | | | | session. If a single | | | | audio bandwidth higher | | | | than narrowband is | | | | negotiated, the codec | | | | operates in the | | | | negotiated bandwidth but | | | | can use lower | | | | bandwidth(s) in the | | | | session, depending on the | | | | input signal. | | +------------+---------------------------+---------------------------+ | bw-send | | | +------------+---------------------------+---------------------------+ | bw-recv | | | +------------+---------------------------+---------------------------+ | ch-send | | | +------------+---------------------------+---------------------------+ | ch-recv | | | +------------+---------------------------+---------------------------+ | cmr | In EVS AMR-WB IO mode, | If cmr=-1 and the session | | | CMR to the bit-rates of | is in the EVS Primary | | | EVS AMR-WB IO mode and | mode, MTSI client in | | | NO_REQ is always | terminal shall not | | | enabled. | transmit CMR. If cmr=-1 | | | | and the session is in the | | | | EVS AMR-WB IO, MTSI | | | | client in terminal shall | | | | restrict CMR to values of | | | | EVS AMR-WB-IO bit-rates | | | | and NO_REQ in the | | | | session. | | | | | | | | MTSI client in terminal | | | | is required to accept CMR | | | | even when cmr=-1. MTSI | | | | client in terminal is | | | | required to accept RTP | | | | payload without CMR even | | | | when cmr=1. | +------------+---------------------------+---------------------------+ | ch-aw-recv | | If a positive (2, 3, 5, | | | | or 7) value of ch-aw-recv | | | | is declared for a payload | | | | type and the payload type | | | | is accepted, the receiver | | | | of the parameter shall | | | | send partial redundancy | | | | (channel-aware mode) at | | | | the start of the session | | | | using the value as the | | | | offset. If ch-aw-recv=0 | | | | is declared or not | | | | present for a payload | | | | type and the payload type | | | | is accepted, the receiver | | | | of the parameter shall | | | | not send partial | | | | redundancy (channel-aware | | | | mode) at the start of the | | | | session. If ch-aw-recv=-1 | | | | is declared for a payload | | | | type and the payload type | | | | is accepted, the receiver | | | | of the parameter shall | | | | not send partial | | | | redundancy (channel-aware | | | | mode) in the session. If | | | | not present or a | | | | non-negative (0, 2, 3, 5, | | | | or 7) value of ch-aw-recv | | | | is declared for a payload | | | | type and the payload type | | | | is accepted, partial | | | | redundancy (channel-aware | | | | mode) can be activated or | | | | deactivated during the | | | | session based on the | | | | expected or estimated | | | | channel condition through | | | | adaptation signalling, | | | | such as CMR (see Annex | | | | A.2 of [125]) or RTCP | | | | based signalling (see | | | | clause 10.2). If not | | | | present or a non-negative | | | | (0, 2, 3, 5, or 7) value | | | | of ch-aw-recv is declared | | | | for a payload type and | | | | the payload type is | | | | accepted, the partial | | | | redundancy offset value | | | | can also be adjusted | | | | during the session based | | | | on the expected or | | | | estimated channel | | | | condition through | | | | adaptation signalling. | +------------+---------------------------+---------------------------+
Table 6.3c: SDP parameters for the EVS AMR-WB IO parameters in the received
SDP offer and in the SDP answer
**Parameter** **Comments** **Handling**
* * *
mode-set See Table 6.3  
mode-change-period  
mode-change-neighbor  
mode-change-capability The default value is re-defined in comparison to that
in [28]. As the default and the only allowed value of mode-change-capability
is 2 in EVS AMR-WB IO, it is not required to include this parameter in the SDP
offer or answer.
NOTE 2: ECN-triggered adaptation is currently undefined for EVS. This does not
prevent ECN-triggered adaptation from being negotiated and used for AMR or
AMR-WB.
[TS 26.114, clause 6.2.5.2]:
If an MTSI client includes an AMR or AMR-WB mode-set, or EVS Primary mode br
or br-recv parameter in the SDP offer or answer, the MTSI client shall set the
b=AS parameter to a value matching the maximum codec mode in the mode-set or
the highest bit-rate in the br or br-recv, the packetization time (ptime), and
the intended redundancy level. For example, b=AS for AMR-WB at IPv6 should be
set to 38 if mode-set includes {6.60, 8.85, 12.65}, the packetization time is
20, and if no extra bandwidth is allocated for redundancy. Likewise, b=AS for
EVS Primary mode at IPv4 should be set to 42 if br=7.2-24.4, the packetization
is header-full payload format, ptime=20, and no extra bandwidth is allocated
for redundancy.
If an MTSI client does not include an AMR or AMR-WB mode-set, or EVS Primary
mode br or br-recv parameter in the SDP offer or answer, the MTSI client shall
set the b=AS parameter in the SDP to a value matching the highest AMR/AMR-WB
mode, i.e., AMR 12.2 and AMR-WB 23.85, or the highest bit-rate of EVS Primary
mode depending on negotiated bandwidth(s), i.e., EVS 24.4 for NB and EVS 128
for WB, SWB and FB, respectively.
NOTE 1: When no mode-set is defined, then this should be understood as that
the offerer or answerer is capable of sending and receiving all codec modes of
AMR or AMR-WB. An MTSI client in terminal will not include the mode-set
parameter in SDP offer in the initial offer-answer negotiation. See Clause
6.2.2.2, Tables 6.1 and 6.2. It is however expected that the mode-set is
defined when an SDP offer is received from an MTSI MGW inter-working with CS
GERAN/UTRAN, see Clause 6.2.2.3, Table 6.5.
The bandwidth to use for b=AS for AMR and AMR-WB, and EVS Primary mode should
be computed as shown in Annexes K and Q respectively. Tables 6.7 and 6.8 shows
the bandwidth for the respective AMR and AMR-WB codec when the packetization
time is 20 and no extra bandwidth is allocated for redundancy. The b=AS value
is computed without taking statistical variations, e.g., the effects of DTX,
into account. Such variations can be considered in the scheduling and call
admission control. Detailed procedures to compute b=AS of AMR and AMR-WB, and
EVS Primary mode can be found in Annexes K and Q.
NOTE 2: For any payload format, b=AS of EVS Primary mode at 5.9 kbps source
controlled variable bit-rate (SC-VBR) coding is computed as the b=AS of its
highest component bit-rate, 8 kbps.
NOTE 3: b=AS of EVS AMR-WB IO mode can be computed as in the octet-aligned
payload format of AMR-WB as shown in Annex K.
b=AS of EVS shall be equal to the maximum of b=AS of the highest included EVS
primary mode and b=AS of the highest included EVS AMR-WB IO mode, regardless
of the presence and configuration of evs-mode-switch.
Table 6.7: b=AS for each codec mode of AMR when ptime is 20
**Payload format** **Codec mode**
* * *
                        4.75             5.15   5.9   6.7   7.4   7.95   10.2   12.2
Bandwidth-efficient IPv4 22 22 23 24 24 25 27 29 IPv6 30 30 31 32 32 33 35 37
Octet-aligned IPv4 22 22 23 24 25 25 28 30 IPv6 30 30 31 32 33 33 36 38
Table 6.8: b=AS for each codec mode of AMR-WB when ptime is 20
**Payload format** **Codec Mode**
* * *
                        6.6              8.85   12.65   14.25   15.85   18.25   19.85   23.05   23.85
Bandwidth-efficient IPv4 24 26 30 31 33 35 37 40 41 IPv6 32 34 38 39 41 43 45
48 49 Octet-aligned IPv4 24 26 30 32 33 36 37 40 41 IPv6 32 34 38 40 41 44 45
48 49
Table 6.9: b=AS for each bit-rate of EVS Primary mode when ptime is 20
**Payload format** **Bit-rate**
* * *
                       7.2            8    9.6   13.2   16.4   24.4   32   48   64   96   128
Header-full IPv4 24 25 27 30 34 42 49 65 81 113 145 IPv6 32 33 35 38 42 50 57
73 89 121 153
##### 7.19.3 Test description {#test-description-23 .H6}
##### 7.19.3.1 Pre-test conditions {#pre-test-conditions-23 .H6}
##### System Simulator: {#system-simulator-24 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-24 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-24 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.19.3.2 Test procedure sequence {#test-procedure-sequence-23 .H6}
Table 7.19.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is made to attempt an IMS voice call. - - - - 2-7 Steps 2-7 of generic
procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21] are performed -
- - - \- EXCEPTION: In parallel with Step 8, parallel behaviour defined in
table 7.19.3.2-2 takes place - - - - 8 Step 1 of Annex A.4.1a happens -->
INVITE - - 9 Step 2 of Annex A.4.1a happens \ PRACK - - 12 Step 5 of Annex A.4.1a happens \ UPDATE - - 14 Step 7 of Annex A.4.1a
happens \ PRACK - - 17 Step 10 of Annex A.4.1a
happens \ ACK - - 20 Step 1 of Annex A.5.1a
happens \ 100 Trying - -
22 Step 11 of Annex A.5.1a happens --> 200 OK 1 P 23 Step 12 of Annex A.5.1a
happens \ NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.19.3.3 Specific message contents {#specific-message-contents-23 .H6}
##### INVITE (Step 20) {#invite-step-20 .H6}
Use the default message \"INVITE (Step 1)\" in annex A.5.1a with the following
exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Supported** | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | SDP body copied from the previous 200 OK (step | | | 12 or 14) and modified as follows: | | | | | | - \"o=\" line identical to previous SDP sent by | | | SS except that sess-version is incremented. | | | | | | - \"a=fmtp\" line identical to previous SDP | | | sent by SS except that \"evs-mode-switch=1\" is | | | added. | +------------------+--------------------------------------------------+
##### 200 OK (Step 22) {#ok-step-22 .H6}
Use the default message \"200 OK (Step 11)\" in annex A.5.1a with the
following exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | _precondition_ | | | | | option-tag | | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(user-name)_ (sess-id) (sess-version) _IN_ | | | (addrtype) (unicast-address for UE) [Note 4] | | | | | | _s=(session name)_ | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_(payload type) _EVS/16000_ _[Note | | | 2]_ | | | | | | _a=fmtp:_(format) _evs-mode-switch=1;_ [Note | | | 2, 3] | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote sendrecv_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: The values for fmt, payload type and | | | format are not checked. | | | | | | Note 3: The evs-mode-switch is checked, but no | | | other codec parameters. | | | | | | Note 4: \"o=\" line identical to previous SDP | | | sent by UE except that sess-version is | | | incremented by one. | +--------------------+------------------------------------------------+
## 7.20 MTSI MO Voice Call / add video and remove video / with preconditions
at both originating UE and terminating UE / 5GS
##### 7.20.1 Test Purpose (TP) {#test-purpose-tp-24 .H6}
##### (1) {#section-69 .H6}
**with** { UE is configured to use preconditions and has set up a voice call
with preconditions }
**ensure** **that** {
**when** { UE is made to add video to the voice call }
**then** { UE sends re-INVITE with SDP media for both voice and video }
}
##### (2) {#section-70 .H6}
**with** { UE having sent re-INVITE }
**ensure** **that** {
**when** { UE receives 100 Trying and 183 Session in Progress with SDP answer
}
**then** { UE acks with PRACK }
}
##### (3) {#section-71 .H6}
**with** { UE having sent PRACK }
**ensure** **that** {
**when** { UE receives 200 OK for PRACK and indication that resources are
reserved }
**then** { UE sends UPDATE with SDP offer indicating reserved resources }
}
##### (4) {#section-72 .H6}
**with** { UE having sent UPDATE }
**ensure** **that** {
**when** { UE receives 200 OK for UPDATE followed by 200 OK for re-INVITE }
**then** { UE sends ACK }
}
##### (5) {#section-73 .H6}
**with** { UE having successfully added video }
**ensure** **that** {
**when** { UE is made to remove video again }
**then** { UE sends re-INVITE with SDP indicating that video is being removed
from the call }
}
##### (6) {#section-74 .H6}
**with** { UE having sent re-INVITE }
**ensure** **that** {
**when** { UE receives 100 Trying followed by 200 OK and indication that video
resources have been removed }
**then** { UE sends ACK }
}
##### 7.20.2 Conformance Requirements {#conformance-requirements-25 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.173, clause 5.2]:
The IMS multimedia telephony communication service can support different types
of media, including media types listed in 3GPP TS 22.173 [2]. The session
control procedures for the different media types shall be in accordance with
3GPP TS 24.229 [13] and 3GPP TS 24.247 [14], with the following additions:
a) Multimedia telephony is an IMS communication service and the P-Preferred-
Service and P-Asserted-Service headers shall be treated as described in 3GPP
TS 24.229 [13]. The coding of the ICSI value in the P-Preferred-Service and
P-Asserted-Service headers shall be according to subclause 5.1.
[TS 24.229, clause 5.1.2A.1]:
If this is a request within an existing dialog, and the request includes a
Contact header field, then the UE should insert the previously used Contact
header field.
...
After the dialog is established the UE may change the dialog capabilities
(e.g. add a media or request a supplementary service) if defined for the IMS
communication service as identified by the ICSI value using the same dialog.
Otherwise, the UE shall initiate a new initial request to the other user.
[TS 24.229, clause 5.1.3]:
The \"integration of resource management and SIP\" extension is hereafter in
this subclause referred to as \"the precondition mechanism\" and is defined in
RFC 3312 [30] as updated by RFC 4032 [64].
The preconditions mechanism should be supported by the originating UE.
If the precondition mechanism is disabled as specified in subclause 5.1.5A,
the UE shall not use the precondition mechanism.
The UE may initiate a session without the precondition mechanism if the
originating UE does not require local resource reservation.
NOTE 1: The originating UE can decide if local resource reservation is
required based on e.g. application requirements, current access network
capabilities, local configuration, etc.
In order to allow the peer entity to reserve its required resources, if the
precondition mechanism is enabled as specified in subclause 5.1.5A; the
originating UE supporting the precondition mechanism should make use of the
precondition mechanism, even if it does not require local resource
reservation.
Upon generating an initial INVITE request using the precondition mechanism,
the UE shall:
\- indicate the support for reliable provisional responses and specify it
using the Supported header field; and
\- indicate the support for the preconditions mechanism and specify it using
the Supported header field.
Upon generating an initial INVITE request using the precondition mechanism,
the UE shall not indicate the requirement for the precondition mechanism by
using the Require header field.
During the session initiation, if the originating UE indicated the support for
the precondition mechanism in the initial INVITE request and:
a) the received response with an SDP body includes a Require header field with
\"precondition\" option-tag, the originating UE shall include a Require header
field with the \"precondition\" option-tag:
\- in subsequent requests that include an SDP body, that the originating UE
sends in the same dialog as the response is received from; and
\- in responses with an SDP body to subsequent requests that include an SDP
body and include \"precondition\" option-tag in Supported header field or
Require header field received in-dialog; or
b) the received response with an SDP body does not include the
\"precondition\" option-tag in the Require header field,
\- in subsequent requests that include an SDP body, the originating UE shall
not include a Require or Supported header field with \"precondition\" option-
tag in the same dialog;
\- in responses with an SDP body to subsequent requests with an SDP body but
without \"precondition\" option-tag in the Require or Supported header field,
the originating UE shall not include a Require or Supported header field with
\"precondition\" option-tag in the same dialog; and
\- in responses with an SDP body to subsequent requests with an SDP body and
with \"precondition\" option-tag in the Require or Supported header field, the
originating UE shall include a Require header field with \"precondition\"
option-tag in the same dialog.
NOTE 2: Table A.4 specifies that UE support of forking is required in
accordance with RFC 3261 [26]. The UE can accept or reject any of the forked
responses, for example, if the UE is capable of supporting a limited number of
simultaneous transactions or early dialogs.
Upon successful reservation of local resources the UE shall confirm the
successful resource reservation (see subclause 6.1.2) within the next SIP
request.
NOTE 3: In case of the precondition mechanism being used on both sides, this
confirmation will be sent in either a PRACK request or an UPDATE request. In
case of the precondition mechanism not being supported on one or both sides,
alternatively a reINVITE request can be used for this confirmation after a 200
(OK) response has been received for the initial INVITE request, in case the
terminating UE does not support the PRACK request (as described in RFC 3262
[27]) and does not support the UPDATE request (as described in RFC 3311 [29]).
NOTE 4: The UE can receive a P-Early-Media header field authorizing an early-
media flow while the required preconditions, if any, are not met and/or the
flow direction is not enabled by the SDP direction parameter. According to RFC
5009 [109], an authorized early-media flow can be established only if the
necessary conditions related to the SDP negotiation are met. These conditions
can evolve during the session establishment.
NOTE 5: When the UE is confirming the successful resource reservation using an
UPDATE request (or a PRACK request) and the UE receives a 180 (Ringing)
response or a 200 (OK) response to the initial INVITE request before receiving
a 200 (OK) response to the UPDATE request (or a 200 (OK) response to the PRACK
request), the UE does not treat this as an error case and does not release the
session.
NOTE 6: The UE procedures for rendering of the received early media and of the
locally generated communication progress information are specified in 3GPP TS
24.628 [8ZF].
[TS 24.229, clause 5.1.4A.1]:
If the precondition mechanism was used during the session establishment, as
described in subclause 5.1.3.1 or 5.1.4.1, the UE shall indicate support of
the precondition mechanism during a session modification. If the precondition
mechanism was not used during the session establishment, the UE shall not
indicate support of the precondition mechanism during a session modification.
In order to indicate support of the precondition mechanism during a session
modification, upon generating a reINVITE request, an UPDATE request with an
SDP body, or a PRACK request with an SDP body, the UE shall:
a) indicate the support for the precondition mechanism using the Supported
header field;
b) not indicate the requirement for the precondition mechanism using the
Require header field; and
c) if a re-INVITE request is being generated, indicate the support for
reliable provisional responses using the Supported header field;
[TS 24.229, clause 5.1.4A.2]:
Upon receiving a reINVITE request, an UPDATE request, or a PRACK request that
indicates support for the precondition mechanism by using the Supported header
field or requires use of the precondition mechanism by using the Require
header field, the UE shall:
a) if the precondition mechanism was used during the session establishment, as
described in subclause 5.1.3.1 or 5.1.4.1, use the precondition mechanism for
the session modification; and
> ...
If the precondition mechanism is used for the session modification, the UE
shall indicate support for the preconditions mechanism, using the Require
header field, in responses that include an SDP body, to the session
modification request.
[TS 24.229, clause 6.1]:
The \"integration of resource management and SIP\" extension is hereafter in
this subclause referred to as \"the precondition mechanism\" and is defined in
RFC 3312 [30] as updated by RFC 4032 [64].
In order to authorize the media streams, the P-CSCF and S-CSCF have to be able
to inspect SDP message bodies. Hence, the UE shall not encrypt SDP message
bodies.
During the session establishment procedure, and during session modification
procedures, SIP messages shall only contain an SDP message body if that is
intended to modify the session description, or when the SDP message body is
included in the message because of SIP rules described in RFC 3261 [26].
...
For \"video\" and \"audio\" media types that use the RTP/RTCP and where the
port number is not zero, the UE shall specify the proposed bandwidth for each
media stream using the \"b=\" media descriptor and the \"AS\" bandwidth
modifier in the SDP.
...
If the media line in the SDP message body indicates the usage of RTP/RTCP, and
if the UE is configured to request an RTCP bandwidth level for the session is
different than the default RTCP bandwidth as specified in RFC 3556 [56], then
in addition to the \"AS\" bandwidth modifier in the media-level \"b=\" line,
the UE shall include two media-level \"b=\" lines, one with the \"RS\"
bandwidth modifier and the other with the \"RR\" bandwidth modifier as
described in RFC 3556 [56] to specify the required bandwidth allocation for
RTCP. The bandwidth-value in the b=RS: and b=RR: lines may include transport
overhead as described in subclause 6.1 of RFC 3890 [152].
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in or 3GPP 29.213 [13C].
NOTE 3: In a two-party session where both participants are active, the RTCP
receiver reports are not sent, therefore, the RR bandwidth modifier will
typically get the value of zero.
If an in-band DTMF codec is supported by the application associated with an
audio media stream, then the UE shall include, in addition to the payload type
numbers associated with the audio codecs for the media stream, for each clock
rate associated with the audio codecs for the media stream, a payload type
number associated with the MIME subtype \"telephone-event\", to indicate
support of in-band DTMF as described in RFC 4733 [23].
The UE shall inspect the SDP message body contained in any SIP request or
response, looking for possible indications of grouping of media streams
according to RFC 3524 [54] and perform the appropriate actions for IP-CAN
bearer establishment for media according to IP-CAN specific procedures (see
subclause B.2.2.5 for IP-CAN implemented using GPRS, subclause L.2.2.5 for IP-
CAN implemented using EPS, and subclause U.2.2.5 for IP-CAN implemented using
5GS).
In case of UE initiated resource reservation and if the UE determines resource
reservation is needed, the UE shall start reserving its local resources
whenever it has sufficient information about the media streams, media
authorization and used codecs available.
NOTE 4: Based on this resource reservation can, in certain cases, be initiated
immediately after the sending or receiving of the initial SDP offer.
In order to fulfil the QoS requirements of one or more media streams, the UE
may re-use previously reserved resources. In this case the UE shall indicate
as met the local preconditions related to the media stream, for which
resources are re-used.
[TS 24.229, clause 6.1.2]:
An INVITE request generated by a UE shall contain a SDP offer and at least one
media description. This SDP offer shall reflect the calling user\'s terminal
capabilities and user preferences for the session.
If the desired QoS resources for one or more media streams have not been
reserved at the UE when constructing the SDP offer, the UE:
shall indicate the related local preconditions for QoS as not met, using the
segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64], as well
as the strength-tag value \"mandatory\" for the local segment and the
strength-tag value either \"optional\" or as specified in RFC 3312 [30] and
RFC 4032 [64] for the remote segment, if the UE uses the precondition
mechanism (see subclause 5.1.3.1); and
\- if the UE uses the precondition mechanism (see subclause 5.1.3.1), shall
not request confirmation for the result of the resource reservation (as
defined in RFC 3312 [30]) at the terminating UE.
NOTE 1: Previous versions of this document mandated the use of the SDP
inactive attribute. This document does not prohibit specific services from
using direction attributes to implement their service-specific behaviours.
If the UE uses the precondition mechanism (see subclause 5.1.3.1), and the
desired QoS resources for one or more media streams are available at the UE
when the SDP offer is sent, the UE shall indicate the related local
preconditions as met, using the segmented status type, as defined in RFC 3312
[30] and RFC 4032 [64], as well as the strength-tag value \"mandatory\" for
the local segment and the strength-tag value either \"optional\" or as
specified in RFC 3312 [30] and RFC 4032 [64] for the remote segment and shall
not request confirmation for the result of the resource reservation (as
defined in RFC 3312 [30]) at the terminating UE.
NOTE 2: If the originating UE does not use the precondition mechanism (see
subclause 5.1.3.1), it will not include any precondition information in the
SDP message body.
...
Upon confirming successful local resource reservation, the UE shall create an
SDP offer in which the related local preconditions are set to met, using the
segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64].
Upon receiving an SDP answer, which includes more than one codec per media
stream, excluding the in-band DTMF codec, as described in subclause 6.1.1, the
UE shall:
send an SDP offer at the first possible time, selecting only one codec per
media stream; or
\- if the UE is participant in a multi-stream multiparty multimedia conference
session using simulcast (indicated by the presence of \"a=simulcast\" SDP
attribute(s) in the SDP answer, as defined in RFC 8853 [249]), apply the
procedures defined in 3GPP TS 26.114 [9B] annex S.
If the UE sends an initial INVITE request that includes only an IPv6 address
in the SDP offer, and receives an error response (e.g., 488 (Not Acceptable
Here) with 301 Warning header field) indicating \"incompatible network address
format\", the UE shall send an ACK as per standard SIP procedures.
Subsequently, the UE may acquire an IPv4 address or use an existing IPv4
address, and send a new initial INVITE request to the same destination
containing only the IPv4 address in the SDP offer.
[TS 26.114, clause 6.2.1a.1]
MTSI clients should support SDPCapNeg to be able to negotiate RTP profiles for
all media types where AVPF is supported. MTSI clients supporting SDPCapNeg
shall support the complete SDPCapNeg framework.
SDPCapNeg is described in [69]. This clause only describes the SDPCapNeg
attributes that are directly applicable for the RTP profile negotiation, i.e.
the tcap, pcfg and acfg attributes. TS 24.229 [7] may outline further
requirements needed for supporting SDPCapNeg in SDP messages.
NOTE: This clause describes only how to use the SDPCapNeg framework for RTP
profile negotiation using the tcap, pcfg and acfg attributes. Implementers may
therefore (incorrectly) assume that it is sufficient to implement only those
specific parts of the framework that are needed for RTP profile negotiation.
Doing so would however not be future proof since future versions may use other
parts of the framework and there are currently no mechanisms for declaring
that only a subset of the framework is supported. Hence, MTSI clients are
required to support the complete framework.
[TS 26.114, clause 6.2.1a.2]
For voice and real-time text, SDPCapNeg shall be used when offering AVPF the
first time for a new media type in the session since the support for AVPF in
the answering client is not known at this stage. For video, an MTSI client
shall either offer AVPF and AVP together using SDPCapNeg, or the MTSI client
shall offer only AVPF without using SDPCapNeg. If an MTSI client has offered
only AVPF for video, and then receives as response either an SDP answer where
the video media component has been rejected, or an SIP 488 or 606 failure
response with an SDP body indicating that only AVP is supported for video
media, the MTSI client should send a new SDP offer with AVP as transport for
video. Subsequent SDP offers, in a re-INVITE or UPDATE, may offer AVPF without
SDPCapNeg if it is known from an earlier re-INVITE or UPDATE that the
answering client supports this RTP profile. If the offer includes only AVP
then SDPCapNeg does not need to be used, which can occur for: text; speech if
RTCP is not used; and in re-INVITEs or UPDATEs where the RTP profile has
already been negotiated for the session in a preceding INVITE or UPDATE.
When offering AVP and AVPF using SDPCapNeg, the MTSI client shall offer AVP on
the media (m=) line and shall offer AVPF using SDPCapNeg mechanisms. The
SDPCapNeg mechanisms are used as follows:
the support for AVPF is indicated in an attribute (a=) line using the
transport capability attribute 'tcap'. AVPF shall be preferred over AVP.
at least one configuration using AVPF shall be listed using the attribute for
potential configurations 'pcfg'.
[TS 26.114, clause 6.2.3.2]:
If video is used in a session, the session setup shall determine the
applicable bandwidth(s) as defined in clause 6.2.5, RTP profile, video codec,
profile and level. The \"imageattr\" attribute as specified in [76] should be
supported. The \"framesize\" attribute as specified in [60] shall not be used
in the session setup.
An MTSI client shall offer AVPF for all media streams containing video. RTP
profile negotiation shall be done as described in clause 6.2.1a.
[TS 26.114, clause 6.2.5.1]:
The SDP shall include bandwidth information for each media stream and also for
the session in total. The bandwidth information for each media stream and for
the session is defined by the Application Specific (AS) bandwidth modifier as
defined in RFC 4566 [8].
An MTSI client in terminal should include the 'a=bw-info' attribute in the SDP
offer. When accepting a media type where the 'a=bw-info' attribute is included
the MTSI client in terminal shall include the 'a=bw-info' attribute in the SDP
answer if it supports the attribute. The 'a=bw-info' attribute and the below
used bandwidth properties are defined in clause 19.
[TS 26.114, clause 6.3]:
During session renegotiation for adding or removing media components, the SDP
offerer should continue to use the same media (m=) line(s) from the previously
negotiated SDP for the media components that are not being added or removed.
An MTSI client in terminal may support multiple media components including
media components of the same media type. An MTSI client in terminal may
support adding one or more media components to an on-going session which
already contains a media component of the same media type. If an MTSI client
in terminal needs to have multiple media components of the same media type in
a single MTSI session, then the MTSI client in terminal should use the SDP
content attributes as defined in [81] for identifying different media
components.
[TS 26.114, clause 7.3.1]
The RS and RR values included in the SDP answer should be treated as the
negotiated values for the session and should be used to calculate the total
RTCP bandwidth for all terminals in the session.
##### 7.20.3 Test description {#test-description-24 .H6}
##### 7.20.3.1 Pre-test conditions {#pre-test-conditions-24 .H6}
##### System Simulator: {#system-simulator-25 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-25 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-25 .H6}
\- UE has registered to IMS services and set up the MO call, by executing
annex A.4.1a.
##### 7.20.3.2 Test procedure sequence {#test-procedure-sequence-24 .H6}
Table 7.20.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict
                                                                                                                                              U - S              Message
1 Make UE add video to the voice call - -
2 Check: Does the UE send re-INVITE with an SDP offer containing media lines
for both voice and video? -> INVITE 1 P
3 The SS responds with a 100 Trying provisional response \
PRACK 2 P
6 The SS responds PRACK with 200 OK. \ UPDATE 3 P
8 The SS responds UPDATE with 200 OK and indicates having reserved the
resources \ ACK
4 P
11 Make UE release video from the media call - -
12 Check: Does the UE send re-INVITE with a SDP offer indicating that the
video component is removed from the call? -> INVITE 5 P
13 The SS responds with a 100 Trying provisional response \ ACK
6 P
17 Make the UE release the call. - - - -
18-19 UE releases the call\ -- - - - (Annex A.7)
* * *
##### 7.20.3.3 Specific message contents {#specific-message-contents-24 .H6}
Table 7.20.3.3-1: re-INVITE (step 2, table 7.20.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.1, | | | | | | conditions A1, | | | | | | A5 and A28. | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | Supported | | | | | +------------------+------+------------------+-----+------------------+ | **option-tag** | | _precondition_ | | | +------------------+------+------------------+-----+------------------+ | **Message-body** | | Same SDP body as | | TS 24.229 [7] | | | | in Step 6 | | | | | | (UPDATE) of | | TS 26.114 [33] | | | | Annex A.15.1a, | | | | | | with following | | | | | | differences: | | | | | | | | | | | | For | | | | | | preconditions of | | | | | | audio media: | | | | | | | | | | | | _a=curr:qos | | | | | | remote sendrecv_ | | | | | | | | | | | | For | | | | | | preconditions of | | | | | | video media: | | | | | | | | | | | | _a=curr:qos | | | | | | local none_ | | | +------------------+------+------------------+-----+------------------+
Table 7.20.3.3-2: 100 Trying (step 3, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1, Step 2
* * *
Table 7.20.3.3-3: 183 Session in Progress (step 4, table 7.20.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.3, Condition | | | | | | A1 | | | | | +------------------+------+------------------+-----+------------------+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | Require | | | | | +------------------+------+------------------+-----+------------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+------------------+ | **Message-body** | | Same SDP body as | | TS 24.229 [7] | | | | in Step 3 (183 | | | | | | Session in | | TS 26.114 [33] | | | | Progress) of | | | | | | Annex A.15.1a, | | | | | | with following | | | | | | exceptions: | | | | | | | | | | | | For | | | | | | preconditions of | | | | | | audio media: | | | | | | | | | | | | a=curr:qos local | | | | | | sendrecv | | | | | | | | | | | | a=curr:qos | | | | | | remote sendrecv | | | | | | | | | | | | Session | | | | | | description: | | | | | | | | | | | | \"o=\" line | | | | | | identical to | | | | | | previous SDP | | | | | | sent by SS | | | | | | except that | | | | | | sess-version is | | | | | | incremented by | | | | | | one | | | +------------------+------+------------------+-----+------------------+
Table 7.20.3.3-4: PRACK (step 5, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1a, Step 4
* * *
Table 7.20.3.3-5: 200 OK for PRACK (step 6, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1a, Step 5
* * *
Table 7.20.3.3-6: UPDATE (step 7, table 7.20.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.5, | | | | | | conditions A1 | | | | | | and A6. | | | | | +------------------+------+------------------+-----+------------------+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | Supported | | | | | +------------------+------+------------------+-----+------------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+------------------+ | **Message-body** | | **Same contents | | TS 24.229 [7] | | | | as specified in | | | | | | step 6 (UPDATE) | | TS 26.114 [33] | | | | of A.15.1a with | | | | | | the following | | | | | | exceptions:** | | | | | | | | | | | | For | | | | | | preconditions of | | | | | | audio media:\ | | | | | | _a=curr:qos | | | | | | remote sendrecv_ | | | +------------------+------+------------------+-----+------------------+
Table 7.20.3.3-7: 200 OK for UPDATE (step 8, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1a Step 7
* * *
Table 7.20.3.3-8: 200 OK for re-INVITE (step 9, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1a, Step 11
* * *
Table 7.20.3.3-9: ACK for re-INVITE (step 10, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1a, Step 12
* * *
Table 7.20.3.3-10: re-INVITE (step 12, table 7.20.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.1, | | | | | | conditions A1, | | | | | | A5 and A28. | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | | | | | | +------------------+------+------------------+-----+------------------+ | Supported | | | | | +------------------+------+------------------+-----+------------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+------------------+ | **Message-body** | | Same SDP body as | | TS 24.229 [7] | | | | in Step 2 | | | | | | (re-INVITE), | | TS 26.114 [33] | | | | with following | | | | | | exceptions and | | | | | | no requirements | | | | | | on b-, c- or | | | | | | a-lines on the | | | | | | video stream: | | | | | | | | | | | | **Media | | | | | | description:** | | | | | | | | | | | | _m=video 0_ | | | | | | _RTP/AVPF_ (fmt) | | | +------------------+------+------------------+-----+------------------+
Table 7.20.3.3-11: 100 Trying (step 13, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1a, step 2
* * *
Table 7.20.3.3-12: 200 OK for INVITE (step 15, table 7.20.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Annex A.3.1, | | | | | | Conditions A2, A5, | | | | | | A11, A20 and A22 | | | | | +=====================+======+=====================+=====+===========+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | Require | | | | | +---------------------+------+---------------------+-----+-----------+ | option-tag | | _precondition_ | | | +---------------------+------+---------------------+-----+-----------+ | Content-Type | | | | | +---------------------+------+---------------------+-----+-----------+ | media-type | | _application/sdp_ | | | +---------------------+------+---------------------+-----+-----------+ | Content-Length | | header shall be | | | | | | present if UE uses | | | | | | TCP to send this | | | | | | message and if | | | | | | there is a message | | | | | | body | | | +---------------------+------+---------------------+-----+-----------+ | value | | length of | | | | | | message-body | | | +---------------------+------+---------------------+-----+-----------+ | **Message-body** | | SDP body copied | | | | | | from the received | | | | | | re-INVITE in step | | | | | | 12 and modified as | | | | | | follows: | | | | | | | | | | | | - IP address on | | | | | | \"c=\" lines and | | | | | | transport port on | | | | | | \"m=\" lines | | | | | | changed to indicate | | | | | | to which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the media; | | | | | | | | | | | | - \"o=\" line | | | | | | identical to | | | | | | previous SDP sent | | | | | | by SS except that | | | | | | sess-version is | | | | | | incremented | | | +---------------------+------+---------------------+-----+-----------+
Table 7.20.3.3-13: ACK (step 16, table 7.20.3.2-1)
* * *
Derivation Path: Annex A.15.1a, step 12
* * *
## 7.21 MTSI MO Voice Call / add video and remove video / without
preconditions at both originating UE and terminating UE / 5GS
##### 7.21.1 Test Purpose (TP) {#test-purpose-tp-25 .H6}
##### (1) {#section-75 .H6}
**with** { UE is configured to not use preconditions and has set up a voice
call without preconditions }
**ensure** **that** {
**when** { UE receives re-INVITE indicating addition of video to voice call }
**then** { UE may send 100 Trying and sends 183 Session Progress with SDP
answer or sends 2OO OK with SDP answer for re-INVITE }
}
##### (2) {#section-76 .H6}
**with** { UE having optionally sent 183 Session Progress }
**ensure** **that** {
**when** { UE receives PRACK for 183 Session Progress }
**then** { UE sends 200 OK for PRACK followed by 200 OK for re-INVITE }
}
##### (3) {#section-77 .H6}
**with** { UE receiving ACK }
**ensure** **that** {
**when** { UE is made to remove video again }
**then** { UE sends re-INVITE with SDP indicating that video is being removed
from the call }
}
##### (4) {#section-78 .H6}
**with** { UE having sent re-INVITE }
**ensure** **that** {
**when** { UE receives 100 Trying followed by 200 OK and indication that video
resources have been removed }
**then** { UE sends ACK }
}
##### 7.21.2 Conformance Requirements {#conformance-requirements-26 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.173, clause 5.2]:
The IMS multimedia telephony communication service can support different types
of media, including media types listed in 3GPP TS 22.173 [2]. The session
control procedures for the different media types shall be in accordance with
3GPP TS 24.229 [13] and 3GPP TS 24.247 [14], with the following additions:
a) Multimedia telephony is an IMS communication service and the P-Preferred-
Service and P-Asserted-Service headers shall be treated as described in 3GPP
TS 24.229 [13]. The coding of the ICSI value in the P-Preferred-Service and
P-Asserted-Service headers shall be according to subclause 5.1.
[TS 24.229, clause 5.1.2A.2]:
After the dialog is established the UE may change the dialog capabilities
(e.g. add a media or request a supplementary service) if defined for the IMS
communication service as identified by the ICSI value using the same dialog.
Otherwise, the UE shall initiate a new initial request to the other user.
[TS 24.229, clause 5.1.4A.1]:
If the precondition mechanism was used during the session establishment, as
described in subclause 5.1.3.1 or 5.1.4.1, the UE shall indicate support of
the precondition mechanism during a session modification. If the precondition
mechanism was not used during the session establishment, the UE shall not
indicate support of the precondition mechanism during a session modification.
[TS 24.229, clause 5.1.4A.2]:
Upon receiving a reINVITE request, an UPDATE request, or a PRACK request that
indicates support for the precondition mechanism by using the Supported header
field or requires use of the precondition mechanism by using the Require
header field, the UE shall:
a) if the precondition mechanism was used during the session establishment, as
described in subclause 5.1.3.1 or 5.1.4.1, use the precondition mechanism for
the session modification; and
b) if the precondition mechanism was not used during the session
establishment, and:
1) if the use of the precondition mechanism is required using the Require
header field, reject the request by sending a 420 (Bad Extension) response;
and
2) if the support of the precondition mechanism is indicated using the
Supported header field, not use the precondition mechanism for the session
modification.
[TS 24.229, clause 6.1]:
The \"integration of resource management and SIP\" extension is hereafter in
this subclause referred to as \"the precondition mechanism\" and is defined in
RFC 3312 [30] as updated by RFC 4032 [64].
In order to authorize the media streams, the P-CSCF and S-CSCF have to be able
to inspect SDP message bodies. Hence, the UE shall not encrypt SDP message
bodies.
During the session establishment procedure, and during session modification
procedures, SIP messages shall only contain an SDP message body if that is
intended to modify the session description, or when the SDP message body is
included in the message because of SIP rules described in RFC 3261 [26].
...
For \"video\" and \"audio\" media types that use the RTP/RTCP and where the
port number is not zero, the UE shall specify the proposed bandwidth for each
media stream using the \"b=\" media descriptor and the \"AS\" bandwidth
modifier in the SDP.
...
If the media line in the SDP message body indicates the usage of RTP/RTCP, and
if the UE is configured to request an RTCP bandwidth level for the session is
different than the default RTCP bandwidth as specified in RFC 3556 [56], then
in addition to the \"AS\" bandwidth modifier in the media-level \"b=\" line,
the UE shall include two media-level \"b=\" lines, one with the \"RS\"
bandwidth modifier and the other with the \"RR\" bandwidth modifier as
described in RFC 3556 [56] to specify the required bandwidth allocation for
RTCP. The bandwidth-value in the b=RS: and b=RR: lines may include transport
overhead as described in subclause 6.1 of RFC 3890 [152].
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in or 3GPP 29.213 [13C].
NOTE 3: In a two-party session where both participants are active, the RTCP
receiver reports are not sent, therefore, the RR bandwidth modifier will
typically get the value of zero.
If an in-band DTMF codec is supported by the application associated with an
audio media stream, then the UE shall include, in addition to the payload type
numbers associated with the audio codecs for the media stream, for each clock
rate associated with the audio codecs for the media stream, a payload type
number associated with the MIME subtype \"telephone-event\", to indicate
support of in-band DTMF as described in RFC 4733 [23].
The UE shall inspect the SDP message body contained in any SIP request or
response, looking for possible indications of grouping of media streams
according to RFC 3524 [54] and perform the appropriate actions for IP-CAN
bearer establishment for media according to IP-CAN specific procedures (see
subclause B.2.2.5 for IP-CAN implemented using GPRS, subclause L.2.2.5 for IP-
CAN implemented using EPS, and subclause U.2.2.5 for IP-CAN implemented using
5GS).
In case of UE initiated resource reservation and if the UE determines resource
reservation is needed, the UE shall start reserving its local resources
whenever it has sufficient information about the media streams, media
authorization and used codecs available.
NOTE 4: Based on this resource reservation can, in certain cases, be initiated
immediately after the sending or receiving of the initial SDP offer.
In order to fulfil the QoS requirements of one or more media streams, the UE
may re-use previously reserved resources. In this case the UE shall indicate
as met the local preconditions related to the media stream, for which
resources are re-used.
[TS 24.229, clause 6.1.2]:
An INVITE request generated by a UE shall contain a SDP offer and at least one
media description. This SDP offer shall reflect the calling user\'s terminal
capabilities and user preferences for the session.
If the desired QoS resources for one or more media streams have not been
reserved at the UE when constructing the SDP offer, the UE:
shall indicate the related local preconditions for QoS as not met, using the
segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64], as well
as the strength-tag value \"mandatory\" for the local segment and the
strength-tag value either \"optional\" or as specified in RFC 3312 [30] and
RFC 4032 [64] for the remote segment, if the UE uses the precondition
mechanism (see subclause 5.1.3.1); and
\- if the UE uses the precondition mechanism (see subclause 5.1.3.1), shall
not request confirmation for the result of the resource reservation (as
defined in RFC 3312 [30]) at the terminating UE.
NOTE 1: Previous versions of this document mandated the use of the SDP
inactive attribute. This document does not prohibit specific services from
using direction attributes to implement their service-specific behaviours.
If the UE uses the precondition mechanism (see subclause 5.1.3.1), and the
desired QoS resources for one or more media streams are available at the UE
when the SDP offer is sent, the UE shall indicate the related local
preconditions as met, using the segmented status type, as defined in RFC 3312
[30] and RFC 4032 [64], as well as the strength-tag value \"mandatory\" for
the local segment and the strength-tag value either \"optional\" or as
specified in RFC 3312 [30] and RFC 4032 [64] for the remote segment and shall
not request confirmation for the result of the resource reservation (as
defined in RFC 3312 [30]) at the terminating UE.
NOTE 2: If the originating UE does not use the precondition mechanism (see
subclause 5.1.3.1), it will not include any precondition information in the
SDP message body.
...
Upon confirming successful local resource reservation, the UE shall create an
SDP offer in which the related local preconditions are set to met, using the
segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64].
Upon receiving an SDP answer, which includes more than one codec per media
stream, excluding the in-band DTMF codec, as described in subclause 6.1.1, the
UE shall:
send an SDP offer at the first possible time, selecting only one codec per
media stream; or
\- if the UE is participant in a multi-stream multiparty multimedia conference
session using simulcast (indicated by the presence of \"a=simulcast\" SDP
attribute(s) in the SDP answer, as defined in RFC 8853 [249]), apply the
procedures defined in 3GPP TS 26.114 [9B] annex S.
If the UE sends an initial INVITE request that includes only an IPv6 address
in the SDP offer, and receives an error response (e.g., 488 (Not Acceptable
Here) with 301 Warning header field) indicating \"incompatible network address
format\", the UE shall send an ACK as per standard SIP procedures.
Subsequently, the UE may acquire an IPv4 address or use an existing IPv4
address, and send a new initial INVITE request to the same destination
containing only the IPv4 address in the SDP offer.
[TS 26.114, clause 6.2.1a.1]
MTSI clients should support SDPCapNeg to be able to negotiate RTP profiles for
all media types where AVPF is supported. MTSI clients supporting SDPCapNeg
shall support the complete SDPCapNeg framework.
SDPCapNeg is described in [69]. This clause only describes the SDPCapNeg
attributes that are directly applicable for the RTP profile negotiation, i.e.
the tcap, pcfg and acfg attributes. TS 24.229 [7] may outline further
requirements needed for supporting SDPCapNeg in SDP messages.
NOTE: This clause describes only how to use the SDPCapNeg framework for RTP
profile negotiation using the tcap, pcfg and acfg attributes. Implementers may
therefore (incorrectly) assume that it is sufficient to implement only those
specific parts of the framework that are needed for RTP profile negotiation.
Doing so would however not be future proof since future versions may use other
parts of the framework and there are currently no mechanisms for declaring
that only a subset of the framework is supported. Hence, MTSI clients are
required to support the complete framework.
[TS 26.114, clause 6.2.1a.2]
For voice and real-time text, SDPCapNeg shall be used when offering AVPF the
first time for a new media type in the session since the support for AVPF in
the answering client is not known at this stage. For video, an MTSI client
shall either offer AVPF and AVP together using SDPCapNeg, or the MTSI client
shall offer only AVPF without using SDPCapNeg. If an MTSI client has offered
only AVPF for video, and then receives as response either an SDP answer where
the video media component has been rejected, or an SIP 488 or 606 failure
response with an SDP body indicating that only AVP is supported for video
media, the MTSI client should send a new SDP offer with AVP as transport for
video. Subsequent SDP offers, in a re-INVITE or UPDATE, may offer AVPF without
SDPCapNeg if it is known from an earlier re-INVITE or UPDATE that the
answering client supports this RTP profile. If the offer includes only AVP
then SDPCapNeg does not need to be used, which can occur for: text; speech if
RTCP is not used; and in re-INVITEs or UPDATEs where the RTP profile has
already been negotiated for the session in a preceding INVITE or UPDATE.
When offering AVP and AVPF using SDPCapNeg, the MTSI client shall offer AVP on
the media (m=) line and shall offer AVPF using SDPCapNeg mechanisms. The
SDPCapNeg mechanisms are used as follows:
the support for AVPF is indicated in an attribute (a=) line using the
transport capability attribute 'tcap'. AVPF shall be preferred over AVP.
at least one configuration using AVPF shall be listed using the attribute for
potential configurations 'pcfg'.
[TS 26.114, clause 6.2.3.2]:
If video is used in a session, the session setup shall determine the
applicable bandwidth(s) as defined in clause 6.2.5, RTP profile, video codec,
profile and level. The \"imageattr\" attribute as specified in [76] should be
supported. The \"framesize\" attribute as specified in [60] shall not be used
in the session setup.
An MTSI client shall offer AVPF for all media streams containing video. RTP
profile negotiation shall be done as described in clause 6.2.1a.
[TS 26.114, clause 6.2.5.1]:
The SDP shall include bandwidth information for each media stream and also for
the session in total. The bandwidth information for each media stream and for
the session is defined by the Application Specific (AS) bandwidth modifier as
defined in RFC 4566 [8].
An MTSI client in terminal should include the 'a=bw-info' attribute in the SDP
offer. When accepting a media type where the 'a=bw-info' attribute is included
the MTSI client in terminal shall include the 'a=bw-info' attribute in the SDP
answer if it supports the attribute. The 'a=bw-info' attribute and the below
used bandwidth properties are defined in clause 19.
[TS 26.114, clause 6.3]:
During session renegotiation for adding or removing media components, the SDP
offerer should continue to use the same media (m=) line(s) from the previously
negotiated SDP for the media components that are not being added or removed.
An MTSI client in terminal may support multiple media components including
media components of the same media type. An MTSI client in terminal may
support adding one or more media components to an on-going session which
already contains a media component of the same media type. If an MTSI client
in terminal needs to have multiple media components of the same media type in
a single MTSI session, then the MTSI client in terminal should use the SDP
content attributes as defined in [81] for identifying different media
components.
[TS 26.114, clause 7.3.1]
The RS and RR values included in the SDP answer should be treated as the
negotiated values for the session and should be used to calculate the total
RTCP bandwidth for all terminals in the session.
##### 7.21.3 Test description {#test-description-25 .H6}
##### 7.21.3.1 Pre-test conditions {#pre-test-conditions-25 .H6}
##### System Simulator: {#system-simulator-26 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-26 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to not use preconditions.
##### Preamble: {#preamble-26 .H6}
\- UE registered to IMS services and set up the MO call, by executing annex
A.4.2.
##### 7.21.3.2 Test procedure sequence {#test-procedure-sequence-25 .H6}
Table 7.21.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-----------+-----------+-----------+-----------+---------+----+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | SS sends | \ | 100 | - | - | | | UE may | | Trying | | | | | respond | | | | | | | with a | | | | | | | 100 | | | | | | | Trying | | | | | | | pr | | | | | | | ovisional | | | | | | | response | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2A | SS starts | - | - | - | - | | | a timer | | | | | | | (2 | | | | | | | seconds) | | | | | | | to wait | | | | | | | for an | | | | | | | optional | | | | | | | 183 | | | | | | | Session | | | | | | | in | | | | | | | Progress | | | | | | | from UE. | | | | | | | | | | | | | | NOTE: If | | | | | | | the UE | | | | | | | does not | | | | | | | send 183 | | | | | | | Session | | | | | | | in | | | | | | | Progress | | | | | | | before | | | | | | | timer | | | | | | | expiry, | | | | | | | proceed | | | | | | | to step | | | | | | | 3b1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps 3a1 | | | | | | | to 3b4 | | | | | | | describe | | | | | | | behaviour | | | | | | | that | | | | | | | depends | | | | | | | on UE | | | | | | | implem | | | | | | | entation; | | | | | | | the | | | | | | | "lower | | | | | | | case | | | | | | | letter" | | | | | | | i | | | | | | | dentifies | | | | | | | a step | | | | | | | sequence | | | | | | | that | | | | | | | takes | | | | | | | place if | | | | | | | such | | | | | | | imple | | | | | | | mentation | | | | | | | take | | | | | | | place. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a1 | Check: | --> | 183 | 1 | P | | | Does the | | Session | | | | | UE | | in | | | | | respond | | Progress | | | | | 183 | | | | | | | Session | | | | | | | in | | | | | | | Progress | | | | | | | with an | | | | | | | SDP | | | | | | | answer? | | | | | | | | | | | | | | (Step 3 | | | | | | | of Annex | | | | | | | A.16.2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a2 | Timer | - | - | - | - | | | from step | | | | | | | 2A is | | | | | | | stopped. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a3 | SS | \ | 200 OK | 2 | P | | | Does the | | | | | | | UE | | | | | | | respond | | | | | | | PRACK | | | | | | | with 200 | | | | | | | OK? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a5 | SS | - | - | - | - | | | reserves | | | | | | | resources | | | | | | | for video | | | | | | | by | | | | | | | executing | | | | | | | TS | | | | | | | 38.508-1 | | | | | | | cl 4.9.27 | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a6 | Make UE | - | - | - | - | | | accept | | | | | | | the call | | | | | | | mod | | | | | | | ification | | | | | | | (Note 1). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a7 | UE | --> | 200 OK | 2 | P | | | responds | | | | | | | re-INVITE | | | | | | | with 200 | | | | | | | OK | | | | | | | | | | | | | | (Step 9 | | | | | | | of Annex | | | | | | | A.16.2) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3a8 | SS | \ | 200 OK | 1, 2 | P | | | Does the | | | | | | | UE | | | | | | | respond | | | | | | | to | | | | | | | re-INVITE | | | | | | | with 200 | | | | | | | OK with | | | | | | | SDP | | | | | | | answer? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3b3 | SS | - | - | - | - | | | reserves | | | | | | | resources | | | | | | | for video | | | | | | | by | | | | | | | executing | | | | | | | TS | | | | | | | 38.508-1 | | | | | | | cl 4.9.27 | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3b4 | SS | \ | INVITE | 3 | P | | | Does the | | | | | | | UE send | | | | | | | re-INVITE | | | | | | | with a | | | | | | | SDP offer | | | | | | | i | | | | | | | ndicating | | | | | | | that the | | | | | | | video | | | | | | | component | | | | | | | is | | | | | | | removed | | | | | | | from the | | | | | | | call? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | The SS | \ | ACK | 4 | P | | | Does the | | | | | | | UE | | | | | | | ac | | | | | | | knowledge | | | | | | | the | | | | | | | receipt | | | | | | | of 200 OK | | | | | | | for | | | | | | | r | | | | | | | e-INVITE? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | Make the | - | - | - | - | | | UE | | | | | | | release | | | | | | | the call | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | UE sends | --> | BYE | - | - | | | BYE | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 16 | SS sends | \ INVITE 1 P 2 SS responds with 100 Trying \ PRACK 2 P 5 SS responds to PRACK with 200 OK \ UPDATE 3 P 7 SS responds UPDATE with 200
OK indicating reservation of resources \ ACK 4 P 10 SS sends re-INVITE with SDP
offer indicating that video component is removed from the call. \ 100 Trying - - 12 Check: does the
UE responds to re-invite with 200 OK final response? --> 200 OK 5 P 13 SS
releases the QoS flow for video by executing TS 38.508-1 cl 4.9.28. - - - - 14
The SS acknowledges the receipt of 200 OK for re-INVITE. \ INVITE 1 P
3 SS responds with a 100 Trying provisional response \
PRACK 2 P
6 SS responds PRACK with 200 OK \ ACK
3 P
9 SS sends re-INVITE with a SDP offer indicating that the video component is
removed from the call \ 100 Trying 4 P
11 UE responds to re-invite with 200 OK final response. --> 200 OK - -
12 SS releases the QoS flow for video by executing TS 38.508-1 cl 4.9.28. - -
- -
13 The SS acknowledges the receipt of 200 OK for re-INVITE. \ 1\. SIP; cause=200; text=\"Call completed elsewhere\"
>
> 2\. SIP; cause=603; text=\"Declined\"
>
> 3\. SIP; cause=600; text=" Busy Everywhere"
for forked calls as defined in 3GPP TS 24.229 [8].
##### 7.24.4 Test description {#test-description-28 .H6}
##### 7.24.4.1 Pre-test conditions {#pre-test-conditions-28 .H6}
##### System Simulator: {#system-simulator-29 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-29 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-29 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 7.24.4.2 Test procedure sequence {#test-procedure-sequence-28 .H6}
Table 7.24.4.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict
                                                                                                                            U - S              Message
1-8 Steps 1-8 of generic procedure specified in Table 4.9.16.2.2-1 of TS
38.508-1 [21] are performed - - - -
9-13 MT voice call setup is initiated and proceeds until before UE is made to
accept the voice call\ - - - - (Steps 1--5 of Annex A.5.1a)
13A-13C Steps 10-12 of generic procedure specified in Table 4.9.16.2.2-1 of TS
38.508-1 [21] are performed - - - -
14-18 MT voice call setup proceeds until before SS sends UPDATE (Steps 6--10
of Annex A.5.1a) - - - -
19 SS sends a CANCEL request \ 200 OK 1 P
21 SS sends ACK \ 487 Request
Terminated 1 P
* * *
##### 7.24.4.3 Specific message contents {#specific-message-contents-28 .H6}
Table 7.24.4.3-1: CANCEL (step 19, table 7.24.4.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.2.15
* * *
Header/param Cond Value/remark Rel **Reference** Reason RFC 3326 [42] protocol
_SIP_  
protocol-cause _cause=200_  
reason-text _text="Call completed elsewhere"_
Table 7.24.4.3-2: 200 OK (step 20, table 7.24.4.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1
* * *
Table 7.24.4.3-3: 487 Request Terminated (step 1, table 7.24.4.2-2)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.16
* * *
Table 7.24.4.3-4: ACK (step 21, table 7.24.4.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.7
* * *
## 7.24a MTSI MO Voice Call / Forking / UE receives two preliminary responses
and one early dialog termination / 5GS
##### 7.24a.1 Test Purpose (TP) {#a.1-test-purpose-tp-1 .H6}
##### (1) {#section-89 .H6}
**with** { UE being registered to IMS and configured to use preconditions and
to not use GRUU and to not suppress forking }
**ensure** **that** {
**when** { UE is made to start a voice call, processes the call setup until
before completion, and then receives another early dialog indication }
**then** { UE processes the second early dialog until before completion }
}
##### (2) {#section-90 .H6}
**with** { UE having proceeded two early dialogs }
**ensure** **that** {
**when** { UE receives 199 Early Dialog Terminated for the first dialog,
followed by 200 OK for the second dialog }
**then** { UE sends ACK on the second dialog and maintains it }
}
##### 7.24a.2 Conformance Requirements {#a.2-conformance-requirements-1 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 5.1.3.1]:
Upon receiving a 199 (Early Dialog Terminated) provisional response to an
established early dialog the UE shall release resources specifically related
to that early dialog.
##### 7.24a.3 Profile Requirements (Informative) {#a.3-profile-requirements-
informative .H6}
[GSMA NG.114 V1.0, clause 2.3.7]:
It is also possible that the network or the terminating UE will need to
release an early dialog using the 199 (Early Dialog Terminated) response
defined in IETF RFC 6228 [85]. To support this, the originating UE must
include the \"199\" option tag in the Supported header field in the initial
INVITE request and must understand a 199 (Early Dialog Terminated) response
code and act as specified in section 5.1.3.1 of 3GPP TS 24.229 [8].
##### 7.24a.4 Test description {#a.4-test-description .H6}
##### 7.24a.4.1 Pre-test conditions {#a.4.1-pre-test-conditions .H6}
##### System Simulator: {#system-simulator-30 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-30 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
\- UE is configured to not use GRUU.
\- UE is configured to not suppress forking via the no-fork directive.
##### Preamble: {#preamble-30 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 7.24a.4.2 Test procedure sequence {#a.4.2-test-procedure-sequence .H6}
Table 7.24a.4.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to start a | | | | | | | voice call. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2-8 | Steps 2-8 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 9-12 | UE | - | - | - | - | | | continues | | | | | | | call setup | | | | | | | (dialog 1) | | | | | | | | | | | | | | (steps 2-5 | | | | | | | of Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 13 | SS triggers | - | - | - | - | | | resource | | | | | | | r | | | | | | | eservation: | | | | | | | Step 10 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] is | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to steps 14 | | | | | | | and 15 | | | | | | | below, step | | | | | | | 16 occurs. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 14-15 | SS triggers | - | - | - | - | | | resource | | | | | | | r | | | | | | | eservation: | | | | | | | Steps 11-12 | | | | | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 16-20 | UE | - | - | - | - | | | continues | | | | | | | call setup | | | | | | | (dialog 1) | | | | | | | | | | | | | | (steps 6-10 | | | | | | | of A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 21 | SS sends | \ | PRACK | 1 | P | | | the UE send | | | | | | | PRACK | | | | | | | message? | | | | | | | (dialog 2) | | | | | | | | | | | | | | (step 4 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 23 | SS responds | \ | UPDATE | 1 | P | | | the UE | | | | | | | initiate a | | | | | | | second SDP | | | | | | | offer in an | | | | | | | UPDATE | | | | | | | request? | | | | | | | (dialog 2) | | | | | | | | | | | | | | (step 6 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 23B | SS responds | \ | PRACK | - | - | | | a | | | | | | | cknowledges | | | | | | | reception | | | | | | | of 180 | | | | | | | Ringing | | | | | | | (step 9 of | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 26 | SS responds | \ | ACK | 2 | P | | | the UE send | | | | | | | ACK? | | | | | | | (dialog 2) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 30 | Check: Does | --> | BYE | 2 | F | | | the UE send | | | | | | | a BYE | | | | | | | within the | | | | | | | next 5 | | | | | | | seconds? | | | | | | | (i.e. does | | | | | | | the UE not | | | | | | | maintain | | | | | | | dialog 2) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 31-32 | SS and | - | - | - | - | | | releases | | | | | | | the call | | | | | | | (dialog 2)\ | | | | | | | (Annex A.8) | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 7.24a.4.3 Specific message contents {#a.4.3-specific-message-contents
.H6}
Table 7.24a.4.3-1: INVITE (in steps 2-8, table 7.24a.4.2-1)
Derivation Path: Annex A.4.1a, Step 1
* * *
Header/param Cond Value/remark Rel Reference **Supported**  
option-tag _199_ RFC 6228 [49]
Table 7.24a.4.3-2: 183 Session Progress (step 21, table 7.24a.4.2-1)
Derivation Path: Annex A.4.1a, Step 3
* * *
Header/param Cond Value/remark Rel Reference **To** RFC 3261 [6] addr-spec
same value as received in INVITE message  
tag _any value different from the one used for dialog 1_  
**Contact** RFC 3261 [6] addr-spec _px_IMS_CalleeContactUri2_  
**Message-body** _o=- 1111111112 1111111111 IN_ (addrtype) (unicast-address
for SS) RFC 4566 [38]
Table 7.24a.4.3-2A: PRACK (step 22 table 7.24a.4.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.2.4, | | | | | | Conditions A1 | | | | | | and A7 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | **Require** | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | precondition | | | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | (if present) | | TS 24.229 [7] | | | | | | | | | | Contents is | | | | | | copied from step | | | | | | 6 of annex | | | | | | A.4.1a. | | | +------------------+------+------------------+-----+-----------------+
Table 7.24a.4.3-2B: 200 OK (step 23, table 7.24a.4.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.3.1, | | | | | | Conditions A10 | | | | | | and A22 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | **Require** | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | precondition | | | +------------------+------+------------------+-----+-----------------+ | **Content-Type** | | (present, if | | | | | | content-type was | | | | | | present in PRACK | | | | | | at step 22) | | | +------------------+------+------------------+-----+-----------------+ | media-type | | application/sdp | | | +------------------+------+------------------+-----+-----------------+ | ** | | | | | | Content-Length**| | | | | +------------------+------+------------------+-----+-----------------+ | value | | length of | | | | | | message-body | | | +------------------+------+------------------+-----+-----------------+ |** Message-body** | | (present, if | | TS 24.229 [7] | | | | Message-Body was | | | | | | present in PRACK | | | | | | at step 22) | | | | | | | | | | | | SDP body of the | | | | | | 200 OK response | | | | | | copied from the | | | | | | received PRACK | | | | | | and modified as | | | | | | follows: | | | | | | | | | | | | - IP address on | | | | | | \"c=\" lines and | | | | | | transport port | | | | | | on \"m=\" lines | | | | | | changed to | | | | | | indicate to | | | | | | which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the | | | | | | media; | | | | | | | | | | | | - \"o=\" line | | | | | | identical to | | | | | | previous SDP | | | | | | sent by SS | | | | | | except that | | | | | | sess-version is | | | | | | incremented; | | | | | | | | | | | | - Attributes | | | | | | for | | | | | | preconditions: | | | | | | a=curr:qos | | | | | | remote sendrecv. | | | +------------------+------+------------------+-----+-----------------+
Table 7.24a.4.3-3: 199 Early Dialog Terminated (step 27, table 7.24a.4.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.26
* * *
Table 7.24a.4.3-4: 200 OK (step 28, table 7.24a.4.2-1)
* * *
Derivation Path: Annex A.4.1a, step 11, with same to tag as used in step 21 of
Test procedure sequence
* * *
Table 7.24a.4.3-5: ACK (step 29, table 7.24a.4.2-1)
* * *
Derivation Path: Annex A.4.1a, step 12, with same to tag as used in step 21 of
Test procedure sequence
* * *
## 7.24b MTSI MO Voice Call / Forking / UE receives two preliminary responses
and one final response / 5GS
##### 7.24b.1 Test Purpose (TP) {#b.1-test-purpose-tp .H6}
##### (1) {#section-91 .H6}
**with** { UE being registered to IMS and configured to use preconditions and
to not use GRUU and to not suppress forking }
**ensure** **that** {
**when** { UE is made to start a voice call, processes the call setup until
before completion, and then receives another early dialog indication }
**then** { UE processes the second early dialog until before completion }
}
##### (2) {#section-92 .H6}
**with** { UE having processed two early dialogs until before completion }
**ensure** **that** {
**when** { one of the early dialog moves to established state and the other
early dialog is then indicated to be ready for establishment as well }
**then** { UE sends ACK for this other dialog and terminates it right away by
sending BYE }
}
##### 7.24b.2 Conformance Requirements {#b.2-conformance-requirements .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229, clause 5.1.3.1]:
When a final answer is received for one of the early dialogs, the UE proceeds
to set up the SIP session. The UE shall not progress any remaining early
dialogs to established dialogs. Therefore, upon the reception of a subsequent
final 200 (OK) response for an INVITE request (e.g., due to forking), the UE
shall:
1) acknowledge the response with an ACK request; and
2) send a BYE request to this dialog in order to terminate it.
##### 7.24b.3 Profile Requirements (Informative) {#b.3-profile-requirements-
informative .H6}
[GSMA NG.114 V1.0, clause 2.2.7]:
It is also possible that the network or the terminating UE will need to
release an early dialog using the 199 (Early Dialog Terminated) response
defined in IETF RFC 6228 [85]. To support this, the originating UE must
include the \"199\" option tag in the Supported header field in the initial
INVITE request and must understand a 199 (Early Dialog Terminated) response
code and act as specified in section 5.1.3.1 of 3GPP TS 24.229 [8].
Note 1: An early dialog that is maintained is one where a SIP 18x response has
been received and the early dialogue has not been terminated (e.g. by receipt
of a SIP 199 response) prior to receiving a SIP 2xx response.
Note 2: Multiple early dialogs can occur as a result of forking or for other
reasons such as announcements or services.
##### 7.24b.4 Test description {#b.4-test-description .H6}
##### 7.24b.4.1 Pre-test conditions {#b.4.1-pre-test-conditions .H6}
##### System Simulator: {#system-simulator-31 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-31 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
\- UE is configured to not use GRUU.
\- UE is configured to not suppress forking via the no-fork directive.
##### Preamble: {#preamble-31 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 7.24b.4.2 Test procedure sequence {#b.4.2-test-procedure-sequence .H6}
Table 7.24b.4.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+-------------+-------------+-------------+---------+----+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to start a | | | | | | | voice call | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2-8 | Steps 2-8 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed | | | | | +-------+-------------+-------------+-------------+---------+----+ | 9-12 | UE | - | - | - | - | | | continues | | | | | | | call setup | | | | | | | (dialog 1) | | | | | | | | | | | | | | (steps 2-5 | | | | | | | of Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 13 | SS triggers | - | - | - | - | | | resource | | | | | | | r | | | | | | | eservation: | | | | | | | Step 10 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] is | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to steps 14 | | | | | | | and 15 | | | | | | | below, step | | | | | | | 16 occurs. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 14-15 | SS triggers | - | - | - | - | | | resource | | | | | | | r | | | | | | | eservation: | | | | | | | Steps 11-12 | | | | | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 16-20 | UE | - | - | - | - | | | continues | | | | | | | call setup | | | | | | | (dialog 1) | | | | | | | | | | | | | | (steps 6-10 | | | | | | | of A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 21 | SS sends | \ | PRACK | - | - | | | PRACK | | | | | | | optionally | | | | | | | including | | | | | | | an SDP | | | | | | | answer | | | | | | | | | | | | | | (dialog 2) | | | | | | | | | | | | | | (step 4 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 23 | SS responds | \ | UPDATE | 1 | P | | | the UE | | | | | | | initiate a | | | | | | | second SDP | | | | | | | offer in an | | | | | | | UPDATE | | | | | | | request? | | | | | | | (dialog 2) | | | | | | | | | | | | | | (Step 6 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 23B | SS responds | \ | PRACK | 1 | P | | | the UE | | | | | | | acknowledge | | | | | | | reception | | | | | | | of 180 | | | | | | | Ringing by | | | | | | | sending | | | | | | | PRACK | | | | | | | message? | | | | | | | (dialog 2)\ | | | | | | | (step 9 of | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 26 | SS responds | \ | ACK | - | - | | | ACK for | | | | | | | dialog 1 | | | | | | | | | | | | | | (step 12 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 29 | SS sends | \ | ACK | 2 | P | | | the UE send | | | | | | | an ACK | | | | | | | message for | | | | | | | dialog 2? | | | | | | | | | | | | | | (step 12 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 31 | Check: Does | --> | BYE | 2 | P | | | the UE send | | | | | | | a BYE | | | | | | | message for | | | | | | | dialog 2? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 32 | SS sends | \ Optional step: 100 Trying - - 4 Check: Does the UE
send 183 Session Progress reliably and containing an SDP offer? --> 183
Session Progress 1 P 5 SS sends PRACK containing an SDP answer. \ 200 OK - - 6A-6C SS triggers
resource reservation: Steps 10-12 of generic procedure specified in Table
4.9.16.2.2-1 of TS 38.508-1 [21] are performed. - - - - 7 SS sends UPDATE
containing an SDP offer. \ 200 OK - - 9 UE sends 180 Ringing
response. --> 180 Ringing - - 10 If UE sent 180 Ringing response reliably, the
SS sends PRACK. \ Conditional step: 200 OK
- - 12 Make the UE accept the voice call - - - - 13 UE sends 200 OK for
INVITE. --> 200 OK 1 P 14 SS sends ACK. \ | PRACK | 1 | P | | | the UE | | | | | | | acknowledge | | | | | | | reception | | | | | | | of 183 | | | | | | | Session | | | | | | | Progress? | | | | | | | (dialog 2) | | | | | | | | | | | | | | (Step 4 of | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 11 | SS responds | \ | UPDATE | 1 | P | | | the UE | | | | | | | initiate a | | | | | | | second SDP | | | | | | | offer in an | | | | | | | UPDATE | | | | | | | request? | | | | | | | (dialog 2) | | | | | | | | | | | | | | (step 6 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 11B | SS responds | \ | ACK | 2 | P | | | the UE send | | | | | | | the ACK to | | | | | | | the 200 OK | | | | | | | for the | | | | | | | INVITE in | | | | | | | step 1? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 16 | The UE is | - | - | - | - | | | made to | | | | | | | release the | | | | | | | call | | | | | +-------+-------------+-------------+-------------+---------+----+ | 17 | The UE | --> | BYE | - | - | | | releases | | | | | | | the call | | | | | | | with BYE | | | | | +-------+-------------+-------------+-------------+---------+----+ | 18 | The SS | \ NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.26.3.3 Specific message contents {#specific-message-contents-30 .H6}
Table 7.26.3.3-1: 183 Session Progress with an SDP offer (step 9, table
7.26.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.2.3, | | | | | | Condition A1 | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | **To** | | | | | +------------------+------+------------------+-----+------------------+ | **tag** | | any value | | | | | | different from | | | | | | what is used in | | | | | | steps 1-5 | | | +------------------+------+------------------+-----+------------------+ | **Contact** | | | | | +------------------+------+------------------+-----+------------------+ | **addr-spec** | | _\ _ | | | +------------------+------+------------------+-----+------------------+ | * | | | | | | _P-Early-Media_ _| | | | | +------------------+------+------------------+-----+------------------+ |__em-param_ _| |_ sendonly _| | | +------------------+------+------------------+-----+------------------+ |__Require_ _| | | | TS 24.229 [7] | +------------------+------+------------------+-----+------------------+ |__option-tag_ _| |_ precondition _| | | +------------------+------+------------------+-----+------------------+ |__Message-body_ _| |__Session | | TS 24.229 [7]\ | | | | description:__| | RFC 4566 [38] | | | | | | | | | |_ v=0 _| | | | | | | | | | | |_ o=- 1111111112 | | | | | | 1111111111 IN _| | | | | | (addrtype) | | | | | | (unicast-address | | | | | | for SS for | | | | | | early-media) | | | | | | | | | | | |_ s=-_| | | | | | | | | | | |_ c=IN _| | | | | | (addrtype) | | | | | | (co | | | | | | nnection-address | | | | | | for SS for | | | | | | early-media) | | | | | | | | | | | |_ b=AS:37 _| | | | | | | | | | | |__Attributes for | | | | | | preconditions:__| | | | | | | | | | | |_ a=curr:qos | | | | | | local sendrecv _| | | | | | | | | | | |_ a=curr:qos | | | | | | remote none _| | | | | | | | | | | |_ a=des:qos | | | | | | mandatory local | | | | | | sendrecv _| | | | | | | | | | | |_ a=des:qos | | | | | | mandatory remote | | | | | | sendrecv _| | | | | | | | | | | |_ a=conf:qos | | | | | | remote sendrecv _| | | | | | | | | | | |__Other | | | | | | attributes:__| | | | | | | | | | | |_ a=con | | | | | | tent:g.3gpp.cat* | | | +------------------+------+------------------+-----+------------------+
Table 7.26.3.3-2: PRACK (step 10, table 7.26.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.2.4, | | | | | | Conditions A1 | | | | | | and A7 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | (if present) | | TS 24.229 [7] | | | | | | | | | | Contents is | | | | | | copied from step | | | | | | 6 of annex | | | | | | A.4.1a with the | | | | | | following | | | | | | exceptions: | | | | | | | | | | | | **Attributes for | | | | | | preconditions:** | | | | | | | | | | | | _a=curr:qos | | | | | | local sendrecv_ | | | | | | | | | | | | _a=curr:qos | | | | | | remote sendrecv_ | | | | | | | | | | | | _a=des:qos | | | | | | mandatory local | | | | | | sendrecv_ | | | | | | | | | | | | _a=des:qos | | | | | | optional remote | | | | | | sendrecv_ or | | | | | | _a=des:qos | | | | | | mandatory remote | | | | | | sendrecv_ | | | +------------------+------+------------------+-----+-----------------+
Table 7.26.3.3-2A: UPDATE (step 11A, table 7.26.3.2-1)
Derivation Path: TS 34.229-1 [2], Table in annex A.2.5, Conditions A1 and A6
* * *
Header/param Cond Value/remark Rel Reference **Require**  
**option-tag** _precondition_  
**Message-body** same contents as specified in table 7.26.3.3-2 TS 24.229 [7]
Table 7.26.3.3-3: 200 OK (step 11, table 7.26.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.3.1, | | | | | | Conditions A10 | | | | | | and A22 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | Content-Type | | (present, if | | | | | | content-type was | | | | | | present in PRACK | | | | | | at step 10) | | | +------------------+------+------------------+-----+-----------------+ | media-type | | * | | | | | | application/sdp _| | | +------------------+------+------------------+-----+-----------------+ | Content-Length | | | | | +------------------+------+------------------+-----+-----------------+ | value | | length of | | | | | | message-body | | | +------------------+------+------------------+-----+-----------------+ |__Message-body_ _| | (present, if | | TS 24.229 [7] | | | | Message-Body was | | | | | | present in PRACK | | | | | | at step 10) | | | | | | | | | | | | SDP body of the | | | | | | 200 OK response | | | | | | copied from the | | | | | | received PRACK | | | | | | and modified as | | | | | | follows: | | | | | | | | | | | | - IP address on | | | | | | \"c=\" lines and | | | | | | transport port | | | | | | on \"m=\" lines | | | | | | changed to | | | | | | indicate to | | | | | | which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the | | | | | | media (same as | | | | | | used in step 9 | | | | | | above); | | | | | | | | | | | |_ \- \"o=\" line | | | | | | identical to | | | | | | previous SDP | | | | | | sent by SS | | | | | | except that | | | | | | sess-version is | | | | | | incremented.* | | | +------------------+------+------------------+-----+-----------------+
## 7.27 Session Timer / MO Voice Call / UE is able to refresh the session /
5GS
##### 7.27.1 Test Purpose (TP) {#test-purpose-tp-31 .H6}
##### (1) {#section-96 .H6}
**with** { UE being registered to IMS and being configured to use Session
Timer and preconditions }
**ensure** **that** {
**when** { UE is being made to initiate a voice call }
**then** { UE sends INVITE for voice call }
}
##### (2) {#section-97 .H6}
**with** { UE having included Session-Expires in INVITE }
**ensure** **that** {
**when** { UE receives 100 Trying followed by 422 Session Interval Too Small
with Min-SE value of 1860 }
**then** { UE sends ACK and new INVITE with Min-SE value and Session-Expires
value being 1860 }
}
##### (3) {#section-98 .H6}
**with** { UE having send 2nd INVITE }
**ensure** **that** {
**when** { UE receives 100 Trying followed by 422 Session Interval Too Small
with Min-SE value of 1920 }
**then** { UE sends ACK and new INVITE with Min-SE value and Session-Expires
value being 1920 }
}
##### (4) {#section-99 .H6}
**with** { UE having sent 3rd INVITE }
**ensure** **that** {
**when** { UE receiving 100 Trying followed by 183 Session Progress }
**then** { UE concludes voice call set up procedure up until sending ACK, with
Session-Expires having value 1920 and refresher being set to uac }
}
##### (5) {#section-100 .H6}
**with** { UE having been chosen as refresher for established voice call }
**ensure** **that** {
**when** { voice call has been going on for 960 seconds }
**then** { UE sends UPDATE to refresh the session }
}
##### (6) {#section-101 .H6}
**with** { UE having been chosen as refresher for established voice call }
**ensure** **that** {
**when** { voice call has been going on for another 960 seconds }
**then** { UE sends UPDATE to refresh the session }
}
##### 7.27.2 Conformance Requirements {#conformance-requirements-32 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2A.1.1]
A UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too
Small) to an INVITE request where the response contains a Min-SE header field,
shall retry the request in accordance with RFC 4028 [58] subclause 7.4.
[TS 24.229 clause 5.2.7.2]
When the P-CSCF receives from the UE an INVITE request, the P-CSCF may require
the periodic refreshment of the session to avoid hung states in the P-CSCF. If
the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply
the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it.
[TS 24.229 clause 5.2.7.3]
When the P-CSCF receives an INVITE request destined for the UE the P-CSCF may
require the periodic refreshment of the session to avoid hung states in the
P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF
shall apply the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it in order to make it work.
[TS 24.229 clause 5.4.5.3]
If the S-CSCF requested the session to be refreshed periodically, and the
S-CSCF got the indication that the session will be refreshed, when the session
timer expires, the S-CSCF shall delete all the stored information related to
the dialog.
##### 7.27.3 Test description {#test-description-31 .H6}
##### 7.27.3.1 Pre-test conditions {#pre-test-conditions-31 .H6}
##### System Simulator: {#system-simulator-34 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-34 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use Session Timer and preconditions.
##### Preamble: {#preamble-34 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.27.3.2 Test procedure sequence {#test-procedure-sequence-31 .H6}
Table 7.27.3.2-1: Main Behaviour
+---------+------------+------------+------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+============+============+============+=========+====+ | | | U - S | Message | | | +---------+------------+------------+------------+---------+----+ | 1 | UE is made | - | - | | | | | to attempt | | | | | | | an IMS | | | | | | | voice | | | | | | | call. | | | | | +---------+------------+------------+------------+---------+----+ | 2-7 | Steps 2-7 | - | - | | | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | with Step | | | | | | | 8, | | | | | | | parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 7.27.3.2-2 | | | | | | | takes | | | | | | | place | | | | | +---------+------------+------------+------------+---------+----+ | 8 | UE sends | --> | INVITE | 1 | P | | | INVITE | | | | | | | with | | | | | | | either the | | | | | | | Sessi | | | | | | | on-Expires | | | | | | | value set | | | | | | | to 1800 or | | | | | | | no | | | | | | | Sessi | | | | | | | on-Expires | | | | | | | header. | | | | | +---------+------------+------------+------------+---------+----+ | - | EXCEPTION: | - | - | | | | | Steps 9a0 | | | | | | | to 9a7 | | | | | | | describe | | | | | | | behaviour | | | | | | | that | | | | | | | depends on | | | | | | | UE | | | | | | | c | | | | | | | apability: | | | | | | | the | | | | | | | \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies | | | | | | | a step | | | | | | | sequence | | | | | | | that takes | | | | | | | place if | | | | | | | the UE | | | | | | | included | | | | | | | Sessi | | | | | | | on-Expires | | | | | | | in step 8 | | | | | +---------+------------+------------+------------+---------+----+ | 9a0 | SS sends a | \ | ACK | 2 | P | | | ACK. | | | | | +---------+------------+------------+------------+---------+----+ | 9a3 | UE sends | --> | INVITE | 2 | P | | | INVITE | | | | | | | with | | | | | | | Min-SE | | | | | | | value and | | | | | | | Sessi | | | | | | | on-Expires | | | | | | | value | | | | | | | being | | | | | | | 1860. | | | | | +---------+------------+------------+------------+---------+----+ | 9a4 | SS sends a | \ | ACK | 3 | P | | | ACK. | | | | | +---------+------------+------------+------------+---------+----+ | 9a7 | UE sends | --> | INVITE | 3 | P | | | INVITE | | | | | | | with | | | | | | | Min-SE | | | | | | | value and | | | | | | | Sessi | | | | | | | on-Expires | | | | | | | value | | | | | | | being | | | | | | | 1920. | | | | | +---------+------------+------------+------------+---------+----+ | 10-13 | Steps 2-5 | - | - | | | | | of Annex | | | | | | | A.4.1a | | | | | | | happen. | | | | | +---------+------------+------------+------------+---------+----+ | 13A | Step 10 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] is | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to steps | | | | | | | 13B and | | | | | | | 13C below, | | | | | | | step 14 | | | | | | | occurs. | | | | | +---------+------------+------------+------------+---------+----+ | 13B-13C | Steps | - | - | - | - | | | 11-12 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 14-18 | Steps 6-10 | - | - | - | - | | | of Annex | | | | | | | A.4.1a | | | | | | | happen. | | | | | +---------+------------+------------+------------+---------+----+ | 19 | SS sends | \ | ACK | 4 | P | | | ACK. | | | | | +---------+------------+------------+------------+---------+----+ | 21 | 960 | --> | UPDATE | 5 | P | | | seconds | | | | | | | after step | | | | | | | 20, UE | | | | | | | sends an | | | | | | | UPDATE | | | | | | | request to | | | | | | | refresh | | | | | | | the | | | | | | | session. | | | | | +---------+------------+------------+------------+---------+----+ | 22 | SS sends | \ | UPDATE | 6 | P | | | seconds | | | | | | | after step | | | | | | | 22, UE | | | | | | | sends an | | | | | | | UPDATE | | | | | | | request to | | | | | | | refresh | | | | | | | the | | | | | | | session. | | | | | +---------+------------+------------+------------+---------+----+ | 24 | SS sends | \ NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.27.3.3 Specific message contents {#specific-message-contents-31 .H6}
Table 7.27.3.3-1: INVITE (step 8, table 7.27.3.2-1)
* * *
Derivation Path: Annex A.4.1a, Step 1, with A26 as additional condition.  
Header/param Cond Value/remark Rel Reference **Session-Expires** (if present)
RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_ (if present)
* * *
Table 7.27.3.3-2: 422 Session Interval Too Small (step 9a1, table 7.27.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.24  
Header/param Cond Value/remark Rel Reference **Min-SE** RFC 4028 [37] **delta-
seconds** _1860_
* * *
Table 7.27.3.3-3: INVITE (step 9a3, table 7.27.3.2-1)
* * *
Derivation Path: Annex A.4.1a, Step 1, with A26 as additional condition.  
Header/param Cond Value/remark Rel Reference **Session-Expires** RFC 4028 [37]
**delta-seconds** _1860_  
**Min-SE** RFC 4028 [37] **delta-seconds** _1860_
* * *
Table 7.27.3.3-4: 422 Session Interval Too Small (step 9a5, table 7.27.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.24  
Header/param Cond Value/remark Rel Reference **Min-SE** RFC 4028 [37] **delta-
seconds** _1920_
* * *
Table 7.27.3.3-5: INVITE (step 9a7, table 7.27.3.2-1)
* * *
Derivation Path: Annex A.4.1a, Step 1, with A26 as additional condition.  
Header/param Cond Value/remark Rel Reference **Session-Expires** RFC 4028 [37]
**delta-seconds** _1920_  
**Min-SE** RFC 4028 [37] **delta-seconds** _1920_
* * *
Table 7.27.3.3-6: 183 Session Progress (step 11, table 7.27.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.3, Conditions A1  
Header/param Cond Value/remark Rel Reference **Allow** _INVITE, UPDATE, PRACK,
ACK, OPTIONS, CANCEL, BYE_ RFC 4028 [37]
* * *
Table 7.27.3.3-7: 200 OK (step 19, table 7.27.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A1 and A10  
Header/param Cond Value/remark Rel Reference **Allow** _INVITE, UPDATE, PRACK,
ACK, OPTIONS, CANCEL, BYE_ RFC 4028 [37] **Require** _timer_ RFC 4028 [37]
**Supported** _timer_ RFC 4028 [37] **Session-Expires** RFC 4028 [37] **delta-
seconds** _192_ 0  
**refresher** _uac_  
**Min-SE** RFC 4028 [37] **delta-seconds** _1920_
* * *
Table 7.27.3.3-8: UPDATE (steps 21 and 23, table 7.27.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.5, Conditions A1 and A6  
Header/param Cond Value/remark Rel Reference **Supported** _timer_ RFC 4028
[37] **Session-Expires** RFC 4028 [37] **delta-seconds** _1920_  
**refresher** _uac_  
**Min-SE** RFC 4028 [37] **delta-seconds** _1920_  
**Content-Type** any value if present RFC 4028 [37]
* * *
Table 7.27.3.3-9: 200 OK (steps 22 and 24, table 7.27.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A1 and A10  
Header/param Cond Value/remark Rel Reference **Supported** _timer_ RFC 4028
[37] **Session-Expires** RFC 4028 [37] **delta-seconds** _1920_  
**refresher** _uac_  
**Min-SE** RFC 4028 [37] **delta-seconds** _192_ 0
* * *
## 7.28 Session Timer / MO Voice Call / Remote end is refresher / 5GS
##### 7.28.1 Test Purpose (TP) {#test-purpose-tp-32 .H6}
##### (1) {#section-102 .H6}
**with** { UE being registered to IMS and being configured to use Session
Timer and preconditions }
**ensure** **that** {
**when** { UE is being made to initiate a voice call }
**then** { UE sends INVITE for voice call without refresher parameter }
}
##### (2) {#section-103 .H6}
**with** { UE having sent INVITE }
**ensure** **that** {
**when** { UE continues setup of voice call and finally receives 200 OK for
INVITE setting refresher to uas }
**then** { UE sends ACK }
}
##### (3) {#section-104 .H6}
**with** { UE having completed call setup }
**ensure** **that** {
**when** { UE receives refresh request via an UPDATE request }
**then** { UE sends 200 OK for UPDATE }
}
##### (4) {#section-105 .H6}
**with** { UE having sent 200 OK for a refresh request }
**ensure** **that** {
**when** { Session expires }
**then** { UE releases the call }
}
##### 7.28.2 Conformance Requirements {#conformance-requirements-33 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2A.1.1]
A UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too
Small) to an INVITE request where the response contains a Min-SE header field,
shall retry the request in accordance with RFC 4028 [58] subclause 7.4.
[TS 24.229 clause 5.2.7.2]
When the P-CSCF receives from the UE an INVITE request, the P-CSCF may require
the periodic refreshment of the session to avoid hung states in the P-CSCF. If
the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply
the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it.
[TS 24.229 clause 5.2.7.3]
When the P-CSCF receives an INVITE request destined for the UE the P-CSCF may
require the periodic refreshment of the session to avoid hung states in the
P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF
shall apply the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it in order to make it work.
[TS 24.229 clause 5.4.5.3]
If the S-CSCF requested the session to be refreshed periodically, and the
S-CSCF got the indication that the session will be refreshed, when the session
timer expires, the S-CSCF shall delete all the stored information related to
the dialog.
##### 7.28.3 Test description {#test-description-32 .H6}
##### 7.28.3.1 Pre-test conditions {#pre-test-conditions-32 .H6}
##### System Simulator: {#system-simulator-35 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-35 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use Session Timer and preconditions.
##### Preamble: {#preamble-35 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.28.3.2 Test procedure sequence {#test-procedure-sequence-32 .H6}
Table 7.28.3.2-1: Main Behaviour
+---------+--------------+--------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+==============+==============+=========+=========+====+ | | | U - S | Message | | | +---------+--------------+--------------+---------+---------+----+ | 1 | UE is made | - | - | | | | | to attempt | | | | | | | an IMS voice | | | | | | | call. | | | | | +---------+--------------+--------------+---------+---------+----+ | 2-7 | Steps 2-7 of | - | - | | | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | with Step 8, | | | | | | | parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 7.28.3.2-2 | | | | | | | takes place | | | | | +---------+--------------+--------------+---------+---------+----+ | 8 | UE sends | --> | INVITE | 1 | P | | | INVITE with | | | | | | | either the | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | value set to | | | | | | | 1800 or no | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | header. | | | | | +---------+--------------+--------------+---------+---------+----+ | 9-12 | Steps 2-5 of | - | - | | | | | Annex A.4.1a | | | | | | | happen. | | | | | +---------+--------------+--------------+---------+---------+----+ | 12A | Step 10 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] is | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to steps 12B | | | | | | | and 12C | | | | | | | below, step | | | | | | | 13 occurs. | | | | | +---------+--------------+--------------+---------+---------+----+ | 12B-12C | Steps 11-12 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | 13-17 | Steps 6-10 | - | - | - | - | | | of Annex | | | | | | | A.4.1a | | | | | | | happen. | | | | | +---------+--------------+--------------+---------+---------+----+ | 18 | SS sends 200 | \ | ACK | 2 | P | | | ACK. | | | | | +---------+--------------+--------------+---------+---------+----+ | 20 | 900 seconds | \ | 200 OK | 3 | P | | | OK for | | | | | | | UPDATE. | | | | | +---------+--------------+--------------+---------+---------+----+ | | UE sends BYE | --> | BYE | 4 | P | | | to release | | | | | | | the call due | | | | | | | to session | | | | | | | expiry 1800 | | | | | | | seconds | | | | | | | after step | | | | | | | 21. | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.7) | | | | | +---------+--------------+--------------+---------+---------+----+ | 23 | SS sends 200 | \ NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.28.3.3 Specific message contents {#specific-message-contents-32 .H6}
Table 7.28.3.3-1: INVITE (step 8, table 7.28.3.2-1)
* * *
Derivation Path: Annex A.4.1a, step 1, with A26 as additional condition.  
Header/param Cond Value/remark Rel Reference **Session-Expires** (if present)
RFC 4028 [37] **delta-seconds** _1800_  
**refresher** not present
* * *
Table 7.28.3.3-2: 200 OK (step 18, table 7.28.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A1 and A10  
Header/param Cond Value/remark Rel Reference **Require** _timer_ RFC 4028 [37]
**Supported** _timer_ RFC 4028 [37] **Session-Expires** RFC 4028 [37] **delta-
seconds** _1800_  
**refresher** _uas_
* * *
Table 7.28.3.3-3: UPDATE (step 20, table 7.28.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.5, Condition A3  
Header/param Cond Value/remark Rel Reference **Supported** _timer_ RFC 4028
[37] **Session-Expires** RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_  
**Content-Type** not present RFC 4028 [37]
* * *
Table 7.28.3.3-4: 200 OK (step 21, table 7.28.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A1 and A10  
Header/param Cond Value/remark Rel Reference **Require** _timer_ RFC 4028 [37]
**Session-Expires** RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_
* * *
## 7.29 Session Timer / MO Voice Call / Remote end does not support Session
Timer / 5GS
##### 7.29.1 Test Purpose (TP) {#test-purpose-tp-33 .H6}
##### (1) {#section-106 .H6}
**with** { UE being registered to IMS and being configured to use Session
Timer and preconditions }
**ensure** **that** {
**when** { UE is being made to initiate the voice call }
**then** { UE sends INVITE for voice call }
}
##### (2) {#section-107 .H6}
**with** { UE having sent INVITE and continuing with the call setup }
**ensure** **that** {
**when** { UE receives 200 OK for INVITE without timer tag and Session-Expires
}
**then** { UE sends ACK }
}
##### (3) {#section-108 .H6}
**with** { UE having sent ACK }
**ensure** **that** {
**when** { 900 seconds have passed }
**then** { UE sends UPDATE to refresh the session }
}
##### (4) {#section-109 .H6}
**with** { UE having sent received 200 OK for UPDATE }
**ensure** **that** {
**when** { Another 900 seconds have passed }
**then** { UE sends UPDATE to refresh the session }
}
##### 7.29.2 Conformance Requirements {#conformance-requirements-34 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2A.1.1]
A UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too
Small) to an INVITE request where the response contains a Min-SE header field,
shall retry the request in accordance with RFC 4028 [58] subclause 7.4.
[TS 24.229 clause 5.2.7.2]
When the P-CSCF receives from the UE an INVITE request, the P-CSCF may require
the periodic refreshment of the session to avoid hung states in the P-CSCF. If
the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply
the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it.
[TS 24.229 clause 5.2.7.3]
When the P-CSCF receives an INVITE request destined for the UE the P-CSCF may
require the periodic refreshment of the session to avoid hung states in the
P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF
shall apply the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it in order to make it work.
[TS 24.229 clause 5.4.5.3]
If the S-CSCF requested the session to be refreshed periodically, and the
S-CSCF got the indication that the session will be refreshed, when the session
timer expires, the S-CSCF shall delete all the stored information related to
the dialog.
##### 7.29.3 Test description {#test-description-33 .H6}
##### 7.29.3.1 Pre-test conditions {#pre-test-conditions-33 .H6}
##### System Simulator: {#system-simulator-36 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-36 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use Session Timer and preconditions.
##### Preamble: {#preamble-36 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.29.3.2 Test procedure sequence {#test-procedure-sequence-33 .H6}
Table 7.29.3.2-1: Main Behaviour
+---------+--------------+--------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+==============+==============+=========+=========+====+ | | | U - S | Message | | | +---------+--------------+--------------+---------+---------+----+ | 1 | UE is made | - | - | | | | | to attempt | | | | | | | an IMS voice | | | | | | | call. | | | | | +---------+--------------+--------------+---------+---------+----+ | 2-7 | Steps 2-7 of | - | - | | | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | with Step 8, | | | | | | | parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 7.27.3.2-2 | | | | | | | takes place | | | | | +---------+--------------+--------------+---------+---------+----+ | 8 | UE sends | --> | INVITE | 1 | P | | | INVITE | | | | | | | indicating | | | | | | | support for | | | | | | | Session | | | | | | | Timer, with | | | | | | | either the | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | value set to | | | | | | | 1800 or no | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | header. | | | | | +---------+--------------+--------------+---------+---------+----+ | 9-12 | Steps 2-5 of | - | - | | | | | Annex A.4.1a | | | | | | | happen. | | | | | +---------+--------------+--------------+---------+---------+----+ | 12A | Step 10 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] is | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to steps 12B | | | | | | | and 12C | | | | | | | below, step | | | | | | | 13 occurs. | | | | | +---------+--------------+--------------+---------+---------+----+ | 12B-12C | Steps 11-12 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | 13-17 | Steps 6-10 | - | - | - | - | | | of Annex | | | | | | | A.4.1a | | | | | | | happen. | | | | | +---------+--------------+--------------+---------+---------+----+ | 18 | SS sends 200 | \ | ACK | 2 | P | | | ACK. | | | | | +---------+--------------+--------------+---------+---------+----+ | 20 | 900 seconds | --> | UPDATE | 3 | P | | | after step | | | | | | | 19, UE sends | | | | | | | an UPDATE | | | | | | | request to | | | | | | | refresh the | | | | | | | session. | | | | | +---------+--------------+--------------+---------+---------+----+ | 21 | SS sends 200 | \ | UPDATE | 4 | P | | | after step | | | | | | | 21, UE sends | | | | | | | an UPDATE | | | | | | | request to | | | | | | | refresh the | | | | | | | session. | | | | | +---------+--------------+--------------+---------+---------+----+ | 23 | SS sends 200 | \ NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.29.3.3 Specific message contents {#specific-message-contents-33 .H6}
Table 7.29.3.3-1: INVITE (step 8, table 7.29.3.2-1)
* * *
Derivation Path: Annex A.4.1a with A26 as additional condition  
Header/param Cond Value/remark Rel Reference **Session-Expires** (if present)
RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_ (if present)
* * *
Table 7.29.3.3-2: 183 Session Progress (step 10, table 7.29.3.2-1)
* * *
Derivation Path: Annex A.4.1a, step 3  
Header/param Cond Value/remark Rel Reference **Allow** _INVITE, UPDATE, PRACK,
ACK, OPTIONS, CANCEL, BYE_ RFC 4028 [37]
* * *
Table 7.29.3.3-3: 200 OK (step 18, table 7.29.3.2-1)
* * *
Derivation Path: Annex A.4.1a, step 11  
Header/param Cond Value/remark Rel Reference **Allow** _INVITE, UPDATE, PRACK,
ACK, OPTIONS, CANCEL, BYE_ RFC 4028 [37]
* * *
Table 7.29.3.3-4: UPDATE (steps 20 and 22, table 7.29.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in Annex A.2.5, Conditions A1 and A6  
Header/param Cond Value/remark Rel Reference **Supported** _timer_ RFC 4028
[37] **Session-Expires** RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_  
**Content-Type** any value if present RFC 4028 [37]
* * *
## 7.30 Session Timer / MO Voice Call / Remote end supports but does not use
Session Timer / 5GS
##### 7.30.1 Test Purpose (TP) {#test-purpose-tp-34 .H6}
##### (1) {#section-110 .H6}
**with** { UE being registered to IMS and being configured to use Session
Timer and preconditions }
**ensure** **that** {
**when** { UE is being made to initiate a voice call }
**then** { UE sends INVITE for voice call }
}
##### (2) {#section-111 .H6}
**with** { UE having sent INVITE for voice call and continuing the call setup
}
**ensure** **that** {
**when** { UE receives 200 OK for INVITE with timer tag and without Session-
Expires }
**then** { UE sends ACK }
}
##### (3) {#section-112 .H6}
**with** { UE having sent ACK }
**ensure** **that** {
**when** { 1860 seconds passed without the UE refreshing the session }
**then** { UE receives BYE and sends 200 OK for BYE }
}
##### 7.30.2 Conformance Requirements {#conformance-requirements-35 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2A.1.1]
A UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too
Small) to an INVITE request where the response contains a Min-SE header field,
shall retry the request in accordance with RFC 4028 [58] subclause 7.4.
[TS 24.229 clause 5.2.7.2]
When the P-CSCF receives from the UE an INVITE request, the P-CSCF may require
the periodic refreshment of the session to avoid hung states in the P-CSCF. If
the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply
the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it.
[TS 24.229 clause 5.2.7.3]
When the P-CSCF receives an INVITE request destined for the UE the P-CSCF may
require the periodic refreshment of the session to avoid hung states in the
P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF
shall apply the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it in order to make it work.
[TS 24.229 clause 5.4.5.3]
If the S-CSCF requested the session to be refreshed periodically, and the
S-CSCF got the indication that the session will be refreshed, when the session
timer expires, the S-CSCF shall delete all the stored information related to
the dialog.
##### 7.30.3 Test description {#test-description-34 .H6}
##### 7.30.3.1 Pre-test conditions {#pre-test-conditions-34 .H6}
##### System Simulator: {#system-simulator-37 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-37 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use Session Timer and preconditions.
##### Preamble: {#preamble-37 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.30.3.2 Test procedure sequence {#test-procedure-sequence-34 .H6}
Table 7.30.3.2-1: Main Behaviour
+---------+--------------+--------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+==============+==============+=========+=========+====+ | | | U - S | Message | | | +---------+--------------+--------------+---------+---------+----+ | 1 | UE is made | - | - | | | | | to attempt | | | | | | | an IMS voice | | | | | | | call. | | | | | +---------+--------------+--------------+---------+---------+----+ | 2-7 | Steps 2-7 of | - | - | | | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | with Step 8, | | | | | | | parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 7.30.3.2-2 | | | | | | | takes place | | | | | +---------+--------------+--------------+---------+---------+----+ | 8 | UE sends | --> | INVITE | 1 | P | | | INVITE | | | | | | | indicating | | | | | | | support for | | | | | | | Session | | | | | | | Timer, with | | | | | | | either the | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | value set to | | | | | | | 1800 or no | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | header. | | | | | +---------+--------------+--------------+---------+---------+----+ | 9-12 | Steps 2-5 of | - | - | | | | | Annex A.4.1a | | | | | | | happen. | | | | | +---------+--------------+--------------+---------+---------+----+ | 12A | Step 10 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] is | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to steps 12B | | | | | | | and 12C | | | | | | | below, step | | | | | | | 13 occurs. | | | | | +---------+--------------+--------------+---------+---------+----+ | 12B-12C | Steps 11-12 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | 13-17 | Steps 6-10 | - | - | | | | | of Annex | | | | | | | A.4.1a | | | | | | | happen. | | | | | +---------+--------------+--------------+---------+---------+----+ | 18 | SS sends 200 | \ | ACK | 2 | P | | | ACK. | | | | | +---------+--------------+--------------+---------+---------+----+ | 20 | SS sends BYE | \ | 200 OK | 3 | P | | | OK for BYE. | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.8) | | | | | +---------+--------------+--------------+---------+---------+----+
Table 7.30.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 7.30.3.3 Specific message contents {#specific-message-contents-34 .H6}
Table 7.30.3.3-1: INVITE (step 8, table 7.30.3.2-1)
* * *
Derivation Path: Annex A.4.1a, Step 1, with A26 as additional condition.  
Header/param Cond Value/remark Rel Reference **Session-Expires** (if present)
RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_ (if present)
* * *
Table 7.30.3.3-2: 200 OK (step 18, table 7.30.3.2-1)
* * *
Derivation Path: Annex A.4.1a, Step 11  
Header/param Cond Value/remark Rel Reference **Supported** timer RFC 4028 [37]
* * *
## 7.31 Session Timer / MT Voice Call / Remote end supports but does not send
Session-Expires / 5GS
##### 7.31.1 Test Purpose (TP) {#test-purpose-tp-35 .H6}
##### (1) {#section-113 .H6}
**with** { UE being registered to IMS and being configured to use Session
Timer and preconditions }
**ensure** **that** {
**when** { UE receives INVITE for voice call }
**then** { UE continues setup of voice call and finally sends 200 OK for
INVITE with Session-Expires being 1800 and setting refresher to uac }
}
##### (2) {#section-114 .H6}
**with** { Call having been set up }
**ensure** **that** {
**when** { 900 seconds have passed and UE receives UPDATE to refresh the
session }
**then** { UE sends 200 OK for UPDATE }
}
##### (3) {#section-115 .H6}
**with** { UE having sent 200 OK for UPDATE }
**ensure** **that** {
**when** { 1800 seconds passed }
**then** { UE sends BYE }
}
##### 7.31.2 Conformance Requirements {#conformance-requirements-36 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2A.1.1]
A UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too
Small) to an INVITE request where the response contains a Min-SE header field,
shall retry the request in accordance with RFC 4028 [58] subclause 7.4.
[TS 24.229 clause 5.2.7.2]
When the P-CSCF receives from the UE an INVITE request, the P-CSCF may require
the periodic refreshment of the session to avoid hung states in the P-CSCF. If
the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply
the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it.
[TS 24.229 clause 5.2.7.3]
When the P-CSCF receives an INVITE request destined for the UE the P-CSCF may
require the periodic refreshment of the session to avoid hung states in the
P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF
shall apply the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it in order to make it work.
[TS 24.229 clause 5.4.5.3]
If the S-CSCF requested the session to be refreshed periodically, and the
S-CSCF got the indication that the session will be refreshed, when the session
timer expires, the S-CSCF shall delete all the stored information related to
the dialog.
##### 7.31.3 Test description {#test-description-35 .H6}
##### 7.31.3.1 Pre-test conditions {#pre-test-conditions-35 .H6}
##### System Simulator: {#system-simulator-38 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-38 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use Session Timer and preconditions.
##### Preamble: {#preamble-38 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.31.3.2 Test procedure sequence {#test-procedure-sequence-35 .H6}
Table 7.31.3.2-1: Main Behaviour
+---------+--------------+--------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+==============+==============+=========+=========+====+ | | | U - S | Message | | | +---------+--------------+--------------+---------+---------+----+ | 1-8 | Steps 1-8 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | 9 | SS sends | \ | 200 OK | 1 | P | | | OK for | | | | | | | INVITE with | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | value set to | | | | | | | 1800 and | | | | | | | refresher | | | | | | | value set to | | | | | | | uac. | | | | | +---------+--------------+--------------+---------+---------+----+ | 20 | Step 12 of | \ | 200 OK | 2 | P | | | OK for | | | | | | | UPDATE. | | | | | +---------+--------------+--------------+---------+---------+----+ | 23 | UE sends BYE | --> | BYE | 3 | P | | | to release | | | | | | | the call due | | | | | | | to session | | | | | | | expiry 1800 | | | | | | | seconds | | | | | | | after step | | | | | | | 22. | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.7) | | | | | +---------+--------------+--------------+---------+---------+----+ | 24 | SS sends 200 | \ | 200 OK | 1 | P | | | OK for | | | | | | | INVITE with | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | value set to | | | | | | | 1800 and | | | | | | | refresher | | | | | | | value set to | | | | | | | uac. | | | | | +---------+--------------+--------------+---------+---------+----+ | 20 | SS sends | \ | 200 OK | 2 | P | | | OK for | | | | | | | UPDATE. | | | | | +---------+--------------+--------------+---------+---------+----+ | 23-24 | SS releases | - | - | - | - | | | the call. | | | | | | | | | | | | | | (Steps 1-2 | | | | | | | of Annex | | | | | | | A.8) | | | | | +---------+--------------+--------------+---------+---------+----+
##### 7.32.3.3 Specific message contents {#specific-message-contents-36 .H6}
Table 7.32.3.3-1: INVITE (step 9, table 7.32.3.2-1)
* * *
Derivation Path: Annex A.5.1a, step 1  
Header/param Cond Value/remark Rel Reference **Session-Expires** RFC 4028 [37]
**delta-seconds** _1800_
* * *
Table 7.32.3.3-2: 200 OK (step 19, table 7.32.3.2-1)
* * *
Derivation Path: Annex A.5.1a, step 11  
Header/param Cond Value/remark Rel Reference **Require** _timer_ RFC 4028 [37]
**Session-Expires** RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_
* * *
Table 7.32.3.3-3: UPDATE (step 21, table 7.32.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.5, Condition A3  
Header/param Cond Value/remark Rel Reference **Supported** _Timer_ RFC 4028
[37] **Session-Expires** RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _Uac_  
**Content-Type** not present RFC 4028 [37]
* * *
Table 7.32.3.3-4: 200 OK (step 22, table 7.32.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A2 and A11  
Header/param Cond Value/remark Rel Reference **Require** _timer_ RFC 4028 [37]
**Session-Expires** RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_
* * *
## 7.33 Session Timer / MT Voice Call / Remote end chooses UE as refresher /
5GS
##### 7.33.1 Test Purpose (TP) {#test-purpose-tp-37 .H6}
##### (1) {#section-118 .H6}
**with** { UE being registered to IMS and being configured to use Session
Timer and being configured to not use preconditions }
**ensure** **that** {
**when** { UE receives INVITE for voice call with Session-Expires value 1800
and refresher set uas and remote UE not supporting UPDATE }
**then** { UE continues setup of voice call and finally sends 200 OK for
INVITE with Session-Expires being 1800 and setting refresher to uas }
}
##### (2) {#section-119 .H6}
**with** { Voice call having been set up }
**ensure** **that** {
**when** { 900 seconds have passed }
**then** { UE sends re-INVITE to refresh the session }
}
##### (3) {#section-120 .H6}
**with** { UE having refreshed the session }
**ensure** **that** {
**when** { Another 900 seconds have passed }
**then** { UE sends another re-INVITE to refresh the session }
}
##### 7.33.2 Conformance Requirements {#conformance-requirements-38 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2A.1.1]
A UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too
Small) to an INVITE request where the response contains a Min-SE header field,
shall retry the request in accordance with RFC 4028 [58] subclause 7.4.
[TS 24.229 clause 5.2.7.2]
When the P-CSCF receives from the UE an INVITE request, the P-CSCF may require
the periodic refreshment of the session to avoid hung states in the P-CSCF. If
the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply
the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it.
[TS 24.229 clause 5.2.7.3]
When the P-CSCF receives an INVITE request destined for the UE the P-CSCF may
require the periodic refreshment of the session to avoid hung states in the
P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF
shall apply the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it in order to make it work.
[TS 24.229 clause 5.4.5.3]
If the S-CSCF requested the session to be refreshed periodically, and the
S-CSCF got the indication that the session will be refreshed, when the session
timer expires, the S-CSCF shall delete all the stored information related to
the dialog.
##### 7.33.3 Test description {#test-description-37 .H6}
##### 7.33.3.1 Pre-test conditions {#pre-test-conditions-37 .H6}
##### System Simulator: {#system-simulator-40 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-40 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use Session Timer
\- UE is configured to not use preconditions.
##### Preamble: {#preamble-40 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.33.3.2 Test procedure sequence {#test-procedure-sequence-37 .H6}
Table 7.33.3.2-1: Main Behaviour
+---------+--------------+--------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+==============+==============+=========+=========+====+ | | | U - S | Message | | | +---------+--------------+--------------+---------+---------+----+ | 1-8 | Steps 1-8 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | 9 | SS sends | \ | 200 OK | 1 | P | | | OK for | | | | | | | INVITE with | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | value set to | | | | | | | 1800 and | | | | | | | refresher | | | | | | | value set to | | | | | | | uas. | | | | | +---------+--------------+--------------+---------+---------+----+ | 20 | SS sends | \ | INVITE | 2 | P | | | after step | | | | | | | 20, UE sends | | | | | | | an INVITE | | | | | | | request to | | | | | | | refresh the | | | | | | | session. | | | | | +---------+--------------+--------------+---------+---------+----+ | 22 | SS sends 200 | \ | ACK | - | - | | | ACK. | | | | | +---------+--------------+--------------+---------+---------+----+ | 24 | 900 seconds | --> | INVITE | 3 | P | | | after step | | | | | | | 23, UE sends | | | | | | | an INVITE | | | | | | | request to | | | | | | | refresh the | | | | | | | session. | | | | | +---------+--------------+--------------+---------+---------+----+ | 25 | SS sends 200 | \ | ACK | - | - | | | ACK. | | | | | +---------+--------------+--------------+---------+---------+----+ | 27-28 | SS releases | - | - | - | - | | | the call. | | | | | | | | | | | | | | (Steps 1-2 | | | | | | | of Annex | | | | | | | A.8) | | | | | +---------+--------------+--------------+---------+---------+----+
##### 7.33.3.3 Specific message contents {#specific-message-contents-37 .H6}
Table 7.33.3.3-1: INVITE (step 9, table 7.33.3.2-1)
* * *
Derivation Path: Step 1 of Annex A.5.2  
Header/param Cond Value/remark Rel Reference **Allow** _INVITE, ACK, OPTIONS,
CANCEL, BYE_ RFC 3261 [6] **Session-Expires** RFC 4028 [37] **delta-seconds**
_1800_  
**refresher** _uas_
* * *
Table 7.33.3.3-2: 200 OK (step 19, table 7.33.3.2-1)
* * *
Derivation Path: Annex A.5.2, Step 9  
Header/param Cond Value/remark Rel Reference **Session-Expires** RFC 4028 [37]
**delta-seconds** _1800_  
**refresher** _uas_
* * *
Table 7.33.3.3-3: INVITE (steps 21 and 24, table 7.33.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.1, Conditions A32, A26 and A28  
Header/param Cond Value/remark Rel Reference **Session-Expires** RFC 4028 [37]
**delta-seconds** _1800_  
**refresher** _uac_  
**Content-Type** RFC 3261 [6] **media-type** _application/sdp_  
**Content-Length** RFC 3261 [6] **value** length of message-body  
**Message-body** Same SDP message as the last SDP message sent by the UE in
the 183 Session Progress at step 11; the session version in the origin shall
not be incremented. RFC 4566 [38]
* * *
Table 7.33.3.3-4: 200 OK (steps 22 and 25, table 7.33.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A2, A11, A20 and A22  
Header/param Cond Value/remark Rel Reference **Require** _timer_ RFC 4028 [37]
**Session-Expires** RFC 4028 [37] **delta-seconds** _1800_  
**refresher** _uac_  
**Content-Type** RFC 3261 [6] **media-type** _application/sdp_  
**Content-Length** RFC 3261 [6] **Value** _length of message-body_  
**Message-body** _Same SDP message as the last SDP message sent by the SS in
the INVITE at step 9; the session version in the origin shall not be
incremented_
* * *
## 7.34 Session Timer / MT Voice Call / Remote end does not support Session
Timer / 5GS
##### 7.34.1 Test Purpose (TP) {#test-purpose-tp-38 .H6}
##### (1) {#section-121 .H6}
**with** { UE being registered to IMS and being configured to use Session
Timer and preconditions }
**ensure** **that** {
**when** { UE receives INVITE for voice call without support for Session Timer
}
**then** { UE continues setup of voice call and finally sends 200 OK for
INVITE with Session-Expires being 1800 and setting refresher to uas }
}
##### (2) {#section-122 .H6}
**with** { Call having been set up }
**ensure** **that** {
**when** { 900 seconds have passed }
**then** { UE sends UPDATE to refresh the session }
}
##### 7.34.2 Conformance Requirements {#conformance-requirements-39 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.2A.1.1]
A UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too
Small) to an INVITE request where the response contains a Min-SE header field,
shall retry the request in accordance with RFC 4028 [58] subclause 7.4.
[TS 24.229 clause 5.2.7.2]
When the P-CSCF receives from the UE an INVITE request, the P-CSCF may require
the periodic refreshment of the session to avoid hung states in the P-CSCF. If
the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply
the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it.
[TS 24.229 clause 5.2.7.3]
When the P-CSCF receives an INVITE request destined for the UE the P-CSCF may
require the periodic refreshment of the session to avoid hung states in the
P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF
shall apply the procedures described in RFC 4028 [58] clause 8.
NOTE 1: Requesting the session to be refreshed requires support by at least
one of the UEs. This functionality cannot automatically be granted, i.e. at
least one of the involved UEs needs to support it in order to make it work.
[TS 24.229 clause 5.4.5.3]
If the S-CSCF requested the session to be refreshed periodically, and the
S-CSCF got the indication that the session will be refreshed, when the session
timer expires, the S-CSCF shall delete all the stored information related to
the dialog.
##### 7.34.3 Test description {#test-description-38 .H6}
##### 7.34.3.1 Pre-test conditions {#pre-test-conditions-38 .H6}
##### System Simulator: {#system-simulator-41 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-41 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use Session Timer and preconditions.
##### Preamble: {#preamble-41 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 7.34.3.2 Test procedure sequence {#test-procedure-sequence-38 .H6}
Table 7.34.3.2-1: Main Behaviour
+---------+--------------+--------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+==============+==============+=========+=========+====+ | | | U - S | Message | | | +---------+--------------+--------------+---------+---------+----+ | 1-8 | Steps 1-8 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | 9 | SS sends | \ | 200 OK | 1 | P | | | OK for | | | | | | | INVITE with | | | | | | | Ses | | | | | | | sion-Expires | | | | | | | value set to | | | | | | | 1800 and | | | | | | | refresher | | | | | | | value set to | | | | | | | uas. | | | | | +---------+--------------+--------------+---------+---------+----+ | 20 | SS sends | \ | UPDATE | 2 | P | | | after step | | | | | | | 20, UE sends | | | | | | | an UPDATE | | | | | | | request to | | | | | | | refresh the | | | | | | | session. | | | | | +---------+--------------+--------------+---------+---------+----+ | 22 | SS sends 200 | \ service element.
[TS 24.109 clause 4.2]:
The UE shall initiate the bootstrapping procedure when:
a) the UE wants to interact with a NAF and bootstrapping is required;
b) a NAF has requested bootstrapping required indication as described in
subclause 5.2.4 or bootstrapping renegotiation indication as described in
subclause 5.2.5; or
c) the lifetime of the key has expired in the UE if one or more applications
are using that key.
A UE and the BSF shall establish bootstrapped security association between
them by running bootstrapping procedure. Bootstrapping security association
consists of a bootstrapping transaction identifier (B-TID) and key material
Ks. Bootstrapping session on the BSF also includes security related
information about subscriber (e.g. user\'s private identity). Bootstrapping
session is valid for a certain time period, and shall be deleted in the BSF
when the session becomes invalid.
Bootstrapping procedure shall be based on HTTP Digest AKA as described in 3GPP
TS 33.220 [1] and in RFC 3310 [6] with the modifications described below.
The BSF address is derived from the IMPI or IMSI according to 3GPP TS 23.003
[7].
A UE shall indicate to the BSF that it supports the use of TMPI as defined in
3GPP 33.220 [1] by including a \"product\" token in the \"User-Agent\" header
field (cf. RFC 2616 [14]) that is set to a static string \"3gpp-gba-tmpi\" in
HTTP requests sent to the BSF.
A BSF shall indicate to the UE that it supports the use of TMPI as defined in
3GPP 33.220 [1] by including a \"product\" token in the \"Server\" header
field (cf. RFC 2616 [14]) that is set to a static string \"3gpp-gba-tmpi\" in
HTTP responses sent to the UE.
In the bootstrapping procedure, Authorization, WWW-Authenticate, and
Authentication-Info HTTP headers shall be used as described in RFC 3310 [6]
with following exceptions:
a) the \"realm\" parameter shall contain the network name where the username
is authenticated;
b) the quality of protection (\"qop\") parameter shall be \"auth-int\"; and
c) the \"username\" parameter shall contain user\'s private identity (IMPI).
NOTE: If the UE does not have an ISIM application with an IMPI, the IMPI will
be constructed from IMSI, according to 3GPP TS 23.003 [7].
In addition to RFC 3310 [6], the following apply:
a) In the initial request from the UE to the BSF, the UE shall include
Authorization header with following parameters:
\- the username directive, set to
1) the value of the TMPI if one has been associated with the private user
identity as described in 3GPP 33.220 [1]; or
2) the value of the private user identity;
\- the realm directive, set to the BSF address derived from the IMPI or IMSI
according to 3GPP TS 23.003 [7];
\- the uri directive, set to either absoluteURL \"http://\/\" or
abs_path \"/\", and which one is used is specified in RFC 2617 [9];
\- the nonce directive, set to an empty value; and
\- the response directive, set to an empty value;
b) In the challenge response from the BSF to the UE, the BSF shall include
parameters to WWW-Authenticate header as specified in RFC 3310 [6] with
following clarifications:
\- the realm directive, set to the BSF address derived from the IMPI or IMSI
according to 3GPP TS 23.003 [7];
c) In the message from the BSF to the UE, the BSF shall include bootstrapping
transaction identifier (B-TID) and the key lifetime to an XML document in the
HTTP response payload. The BSF may also include additional server specific
data to the XML document. The XML schema definition of this XML document is
given in Annex C.
d) When responding to a challenge from the BSF, the UE shall include an
Authorization header containing a realm directive set to the value as received
in the realm directive in the WWW-Authenticate header.
e) Authentication-Info header shall be included into the subsequent HTTP
response after the BSF concluded that the UE has been authenticated.
Authentication-Info header shall include the \"rspauth\" parameter.
After successful bootstrapping procedure the UE and the BSF shall contain the
key material (Ks) and the B-TID. The key material shall be derived from AKA
parameters as specified in 3GPP TS 33.220 [1]. In addition, BSF shall also
contain a set of security specific attributes related to the UE.
An example flow of successful bootstrapping procedure can be found in clause
A.3.
##### 8.1.3 Test description {#test-description-39 .H6}
##### 8.1.3.1 Pre-test conditions {#pre-test-conditions-39 .H6}
##### System Simulator: {#system-simulator-42 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-42 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-42 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.1.3.2 Test procedure sequence {#test-procedure-sequence-39 .H6}
Table 8.1.3.2-1: Main Behaviour
+--------+------------+------------+------------+------------+----+ | **St** | **P |** Message | **TP** | * | | | | rocedure**| Sequence** | | _Verdict_ _| | +--------+------------+------------+------------+------------+----+ | | |__U - S_ _| * | | | | | | |_ Message** | | | +--------+------------+------------+------------+------------+----+ | 1 | The UE is | - | - | - | - | | | triggered | | | | | | | for | | | | | | | activation | | | | | | | of | | | | | | | sup | | | | | | | plementary | | | | | | | service | | | | | | | OIP | | | | | +--------+------------+------------+------------+------------+----+ | 2-5b | Check: | - | - | 1 | - | | | Does the | | | | | | | UE perform | | | | | | | steps 2-5b | | | | | | | of the | | | | | | | generic | | | | | | | test | | | | | | | procedure | | | | | | | for | | | | | | | activation | | | | | | | of | | | | | | | Sup | | | | | | | plementary | | | | | | | Services | | | | | | | according | | | | | | | to annex | | | | | | | A.21 | | | | | +--------+------------+------------+------------+------------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | Simservs | | | | | | | document | | | | | | | stored in | | | | | | | the SS | | | | | | | contain | | | | | | | the | | | | | | | i | | | | | | | nformation | | | | | | | supplied | | | | | | | by UE as | | | | | | | according | | | | | | | to table | | | | | | | 8.1.3.3-2? | | | | | | | | | | | | | | -\ | | | | | | | element | | | | | | | with | | | | | | | \"active\" | | | | | | | attribute | | | | | | | being set | | | | | | | \"true\" | | | | | +--------+------------+------------+------------+------------+----+ | 7 | Make the | - | - | - | - | | | UE attempt | | | | | | | de | | | | | | | activation | | | | | | | of OIP | | | | | +--------+------------+------------+------------+------------+----+ | 8-8b | Check: | - | - | 3 | - | | | Does the | | | | | | | UE perform | | | | | | | steps 8-8b | | | | | | | of the | | | | | | | generic | | | | | | | test | | | | | | | procedure | | | | | | | for | | | | | | | activation | | | | | | | of | | | | | | | Sup | | | | | | | plementary | | | | | | | Services | | | | | | | according | | | | | | | to annex | | | | | | | A.21? | | | | | +--------+------------+------------+------------+------------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | Simservs | | | | | | | document | | | | | | | stored in | | | | | | | the SS | | | | | | | contain | | | | | | | the | | | | | | | i | | | | | | | nformation | | | | | | | supplied | | | | | | | by UE as | | | | | | | according | | | | | | | to table | | | | | | | 8.1.3.3-3? | | | | | +--------+------------+------------+------------+------------+----+
##### 8.1.3.3 Specific message contents {#specific-message-contents-39 .H6}
Table 8.1.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.607 clause 4.10.2  
**Content** **Comment** \  
\  
\
* * *
Table 8.1.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.607 clause 4.10.2  
**Content** **Comment** \  
\ The "active"
attribute may not be present but if present is is set to "true". \
* * *
Table 8.1.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.607 clause 4.10.2  
**Content** **Comment** \  
\  
\
* * *
## **8.2 Originating Identification Restriction / Configuration / 5GS**
##### 8.2.1 Test Purpose (TP) {#test-purpose-tp-40 .H6}
##### (1) {#section-126 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate OIR }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-127 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate OIR }
}
##### (3) {#section-128 .H6}
**with** { UE having concluded activation of OIR }
**ensure** **that** {
**when** { UE is made to de-activate OIR }
**then** { UE sends HTTP request to de-activate OIR }
}
##### 8.2.2 Conformance Requirements {#conformance-requirements-41 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.607 clause 4.2.1]:
The OIR service is a service offered to the originating user. It restricts
presentation of the originating user\'s identity information to the
terminating user.
When the OIR service is applicable and activated, the originating network
provides the destination network with the indication that the originating
user\'s identity information is not allowed to be presented to the terminating
user. In this case, no originating user\'s identity information shall be
included in the requests sent to the terminating user. The presentation
restriction function shall not influence the forwarding of the originating
user\'s identity information within the network as part of the simulation
service procedures.
[TS 24.607 clause 4.10.1]:
The OIR service can be activated/deactivated using the active attribute of the
\ service element. Activating
the OIR service this way activates the temporary mode OIR service. When
deactivated and not overruled by operator settings, basic communication
procedures apply.
##### 8.2.3 Test description {#test-description-40 .H6}
##### 8.2.3.1 Pre-test conditions {#pre-test-conditions-40 .H6}
##### System Simulator: {#system-simulator-43 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-43 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-43 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.2.3.2 Test procedure sequence {#test-procedure-sequence-40 .H6}
Table 8.2.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service OIR - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21 - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.2.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service OIR - - - - 8-8b Check: Does the UE
perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.2.3.3-3? - - 3 P
##### 8.2.3.3 Specific message contents {#specific-message-contents-40 .H6}
Table 8.2.3.3-1: Simservs document (step 4)
Derivation Path: TS 24.607 clause 4.10.2
* * *
**Content** **Comment** \  
\  
\
Table 8.2.3.3-2: Simservs document (step 6)
Derivation Path: TS 24.607 clause 4.10.2
* * *
**Content** **Comment** \  
\ the
\"active\" attribute may not be present but if present it is set to \"true\"
\
Table 8.2.3.3-3: Simservs document (step 9)
Derivation Path: TS 24.607 clause 4.10.2
* * *
**Content** **Comment** \  
\  
\
## **8.3 Originating Identification Restriction / Signalling / 5GS**
##### 8.3.1 Test Purpose (TP) {#test-purpose-tp-41 .H6}
##### (1) {#section-129 .H6}
**with** { UE is registered to IMS and OIR in temporary mode is activated }
**ensure that** {
**when** { UE is made to initiate a voice call }
**then** { UE sends INVITE with \"Anonymous\" in the From header }
}
##### 8.3.2 Conformance Requirements {#conformance-requirements-42 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.607 clause 4.5.2.1]:
If the originating user wishes to override the default setting of
\"presentation not restricted\" of the OIR service in temporary mode:
\- The originating UE shall include an \"anonymous\" From header field. The
convention for configuring an anonymous From header field described in IETF
RFC 3323 [6] should be followed; i.e. From: \"Anonymous\"
\;tag= xxxxxxx.
\- If only the Pâ€‘Assertedâ€‘Identity needs to be restricted the originating UE
shall include a Privacy header field [6] set to \"id\" in accordance with IETF
RFC 3325 [7].
\- If all headers containing private information that the UE cannot anonymize
itself need to be restricted, the originating UE shall include a Privacy
header field set to \"header\" in accordance with IETF RFC 3323 [6].
NOTE 2: The Privacy header field value \"header\" does not apply to the
identity in the From header field.
##### 8.3.3 Test description {#test-description-41 .H6}
##### 8.3.3.1 Pre-test conditions {#pre-test-conditions-41 .H6}
System Simulator:
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-44 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
\- The UE is configured to use Telephony Originating Identification
Restriction in temporary mode
##### Preamble: {#preamble-44 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 8.3.3.2 Test procedure sequence {#test-procedure-sequence-41 .H6}
Table 8.3.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                      U - S              Message
1 Make the UE attempt an IMS speech call with originating identification
restriction. - - - - 2-7 Steps 2-7 of generic procedure specified in Table
4.9.15.2.2-1 of TS 38.508-1 [21] are performed. - - - - \- EXCEPTION: In
parallel with Step 8, parallel behaviour defined in table 8.3.3.2-2 takes
place - - - - 8 Check: Does the UE sends INVITE with first SDP offer with
including an \"Anonymous\" From header field? --> INVITE 1 P 9-12 Steps 2-5 of
Annex A.4.1a are perfomed - - - - 12A Step 10 of generic procedure specified
in Table 4.9.15.2.2-1 of TS 38.508-1 [21] is performed. - - - - \- EXCEPTION:
In parallel to steps 12B and 12C below, step 13 occurs. - - - - 12B-12C Steps
11-12 of generic procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21]
are performed. - - - - 13-19 Steps 6-12 of Annex A.4.1a happen. - - - - 20
Make the UE release the IMS speech call. - - - - 21-22 Steps 1-2 defined in
annex A.7 are performed to MO release the IMS speech call. - - - -
Table 8.3.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 8.3.3.3 Specific message contents {#specific-message-contents-41 .H6}
Table 8.3.3.3-1: INVITE (step 8, Table 8.3.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | Step 1 of A.4.1a | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | **From** | | | | | | | | | | | | addr-spec | | | | | +------------------+------+------------------+-----+------------------+ | | | _"Anonymous\" | | | | | | \ _ | | | +------------------+------+------------------+-----+------------------+ | **Privacy** | | _id_ or _header_ | | RFC 3323[50] | | | | (mutually | | RFC 3325[51] | | | | exclusive) | | | +------------------+------+------------------+-----+------------------+
## **8.4 Terminating Identification Presentation / Configuration / 5GS**
##### 8.4.1 Test Purpose (TP) {#test-purpose-tp-42 .H6}
##### (1) {#section-130 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate TIP }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-131 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate TIP }
}
##### (3) {#section-132 .H6}
**with** { UE having concluded activation of TIP }
**ensure** **that** {
**when** { UE is made to de-activate TIP }
**then** { UE sends HTTP request to de-activate TIP }
}
##### 8.4.2 Conformance Requirements {#conformance-requirements-43 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.608 clause 4.2.1]:
The Terminating Identification Presentation (TIP) service provides the
originating party with the possibility of receiving trusted information in
order to identify the terminating party.
[TS 24.608 clause 4.9.1]:
The TIP service can be activated/deactivated using the active attribute of the
\ service element.
##### 8.4.3 Test description {#test-description-42 .H6}
##### 8.4.3.1 Pre-test conditions {#pre-test-conditions-42 .H6}
##### System Simulator: {#system-simulator-44 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-45 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-45 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.4.3.2 Test procedure sequence {#test-procedure-sequence-42 .H6}
Table 8.4.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service TIP. - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.4.3.3-2? - 2 P 7 UE is triggered for
deactivation of supplementary service TIP. - - - - 8-8b Check: Does the UE
perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.4.3.3-3? - - 3 P
##### 8.4.3.3 Specific message contents {#specific-message-contents-42 .H6}
Table 8.4.3.3-1: Simservs document (step 4)
Derivation Path: TS 24.608 clause 4.9.2
* * *
**Content** **Comment** \  
\  
\
Table 8.4.3.3-2: Simservs document (step 6)
Derivation Path: TS 24.608 clause 4.9.2
* * *
**Content** **Comment** \  
\ the \"active\"
attribute may not be present but if present it is set to \"true\" \
Table 8.4.3.3-3: Simservs document (step 9)
Derivation Path: TS 24.608 clause 4.9.2
* * *
**Content** **Comment** \  
\  
\
## **8.5 Terminating Identification Restriction / Configuration / 5GS**
##### 8.5.1 Test Purpose (TP) {#test-purpose-tp-43 .H6}
##### (1) {#section-133 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate TIR }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-134 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate TIR }
}
##### (3) {#section-135 .H6}
**with** { UE having concluded activation of TIR }
**ensure** **that** {
**when** { UE is made to de-activate TIR }
**then** { UE sends HTTP request to de-activate TIR }
}
##### 8.5.2 Conformance Requirements {#conformance-requirements-44 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.608 clause 4.2.1]:
The Terminating Identification Restriction (TIR) is a service offered to the
terminating party which enables the terminating party to prevent presentation
of the terminating identity information to originating party.
[TS 24.608 clause 4.9.1]:
The TIR service can be activated/deactivated using the active attribute of the
\ service element. Activating
the TIR service this way activates the temporary mode TIR service. When
deactivated and not overruled by operator settings, basic communication
procedures apply.
##### 8.5.3 Test description {#test-description-43 .H6}
##### 8.5.3.1 Pre-test conditions {#pre-test-conditions-43 .H6}
##### System Simulator: {#system-simulator-45 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-46 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-46 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.5.3.2 Test procedure sequence {#test-procedure-sequence-43 .H6}
Table 8.5.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service TIR. - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.5.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service TIR. - - - - 8-8b Check: Does the UE
perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.5.3.3-3? - - 3 P
##### 8.5.3.3 Specific message contents {#specific-message-contents-43 .H6}
Table 8.5.3.3-1: Simservs document (step 4)
Derivation Path: TS 24.608 clause 4.9.2
* * *
**Content** **Comment** \  
\  
\
Table 8.5.3.3-2: Simservs document (step 6)
Derivation Path: TS 24.608 clause 4.9.2
* * *
**Content** **Comment** \  
\ the
\"active\" attribute may not be present but if present it is set to \"true\"
\
Table 8.5.3.3-3: Simservs document (step 9)
Derivation Path: TS 24.608 clause 4.9.2
* * *
**Content** **Comment** \  
\  
\
## **8.6 Terminating Identification Restriction / Signalling / 5GS**
##### 8.6.1 Test Purpose (TP) {#test-purpose-tp-44 .H6}
##### (1) {#section-136 .H6}
**with** { UE being registered to IMS and TIR in temporary mode being
activated }
**ensure that** {
**when** { UE receives INVITE for voice call }
**then** { UE includes the Privacy header in its 183 Session Progress response
and in its 180 Ringing response and in its final 200 OK for INVITE response }
}
##### 8.6.2 Conformance Requirements {#conformance-requirements-45 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.608 clause 4.2.1]:
The Terminating Identification Restriction (TIR) is a service offered to the
terminating party which enables the terminating party to prevent presentation
of the terminating identity information to originating party.
[TS 24.608 clause 4.5.2.12]:
The destination UE, if the terminating user wishes to override the default
setting of \"presentation not restricted\" of the TIR service in temporary
mode, shall include a Privacy header with privacy type of \"id\" in any
non-100 responses it sends upon receipt of a SIP request.
....NOTE: It is assumed that TIR subscribers support IETF RFC 3325.
##### 8.6.3 Test description {#test-description-44 .H6}
##### 8.6.3.1 Pre-test conditions {#pre-test-conditions-44 .H6}
System Simulator:
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-47 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
\- The UE is configured to use Terminating Identification Restriction in
temporary mode.
##### Preamble: {#preamble-47 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 8.6.3.2 Test procedure sequence {#test-procedure-sequence-44 .H6}
Table 8.6.3.2-1: Main Behaviour
+---------+------------+------------+------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+============+============+============+=========+====+ | | | U - S | Message | | | +---------+------------+------------+------------+---------+----+ | 1-8 | Steps 1-8 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 9-10 | Steps 1-2 | - | - | - | - | | | of Annex | | | | | | | A.5.1a are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 11 | Check: | --> | 183 | 1 | P | | | Does the | | Session | | | | | UE send | | Progress | | | | | 183 | | | | | | | Session | | | | | | | Progress | | | | | | | response | | | | | | | reliably, | | | | | | | including | | | | | | | a Privacy | | | | | | | header | | | | | | | with | | | | | | | privacy | | | | | | | type of | | | | | | | \"id\"? | | | | | | | | | | | | | | (Steps 3 | | | | | | | of Annex | | | | | | | A.5.1a)) | | | | | +---------+------------+------------+------------+---------+----+ | 12-13 | Steps 4-5 | - | - | - | - | | | of Annex | | | | | | | A.5.1a are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 13A-13C | SS | - | - | - | - | | | triggers | | | | | | | resource | | | | | | | re | | | | | | | servation: | | | | | | | Steps | | | | | | | 10-12 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.16.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 14-15 | Step 6-7 | - | - | - | - | | | of Annex | | | | | | | A.5.1a are | | | | | | | performed | | | | | +---------+------------+------------+------------+---------+----+ | 16 | Check: | --> | 180 | 1 | P | | | Does the | | Ringing | | | | | UE send | | | | | | | 180 | | | | | | | Ringing | | | | | | | including | | | | | | | a Privacy | | | | | | | header | | | | | | | with | | | | | | | privacy | | | | | | | type of | | | | | | | \"id\"? | | | | | | | | | | | | | | (Steps 8 | | | | | | | of Annex | | | | | | | A.5.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 17-19 | Steps | - | - | - | - | | | 9-10A of | | | | | | | Annex | | | | | | | A.5.1a are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 20 | Check: | --> | 200 OK | 1 | P | | | Does the | | | | | | | UE send | | | | | | | 200 OK | | | | | | | including | | | | | | | a Privacy | | | | | | | header | | | | | | | with | | | | | | | privacy | | | | | | | type of | | | | | | | \"id\"? | | | | | | | | | | | | | | (Steps 11 | | | | | | | of Annex | | | | | | | A.5.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 21 | Steps 12 | \
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.7.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\ \ element missing or empty as forwarding is
supposed to be unconditional and not containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.7.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
## 8.8 Communication Forwarding Unconditional / Signalling / 5GS
##### 8.8.1 Test Purpose (TP) {#test-purpose-tp-46 .H6}
##### (1) {#section-140 .H6}
**with** { UE being registered to IMS and being made to initiate a voice call
}
**ensure that** {
**when** { UE sends INVITE and receives a 181 Call Is Being Forwarded response
}
**then** { UE continues and completes the voice call initiation }
}
##### 8.8.2 Conformance Requirements {#conformance-requirements-47 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.604, clause 4.2.1.2]:
The CFU service enables a served user to have the network redirect to another
user communications which are addressed to the served user\'s address. The CFU
service may operate on all communication, or just those associated with
specified services. The served user\'s ability to originate communications is
unaffected by the CFU supplementary service. After the CFU service has been
activated, communications are forwarded independent of the status of the
served user.
As a service provider option, a subscription option can be provided to enable
the served user to receive an indication that the CFU service has been
activated. This indication shall be provided when the served user originates a
communication if the CFU service has been activated for the served user\'s
address and for the service requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
[TS 24.604, clause 4.5.2.1]:
When communication diversion has occurred on the served user side and the
network option \"_Originating_ \" user receives notification that his
communication has been diverted (forwarded or deflected)\" is set to true, the
originating UA may receive a 181 (Call is being forwarded) response according
to the procedures described in 3GPP TS 24.229.
The Information given by the History header could be displayed by the UA if it
is a UE.
##### 8.8.3 Test description {#test-description-46 .H6}
##### 8.8.3.1 Pre-test conditions {#pre-test-conditions-46 .H6}
##### System Simulator: {#system-simulator-47 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-49 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
##### Preamble: {#preamble-49 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 8.8.3.2 Test procedure sequence {#test-procedure-sequence-46 .H6}
Table 8.8.3.2-1: Main Behaviour
+---------+------------+------------+------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+============+============+============+=========+====+ | | | U - S | Message | | | +---------+------------+------------+------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to attempt | | | | | | | an IMS | | | | | | | voice | | | | | | | call. | | | | | +---------+------------+------------+------------+---------+----+ | 2-7 | Steps 2-7 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.15.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | with Steps | | | | | | | 8-9, | | | | | | | parallel | | | | | | | behaviour | | | | | | | defined in | | | | | | | table | | | | | | | 8.8.3.2-2 | | | | | | | takes | | | | | | | place | | | | | +---------+------------+------------+------------+---------+----+ | 8-9 | Steps 1-2 | - | - | - | - | | | as defined | | | | | | | in Annex | | | | | | | A.4.1a are | | | | | | | executed. | | | | | +---------+------------+------------+------------+---------+----+ | 10 | SS sends | \ | PRACK | 1 | P | | | Does the | | | | | | | UE send | | | | | | | PRACK for | | | | | | | 183 | | | | | | | Session | | | | | | | Progress\ | | | | | | | (Step 4 of | | | | | | | A.4.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 13 | SS | \ | UPDATE | 1 | P | | | Does the | | | | | | | UE send a | | | | | | | second SDP | | | | | | | offer in | | | | | | | an UPDATE | | | | | | | request?\ | | | | | | | (Step 6 of | | | | | | | A.4.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 15 | SS | \ | PRACK | - | - | | | ac | | | | | | | knowledges | | | | | | | the | | | | | | | receipt of | | | | | | | 180 | | | | | | | response | | | | | | | by sending | | | | | | | PRACK.\ | | | | | | | (Step 9 of | | | | | | | A.4.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 18 | The SS | \ | ACK | - | - | | | ac | | | | | | | knowledges | | | | | | | the | | | | | | | receipt of | | | | | | | 200 OK for | | | | | | | INVITE\ | | | | | | | (Step12 of | | | | | | | A.4.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 21 | Make the | - | - | - | - | | | UE release | | | | | | | the call. | | | | | +---------+------------+------------+------------+---------+----+ | 22 | UE | - | - | - | - | | | releases | | | | | | | the voice | | | | | | | call. | | | | | | | | | | | | | | (Steps 1-2 | | | | | | | of Annex | | | | | | | A.7.) | | | | | +---------+------------+------------+------------+---------+----+
Table 8.8.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 8.8.3.3 Specific message content {#specific-message-content .H6}
Table 8.8.3.3-1: 181 Call is being forwarded for INVITE (Step 10, table
8.8.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.2.14.
* * *
Table 8.8.3.3-2: 180 Ringing for INVITE (Step 16, table 8.8.3.2-1)
Derivation Path: TS 34.229-1 [2], Table in subclause A.2.4 with conditions A1
and A7
* * *
Header/param Cond Value/remark Rel Reference **History-Info**  
hi-targeted-to-uri Same value as in the 181 response of step 10  
hi-index Same value as in the 181 response of step 10
Table 8.8.3.3-3: 200 OK for INVITE (Step 19, table 8.8.3.2-1)
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.1, conditions A1,
A10, and A19
* * *
Header/param Cond Value/remark Rel Reference **History-Info**  
hi-targeted-to-uri Same value as in the 181 response of step 10  
hi-index Same value as in the 181 response of step 10
## **8.9 Communication Forwarding on Not Logged-in / Configuration / 5GS**
##### 8.9.1 Test Purpose (TP) {#test-purpose-tp-47 .H6}
##### (1) {#section-141 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate CFNL }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-142 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate CFNL }
}
##### (3) {#section-143 .H6}
**with** { UE having concluded activation of CFNL }
**ensure** **that** {
**when** { UE is made to de-activate CFNL }
**then** { UE sends HTTP request to de-activate CFNL }
}
##### 8.9.2 Conformance Requirements {#conformance-requirements-48 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.604, clause 4.2.1.7]:
The Communication Forwarding on Not Logged-in (CFNL) service enables a served
user to redirect incoming communications which are addressed to the served
user\'s address, to another user (forwarded-to address) in case the served
user is not registered (logged-in). The CFNL service may operate on all
communications, or just those associated with specified basic services.
As a service provider option, a subscription option can be provided to enable
the served user to receive an indication that the CFNL service has been
activated. This indication shall be provided when the served user logs out
according to procedures described in RFC 3261
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
##### 8.9.3 Test description {#test-description-47 .H6}
##### 8.9.3.1 Pre-test conditions {#pre-test-conditions-47 .H6}
##### System Simulator: {#system-simulator-48 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-50 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-50 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.9.3.2 Test procedure sequence {#test-procedure-sequence-47 .H6}
Table 8.9.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                   U - S              Message
1 UE is triggered for activation of supplementary service CFNL - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21 - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.9.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service CFNL - - - - 8-8b Check: Does the UE
perform steps 8 -- 8b of the generic test procedure for activation of
Supplementary Services according to annex A.21 - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.9.3.3-3? - - 3 P
##### 8.9.3.3 Specific message contents {#specific-message-contents-46 .H6}
Table 8.9.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.9.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\ not containing a \ element
\
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.9.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
## 8.10 Void
## **8.11 Communication Forwarding on Busy / Configuration / 5GS**
##### 8.11.1 Test Purpose (TP) {#test-purpose-tp-48 .H6}
##### (1) {#section-144 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate CFB }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-145 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate CFB }
}
##### (3) {#section-146 .H6}
**with** { UE having concluded activation of CFB }
**ensure** **that** {
**when** { UE is made to de-activate CFB }
**then** { UE sends HTTP request to de-activate CFB }
}
##### 8.11.2 Conformance Requirements {#conformance-requirements-49 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.604, clause 4.2.1.3]:
The CFB service enables a served user to have the network redirect to another
user communications which are addressed to the served user\'s address and meet
busy. The CFB service may operate on all communications, or just those
associated with specified services. The served user\'s ability to originate
communications is unaffected by the CFB supplementary service.
As a service provider option, a subscription option can be provided to enable
the served user to receive an indication that the CFB service has been
activated. This indication shall be provided when the served user originates a
communication if the CFB service has been activated for the served user\'s
address and for the service requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
##### 8.11.3 Test description {#test-description-48 .H6}
##### 8.11.3.1 Pre-test conditions {#pre-test-conditions-48 .H6}
##### System Simulator: {#system-simulator-49 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server.
\- 1 NR Cell
##### UE: {#ue-51 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-51 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.11.3.2 Test procedure sequence {#test-procedure-sequence-48 .H6}
Table 8.11.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service CFB. - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.11.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service CFB. - - - - 8-8b Check: Does the UE
perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.11.3.3-3? - - 3 P
##### 8.11.3.3 Specific message contents {#specific-message-contents-47 .H6}
Table 8.11.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.11.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\ not containing a \ element
\
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.11.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
## **8.12 Void**
## **8.13 Communication Forwarding on Subscriber Not Reachable / Configuration
/ 5GS**
##### 8.13.1 Test Purpose (TP) {#test-purpose-tp-49 .H6}
##### (1) {#section-147 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate CFNRc }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-148 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate CFNRc }
}
##### (3) {#section-149 .H6}
**with** { UE having concluded activation of CFNRc }
**ensure** **that** {
**when** { UE is made to de-activate CFNRC }
**then** { UE sends HTTP request to de-activate CFNRc }
}
##### 8.13.2 Conformance Requirements {#conformance-requirements-50 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
**Communication Forwarding on Subscriber Not Reachable (CFNRc)**
The CFNRc service enables an user to have the network redirect all incoming
communications, when the user is not reachable (e.g. there is no IP
connectivity to the user\'s terminal), to another user. The CFNRc service may
operate on all communications, or just those associated with specified
services. The user\'s ability to originate communications is unaffected by the
CFNRc simulation service.
As a service provider option, a subscription option can be provided to enable
the user to receive an indication that the CFNRc service has been activated.
This indication may be provided when the user originates a communication if
the CFNRc service has been activated for the user and for the service
requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
##### 8.13.3 Test description {#test-description-49 .H6}
##### 8.13.3.1 Pre-test conditions {#pre-test-conditions-49 .H6}
##### System Simulator: {#system-simulator-50 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-52 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-52 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.13.3.2 Test procedure sequence {#test-procedure-sequence-49 .H6}
Table 8.13.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                   U - S              Message
1 UE is triggered for activation of supplementary service CFNRC - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21 - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.13.3.3-2? - 2 P 7 UE is triggered for
deactivation of supplementary service CFNRC - - - - 8-8b Check: Does the UE
perform steps 8 -- 8b of the generic test procedure for activation of
Supplementary Services according to annex A.21 - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.13.3.3-3? - - 3 P
##### 8.13.3.3 Specific message contents {#specific-message-contents-48 .H6}
Table 8.13.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.13.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\ not containing a \ element
\
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.13.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
## **8.14 Void**
## **8.15 Communication Forwarding on No Reply / Configuration / 5GS**
##### 8.15.1 Test Purpose (TP) {#test-purpose-tp-50 .H6}
##### (1) {#section-150 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate CFNR }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-151 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate CFNR }
}
##### (3) {#section-152 .H6}
**with** { UE having concluded activation of CFNR }
**ensure** **that** {
**when** { UE is made to de-activate CFNR }
**then** { UE sends HTTP request to de-activate CFNR }
}
##### 8.15.2 Conformance Requirements {#conformance-requirements-51 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.604, clause 4.2.1.4]:
The CFNR service enables a served user to have the network redirect to another
user communications which are addressed to the served user\'s address, and for
which the connection is not established within a defined period of time. The
CFNR service may operate on all communications, or just those associated with
specified services. The served user\'s ability to originate communications is
unaffected by the CFNR supplementary service.
The CFNR service can only be invoked by the network after the communication
has been offered to the served user and an indication that the called user is
being informed of the communication has been received.
As a service provider option, a subscription option can be provided to enable
the served user to receive an indication that the CFNR service has been
activated. This indication shall be provided when the served user originates a
communication if the CFNR service has been activated for the served user\'s
address and for the service requested for the communication.
The maximum number of diversions permitted for each communication is a service
provider option. The service provider shall define the upper limit of
diversions. When counting the number of diversions, all types of diversion are
included.
##### 8.15.3 Test description {#test-description-50 .H6}
##### 8.15.3.1 Pre-test conditions {#pre-test-conditions-50 .H6}
##### System Simulator: {#system-simulator-51 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-53 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-53 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.15.3.2 Test procedure sequence {#test-procedure-sequence-50 .H6}
Table 8.15.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                   U - S              Message
1 UE is triggered for activation of supplementary service CFNR - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21 - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.15.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service CFNR - - - - 8-8b Check: Does the UE
perform steps 8 -- 8b of the generic test procedure for activation of
Supplementary Services according to annex A.21 - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.15.3.3-3? - - 3 P
##### 8.15.3.3 Specific message contents {#specific-message-contents-49 .H6}
Table 8.15.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.15.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\ not containing a \ element
\
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
Table 8.15.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.604 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute may not be
present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\
\ px_XCAP_TargetUri\
\true\
\
\
\
\
\
\
* * *
## **8.16 Void**
## **8.17 Barring of All Incoming Calls / Configuration / 5GS**
##### 8.17.1 Test Purpose (TP) {#test-purpose-tp-51 .H6}
##### (1) {#section-153 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate incoming communication barring for all calls
(ICB) }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-154 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate ICB }
}
##### (3) {#section-155 .H6}
**with** { UE having concluded activation of ICB }
**ensure** **that** {
**when** { UE is made to de-activate ICB }
**then** { UE sends HTTP request to de-activate ICB }
}
##### 8.17.2 Conformance Requirements {#conformance-requirements-52 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.611, clause 4.9.1.4]:
The following conditions are allowed by the XML Schema for the communication
barring service.
**presence-status:** This condition evaluates to true when the called user\'s
current presence activity status is equal to the value set for this condition.
In all other cases the condition evaluates to false.
**cp:identity:** This condition evaluates to true when a provided user\'s
identity matches with the value of the identity element. The interpretation of
all the elements of this condition is described in the common policy draft\
(see IETF RFC 4745 [16]). In all other cases the condition evaluates to false.
**anonymous:** To comply with the requirements as set for simulation of the
ACR service, the _anonymous_ element only evaluate to true when the conditions
as set out in clause 4.5.2.6.2 for asserted originating public user identity
apply.
**request-name:** This condition evaluates to true when the incoming SIP
request name matches with the value of the request-name element.
NOTE 1: The absence of this condition means that the barring rules apply to
all initial incoming requests.
**...**
The condition elements that are not taken from the common policy draft (see
IETF RFC 4745 [16]) or OMA common policy schema ETSI TS 183 038 [4] are
defined in the simservs document schema specified in 3GPP TS 24.623 [6].
Information of which of the above mentioned conditions the user is allowed to
use can be obtained from the network by using the schema defined in clause
4.9.3.
The \"serv-cap-media\" element lists the elements that can be used in the
\"media\" rule condition.
##### 8.17.3 Test description {#test-description-51 .H6}
##### 8.17.3.1 Pre-test conditions {#pre-test-conditions-51 .H6}
##### System Simulator: {#system-simulator-52 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server.
\- 1 NR Cell
##### UE: {#ue-54 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-54 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.17.3.2 Test procedure sequence {#test-procedure-sequence-51 .H6}
Table 8.17.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service ICB - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.17.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service ICB - - - - 8-8b Check: Does the UE
perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.17.3.3-3? - - 3 P
##### 8.17.3.3 Specific message contents {#specific-message-contents-50 .H6}
Table 8.17.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\ first rule
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.17.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\ first rule
\ the \ element may not be present if present it is
set to empty
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.17.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\ first rule
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
## 8.18 Barring of All Incoming Calls / except for a specific user /
Configuration / 5GS
##### 8.18.1 Test Purpose (TP) {#test-purpose-tp-52 .H6}
##### (1) {#section-156 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { _UE is made to activate incoming communication barring except for a
specific user (ICBESU)_ }
**then** { UE authenticates itself using Digest or GBA}
}
##### (2) {#section-157 .H6}
**with** { UE having started authentication using Digest or GBA}
**ensure that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate ICBESU }
}
##### (3) {#section-158 .H6}
**with** { UE having concluded activation of ICBESU }
**ensure that** {
**when** { UE is made to de-activate ICBESU }
**then** { UE sends HTTP request to de-activate ICBESU }
}
##### 8.18.2 Conformance Requirements {#conformance-requirements-53 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
References: Conformance requirements for activating and deactivating
Communication Barring are specified in TS 34.229-1 Annexes F.1 and F.5; TS
24.611, clause 4.9.1.4; TS 24.109, clause 4.2
[TS 24.611, clause 4.9.1.4]:
cp:identity: This condition evaluates to true when the remote user\'s identity
matches with the value of the identity element. The interpretation of all the
elements of this condition is described in the in the common policy draft (see
RFC 4745). In all other cases the condition evaluates to false.
...
ocp:otherâ€‘identity: If present in any rule, the \"otherâ€‘identity\" element,
which is empty, matches all identities that are not referenced in any rule. It
allows for specifying a default policy. The exact interpretation of this
condition is specified in OMAâ€‘TSâ€‘XDM_Core.
[TS 24.109 clause 4.2]:
The UE shall initiate the bootstrapping procedure when:
a) the UE wants to interact with a NAF and bootstrapping is required;
b) a NAF has requested bootstrapping required indication as described in
subclause 5.2.4 or bootstrapping renegotiation indication as described in
subclause 5.2.5; or
c) the lifetime of the key has expired in the UE if one or more applications
are using that key.
A UE and the BSF shall establish bootstrapped security association between
them by running bootstrapping procedure. Bootstrapping security association
consists of a bootstrapping transaction identifier (B-TID) and key material
Ks. Bootstrapping session on the BSF also includes security related
information about subscriber (e.g. user\'s private identity). Bootstrapping
session is valid for a certain time period, and shall be deleted in the BSF
when the session becomes invalid.
Bootstrapping procedure shall be based on HTTP Digest AKA as described in 3GPP
TS 33.220 [1] and in RFC 3310 [6] with the modifications described below.
The BSF address is derived from the IMPI or IMSI according to 3GPP TS 23.003
[7].
A UE shall indicate to the BSF that it supports the use of TMPI as defined in
3GPP 33.220 [1] by including a \"product\" token in the \"User-Agent\" header
field (cf. RFC 2616 [14]) that is set to a static string \"3gpp-gba-tmpi\" in
HTTP requests sent to the BSF.
A BSF shall indicate to the UE that it supports the use of TMPI as defined in
3GPP 33.220 [1] by including a \"product\" token in the \"Server\" header
field (cf. RFC 2616 [14]) that is set to a static string \"3gpp-gba-tmpi\" in
HTTP responses sent to the UE.
In the bootstrapping procedure, Authorization, WWW-Authenticate, and
Authentication-Info HTTP headers shall be used as described in RFC 3310 [6]
with following exceptions:
a) the \"realm\" parameter shall contain the network name where the username
is authenticated;
b) the quality of protection (\"qop\") parameter shall be \"auth-int\"; and
c) the \"username\" parameter shall contain user\'s private identity (IMPI).
NOTE: If the UE does not have an ISIM application with an IMPI, the IMPI will
be constructed from IMSI, according to 3GPP TS 23.003 [7].
In addition to RFC 3310 [6], the following apply:
a) In the initial request from the UE to the BSF, the UE shall include
Authorization header with following parameters:
\- the username directive, set to
1) the value of the TMPI if one has been associated with the private user
identity as described in 3GPP 33.220 [1]; or
2) the value of the private user identity;
\- the realm directive, set to the BSF address derived from the IMPI or IMSI
according to 3GPP TS 23.003 [7];
\- the uri directive, set to either absoluteURL \"http://\/\" or
abs_path \"/\", and which one is used is specified in RFC 2617 [9];
\- the nonce directive, set to an empty value; and
\- the response directive, set to an empty value;
b) In the challenge response from the BSF to the UE, the BSF shall include
parameters to WWW-Authenticate header as specified in RFC 3310 [6] with
following clarifications:
\- the realm directive, set to the BSF address derived from the IMPI or IMSI
according to 3GPP TS 23.003 [7];
c) In the message from the BSF to the UE, the BSF shall include bootstrapping
transaction identifier (B-TID) and the key lifetime to an XML document in the
HTTP response payload. The BSF may also include additional server specific
data to the XML document. The XML schema definition of this XML document is
given in Annex C.
d) When responding to a challenge from the BSF, the UE shall include an
Authorization header containing a realm directive set to the value as received
in the realm directive in the WWW-Authenticate header.
e) Authentication-Info header shall be included into the subsequent HTTP
response after the BSF concluded that the UE has been authenticated.
Authentication-Info header shall include the \"rspauth\" parameter.
After successful bootstrapping procedure the UE and the BSF shall contain the
key material (Ks) and the B-TID. The key material shall be derived from AKA
parameters as specified in 3GPP TS 33.220 [1]. In addition, BSF shall also
contain a set of security specific attributes related to the UE.
An example flow of successful bootstrapping procedure can be found in clause
A.3.
##### 8.18.3 Test description {#test-description-52 .H6}
##### 8.18.3.1 Pre-test conditions {#pre-test-conditions-52 .H6}
##### System Simulator: {#system-simulator-53 .H6}
\- SS is configured shared secret key of IMS AKA algorithm, related to the IMS
private user identity (IMPI) configured on the UICC card equipped into the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-55 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-55 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.18.3.2 Test procedure sequence {#test-procedure-sequence-52 .H6}
Table 8.18.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                           U - S              Message
1 UE is triggered for activation of supplementary service ICBESU - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.18.3.3-2 or table 8.18.3.3-3? - 2 P 7 UE is
triggered for deactivation of supplementary service ICBESU - - - - 8-8b Check:
Does the UE perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.18.3.3-4 or table 8.18.3.3-5? - - 3 P
##### 8.18.3.3 Specific message contents {#specific-message-contents-51 .H6}
Table 8.18.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
**Content** **Further restrictions/Comments**
\
\
\
\
\
\
\
\
\
\
\
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.18.3.3-2: Simservs document (step 6) -- Option 1
* * *
Derivation Path: TS 24.611 clause 4.9.2
**Content** **Further restrictions/Comments**
\
\ the \"active\"
attribute may not be present but if present it is set to \"true\"
\
\
\ list of conditions not containing a \
element
\
\
\
\
\
\
\
\**true** \
\
\
\
\
\
* * *
Table 8.18.3.3-3: Simservs document (step 6) -- Option 2
* * *
Derivation Path: TS 24.611 clause 4.9.2
**Content** **Further restrictions/Comments**
\
\ the \"active\"
attribute may not be present but if present it is set to \"true\"
\
\ first rule
\ list of conditions for first rule not containing a \ element
\
\
\
\
\
\**true** \
\
\
\ second rule
\ list of conditions for second rule not containing a \ element
\
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.18.3.3-4: Simservs document (step 9) -- Option 1
* * *
Derivation Path: TS 24.611 clause 4.9.2
**Content** **Further restrictions/Comments**
\
\
... any content
\
\
* * *
Table 8.18.3.3-5: Simservs document (step 9) -- Option 2
* * *
Derivation Path: TS 24.611 clause 4.9.2
**Content** **Further restrictions/Comments**
\
\ the \"active\"
attribute may not be present but if present it is set to \"true\"
\
... list of rules with each \ element having a **\ **
condition in the \ element
\
\
\
* * *
## **8.19 Barring of All Incoming Calls from anonymous users / Configuration /
5GS**
##### 8.19.1 Test Purpose (TP) {#test-purpose-tp-53 .H6}
##### (1) {#section-159 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate ACR }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-160 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate ACR }
}
##### (3) {#section-161 .H6}
**with** { UE having concluded activation of ACR }
**ensure** **that** {
**when** { UE is made to de-activate ACR }
**then** { UE sends HTTP request to de-activate ACR }
}
##### 8.19.2 Conformance Requirements {#conformance-requirements-54 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.611, clause 4.2.1]:
The Anonymous Communication Rejection (ACR) service allows the served user to
reject incoming communications on which the asserted public user identity of
the originating user is restricted. In case the asserted public user identity
of the originating user is not provided then the communication shall be
allowed by the ACR service.
An example where the originating user restricts presentation of the asserted
public user identity is when he activated the OIR service 3GPP TS 24.607.
The originating user is given an appropriate indication that the communication
has been rejected due to the application of the ACR service.
The Anonymous Communication Rejection (ACR) simulation service is a special
case of the ICB service, which is highlighted here because it is a regulatory
service in many countries. The ACR service can be activated for a specific
subscriber by configuring an ICB service barring rule where the conditional
part contains the \"Condition=anonymous\" and the action part \"allow=false\".
[TS 24.611, clause 4.5.2.6.2]:
The AS providing the ACR service shall reject all incoming communications
where the incoming SIP request:
1) includes the P-Asserted-Identity header field AND includes the Privacy
header field indicating \"id\" as specified in RFC 3325; or
2) includes the P-Asserted-Identity header field AND includes the Privacy
header field indicating \"header\" as specified in RFC 3323; or
3) includes the P-Asserted-Identity header field AND includes the Privacy
header field indicating \"user\" as specified in RFC 3323; or
4) includes the P-Asserted-Identity header field AND includes the Privacy
header field indicating \"critical\" as specified in RFC 3323.
[TS 24.611, clause 4.9.1.4]:
**anonymous:** To comply with the requirements as set for simulation of the
ACR service, the _anonymous_ element shall only evaluate to true when the
conditions as set out in clause 4.5.2.6.2 for asserted originating public user
identity apply.
##### 8.19.3 Test description {#test-description-53 .H6}
##### 8.19.3.1 Pre-test conditions {#pre-test-conditions-53 .H6}
##### System Simulator: {#system-simulator-54 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server.
\- 1 NR Cell
##### UE: {#ue-56 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-56 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.19.3.2 Test procedure sequence {#test-procedure-sequence-53 .H6}
Table 8.19.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service ACR. - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.19.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service ACR. - - - - 8-8b Check: Does the UE
perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.19.3.3-3? - - 3 P
##### 8.19.3.3 Specific message contents {#specific-message-contents-52 .H6}
Table 8.19.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.19.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\ list of conditions not containing a \
element
\
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.19.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
## 8.20 **Void**
## **8.21 Barring of all Outgoing Calls / Configuration / 5GS**
##### 8.21.1 Test Purpose (TP) {#test-purpose-tp-54 .H6}
##### (1) {#section-162 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate barring of all Outgoing Calls (OCB) }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-163 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate OCB }
}
##### (3) {#section-164 .H6}
**with** { UE having concluded activation of OCB }
**ensure** **that** {
**when** { UE is made to de-activate OCB }
**then** { UE sends HTTP request to de-activate OCB }
}
##### 8.21.2 Conformance Requirements {#conformance-requirements-55 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.611, clause 4.2.1]:
The Outgoing Communication Barring (OCB) service makes it possible for a user
to have barring of certain categories of outgoing communications according to
a provisioned or user configured barring program and is valid for all outgoing
communications. A barring program is expressed as a set of rules in which the
rules have a conditional part and an action part. An example condition is
whether the request uri matches a specific public user identity. The action
part can specify for a rule that contains a matching condition that the
specific outgoing communication it to be barred. The complete set of
conditions and actions that apply to this service and their semantics is
described in clause 4.9.
[TS 24.611, clause 4.5.2.4.1]:
The AS providing the OCB service shall operate as either an AS acting as a SIP
proxy as specified in clause 5.7.4 of 3GPP TS 24.229 [2] or an AS providing
3rd party call control, and specifically as a routeing B2BUA, as specified in
clause 5.7.5 of 3GPP TS 24.229 [2]. An AS providing the OCB service and
rejecting the request shall operate as a terminating UA, as specified in
clause 5.7.2 of 3GPP TS 24.229 [2].
NOTE: For the case when the session is not subject to OCB according the
requirements in this document, and is the only service being applied by the
AS, then the AS only needs to act as a SIP proxy. If additional services are
applied, then the AS might need to act as a routeing B2BUA.
The AS providing the OCB service shall reject outgoing communications when the
evaluation of the served users outgoing communication barring rules according
to the algorithm as specified in clause 4.9.1.2 evaluates to
(allow=\"false\"),.Outgoing communications towards emergency services are
always allowed irrespective of what barring settings the user has defined. To
allow emergency calls to go through, the operator creates an allow list, as
described in clause 4.9.1.3, including emergency numbers in any useful format
including emergency service URNs specified in RFC 5031[23]. For the purpose of
OCB, the AS shall evaluate the \"cp:identity\" and \"ocp:external-list\"
conditions against the called party identity taken from Request-URI or
additionally taken from the To header field.
When the AS providing the OCB service rejects a communication, the AS shall
send an indication to the calling user by sending a 603 (Decline) response
Additionally, before terminating the communication the AS can provide an
announcement to the originating user. The procedure of invoking an
announcement is described within 3GPP TS 24.628 [10].
[TS 24.611, clause 4.9.1.4]:
The following conditions are allowed by the XML Schema for the communication
barring service.
...
The condition elements that are not taken from the common policy draft (see
IETF RFC 4745 [16]) or OMA common policy schema ETSI TS 183 038 [4] are
defined in the simservs document schema specified in 3GPP TS 24.623 [6].
Information of which of the above mentioned conditions the user is allowed to
use can be obtained from the network by using the schema defined in clause
4.9.3.
The \"serv-cap-media\" element lists the elements that can be used in the
\"media\" rule condition.
##### 8.21.3 Test description {#test-description-54 .H6}
##### 8.21.3.1 Pre-test conditions {#pre-test-conditions-54 .H6}
##### System Simulator: {#system-simulator-55 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-57 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-57 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.21.3.2 Test procedure sequence {#test-procedure-sequence-54 .H6}
Table 8.21.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service OCB - - - - 2-5b
Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.21.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service OCB. - - - - 8-8b Check: Does the UE
perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.21.3.3-3? - - 3 P
##### 8.21.3.3 Specific message contents {#specific-message-contents-53 .H6}
Table 8.21.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.21.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\ the \ element may not be present if present it is
set to empty
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.21.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
## **8.22 Barring of Outgoing International Calls / Configuration / 5GS**
##### 8.22.1 Test Purpose (TP) {#test-purpose-tp-55 .H6}
##### (1) {#section-165 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate barring of all Outgoing Calls (OCB intl) }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-166 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate OCB intl }
}
##### (3) {#section-167 .H6}
**with** { UE having concluded activation of OCB intl }
**ensure** **that** {
**when** { UE is made to de-activate OCB intl }
**then** { UE sends HTTP request to de-activate OCB intl }
}
##### 8.22.2 Conformance Requirements {#conformance-requirements-56 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.611, clause 4.2.1]:
The Outgoing Communication Barring (OCB) service makes it possible for a user
to have barring of certain categories of outgoing communications according to
a provisioned or user configured barring program and is valid for all outgoing
communications. A barring program is expressed as a set of rules in which the
rules have a conditional part and an action part. An example condition is
whether the request uri matches a specific public user identity. The action
part can specify for a rule that contains a matching condition that the
specific outgoing communication it to be barred. The complete set of
conditions and actions that apply to this service and their semantics is
described in clause 4.9.
[TS 24.611, clause 4.5.2.4.1]:
The AS providing the OCB service shall operate as either an AS acting as a SIP
proxy as specified in clause 5.7.4 of 3GPP TS 24.229 [2] or an AS providing
3rd party call control, and specifically as a routeing B2BUA, as specified in
clause 5.7.5 of 3GPP TS 24.229 [2]. An AS providing the OCB service and
rejecting the request shall operate as a terminating UA, as specified in
clause 5.7.2 of 3GPP TS 24.229 [2].
NOTE: For the case when the session is not subject to OCB according the
requirements in this document, and is the only service being applied by the
AS, then the AS only needs to act as a SIP proxy. If additional services are
applied, then the AS might need to act as a routeing B2BUA.
The AS providing the OCB service shall reject outgoing communications when the
evaluation of the served users outgoing communication barring rules according
to the algorithm as specified in clause 4.9.1.2 evaluates to
(allow=\"false\"),.Outgoing communications towards emergency services are
always allowed irrespective of what barring settings the user has defined. To
allow emergency calls to go through, the operator creates an allow list, as
described in clause 4.9.1.3, including emergency numbers in any useful format
including emergency service URNs specified in RFC 5031[23]. For the purpose of
OCB, the AS shall evaluate the \"cp:identity\" and \"ocp:external-list\"
conditions against the called party identity taken from Request-URI or
additionally taken from the To header field.
When the AS providing the OCB service rejects a communication, the AS shall
send an indication to the calling user by sending a 603 (Decline) response
Additionally, before terminating the communication the AS can provide an
announcement to the originating user. The procedure of invoking an
announcement is described within 3GPP TS 24.628 [10].
[TS 24.611, clause 4.9.1.4]:
**international:** This condition evaluates to true when the request URI of
the outgoing SIP request:
\- corresponds to a telephone number, i.e. a SIP URI with a \"user\" URI
parameter set to \"phone\" or a tel URI; and
\- does not point to a destination served by a network within the country
where the originating user is located when initiating the communication.
##### 8.22.3 Test description {#test-description-55 .H6}
##### 8.22.3.1 Pre-test conditions {#pre-test-conditions-55 .H6}
##### System Simulator: {#system-simulator-56 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-58 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-58 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.22.3.2 Test procedure sequence {#test-procedure-sequence-55 .H6}
Table 8.22.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service OCB intl. - - - -
2-5b Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.22.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service OCB intl. - - - - 8-8b Check: Does the
UE perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.22.3.3-3? - - 3 P
##### 8.22.3.3 Specific message contents {#specific-message-contents-54 .H6}
Table 8.22.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.22.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\ list of conditions not containing a \
element
\
\
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.22.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
## **8.23 Barring of Outgoing International Calls / ex Home Country /
Configuration / 5GS**
##### 8.23.1 Test Purpose (TP) {#test-purpose-tp-56 .H6}
##### (1) {#section-168 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate Barring of Outgoing International Calls ex
Home Country (OCB intl exHC) }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-169 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate OCB intl exHC }
}
##### (3) {#section-170 .H6}
**with** { UE having concluded activation of OCB intl exHC }
**ensure** **that** {
**when** { UE is made to de-activate OCB intl exHC }
**then** { UE sends HTTP request to de-activate OCB intl exHC }
}
##### 8.23.2 Conformance Requirements {#conformance-requirements-57 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.611, clause 4.2.1]:
The Outgoing Communication Barring (OCB) service makes it possible for a user
to have barring of certain categories of outgoing communications according to
a provisioned or user configured barring program and is valid for all outgoing
communications. A barring program is expressed as a set of rules in which the
rules have a conditional part and an action part. An example condition is
whether the request uri matches a specific public user identity. The action
part can specify for a rule that contains a matching condition that the
specific outgoing communication it to be barred. The complete set of
conditions and actions that apply to this service and their semantics is
described in clause 4.9.
[TS 24.611, clause 4.5.2.4.1]:
The AS providing the OCB service shall operate as either an AS acting as a SIP
proxy as specified in clause 5.7.4 of 3GPP TS 24.229 [2] or an AS providing
3rd party call control, and specifically as a routeing B2BUA, as specified in
clause 5.7.5 of 3GPP TS 24.229 [2]. An AS providing the OCB service and
rejecting the request shall operate as a terminating UA, as specified in
clause 5.7.2 of 3GPP TS 24.229 [2].
NOTE: For the case when the session is not subject to OCB according the
requirements in this document, and is the only service being applied by the
AS, then the AS only needs to act as a SIP proxy. If additional services are
applied, then the AS might need to act as a routeing B2BUA.
The AS providing the OCB service shall reject outgoing communications when the
evaluation of the served users outgoing communication barring rules according
to the algorithm as specified in clause 4.9.1.2 evaluates to
(allow=\"false\"),.Outgoing communications towards emergency services are
always allowed irrespective of what barring settings the user has defined. To
allow emergency calls to go through, the operator creates an allow list, as
described in clause 4.9.1.3, including emergency numbers in any useful format
including emergency service URNs specified in RFC 5031[23]. For the purpose of
OCB, the AS shall evaluate the \"cp:identity\" and \"ocp:external-list\"
conditions against the called party identity taken from Request-URI or
additionally taken from the To header field.
When the AS providing the OCB service rejects a communication, the AS shall
send an indication to the calling user by sending a 603 (Decline) response
Additionally, before terminating the communication the AS can provide an
announcement to the originating user. The procedure of invoking an
announcement is described within 3GPP TS 24.628 [10].
[TS 24.611, clause 4.9.1.4]:
**international-exHC:** This condition for international barring, excluding
the home country, evaluates to true when the request URI of the outgoing SIP
request:
\- corresponds to a telephone number, i.e. a SIP URI with a \"user\" URI
parameter set to \"phone\" or a tel URI;
\- does not point to a destination served by a network within the country
where the originating user is located when initiating the communication; and
\- does not point to a destination served within the served users home
network.
NOTE 4: In case of international and international-exHC, called users
subscribed to a network in the country in which the served user roams, can be
called irrespective where they roam. Subscribers, subscribed to any network in
another country than the one in which the served user is located cannot be
called even if they roam in the same network area as the served users or in
the served user\'s home network. The condition elements that are not taken
from the common policy draft (see IETF RFC 4745 [16]) or OMA common policy
schema ETSI TS 183 038 [4] are defined in the simservs document schema
specified in 3GPP TS 24.623 [6].
##### 8.23.3 Test description {#test-description-56 .H6}
##### 8.23.3.1 Pre-test conditions {#pre-test-conditions-56 .H6}
##### System Simulator: {#system-simulator-57 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-59 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-59 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.23.3.2 Test procedure sequence {#test-procedure-sequence-56 .H6}
Table 8.23.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service OCB intl exHC. - - -
- 2-5b Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.23.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service OCB intl exHC. - - - - 8-8b Check: Does
the UE perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.23.3.3-3? - - 3 P
##### 8.23.3.3 Specific message contents {#specific-message-contents-55 .H6}
Table 8.23.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.23.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\ list of conditions not containing a \
element
\
\
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.23.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
## **8.24 Barring of Outgoing International Calls / When Roaming /
Configuration / 5GS**
##### 8.24.1 Test Purpose (TP) {#test-purpose-tp-57 .H6}
##### (1) {#section-171 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate Barring of Outgoing International Calls when
roaming (OCB intl roam) }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-172 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate OCB intl roam }
}
##### (3) {#section-173 .H6}
**with** { UE having concluded activation of OCB intl roam }
**ensure** **that** {
**when** { UE is made to de-activate OCB intl roam }
**then** { UE sends HTTP request to de-activate OCB intl roam }
}
##### 8.24.2 Conformance Requirements {#conformance-requirements-58 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.611, clause 4.2.1]:
The Outgoing Communication Barring (OCB) service makes it possible for a user
to have barring of certain categories of outgoing communications according to
a provisioned or user configured barring program and is valid for all outgoing
communications. A barring program is expressed as a set of rules in which the
rules have a conditional part and an action part. An example condition is
whether the request uri matches a specific public user identity. The action
part can specify for a rule that contains a matching condition that the
specific outgoing communication it to be barred. The complete set of
conditions and actions that apply to this service and their semantics is
described in clause 4.9.
[TS 24.611, clause 4.5.2.4.1]:
The AS providing the OCB service shall operate as either an AS acting as a SIP
proxy as specified in clause 5.7.4 of 3GPP TS 24.229 [2] or an AS providing
3rd party call control, and specifically as a routeing B2BUA, as specified in
clause 5.7.5 of 3GPP TS 24.229 [2]. An AS providing the OCB service and
rejecting the request shall operate as a terminating UA, as specified in
clause 5.7.2 of 3GPP TS 24.229 [2].
NOTE: For the case when the session is not subject to OCB according the
requirements in this document, and is the only service being applied by the
AS, then the AS only needs to act as a SIP proxy. If additional services are
applied, then the AS might need to act as a routeing B2BUA.
The AS providing the OCB service shall reject outgoing communications when the
evaluation of the served users outgoing communication barring rules according
to the algorithm as specified in clause 4.9.1.2 evaluates to
(allow=\"false\"),.Outgoing communications towards emergency services are
always allowed irrespective of what barring settings the user has defined. To
allow emergency calls to go through, the operator creates an allow list, as
described in clause 4.9.1.3, including emergency numbers in any useful format
including emergency service URNs specified in RFC 5031[23]. For the purpose of
OCB, the AS shall evaluate the \"cp:identity\" and \"ocp:external-list\"
conditions against the called party identity taken from Request-URI or
additionally taken from the To header field.
When the AS providing the OCB service rejects a communication, the AS shall
send an indication to the calling user by sending a 603 (Decline) response
Additionally, before terminating the communication the AS can provide an
announcement to the originating user. The procedure of invoking an
announcement is described within 3GPP TS 24.628 [10].
[TS 24.611, clause 4.9.1.4]:
**roaming:** This condition evaluates to true when the served user is
registered from an access network other than the served users home network.
NOTE 3: Whether the served user is registered from another network then the
served users home network can be determined from the P-Visited-Network-ID
header field specified in IETF RFC 7315 [15] and the P-Access-Network-Info
header field specified in IETF RFC 7315 [15] both are provided during the
registration process, see 3GPP TS 24.229 [2], clause 5.7.1.3.
**rule-deactivated:** This condition always evaluates to false. This can be
used to deactivate a rule, without losing information. By removing this
condition the rule can be activated again.
**...**
**international:** This condition evaluates to true when the request URI of
the outgoing SIP request:
\- corresponds to a telephone number, i.e. a SIP URI with a \"user\" URI
parameter set to \"phone\" or a tel URI; and
\- does not point to a destination served by a network within the country
where the originating user is located when initiating the communication.
##### 8.24.3 Test description {#test-description-57 .H6}
##### 8.24.3.1 Pre-test conditions {#pre-test-conditions-57 .H6}
##### System Simulator: {#system-simulator-58 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-60 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-60 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.24.3.2 Test procedure sequence {#test-procedure-sequence-57 .H6}
Table 8.24.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service OCB intl roam. - - -
- 2-5b Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.24.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service OCB intl roam. - - - - 8-8b Check: Does
the UE perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.24.3.3-3? - - 3 P
##### 8.24.3.3 Specific message contents {#specific-message-contents-56 .H6}
Table 8.24.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.24.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\ list of conditions not containing a \
element
\
\
\
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.24.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
## **8.25 Barring of Incoming Calls / When Roaming / Configuration / 5GS**
##### 8.25.1 Test Purpose (TP) {#test-purpose-tp-58 .H6}
##### (1) {#section-174 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to activate Barring of Incoming Calls When Roaming (ICB
roam) }
**then** { UE authenticates itself using GBA or Digest }
}
##### (2) {#section-175 .H6}
**with** { UE having started authentication }
**ensure** **that** {
**when** { UE receives 200 OK concluding the authentication }
**then** { UE sends HTTP request to activate ICB roam }
}
##### (3) {#section-176 .H6}
**with** { UE having concluded activation of ICB roam }
**ensure** **that** {
**when** { UE is made to de-activate ICB roam }
**then** { UE sends HTTP request to de-activate ICB roam }
}
##### 8.25.2 Conformance Requirements {#conformance-requirements-59 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.611, clause 4.2.1]:
The Incoming Communication Barring (ICB**)** service makes it possible for a
user to have barring of certain categories of incoming communications
according to a provisioned or user configured barring program and is valid for
all incoming communications. A barring program is expressed as a set of rules
in which the rules have a conditional part and an action part. Examples of
conditions are whether the asserted originating public user identity matches a
specific public user identity or whether the originating public user identity
is restricted (anonymous). The action part could specify for a rule that
contains a matching condition that the specific incoming communication is
barred. The complete set of conditions and actions that apply to this service
and their semantics is described in subclause 4.9.
[TS 24.611, clause 4.9.1.4]:
**roaming:** This condition evaluates to true when the served user is
registered from an access network other than the served users home network.
NOTE 3: Whether the served user is registered from another network then the
served users home network can be determined from the P-Visited-Network-ID
header field specified in IETF RFC 7315 [15] and the P-Access-Network-Info
header field specified in IETF RFC 7315 [15] both are provided during the
registration process, see 3GPP TS 24.229 [2], clause 5.7.1.3.
##### 8.25.3 Test description {#test-description-58 .H6}
##### 8.25.3.1 Pre-test conditions {#pre-test-conditions-58 .H6}
##### System Simulator: {#system-simulator-59 .H6}
\- SS is configured with shared secret key of IMS AKA algorithm, related to
the IMS private user identity (IMPI) configured on the UICC card equipped into
the UE.
\- SS is listening to SIP default port 5060 for both UDP and TCP protocols.
\- At the SS, a HTTP Server is established at port 80 to simulate the XCAP
server
\- 1 NR Cell
##### UE: {#ue-61 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- UE is configured with the name of the XCAP root directory on the XCAP
server and the user\'s directory name.
\- UE has activated an IPCAN bearer with SS.
##### Preamble: {#preamble-61 .H6}
\- The steps 0a and 0b of Annex A.21 have been executed
\- During these procedures the UE may request a DNS server address via NAS
signalling and as parallel behaviour the UE may resolve the IP address of the
XCAP server via DNS.
##### 8.25.3.2 Test procedure sequence {#test-procedure-sequence-58 .H6}
Table 8.25.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                 U - S              Message
1 UE is triggered for activation of supplementary service ICB roam. - - - -
2-5b Check: Does the UE perform steps 2-5b of the generic test procedure for
activation of Supplementary Services according to annex A.21? - - 1 - 6 Check:
Does the Simservs document stored in the SS contain the information supplied
by UE as according to table 8.25.3.3-2? - - 2 P 7 UE is triggered for
deactivation of supplementary service ICB roam. - - - - 8-8b Check: Does the
UE perform steps 8-8b of the generic test procedure for activation of
Supplementary Services according to annex A.21? - - 3 - 9 Check: Does the
Simservs document stored in the SS contain the information supplied by UE as
according to table 8.25.3.3-3? - - 3 P
##### 8.25.3.3 Specific message contents {#specific-message-contents-57 .H6}
Table 8.25.3.3-1: Simservs document (step 4)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.25.3.3-2: Simservs document (step 6)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\ list of conditions not containing a \
element
\
\
\
\
\**false** \
\
\
\
\
\
* * *
Table 8.25.3.3-3: Simservs document (step 9)
* * *
Derivation Path: TS 24.611 clause 4.9.2
* * *
**Content** **Further restrictions/Comments**
\
\ the \"active\" attribute
may not be present but if present it is set to \"true\"
\
\
\
\
\ containing a \ element
\
\
\**false** \
\
\
\
\
\
* * *
## 8.26 MO Voice Call Hold without announcement / 5GS
##### 8.26.1 Test Purpose (TP) {#test-purpose-tp-59 .H6}
##### (1) {#section-177 .H6}
**with** { UE being registered to IMS and being configured to use
preconditions and having set up a voice call }
**ensure** **that** {
**when** { UE is being made to hold the call }
**then** { UE sends re-INVITE or UPDATE, and completes the call hold procedure
}
}
##### (2) {#section-178 .H6}
**with** { UE having put the voice call on hold }
**ensure** **that** {
**when** { UE is being made to resume the call }
**then** { UE sends re-INVITE or UPDATE, and completes the call resume
procedure }
}
##### 8.26.2 Conformance Requirements {#conformance-requirements-60 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.610 clause 4.5.2.1]:
In addition to the application of procedures according to 3GPP TS 24.229 [1],
the following procedures shall be applied at the invoking UE in accordance
with RFC 3264 [4].
A UE shall not invoke the HOLD service on a dialog associated with an
emergency call the UE has initiated.
If not all the media streams are affected, the invoking UE shall generate a
new SDP offer where:
1) for each media stream that is to be held, the SDP offer contains:
\- an \"inactive\" SDP attribute if the stream was previously set to
\"recvonly\"; or
\- a \"sendonly\" SDP attribute if the stream was previously set to
\"sendrecv\";
NOTE 1: If the directionality attribute of the media stream is currently
\"sendonly\" or \"inactive\", then that media stream is not put on hold and,
in the SDP offer, the directionality for that media stream remains unchanged.
2) for each held media stream that is to be resumed, the SDP offer contains:
\- a \"recvonly\" SDP attribute if the stream was previously an inactive media
stream; or
\- a \"sendrecv\" SDP attribute if the stream was previously a sendonly media
stream, or the attribute may be omitted, since sendrecv is the default; and
3) for each media stream that is unaffected, the media parameters in the SDP
offer remain unchanged from the previous SDP.
If all the media streams are to be held:
\- if they all have identical directionality, the invoking UE shall generate
an SDP offer containing a session level direction attribute, or separate media
level direction attributes, in the SDP that is set to:
1) \"inactive\" if the streams were previously set to \"recvonly\"; or
2) \"sendonly\" if the streams were previously set to \"sendrecv\"; and
NOTE 2: If the directionality attribute of all the media streams is currently
\"sendonly\" or \"inactive\", then all these media streams are not put on hold
and, in the SDP offer, the directionality for these media streams will remain
unchanged.
\- if they all do not have identical directionality, then for each media
stream in the session, the invoking UE shall follow the procedure listed above
for individual media streams.
If all the media streams were previously on hold and are to be resumed:
\- if they all have identical directionality, the invoking UE shall generate a
session level direction attribute, or separate media level direction
attributes, in the SDP that is set to:
1) \"recvonly\" if the streams were previously inactive media streams; or
2) \"sendrecv\" if the streams were previously sendonly media streams, or the
attribute may be omitted, since sendrecv is the default; and
\- if they all do not have identical directionality, then for each media
stream in the session, the invoking UE shall follow the procedure listed above
for individual media streams.
If, in the generated SDP offer, there is at least one media stream whose
directionality has changed from the previous SDP, the UE shall send the
generated SDP offer in a re-INVITE request (or UPDATE request) to the remote
UE.
[TS 26.114 clause 7.3.1]:
RTCP packets should be sent for all types of multimedia sessions to enable
synchronization with other RTP transported media, remote end-point aliveness
information, monitoring of the transmission quality, and carriage of feedback
messages such as TMMBR for video and RTCP APP for speech. The RR value should
be set greater than zero to enable RTCP packets to be sent when media is put
on hold and during active RTP media transmission, including real-time text
sessions which may have infrequent RTP media transmissions.
[TS 24.229 clause 6.1.1]:
If the media line in the SDP message body indicates the usage of RTP/RTCP, and
if the UE is configured to request an RTCP bandwidth level for the session is
different than the default RTCP bandwidth as specified in RFC 3556 [56], then
in addition to the \"AS\" bandwidth modifier in the media-level \"b=\" line,
the UE shall include two media-level \"b=\" lines, one with the \"RS\"
bandwidth modifier and the other with the \"RR\" bandwidth modifier as
described in RFC 3556 [56] to specify the required bandwidth allocation for
RTCP. The bandwidth-value in the b=RS: and b=RR: lines may include transport
overhead as described in subclause 6.1 of RFC 3890 [152].
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in or 3GPP 29.213 [13C].
NOTE 3: In a two-party session where both participants are active, the RTCP
receiver reports are not sent, therefore, the RR bandwidth modifier will
typically get the value of zero.
##### 8.26.3 Test description {#test-description-59 .H6}
##### 8.26.3.1 Pre-test conditions {#pre-test-conditions-59 .H6}
##### System Simulator: {#system-simulator-60 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-62 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions
##### Preamble: {#preamble-62 .H6}
\- The UE has registered to IMS and set up the MO call, by executing the
generic test procedure in Annex A.2 up to the last step and thereafter
executing the generic test procedure in A.4.1a.
##### 8.26.3.2 Test procedure sequence {#test-procedure-sequence-59 .H6}
Table 8.26.3.2-1: Main Behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +----+--------------+--------------+--------------+---------+----+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 1 | The UE is | - | - | | | | | made to hold | | | | | | | the call | | | | | +----+--------------+--------------+--------------+---------+----+ | 2 | Check: Does | --> | INVITE or | 1 | P | | | the UE send | | UPDATE | | | | | INVITE or | | | | | | | UPDATE with | | | | | | | a SDP offer | | | | | | | to hold the | | | | | | | call? | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.17) | | | | | +----+--------------+--------------+--------------+---------+----+ | 3 | The SS | \ | ACK | | | | | sent INVITE | | | | | | | in step 1 | | | | | | | then UE | | | | | | | acknowledges | | | | | | | the receipt | | | | | | | of 200 OK | | | | | | | for INVITE. | | | | | | | (Step 4 of | | | | | | | Annex A.17) | | | | | +----+--------------+--------------+--------------+---------+----+ | 6 | The UE is | - | - | | | | | made to | | | | | | | resume the | | | | | | | call | | | | | +----+--------------+--------------+--------------+---------+----+ | 7 | Check: Does | --> | INVITE or | 2 | P | | | the UE send | | UPDATE | | | | | INVITE or | | | | | | | UPDATE with | | | | | | | a SDP offer | | | | | | | to resume | | | | | | | the call? | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.17) | | | | | +----+--------------+--------------+--------------+---------+----+ | 8 | The SS | \ | ACK | | | | | the UE sent | | | | | | | INVITE in | | | | | | | step 1 then | | | | | | | UE | | | | | | | acknowledges | | | | | | | the receipt | | | | | | | of 200 OK | | | | | | | for INVITE. | | | | | | | (Step 4 of | | | | | | | Annex A.17) | | | | | +----+--------------+--------------+--------------+---------+----+ | 11 | The SS | \ | 200 OK | - | - | | | 200 OK for | | | | | | | BYE. | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.8) | | | | | +----+--------------+--------------+--------------+---------+----+
##### 8.26.3.3 Specific message contents {#specific-message-contents-58 .H6}
None as fully specified in Annex A.17 and Annex A.8.
## 8.27 MO Video Call Hold without announcement / 5GS
##### 8.27.1 Test Purpose (TP) {#test-purpose-tp-60 .H6}
##### (1) {#section-179 .H6}
**with** { UE being registered to IMS and being registered to use
preconditions and having set up a video call }
**ensure** **that** {
**when** { UE is being made to hold the call }
**then** { UE sends re-INVITE or UPDATE, and completes the call hold procedure
}
}
##### (2) {#section-180 .H6}
**with** { UE having put the video call on hold }
**ensure** **that** {
**when** { UE is being made to resume the call }
**then** { UE sends re-INVITE or UPDATE, and completes the call resume
procedure }
}
##### 8.27.2 Conformance Requirements {#conformance-requirements-61 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.610 clause 4.5.2.1]:
In addition to the application of procedures according to 3GPP TS 24.229 [1],
the following procedures shall be applied at the invoking UE in accordance
with RFC 3264 [4].
A UE shall not invoke the HOLD service on a dialog associated with an
emergency call the UE has initiated.
If not all the media streams are affected, the invoking UE shall generate a
new SDP offer where:
1) for each media stream that is to be held, the SDP offer contains:
\- an \"inactive\" SDP attribute if the stream was previously set to
\"recvonly\"; or
\- a \"sendonly\" SDP attribute if the stream was previously set to
\"sendrecv\";
NOTE 1: If the directionality attribute of the media stream is currently
\"sendonly\" or \"inactive\", then that media stream is not put on hold and,
in the SDP offer, the directionality for that media stream remains unchanged.
2) for each held media stream that is to be resumed, the SDP offer contains:
\- a \"recvonly\" SDP attribute if the stream was previously an inactive media
stream; or
\- a \"sendrecv\" SDP attribute if the stream was previously a sendonly media
stream, or the attribute may be omitted, since sendrecv is the default; and
3) for each media stream that is unaffected, the media parameters in the SDP
offer remain unchanged from the previous SDP.
If all the media streams are to be held:
\- if they all have identical directionality, the invoking UE shall generate
an SDP offer containing a session level direction attribute, or separate media
level direction attributes, in the SDP that is set to:
1) \"inactive\" if the streams were previously set to \"recvonly\"; or
2) \"sendonly\" if the streams were previously set to \"sendrecv\"; and
NOTE 2: If the directionality attribute of all the media streams is currently
\"sendonly\" or \"inactive\", then all these media streams are not put on hold
and, in the SDP offer, the directionality for these media streams will remain
unchanged.
\- if they all do not have identical directionality, then for each media
stream in the session, the invoking UE shall follow the procedure listed above
for individual media streams.
If all the media streams were previously on hold and are to be resumed:
\- if they all have identical directionality, the invoking UE shall generate a
session level direction attribute, or separate media level direction
attributes, in the SDP that is set to:
1) \"recvonly\" if the streams were previously inactive media streams; or
2) \"sendrecv\" if the streams were previously sendonly media streams, or the
attribute may be omitted, since sendrecv is the default; and
\- if they all do not have identical directionality, then for each media
stream in the session, the invoking UE shall follow the procedure listed above
for individual media streams.
If, in the generated SDP offer, there is at least one media stream whose
directionality has changed from the previous SDP, the UE shall send the
generated SDP offer in a re-INVITE request (or UPDATE request) to the remote
UE.
[TS 26.114 clause 7.3.1]:
RTCP packets should be sent for all types of multimedia sessions to enable
synchronization with other RTP transported media, remote end-point aliveness
information, monitoring of the transmission quality, and carriage of feedback
messages such as TMMBR for video and RTCP APP for speech. The RR value should
be set greater than zero to enable RTCP packets to be sent when media is put
on hold and during active RTP media transmission, including real-time text
sessions which may have infrequent RTP media transmissions.
[TS 24.229 clause 6.1.1]:
If the media line in the SDP message body indicates the usage of RTP/RTCP, and
if the UE is configured to request an RTCP bandwidth level for the session is
different than the default RTCP bandwidth as specified in RFC 3556 [56], then
in addition to the \"AS\" bandwidth modifier in the media-level \"b=\" line,
the UE shall include two media-level \"b=\" lines, one with the \"RS\"
bandwidth modifier and the other with the \"RR\" bandwidth modifier as
described in RFC 3556 [56] to specify the required bandwidth allocation for
RTCP. The bandwidth-value in the b=RS: and b=RR: lines may include transport
overhead as described in subclause 6.1 of RFC 3890 [152].
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in or 3GPP 29.213 [13C].
NOTE 3: In a two-party session where both participants are active, the RTCP
receiver reports are not sent, therefore, the RR bandwidth modifier will
typically get the value of zero.
##### 8.27.3 Test description {#test-description-60 .H6}
##### 8.27.3.1 Pre-test conditions {#pre-test-conditions-60 .H6}
##### System Simulator: {#system-simulator-61 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-63 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions
##### Preamble: {#preamble-63 .H6}
\- The UE has registered to IMS and set up the MO Video call, by executing the
generic test procedure in Annex A.2 up to the last step and thereafter
executing the generic test procedure in A.15.1a.
##### 8.27.3.2 Test procedure sequence {#test-procedure-sequence-60 .H6}
Table 8.27.3.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | The UE is | - | - | - | - | | | made to | | | | | | | hold the | | | | | | | call | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2 | Check: Does | --> | INVITE or | 1 | P | | | the UE send | | UPDATE | | | | | INVITE or | | | | | | | UPDATE with | | | | | | | a SDP offer | | | | | | | to hold the | | | | | | | call? | | | | | | | | | | | | | | (step 1 in | | | | | | | annex A.24) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 3-5 | Steps 2-4 | - | - | - | - | | | in annex | | | | | | | A.24 are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 6 | The UE is | - | - | - | - | | | made to | | | | | | | resume the | | | | | | | call | | | | | +-------+-------------+-------------+-------------+---------+----+ | 7 | Check: Does | --> | INVITE or | 2 | P | | | the UE send | | UPDATE | | | | | INVITE or | | | | | | | UPDATE with | | | | | | | a SDP offer | | | | | | | to resume | | | | | | | the call? | | | | | | | | | | | | | | (step 1 in | | | | | | | annex A.24) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 8-10 | Steps 2-4 | - | - | - | - | | | in annex | | | | | | | A.24 are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 11 | The UE is | - | - | - | - | | | made to | | | | | | | release the | | | | | | | call | | | | | +-------+-------------+-------------+-------------+---------+----+ | 12-13 | UE releases | - | - | - | - | | | the call\ | | | | | | | (Annex A.7) | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 8.27.3.3 Specific message contents {#specific-message-contents-59 .H6}
None as fully described in Annex A.24.
## 8.28 MT Voice Call Hold without announcement / 5GS
##### 8.28.1 Test Purpose (TP) {#test-purpose-tp-61 .H6}
##### (1) {#section-181 .H6}
**with** { UE being registered to IMS being configured to using preconditions
and having set up an MO voice call }
**ensure** **that** {
**when** { UE receives re-INVITE including call hold instructions }
**then** { UE may send 100 Trying and sends 200 OK for re-INVITE }
}
##### (2) {#section-182 .H6}
**with** { UE having responded to re-INVITE for call hold }
**ensure** **that** {
**when** { UE receives ACK followed by re-INVITE including call resume
instructions }
**then** { UE may send 100 Trying and sends 200 OK for re-INVITE }
}
##### (3) {#section-183 .H6}
**with** { UE having concluded the call resume procedure }
**ensure** **that** {
**when** { UE is being made to release the call }
**then** { UE sends BYE }
}
##### 8.28.2 Conformance Requirements {#conformance-requirements-62 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.610 clause 4.5.2.9]:
3GPP TS 24.229 [1] shall apply.
[TS 26.114 clause 7.3.1]:
RTCP packets should be sent for all types of multimedia sessions to enable
synchronization with other RTP transported media, remote end-point aliveness
information, monitoring of the transmission quality, and carriage of feedback
messages such as TMMBR for video and RTCP APP for speech. The RR value should
be set greater than zero to enable RTCP packets to be sent when media is put
on hold and during active RTP media transmission, including real-time text
sessions which may have infrequent RTP media transmissions.
[TS 24.229 clause 6.1.1]:
If the media line in the SDP message body indicates the usage of RTP/RTCP, and
if the UE is configured to request an RTCP bandwidth level for the session is
different than the default RTCP bandwidth as specified in RFC 3556 [56], then
in addition to the \"AS\" bandwidth modifier in the media-level \"b=\" line,
the UE shall include two media-level \"b=\" lines, one with the \"RS\"
bandwidth modifier and the other with the \"RR\" bandwidth modifier as
described in RFC 3556 [56] to specify the required bandwidth allocation for
RTCP. The bandwidth-value in the b=RS: and b=RR: lines may include transport
overhead as described in subclause 6.1 of RFC 3890 [152].
For other media streams the \"b=\" media descriptor may be included. The value
or absence of the \"b=\" parameter will affect the assigned QoS which is
defined in or 3GPP 29.213 [13C].
NOTE 3: In a two-party session where both participants are active, the RTCP
receiver reports are not sent, therefore, the RR bandwidth modifier will
typically get the value of zero.
##### 8.28.3 Test description {#test-description-61 .H6}
##### 8.28.3.1 Pre-test conditions {#pre-test-conditions-61 .H6}
##### System Simulator: {#system-simulator-62 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-64 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-64 .H6}
\- The UE has registered to IMS and set up the MO call, by executing the
generic test procedure in Annex A.2 up to the last step and thereafter
executing the generic test procedure in A.4.1a.
##### 8.28.3.2 Test procedure sequence {#test-procedure-sequence-61 .H6}
Table 8.28.3.2-1: Main Behaviour
+----+--------------+--------------+------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +----+--------------+--------------+------------+---------+----+ | | | U - S | Message | | | +----+--------------+--------------+------------+---------+----+ | 1 | SS sends | \ | 100 Trying | - | - | | | The UE | | | | | | | responds | | | | | | | with a 100 | | | | | | | Trying | | | | | | | provisional | | | | | | | response | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.18) | | | | | +----+--------------+--------------+------------+---------+----+ | 3 | Check: Does | --> | 200 OK | 1 | P | | | the UE | | | | | | | respond to | | | | | | | INVITE with | | | | | | | 200 OK to | | | | | | | indicate | | | | | | | that the UE | | | | | | | is no more | | | | | | | expecting to | | | | | | | receive any | | | | | | | media? | | | | | | | | | | | | | | (Step 3 of | | | | | | | Annex A.18) | | | | | +----+--------------+--------------+------------+---------+----+ | 4 | The SS | \ | 100 Trying | - | - | | | The UE | | | | | | | responds | | | | | | | with a 100 | | | | | | | Trying | | | | | | | provisional | | | | | | | response | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.18) | | | | | +----+--------------+--------------+------------+---------+----+ | 7 | Check: Does | --> | 200 OK | 2 | P | | | the UE | | | | | | | respond to | | | | | | | INVITE with | | | | | | | 200 OK to | | | | | | | indicate | | | | | | | that the UE | | | | | | | is no more | | | | | | | expecting to | | | | | | | receive any | | | | | | | media? | | | | | | | | | | | | | | (Step 3 of | | | | | | | Annex A.18) | | | | | +----+--------------+--------------+------------+---------+----+ | 8 | The SS | \ | BYE | 3 | P | | | the UE send | | | | | | | BYE to | | | | | | | release the | | | | | | | call? | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.7) | | | | | +----+--------------+--------------+------------+---------+----+ | 11 | The SS sends | \ | 100 Trying | - | - | | | The UE | | | | | | | responds | | | | | | | with a 100 | | | | | | | Trying | | | | | | | provisional | | | | | | | response. | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.28) | | | | | +----+--------------+--------------+------------+---------+----+ | 3 | Check: Does | --> | 200 OK | 1 | P | | | the UE | | | | | | | respond to | | | | | | | INVITE with | | | | | | | 200 OK to | | | | | | | indicate | | | | | | | that the UE | | | | | | | is no more | | | | | | | expecting to | | | | | | | receive any | | | | | | | media? | | | | | | | | | | | | | | (Step 3 of | | | | | | | Annex A.28) | | | | | +----+--------------+--------------+------------+---------+----+ | 4 | The SS | \ | 100 Trying | - | - | | | The UE | | | | | | | responds | | | | | | | with a 100 | | | | | | | Trying | | | | | | | provisional | | | | | | | response. | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.28) | | | | | +----+--------------+--------------+------------+---------+----+ | 7 | Check: Does | --> | 200 OK | 2 | P | | | the UE | | | | | | | respond to | | | | | | | INVITE with | | | | | | | 200 OK to | | | | | | | indicate | | | | | | | that the UE | | | | | | | resumes | | | | | | | sending | | | | | | | media (call | | | | | | | resume)? | | | | | | | | | | | | | | (Step 3 of | | | | | | | Annex A.28) | | | | | +----+--------------+--------------+------------+---------+----+ | 8 | The SS | \ | BYE | 3 | P | | | the UE send | | | | | | | BYE to | | | | | | | release the | | | | | | | call? | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.7) | | | | | +----+--------------+--------------+------------+---------+----+ | 11 | The SS sends | \ SUBSCRIBE 1 P 2 The SS responds SUBSCRIBE with 200 OK \ SUBSCRIBE - -
4 The SS responds with 200 OK \ 200 OK 2 P 7 The SS sends another
NOTIFY for Message Waiting Indication event package, now referring to one
voice message waiting \ 200 OK 3 P 9 The SS sends initial NOTIFY for registration
event package, containing full registration state information for the
registered public user identity in the XML body \ 200 OK 4 P
* * *
##### 8.30.3.3 Specific message contents {#specific-message-contents-62 .H6}
Table 8.30.3.3-1: SUBSCRIBE (step 1, table 8.30.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.6.1, Conditions A1, A6
* * *
Table 8.30.3.3-2: 200 OK for SUBSCRIBE (step 2/4, table 8.30.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.1.5, Condition A1
* * *
Table 8.30.3.3-3: SUBSCRIBE (step 3, table 8.30.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.1.4, Conditions A1, A7
* * *
Table 8.30.3.3-4: NOTIFY for Message Waiting Indication package (step 5, table
8.30.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.6.2, Condition A1
* * *
Table 8.30.3.3-5: 200 OK (step 6/8/10, table 8.30.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A5, A11, A22
* * *
Table 8.30.3.3-6: NOTIFY for Message Waiting Indication package (step 7/9,
table 8.30.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Annex A.6.2, | | | | | | Condition A1 | | | | | +=====================+======+=====================+=====+===========+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | > Message-body | | _Messages-Waiting: | | | | | | yes_ | | | | | | | | | | | | _Message-Account:_ | | | | | | same IMPU as in | | | | | | From header | | | | | | | | | | | | _Voice-Message: 1/0 | | | | | | (0/0)_ | | | | | | | | | | | | _To: \  | | | | | | | | | | | | _From: | | | | | | \ _ | | | | | | | | | | | | _Subject: call me | | | | | | back!_ | | | | | | | | | | | | _Date: Fri 05 Feb | | | | | | 2021 14:24 +0100_ | | | | | | | | | | | | _Priority: urgent_ | | | | | | | | | | | | _Message-ID: | | | | | | 27775334485@_ home | | | | | | domain name | | | | | | | | | | | | _Message-Context: | | | | | | voice-message_ | | | +---------------------+------+---------------------+-----+-----------+
Table 8.30.3.3-7: NOTIFY for reg-event package (step 8, table 8.30.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.1.6, Condition A1
* * *
## 8.31 Creating and leaving a conference / 5GS
##### 8.31.1 Test Purpose (TP) {#test-purpose-tp-64 .H6}
##### (1) {#section-191 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to start a conference call }
**then** { UE sends INVITE to the conference factory and completes the
conference call initiation and subscribes to conference event }
}
##### (2) {#section-192 .H6}
**with** { Conference call going on }
**ensure** **that** {
**when** { UE is made to leave the call }
**then** { UE sends BYE and processes notification for conf event if any }
}
##### 8.31.2 Conformance Requirements {#conformance-requirements-65 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.147, clause 5.3.1.3.1]:
A conference can be created by means of SIP, as described in subclause
5.3.1.3.2 or subclause 5.3.1.3.3.
NOTE: Additionally, creation of a conference can be provided by other means.
The conference participant shall make use of the procedures for session
establishment as described in subclauses 5.1.2A and 5.1.3 of 3GPP TS 24.229
[5] when creating conferences by means of SIP.
[TS 24.147, clause 5.3.1.3.2]:
Upon a request to create a conference with a conference factory URI, the
conference participant shall:
1) generate an initial INVITE request in accordance with subclause 5.1.3.1 of
3GPP TS 24.229 [5]; and
2) set the request URI of the INVITE request to the conference factory URI.
On receiving a 200 (OK) response to the INVITE request with the \"isfocus\"
feature parameter indicated in Contact header, the conference participant
shall store the content of the received Contact header as the conference URI.
In addition to this, the conference participant may subscribe to the
conference event package as described in RFC 4575 [11] by using the stored
conference URI.
NOTE 1: A conference participant can decide not to subscribe to the conference
event package for conferences with a large number of attendees, due to, e.g.
the signalling traffic caused by the notifications about users joining or
leaving the conference.
NOTE 2: A conference can also be created with a conference URI. The procedures
for this case at the conference participant are identical to those for joining
a conference, as described in subclause 5.3.1.4.1. It is not assumed that the
conference participant is aware that the conference gets created in this case.
NOTE 3: The UE can discover the conference factory URI from the Management
Object as defined in 3GPP TS 24.166 [38]. Further discovery mechanisms for the
conference factory URI are outside the scope of the present document.
##### 8.31.3 Test description {#test-description-64 .H6}
##### 8.31.3.1 Pre-test conditions {#pre-test-conditions-64 .H6}
##### System Simulator: {#system-simulator-65 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-67 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-67 .H6}
\- The UE is in test state 1N-A (TS 38.508-1) and registered to IMS.
##### 8.31.3.2 Test procedure sequence {#test-procedure-sequence-64 .H6}
Table 8.31.3.2-1: Main Behaviour
+-------+---------------+---------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+---------------+---------------+---------+---------+----+ | | | U - S | Message | | | +-------+---------------+---------------+---------+---------+----+ | 1 | Make the UE | - | - | - | - | | | attempt an | | | | | | | IMS | | | | | | | Conference | | | | | | | call | | | | | +-------+---------------+---------------+---------+---------+----+ | 2 | Check: Does | --> | INVITE | 1 | P | | | the UE send | | | | | | | INVITE with | | | | | | | the first SDP | | | | | | | offer? | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.19) | | | | | +-------+---------------+---------------+---------+---------+----+ | 3-14 | UE and SS | - | - | - | - | | | continue the | | | | | | | procedures of | | | | | | | conference | | | | | | | call. (Steps | | | | | | | 2-13 of annex | | | | | | | A.19) | | | | | +-------+---------------+---------------+---------+---------+----+ | | EXCEPTION: | - | - | - | - | | | steps 11 -- | | | | | | | 14 | | | | | | | (conference | | | | | | | event | | | | | | | subscription) | | | | | | | describe | | | | | | | optional | | | | | | | behaviour | | | | | | | depending on | | | | | | | UE | | | | | | | c | | | | | | | onfiguration. | | | | | | | The SS shall | | | | | | | wait up to 3s | | | | | | | for the | | | | | | | SUBSCRIBE of | | | | | | | step 11 | | | | | +-------+---------------+---------------+---------+---------+----+ | 15 | The UE is | - | - | - | - | | | made to leave | | | | | | | the | | | | | | | conference | | | | | +-------+---------------+---------------+---------+---------+----+ | 16 | The UE leaves | --> | BYE | 2 | P | | | the | | | | | | | conference | | | | | | | with BYE | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.27) | | | | | +-------+---------------+---------------+---------+---------+----+ | 17-19 | The SS and UE | - | - | - | - | | | continue to | | | | | | | finish the | | | | | | | procedures of | | | | | | | leaving a | | | | | | | conference. | | | | | | | | | | | | | | (Steps 2-4 of | | | | | | | annex A.27) | | | | | +-------+---------------+---------------+---------+---------+----+
##### 8.31.3.3 Specific message contents {#specific-message-contents-63 .H6}
None as fully specified in annex A.19 and A.27.
## 8.32 Inviting user to conference by sending a REFER request to the
conference focus / 5GS
##### 8.32.1 Test Purpose (TP) {#test-purpose-tp-65 .H6}
##### (1) {#section-193 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to start a conference call }
**then** { UE sends INVITE to the conference factory and completes the
conference call initiation and subscribes to conference event }
}
##### (2) {#section-194 .H6}
**with** { Conference call going on }
**ensure** **that** {
**when** { UE is made to invite another user to the conference call }
**then** { UE sends REFER to the conference focus }
}
##### (3) {#section-195 .H6}
**with** { UE having invited another user to the conference call }
**ensure** **that** {
**when** { UE receives 202 Accepted followed by notification messages for the
REFER request, the confirmation on the other user and conditional conference
event package }
**then** { UE sends 200 OK for each received NOTIFY request }
}
##### (4) {#section-196 .H6}
**with** { Conference call going on }
**ensure** **that** {
**when** { UE is made to leave the call }
**then** { UE sends BYE and processes notification for conf event if any }
}
##### 8.32.2 Conformance Requirements {#conformance-requirements-66 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.147, clause 5.3.1.5.3]:
Upon generating a REFER request in accordance with the procedures specified in
3GPP TS 24.229 [5], IETF RFC 3515 [17] as updated by IETF RFC 6665 [10] and
IETF RFC 7647 [39] that is destined to the conference focus in order to invite
another user to a specific conference, the conference participant shall:
1) set the request URI of the REFER request to the conference URI to which the
user is invited to;
2) set the Refer-To header of the REFER request to the SIP URI or tel URL of
the user who is invited to the conference;
3) either include the \"method\" URI parameter with the value \"INVITE\" or
omit the \"method\" URI parameter in the Refer-To header; and
NOTE: Other headers of the REFER request will be set in accordance with 3GPP
TS 24.229 [5].
4) send the REFER request towards the conference focus that is hosting the
conference.
The UE may additionally include the Referred-By header to the REFER request
and set it to the URI of the conference participant that is sending the REFER
request.
In case of an active session the UE may additionally include the Replaces
header in the header portion of the SIP URI of the Refer-to header field of
the REFER request. If the user involved in the active session is identified by
a tel URI, the UE shall convert the tel URI to an SIP URI as described in RFC
3261 [7] before including the Replaces header field. The included Replaces
header field shall refer to the active dialog that is replaced by the ad-hoc
conference. The Replaces header field shall comply with RFC 3891 [33].
Afterwards the UE shall treat incoming NOTIFY requests that are related to the
previously sent REFER request in accordance with RFC 3515 [17] as updated by
RFC 6665 [10] and may indicate the received information to the user.
##### 8.32.3 Test description {#test-description-65 .H6}
##### 8.32.3.1 Pre-test conditions {#pre-test-conditions-65 .H6}
##### System Simulator: {#system-simulator-66 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
\- SS has performed AKAv1-MD5 authentication with the UE and accepted the
registration.
##### UE: {#ue-68 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-68 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 8.32.3.2 Test procedure sequence {#test-procedure-sequence-65 .H6}
Table 8.32.3.2-1: Main Behaviour
+-------+---------------+---------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+---------------+---------------+---------+---------+----+ | | | U - S | Message | | | +-------+---------------+---------------+---------+---------+----+ | 1 | The UE is | - | - | - | - | | | made to | | | | | | | attempt an | | | | | | | IMS | | | | | | | Conference | | | | | | | call | | | | | +-------+---------------+---------------+---------+---------+----+ | 2 | Check: Does | --> | INVITE | 1 | P | | | the UE send | | | | | | | INVITE with | | | | | | | the first SDP | | | | | | | offer? | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.19) | | | | | +-------+---------------+---------------+---------+---------+----+ | 3-14 | UE and SS | - | - | - | - | | | continue the | | | | | | | procedures of | | | | | | | conference | | | | | | | call. | | | | | | | | | | | | | | (Steps 2-13 | | | | | | | of annex | | | | | | | A.19) | | | | | +-------+---------------+---------------+---------+---------+----+ | 15 | The UE is | - | - | - | - | | | made to | | | | | | | invite | | | | | | | another user | | | | | | | to the | | | | | | | conference | | | | | +-------+---------------+---------------+---------+---------+----+ | 16 | The UE sends | --> | REFER | 2 | P | | | REFER to SS | | | | | | | referring to | | | | | | | the | | | | | | | conference | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.20) | | | | | +-------+---------------+---------------+---------+---------+----+ | 17-18 | The SS | - | - | - | - | | | responds with | | | | | | | a 202 final | | | | | | | response and | | | | | | | sends initial | | | | | | | NOTIFY for | | | | | | | the implicit | | | | | | | subscription | | | | | | | created by | | | | | | | the REFER | | | | | | | request. | | | | | | | | | | | | | | (Steps 2-3 of | | | | | | | annex A.20) | | | | | +-------+---------------+---------------+---------+---------+----+ | 19 | The UE | --> | 200 OK | 3 | P | | | responds the | | | | | | | NOTIFY with | | | | | | | 200 OK | | | | | | | | | | | | | | (Step 4 of | | | | | | | annex A.20) | | | | | +-------+---------------+---------------+---------+---------+----+ | 20 | The SS sends | \ | 200 OK | 3 | P | | | responds the | | | | | | | NOTIFY with | | | | | | | 200 OK | | | | | | | | | | | | | | (Step 6 of | | | | | | | annex A.20) | | | | | +-------+---------------+---------------+---------+---------+----+ | 22 | Conditional: | \ | 200 OK | 3 | P | | | The UE | | | | | | | responds the | | | | | | | NOTIFY with | | | | | | | 200 OK (if | | | | | | | NOTIFY sent | | | | | | | by SS) | | | | | | | | | | | | | | (Step 8 of | | | | | | | annex A.20) | | | | | +-------+---------------+---------------+---------+---------+----+ | 24 | The UE is | - | - | - | - | | | made to leave | | | | | | | the | | | | | | | conference | | | | | +-------+---------------+---------------+---------+---------+----+ | 25 | The UE sends | | BYE | 4 | P | | | BYE to leave | | | | | | | the | | | | | | | conference | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.27) | | | | | +-------+---------------+---------------+---------+---------+----+ | 26-28 | The SS and UE | - | - | - | - | | | continue to | | | | | | | finish the | | | | | | | procedures of | | | | | | | leaving a | | | | | | | conference. | | | | | | | | | | | | | | (Steps 2-4 of | | | | | | | annex A.27) | | | | | +-------+---------------+---------------+---------+---------+----+
##### 8.32.3.3 Specific message contents {#specific-message-contents-64 .H6}
None as fully specified in annex A.19, A.20 and A.27.
## 8.33 Inviting user to conference by sending a REFER request to the
conference focus / Video / 5GS
##### 8.33.1 Test Purpose (TP) {#test-purpose-tp-66 .H6}
##### (1) {#section-197 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to start a video conference call }
**then** { UE sends INVITE to the conference factory and completes the
conference call initiation and subscribes to conference event }
}
##### (2) {#section-198 .H6}
**with** { Video Conference call going on }
**ensure** **that** {
**when** { UE is made to invite another user to the conference call }
**then** { UE sends REFER to the conference focus }
}
##### (3) {#section-199 .H6}
**with** { UE having invited another user to the Video conference call }
**ensure** **that** {
**when** { UE receives 202 Accepted followed by notification messages for the
REFER request, the confirmation on the other user and conditional conference
event package }
**then** { UE sends 200 OK for each received NOTIFY request }
}
##### (4) {#section-200 .H6}
**with** {Video Conference call going on }
**ensure** **that** {
**when** { UE is made to leave the call }
**then** { UE sends BYE and processes notification for conf event if any }
}
##### 8.33.2 Conformance Requirements {#conformance-requirements-67 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.147, clause 5.3.1.5.3]:
Upon generating a REFER request in accordance with the procedures specified in
3GPP TS 24.229 [5], IETF RFC 3515 [17] as updated by IETF RFC 6665 [10] and
IETF RFC 7647 [39] that is destined to the conference focus in order to invite
another user to a specific conference, the conference participant shall:
1) set the request URI of the REFER request to the conference URI to which the
user is invited to;
2) set the Refer-To header of the REFER request to the SIP URI or tel URL of
the user who is invited to the conference;
3) either include the \"method\" URI parameter with the value \"INVITE\" or
omit the \"method\" URI parameter in the Refer-To header; and
NOTE: Other headers of the REFER request will be set in accordance with 3GPP
TS 24.229 [5].
4) send the REFER request towards the conference focus that is hosting the
conference.
The UE may additionally include the Referred-By header to the REFER request
and set it to the URI of the conference participant that is sending the REFER
request.
In case of an active session the UE may additionally include the Replaces
header in the header portion of the SIP URI of the Refer-to header field of
the REFER request. If the user involved in the active session is identified by
a tel URI, the UE shall convert the tel URI to an SIP URI as described in RFC
3261 [7] before including the Replaces header field. The included Replaces
header field shall refer to the active dialog that is replaced by the ad-hoc
conference. The Replaces header field shall comply with RFC 3891 [33].
Afterwards the UE shall treat incoming NOTIFY requests that are related to the
previously sent REFER request in accordance with RFC 3515 [17] as updated by
RFC 6665 [10] and may indicate the received information to the user.
##### 8.33.3 Test description {#test-description-66 .H6}
##### 8.33.3.1 Pre-test conditions {#pre-test-conditions-66 .H6}
##### System Simulator: {#system-simulator-67 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
\- SS has performed AKAv1-MD5 authentication with the UE and accepted the
registration.
##### UE: {#ue-69 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-69 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 8.33.3.2 Test procedure sequence {#test-procedure-sequence-66 .H6}
Table 8.33.3.2-1: Main Behaviour
+------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +------+-------------+-------------+-------------+---------+----+ | 1 | The UE is | - | - | - | - | | | made to | | | | | | | attempt an | | | | | | | IMS | | | | | | | Conference | | | | | | | call | | | | | +------+-------------+-------------+-------------+---------+----+ | 2 | The UE | --> | INVITE | 1 | P | | | sends | | | | | | | INVITE with | | | | | | | the first | | | | | | | SDP offer. | | | | | | | | | | | | | | (Step 1 in | | | | | | | annex A.25 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+ | 3-14 | Steps 2-13 | - | - | - | - | | | of annex | | | | | | | A.25 | | | | | | | happen. | | | | | +------+-------------+-------------+-------------+---------+----+ | 15 | The UE is | - | - | - | - | | | made to | | | | | | | invite | | | | | | | another | | | | | | | user to the | | | | | | | conference | | | | | +------+-------------+-------------+-------------+---------+----+ | 16 | The UE | --> | REFER | 2 | P | | | sends REFER | | | | | | | to SS | | | | | | | referring | | | | | | | to the | | | | | | | conference | | | | | | | | | | | | | | (Step 1 in | | | | | | | annex A.26 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+ | 17 | The SS | \ | 200 OK | 3 | P | | | responds | | | | | | | the NOTIFY | | | | | | | with 200 OK | | | | | | | | | | | | | | (Step 4 in | | | | | | | annex A.26 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+ | 20 | The SS | \ | 200 OK | 3 | P | | | responds | | | | | | | the NOTIFY | | | | | | | with 200 OK | | | | | | | | | | | | | | (Step 6 in | | | | | | | annex A.26 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+ | 22 | Optional: | \ | 200 OK | 3 | P | | | The UE | | | | | | | responds | | | | | | | the NOTIFY | | | | | | | with 200 OK | | | | | | | | | | | | | | (Step 8 in | | | | | | | annex A.26 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+ | 24 | The UE is | - | - | - | - | | | made to | | | | | | | leave the | | | | | | | conference | | | | | +------+-------------+-------------+-------------+---------+----+ | 25 | The UE | --> | BYE | 4 | P | | | sends BYE | | | | | | | to ler | | | | | | | leaving the | | | | | | | conference | | | | | | | | | | | | | | (Step 1 in | | | | | | | annex A.27 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+ | 26 | The SS | \ | NOTIFY | - | - | | | had | | | | | | | subscribed | | | | | | | to the | | | | | | | conference | | | | | | | event | | | | | | | package, | | | | | | | the SS | | | | | | | notifies | | | | | | | the UE that | | | | | | | its | | | | | | | s | | | | | | | ubscription | | | | | | | to | | | | | | | conference | | | | | | | event | | | | | | | package is | | | | | | | terminated | | | | | | | | | | | | | | (Step 3 in | | | | | | | annex A.27 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+ | 28 | The UE | --> | 200 OK | - | - | | | sends 200 | | | | | | | OK for | | | | | | | NOTIFY (if | | | | | | | sent by SS) | | | | | | | | | | | | | | (Step 4 in | | | | | | | annex A.27 | | | | | | | ) | | | | | +------+-------------+-------------+-------------+---------+----+
##### 8.33.3.3 Specific message contents {#specific-message-contents-65 .H6}
None as fully described in Annex A.25, A.26 and A.27.
## 8.34 Three way session creation / Voice / 5GS
##### 8.34.1 Test Purpose (TP) {#test-purpose-tp-67 .H6}
##### (1) {#section-201 .H6}
**with** { UE being registered to IMS and being configured to use
preconditions having set up an MO voice call with A }
**ensure** **that** {
**when** { UE is made to start a three way voice call }
**then** { UE sends re-INVITE or UPDATE, and completes the call hold procedure
with A }
}
##### (2) {#section-202 .H6}
**with** { UE being in the process of starting a three way voice call }
**ensure** **that** {
**when** { UE having put A on hold }
**then** { UE initiates a voice call with B }
}
##### (3) {#section-203 .H6}
**with** { UE being in the process of starting a three way voice call }
**ensure** **that** {
**when** { UE having initiated a voice call with B }
**then** { UE sends re-INVITE or UPDATE, and completes the call hold procedure
with B }
}
##### (4) {#section-204 .H6}
**with** { UE being in the process of starting a three way voice call }
**ensure** **that** {
**when** { UE having put both A and B on hold }
**then** { UE sends INVITE to the conference factory and completes the
conference call initiation and subscribes to conference event }
}
##### (5) {#section-205 .H6}
**with** { UE being in the process of starting a three way voice call }
**ensure** **that** {
**when** { UE having created a call at the conference factory }
**then** { UE sends REFER to the conference focus in order to invite A }
}
##### (6) {#section-206 .H6}
**with** { UE having invited A to the conference call }
**ensure** **that** {
**when** { UE receives 202 Accepted followed by notification messages for the
REFER request, the confirmation on A and conditional conference event package
}
**then** { UE sends 200 OK for each received NOTIFY request }
}
##### (7) {#section-207 .H6}
**with** { UE being in the process of starting a three way voice call }
**ensure** **that** {
**when** { UE having completed the invitation of A }
**then** { UE sends REFER to the conference focus in order to invite B }
}
##### (8) {#section-208 .H6}
**with** { UE having invited B to the conference call }
**ensure** **that** {
**when** { UE receives 202 Accepted followed by notification messages for the
REFER request, the confirmation on B and conditional conference event package
}
**then** { UE sends 200 OK for each received NOTIFY request }
}
##### 8.34.2 Conformance Requirements {#conformance-requirements-68 .H6}
When a user is participating in two or more SIP sessions and wants to join
together two of these active sessions to a so-called three-way session, the
user shall perform the following steps.
1) create a conference at the conference focus by sending an INVITE request
with the conference factory URI for the three-way session towards the
conference focus, as described in subclause 5.3.1.3.2;
2) decide and perform for each of the active sessions that are requested to be
joined to the three-way session, how the remote user shall be invited to the
three-way session, which can either be:
a) by performing the procedures for inviting a user to a conference by sending
an REFER request to the user, as described in subclause 5.3.1.5.2; or
b) by performing the procedures for inviting a user to a conference by sending
a REFER request to the conference focus, as described in subclause 5.3.1.5.3;
3) release the active session with the user, by applying the procedures for
session release in accordance with RFC 3261 [7], provided that a BYE request
has not already been received, after a NOTIFY request has been received,
indicating that the user has successfully joined the three-way session, i.e.
including:
a) a body of content-type \"message/sipfrag\" that indicates a \"200 OK\"
response; and,
b) a Subscription-State header set to the value \"terminated\"; and,
4) treat the created three-way session as a normal conference, i.e. the
conference participant shall apply the applicable procedures of subclause
5.3.1 for it.
Reference(s)
3GPP TS 24.147 [35] clause 5.3.1.3.3.
##### 8.34.3 Test description {#test-description-67 .H6}
##### 8.34.3.1 Pre-test conditions {#pre-test-conditions-67 .H6}
##### System Simulator: {#system-simulator-68 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-70 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-70 .H6}
\- The UE has registered to IMS and set up the MO voice call, by executing the
generic test procedure in Annex A.2 up to the last step and thereafter
executing the generic test procedure in A.4.1a.
##### 8.34.3.2 Test procedure sequence {#test-procedure-sequence-67 .H6}
Table 8.34.3.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+-------------+-------------+-------------+---------+----+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 0 | UE is made | - | - | - | - | | | to put the | | | | | | | first call | | | | | | | on hold. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 1-4 | Steps 1-4 | - | Messages in | 1 | P | | | of A.17 are | | Annex A.17 | | | | | used to put | | | | | | | the first | | | | | | | call on | | | | | | | hold. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 5 | UE is made | - | - | - | - | | | to initiate | | | | | | | a second | | | | | | | MTSI voice | | | | | | | call. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 6-10 | Steps 1-5 | - | Messages in | 2 | P | | | of A.4.1a | | Annex | | | | | are | | A.4.1a | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 11-12 | | | | | | | describes | | | | | | | behaviour | | | | | | | that takes | | | | | | | place if | | | | | | | the UE | | | | | | | doesn\'t | | | | | | | include QOS | | | | | | | c | | | | | | | onfirmation | | | | | | | in the | | | | | | | PRACK | | | | | | | message in | | | | | | | step 9. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 11 | UE sends a | --> | UPDATE | 2 | P | | | second SDP | | | | | | | offer in an | | | | | | | UPDATE | | | | | | | request. | | | | | | | | | | | | | | (Step 6 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 12 | SS responds | \ | REFER | 5 | P | | | REFER to | | | | | | | invite user | | | | | | | A to the | | | | | | | conference. | | | | | | | | | | | | | | (Step 1 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 37-38 | SS responds | - | - | - | - | | | with a 202 | | | | | | | final | | | | | | | response | | | | | | | and NOTIFY | | | | | | | for the | | | | | | | s | | | | | | | ubscription | | | | | | | created by | | | | | | | the REFER. | | | | | | | | | | | | | | (Steps 2-3 | | | | | | | of A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 39 | The UE | --> | 200 OK | 6 | P | | | responds | | | | | | | the NOTIFY | | | | | | | request | | | | | | | with 200 | | | | | | | OK. | | | | | | | | | | | | | | (Step 4 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 40 | SS responds | - | NOTIFY | - | - | | | with a | | | | | | | NOTIFY to | | | | | | | confirm the | | | | | | | user the | | | | | | | invited | | | | | | | user was | | | | | | | able to | | | | | | | join the | | | | | | | conference. | | | | | | | | | | | | | | (Steps 5 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 41 | UE responds | --> | 200 OK | 6 | P | | | the NOTIFY | | | | | | | request | | | | | | | with 200 OK | | | | | | | | | | | | | | (Steps 6 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 42-43 | C | - | - | - | - | | | onditional: | | | | | | | If the UE | | | | | | | has | | | | | | | subscribed | | | | | | | to the | | | | | | | conference | | | | | | | event | | | | | | | package, | | | | | | | then the SS | | | | | | | sends a | | | | | | | NOTIFY for | | | | | | | conference | | | | | | | event | | | | | | | package and | | | | | | | UE responds | | | | | | | with 200 | | | | | | | OK. | | | | | | | | | | | | | | (Steps 7-8 | | | | | | | of A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 44 | UE sends | --> | REFER | 7 | P | | | REFER to | | | | | | | invite user | | | | | | | B to the | | | | | | | conference. | | | | | | | | | | | | | | (Step 1 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 45-46 | SS responds | - | - | - | - | | | with a 202 | | | | | | | final | | | | | | | response | | | | | | | and NOTIFY | | | | | | | for the | | | | | | | s | | | | | | | ubscription | | | | | | | created by | | | | | | | the REFER. | | | | | | | | | | | | | | (Steps 2-3 | | | | | | | of A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 47 | The UE | --> | 200 OK | 8 | P | | | responds | | | | | | | the NOTIFY | | | | | | | request | | | | | | | with 200 | | | | | | | OK. | | | | | | | | | | | | | | (Step 4 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 48 | SS responds | - | NOTIFY | - | - | | | with a | | | | | | | NOTIFY to | | | | | | | confirm the | | | | | | | user the | | | | | | | invited | | | | | | | user was | | | | | | | able to | | | | | | | join the | | | | | | | conference. | | | | | | | | | | | | | | (Steps 5 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 49 | UE responds | --> | 200 OK | 8 | P | | | the NOTIFY | | | | | | | request | | | | | | | with 200 OK | | | | | | | | | | | | | | (Steps 6 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 50-51 | C | - | - | - | - | | | onditional: | | | | | | | If the UE | | | | | | | has | | | | | | | subscribed | | | | | | | to the | | | | | | | conference | | | | | | | event | | | | | | | package, | | | | | | | then the SS | | | | | | | sends a | | | | | | | NOTIFY for | | | | | | | conference | | | | | | | event | | | | | | | package and | | | | | | | UE responds | | | | | | | with 200 | | | | | | | OK. | | | | | | | | | | | | | | (Steps 7-8 | | | | | | | of A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 52-53 | Steps 1-2 | - | - | - | - | | | of A.7 are | | | | | | | used to | | | | | | | release the | | | | | | | first call. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 54-55 | Steps 1-2 | - | - | - | - | | | of A.7 are | | | | | | | used to | | | | | | | release the | | | | | | | second | | | | | | | call. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 56-57 | Steps 1-2 | - | - | - | - | | | of A.8 are | | | | | | | used to | | | | | | | release the | | | | | | | active | | | | | | | session. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 58 | C | \ | 200 OK | - | - | | | onditional: | | | | | | | If the SS | | | | | | | sent | | | | | | | NOTIFY, | | | | | | | then the UE | | | | | | | sends 200 | | | | | | | OK for | | | | | | | NOTIFY. | | | | | | | | | | | | | | (Steps 8 of | | | | | | | A.20) | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 8.34.3.3 Specific message contents {#specific-message-contents-66 .H6}
Table 8.34.3.3-1: INVITE (Step 6, table 8.34.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Table in subclause | | | | | | A.2.1, Conditions | | | | | | A1, A3, A5 and A28. | | | | | +---------------------+------+---------------------+-----+-----------+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | **Request-Line** | | | | | +---------------------+------+---------------------+-----+-----------+ | Request-URI | | px_IMS_CalleeUri2 | | | | | | | | | | | | px_IMS_CalleeUri2 | | | | | | is used to invite | | | | | | another user to the | | | | | | session. | | | | | | | | | | | | px_IMS_CalleeUri2 | | | | | | may be either SIP | | | | | | or Tel URI. It may | | | | | | contain a | | | | | | dialstring and | | | | | | phone-context | | | | | | parameter, when | | | | | | calling to | | | | | | dialstring. When | | | | | | calling to | | | | | | dialstring SIP URI | | | | | | must also contain | | | | | | user=phone or | | | | | | user=dialstring | | | | | | parameter. | | | | | | | | | | | | The dialstring, if | | | | | | used, may be | | | | | | global, home local | | | | | | number or geo-local | | | | | | number. For home | | | | | | local numbers the | | | | | | value of | | | | | | phone-context | | | | | | parameter must | | | | | | equal the home | | | | | | domain name i.e. | | | | | | px_I | | | | | | MS_HomeDomainName. | | | | | | For geo-local | | | | | | numbers the home | | | | | | domain name must be | | | | | | prefixed by string | | | | | | "geo-local." or | | | | | | access technology | | | | | | specific prefix, if | | | | | | the UE supports | | | | | | that option. | | | | | | | | | | | | Note: The way how | | | | | | the UE determines | | | | | | whether numbers in | | | | | | a non-international | | | | | | format are | | | | | | geo-local, | | | | | | home-local or | | | | | | relating to another | | | | | | network, is UE | | | | | | implementation | | | | | | specific. For | | | | | | instance the UE | | | | | | might have a UI | | | | | | setting. | | | +---------------------+------+---------------------+-----+-----------+ | **To** | | | | | +---------------------+------+---------------------+-----+-----------+ | addr-spec | | px_IMS_CalleeUri2 | | | +---------------------+------+---------------------+-----+-----------+
Table 8.34.3.3-2: 183 Session in Progress for INVITE (Step 8, table
8.34.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.2.3, Condition A1.  
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2  
**Message-body** _o=- 1111111112 1111111111 IN_ (addrtype) (unicast-address
for SS) RFC 4566 [38]
* * *
Table 8.34.3.3-3: 200 OK for INVITE (Step 11, table 8.34.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.1, Condition A1, A10
and A19.  
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2
* * *
Table 8.34.3.3-4: 180 Ringing for INVITE (Step 13, table 8.34.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.2.6, Condition A1.  
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2
* * *
**Table 8.34.3.3-5: 183 Session in Progress for INVITE (Step 25, table
8.34.3.2-1)**
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.2.3, Condition A1.  
**Header/param** **Cond** **Value/remark** **Rel** **Reference** **Message-
body** _o=- 1111111113 1111111111 IN_ (addrtype) (unicast-address for SS) RFC
4566 [38]
* * *
Table 8.34.3.3-6: NOTIFY for conference event package (Step 58, table
8.34.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.5.3, Conditions A1 and
A4.  
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2
* * *
Table 8.34.3.3-7: PRACK (step 9, table 8.34.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.2.4, | | | | | | Conditions A1 | | | | | | and A7 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | (if present) | | TS 24.229 [7] | | | | | | | | | | Contents is | | | | | | copied from step | | | | | | 6 of annex | | | | | | A.4.1a with the | | | | | | following | | | | | | exceptions: | | | | | | | | | | | | **Attributes for | | | | | | preconditions:** | | | | | | | | | | | | _a=curr:qos | | | | | | local sendrecv_ | | | | | | | | | | | | _a=curr:qos | | | | | | remote none_ | | | | | | | | | | | | _a=des:qos | | | | | | mandatory local | | | | | | sendrecv_ | | | | | | | | | | | | _a=des:qos | | | | | | optional remote | | | | | | sendrecv_ or | | | | | | _a=des:qos | | | | | | mandatory remote | | | | | | sendrecv_ | | | +------------------+------+------------------+-----+-----------------+
Table 8.34.3.3-8: 200 OK (step 10, table 8.34.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.3.1, | | | | | | Conditions A10 | | | | | | and A22 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | Content-Type | | (present, if | | | | | | content type was | | | | | | present in PRACK | | | | | | at step 9) | | | +------------------+------+------------------+-----+-----------------+ | media-type | | * | | | | | | application/sdp _| | | +------------------+------+------------------+-----+-----------------+ | Content-Length | | | | | +------------------+------+------------------+-----+-----------------+ | value | | length of | | | | | | message-body | | | +------------------+------+------------------+-----+-----------------+ |__Message-body_ _| | (present, if | | TS 24.229 [7] | | | | message-body was | | | | | | present in PRACK | | | | | | at step 9) | | | | | | | | | | | | SDP body of the | | | | | | 200 OK response | | | | | | copied from the | | | | | | received PRACK | | | | | | and modified as | | | | | | follows: | | | | | | | | | | | | - IP address on | | | | | | \"c=\" lines and | | | | | | transport port | | | | | | on \"m=\" lines | | | | | | changed to | | | | | | indicate to | | | | | | which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the | | | | | | media; | | | | | | | | | | | | - \"o=\" line | | | | | | identical to | | | | | | previous SDP | | | | | | sent by SS | | | | | | except that | | | | | | sess-version is | | | | | | incremented; | | | | | | | | | | | |_ -_Attributes | | | | | | for | | | | | | preconditions: | | | | | |_ a=curr:qos | | | | | | remote | | | | | | sendrecv.* | | | +------------------+------+------------------+-----+-----------------+
## 8.35 Three way session creation / Video / 5GS
##### 8.35.1 Test Purpose (TP) {#test-purpose-tp-68 .H6}
##### (1) {#section-209 .H6}
**with** { UE being registered to IMS being configured to use preconditions
and having set up an MO video call with A }
**ensure** **that** {
**when** { UE is made to start a three way video call }
**then** { UE sends re-INVITE or UPDATE, and completes the call hold procedure
with A }
}
##### (2) {#section-210 .H6}
**with** { UE being in the process of starting a three way video call }
**ensure** **that** {
**when** { UE having put A on hold }
**then** { UE initiates a video call with B }
}
##### (3) {#section-211 .H6}
**with** { UE being in the process of starting a three way video call }
**ensure** **that** {
**when** { UE having initiated a video call with B }
**then** { UE sends re-INVITE or UPDATE, and completes the call hold procedure
with B }
}
##### (4) {#section-212 .H6}
**with** { UE being in the process of starting a three way video call }
**ensure** **that** {
**when** { UE having put both A and B on hold }
**then** { UE sends INVITE to the conference factory and completes the
conference call initiation and subscribes to conference event }
}
##### (5) {#section-213 .H6}
**with** { UE being in the process of starting a three way video call }
**ensure** **that** {
**when** { UE having created a call at the conference factory }
**then** { UE sends REFER to the conference focus in order to invite A }
}
##### (6) {#section-214 .H6}
**with** { UE having invited A to the conference video call }
**ensure** **that** {
**when** { UE receives 202 Accepted followed by notification messages for the
REFER request, the confirmation on A and conditional conference event package
}
**then** { UE sends 200 OK for each received NOTIFY request }
}
##### (7) {#section-215 .H6}
**with** { UE being in the process of starting a three way video call }
**ensure** **that** {
**when** { UE having completed the invitation of A }
**then** { UE sends REFER to the conference focus in order to invite B }
}
##### (8) {#section-216 .H6}
**with** { UE having invited B to the conference video call }
**ensure** **that** {
**when** { UE receives 202 Accepted followed by notification messages for the
REFER request, the confirmation on B and conditional conference event package
}
**then** { UE sends 200 OK for each received NOTIFY request }
}
##### 8.35.2 Conformance Requirements {#conformance-requirements-69 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.147 clause 5.3.1.3.3]:
When a user is participating in two or more SIP sessions and wants to join
together two of these active sessions to a so-called three-way session, the
user shall perform the following steps.
1) create a conference at the conference focus by sending an INVITE request
with the conference factory URI for the three-way session towards the
conference focus, as described in subclause 5.3.1.3.2;
2) decide and perform for each of the active sessions that are requested to be
joined to the three-way session, how the remote user shall be invited to the
three-way session, which can either be:
a) by performing the procedures for inviting a user to a conference by sending
an REFER request to the user, as described in subclause 5.3.1.5.2; or
b) by performing the procedures for inviting a user to a conference by sending
a REFER request to the conference focus, as described in subclause 5.3.1.5.3;
3) release the active session with the user, by applying the procedures for
session release in accordance with RFC 3261 [7], provided that a BYE request
has not already been received, after a NOTIFY request has been received,
indicating that the user has successfully joined the three-way session, i.e.
including:
a) a body of content-type \"message/sipfrag\" that indicates a \"200 OK\"
response; and,
b) a Subscription-State header set to the value \"terminated\"; and,
4) treat the created three-way session as a normal conference, i.e. the
conference participant shall apply the applicable procedures of subclause
5.3.1 for it.
##### 8.35.3 Test description {#test-description-68 .H6}
##### 8.35.3.1 Pre-test conditions {#pre-test-conditions-68 .H6}
##### System Simulator: {#system-simulator-69 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-71 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-71 .H6}
\- The UE has registered to IMS and set up the MO video call, by executing the
generic test procedure in Annex A.2 up to the last step and thereafter
executing the generic test procedure in A. 15.1a.
##### 8.35.3.2 Test procedure sequence {#test-procedure-sequence-68 .H6}
Table 8.35.3.2-1: Main Behaviour
+-------+---------------+---------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+===============+===============+=========+=========+====+ | | | U - S | Message | | | +-------+---------------+---------------+---------+---------+----+ | 0 | UE is made to | - | - | - | - | | | put the first | | | | | | | call on hold. | | | | | +-------+---------------+---------------+---------+---------+----+ | 1-4 | Steps 1-4 of | - | - | 1 | P | | | A.24 are used | | | | | | | to put the | | | | | | | first call on | | | | | | | hold. | | | | | +-------+---------------+---------------+---------+---------+----+ | 5 | UE is made to | - | - | - | - | | | initiate a | | | | | | | MTSI video | | | | | | | call. | | | | | +-------+---------------+---------------+---------+---------+----+ | 6-10 | Steps 1-5 of | - | - | 2 | P | | | A.15.1a are | | | | | | | performed. | | | | | +-------+---------------+---------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 11-12 | | | | | | | describes | | | | | | | behaviour | | | | | | | that takes | | | | | | | place if the | | | | | | | UE doesn\'t | | | | | | | include QOS | | | | | | | confirmation | | | | | | | in the PRACK | | | | | | | message in | | | | | | | step 9. | | | | | +-------+---------------+---------------+---------+---------+----+ | 11 | UE sends a | --> | UPDATE | 2 | P | | | second SDP | | | | | | | offer in an | | | | | | | UPDATE | | | | | | | request. | | | | | | | | | | | | | | (Step 6 of | | | | | | | Annex | | | | | | | A.15.1a) | | | | | +-------+---------------+---------------+---------+---------+----+ | 12 | SS responds | \ | REFER | 5 | P | | | REFER to | | | | | | | invite user A | | | | | | | to the | | | | | | | conference. | | | | | | | | | | | | | | (Step 1 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 37-38 | SS responds | - | - | - | - | | | with a 202 | | | | | | | final | | | | | | | response and | | | | | | | NOTIFY for | | | | | | | the | | | | | | | subscription | | | | | | | created by | | | | | | | the REFER. | | | | | | | | | | | | | | (Steps 2-3 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 39 | The UE | -> | 200 OK | 6 | P | | | responds the | | | | | | | NOTIFY | | | | | | | request with | | | | | | | 200 OK. | | | | | | | | | | | | | | (Step 4 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 40 | SS responds | - | NOTIFY | - | - | | | with a NOTIFY | | | | | | | to confirm | | | | | | | the user the | | | | | | | invited user | | | | | | | was able to | | | | | | | join the | | | | | | | conference. | | | | | | | | | | | | | | (Steps 5 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 41 | UE responds | -> | 200 OK | 6 | P | | | the NOTIFY | | | | | | | request with | | | | | | | 200 OK | | | | | | | | | | | | | | (Steps 6 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 42-43 | Conditional: | - | - | - | - | | | If the UE has | | | | | | | subscribed | | | | | | | the | | | | | | | conference | | | | | | | event | | | | | | | package, then | | | | | | | the SS sends | | | | | | | a NOTIFY for | | | | | | | conference | | | | | | | event package | | | | | | | and UE | | | | | | | responds with | | | | | | | 200 OK. | | | | | | | | | | | | | | (Steps 7-8 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 44 | UE sends | -> | REFER | 7 | P | | | REFER to | | | | | | | invite user B | | | | | | | to the | | | | | | | conference. | | | | | | | | | | | | | | (Step 1 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 45-46 | SS responds | - | - | - | - | | | with a 202 | | | | | | | final | | | | | | | response and | | | | | | | NOTIFY for | | | | | | | the | | | | | | | subscription | | | | | | | created by | | | | | | | the REFER. | | | | | | | | | | | | | | (Steps 2-3 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 47 | The UE | -> | 200 OK | 8 | P | | | responds the | | | | | | | NOTIFY | | | | | | | request with | | | | | | | 200 OK. | | | | | | | | | | | | | | (Step 4 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 48 | SS responds | - | NOTIFY | - | - | | | with a NOTIFY | | | | | | | to confirm | | | | | | | the user the | | | | | | | invited user | | | | | | | was able to | | | | | | | join the | | | | | | | conference. | | | | | | | | | | | | | | (Steps 5 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 49 | UE responds | -> | 200 OK | 8 | P | | | the NOTIFY | | | | | | | request with | | | | | | | 200 OK | | | | | | | | | | | | | | (Steps 6 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 50-51 | Conditional: | - | - | - | - | | | If the UE has | | | | | | | subscribed | | | | | | | the | | | | | | | conference | | | | | | | event | | | | | | | package, then | | | | | | | the SS sends | | | | | | | a NOTIFY for | | | | | | | conference | | | | | | | event package | | | | | | | and UE | | | | | | | responds with | | | | | | | 200 OK. | | | | | | | | | | | | | | (Steps 7-8 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+ | 52-53 | Steps 1-2 of | - | - | - | - | | | A.7 are used | | | | | | | to release | | | | | | | the first | | | | | | | call. | | | | | +-------+---------------+---------------+---------+---------+----+ | 54-55 | Steps 1-2 of | - | - | - | - | | | A.7 are used | | | | | | | to release | | | | | | | the second | | | | | | | call. | | | | | +-------+---------------+---------------+---------+---------+----+ | 56-57 | Steps 1-2 of | - | - | - | - | | | A.8 are used | | | | | | | to release | | | | | | | the active | | | | | | | session. | | | | | +-------+---------------+---------------+---------+---------+----+ | 58 | Conditional: | \ | 200 OK | - | - | | | If the SS | | | | | | | sent NOTIFY, | | | | | | | then the UE | | | | | | | sends 200 OK | | | | | | | for NOTIFY. | | | | | | | | | | | | | | (Steps 8 of | | | | | | | A.26) | | | | | +-------+---------------+---------------+---------+---------+----+
##### 8.35.3.3 Specific message content {#specific-message-content-1 .H6}
Table 8.35.3.3-1: INVITE (Step 6, table 8.35.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Annex A.2.1, | | | | | | Conditions A1, A3, | | | | | | A4, A28, A29, A30, | | | | | | and A31,. | | | | | +=====================+======+=====================+=====+===========+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | **Request-Line** | | | | | +---------------------+------+---------------------+-----+-----------+ | Request-URI | | px_IMS_CalleeUri2 | | | | | | | | | | | | px_IMS_CalleeUri2 | | | | | | is used to invite | | | | | | another user to the | | | | | | session. | | | | | | | | | | | | px_IMS_CalleeUri2 | | | | | | may be either SIP | | | | | | or Tel URI. It may | | | | | | contain a | | | | | | dialstring and | | | | | | phone-context | | | | | | parameter, when | | | | | | calling to | | | | | | dialstring. When | | | | | | calling to | | | | | | dialstring SIP URI | | | | | | must also contain | | | | | | user=phone or | | | | | | user=dialstring | | | | | | parameter. | | | | | | | | | | | | The dialstring, if | | | | | | used, may be | | | | | | global, home local | | | | | | number or geo-local | | | | | | number. For home | | | | | | local numbers the | | | | | | value of | | | | | | phone-context | | | | | | parameter must | | | | | | equal the home | | | | | | domain name i.e. | | | | | | px_I | | | | | | MS_HomeDomainName. | | | | | | For geo-local | | | | | | numbers the home | | | | | | domain name must be | | | | | | prefixed by string | | | | | | "geo-local." or | | | | | | access technology | | | | | | specific prefix, if | | | | | | the UE supports | | | | | | that option. | | | | | | | | | | | | Note: The way how | | | | | | the UE determines | | | | | | whether numbers in | | | | | | a non-international | | | | | | format are | | | | | | geo-local, | | | | | | home-local or | | | | | | relating to another | | | | | | network, is UE | | | | | | implementation | | | | | | specific. For | | | | | | instance the UE | | | | | | might have a UI | | | | | | setting. | | | +---------------------+------+---------------------+-----+-----------+ | **To** | | | | | +---------------------+------+---------------------+-----+-----------+ | addr-spec | | px_IMS_CalleeUri2 | | | +---------------------+------+---------------------+-----+-----------+
Table 8.35.3.3-2: 183 Session in Progress for INVITE (Step 8, table
8.35.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.2.3, Condition A1.
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2  
**Message-body** _o=- 1111111112 1111111111 IN (addrtype) (unicast-address for
SS)_ **RFC 4566 [38]**
Table 8.35.3.3-3: 200 OK for INVITE (Step 11, table 8.35.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Condition A1, A10 and A19.
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2
Table 8.35.3.3-4: 180 Ringing for INVITE (Step 13, table 8.35.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.2.6, Condition A1.
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2
Table 8.35.3.3-4a: 183 Session in Progress for INVITE (Step 25, table
8.35.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.2.3, Condition A1.  
Header/param Cond Value/remark Rel Reference **Message-body** _o=- 1111111113
1111111111 IN_ (addrtype) (unicast-address for SS) RFC 4566 [38]
* * *
Table 8.35.3.3-5: NOTIFY for conference event package (Step 58, table
8.35.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.5.3, Conditions A1 and A4.
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec px_IMS_CalleeContactUri2
Table 8.35.3.3-6: PRACK (step 9, table 8.35.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.2.4, | | | | | | Conditions A1 | | | | | | and A7 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | (if present) | | TS 24.229 [7] | | | | | | | | | | Contents is | | | | | | copied from step | | | | | | 6 of annex | | | | | | A.15.1 with the | | | | | | following | | | | | | exceptions: | | | | | | | | | | | | **Attributes for | | | | | | preconditions | | | | | | (Audio):** | | | | | | | | | | | | _a=curr:qos | | | | | | local sendrecv_ | | | | | | | | | | | | _a=curr:qos | | | | | | remote none_ | | | | | | | | | | | | _a=des:qos | | | | | | mandatory local | | | | | | sendrecv_ | | | | | | | | | | | | _a=des:qos | | | | | | optional remote | | | | | | sendrecv_ or | | | | | | _a=des:qos | | | | | | mandatory remote | | | | | | sendrecv_ | | | | | | | | | | | | **Attributes for | | | | | | preconditions | | | | | | (video):** | | | | | | | | | | | | _a=curr:qos | | | | | | local sendrecv_ | | | | | | | | | | | | _a=curr:qos | | | | | | remote none_ | | | | | | | | | | | | _a=des:qos | | | | | | mandatory local | | | | | | sendrecv_ | | | | | | | | | | | | _a=des:qos | | | | | | optional remote | | | | | | sendrecv_ or | | | | | | _a=des:qos | | | | | | mandatory remote | | | | | | sendrecv_ | | | +------------------+------+------------------+-----+-----------------+
Table 8.35.3.3-7: 200 OK (step 10, table 8.35.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.3.1, | | | | | | Conditions A10 | | | | | | and A22 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | Content-Type | | (present, if | | | | | | content-type was | | | | | | present in PRACK | | | | | | at step 9) | | | +------------------+------+------------------+-----+-----------------+ | media-type | | * | | | | | | application/sdp _| | | +------------------+------+------------------+-----+-----------------+ | Content-Length | | | | | +------------------+------+------------------+-----+-----------------+ | value | | length of | | | | | | message-body | | | +------------------+------+------------------+-----+-----------------+ |__Message-body_ _| | (present, if | | TS 24.229 [7] | | | | Message-body was | | | | | | present in PRACK | | | | | | at step 9) | | | | | | | | | | | | SDP body of the | | | | | | 200 OK response | | | | | | copied from the | | | | | | received PRACK | | | | | | and modified as | | | | | | follows: | | | | | | | | | | | | - IP address on | | | | | | \"c=\" lines and | | | | | | transport port | | | | | | on \"m=\" lines | | | | | | changed to | | | | | | indicate to | | | | | | which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the | | | | | | media; | | | | | | | | | | | | - \"o=\" line | | | | | | identical to | | | | | | previous SDP | | | | | | sent by SS | | | | | | except that | | | | | | sess-version is | | | | | | incremented; | | | | | | | | | | | |_ -_Attributes | | | | | | for | | | | | | preconditions: | | | | | |_ a=curr:qos | | | | | | remote | | | | | | sendrecv.* | | | +------------------+------+------------------+-----+-----------------+
## 8.36 MO Voice Call Explicit Communication Transfer / Consultative Call
Transfer / 5GS
##### 8.36.1 Test Purpose (TP) {#test-purpose-tp-69 .H6}
##### (1) {#section-217 .H6}
**with** { UE being registered to IMS and being configured to use
preconditions and having established a voice call with A (the transferee) }
**ensure** **that** {
**when** { UE is being made to attempt Consultative Call Transfer }
**then** { UE puts A on hold and sets up voice call with B (the transfer
target) and puts B on hold and sends REFER to the transferee }
}
##### (2) {#section-218 .H6}
**with** { UE having initiated consultative call transfer }
**ensure** **that** {
**when** { UE receives NOTIFY }
**then** { UE sends 200 OK response for NOTIFY }
}
##### (3) {#section-219 .H6}
**with** { UE having processed the NOTIFY exchange }
**ensure** **that** {
**when** { UE receives instruction to be put on hold by A }
**then** { UE processes call hold instruction and responds to it }
}
##### (4) {#section-220 .H6}
**with** { UE having been put on hold by A }
**ensure** **that** {
**when** { UE receives BYE from B }
**then** { UE sends 200 OK for BYE }
}
##### (5) {#section-221 .H6}
**with** { Call with B having ended }
**ensure** **that** {
**when** { UE receives NOTIFY from A }
**then** { UE sends 200 OK for NOTIFY and may send BYE }
}
##### 8.36.2 Conformance Requirements {#conformance-requirements-70 .H6}
[TS 24.629, clause 4.5.2.1]:
A UE that has initiated an emergency call, shall not perform any transfer
operation involving the dialog associated with the emergency call.
A UE that initiates a transfer operation shall if the Contact address of the
transferee is a GRUU:
\- issue a REFER outside an existing dialog as specified in RFC 3515 [2] as
updated by IETF RFC 6665 [14] and IETF RFC 7647 [16], where:
a) the request URI shall contain the SIP URI of the transferee as received in
the Contact header field:
b) the Refer-To header field shall indicate the public address of the transfer
target;
c) in case of Consultative transfer, the transferor UE has a consultation
communication with the transfer target, a Replaces header field parameter
shall be added to the Refer-To URI together with a Require=replaces header
field parameter;
d) the Referred-By header field can be used to indicate the identity of the
transferor. When privacy was required in the original communications dialog
and a Referred-By header field is included, the UE shall include a Privacy
header field set to \"user\"; and
e) the Target-Dialog header field identifies the dialog to be transferred;
otherwise the UE shall:
\- issue a REFER request in the original communications dialog as specified in
RFC 3515 [2], where:
a) the request URI shall contain the SIP URI of the transferee as received in
the Contact header field;
b) the Refer-To header field shall indicate the public address of the transfer
target;
c) in case of consultative transfer, the transferor UE has a consultation
communication with the transfer target, a Replaces header field parameter
shall be added to the Refer-To URI together with a Require=replaces header
field parameter; and
d) the Referred-By header field can be used to indicate the identity of the
transferor. When privacy was required in the original communications dialog
and a Referred-By header field is included, the UE shall include a Privacy
header field set to \"user\".
If assured transfer is requested, the UE may include an Expires header field
in the Refer-To URI of the REFER request.
NOTE 1: The value of the Expires header field indicates the maximum duration
of the transfer attempt. If the transfer does not succeed within this
duration, the UE will receive a NOTIFY request indicating the transfer
failure.
After the REFER request is accepted by the other end with a 2xx response, the
transferor UE gets notifications of how the transferee\'s communication setup
towards the transfer Target is progressing.
When a NOTIFY request is received on the REFER dialog that indicates that the
transferee and the transfer Target have successfully setup a communication,
the transferor UE may terminate the original communication with the transferee
UE, by sending a BYE request on the original dialog.
If an assured transfer attempt is not completed (i.e. the UE has not received
a NOTIFY request with a \"message/sipfrag\" body's status line containing a
final response code indicating the end of the transfer operation), the UE may
request to terminate the transfer attempt by:
\- sending a REFER request in the same communications dialog as the previous
REFER request as specified in RFC 3515 [2] as updated by IETF RFC 6665 [14]
and IETF RFC 7647 [16], where:
a) the request URI shall contain the SIP URI of the transferee as received in
the Contact header field; and
b) the Refer-To header field shall indicate the public address of the transfer
target and shall contain the method parameter set to \"CANCEL\"; and
c) if applicable include a Target-Dialog header field that identifies the
dialog under transfer.
If the UE receives a NOTIFY request indicating that the assured transfer
attempt failed, followed by a re-INVITE or an UPDATE request taking the UE off
HOLD the UE may decide to retrieve the original communication by sending a re-
INVITE request in the original SIP dialog.
NOTE 2: If the user requests the retrieval of the original communication while
the transfer attempt has not been completed, the UE needs to first request the
termination of the transfer attempt before retrieving the original
communication via a re-INVITE request.
Reference(s)
3GPP TS 24.629 [36], clause 4.5.2.1.
##### 8.36.3 Test description {#test-description-69 .H6}
##### 8.36.3.1 Pre-test conditions {#pre-test-conditions-69 .H6}
##### System Simulator: {#system-simulator-70 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-72 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-72 .H6}
\- The UE has registered to IMS and set up the MO call, by executing the
generic test procedure in Annex A.2 up to the last step and thereafter
executing the generic test procedure in A.4.1a.
\- The SS has accepted the UE's MO call.
##### 8.36.3.2 Test procedure sequence {#test-procedure-sequence-69 .H6}
Table 8.36.3.2-1: Main Behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-----------+-----------+-----------+-----------+---------+----+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Make the | - | - | - | - | | | UE put | | | | | | | the call | | | | | | | on hold | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Check: | --> | INVITE or | 1 | P | | | Does the | | UPDATE | | | | | UE send | | | | | | | INVITE or | | | | | | | UPDATE | | | | | | | with a | | | | | | | SDP offer | | | | | | | to hold | | | | | | | the call | | | | | | | with A by | | | | | | | running | | | | | | | step 1 of | | | | | | | A.17 for | | | | | | | MO Call | | | | | | | Hold? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3-5 | Remaining | - | - | - | - | | | steps 2-4 | | | | | | | of A.17 | | | | | | | for MO | | | | | | | Call Hold | | | | | | | happen. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Void | - | - | - | - | +-----------+-----------+-----------+-----------+---------+----+ | 6A | Make the | - | - | - | - | | | UE | | | | | | | initiate | | | | | | | a new | | | | | | | MTSI | | | | | | | voice | | | | | | | call. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | Check: | --> | INVITE | 1 | P | | | Does the | | | | | | | UE | | | | | | | initiate | | | | | | | a voice | | | | | | | call with | | | | | | | B by | | | | | | | e | | | | | | | xercising | | | | | | | step 1 of | | | | | | | Annex | | | | | | | A.4.1a? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8-11 | Steps 2-5 | - | - | - | - | | | of A.4.1a | | | | | | | happen | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Step | | | | | | | 12-13 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | takes | | | | | | | place if | | | | | | | the UE | | | | | | | doesn\'t | | | | | | | include | | | | | | | QOS | | | | | | | con | | | | | | | firmation | | | | | | | in the | | | | | | | PRACK | | | | | | | message | | | | | | | in step | | | | | | | 10. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | UE sends | --> | UPDATE | - | - | | | a second | | | | | | | SDP offer | | | | | | | in an | | | | | | | UPDATE | | | | | | | request. | | | | | | | | | | | | | | (Step 6 | | | | | | | of Annex | | | | | | | A.4.1a) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | SS | \ | INVITE or | 1 | P | | | Does the | | UPDATE | | | | | UE send | | | | | | | INVITE or | | | | | | | UPDATE | | | | | | | with a | | | | | | | SDP offer | | | | | | | to hold | | | | | | | the call | | | | | | | with B by | | | | | | | running | | | | | | | step 1 of | | | | | | | A.17 for | | | | | | | MO Call | | | | | | | Hold? | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 21-23 | Remaining | - | - | - | - | | | steps 2-4 | | | | | | | of A.17 | | | | | | | for MO | | | | | | | Call Hold | | | | | | | happen | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 24 | Check: | --> | REFER | 1 | P | | | Does the | | | | | | | UE send | | | | | | | REFER to | | | | | | | SS, | | | | | | | s | | | | | | | imulating | | | | | | | the | | | | | | | tr | | | | | | | ansferee, | | | | | | | referring | | | | | | | to the | | | | | | | transfer | | | | | | | target | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 25 | The SS | \ | 200 OK | 2 | P | | | responds | | | | | | | to NOTIFY | | | | | | | with 200 | | | | | | | OK | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 28-31 | The SS, | - | - | 3 | P | | | s | | | | | | | imulating | | | | | | | the | | | | | | | tr | | | | | | | ansferee, | | | | | | | puts the | | | | | | | UE on | | | | | | | hold by | | | | | | | executing | | | | | | | the MT | | | | | | | Call Hold | | | | | | | procedure | | | | | | | of Annex | | | | | | | A.18, but | | | | | | | setting | | | | | | | the | | | | | | | direction | | | | | | | attribute | | | | | | | to | | | | | | | inactive. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 32 | The SS, | \ | 200 OK | 4 | P | | | responds | | | | | | | to BYE | | | | | | | with 200 | | | | | | | OK | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 34 | The SS, | \ | 200 OK | - | - | | | responds | | | | | | | to NOTIFY | | | | | | | with 200 | | | | | | | OK | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 36 | Optional: | --> | BYE | - | - | | | UE may | | | | | | | send a | | | | | | | BYE | | | | | | | request | | | | | | | to | | | | | | | release | | | | | | | call with | | | | | | | the | | | | | | | t | | | | | | | ransferee | | | | | | | within | | | | | | | 3s. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 37 | If the UE | \  
Referred-By  
value same value as addr-spec field in From header in the first INVITE during
initial call setup, if header present  
Privacy  
value user (shall be included if privacy was required during original
communication dialog and Referred-By header field is included)
Table 8.36.3.3-7: NOTIFY (step 26, table 8.36.3.2-1)
Derivation Path: TS 34.229-1 [2], A.2.11
* * *
Header/param Cond Value/remark Rel Reference Message-body _SIP/2.0 100 Trying_
Table 8.36.3.3-8: 200 OK for NOTIFY (step 27, table 8.36.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A11 and A22
* * *
Table 8.36.3.3-9: INVITE (step 28, table 8.36.3.2-1)
Derivation Path: TS 34.229-5, Step 1 of A.19
* * *
Header/param Cond Value/remark Rel Reference Message-body Each media line
carries direction attribute "a=inactive"
Table 8.36.3.3-10: 200 OK for re-INVITE (step 30, table 8.36.3.2-1)
Derivation Path: TS 34.229-5, Step 4 of A.19
* * *
Header/param Cond Value/remark Rel Reference Message-body Each media line
carries direction attribute "a=inactive"
Table 8.36.3.3-11: NOTIFY (step 34, table 8.36.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.2.11
* * *
Header/param Cond Value/remark Rel Reference Subscription-State  
Substate-value _terminated_  
expires omitted from request  
reason _noresource_  
Message-body _SIP/2.0 200 OK_
Table 8.36.3.3-12: 200 OK for NOTIFY (step 35, table 8.36.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A11 and A22
* * *
Table 8.36.3.3-13: PRACK (step 10, table 8.36.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.2.4, | | | | | | Conditions A1 | | | | | | and A7 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | (if present) | | TS 24.229 [7] | | | | | | | | | | Contents is | | | | | | copied from step | | | | | | 6 of annex A.4.1 | | | | | | with the | | | | | | following | | | | | | exceptions: | | | | | | | | | | | | **Attributes for | | | | | | preconditions:** | | | | | | | | | | | | _a=curr:qos | | | | | | local sendrecv_ | | | | | | | | | | | | _a=curr:qos | | | | | | remote none_ | | | | | | | | | | | | _a=des:qos | | | | | | mandatory local | | | | | | sendrecv_ | | | | | | | | | | | | _a=des:qos | | | | | | optional remote | | | | | | sendrecv_ or | | | | | | _a=des:qos | | | | | | mandatory remote | | | | | | sendrecv_ | | | +------------------+------+------------------+-----+-----------------+
Table 8.36.3.3-14: 200 OK (step 11, table 8.36.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.3.1, | | | | | | Conditions A10 | | | | | | and A22 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | Require | | (present, if | | | | | | Message-Body is | | | | | | present) | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | Content-Type | | (present, if | | | | | | content-type was | | | | | | present in PRACK | | | | | | at step 10) | | | +------------------+------+------------------+-----+-----------------+ | media-type | | * | | | | | | application/sdp _| | | +------------------+------+------------------+-----+-----------------+ | Content-Length | | | | | +------------------+------+------------------+-----+-----------------+ | value | | length of | | | | | | message-body | | | +------------------+------+------------------+-----+-----------------+ |__Message-body_ _| | (present, if | | TS 24.229 [7] | | | | Message-Body was | | | | | | present in PRACK | | | | | | at step 10) | | | | | | | | | | | | SDP body of the | | | | | | 200 OK response | | | | | | copied from the | | | | | | received PRACK | | | | | | and modified as | | | | | | follows: | | | | | | | | | | | | - IP address on | | | | | | \"c=\" lines and | | | | | | transport port | | | | | | on \"m=\" lines | | | | | | changed to | | | | | | indicate to | | | | | | which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the | | | | | | media; | | | | | | | | | | | | - \"o=\" line | | | | | | identical to | | | | | | previous SDP | | | | | | sent by SS | | | | | | except that | | | | | | sess-version is | | | | | | incremented; | | | | | | | | | | | |_ -_Attributes | | | | | | for | | | | | | preconditions: | | | | | |_ a=curr:qos | | | | | | remote | | | | | | sendrecv.* | | | +------------------+------+------------------+-----+-----------------+
## 8.37 Communication Waiting and answering the voice call / 5Gs
##### 8.37.1 Test Purpose (TP) {#test-purpose-tp-70 .H6}
##### (1) {#section-222 .H6}
**with** { UE being registered to IMS and having initiated an MO voice call
with preconditions }
**ensure** **that** {
**when** { UE receives INVITE for MT voice call with preconditions }
**then** { UE continues voice call initiation until 180 Ringing (including
conditional PRACK/200 OK) }
}
##### (2) {#section-223 .H6}
**with** { UE having continued initiation of incoming voice call until 180
Ringing }
**ensure** **that** {
**when** { UE is being made to terminate the MO voice call }
**then** { UE sends BYE for the MO voice call }
}
##### (3) {#section-224 .H6}
**with** { UE having terminated the MO voice call }
**ensure** **that** {
**when** { UE is being made to accept the incoming MT voice call }
**then** { UE sends 200 OK for INVITE }
}
##### 8.37.2 Conformance Requirements {#conformance-requirements-71 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.615 subclause 4.5.5.3.2]:
Upon receipt of an INVITE request containing:
\- a Content-Type header field set to \"application/vnd.3gpp.cw+xml\";
\- a MIME body according to subclause 4.4.1 with the with the \ element contained in the \ root element; and
\- if the maximum number of waiting communications is not reached (i.e. UDUB
condition has not occurred), the UE shall:
\- provide a CW indication to the user;
\- send a 180 (Ringing) response to the INVITE request according to the
provisional response procedures described in 3GPP TS 24.229 [2];
\- optionally, if the INVITE includes an Expires header field, use the value
of this header field to provide the time to expiry information of the
communication waiting to the user; and
\- optionally start timer T~UE-CW~;
NOTE 1: The timer T~UE-CW~ is used in order to limit the duration of the CW
condition at the UE. For terminals that can provide an indication to the user
that a CW condition is occurring without disturbing the active communication,
this timer is not needed.
NOTE 2: RFC 5621 [9] describes conditions under which a 415 (Unsupported Media
Type) response is returned.
The UE may insert an Alert-Info header field set to
\"\\" according to RFC 7462 [131] in the 180
(Ringing) response, according to the provisional response procedures described
in 3GPP TS 24.229 [2].
[TS 24.615 subclause 4.5.5.3.3]:
##### Case A {#case-a .H6}
If user B accepts the waiting communication and holds (per procedures in 3GPP
TS 24.610 [5]) or releases (per procedures in 3GPP TS 24.229 [2]) the active
communication and timer T~UE-CW~ has not expired, user B\'s UE shall:
\- stop timer T~UE-CW~ (if it has been started);
\- stop providing the CW indication to User B; and
\- apply the procedures for answering the waiting communication to User B as
described in 3GPP TS 24.229 [2].
##### Case B {#case-b .H6}
If T~UE-CW~ was started and expires, user B\'s UE shall:
\- stop providing the CW indication to User B; and
\- send a 480 (Temporarily Unavailable) response towards User C, optionally
including a Reason header field set to cause 19, in accordance with RFC 6432
[130].
[TS 24.615 subclause 4.5.5.3.4]:
If user B\'s UE receives a CANCEL request or BYE request from User C during a
CW condition, user B\'s UE shall:
\- stop timer T~UE-CW~ (if necessary);
\- stop providing the CW indication to User B; and
\- apply the terminating UE procedures upon receipt of CANCEL or BYE as
described in 3GPP TS 24.229 [2].
If user B\'s UE receives a CANCEL request or BYE request from User A and
during a CW condition, user B\'s UE shall:
\- stop timer T~UE-CW~ (if necessary);
\- stop providing the CW indication to User B;
\- apply the terminating UE procedures upon receipt of CANCEL request or BYE
request as described in 3GPP TS 24.229 [2]; and
\- optionally apply the procedure for accepting the waiting communication as
described in 3GPP TS 24.229 [2].
##### 8.37.3 Test description {#test-description-70 .H6}
##### 8.37.3.1 Pre-test conditions {#pre-test-conditions-70 .H6}
##### System Simulator: {#system-simulator-71 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-73 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is configured to use preconditions.
##### Preamble: {#preamble-73 .H6}
\- The UE has registered to IMS and set up the MO voice call, by executing the
generic test procedure in Annex A.2 up to the last step and thereafter
executing the generic test procedure in A.4.1a.
##### 8.37.3.2 Test procedure sequence {#test-procedure-sequence-70 .H6}
Table 8.37.3.2-1: Main Behaviour
+-----+--------------+--------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+=============+=========+====+ | | | U - S | Message | | | +-----+--------------+--------------+-------------+---------+----+ | 1-7 | Steps 1-7 of | - | - | - | - | | | A.5.1a are | | | | | | | executed. | | | | | +-----+--------------+--------------+-------------+---------+----+ | 8 | Check: Does | --> | 180 Ringing | 1 | P | | | the UE | | | | | | | responds to | | | | | | | INVITE with | | | | | | | 180 Ringing | | | | | | | with an | | | | | | | Alert-Info | | | | | | | header field | | | | | | | set to | | | | | | | \" | | | | | | | \\" | | | | | +-----+--------------+--------------+-------------+---------+----+ | 9 | ( | \ | 200 OK | - | - | | | Conditional) | | | | | | | The UE | | | | | | | acknowledges | | | | | | | the PRACK | | | | | | | with 200 OK. | | | | | +-----+--------------+--------------+-------------+---------+----+ | 11 | The UE is | - | - | - | - | | | made to end | | | | | | | the MO call | | | | | +-----+--------------+--------------+-------------+---------+----+ | 12 | Check: Does | --> | BYE | 2 | P | | | the UE send | | | | | | | a BYE to | | | | | | | terminate | | | | | | | its previous | | | | | | | session? | | | | | | | | | | | | | | (step 1 in | | | | | | | Annex A.7) | | | | | +-----+--------------+--------------+-------------+---------+----+ | 13 | The SS | \ | 200 OK | 3 | P | | | the UE | | | | | | | responds to | | | | | | | INVITE with | | | | | | | a 200 OK | | | | | | | final | | | | | | | response | | | | | | | after the | | | | | | | user answers | | | | | | | the call. | | | | | +-----+--------------+--------------+-------------+---------+----+ | 16 | The SS | \_
Table 8.37.3.3-4: PRACK (Step 9, table 8.37.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.2.4, Condition A3
* * *
Header/param Cond Value/remark Rel Reference **Content-Length**  
**value** 0  
**Message-body** not present
Table 8.37.3.3-5: 200 OK (Step 10, table 8.37.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A2, A11 and A20.
* * *
Table 8.37.3.3-6: 200 OK (Step 15, table 8.37.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Conditions A1, A10 and A19.
* * *
Table 8.37.3.3-7: ACK (Step 16, table 8.37.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.7, Condition A2.
* * *
## 8.38 Communication Waiting and cancelling the voice call / 5GS
##### 8.38.1 Test Purpose (TP) {#test-purpose-tp-71 .H6}
##### (1) {#section-225 .H6}
**with** { UE being registered to IMS and having initiated an MO voice call
with preconditions }
**ensure that** {
**when** { UE receives INVITE for MT voice call with preconditions }
**then** { UE continues voice call initiation until 180 Ringing (including
conditional PRACK/200 OK) }
}
##### (2) {#section-226 .H6}
**with** { UE having continued initiation of incoming voice call until 180
Ringing }
**ensure that** {
**when** { UE receives CANCEL for incoming voice call }
**then** { UE responds with 200 OK and 487 Request Terminated responses }
}
##### 8.38.2 Conformance Requirements {#conformance-requirements-72 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.615 clause 1]:
The **Communication Waiting (CW)** service enables a user to be informed, that
very limited resources are available for an incoming communication. The user
then has the choice of accepting, rejecting or ignoring the waiting call (as
per basic call procedures).
[TS 24.615 clause 4.2.1]:
When a communication arrives at the destination user, the UE validates the
status of the user. If the user is already involved in one or more
communications, the terminal notifies the served user of a communication
waiting situation.
[TS 24.615 clause 4.5.5.3.2]:
The UE shall insert an Alert-Info header field set to
\"\\", specified in RFC 7462 [8] in the 180
(Ringing) response, in accordance with the provisional response procedures
described in 3GPP TS 24.229.
[TS 24.615 clause 4.5.5.3.4]:
If user B\'s UE receives a CANCEL request or BYE request from User C during a
CW condition, user B\'s UE shall:
\- stop timer T~UE-CW~ (if necessary);
\- stop providing the CW indication to User B; and
\- apply the terminating UE procedures upon receipt of CANCEL or BYE as
described in 3GPP TS 24.229.
##### 8.38.3 Test description {#test-description-71 .H6}
##### 8.38.3.1 Pre-test conditions {#pre-test-conditions-71 .H6}
##### System Simulator: {#system-simulator-72 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-74 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
##### Preamble: {#preamble-74 .H6}
##### \- The UE has registered to IMS and set up the MO voice call, by
executing the generic test procedure in Annex A.2 up to the last step and
thereafter executing the generic test procedure in A.4.1a.8.38.3.2 Test
procedure sequence {#the-ue-has-registered-to-ims-and-set-up-the-mo-voice-
call-by-executing-the-generic-test-procedure-in-annex-a.2-up-to-the-last-step-
and-thereafter-executing-the-generic-test-procedure-in-a.4.1a.8.38.3.2-test-
procedure-sequence .H6}
Table 8.38.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict
                                                                                                                     U - S              Message
1-7 MT Voice call setup takes place according to steps 1-7 of Annex A.5.1a - -
- -
8 Step 8 of Annex A.5.1a happens --> 180 Ringing 1 P
9 Conditional Step: if UE sent 180 Ringing reliably, Step 9 of Annex A.5.1a
happens \ 200 OK - -
11 SS sends CANCEL request to terminate INVITE transaction \ 200 OK - -
13 The UE responds to INVITE with a 487 Request Terminated final response
after transaction was terminated. --> 487 Request Terminated 2 P
14 SS acknowledges the receipt of 487 Request Terminated \ RFC 7462 [39]
Table 8.38.3.3-4: CANCEL (step 11, table 8.38.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.2.15
* * *
Table 8.38.3.3-5: 200 OK (step 12, table 8.38.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.3.1 applying conditions
A5 and A11
* * *
Table 8.38.3.3-6: 487 Request Terminated (step 13, table 8.38.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.2.16
* * *
Table 8.38.3.3-7: ACK (step 14, table 8.38.3.2-1)
* * *
Derivation path: TS 34.229-1 [2], Table in subclause A.2.7 applying conditions
A2 and A4
* * *
## 8.39 GBA Authentication / 5GS
##### 8.39.1 Test Purpose (TP) {#test-purpose-tp-72 .H6}
##### (1) {#section-227 .H6}
**with** { UE being registered to IMS and configured to use GBA authentication
}
**ensure that** {
**when** { UE is made to activate OIP }
**then** { UE authenticates itself using GBA }
}
##### 8.39.2 Conformance Requirements {#conformance-requirements-73 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.109, clause 4.2]:
The UE shall initiate the bootstrapping procedure when:
a) the UE wants to interact with a NAF and bootstrapping is required;
b) a NAF has requested bootstrapping required indication as described in
subclause 5.2.4 or bootstrapping renegotiation indication as described in
subclause 5.2.5; or
c) the lifetime of the key has expired in the UE if one or more applications
are using that key.
A UE and the BSF shall establish bootstrapped security association between
them by running bootstrapping procedure. Bootstrapping security association
consists of a bootstrapping transaction identifier (B-TID) and key material
Ks. Bootstrapping session on the BSF also includes security related
information about subscriber (e.g. user\'s private identity). Bootstrapping
session is valid for a certain time period, and shall be deleted in the BSF
when the session becomes invalid.
Bootstrapping procedure shall be based on HTTP Digest AKA as described in 3GPP
TS 33.220 [1] and in RFC 3310 [6] with the modifications described below.
The BSF address is derived from the IMPI or IMSI according to 3GPP TS 23.003
[7].
A UE shall indicate to the BSF that it supports the use of TMPI as defined in
3GPP 33.220 [1] by including a \"product\" token in the \"User-Agent\" header
field (cf. RFC 2616 [14]) that is set to a static string \"3gpp-gba-tmpi\" in
HTTP requests sent to the BSF.
A BSF shall indicate to the UE that it supports the use of TMPI as defined in
3GPP 33.220 [1] by including a \"product\" token in the \"Server\" header
field (cf. RFC 2616 [14]) that is set to a static string \"3gpp-gba-tmpi\" in
HTTP responses sent to the UE.
In the bootstrapping procedure, Authorization, WWW-Authenticate, and
Authentication-Info HTTP headers shall be used as described in RFC 3310 [6]
with following exceptions:
a) the \"realm\" parameter shall contain the network name where the username
is authenticated;
b) the quality of protection (\"qop\") parameter shall be \"auth-int\"; and
c) the \"username\" parameter shall contain user\'s private identity (IMPI).
NOTE: If the UE does not have an ISIM application with an IMPI, the IMPI will
be constructed from IMSI, according to 3GPP TS 23.003 [7].
In addition to RFC 3310 [6], the following apply:
a) In the initial request from the UE to the BSF, the UE shall include
Authorization header with following parameters:
\- the username directive, set to
1) the value of the TMPI if one has been associated with the private user
identity as described in 3GPP 33.220 [1]; or
2) the value of the private user identity;
\- the realm directive, set to the BSF address derived from the IMPI or IMSI
according to 3GPP TS 23.003 [7];
\- the uri directive, set to either absoluteURL \"http://\/\" or
abs_path \"/\", and which one is used is specified in RFC 2617 [9];
\- the nonce directive, set to an empty value; and
\- the response directive, set to an empty value;
b) In the challenge response from the BSF to the UE, the BSF shall include
parameters to WWW-Authenticate header as specified in RFC 3310 [6] with
following clarifications:
\- the realm directive, set to the BSF address derived from the IMPI or IMSI
according to 3GPP TS 23.003 [7];
c) In the message from the BSF to the UE, the BSF shall include bootstrapping
transaction identifier (B-TID) and the key lifetime to an XML document in the
HTTP response payload. The BSF may also include additional server specific
data to the XML document. The XML schema definition of this XML document is
given in Annex C.
d) When responding to a challenge from the BSF, the UE shall include an
Authorization header containing a realm directive set to the value as received
in the realm directive in the WWW-Authenticate header.
e) Authentication-Info header shall be included into the subsequent HTTP
response after the BSF concluded that the UE has been authenticated.
Authentication-Info header shall include the \"rspauth\" parameter.
After successful bootstrapping procedure the UE and the BSF shall contain the
key material (Ks) and the B-TID. The key material shall be derived from AKA
parameters as specified in 3GPP TS 33.220 [1]. In addition, BSF shall also
contain a set of security specific attributes related to the UE.
An example flow of successful bootstrapping procedure can be found in clause
A.3.
##### 8.39.3 Test description {#test-description-72 .H6}
##### 8.39.3.1 Pre-test conditions {#pre-test-conditions-72 .H6}
##### System Simulator: {#system-simulator-73 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-75 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-75 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 8.39.3.2 Test procedure sequence {#test-procedure-sequence-71 .H6}
Table 8.39.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                         U - S              Message
1 UE is made to attempt to attempt activation of supplementary service
Originating Identification Presentation - - - -
2 UE sends an initial HTTP Request\ --> GET/PUT/DELETE - - (Step 2 of A.21)
3 Conditional (according to A.21):\ \ GET - - (Step 1 of A.22)
5 SS sends 401 Unauthorized\ \ GET 1 P
(Step 3 of A.22)
7 SS sends 200 OK\ \ GET/PUT/DELETE - - UE sends HTTP
request with valid authorization credentials\  
(Step 3b of A.21)
9 SS sends 200 OK\ \ GET/PUT/DELETE - - (Step 2 of A.21)
3 Conditional (according to A.21):\ \ GET/PUT/DELETE 1 P UE sends HTTP
request with valid authorization credentials\  
(Step 3b of A.21)
5 SS sends 200 OK\ \
language, ussd-String
BYE
\ XML element is used.
In order to send the initial USSD message, the UE shall send an initial INVITE
request, according to 3GPP TS 24.229 [6]. The UE shall populate the request as
follows:
1) Request-URI set to a SIP URI with user part including the USSD string and a
\"phone-context\" parameter set to the home network domain name used in
REGISTER request according to TS 24.229 [6], a host part set to the home
network domain name used in REGISTER request as defined in TS 24.229 [6] a
\"user\" URI parameter set to value \"dialstring\" as specified in RFC 4967
[7];
2) Recv-Info header field containing the g.3gpp.ussd info-package name;
3) Accept header field containing the application/vnd.3gpp.ussd+xml,
application/sdp and multipart/mixed MIME types;
4) the Content-Type header, which shall contain \"multipart/mixed\";
5) SDP offer as described in subclause 4.5.2; and
6) application/vnd.3gpp.ussd+xml MIME body as described in subclause 5.1.3
with a Content-Disposition header field set to \"render\" and with
\"handling\" header field parameter set to \"optional\". The XML document
shall contain a single \ element and may contain a \
element.
...
When receiving a BYE request containing application/vnd.3gpp.ussd+xml MIME
body, the UE shall, in addition to the procedures specified in 3GPP TS 24.229
[6], handle the application/vnd.3gpp.ussd+xml MIME body.
NOTE 2: According to 3GPP TS 24.229 [6], the UE can receive a BYE request
without the application/vnd.3gpp.ussd+xml MIME body and in this case the
dialog is terminated immediately.
When receiving a 404 (Not Found) response to INVITE request, the UE shall
determine that an attempt to deliver the USSD request using IMS fails due to
missing network support.
NOTE 3: 3GPP TS 23.221 [14] gives requirements related to failure of the USSD
request using IMS due to missing network support.
[TS 24.390, clause 4.5.4.2]:
In addition to the procedures specified in this subclause, the USSI AS shall
support the procedures specified in 3GPP TS 24.229 [6] for an AS.
NOTE 1: The Content-Language SIP header field is not used to determine the
language of the USSD string. Only the \ XML element is used.
Upon receiving an initial INVITE request with Request-URI containing the SIP
URI including the USSD string and a \"user\" URI parameter set to value
\"dialstring\" as specified in RFC 4967 [7], if the
application/vnd.3gpp.ussd+xml MIME body contained in the request is accepted
by the USSI AS, the USSI AS shall:
...
2) send 200 (OK) response to the request following the procedures specified
for AS acting as a terminating UA in 3GPP TS 24.229 [6]. The USSI AS shall
populate the 200 (OK) response to the request as follows:
a) Recv-Info header field containing the g.3gpp.ussd info-package name;
b) Accept header field containing the application/vnd.3gpp.ussd+xml,
application/sdp and multipart/mixed MIME types; and
c) SDP answer as described in subclause 4.5.2.
Upon receiving an ACK request associated with the INVITE request, the USSI AS
shall:
...
2) if the network successfully performed the USSD information and does not
need any further information, send a BYE request in order to terminate the
dialog. The USSI AS shall populate the BYE request with
application/vnd.3gpp.ussd+xml MIME body, as described in subclause 5.1.3
including a \ element and a \ element; and
3) if the network informs the UE that the network is unable to process the
USSD request or the network informs the UE that the network rejects the USSD
request, send a BYE request in order to terminate the dialog. The USSI AS
shall populate the BYE request with application/vnd.3gpp.ussd+xml MIME body,
as described in subclause 5.1.3, including, a \ element.
##### 8.40.3 Test description {#test-description-73 .H6}
##### 8.40.3.1 Pre-test conditions {#pre-test-conditions-73 .H6}
##### System Simulator: {#system-simulator-75 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-77 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-77 .H6}
\- The UE has registered to IMS, by executing the generic test procedure in
Annex A.2 up to the last step.
##### 8.40.3.2 Test procedure sequence {#test-procedure-sequence-72 .H6}
Table 8.40.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                 U - S              Message
1 Make the UE attempt an user initiated USSI with USSD string "*#60#". - - - -
2 Check: Does the UE send INVITE message? --> INVITE 1 P 3 SS sends a 100
Trying provisional response. \ ACK 2 P 6 SS
sends BYE to release the session. \ 200 OK 3 P
##### 8.40.3.3 Specific message content {#specific-message-content-4 .H6}
Table 8.40.3.3-1: INVITE (Step 2, table 8.40.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.1, | | | | | | Conditions A4 | | | | | | and A28. | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | **Request-Line** | | | | | +------------------+------+------------------+-----+-----------------+ | Request-URI | | Request-URI set | | | | | | to a SIP URI | | | | | | with user part | | | | | | including the | | | | | | percent-encoded | | | | | | USSD string as | | | | | | used at step 1 | | | | | | and a | | | | | | \ | | | | | | "phone-context\" | | | | | | parameter set to | | | | | | the home network | | | | | | domain name used | | | | | | in REGISTER | | | | | | request, a host | | | | | | part set to the | | | | | | home network | | | | | | domain name used | | | | | | in REGISTER | | | | | | request and a | | | | | | \"user\" URI | | | | | | parameter set to | | | | | | value | | | | | | \"dialstring\" | | | | | | | | | | | | Note: In USSD | | | | | | string *#60#, | | | | | | * may or may | | | | | | not be | | | | | | percent-encoded. | | | +------------------+------+------------------+-----+-----------------+ | **To** | | | | | +------------------+------+------------------+-----+-----------------+ | addr-spec | | same as Request | | | | | | URI | | | +------------------+------+------------------+-----+-----------------+ | tag | | not present | | | +------------------+------+------------------+-----+-----------------+ | Supported | | | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _timer_ \-- may | | RFC 4028 [37] | | | | or may not be | | | | | | present\ | | | | | | Note: this does | | | | | | not affect | | | | | | regulation of | | | | | | any other | | | | | | option-tags in | | | | | | the Supported | | | | | | header | | | +------------------+------+------------------+-----+-----------------+ | **Recv-Info** | | | | | +------------------+------+------------------+-----+-----------------+ | I | | _g.3gpp.ussd_ | | | | nfo-package-type | | | | | +------------------+------+------------------+-----+-----------------+ | **Accept** | | _application/vn | | | | | | d.3gpp.ussd+xml, | | | | | | application/sdp, | | | | | | multipart/mixed_ | | | | | | | | | | | | _(additional | | | | | | medias can be | | | | | | added in any | | | | | | order)_ | | | +------------------+------+------------------+-----+-----------------+ | **Content-Type** | | | | | +------------------+------+------------------+-----+-----------------+ | media-type | | _multipart/mix | | | | | | ed;boundary=_ any | | | | | | value | | | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | The following | | | | | | SDP types and | | | | | | values. | | | | | | | | | | | | --boundary | | | | | | value (as | | | | | | provided in SIP | | | | | | hdr | | | | | | Content-Type) | | | | | | | | | | | | Content-Type: | | | | | | application/sdp | | | | | | | | | | | | Session | | | | | | description: | | | | | | | | | | | | _v=0_ | | | | | | | | | | | | _o=_(usern | | | | | | ame)__(sess-id) | | | | | | (sess-version) | | | | | | _IN_ (addrtype) | | | | | | (unicast-address | | | | | | for UE) | | | | | | | | | | | | _s=_(session | | | | | | name) | | | | | | | | | | | | * | | | | | | c=IN _(addrtype) | | | | | | (co | | | | | | nnection-address | | | | | | for UE) [Note | | | | | | 1] | | | | | | | | | | | |_ b=AS _: | | | | | | ( | | | | | | bandwidth-value) | | | | | | | | | | | | Time | | | | | | description: | | | | | | | | | | | |_ t=_| | | | | | (start-time) | | | | | | (stop-time) | | | | | | | | | | | | Media | | | | | | description: | | | | | | | | | | | |_ m=_(media) 0 | | | | | | [Note2] | | | | | | | | | | | | * | | | | | | c=IN_ (addrtype) | | | | | | (co | | | | | | nnection-address | | | | | | for UE) [Note | | | | | | 1] | | | | | | | | | | | | _b=AS:_ | | | | | | ( | | | | | | bandwidth-value) | | | | | | | | | | | | --boundary | | | | | | value (as | | | | | | provided in SIP | | | | | | hdr | | | | | | Content-Type) | | | | | | | | | | | | _Content-Type: | | | | | | application/vn | | | | | | d.3gpp.ussd+xml_ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _(language | | | | | | )_\ _ | | | | | | [Note 3] | | | | | | | | | | | | _\ | | | | | | _( | | | | | | USSD string as | | | | | | used at step | | | | | | 1)_\ | | | | | | _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | --boundary | | | | | | value-- (as | | | | | | provided in SIP | | | | | | hdr | | | | | | Content-Type) | | | | | | | | | | | | Note 1: At least | | | | | | one \"c=\" field | | | | | | shall be | | | | | | present. | | | | | | | | | | | | Note 2: media is | | | | | | the type of | | | | | | media like | | | | | | _audio._ | | | | | | | | | | | | Note 3: language | | | | | | is the type of | | | | | | USSD language | | | | | | coded as defined | | | | | | in IETF RFC 5646 | | | | | | [153] | | | +------------------+------+------------------+-----+-----------------+
Table 8.40.3.3-1A: 100 Trying (Step 3, table 8.40.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.2, condition A1.
* * *
Table 8.40.3.3-2: 200 OK for INVITE (Step 4, table 8.40.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Annex A.3.1, | | | | | | conditions A1, A10, | | | | | | and A19 | | | | | +=====================+======+=====================+=====+===========+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | **Recv-Info** | | | | | +---------------------+------+---------------------+-----+-----------+ | Info-package-type | | _g.3gpp.ussd_ | | | +---------------------+------+---------------------+-----+-----------+ | **Accept** | | _application | | | | | | /vnd.3gpp.ussd+xml, | | | | | | application/sdp, | | | | | | multipart/mixed | | | | | | MIME types_ | | | +---------------------+------+---------------------+-----+-----------+ | **Content-Type** | | | | | +---------------------+------+---------------------+-----+-----------+ | media-type | | _application/sdp_ | | | +---------------------+------+---------------------+-----+-----------+ | **Message-body** | | SDP body of the 200 | | | | | | response copied | | | | | | from the received | | | | | | INVITE and modified | | | | | | as follows: | | | | | | | | | | | | _\- o=- 1111111111 | | | | | | 1111111111 IN_ | | | | | | (addrtype) | | | | | | (unicast-address | | | | | | for SS) | | | | | | | | | | | | - IP address on | | | | | | \"c=\" line changed | | | | | | to indicate to | | | | | | which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the media; | | | | | | | | | | | | - \"a=\" lines are | | | | | | all removed. | | | +---------------------+------+---------------------+-----+-----------+
Table 8.40.3.3-2A: ACK (Step 5, table 8.40.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.7, conditions A1 and A3.
* * *
Table 8.40.3.3-3: BYE (Step 6, table 8.40.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Annex A.2.8. | | | | | +=====================+======+=====================+=====+===========+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | **Content-Type** | | | | | +---------------------+------+---------------------+-----+-----------+ | media-type | | _application | | | | | | /vnd.3gpp.ussd+xml_ | | | +---------------------+------+---------------------+-----+-----------+ | **Message-body** | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ en\_ | | | | | | | | | | | | _\ 148*7 | | | | | | #\_ | | | | | | | | | | | | _\ _ | | | +---------------------+------+---------------------+-----+-----------+
Table 8.40.3.3-4: 200 OK for BYE (Step 7, table 8.40.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, conditions A5, A8, and A22.
* * *
## 8.41 Communication Forwarding on No Reply: MO Voice Call initiation with
preconditions
##### 8.41.1 Test Purpose (TP) {#test-purpose-tp-74 .H6}
##### (1) {#section-232 .H6}
**with** { UE being registered to IMS and configured to use preconditions and
being made to initiate a voice call }
**ensure that** {
**when** { Voice call initiation progressed until 180 Ringing (including
PRACK/200 OK) and UE receives 181 Call is being forwarded followed by 183
Session Progress }
**then** { UE completes call initiation with forwarded to UE by restarting
from PRACK for 183 Session Progress }
}
##### 8.41.2 Conformance Requirements {#conformance-requirements-75 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.604, clause 4.2.1.4]:
The CFNR service enables a served user to have the network redirect to another
user communications which are addressed to the served user\'s address, and for
which the connection is not established within a defined period of time. The
CFNR service may operate on all communications, or just those associated with
specified services. The served user\'s ability to originate communications is
unaffected by the CFNR supplementary service.
The CFNR service can only be invoked by the network after the communication
has been offered to the served user and an indication that the called user is
being informed of the communication has been received.
[TS 24.604, clause 4.5.2.1]:
When communication diversion has occurred on the served user side and the
network option \"_Originating_ \" user receives notification that his
communication has been diverted (forwarded or deflected)\" is set to true, the
originating UA may receive a 181 (Call is being forwarded) response according
to the procedures described in 3GPP TS 24.229.
The Information given by the History header could be displayed by the UA if it
is a UE.
[TS 24.229, clause 9.2.3]:
Since the UE does not know that forking has occurred until a second
provisional response arrives, the UE will request the radio/bearer resources
as required by the first provisional response. For each subsequent provisional
response that may be received, different alternative actions may be performed
depending on the requirements in the SDP answer:
\- the UE has sufficient radio/bearer resources to handle the media specified
in the SDP of the subsequent provisional response, or
\- the UE must request additional radio/bearer resources to accommodate the
media specified in the SDP of the subsequent provisional response.
NOTE 1: When several forked responses are received, the resources requested by
the UE is the \"logical OR\" of the resources indicated in the multiple
responses to avoid allocation of unnecessary resources. The UE does not
request more resources than proposed in the original INVITE request.
NOTE 2: When service-based local policy is applied, the UE receives the same
authorization token for all forked requests/responses related to the same SIP
session.
When an 199 (Early Dialog Terminated) response for the INVITE request is
received for an early dialogue, the UE shall release reserved radio/bearer
resources associated with that early dialogue.
When the first final 200 (OK) response for the INVITE request is received for
one of the early dialogues, the UE proceeds to set up the SIP session using
the radio/bearer resources required for this session. Upon the reception of
the first final 200 (OK) response for the INVITE request, the UE shall release
all unneeded radio/bearer resources.
GIBA:
NOTE 1: GIBA does not allow SIP requests to be protected using an IPsec
security association because it does not perform a key agreement procedure.
##### 8.41.3 Test description {#test-description-74 .H6}
##### 8.41.3.1 Pre-test conditions {#pre-test-conditions-74 .H6}
##### System Simulator: {#system-simulator-76 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-78 .H6}
\- The UE contains either ISIM and USIM applications or only USIM application
on UICC.
\- The UE is configured to register for IMS after switch on.
\- The UE is configured to use preconditions.
##### Preamble: {#preamble-78 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS
##### 8.41.3.2 Test procedure sequence {#test-procedure-sequence-73 .H6}
Table 8.41.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                              U - S              Message
1 UE is made to attempt an IMS voice call. - - - - 2-7 Steps 2-7 of generic
procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21] are performed. -
- - - \- EXCEPTION: In parallel with Step 8-12, parallel behaviour defined in
table 8.41.3.2-2 takes place - - - - 8-12 Steps 1-5 as defined in Annex A.4.1a
are executed. - - - - 12A Step 10 of generic procedure specified in Table
4.9.15.2.2-1 of TS 38.508-1 [21] is performed. - - - - \- EXCEPTION: In
parallel to steps 12B and 12C below, step 13 occurs. - - - - 12B-12C Steps
11-12 of generic procedure specified in Table 4.9.15.2.2-1 of TS 38.508-1 [21]
are performed. - - - - 13-17 Steps 6-10 of Annex A.4.1a happen. - - - - 18 SS
sends 181 response to indicate that call forwarding has been started as the
user did not answer to the phone \ PRACK 1 P 21 SS
responds to PRACK containing an SDP answer. \ PRACK - - 24
The SS responds PRACK with 200 OK. \ ACK - -
27 UE is made to release the call - - - - 28-29 Steps 1-2 in Annex A.7 are
performed. - - - -
Table 8.41.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 8.41.3.3 Specific message content {#specific-message-content-5 .H6}
Table 8.41.3.3-1: 181 Call is being forwarded for INVITE (Step 18, table
8.41.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.14.
* * *
Table 8.41.3.3-2: 183 Session Progress for INVITE (Step 19, table 8.41.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.3, condition | | | | | | A1 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | **To** | | | | | +------------------+------+------------------+-----+-----------------+ | tag | | different tag | | | | | | must be used | | | | | | than the one | | | | | | used in steps | | | | | | 8-17 as this | | | | | | response is now | | | | | | from another UE | | | | | | and belongs to | | | | | | another dialog | | | | | | instance. Note | | | | | | that this new | | | | | | tag must be used | | | | | | within the rest | | | | | | of the steps | | | | | | (18-29) in this | | | | | | test case | | | | | | instead of the | | | | | | tag used within | | | | | | steps 8-17 | | | +------------------+------+------------------+-----+-----------------+ | **Contact** | | | | | +------------------+------+------------------+-----+-----------------+ | addr-spec | | different URI | | | | | | must be used | | | | | | than the one | | | | | | used in step 9 | | | | | | as this is | | | | | | supposed now to | | | | | | represent | | | | | | another UE to | | | | | | which the call | | | | | | is being | | | | | | forwarded. Note | | | | | | that this new | | | | | | Contact must be | | | | | | used within the | | | | | | rest of the | | | | | | steps (20-21) in | | | | | | this test case. | | | +------------------+------+------------------+-----+-----------------+ | **Require** | | | | | +------------------+------+------------------+-----+-----------------+ | option-tag | | _precondition_ | | | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | Same contents as | | RFC 4566 [38] | | | | specified in | | | | | | step 3 annex | | | | | | A.4.1a except | | | | | | for o-line: | | | | | | | | | | | | _o=- 1111111112 | | | | | | 1111111111 IN_ | | | | | | (addrtype) | | | | | | (unicast-address | | | | | | for new remote | | | | | | UE). | | | +------------------+------+------------------+-----+-----------------+
Table 8.41.3.3-3: PRACK (Step 20, table 8.41.3.2-1)
* * *
Derivation Path: Annex A.4.1a, step 6 UPDATE with o-line not being checked
* * *
Table 8.41.3.3-4: 200 OK for PRACK (Step 21 and 24, table 8.41.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Annex A.3.1, | | | | | | conditions A10 and | | | | | | A22 | | | | | +=====================+======+=====================+=====+===========+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | **Require** | | | | | +---------------------+------+---------------------+-----+-----------+ | option-tag | | _precondition_ | | | +---------------------+------+---------------------+-----+-----------+ | **Content-Type** | | | | | +---------------------+------+---------------------+-----+-----------+ | media-type | | _application/sdp_ | | | +---------------------+------+---------------------+-----+-----------+ | **Content-Length** | | | | | +---------------------+------+---------------------+-----+-----------+ | value | | length of | | | | | | message-body | | | +---------------------+------+---------------------+-----+-----------+ | **Message-body** | | SDP body of the 200 | | | | | | response copied | | | | | | from the received | | | | | | PRACK and modified | | | | | | as follows: | | | | | | | | | | | | - IP address on | | | | | | \"c=\" lines and | | | | | | transport port on | | | | | | \"m=\" lines | | | | | | changed to indicate | | | | | | to which IP address | | | | | | and port the UE | | | | | | should start | | | | | | sending the media; | | | | | | | | | | | | - \"o=\" line | | | | | | identical to | | | | | | previous SDP sent | | | | | | by SS except that | | | | | | sess-version is | | | | | | incremented; | | | | | | | | | | | | _-_ Attributes for | | | | | | preconditions: | | | | | | _a=curr:qos remote | | | | | | sendrecv_ | | | +---------------------+------+---------------------+-----+-----------+
Table 8.41.3.3-5: 180 Ringing for INVITE (Step 22, table 8.41.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.2.4 with conditions A1 and A7
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec Same value as in the 183 response of step 19  
**History-Info**  
hi-targeted-to-uri Same value as in the 181 response of step 18  
hi-index Same value as in the 181 response of step 18
Table 8.41.3.3-5a: PRACK (Step 23, table 8.41.3.2-1)
* * *
Derivation Path: Annex A.4.1a, step 9.
* * *
Table 8.41.3.3-6: 200 OK for INVITE (Step 25, table 8.41.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.3.1, conditions A1, A10, and A19
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec Same value as in the 183 response of step 19  
**History-Info**  
hi-targeted-to-uri Same value as in the 181 response of step 18  
hi-index Same value as in the 181 response of step 18
Table 8.41.3.3-7: ACK (Step 26, table 8.41.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.7, conditions A1
* * *
# 9 SMS
## 9.1 Mobile Originating SMS / 5GS
##### 9.1.1 Test Purpose (TP) {#test-purpose-tp-75 .H6}
##### (1) {#section-233 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE is made to send an SMS over IP }
**then** { UE sends a SIP MESSAGE request containing a short message }
}
##### (2) {#section-234 .H6}
**with** { UE having sent a SIP MESSAGE request containing a short message }
**ensure that** {
**when** { UE receives a 202 Accepted response, followed by a SIP MESSAGE
request containing a submission report }
**then** { UE sends a 200 OK response }
}
##### (3) {#section-235 .H6}
**with** { UE having sent a 200 OK response for submission report }
**ensure that** {
**when** { UE receives a SIP MESSAGE request containing a status report }
**then** { UE sends a 200 OK response, followed by a SIP MESSAGE request
containing a delivery report for status report }
}
##### 9.1.2 Conformance Requirements {#conformance-requirements-76 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.341, clause 5.3.1.2]:
When an SM-over-IP sender wants to submit an SM over IP, the SM-over-IP sender
shall send a SIP MESSAGE request with the following information:
a) the Request-URI, which shall contain the PSI of the SC of the SM-over-IP
sender;
NOTE 1: The PSI of the SC can be SIP URI or tel URI based on operator policy.
The PSI of the SC can be obtained using one of the following methods in the
priority order listed below:
1) provided by the user;
2) if UICC is used, then:
\- if present in the ISIM, then the PSI of the SC is obtained from the
EF~PSISMSC~ in DF_TELECOM of the ISIM as per 3GPP TS 31.103 [18];
\- if not present on the ISIM, then the PSI of the SC is obtained from the
EF~PSISMSC~ in DF_TELECOM of the USIM as per 3GPP TS 31.102 [19]; or
\- if neither present on the ISIM nor on the USIM, then the PSI of the SC
contains the **_TSâ€‘Service-Centre-Address_** stored in the EF~SMSP~ in
DF_TELECOM as per 3GPP TS 31.102 [19]. If the PSI of the SC is based on the
E.164 number from the **_TSâ€‘Service-Centre-Address_** stored in the EF~SMSP~
in DF_TELECOM then the URI constructed can be either a tel URI or a SIP URI
(using the \"user=phone\" SIP URI parameter format).
3) if SIM is used instead of UICC, then the PSI of the SC contains the
**_TSâ€‘Service Centre Address_** stored in the EF~SMSP~ in DF_TELECOM as per
3GPP TS 51.011 [20]. If the PSI of the SC is based on the E.164 number from
the **_TSâ€‘Service-Centre-Address_** stored in the EF~SMSP~ in DF_TELECOM then
the URI constructed can be either a tel URI or a SIP URI (using the
\"user=phone\" SIP URI parameter format); or
4) if neither the UICC nor SIM is used, then how the PSI of the SC is
configured and obtained is through means outside the scope of this
specification.
b) the From header, which shall contain a public user identity of the SM-over-
IP sender;
NOTE 2: The IP-SM-GW will have to use an address of the SM-over-IP sender that
the SC can process (i.e. an E.164 number). This address will come from a tel
URI in a P-Asserted-Identity header (as defined in RFC 3325 [13]) placed in
the SIP MESSAGE request by the P-CSCF or S-CSCF.
NOTE 3: The SM-over-IP sender has to store the Call-ID of the SIP MESSAGE
request, so it can associate the appropriate SIP MESSAGE request including a
submit report with it.
c) the To header, which shall contain the SC of the SM-over-IP sender;
d) the Content-Type header, which shall contain \"application/vnd.3gpp.sms\";
and
e) the body of the request shall contain an RP-DATA message as defined in 3GPP
TS 24.011 [8], including the SMS headers and the SMS user information encoded
as specified in 3GPP TS 23.040 [3].
NOTE 4: The address of the SC is included in the RP-DATA message content. The
address of the SC included in the RP-DATA message content is stored in the
EF~SMSP~ in DF_TELECOM of the (U)SIM of the SM-over-IP sender.
NOTE 5: The SM-over-IP sender will use content transfer encoding of type
\"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.
NOTE 6: Both the address of the SC and the PSI of the SC can be configured in
the EF~PSISMSC~ in DF_TELECOM of the USIM and ISIM respectively using the USAT
as per 3GPP TS 31.111 [21].
The SM-over-IP sender may request the SC to return the status of the submitted
message. The support of status report capabilities is optional for the SC.
When a SIP MESSAGE request including a submit report in the \"vnd.3gpp.sms\"
payload is received, the SM-over-IP sender shall:
\- if SM-over-IP sender supports In-Reply-To header usage and the In-Reply-To
header indicates that the request corresponds to a short message submitted by
the SM-over-IP sender, generate a 200 (OK) SIP response according to RFC 3428
[14].
if SM-over-IP sender supports In-Reply-To header usage and the In-Reply-To
header indicates that the request does not correspond to a short message
submitted by the SM-over-IP sender, a 488 (Not Acceptable here) SIP response
according to RFC 3428 [14].
\- if SM-over-IP sender does not support In-Reply-To header usage, generate a
200 (OK) SIP response according to RFC 3428 [14]; and extract the payload
encoded according to 3GPP TS 24.011 [8] for RP-ACK or RP-ERROR.
[TS 24.341 clause 5.3.1.3]:
When a SIP MESSAGE request including a status report in the \"vnd.3gpp.sms\"
payload is delivered, the SM-over-IP sender shall:
\- generate a SIP response according to RFC 3428 [14];
\- extract the payload encoded according to 3GPP TS 24.011 [8] for RP-DATA;
and
\- create a delivery report for the status report as described in subclause
5.3.2.4. The content of the delivery report is defined in 3GPP TS 24.011 [8].
[TS 24.341 clause 5.3.2.4]:
When an SM-over-IP receiver wants to send an SM delivery report over IP, the
SM-over-IP receiver shall send a SIP MESSAGE request with the following
information:
a) the Request-URI, which shall contain the IP-SM-GW;
NOTE 1: The address of the IP-SM-GW is received in the P-Asserted-Identity
header in the SIP MESSAGE request including the delivered short message.
b) the From header, which shall contain a public user identity of the SM-over-
IP receiver.
c) the To header, which shall contain the IP-SM-GW;
b) the Content-Type header shall contain \"application/vnd.3gpp.sms\"; and
c) the body of the request shall contain the RP-ACK or RP-ERROR message for
the SM delivery report, as defined in 3GPP TS 24.011 [8].
NOTE 2: The SM-over-IP sender will use content transfer encoding of type
\"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.
##### 9.1.3 Test description {#test-description-75 .H6}
##### 9.1.3.1 Pre-test conditions {#pre-test-conditions-75 .H6}
##### System Simulator: {#system-simulator-77 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-79 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-79 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 9.1.3.2 Test procedure sequence {#test-procedure-sequence-74 .H6}
Table 9.1.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
1 UE is made to attempt a Mobile Originating SMS over IMS - - - - 1A-1F Steps
2-7 of generic procedure specified in Table 4.9.19.2.2-1 of TS 38.508-1 [21]
are performed. - - - - \- EXCEPTION: In parallel with Step 2, parallel
behaviour defined in table 9.1.3.2-2 takes place - - - - 2 Check: Does UE send
a SIP MESSAGE request including a vnd.3gpp.sms payload that contains a short
message? --> SIP MESSAGE 1 P 3 SS responds with 202 Accepted \ 200 OK 2 P 6 SS sends a
SIP MESSAGE request including a vnd.3gpp.sms payload that contains a status
report \ 200 OK
3 P 8 Check: Does UE send a SIP MESSAGE request including a vnd.3gpp.sms
payload that contains an acknowledgement for the status report received at
Step 6? --> SIP MESSAGE 3 P 9 SS responds with 202 Accepted \ NR RRC:
_RRCReconfigurationComplete_ \- -
##### 9.1.3.3 Specific message contents {#specific-message-contents-69 .H6}
Table 9.1.3.3-1: SIP MESSAGE (step 2, table 9.1.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.7.3, Condition A5
* * *
Table 9.1.3.3-2: 202 Accepted (step 3 and 9, table 9.1.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.3
* * *
Table 9.1.3.3-3: SIP MESSAGE (step 4, table 9.1.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.7.4
* * *
Table 9.1.3.3-4: 200 OK (step 5 and 7, table 9.1.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.1, Condition A5 and
A22
* * *
Table 9.1.3.3-5: SIP MESSAGE (step6, table 9.1.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.7.5
* * *
Table 9.1.3.3-6: SIP MESSAGE (step 8, table 9.1.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.7.6
* * *
## 9.2 Mobile Terminating SMS / 5GS
##### 9.2.1 Test Purpose (TP) {#test-purpose-tp-76 .H6}
##### (1) {#section-236 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE receives a SIP MESSAGE request containing a short message }
**then** { UE sends a 200 OK response, followed by a SIP MESSAGE request
containing a delivery report }
}
##### 9.2.2 Conformance Requirements {#conformance-requirements-77 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.341, clause 5.3.2.3]
When a SIP MESSAGE request including a short message in the \"vnd.3gpp.sms\"
payload is delivered, the SM-over-IP receiver shall:
\- generate a SIP response according to RFC 3428;
\- extract the payload encoded according to 3GPP TS 24.011 for RP-DATA; and
\- create a delivery report as described in subclause 5.3.2.4. The content of
the report is defined in 3GPP TS 24.011.
[TS 24.341, clause 5.3.2.4]
When an SM-over-IP receiver wants to send an SM delivery report over IP, the
SM-over-IP receiver shall send a SIP MESSAGE request with the following
information:
a) the Request-URI, which shall contain the IP-SM-GW;
NOTE 1: The address of the IP-SM-GW is received in the P-Asserted-Identity
header in the SIP MESSAGE request including the delivered short message.
b) the From header, which shall contain a public user identity of the SM-over-
IP receiver.
c) the To header, which shall contain the IP-SM-GW;
b) the Content-Type header shall contain \"application/vnd.3gpp.sms\"; and
c) the body of the request shall contain the RP-ACK or RP-ERROR message for
the SM delivery report, as defined in 3GPP TS 24.011 [8].
NOTE 2: The SM-over-IP sender will use content transfer encoding of type
\"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.
##### 9.2.3 Test description {#test-description-76 .H6}
##### 9.2.3.1 Pre-test conditions {#pre-test-conditions-76 .H6}
##### System Simulator: {#system-simulator-78 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-80 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-80 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 9.2.3.2 Test procedure sequence {#test-procedure-sequence-75 .H6}
Table 9.2.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
0A-0H Steps 1-8 of generic procedure specified in Table 4.9.20.2.2-1 of TS
38.508-1 [21] are performed. - - - - 1 The SS sends a Short Message. \ 200 OK 1 P 3
Check: Does the UE respond with a delivery report? --> SIP MESSAGE 1 P 4 The
SS sends a 202 ACCEPTED response. \ | | | | | character | | | +----------------+----------------+----------------+---------------+ | 04 | Application | SMS Control | No | | | port | | | | | addressing | | | | | scheme, 8 bit | | | | | address | | | +----------------+----------------+----------------+---------------+ | 05 | Application | SMS Control | No | | | port | | | | | addressing | | | | | scheme, 16 bit | | | | | address | | | +----------------+----------------+----------------+---------------+ | 06 | SMSC Control | SMS Control | No | | | Parameters | | | +----------------+----------------+----------------+---------------+ | 07 | UDH Source | SMS Control | Yes | | | Indicator | | | +----------------+----------------+----------------+---------------+ | 08 | Concatenated | SMS Control | No | | | short message, | | | | | 16-bit | | | | | reference | | | | | number | | | +----------------+----------------+----------------+---------------+ | 09 | Wireless | SMS Control | Note 3 | | | Control | | | | | Message | | | | | Protocol | | | +----------------+----------------+----------------+---------------+ | 0A | Text | EMS Control | Yes | | | Formatting | | | +----------------+----------------+----------------+---------------+ | 0B | Predefined | EMS Content | Yes | | | Sound | | | +----------------+----------------+----------------+---------------+ | 0C | User Defined | EMS Content | Yes | | | Sound (iMelody | | | | | max 128 bytes) | | | +----------------+----------------+----------------+---------------+ | 0D | Predefined | EMS Content | Yes | | | Animation | | | +----------------+----------------+----------------+---------------+ | 0E | Large | EMS Content | Yes | | | Animation | | | | | (16*16 times | | | | | 4 = 32*4 =128 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 0F | Small | EMS Content | Yes | | | Animation | | | | | (8*8 times 4 | | | | | = 8*4 =32 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 10 | Large Picture | EMS Content | Yes | | | (32*32 = 128 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 11 | Small Picture | EMS Content | Yes | | | (16*16 = 32 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 12 | Variable | EMS Content | Yes | | | Picture | | | +----------------+----------------+----------------+---------------+ | 13 | User prompt | EMS Control | Yes | | | indicator | | | +----------------+----------------+----------------+---------------+ | 14 | Extended | EMS Content | Yes | | | Object | | | +----------------+----------------+----------------+---------------+ | 15 | Reused | EMS Control | Yes | | | Extended | | | | | Object | | | +----------------+----------------+----------------+---------------+ | 16 | Compression | EMS Control | No | | | Control | | | +----------------+----------------+----------------+---------------+ | 17 | Object | EMS Control | Yes | | | Distribution | | | | | Indicator | | | +----------------+----------------+----------------+---------------+ | 18 | Standard WVG | EMS Content | Yes | | | object | | | +----------------+----------------+----------------+---------------+ | 19 | Character Size | EMS Content | Yes | | | WVG object | | | +----------------+----------------+----------------+---------------+ | 1A | Extended | EMS Control | No | | | Object Data | | | | | Request | | | | | Command | | | +----------------+----------------+----------------+---------------+ | 1B-1F | Reserved for | N/A | N/A | | | future EMS | | | | | features (see | | | | | subclause | | | | | 3.10) | | | +----------------+----------------+----------------+---------------+ | 20 | RFC 5322 | SMS Control | No | | | E-Mail Header | | | +----------------+----------------+----------------+---------------+ | 21 | Hyperlink | SMS Control | Yes | | | format element | | | +----------------+----------------+----------------+---------------+ | 22 | Reply Address | SMS Control | No | | | Element | | | +----------------+----------------+----------------+---------------+ | 23 | Enhanced Voice | SMS Control | No | | | Mail | | | | | Information | | | +----------------+----------------+----------------+---------------+ | 24 | National | SMS Control | No | | | Language | | | | | Single Shift | | | +----------------+----------------+----------------+---------------+ | 25 | National | SMS Control | No | | | Language | | | | | Locking Shift | | | +----------------+----------------+----------------+---------------+ | 26 -- 6F | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | 70 -- 7F | (U)SIM Toolkit | SMS Control | Note 1 | | | Security | | | | | Headers | | | +----------------+----------------+----------------+---------------+ | 80 -- 9F | SME to SME | SMS Control | Note 2 | | | specific use | | | +----------------+----------------+----------------+---------------+ | A0 -- BF | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | C0 -- DF | SC specific | SMS Control | Note 2 | | | use | | | +----------------+----------------+----------------+---------------+ | E0 -- FF | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | Note 1: The | | | | | functionality | | | | | of these IEIs | | | | | is defined in | | | | | 3GPP TSG | | | | | 31.115 [28], | | | | | and therefore, | | | | | the | | | | | repeatability | | | | | is not within | | | | | the scope of | | | | | this document | | | | | and will not | | | | | be determined | | | | | here. | | | | | | | | | | Note 2: The | | | | | functionality | | | | | of these IEIs | | | | | is used in a | | | | | proprietary | | | | | fashion by | | | | | different SMSC | | | | | vendors, and | | | | | therefore, are | | | | | not within the | | | | | scope of this | | | | | technical | | | | | specification. | | | | | | | | | | Note 3: The | | | | | functionality | | | | | of these IEIs | | | | | is defined by | | | | | the WAP Forum | | | | | and therefore | | | | | the | | | | | repeatability | | | | | is not within | | | | | the scope of | | | | | this document | | | | | and will not | | | | | be determined | | | | | here. | | | | +----------------+----------------+----------------+---------------+
A receiving entity shall ignore (i.e. skip over and commence processing at the
next information element) any information element where the IEI is Reserved or
not supported. The receiving entity calculates the start of the next
information element by looking at the length of the current information
element and skipping that number of octets.
The SM itself may be coded as 7, 8 or 16 bit data.
If 7 bit data is used and the TPâ€‘UDâ€‘Header does not finish on a septet
boundary then fill bits are inserted after the last Information Element Data
octet up to the next septet boundary so that there is an integral number of
septets for the entire TPâ€‘UD header. This is to ensure that the SM itself
starts on an septet boundary so that an earlier Phase mobile shall be capable
of displaying the SM itself although the TPâ€‘UD Header in the TPâ€‘UD field may
not be understood.
It is optional to make the first character of the SM itself a Carriage Return
character encoded according to the default 7 bit alphabet so that earlier
Phase mobiles, which do not understand the TPâ€‘UDâ€‘Header, shall overâ€‘write the
displayed TPâ€‘UDâ€‘Header with the SM itself.
If 16 bit (USC2) data is used then padding octets are not necessary. The SM
itself shall start on an octet boundary.
If 8 bit data is used then padding is not necessary. An earlier Phase mobile
shall be able to display the SM itself although the TPâ€‘UD header may not be
understood.
It is also possible for mobiles not wishing to support the TPâ€‘UD header to
check the value of the TPâ€‘UDHI bit in the SMSâ€‘Deliver PDU and the first octet
of the TPâ€‘UD field and skip to the start of the SM and ignore the TPâ€‘UD
header.
[TS 23.040, clause 9.2.3.24.1]:
This facility allows short messages to be concatenated to form a longer
message.
In the case of uncompressed 8â€‘bit data, the maximum length of the short
message within the TPâ€‘UD field is 134 (140â€‘6) octets.
In the case of uncompressed GSM 7 bit default alphabet data, the maximum
length of the short message within the TPâ€‘UD field is 153 (160â€‘7) characters.
A character represented by an escape-sequence shall not be split in the
middle.
In the case of 16 bit uncompressed USC2 data, the maximum length of the short
message within the TPâ€‘UD field is 67 ((140â€‘6)/2) characters. A UCS2 character
shall not be split in the middle; if the length of the User Data Header is
odd, the maximum length of the whole TP-UD field is 139 octets.
In the case of compressed GSM 7 bit default alphabet data, 8 bit data or UCS2
the maximum length of the compressed short message within the TP-UD field is
134 (140-6) octets including the Compression Header and Compression Footer,
both or either of which may be present (see clause 3.9).
The maximum length of an uncompressed concatenated short message is 39015
(255*153) default alphabet characters, 34170 (255*134) octets or 17085
(255*67) UCS2 characters.
The maximum length of a compressed concatenated message is 34170 (255*134)
octets including the Compression Header and Compression Footer (see clause 3.9
and figure 9.2.3.24.1(a) below).
Figure 9.2.3.24.1 (a): Concatenation of a Compressed short message
The Informationâ€‘Elementâ€‘Data field contains information set by the application
in the SMSâ€‘SUBMIT so that the receiving entity is able to reâ€‘assemble the
short messages in the correct order. Each concatenated short message contains
a reference number which together with the originating address and Service
Centre address allows the receiving entity to discriminate between
concatenated short messages sent from different originating SMEs and/or SCs.
In a network which has multiple SCs, it is possible for different segments of
a concatenated SM to be sent via different SCs and so it is recommended that
the SC address should not be checked by the MS unless the application
specifically requires such a check.
The TP elements in the SMSâ€‘SUBMIT PDU, apart from TPâ€‘MR, TP-SRR, TPâ€‘UDL and
TPâ€‘UD, should remain unchanged for each SM which forms part of a concatenated
SM, otherwise this may lead to irrational behaviour. TP-MR must be incremented
for every segment of a concatenated message as defined in clause 9.2.3.6. A SC
shall handle segments of a concatenated message like any other short message.
The relation between segments of a concatenated message is made only at the
originator, where the message is segmented, and at the recipient, where the
message is reassembled. SMSâ€‘COMMANDs identify messages by TP-MR and therefore
apply to only one segment of a concatenated message. It is up to the
originating SME to issue SMS-COMMANDs for all the required segments of a
concatenated message.
The Informationâ€‘Elementâ€‘Data octets shall be coded as follows.
Octet 1 Concatenated short message reference number.
This octet shall contain a modulo 256 counter indicating the reference number
for a particular concatenated short message. This reference number shall
remain constant for every short message which makes up a particular
concatenated short message.
Octet 2 Maximum number of short messages in the concatenated short message.
This octet shall contain a value in the range 0 to 255 indicating the total
number of short messages within the concatenated short message. The value
shall start at 1 and remain constant for every short message which makes up
the concatenated short message. If the value is zero then the receiving entity
shall ignore the whole Information Element.
Octet 3 Sequence number of the current short message.
This octet shall contain a value in the range 0 to 255 indicating the sequence
number of a particular short message within the concatenated short message.
The value shall start at 1 and increment by one for every short message sent
within the concatenated short message. If the value is zero or the value is
greater than the value in octet 2 then the receiving entity shall ignore the
whole Information Element.
The IEI and associated IEI length and IEI data shall be present in every
segment of the concatenated SM.
[TS 24.341, clause 5.3.2.3]
When a SIP MESSAGE request including a short message in the \"vnd.3gpp.sms\"
payload is delivered, the SM-over-IP receiver shall:
\- generate a SIP response according to RFC 3428;
\- extract the payload encoded according to 3GPP TS 24.011 for RP-DATA; and
\- create a delivery report as described in subclause 5.3.2.4. The content of
the report is defined in 3GPP TS 24.011.
[TS 24.341, clause 5.3.2.4]
When an SM-over-IP receiver wants to send an SM delivery report over IP, the
SM-over-IP receiver shall send a SIP MESSAGE request with the following
information:
a) the Request-URI, which shall contain the IP-SM-GW;
NOTE 1: The address of the IP-SM-GW is received in the P-Asserted-Identity
header in the SIP MESSAGE request including the delivered short message.
b) the From header, which shall contain a public user identity of the SM-over-
IP receiver.
c) the To header, which shall contain the IP-SM-GW;
b) the Content-Type header shall contain \"application/vnd.3gpp.sms\"; and
c) the body of the request shall contain the RP-ACK or RP-ERROR message for
the SM delivery report, as defined in 3GPP TS 24.011 [8].
NOTE 2: The SM-over-IP sender will use content transfer encoding of type
\"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.
##### 9.3.3 Test description {#test-description-77 .H6}
##### 9.3.3.1 Pre-test conditions {#pre-test-conditions-77 .H6}
##### System Simulator: {#system-simulator-79 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-81 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- SMS over IP is enabled.
##### Preamble: {#preamble-81 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 9.3.3.2 Test procedure sequence {#test-procedure-sequence-76 .H6}
Table 9.3.3.2-1: Main Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                            U - S              Message
1 UE is made to send a Concatenated SMS over IP (The length of SMS text is
determined so that the amount of segments of the concatenated SMS is three). -
- - - 1A-1F Steps 2-7 of generic procedure specified in Table 4.9.19.2.2-1 of
TS 38.508-1 [21] are performed. - - - - \- EXCEPTION: In parallel with Step 2,
parallel behaviour defined in table 9.3.3.2-2 takes place - - - - 2 Check:
Does the UE send a SIP MESSAGE request including a vnd.3gpp.sms payload that
contains the first segment of the concatenated SMS? --> SIP MESSAGE request 1
P 3 SS responds with 202 Accepted. \ 200 OK 2 P 6 Check:
Does the UE send a SIP MESSAGE request including a vnd.3gpp.sms payload that
contains the second segment of the concatenated SMS? --> SIP MESSAGE request 2
P 7 SS responds with 202 Accepted. \ 200 OK 3 P 10 Check:
Does the UE send a SIP MESSAGE request including a vnd.3gpp.sms payload that
contains the final segment of the concatenated SMS? --> SIP MESSAGE request 3
P 11 SS responds with 202 Accepted. \ 200 OK 4 P
Table 9.3.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 9.3.3.3 Specific message contents {#specific-message-contents-71 .H6}
Table 9.3.3.3-1: MESSAGE for MO SMS (step 2, table 9.3.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.7.3 | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | **Message-body** | | - TP-UDHI='1'B | | TS 24.011 [25] | | | | (The beginning | | | | | | of the TP UD | | TS 23.040 [24] | | | | field contains a | | | | | | Header in | | | | | | addition to the | | | | | | short message.) | | | | | | | | | | | | - TP-MR=any | | | | | | allowed value | | | | | | | | | | | | - TP-UD | | | | | | | | | | | | - Length of | | | | | | User Data Header | | | | | | (UDHL)=5 | | | | | | | | | | | | - Information | | | | | | Element | | | | | | Identifier | | | | | | (IEI)=0x00 | | | | | | (Concatenated | | | | | | short messages, | | | | | | 8-bit reference | | | | | | number) | | | | | | | | | | | | - Length of | | | | | | Information | | | | | | Element | | | | | | (IEIDL)=3 | | | | | | | | | | | | - Concatenated | | | | | | short message | | | | | | reference | | | | | | number=any | | | | | | allowed value | | | | | | | | | | | | - Maximum | | | | | | number of short | | | | | | messages in the | | | | | | concatenated | | | | | | short message=3 | | | | | | | | | | | | - Sequence | | | | | | number of the | | | | | | current short | | | | | | message=1 | | | +------------------+------+------------------+-----+------------------+
Table 9.3.3.3-2: 202 ACCEPTED (step 3, table 9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.3
* * *
Table 9.3.3.3-3: Short message submission report for MO SMS (step 4, table
9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in annex A.7.4
* * *
Table 9.3.3.3-4: 200 OK for other requests than REGISTER or SUBSCRIBE (step 5,
table 9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.1, Condition A5, A22
* * *
Table 9.3.3.3-5: MESSAGE for MO SMS (step 6, table 9.3.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.7.3 | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | **Message-body** | | - TP-UDHI='1'B | | TS 24.011 [25] | | | | (The beginning | | | | | | of the TP UD | | TS 23.040 [24] | | | | field contains a | | | | | | Header in | | | | | | addition to the | | | | | | short message.) | | | | | | | | | | | | - TP-MR= The | | | | | | value sent in | | | | | | the step1 + 1 | | | | | | (incremented) | | | | | | | | | | | | - TP-UD | | | | | | | | | | | | - Length of | | | | | | User Data Header | | | | | | (UDHL)=5 | | | | | | | | | | | | - Information | | | | | | Element | | | | | | Identifier | | | | | | (IEI)=0x00 | | | | | | (Concatenated | | | | | | short messages, | | | | | | 8-bit reference | | | | | | number) | | | | | | | | | | | | - Length of | | | | | | Information | | | | | | Element | | | | | | (IEIDL)=3 | | | | | | | | | | | | - Concatenated | | | | | | short message | | | | | | reference | | | | | | number= The same | | | | | | value sent in | | | | | | the step1 | | | | | | | | | | | | - Maximum | | | | | | number of short | | | | | | messages in the | | | | | | concatenated | | | | | | short message=3 | | | | | | | | | | | | - Sequence | | | | | | number of the | | | | | | current short | | | | | | message=2 | | | +------------------+------+------------------+-----+------------------+
Table 9.3.3.3-6: 202 ACCEPTED (step 7, table 9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.3
* * *
Table 9.3.3.3-7: Short message submission report for MO SMS (step 8, table
9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in annex A.7.4
* * *
Table 9.3.3.3-8: 200 OK for other requests than REGISTER or SUBSCRIBE (step 9,
table 9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.1, Condition A5, A22
* * *
Table 9.3.3.3-9: MESSAGE for MO SMS (step 10, table 9.3.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.7.3 | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | **Message-body** | | - TP-UDHI='1'B | | TS 24.011 [25] | | | | (The beginning | | | | | | of the TP UD | | TS 23.040 [24] | | | | field contains a | | | | | | Header in | | | | | | addition to the | | | | | | short message.) | | | | | | | | | | | | - TP-MR= The | | | | | | value sent in | | | | | | the step5 + 1 | | | | | | (incremented) | | | | | | | | | | | | - TP-UD | | | | | | | | | | | | - Length of | | | | | | User Data Header | | | | | | (UDHL)=5 | | | | | | | | | | | | - Information | | | | | | Element | | | | | | Identifier | | | | | | (IEI)=0x00 | | | | | | (Concatenated | | | | | | short messages, | | | | | | 8-bit reference | | | | | | number) | | | | | | | | | | | | - Length of | | | | | | Information | | | | | | Element | | | | | | (IEIDL)=3 | | | | | | | | | | | | - Concatenated | | | | | | short message | | | | | | reference | | | | | | number= The same | | | | | | value sent in | | | | | | the step5 | | | | | | | | | | | | - Maximum | | | | | | number of short | | | | | | messages in the | | | | | | concatenated | | | | | | short message=3 | | | | | | | | | | | | - Sequence | | | | | | number of the | | | | | | current short | | | | | | message=3 | | | +------------------+------+------------------+-----+------------------+
Table 9.3.3.3-10: 202 ACCEPTED (step 11, table 9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.3
* * *
Table 9.3.3.3-11: Short message submission report for MO SMS (step 12, table
9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in annex A.7.4
* * *
Table 9.3.3.3-12: 200 OK for other requests than REGISTER or SUBSCRIBE (step
13, table 9.3.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.1, Condition A5, A22
* * *
## 9.4 Mobile Terminating Concatenated SMS / 5GS
##### 9.4.1 Test Purpose (TP) {#test-purpose-tp-78 .H6}
##### (1) {#section-241 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE receives a SIP MESSAGE request containing a first segment of a
concatenated SMS }
**then** { UE sends a 200 OK response, followed by a SIP MESSAGE request
containing a delivery report for the first segment }
}
##### (2) {#section-242 .H6}
**with** { UE having sent a SIP MESSAGE request containing a delivery report
for the first segment }
**ensure that** {
**when** { UE receives a 202 Accepted response, followed by a SIP MESSAGE
request containing a second segment of a concatenated SMS }
**then** { UE sends a 200 OK response, followed by a SIP MESSAGE request
containing a delivery report for the second segment }
}
##### (3) {#section-243 .H6}
**with** { UE having sent a SIP MESSAGE request containing a delivery report
for the second segment }
**ensure that** {
**when** { UE receives a 202 Accepted response, followed by a SIP MESSAGE
request containing a third segment of a concatenated SMS }
**then** { UE sends a 200 OK response, followed by a SIP MESSAGE request
containing a delivery report for the third segment }
}
##### 9.4.2 Conformance Requirements {#conformance-requirements-79 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 23.040, clause 9.2.3.23]:
The TPâ€‘Userâ€‘Dataâ€‘Headerâ€‘Indicator is a 1 bit field within bit 6 of the first
octet of the following six PDUs:
\- SMSâ€‘SUBMIT,
\- SMS-SUBMIT-REPORT,
\- SMSâ€‘DELIVER,
\- SMS-DELIVER-REPORT,
\- SMS-STATUS-REPORT,
\- SMS-COMMAND.
TP-UDHI has the following values.
Bit no. 6 0 The TPâ€‘UD field contains only the short message
1 The beginning of the TPâ€‘UD field contains a Header in addition to the short
message.
[TS 23.040, clause 9.2.3.24]:
The length of the TP-User-Data field is defined in the PDU's of the SM-TL (see
clause 9.2.2).
The TPâ€‘Userâ€‘Data field may comprise just the short message itself or a Header
in addition to the short message depending upon the setting of TPâ€‘UDHI.
Where the TPâ€‘UDHI value is set to 0 the TPâ€‘Userâ€‘Data field comprises the short
message only, where the user data can be 7 bit (default alphabet) data, 8 bit
data, or 16 bit (UCS2 [24]) data.
Where the TPâ€‘UDHI value is set to 1 the first octets of the TPâ€‘Userâ€‘Data field
contains a Header in the following order starting at the first octet of the
TPâ€‘Userâ€‘Data field.
Irrespective of whether any part of the User Data Header is ignored or
discarded, the MS shall always store the entire TPDU exactly as received.
FIELD LENGTH
Length of User Data Header 1 octet
Informationâ€‘Elementâ€‘Identifier \"A\" 1 octet
Length of Informationâ€‘Element \"A\" 1 octet
Informationâ€‘Element \"A\" Data 0 to \"n\" octets
Informationâ€‘Elementâ€‘Identifier \"B\" 1 octet
Length of Informationâ€‘Element \"B\" 1 octet
Informationâ€‘Element \"B\" Data 0 to \"n\" octets
Informationâ€‘Elementâ€‘Identifier \"X\" 1 octet
Length of Informationâ€‘Element \"X\" 1 octet
Informationâ€‘Element \"X\" Data 0 to \"n\" octets
The diagram below shows the layout of the TP-User-Data-Length and the TP-User-
Data for uncompressed GSM 7 bit default alphabet data. The UDHL field is the
first octet of the TP-User-Data content of the Short Message.
Figure 9.2.3.24 (a)
The diagram below shows the layout of the TP-User-Data-Length and the TP-User-
Data for uncompressed 8 bit data or uncompressed UCS2 data. The UDHL field is
the first octet of the TP-User-Data content of the Short Message.
Figure 9.2.3.24 (b)
The diagram below shows the layout of the TP-User-Data-Length and the TP-User-
Data for compressed GSM 7 bit default alphabet data, compressed 8 bit data or
compressed UCS2 data. The UDHL field is the first octet of the TPâ€‘User-Data
content of the Short Message.
Figure 9.2.3.24 (c)
The definition of the TPâ€‘Userâ€‘Dataâ€‘Length field which immediately precedes the
\"Length of User Data Header\" is unchanged and shall therefore be the total
length of the TPâ€‘Userâ€‘Data field including the Header, if present. (see
9.2.3.16).
The \"Lengthâ€‘ofâ€‘Informationâ€‘Element\" fields shall be the integer
representation of the number of octets within its associated
\"Informationâ€‘Elementâ€‘Data\" field which follows and shall not include itself
in its count value.
The \"Lengthâ€‘ofâ€‘Userâ€‘Dataâ€‘Header\" field shall be the integer representation
of the number of octets within the \"Userâ€‘Dataâ€‘Header\" information fields
which follow and shall not include itself in its count or any fill bits which
may be present (see text below).
Information Elements may appear in any order and need not follow the order
used in the present document. Information Elements are classified into 3
categories as described below.
\- SMS Control -- identifies those IEIs which have the capability of dictating
SMS functionality.
\- EMS Control -- identifies those IEIs which manage EMS Content IEIs.
\- EMS Content -- identifies those IEIs containing data of a unique media
format.
It is permissible for certain IEs to be repeated within a short message, or
within a concatenated message. There is no restriction on the repeatability of
IEs in the EMS Content classification. The repeatability of SMS Control and
EMS Control IEs is determined on an individual basis. See the IE table below
for the repeatability of each IE.
In the event that IEs determined as not repeatable are duplicated, the last
occurrence of the IE shall be used. In the event that two or more IEs occur
which have mutually exclusive meanings (e.g. an 8bit port address and a 16bit
port address), then the last occurring IE shall be used.
If the length of the User Data Header is such that there are too few or too
many octets in the final Information Element then the whole User Data Header
shall be ignored.
If any reserved values are received within the content of any Information
Element then that part of the Information Element shall be ignored.
The support of any Information Element Identifier is optional unless otherwise
stated.
The Information Element Identifier octet shall be coded as follows:
+----------------+----------------+----------------+---------------+ | VALUE (hex) | MEANING | Classification | Repeatability | +----------------+----------------+----------------+---------------+ | 00 | Concatenated | SMS Control | No | | | short | | | | | messages, | | | | | 8-bit | | | | | reference | | | | | number | | | +----------------+----------------+----------------+---------------+ | 01 | Special SMS | SMS Control | Yes | | | Message | | | | | Indication | | | +----------------+----------------+----------------+---------------+ | 02 | Reserved | N/A | N/A | +----------------+----------------+----------------+---------------+ | 03 | Value not used | N/A | N/A | | | to avoid | | | | | mis | | | | | interpretation | | | | | as \ | | | | | character | | | +----------------+----------------+----------------+---------------+ | 04 | Application | SMS Control | No | | | port | | | | | addressing | | | | | scheme, 8 bit | | | | | address | | | +----------------+----------------+----------------+---------------+ | 05 | Application | SMS Control | No | | | port | | | | | addressing | | | | | scheme, 16 bit | | | | | address | | | +----------------+----------------+----------------+---------------+ | 06 | SMSC Control | SMS Control | No | | | Parameters | | | +----------------+----------------+----------------+---------------+ | 07 | UDH Source | SMS Control | Yes | | | Indicator | | | +----------------+----------------+----------------+---------------+ | 08 | Concatenated | SMS Control | No | | | short message, | | | | | 16-bit | | | | | reference | | | | | number | | | +----------------+----------------+----------------+---------------+ | 09 | Wireless | SMS Control | Note 3 | | | Control | | | | | Message | | | | | Protocol | | | +----------------+----------------+----------------+---------------+ | 0A | Text | EMS Control | Yes | | | Formatting | | | +----------------+----------------+----------------+---------------+ | 0B | Predefined | EMS Content | Yes | | | Sound | | | +----------------+----------------+----------------+---------------+ | 0C | User Defined | EMS Content | Yes | | | Sound (iMelody | | | | | max 128 bytes) | | | +----------------+----------------+----------------+---------------+ | 0D | Predefined | EMS Content | Yes | | | Animation | | | +----------------+----------------+----------------+---------------+ | 0E | Large | EMS Content | Yes | | | Animation | | | | | (16*16 times | | | | | 4 = 32*4 =128 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 0F | Small | EMS Content | Yes | | | Animation | | | | | (8*8 times 4 | | | | | = 8*4 =32 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 10 | Large Picture | EMS Content | Yes | | | (32*32 = 128 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 11 | Small Picture | EMS Content | Yes | | | (16*16 = 32 | | | | | bytes) | | | +----------------+----------------+----------------+---------------+ | 12 | Variable | EMS Content | Yes | | | Picture | | | +----------------+----------------+----------------+---------------+ | 13 | User prompt | EMS Control | Yes | | | indicator | | | +----------------+----------------+----------------+---------------+ | 14 | Extended | EMS Content | Yes | | | Object | | | +----------------+----------------+----------------+---------------+ | 15 | Reused | EMS Control | Yes | | | Extended | | | | | Object | | | +----------------+----------------+----------------+---------------+ | 16 | Compression | EMS Control | No | | | Control | | | +----------------+----------------+----------------+---------------+ | 17 | Object | EMS Control | Yes | | | Distribution | | | | | Indicator | | | +----------------+----------------+----------------+---------------+ | 18 | Standard WVG | EMS Content | Yes | | | object | | | +----------------+----------------+----------------+---------------+ | 19 | Character Size | EMS Content | Yes | | | WVG object | | | +----------------+----------------+----------------+---------------+ | 1A | Extended | EMS Control | No | | | Object Data | | | | | Request | | | | | Command | | | +----------------+----------------+----------------+---------------+ | 1B-1F | Reserved for | N/A | N/A | | | future EMS | | | | | features (see | | | | | subclause | | | | | 3.10) | | | +----------------+----------------+----------------+---------------+ | 20 | RFC 5322 | SMS Control | No | | | E-Mail Header | | | +----------------+----------------+----------------+---------------+ | 21 | Hyperlink | SMS Control | Yes | | | format element | | | +----------------+----------------+----------------+---------------+ | 22 | Reply Address | SMS Control | No | | | Element | | | +----------------+----------------+----------------+---------------+ | 23 | Enhanced Voice | SMS Control | No | | | Mail | | | | | Information | | | +----------------+----------------+----------------+---------------+ | 24 | National | SMS Control | No | | | Language | | | | | Single Shift | | | +----------------+----------------+----------------+---------------+ | 25 | National | SMS Control | No | | | Language | | | | | Locking Shift | | | +----------------+----------------+----------------+---------------+ | 26 -- 6F | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | 70 -- 7F | (U)SIM Toolkit | SMS Control | Note 1 | | | Security | | | | | Headers | | | +----------------+----------------+----------------+---------------+ | 80 -- 9F | SME to SME | SMS Control | Note 2 | | | specific use | | | +----------------+----------------+----------------+---------------+ | A0 -- BF | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | C0 -- DF | SC specific | SMS Control | Note 2 | | | use | | | +----------------+----------------+----------------+---------------+ | E0 -- FF | Reserved for | N/A | N/A | | | future use | | | +----------------+----------------+----------------+---------------+ | Note 1: The | | | | | functionality | | | | | of these IEIs | | | | | is defined in | | | | | 3GPP TSG | | | | | 31.115 [28], | | | | | and therefore, | | | | | the | | | | | repeatability | | | | | is not within | | | | | the scope of | | | | | this document | | | | | and will not | | | | | be determined | | | | | here. | | | | | | | | | | Note 2: The | | | | | functionality | | | | | of these IEIs | | | | | is used in a | | | | | proprietary | | | | | fashion by | | | | | different SMSC | | | | | vendors, and | | | | | therefore, are | | | | | not within the | | | | | scope of this | | | | | technical | | | | | specification. | | | | | | | | | | Note 3: The | | | | | functionality | | | | | of these IEIs | | | | | is defined by | | | | | the WAP Forum | | | | | and therefore | | | | | the | | | | | repeatability | | | | | is not within | | | | | the scope of | | | | | this document | | | | | and will not | | | | | be determined | | | | | here. | | | | +----------------+----------------+----------------+---------------+
A receiving entity shall ignore (i.e. skip over and commence processing at the
next information element) any information element where the IEI is Reserved or
not supported. The receiving entity calculates the start of the next
information element by looking at the length of the current information
element and skipping that number of octets.
The SM itself may be coded as 7, 8 or 16 bit data.
If 7 bit data is used and the TPâ€‘UDâ€‘Header does not finish on a septet
boundary then fill bits are inserted after the last Information Element Data
octet up to the next septet boundary so that there is an integral number of
septets for the entire TPâ€‘UD header. This is to ensure that the SM itself
starts on an septet boundary so that an earlier Phase mobile shall be capable
of displaying the SM itself although the TPâ€‘UD Header in the TPâ€‘UD field may
not be understood.
It is optional to make the first character of the SM itself a Carriage Return
character encoded according to the default 7 bit alphabet so that earlier
Phase mobiles, which do not understand the TPâ€‘UDâ€‘Header, shall overâ€‘write the
displayed TPâ€‘UDâ€‘Header with the SM itself.
If 16 bit (USC2) data is used then padding octets are not necessary. The SM
itself shall start on an octet boundary.
If 8 bit data is used then padding is not necessary. An earlier Phase mobile
shall be able to display the SM itself although the TPâ€‘UD header may not be
understood.
It is also possible for mobiles not wishing to support the TPâ€‘UD header to
check the value of the TPâ€‘UDHI bit in the SMSâ€‘Deliver PDU and the first octet
of the TPâ€‘UD field and skip to the start of the SM and ignore the TPâ€‘UD
header.
[TS 23.040, clause 9.2.3.24.1]:
This facility allows short messages to be concatenated to form a longer
message.
In the case of uncompressed 8â€‘bit data, the maximum length of the short
message within the TPâ€‘UD field is 134 (140â€‘6) octets.
In the case of uncompressed GSM 7 bit default alphabet data, the maximum
length of the short message within the TPâ€‘UD field is 153 (160â€‘7) characters.
A character represented by an escape-sequence shall not be split in the
middle.
In the case of 16 bit uncompressed USC2 data, the maximum length of the short
message within the TPâ€‘UD field is 67 ((140â€‘6)/2) characters. A UCS2 character
shall not be split in the middle; if the length of the User Data Header is
odd, the maximum length of the whole TP-UD field is 139 octets.
In the case of compressed GSM 7 bit default alphabet data, 8 bit data or UCS2
the maximum length of the compressed short message within the TP-UD field is
134 (140-6) octets including the Compression Header and Compression Footer,
both or either of which may be present (see clause 3.9).
The maximum length of an uncompressed concatenated short message is 39015
(255*153) default alphabet characters, 34170 (255*134) octets or 17085
(255*67) UCS2 characters.
The maximum length of a compressed concatenated message is 34170 (255*134)
octets including the Compression Header and Compression Footer (see clause 3.9
and figure 9.2.3.24.1(a) below).
Figure 9.2.3.24.1 (a): Concatenation of a Compressed short message
The gNB-DU controlling a UE-associated logical F1-connection initiates the
procedure by generating a UE The Informationâ€‘Elementâ€‘Data field contains
information set by the application in the SMSâ€‘SUBMIT so that the receiving
entity is able to reâ€‘assemble the short messages in the correct order. Each
concatenated short message contains a reference number which together with the
originating address and Service Centre address allows the receiving entity to
discriminate between concatenated short messages sent from different
originating SMEs and/or SCs. In a network which has multiple SCs, it is
possible for different segments of a concatenated SM to be sent via different
SCs and so it is recommended that the SC address should not be checked by the
MS unless the application specifically requires such a check.
The TP elements in the SMSâ€‘SUBMIT PDU, apart from TPâ€‘MR, TP-SRR, TPâ€‘UDL and
TPâ€‘UD, should remain unchanged for each SM which forms part of a concatenated
SM, otherwise this may lead to irrational behaviour. TP-MR must be incremented
for every segment of a concatenated message as defined in clause 9.2.3.6. A SC
shall handle segments of a concatenated message like any other short message.
The relation between segments of a concatenated message is made only at the
originator, where the message is segmented, and at the recipient, where the
message is reassembled. SMSâ€‘COMMANDs identify messages by TP-MR and therefore
apply to only one segment of a concatenated message. It is up to the
originating SME to issue SMS-COMMANDs for all the required segments of a
concatenated message.
The Informationâ€‘Elementâ€‘Data octets shall be coded as follows.
Octet 1 Concatenated short message reference number.
This octet shall contain a modulo 256 counter indicating the reference number
for a particular concatenated short message. This reference number shall
remain constant for every short message which makes up a particular
concatenated short message.
Octet 2 Maximum number of short messages in the concatenated short message.
This octet shall contain a value in the range 0 to 255 indicating the total
number of short messages within the concatenated short message. The value
shall start at 1 and remain constant for every short message which makes up
the concatenated short message. If the value is zero then the receiving entity
shall ignore the whole Information Element.
Octet 3 Sequence number of the current short message.
This octet shall contain a value in the range 0 to 255 indicating the sequence
number of a particular short message within the concatenated short message.
The value shall start at 1 and increment by one for every short message sent
within the concatenated short message. If the value is zero or the value is
greater than the value in octet 2 then the receiving entity shall ignore the
whole Information Element.
The IEI and associated IEI length and IEI data shall be present in every
segment of the concatenated SM.
[TS 24.341, clause 5.3.2.3]
When a SIP MESSAGE request including a short message in the \"vnd.3gpp.sms\"
payload is delivered, the SM-over-IP receiver shall:
\- generate a SIP response according to RFC 3428 [14];
\- extract the payload encoded according to 3GPP TS 24.011 [8] for RP-DATA;
and
\- create a delivery report as described in subclause 5.3.2.4. The content of
the report is defined in 3GPP TS 24.011 [8].
[TS 24.341, clause 5.3.2.4]
When an SM-over-IP receiver wants to send an SM delivery report over IP, the
SM-over-IP receiver shall send a SIP MESSAGE request with the following
information:
a) the Request-URI, which shall contain the IP-SM-GW;
NOTE 1: The address of the IP-SM-GW is received in the P-Asserted-Identity
header in the SIP MESSAGE request including the delivered short message.
b) the From header, which shall contain a public user identity of the SM-over-
IP receiver.
c) the To header, which shall contain the IP-SM-GW;
d) the In-Reply-To header which shall contain the Call-Id of the SIP MESSAGE
request that was received in the received short message;
e) the Content-Type header shall contain \"application/vnd.3gpp.sms\"; and
f) the body of the request shall contain the RP-ACK or RP-ERROR message for
the SM delivery report, as defined in 3GPP TS 24.011 [8].
NOTE 2: The SM-over-IP sender will use content transfer encoding of type
\"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.
##### 9.4.3 Test description {#test-description-78 .H6}
##### 9.4.3.1 Pre-test conditions {#pre-test-conditions-78 .H6}
##### System Simulator: {#system-simulator-80 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-82 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-82 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 9.4.3.2 Test procedure sequence {#test-procedure-sequence-77 .H6}
Table 9.4.3.2-1: Main Behaviour
* * *
St Procedure Message Sequence TP Verdict  
U - S Message  
0A-0H Steps 1-8 of generic procedure specified in Table 4.9.20.2.2-1 of TS
38.508-1 [21] are performed. - - - - 1 SS sends a first segment of a
concatenated SMS in the message-body of SIP_MESSAGE. \ 200 OK 1 P 3 Check: When the
payload is extracted, does the UE respond with a delivery report included in
the message-body of MESSAGE? --> SIP MESSAGE request 1 P 4 SS responds with a
202 ACCEPTED. \ 200 OK 2 P 7 Check: When the
payload is extracted, does the UE respond with a delivery report included in
the message-body of MESSAGE? --> SIP MESSAGE request 2 P 8 SS responds with a
202 ACCEPTED. \ 200 OK 3 P 11 Check: When the
payload is extracted, does the UE respond with a delivery report included in
the message-body of MESSAGE? --> SIP MESSAGE request 3 P 12 SS responds with a
202 ACCEPTED. \ SIP MESSAGE request 1 P 3 SS responds with 202
Accepted. \ 200 OK 2 P
* * *
Table 9.5.3.2-2: Parallel behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                   U - S              Message
1 The UE transmits an _RRCReconfigurationComplete_ message. --> NR RRC:
_RRCReconfigurationComplete_ \- -
##### 9.5.3.3 Specific message contents {#specific-message-contents-73 .H6}
Table 9.5.3.3-1: Message for MO SMS (step 2, table 9.5.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in annex A.7.3, Condition A2, A5
* * *
Table 9.5.3.3-2: 202 ACCEPTED (step 3, table 9.5.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.3
* * *
Table 9.5.3.3-3: Short message submission report for MO SMS (step 4, table
9.5.3.2-1)
+------------------+------+------------------+-----+------------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Table in | | | | | | annex A.7.4 | | | | | +==================+======+==================+=====+==================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+------------------+ | **Message-body** | | RP-ERROR message | | TS 24.011 [25] | | | | with RPâ€‘Cause | | | | | | Data:\ | | TS 23.040 [24] | | | | Length: 2, | | | | | | Length indicator | | | | | | = 1 | | | | | | | | | | | | Extension: not | | | | | | extended | | | | | | | | | | | | Cause value: 38 | | | | | | (Network out of | | | | | | order) | | | +------------------+------+------------------+-----+------------------+
Table 9.5.3.3-4: 200 OK for other requests than REGISTER or SUBSCRIBE (step 5,
table 9.5.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Table in subclause A.3.1, Condition A5, A22
* * *
# 10 Emergency Calls
## 10.1 Emergency Call with emergency registration / Success / Location
information available / 5GS
##### 10.1.1 Test Purpose (TP) {#test-purpose-tp-80 .H6}
##### (1) {#section-246 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE is being made to initiate an emergency call }
**then** { UE sends a correctly composed initial REGISTER request for IMS
emergency registration }
##### (2) {#section-247 .H6}
**with** { UE having sent an unprotected REGISTER request }
**ensure** that {
**when** { UE receiving a valid 401 (Unauthorized) response for the initial
REGISTER request sent }
**then** { UE correctly authenticates itself by sending another REGISTER
request with a correctly composed Authorization header using the AKAv1-MD5
algorithm }
}
##### (3) {#section-248 .H6}
**with** { UE having sent unprotected and then protected REGISTER request }
**ensure that** {
**when** { UE receiving a valid 200 OK response for the REGISTER sent for
authentication }
**then** { UE sends a correctly composed INVITE request }
}
##### (4) {#section-249 .H6}
**with** { UE having sent INVITE }
**ensure** **that** {
**when** { UE receiving 100 Trying, followed by 180 Ringing, followed by 200
OK }
**then** { UE sends ACK }
}
##### (5) {#section-250 .H6}
**with** { Emergency call being established }
**ensure that** {
**when** { UE receives BYE }
**then** { UE sends a 200 OK response }
}
##### 10.1.2 Conformance Requirements {#conformance-requirements-81 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 4.7.5]:
A number of mechanisms also exist for providing location in support of
emergency calls, both for routeing to a PSAP, and for use by the PSAP itself,
in the IM CN subsystem:
a) by the inclusion by the UE of the Geolocation header field containing a
location by reference or by value (see RFC 6442 [89]);
b) by the inclusion by the UE of a P-Access-Network-Info header field, which
contains a cell identifier or location identifier, which is subsequently
mapped, potentially by the recipient, into a real location;
...
Which means of providing location is used depends on local regulatory and
operator requirements. One or more mechanisms can be used. Location can be
subject to privacy constraints.
[TS 24.229 clause 5.1.6.2]:
When the user initiates an emergency call, if emergency registration is needed
(including cases described in subclause 5.1.6.2A), the UE shall perform an
emergency registration prior to sending the SIP request related to the
emergency call.
...
When a UE performs an initial emergency registration the UE shall perform the
actions as specified in subclause 5.1.1.2 with the following additions and
modifications:
a) the UE shall include a \"sos\" SIP URI parameter in the Contact header
field as described in subclause 7.2A.13, indicating that this is an emergency
registration and that the associated contact address is allowed only for
emergency service; and
b) the UE shall populate the From and To header fields of the REGISTER request
with:
\- the first entry in the list of public user identities provisioned in the
UE;
\- the default public user identity obtained during the normal registration,
if the UE is not provisioned with a list of public user identities, but the UE
is currently registered to the IM CN subsystem; and
\- the derived temporary public user identity, in all other cases.
[TS 24.229 clause 5.1.6.3]
Upon receiving the 200 (OK) to the REGISTER request that completes the
emergency registration, the UE shall not subscribe to the reg event package of
the public user identity specified in the REGISTER request.
[TS 24.229 clause 5.1.6.5]
When a UE performs authentication a UE shall perform the procedures as
specified in subclause 5.1.1.5.
[TS 24.229 clause 5.1.6.8.3]
After a successful initial emergency registration, the UE shall apply the
procedures as specified in subclause 5.1.2A and 5.1.3 with the following
additions:
1) the UE shall insert in the INVITE request, a From header field that
includes the public user identity registered via emergency registration or the
tel URI associated with the public user identity registered via emergency
registration, as described in subclause 4.2;
2) the UE shall include a service URN in the Request-URI of the INVITE request
in accordance with subclause 5.1.6.8.1;
3) the UE shall insert in the INVITE request, a To header field with the same
emergency service URN as in the Request-URI;
4) if available to the UE, and if defined for the access type as specified in
subclause 7.2A.4, the P-Access-Network-Info header field shall contain a
location identifier such as the cell id, line id or the identity of the WLAN
access node, which is relevant for routeing the IMS emergency call;
NOTE 1: The IMS emergency specification in 3GPP TS 23.167 [4B] describes
several methods how the UE can get its location information from the access
network or from a server. Such methods are not in the scope of this
specification.
5) the UE shall insert in the INVITE request, one or two P-Preferred-Identity
header field(s) that include the public user identity registered via emergency
registration or the tel URI associated with the public user identity
registered via emergency registration as described in subclause 4.2;
NOTE 2: Providing two P-Preferred-Identity header fields is usually supported
by UE acting as enterprise network.
6) void;
7) if the UE has its location information available, or a URI that points to
the location information, then the UE shall include a Geolocation header field
in the INVITE request in the following way:
\- if the UE is aware of the URI that points to where the UE\'s location is
stored, include the URI as the Geolocation header field value, as described in
RFC 6442 [89]; or
[Rel-15]
\- if the UE is aware of its location information, include the location
information in a PIDF location object, in accordance with RFC 4119 [90],
include the location object in a message body with the content type
application/pidf+xml, and include a Content ID URL, referring to the message
body, as the Geolocation header field value, as described RFC 6442 [89], and
include a Content-Disposition header field with a disposition type \"render\"
value and a \"handling\" header field parameter with an \"optional\" value, as
described in RFC 3261 [26];
[Rel-16]
\- if the UE is aware of its location information, include the location
information in a PIDF location object, in accordance with RFC 4119 [90] and
RFC 5491 [267], include the location object in a message body with the content
type application/pidf+xml, and include a Content ID URL, referring to the
message body, as the Geolocation header field value, as described RFC 6442
[89], and include a Content-Disposition header field with a disposition type
\"render\" value and a \"handling\" header field parameter with an
\"optional\" value, as described in RFC 3261 [26];
8) if the UE includes a Geolocation header field, the UE shall also include a
Geolocation-Routing header field with a \"yes\" header field value, which
indicates that the location of the UE can be used by other entities to make
routing decisions, as described in RFC 6442 [89];
NOTE 3: It is suggested that UE\'s only use the option of providing a URI when
the domain part belongs to the current P-CSCF or S-CSCF provider. This is an
issue on which the network operator needs to provide guidance to the end user.
A URI that is only resolvable to the UE which is making the emergency call is
not desirable.
9) if the UE has neither geographical location information available, nor a
URI that points to the location information, the UE shall not insert a
Geolocation header field in the INVITE request; and
10) if support of the current location discovery during an emergency call is
allowed in the IP-CAN specific annex and the UE supports the current location
discovery during an emergency call, the UE shall include a Recv-Info header
field as described in RFC 6086 [25], indicating the g.3gpp.current-location-
discovery info package name and shall include an Accept header field
indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME
type.
NOTE 4: RFC 3261 [26] provides for the use of the Priority header field with a
suggested value of \"emergency\". It is not precluded that emergency sessions
contain this value, but such usage will have no impact on the processing
within the IM CN subsystem.
[TS 24.237 clause 7.2]:
When originating an emergency call as specified in 3GPP TS 24.229 [2] and if
the SC UE has an IMEI, then the SC UE shall include the sip.instance media
feature tag as specified in IETF RFC 5626 [22] with value based on the IMEI as
defined in 3GPP TS 23.003 [12] in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [53].
[TS 23.003 clause 13.8]:
An instance-id is a SIP Contact header parameter that uniquely identifies the
SIP UA performing a registration.
When an IMEI is available, the instance-id shall take the form of a IMEI URN
(see RFC 7254 [79]). The format of the instance-id shall take the form
\"urn:gsma:imei:\\" where by the imeival shall contain the IMEI
encoded as defined in RFC 7254 [79]. The optional \ and
\ parameters shall not be included in the instance-id. RFC
7255 [104] specifies additional considerations for using the IMEI as an
instance-id. An example of such an instance-id is as follows:
EXAMPLE: urn:gsma:imei:90420156-025763-0
If no IMEI is available, the instance-id shall take the form of a string
representation of a UUID as a URN as defined in IETF RFC 4122 [80]. An example
of such an instance-id is as follows:
EXAMPLE: urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
For more information on the instance-id and when it is used, see 3GPP TS
24.229 [81].
##### 10.1.3 Test description {#test-description-80 .H6}
##### 10.1.3.1 Pre-test conditions {#pre-test-conditions-80 .H6}
##### System Simulator: {#system-simulator-82 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
\- Test environment shall be set up to provide the needed input to the UE, in
order for the UE to derive its location, if the UE uses Geolocation header for
providing its geographical location. This shall be done by use of the test
function Update UE Location Information defined in TS 38.509 [48], if
supported by the UE according to pc_UpdateUE_LocationInformation. Otherwise,
or in addition any other suitable method may also be used.
##### UE: {#ue-84 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-84 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 10.1.3.2 Test procedure sequence {#test-procedure-sequence-79 .H6}
Table 10.1.3.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +-------+-------------+-------------+-------------+---------+----+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to make an | | | | | | | emergency | | | | | | | call | | | | | +-------+-------------+-------------+-------------+---------+----+ | 1A-1J | Steps 1-10 | - | - | - | - | | | of test | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2 | Step 1 of | --> | REGISTER | 1 | P | | | annex A.3 | | | | | | | (emergency | | | | | | | re | | | | | | | gistration) | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | a correctly | | | | | | | composed | | | | | | | initial | | | | | | | REGISTER | | | | | | | request for | | | | | | | IMS | | | | | | | emergency | | | | | | | re | | | | | | | gistration? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 3 | Step 2 of | \ | REGISTER | 2 | P | | | annex A.3 | | | | | | | (emergency | | | | | | | re | | | | | | | gistration) | | | | | | | | | | | | | | Check: Does | | | | | | | the UE | | | | | | | correctly | | | | | | | a | | | | | | | uthenticate | | | | | | | itself by | | | | | | | sending | | | | | | | another | | | | | | | REGISTER | | | | | | | request | | | | | | | with a | | | | | | | correctly | | | | | | | composed | | | | | | | Au | | | | | | | thorization | | | | | | | header | | | | | | | using the | | | | | | | AKAv1-MD5 | | | | | | | algorithm? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 5 | Step 4 of | \ | INVITE | 3 | P | | | annex A.6 | | | | | | | (emergency | | | | | | | call) | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | a correctly | | | | | | | composed | | | | | | | INVITE | | | | | | | request? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 7 | Step 2 of | \ | ACK | 4 | P | | | annex A.6 | | | | | | | (emergency | | | | | | | call) | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | ACK? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 11 | Step 1 of | \ | 200 OK | 5 | P | | | annex A.8 | | | | | | | (MT Release | | | | | | | of Voice | | | | | | | Call) | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request and | | | | | | | ends the | | | | | | | call? | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 10.1.3.3 Specific message contents {#specific-message-contents-74 .H6}
Table 10.1.3.3-1: INVITE (step 6, table 10.1.3.2-1)
* * *
Derivation Path: Annex A.6, Step 1, with Conditions A7, A8, and A28 of TS
34.229-1 [2] cl A.2.1
* * *
## 10.2 Emergency Call with emergency registration / Success / Location
information not available / 5GS
##### 10.2.1 Test Purpose (TP) {#test-purpose-tp-81 .H6}
##### (1) {#section-251 .H6}
**with** { UE being registered to IMS }
**ensure that** {
**when** { UE is being made to initiate an emergency call }
**then** { UE sends a correctly composed initial REGISTER request for IMS
emergency registration }
##### (2) {#section-252 .H6}
**with** { UE having sent an unprotected REGISTER request }
**ensure** that {
**when** { UE receiving a valid 401 (Unauthorized) response for the initial
REGISTER request sent }
**then** { UE correctly authenticates itself by sending another REGISTER
request with a correctly composed Authorization header using the AKAv1-MD5
algorithm }
}
##### (3) {#section-253 .H6}
**with** { UE having sent unprotected and then protected REGISTER request }
**ensure that** {
**when** { UE receiving a valid 200 OK response for the REGISTER sent for
authentication }
**then** { UE sends a correctly composed INVITE request without location
information }
}
##### (4) {#section-254 .H6}
**with** { UE having sent INVITE }
**ensure** **that** {
**when** { UE receiving 100 Trying, followed by 180 Ringing, followed by 200
OK }
**then** { UE sends ACK }
}
##### (5) {#section-255 .H6}
with { Emergency call being established }
ensure that {
when { UE receives BYE }
then { UE sends a 200 OK response }
}
##### 10.2.2 Conformance Requirements {#conformance-requirements-82 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.6.1]:
If the IM CN subsystem is selected and the UE is currently attached to its
home operator\'s network (e.g. HPLMN) and the UE is currently registered and
the IP-CAN defines emergency bearers and the core network has indicated that
it supports emergency bearers, the UE shall:
1) perform an initial emergency registration, as described in subclause
5.1.6.2; and
2) attempt an emergency call as described in subclause 5.1.6.8.3.
[TS 24.229 clause 5.1.6.2]:
When a UE performs an initial emergency registration the UE shall perform the
actions as specified in subclause 5.1.1.2 with the following additions and
modifications:
a) the UE shall include a \"sos\" SIP URI parameter in the Contact header
field as described in subclause 7.2A.13, indicating that this is an emergency
registration and that the associated contact address is allowed only for
emergency service; and
b) the UE shall populate the From and To header fields of the REGISTER request
with:
\- the first entry in the list of public user identities provisioned in the
UE;
\- the default public user identity obtained during the normal registration,
if the UE is not provisioned with a list of public user identities, but the UE
is currently registered to the IM CN subsystem; and
\- the derived temporary public user identity, in all other cases.
[TS 24.229 clause 5.1.6.8.1]:
When an initial request for a dialog or a standalone transaction, or an
unknown method transmitted as part of UE detected emergency call procedures as
defined in subclause 5.1.6 is initiated:
...
the Request-URI of the initial request for a dialog or the standalone
transaction, or the unknown method transmitted as part of UE detected
emergency call procedures as defined in subclause 5.1.6 shall include one of
the following service URNs:
\- \"urn:service:sos\", \"urn:service:sos.ambulance\",
\"urn:service:sos.police\", \"urn:service:sos.fire\",
\"urn:service:sos.marine\", \"urn:service:sos.mountain\",
\"urn:service:sos.ecall.manual\", \"urn:service:sos.ecall.automatic\". If the
UE can determine the type of emergency service the UE shall use an emergency
service URN with a sub-service type corresponding to the type of emergency
service.
[TS 24.229 clause 5.1.6.8.3]:
After a successful initial emergency registration, the UE shall apply the
procedures as specified in subclause 5.1.2A and 5.1.3 with the following
additions:
1) the UE shall insert in the INVITE request, a From header field that
includes the public user identity registered via emergency registration or the
tel URI associated with the public user identity registered via emergency
registration, as described in subclause 4.2;
2) the UE shall include a service URN in the Request-URI of the INVITE request
in accordance with subclause 5.1.6.8.1;
3) the UE shall insert in the INVITE request, a To header field with the same
emergency service URN as in the Request-URI;
4) if available to the UE, and if defined for the access type as specified in
subclause 7.2A.4, the P-Access-Network-Info header field shall contain a
location identifier such as the cell id, line id or the identity of the WLAN
access node, which is relevant for routeing the IMS emergency call;
NOTE 1: The IMS emergency specification in 3GPP TS 23.167 [4B] describes
several methods how the UE can get its location information from the access
network or from a server. Such methods are not in the scope of this
specification.
5) the UE shall insert in the INVITE request, one or two P-Preferred-Identity
header field(s) that include the public user identity registered via emergency
registration or the tel URI associated with the public user identity
registered via emergency registration as described in subclause 4.2;
NOTE 2: Providing two P-Preferred-Identity header fields is usually supported
by UE acting as enterprise network.
6) void;
7) if the UE has its location information available, or a URI that points to
the location information, then the UE shall include a Geolocation header field
in the INVITE request in the following way:
\- if the UE is aware of the URI that points to where the UE\'s location is
stored, include the URI as the Geolocation header field value, as described in
RFC 6442 [89]; or
\- if the UE is aware of its location information, include the location
information in a PIDF location object, in accordance with RFC 4119 [90],
include the location object in a message body with the content type
application/pidf+xml, and include a Content ID URL, referring to the message
body, as the Geolocation header field value, as described RFC 6442 [89], and
include a Content-Disposition header field with a disposition type \"render\"
value and a \"handling\" header field parameter with an \"optional\" value, as
described in RFC 3261 [26];
8) if the UE includes a Geolocation header field, the UE shall also include a
Geolocation-Routing header field with a \"yes\" header field value, which
indicates that the location of the UE can be used by other entities to make
routing decisions, as described in RFC 6442 [89];
NOTE 3: It is suggested that UE\'s only use the option of providing a URI when
the domain part belongs to the current P-CSCF or S-CSCF provider. This is an
issue on which the network operator needs to provide guidance to the end user.
A URI that is only resolvable to the UE which is making the emergency call is
not desirable.
9) if the UE has neither geographical location information available, nor a
URI that points to the location information, the UE shall not insert a
Geolocation header field in the INVITE request; and
10) if support of the current location discovery during an emergency call is
allowed in the IP-CAN specific annex and the UE supports the current location
discovery during an emergency call, the UE shall include a Recv-Info header
field as described in RFC 6086 [25], indicating the g.3gpp.current-location-
discovery info package name and shall include an Accept header field
indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME
type.
NOTE 4: RFC 3261 [26] provides for the use of the Priority header field with a
suggested value of \"emergency\". It is not precluded that emergency sessions
contain this value, but such usage will have no impact on the processing
within the IM CN subsystem.
[TS 24.229 annex U.2.2.6]:
For the purposes of this document, an emergency PDU session is the equivalent
of emergency bearers; i.e. the 5GS defines emergency bearers for the support
of emergency calls. Emergency PDU session is defined for use in emergency
calls in 5GS and core network support of emergency PDU session is indicated to
the UE in NAS signalling. Where the UE recognises that a call request is an
emergency call and the core network supports emergency PDU session, the UE
shall use emergency PDU session for both signalling and media for emergency
calls made using the IM CN subsystem.
...
To perform emergency registration, the UE shall request to establish an
emergency PDU session as described in 3GPP TS 24.501 [258]. The procedures for
PDU session establishment and P-CSCF discovery, as described in subclause
U.2.2.1 of this specification apply accordingly.
[TS 24.237 clause 7.2.1]:
When originating an emergency call as specified in 3GPP TS 24.229 [2] and if
the SC UE has an IMEI, then the SC UE shall include the sip.instance media
feature tag as specified in IETF RFC 5626 [22] with value based on the IMEI as
defined in 3GPP TS 23.003 [12] in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [53].
[TS 23.003 clause 13.8]:
An instance-id is a SIP Contact header parameter that uniquely identifies the
SIP UA performing a registration.
When an IMEI is available, the instance-id shall take the form of a IMEI URN
(see RFC 7254 [79]). The format of the instance-id shall take the form
\"urn:gsma:imei:\\" where by the imeival shall contain the IMEI
encoded as defined in RFC 7254 [79]. The optional \ and
\ parameters shall not be included in the instance-id. RFC
7255 [104] specifies additional considerations for using the IMEI as an
instance-id. An example of such an instance-id is as follows:
EXAMPLE: urn:gsma:imei:90420156-025763-0
If no IMEI is available, the instance-id shall take the form of a string
representation of a UUID as a URN as defined in IETF RFC 4122 [80]. An example
of such an instance-id is as follows:
EXAMPLE: urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
For more information on the instance-id and when it is used, see 3GPP TS
24.229 [81].
##### 10.2.3 Test description {#test-description-81 .H6}
##### 10.2.3.1 Pre-test conditions {#pre-test-conditions-81 .H6}
##### System Simulator: {#system-simulator-83 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
\- Test environment shall ensure that UE cannot access any information (such
as GPS signal) from which the UE would be able to derive its geographical
location. The UE shall only be able to read the global cell ID as provided by
the SS.
##### UE: {#ue-85 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
\- UE is either not able to obtain location information or is configured to
not obtain location information when setting up an emergency session.
##### Preamble: {#preamble-85 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 10.2.3.2 Test procedure sequence {#test-procedure-sequence-80 .H6}
Same as test procedure sequence in clause 10.1.3.2
##### 10.2.3.3 Specific message contents {#specific-message-contents-75 .H6}
Table 10.2.3.3-1: INVITE (step 6, table 10.2.3.2-1)
* * *
Derivation Path: Annex A.6 Step 1, with Conditions A7, A28 and NOT A8 of
34.229-1 [2] A.2.1
* * *
## 10.3 Emergency call with emergency registration / Emergency SIP signalling
and media in parallel with another ongoing IM CN subsystem signalling and
media / 5GS
##### 10.3.1 Test Purpose (TP) {#test-purpose-tp-82 .H6}
##### (1) {#section-256 .H6}
**with** { UE being registered to IMS, having set up a voice call, and having
it put on hold }
**ensure that** {
**when** { UE is being made to initiate an emergency call }
**then** { UE initiates and completes IMS emergency registration }
}
##### (2) {#section-257 .H6}
**with** { UE being made to initiate an emergency call }
**ensure** **that** {
**when** { UE having completed IMS emergency registration }
**then** { UE sends correctly composed INVITE request for emergency call }
}
##### (3) {#section-258 .H6}
**with** { UE having sent INVITE }
**ensure** **that** {
**when** { UE receiving 100 Trying, followed by 180 Ringing, followed by 200
OK }
**then** { UE sends ACK }
}
##### (4) {#section-259 .H6}
**with** { Emergency call being established }
**ensure** **that** {
**when** { UE receives BYE }
**then** { UE sends a 200 OK response }
}
##### (5) {#section-260 .H6}
**with** { Emergency call being terminated }
**ensure** **that** {
**when** { UE having sent 200 OK for BYE }
**then** { UE sends re-INVITE and completes resumption of the original voice
call }
}
##### 10.3.2 Conformance Requirements {#conformance-requirements-83 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.6.1]:
If the IM CN subsystem is selected and the UE is currently attached to its
home operator\'s network (e.g. HPLMN) and the UE is currently registered and
the IP-CAN defines emergency bearers and the core network has indicated that
it supports emergency bearers, the UE shall:
1) perform an initial emergency registration, as described in subclause
5.1.6.2; and
2) attempt an emergency call as described in subclause 5.1.6.8.3.[TS 24.229
clause 5.1.6.2]:
When a UE performs an initial emergency registration the UE shall perform the
actions as specified in subclause 5.1.1.2 with the following additions and
modifications:
a) the UE shall include a \"sos\" SIP URI parameter in the Contact header
field as described in subclause 7.2A.13, indicating that this is an emergency
registration and that the associated contact address is allowed only for
emergency service; and
b) the UE shall populate the From and To header fields of the REGISTER request
with:
\- the first entry in the list of public user identities provisioned in the
UE;
\- the default public user identity obtained during the normal registration,
if the UE is not provisioned with a list of public user identities, but the UE
is currently registered to the IM CN subsystem; and
\- the derived temporary public user identity, in all other cases.
[TS 24.229 clause 5.1.6.8.1]:
When an initial request for a dialog or a standalone transaction, or an
unknown method transmitted as part of UE detected emergency call procedures as
defined in subclause 5.1.6 is initiated:
...
the Request-URI of the initial request for a dialog or the standalone
transaction, or the unknown method transmitted as part of UE detected
emergency call procedures as defined in subclause 5.1.6 shall include one of
the following service URNs:
\- \"urn:service:sos\", \"urn:service:sos.ambulance\",
\"urn:service:sos.police\", \"urn:service:sos.fire\",
\"urn:service:sos.marine\", \"urn:service:sos.mountain\",
\"urn:service:sos.ecall.manual\", \"urn:service:sos.ecall.automatic\". If the
UE can determine the type of emergency service the UE shall use an emergency
service URN with a sub-service type corresponding to the type of emergency
service.
[TS 24.229 clause 5.1.6.8.3]:
After a successful initial emergency registration, the UE shall apply the
procedures as specified in subclause 5.1.2A and 5.1.3 with the following
additions:
1) the UE shall insert in the INVITE request, a From header field that
includes the public user identity registered via emergency registration or the
tel URI associated with the public user identity registered via emergency
registration, as described in subclause 4.2;
2) the UE shall include a service URN in the Request-URI of the INVITE request
in accordance with subclause 5.1.6.8.1;
3) the UE shall insert in the INVITE request, a To header field with the same
emergency service URN as in the Request-URI;
4) if available to the UE, and if defined for the access type as specified in
subclause 7.2A.4, the P-Access-Network-Info header field shall contain a
location identifier such as the cell id, line id or the identity of the WLAN
access node, which is relevant for routeing the IMS emergency call;
NOTE 1: The IMS emergency specification in 3GPP TS 23.167 [4B] describes
several methods how the UE can get its location information from the access
network or from a server. Such methods are not in the scope of this
specification.
5) the UE shall insert in the INVITE request, one or two P-Preferred-Identity
header field(s) that include the public user identity registered via emergency
registration or the tel URI associated with the public user identity
registered via emergency registration as described in subclause 4.2;
NOTE 2: Providing two P-Preferred-Identity header fields is usually supported
by UE acting as enterprise network.
6) void;
7) if the UE has its location information available, or a URI that points to
the location information, then the UE shall include a Geolocation header field
in the INVITE request in the following way:
\- if the UE is aware of the URI that points to where the UE\'s location is
stored, include the URI as the Geolocation header field value, as described in
RFC 6442 [89]; or
\- if the UE is aware of its location information, include the location
information in a PIDF location object, in accordance with RFC 4119 [90],
include the location object in a message body with the content type
application/pidf+xml, and include a Content ID URL, referring to the message
body, as the Geolocation header field value, as described RFC 6442 [89], and
include a Content-Disposition header field with a disposition type \"render\"
value and a \"handling\" header field parameter with an \"optional\" value, as
described in RFC 3261 [26];
8) if the UE includes a Geolocation header field, the UE shall also include a
Geolocation-Routing header field with a \"yes\" header field value, which
indicates that the location of the UE can be used by other entities to make
routing decisions, as described in RFC 6442 [89];
NOTE 3: It is suggested that UE\'s only use the option of providing a URI when
the domain part belongs to the current P-CSCF or S-CSCF provider. This is an
issue on which the network operator needs to provide guidance to the end user.
A URI that is only resolvable to the UE which is making the emergency call is
not desirable.
9) if the UE has neither geographical location information available, nor a
URI that points to the location information, the UE shall not insert a
Geolocation header field in the INVITE request; and
10) if support of the current location discovery during an emergency call is
allowed in the IP-CAN specific annex and the UE supports the current location
discovery during an emergency call, the UE shall include a Recv-Info header
field as described in RFC 6086 [25], indicating the g.3gpp.current-location-
discovery info package name and shall include an Accept header field
indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME
type.
NOTE 4: RFC 3261 [26] provides for the use of the Priority header field with a
suggested value of \"emergency\". It is not precluded that emergency sessions
contain this value, but such usage will have no impact on the processing
within the IM CN subsystem.
[TS 24.229 annex U.2.2.6]:
For the purposes of this document, an emergency PDU session is the equivalent
of emergency bearers; i.e. the 5GS defines emergency bearers for the support
of emergency calls. Emergency PDU session is defined for use in emergency
calls in 5GS and core network support of emergency PDU session is indicated to
the UE in NAS signalling. Where the UE recognises that a call request is an
emergency call and the core network supports emergency PDU session, the UE
shall use emergency PDU session for both signalling and media for emergency
calls made using the IM CN subsystem.
...
To perform emergency registration, the UE shall request to establish an
emergency PDU session as described in 3GPP TS 24.501 [258]. The procedures for
PDU session establishment and P-CSCF discovery, as described in subclause
U.2.2.1 of this specification apply accordingly.
[TS 24.237 clause 7.2.1]:
When originating an emergency call as specified in 3GPP TS 24.229 [2] and if
the SC UE has an IMEI, then the SC UE shall include the sip.instance media
feature tag as specified in IETF RFC 5626 [22] with value based on the IMEI as
defined in 3GPP TS 23.003 [12] in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [53].
[TS 23.003 clause 13.8]:
An instance-id is a SIP Contact header parameter that uniquely identifies the
SIP UA performing a registration.
When an IMEI is available, the instance-id shall take the form of a IMEI URN
(see RFC 7254 [79]). The format of the instance-id shall take the form
\"urn:gsma:imei:\\" where by the imeival shall contain the IMEI
encoded as defined in RFC 7254 [79]. The optional \ and
\ parameters shall not be included in the instance-id. RFC
7255 [104] specifies additional considerations for using the IMEI as an
instance-id. An example of such an instance-id is as follows:
EXAMPLE: urn:gsma:imei:90420156-025763-0
If no IMEI is available, the instance-id shall take the form of a string
representation of a UUID as a URN as defined in IETF RFC 4122 [80]. An example
of such an instance-id is as follows:
EXAMPLE: urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
For more information on the instance-id and when it is used, see 3GPP TS
24.229 [81].
##### 10.3.3 Test description {#test-description-82 .H6}
##### 10.3.3.1 Pre-test conditions {#pre-test-conditions-82 .H6}
##### System Simulator: {#system-simulator-84 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-86 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-86 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS and
thereafter executing the generic test procedure in Annex A.4.1 up to and
including its last step for a non-emergency voice call defined in Table
4.9.15.2.2-1 of TS 38.508-1 [21].
##### 10.3.3.2 Test procedure sequence {#test-procedure-sequence-81 .H6}
Table 10.3.3.2-1: Main Behaviour
+---------+--------------+--------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+==============+==============+=========+=========+====+ | | | U - S | Message | | | +---------+--------------+--------------+---------+---------+----+ | 1 | UE is made | - | - | - | - | | | to hold the | | | | | | | ongoing call | | | | | +---------+--------------+--------------+---------+---------+----+ | 2-5 | Ongoing call | - | - | - | - | | | is put on | | | | | | | hold by UE | | | | | | | | | | | | | | (Steps 1-4 | | | | | | | of Annex | | | | | | | A.17) | | | | | +---------+--------------+--------------+---------+---------+----+ | 6 | UE is made | - | - | - | - | | | to initiate | | | | | | | an emergency | | | | | | | call | | | | | +---------+--------------+--------------+---------+---------+----+ | 6A | Steps 1-8 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | with steps | | | | | | | 7-10, steps | | | | | | | 9-10 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] take | | | | | | | palce. | | | | | +---------+--------------+--------------+---------+---------+----+ | 7-10 | Check: Does | - | - | 1 | P | | | the UE | | | | | | | initiate and | | | | | | | complete the | | | | | | | IMS | | | | | | | emergency | | | | | | | r | | | | | | | egistration? | | | | | | | | | | | | | | (Steps 1-4 | | | | | | | of Annex | | | | | | | A.3) | | | | | +---------+--------------+--------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to steps | | | | | | | 11-15 below, | | | | | | | steps 11-13 | | | | | | | of generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] takes | | | | | | | place. | | | | | +---------+--------------+--------------+---------+---------+----+ | 11 | Check: Does | --> | INVITE | 2 | P | | | the UE send | | | | | | | correctly | | | | | | | composed | | | | | | | INVITE | | | | | | | request for | | | | | | | emergency | | | | | | | call? | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.6) | | | | | +---------+--------------+--------------+---------+---------+----+ | 12-14 | SS sends 100 | - | - | - | - | | | Trying, | | | | | | | followed by | | | | | | | 180 Ringing, | | | | | | | followed by | | | | | | | 200 OK. | | | | | | | | | | | | | | (Steps 2-4 | | | | | | | of Annex | | | | | | | A.6) | | | | | +---------+--------------+--------------+---------+---------+----+ | 15 | Check: Does | --> | ACK | 3 | P | | | the UE | | | | | | | acknowledge? | | | | | | | | | | | | | | (Step 5 of | | | | | | | Annex A.6) | | | | | +---------+--------------+--------------+---------+---------+----+ | 16 | SS sends BYE | \ | 200 OK | 4 | P | | | the UE send | | | | | | | 200 OK | | | | | | | response? | | | | | | | | | | | | | | (Step 2 of | | | | | | | Annex A.8) | | | | | +---------+--------------+--------------+---------+---------+----+ | 17A-17C | Steps | - | - | - | - | | | 3b1-3b3 of | | | | | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4 | | | | | | | .9.12B.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+--------------+--------------+---------+---------+----+ | 18 | UE is made | - | - | - | - | | | to resume | | | | | | | the original | | | | | | | voice call | | | | | +---------+--------------+--------------+---------+---------+----+ | 19-22 | Check: Does | - | - | 5 | P | | | the UE send | | | | | | | re-INVITE | | | | | | | and | | | | | | | completes | | | | | | | resumption | | | | | | | of the | | | | | | | original | | | | | | | voice call? | | | | | | | | | | | | | | (Steps 1-4 | | | | | | | of Annex | | | | | | | A.17) | | | | | +---------+--------------+--------------+---------+---------+----+ | 23 | UE is made | - | - | - | - | | | to release | | | | | | | the original | | | | | | | voice call | | | | | +---------+--------------+--------------+---------+---------+----+ | 24 | The UE sends | --> | BYE | - | - | | | BYE for the | | | | | | | original | | | | | | | voice call\ | | | | | | | (Step 1 of | | | | | | | Annex A.7) | | | | | +---------+--------------+--------------+---------+---------+----+ | 25 | SS sends 200 | \ | INVITE | 1 | P | | | Does the | | | | | | | UE send an | | | | | | | INVITE | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex | | | | | | | A.4.1a)? | | | | | +---------+------------+------------+------------+---------+----+ | 9 | SS sends a | \ | PRACK | - | - | | | 183 | | | | | | | Session | | | | | | | Progress\ | | | | | | | (Step 4 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 15 | SS | \ | UPDATE | 2 | P | | | Does the | | | | | | | UE send an | | | | | | | UPDATE? | | | | | +---------+------------+------------+------------+---------+----+ | 17 | SS | \ | PRACK | - | - | | | ac | | | | | | | knowledges | | | | | | | reception | | | | | | | of 180 | | | | | | | Ringing. | | | | | | | | | | | | | | (Step 9 of | | | | | | | Annex | | | | | | | A.4.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 17C | SS | \ | ACK | - | - | | | 200 OK for | | | | | | | INVITE\ | | | | | | | (Step 12 | | | | | | | of Annex | | | | | | | A.4.1a) | | | | | +---------+------------+------------+------------+---------+----+ | 19-20 | Steps 1-2 | - | - | - | - | | | of the | | | | | | | procedure | | | | | | | A.8 are | | | | | | | executed | | | | | | | for MT | | | | | | | release of | | | | | | | speech | | | | | | | call | | | | | +---------+------------+------------+------------+---------+----+ | 21-23 | Steps 3-5 | - | - | - | - | | | of test | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.18.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+
##### 10.4.3.3 Specific message contents {#specific-message-contents-77 .H6}
Table 10.4.3.3-1: 183 Session Progress (step 13, table 10.4.3.2-1)
* * *
Derivation Path: Annex A.4.1a, step 3 applying option A5 of A.2.3 in addition
* * *
Table 10.4.3.3-2: UPDATE (step 16, table 10.4.3.2-1)
+-----------------------------+--------+-----------------------------+ | Derivation Path: Annex | | | | A.4.1a, step 6 | | | +=============================+========+=============================+ | Header/param | Cond | Value/Remark | +-----------------------------+--------+-----------------------------+ | Geolocation | B1 | | +-----------------------------+--------+-----------------------------+ | locationUR | | cid-url indicating the | | | | Content-Id of the PIDF-LO | | | | within the multipart MIME | | | | body of INVITE request. | | | | | | | | (Note that | | | | location-by-reference URI | | | | is not allowed as the SS | | | | does not provide any | | | | external storage for | | | | location info for the UE to | | | | refer.) | +-----------------------------+--------+-----------------------------+ | Geolocation-Routing | B1 | "yes" | +-----------------------------+--------+-----------------------------+ | Contact | | SIP URI with IP address or | | | | FQDN and protected server | | addr-spec | | port of UE | +-----------------------------+--------+-----------------------------+ | Content-Type | | | +-----------------------------+--------+-----------------------------+ | media-type | B1 | _multipart/mixed_ | +-----------------------------+--------+-----------------------------+ | | not B1 | _application/sdp_ | +-----------------------------+--------+-----------------------------+ | **Message-body** | B1 | The | | | | \"application/pidf+xml\" | | | | multipart-mime body shall | | | | contain a PIDF-LO element | | | | mapped to the same | | | | Content-ID which can be | | | | found from the Geolocation | | | | header | | | | | | | | The PIDF-LO shall contain | | | | at least the following | | | | elements: | | | | | | | | - One or more 'geopriv' | | | | elements (Note), each | | | | containing: | | | | | | | | - At least one | | | | 'location-info' element | | | | describing the location of | | | | the UE. | | | | | | | | Note: PIDF-LO shall contain | | | | at least one \ | | | | element in a \ | | | | element according to RFC | | | | 4119 or in a \ or | | | | \ element | | | | according to RFC 4119 and | | | | RFC 5491. | | | | | | | | The \"application/sdp\" | | | | multipart-mime body shall | | | | contain the SDP message as | | | | specified for the \"UPDATE | | | | (Step 6 of Annex A.4.1a)\". | +-----------------------------+--------+-----------------------------+ | | not B1 | SDP message as specified | | | | for the \"UPDATE (Step 6 of | | | | Annex A.4.1a)\". | +-----------------------------+--------+-----------------------------+
* * *
Condition Explanation B1 UE is capable of obtaining location information
* * *
Table 10.4.3.3-3: Void
Table 10.4.3.3-4: 200 OK (step 17, table 10.4.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1, Condition A6.
* * *
## **10.5 Void**
## 10.6 Non-UE detectable emergency call / IM CN sends 380 with an Alternative
Service / Previous emergency IMS registration not expired / 5GS
##### 10.6.1 Test Purpose (TP) {#test-purpose-tp-84 .H6}
##### (1) {#section-263 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to start an emergency call }
**then** { UE performs IMS registration and sets up emergency call }
}
##### (2) {#section-264 .H6}
**with** { Emergency call ongoing }
**ensure** **that** {
**when** { Network sends BYE }
**then** { UE sends 200 OK for BYE }
}
##### (3) {#section-265 .H6}
**with** { Emergency call being terminated }
**ensure** **that** {
**when** { UE is made to initiate a non UE detectable emergency call }
**then** { UE sends correctly composed INVITE request for normal voice call }
}
##### (4) {#section-266 .H6}
**with** { UE having sent INVITE for normal voice call }
**ensure** **that** {
**when** { UE receives 380 Alternative Service response }
**then** { UE acknowledges and initiates an emergency call }
}
##### (5) {#section-267 .H6}
**with** { Emergency call ongoing }
**ensure** **that** {
**when** { Network sends BYE }
**then** { UE sends 200 OK for BYE }
}
##### 10.6.2 Conformance Requirements {#conformance-requirements-85 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.3.1]:
In the event the UE receives a 380 (Alternative Service) response to an
initial INVITE request the response containing a P-Asserted-Identity header
field with a value equal to the value of the last entry of the Path header
field value received during registration and the response containing a 3GPP IM
CN subsystem XML body that includes an \ element, including a
version attribute, with an \ child element with the
\ child element set to \"emergency\" (see table 7.6.2), the UE shall
select a domain in accordance with the conventions and rules specified in 3GPP
TS 22.101 [1A] and 3GPP TS 23.167 [4B], and:
\- if the CS domain is selected, the UE behaviour is defined in subclause
7.1.2 of 3GPP TS 23.167 [4B] and, where appropriate, in the access technology
specific annex; and
\- if the IM CN subsystem is selected, the UE shall apply the procedures in
subclause 5.1.6 with the exception of selecting a domain for the emergency
call attempt.
NOTE 10: The last entry on the Path header field value received during
registration is the value of the SIP URI of the P-CSCF. If there are multiple
registration flows associated with the registration, then the UE has received
from the P-CSCF during registration multiple sets of Path header field values.
The last entry of the Path header field value corresponding to the flow on
which the 380 (Alternative Service) response was received is checked.
[TS 24.229 clause 5.1.6.2A]:
The UE shall perform a new initial emergency registration, as specified in
subclause 5.1.6.2, if the UE determines that:
\- it has previously performed an emergency registration which has not yet
expired; and
\- it has obtained an IP address from the serving IP-CAN, as specified in
subclause 9.2.1, different than the IP address used for the emergency
registration.
##### 10.6.3 Test description {#test-description-84 .H6}
##### 10.6.3.1 Pre-test conditions {#pre-test-conditions-84 .H6}
##### System Simulator: {#system-simulator-86 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-88 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-88 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 10.6.3.2 Test procedure sequence {#test-procedure-sequence-83 .H6}
Table 10.6.3.2-1: Main Behaviour
+---------+------------+------------+------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=========+============+============+============+=========+====+ | | | U - S | Message | | | +---------+------------+------------+------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to make an | | | | | | | emergency | | | | | | | call | | | | | +---------+------------+------------+------------+---------+----+ | 2-11 | Steps 1-10 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4. | | | | | | | 9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in steps | | | | | | | 12-16 | | | | | | | below the | | | | | | | events | | | | | | | specified | | | | | | | in 11-13 | | | | | | | of Table | | | | | | | 4. | | | | | | | 9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 12-15 | Steps 1-4 | - | - | - | - | | | of Annex | | | | | | | A.6 | | | | | | | happens | | | | | +---------+------------+------------+------------+---------+----+ | 16 | Step 5 of | --> | ACK | 1 | P | | | Annex A.6 | | | | | | | happens | | | | | | | | | | | | | | Check: | | | | | | | Does the | | | | | | | UE send an | | | | | | | ACK? | | | | | +---------+------------+------------+------------+---------+----+ | 17 | Step 1 of | \ | 200 OK | 2 | P | | | Annex A.8 | | | | | | | happens | | | | | | | | | | | | | | Check: | | | | | | | Does the | | | | | | | UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request | | | | | | | and ends | | | | | | | the call? | | | | | +---------+------------+------------+------------+---------+----+ | 18A-18C | Steps | - | - | - | - | | | 3b1-3b34 | | | | | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4.9 | | | | | | | .12B.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed | | | | | | | to release | | | | | | | emergency | | | | | | | speech | | | | | | | bearer and | | | | | | | Keep | | | | | | | emergency | | | | | | | PDU | | | | | | | session. | | | | | +---------+------------+------------+------------+---------+----+ | 19 | UE is made | - | - | - | - | | | to attempt | | | | | | | an IMS | | | | | | | voice call | | | | | +---------+------------+------------+------------+---------+----+ | 20 | UE sends | --> | INVITE | 3 | P | | | INVITE | | | | | | | with the | | | | | | | first SDP | | | | | | | offer\ | | | | | | | Check: | | | | | | | Does the | | | | | | | UE send | | | | | | | correctly | | | | | | | composed | | | | | | | INVITE | | | | | | | request | | | | | | | for normal | | | | | | | voice | | | | | | | call? | | | | | +---------+------------+------------+------------+---------+----+ | 21 | SS | \ | ACK | - | - | | | ac | | | | | | | knowledges | | | | | | | the | | | | | | | receipt of | | | | | | | 380 | | | | | | | A | | | | | | | lternative | | | | | | | Service | | | | | | | response | | | | | +---------+------------+------------+------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in steps | | | | | | | 23-27 | | | | | | | below the | | | | | | | events | | | | | | | specified | | | | | | | in 11-13 | | | | | | | of Table | | | | | | | 4. | | | | | | | 9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +---------+------------+------------+------------+---------+----+ | 23 | Step 1 of | --> | INVITE | 4 | P | | | Annex A.6 | | | | | | | happens | | | | | | | | | | | | | | Check: | | | | | | | Does UE | | | | | | | send | | | | | | | INVITE | | | | | | | message | | | | | | | for | | | | | | | emergency | | | | | | | call? | | | | | +---------+------------+------------+------------+---------+----+ | 24-27 | Steps 2-5 | - | - | - | - | | | of Annex | | | | | | | A.6 | | | | | | | happens | | | | | +---------+------------+------------+------------+---------+----+ | 28 | Step 1 of | \ | 200 OK | 5 | P | | | Annex A.8 | | | | | | | happens | | | | | | | | | | | | | | Check: | | | | | | | Does the | | | | | | | UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request | | | | | | | and ends | | | | | | | the call? | | | | | +---------+------------+------------+------------+---------+----+
##### 10.6.3.3 Specific message contents {#specific-message-contents-78 .H6}
Table 10.6.3.3-1: INVITE for non UE detectable emergency call (step 20, table
10.6.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.1, | | | | | | Conditions A1, | | | | | | A3, A4, A28, | | | | | | A29, and A30 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | The following | | TS 24.229 [7] | | | | SDP types and | | | | | | values. | | | | | | | | | | | | **Session | | | | | | description:** | | | | | | | | | | | | _v=0_ | | | | | | | | | | | | _o=(username) | | | | | | (sess-id)_ | | | | | | ** | | | | | | (sess-version)**| | | | | |_IN_ (addrtype) | | | | | | (unicast-address | | | | | | for UE) | | | | | | | | | | | | _s=(session | | | | | | name)_ | | | | | | | | | | | | _c=IN_ | | | | | | (addrtype) | | | | | | (co | | | | | | nnection-address | | | | | | for UE) [Note | | | | | | 1] | | | | | | | | | | | | **Time | | | | | | description:**| | | | | | | | | | | |_t=_ | | | | | | **(start-time) | | | | | | (stop-time)**| | | | | | | | | | | |** Media | | | | | | description:__| | | | | | | | | | | |_ m=audio_ | | | | | | (transport port) | | | | | | [Note 2] | | | | | | | | | | | | _c=IN_ | | | | | | (addrtype) | | | | | | (co | | | | | | nnection-address | | | | | | for UE) [Note | | | | | | 1] | | | | | | | | | | | | _b=AS:_ | | | | | | ( | | | | | | bandwidth-value) | | | | | | | | | | | | Note 1: At least | | | | | | one \"c=\" field | | | | | | shall be | | | | | | present. | | | | | | | | | | | | Note 2: EVS | | | | | | codec shall be | | | | | | present in the | | | | | | media | | | | | | attributes, | | | | | | optionally | | | | | | including | | | | | | channel number | | | | | | \"/1\". | | | +------------------+------+------------------+-----+-----------------+
Table 10.6.3.3-2: 380 Alternative Service (step 21, table 10.6.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.4.1 | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ eme | | | | | | rgency\_ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _e | | | | | | mergency-registr | | | | | | ation\ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | +------------------+------+------------------+-----+-----------------+
Table 10.6.3.3-3: ACK (step 22, table 10.6.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.7, Conditions A1 and A4
* * *
## 10.7 Void
## 10.8 Void
## 10.9 Emergency call without emergency registration / UE credentials are not
accepted / 5GS
##### 10.9.1 Test Purpose (TP) {#test-purpose-tp-85 .H6}
##### (1) {#section-268 .H6}
**with** { UE being registered to IMS and being made to initiate an emergency
call }
**ensure** that {
**when** { UE attempts IMS emergency registration and network declines by
sending 403 Forbidden }
**then** { UE initiates and completes IMS emergency calls on non-protected
ports }
**}**
##### 10.9.2 Conformance Requirements {#conformance-requirements-86 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 33.203 clause 7.1]
The Pâ€‘CSCF is allowed to receive only REGISTER messages, messages relating to
emergency services in accordance with TS 23.167 [31] and TS 24.229 [8], and
error messages related to unprotected messages on unprotected ports. All other
messages not arriving on a protected port shall be either discarded or
rejected by the Pâ€‘CSCF.
4\. The UE is allowed to receive only the following messages on an unprotected
port:
\- responses to unprotected REGISTER messages;
\- messages relating to emergency services in accordance with TS 23.167 [31]
and TS 24.229 [8];
\- error messages related to unprotected messages.
All other messages not arriving on a protected port shall be rejected or
silently discarded by the UE.
[TS 24.229 clause 5.1.6.1]
If the IM CN subsystem is selected and the UE is currently attached to its
home operator\'s network (e.g. HPLMN) and the UE is currently registered and
the IP-CAN defines emergency bearers and the core network has indicated that
it supports emergency bearers, the UE shall:
1) perform an initial emergency registration, as described in subclause
5.1.6.2; and
2) attempt an emergency call as described in subclause 5.1.6.8.3.
##### 10.9.3 Test description {#test-description-85 .H6}
##### 10.9.3.1 Pre-test conditions {#pre-test-conditions-85 .H6}
##### System Simulator: {#system-simulator-87 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-89 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-89 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 10.9.3.2 Test procedure sequence {#test-procedure-sequence-84 .H6}
Table 10.9.3.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | Make the UE | - | - | - | - | | | to initiate | | | | | | | an | | | | | | | emergency | | | | | | | call. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2-9 | Steps 1-8 | - | - | - | - | | | of Table | | | | | | | 4 | | | | | | | .9.11.2.2-1 | | | | | | | of TS | | | | | | | 38. | | | | | | | 508-1[21] | | | | | | | are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in steps | | | | | | | 10-11 below | | | | | | | the events | | | | | | | specified | | | | | | | in steps | | | | | | | 1a1 of | | | | | | | Table | | | | | | | 4 | | | | | | | .9.11.2.2-2 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] take | | | | | | | place. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 10-11 | Steps 9-10 | - | - | - | - | | | of Table | | | | | | | 4 | | | | | | | .9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+-------------+---------+----+ | 12 | UE sends | --> | REGISTER | - | - | | | REGISTER | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.3) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 13 | SS sends | \ | REGISTER | - | - | | | REGISTER | | | | | | | | | | | | | | (Step 3 of | | | | | | | Annex A.3) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 15 | SS sends | \ | INVITE | 1 | P | | | the UE send | | | | | | | a correctly | | | | | | | composed | | | | | | | INVITE | | | | | | | request? | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.6) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 17 | SS sends | \ | ACK | 1 | P | | | the UE send | | | | | | | ACK? | | | | | | | | | | | | | | (Step 5 of | | | | | | | annex A.6) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 21 | SS sends | \ | 200 OK | - | - | | | 200 OK. | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.8) | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 10.9.3.3 Specific message contents {#specific-message-contents-79 .H6}
**Table 10.9.3.3-1: 403 Forbidden (step 15, table 10.9.3.2-1)**
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.2, Conditions A1.
* * *
Table 10.9.3.3-2: INVITE (step 16, table 10.9.3.2-1)
* * *
Derivation Path: Annex A.6, Step 1, Conditions A6, A28 of TS 34.229-1 [2] cl
A.2.1
* * *
Table 10.9.3.3-3: 180 Ringing (step 18, table 10.9.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.6, Conditions A4, A7, A14.
* * *
Table 10.9.3.3-4: 200 OK (step 19, table 10.9.3.2-1)
* * *
Derivation Path: Annex A.6, Step 4, Conditions A7, A10, A22 of TS 34.229-1 [2]
cl A.3.1.
* * *
Table 10.9.3.3-5: BYE (step 21, table 10.9.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.8, Conditions A3, A6.
* * *
## 10.10 Emergency call without emergency registration / Failure of
registration / Rejected by 403(Forbidden)
##### 10.10.1 Test Purpose (TP) {#test-purpose-tp-86 .H6}
##### (1) {#section-269 .H6}
**with** { UE being registered to IMS in V-PLMN and being made to initiate an
emergency call }
**ensure** that {
**when** { UE attempts IMS emergency registration and visited network declines
by sending 403 Forbidden }
**then** { UE initiates and completes anonymous IMS emergency calls on non-
protected ports }
**}**
##### 10.10.2 Conformance Requirements {#conformance-requirements-87 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
> [TS 24.229, clause 5.1.1.2.1]
>
> On sending an unprotected REGISTER request, the UE shall populate the header
> fields as follows:
>
> a) a From header field set to the SIP URI that contains:
>
> 1) if the UE supports RFC 6140 [191] and performs the functions of an
> external attached network, the main URI of the UE; else
>
> 2) the public user identity to be registered;
>
> b) a To header field set to the SIP URI that contains:
>
> 1) if the UE supports RFC 6140 [191] and performs the functions of an
> external attached network, the main URI of the UE; else
>
> 2) the public user identity to be registered;
>
> c) a Contact header field set to include SIP URI(s) containing the IP
> address or FQDN of the UE in the hostport parameter. If the UE:
>
> 1) supports GRUU (see table A.4, item A.4/53);
>
> 2) supports multiple registrations;
>
> 3) has an IMEI available; or
>
> 4) has an MEID available;
>
> the UE shall include a \"+sip.instance\" header field parameter containing
> the instance ID. Only the IMEI shall be used for generating an instance ID
> for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access
> networks.
>
> NOTE 2: The requirement placed on the UE to include an instance ID based on
> the IMEI or the MEID when the UE does not support GRUU and does not support
> multiple registrations does not imply any additional requirements on the
> network.
>
> If the UE supports multiple registrations it shall include a \"reg-id\"
> header field parameter as described in RFC 5626 [92].
>
> The UE shall include all supported ICSI values (coded as specified in
> subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in
> subclause 7.9.2 and RFC 3840 [62] for the IMS communication services it
> intends to use, and IARI values (coded as specified in subclause 7.2A.9.2),
> for the IMS applications it intends to use in a g.3gpp.iari-ref media
> feature tag as defined in subclause 7.9.3 and RFC 3840 [62].
>
> The UE shall include the media feature tags as defined in RFC 3840 [62] for
> all supported streaming media types.
>
> If the UE supports RFC 6140 [191] and performs the functions of an external
> attached network, for the registration of bulk number contacts the UE shall
> include a Contact URI without a user portion and containing the \"bnc\" URI
> parameter.
>
> If the UE has no specific reason not to include a user part in the URI of
> the contact address (e.g. some UE performing the functions of an external
> attached network), the UE should include a user part in the URI of the
> contact address such that the user part is globally unique and does not
> reveal any private information;
>
> NOTE 3: A time-based UUID (Universal Unique Identifier) generated as per
> subclause 4.2 of RFC 4122 [154] is globally unique and does not reveal any
> private information.
>
> d) a Via header field set to include the sent-by field containing the IP
> address or FQDN of the UE and the port number where the UE expects to
> receive the response to this request when UDP is used. For TCP, the response
> is received on the TCP connection on which the request was sent. For the
> UDP, the UE shall also include a \"rport\" header field parameter with no
> value in the Via header field. Unless the UE has been configured to not send
> keep-alives, and unless the UE is directly connected to an IP-CAN for which
> usage of NAT is not defined, it shall include a \"keep\" header field
> parameter with no value in the Via header field, in order to indicate
> support of sending keep-alives associated with the registration, as
> described in RFC 6223 [143];
>
> NOTE 4: When sending the unprotected REGISTER request using UDP, the UE
> transmit the request from the same IP address and port on which it expects
> to receive the response to this request.
>
> e) a registration expiration interval value of 600 000 seconds as the value
> desired for the duration of the registration;
>
> NOTE 5: The registrar (S-CSCF) might decrease the duration of the
> registration in accordance with network policy. Registration attempts with a
> registration period of less than a predefined minimum value defined in the
> registrar will be rejected with a 423 (Interval Too Brief) response.
>
> f) a Request-URI set to the SIP URI of the domain name of the home network
> used to address the REGISTER request;
>
> g) the Supported header field containing the option-tag \"path\", and
>
> 1) if GRUU is supported, the option-tag \"gruu\"; and
>
> 2) if multiple registrations is supported, the option-tag \"outbound\".
>
> h) if a security association or TLS session exists, and if available to the
> UE (as defined in the access technology specific annexes for each access
> technology), a P-Access-Network-Info header field set as specified for the
> access network technology (see subclause 7.2A.4);
>
> i) a Security-Client header field to announce the media plane security
> mechanisms the UE supports, if any, labelled with the \"mediasec\" header
> field parameter specified in subclause 7.2A.7;
>
> NOTE 6: The \"mediasec\" header field parameter indicates that security
> mechanisms are specific to the media plane.
>
> j) if the UE supports RFC 6140 [191] and performs the functions of an
> external attached network, for the registration of bulk number contacts the
> UE shall include a Require header field containing the option-tag \"gin\";
> and
>
> k) if the UE supports RFC 6140 [191] and performs the functions of an
> external attached network, for the registration of bulk number contacts the
> UE shall include a Proxy-Require header field containing the option-tag
> \"gin\".
>
> [TS 24.229, clause 5.1.6.2]
>
> If:
>
> 1) the UE receives a 403 (Forbidden) response to the REGISTER request for
> initial emergency registration containing an \"sos\" SIP URI parameter in
> the Contact header field; and
>
> 2) the response contains a 3GPP IM CN subsystem XML body that includes an
> \ element, including a version attribute, with an \ service> child element with the \ child element set to \"emergency\"
> (see table 7.6.2) and \ child element set to \"anonymous-
> emergencycall\" (see table 7.6.3);
>
> the UE shall attempt an emergency call as described in subclause 5.1.6.8.2.
>
> [TS 24.229, clause 5.1.6.8.2]
>
> The UE shall apply the procedures as specified in subclause 5.1.2A.1 and
> subclause 5.1.3 with the following additions:
>
> 1) the UE shall set the From header field of the INVITE request to
> \"Anonymous\" as specified in RFC 3261 [26];
>
> 2) the UE shall include a service URN in the Request-URI of the initial
> INVITE request in accordance with subclause 5.1.6.8.1;
>
> NOTE 1: Other specifications make provision for emergency service
> identifiers, which are not specifically the emergency service URN, to be
> recognised in the UE. Emergency service identifiers which the UE does not
> detect will be treated as a normal call by the UE.
>
> 3) the UE shall insert in the INVITE request, a To header field with the
> same emergency service URN as in the Request-URI;
>
> 4) if available to the UE (as defined in the access technology specific
> annexes for each access technology), the UE shall include in the P-Access-
> Network-Info header field in any request for a dialog, any subsequent
> request (except CANCEL requests) or response (except CANCEL responses)
> within a dialog or any request. Insertion of the P-Access-Network-Info
> header field into the ACK request is optional. The UE shall populate the
> P-Access-Network-Info header field with the current point of attachment to
> the IP-CAN as specified for the access network technology (see subclause
> 7.2A.4). The P-Access-Network-Info header field contains the location
> identifier such as the cell id, the line id or the identity of the WLAN
> access node, which is relevant for routeing the emergency call;
>
> 5) if defined by the access technology specific annex, the UE shall populate
> the P-Preferred-Identity header field in the INVITE request with an
> equipment identifier as a SIP URI. The special details of the equipment
> identifier to use depend on the IP-CAN;
>
> 6) a Contact header field set to include SIP URI that contains in the
> hostport parameter the IP address of the UE and an unprotected port where
> the UE will receive incoming requests belonging to this dialog. The UE shall
> also include a \"sip.instance\" media feature tag containing Instance ID as
> described in RFC 5626 [92]. The UE shall not include either the public or
> temporary GRUU in the Contact header field;
>
> 7) a Via header field set to include the IP address of the UE in the sent-by
> field and for the UDP the unprotected server port value where the UE will
> receive response to the emergency request, while for the TCP, the response
> is received on the TCP connection on which the emergency request was sent.
> For the UDP, the UE shall also include \"rport\" header field parameter with
> no value in the top Via header field. Unless the UE has been configured to
> not send keep-alives, and unless the UE is directly connected to an IP-CAN
> for which usage of NAT is not defined, it shall include a \"keep\" header
> field parameter with no value in the Via header field, in order to indicate
> support of sending keep-alives associated with, and during the lifetime of,
> the emergency session, as described in RFC 6223 [143];
>
> NOTE 2: The UE inserts the same IP address and port number into the Contact
> header field and the Via header field, and sends all IP packets to the
> P-CSCF from this IP address and port number.
>
> 8) if the UE has its location information available, or a URI that points to
> the location information, the UE shall include a Geolocation header field in
> the INVITE request in the following way:
>
> \- if the UE is aware of the URI that points to where the UE\'s location is
> stored, include the URI as the Geolocation header field value, as described
> in RFC 6442 [89]; or
>
> \- if the UE is aware of its location information, include the location
> information in a PIDF location object, in accordance with RFC 4119 [90],
> include the location object in a message body with the content type
> application/pidf+xml, and include a Content ID URL, referring to the message
> body, as the Geolocation header field value, as described RFC 6442 [89], and
> include a Content-Disposition header field with a disposition type
> \"render\" value and a \"handling\" header field parameter with an
> \"optional\" value, as described in RFC 3261 [26];
>
> 9) if the UE includes a Geolocation header field, the UE shall also include
> a Geolocation-Routing header field with a \"yes\" header field value, which
> indicates that the location of the UE can be used by other entities to make
> routing decisions, as described in RFC 6442 [89];
>
> 10) if the UE has neither geographical location information available, nor a
> URI that points to the location information, the UE shall not insert a
> Geolocation header field in the INVITE request; and
>
> NOTE 3: It is suggested that UE\'s only use the option of providing a URI
> when the domain part belongs to the current P-CSCF or S-CSCF provider. This
> is an issue on which the network operator needs to provide guidance to the
> end user. A URI that is only resolvable to the UE which is making the
> emergency call is inapplicable in this area.
>
> 11) if support of the current location discovery during an emergency call is
> allowed in the IP-CAN specific annex and the UE supports the current
> location discovery during an emergency call, the UE shall include a Recv-
> Info header field as described in RFC 6086 [25], indicating the
> g.3gpp.current-location-discovery info package name and shall include an
> Accept header field indicating the \"application/vnd.3gpp.current-location-
> discovery+xml\" MIME type.
>
> NOTE 4: During the dialog, the points of attachment to the IP-CAN of the UE
> can change (e.g. UE connects to different cells). The UE will populate the
> P-Access-Network-Info header field in any request or response within a
> dialog with the current point of attachment to the IP-CAN (e.g. the current
> cell information).
>
> Reference(s)
>
> TS 24.229 [10] clauses 5.1.1.2.1, 5.1.6.2 and 5.1.6.8.2.
##### 10.10.3 Test description {#test-description-86 .H6}
##### 10.10.3.1 Pre-test conditions {#pre-test-conditions-86 .H6}
##### System Simulator: {#system-simulator-88 .H6}
\- NR Cell 12 as specified in TS 38.508-1 [4] table 4.4.2-3 is configured and
connected to 5GC, default parameters.
##### UE: {#ue-90 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-90 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 10.10.3.2 Test procedure sequence {#test-procedure-sequence-85 .H6}
Table 10.10.3.2-1: Main Behaviour
+--------+------------+------------+------------+------------+----+ | **St** | **P |** Message | **TP** | * | | | | rocedure**| Sequence** | | _Verdict_ _| | +========+============+============+============+============+====+ | | |__U - S_ _| * | | | | | | |_ Message** | | | +--------+------------+------------+------------+------------+----+ | 0 | UE is made | - | - | - | - | | | to | | | | | | | initiate | | | | | | | an | | | | | | | emergency | | | | | | | call. | | | | | +--------+------------+------------+------------+------------+----+ | 1-8 | Steps | - | - | - | - | | | 1-8of | | | | | | | Table | | | | | | | 4. | | | | | | | 9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +--------+------------+------------+------------+------------+----+ | | EXCEPTION: | - | -- | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in steps | | | | | | | 9-10 below | | | | | | | the events | | | | | | | specified | | | | | | | in steps | | | | | | | 1a1 of | | | | | | | Table | | | | | | | 4. | | | | | | | 9.11.2.2-2 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] | | | | | | | take | | | | | | | place. | | | | | +--------+------------+------------+------------+------------+----+ | 9-10 | Steps 9-10 | - | - | - | - | | | of Table | | | | | | | 4. | | | | | | | 9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +--------+------------+------------+------------+------------+----+ | 11 | UE sends | --> | REGISTER | - | - | | | REGISTER | | | | | | | | | | | | | | (Step 1 of | | | | | | | Annex A.3) | | | | | +--------+------------+------------+------------+------------+----+ | 12 | SS sends | \ | INVITE | 1 | P | | | Does the | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | INVITE | | | | | | | request? | | | | | +--------+------------+------------+------------+------------+----+ | 14 | SS sends | \ | ACK | - | - | | | ACK. | | | | | | | | | | | | | | (Step 5 of | | | | | | | annex A.6) | | | | | +--------+------------+------------+------------+------------+----+ | 18 | SS sends | \ | 200 OK | - | - | | | 200 OK. | | | | | | | | | | | | | | (Step 1 of | | | | | | | annex A.8) | | | | | +--------+------------+------------+------------+------------+----+
##### 10.10.3.3 Specific message contents {#specific-message-contents-80 .H6}
Table 10.10.3.3-1: 403 Forbidden (step 12, table 10.10.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.2, Conditions A1.
* * *
Table 10.10.3.3-2: INVITE (step 13, table 10.10.3.2-1)
+------------------+------+------------------+-----+-----------------+ | Derivation Path: | | | | | | TS 34.229-1 | | | | | | [2], Annex | | | | | | A.2.1, | | | | | | Conditions A6, | | | | | | A28. | | | | | +==================+======+==================+=====+=================+ | Header/param | Cond | Value/remark | Rel | Reference | +------------------+------+------------------+-----+-----------------+ | **Message-body** | | The following | | TS 24.229 [7] | | | | SDP types and | | | | | | values. | | | | | | | | | | | | **Session | | | | | | description:** | | | | | | | | | | | | _v=0_ | | | | | | | | | | | | _o=(username) | | | | | | (sess-id)_ | | | | | | ** | | | | | | (sess-version)**| | | | | |_IN_ (addrtype) | | | | | | (unicast-address | | | | | | for UE) | | | | | | | | | | | | _s=(session | | | | | | name)_ | | | | | | | | | | | | _c=IN_ | | | | | | (addrtype) | | | | | | (co | | | | | | nnection-address | | | | | | for UE) [Note | | | | | | 1] | | | | | | | | | | | | **Time | | | | | | description:**| | | | | | | | | | | |_t=_ | | | | | | **(start-time) | | | | | | (stop-time)**| | | | | | | | | | | |** Media | | | | | | description:__| | | | | | | | | | | |_ m=audio_ | | | | | | (transport port) | | | | | | [Note 2] | | | | | | | | | | | | _c=IN_ | | | | | | (addrtype) | | | | | | (co | | | | | | nnection-address | | | | | | for UE) [Note | | | | | | 1] | | | | | | | | | | | | _b=AS:_ | | | | | | ( | | | | | | bandwidth-value) | | | | | | | | | | | | Note 1: At least | | | | | | one \"c=\" field | | | | | | shall be | | | | | | present. | | | | | | | | | | | | Note 2: EVS | | | | | | codec shall be | | | | | | present in the | | | | | | media | | | | | | attributes, | | | | | | optionally | | | | | | including | | | | | | channel number | | | | | | \"/1\". | | | +------------------+------+------------------+-----+-----------------+
Table 10.10.3.3-3: 180 Ringing (step 15, table 10.10.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.6, Conditions A4, A7, A14.
* * *
Table 10.10.3.3-4: 200 OK (step 16, table 10.9.3.2-1)
* * *
Derivation Path: Annex A.6, Step 4, Conditions A7, A10, A22 of TS 34.229-1 [2]
cl A.3.1.
* * *
Table 10.10.3.3-5: BYE (step 18, table 10.9.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.8, Conditions A3, A6.
* * *
## 10.11 Void
## 10.12 User-initiated emergency reregistration / UE has emergency related
ongoing dialog / 5GS
##### 10.12.1 Test Purpose (TP) {#test-purpose-tp-87 .H6}
##### (1) {#section-270 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to start an emergency call }
**then** { UE performs IMS emergency registration and sets up an emergency
call }
}
##### (2) {#section-271 .H6}
**with** { Emergency call ongoing }
**ensure** **that** {
**when** { IMS emergency registration passes half of the expiring time }
**then** { UE performs IMS emergency re-registration }
}
##### 10.12.2 Conformance Requirements {#conformance-requirements-88 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.6.4]:
The UE shall perform user-initiated emergency reregistration as specified in
subclause 5.1.1.4 if half of the time for the emergency registration has
expired and:
\- the UE has emergency related ongoing dialog;
\- standalone transactions exist; or
\- the user initiates an emergency call.
The UE shall not perform user-initiated emergency reregistration in any other
cases.
[TS 24.229 clause 5.1.1.4.1]:
When sending a protected REGISTER request, the UE shall use a security
association or TLS session associated either with the contact address or with
the registration flow and the associated contact address used to send the
request, see 3GPP TS 33.203 [19], established as a result of an earlier
initial registration.
The UE shall extract or derive a public user identity, the private user
identity, and the domain name to be used in the Request-URI in the
registration, according to the procedures described in subclause 5.1.1.1A or
subclause 5.1.1.1B.
On sending a REGISTER request that does not contain a challenge response, the
UE shall populate the header fields as follows:
a) a From header field set to the SIP URI that contains:
1) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, the main URI of the UE; else
2) the public user identity to be registered;
b) a To header field set to the SIP URI that contains:
1) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, the main URI of the UE; else
2) the public user identity to be registered;
c) a Contact header field set to include SIP URI(s) that contain(s) in the
hostport parameter the IP address or FQDN of the UE, and containing the
instance ID of the UE in the \"+sip.instance\" header field parameter, if the
UE:
1) supports GRUU (see table A.4, item A.4/53);
2) supports multiple registrations;
3) has an IMEI available; or
4) has an MEID available.
Only the IMEI shall be used for generating an instance ID for a multi-mode UE
that supports both 3GPP and 3GPP2 defined radio access networks.
NOTE 1: The requirement placed on the UE to include an instance ID based on
the IMEI or the MEID when the UE does not support GRUU and does not support
multiple registrations does not imply any additional requirements on the
network.
If the UE support multiple registrations, it shall include \"reg-id\" header
field as described in RFC 5626 [92]. The UE shall include all supported ICSI
values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media
feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS
communication it intends to use, and IARI values (coded as specified in
subclause 7.2A.9.2), for the IMS applications it intends to use in a
g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840
[62].
If the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Contact URI without a user portion and containing the \"bnc\" URI
parameter.
If a user part has previously been included in an initial REGISTER request,
the UE shall use the user part which was previously used to create the binding
being refreshed or removed;
d) a Via header field set to include the IP address or FQDN of the UE in the
sent-by field. For the TCP, the response is received on the TCP connection on
which the request was sent. If the UE previously has previously negotiated
sending of keep-alives associated with the registration, it shall include a
\"keep\" header field parameter with no value in the Via header field, in
order to indicate continuous support to send keep-alives, as described in RFC
6223 [143];
e) a registration expiration interval value, set to 600 000 seconds as the
value desired for the duration of the registration;
NOTE 2: The registrar (S-CSCF) might decrease the duration of the registration
in accordance with network policy. Registration attempts with a registration
period of less than a predefined minimum value defined in the registrar will
be rejected with a 423 (Interval Too Brief) response.
f) a Request-URI set to the SIP URI of the domain name of the home network
used to address the REGISTER request;
g) the Supported header field containing the option-tag \"path\", and:
1) if GRUU is supported, the option-tag \"gruu\"; and
2) if multiple registrations is supported, the option-tag \"outbound\";
h) if available to the UE (as defined in the access technology specific
annexes for each access technology), a P-Access-Network-Info header field set
as specified for the access network technology (see subclause 7.2A.4);
i) a Security-Client header field to announce the media plane security
mechanisms the UE supports, if any, labelled with the \"mediasec\" header
field parameter specified in subclause 7.2A.7;
NOTE 3: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
j) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Require header field containing the option-tag \"gin\"; and
k) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Proxy-Require header field containing the option-tag \"gin\".
On receiving the 200 (OK) response to the REGISTER request, the UE shall:
a) bind the new expiration time of the registration for this public user
identity found in the To header field value either to the contact address or
to the registration flow and the associated contact address used in this
registration;
NOTE 4: If the UE supports RFC 6140 [191] and performs the functions of an
external attached network, the To header field will contain the main URI of
the UE.
b) store the list of service route values contained in the Service-Route
header field and bind the list either to the contact address or to the
registration flow and the associated contact address (if the multiple
registration mechanism is used);
NOTE 5: The stored list of service route values will be used to build a proper
preloaded Route header field for new dialogs and standalone transactions
(other than REGISTER method) when using either the respective contact address
or the registration flow and the associated contact address (if the multiple
registration mechanism is used).
NOTE 6: If the list of Service-Route headers saved from a previous
registration and bound either to this contact address or to the registration
flow and the associated contact address (if the multiple registration
mechanism is used), and the associated set of security associations or TLS
session already exist, then the received list of Service-Route headers
replaces the old list.
NOTE 7: The UE can utilize additional URIs contained in the P-Associated-URI
header field, e.g. for application purposes.
c) if the UE indicated support for GRUU in the Supported header field of the
REGISTER request then:
\- if the UE did not use the procedures specified in RFC 6140 [191] for
registration find the Contact header field within the response that matches
the one included in the REGISTER request. If this contains a \"pub-gruu\"
header field parameter or a \"temp-gruu\" header field parameter or both, then
store the value of those parameters as the GRUUs for the UE in association
with the public user identity and the contact address that was registered; and
\- if the UE used the procedures specified in RFC 6140 [191]for registration
then find the Contact header field within the response that matches the one
included in the REGISTER request. If this contains a \"pub-gruu\" header field
parameter then store the value of the \"pub-gruu\" header field parameter for
use for generating public GRUUs for registering UAs as specified in RFC 6140
[191]. If this contains a \"temp-gruu-cookie\" header field parameter then
store the value of the \"temp-gruu-cookie\" header field parameter for use for
generating temporary GRUUs for registering UAs as specified in RFC 6140 [191];
NOTE 8: When allocating public GRUUs to registering UAs the functionality
within the UE that performs the role of registrar will add an \"sg\" SIP URI
parameter that uniquely identifies that UA to the public GRUU it received in
the \"pub-gruu\" header field parameter. The procedures for generating a
temporary GRUU using the \"temp-gruu-cookie\" header field parameter are
specified in subclause 7.1.2.2 of RFC 6140 [191].
d) store the announcement of the media plane security mechanisms the P-CSCF
(IMS-ALG) supports received in the Security-Server header field and labelled
with the \"mediasec\" header field parameter specified in subclause 7.2A.7, if
any. Once the UE chooses a media security mechanism from the list received in
the Security-Server header field from the server, it may initiate that
mechanism on a media level when it initiates new media in an existing session;
NOTE 9: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
e) if the Via header field contains a \"keep\" header field parameter with a
value, continue to send keep-alives as described in RFC 6223 [143], towards
the P-CSCF;
f) if the 200 (OK) response contains the Authentication-Info header field
including a nextnonce field, store the contained nonce as a nonce for
authentication associated to the same registration or registration flow (if
the multiple registration mechanism is used) and shall delete any other
previously stored nonce value for authentication for this registration or
registration flow (if the multiple registration mechanism is used);
NOTE 10: The related registration flow or registration is identified by the
couple instance-id and reg-id if the multiple registration mechanism is used
or by contact address if not.
g) if a Feature-Caps header field is received, a UE supporting the Feature-
Caps header field shall consider the ICSI values received in the Feature-Caps
header field of 200 (OK) response as supported for the established
registration or registration flow (if the multiple registration mechanism is
used) according to RFC 6809 [190]; and
NOTE 11: The UE and related applications can use the ICSI values received in
the Feature-Caps header field to improve the user experience.
h) void.
[TS 24.229 clause 5.1.1.4.2]:
On sending a REGISTER request, as defined in subclause 5.1.1.4.1, the UE shall
additionally populate the header fields as follows:
a) an Authorization header field, with:
\- the \"username\" header field parameter set to the value of the private
user identity;
\- the \"realm\" header field parameter directive, set to the value as
received in the \"realm\" WWW-Authenticate header field parameter;
\- the \"uri\" header field parameter, set to the SIP URI of the domain name
of the home network;
\- the \"nonce\" header field parameter, set to last received nonce value; and
\- the \"response\" header field parameter, set to the last calculated
response value;
NOTE 1: If the UE specifies its FQDN in the hostport parameter in the Contact
header field and in the sent-by field in the Via header field, then it has to
ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the
IP address that is bound to the security association.
NOTE 2: The UE associates two ports, a protected client port and a protected
server port, with each pair of security associations. For details on the
selection of the protected port value see 3GPP TS 33.203 [19].
NOTE 3: If the UE is setting up an additional registration using procedures
specified in RFC 5626 [92] and the UE accesses the network through 3GPP or
3GPP2 systems without any NAT, the flow is considered to be \"logical flow\".
b) additionally for the Contact header field, include the protected server
port value in the hostport parameter;
c) additionally for the Via header field, for UDP, if the REGISTER request is
protected by a security association, include the protected server port value
in the sent-by field;
d) a Security-Client header field, set to specify the signalling plane
security mechanism it supports, the IPsec layer algorithms for security and
confidentiality protection it supports and the new parameter values needed for
the setup of two new pairs of security associations. For further details see
3GPP TS 33.203 [19] and RFC 3329 [48]; and
e) a Security-Verify header field that contains the content of the Security-
Server header field received in the 401 (Unauthorized) response of the last
successful authentication.
On receiving the 200 (OK) response to the REGISTER request, the UE shall
additionally:
a) set the security association lifetime associated with either this contact
address or the registration flow and the associated contact address (if the
multiple registration mechanism is used), and the associated set of security
associations to the longest of either the previously existing security
association lifetime, or the lifetime of the just completed registration plus
30 seconds.
NOTE 4: If the UE receives Authentication-Info, it will proceed as described
in RFC 3310 [49].
[TS 24.229 clause 5.1.1.5.1]:
On receiving a 401 (Unauthorized) response to the REGISTER request, the UE
shall:
1) extract the RAND and AUTN parameters;
2) check the validity of a received authentication challenge, as described in
3GPP TS 33.203 [19] i.e. the locally calculated XMAC must match the MAC
parameter derived from the AUTN part of the challenge; and the SQN parameter
derived from the AUTN part of the challenge must be within the correct range;
and
3) check the existence of the Security-Server header field as described in RFC
3329 [48]. If the Security-Server header field is not present or it does not
contain the parameters required for the setup of the set of security
associations (see annex H of 3GPP TS 33.203 [19]), the UE shall abandon the
authentication procedure and send a new REGISTER request with a new Call-ID.
In the case that the 401 (Unauthorized) response to the REGISTER request is
deemed to be valid the UE shall:
1) calculate the RES parameter and derive the keys CK and IK from RAND as
described in 3GPP TS 33.203 [19];
2) set up a temporary set of security associations for this registration based
on the static list and parameters the UE received in the 401 (Unauthorized)
response and its capabilities sent in the Security-Client header field in the
REGISTER request. The UE sets up the temporary set of security associations
using the most preferred mechanism and algorithm returned by the P-CSCF and
supported by the UE and using IK and CK (only if encryption enabled) as the
shared key. The UE shall use the parameters received in the Security-Server
header field to setup the temporary set of security associations. The UE shall
set a temporary SIP level lifetime for the temporary set of security
associations to the value of reg-await-auth timer;
3) store the announcement of the media plane security mechanisms the P-CSCF
(IMS-ALG) supports received in the Security-Server header field and labelled
with the \"mediasec\" header field parameter specified in subclause 7.2A.7, if
any; and
NOTE 1: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
4) send another REGISTER request towards the protected server port indicated
in the response using the temporary set of security associations to protect
the message. The header fields are populated as defined for the initial
REGISTER request that was challenged with the received 401 (Unauthorized)
response, with the addition that the UE shall include an Authorization header
field containing:
\- the \"realm\" header field parameter set to the value as received in the
\"realm\" WWW-Authenticate header field parameter;
\- the \"username\" header field parameter, set to the value of the private
user identity;
\- the \"response\" header field parameter that contains the RES parameter, as
described in RFC 3310 [49];
\- the \"uri\" header field parameter, set to the SIP URI of the domain name
of the home network;
\- the \"**algorithm\" header field parameter,** set to the value received in
the 401 (Unauthorized) response; and
\- the \"nonce\" header field parameter, set to the value received in the 401
(Unauthorized) response.
The UE shall also insert the Security-Client header field that is identical to
the Security-Client header field that was included in the previous REGISTER
request (i.e. the REGISTER request that was challenged with the received 401
(Unauthorized) response). The UE shall also insert the Security-Verify header
field into the request, by mirroring in it the content of the Security-Server
header field received in the 401 (Unauthorized) response. The UE shall set the
Call-ID of the security association protected REGISTER request which carries
the authentication challenge response to the same value as the Call-ID of the
401 (Unauthorized) response which carried the challenge.
NOTE 2: The Security-Client header field contains signalling plane security
mechanism and if the UE supports media plane security, then media plane
security mechanisms are contained, too.
On receiving the 200 (OK) response for the security association protected
REGISTER request registering a public user identity with the associated
contact address, the UE shall:
\- change the temporary set of security associations to a newly established
set of security associations, i.e. set its SIP level lifetime to the longest
of either the previously existing set of security associations SIP level
lifetime, or the lifetime of the just completed registration plus 30 seconds;
and
\- if this is the only set of security associations available toward the
P-CSCF, use the newly established set of security associations for further
messages sent towards the P-CSCF. If there are additional sets of security
associations (e.g. due to registration of multiple contact addresses), the UE
can either use them or use the newly established set of security associations
for further messages sent towards the P-CSCF as appropriate.
Reference(s)
3GPP TS 24.229 [7], clauses 5.1.1.4.1, 5.1.1.4.2, 5.1.1.5.1 and 5.1.6.4.
##### 10.12.3 Test description {#test-description-87 .H6}
##### 10.12.3.1 Pre-test conditions {#pre-test-conditions-87 .H6}
##### System Simulator: {#system-simulator-89 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-91 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-91 .H6}
\- The UE is in test state 1N-A (TS 38.508-1) and registered to IMS.
##### 10.12.3.2 Test procedure sequence {#test-procedure-sequence-86 .H6}
Table 10.12.3.2-1: Main Behaviour
+------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +------+-------------+-------------+-------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to initiate | | | | | | | an | | | | | | | emergency | | | | | | | call | | | | | +------+-------------+-------------+-------------+---------+----+ | 2-4 | Check: Does | - | - | 1 | P | | | the UE | | | | | | | correctly | | | | | | | initiate | | | | | | | emergency | | | | | | | re | | | | | | | gistration? | | | | | | | | | | | | | | (Steps 1-3 | | | | | | | of Annex | | | | | | | A.3) | | | | | +------+-------------+-------------+-------------+---------+----+ | 5 | SS responds | \ | REGISTER | 2 | P | | | the UE | | | | | | | re-register | | | | | | | to the | | | | | | | emergency | | | | | | | service 60 | | | | | | | seconds | | | | | | | before the | | | | | | | expiration | | | | | | | time? | | | | | +------+-------------+-------------+-------------+---------+----+ | 12 | The SS | \ | REGISTER | 2 | P | | | the UE | | | | | | | complete | | | | | | | the | | | | | | | security | | | | | | | negotiation | | | | | | | procedures, | | | | | | | set up a | | | | | | | new | | | | | | | temporary | | | | | | | set of SAs | | | | | | | and uses | | | | | | | those for | | | | | | | sending | | | | | | | another | | | | | | | REGISTER? | | | | | +------+-------------+-------------+-------------+---------+----+ | 14 | The SS | \ | 200 OK | - | - | | | the UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request and | | | | | | | ends the | | | | | | | call? | | | | | | | | | | | | | | (Step 2 of | | | | | | | annex A.8) | | | | | +------+-------------+-------------+-------------+---------+----+
##### 10.12.3.3 Specific message contents {#specific-message-contents-81 .H6}
Table 10.12.3.3-1: 200 OK for REGISTER (step 5, table 10.12.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.1.3, Condition A3
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
expires 120
Table 10.12.3.3-2: REGISTER (step 11, table 10.12.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.1.1, Conditions A2 and A32
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec SIP URI with IP address or FQDN and protected server port of UE. The
SIP URI shall contain the sos URI parameter.  
**Security-Client**  
spi-c new SPI number of the inbound SA at the protected client port  
spi-s new SPI number of the inbound SA at the protected server port  
port-c new protected client port needed for the setup of new pairs of security
associations  
port-s Same value as in the previous REGISTER
Table 10.12.3.3-3: 401 Unauthorized for REGISTER (step 12, table 10.12.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.1.2
* * *
Header/param Cond Value/remark Rel Reference **Security-Server**  
spi-c new SPI number of the inbound SA at the protected client port  
spi-s new SPI number of the inbound SA at the protected server port  
port-c new protected client port needed for the setup of new pairs of security
associations  
port-s Same value as in the previous Security-Server headers  
**WWW-Authenticate**  
nonce Base 64 encoding of a new RAND and AUTN
Table 10.12.3.3-4: REGISTER (step 13, table 10.12.3.2-1)
Derivation Path: TS 34.229-1 [2], Annex A.1.1, Conditions A2 and A32
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec The same with Step 11 above.  
**Security-Client**  
spi-c The same with Step 11 above.  
spi-s The same with Step 11 above.  
port-c The same with Step 11 above.  
port-s The same with Step 11 above.  
**Authorization** Recalculated based on the nonce received from SS within 401
response in Step 12 above.
## 10.13 User-initiated emergency reregistration / User initiates an emergency
call / 5GS
##### 10.13.1 Test Purpose (TP) {#test-purpose-tp-88 .H6}
##### (1) {#section-272 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is made to start an emergency call }
**then** { UE performs IMS emergency registration and initiates the setup of
an emergency call }
}
##### (2) {#section-273 .H6}
**with** { Emergency call setup having proceeded until 180 Ringing }
**ensure** **that** {
**when** { IMS emergency registration expiring }
**then** { UE performs IMS emergency re-registration }
}
##### 10.13.2 Conformance Requirements {#conformance-requirements-89 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.6.4]:
The UE shall perform user-initiated emergency reregistration as specified in
subclause 5.1.1.4 if half of the time for the emergency registration has
expired and:
\- the UE has emergency related ongoing dialog;
\- standalone transactions exist; or
\- the user initiates an emergency call.
The UE shall not perform user-initiated emergency reregistration in any other
cases.
[TS 24.229 clause 5.1.1.4.1]:
When sending a protected REGISTER request, the UE shall use a security
association or TLS session associated either with the contact address or with
the registration flow and the associated contact address used to send the
request, see 3GPP TS 33.203 [19], established as a result of an earlier
initial registration.
The UE shall extract or derive a public user identity, the private user
identity, and the domain name to be used in the Request-URI in the
registration, according to the procedures described in subclause 5.1.1.1A or
subclause 5.1.1.1B.
On sending a REGISTER request that does not contain a challenge response, the
UE shall populate the header fields as follows:
a) a From header field set to the SIP URI that contains:
1) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, the main URI of the UE; else
2) the public user identity to be registered;
b) a To header field set to the SIP URI that contains:
1) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, the main URI of the UE; else
2) the public user identity to be registered;
c) a Contact header field set to include SIP URI(s) that contain(s) in the
hostport parameter the IP address or FQDN of the UE, and containing the
instance ID of the UE in the \"+sip.instance\" header field parameter, if the
UE:
1) supports GRUU (see table A.4, item A.4/53);
2) supports multiple registrations;
3) has an IMEI available; or
4) has an MEID available.
Only the IMEI shall be used for generating an instance ID for a multi-mode UE
that supports both 3GPP and 3GPP2 defined radio access networks.
NOTE 1: The requirement placed on the UE to include an instance ID based on
the IMEI or the MEID when the UE does not support GRUU and does not support
multiple registrations does not imply any additional requirements on the
network.
If the UE support multiple registrations, it shall include \"reg-id\" header
field as described in RFC 5626 [92]. The UE shall include all supported ICSI
values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media
feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS
communication it intends to use, and IARI values (coded as specified in
subclause 7.2A.9.2), for the IMS applications it intends to use in a
g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840
[62].
If the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Contact URI without a user portion and containing the \"bnc\" URI
parameter.
If a user part has previously been included in an initial REGISTER request,
the UE shall use the user part which was previously used to create the binding
being refreshed or removed;
d) a Via header field set to include the IP address or FQDN of the UE in the
sent-by field. For the TCP, the response is received on the TCP connection on
which the request was sent. If the UE previously has previously negotiated
sending of keep-alives associated with the registration, it shall include a
\"keep\" header field parameter with no value in the Via header field, in
order to indicate continuous support to send keep-alives, as described in RFC
6223 [143];
e) a registration expiration interval value, set to 600 000 seconds as the
value desired for the duration of the registration;
NOTE 2: The registrar (S-CSCF) might decrease the duration of the registration
in accordance with network policy. Registration attempts with a registration
period of less than a predefined minimum value defined in the registrar will
be rejected with a 423 (Interval Too Brief) response.
f) a Request-URI set to the SIP URI of the domain name of the home network
used to address the REGISTER request;
g) the Supported header field containing the option-tag \"path\", and:
1) if GRUU is supported, the option-tag \"gruu\"; and
2) if multiple registrations is supported, the option-tag \"outbound\";
h) if available to the UE (as defined in the access technology specific
annexes for each access technology), a P-Access-Network-Info header field set
as specified for the access network technology (see subclause 7.2A.4);
i) a Security-Client header field to announce the media plane security
mechanisms the UE supports, if any, labelled with the \"mediasec\" header
field parameter specified in subclause 7.2A.7;
NOTE 3: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
j) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Require header field containing the option-tag \"gin\"; and
k) if the UE supports RFC 6140 [191] and performs the functions of an external
attached network, for the registration of bulk number contacts the UE shall
include a Proxy-Require header field containing the option-tag \"gin\".
On receiving the 200 (OK) response to the REGISTER request, the UE shall:
a) bind the new expiration time of the registration for this public user
identity found in the To header field value either to the contact address or
to the registration flow and the associated contact address used in this
registration;
NOTE 4: If the UE supports RFC 6140 [191] and performs the functions of an
external attached network, the To header field will contain the main URI of
the UE.
b) store the list of service route values contained in the Service-Route
header field and bind the list either to the contact address or to the
registration flow and the associated contact address (if the multiple
registration mechanism is used);
NOTE 5: The stored list of service route values will be used to build a proper
preloaded Route header field for new dialogs and standalone transactions
(other than REGISTER method) when using either the respective contact address
or the registration flow and the associated contact address (if the multiple
registration mechanism is used).
NOTE 6: If the list of Service-Route headers saved from a previous
registration and bound either to this contact address or to the registration
flow and the associated contact address (if the multiple registration
mechanism is used), and the associated set of security associations or TLS
session already exist, then the received list of Service-Route headers
replaces the old list.
NOTE 7: The UE can utilize additional URIs contained in the P-Associated-URI
header field, e.g. for application purposes.
c) if the UE indicated support for GRUU in the Supported header field of the
REGISTER request then:
\- if the UE did not use the procedures specified in RFC 6140 [191] for
registration find the Contact header field within the response that matches
the one included in the REGISTER request. If this contains a \"pub-gruu\"
header field parameter or a \"temp-gruu\" header field parameter or both, then
store the value of those parameters as the GRUUs for the UE in association
with the public user identity and the contact address that was registered; and
\- if the UE used the procedures specified in RFC 6140 [191]for registration
then find the Contact header field within the response that matches the one
included in the REGISTER request. If this contains a \"pub-gruu\" header field
parameter then store the value of the \"pub-gruu\" header field parameter for
use for generating public GRUUs for registering UAs as specified in RFC 6140
[191]. If this contains a \"temp-gruu-cookie\" header field parameter then
store the value of the \"temp-gruu-cookie\" header field parameter for use for
generating temporary GRUUs for registering UAs as specified in RFC 6140 [191];
NOTE 8: When allocating public GRUUs to registering UAs the functionality
within the UE that performs the role of registrar will add an \"sg\" SIP URI
parameter that uniquely identifies that UA to the public GRUU it received in
the \"pub-gruu\" header field parameter. The procedures for generating a
temporary GRUU using the \"temp-gruu-cookie\" header field parameter are
specified in subclause 7.1.2.2 of RFC 6140 [191].
d) store the announcement of the media plane security mechanisms the P-CSCF
(IMS-ALG) supports received in the Security-Server header field and labelled
with the \"mediasec\" header field parameter specified in subclause 7.2A.7, if
any. Once the UE chooses a media security mechanism from the list received in
the Security-Server header field from the server, it may initiate that
mechanism on a media level when it initiates new media in an existing session;
NOTE 9: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
e) if the Via header field contains a \"keep\" header field parameter with a
value, continue to send keep-alives as described in RFC 6223 [143], towards
the P-CSCF;
f) if the 200 (OK) response contains the Authentication-Info header field
including a nextnonce field, store the contained nonce as a nonce for
authentication associated to the same registration or registration flow (if
the multiple registration mechanism is used) and shall delete any other
previously stored nonce value for authentication for this registration or
registration flow (if the multiple registration mechanism is used);
NOTE 10: The related registration flow or registration is identified by the
couple instance-id and reg-id if the multiple registration mechanism is used
or by contact address if not.
g) if a Feature-Caps header field is received, a UE supporting the Feature-
Caps header field shall consider the ICSI values received in the Feature-Caps
header field of 200 (OK) response as supported for the established
registration or registration flow (if the multiple registration mechanism is
used) according to RFC 6809 [190]; and
NOTE 11: The UE and related applications can use the ICSI values received in
the Feature-Caps header field to improve the user experience.
h) void.
[TS 24.229 clause 5.1.1.4.2]:
On sending a REGISTER request, as defined in subclause 5.1.1.4.1, the UE shall
additionally populate the header fields as follows:
a) an Authorization header field, with:
\- the \"username\" header field parameter set to the value of the private
user identity;
\- the \"realm\" header field parameter directive, set to the value as
received in the \"realm\" WWW-Authenticate header field parameter;
\- the \"uri\" header field parameter, set to the SIP URI of the domain name
of the home network;
\- the \"nonce\" header field parameter, set to last received nonce value; and
\- the \"response\" header field parameter, set to the last calculated
response value;
NOTE 1: If the UE specifies its FQDN in the hostport parameter in the Contact
header field and in the sent-by field in the Via header field, then it has to
ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the
IP address that is bound to the security association.
NOTE 2: The UE associates two ports, a protected client port and a protected
server port, with each pair of security associations. For details on the
selection of the protected port value see 3GPP TS 33.203 [19].
NOTE 3: If the UE is setting up an additional registration using procedures
specified in RFC 5626 [92] and the UE accesses the network through 3GPP or
3GPP2 systems without any NAT, the flow is considered to be \"logical flow\".
b) additionally for the Contact header field, include the protected server
port value in the hostport parameter;
c) additionally for the Via header field, for UDP, if the REGISTER request is
protected by a security association, include the protected server port value
in the sent-by field;
d) a Security-Client header field, set to specify the signalling plane
security mechanism it supports, the IPsec layer algorithms for security and
confidentiality protection it supports and the new parameter values needed for
the setup of two new pairs of security associations. For further details see
3GPP TS 33.203 [19] and RFC 3329 [48]; and
e) a Security-Verify header field that contains the content of the Security-
Server header field received in the 401 (Unauthorized) response of the last
successful authentication.
On receiving the 200 (OK) response to the REGISTER request, the UE shall
additionally:
a) set the security association lifetime associated with either this contact
address or the registration flow and the associated contact address (if the
multiple registration mechanism is used), and the associated set of security
associations to the longest of either the previously existing security
association lifetime, or the lifetime of the just completed registration plus
30 seconds.
NOTE 4: If the UE receives Authentication-Info, it will proceed as described
in RFC 3310 [49].
[TS 24.229 clause 5.1.1.5.1]:
On receiving a 401 (Unauthorized) response to the REGISTER request, the UE
shall:
1) extract the RAND and AUTN parameters;
2) check the validity of a received authentication challenge, as described in
3GPP TS 33.203 [19] i.e. the locally calculated XMAC must match the MAC
parameter derived from the AUTN part of the challenge; and the SQN parameter
derived from the AUTN part of the challenge must be within the correct range;
and
3) check the existence of the Security-Server header field as described in RFC
3329 [48]. If the Security-Server header field is not present or it does not
contain the parameters required for the setup of the set of security
associations (see annex H of 3GPP TS 33.203 [19]), the UE shall abandon the
authentication procedure and send a new REGISTER request with a new Call-ID.
In the case that the 401 (Unauthorized) response to the REGISTER request is
deemed to be valid the UE shall:
1) calculate the RES parameter and derive the keys CK and IK from RAND as
described in 3GPP TS 33.203 [19];
2) set up a temporary set of security associations for this registration based
on the static list and parameters the UE received in the 401 (Unauthorized)
response and its capabilities sent in the Security-Client header field in the
REGISTER request. The UE sets up the temporary set of security associations
using the most preferred mechanism and algorithm returned by the P-CSCF and
supported by the UE and using IK and CK (only if encryption enabled) as the
shared key. The UE shall use the parameters received in the Security-Server
header field to setup the temporary set of security associations. The UE shall
set a temporary SIP level lifetime for the temporary set of security
associations to the value of reg-await-auth timer;
3) store the announcement of the media plane security mechanisms the P-CSCF
(IMS-ALG) supports received in the Security-Server header field and labelled
with the \"mediasec\" header field parameter specified in subclause 7.2A.7, if
any; and
NOTE 1: The \"mediasec\" header field parameter indicates that security
mechanisms are specific to the media plane.
4) send another REGISTER request towards the protected server port indicated
in the response using the temporary set of security associations to protect
the message. The header fields are populated as defined for the initial
REGISTER request that was challenged with the received 401 (Unauthorized)
response, with the addition that the UE shall include an Authorization header
field containing:
\- the \"realm\" header field parameter set to the value as received in the
\"realm\" WWW-Authenticate header field parameter;
\- the \"username\" header field parameter, set to the value of the private
user identity;
\- the \"response\" header field parameter that contains the RES parameter, as
described in RFC 3310 [49];
\- the \"uri\" header field parameter, set to the SIP URI of the domain name
of the home network;
\- the \"**algorithm\" header field parameter,** set to the value received in
the 401 (Unauthorized) response; and
\- the \"nonce\" header field parameter, set to the value received in the 401
(Unauthorized) response.
The UE shall also insert the Security-Client header field that is identical to
the Security-Client header field that was included in the previous REGISTER
request (i.e. the REGISTER request that was challenged with the received 401
(Unauthorized) response). The UE shall also insert the Security-Verify header
field into the request, by mirroring in it the content of the Security-Server
header field received in the 401 (Unauthorized) response. The UE shall set the
Call-ID of the security association protected REGISTER request which carries
the authentication challenge response to the same value as the Call-ID of the
401 (Unauthorized) response which carried the challenge.
NOTE 2: The Security-Client header field contains signalling plane security
mechanism and if the UE supports media plane security, then media plane
security mechanisms are contained, too.
On receiving the 200 (OK) response for the security association protected
REGISTER request registering a public user identity with the associated
contact address, the UE shall:
\- change the temporary set of security associations to a newly established
set of security associations, i.e. set its SIP level lifetime to the longest
of either the previously existing set of security associations SIP level
lifetime, or the lifetime of the just completed registration plus 30 seconds;
and
\- if this is the only set of security associations available toward the
P-CSCF, use the newly established set of security associations for further
messages sent towards the P-CSCF. If there are additional sets of security
associations (e.g. due to registration of multiple contact addresses), the UE
can either use them or use the newly established set of security associations
for further messages sent towards the P-CSCF as appropriate.
Reference(s)
3GPP TS 24.229 [7], clauses 5.1.1.4.1, 5.1.1.4.2, 5.1.1.5.1 and 5.1.6.4.
##### 10.13.3 Test description {#test-description-88 .H6}
##### 10.13.3.1 Pre-test conditions {#pre-test-conditions-88 .H6}
##### System Simulator: {#system-simulator-90 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-92 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-92 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 10.13.3.2 Test procedure sequence {#test-procedure-sequence-87 .H6}
Table 10.13.3.2-1: Main Behaviour
+-------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +-------+-------------+-------------+-------------+---------+----+ | 1 | UE is made | - | - | - | - | | | to | | | | | | | initiates | | | | | | | an | | | | | | | emergency | | | | | | | call | | | | | +-------+-------------+-------------+-------------+---------+----+ | 2-4 | Check: Does | - | - | 1 | P | | | the UE | | | | | | | correctly | | | | | | | initiate | | | | | | | and | | | | | | | complete | | | | | | | emergency | | | | | | | re | | | | | | | gistration? | | | | | | | | | | | | | | (Steps 1-3 | | | | | | | of Annex | | | | | | | A.3) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 5 | SS responds | \ | REGISTER | 2 | P | | | the UE | | | | | | | re-register | | | | | | | to the | | | | | | | emergency | | | | | | | service in | | | | | | | a time span | | | | | | | between | | | | | | | half of the | | | | | | | expiration | | | | | | | time and | | | | | | | the full | | | | | | | expiration | | | | | | | time? | | | | | | | | | | | | | | (Note: in | | | | | | | this test | | | | | | | case, the | | | | | | | re-r | | | | | | | egistration | | | | | | | time is set | | | | | | | to an | | | | | | | untypically | | | | | | | short value | | | | | | | of 30 | | | | | | | seconds. As | | | | | | | there are | | | | | | | no | | | | | | | r | | | | | | | equirements | | | | | | | on the | | | | | | | duration of | | | | | | | a | | | | | | | re-r | | | | | | | egistration | | | | | | | procedure | | | | | | | it is only | | | | | | | checked | | | | | | | that the | | | | | | | re-r | | | | | | | egistration | | | | | | | procedure | | | | | | | starts | | | | | | | between | | | | | | | half of the | | | | | | | expiration | | | | | | | time and | | | | | | | the full | | | | | | | expiration | | | | | | | time.) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 11 | The SS | \ | REGISTER | 2 | P | | | the UE | | | | | | | complete | | | | | | | the | | | | | | | security | | | | | | | negotiation | | | | | | | procedures, | | | | | | | set up a | | | | | | | new | | | | | | | temporary | | | | | | | set of SAs | | | | | | | and uses | | | | | | | those for | | | | | | | sending | | | | | | | another | | | | | | | REGISTER? | | | | | +-------+-------------+-------------+-------------+---------+----+ | 13 | The SS | \ | ACK | - | - | | | from UE to | | | | | | | confirm the | | | | | | | dialog | | | | | | | | | | | | | | (Step 5 of | | | | | | | annex A.6) | | | | | +-------+-------------+-------------+-------------+---------+----+ | 16-17 | The call is | - | - | - | - | | | released by | | | | | | | the SS | | | | | | | | | | | | | | (Steps 1-2 | | | | | | | of annex A. | | | | | | | 8) | | | | | +-------+-------------+-------------+-------------+---------+----+
##### 10.13.3.3 Specific message contents {#specific-message-contents-82 .H6}
Table 10.13.3.3-1: 200 OK for REGISTER (step 5, table 10.13.3.2-1)
Derivation Path: TS 34.229-1 [2], A.1.3, Condition A3
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
expires 30
Table 10.13.3.3-2: REGISTER (step 10, table 10.13.3.2-1)
Derivation Path: TS 34.229-1 [2], A.1.1, Conditions A2 and A32
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec SIP URI with IP address or FQDN and protected server port of UE. The
SIP URI shall contain the sos URI parameter.  
**Security-Client**  
spi-c new SPI number of the inbound SA at the protected client port  
spi-s new SPI number of the inbound SA at the protected server port  
port-c new protected client port needed for the setup of new pairs of security
associations  
port-s Same value as in the previous REGISTER
Table 10.13.3.3-3: 401 Unauthorized for REGISTER (step 11, table 10.13.3.2-1)
Derivation Path: TS 34.229-1 [2], A.1.2
* * *
Header/param Cond Value/remark Rel Reference **Security-Server**  
spi-c new SPI number of the inbound SA at the protected client port  
spi-s new SPI number of the inbound SA at the protected server port  
port-c new protected client port needed for the setup of new pairs of security
associations  
port-s Same value as in the previous Security-Server headers  
**WWW-Authenticate**  
nonce Base 64 encoding of a new RAND and AUTN
Table 10.13.3.3-4: REGISTER (step 12, table 10.13.3.2-1)
Derivation Path: TS 34.229-1 [2], A.1.1, Conditions A2 and A32
* * *
Header/param Cond Value/remark Rel Reference **Contact**  
addr-spec The same with Step 10 above.  
**Security-Client**  
spi-c The same with Step 10 above.  
spi-s The same with Step 10 above.  
port-c The same with Step 10 above.  
port-s The same with Step 10 above.  
**Authorization** Recalculated based on the nonce received from SS within 401
response in Step 11 above.
## 10.14 In parallel emergency and non-emergency registrations / 5GS
##### 10.14.1 Test Purpose (TP) {#test-purpose-tp-89 .H6}
##### (1) {#section-274 .H6}
**with { UE being registered to IMS }**
**ensure that** {
**when** { UE is made to start an emergency call }
**then** { UE performs IMS emergency registration and sets up an emergency
call }
}
##### (2) {#section-275 .H6}
**with { Emergency call ongoing }**
**ensure that** {
**when** { Network sends NOTIFY terminating non-emergency public user
identities }
**then** { UE sends 200 OK without impacting ongoing emergency registration
and call }
}
##### 10.14.2 Conformance Requirements {#conformance-requirements-90 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-15 requirements.
[TS 24.229 clause 5.1.6.2]:
When the UE performs an initial emergency registration and whilst this
emergency registration is active, the UE shall:
\- handle the emergency registration independently from any other ongoing
registration to the IM CN subsystem;
\- handle any signalling or media related IP-CAN for the purpose of emergency
calls independently from any other established IP-CAN for IM CN subsystem
related signalling or media; and
\- handle all SIP signalling and all media related to the emergency call
independently from any other ongoing IM CN subsystem signalling and media.
##### 10.14.3 Test description {#test-description-89 .H6}
##### 10.14.3.1 Pre-test conditions {#pre-test-conditions-89 .H6}
##### System Simulator: {#system-simulator-91 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-93 .H6}
\- UE contains either ISIM and USIM applications or only USIM application on
UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-93 .H6}
\- The UE is in test state 1N-A (TS 38.508-1 [21]) and registered to IMS by
executing the generic test procedure in Annex A.2 up to the last step.
##### 10.14.3.2 Test procedure sequence {#test-procedure-sequence-88 .H6}
Table 10.14.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | UE is made | - | - | - | - | | | to make an | | | | | | | emergency | | | | | | | call | | | | | +------------+------------+------------+---------+---------+----+ | 2-14 | Steps 1 | - | - | 1 | P | | | -13 in | | | | | | | generic | | | | | | | test | | | | | | | procedure | | | | | | | in TS | | | | | | | 38.508-1 | | | | | | | [21] | | | | | | | Table | | | | | | | 4. | | | | | | | 9.11.2.2-1 | | | | | | | are | | | | | | | performed. | | | | | | | And steps | | | | | | | in A.3 and | | | | | | | step A.6 | | | | | | | are | | | | | | | performed | | | | | | | in the | | | | | | | generic | | | | | | | test | | | | | | | procedure, | | | | | | | to | | | | | | | initiate | | | | | | | IMS | | | | | | | emergency | | | | | | | re | | | | | | | gistration | | | | | | | and IMS | | | | | | | emergency | | | | | | | voice | | | | | | | call. | | | | | +------------+------------+------------+---------+---------+----+ | 15 | The SS | ÃŸ | NOTIFY | - | - | | | sends a | | | | | | | NOTIFY for | | | | | | | re | | | | | | | gistration | | | | | | | event | | | | | | | package, | | | | | | | containing | | | | | | | partial | | | | | | | re | | | | | | | gistration | | | | | | | state | | | | | | | in | | | | | | | formation, | | | | | | | with all | | | | | | | previously | | | | | | | registered | | | | | | | non | | | | | | | -emergency | | | | | | | public | | | | | | | user | | | | | | | identities | | | | | | | as | | | | | | | \"te | | | | | | | rminated\" | | | | | | | and | | | | | | | \" | | | | | | | rejected\" | | | | | +------------+------------+------------+---------+---------+----+ | 16 | Check: | Ã  | 200 OK | 2 | P | | | Does the | | | | | | | UE respond | | | | | | | the NOTIFY | | | | | | | with 200 | | | | | | | OK? | | | | | +------------+------------+------------+---------+---------+----+ | 17 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 18 | Wait 5 | - | - | - | - | | | seconds. | | | | | +------------+------------+------------+---------+---------+----+ | 19 | The SS | ÃŸ | BYE | - | - | | | releases | | | | | | | the | | | | | | | emergency | | | | | | | call | | | | | +------------+------------+------------+---------+---------+----+ | 20 | Check: | Ã  | 200 OK | 2 | P | | | Does the | | | | | | | UE send | | | | | | | 200 OK for | | | | | | | BYE(NOTE1 | | | | | | | and | | | | | | | NOTE2)? | | | | | +------------+------------+------------+---------+---------+----+ | NOTE1: | | | | | | | Upon | | | | | | | reception | | | | | | | of NOTIFY | | | | | | | with | | | | | | | rejected | | | | | | | cause, UE | | | | | | | shall not | | | | | | | attempt | | | | | | | IMS | | | | | | | re | | | | | | | -subscribe | | | | | | | as per RFC | | | | | | | 6 | | | | | | | 665[28]. | | | | | | | Add | | | | | | | itionally, | | | | | | | in case of | | | | | | | UE | | | | | | | configured | | | | | | | in voice | | | | | | | centric, | | | | | | | UE | | | | | | | considers | | | | | | | IMS voice | | | | | | | disabled | | | | | | | and | | | | | | | attempts | | | | | | | to disable | | | | | | | N1 mode | | | | | | | but waits | | | | | | | until | | | | | | | radio | | | | | | | bearer | | | | | | | release as | | | | | | | per TS | | | | | | | 24,501 | | | | | | | [20] | | | | | | | ,cl.4.3.2. | | | | | | | | | | | | | | NOTE2: In | | | | | | | case of UE | | | | | | | configured | | | | | | | in voice | | | | | | | centric, | | | | | | | UE shall | | | | | | | be in | | | | | | | NR-DE | | | | | | | REGISTERED | | | | | | | state upon | | | | | | | signalling | | | | | | | connection | | | | | | | release as | | | | | | | N1 mode | | | | | | | disabled | | | | | | | upon radio | | | | | | | bearers | | | | | | | are | | | | | | | released. | | | | | | +------------+------------+------------+---------+---------+----+
##### 10.14.3.3 Specific message content {#specific-message-content-6 .H6}
Table 10.14.3.3-1: NOTIFY (Step 12, table 10.14.3.2-1)
+---------------------+------+---------------------+-----+-----------+ | Derivation Path: TS | | | | | | 34.229-1 [2], | | | | | | Annex A.1.6 with | | | | | | condition A6. | | | | | +=====================+======+=====================+=====+===========+ | Header/param | Cond | Value/remark | Rel | Reference | +---------------------+------+---------------------+-----+-----------+ | **CSeq** | | | | | +---------------------+------+---------------------+-----+-----------+ | Value | | 2 | | | +---------------------+------+---------------------+-----+-----------+ | **Message-body** | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _same value | | | | | | as in Contact | | | | | | header of REGISTER | | | | | | request _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _same value | | | | | | as in Contact | | | | | | header of REGISTER | | | | | | request _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | +---------------------+------+---------------------+-----+-----------+
NOTE 1: The public user ids and the associated TEL URI are as returned to the
UE in the P-Associated-URI header of the 200 (OK) response to the REGISTER
request;\ PublicUserId1 is the default public user id i.e. the first one
contained in P-Associated-URI;\ AssociatedTelUri is the same as used in
P-Associated-URI\ PublicUserId2 and PublicUserId3 are the remaining IMPUs of
the P-Associated-URI header
Table 10.14.3.3-2: 200 OK for NOTIFY (Step 13, table 10.14.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1 with conditions A11 and A22
* * *
Table 10.14.3.3-3: BYE (Step 15, table 10.14.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.2.8 with condition A1 and A8.
* * *
Table 10.14.3.3-4: 200 OK for BYE (Step 16, table 10.14.3.2-1)
* * *
Derivation Path: TS 34.229-1 [2], Annex A.3.1 with conditions A11 and A22
* * *
## 10.15 Void
# 11 eCall over IMS
## 11.1 eCall over IMS / Manual initiation / Normal registration / Emergency
registration / Success / 200 OK with ACK / 5GS
##### 11.1.1 Test Purpose (TP) {#test-purpose-tp-90 .H6}
##### (1) {#section-276 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is being made to initiate a manual eCall over IMS }
**then** { UE sends a correctly composed initial REGISTER request for IMS
emergency registration }
}
##### (2) {#section-277 .H6}
**with** { UE having sent an unprotected REGISTER request }
**ensure** **that** {
**when** { UE receives a valid 401 (Unauthorized) response for the initial
REGISTER request sent }
**then** { UE correctly authenticates itself by sending another REGISTER
request with a correctly composed Authorization header using the AKAv1-MD5
algorithm }
}
##### (3) {#section-278 .H6}
**with** { UE having sent unprotected and then protected REGISTER request }
**ensure** **that** {
**when** { UE receives a valid 200 OK response for the REGISTER sent for
authentication }
**then** { UE sends a correctly composed INVITE request with MSD }
}
##### (4) {#section-279 .H6}
**with** { UE having sent INVITE with MSD for manual eCall over IMS }
**ensure** **that** {
**when** { UE receives 200 OK containing acknowledgement of reception of MSD }
**then** { UE sends ACK }
}
##### (5) {#section-280 .H6}
**with** { eCall over IMS being established }
**ensure** **that** {
**when** { Network sends BYE }
**then** { UE sends 200 OK for BYE }
}
##### 11.1.2 Conformance Requirements {#conformance-requirements-91 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-16 requirements.
[TS 24.229 clause 5.1.6.11.1]:
If the upper layers request establishment of an IMS emergency call of the
manually initiated eCall type of emergency service, the service URN shall be
\"urn:service:sos.ecall.manual\" as specified in RFC 8147 [244].
If the upper layers request establishment of an IMS emergency call of the
automatically initiated eCall type of emergency service, the service URN shall
be \"urn:service:sos.ecall.automatic\" as specified in RFC 8147 [244].
NOTE 1: The manually initiated eCall type of emergency service is used when
the eCall IMS emergency session is invoked with user input. The automatically
initiated eCall type of emergency service is used if the eCall IMS emergency
session is invoked without user input.
[TS 24.229 clause 5.1.6.11.2]:
If the upper layers request establishment of an IMS emergency call of the
automatically initiated eCall type of emergency service or of the manually
initiated eCall type of emergency service and if allowed by IP-CAN specific
annex, the UE shall send an INVITE request as specified in the procedures in
subclause 5.1.6.8 with the following additions:
1) the UE shall set the Request-URI to \"urn:service:sos.ecall.automatic\" or
\"urn:service:sos.ecall.manual\"; and
2) if the IP-CAN indicates the eCall support indication, the UE shall:
a) insert a multipart/mixed body containing an
\"application/EmergencyCallData.eCall.MSD\" MIME body part as defined in RFC
8147 [244], containing the MSD not exceeding 140 bytes and encoded in binary
ASN.1 PER as specified in CEN EN 15722:2015 [245] and include a Content-
Disposition header field with a \"handling\" header field parameter with an
\"optional\" value, as described in RFC 3261 [26];
b) insert an Accept header field indicating the UE is willing to accept an
\"application/EmergencyCallData.Control+xml\" MIME type as defined in RFC 8147
[244]; and
c) insert a Recv-Info header field set to \"EmergencyCallData.eCall.MSD\" as
defined in RFC 8147 [244].
NOTE: Further content for the INVITE is as defined in RFC 8147 [244].
Then the UE shall proceed as follows:
...
2) if the UE receives a 200 (OK) response to the INVITE request containing:
a) a multipart/mixed body containing an
\"application/EmergencyCallData.Control+xml\" MIME body part as defined in RFC
8147 [244] with an \"ack\" element containing:
i) a \"received\" attribute set to \"true\"; and
ii) a \"ref\" attribute set to the Content-ID of the MIME body part containing
the MSD sent by the UE;
then the UE shall consider the initial MSD transmission as successful;
##### 11.1.3 Test description {#test-description-90 .H6}
##### 11.1.3.1 Pre-test conditions {#pre-test-conditions-90 .H6}
##### System Simulator: {#system-simulator-92 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-94 .H6}
\- UE contains either ISIM and USIM applications or only USIM application with
eCall subscription on UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-94 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 11.1.3.2 Test procedure sequence {#test-procedure-sequence-89 .H6}
Table 11.1.3.2-1: Main Behaviour
+------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +------+-------------+-------------+-------------+---------+----+ | 1 | UE is | - | - | - | - | | | triggered | | | | | | | to start a | | | | | | | manual | | | | | | | eCall | | | | | +------+-------------+-------------+-------------+---------+----+ | 2-11 | Steps 1-10 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] with | | | | | | | condition | | | | | | | 'eCall' are | | | | | | | performed. | | | | | +------+-------------+-------------+-------------+---------+----+ | 12 | Step 1 of | --> | REGISTER | 1 | P | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | initial | | | | | | | REGISTER | | | | | | | request for | | | | | | | IMS | | | | | | | emergency | | | | | | | re | | | | | | | gistration? | | | | | +------+-------------+-------------+-------------+---------+----+ | 13 | Step 2 of | \ | REGISTER | 2 | P | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send | | | | | | | another | | | | | | | REGISTER | | | | | | | with | | | | | | | AKAv1-MD5 | | | | | | | c | | | | | | | redentials? | | | | | +------+-------------+-------------+-------------+---------+----+ | 15 | Step 4 of | \ | INVITE | 3 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE | | | | | | | include MSD | | | | | | | in the | | | | | | | message | | | | | | | body? | | | | | +------+-------------+-------------+-------------+---------+----+ | 17 | Step 2 of | \ | ACK | 4 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | ACK? | | | | | +------+-------------+-------------+-------------+---------+----+ | 19 | Step 1 of | \ | 200 OK | 5 | P | | | Annex A.8 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request and | | | | | | | ends the | | | | | | | call? | | | | | +------+-------------+-------------+-------------+---------+----+
##### 11.1.3.3 Specific message contents {#specific-message-contents-83 .H6}
Table 11.1.3.3-1: INVITE (step 16, table 11.1.3.2-1)
* * *
Derivation path: Step 1 in Annex A.23 with Condition A20
* * *
Table 11.1.3.3-2: 200 OK for INVITE (step 17, table 11.1.3.2-1)
* * *
Derivation path: Step 2 in Annex A.23 with Conditions A12 and A13
* * *
## 11.2 eCall over IMS / Automatic initiation / Normal registration /
Emergency registration / Success / 200 OK with ACK / 5GS
##### 11.2.1 Test Purpose (TP) {#test-purpose-tp-91 .H6}
##### (1) {#section-281 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is being made to initiate an automatic eCall over IMS }
**then** { UE sends a correctly composed initial REGISTER request for IMS
emergency registration }
}
##### (2) {#section-282 .H6}
**with** { UE having sent an unprotected REGISTER request }
**ensure** **that** {
**when** { UE receives a valid 401 (Unauthorized) response for the initial
REGISTER request sent }
**then** { UE correctly authenticates itself by sending another REGISTER
request with a correctly composed Authorization header using the AKAv1-MD5
algorithm }
}
##### (3) {#section-283 .H6}
**with** { UE having sent unprotected and then protected REGISTER request }
**ensure** **that** {
**when** { UE receives a valid 200 OK response for the REGISTER sent for
authentication }
**then** { UE sends a correctly composed INVITE request with MSD }
}
##### (4) {#section-284 .H6}
**with** { UE having sent INVITE with MSD for automatic eCall over IMS }
**ensure** **that** {
**when** { UE receives 200 OK containing acknowledgement of reception of MSD }
**then** { UE sends ACK }
}
##### (5) {#section-285 .H6}
**with** { eCall over IMS being established }
**ensure** **that** {
**when** { Network sends BYE }
**then** { UE sends 200 OK for BYE }
}
##### 11.2.2 Conformance Requirements {#conformance-requirements-92 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-16 requirements.
[TS 24.229 clause 5.1.6.11.1]:
If the upper layers request establishment of an IMS emergency call of the
manually initiated eCall type of emergency service, the service URN shall be
\"urn:service:sos.ecall.manual\" as specified in RFC 8147 [244].
If the upper layers request establishment of an IMS emergency call of the
automatically initiated eCall type of emergency service, the service URN shall
be \"urn:service:sos.ecall.automatic\" as specified in RFC 8147 [244].
NOTE 1: The manually initiated eCall type of emergency service is used when
the eCall IMS emergency session is invoked with user input. The automatically
initiated eCall type of emergency service is used if the eCall IMS emergency
session is invoked without user input.
[TS 24.229 clause 5.1.6.11.2]:
If the upper layers request establishment of an IMS emergency call of the
automatically initiated eCall type of emergency service or of the manually
initiated eCall type of emergency service and if allowed by IP-CAN specific
annex, the UE shall send an INVITE request as specified in the procedures in
subclause 5.1.6.8 with the following additions:
1) the UE shall set the Request-URI to \"urn:service:sos.ecall.automatic\" or
\"urn:service:sos.ecall.manual\"; and
2) if the IP-CAN indicates the eCall support indication, the UE shall:
a) insert a multipart/mixed body containing an
\"application/EmergencyCallData.eCall.MSD\" MIME body part as defined in RFC
8147 [244], containing the MSD not exceeding 140 bytes and encoded in binary
ASN.1 PER as specified in CEN EN 15722:2015 [245] and include a Content-
Disposition header field with a \"handling\" header field parameter with an
\"optional\" value, as described in RFC 3261 [26];
b) insert an Accept header field indicating the UE is willing to accept an
\"application/EmergencyCallData.Control+xml\" MIME type as defined in RFC 8147
[244]; and
c) insert a Recv-Info header field set to \"EmergencyCallData.eCall.MSD\" as
defined in RFC 8147 [244].
NOTE: Further content for the INVITE is as defined in RFC 8147 [244].
Then the UE shall proceed as follows:
...
2) if the UE receives a 200 (OK) response to the INVITE request containing:
a) a multipart/mixed body containing an
\"application/EmergencyCallData.Control+xml\" MIME body part as defined in RFC
8147 [244] with an \"ack\" element containing:
i) a \"received\" attribute set to \"true\"; and
ii) a \"ref\" attribute set to the Content-ID of the MIME body part containing
the MSD sent by the UE;
then the UE shall consider the initial MSD transmission as successful;
##### 11.2.3 Test description {#test-description-91 .H6}
##### 11.2.3.1 Pre-test conditions {#pre-test-conditions-91 .H6}
##### System Simulator: {#system-simulator-93 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-95 .H6}
\- UE contains either ISIM and USIM applications or only USIM application with
eCall subscription on UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-95 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 11.2.3.2 Test procedure sequence {#test-procedure-sequence-90 .H6}
Table 11.2.3.2-1: Main Behaviour
+-------+---------------+---------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+===============+===============+=========+=========+====+ | | | U - S | Message | | | +-------+---------------+---------------+---------+---------+----+ | 1 | UE is | - | - | - | - | | | triggered to | | | | | | | start an | | | | | | | automatic | | | | | | | eCall | | | | | +-------+---------------+---------------+---------+---------+----+ | 2-9 | Steps 1-8 of | - | - | - | - | | | generic | | | | | | | procedure | | | | | | | specified in | | | | | | | Table | | | | | | | 4.9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] with | | | | | | | condition | | | | | | | 'eCall' are | | | | | | | performed. | | | | | +-------+---------------+---------------+---------+---------+----+ | - | EXCEPTION: In | - | - | - | - | | | parallel to | | | | | | | the events | | | | | | | described in | | | | | | | steps 10-11 | | | | | | | below the | | | | | | | events | | | | | | | specified in | | | | | | | Table | | | | | | | 11.2.3.2-2 | | | | | | | take place. | | | | | +-------+---------------+---------------+---------+---------+----+ | 10-11 | Steps 9-10 of | - | - | - | - | | | Table | | | | | | | 4.9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+---------------+---------------+---------+---------+----+ | - | EXCEPTION: In | - | - | - | - | | | parallel to | | | | | | | the events | | | | | | | described in | | | | | | | steps 12 and | | | | | | | 13, steps 11 | | | | | | | to 13 | | | | | | | specified in | | | | | | | 38.508-1 | | | | | | | [21] Table | | | | | | | 4.9.11.2.2-1 | | | | | | | take place. | | | | | +-------+---------------+---------------+---------+---------+----+ | 12 | Step 1 of | --> | INVITE | 3 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE | | | | | | | include MSD | | | | | | | in the | | | | | | | message body? | | | | | +-------+---------------+---------------+---------+---------+----+ | 13 | Step 2 of | \ | ACK | 4 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | ACK? | | | | | +-------+---------------+---------------+---------+---------+----+ | 15 | Step 1 of | \ | 200 OK | 5 | P | | | Annex A.8 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request and | | | | | | | end the call? | | | | | +-------+---------------+---------------+---------+---------+----+
Table 11.2.3.2-2: Parallel Behaviour
+-----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+==============+=========+====+ | | | U - S | Mes | | | | | | | sage/PDU/SDU | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 1a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | depending UE | | | | | | | imp | | | | | | | lementation; | | | | | | | the \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies a | | | | | | | step | | | | | | | sequence | | | | | | | that takes | | | | | | | place if the | | | | | | | UE performs | | | | | | | a specific | | | | | | | action. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 1a1 | The generic | - | - | - | - | | | procedure | | | | | | | for IP | | | | | | | address | | | | | | | allocation | | | | | | | in the user | | | | | | | plane | | | | | | | specified in | | | | | | | subclause | | | | | | | 4.5A.3 takes | | | | | | | place. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 2 | Step 1 of | --> | REGISTER | 1 | P | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | initial | | | | | | | REGISTER | | | | | | | request for | | | | | | | IMS | | | | | | | emergency | | | | | | | r | | | | | | | egistration? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 3 | Step 2 of | \ | REGISTER | 2 | P | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send | | | | | | | another | | | | | | | REGISTER | | | | | | | with | | | | | | | AKAv1-MD5 | | | | | | | credentials? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 5 | Step 4 of | \ | INVITE | 1 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE | | | | | | | include MSD | | | | | | | in the | | | | | | | message | | | | | | | body? | | | | | +------+-------------+-------------+----------+---------+----+ | 13 | Step 2 of | \ | ACK | 2 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | ACK? | | | | | +------+-------------+-------------+----------+---------+----+ | 15 | Step 4 of | \ | 200 OK | 3 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK | | | | | | | ac | | | | | | | knowledging | | | | | | | reception | | | | | | | of SIP | | | | | | | INFO? | | | | | +------+-------------+-------------+----------+---------+----+ | 17 | Step 6 of | --> | SIP INFO | 4 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | SIP INFO | | | | | | | with | | | | | | | updated MSD | | | | | | | i | | | | | | | nformation? | | | | | +------+-------------+-------------+----------+---------+----+ | 18 | Step 7 of | \ | 200 OK | 5 | P | | | Annex A.8 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request and | | | | | | | end the | | | | | | | call? | | | | | +------+-------------+-------------+----------+---------+----+
##### 11.4.3.3 Specific message contents {#specific-message-contents-85 .H6}
Table 11.4.3.3-1: INVITE (step 12, table 11.4.3.2-1)
* * *
Derivation path: Step 1 in Annex A.23 with Condition A20
* * *
Table 11.4.3.3-2: 200 OK for INVITE (step 13, table 11.4.3.2-1)
* * *
Derivation path: Step 2 in Annex A.23 with Conditions A12 and A13
* * *
Table 11.4.3.3-3: SIP INFO (step 17, table 11.4.3.2-1)
* * *
Derivation path: Step 6 in Annex A.23 with Conditions A1 and A3
* * *
## 11.5 eCall over IMS / Automatic initiation / MSD transfer and 200 OK with
ACK / SIP INFO request for MSD update / Success / 5GS
##### 11.5.1 Test Purpose (TP) {#test-purpose-tp-93 .H6}
##### (1) {#section-292 .H6}
**with** { UE being registered to IMS }
**ensure** **that** {
**when** { UE is being made to initiate an automatic eCall over IMS }
**then** { UE performs IMS emergency registration and sends correctly composed
INVITE with MSD }
}
##### (2) {#section-293 .H6}
**with** { UE having sent an INVITE }
**ensure** **that** {
**when** { UE receives 200 OK containing acknowledgement of reception of MSD }
**then** { UE sends ACK }
}
##### (3) {#section-294 .H6}
**with** { eCall over IMS being established }
**ensure** **that** {
**when** { UE receives SIP INFO requesting MSD update }
**then** { UE sends 200 OK acknowledging SIP INFO }
}
##### (4) {#section-295 .H6}
**with** { UE having sent 200 OK for SIP INFO }
**ensure** **that** {
**when** { UE is able to provide the updated MSD }
**then** { UE sends a correctly composed SIP INFO with updated MSD information
}
}
##### (5) {#section-296 .H6}
**with** { UE having received 200 OK acknowledging the reception of updated
MSD in SIP INFO }
**ensure** **that** {
**when** { Network sends BYE }
**then** { UE sends 200 OK for BYE }
}
##### 11.5.2 Conformance Requirements {#conformance-requirements-94 .H6}
The conformance requirements covered in the present test case are, unless
otherwise stated, Rel-16 requirements.
[TS 24.229 clause 5.1.6.11.3]:
During an emergency session established for eCall type of emergency service as
described in subclause 5.1.6.11.2, if the UE receives an INFO request with:
1) an Info-Package header field set to \"EmergencyCallData.eCall.MSD\" as
defined in RFC 8147 [244];
2) a multipart/mixed body including:
a) an \"application/EmergencyCallData.Control+xml\" MIME body part as defined
in RFC 8147 [244] containing a \"request\" element with an \"action\"
attribute set to \"send-data\" and a \"datatype\" attribute set to
\"eCall.MSD\"; and
b) a Content-Disposition header field set to \"By-Reference\" associated with
the \"application/EmergencyCallData.Control+xml\" MIME body part; and
3) a Content-Disposition header field set to \"Info-Package\" associated with
the multipart/mixed body;
the UE shall proceed as follows:
1) if the UE is able to provide an updated MSD, the UE shall send an INFO
request containing:
a) an Info-Package header field set to \"EmergencyCallData.eCall.MSD\" as
defined in RFC 8147 [244];
b) a multipart/mixed body including:
i) an \"application/EmergencyCallData.eCall.MSD\" MIME body part as defined in
RFC 8147 [244] containing the MSD not exceeding 140 bytes and encoded in
binary ASN.1 as specified in CEN EN 15722:2015 [245]; and
ii) a Content-Disposition header field set to \"By-Reference\" associated with
the \"application/EmergencyCallData.eCall.MSD\" MIME body part; and
c) a Content-Disposition header field set to \"Info-Package\" associated with
the multipart/mixed body; and
2) if the UE is not able to provide an updated MSD, the UE shall send an INFO
request containing:
a) an Info-Package header field set to \"EmergencyCallData.eCall.MSD\" as
defined in RFC 8147 [244];
b) a multipart/mixed body including:
i) an \"application/EmergencyCallData.Control+xml\" MIME body part as defined
in RFC 8147 [244] with an \"ack\" element containing:
\- a \"ref\" attribute set to the Content-ID of the
\"application/EmergencyCallData.Control+xml\" MIME body part in the INFO
request received by the UE; and
\- an \"actionResult\" child element containing:
A) an \"action\" attribute set to \"send-data\";
B) a \"success\" attribute set to \"false\"; and
C) a \"reason\" attribute set to an appropriate value as defined in RFC 8147
[244]; and
ii) a Content-Disposition header field set to \"By-Reference\" associated with
the \"application/EmergencyCallData.Control+xml\" MIME body part; and
c) a Content-Disposition header field set to \"Info-Package\" associated with
the multipart/mixed body.
NOTE: Further content for the INFO request is as defined in RFC 8147 [244].
##### 11.5.3 Test description {#test-description-93 .H6}
##### 11.5.3.1 Pre-test conditions {#pre-test-conditions-93 .H6}
##### System Simulator: {#system-simulator-95 .H6}
\- 1 NR Cell connected to 5GC, default parameters.
##### UE: {#ue-97 .H6}
\- UE contains either ISIM and USIM applications or only USIM application with
eCall subscription on UICC.
\- UE is configured to register for IMS after switch on.
##### Preamble: {#preamble-97 .H6}
\- UE is in state 1N-A (TS 38.508-1 [21]) and registered to IMS.
##### 11.5.3.2 Test procedure sequence {#test-procedure-sequence-92 .H6}
Table 11.5.3.2-1: Main Behaviour
+-------+-------------+-------------+----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=======+=============+=============+==========+=========+====+ | | | U - S | Message | | | +-------+-------------+-------------+----------+---------+----+ | 1 | UE is | - | - | - | - | | | triggered | | | | | | | to start an | | | | | | | automatic | | | | | | | eCall | | | | | +-------+-------------+-------------+----------+---------+----+ | 2-9 | Steps 1-8 | - | - | - | - | | | of generic | | | | | | | procedure | | | | | | | specified | | | | | | | in Table | | | | | | | 4 | | | | | | | .9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] with | | | | | | | condition | | | | | | | 'eCall' are | | | | | | | performed. | | | | | +-------+-------------+-------------+----------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in steps | | | | | | | 10-11 below | | | | | | | the events | | | | | | | specified | | | | | | | in Table | | | | | | | 11.5.3.2-2 | | | | | | | take place | | | | | +-------+-------------+-------------+----------+---------+----+ | 10-11 | Steps 9-10 | - | - | - | - | | | of Table | | | | | | | 4 | | | | | | | .9.11.2.2-1 | | | | | | | of TS | | | | | | | 38.508-1 | | | | | | | [21] are | | | | | | | performed. | | | | | +-------+-------------+-------------+----------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in steps 12 | | | | | | | and 13, | | | | | | | steps 11 to | | | | | | | 13 | | | | | | | specified | | | | | | | in 38.508-1 | | | | | | | [21] | | | | | | | Table | | | | | | | 4 | | | | | | | .9.11.2.2-1 | | | | | | | takes | | | | | | | place. | | | | | +-------+-------------+-------------+----------+---------+----+ | 12 | Step 1 of | --> | INVITE | 1 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE | | | | | | | include MSD | | | | | | | in the | | | | | | | message | | | | | | | body? | | | | | +-------+-------------+-------------+----------+---------+----+ | 13 | Step 2 of | \ | ACK | 2 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | ACK? | | | | | +-------+-------------+-------------+----------+---------+----+ | 15 | Step 4 of | \ | 200 OK | 3 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK | | | | | | | ac | | | | | | | knowledging | | | | | | | reception | | | | | | | of SIP | | | | | | | INFO? | | | | | +-------+-------------+-------------+----------+---------+----+ | 17 | Step 6 of | --> | SIP INFO | 4 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | SIP INFO | | | | | | | with | | | | | | | updated MSD | | | | | | | i | | | | | | | nformation? | | | | | +-------+-------------+-------------+----------+---------+----+ | 18 | Step 7 of | \ | 200 OK | 5 | P | | | Annex A.8 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK for | | | | | | | the BYE | | | | | | | request and | | | | | | | end the | | | | | | | call? | | | | | +-------+-------------+-------------+----------+---------+----+
Table 11.5.3.2-2: Parallel Behaviour
+-----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+==============+=========+====+ | | | U - S | Mes | | | | | | | sage/PDU/SDU | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 1a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | depending UE | | | | | | | imp | | | | | | | lementation; | | | | | | | the \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies a | | | | | | | step | | | | | | | sequence | | | | | | | that takes | | | | | | | place if the | | | | | | | UE performs | | | | | | | a specific | | | | | | | action. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 1a1 | The generic | - | - | - | - | | | procedure | | | | | | | for IP | | | | | | | address | | | | | | | allocation | | | | | | | in the user | | | | | | | plane | | | | | | | specified in | | | | | | | subclause | | | | | | | 4.5A.3 takes | | | | | | | place. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 2 | Step 1 of | --> | REGISTER | - | - | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | initial | | | | | | | REGISTER | | | | | | | request for | | | | | | | IMS | | | | | | | emergency | | | | | | | r | | | | | | | egistration? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 3 | Step 2 of | \ | REGISTER | - | - | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send | | | | | | | another | | | | | | | REGISTER | | | | | | | with | | | | | | | AKAv1-MD5 | | | | | | | credentials? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 5 | Step 4 of | \ | INVITE | 1 | P | | | Annex A.23 | | | | | | | happens | | | | | +-------+-------------+-------------+----------+---------+----+ | 13 | Step 2 of | \ | ACK | 2 | P | | | Annex A.23 | | | | | | | happens | | | | | +-------+-------------+-------------+----------+---------+----+ | 15 | Step 4 of | \ | 200 OK | 3 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | the UE send | | | | | | | 200 OK | | | | | | | ac | | | | | | | knowledging | | | | | | | reception | | | | | | | of SIP | | | | | | | INFO? | | | | | +-------+-------------+-------------+----------+---------+----+ | 17 | Step 6 of | --> | SIP INFO | 4 | P | | | Annex A.23 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | SIP INFO | | | | | | | with ack | | | | | | | element | | | | | | | containing | | | | | | | "success" | | | | | | | attribute | | | | | | | set to | | | | | | | "false"? | | | | | +-------+-------------+-------------+----------+---------+----+ | 18 | Step 7 of | \ | 200 OK | - | - | | | Annex A.8 | | | | | | | happens | | | | | +-------+-------------+-------------+----------+---------+----+
Table 11.6.3.2-2: Parallel Behaviour
+-----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+==============+=========+====+ | | | U - S | Mes | | | | | | | sage/PDU/SDU | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 1a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | depending UE | | | | | | | imp | | | | | | | lementation; | | | | | | | the \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies a | | | | | | | step | | | | | | | sequence | | | | | | | that takes | | | | | | | place if the | | | | | | | UE performs | | | | | | | a specific | | | | | | | action. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 1a1 | The generic | - | - | - | - | | | procedure | | | | | | | for IP | | | | | | | address | | | | | | | allocation | | | | | | | in the user | | | | | | | plane | | | | | | | specified in | | | | | | | subclause | | | | | | | 4.5A.3 takes | | | | | | | place. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 2 | Step 1 of | --> | REGISTER | - | - | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send a | | | | | | | correctly | | | | | | | composed | | | | | | | initial | | | | | | | REGISTER | | | | | | | request for | | | | | | | IMS | | | | | | | emergency | | | | | | | r | | | | | | | egistration? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 3 | Step 2 of | \ | REGISTER | - | - | | | Annex A.3 | | | | | | | happens | | | | | | | | | | | | | | Check: Does | | | | | | | UE send | | | | | | | another | | | | | | | REGISTER | | | | | | | with | | | | | | | AKAv1-MD5 | | | | | | | credentials? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 5 | Step 4 of | \\  
Content-Disposition: by-reference\  
_\\  
\\  
\\  
\\  
_\--boundaryXXX_
* * *
Table 11.6.3.3-4: SIP INFO (step 17, table 11.6.3.2-1)
* * *
Derivation path: Step 6 in Annex A.23 with Conditions A2 and A4
* * *
###### ## Annex A (normative): Generic Test Procedures
# A.1 Introduction
This annex specifies general procedures for IMS usages as well as application
specific procedures, e.g. for a MTSI client.
# A.2 IMS Registration / 5GS
##### Expected sequence {#expected-sequence .H6}
* * *
Step Direction Message Comment  
UE SS  
1 REGISTER The UE sends initial registration for IMS services.  
2 401 Unauthorized The SS responds with a valid AKAv1-MD5 authentication
challenge and security mechanisms supported by the network.  
3 REGISTER The UE completes the security negotiation procedures, sets up a
temporary set of SAs and uses those for sending another REGISTER with
AKAv1-MD5 credentials.  
4 200 OK The SS responds with 200 OK.  
\- EXCEPTION: In parallel to the events described in steps 5-8, the steps
specified in Annex A.10 on PUBLISH may happen.  
5 SUBSCRIBE The UE subscribes to its registration event package.  
6 200 OK The SS responds with 200 OK.  
7 NOTIFY The SS sends initial NOTIFY for registration event package,
containing full registration state information for the registered public user
identity in the XML body.  
8 200 OK The UE responds with 200 OK.
* * *
##### Specific Message Contents {#specific-message-contents-88 .H6}
##### REGISTER (Step 1) {#register-step-1 .H6}
Use the default message \"REGISTER\" in Annex A.1.1 of TS 34.229-1 [2]
applying condition A1.
##### 401 Unauthorized (Step 2) {#unauthorized-step-2 .H6}
Use the default message \"401 Unauthorized for REGISTER\" in Annex A.1.2 of TS
34.229-1 [2] applying condition A1.
##### REGISTER (Step 3) {#register-step-3 .H6}
Use the default message \"REGISTER\" in Annex A.1.1 of TS 34.229-1 [2]
applying conditions A2 and A32.
##### 200 OK (Step 4) {#ok-step-4 .H6}
Use the default message \"200 OK for REGISTER\" in Annex A.1.3 of TS 34.229-1
[2] applying condition A2.
##### SUBSCRIBE (Step 5) {#subscribe-step-5 .H6}
Use the default message \"SUBSCRIBE for reg-event package\" in Annex A.1.4 of
TS 34.229-1 [2] applying conditions A1 and A7.
##### 200 OK (Step 6) {#ok-step-6 .H6}
Use the default message \"200 OK for SUBSCRIBE\" in Annex A.1.4 of TS 34.229-1
[2] applying condition A1.
##### NOTIFY (Step 7) {#notify-step-7 .H6}
Use the default message \"NOTIFY for reg-event package\" in Annex A.1.6 of TS
34.229-1 [2] applying condition A1.
##### 200 OK (Step 8) {#ok-step-8 .H6}
Use the default message \"200 OK for requests other than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, and
A22.
# A.3 IMS Emergency Registration / 5GS
##### Test procedure: {#test-procedure .H6}
1) SS waits for the UE to send an initial REGISTER request.
2) The SS responds to the initial REGISTER request with a valid 401
Unauthorized response.
3) The SS waits for the UE to set up a temporary set of security associations
and to send another REGISTER request over those security associations.
4) The SS responds to the second REGISTER request with valid 200 OK response,
sent over the same temporary set of security associations that the UE used for
sending the REGISTER request.
##### Expected sequence: {#expected-sequence-1 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 REGISTER The UE sends initial IMS emergency registration  
2 401 Unauthorized The SS responds with a valid AKAv1-MD5 authentication
challenge and security mechanisms supported by the network.  
3 REGISTER The UE completes the security negotiation procedures, sets up a
temporary set of SAs and uses those for sending another REGISTER with
AKAv1-MD5 credentials.  
4 200 OK The SS responds with 200 OK.
* * *
##### Specific Message Contents: {#specific-message-contents-89 .H6}
##### REGISTER (Step 1) {#register-step-1-1 .H6}
Use the default message "REGISTER" in Annex A.1.1 of TS 34.229-1 [2] with
conditions A1 and A7.
##### 401 Unauthorized (Step 2) {#unauthorized-step-2-1 .H6}
Use the default message "401 Unauthorized for REGISTER" in Annex A.1.2 of TS
34.229-1 [2] with condition A1.
##### REGISTER (Step 3) {#register-step-3-1 .H6}
Use the default message "REGISTER" in Annex A.1.1 of TS 34.229-1 [2] with
conditions A2, A7, and A32.
##### 200 OK for REGISTER (Step 4) {#ok-for-register-step-4 .H6}
Use the default message "200 OK for REGISTER" in Annex A.1.3 of TS 34.229-1
[2] with condition A3.
# A.4 MTSI MO Voice Call / 5GS
## A.4.1 MTSI MO Voice Call / with preconditions / 5GS
##### Expected sequence {#expected-sequence-2 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 INVITE UE sends INVITE with the first SDP offer.  
2 100 Trying SS sends a 100 Trying provisional response.  
3 183 Session Progress SS sends an SDP answer.  
4 PRACK UE acknowledges reception of 183 Session Progress.  
5 200 OK SS responds to PRACK.  
6 UPDATE UE sends a second SDP offer in an UPDATE request.  
7 200 OK SS responds to UPDATE.  
8 180 Ringing SS sends 180 Ringing reliably.  
9 PRACK UE acknowledges reception of 180 Ringing.  
10 200 OK SS responds to PRACK.  
11 200 OK SS responds to INVITE.  
12 ACK UE acknowledges.
* * *
##### Specific Message Contents {#specific-message-contents-90 .H6}
##### INVITE (Step 1) {#invite-step-1 .H6}
Use the default message \"INVITE for MO Call Setup\" in Annex A.2.1 of TS
34.229-1 [2] applying conditions A1, A3, A4, A28, A29, A30, and A31, and with
the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Supported | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(username)_ (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) | | | | | | _s=_(session name) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS_ : (bandwidth-value) | | | | | | **Time description:** | | | | | | _t=_ (start-time) (stop-time) | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) [Note 2] | | | | | | _b=RR:_ (bandwidth-value) [Note 2] | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 12] | | | | | | _a=fmtp:_ (format) _br=5.9-13.2; bw=nb-swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 12] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 13] | | | | | | _a=fmtp:_ (format) _br=5.9-24.4; bw=nb-swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 13] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 14] | | | | | | _a=fmtp:_ (format) _br=13.2; bw=swb; max-red=_ | | | (att-field) [Note 4, 5, 10, 14] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 15] | | | | | | _a=fmtp:_ (format) _br=9.6-13.2; bw=swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 15] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 16] | | | | | | _a=fmtp:_ (format) _br=9.6-24.4; bw=swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 16] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 11] | | | | | | _a=fmtp:_ (format) _bw=nb-swb; max-red=_ | | | (att-field) [Note 4, 5, 11] | | | | | | _a=rtpmap:_ (payload type) _AMR-WB/16000_ [Note | | | 3, 9] | | | | | | _a=fmtp:_ (format) _mode-change-capability=2; | | | max-red=_ (att-field) [Note 4, 6] | | | | | | _a=rtpmap:_ (payload type) | | | _telephone-event/16000_ | | | | | | _a=fmtp: (format)_ | | | | | | _a=rtpmap:_ (payload type) _AMR/8000_ [Note 3, | | | 9] | | | | | | _a=fmtp:_ (format) _mode-change-capability=2; | | | max-red=_ (att-field) [Note 4, 6] | | | | | | _a=rtpmap:_ (payload type) | | | _telephone-event/8000_ | | | | | | _a=fmtp: (format)_ | | | | | | _a=ecn-capable-rtp: leap ect=0_ [Note 7] | | | | | | _a=rtcp-fb:* nack ecn_ [Note 7] | | | | | | _a=rtcp-xr:ecn-sum_ [Note 7] | | | | | | _a=rtcp-rsize_ [Note 7] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | _a=3ge2ae: requested_ [Note 8] | | | | | | * | | | a=crypto:1 AES_CM_128_HMAC_SHA1_80inline:WV | | | NfX19zZW1jdGwgKCkgewkyMjA7fQp9CnVubGVz\|2\^20\|_| | | | | |_ 1:4FEC_ORDER=FEC_SRTP\"_[Note 8] | | | | | |__Attributes for preconditions:__| | | | | |_ a=curr:qos local none _| | | | | |_ a=curr:qos remote none _| | | | | |_ a=des:qos mandatory local sendrecv _| | | | | |_ a=des:qos optional remote sendrecv* | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: The RR value shall be greater than 0. | | | The RS value can be any value. | | | | | | Note 3: The channel number shall be \"/1\" or | | | omitted. | | | | | | Note 4: The max-red values from 0 to 220 are | | | allowed. | | | | | | Note 5: The parameters dtx, dtx-recv and | | | evs-mode-switch shall not be present. | | | | | | Note 6: The parameters mode-set, | | | mode-change-period, mode-change-neighbor, crc, | | | robust-sorting and interleaving shall not be | | | included. | | | | | | Note 7: Attributes for ECN Capability may be | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 8: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | | | | | | Note 9: The ordering of payload types shall be | | | as listed, i.e., EVS before AMR-WB before AMR | | | according to NG.114 [31]. | | | | | | Note 10: The EVS payload type shall carry at | | | least one of the five EVS configurations | | | according to NG.114 [31] clause 3.2.2.3. In | | | addition, if there is no further EVS payload | | | type according to the criteria of Note 11, the | | | following rules shall be checked:\ | | | IF the first EVS payload type is configuration | | | B0 or B1 THEN\ | | | there shall be a second EVS payload type with | | | configuration A1\ | | | ELSE IF the first EVS payload type is | | | configuration B2 THEN | | | | | | there shall be a second EVS payload type with | | | configuration A2\ | | | (NOTE: if the first EVS payload type is | | | configuration A1 or A2 there does not need to be | | | any further EVS payload type) | | | | | | Note 11: Further EVS payload type according to | | | NG.114 [31] clause 3.2.2.3 with bandwidth up | | | to super-wideband, no br parameter and no | | | mode-set parameter. | | | | | | Note 12: EVS payload type with EVS Configuration | | | A1 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 13: EVS payload type with EVS Configuration | | | A2 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 14: EVS payload type with EVS Configuration | | | B0 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 15: EVS payload type with EVS Configuration | | | B1 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 16: EVS payload type with EVS Configuration | | | B2 (NG.114 [31] clause 3.2.2.3). | +------------------+--------------------------------------------------+
##### 100 Trying (Step 2) {#trying-step-2 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] applying condition A1.
##### 183 Session Progress (Step 3) {#session-progress-step-3 .H6}
Use the default message \"183 Session Progress for INVITE\" in Annex A.2.3 of
TS 34.229-1 [2] applying condition A1, and with the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Require | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) [Note | | | 1, 2] | | | | | | _b=AS:65_ | | | | | | _b=RS:_ **(bandwidth-value)** [Note 3] | | | | | | _b=RR:_ **(bandwidth-value)** [Note 3] | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000/1_ [Note | | | 1, 8] | | | | | | _a=fmtp:_ (format) _br=13.2; bw=swb; | | | mode-set=0,1,2; max-red=220_ [Note 8] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000/1_ [Note | | | 1, 9] | | | | | | _a=fmtp:_ (format) _br=5.9-13.2; bw=nb-swb; | | | mode-set=0,1,2; max-red=220_ [Note 9] | | | | | | _a=ecn-capable-rtp: leap ect=0_ [Note 6] | | | | | | _a=rtcp-fb:* nack ecn_ [Note 6] | | | | | | _a=rtcp-xr:ecn-sum_ [Note 6] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | **_a=3ge2ae: requested_ [Note 7]** | | | | | | **_a=c | | | rypto:1 AES_CM_128_HMAC_SHA1_80inline:PS1uQ | | | CVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR\|2\^20\|1:4_ | | | [Note 7]** | | | | | | **Attributes for preconditions:** | | | | | | _a=curr:qos local none_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | _a=conf:qos remote sendrecv_ | | | | | | Note 1: The values for fmt, payload type and | | | format are copied from step 1. | | | | | | Note 2: Transport port is the port number of the | | | SS (see RFC 3264 clause 6). | | | | | | Note 3: The bandwidth-value is copied from step | | | 1. | | | | | | _Note 4: Void_ | | | | | | _Note 5: Void_ | | | | | | _Note 6:_ Attributes for ECN Capability are | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 7: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | | | | | | Note 8: This EVS configuration is sent if UE | | | sent it as the first of its EVS configurations | | | in INVITE. | | | | | | Note 9: This EVS configuration is sent if UE did | | | not send \"br=13.2; bw=swb\" as the first of its | | | EVS configurations in INVITE. | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
conditions A1 and A7.
##### 200 OK for PRACK (Step 5) {#ok-for-prack-step-5 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A10 and A22.
##### UPDATE (Step 6) {#update-step-6 .H6}
Use the default message \"UPDATE\" in Annex A.2.5 of TS 34.229-1 [2] applying
conditions A1 and A6, and with the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Require | _precondition_ | | | | | option-tag | | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(username)_ (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) [Note 2] | | | | | | _s=_(session name) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) [Note | | | 3] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note | | | 3] [Note 5] [Note 6] | | | | | | _a=fmtp:_ (format) _br=13.2; bw=swb; | | | max-red=_(att-field) [Note 7] | | | | | | _a=fmtp:_ (format) _br=5.9-13.2; bw=nb-swb; | | | max-red=_(att-field) [Note 8] | | | | | | **Attributes for preconditions:** | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos optional remote sendrecv_ or | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: \"o=\" line identical to previous SDP | | | sent by UE except that sess-version is | | | incremented by one | | | | | | Note 3: **The value for fmt, payload type and | | | format is not checked** | | | | | | **Note 4: Void** | | | | | | **Note 5: The channel number shall be \"/1\" or | | | omitted** | | | | | | **Note 6: EVS shall be the only codec in UPDATE | | | and shall come with the same configuration | | | parameters as sent in 183 Session Progress\ | | | Note 7: Sent by UE if it sent it as first of its | | | EVS configurations in INVITE.\ | | | Note 8: Sent by UE if it did** not send | | | \"br=13.2; bw=swb\" as the first of its EVS | | | configurations in INVITE**.** | +------------------+--------------------------------------------------+
##### 200 OK for UPDATE (Step 7) {#ok-for-update-step-7 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A1, A10 and
A22, and with the following exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | _precondition_ | | | | | option-tag | | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | SDP body of the 200 response copied from the | | | received UPDATE and modified as follows: | | | | | | - IP address on \"c=\" lines and transport | | | port on \"m=\" lines changed to indicate to | | | which IP address and port the UE should start | | | sending the media; | | | | | | - \"o=\" line identical to previous SDP sent | | | by SS except that sess-version is incremented; | | | | | | _-_ Attributes for preconditions: _a=curr:qos | | | remote sendrecv_ | +--------------------+------------------------------------------------+
##### 180 Ringing (Step 8) {#ringing-step-8 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] applying conditions A1 and A3.
##### PRACK (Step 9) {#prack-step-9 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
conditions A1 and A7.
##### 200 OK for PRACK (Step 10) {#ok-for-prack-step-10 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying condition A10.
##### 200 OK for INVITE (Step 11) {#ok-for-invite-step-11 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A1, A10, and
A19.
##### ACK (Step 12) {#ack-step-12 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A1 and A3.
## A.4.1a MTSI MO Voice Call / Default Configuration / 5GS
##### Expected sequence {#expected-sequence-3 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 INVITE UE sends INVITE with the first SDP offer.  
2 100 Trying SS sends a 100 Trying provisional response.  
3 183 Session Progress SS sends an SDP answer.  
4 PRACK UE acknowledges reception of 183 Session Progress.  
5 200 OK SS responds to PRACK.  
6 UPDATE UE sends a second SDP offer in an UPDATE request.  
7 200 OK SS responds to UPDATE.  
8 180 Ringing SS sends 180 Ringing reliably.  
9 PRACK UE acknowledges reception of 180 Ringing.  
10 200 OK SS responds to PRACK.  
11 200 OK SS responds to INVITE.  
12 ACK UE acknowledges.
##### Specific Message Contents {#specific-message-contents-91 .H6}
##### INVITE (Step 1) {#invite-step-1-1 .H6}
Use the default message \"INVITE for MO Call Setup\" in Annex A.2.1 of TS
34.229-1 [2] applying conditions A1, A3, A4, A28, A29, A30, and A31, and with
the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +==================+==================================================+ | Supported | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(username)_ (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) | | | | | | _s=_(session name) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS_ : (bandwidth-value) | | | | | | **Time description:** | | | | | | _t=_ (start-time) (stop-time) | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) [Note 2] | | | | | | _b=RR:_ (bandwidth-value) [Note 2] | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9] | | | | | | _a=fmtp:_ (format) _br=5.9-24.4; bw=nb-swb; | | | max-red=_ (att-field) [Note 4, 5] | | | | | | _a=rtpmap:_ (payload type) _AMR-WB/16000_ [Note | | | 3, 9] | | | | | | _a=fmtp:_ (format) _mode-change-capability=2; | | | max-red=_ (att-field) [Note 4, 6] | | | | | | _a=rtpmap:_ (payload type) | | | _telephone-event/16000_ | | | | | | _a=fmtp: (format)_ | | | | | | _a=rtpmap:_ (payload type) _AMR/8000_ [Note 3, | | | 9] | | | | | | _a=fmtp:_ (format) _mode-change-capability=2; | | | max-red=_ (att-field) [Note 4, 6] | | | | | | _a=rtpmap:_ (payload type) | | | _telephone-event/8000_ | | | | | | _a=fmtp: (format)_ | | | | | | _a=ecn-capable-rtp: leap ect=0_ [Note 7] | | | | | | _a=rtcp-fb:* nack ecn_ [Note 7] | | | | | | _a=rtcp-xr:ecn-sum_ [Note 7] | | | | | | _a=rtcp-rsize_ [Note 7] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | _a=3ge2ae: requested_ [Note 8] | | | | | | * | | | a=crypto:1 AES_CM_128_HMAC_SHA1_80inline:WV | | | NfX19zZW1jdGwgKCkgewkyMjA7fQp9CnVubGVz\|2\^20\|_| | | | | |_ 1:4FEC_ORDER=FEC_SRTP\"_[Note 8] | | | | | |__Attributes for preconditions:__| | | | | |_ a=curr:qos local none _| | | | | |_ a=curr:qos remote none _| | | | | |_ a=des:qos mandatory local sendrecv _| | | | | |_ a=des:qos optional remote sendrecv* | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: The RR value shall be greater than 0. | | | The RS value can be any value. | | | | | | Note 3: The channel number shall be \"/1\" or | | | omitted. | | | | | | Note 4: The max-red values from 0 to 220 are | | | allowed. | | | | | | Note 5: The parameters dtx, dtx-recv and | | | evs-mode-switch shall not be present. | | | | | | Note 6: The parameters mode-set, | | | mode-change-period, mode-change-neighbor, crc, | | | robust-sorting and interleaving shall not be | | | included. | | | | | | Note 7: Attributes for ECN Capability may be | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 8: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | | | | | | Note 9: The ordering of payload types shall be | | | as listed. | +------------------+--------------------------------------------------+
##### 100 Trying (Step 2) {#trying-step-2-1 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] applying condition A1.
##### 183 Session Progress (Step 3) {#session-progress-step-3-1 .H6}
Use the default message \"183 Session Progress for INVITE\" in Annex A.2.3 of
TS 34.229-1 [2] applying condition A1, and with the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +==================+==================================================+ | Require | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) [Note | | | 1, 2] | | | | | | _b=AS:65_ | | | | | | _b=RS:_ **(bandwidth-value)** [Note 3] | | | | | | _b=RR:_ **(bandwidth-value)** [Note 3] | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000/1_ [Note | | | 1] | | | | | | _a=fmtp:_ (format) _br=5.9-24.4; bw=nb-swb; | | | max-red=220_ | | | | | | _a=ecn-capable-rtp: leap ect=0_ [Note 4] | | | | | | _a=rtcp-fb:* nack ecn_ [Note 4] | | | | | | _a=rtcp-xr:ecn-sum_ [Note 4] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | **_a=3ge2ae: requested_ [Note 5]** | | | | | | **_a=c | | | rypto:1 AES_CM_128_HMAC_SHA1_80inline:PS1uQ | | | CVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR\|2\^20\|1:4_ | | | [Note 5]** | | | | | | **Attributes for preconditions:** | | | | | | _a=curr:qos local none_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | _a=conf:qos remote sendrecv_ | | | | | | Note 1: The values for fmt, payload type and | | | format are copied from step 1. | | | | | | Note 2: Transport port is the port number of the | | | SS (see RFC 3264 clause 6). | | | | | | Note 3: The bandwidth-value is copied from step | | | 1. | | | | | | _Note 4:_ Attributes for ECN Capability are | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 5: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-1 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
conditions A1 and A7.
##### 200 OK for PRACK (Step 5) {#ok-for-prack-step-5-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A10 and A22.
##### UPDATE (Step 6) {#update-step-6-1 .H6}
Use the default message \"UPDATE\" in Annex A.2.5 of TS 34.229-1 [2] applying
conditions A1 and A6, and with the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +==================+==================================================+ | Require | _precondition_ | | | | | option-tag | | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(username)_ (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) [Note 2] | | | | | | _s=_(session name) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) [Note | | | 3] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note | | | 3,5] | | | | | | _a=fmtp:_ (format) [Note 3,4] | | | | | | **Attributes for preconditions:** | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos optional remote sendrecv_ or | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: \"o=\" line identical to previous SDP | | | sent by UE except that sess-version is | | | incremented by one. | | | | | | Note 3: **The value for fmt, payload type and | | | format are not checked.** | | | | | | **Note 4: Parameters for the codec are not | | | checked.** | | | | | | **Note 5: The channel number shall be \"/1\" or | | | omitted.** | +------------------+--------------------------------------------------+
##### 200 OK for UPDATE (Step 7) {#ok-for-update-step-7-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A1, A10 and
A22, and with the following exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | _precondition_ | | | | | option-tag | | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | SDP body of the 200 response copied from the | | | received UPDATE and modified as follows: | | | | | | - IP address on \"c=\" lines and transport | | | port on \"m=\" lines changed to indicate to | | | which IP address and port the UE should start | | | sending the media; | | | | | | - \"o=\" line identical to previous SDP sent | | | by SS except that sess-version is incremented; | | | | | | _-_ Attributes for preconditions: _a=curr:qos | | | remote sendrecv_ | +--------------------+------------------------------------------------+
##### 180 Ringing (Step 8) {#ringing-step-8-1 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] applying conditions A1 and A3.
##### PRACK (Step 9) {#prack-step-9-1 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
conditions A1 and A7.
##### 200 OK for PRACK (Step 10) {#ok-for-prack-step-10-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying condition A10.
##### 200 OK for INVITE (Step 11) {#ok-for-invite-step-11-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A1, A10, and
A19.
##### ACK (Step 12) {#ack-step-12-1 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A1 and A3.
## A.4.2 MTSI MO Voice Call / without preconditions / 5GS
##### Expected sequence {#expected-sequence-4 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 INVITE UE sends INVITE with the first SDP offer.  
2 100 Trying SS sends a 100 Trying provisional response.  
3 183 Session Progress SS sends an SDP answer.  
4 PRACK UE acknowledges reception of 183 Session Progress.  
5 200 OK SS responds to PRACK.  
6 180 Ringing SS sends 180 Ringing.  
7 200 OK SS responds to INVITE.  
8 ACK UE acknowledges.
* * *
##### Specific Message Contents {#specific-message-contents-92 .H6}
##### INVITE (Step 1) {#invite-step-1-2 .H6}
Use the default message \"INVITE for MO Call\" in Annex A.2.1 of TS 34.229-1
[2] applying conditions A1, A3, A4, A28, A29, A30, and A31, and with the
following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Supported | | +------------------+--------------------------------------------------+ | option-tag | _precondition --_ option tag not present\ | | | Note: this does not affect any other option tags | | | in the Supported header as for instance | | | prescribed in TS 34.229-1 [2] Annex A.2.1 | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(username)_ (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) | | | | | | _s=_(session name) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS_ : (bandwidth-value) | | | | | | **Time description:** | | | | | | _t=_ (start-time) (stop-time) | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) [Note 2] | | | | | | _b=RR:_ (bandwidth-value) [Note 2] | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 12] | | | | | | _a=fmtp:_ (format) _br=5.9-13.2; bw=nb-swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 12] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 13] | | | | | | _a=fmtp:_ (format) _br=5.9-24.4; bw=nb-swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 13] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 14] | | | | | | _a=fmtp:_ (format) _br=13.2; bw=swb; max-red=_ | | | (att-field) [Note 4, 5, 10, 14] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 15] | | | | | | _a=fmtp:_ (format) _br=9.6-13.2; bw=swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 15] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 10, 16] | | | | | | _a=fmtp:_ (format) _br=9.6-24.4; bw=swb; | | | max-red=_ (att-field) [Note 4, 5, 10, 16] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000_ [Note 3, | | | 9, 11] | | | | | | _a=fmtp:_ (format) _bw=nb-swb; max-red=_ | | | (att-field) [Note 4, 5, 11] | | | | | | _a=rtpmap:_ (payload type) _AMR-WB/16000_ [Note | | | 3, 9] | | | | | | _a=fmtp:_ (format) _mode-change-capability=2; | | | max-red=_ (att-field) [Note 4, 6] | | | | | | _a=rtpmap:_ (payload type) | | | _telephone-event/16000_ | | | | | | _a=fmtp: (format)_ | | | | | | _a=rtpmap:_ (payload type) _AMR/8000_ [Note 3, | | | 9] | | | | | | _a=fmtp:_ (format) _mode-change-capability=2; | | | max-red=_ (att-field) [Note 4, 6] | | | | | | _a=rtpmap:_ (payload type) | | | _telephone-event/8000_ | | | | | | _a=fmtp: (format)_ | | | | | | _a=ecn-capable-rtp: leap ect=0_ [Note 7] | | | | | | _a=rtcp-fb:* nack ecn_ [Note 7] | | | | | | _a=rtcp-xr:ecn-sum_ [Note 7] | | | | | | _a=rtcp-rsize_ [Note 7] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | _a=3ge2ae: requested_ [Note 8] | | | | | | * | | | a=crypto:1 AES_CM_128_HMAC_SHA1_80inline:WV | | | NfX19zZW1jdGwgKCkgewkyMjA7fQp9CnVubGVz\|2\^20\|_| | | | | |_ 1:4FEC_ORDER=FEC_SRTP\"_[Note 8] | | | | | |__Attributes for preconditions: not present_ * | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: The RR value shall be greater than 0. | | | The RS value can be any value. | | | | | | Note 3: The channel number shall be \"/1\" or | | | omitted. | | | | | | Note 4: The max-red values from 0 to 220 are | | | allowed. | | | | | | Note 5: The parameters dtx, dtx-recv and | | | evs-mode-switch shall not be present. | | | | | | Note 6: The parameters mode-set, | | | mode-change-period, mode-change-neighbor, crc, | | | robust-sorting and interleaving shall not be | | | included. | | | | | | Note 7: Attributes for ECN Capability may be | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 8: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | | | | | | Note 9: The ordering of payload types shall be | | | as listed, i.e., EVS before AMR-WB before AMR | | | according to NG.114 [31]. | | | | | | Note 10: The EVS payload type shall carry at | | | least one of the five EVS configurations | | | according to NG.114 [31] clause 3.2.2.3. In | | | addition, if there is no further EVS payload | | | type according to the criteria of Note 11, the | | | following rules shall be checked:\ | | | IF the first EVS payload type is configuration | | | B0 or B1 THEN\ | | | there shall be a second EVS payload type with | | | configuration A1\ | | | ELSE IF the first EVS payload type is | | | configuration B2 THEN | | | | | | there shall be a second EVS payload type with | | | configuration A2\ | | | (NOTE: if the first EVS payload type is | | | configuration A1 or A2 there does not need to be | | | any further EVS payload type) | | | | | | Note 11: Further EVS payload type according to | | | NG.114 [31] clause 3.2.2.3 with bandwidth up | | | to super-wideband, no br parameter and no | | | mode-set parameter. | | | | | | Note 12: EVS payload type with EVS Configuration | | | A1 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 13: EVS payload type with EVS Configuration | | | A2 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 14: EVS payload type with EVS Configuration | | | B0 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 15: EVS payload type with EVS Configuration | | | B1 (NG.114 [31] clause 3.2.2.3). | | | | | | Note 16: EVS payload type with EVS Configuration | | | B2 (NG.114 [31] clause 3.2.2.3). | +------------------+--------------------------------------------------+
##### 100 Trying (Step 2) {#trying-step-2-2 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] applying condition A1.
##### 183 Session Progress (Step 3) {#session-progress-step-3-2 .H6}
Use the default message \"183 Session Progress\" in Annex A.2.3 of TS 34.229-1
[2] applying condition A1, and with the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio (transport port) RTP/AVP_ (fmt) [Note | | | 1, 2] | | | | | | _b=AS:65_ | | | | | | _b=RS:_ **(bandwidth-value)** [Note 3] | | | | | | _b=RR:_ **(bandwidth-value)** [Note 3] | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ (payload type) _EVS/16000/1_ [Note | | | 1, 8] | | | | | | _a=fmtp:_ (format) _br=13.2; bw=swb; | | | mode-set=0,1,2; max-red=220_ [Note 8] | | | | | | _a=rtpmap:_ (payload type) _EVS/16000/1_ [Note | | | 1, 9] | | | | | | _a=fmtp:_ (format) _br=5.9-13.2; bw=nb-swb; | | | mode-set=0,1,2; max-red=220_ [Note 9] | | | | | | _a=ecn-capable-rtp: leap ect=0_ [Note 6] | | | | | | _a=rtcp-fb:* nack ecn_ [Note 6] | | | | | | _a=rtcp-xr:ecn-sum_ [Note 6] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | **_a=3ge2ae: requested_ [Note 7]** | | | | | | **_a=c | | | rypto:1 AES_CM_128_HMAC_SHA1_80inline:PS1uQ | | | CVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR\|2\^20\|1:4_ | | | [Note 7]** | | | | | | Note 1: The values for fmt, payload type and | | | format are copied from step 1. | | | | | | Note 2: Transport port is the port number of the | | | SS (see RFC 3264 clause 6). | | | | | | Note 3: The bandwidth-value is copied from step | | | 1. | | | | | | _Note 4: Void_ | | | | | | _Note 5: Void_ | | | | | | _Note 6:_ Attributes for ECN Capability are | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 7: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | | | | | | Note 8: This EVS configuration is sent if UE | | | sent it as the first of its EVS configurations | | | in INVITE. | | | | | | Note 9: This EVS configuration is sent if UE did | | | not send \"br=13.2; bw=swb\" as the first of its | | | EVS configurations in INVITE. | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-2 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
conditions A1 and A7.
##### 200 OK for PRACK (Step 5) {#ok-for-prack-step-5-2 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A10 and A22.
##### 180 Ringing (Step 6) {#ringing-step-6 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] applying conditions A1 and A14.
##### 200 OK for INVITE (Step 7) {#ok-for-invite-step-7 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A1, A10, and
A19.
##### ACK (Step 8) {#ack-step-8 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A1 and A3.
# A.5 MTSI MT Voice Call / 5GS
## A.5.1 MTSI MT Voice Call / with preconditions / 5GS
##### Expected sequence {#expected-sequence-5 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 INVITE SS sends INVITE with the first SDP offer.  
2 100 Trying Optional step: UE may send a 100 Trying provisional response.  
3 183 Session Progress UE sends 183 Session Progress response reliably,
including an SDP answer.  
4 PRACK SS acknowledges reception of 183 Session Progress.  
5 200 OK UE responds to PRACK.  
6 UPDATE SS sends a second SDP offer  
7 200 OK UE responds to UPDATE, including an SDP answer.  
8 180 Ringing UE sends 180 Ringing.  
9 PRACK Conditional step: if UE sent 180 Ringing reliably, SS acknowledges
reception of 180 Ringing  
10 200 OK Conditional step: if UE sent 180 Ringing reliably, UE responds to
PRACK.  
10A Make UE accept the voice call.  
11 200 OK UE responds to INVITE.  
12 ACK SS acknowledges.
* * *
##### Specific Message Contents {#specific-message-contents-93 .H6}
##### INVITE (Step 1) {#invite-step-1-3 .H6}
Use the default message \"INVITE for MT Call\" in Annex A.2.9 of TS 34.229-1
[2] applying conditions A1, A3, and A4, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Supported** | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP 96 97 98 99 | | | 100 102_ | | | | | | _b=AS:65_ | | | | | | _b=RS:0_ | | | | | | _b=RR:2000_ | | | | | | Attributes for media: | | | | | | _a=rtpmap: 96 EVS/16000/1_ | | | | | | _a=fmtp: 96 br=13.2; bw=swb; max-red=220_ | | | | | | _a=rtpmap: 102 EVS/16000/1_ | | | | | | _a=fmtp: 102 br=5.9-13.2; bw=nb-swb; | | | max-red=220_ | | | | | | _a=rtpmap:97 AMR-WB/16000/1_ | | | | | | _a=fmtp:97 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap: 98_ _telephone-event/16000_ | | | | | | _a=fmtp: 98 0-15_ | | | | | | _a=rtpmap:99 AMR/8000/1_ | | | | | | _a=fmtp:99 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap: 100_ _telephone-event/8000_ | | | | | | _a=fmtp: 100 0-15_ | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local none_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos optional remote sendrecv_ | +------------------+--------------------------------------------------+
##### 100 Trying (Step 2) {#trying-step-2-3 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] applying condition A2.
##### 183 Session Progress (Step 3) {#session-progress-step-3-3 .H6}
Use the default message \"183 Session Progress\" in Annex A.2.3 of TS 34.229-1
[2] applying condition A2, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Status-Line** | | +------------------+--------------------------------------------------+ | Reason-Phrase | Not checked | +------------------+--------------------------------------------------+ | **Require** | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=(user-name)_ (sess-id) (sess-version) _IN_ | | | (addrtype) (unicast-address for UE) | | | | | | _s=(session name)_ | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | Attributes for media: | | | | | | _a=rtpmap:_(payload type) _EVS/16000_ [Note 2] | | | | | | _a=fmtp:_(format) _br=13.2; bw=swb; | | | mode-set=0,1,2; max-red=_(att-field) | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local none_ or _a=curr:qos local | | | sendrecv_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | _a=conf:qos remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present.\ | | | Note 2: **The value for fmt, payload type and | | | format is not checked** | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-3 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK (Step 5) {#ok-step-5 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### UPDATE (step 6) {#update-step-6-2 .H6}
Use the default message \"UPDATE\" in Annex A.2.5 of TS 34.229-1 [2] applying
condition A3, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Require** | _precondition_ | | | | | option-tag | | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111112 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP 96_ | | | | | | _b=AS:65_ | | | | | | _b=RS:0_ | | | | | | _b=RR:2000_ | | | | | | Attributes for media: | | | | | | _a=rtpmap:96 EVS/16000/1_ | | | | | | _a=fmtp:96 br=(att-field); bw=(att-field); | | | max-red=220_ [Note 2] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote none_ or _curr:qos remote | | | sendrecv_ [Note 1] | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: Use the value (none/sendrecv) received | | | from 183 Session Progress and attribute | | | a=curr:qos local. | | | | | | Note 2: The br and bw values are taken from step | | | 3. | +------------------+--------------------------------------------------+
##### 200 OK (step 7) {#ok-step-7 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A2, A11, and
A22, and with the following exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | _precondition_ | | | | | option-tag | | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | header shall be present if UE uses TCP to send | | | this message and if there is a message body | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=(user-name)_ (sess-id) (sess-version) _IN_ | | | (addrtype) (unicast-address for UE) [Note 4] | | | | | | _s=(session name)_ | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | Attributes for media: | | | | | | _a=rtpmap:_(payload type) _EVS/16000 [Note | | | 2]_ | | | | | | _a=fmtp:_(format) [Note 2, 3] | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote sendrecv_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: The value for fmt, payload type and | | | format is not checked | | | | | | Note 3: Parameters for the AMR codec are not | | | checked | | | | | | Note 4: \"o=\" line identical to previous SDP | | | sent by UE except that sess-version is | | | incremented by one. | +--------------------+------------------------------------------------+
##### 180 Ringing (Step 8) {#ringing-step-8-2 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] applying conditions A2 and A14, and with the following
exceptions:
**Header/param** **Value/remark**
* * *
**Content-Type** **Header not present** media-type  
**Content-Length** header shall be present if UE uses TCP to send this message
and if there is a message body value _0_ **Message-body** **Not present**
##### PRACK (Step 9) {#prack-step-9-2 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK (Step 10) {#ok-step-10 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### 200 OK (Step 11) {#ok-step-11 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### ACK (Step 12) {#ack-step-12-2 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A2 and A3.
## A.5.1a MTSI MT Voice Call / Default Configuration / 5GS
##### Expected sequence {#expected-sequence-6 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 INVITE SS sends INVITE with the first SDP offer.  
2 100 Trying Optional step: UE may send a 100 Trying provisional response.  
3 183 Session Progress UE sends 183 Session Progress response reliably,
including an SDP answer.  
4 PRACK SS acknowledges reception of 183 Session Progress.  
5 200 OK UE responds to PRACK.  
6 UPDATE SS sends a second SDP offer  
7 200 OK UE responds to UPDATE, including an SDP answer.  
8 180 Ringing UE sends 180 Ringing.  
9 PRACK SS acknowledges reception of 180 Ringing  
10 200 OK UE responds to PRACK.  
10A Make UE accept the voice call.  
11 200 OK UE responds to INVITE.  
12 ACK SS acknowledges.
* * *
##### Specific Message Contents {#specific-message-contents-94 .H6}
##### INVITE (Step 1) {#invite-step-1-4 .H6}
Use the default message \"INVITE for MT Call\" in Annex A.2.9 of TS 34.229-1
[2] applying conditions A1, A3, and A4, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Supported** | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP 96 97 98 99 | | | 100_ | | | | | | _b=AS:65_ | | | | | | _b=RS:0_ | | | | | | _b=RR:2000_ | | | | | | Attributes for media: | | | | | | _a=rtpmap:96 EVS/16000/1_ | | | | | | _a=fmtp:96 br=5.9-24.4; bw=nb-swb; max-red=220_ | | | | | | _a=rtpmap:97 AMR-WB/16000/1_ | | | | | | _a=fmtp:97 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap:98_ _telephone-event/16000_ | | | | | | _a=fmtp:98 0-15_ | | | | | | _a=rtpmap:99 AMR/8000/1_ | | | | | | _a=fmtp:99 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap:100_ _telephone-event/8000_ | | | | | | _a=fmtp:100 0-15_ | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local none_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos optional remote sendrecv_ | +------------------+--------------------------------------------------+
##### 100 Trying (Step 2) {#trying-step-2-4 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] applying condition A2.
##### 183 Session Progress (Step 3) {#session-progress-step-3-4 .H6}
Use the default message \"183 Session Progress\" in Annex A.2.3 of TS 34.229-1
[2] applying condition A2, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Status-Line** | | +------------------+--------------------------------------------------+ | Reason-Phrase | Not checked | +------------------+--------------------------------------------------+ | **Require** | | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=(user-name)_ (sess-id) (sess-version) _IN_ | | | (addrtype) (unicast-address for UE) | | | | | | _s=(session name)_ | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | Attributes for media: | | | | | | _a=rtpmap:_(payload type) _EVS/16000_ [Note 2] | | | | | | _a=fmtp:_(format) _br=5.9-24.4; bw=nb-swb; | | | max-red=_(att-field) | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local none_ or _a=curr:qos local | | | sendrecv_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | _a=conf:qos remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present.\ | | | Note 2: **The values for fmt, payload type and | | | format are not checked** | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-4 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK (Step 5) {#ok-step-5-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### UPDATE (step 6) {#update-step-6-3 .H6}
Use the default message \"UPDATE\" in Annex A.2.5 of TS 34.229-1 [2] applying
condition A3, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Require** | _precondition_ | | | | | option-tag | | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111112 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP 96_ | | | | | | _b=AS:65_ | | | | | | _b=RS:0_ | | | | | | _b=RR:2000_ | | | | | | Attributes for media: | | | | | | _a=rtpmap:96 EVS/16000/1_ | | | | | | _a=fmtp:96 br=(att-field); bw=(att-field); | | | max-red=220_ [Note 2] | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote none_ or _curr:qos remote | | | sendrecv_ [Note 1] | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: Use the value (none/sendrecv) received | | | from 183 Session Progress and attribute | | | a=curr:qos local. | | | | | | Note 2: The br and bw values are taken from step | | | 3. | +------------------+--------------------------------------------------+
##### 200 OK (step 7) {#ok-step-7-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A2, A11, and
A22, and with the following exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | _precondition_ | | | | | option-tag | | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | header shall be present if UE uses TCP to send | | | this message and if there is a message body | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=(user-name)_ (sess-id) (sess-version) _IN_ | | | (addrtype) (unicast-address for UE) [Note 4] | | | | | | _s=(session name)_ | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | Attributes for media: | | | | | | _a=rtpmap:_(payload type) _EVS/16000 [Note | | | 2]_ | | | | | | _a=fmtp:_(format) [Note 2, 3] | | | | | | Attributes for preconditions: | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote sendrecv_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: The value for fmt, payload type and | | | format is not checked | | | | | | Note 3: Parameters for the AMR codec are not | | | checked | | | | | | Note 4: \"o=\" line identical to previous SDP | | | sent by UE except that sess-version is | | | incremented by one. | +--------------------+------------------------------------------------+
##### 180 Ringing (Step 8) {#ringing-step-8-3 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] applying conditions A2 and A14, and with the following
exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | **_100rel_** | | | | | **option-tag** | | +--------------------+------------------------------------------------+ | **Content-Type** | **Header not present** | +--------------------+------------------------------------------------+ | media-type | | +--------------------+------------------------------------------------+ | **Content-Length** | header shall be present if UE uses TCP to send | | | this message and if there is a message body | +--------------------+------------------------------------------------+ | value | _0_ | +--------------------+------------------------------------------------+ | **Message-body** | **Not present** | +--------------------+------------------------------------------------+
##### PRACK (Step 9) {#prack-step-9-3 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK (Step 10) {#ok-step-10-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### 200 OK (Step 11) {#ok-step-11-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### ACK (Step 12) {#ack-step-12-3 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A2 and A3.
## A.5.2 MTSI MT Voice Call / without preconditions / 5GS
##### Expected sequence {#expected-sequence-7 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 INVITE SS sends INVITE with the first SDP offer.  
2 100 Trying Optional step: UE may send a 100 Trying provisional response.  
3 183 Session Progress UE sends 183 Session Progress response reliably,
including an SDP answer.  
4 PRACK SS acknowledges reception of 183 Session Progress.  
5 200 OK UE responds to PRACK.  
6 180 Ringing UE sends 180 Ringing.  
7 PRACK Conditional step: if UE sent 180 Ringing reliably, SS acknowledges
reception of 180 Ringing  
8 200 OK Conditional step: if UE sent 180 Ringing reliably, UE responds to
PRACK.  
8A Make UE accept the voice call.  
9 200 OK UE responds to INVITE.  
10 ACK SS acknowledges.
* * *
##### Specific Message Contents {#specific-message-contents-95 .H6}
##### INVITE (Step 1) {#invite-step-1-5 .H6}
Use the default message \"INVITE for MT Call\" in Annex A.2.9 of TS 34.229-1
[2] applying conditions A1, A3, and A4, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Message-body** | The following SDP types and values. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP 96 97 98 99 | | | 100 102_ | | | | | | _b=AS:65_ | | | | | | _b=RS:0_ | | | | | | _b=RR:2000_ | | | | | | Attributes for media: | | | | | | _a=rtpmap: 96 EVS/16000/1_ | | | | | | _a=fmtp: 96 br=13.2; bw=swb; max-red=220_ | | | | | | _a=rtpmap: 102 EVS/16000/1_ | | | | | | _a=fmtp: 102 br=5.9-13.2; bw=nb-swb; | | | max-red=220_ | | | | | | _a=rtpmap:97 AMR-WB/16000/1_ | | | | | | _a=fmtp:97 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap: 98_ _telephone-event/16000_ | | | | | | _a=fmtp: 98 0-15_ | | | | | | _a=rtpmap:99 AMR/8000/1_ | | | | | | _a=fmtp:99 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap: 100_ _telephone-event/8000_ | | | | | | _a=fmtp: 100 0-15_ | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | +------------------+--------------------------------------------------+
##### 100 Trying (Step 2) {#trying-step-2-5 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] applying condition A2.
##### 183 Session Progress (Step 3) {#session-progress-step-3-5 .H6}
Use the default message \"183 Session Progress\" in Annex A.2.3 of TS 34.229-1
[2] applying condition A2, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Status-Line** | | +------------------+--------------------------------------------------+ | Reason-Phrase | Not checked | +------------------+--------------------------------------------------+ | **Supported** | option-tag "precondition" not present in | | | Supported header | +------------------+--------------------------------------------------+ | **option-tag** | **_precondition_** | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=(user-name)_ (sess-id) (sess-version) _IN_ | | | (addrtype) (unicast-address for UE) | | | | | | _s=(session name)_ | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | Attributes for media: | | | | | | _a=rtpmap:_(payload type) _EVS/16000_ [Note 2] | | | | | | _a=fmtp:_(format) _br=13.2; bw=swb; | | | mode-set=0,1,2; max-red=_(att-field) | | | | | | **Attributes for preconditions: not present** | | | | | | Note 1: At least one \"c=\" field shall be | | | present.\ | | | Note 2: **The value for fmt, payload type and | | | format is not checked** | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-5 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK (Step 5) {#ok-step-5-2 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### 180 Ringing (Step 6) {#ringing-step-6-1 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] applying conditions A2 and A14, and with the following
exceptions:
**Header/param** **Value/remark**
* * *
**Content-Type** **Header not present** media-type  
**Content-Length** header shall be present if UE uses TCP to send this message
and if there is a message body value _0_ **Message-body** **Not present**
##### PRACK (Step 7) {#prack-step-7 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK for PRACK (Step 8) {#ok-for-prack-step-8 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### 200 OK for INVITE (Step 9) {#ok-for-invite-step-9 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### ACK (Step 10) {#ack-step-10 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A2 and A3.
## A.5.2a MTSI MT Voice Call / Default Configuration with preconditions
disabled / 5GS
##### Expected sequence {#expected-sequence-8 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 INVITE SS sends INVITE with the first SDP offer.  
2 100 Trying Optional step: UE may send a 100 Trying provisional response.  
3 183 Session Progress UE sends 183 Session Progress response reliably,
including an SDP answer.  
4 PRACK SS acknowledges reception of 183 Session Progress.  
5 200 OK UE responds to PRACK.  
6 180 Ringing UE sends 180 Ringing.  
7 PRACK SS acknowledges reception of 180 Ringing  
8 200 OK UE responds to PRACK.  
8A Make UE accept the voice call.  
9 200 OK UE responds to INVITE.  
10 ACK SS acknowledges.
* * *
##### Specific Message Contents {#specific-message-contents-96 .H6}
##### INVITE (Step 1) {#invite-step-1-6 .H6}
Use the default message \"INVITE for MT Call\" in Annex A.2.9 of TS 34.229-1
[2] applying conditions A1, A3, and A4, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Message-body** | The following SDP types and values. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | _s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for SS) | | | | | | _b=AS:65_ | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP 96 97 98 99 | | | 100_ | | | | | | _b=AS:65_ | | | | | | _b=RS:0_ | | | | | | _b=RR:2000_ | | | | | | Attributes for media: | | | | | | _a=rtpmap:96 EVS/16000/1_ | | | | | | _a=fmtp:96 br=5.9-24.4; bw=nb-swb; max-red=220_ | | | | | | _a=rtpmap:97 AMR-WB/16000/1_ | | | | | | _a=fmtp:97 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap:98_ _telephone-event/16000_ | | | | | | _a=fmtp:98 0-15_ | | | | | | _a=rtpmap:99 AMR/8000/1_ | | | | | | _a=fmtp:99 mode-change-capability=2; | | | max-red=220_ | | | | | | _a=rtpmap:100_ _telephone-event/8000_ | | | | | | _a=fmtp:100 0-15_ | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | +------------------+--------------------------------------------------+
##### 100 Trying (Step 2) {#trying-step-2-6 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] applying condition A2.
##### 183 Session Progress (Step 3) {#session-progress-step-3-6 .H6}
Use the default message \"183 Session Progress\" in Annex A.2.3 of TS 34.229-1
[2] applying condition A2, and with the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Status-Line** | | +------------------+--------------------------------------------------+ | Reason-Phrase | Not checked | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | Session description: | | | | | | _v=0_ | | | | | | _o=(user-name)_ (sess-id) (sess-version) _IN_ | | | (addrtype) (unicast-address for UE) | | | | | | _s=(session name)_ | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | Time description: | | | | | | _t=0 0_ | | | | | | Media description: | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | _b=RS:_ (bandwidth-value) | | | | | | _b=RR:_ (bandwidth-value) | | | | | | Attributes for media: | | | | | | _a=rtpmap:_(payload type) _EVS/16000_ [Note 2] | | | | | | _a=fmtp:_(format) _br=5.9-24.4; bw=nb-swb; | | | max-red=_(att-field) | | | | | | Note 1: At least one \"c=\" field shall be | | | present.\ | | | Note 2: **The values for fmt, payload type and | | | format are not checked** | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-6 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK (Step 5) {#ok-step-5-3 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### 180 Ringing (Step 6) {#ringing-step-6-2 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] applying conditions A2 and A14, and with the following
exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | **_100rel_** | | | | | **option-tag** | | +--------------------+------------------------------------------------+ | **Content-Type** | **Header not present** | +--------------------+------------------------------------------------+ | media-type | | +--------------------+------------------------------------------------+ | **Content-Length** | header shall be present if UE uses TCP to send | | | this message and if there is a message body | +--------------------+------------------------------------------------+ | value | _0_ | +--------------------+------------------------------------------------+ | **Message-body** | **Not present** | +--------------------+------------------------------------------------+
##### PRACK (Step 7) {#prack-step-7-1 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] applying
condition A3.
##### 200 OK for PRACK (Step 8) {#ok-for-prack-step-8-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### 200 OK for INVITE (Step 9) {#ok-for-invite-step-9-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] applying conditions A5, A8, A11,
and A22.
##### ACK (Step 10) {#ack-step-10-1 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A2 and A3.
# A.6 IMS Emergency Voice Call / 5GS
##### Expected sequence {#expected-sequence-9 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 INVITE UE sends INVITE with the first SDP offer.  
2 100 Trying SS sends a 100 Trying provisional response.  
3 180 Ringing SS sends a 180 Ringing.  
4 200 OK SS responds INVITE with 200 OK.  
5 ACK UE acknowledges.
* * *
##### Specific Message Contents {#specific-message-contents-97 .H6}
##### INVITE (Step 1) {#invite-step-1-7 .H6}
Use the default message \"INVITE for MO Call\" in Annex A.2.1 of TS 34.229-1
[2] with condition A28 and the following exceptions:
+------------------+--------------------------------------------------+ | **Header/param** | **Value/remark** | +==================+==================================================+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=(username) (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE)_ | | | | | | _s=(session name)_ | | | | | | _c=IN (addrtype)_ (connection-address for UE) | | | [Note 1] | | | | | | **Time description:** | | | | | | _t=_**(start-** time**) (stop-time)** | | | | | | **Media description:** | | | | | | _m=audio_ (transport port) [Note 2] | | | | | | _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _b=AS:_ (bandwidth-value) | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: AMR-WB/16000 codec shall be present in | | | the media attributes, optionally including | | | channel number \"/1\". | +------------------+--------------------------------------------------+
##### 180 Ringing for INVITE (Step 3) {#ringing-for-invite-step-3 .H6}
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] with conditions A4 and A14.
##### 200 OK for INVITE (Step 4) {#ok-for-invite-step-4 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] with conditions A6 and A22 and
the following exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS)_s=-_ | | | | | | _c=IN_ (addrtype) (connection-address for | | | SS)_b=AS:37_ | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio_ (transport port) _RTP/AVP_ (fmt) | | | [Note 1]_b=AS:37_ | | | | | | _b=RS:0_ | | | | | | _b=RR:0_ | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ **(** payload type) | | | _AMR-WB/16000/1_ [Note 1]_a=fmtp:_ (format) | | | _mode-change-capability=2; | | | max-red=220a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Note 1: The values for fmt, payload type and | | | format are copied from step 1.** | +--------------------+------------------------------------------------+
ACK (step 5)
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] applying
conditions A1 and A3.
# A.7 MO Release of Voice or Video Call / 5GS
##### Expected sequence {#expected-sequence-10 .H6}
* * *
Step Direction Message/Procedure Comment  
UE SS  
1 BYE The UE releases the call with BYE  
2 200 OK The SS sends 200 OK for BYE
* * *
##### Specific message contents {#specific-message-contents-98 .H6}
##### BYE (Step 1) {#bye-step-1 .H6}
Use the default message \"BYE\" in Annex A.2.8 of TS 34.229-1 [2] with
conditions A1 and A8.
##### 200 OK (Step 2) {#ok-step-2 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in annex A.3.1 of TS 34.229-1 [2] with condition A10.
# A.8 MT Release of Voice or Video Call / 5GS
##### Expected sequence {#expected-sequence-11 .H6}
* * *
Step Direction Message/Procedure Comment  
UE SS  
1 BYE The SS releases the call with BYE  
2 200 OK The UE sends 200 OK for BYE
* * *
##### Specific message contents {#specific-message-contents-99 .H6}
##### BYE (Step 1) {#bye-step-1-1 .H6}
Use the default message \"BYE\" in Annex A.2.8 of TS 34.229-1 [2] with
conditions A3 and A8.
##### 200 OK (Step 2) {#ok-step-2-1 .H6}
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in annex A.3.1 of TS 34.229-1 [2] with conditions A5, A8, and A22.
# A.9 EPS Fallback for Voice Call / 5GS
## A.9.1 EPS Fallback for Voice Call / steps before fallback / 5GS
##### Expected sequence {#expected-sequence-12 .H6}
* * *
Step Direction Message/Procedure Comment  
UE SS  
1 INVITE UE sends INVITE including an SDP offer.  
2 100 Trying SS sends a 100 Trying provisional response.  
3 183 Session Progress SS sends 183 Session Progress including an SDP answer.  
4 PRACK UE acknowledges reception of 183 Session Progress.  
5 200 OK SS sends 200 OK for PRACK.
* * *
##### Specific message contents {#specific-message-contents-100 .H6}
##### INVITE (Step 1) {#invite-step-1-8 .H6}
Use the default message \"INVITE for MO Call Setup\" in Annex A.2.1 of TS
34.229-1 [2] with conditions A1, A3, A4, and A28 and the following exceptions:
* * *
Header/param Value/Remark
Supported
option-tag _precondition\_ Note1: the _precondition_ option-tag is only
required when the UE is configured to use preconditions.\ Note 2: the
_precondition_ option-tag being required does not affect any other option tags
in the Supported header as for instance prescribed in TS 34.229-1 [2] Annex
A.2.1
**Message-body** SDP body present but contents not checked
* * *
##### 100 Trying (Step 2) {#trying-step-2-7 .H6}
Use the default message \"100 Trying for INVITE\" in Annex A.2.2 of TS
34.229-1 [2] with condition A1.
##### 183 Session Progress (Step 3) {#session-progress-step-3-7 .H6}
Use the default message \"183 Session Progress for INVITE\" in Annex A.2.3 of
TS 34.229-1 [2] with condition A1 and the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Require | present if UE is configured to use preconditions | +------------------+--------------------------------------------------+ | option-tag | _precondition_ | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | Session description: | | | | | | _\- v=0_ | | | | | | _\- o=- 1111111111 1111111111 IN_ (addrtype) | | | (unicast-address for SS) | | | | | | - _s=-_ | | | | | | _\- c=IN_ (addrtype) (connection-address for SS) | | | | | | _\- b=AS:37_ | | | | | | Time description: | | | | | | _\- t=0 0_ | | | | | | Media description: | | | | | | _\- m=audio (transport port) RTP/AVP_ (fmt) | | | [Note 1, 4] | | | | | | _\- b=AS:3_ 7 | | | | | | _\- b=RS:0_ | | | | | | _\- b=RR:2000_ | | | | | | Attributes for media: | | | | | | _\- a=rtpmap:_ **(payload type)** | | | _AMR-WB/16000/1_ [Note 1] | | | | | | _\- a=fmtp:_ **(format)** | | | _mode-change-capability=2; max-red=220_ [Note | | | 1] | | | | | | _\- a=ecn-capable-rtp: leap ect=0_ [Note 2] | | | | | | _\- a=rtcp-fb:* nack ecn_ [Note 2] | | | | | | _\- a=rtcp-xr:ecn-sum_ [Note 2] | | | | | | _\- a=ptime:20_ | | | | | | _\- a=maxptime:240_ | | | | | | **Attributes for media security mechanism:** | | | | | | **_\- a=3ge2ae: requested_ [Note 3]** | | | | | | **_\- a=crypto:1 | | | AES_CM_128_HMAC_SHA1_80inline:PS1uQ | | | CVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR\|2\^20\|1:4_ | | | [Note 3]** | | | | | | **Attributes for preconditions: [Note 5]** | | | | | | _a=curr:qos local none_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos mandatory remote sendrecv_ | | | | | | _a=conf:qos remote sendrecv_ | | | | | | Note 1: The value for fmt, payload type (AMR) | | | and format is copied from Step 1. | | | | | | _Note 2:_ Attributes for ECN Capability are | | | present if the UE supports Explicit Congestion | | | Notification. | | | | | | Note 3: Attributes for media plane security are | | | present if the use of end-to-access-edge | | | security is supported by UE. | | | | | | Note 4: transport port is the port number of the | | | SS (see RFC 3264 clause 6). | | | | | | Note 5: present if UE is configured to use | | | preconditions | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-7 .H6}
Use the default message \"PRACK\" in Annex A.2.4 of TS 34.229-1 [2] with
conditions A1 and A7.
##### 200 OK (Step 5) {#ok-step-5-4 .H6}
Use the default message \"200 OK for requests other than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] with conditions A10 and A22.
## A.9.2 EPS Fallback for Voice Call / steps after fallback / 5GS
##### Expected sequence {#expected-sequence-13 .H6}
+------+-----------+----------------------+----------------------+---+ | Step | Direction | Message/Procedure | Comment | | +------+-----------+----------------------+----------------------+---+ | | UE | SS | | | +------+-----------+----------------------+----------------------+---+ | 1 | | SS starts a timer (5 | | | | | | seconds) to wait for | | | | | | an optional REGISTER | | | | | | request from UE.\ | | | | | | NOTE: if the UE does | | | | | | not send REGISTER | | | | | | and is configured to | | | | | | use preconditions, | | | | | | it may send UPDATE | | | | | | right away. In that | | | | | | case, the timer is | | | | | | stopped upon arrival | | | | | | of UPDATE. | | | +------+-----------+----------------------+----------------------+---+ | - | | EXCEPTION: Steps | | | | | | 2a1-2a3 describes | | | | | | behaviour that | | | | | | depends on UE | | | | | | implementation. | | | | | | | | | | | | The "lower case | | | | | | letter" identifies a | | | | | | step sequence that | | | | | | takes place if such | | | | | | implementation was | | | | | | applied. | | | +------+-----------+----------------------+----------------------+---+ | 2a1 | --> | REGISTER | Optional step: the | | | | | | UE may register for | | | | | | IMS on EPS. | | +------+-----------+----------------------+----------------------+---+ | 2a2 | \ | IF the UE is | UPDATE contains a | | | | | configured to use | second SDP offer. | | | | | preconditions THEN | | | | | | the UE sends UPDATE | | | +------+-----------+----------------------+----------------------+---+ | 3a2 | \ | ACK | - | | +------+-----------+----------------------+----------------------+---+
Specific message contents
##### REGISTER (Step 2a1) {#register-step-2a1 .H6}
Use the default message \"REGISTER\" in Annex A.1.1 of TS 34.229-1 [2]
applying conditions A2 and A31.
200 OK (Step 2a2)
Use the default message \"200 OK for REGISTER\" in Annex A.1.3 of TS 34.229-1
[2] with condition A2.
##### UPDATE (Step 3a1) {#update-step-3a1 .H6}
Use the default message \"UPDATE\" in Annex A.2.5 of TS 34.229-1 [2] with
conditions A1 and A5 and the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/Remark | +------------------+--------------------------------------------------+ | Require | | +------------------+--------------------------------------------------+ | option-tag | _precondition\ | | |_ Note1: the _precondition_ option-tag is only | | | required when the UE is configured to use | | | preconditions.\ | | | Note 2: the _precondition_ option-tag being | | | required does not affect any other option tags | | | in the Require header as for instance prescribed | | | in TS 34.229-1 [2] Annex A.2.6 | +------------------+--------------------------------------------------+ | **Message-body** | The following SDP types and values shall be | | | present. | | | | | | Session description: | | | | | | _\- v=0_ | | | | | | _\- o=(username)_ (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) [Note 2] | | | | | | _\- s=_(session name) | | | | | | _\- c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _\- b=AS:_ (bandwidth-value) | | | | | | Time description: | | | | | | _\- t=0 0_ | | | | | | Media description: | | | | | | _\- m=audio (transport port) RTP/AVP_ (fmt) | | | [Note 2] | | | | | | _\- c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | _\- b=AS:_ (bandwidth-value) | | | | | | _\- b=RS:_ (bandwidth-value) | | | | | | _\- b=RR:_ (bandwidth-value) | | | | | | Attributes for media: | | | | | | _\- a=rtpmap:_ (payload type) _AMR-WB/16000_ | | | [Note 2] [Note 4] | | | | | | _\- a=fmtp:_ (format) [Note 2, 3] | | | | | | **Attributes for preconditions:** | | | | | | _a=curr:qos local sendrecv_ | | | | | | _a=curr:qos remote none_ | | | | | | _a=des:qos mandatory local sendrecv_ | | | | | | _a=des:qos optional remote sendrecv_ or | | | _a=des:qos mandatory remote sendrecv_ | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: **The value for fmt, payload type and | | | format is not checked** | | | | | | **Note 3: Parameters for the AMR codec are not | | | checked** | | | | | | **Note 4: The AMR channel number shall be "/1" | | | or omitted.** | +------------------+--------------------------------------------------+
##### 200 OK (Step 3a2) {#ok-step-3a2 .H6}
Use the default message \"200 OK for requests other than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2] with conditions A1, A10 and A21
and the following exceptions:
+--------------------+------------------------------------------------+ | **Header/param** | **Value/remark** | +====================+================================================+ | **Require** | present if UE is configured to use | | | preconditions | +--------------------+------------------------------------------------+ | option-tag | _precondition_ | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | | +--------------------+------------------------------------------------+ | Value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | SDP body of the 200 OK response copied from | | | the received UPDATE and modified as follows: | | | | | | - IP address on \"c=\" lines and transport | | | port on \"m=\" lines changed to indicate to | | | which IP address and port the UE should start | | | sending the media; | | | | | | _\- \"o=\" line identical to previous SDP sent | | | by SS_ except _that sess-version is | | | incremented._ | | | | | | _-_ Attributes for preconditions: _a=curr:qos | | | remote sendrecv_ | +--------------------+------------------------------------------------+
180 Ringing (Step 4)
Use the default message \"180 Ringing for INVITE\" in Annex A.2.6 of TS
34.229-1 [2] with conditions A1 and A13.
##### 200 OK (Step 5) {#ok-step-5-5 .H6}
Use the default message \"200 OK for requests other than REGISTER or
SUBSRIBE\" in Annex A.3.1 of TS 34.229-1 [2] with conditions A1, A10, A19, and
A21.
##### ACK (Step 6) {#ack-step-6 .H6}
Use the default message \"ACK\" in Annex A.2.7 of TS 34.229-1 [2] with
condition A1.
# A.10 Default handling of PUBLISH requests
This procedure may occur within 3 seconds after a successful IMS registration.
NOTE: For sake of testability and to mitigate detrimental effect on non-IMS
test cases, it is assumed that such PUBLISH request arrives at SS within 3
seconds of sending 200 OK for REGISTER.
The generic test procedure:
1 SS receives from the UE a PUBLISH request.
2 The SS responds to the PUBLISH request with a 503 Service Unavailable
response carrying a Retry-after header field big enough to quench further
publication traffic during test case execution.
##### Expected sequence {#expected-sequence-14 .H6}
* * *
Step Direction Message Comment  
UE SS  
1 PUBLISH The UE sends a PUBLISH request (A.4.3).  
2 503 Service Unavailable The SS responds with 503 Service Unavailable
(A.4.2).
* * *
##### Specific Message Contents {#specific-message-contents-101 .H6}
##### PUBLISH (Step 1) {#publish-step-1 .H6}
Use the default message \"PUBLISH\" in Annex A.4.3 of TS 34.229-1 [2] applying
conditions A1 and A5.
##### 503 Service Unavailable (Step 2) {#service-unavailable-step-2 .H6}
Use the default message "503 Service Unavailable" in Annex A.4.2 of TS
34.229-1 [2] and with the following exceptions:
Header/param Value/remark Rel Reference
* * *
**Retry-after** RFC 3261 [6] period _7200_  
duration Not present  
comment Not present
# A.11 Mobile Initiated De-Registration / 5GS
IMS de-registration is initiated on the UE. The SS waits for the UE to send a
REGISTER request, in accordance with 3GPP TS 24.229 [7], clause 5.1.1.6.
Expected sequence:
+--------------------+-----------+-----------+--------------------+---+ | Step | Direction | Message | Comment | | +--------------------+-----------+-----------+--------------------+---+ | | UE | SS | | | +--------------------+-----------+-----------+--------------------+---+ | 0A | | SUBSCRIBE | Optional: The UE | | | | | | unsubscribes from | | | | | | one of its | | | | | | subscribed to | | | | | | event packages. | | +--------------------+-----------+-----------+--------------------+---+ | 0B | | 200 OK | If the UE sent | | | | | | SUBSCRIBE, the SS | | | | | | responds to | | | | | | SUBSCRIBE with 200 | | | | | | OK. | | +--------------------+-----------+-----------+--------------------+---+ | 0C | | NOTIFY | If the UE sent | | | | | | SUBSCRIBE, the SS | | | | | | sends a final | | | | | | NOTIFY | | +--------------------+-----------+-----------+--------------------+---+ | 0D | | 200 OK | If the UE sent | | | | | | SUBSCRIBE, the UE | | | | | | responds to NOTIFY | | | | | | with 200 OK. | | +--------------------+-----------+-----------+--------------------+---+ | 1 | | REGISTER | The UE sends a | | | | | | de-registration | | | | | | request for IMS | | | | | | services. | | +--------------------+-----------+-----------+--------------------+---+ | 2 | | 200 OK | The SS responds to | | | | | | REGISTER with 200 | | | | | | OK. | | +--------------------+-----------+-----------+--------------------+---+ | Note 1: Steps | | | | | | 0A-0D may be | | | | | | repeated for any | | | | | | or all event | | | | | | packages | | | | | | subscribed to by | | | | | | the UE. It is the | | | | | | UE's decision | | | | | | which | | | | | | unsubscriptions to | | | | | | perform. | | | | | | | | | | | | Note 2: The UE can | | | | | | send the 200 OK | | | | | | for NOTIFY (step | | | | | | 0D) after the | | | | | | REGISTER request | | | | | | (step 1) or even | | | | | | not send it at | | | | | | all. | | | | | +--------------------+-----------+-----------+--------------------+---+
Specific message contents
SUBSCRIBE (step 0A)
Use the default message "SUBSCRIBE for reg-event package" in Annex A.1.4 of TS
34.229-1 [2] or "SUBSCRIBE for conference event package" in Annex A.5.1 of TS
34.229-1 [2] or "SUBSCRIBE for message-summary event package" in Annex A.6.1
of TS 34.229-1 [2], and with the following exceptions:
Header/param Cond Value/remark Rel Reference
* * *
**From**  
addr-spec Same as in original SUBSCRIBE that set up the corresponding
subscription  
tag Same as in original SUBSCRIBE that set up the corresponding subscription  
**To**  
addr-spec As specified in TS 34.229-1 [2] Annex A.1.4/A.5.1/A.6.1  
tag Same as in 200 OK for original SUBSCRIBE that set up the corresponding
subscription  
**CSeq**  
value value of the previous SUBSCRIBE sent by the UE for this dialog
incremented by one  
method _SUBSCRIBE_  
**Expires**  
delta-seconds _0_
200 OK for SUBSCRIBE (step 0B)
Use the default message "200 OK for SUBSCRIBE" in Annex A.1.5, A.5.2 or A.6.3
of TS 34.229-1 [2], whatever appropriate, with the following exceptions:
Header/param Cond Value/remark Rel Reference
* * *
**To** RFC 3261 [6] addr-spec As specified in TS 34.229-1 [2] Annex
A.1.4/A.5.1/A.6.1  
tag Same as in step 0A  
**Expires** RFC 3261 [6] delta-seconds _0_
NOTIFY (step 0C)
* * *
Header/param Cond Value/remark Rel Reference
* * *
**Request-Line** RFC 3261 [6]
Method _NOTIFY_
Request-URI UE's contact address in SIP URI form, as provided in the Contact
header within the SUBSCRIBE creating the dialog
SIP-Version _SIP/2.0_
**Via** order of the parameters in this header must be like in this table RFC
3261 [6]
**via-param1:**
sent-protocol _SIP/2.0/UDP_ when using UDP or\  
_SIP/2.0/TCP_ when using TCP
sent-by IP address and protected server port of SS
via-branch value starting with '_z9hG4bK'_ (NOTE 1)
**via-param2:**
sent-protocol _SIP/2.0/UDP_ when using UDP or\  
_SIP/2.0/TCP_ when using TCP
sent-by _scscf.3gpp.org_
via-branch value starting with '_z9hG4bK'_ (NOTE 1)
**From** RFC 3261 [6]
addr-spec same URI as received in the To header of the corresponding SUBSCRIBE
message
tag same as to-tag in step 0A
**To** RFC 3261 [6]
addr-spec same URI as received in the From header of the corresponding
SUBSCRIBE message
tag same as from-tag in step 0A
**Call-ID** RFC 3261 [6]
callid same as value received in SUBSCRIBE message
**CSeq** RFC 3261 [6]
value 1
method _NOTIFY_
**Contact** RFC 3261 [6]
addr-spec A1 \_
addr-spec A2 _sip:final\@conf-factory._ appended with px_IMS_HomeDomainName
addr-spec A3 \_
**Event** RFC 6665 [28]\ RFC 3680 [18]
event-type A1 _reg_
event-type A2 _conference_
event-type A3 _message-summary_
**Max-Forwards** RFC 3261 [6]
value _69_
**Subscription-State** RFC 6665 [28]
substate-value _terminated_
**Content-Length**
value _0_
* * *
* * *
Condition Explanation A1 Final NOTIFY sent for reg-event A2 Final NOTIFY sent
for conf-event A3 Final NOTIFY sent for message-summary
* * *
NOTE 1: Branch parameter values sent by SS are different within a test case
execution.
200 OK (step 0D)
Use the default message \"200 OK for other requests than REGISTER or
SUBSCRIBE\" in Annex A.3.1 of TS 34.229-1 [2].
REGISTER (step 1)
Use the default message "REGISTER" in Annex A.1.1 of TS 34.229-1 [1] with
conditions A2 and A17 \"UE initiated IMS re-registration or de-registration\"
with the following exceptions:
+------------------+------+------------------+-----+----------------+ | Header/param | Cond | Value/remark | Rel | Reference | +==================+======+==================+=====+================+ | **Contact** | | | | RFC 3261 [6] | +------------------+------+------------------+-----+----------------+ | addr-spec | | SIP URI with IP | | | | | | address or FQDN | | | | | | and protected | | | | | | server port of | | | | | | the UE, AND,\ | | | | | | if the UE | | | | | | supports GRUU, | | | | | | the following | | | | | | parameter: | | | | | | | | | | | | +_si | | | | | | p.instance_ =\"\", | | | | | | OR\ | | | | | | * | | | +------------------+------+------------------+-----+----------------+ | expires | | _0_ (if present) | | | +------------------+------+------------------+-----+----------------+ | **Expires** | | (must be present | | RFC 3261 [6] | | | | if addr-spec is | | | | | | *) | | | +------------------+------+------------------+-----+----------------+ | delta-seconds | | _0_ (if present) | | | +------------------+------+------------------+-----+----------------+ | **Supported** | | header may be | | | | | | missing or it | | | | | | may contain any | | | | | | value | | | +------------------+------+------------------+-----+----------------+ | * | | value not | | | | _Authorization_ * | | checked | | | +------------------+------+------------------+-----+----------------+
NOTE: In contrast to Annex A.1.1 of TS 34.229-1 [2], the Contact header does
not have any further mandatory feature parameters.
##### 200 OK (step 2) {#ok-step-2-2 .H6}
Use the default message "200 OK for REGISTER" in Annex A.1.3 of TS 34.229-1
[2] with the following exceptions:
* * *
Header/param Cond Value/remark Rel Reference
* * *
**Contact** RFC 3261 [6]
addr-spec same value as in REGISTER request if \"*\" is not included in the
Contact header field of the REGISTER request in step 1\  
same value as in the Contact header field of the \"200 OK\" response to the
initial registration if \"*\" is included in the Contact header field of the
REGISTER request in step 1 (NOTE)
expires _0_
NOTE: According to 3GPP TS 24.229 [7] clause 5.4.1.4.1 when the S-CSCF gets a
wild-carded contact address for de-registration it shall include all de-
registered contact addresses in the contact header of the 200 OK response â‡’
there is no "*" in DL
* * *
# A.12 IMS Re-Registration / 5GS
The generic test procedure for IMS re-registration
##### Expected sequence {#expected-sequence-15 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 REGISTER The UE sends a re-registration request.  
2 200 OK The SS responds with 200 OK.
##### REGISTER (Step 1) {#register-step-1-2 .H6}
Use the default message "REGISTER" in Annex A.1.1 of TS 34.229-1 [2] with
conditions A2 and A32.
# A.13 IMS MO SMS / 5GS
##### Expected sequence {#expected-sequence-16 .H6}
* * *
Step Direction Message/Procedure Comment  
UE SS  
1 SIP MESSAGE UE sends a SIP MESSAGE request including a vnd.3gpp.sms payload
that contains a short message  
2 202 Accepted The SS responds with 202 Accepted  
3 SIP MESSAGE SS sends a SIP MESSAGE request including a vnd.3gpp.sms payload
that contains the short message submission report indicating a positive
acknowledgement of the short message sent by the UE at Step 1  
4 200 OK UE responds with 200 OK  
5 SIP MESSAGE SS sends a SIP MESSAGE request including a vnd.3gpp.sms payload
that contains a status report  
6 200 OK UE responds with 200 OK  
7 SIP MESSAGE UE sends a SIP MESSAGE request including a vnd.3gpp.sms payload
that contains an acknowledgement for the status report received at Step 6  
8 202 Accepted The SS responds with 202 Accepted
* * *
##### Specific message contents: {#specific-message-contents-102 .H6}
##### SIP MESSAGE (Step 1) {#sip-message-step-1 .H6}
Use the default "MESSAGE for MO SMS" in Annex A.7.3 of TS 34.229-1 [2] with
conditions A2 and A5.
##### 202 Accepted (Step 2 and 8) {#accepted-step-2-and-8 .H6}
Use the default "202 Accepted" in Annex A.3.3 of TS 34.229-1 [2].
##### SIP MESSAGE (Step 3) {#sip-message-step-3 .H6}
Use the default "MESSAGE for submission report for MO SMS" in Annex A.7.4 of
TS 34.229-1 [2].
##### 200 OK (step 4 and 6) {#ok-step-4-and-6 .H6}
Use the default message "200 OK for requests other than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2] with conditions A5 and A22.
##### SIP MESSAGE (Step 5) {#sip-message-step-5 .H6}
Use the default "MESSAGE for status report for MO SMS" in Annex A.7.5 of TS
34.229-1 [2].
##### SIP MESSAGE (Step 7) {#sip-message-step-7 .H6}
Use the default "MESSAGE for delivery report for MO SMS" in Annex A.7.6 of TS
34.229-1 [2].
# A.14 IMS MT SMS / 5GS
##### Expected sequence {#expected-sequence-17 .H6}
* * *
Step Direction Message/Procedure Comment  
UE SS  
1 \ 200 OK UE responds with 200 OK  
3 -> SIP MESSAGE UE sends a SIP MESSAGE request including a vnd.3gpp.sms
payload that contains a delivery report  
4 \ INVITE or UPDATE UE sends INVITE or UPDATE with a SDP offer to hold or
resume the call  
2 \ ACK Conditional: If the UE sent INVITE in step 1 then UE acknowledges the
receipt of 200 OK for INVITE
##### Specific Message Contents {#specific-message-contents-110 .H6}
##### INVITE or UPDATE (Step 1) {#invite-or-update-step-1 .H6}
Use the default message "INVITE for MO call setup" in Annex A.2.1 of TS
34.229-1 [2] applying conditions A1, A3, A5 and A28 or "UPDATE" in Annex A.2.5
applying conditions A1 and A6 of TS 34.229-1 [2]. In case of an INVITE the UE
shall use also the same URI in the request line as the SS has sent in the
Contact header of an earlier message within the same dialog (in case of an
UPDATE ref. to A.2.5 of TS 34.229-1 [2]).
The UE shall include support for precondition in the Supported header field.
The UE shall include an SDP body as described in A.4.1a, Step 6, (respectively
Step 6 of A.15.1a, for holding a video call), but with the following
exceptions and clarifications:
\- the sess-version number of the SDP shall be incremented by one; and
\- the direction-tag for the current-status remote segment shall be
\"sendrecv\"; and
\- the UE shall either add a session level direction attribute (and remove the
direction attributes of all the media lines) or modify the direction
attributes of all the media lines as follows:
\- in case of Call Hold
\- If the directionality of the media lines were originally as \"recvonly\"
then the directionality attributes within the INVITE in step 1 shall be
\"inactive\"
\- If the directionality of the media lines were originally as \"sendrecv\"
then the directionality attributes within the INVITE in step 1 shall be
\"sendonly\"
\- in case of Call Resume
\- the UE shall restore the value of the directionality attributes within the
SDP body their original values (the UE may use either a single session level
attribute or separate attributes for each media line).
##### 100 Trying for INVITE (Step 2) optional step used when UE sent INVITE in
step 1 {#trying-for-invite-step-2-optional-step-used-when-ue-sent-invite-in-
step-1 .H6}
Use the default message "100 Trying for INVITE" in Annex A.2.2 of TS 34.229-1
[2], applying condition A1.
##### 200 OK for INVITE or UPDATE (Step 3) {#ok-for-invite-or-update-step-3
.H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying conditions A1, A10 and A19, with
the following exceptions:
+--------------------+------------------------------------------------+ | Header/param | Value/remark | +====================+================================================+ | **Require** | | +--------------------+------------------------------------------------+ | option-tag | _precondition_ | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | SDP body of the 200 OK response copied from | | | the received INVITE or UPDATE but modified as | | | follows: | | | | | | - \"o=\" line identical to previous SDP sent | | | by SS except that sess-version is incremented | | | by one | | | | | | - IP address on \"c=\" line and transport | | | port on \"m=\" lines changed to indicate to | | | which IP address and port the UE should send | | | the media; and | | | | | | In case of Call Hold: | | | | | | - \"sendonly\" direction attribute inverted | | | to \"recvonly\". | | | | | | Note that this applies to "a=sendonly" | | | direction attributes only, not to the | | | direction tags found in preconditions. | +--------------------+------------------------------------------------+
##### ACK (Step 4) conditional step used when UE sent INVITE in step 1 {#ack-
step-4-conditional-step-used-when-ue-sent-invite-in-step-1 .H6}
Use the default message "ACK" in Annex A.2.7 of 34.229-1 [2], applying
conditions A1, A3 and A5.
# A.18 Putting a MTSI speech call to hold or to resume the call from the SS /
5GS
Expected sequence
Step Direction Message Comment
* * *
         UE          SS
1 \ 100 Trying Optional: The UE responds with a 100 Trying provisional
response  
3 -> 200 OK The UE responds to INVITE with 200 OK to indicate that the UE is
no more sending any media (call hold) or resumes sending media (call resume)  
4 \ ACK The UE acknowledges the receipt of 200 OK for INVITE  
EXCEPTION: steps 10--13 describe optional behaviour depending on UE
configuration. The SS shall wait up to 3s for the SUBSCRIBE of step 10  
10 -> SUBSCRIBE UE subscribes the conference event  
11 \ 200 OK UE responds to the NOTIFY
##### Specific Message Contents {#specific-message-contents-112 .H6}
The specific message contents for steps 1--7 is otherwise identical to what
have been specified in Annex A.4.1a, but with the exceptions as below:
##### INVITE (Step 1) {#invite-step-1-16 .H6}
Header/param Value/remark
* * *
**Request-Line**  
Request-URI _sip:mmtel\@conf-factory_ appended with **px_IMS_HomeDomainName**
**To**  
addr-spec _sip:mmtel\@conf-factory_ appended with **px_IMS_HomeDomainName**
##### 183 Session in Progress for INVITE (Step 3) {#session-in-progress-for-
invite-step-3 .H6}
+------------------+--------------------------------------------------+ | Header/param | Value/remark | +==================+==================================================+ | **Contact** | | +------------------+--------------------------------------------------+ | addr-spec | _[sip:temporary\@conf-factory]{.underline}_. | | | appended with **px_IMS_HomeDomainName** | +------------------+--------------------------------------------------+ | feature-param | _isfocus_ | +------------------+--------------------------------------------------+ | **Record-Route** | | +------------------+--------------------------------------------------+ | rec-route | \, | | | | | | \ | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-14 .H6}
Header/param Value/remark
* * *
**Require** (present, if Message-Body is present) option-tag _precondition_
**Message-body** (if present, shall be the same as message body in UPDATE at
step 6 of Annex A.4.1a)
##### 200 OK for PRACK (Step 5) {#ok-for-prack-step-5-7 .H6}
+--------------------+------------------------------------------------+ | Header/param | Value/remark | +====================+================================================+ | **Require** | (present, if Message-Body is present) | +--------------------+------------------------------------------------+ | option-tag | _precondition_ | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | (present, if SDP message-Body was present in | | | PRACK at step 4) | +--------------------+------------------------------------------------+ | | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | (present if SDP message-Body was present in | | | PRACK at step 4) | +--------------------+------------------------------------------------+ | value | length of message body | +--------------------+------------------------------------------------+ | **Message-body** | (present, if SDP message-Body was present in | | | PRACK at step 4) | | | | | | same as message body in 200 OK for UPDATE at | | | step 7 of Annex A.4.1a | +--------------------+------------------------------------------------+ | | | +--------------------+------------------------------------------------+
##### 200 OK for INVITE (Step 8) {#ok-for-invite-step-8 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying conditions A1 and A5 with the
following exceptions:
Header/param Value/remark
* * *
**Record-Route**  
rec-route Same value as in the 183 response **Contact**  
addr-spec _sip:final\@conf-factory_. appended with px_IMS_HomeDomainName
feature-param _Isfocus_
##### ACK (Step 9) {#ack-step-9 .H6}
Use the default message "ACK" in Annex A.2.7 of TS 34.229-1 [2], applying
conditions A1 and A3, with the following exceptions:
Header/param Value/remark
* * *
**Request-Line**  
Request-URI _[sip:final\@conf-factory]{.underline}_. appended with
**px_IMS_HomeDomainName**
##### SUBSCRIBE (Step 10) {#subscribe-step-10 .H6}
Use the default message "SUBSCRIBE for conference event package" in Annex
A.5.1 of TS 34.229-1 [2], applying conditions A1 and A7.
##### 200 OK (Step 11) {#ok-step-11-4 .H6}
Use the default message "200 OK for SUBSCRIBE" in Annex A.5.2 of TS 34.229-1
[2], applying condition A1.
##### NOTIFY (Step 12) {#notify-step-12 .H6}
Use the default message "MT NOTIFY for conference event package" in Annex
A.5.3 of TS 34.229-1 [2], applying condition A3.
##### 200 OK (Step 13) {#ok-step-13 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying conditions A5 and A22.
# A.20 Inviting user to conference by sending a REFER request to the
conference focus / 5GS
##### Expected sequence {#expected-sequence-26 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 --> REFER UE sends REFER to SS referring to the conference  
2 \ 200 OK The UE responds the NOTIFY with 200 OK  
5 \ 200 OK The UE responds the NOTIFY with 200 OK  
7 \ 200 OK Conditional: The UE responds the NOTIFY with 200 OK
##### Specific Message Contents {#specific-message-contents-113 .H6}
##### REFER (Step 1) {#refer-step-1 .H6}
Use the default message "MO REFER" in Annex A.2.10 of TS 34.229-1[2], applying
conditions A1 and A5, with the following exceptions:
+-----------------+---------------------------------------------------+ | Header/param | Value/remark | +=================+===================================================+ | **Request-URI** | _sip:final\@conf-factory._ appended with | | | px_IMS_HomeDomainName | +-----------------+---------------------------------------------------+ | **Refer-To** | SIP URI or tel URI of the user invited to the | | | conference. If an active session exists, the | | addr-spec | Replaces header in the header portion of the SIP | | | URI shall be included (mandatory inclusion is | | | stated in NG.114 [31]) and set to the dialog ID | | | of the active session according to RFC 3891 | | | [40]. In this case, if the user has been | | | invited with a tel URI, the UE shall convert the | | | tel URI to a SIP URI according to RFC 3261 [6] | | | clause 19.1.6. In addition, a Require header | | | field with option tag "replaces" may be included | | | according to RFC 3891 clause 6.2. | | | | | | (NOTE: the dialog ID is percent encoded according | | | to RFC 3986 [41]). | +-----------------+---------------------------------------------------+ | **Route** | URIs of the Record-Route header of 183 response | | | sent in step 4 of A.16 in reverse order | | route-param | | +-----------------+---------------------------------------------------+
##### NOTIFY (Step 3) {#notify-step-3 .H6}
Use the default message "MT NOTIFY for refer package" in Annex A.2.11 of TS
34.229-1 [2], applying condition A1, with the following exceptions:
Header/param Value/remark
* * *
**Message-body** _SIP/2.0 100 Trying_
##### NOTIFY (Step 5) {#notify-step-5 .H6}
Use the default message "MT NOTIFY for refer package" in Annex A.2.11 of TS
34.229-1 [2], applying condition A1, with the following exceptions:
Header/param Value/remark
* * *
**Subscription-State**  
substate-value _terminated_ expires omitted from the request reason
_noresource_ **Message-body** _SIP/2.0 200 OK_
##### NOTIFY (Step 7) {#notify-step-7-1 .H6}
Use the default message "NOTIFY for conference event package" in Annex A.5.3
of TS 34.229-1 [2], applying conditions A1 and A3, with the following
exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/remark | +==================+==================================================+ | **Message-body** | _\ _ | | | | | | _\ _ | | | | | | _entity=\"sip:final\@conf-factory._ appended | | | with px_IMS_HomeDomainName _\"_ | | | | | | _state=\"partial\"_ | | | | | | _version=\"_ value as in previous notification | | | for conference event package but incremented by | | | one _\"_ | | | | | | _\ _ | | | | | | _\ _ | | | | | | _\ _ | | | | | | _\ connected\_ | | | | | | _\ dialed-in\_ | | | | | | _\ _ | | | | | | _\ audio\_ | | | | | | _\  unique identifier for the media | | | stream between the focus and the endpoint of the | | | invited user (e.g. 11223)\_ | | | | | | _\ random SSRC value\_ | | | | | | _\ sendrecv\_ | | | | | | _\ _ | | | | | | _\ _ | | | | | | _\ _ | | | | | | _\ _ | +------------------+--------------------------------------------------+
# A.21 Activation and deactivation of Supplementary Services / 5GS
Generic test procedure for signalling between UE and XCAP server to activate
or deactivate a supplementary service.
##### Test procedure: {#test-procedure-1 .H6}
0a) Pre-configurations:
\- The UE is in state 3N-A, registered to IMS on an IMS PDU session and at
least one PDU session for Internet active according to TS 38.508-1 [21],
clause 4.5.3.
NOTE: All XCAP signalling shall occur on the Internet PDU session according to
NG.114 [31], Annex C.3. It is recommended that px_MobileDataOn (TS 36.523-3
[53]) is set to false when executing test cases using this generic test
procedure.
0b) At the SS an HTTP server is established at port 80 to simulate the XCAP
server.
NOTE: TLS is not a test requirement i.e. the UE uses port 80 to access XCAP
and BSF servers and SS does not redirect the UE to use HTTPS (port 443).
1) Activation of the specific Supplementary Service is triggered at the UE
with appropriate MMI command.
2) The UE sends an initial HTTP request to the SS.
3) In case of HTTP Digest XCAP authentication when the UE does not provide
correct authorization credentials within its initial request:
3a) the SS shall challenge the UE by sending a "401 Unauthorized" response to
it.\ When the UE supports GBA for XCAP authentication and GBA shall be used
according to test requirements or test configuration, the SS shall indicate
bootstrapped security association is required as specified in TS 24.109 [43]
clause 5.2.4 and the generic procedure A.22 shall be applied.
3b) the UE repeats the HTTP request including a valid digest response in the
authorization header.\ The SS shall check the digest response taking into
account the user's prearranged password for (pure) HTTP digest authentication,
or, for GBA, being derived from the key material (Ks) using key derivation
function as specified in 3GPP TS 33.220 [44].
4) The SS sends a 200 (OK) response
5) Optionally UE and SS exchange a sequence of additional HTTP requests and
responses. In this sequence the UE may query the contents of the simservs
document or selected parts of it.\ In general the HTTP requests are responded
with a 200 "Ok" response but in case of a GET request to a non-existing node
the SS shall respond with a 404 "File Not Found".
6) The simservs document is checked according to specific test requirements.
7) Deactivation of supplementary service is triggered at the UE with
appropriate MMI command.
8) UE and SS exchange a sequence of HTTP requests and responses. In this
sequence the UE may query the contents of the simservs document or selected
parts of it.\ In general the HTTP requests are responded with a 200 "Ok"
response but in case of a GET request to a non-existing node the SS shall
respond with a 404 "File Not Found".
9) The simservs document is checked according to specific test requirements.
##### Expected sequence: {#expected-sequence-27 .H6}
+-----------------+-----------+-----------------+-----------------+---+ | Step | Direction | Me | Comment | | | | | ssage/Procedure | | | +=================+===========+=================+=================+===+ | | UE | SS | | | +-----------------+-----------+-----------------+-----------------+---+ | 1 | | Make the UE | | | | | | attempt | | | | | | activation of | | | | | | supplementary | | | | | | service | | | +-----------------+-----------+-----------------+-----------------+---+ | 2 | | Initial HTTP | NOTE 1 | | | | | Request | | | +-----------------+-----------+-----------------+-----------------+---+ | 3 | | EXCEPTION: | | | | | | steps 3a and 3b | | | | | | describe | | | | | | behaviour in | | | | | | case of HTTP | | | | | | Digest XCAP | | | | | | authentication | | | | | | when the UE | | | | | | does not | | | | | | provide correct | | | | | | authorization | | | | | | credentials | | | | | | within its | | | | | | initial request | | | +-----------------+-----------+-----------------+-----------------+---+ | 3a | | HTTP Response: | | | | | | "401 | | | | | | Unauthorized" | | | +-----------------+-----------+-----------------+-----------------+---+ | | | EXCEPTION: | (optional) GBA | | | | | | authentication | | | | | By default, | at BSF server | | | | | when the UE | | | | | | supports GBA | | | | | | for XCAP | | | | | | authentication, | | | | | | GBA shall be | | | | | | used according | | | | | | to the generic | | | | | | test procedure | | | | | | A.22. | | | | | | | | | | | | NOTE: See TS | | | | | | 34.229-2 [3] | | | | | | for cases where | | | | | | the default | | | | | | does not apply. | | | +-----------------+-----------+-----------------+-----------------+---+ | 3b | | HTTP Request | The SS checks | | | | | with valid | the digest | | | | | authorization | response | | | | | credentials | | | +-----------------+-----------+-----------------+-----------------+---+ | 4 | | HTTP Response: | | | | | | "200 OK" | | | +-----------------+-----------+-----------------+-----------------+---+ | 5 | | EXCEPTION: | | | | | | steps 5a and 5b | | | | | | describe | | | | | | further | | | | | | optional | | | | | | message | | | | | | exchange | | | | | | between the UE | | | | | | and the SS; | | | | | | | | | | | | steps 5a and | | | | | | steps 5b can be | | | | | | repeated | | | | | | several times | | | | | | | | | | | | this exchange | | | | | | of information | | | | | | is considered | | | | | | to be finished | | | | | | when there is | | | | | | no further HTTP | | | | | | request sent by | | | | | | the UE within | | | | | | 20 seconds | | | | | | after the | | | | | | previous | | | | | | request | | | +-----------------+-----------+-----------------+-----------------+---+ | 5a | | HTTP Request | NOTE 1 | | +-----------------+-----------+-----------------+-----------------+---+ | 5b | | HTTP Response: | NOTE 3 | | | | | "200 OK" or | | | | | | "404 File Not | | | | | | Found" | | | +-----------------+-----------+-----------------+-----------------+---+ | 6 | | Check: Does the | This is done by | | | | | simservs | fetching the | | | | | document stored | whole simservs | | | | | in the SS | document from | | | | | contain the | the XCAP server | | | | | information | and checking | | | | | supplied by the | its content | | | | | UE as required | against the | | | | | by the test | respective XML | | | | | requirements of | file (according | | | | | the specific | to the XSD | | | | | test case? | definitions for | | | | | | the respective | | | | | | supplementary | | | | | | service) | | +-----------------+-----------+-----------------+-----------------+---+ | 7 | | Make the UE | | | | | | attempt | | | | | | deactivation of | | | | | | supplementary | | | | | | service | | | +-----------------+-----------+-----------------+-----------------+---+ | 8 | | EXCEPTION: | | | | | | steps 8a and 8b | | | | | | describe the | | | | | | mandatory | | | | | | message | | | | | | exchange | | | | | | between the UE | | | | | | and the SS | | | | | | which can be | | | | | | repeated | | | | | | several times; | | | | | | | | | | | | this exchange | | | | | | of information | | | | | | is considered | | | | | | to be finished | | | | | | when there is | | | | | | no further HTTP | | | | | | request sent by | | | | | | the UE within | | | | | | 20 seconds | | | | | | after the | | | | | | previous | | | | | | request | | | +-----------------+-----------+-----------------+-----------------+---+ | 8a | | HTTP Request | NOTE 1 | | +-----------------+-----------+-----------------+-----------------+---+ | 8b | | HTTP Response: | NOTE 3 | | | | | "200 OK" or | | | | | | "404 File Not | | | | | | Found" | | | +-----------------+-----------+-----------------+-----------------+---+ | 9 | | Check: Does the | This is done by | | | | | simservs | fetching the | | | | | document stored | whole simservs | | | | | in the SS | document from | | | | | contain the | the XCAP server | | | | | information | and checking | | | | | supplied by the | its content | | | | | UE as required | against the | | | | | by the test | respective XML | | | | | requirements of | file (according | | | | | the specific | to the XSD | | | | | test case? | definitions for | | | | | | the respective | | | | | | supplementary | | | | | | service) | | +-----------------+-----------+-----------------+-----------------+---+ | NOTE 1: The | | | | | | HTTP requests | | | | | | sent by the UE | | | | | | are processed | | | | | | by an XCAP | | | | | | server | | | | | | implementation | | | | | | at the SS to | | | | | | modify or query | | | | | | the contents of | | | | | | the simservs | | | | | | document. | | | | | | | | | | | | NOTE 2: Void. | | | | | | | | | | | | NOTE 3: "404 | | | | | | File Not Found" | | | | | | is sent as | | | | | | response for a | | | | | | GET request to | | | | | | a non-existing | | | | | | node | | | | | +-----------------+-----------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-114 .H6}
##### HTTP Requests sent by the UE (step 2, 3b, 5a, 8a) {#http-requests-sent-
by-the-ue-step-2-3b-5a-8a .H6}
+-----------------+--------+-----------------+-----+-----------------+ | Header/param | Cond | Value/remark | Rel | Reference | +=================+========+=================+=====+=================+ | * | | | | RFC 2616 [46] | | _Request-Line_ _| | | | | +-----------------+--------+-----------------+-----+-----------------+ | Method | |_ GET, PUT, | | | | | | DELETE _| | | +-----------------+--------+-----------------+-----+-----------------+ | Request-URI | | XCAP URI | | | | | | referring to | | | | | | the simservs | | | | | | document as | | | | | | specified in | | | | | | RFC 4825 | | | | | | [45]; the | | | | | | document | | | | | | selector of | | | | | | such XCAP URI | | | | | | consists of | | | | | | | | | | | | - Configured | | | | | | XCAP root URI | | | | | | | | | | | |_ \- | | | | | | simserv | | | | | | s.ngn.etsi.org _| | | | | | | | | | | |_ \- users _| | | | | | | | | | | | - same public | | | | | | user id as the | | | | | | default public | | | | | | user identity | | | | | | received in | | | | | | P | | | | | | -Associated-URI | | | | | | header in 200 | | | | | | OK for REGISTER | | | | | | (NOTE 4). | | | | | | | | | | | |_ \- | | | | | | simservs.xml _| | | | | | | | | | | | (in this order, | | | | | | separated by a | | | | | | slash); | | | | | | | | | | | | According to | | | | | | RFC 4825 [45] | | | | | | the node | | | | | | selector of the | | | | | | XCAP URI shall | | | | | | identify a | | | | | | valid part of a | | | | | | simservs | | | | | | document or | | | | | | whole document | | | | | | itself (NOTE | | | | | | 2). | | | +-----------------+--------+-----------------+-----+-----------------+ | Version | |_ HTTP 1.1 _| | | +-----------------+--------+-----------------+-----+-----------------+ |__User-Agent_ _| A1 | | | RFC 2616 [46] | +-----------------+--------+-----------------+-----+-----------------+ | Product token | |_ 3gpp-gba _| | TS 24.109 | | | | | | [43] | +-----------------+--------+-----------------+-----+-----------------+ | ** | | present in case | | RFC 2617 [16] | | Authorization_ _| | of HTTP Digest | | | | | | XCAP | | RFC 3310 [17] | | | | authentication | | | | | | in the initial | | | | | | request or in | | | | | | the request | | | | | | following the | | | | | | "401 | | | | | | Unauthorized" | | | | | | response | | | | | | | | | | | |_ Digest _| | | +-----------------+--------+-----------------+-----+-----------------+ | username | NOT A2 | As configured | | | | | | in the UE (NOTE | | | | | | 5). | | | | | | | | | | | | Same public | | | | | | user id as the | | | | | | default public | | | | | | user identity | | | | | | received in | | | | | | P | | | | | | -Associated-URI | | | | | | header in 200 | | | | | | OK for REGISTER | | | | | | (NOTE 6). | | | +-----------------+--------+-----------------+-----+-----------------+ | username | A2 | B-TID as | | | | | | obtained from | | | | | | GBA | | | | | | authentication | | | +-----------------+--------+-----------------+-----+-----------------+ | realm | | same value as | | | | | | received in the | | | | | | realm directive | | | | | | in the WWW | | | | | | Authenticate | | | | | | header sent by | | | | | | SS | | | +-----------------+--------+-----------------+-----+-----------------+ | nonce | | same value as | | | | | | in | | | | | | W | | | | | | WW-Authenticate | | | | | | header sent by | | | | | | SS | | | +-----------------+--------+-----------------+-----+-----------------+ | opaque | | same value as | | | | | | sent by the SS | | | | | | in "401 | | | | | | Unauthorized" | | | +-----------------+--------+-----------------+-----+-----------------+ | digest-uri | | same URI as | | | | | | used in | | | | | | Request-URI | | | +-----------------+--------+-----------------+-----+-----------------+ | qop-value | |_ auth _| | | +-----------------+--------+-----------------+-----+-----------------+ | cnonce-value | | value assigned | | | | | | by UE affecting | | | | | | the response | | | | | | calculation | | | +-----------------+--------+-----------------+-----+-----------------+ | nonce-count | | 1 | | | +-----------------+--------+-----------------+-----+-----------------+ | response | NOT A2 | response | | | | | | calculated by | | | | | | UE using | | | | | | prearranged | | | | | | password | | | +-----------------+--------+-----------------+-----+-----------------+ | response | A2 | response | | | | | | calculated by | | | | | | UE using | | | | | | password | | | | | | derived from | | | | | | the key | | | | | | material of the | | | | | | GBA | | | | | | authentication | | | | | | according to | | | | | | Generic key | | | | | | derivation as | | | | | | specified in | | | | | | Annex B.3 of TS | | | | | | 33.220 [44] | | | | | | using static | | | | | | string "gba-me" | | | | | | as parameter P0 | | | | | | in Annex B.3. | | | +-----------------+--------+-----------------+-----+-----------------+ | algorithm | |_ MD5 _| | | +-----------------+--------+-----------------+-----+-----------------+ | * | | present for | | RFC 2616 [46] | |_ Content-Type**| | HTTP PUT method | | | +-----------------+--------+-----------------+-----+-----------------+ | media-type | |_appl | | | | | | ication/vnd.ets | | | | | | i.simservs+xml_ | | | | | | or | | | | | | | | | | | | _applicati | | | | | | on/xcap-el+xml_ | | | | | | or | | | | | | | | | | | | _applicatio | | | | | | n/xcap-att+xml_ | | | | | | (NOTE 3) | | | +-----------------+--------+-----------------+-----+-----------------+ | * | | present for | | RFC 2616 [46] | | *Message-body** | | HTTP PUT | | | | | | method: | | RFC 4825 [45] | | | | | | | | | | XML fragment of | | | | | | given node | | | +-----------------+--------+-----------------+-----+-----------------+ | NOTE 1: Any | | | | | | other headers | | | | | | are ignored. | | | | | | | | | | | | NOTE 2: The SS | | | | | | shall check and | | | | | | make sure that | | | | | | the syntax of | | | | | | the node | | | | | | selector | | | | | | expressions is | | | | | | in compliance | | | | | | to clause 6.2 | | | | | | of RFC 4825 | | | | | | [45]. | | | | | | | | | | | | NOTE 3: the | | | | | | media-type | | | | | | depends on the | | | | | | kind of node | | | | | | being accessed | | | | | | by the | | | | | | Request-URI: | | | | | | document, | | | | | | element or | | | | | | attribute (see | | | | | | RFC 4825 | | | | | | [45]). | | | | | | | | | | | | NOTE 4: | | | | | | According | | | | | | A.12/38 3GPP TS | | | | | | 34.229-2 [3]. | | | | | | | | | | | | NOTE 5: Shall | | | | | | be present if | | | | | | A.12/37 3GPP TS | | | | | | 34.229-2 [3] | | | | | | is yes. | | | | | | | | | | | | NOTE 6: Shall | | | | | | be present if | | | | | | A.12/37 3GPP TS | | | | | | 34.229-2 [3] | | | | | | is no. | | | | | +-----------------+--------+-----------------+-----+-----------------+
Condition Explanation
* * *
A1 UE supports GBA authentication A2 GBA authentication shall be applied
(according to test requirements or test configuration)
##### HTTP Responses (step 4, 5b, 8b2) -- normal case {#http-responses-
step-4-5b-8b2-normal-case .H6}
+------------------+------+------------------+-----+-----------------+ | Header/param | Cond | Value/remark | Rel | Reference | +==================+======+==================+=====+=================+ | **Status-Line** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | Version | | _HTTP 1.1_ | | | +------------------+------+------------------+-----+-----------------+ | Code | | _200_ | | | +------------------+------+------------------+-----+-----------------+ | Reason | | _OK_ | | | +------------------+------+------------------+-----+-----------------+ | **Server** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | product | | _XCAP-Server_ | | | +------------------+------+------------------+-----+-----------------+ | **Date** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | HTTP-date | | valid date | | | | | | according to | | | | | | RFC 2616 [46] | | | | | | section 3.3.1 | | | +------------------+------+------------------+-----+-----------------+ | **ETag** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | entity-tag | | hextring: value | | | | | | starting with | | | | | | \ | | | | | | "478fb2358f700\" | | | | | | and incremented | | | | | | after each PUT | | | | | | operation | | | +------------------+------+------------------+-----+-----------------+ | **Content-Type** | | present for HTTP | | RFC 2616 [46] | | | | GET method | | | +------------------+------+------------------+-----+-----------------+ | media-type | | _ap | | | | | | plication/vnd.et | | | | | | si.simservs+xml_ | | | | | | or | | | | | | | | | | | | _applicat | | | | | | ion/xcap-el+xml_ | | | | | | or | | | | | | | | | | | | _applicati | | | | | | on/xcap-att+xml_ | | | | | | (NOTE 1) | | | +------------------+------+------------------+-----+-----------------+ | ** | | | | RFC 2616 [46] | | Content-Length**| | | | | +------------------+------+------------------+-----+-----------------+ | value | | length of the | | | | | | message body | | | +------------------+------+------------------+-----+-----------------+ |** Message-body** | | present for GET | | RFC 2616 [46] | | | | method: | | | | | | | | RFC 4825 [45] | | | | XML fragment of | | | | | | given node | | | +------------------+------+------------------+-----+-----------------+ | NOTE 1: the | | | | | | media-type | | | | | | depends on the | | | | | | kind of node | | | | | | being accessed | | | | | | with the HTTP | | | | | | GET method: | | | | | | document, | | | | | | element or | | | | | | attribute (see | | | | | | RFC 4825 | | | | | | [45]). | | | | | +------------------+------+------------------+-----+-----------------+
##### HTTP Responses (step 5b, 8b) -- Response for GET request to a non-
existing node {#http-responses-step-5b-8b-response-for-get-request-to-a-non-
existing-node .H6}
Header/param Cond Value/remark Rel Reference
* * *
**Status-Line** RFC 2616 [46] Version _HTTP 1.1_  
Code _404_  
Reason _File Not Found_  
**Server** RFC 2616 [46] product _XCAP-Server_  
**Date** RFC 2616 [46] HTTP-date valid date according to RFC 2616 [46] section
3.3.1
##### HTTP Response (step 3a) for HTTP Digest XCAP authentication {#http-
response-step-3a-for-http-digest-xcap-authentication .H6}
+-----------------+--------+-----------------+-----+-----------------+ | Header/param | Cond | Value/remark | Rel | Reference | +=================+========+=================+=====+=================+ | **Status-Line** | | | | RFC 2616 [46] | +-----------------+--------+-----------------+-----+-----------------+ | Version | | _HTTP 1.1_ | | | +-----------------+--------+-----------------+-----+-----------------+ | Code | | _401_ | | | +-----------------+--------+-----------------+-----+-----------------+ | Reason | | _Unauthorized_ | | | +-----------------+--------+-----------------+-----+-----------------+ | **Server** | | | | RFC 2616 [46] | +-----------------+--------+-----------------+-----+-----------------+ | product | | _XCAP-Server_ | | | +-----------------+--------+-----------------+-----+-----------------+ | **Date** | | | | RFC 2616 [46] | +-----------------+--------+-----------------+-----+-----------------+ | HTTP-date | | valid date | | | | | | according to | | | | | | RFC 2616 [46] | | | | | | section 3.3.1 | | | +-----------------+--------+-----------------+-----+-----------------+ | **WWW | | | | RFC 2616 [46] | | -Authenticate** | | | | | +-----------------+--------+-----------------+-----+-----------------+ | realm | NOT A1 | home domain | | | | | | name as stored | | | | | | in EF~DOMAIN~ | | | | | | or home domain | | | | | | name derived | | | | | | from the IMSI | | | +-----------------+--------+-----------------+-----+-----------------+ | realm | A1 | containing two | | | | | | parts delimited | | | | | | by \"@\" (see | | | | | | TS 24.109 | | | | | | [43] clause | | | | | | 5): | | | | | | | | | | | | - _3GPP | | | | | | -bootstrapping_ | | | | | | | | | | | | - home domain | | | | | | name as | | | | | | stored in | | | | | | EF~DOMAIN~ | | | | | | or home | | | | | | domain name | | | | | | derived | | | | | | from the | | | | | | IMSI | | | +-----------------+--------+-----------------+-----+-----------------+ | algorithm | | _MD5_ | | | +-----------------+--------+-----------------+-----+-----------------+ | qop-value | | _auth_ | | | +-----------------+--------+-----------------+-----+-----------------+ | nonce | | Base 64 | | | | | | encoding of | | | | | | RAND and AUTN | | | +-----------------+--------+-----------------+-----+-----------------+ | opaque | | arbitrary value | | | | | | (to be returned | | | | | | by the UE in | | | | | | subsequent | | | | | | request) | | | +-----------------+--------+-----------------+-----+-----------------+
Condition Explanation
* * *
A1 UE supports GBA authentication and GBA authentication shall be applied
(according to test requirements or test configuration)
# A.22 GAA XCAP authentication
The generic test procedure for GBA authentication between UE and BSF.
The generic test procedure for GAA XCAP authentication is referred to the
bootstrapping procedure in TS 33.220 [44], clause 4.5.2 and TS 24.109 [43]
clause 4.2.
##### Test procedure: {#test-procedure-2 .H6}
0a) Pre-configurations:\ The UE may resolve the IP address for the BSF server
via DNS.
0b) At the SS an HTTP server is established at port 80 to simulate the BSF
server.
> 1) UE sends initial GET to the BSF server.
>
> 2) BSF server responds with "401 Unauthorized".
>
> 3) UE sends GET with Authorization header to the BSF server.
>
> 4) BSF server responds with \"200 OK\" when the UE has provided a valid
> Authorization header.
##### Expected sequence: {#expected-sequence-28 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 HTTP Request  
2 HTTP Response: "401 Unauthorized"  
3 HTTP Request with valid authorization credentials  
4 HTTP Response: "200 OK"
##### Specific Message Contents {#specific-message-contents-115 .H6}
##### HTTP Request (step 1) {#http-request-step-1 .H6}
+------------------+------+------------------+-----+------------------+ | Header/param | Cond | Value/remark | Rel | Reference | +==================+======+==================+=====+==================+ | **Request-Line** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+------------------+ | Method | | _GET_ | | | +------------------+------+------------------+-----+------------------+ | Request-URI | | Request-URI | | | +------------------+------+------------------+-----+------------------+ | Version | | _HTTP/_ | | | | | | DIGIT.DIGIT | | | +------------------+------+------------------+-----+------------------+ | **Host** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+------------------+ | host | | * | | | | | | bsf._mnc\ . | | | | | | mcc\_.pub. | | | | | | 3gppnetwork.org _| | | | | | (when no ISIM | | | | | | available on the | | | | | | UICC), | | | | | | optionally | | | | | | followed by port | | | | | | 80 | | | | | | | | | | | | or | | | | | | | | | | | |_ bsf._domain | | | | | | name (when using | | | | | | ISIM) , | | | | | | optionally | | | | | | followed by port | | | | | | 80 | | | +------------------+------+------------------+-----+------------------+ |__User-Agent_ _| | | | RFC 2616 [46] | +------------------+------+------------------+-----+------------------+ | Product token | |_ 3gpp-gba-tmpi _| | TS 24.109 [43] | +------------------+------+------------------+-----+------------------+ | * | |_ Digest _| | RFC 2616 [46] | |_ Authorization __| | | | | | | | | | RFC 2617 [23] | | | | | | | | | | | | RFC 3310 [47] | +------------------+------+------------------+-----+------------------+ | | | | | | +------------------+------+------------------+-----+------------------+ | username | | private user | | | | | | identity as | | | | | | stored in | | | | | | EF~IMPI~ (when | | | | | | using ISIM) | | | | | | | | | | | | or | | | | | | | | | | | | private user | | | | | | identity derived | | | | | | from IMSI (when | | | | | | no ISIM | | | | | | available on the | | | | | | UICC) | | | | | | | | | | | | or | | | | | | | | | | | | the value of the | | | | | | TMPI if one has | | | | | | been associated | | | | | | with the private | | | | | | user identity as | | | | | | described in | | | | | | 3GPP TS 33.220 | | | | | | [44] | | | +------------------+------+------------------+-----+------------------+ | | | | | | +------------------+------+------------------+-----+------------------+ | realm | | * | | | | | | bsf_.mnc\. | | | | | | mcc\_.pub. | | | | | | 3gppnetwork.org _| | | | | | (when no ISIM | | | | | | available on the | | | | | | UICC) | | | | | | | | | | | | or | | | | | | | | | | | |_ bsf.*domain | | | | | | name (when using | | | | | | ISIM) | | | +------------------+------+------------------+-----+------------------+ | nonce | | empty value | | | +------------------+------+------------------+-----+------------------+ | digest-uri | | absoluteURL | | | | | | http://\/ | | | | | | | | | | | | or | | | | | | | | | | | | abs_path \"/\" | | | +------------------+------+------------------+-----+------------------+ | response | | empty value | | | +------------------+------+------------------+-----+------------------+
NOTE 1: All choices for applicable conditions are described for each header.
##### HTTP Response (step 2) {#http-response-step-2 .H6}
+------------------+------+------------------+-----+-----------------+ | Header/param | Cond | Value/remark | Rel | Reference | +==================+======+==================+=====+=================+ | **Status-Line** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | Version | | _HTTP/1.1_ | | | +------------------+------+------------------+-----+-----------------+ | Code | | _401_ | | | +------------------+------+------------------+-----+-----------------+ | Reason | | _Unauthorized_ | | | +------------------+------+------------------+-----+-----------------+ | **Server** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | product | | _BSF-Server_ | | | +------------------+------+------------------+-----+-----------------+ | **Date** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | HTTP-date | | valid date | | | | | | according to | | | | | | RFC 2616 [46] | | | | | | section 3.3.1 | | | +------------------+------+------------------+-----+-----------------+ | **WW | | | | RFC 2616 [46] | | W-Authenticate** | | | | | | | | | | RFC 2617 [23] | +------------------+------+------------------+-----+-----------------+ | challenge | | _Digest_ | | | +------------------+------+------------------+-----+-----------------+ | realm | | same value as | | | | | | received in step | | | | | | 1 | | | +------------------+------+------------------+-----+-----------------+ | algorithm | | _AKAv1-MD5_ | | | +------------------+------+------------------+-----+-----------------+ | qop-value | | _auth-int_ | | | +------------------+------+------------------+-----+-----------------+ | nonce | | Base 64 encoding | | | | | | of RAND and AUTN | | | +------------------+------+------------------+-----+-----------------+ | opaque | | _5 | | | | | | ccc069c403ebaf9f | | | | | | 0171e9517f30e41_ | | | +------------------+------+------------------+-----+-----------------+
##### HTTP Request (step 3) {#http-request-step-3 .H6}
+------------------+------+------------------+-----+-----------------+ | Header/param | Cond | Value/remark | Rel | Reference | +==================+======+==================+=====+=================+ | **Request-Line** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | Method | | _GET_ | | | +------------------+------+------------------+-----+-----------------+ | Request-URI | | Request-URI | | | +------------------+------+------------------+-----+-----------------+ | Version | | _HTTP/_ | | | | | | DIGIT.DIGIT | | | +------------------+------+------------------+-----+-----------------+ | **Host** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+-----------------+ | host | | * | | | | | | bsf._mnc\ . | | | | | | mcc\_.pub. | | | | | | 3gppnetwork.org _| | | | | | (when no ISIM | | | | | | available on the | | | | | | UICC), | | | | | | optionally | | | | | | followed by port | | | | | | 80 | | | | | | | | | | | | or | | | | | | | | | | | |_ bsf._domain | | | | | | name (when using | | | | | | ISIM), | | | | | | optionally | | | | | | followed by port | | | | | | 80 | | | +------------------+------+------------------+-----+-----------------+ | * | |_ Digest _| | RFC 2616 [46] | |_ Authorization __| | | | | | | | | | RFC 2617 [23] | | | | | | | | | | | | RFC 3310 [47] | +------------------+------+------------------+-----+-----------------+ | | | | | | +------------------+------+------------------+-----+-----------------+ | username | | private user | | | | | | identity as | | | | | | stored in | | | | | | EF~IMPI~ (when | | | | | | using ISIM) | | | | | | | | | | | | or | | | | | | | | | | | | private user | | | | | | identity derived | | | | | | from IMSI (when | | | | | | no ISIM | | | | | | available on the | | | | | | UICC) | | | | | | | | | | | | or | | | | | | | | | | | | the value of the | | | | | | TMPI if one has | | | | | | been associated | | | | | | with the private | | | | | | user identity as | | | | | | described in | | | | | | 3GPP TS 33.220 | | | | | | [44] | | | +------------------+------+------------------+-----+-----------------+ | | | | | | +------------------+------+------------------+-----+-----------------+ | realm | | same value as | | | | | | received in the | | | | | | realm directive | | | | | | in the WWW | | | | | | Authenticate | | | | | | header sent by | | | | | | SS | | | +------------------+------+------------------+-----+-----------------+ | opaque | |_ 5 | | | | | | ccc069c403ebaf9f | | | | | | 0171e9517f30e41_ | | | +------------------+------+------------------+-----+-----------------+ | digest-uri | | absoluteURL | | | | | | http://\/ | | | | | | | | | | | | or | | | | | | | | | | | | abs_path \"/\" | | | +------------------+------+------------------+-----+-----------------+ | cnonce-value | | value assigned | | | | | | by UE affecting | | | | | | the response | | | | | | calculation | | | +------------------+------+------------------+-----+-----------------+ | nonce-count | | _00000001_ | | | +------------------+------+------------------+-----+-----------------+ | response | | response | | | | | | calculated by UE | | | +------------------+------+------------------+-----+-----------------+ | algorithm | | _AKAv1-MD5_ | | | +------------------+------+------------------+-----+-----------------+
NOTE 1: All choices for applicable conditions are described for each header.
##### HTTP Response (step 4) {#http-response-step-4 .H6}
+------------------+------+------------------+-----+------------------+ | Header/param | Cond | Value/remark | Rel | Reference | +==================+======+==================+=====+==================+ | **Status-Line** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+------------------+ | Version | | _HTTP/1.1_ | | | +------------------+------+------------------+-----+------------------+ | Code | | _200_ | | | +------------------+------+------------------+-----+------------------+ | Reason | | _OK_ | | | +------------------+------+------------------+-----+------------------+ | **Server** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+------------------+ | Product token | | _3gpp-gba-tmpi_ | | | +------------------+------+------------------+-----+------------------+ | **Date** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+------------------+ | HTTP-date | | valid date | | | | | | according to | | | | | | RFC 2616 [46] | | | | | | section 3.3.1 | | | +------------------+------+------------------+-----+------------------+ | **Authe | | | | RFC 2616 [46] | | ntication-Info** | | | | | | | | | | RFC 2617 [23] | +------------------+------+------------------+-----+------------------+ | message-qop | | _qop=auth-int_ | | | +------------------+------+------------------+-----+------------------+ | rspauth | | see Note 1 | | | +------------------+------+------------------+-----+------------------+ | cnonce | | same value as | | | | | | received in step | | | | | | 3 | | | +------------------+------+------------------+-----+------------------+ | nc | | _1_ | | | +------------------+------+------------------+-----+------------------+ | | | | | | +------------------+------+------------------+-----+------------------+ | **Content-Type** | | | | RFC 2616 [46] | +------------------+------+------------------+-----+------------------+ | media-type | | _application/v | | | | | | nd.3gpp.bsf+xml_ | | | +------------------+------+------------------+-----+------------------+ | ** | | | | RFC 2616 [46] | | Content-Length**| | | | | +------------------+------+------------------+-----+------------------+ | value | | length of the | | | | | | message body | | | +------------------+------+------------------+-----+------------------+ |** Message-body __| |_ \_ | | C [43] | | | | | | | | | | _\ _ | | | | | | | | | | | | _\ _ | | | | | | B-TID _\ _ | | | | | | | | | | | | * | | | | | | \_key | | | | | | lifetim | | | | | | e_ \_| | | | | | | | | | | |_ \* | | | | | | | | | | | | with | | | | | | | | | | | | Â­ B-TID\ | | | | | | Bootstrapping - | | | | | | Transaction | | | | | | Identifier | | | | | | according to TS | | | | | | 33.220 [44] | | | | | | clause 4.5.2:\ | | | | | | base64encode(R | | | | | | AND)\@BSF_serve | | | | | | rs_domain_name | | | | | | | | | | | | - key lifetime\ | | | | | | lifetime of the | | | | | | key material | | | | | | formatted | | | | | | according to XSD | | | | | | dateTime data | | | | | | type | | | +------------------+------+------------------+-----+------------------+
NOTE 1: Rspauth is computed according to RFC 3310 and RFC 2617.
# A.23 eCall Setup and MSD Update / 5GS
##### Expected sequence {#expected-sequence-29 .H6}
Step Direction Message/Procedure Comment
* * *
         UE          SS
1 INVITE UE sends INVITE with initial MSD  
2 200 OK SS responds INVITE with 200 OK  
3 ACK UE responds ACK for 200 OK  
4 SIP INFO SS sends SIP INFO to request MSD update  
5 200 OK UE responds SIP INFO with 200 OK  
6 SIP INFO UE sends SIP INFO with MSD update  
7 200 OK SS responds SIP INFO with 200 OK.
##### Specific message contents: {#specific-message-contents-116 .H6}
##### INVITE (Step 1) {#invite-step-1-17 .H6}
Use the default message \"INVITE for MO Call Setup\" in Annex A.2.1 of TS
34.229-1 [2] applying condition A7 and condition A20 or A21 as indicated by
the test case and the following inclusion along with the applicable message
body of default message:
+------------------+--------------------------------------------------+ | Header/param | Value/remark | +==================+==================================================+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | - | | | | | | - _v=0_ | | | | | | - _o=_(username) (sess-id) (sess-version) IN | | | (addrtype) (unicast-address for UE) | | | | | | - _s=_(session name) | | | | | | - c=IN (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | **Time description:** | | | | | | - t= (start-time) (stop-time) | | | | | | **Media description:** | | | | | | - _m=audio_ (transport port) [Note 2] | | | | | | - _c=IN_ (addrtype) (connection-address for UE) | | | [Note 1] | | | | | | - _b=AS:_ (bandwidth-value) | | | | | | Note 1: At least one \"c=\" field shall be | | | present. | | | | | | Note 2: EVS codec shall be present in the media | | | attributes, optionally including channel number | | | \"/1\". | +------------------+--------------------------------------------------+
##### 200 OK for INVITE (Step 2) {#ok-for-invite-step-2 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2] with conditions A6, A12, (A13 OR A14) and
A22 and following inclusion along with the applicable message body of default
message:
+--------------------+------------------------------------------------+ | Header/param | Value/remark | +====================+================================================+ | **Content-Type** | _application/sdp_ | | | | | media-type | | +--------------------+------------------------------------------------+ | **Content-Length** | length of message-body | | | | | value | | +--------------------+------------------------------------------------+ | **Message-body** | The following SDP types and values. | | | | | | **Session description:** | | | | | | _v=0_ | | | | | | _o=- 1111111111 1111111111 IN (addrtype) | | | (unicast-address for SS)_ | | | | | | _s=-_ | | | | | | _c=IN (addrtype) (connection-address for SS)_ | | | | | | _b=AS:37_ | | | | | | **Time description:** | | | | | | _t=0 0_ | | | | | | **Media description:** | | | | | | _m=audio_ (_transport port) RTP/AVP (fmt) | | | [Note 1]_ | | | | | | _b=AS:37_ | | | | | | _b=RS:0_ | | | | | | _b=RR:0_ | | | | | | **Attributes for media:** | | | | | | _a=rtpmap:_ **(**_payload type) EVS/16000/1 | | | [Note 1]_ | | | | | | _a=fmtp: (format) mode-change-capability=2; | | | max-red=220_ | | | | | | _a=ptime:20_ | | | | | | _a=maxptime:240_ | | | | | | **Note 1: The value for fmt, payload type and | | | format is copied from step 1.** | +--------------------+------------------------------------------------+
##### INFO (Step 4) {#info-step-4 .H6}
Use the default message "INFO for MT" in Annex A.2.20 of TS 34.229-1 [2].
##### INFO (Step 6) {#info-step-6 .H6}
Use the default message "INFO for MO" in Annex A.2.19 of TS 34.229-1 [2].
# A.24 UE putting a Video Call on hold or resume the call / 5GS
##### Expected sequence {#expected-sequence-30 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 ---> INVITE or UPDATE UE sends INVITE or UPDATE with a SDP offer to hold or
resume the call  
2 \ ACK Conditional: If the UE sent INVITE in step 1 then UE acknowledges
the receipt of 200 OK for INVITE
##### Specific Message Contents {#specific-message-contents-117 .H6}
##### INVITE or UPDATE (Step 1) {#invite-or-update-step-1-1 .H6}
Use the default message "INVITE for MO call setup" in Annex A.2.1 of TS
34.229-1 [2] applying conditions A1, A3, A5, A10, A11 and A28 or "UPDATE" in
Annex A.2.5 applying conditions A1 and A6 of TS 34.229-1 [2]. In case of an
INVITE the UE shall use also the same URI in the request line as the SS has
sent in the Contact header of an earlier message within the same dialog (in
case of an UPDATE ref. to A.2.5 of TS 34.229-1 [2]).
The UE shall include support for precondition in the Supported header field.
The UE shall include an SDP body as described in A.15.1a, Step 6, but with the
following exceptions and clarifications:
\- the sess-version number of the SDP shall be incremented by one; and
\- the direction-tag for the current-status remote segment shall be
\"sendrecv\"; and
\- the UE shall either add a session level direction attribute (and remove the
direction attributes of all the media lines) or modify the direction
attributes of all the media lines as follows:
\- in case of Call Hold
\- If the directionality of the media lines were originally as \"recvonly\"
then the directionality attributes within the INVITE in step 1 shall be
\"inactive\"
\- If the directionality of the media lines were originally as \"sendrecv\"
then the directionality attributes within the INVITE in step 1 shall be
\"sendonly\"
\- in case of Call Resume
\- the UE shall restore the value of the directionality attributes within the
SDP body their original values (the UE may use either a single session level
attribute or separate attributes for each media line).
##### 100 Trying for INVITE (Step 2) optional step used when UE sent INVITE in
step 1 {#trying-for-invite-step-2-optional-step-used-when-ue-sent-invite-in-
step-1-1 .H6}
Use the default message "100 Trying for INVITE" in Annex A.2.2 of TS 34.229-1
[2], applying condition A1.
##### 200 OK for INVITE or UPDATE (Step 3) {#ok-for-invite-or-update-step-3-1
.H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying conditions A1, A10 and A19, with
the following exceptions:
+--------------------+------------------------------------------------+ | Header/param | Value/remark | +====================+================================================+ | **Require** | | +--------------------+------------------------------------------------+ | option-tag | _precondition_ | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | | +--------------------+------------------------------------------------+ | value | _length of message-body_ | +--------------------+------------------------------------------------+ | **Message-body** | SDP body of the 200 OK response copied from | | | the received INVITE or UPDATE but modified as | | | follows: | | | | | | - \"o=\" line identical to previous SDP sent | | | by SS except that sess-version is incremented | | | by one | | | | | | - IP address on \"c=\" line and transport | | | port on \"m=\" lines changed to indicate to | | | which IP address and port the UE should send | | | the media; and | | | | | | In case of Call Hold: | | | | | | - \"sendonly\" direction attribute inverted | | | to \"recvonly\". | | | | | | Note that this applies to "a=sendonly" | | | direction attributes only, not to the | | | direction tags found in preconditions. | +--------------------+------------------------------------------------+
##### ACK (Step 4) conditional step used when UE sent INVITE in step 1 {#ack-
step-4-conditional-step-used-when-ue-sent-invite-in-step-1-1 .H6}
Use the default message "ACK" in Annex A.2.7 of 34.229-1 [2], applying
conditions A1, A3 and A5.
# A.25 Video Conference Creation / 5GS
##### Expected sequence {#expected-sequence-31 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 INVITE UE sends INVITE with the first SDP offer.  
2 100 Trying SS sends a 100 Trying provisional response.  
3 183 Session Progress SS sends an SDP answer.  
4 PRACK UE acknowledges reception of 183 Session Progress., with optional SDP
offer  
5 200 OK SS responds to PRACK.  
Exception : Step 6-7 describe optional behaviour depending on UE
implementation. The steps will be executed if no SDP offer was included in
PRACK at step 4  
6 UPDATE UE sends a second SDP offer in an UPDATE request.  
7 200 OK SS responds to UPDATE.  
8 \ ACK The UE acknowledges the receipt of 200 OK for INVITE  
EXCEPTION: steps 10--13 describe optional behaviour depending on UE
configuration. The SS shall wait up to 3s for the SUBSCRIBE of step 10  
10 -> SUBSCRIBE UE subscribes the conference event  
11 \ 200 OK UE responds to the NOTIFY
##### Specific Message Contents {#specific-message-contents-118 .H6}
The specific message contents for steps 1--7 is otherwise identical to what
have been specified in Annex A.15.1a, but with the exceptions as below:
##### INVITE (Step 1) {#invite-step-1-18 .H6}
Header/param Value/remark
* * *
**Request-Line**  
Request-URI _sip:mmtel\@conf-factory_ appended with **px_IMS_HomeDomainName**
**To**  
addr-spec _sip:mmtel\@conf-factory_ appended with **px_IMS_HomeDomainName**
##### 183 Session in Progress for INVITE (Step 3) {#session-in-progress-for-
invite-step-3-1 .H6}
+------------------+--------------------------------------------------+ | Header/param | Value/remark | +==================+==================================================+ | **Contact** | | +------------------+--------------------------------------------------+ | addr-spec | _[sip:temporary\@conf-factory]{.underline}_. | | | appended with **px_IMS_HomeDomainName** | +------------------+--------------------------------------------------+ | feature-param | _isfocus_ | +------------------+--------------------------------------------------+ | **Record-Route** | | +------------------+--------------------------------------------------+ | rec-route | \, | | | | | | \ | +------------------+--------------------------------------------------+
##### PRACK (Step 4) {#prack-step-4-15 .H6}
Header/param Value/remark
* * *
**Require** (present, if Message-Body is present) option-tag _precondition_
**Message-body** (if present, shall be the same as message body in UPDATE at
step 6 of Annex A.15.1a)
##### 200 OK for PRACK (Step 5) {#ok-for-prack-step-5-8 .H6}
+--------------------+------------------------------------------------+ | Header/param | Value/remark | +====================+================================================+ | **Require** | (present, if Message-Body is present) | +--------------------+------------------------------------------------+ | option-tag | _precondition_ | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | (present, if SDP message-Body was present in | | | PRACK at step 4) | +--------------------+------------------------------------------------+ | | _application/sdp_ | +--------------------+------------------------------------------------+ | **Content-Length** | (present if SDP message-Body was present in | | | PRACK at step 4) | +--------------------+------------------------------------------------+ | value | length of message body | +--------------------+------------------------------------------------+ | **Message-body** | (present, if SDP message-Body was present in | | | PRACK at step 4) | | | | | | same as message body in 200 OK for UPDATE at | | | step 7 of Annex A.15.1a | +--------------------+------------------------------------------------+ | | | +--------------------+------------------------------------------------+
##### 200 OK for INVITE (Step 8) {#ok-for-invite-step-8-1 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying conditions A1 and A5 with the
following exceptions:
Header/param Value/remark
* * *
**Record-Route**  
rec-route Same value as in the 183 response **Contact**  
addr-spec _sip:final\@conf-factory_. appended with px_IMS_HomeDomainName
feature-param _Isfocus_
##### ACK (Step 9) {#ack-step-9-1 .H6}
Use the default message "ACK" in Annex A.2.7 of TS 34.229-1 [2], applying
conditions A1 and A3, with the following exceptions:
Header/param Value/remark
* * *
**Request-Line**  
Request-URI _[sip:final\@conf-factory]{.underline}_. appended with
**px_IMS_HomeDomainName**
##### SUBSCRIBE (Step 10) {#subscribe-step-10-1 .H6}
Use the default message "SUBSCRIBE for conference event package" in Annex
A.5.1 of TS 34.229-1 [2], applying conditions A1 and A7.
##### 200 OK (Step 11) {#ok-step-11-5 .H6}
Use the default message "200 OK for SUBSCRIBE" in Annex A.5.2 of TS 34.229-1
[2], applying condition A1.
##### NOTIFY (Step 12) {#notify-step-12-1 .H6}
Use the default message "MT NOTIFY for conference event package" in Annex
A.5.3 of TS 34.229-1 [2], applying condition A5.
##### 200 OK (Step 13) {#ok-step-13-1 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying conditions A5 and A22.
# A.26 Inviting user to Video conference by sending a REFER request to the
conference focus / 5GS
##### Expected sequence {#expected-sequence-32 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 --> REFER UE sends REFER to SS referring to the conference  
2 \ 200 OK The UE responds the NOTIFY with 200 OK  
5 \ 200 OK The UE responds the NOTIFY with 200 OK  
7 \ 200 OK Conditional: The UE responds the NOTIFY with 200 OK
##### Specific Message Contents {#specific-message-contents-119 .H6}
##### REFER (Step 1) {#refer-step-1-1 .H6}
Use the default message "MO REFER" in Annex A.2.10 of TS 34.229-1[2], applying
conditions A1 and A5, with the following exceptions:
+-----------------+---------------------------------------------------+ | Header/param | Value/remark | +=================+===================================================+ | **Request-URI** | _sip:final\@conf-factory._ appended with | | | px_IMS_HomeDomainName | +-----------------+---------------------------------------------------+ | **Refer-To** | SIP URI or tel URI of the user invited to the | | | conference. If an active session exists, the | | addr-spec | Replaces header in the header portion of the SIP | | | URI shall be included (mandatory inclusion is | | | stated in NG.114 [31]) and set to the dialog ID | | | of the active session according to RFC 3891 | | | [40]. In this case, if the user has been | | | invited with a tel URI, the UE shall convert the | | | tel URI to a SIP URI according to RFC 3261 [6] | | | clause 19.1.6. | | | | | | (NOTE: the dialog ID is percent encoded according | | | to RFC 3986 [41]). | +-----------------+---------------------------------------------------+ | **Route** | URIs of the Record-Route header of 183 response | | | sent in step 4 of A.25 in reverse order | | route-param | | +-----------------+---------------------------------------------------+
##### NOTIFY (Step 3) {#notify-step-3-1 .H6}
Use the default message "MT NOTIFY for refer package" in Annex A.2.11 of TS
34.229-1 [2], applying condition A1, with the following exceptions:
Header/param Value/remark
* * *
**Message-body** _SIP/2.0 100 Trying_
##### NOTIFY (Step 5) {#notify-step-5-1 .H6}
Use the default message "MT NOTIFY for refer package" in annex A.2.11 of TS
34.229-1[2] with the following exceptions:
Header/param Value/remark
* * *
**Subscription-State**  
substate-value _terminated_ expires omitted from the request reason
_noresource_ **Message-body** _SIP/2.0 200 OK_
##### NOTIFY (Step 7) {#notify-step-7-2 .H6}
Use the default message "NOTIFY for conference event package" in annex A.5.3
of TS 34.229-1[2] with the following exceptions:
+------------------+--------------------------------------------------+ | Header/param | Value/remark | +==================+==================================================+ | **Message-body** | _\ _ | | | | | | _\ _ | | | | | | _entity=\"sip:final\@conf-factory._ appended | | | with px_IMS_HomeDomainName _\"_ | | | | | | _state=\"partial\"_ | | | | | | _version=\"1\"_ | | | | | | _\ _ | | | | | | _\ _ | | | | | | _\ _ | | | | | | _\ connected\_ | | | | | | * | | | \dialled-in\_| | | | | |_ \_| | | | | |_ \audio\_| | | | | |_ \11223\_| | | | | |_ \**_random SSRC value_** \_| | | | | |_ \sendrecv\_| | | | | |_ \_| | | | | |_ \_| | | | | |_ \video\_| | | | | |_ \11224\_| | | | | |_ \**_random SSRC value_** \_| | | | | |_ \sendrecv\_| | | | | |_ \_| | | | | |_ \_| | | | | |_ \_| | | | | |_ \* | +------------------+--------------------------------------------------+
# A.27 Leaving a conference / 5GS
##### Expected sequence {#expected-sequence-33 .H6}
Step Direction Message Comment
* * *
         UE          SS
1 -> BYE The UE leaves the conference with BYE  
2 \ 200 OK Conditional: the UE sends 200 OK for NOTIFY (if sent by SS)
##### Specific Message Contents {#specific-message-contents-120 .H6}
##### BYE {#bye .H6}
Use the default message "BYE" in Annex A.2.8 of TS 34.229-1 [2], applying
condition A8, with the following exceptions:
Header/param Value/remark
* * *
**Request-Line**  
Request-URI _[sip:final\@conf-factory appended with
px_IMS_HomeDomainName]{.underline}_
##### 200 OK (Step 2) {#ok-step-2-4 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying condition A22.
##### NOTIFY {#notify .H6}
Use the default message "NOTIFY for conference event package" in Annex A.5.3
of TS 34.229-1 [2], applying condition A4.
##### 200 OK (Step 4) {#ok-step-4-1 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying condition A22.
# A.28 SS putting a Video Call on hold or resume the call / 5GS
Expected sequence
Step Direction Message Comment
* * *
         UE          SS
1 \ 100 Trying Optional: The UE responds with a 100 Trying provisional
response  
3 -> 200 OK The UE responds to INVITE with 200 OK to indicate that the UE is
no more sending any media (call hold) or resumes sending media (call resume)  
4 \<\- ACK The SS acknowledges the receipt of 200 OK for INVITE
##### Specific Message Contents {#specific-message-contents-121 .H6}
##### INVITE (Step 1) {#invite-step-1-19 .H6}
Use the default message "INVITE for MT call setup" in Annex A.2.9 of TS
34.229-1 [2], applying conditions A1, A3, A5, A7 and A8, with the below
exceptions. The SS uses the same URI in the request line as the UE has earlier
sent in its Contact header within the same dialog.
The SS shall include support for preconditions in the Supported header field.
In case of Call Hold, the SS shall include the same lines in the SDP body as
finally accepted for the MTSI call, i.e., the last SDP sent by the SS, with
the following exceptions:
\- version number of the SDP shall be incremented; and
\- each media line shall carry direction attribute "a=sendonly".
In case of Call Resume, the SS shall include the same lines in the SDP body as
sent in the message for Call Hold with the following exceptions:
\- version number of the SDP shall be incremented; and
\- each media line shall carry direction attribute "a=sendrecv".
##### 100 Trying for INVITE (Step 2) {#trying-for-invite-step-2-1 .H6}
Use the default message "100 Trying for INVITE" in Annex A.2.2 of TS 34.229-1
[2], applying condition A2.
##### 200 OK for INVITE (Step 3) {#ok-for-invite-step-3-1 .H6}
Use the default message "200 OK for other requests than REGISTER or SUBSCRIBE"
in Annex A.3.1 of TS 34.229-1 [2], applying conditions A5, A11, A18, A20 and
A22 with the following exceptions:
+--------------------+------------------------------------------------+ | Header/param | Value/remark | +====================+================================================+ | **Require** | | +--------------------+------------------------------------------------+ | option-tag | _precondition_ | +--------------------+------------------------------------------------+ | **Content-Type** | | +--------------------+------------------------------------------------+ | media-type | _application/sdp * | +--------------------+------------------------------------------------+ |__Content-Length_ _| header shall be present if UE uses TCP to send | | | this message and if there is a message body | +--------------------+------------------------------------------------+ | value | length of message-body | +--------------------+------------------------------------------------+ |__Message-body_ * | SDP answer to the SDP offer contained in the | | | INVITE including: | | | | | | - All mandatory SDP lines as specified in RFC | | | 4566 [38]. | | | | | | - The same number of media lines ("m=") as in | | | the INVITE. | | | | | | - All the media lines having directionality | | | as \"recvonly\" | | | | | | In case of Call Hold: | | | | | | All the media lines having direction attribute | | | "a=recvonly". | | | | | | In case of Call Resume: | | | | | | All the media lines having direction attribute | | | "a=sendrecv". | +--------------------+------------------------------------------------+
##### ACK (Step 4) {#ack-step-4-1 .H6}
Use the default message "ACK" in Annex A.2.7 of TS 34.229-1 [2], applying
conditions A2, A3 and A5.
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides the description of the Packet Data Convergence
Protocol (PDCP).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 38.300: \"NG Radio Access Network; Overall description\".
[3] 3GPP TS 38.331: \"NR Radio Resource Control (RRC); Protocol
Specification\".
[4] 3GPP TS 38.321: \"NR Medium Access Control (MAC) protocol specification\".
[5] 3GPP TS 38.322: \"NR Radio Link Control (RLC) protocol specification\".
[6] 3GPP TS 33.501: \"Security Architecture and Procedures for 5G System \".
[7] IETF RFC 5795: \"The RObust Header Compression (ROHC) Framework\".
[8] IETF RFC 3095: \"RObust Header Compression (ROHC): Framework and four
profiles: RTP, UDP, ESP and uncompressed\".
[9] IETF RFC 4815: \"RObust Header Compression (ROHC): Corrections and
Clarifications to RFC 3095\".
[10] IETF RFC 6846: \"RObust Header Compression (ROHC): A Profile for TCP/IP
(ROHC-TCP)\".
[11] IETF RFC 5225: \"RObust Header Compression (ROHC) Version 2: Profiles for
RTP, UDP, IP, ESP and UDP Lite\".
[12] 3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
Medium Access Control (MAC) protocol specification\".
[13] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to
support Vehicle-to-Everything (V2X) services\".
[14] 3GPP TS 33.536: \"Security Aspect of 3GPP Support for Advanced V2X
Services\".
[15] IEEE Standard 802.3™-2018: \"Ethernet\".
[16] 3GPP TS 24.587: \"Vehicle-to-Everything (V2X) services in 5G System
(5GS), Stage 3\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**AM DRB** : a data radio bearer which utilizes RLC AM.
**DAPS bearer** : a bearer whose radio protocols are located in both the
source gNB and the target gNB during DAPS handover to use both source gNB and
target gNB resources.
**Non-split bearer** : a bearer whose radio protocols are located in either
the MgNB or the SgNB to use MgNB or SgNB resource, respectively.
**NR sidelink communication** : AS functionality enabling at least V2X
communication as defined in TS 23.287 [13], between two or more nearby UEs,
using NR technology but not traversing any network node.
**PDCP data volume** : the amount of data available for transmission in a PDCP
entity.
**Split bearer** : in dual connectivity, a bearer whose radio protocols are
located in both the MgNB and the SgNB to use both MgNB and SgNB resources.
**Split secondary RLC entity** : in dual connectivity, the RLC entity other
than the primary RLC entity which is responsible for split bearer operation.
If the PDCP entity is associated with two RLC entities, the split secondary
RLC entity is the RLC entity other than the primary RLC entity. If the PDCP
entity is associated with more than two RLC entities, the split secondary RLC
entity is configured by upper layers.
**UM DRB** : a data radio bearer which utilizes RLC UM.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AM Acknowledged Mode
CID Context Identifier
DAPS Dual Active Protocol Stack
DRB Data Radio Bearer carrying user plane data
EHC Ethernet Header Compression
gNB NR Node B
HFN Hyper Frame Number
IETF Internet Engineering Task Force
IP Internet Protocol
MAC Medium Access Control
MAC-I Message Authentication Code for Integrity
PDCP Packet Data Convergence Protocol
PDU Protocol Data Unit
RB Radio Bearer
RFC Request For Comments
RLC Radio Link Control
ROHC RObust Header Compression
RRC Radio Resource Control
RTP Real Time Protocol
SAP Service Access Point
SCCH Sidelink Control Channel
SDU Service Data Unit
SLRB Sidelink Radio Bearer carrying NR sidelink communication
SN Sequence Number
SRB Signalling Radio Bearer carrying control plane data
STCH Sidelink Traffic Channel
TCP Transmission Control Protocol
UDP User Datagram Protocol
UE User Equipment
UM Unacknowledged Mode
X-MAC Computed MAC-I
# 4 General
## 4.1 Introduction
The present document describes the functionality of the PDCP.
## 4.2 Architecture
### 4.2.1 PDCP structure
Figure 4.2.1.1 represents one possible structure for the PDCP sublayer; it
should not restrict implementation. The figure is based on the radio interface
protocol architecture defined in TS 38.300 [2].
Figure 4.2.1-1: PDCP layer, structure view
The PDCP sublayer is configured by upper layers TS 38.331 [3]. The PDCP
sublayer is used for RBs mapped on DCCH, DTCH, SCCH, and STCH type of logical
channels. The PDCP sublayer is not used for any other type of logical
channels.
Each RB (except for SRB0 for Uu interface) is associated with one PDCP entity.
Each PDCP entity is associated with one, two, three, four, six, or eight RLC
entities depending on the RB characteristic (e.g. uni-directional/bi-
directional or split/non-split) or RLC mode:
\- For split bearers, each PDCP entity is associated with two UM RLC entities
(for same direction), four UM RLC entities (two for each direction), or two AM
RLC entities;
\- For RBs configured with PDCP duplication, each PDCP entity is associated
with N UM RLC entities (for same direction), 2 × N UM RLC entities (N for each
direction), or N AM RLC entities, where 2 \= SN(RX_DELIV) +_ Window_Size _:_
_\- RCVD_HFN = HFN(RX_DELIV) -- 1._
\- else:
\- RCVD_HFN = HFN(RX_DELIV);
\- RCVD_COUNT = [RCVD_HFN, RCVD_SN].
After determining the COUNT value of the received PDCP Data PDU = RCVD_COUNT,
the receiving PDCP entity shall:
\- perform deciphering and integrity verification of the PDCP Data PDU using
COUNT = RCVD_COUNT;
\- if integrity verification fails:
\- indicate the integrity verification failure to upper layer;
\- discard the PDCP Data PDU and consider it as not received;
\- if RCVD_COUNT \= RX_NEXT:
\- update RX_NEXT to RCVD_COUNT + 1.
\- if _outOfOrderDelivery_ is configured:
\- deliver the resulting PDCP SDU to upper layers after performing header
decompression using EHC.
\- if RCVD_COUNT = RX_DELIV:
\- deliver to upper layers in ascending order of the associated COUNT value
after performing header decompression, if not decompressed before;
\- all stored PDCP SDU(s) with consecutively associated COUNT value(s)
starting from COUNT = RX_DELIV;
\- update RX_DELIV to the COUNT value of the first PDCP SDU which has not been
delivered to upper layers, with COUNT value > RX_DELIV;
\- if _t-Reordering_ is running, and if RX_DELIV >= RX_REORD:
\- stop and reset _t-Reordering_.
\- if _t-Reordering_ is not running (includes the case when _t-Reordering_ is
stopped due to actions above), and RX_DELIV \= RX_REORD;
\- if RX_DELIV \ 15 then LARGE_CIDS = TRUE else LARGE_CIDS = FALSE;
\- PROFILES (M): Profiles are used to define which profiles are allowed to be
used by the UE. The list of supported profiles is described in clause 5.7.1.
The parameter PROFILES is configured by upper layers (_profiles_ for uplink
and downlink, _sl-RoHC-Profiles_ in _SidelinkPreconfigNR_ for sidelink in TS
38.331 [3]);
\- FEEDBACK_FOR (N/A): This is a reference to the channel in the opposite
direction between two compression endpoints and indicates to what channel any
feedback sent refers to. Feedback received on one ROHC channel for this PDCP
entity shall always refer to the ROHC channel in the opposite direction for
this same PDCP entity;
\- MRRU (N/A): ROHC segmentation is not used.
### 5.7.4 Header compression using ROHC
If ROHC is configured, the ROHC protocol generates two types of output
packets:
\- ROHC compressed packets, each associated with one PDCP SDU;
\- standalone packets not associated with a PDCP SDU, i.e. interspersed ROHC
feedback.
A ROHC compressed packet is associated with the same PDCP SN and COUNT value
as the related PDCP SDU. The header compression is not applicable to the SDAP
header and the SDAP Control PDU if included in the PDCP SDU.
For DAPS bearers, the PDCP entity shall perform the header compression for the
PDCP SDU using the ROHC protocol either configured for the source cell or
configured for the target cell, based on to which cell the PDCP SDU is
transmitted.
Interspersed ROHC feedback are not associated with a PDCP SDU. They are not
associated with a PDCP SN and are not ciphered.
NOTE 1: If the MAX_CID number of ROHC contexts are already established for the
compressed flows and a new IP flow does not match any established ROHC
context, the compressor should associate the new IP flow with one of the ROHC
CIDs allocated for the existing compressed flows or send PDCP SDUs belonging
to the IP flow as uncompressed packet.
NOTE 2: For downlink, the ROHC protocol of the target cell should maintain the
IR state if operating in U-mode and O-mode during DAPS handover before release
of source cell.
### 5.7.5 Header decompression using ROHC
If ROHC is configured by upper layers for PDCP entities associated with user
plane data, the PDCP Data PDUs are decompressed by the ROHC protocol after
performing deciphering as explained in clause 5.8. The header decompression is
not applicable to the SDAP header and the SDAP Control PDU if included in the
PDCP Data PDU.
For DAPS bearers, the PDCP entity shall perform the header decompression for
the PDCP SDU using the ROHC protocol either configured for the source cell or
configured for the target cell, based on from which cell the PDCP SDU is
received.
### 5.7.6 PDCP Control PDU for interspersed ROHC feedback
#### 5.7.6.1 Transmit Operation
When an interspersed ROHC feedback is generated by the ROHC protocol, the
transmitting PDCP entity shall:
\- submit to lower layers the corresponding PDCP Control PDU as specified in
clause 6.2.3.2 i.e. without associating a PDCP SN, nor performing ciphering,
as specified in clause 5.2.1.
#### 5.7.6.2 Receive Operation
At reception of a PDCP Control PDU for interspersed ROHC feedback from lower
layers, the receiving PDCP entity shall:
\- deliver the corresponding interspersed ROHC feedback to the associated ROHC
protocol without performing deciphering.
## 5.8 Ciphering and deciphering
The ciphering function includes both ciphering and deciphering and is
performed in PDCP, if configured. The data unit that is ciphered is the MAC-I
(see clause 6.3.4) and the data part of the PDCP Data PDU (see clause 6.3.3)
except the SDAP header and the SDAP Control PDU if included in the PDCP SDU.
The ciphering is not applicable to PDCP Control PDUs.
For downlink and uplink, the ciphering algorithm and key to be used by the
PDCP entity are configured by upper layers TS 38.331 [3] and the ciphering
method shall be applied as specified in TS 33.501 [6].
The ciphering function is activated/suspended/resumed by upper layers TS
38.331 [3]. When security is activated and not suspended, the ciphering
function shall be applied to all PDCP Data PDUs indicated by upper layers TS
38.331 [3] for the downlink and the uplink, respectively.
For DAPS bearers, the PDCP entity shall perform the ciphering or deciphering
for the PDCP SDU using the ciphering algorithm and key either configured for
the source cell or configured for the target cell, based on to/from which cell
the PDCP SDU is transmitted/received.
For downlink and uplink ciphering and deciphering, the parameters that are
required by PDCP for ciphering are defined in TS 33.501 [6] and are input to
the ciphering algorithm. The required inputs to the ciphering function include
the COUNT value, and DIRECTION (direction of the transmission: set as
specified in TS 33.501 [6]). The parameters required by PDCP which are
provided by upper layers TS 38.331 [3] are listed below:
\- BEARER (defined as the radio bearer identifier in TS 33.501 [6]. It will
use the value RB identity --1 as in TS 38.331 [3]);
\- KEY (the ciphering keys for **the control plane and for the user plane
are** K~RRCenc~ and K~UPenc~, respectively).
For NR sidelink communication, the ciphering algorithm and key to be used by
the PDCP entity are configured by upper layers as specified in TS 24.587 [16]
and the ciphering method shall be applied as specified in TS 33.536 [14].
For NR sidelink communication, the ciphering function is activated for
sidelink SRBs (except for SL-SRB0) and/or sidelink DRBs for a PC5 unicast
‎link by upper layers, as specified in TS 38.331 [3]. When security is
activated for sidelink SRBs, the ciphering function ‎shall be applied to all
PDCP Data PDUs (except for carrying Direct Security Mode Command message as
specified in TS 33.536 [14]) for the sidelink SRBs which belong to ‎the PC5
unicast link.‎ When security is activated for sidelink DRBs, the ciphering
function ‎shall be applied to all PDCP Data PDUs for the sidelink DRBs which
belong to ‎the PC5 unicast link.‎
For NR sidelink communication, the ciphering and deciphering function as
specified in TS 33.536 [14] is applied with KEY (NRPEK), COUNT, BEARER (LSB 5
bits of LCID as specified in TS 38.321 [4]) and DIRECTION (which value shall
be set is specified in TS 33.536 [14]) as input.
## 5.9 Integrity protection and verification
The integrity protection function includes both integrity protection and
integrity verification and is performed in PDCP, if configured. The data unit
that is integrity protected is the PDU header and the data part of the PDU
before ciphering. The integrity protection is always applied to PDCP Data PDUs
of SRBs. The integrity protection is applied to sidelink SRB1, SRB2 and SRB3.
The integrity protection is applied to PDCP Data PDUs of DRBs (including
sidelink DRBs for unicast) for which integrity protection is configured. The
integrity protection is not applicable to PDCP Control PDUs.
For downlink and uplink, the integrity protection algorithm and key to be used
by the PDCP entity are configured by upper layers TS 38.331 [3] and the
integrity protection method shall be applied as specified in TS 33.501 [6].
The integrity protection function is activated/suspended/resumed by upper
layers TS 38.331 [3]. When security is activated and not suspended, the
integrity protection function shall be applied to all PDUs including and
subsequent to the PDU indicated by upper layers TS 38.331 [3] for the downlink
and the uplink, respectively.
NOTE 1: As the RRC message which activates the integrity protection function
is itself integrity protected with the configuration included in this RRC
message, this message needs first be decoded by RRC before the integrity
protection verification could be performed for the PDU in which the message
was received.
NOTE 2: As the PC5-S message which activates the integrity protection function
is itself integrity protected with the configuration included in this PC5-S
message, this message needs first be decoded by upper layer before the
integrity protection verification could be performed for the PDU in which the
message was received.
For DAPS bearers, the PDCP entity shall perform the integrity protection or
verification for the PDCP SDU using the integrity protection algorithm and key
either configured for the source cell or configured for the target cell, based
on to/from which cell the PDCP SDU is transmitted/received.
For downlink and uplink integrity protection and verification, the parameters
that are required by PDCP for integrity protection are defined in TS 33.501
[6] and are input to the integrity protection algorithm. The required inputs
to the integrity protection function include the COUNT value, and DIRECTION
(direction of the transmission: set as specified in TS 33.501 [6]). The
parameters required by PDCP which are provided by upper layers TS 38.331 [3]
are listed below:
\- BEARER (defined as the radio bearer identifier in TS 33.501 [6]. It will
use the value RB identity --1 as in TS 38.331 [3]);
\- KEY (the integrity protection keys for **the control plane and for the user
plane are** K~RRCint~ and K~UPint~, respectively).
For NR sidelink communication, the integrity protection algorithm and key to
be used by the PDCP entity are configured by upper layers TS 24.587 [16] and
the integrity protection method shall be applied as specified in TS 33.536
[14].
For NR sidelink communication, the integrity protection function is activated
for sidelink SRBs and/or sidelink DRBs for a PC5 unicast link ‎by upper
layers, as specified in TS 38.331 [3]. When security is activated for sidelink
SRBs, the integrity protection ‎function shall be applied to all PDUs
including and subsequent to the PDU for the ‎sidelink SRBs which belong to the
PC5 unicast link.‎ When security is activated for sidelink DRBs, the integrity
protection ‎function shall be applied to all PDUs including and subsequent to
the PDU for the ‎sidelink DRBs which belong to the PC5 unicast link.‎
For the SLRB that needs integrity protection and verification, the parameters
that are required by PDCP for integrity protection are defined in TS 33.536
[14] and are input to the integrity protection algorithm. The required inputs
to the integrity protection function include the KEY (NRPIK), COUNT, BEARER
(LSB 5 bits of LCID as specified in TS 38.321 [4]) and DIRECTION (which value
shall be set is specified in TS 33.536 [14]).
At transmission, the UE computes the value of the MAC-I field and at reception
it verifies the integrity of the PDCP Data PDU by calculating the X-MAC based
on the input parameters as specified above. If the calculated X-MAC
corresponds to the received MAC-I, integrity protection is verified
successfully.
## 5.10 Handling of unknown, unforeseen, and erroneous protocol data
When a PDCP PDU that contains reserved or invalid values is received, the
receiving PDCP entity shall:
\- discard the received PDU.
NOTE: For NR sidelink communication for unicast, the invalid values include
the invalid value of K~NRP-sess~ ID.
## 5.11 PDCP duplication
### 5.11.1 Activation/Deactivation of PDCP duplication
For the PDCP entity configured with _pdcp-Duplication_ , the transmitting PDCP
entity shall:
\- for SRBs:
\- activate the PDCP duplication;
\- for DRBs:
\- if the activation of PDCP duplication is indicated for the DRB:
\- activate the PDCP duplication for the DRB;
\- if the activation of PDCP duplication is indicated for at least one
associated RLC entities:
\- activate the PDCP duplication for the indicated associated RLC entities;
\- activate the PDCP duplication for the DRB;
\- if the deactivation of PDCP duplication is indicated for the DRB:
\- deactivate the PDCP duplication for the DRB;
\- if the deactivation of PDCP duplication is indicated for at least one
associated RLC entities:
\- deactivate the PDCP duplication for the indicated associated RLC entities;
\- if all associated RLC entities other than the primary RLC entity are
deactivated for PDCP duplication:
\- deactivate the PDCP duplication for the DRB.
### 5.11.2 Duplicate PDU discard
For the PDCP entity configured with _pdcp-Duplication_ , the transmitting PDCP
entity shall:
\- if the successful delivery of a PDCP Data PDU is confirmed by one of the
associated AM RLC entities:
\- indicate to the other AM RLC entities to discard the duplicated PDCP Data
PDU;
\- if the deactivation of PDCP duplication is indicated for the DRB:
\- indicate to the RLC entities other than the primary RLC entity to discard
all duplicated PDCP Data PDUs;
\- if the deactivation of PDCP duplication is indicated for at least one
associated RLC entities:
\- indicate to the RLC entities deactivated for PDCP duplication to discard
all duplicated PDCP Data PDUs.
## 5.12 Ethernet header compression and decompression
### 5.12.1 Supported header compression protocols
The EHC protocol is based on the Ethernet Header Compression (EHC) framework
defined in Annex A.
### 5.12.2 Configuration of EHC
PDCP entities associated with DRBs can be configured by upper layers TS 38.331
[3] to use EHC. Each PDCP entity carrying user plane data may be configured to
use EHC. Every PDCP entity uses at most one EHC compressor instance and at
most one EHC decompressor instance.
### 5.12.3 Protocol parameters
The usage and definition of the parameters shall be as specified below.
\- MAX_CID_EHC_UL: This is the maximum CID value that can be used for uplink.
One CID value shall always be reserved for uncompressed flows. The parameter
MAX_CID_EHC_UL is configured by upper layers (_maxCID-EHC-UL_ in TS 38.331
[3]);
### 5.12.4 Header compression using EHC
If EHC is configured, the EHC protocol generates two types of output packets:
\- EHC compressed packets (i.e. EHC full header packets and EHC compressed
header packets), each associated with one PDCP SDU;
\- standalone packets not associated with a PDCP SDU, i.e. EHC feedback.
An EHC compressed packet is associated with the same PDCP SN and COUNT value
as the related PDCP SDU. The header compression is not applicable to the SDAP
header and the SDAP Control PDU if included in the PDCP SDU.
EHC feedback are not associated with a PDCP SDU. They are not associated with
a PDCP SN and are not ciphered/integrity protected.
### 5.12.5 Header decompression using EHC
If EHC is configured by upper layers for PDCP entities associated with user
plane data, the PDCP Data PDUs are decompressed by the EHC protocol after
performing deciphering and integrity verification as explained in clause 5.8
and 5.9, respectively. The header decompression is not applicable to the SDAP
header and the SDAP Control PDU if included in the PDCP Data PDU.
### 5.12.6 PDCP Control PDU for EHC feedback
#### 5.12.6.1 Transmit Operation
When an EHC feedback is generated by the EHC protocol, the transmitting PDCP
entity shall:
\- submit to lower layers the corresponding PDCP Control PDU as specified in
clause 6.2.3.3 i.e. without associating a PDCP SN, nor performing
ciphering/integrity protection.
#### 5.12.6.2 Receive Operation
At reception of a PDCP Control PDU for EHC feedback from lower layers, the
receiving PDCP entity shall:
\- deliver the corresponding EHC feedback to the EHC protocol without
performing deciphering/integrity verification.
### 5.12.7 Simultaneous configuration of ROHC and EHC
If both ROHC and EHC are configured for a DRB, the ROHC header shall be
located after the EHC header. Figure 5.12.7-1 shows the location of the ROHC
header and the EHC header in a PDCP Data PDU.
Figure 5.12.7-1: Location of ROHC header and EHC header in a PDCP Data PDU
If a PDCP SDU including non-IP Ethernet packet is received from upper layers,
the EHC compressor shall bypass the ROHC compressor and submit the EHC
compressed non-IP Ethernet packet to lower layers according to clause 5.2.1.
If a PDCP Data PDU including non-IP Ethernet packet is received from lower
layers, the EHC decompressor shall bypass the ROHC decompressor and deliver
the EHC decompressed non-IP Ethernet packet to upper layers according to
clause 5.2.2.
## 5.13 Uplink data switching
For DAPS bearers, when upper layers request uplink data switching, the
transmitting PDCP entity shall:
\- for AM DRBs, from the first PDCP SDU for which the successful delivery of
the corresponding PDCP Data PDU has not been confirmed by the RLC entity
associated with the source cell, perform retransmission or transmission of all
the PDCP SDUs already associated with PDCP SNs in ascending order of the COUNT
values associated to the PDCP SDU prior to uplink data switching to the RLC
entity associated with the target cell as specified below:
\- perform header compression of the PDCP SDU using ROHC as specified in the
clause 5.7.4;
\- perform integrity protection and ciphering of the PDCP SDU using the COUNT
value associated with this PDCP SDU as specified in the clause 5.9 and 5.8,
respectively;
\- submit the resulting PDCP Data PDU to lower layer, as specified in clause
5.2.1.
\- for UM DRBs, for all PDCP SDUs which have been processed by PDCP but which
have not yet been submitted to lower layers, perform transmission of the PDCP
SDUs in ascending order of the COUNT values to the RLC entity associated with
the target cell as specified below:
\- perform header compression of the PDCP SDU using ROHC as specified in the
clause 5.7.4;
\- perform integrity protection and ciphering of the PDCP SDU using the COUNT
value associated with this PDCP SDU as specified in the clause 5.9 and 5.8,
respectively;
\- submit the resulting PDCP Data PDU to lower layer, as specified in clause
5.2.1.
# 6 Protocol data units, formats, and parameters
## 6.1 Protocol data units
### 6.1.1 Data PDU
The PDCP Data PDU is used to convey one or more of followings in addition to
the PDU header:
\- user plane data;
\- control plane data;
\- a MAC-I.
### 6.1.2 Control PDU
The PDCP Control PDU is used to convey one of followings in addition to the
PDU header:
\- a PDCP status report;
\- an interspersed ROHC feedback;
\- an EHC feedback.
## 6.2 Formats
### 6.2.1 General
A PDCP PDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in
length. In the figures in clause 6.2, bit strings are represented by tables in
which the most significant bit is the leftmost bit of the first line of the
table, the least significant bit is the rightmost bit on the last line of the
table, and more generally the bit string is to be read from left to right and
then in the reading order of the lines. The bit order of each parameter field
within a PDCP PDU is represented with the first and most significant bit in
the leftmost bit and the last and least significant bit in the rightmost bit.
PDCP SDUs are bit strings that are byte aligned (i.e. multiple of 8 bits) in
length. A compressed or uncompressed SDU is included into a PDCP Data PDU from
the first bit onward.
### 6.2.2 Data PDU
#### 6.2.2.1 Data PDU for SRBs
Figure 6.2.2.1-1 shows the format of the PDCP Data PDU with 12 bits PDCP SN.
This format is applicable for SRBs.
Figure 6.2.2.1-1: PDCP Data PDU format for SRBs
#### 6.2.2.2 Data PDU for DRBs with 12 bits PDCP SN
Figure 6.2.2.2-1 shows the format of the PDCP Data PDU with 12 bits PDCP SN.
This format is applicable for UM DRBs and AM DRBs.
Figure 6.2.2.2-1: PDCP Data PDU format with 12 bits PDCP SN
#### 6.2.2.3 Data PDU for DRBs with 18 bits PDCP SN
Figure 6.2.2.3-1 shows the format of the PDCP Data PDU with 18 bits PDCP SN.
This format is applicable for UM DRBs and AM DRBs.
Figure 6.2.2.3-1: PDCP Data PDU format for DRBs with 18 bits PDCP SN
#### 6.2.2.4 Data PDU for sidelink DRBs for groupcast and broadcast and for
the sidelink SRB0‎
Figure 6.2.2.4-1 shows the format of the PDCP Data PDU with 12 bits PDCP SN.
This format is applicable for sidelink DRBs for groupcast and broadcast and
for the sidelink SRB0.
Figure 6.2.2.4-1: PDCP Data PDU format for sidelink DRBs for groupcast and
broadcast and for the sidelink SRB0‎
NOTE: There is no control PDU for SLRBs for groupcast and broadcast. Thus,
there is no D/C field in the PDCP Data PDU format for SLRBs for groupcast and
broadcast. SDU type is only applicable for sidelink DRB.
#### 6.2.2.5 Data PDU for sidelink SRBs for unicast
Figure 6.2.2.5-1 shows the format of the PDCP Data PDU with 12 bits PDCP SN.
This format is applicable for sidelink SRB1, SRB2 and SRB3 for unicast.
Figure 6.2.2.5-1: PDCP Data PDU format for sidelink SRB1, SRB2 and SRB3 for
unicast
#### 6.2.2.6 Data PDU for sidelink DRBs for unicast with 12 bits PDCP SN
Figure 6.2.2.6-1 shows the format of the PDCP Data PDU with 12 bits PDCP SN.
This format is applicable for sidelink DRBs for unicast.
Figure 6.2.2.6-1: PDCP Data PDU format for sidelink DRBs for unicast with 12
bits PDCP SN
#### 6.2.2.7 Data PDU for sidelink DRBs for unicast with 18 bits PDCP SN
Figure 6.2.2.7-1 shows the format of the PDCP Data PDU with 18 bits PDCP SN.
This format is applicable for sidelink DRBs for unicast.
Figure 6.2.2.7-1: PDCP Data PDU format for sidelink DRBs for unicast with 18
bits PDCP SN
### 6.2.3 Control PDU
#### 6.2.3.1 Control PDU for PDCP status report
Figure 6.2.3.1-1 shows the format of the PDCP Control PDU carrying one PDCP
status report. This format is applicable for UM DRBs and AM DRBs (including
sidelink DRBs for unicast).
Figure 6.2.3.1-1: PDCP Control PDU format for PDCP status report
#### 6.2.3.2 Control PDU for interspersed ROHC feedback
Figure 6.2.3.2-1 shows the format of the PDCP Control PDU carrying one
interspersed ROHC feedback. This format is applicable for UM DRBs and AM DRBs
(including sidelink DRBs for unicast).
Figure 6.2.3.2-1: PDCP Control PDU format for interspersed ROHC feedback
#### 6.2.3.3 Control PDU for EHC feedback
Figure 6.2.3.3-1 shows the format of the PDCP Control PDU carrying one EHC
feedback. This format is applicable for UM DRBs and AM DRBs.
Figure 6.2.3.3-1: PDCP Control PDU format for EHC feedback
## 6.3 Parameters
### 6.3.1 General
If not otherwise mentioned in the definition of each field then the bits in
the parameters shall be interpreted as follows: the left most bit string is
the first and most significant and the right most bit is the last and least
significant bit.
Unless otherwise mentioned, integers are encoded in standard binary encoding
for unsigned integers. In all cases the bits appear ordered from MSB to LSB
when read in the PDU.
### 6.3.2 PDCP SN
Length: 12 or 18 bits as indicated in table 6.3.2-1. The length of the PDCP SN
is configured by upper layers (_pdcp-SN-SizeUL,_ _pdcp-SN-SizeDL, or sl-PDCP-
SN-Size_ in TS 38.331 [3]).
Table 6.3.2-1: PDCP SN length
* * *
Length Description 12 UM DRBs, AM DRBs, and SRBs (including sidelink DRBs and
sidelink SRBs) 18 UM DRBs, and AM DRBs (including sidelink DRBs for unicast)
* * *
NOTE: For NR sidelink communication for groupcast and broadcast, only 12 bits
PDCP SN length is used for the sidelink DRBs.
### 6.3.3 Data
Length: Variable
This field includes one of the followings:
\- Uncompressed PDCP SDU (user plane data, or control plane data);
\- Compressed PDCP SDU (user plane data only).
NOTE: All fields other than PDCP PDU header and MAC-I belong to Data field.‎
### 6.3.4 MAC-I
Length: 32 bits
This field carries a message authentication code calculated as specified in
clause 5.9.
For SRBs for Uu interface, the MAC-I field is always present. If integrity
protection is not configured, the MAC-I field is still present but should be
padded with padding bits set to 0.
For sidelink SRB1, SRB2 and SRB3, the MAC-I field is present only when the
sidelink SRB1, SRB2 and SRB3 are configured with integrity ‎protection‎.‎
For DRBs (including sidelink DRBs for unicast), the MAC-I field is present
only when the DRB is configured with integrity protection.
### 6.3.5 COUNT
Length: 32 bits
The COUNT value is composed of a HFN and the PDCP SN. The size of the HFN part
in bits is equal to 32 minus the length of the PDCP SN.
Figure 6.3.5-1: Format of COUNT
NOTE: COUNT does not wrap around.
### 6.3.6 R
Length: 1 bit
Reserved. In this version of the specification reserved bits shall be set to
0. Reserved bits shall be ignored by the receiver.
### 6.3.7 D/C
Length: 1 bit
This field indicates whether the corresponding PDCP PDU is a PDCP Data PDU or
a PDCP Control PDU.
Table 6.3.7-1: D/C field
* * *
Bit Description 0 Control PDU 1 Data PDU
* * *
### 6.3.8 PDU type
Length: 3 bits
This field indicates the type of control information included in the
corresponding PDCP Control PDU.
Table 6.3.8-1: PDU type
* * *
Bit Description 000 PDCP status report 001 Interspersed ROHC feedback 010 EHC
feedback 011-111 Reserved
* * *
### 6.3.9 FMC
Length: 32 bits
First Missing COUNT. This field indicates the COUNT value of the first missing
PDCP SDU within the reordering window, i.e. RX_DELIV.
### 6.3.10 Bitmap
Length: Variable. The length of the bitmap field can be 0.
This field indicates which SDUs are missing and which SDUs are correctly
received in the receiving PDCP entity. The bit position of N^th^ bit in the
Bitmap is N, i.e., the bit position of the first bit in the Bitmap is 1.
Table 6.3.10-1 Bitmap
* * *
Bit Description 0 PDCP SDU with COUNT = (FMC + bit position) modulo 2^32^ is
missing. 1 PDCP SDU with COUNT = (FMC + bit position) modulo 2^32^ is
correctly received.
* * *
### 6.3.11 Interspersed ROHC feedback
Length: Variable
This field contains one ROHC packet with only feedback, i.e. a ROHC packet
that is not associated with a PDCP SDU as defined in clause 5.7.4.
### 6.3.12 SDU Type
Length: 3 bits
PDCP SDU type, i.e. Layer-3 Protocol Data Unit type as specified in [13]. PDCP
entity may handle the SDU differently per SDU Type, e.g. ROHC is applicable to
IP SDU but not Non-IP SDU.
Table 6.3.12-1: SDU Type
* * *
Bit Description 000 IP 001 Non-IP 010-111 Reserved
* * *
### 6.3.13 K~NRP-sess~ ID
Length: 16 bits
K~NRP-sess~ Identity as specified in TS 33.536 [14].
For the SLRB that does not need integrity and ciphering protection, the UE
shall set K~NRP-sess~ ID to \"0\" in the PDCP PDU header.
# 7 State variables, constants, and timers
## 7.1 State variables
This clause describes the state variables used in PDCP entities in order to
specify the PDCP protocol. The state variables defined in this clause are
normative.
All state variables are non-negative integers, and take values from 0 to
[2^32^ -- 1].
PDCP Data PDUs are numbered integer sequence numbers (SN) cycling through the
field: 0 to [2^[_pdcp-SN-SizeUL_]^ -- 1] or 0 to [2^[_pdcp-SN-SizeDL_]^ -- 1]
or 0 to [2^[_sl-PDCP-SN-Size_]^ -- 1].
The transmitting PDCP entity shall maintain the following state variables:
a) TX_NEXT
This state variable indicates the COUNT value of the next PDCP SDU to be
transmitted. The initial value is 0, except for SRBs configured with state
variables continuation. For target SRB configured with state variables
continuation, the initial value is the value stored in PDCP entity for the
corresponding source SRB. For source SRB configured with state variables
continuation, the initial value is the value stored in PDCP entity for the
corresponding target SRB.
The receiving PDCP entity shall maintain the following state variables:
a) RX_NEXT
This state variable indicates the COUNT value of the next PDCP SDU expected to
be received. The initial value is 0, except for sidelink broadcast and
groupcast, and for SRBs configured with state variables continuation. For NR
sidelink communication for broadcast and groupcast, the initial value of the
SN part of RX_NEXT is (x +1) modulo (2^[_sl-PDCP-SN-Size_]^), where x is the
SN of the first received PDCP Data PDU. For target SRB configured with state
variables continuation, the initial value is the value stored in PDCP entity
for the corresponding source SRB. For source SRB configured with state
variables continuation, the initial value is the value stored in PDCP entity
for the corresponding target SRB.
NOTE: For NR sidelink communication for broadcast and groupcast, it is up to
UE implementation to select the HFN part for RX_NEXT such that initial value
of RX_DELIV should be a positive value.
b) RX_DELIV
This state variable indicates the COUNT value of the first PDCP SDU not
delivered to the upper layers, but still waited for. The initial value is 0,
except for sidelink broadcast and groupcast, and for SRBs configured with
state variables continuation. For NR sidelink communication for broadcast and
groupcast, the initial value of the SN part of RX_DELIV is (x -- 0.5 × 2^[_sl-
PDCP-SN-Size_ \--1]^) modulo (2^[_sl-PDCP-SN-Size_]^), where x is the SN of
the first received PDCP Data PDU. For target SRB configured with state
variables continuation, the initial value is the value stored in PDCP entity
for the corresponding source SRB. For source SRB configured with state
variables continuation, the initial value is the value stored in PDCP entity
for the corresponding target SRB.
c) RX_REORD
This state variable indicates the COUNT value following the COUNT value
associated with the PDCP Data PDU which triggered _t-Reordering_. For target
SRB configured with state variables continuation, the initial value is the
value stored in PDCP entity for the corresponding source SRB. For source SRB
configured with state variables continuation, the initial value is the value
stored in PDCP entity for the corresponding target SRB.
## 7.2 Constants
a) Window_Size
This constant indicates the size of the reordering window. The value equals to
2^[_pdcp-SN-SizeDL_]\ --\ 1^ for SRB/DRB and 2^[_sl-PDCP-SN-Size_]\ --\ 1^ for
SLRB.
## 7.3 Timers
The transmitting PDCP entity shall maintain the following timers:
a) _discardTimer_
This timer is configured only for DRBs. The duration of the timer is
configured by upper layers TS 38.331 [3]. In the transmitter, a new timer is
started upon reception of an SDU from upper layer.
The receiving PDCP entity shall maintain the following timers:
b) _t-Reordering_
The duration of the timer is configured by upper layers TS 38.331 [3], except
for the case of NR sidelink communication. For NR sidelink communication, the
_t-Reordering_ timer is determined by the UE implementation. This timer is
used to detect loss of PDCP Data PDUs as specified in clause 5.2.2. If _t-
Reordering_ is running, _t-Reordering_ shall not be started additionally, i.e.
only one _t-Reordering_ per receiving PDCP entity is running at a given time.
###### ## Annex A (normative): Ethernet Header Compression (EHC) protocol
## A.1 EHC principle
The Ethernet header compression (EHC) protocol compresses Ethernet header as
shown in Figure A.1-1 [15]. The fields that are compressed (i.e. removed from
the Ethernet header) by the EHC protocol are: DESTINATION ADDRESS, SOURCE
ADDRESS, 802.1Q TAG, and LENGTH/TYPE. The fields PREAMBLE, SFD, and FCS are
not transmitted in 3GPP system, and thus not considered in EHC protocol. There
may be more than one 802.1Q TAG fields in the Ethernet header, and all are
compressed by the EHC protocol. The padding (PAD) is not compressed by the EHC
protocol.
Figure A.1-1: Ethernet packet format [15]
The EHC compressor and the EHC decompressor store original header field
information as a \"EHC context\". Each EHC context is identified by a unique
identifier, called Context ID (CID). The EHC context must be synchronized
between the EHC compressor and the EHC decompressor; otherwise, the EHC
decompressor erroneously decompresses the \"Compressed Header (CH)\" packets.
For an Ethernet packet stream, the EHC compressor establishes the EHC context
and associates it with the CID. Then, the EHC compressor transmits the \"Full
Header (FH)\" packet to the EHC decompressor including the associated CID. The
EHC compressor keeps transmitting the FH packets until the EHC feedback is
received from the EHC decompressor.
NOTE: If the maximum number of EHC contexts are already established for the
compressed flows and a new Ethernet flow does not match any established EHC
context, the compressor should associate the new Ethernet flow with one of the
EHC CIDs allocated for the existing compressed flows or send PDCP SDUs
belonging to the Ethernet flow as uncompressed packet.
When the EHC decompressor receives the FH packet, the EHC decompressor
establishes the EHC context identified by the CID, and transmits the EHC
feedback to the EHC compressor to indicate that the EHC context associated
with the CID is successfully established in the EHC decompressor.
After receiving the EHC feedback, the EHC compressor starts to transmit the CH
packets to the EHC decompressor including the associated CID. The CH packet
includes only the header fields not stored in the EHC context.
When the EHC decompressor receives the CH packet, the EHC decompressor
restores original header fields based on the stored EHC context identified by
the associated CID.
Figure A.1-2 represents a conceptual view of EHC operation.
Figure A.1-2: EHC operation
## A.2 EHC packet format and parameters
### A.2.1 EHC packet format
#### A.2.1.1 EHC Full Header packet and EHC Compressed Header packet
Figure A.2.1.1-1 and Figure A.2.1.1-2 show the formats of EHC FH packet and
EHC CH packet, respectively.
Figure A.2.1.1-1: EHC Full Header packet format
Figure A.2.1.1-2: EHC Compressed Header packet format
#### A.2.1.2 EHC feedback packet
Figure A.2.1.2-1 shows the format of the EHC feedback packet.
Figure A.2.1.2-1: EHC feedback packet format
### A.2.2 Parameters
#### A.2.2.1 F/C
Length: 1 bit
This field indicates whether the corresponding EHC packet is a FH packet or a
CH packet.
Table A.2.2.1-1: F/C field
* * *
Bit Description 0 FH packet 1 CH packet
* * *
#### A.2.2.2 CID
Length: 7, or 15 bits. The length of the CID is configured by upper layers
(_ehc-CID-Length_ in TS 38.331 [3]).
The CID = \"all zeros\" indicates that the corresponding Ethernet header is
\"uncompressed\". The EHC decompressor does not establish the EHC context
identified by the CID = \"all zeros\".
#
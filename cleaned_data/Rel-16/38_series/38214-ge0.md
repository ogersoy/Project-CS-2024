# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies and establishes the characteristics of the
physicals layer procedures of data channels for 5G-NR.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\"
[2] 3GPP TS 38.201: \" NR; Physical Layer -- General Description\"
[3] 3GPP TS 38.202: \"NR; Services provided by the physical layer\"
[4] 3GPP TS 38.211: \"NR; Physical channels and modulation\"
[5] 3GPP TS 38.212: \"NR; Multiplexing and channel coding\"
[6] 3GPP TS 38.213: \"NR; Physical layer procedures for control\"
[7] 3GPP TS 38.215: \"NR; Physical layer measurements\"
[8] 3GPP TS 38.101: \"NR; User Equipment (UE) radio transmission and
reception\"
[9] 3GPP TS 38.104: \"NR; Base Station (BS) radio transmission and reception\"
[10] 3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol
specification\"
[11] 3GPP TS 38.133: \"NR; Requirements for support of radio resource
management\"
[12] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\"
[13] 3GPP TS 38.306: \"NR; User Equipment (UE) radio access capabilities\"
[14] 3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\"
[15] 3GPP TS 36.211: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical channels and modulation\"
[16] 3GPP TS 37.213: \"Physical layer procedures for shared spectrum channel
access\"
[17] 3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\"
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
BWP Bandwidth part
CBG Code block group
CLI Cross Link Interference
CP Cyclic prefix
CQI Channel quality indicator
CPU CSI processing unit
CRB Common resource block
CRC Cyclic redundancy check
CRI CSI-RS Resource Indicator
CSI Channel state information
CSI-RS Channel state information reference signal
CSI-RSRP CSI reference signal received power
CSI-RSRQ CSI reference signal received quality
CSI-SINR CSI signal-to-noise and interference ratio
CW Codeword
DCI Downlink control information
DL Downlink
DM-RS Demodulation reference signals
DRX Discontinuous Reception
EPRE Energy per resource element
IAB-MT Integrated Access and Backhaul -- Mobile Terminal
L1-RSRP Layer 1 reference signal received power
LI Layer Indicator
MCS Modulation and coding scheme
PDCCH Physical downlink control channel
PDSCH Physical downlink shared channel
PSS Primary Synchronisation signal
PUCCH Physical uplink control channel
QCL Quasi co-location
PMI Precoding Matrix Indicator
PRB Physical resource block
PRG Precoding resource block group
PRS Positioning reference signal
PT-RS Phase-tracking reference signal
RB Resource block
RBG Resource block group
RI Rank Indicator
RIV Resource indicator value
RS Reference signal
SCI Sidelink control information
SLIV Start and length indicator value
SR Scheduling Request
SRS Sounding reference signal
SS Synchronisation signal
SSS Secondary Synchronisation signal
SS-RSRP SS reference signal received power
SS-RSRQ SS reference signal received quality
SS-SINR SS signal-to-noise and interference ratio
TB Transport Block
TCI Transmission Configuration Indicator
TDM Time division multiplexing
UE User equipment
UL Uplink
# 4 Power control
Throughout this specification, unless otherwise noted, statements using the
term \"UE\" in clauses 4, 5, or 6 are equally applicable to the IAB-MT part of
an IAB node.
## 4.1 Power allocation for downlink
The gNB determines the downlink transmit EPRE.
For the purpose of SS-RSRP, SS-RSRQ and SS-SINR measurements, the UE may
assume downlink EPRE is constant across the bandwidth. For the purpose of SS-
RSRP, SS-RSRQ and SS-SINR measurements, the UE may assume downlink EPRE is
constant over SSS carried in different SS/PBCH blocks. For the purpose of SS-
RSRP, SS-RSRQ and SS-SINR measurements, the UE may assume that the ratio of
SSS EPRE to PBCH DM-RS EPRE is 0 dB.
For the purpose of CSI-RSRP, CSI-RSRQ and CSI-SINR measurements, the UE may
assume downlink EPRE of a port of CSI-RS resource configuration is constant
across the configured downlink bandwidth and constant across all configured
OFDM symbols.
The downlink SS/PBCH SSS EPRE can be derived from the SS/PBCH downlink
transmit power given by the parameter _ss-PBCH-BlockPower_ provided by higher
layers. The downlink SSS transmit power is defined as the linear average over
the power contributions (in [W]) of all resource elements that carry the SSS
within the operating system bandwidth.
The downlink CSI-RS EPRE can be derived from the SS/PBCH block downlink
transmit power given by the parameter _ss-PBCH-BlockPower_ and CSI-RS power
offset given by the parameter _powerControlOffsetSS_ provided by higher
layers. The downlink reference-signal transmit power is defined as the linear
average over the power contributions (in [W]) of the resource elements that
carry the configured CSI-RS within the operating system bandwidth.
For downlink DM-RS associated with PDSCH, the UE may assume the ratio of PDSCH
EPRE to DM-RS EPRE ( [dB]) is given by Table 4.1-1 according to the number of
DM-RS CDM groups without data as described in Clause 5.1.6.2. The DM-RS
scaling factor specified in Clause 7.4.1.1.2 of [4, TS 38.211] is given by .
Table 4.1-1: The ratio of PDSCH EPRE to DM-RS EPRE
Number of DM-RS CDM groups without data DM-RS configuration type 1 DM-RS
configuration type 2
* * *
1 0 dB 0 dB 2 -3 dB -3 dB 3 - -4.77 dB
When the UE is scheduled with one or two PT-RS ports associated with the
PDSCH,
\- if the UE is configured with the higher layer parameter _epre-Ratio_ , the
ratio of PT-RS EPRE to PDSCH EPRE per layer per RE for each PT-RS port () is
given by Table 4.1-2 according to the _epre-Ratio_ , the PT-RS scaling factor
specified in clause 7.4.1.2.2 of [4, TS 38.211] is given by.
\- otherwise, the UE shall assume _epre-Ratio_ is set to state \'0\' in Table
4.1-2 if not configured.
Table 4.1-2: PT-RS EPRE to PDSCH EPRE per layer per RE ()
_epre-Ratio_ The number of PDSCH layers with DM-RS associated to the PT-RS
port
* * *
                 1                                                                    2   3      4   5   6
0 0 3 4.77 6 7 7.78 1 0 0 0 0 0 0 2 reserved  
3 reserved
For link recovery, as described in clause 6 of [6, TS 38.213] the ratio of the
PDCCH EPRE to NZP CSI-RS EPRE is assumed as 0 dB.
# 5 Physical downlink shared channel related procedures
## 5.1 UE procedure for receiving the physical downlink shared channel
For downlink, a maximum of 16 HARQ processes per cell is supported by the UE.
The number of processes the UE may assume will at most be used for the
downlink is configured to the UE for each cell separately by higher layer
parameter _nrofHARQ-ProcessesForPDSCH_ , and when no configuration is provided
the UE may assume a default number of 8 processes.
A UE shall upon detection of a PDCCH with a configured DCI format 1_0, 1_1 or
1_2 decode the corresponding PDSCHs as indicated by that DCI. For any HARQ
process ID(s) in a given scheduled cell, the UE is not expected to receive a
PDSCH that overlaps in time with another PDSCH. The UE is not expected to
receive another PDSCH for a given HARQ process until after the end of the
expected transmission of HARQ-ACK for that HARQ process, where the timing is
given by Clause 9.2.3 of [6]. Except for the case when a UE is configured by
higher layer parameter _PDCCH-Config_ that contains two different values of
_coresetPoolIndex_ in _ControlResourceSet_ and PDCCHs that schedule two PDSCHs
are associated to different _ControlResourceSets_ having different values of
_coresetPoolIndex,_ in a given scheduled cell, the UE is not expected to
receive a first PDSCH and a second PDSCH, starting later than the first PDSCH,
with its corresponding HARQ-ACK assigned to be transmitted on a resource
ending before the start of a different resource for the HARQ-ACK assigned to
be transmitted for the first PDSCH, where the two resources are in different
slots for the associated HARQ-ACK transmissions, each slot is composed of
symbols [4] or a number of symbols indicated by _subslotLengthForPUCCH_ if
provided, and the HARQ-ACK for the two PDSCHs are associated with the HARQ-ACK
codebook of the same priority. Except for the case when a UE is configured by
higher layer parameter _PDCCH-Config_ that contains two different values of
_coresetPoolIndex_ in _ControlResourceSet_ and PDCCHs that schedule two PDSCHs
are associated to different _ControlResourceSets_ having different values of
_coresetPoolIndex,_ in a given scheduled cell, the UE is not expected to
receive a first PDSCH, and a second PDSCH, starting later than the first
PDSCH, with its corresponding HARQ-ACK assigned to be transmitted on a
resource ending before the start of a different resource for the HARQ-ACK
assigned to be transmitted for the first PDSCH if the HARQ-ACK for the two
PDSCHs are associated with HARQ-ACK codebooks of different priorities. For any
two HARQ process IDs in a given scheduled cell, if the UE is scheduled to
start receiving a first PDSCH starting in symbol _j_ by a PDCCH ending in
symbol _i_ , the UE is not expected to be scheduled to receive a PDSCH
starting earlier than the end of the first PDSCH with a PDCCH that ends later
than symbol _i_. In a given scheduled cell, for any PDSCH corresponding to SI-
RNTI, the UE is not expected to decode a re-transmission of an earlier PDSCH
with a starting symbol less than _N_ symbols after the last symbol of that
PDSCH, where the value of _N_ depends on the PDSCH subcarrier spacing
configuration _μ,_ with _N_ =13 for _μ_ =0, _N_ =13 for _μ_ =1, _N_ =20 for
_μ_ =2, and _N_ =24 for _μ_ =3.
When receiving PDSCH scheduled with SI-RNTI or P-RNTI, the UE may assume that
the DM-RS port of PDSCH is quasi co-located with the associated SS/PBCH block
with respect to Doppler shift, Doppler spread, average delay, delay spread,
spatial RX parameters when applicable.
When receiving PDSCH scheduled with RA-RNTI, or MSGB-RNTI, the UE may assume
that the DM-RS port of PDSCH is quasi co-located with the SS/PBCH block or the
CSI-RS resource the UE used for RACH association as applicable, and
transmission with respect to Doppler shift, Doppler spread, average delay,
delay spread, spatial RX parameters when applicable. When receiving a PDSCH
scheduled with RA-RNTI in response to a random access procedure triggered by a
PDCCH order which triggers contention-free random access procedure for the
SpCell [10, TS 38.321], the UE may assume that the DM-RS port of the received
PDCCH order and the DM-RS ports of the corresponding PDSCH scheduled with RA-
RNTI are quasi co-located with the same SS/PBCH block or CSI-RS with respect
to Doppler shift, Doppler spread, average delay, delay spread, spatial RX
parameters when applicable.
When receiving PDSCH in response to a PUSCH transmission scheduled by a RAR UL
grant or corresponding PUSCH retransmission, or when receiving PDSCH in
response to a PUSCH for Type-2 random access procedure, or a PUSCH scheduled
by a fallbackRAR UL grant or corresponding PUSCH retransmission, the UE may
assume that the DM-RS port of PDSCH is quasi co-located with the SS/PBCH block
the UE selected for RACH association and transmission with respect to Doppler
shift, Doppler spread, average delay, delay spread, spatial RX parameters when
applicable.
If the UE is not configured for PUSCH/PUCCH transmission for at least one
serving cell configured with slot formats comprised of DL and UL symbols, and
if the UE is not capable of simultaneous reception and transmission on serving
cell _c~1~_ and serving cell _c~2~_ , the UE is not expected to receive PDSCH
on serving cell _c~1~_ if the PDSCH overlaps in time with SRS transmission
(including any interruption due to uplink or downlink RF retuning time [10])
on serving cell _c~2~_ not configured for PUSCH/PUCCH transmission.
The UE is not expected to decode a PDSCH in a serving cell scheduled by a
PDCCH with C-RNTI, CS-RNTI or MCS-C-RNTI and one or multiple PDSCH(s) required
to be received according to this Clause in the same serving cell without a
corresponding PDCCH transmission if the PDSCHs partially or fully overlap in
time except if the PDCCH scheduling the PDSCH ends at least 14 symbols before
the earliest starting symbol of the PDSCH(s) without the corresponding PDCCH
transmission, where the symbol duration is based on the smallest numerology
between the scheduling PDCCH and the PDSCH, in which case the UE shall decode
the PDSCH scheduled by the PDCCH.
The UE is not expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, or
CS-RNTI if another PDSCH in the same cell scheduled with RA-RNTI or MSGB-RNTI
partially or fully overlap in time.
The UE in RRC_IDLE and RRC_INACTIVE modes shall be able to decode two PDSCHs
each scheduled with SI-RNTI, P-RNTI, RA-RNTI or TC-RNTI, with the two PDSCHs
partially or fully overlapping in time in non-overlapping PRBs.
On a frequency range 1 cell, the UE shall be able to decode a PDSCH scheduled
with C-RNTI, MCS-C-RNTI, or CS-RNTI and, during a process of P-RNTI triggered
SI acquisition, another PDSCH scheduled with SI-RNTI that partially or fully
overlap in time in non-overlapping PRBs, unless the PDSCH scheduled with
C-RNTI, MCS-C-RNTI, or CS-RNTI requires Capability 2 processing time according
to clause 5.3 in which case the UE may skip decoding of the scheduled PDSCH
with C-RNTI, MCS-C-RNTI, or CS-RNTI.
On a frequency range 2 cell, the UE is not expected to decode a PDSCH
scheduled with C-RNTI, MCS-C-RNTI, or CS-RNTI if in the same cell, during a
process of P-RNTI triggered SI acquisition, another PDSCH scheduled with SI-
RNTI partially or fully overlap in time.
The UE is expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, or CS-
RNTI during a process of autonomous SI acquisition.
If the UE is configured by higher layers to decode a PDCCH with its CRC
scrambled by a CS-RNTI, the UE shall receive PDSCH transmissions without
corresponding PDCCH transmissions using the higher-layer-provided PDSCH
configuration for those PDSCHs.
If a UE is configured by higher layer parameter _PDCCH-Config_ that contains
two different values of _coresetPoolIndex_ in _ControlResourceSet_ , the UE
may expect to receive multiple PDCCHs scheduling fully/partially/non-
overlapped PDSCHs in time and frequency domain. The UE may expect the
reception of full/partially-overlapped PDSCHs in time, only when PDCCHs that
schedule two PDSCHs are associated to different _ControlResourceSets_ having
different values of _coresetPoolIndex_. For a _ControlResourceSet_ without
_coresetPoolIndex_ , the UE may assume that the _ControlResourceSet_ is
assigned with _coresetPoolIndex_ as 0. When the UE is scheduled with
full/partially/non-overlapped PDSCHs in time and frequency domain, the full
scheduling information for receiving a PDSCH is indicated and carried only by
the corresponding PDCCH, the UE is expected to be scheduled with the same
active BWP and the same SCS. When the UE is scheduled with full/partially-
overlapped PDSCHs in time and frequency domain, the UE can be scheduled with
at most two codewords simultaneously. When PDCCHs that schedule two PDSCHs are
associated to different _ControlResourceSets_ having different values of
_coresetPoolIndex,_ the following operations are allowed:
\- For any two HARQ process IDs in a given scheduled cell, if the UE is
scheduled to start receiving a first PDSCH starting in symbol _j_ by a PDCCH
associated with a value of _coresetPoolIndex_ ending in symbol _i_ , the UE
can be scheduled to receive a PDSCH starting earlier than the end of the first
PDSCH with a PDCCH associated with a different value of _coresetPoolIndex_
that ends later than symbol _i_.
\- In a given scheduled cell, the UE can receive a first PDSCH in slot _i_ ,
with the corresponding HARQ-ACK assigned to be transmitted in slot _j_ , and a
second PDSCH associated with a value of _coresetPoolIndex_ different from that
of the first PDSCH starting later than the first PDSCH with its corresponding
HARQ-ACK assigned to be transmitted in a slot before slot _j_.
If PDCCHs that schedule corresponding PDSCHs are associated to the same or
different _ControlResourceSets_ having the same value of _coresetPoolIndex_ ,
the UE procedure for receiving the PDSCH upon detection of a PDCCH follows
Clause 5.1.
A UE does not expect to be configured with _repetitionScheme_ if the UE is
configured with higher layer parameter _repetitionNumber._
When a UE is configured by higher layer parameter _repetitionScheme_ set to
one of \'_fdmSchemeA\'_ , \'_fdmSchemeB\'_ , \'_tdmSchemeA\'_ , if the UE is
indicated with two TCI states in a codepoint of the DCI field _\'Transmission
Configuration Indication\'_ and DM-RS port(s) within one CDM group in the DCI
field \'_Antenna Port(s)\'_.
\- When two TCI states are indicated in a DCI and the UE is set to
\'_fdmSchemeA\',_ the UE shall receive a single PDSCH transmission occasion of
the TB with each TCI state associated to a non-overlapping frequency domain
resource allocation as described in Clause 5.1.2.3.
\- When two TCI states are indicated in a DCI and the UE is set to
\'_fdmSchemeB\'_ , the UE shall receive two PDSCH transmission occasions of
the same TB with each TCI state associated to a PDSCH transmission occasion
which has non-overlapping frequency domain resource allocation with respect to
the other PDSCH transmission occasion as described in Clause 5.1.2.3.
\- When two TCI states are indicated in a DCI and the UE is set to
\'_tdmSchemeA\'_ , the UE shall receive two PDSCH transmission occasions of
the same TB with each TCI state associated to a PDSCH transmission occasion
which has non-overlapping time domain resource allocation with respect to the
other PDSCH transmission occasion and both PDSCH transmission occasions shall
be received within a given slot as described in Clause 5.1.2.1.
When a UE is configured by the higher layer parameter _repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation_ , the UE may expect to be indicated with
one or two TCI states in a codepoint of the DCI field _\'Transmission
Configuration Indication\'_ together with the DCI field \'_Time domain
resource assignment_ \' indicating an entry _which contains repetitionNumber_
in _PDSCH-TimeDomainResourceAllocation_ and DM-RS port(s) within one CDM group
in the DCI field \'_Antenna Port(s)\'_.
\- When two TCI states are indicated in a DCI with \'_Transmission
Configuration Indication_ \' field, the UE may expect to receive multiple slot
level PDSCH transmission occasions of the same TB with two TCI states used
across multiple PDSCH transmission occasions in the _repetitionNumber_
consecutive slots as defined in Clause 5.1.2.1.
\- When one TCI state is indicated in a DCI with \'_Transmission Configuration
Indication_ \' field, the UE may expect to receive multiple slot level PDSCH
transmission occasions of the same TB with one TCI state used across multiple
PDSCH transmission occasions in the _repetitionNumber_ consecutive slots as
defined in Clause 5.1.2.1.
When a UE is not indicated with a DCI that DCI field \'_Time domain resource
assignment_ \' indicating an entry _which contains repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation_ , and it is indicated with two TCI states
in a codepoint of the DCI field _\'Transmission Configuration Indication\'_
and DM-RS port(s) within two CDM groups in the DCI field \'_Antenna Port(s)\'_
, the UE may expect to receive a single PDSCH where the association between
the DM-RS ports and the TCI states are as defined in Clause 5.1.6.2.
When a UE is not indicated with a DCI that DCI field \'_Time domain resource
assignment_ \' indicating an entry _which contains repetitionNumber_ in
_PDSCH-TimeDomainResourceAllocation_ , and it is indicated with one TCI states
in a codepoint of the DCI field _\'Transmission Configuration Indication\',_
the UE procedure for receiving the PDSCH upon detection of a PDCCH follows
Clause 5.1.
If more than one PDSCH on a serving cell each without a corresponding PDCCH
transmission are in a slot, after resolving overlapping with symbols in the
slot indicated as uplink by _tdd-UL-DL-ConfigurationCommon_ , or by _tdd-UL-
DL-ConfigurationDedicated_ , a UE receives one or more PDSCHs without
corresponding PDCCH transmissions in the slot as specified below.
‒ Step 0: set _j=0_ , where _j_ is the number of selected PDSCH(s) for
decoding. _Q_ is the set of activated PDSCHs without corresponding PDCCH
transmissions within the slot
‒ Step 1: A UE receives one PDSCH with the lowest configured _sps-ConfigIndex_
within _Q_ , set _j=j+1_. Designate the received PDSCH as survivor PDSCH.
‒ Step 2: The survivor PDSCH in step 1 and any other PDSCH(s) overlapping
(even partially) with the survivor PDSCH in step 1 are excluded from _Q_.
‒ Step 3: Repeat step 1 and 2 until _Q_ is empty or _j_ is equal to the number
of unicast PDSCHs in a slot supported by the UE
### 5.1.1 Transmission schemes
Only one transmission scheme is defined for the PDSCH, and is used for all
PDSCH transmissions.
#### 5.1.1.1 Transmission scheme 1
For transmission scheme 1 of the PDSCH, the UE may assume that a gNB
transmission on the PDSCH would be performed with up to 8 transmission layers
on antenna ports 1000-1011 as defined in Clause 7.3.1.4 of [4, TS 38.211],
subject to the DM-RS reception procedures in Clause 5.1.6.2.
### 5.1.2 Resource allocation
#### 5.1.2.1 Resource allocation in time domain
When the UE is scheduled to receive PDSCH by a DCI, the _Time domain resource
assignment_ field value _m_ of the DCI provides a row index _m_ \+ 1 to an
allocation table. The determination of the used resource allocation table is
defined in Clause 5.1.2.1.1. The indexed row defines the slot offset _K~0~_ ,
the start and length indicator _SLIV_ , or directly the start symbol _S_ and
the allocation length _L_ , and the PDSCH mapping type to be assumed in the
PDSCH reception.
Given the parameter values of the indexed row:
\- The slot allocated for the PDSCH is _K~s~_ , where , if UE is configured
with _ca-SlotOffset_ for at least one of the scheduled and scheduling cell,
and _K~s\ ~_ = {width="1.0284722222222222in" height="0.5145833333333333in"},
otherwise, and where _n_ is the slot with the scheduling DCI, and _K~0~_ is
based on the numerology of PDSCH, and and are the subcarrier spacing
configurations for PDSCH and PDCCH, respectively, and
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}$ are the $N_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset,_ for the cell receiving the PDCCH
respectively,$\ N_{\text{slot,\ offset,\
}\text{PD}\text{S}\text{CH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDSCH}}$ are the $N_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDSCH, as defined
in clause 4.5 of [4, TS 38.211].
\- The reference point _S~0~_ for starting symbol _S_ is defined as:
\- if configured with _referenceOfSLIVDCI-1-2_ , and when receiving PDSCH
scheduled by DCI format 1_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, CS-RNTI
with _K~0~=0_ , and PDSCH mapping Type B, the starting symbol _S_ is relative
to the starting symbol _S~0~_ of the PDCCH monitoring occasion where DCI
format 1_2 is detected;
\- otherwise, the starting symbol _S_ is relative to the start of the slot
using _S~0~=0._
\- The number of consecutive symbols _L_ counting from the starting symbol _S_
allocated for the PDSCH are determined from the start and length indicator
_SLIV_ :
if then
else
where, and
\- the PDSCH mapping type is set to Type A or Type B as defined in Clause
7.4.1.1.2 of [4, TS 38.211].
The UE shall consider the _S_ and _L_ combinations defined in table 5.1.2.1-1
satisfying for normal cyclic prefix and for extended cyclic prefix as valid
PDSCH allocations:
Table 5.1.2.1-1: Valid _S_ and _L_ combinations
+---------+---------+---------+---------+---------+---------+---------+ | PDSCH | Normal | E | | | | | | mapping | cyclic | xtended | | | | | | type | prefix | cyclic | | | | | | | | prefix | | | | | +=========+=========+=========+=========+=========+=========+=========+ | | _S_ | _L_ | _S+L_ | _S_ | _L_ | _S+L_ | +---------+---------+---------+---------+---------+---------+---------+ | Type A | {0 | {3, | {3, | {0 | {3, | {3, | | | ,1,2,3} | ...,14} | ...,14} | ,1,2,3} | ...,12} | ...,12} | | | | | | | | | | | (Note | | | (Note | | | | | 1) | | | 1) | | | +---------+---------+---------+---------+---------+---------+---------+ | Type B | {0, | {2, | {2, | {0, | {2,4,6} | {2, | | | ...,12} | ...,13} | ...,14} | ...,10} | | ...,12} | +---------+---------+---------+---------+---------+---------+---------+ | Note 1: | | | | | | | | S = 3 | | | | | | | | is | | | | | | | | app | | | | | | | | licable | | | | | | | | only if | | | | | | | | _dmrs-T | | | | | | | | ypeA-Po | | | | | | | | sition_ | | | | | | | | = 3 | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
When receiving PDSCH scheduled by DCI format 1_1 or 1_2 in PDCCH with CRC
scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI with NDI=1, if the UE is
configured with _pdsch-AggregationFactor_ in _pdsch-config_ , the same symbol
allocation is applied across the _pdsch-AggregationFactor_ consecutive slots.
When receiving PDSCH scheduled by DCI format 1_1 or 1_2 in PDCCH with CRC
scrambled by CS-RNTI with NDI=0, or PDSCH scheduled without corresponding
PDCCH transmission using _sps-Config_ and activated by DCI format 1_1 or 1_2,
the same symbol allocation is applied across the _pdsch-AggregationFactor_ ,
in _sps-Config_ if configured, or across the _pdsch-AggregationFactor_ in
_pdsch-config_ otherwise, consecutive slots. The UE may expect that the TB is
repeated within each symbol allocation among each of the _pdsch-
AggregationFactor_ consecutive slots and the PDSCH is limited to a single
transmission layer. For PDSCH scheduled by DCI format 1_1 or 1_2 in PDCCH with
CRC scrambled by CS-RNTI with NDI=0, or PDSCH scheduled without corresponding
PDCCH transmission using _sps-Config_ and activated by DCI format 1_1 or 1_2,
the UE is not expected to be configured with the time duration for the
reception of _pdsch-AggregationFactor_ repetitions, in _sps-Config_ if
configured, or across the _pdsch-AggregationFactor_ in _pdsch-config_
otherwise, larger than the time duration derived by the periodicity P obtained
from the corresponding _sps-Config_. The redundancy version to be applied on
the _n_ ^th^ transmission occasion of the TB, where _n_ = 0, 1, ..._pdsch-
AggregationFactor_ -1, is determined according to table 5.1.2.1-2 and
\"_rv~id~_ indicated by the DCI scheduling the PDSCH\" in table 5.1.2.1-2 is
assumed to be 0 for PDSCH scheduled without corresponding PDCCH transmission
using _sps-Config_ and activated by DCI format 1_1 or 1_2.
_If a UE is configured with higher layer parameter repetitionNumber or if the
UE is configured by repetitionScheme set to one of \' fdmSchemeA\', \'
fdmSchemeB\' and \'tdmSchemeA\', the_ UE does not expect to be configured with
_pdsch-AggregationFactor._
Table 5.1.2.1-2: Applied redundancy version when _pdsch-AggregationFactor_ is
present
_rv~id\ ~_ indicated by the DCI scheduling the PDSCH _rv~id~_ to be applied to
_n_ ^th^ transmission occasion
* * *
                                                        *n* mod 4 = 0                                             *n* mod 4 = 1   *n* mod 4 = 2   *n* mod 4 = 3
0 0 2 3 1 2 2 3 1 0 3 3 1 0 2 1 1 0 2 3
A PDSCH reception in a slot of a multi-slot PDSCH reception is omitted
according to the conditions in Clause 11.1 of [6, TS38.213].
The UE is not expected to receive a PDSCH with mapping type A in a slot, if
the PDCCH scheduling the PDSCH was received in the same slot and was not
contained within the first three symbols of the slot.
The UE is not expected to receive a PDSCH with mapping type B in a slot, if
the first symbol of the PDCCH scheduling the PDSCH was received in a later
symbol than the first symbol indicated in the PDSCH time domain resource
allocation.
When the UE is configured with _minimumSchedulingOffsetK0_ in an active DL BWP
it applies a minimum scheduling offset restriction indicated by the \'Minimum
applicable scheduling offset indicator\' field in DCI format 1_1 or DCI format
0_1 if the same field is available. When the UE is configured with
_minimumSchedulingOffsetK0_ in an active DL BWP and it has not received
\'Minimum applicable scheduling offset indicator\' field in DCI format 0_1 or
1_1, the UE shall apply a minimum scheduling offset restriction indicated
based on \'Minimum applicable scheduling offset indicator\' value \'0\'. When
the _minimum scheduling offset restriction_ is applied the UE is not expected
to be scheduled with a DCI in slot _n_ to receive a PDSCH scheduled with
C-RNTI, CS-RNTI or MCS-C-RNTI with _K_ ~0~ smaller than $\ \left\lceil
K_{0min} \cdot \frac{2^{\mu^{'}}}{2^{\mu}} \right\rceil$, where _K_ ~0min~ and
$\mu$ are the applied minimum scheduling offset restriction and the numerology
of the active DL BWP of the scheduled cell when receiving the DCI in slot _n,_
respectively, and $\mu^{'}$ is the numerology of the new active DL BWP in case
of active DL BWP change in the scheduled cell and is equal to $\mu$,
otherwise. The minimum scheduling offset restriction is not applied when PDSCH
transmission is scheduled with C-RNTI, CS-RNTI or MCS-C-RNTI in common search
space associated with CORESET0 and default PDSCH time domain resource
allocation is used, in the search space set provided by
_recoverySearchSpaceId_ when monitoring PDCCH as described in [6, TS 38.213]
or when PDSCH transmission is scheduled with SI-RNTI, MSGB-RNTI or RA-RNTI.
The application delay of the change of the minimum scheduling offset
restriction is determined in Clause 5.3.1.
The UE is not expected to be configured with _referenceOfSLIVDCI-1-2_ for
serving cells configured for cross-carrier scheduling with a scheduling cell
of a different downlink SCS configuration.
When a UE is configured by the higher layer parameter _repetitionScheme_ set
to \'_tdmSchemeA\'_ and indicated DM-RS port(s) within one CDM group in the
DCI field \'_Antenna Port(s)\'_ , the number of PDSCH transmission occasions
is derived by the number of TCI states indicated by the DCI field
_\'Transmission Configuration Indication\'_ of the scheduling DCI _._
\- If two TCI states are indicated by the DCI field \'_Transmission
Configuration Indication_ \', the UE is expected to receive two PDSCH
transmission occasions, where the first TCI state is applied to the first
PDSCH transmission occasion and resource allocation in time domain for the
first PDSCH transmission occasion follows Clause 5.1.2.1. The second TCI state
is applied to the second PDSCH transmission occasion, and the second PDSCH
transmission occasion shall have the same number of symbols as the first PDSCH
transmission occasion. If the UE is configured by the higher layers with a
value$\ \overline{K}$ in _StartingSymbolOffsetK_ , it shall determine that the
first symbol of the second PDSCH transmission occasion starts after
$\overline{K}$ symbols from the last symbol of the first PDSCH transmission
occasion. If the value$\ \overline{K}$ is not configured via the higher layer
parameter _StartingSymbolOffsetK_ , $\overline{K}$ = 0 shall be assumed by the
UE. The UE is not expected to receive more than two PDSCH transmission layers
for each PDSCH transmission occasion. For two PDSCH transmission occasions,
the redundancy version to be applied is derived according to Table 5.1.2.1-2,
where $n = 0,\ 1$ applied respectively to the first and second TCI state. The
UE expects the PDSCH mapping type indicated by DCI field \'_Time domain
resource assignment_ \' to be mapping type B, and the indicated PDSCH mapping
type is applied to both PDSCH transmission occasions.
\- Otherwise, the UE is expected to receive a single PDSCH transmission
occasion, and the resource allocation in the time domain follows Clause
5.1.2.1.
When a UE configured by the higher layer parameter _PDSCH-config_ that
indicates at least one entry _contains_ _repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ ,
\- If two TCI states are indicated by the DCI field \'Transmission
Configuration Indication\' together with the DCI field \'Time domain resource
assignment\' indicating an entry _which contains repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ and DM-RS port(s) within one CDM group in the
DCI field \'Antenna Port(s)\', the same SLIV is applied for all PDSCH
transmission occasions across the _repetitionNumber_ consecutive slots, the
first TCI state is applied to the first PDSCH transmission occasion and
resource allocation in time domain for the first PDSCH transmission occasion
follows Clause 5.1.2.1.
When the value indicated by _repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ equals to two, the second TCI state is applied
to the second PDSCH transmission occasion. When the value indicated by
_repetitionNumber_ in _PDSCH-TimeDomainResourceAllocation_ is larger than two,
the UE may be further configured to enable _cyclicMapping_ or
_sequenticalMapping_ in _tciMapping_.
\- When _cyclicMapping_ is enabled, the first and second TCI states are
applied to the first and second PDSCH transmission occasions, respectively,
and the same TCI mapping pattern continues to the remaining PDSCH transmission
occasions.
\- When _sequenticalMapping_ is enabled, first TCI state is applied to the
first and second PDSCH transmission occasions, and the second TCI state is
applied to the third and fourth PDSCH transmission occasions, and the same TCI
mapping pattern continues to the remaining PDSCH transmission occasions.
The UE may expect that each PDSCH transmission occasion is limited to two
transmission layers. For all PDSCH transmission occasions associated with the
first TCI state, the redundancy version to be applied is derived according to
Table 5.1.2.1-2, where $n$ is counted only considering PDSCH transmission
occasions associated with the first TCI state. The redundancy version for
PDSCH transmission occasions associated with the second TCI state is derived
according to Table 5.1.2.1-3, where additional shifting operation for each
redundancy version $\text{rv}_{s}\ $is configured by higher layer parameter
_sequenceOffsetforRV_ and $n$ is counted only considering PDSCH transmission
occasions associated with the second TCI state.
Table 5.1.2.1-3: Applied redundancy version for the second TCI state when
_sequenceOffsetforRV_ is present
_rv~id\ ~_ indicated by the DCI scheduling the PDSCH _rv~id~_ to be applied to
_n_ ^th^ transmission occasion with second TCI state
* * *
                                                        *n* mod 4 = 0                                                                   *n* mod 4 = 1                              *n* mod 4 = 2                              *n* mod 4 = 3
$$0$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(2 + \ \text{rv}_{s})\
\text{mod}\ 4$$ $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(1 + \
\text{rv}_{s})\ \text{mod}\ 4$$ $$2$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$
$$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(1 + \ \text{rv}_{s})\ \text{mod}\
4$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$3$$ $$(3 + \ \text{rv}_{s})\
\text{mod}\ 4$$ $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(0 + \
\text{rv}_{s})\ \text{mod}\ 4$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$1$$
$$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(0 + \ \text{rv}_{s})\ \text{mod}\
4$$ $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$ $$(3 + \ \text{rv}_{s})\
\text{mod}\ 4$$
\- If one TCI state is indicated by the DCI field \'Transmission Configuration
Indication\' together with the DCI field \'Time domain resource assignment\'
indicating an entry _which contains repetitionNumber_ in _PDSCH-
TimeDomainResourceAllocation_ and DM-RS port(s) within one CDM group in the
DCI field \'Antenna Port(s)\', the same SLIV is applied for all PDSCH
transmission occasions across the _repetitionNumber_ consecutive slots, the
first PDSCH transmission occasion follows Clause 5.1.2.1, the same TCI state
is applied to all PDSCH transmission occasions. The UE may expect that each
PDSCH transmission occasion is limited to two transmission layers. For all
PDSCH transmission occasions, the redundancy version to be applied is derived
according to Table 5.1.2.1-2, where $n$ is counted considering PDSCH
transmission occasions.
\- Otherwise, the UE is expected to receive a single PDSCH transmission
occasion, and the resource allocation in the time domain follows Clause
5.1.2.1.
##### 5.1.2.1.1 Determination of the resource allocation table to be used for
PDSCH
Table 5.1.2.1.1-1 and Table 5.1.2.1.1-1A define which PDSCH time domain
resource allocation configuration to apply. Either a default PDSCH time domain
allocation A, B or C according to tables 5.1.2.1.1-2, 5.1.2.1.1-3, 5.1.2.1.1-4
and 5.1.2.1.1-5 is applied, or the higher layer configured _pdsch-
TimeDomainAllocationList_ or _pdsch-TimeDomainAllocationListDCI-1-2_ is
applied. For operation with shared spectrum channel access, as described in
[16, TS 37.213], UE reinterprets _S_ and _L_ in row 9 of Table 5.1.2.1.1-2 as
_S=6_ and _L=7_.
Table 5.1.2.1.1-1: Applicable PDSCH time domain resource allocation for DCI
formats 1_0 and 1_1
+----------+----------+----------+----------+----------+----------+ | RNTI | PDCCH | SS/PBCH | _PDS |_ PDSCH | PDSCH | | | search | block | CH-Confi | -Config _| time | | | space | and | gCommon_ | includes | domain | | | | CORESET | includes | _pdsch-T | resource | | | | mult |_ pdsch-T | imeDomai | al | | | | iplexing | imeDomai | nAllocat | location | | | | pattern | nAllocat | ionList _| to apply | | | | | ionList_ | | | +==========+==========+==========+==========+==========+==========+ | SI-RNTI | Type0 | 1 | - | - | Default | | | common | | | | A for | | | | | | | normal | | | | | | | CP | +----------+----------+----------+----------+----------+----------+ | | | 2 | - | - | Default | | | | | | | B | +----------+----------+----------+----------+----------+----------+ | | | 3 | - | - | Default | | | | | | | C | +----------+----------+----------+----------+----------+----------+ | SI-RNTI | Type0A | 1 | No | - | Default | | | common | | | | A | +----------+----------+----------+----------+----------+----------+ | | | 2 | No | - | Default | | | | | | | B | +----------+----------+----------+----------+----------+----------+ | | | 3 | No | - | Default | | | | | | | C | +----------+----------+----------+----------+----------+----------+ | | | 1,2,3 | Yes | - | _pdsch- | | | | | | | TimeDoma | | | | | | | inAlloca | | | | | | | tionList | | | | | | | provided | | | | | | | in | | | | | | | PDS | | | | | | | CH-Confi | | | | | | | gCommon_ | +----------+----------+----------+----------+----------+----------+ | RA-RNTI, | Type1 | 1, 2, 3 | No | - | Default | | MS | common | | | | A | | GB-RNTI, | | | | | | | TC-RNTI | | | | | | +----------+----------+----------+----------+----------+----------+ | | | 1, 2, 3 | Yes | - | _pdsch-T | | | | | | | imeDomai | | | | | | | nAllocat | | | | | | | ionList_ | | | | | | | provided | | | | | | | in | | | | | | | _PDS | | | | | | | CH-Confi | | | | | | | gCommon_ | +----------+----------+----------+----------+----------+----------+ | P-RNTI | Type2 | 1 | No | - | Default | | | common | | | | A | +----------+----------+----------+----------+----------+----------+ | | | 2 | No | - | Default | | | | | | | B | +----------+----------+----------+----------+----------+----------+ | | | 3 | No | - | Default | | | | | | | C | +----------+----------+----------+----------+----------+----------+ | | | 1,2,3 | Yes | - | _pdsch- | | | | | | | TimeDoma | | | | | | | inAlloca | | | | | | | tionList | | | | | | | provided | | | | | | | in | | | | | | | PDS | | | | | | | CH-Confi | | | | | | | gCommon_ | +----------+----------+----------+----------+----------+----------+ | C-RNTI, | Any | 1, 2, 3 | No | - | Default | | MCS | common | | | | A | | -C-RNTI, | search | | | | | | CS-RNTI | space | | | | | | | as | | | | | | | sociated | | | | | | | with | | | | | | | CORESET | | | | | | | 0 | | | | | +----------+----------+----------+----------+----------+----------+ | | | 1, 2, 3 | Yes | - | _pdsch-T | | | | | | | imeDomai | | | | | | | nAllocat | | | | | | | ionList_ | | | | | | | provided | | | | | | | in | | | | | | | _PDS | | | | | | | CH-Confi | | | | | | | gCommon_ | +----------+----------+----------+----------+----------+----------+ | C-RNTI, | Any | 1,2,3 | No | No | Default | | MCS | common | | | | A | | -C-RNTI, | search | | | | | | CS-RNTI | space | | | | | | | not | | | | | | | as | | | | | | | sociated | | | | | | | with | | | | | | | CORESET | | | | | | | 0 | | | | | | | | | | | | | | UE | | | | | | | specific | | | | | | | search | | | | | | | space | | | | | +----------+----------+----------+----------+----------+----------+ | | | 1,2,3 | Yes | No | _pdsch-T | | | | | | | imeDomai | | | | | | | nAllocat | | | | | | | ionList_ | | | | | | | provided | | | | | | | in | | | | | | | _PDS | | | | | | | CH-Confi | | | | | | | gCommon_ | +----------+----------+----------+----------+----------+----------+ | | | 1,2,3 | No/Yes | Yes | _pdsch-T | | | | | | | imeDomai | | | | | | | nAllocat | | | | | | | ionList_ | | | | | | | provided | | | | | | | in | | | | | | | _PDSCH | | | | | | | -Config_ | +----------+----------+----------+----------+----------+----------+
Table 5.1.2.1.1-1A: Applicable PDSCH time domain resource allocation for DCI
format 1_2
_PDSCH-ConfigCommon_ includes _pdsch-TimeDomainAllocationList_ _PDSCH-Config
includes pdsch-TimeDomainAllocationList_ _PDSCH-Config_ includes _pdsch-
TimeDomainAllocationListDCI-1-2_ PDSCH time domain resource allocation to
apply
* * *
No No No Default A Yes No No _pdsch-TimeDomainAllocationList_ provided in
_PDSCH-ConfigCommon_ No/Yes Yes No _pdsch-TimeDomainAllocationList_ provided
in _PDSCH-Config_ No/Yes No/Yes Yes _pdsch-TimeDomainAllocationListDCI-1-2_
provided in _PDSCH-Config_
Table 5.1.2.1.1-2: Default PDSCH time domain resource allocation A for normal
CP
Row index _dmrs-TypeA-Position_ PDSCH mapping type _K~0~_ _S_ _L_
* * *
1 2 Type A 0 2 12 3 Type A 0 3 11 2 2 Type A 0 2 10 3 Type A 0 3 9 3 2 Type A
0 2 9 3 Type A 0 3 8 4 2 Type A 0 2 7 3 Type A 0 3 6 5 2 Type A 0 2 5 3 Type A
0 3 4 6 2 Type B 0 9 4 3 Type B 0 10 4 7 2 Type B 0 4 4 3 Type B 0 6 4 8 2,3
Type B 0 5 7 9 2,3 Type B 0 5 2 10 2,3 Type B 0 9 2 11 2,3 Type B 0 12 2 12
2,3 Type A 0 1 13 13 2,3 Type A 0 1 6 14 2,3 Type A 0 2 4 15 2,3 Type B 0 4 7
16 2,3 Type B 0 8 4
Table 5.1.2.1.1-3: Default PDSCH time domain resource allocation A for
extended CP
Row index _dmrs-TypeA-Position_ PDSCH mapping type _K~0~_ _S_ _L_
* * *
1 2 Type A 0 2 6 3 Type A 0 3 5 2 2 Type A 0 2 10 3 Type A 0 3 9 3 2 Type A 0
2 9 3 Type A 0 3 8 4 2 Type A 0 2 7 3 Type A 0 3 6 5 2 Type A 0 2 5 3 Type A 0
3 4 6 2 Type B 0 6 4 3 Type B 0 8 2 7 2 Type B 0 4 4 3 Type B 0 6 4 8 2,3 Type
B 0 5 6 9 2,3 Type B 0 5 2 10 2,3 Type B 0 9 2 11 2,3 Type B 0 10 2 12 2,3
Type A 0 1 11 13 2,3 Type A 0 1 6 14 2,3 Type A 0 2 4 15 2,3 Type B 0 4 6 16
2,3 Type B 0 8 4
Table 5.1.2.1.1-4: Default PDSCH time domain resource allocation B
**Row index** **_dmrs-TypeA-Position_** **PDSCH mapping type** **_K~0~_**
**_S_** **_L_**
* * *
1 2,3 Type B 0 2 2 2 2,3 Type B 0 4 2 3 2,3 Type B 0 6 2 4 2,3 Type B 0 8 2 5
2,3 Type B 0 10 2 6 2,3 Type B 1 2 2 7 2,3 Type B 1 4 2 8 2,3 Type B 0 2 4 9
2,3 Type B 0 4 4 10 2,3 Type B 0 6 4 11 2,3 Type B 0 8 4 12 (Note 1) 2,3 Type
B 0 10 4 13 (Note 1) 2,3 Type B 0 2 7 14 (Note 1) 2 Type A 0 2 12 3 Type A 0 3
11 15 2,3 Type B 1 2 4 16 Reserved  
Note 1: If the PDSCH was scheduled with SI-RNTI in PDCCH Type0 common search
space, the UE may assume that this PDSCH resource allocation is not applied
Table 5.1.2.1.1-5: Default PDSCH time domain resource allocation C
**Row index** **_dmrs-TypeA-Position_** **PDSCH mapping type** **_K~0~_**
**_S_** **_L_**
* * *
1 (Note 1) 2,3 Type B 0 2 2 2 2,3 Type B 0 4 2 3 2,3 Type B 0 6 2 4 2,3 Type B
0 8 2 5 2,3 Type B 0 10 2 6 Reserved  
7 Reserved  
8 2,3 Type B 0 2 4 9 2,3 Type B 0 4 4 10 2,3 Type B 0 6 4 11 2,3 Type B 0 8 4
12 2,3 Type B 0 10 4 13 (Note 1) 2,3 Type B 0 2 7 14 (Note 1) 2 Type A 0 2 12
3 Type A 0 3 11 15 (Note 1) 2,3 Type A 0 0 6 16 (Note 1) 2,3 Type A 0 2 6 Note
1: The UE may assume that this PDSCH resource allocation is not used, if the
PDSCH was scheduled with SI-RNTI in PDCCH Type0 common search space
#### 5.1.2.2 Resource allocation in frequency domain
Two downlink resource allocation schemes, type 0 and type 1, are supported.
The UE shall assume that when the scheduling grant is received with DCI format
1_0, then downlink resource allocation type 1 is used.
If the scheduling DCI is configured to indicate the downlink resource
allocation type as part of the \'_Frequency domain resource assignment\'_
field by setting a higher layer parameter _resourceAllocation_ in _PDSCH-
Config_ to \'dynamicSwitch\', for DCI format 1_1 or setting a higher layer
parameter _resourceAllocationDCI-1-2_ in _PDSCH-Config_ to \'dynamicSwitch\'
for DCI format 1_2, the UE shall use downlink resource allocation type 0 or
type 1 as defined by this DCI field. Otherwise the UE shall use the downlink
frequency resource allocation type as defined by the higher layer parameter
_resourceAllocation_ for DCI format 1_1 or by the higher layer parameter
_resourceAllocationDCI-1-2_ for DCI format 1_2.
If a bandwidth part indicator field is not configured in the scheduling DCI or
the UE does not support active BWP change via DCI, the RB indexing for
downlink type 0 and type 1 resource allocation is determined within the UE\'s
active bandwidth part. If a bandwidth part indicator field is configured in
the scheduling DCI and the UE supports active BWP change via DCI, the RB
indexing for downlink type 0 and type 1 resource allocation is determined
within the UE\'s bandwidth part indicated by bandwidth part indicator field
value in the DCI. The UE shall upon detection of PDCCH intended for the UE
determine first the downlink bandwidth part and then the resource allocation
within the bandwidth part.
For a PDSCH scheduled with a DCI format 1_0 in any type of PDCCH common search
space, regardless of which bandwidth part is the active bandwidth part, RB
numbering starts from the lowest RB of the CORESET in which the DCI was
received; otherwise RB numbering starts from the lowest RB in the determined
downlink bandwidth part.
##### 5.1.2.2.1 Downlink resource allocation type 0
In downlink resource allocation of type 0, the resource block assignment
information includes a bitmap indicating the Resource Block Groups (RBGs) that
are allocated to the scheduled UE where a RBG is a set of consecutive virtual
resource blocks defined by higher layer parameter _rbg-Size_ configured by
_PDSCH-Config_ and the size of the bandwidth part as defined in Table
5.1.2.2.1-1.
Table 5.1.2.2.1-1: Nominal RBG size _P_
Bandwidth Part Size Configuration 1 Configuration 2
* * *
1 -- 36 2 4 37 -- 72 4 8 73 -- 144 8 16 145 -- 275 16 16
The total number of RBGs () for a downlink bandwidth part _i_ of size PRBs is
given by , where
\- the size of the first RBG is ,
\- the size of last RBG is if and _P_ otherwise,
\- the size of all other RBGs is _P_.
The bitmap is of size bits with one bitmap bit per RBG such that each RBG is
addressable. The RBGs shall be indexed in the order of increasing frequency
and starting at the lowest frequency of the bandwidth part. The order of RBG
bitmap is such that RBG 0 to RBG are mapped from MSB to LSB. The RBG is
allocated to the UE if the corresponding bit value in the bitmap is 1, the RBG
is not allocated to the UE otherwise.
##### 5.1.2.2.2 Downlink resource allocation type 1
In downlink resource allocation of type 1, the resource block assignment
information indicates to a scheduled UE a set of contiguously allocated non-
interleaved or interleaved virtual resource blocks within the active bandwidth
part of size PRBs except for the case when DCI format 1_0 is decoded in any
common search space in which case the size of CORESET 0 shall be used if
CORESET 0 is configured for the cell and the size of initial DL bandwidth part
shall be used if CORESET 0 is not configured for the cell.
A downlink type 1 resource allocation field consists of a resource indication
value (_RIV_) corresponding to a starting virtual resource block () and a
length in terms of contiguously allocated resource blocks. The resource
indication value is defined by
if then
else
where≥ 1 and shall not exceed .
When the DCI size for DCI format 1_0 in USS is derived from the size of DCI
format 1_0 in CSS but applied to an active BWP with size of , a downlink type
1 resource block assignment field consists of a resource indication value
(_RIV_) corresponding to a starting resource block and a length in terms of
virtually contiguously allocated resource blocks , where is given by
\- the size of CORESET 0 if CORESET 0 is configured for the cell;
\- the size of initial DL bandwidth part if CORESET 0 is not configured for
the cell.
The resource indication value is defined by:
if then
else
where, and where shall not exceed .
If , _K_ is the maximum value from set {1, 2, 4, 8} which satisfies ;
otherwise _K_ = 1.
When the scheduling grant is received with DCI format 1_2, a downlink type 1
resource allocation field consists of a resource indication value (_RIV_)
corresponding to a starting resource block group _RBG~start~_ =0, 1, ...,
_N~RBG~_ -1 and a length in terms of virtually contiguously allocated resource
block groups _L~RBGs~_ =1, ..., _N~RBG~_ , where the resource block groups are
defined as in 5.1.2.2.1 with _P_ defined by
_resourceAllocationType1GranularityDCI-1-2_ if the UE is configured with
higher layer parameter _resourceAllocationType1GranularityDCI-1-2_ , and _P=1_
otherwise _._ The resource indication value is defined by
if then
else
where≥ 1 and shall not exceed .
#### 5.1.2.3 Physical resource block (PRB) bundling
The PRB bundling procedures for PDSCH scheduled by PDCCH with DCI format 1_1
described in this clause equally apply to PDSCH scheduled by PDCCH with DCI
format 1_2, by applying the parameters of _prb-BundlingTypeDCI-1-2_ instead of
_prb-BundlingType_ as well as _vrb-ToPRB-InterleaverDCI-1-2_ instead of _vrb-
ToPRB-Interleaver_.
A UE may assume that precoding granularity is consecutive resource blocks in
the frequency domain. can be equal to one of the values among {2, 4,
wideband}.
If is determined as \"wideband\", the UE is not expected to be scheduled with
non-contiguous PRBs and the UE may assume that the same precoding is applied
to the allocated resource associated with a same TCI state or a same QCL
assumption.
If is determined as one of the values among {2, 4}, Precoding Resource Block
Group (PRGs) partitions the bandwidth part _i_ with consecutive PRBs. Actual
number of consecutive PRBs in each PRG could be one or more.
The first PRG size is given by and the last PRG size given by if , and the
last PRG size is if .
The UE may assume the same precoding is applied for any downlink contiguous
allocation of PRBs in a PRG.
For PDSCH carrying SIB1 scheduled by PDCCH with CRC scrambled by SI-RNTI, a
PRG is partitioned from the lowest numbered resource block of CORESET 0 if the
corresponding PDCCH is associated with CORESET 0 and Type0-PDCCH common search
space and is addressed to SI-RNTI; otherwise, a PRG is partitioned from common
resource block 0.
If a UE is scheduled a PDSCH with DCI format 1_0, the UE shall assume that is
equal to 2 PRBs.
When receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled
by C-RNTI, MCS-C-RNTI, or CS-RNTI, for bandwidth part is equal to 2 PRBs
unless configured by the higher layer parameter _prb-BundlingType_ given by
_PDSCH-Config_.
When receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled
by C-RNTI, MCS-C-RNTI, or CS-RNTI, if the higher layer parameter _prb-
BundlingType_ is set to \'dynamicBundling\', the higher layer parameters
_bundleSizeSet1_ and _bundleSizeSet2_ configure two sets of values, the first
set can take one or two values among {2, 4, wideband}, and the second set can
take one value among {2, 4, wideband}.
If the _PRB \'bundling size indicator\'_ signalled in DCI format 1_1 as
defined in Clause 7.3.1.2.2 of [5, TS 38.212]
\- is set to \'0\', the UE shall use the value from the second set of values
when receiving PDSCH scheduled by the same DCI.
\- is set to \'1\' and one value is configured for the first set of values,
the UE shall use this value when receiving PDSCH scheduled by the same DCI
\- is set to \'1\' and two values are configured for the first set of values
as \'n2-wideband\' (corresponding to two values 2 and wideband) or
\'n4-wideband\' (corresponding to two values 4 and wideband), the UE shall use
the value when receiving PDSCH scheduled by the same DCI as follows:
\- If the scheduled PRBs are contiguous and the size of the scheduled PRBs is
larger than , is the same as the scheduled bandwidth, otherwise is set to the
remaining configured value of 2 or 4, respectively.
When receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled
by C-RNTI, MCS-C-RNTI, or CS-RNTI, if the higher layer parameter _prb-
BundlingType_ is set to \'staticBundling\', the value is configured with the
single value indicated by the higher layer parameter _bundleSize_.
When a UE is configured with nominal RBG size $P = 2$ for bandwidth part _i_
according to Clause 5.1.2.2.1, or when a UE is configured with interleaving
unit of 2 for VRB to PRB mapping provided by the higher layer parameter _vrb-
ToPRB-Interleaver_ given by _PDSCH-Config_ for bandwidth part _i_ , the UE is
not expected to be configured with = 4.
For a UE configured by the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeA _\' or_ \'fdmSchemeB _\', and_ when the UE is indicated with two
TCI states in a codepoint of the DCI field _\'Transmission Configuration
Indication\'_ and DM-RS port(s) within one CDM group in the DCI field
\'_Antenna Port(s)_ \',
\- If is determined as \"wideband\", the first $\left\lceil
\frac{n_{\text{PRB}}}{2} \right\rceil$ PRBs are assigned to the first TCI
state and the remaining $\left\lfloor \frac{n_{\text{PRB}}}{2} \right\rfloor$
PRBs are assigned to the second TCI state, where $n_{\text{PRB}}\ $is the
total number of allocated PRBs for the UE.
\- If is determined as one of the values among {2, 4}, even PRGs within the
allocated frequency domain resources are assigned to the first TCI state and
odd PRGs within the allocated frequency domain resources are assigned to the
second TCI state, wherein the PRGs are numbered continuously in increasing
order with the first PRG index equal to 0.
\- The UE is not expected to receive more than two PDSCH transmission layers
for each PDSCH transmission occasion.
For a UE configured by the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeB _\',_ and when the UE is indicated with two TCI states in a
codepoint of the DCI field _\'Transmission Configuration Indication\'_ and DM-
RS port(s) within one CDM group in the DCI field \'_Antenna Port(s)\',_ each
PDSCH transmission occasion shall follow the Clause 7.3.1 of [4, TS 38.211]
with the mapping to resource elements determined by the assigned PRBs for
corresponding TCI state of the PDSCH transmission occasion, and the UE shall
only expect at most two code blocks per PDSCH transmission occasion when a
single transmission layer is scheduled and a single code block per PDSCH
transmission occasion when two transmission layers are scheduled. For two
PDSCH transmission occasions, the redundancy version to be applied is derived
according to Table 5.1.2.1-2, where $n = 0,\ 1$ are applied to the first and
second TCI state, respectively.
### 5.1.3 Modulation order, target code rate, redundancy version and transport
block size determination
To determine the modulation order, target code rate, and transport block
size(s) in the physical downlink shared channel, the UE shall first
\- read the 5-bit modulation and coding scheme field (_I~MCS~_) in the DCI to
determine the modulation order (_Q~m~_) and target code rate (_R_) based on
the procedure defined in Clause 5.1.3.1, and
\- read \'_redundancy version\'_ field (_rv_) in the DCI to determine the
redundancy version.
and second
\- the UE shall use the number of layers (ʋ), the total number of allocated
PRBs before rate matching (_n~PRB~_) to determine to the transport block size
based on the procedure defined in Clause 5.1.3.2.
The UE may skip decoding a transport block in an initial transmission if the
effective channel code rate is higher than 0.95, where the effective channel
code rate is defined as the number of downlink information bits (including CRC
bits) divided by the number of physical channel bits on PDSCH.
The UE is not expected to handle any transport blocks (TBs) in a 14
consecutive-symbol duration for normal CP (or 12 for extended CP) ending at
the last symbol of the latest PDSCH transmission within an active BWP on a
serving cell whenever
$$2^{max(0,\mu - \mu^{'})}.\sum_{i \in S}^{}{\left\lfloor
\frac{C_{i}^{'}}{L_{i}} \right\rfloor x_{i}.F_{i}} > \left\lceil \frac{X}{4}
\right\rceil.\frac{1}{R_{\text{LBRM}}}.\text{TB}S_{\text{LBRM}}$$
where, for the serving cell,
\- S is the set of TBs belonging to PDSCH(s) that are partially or fully
contained in the consecutive-symbol duration
\- for the _i_ th TB
_\- C~i~\'_ is the number of scheduled code blocks for as defined in [5,
38.212].
_\- L~i~_ is the number of OFDM symbols assigned to the PDSCH
_\- x~i~_ is the number of OFDM symbols of the PDSCH contained in the
consecutive-symbol duration
\- $F_{i} = \max_{j = 0,...,J - 1}{(\min{(k_{0,i}^{j} + E_{i}^{j},\
N_{cb,i})})}$ based on the values defined in Clause 5.4.2.1 [5, TS 38.212]
\- $k_{0,i}^{j}$ is the starting location of RV for the $j$th transmission
\- $E_{\text{i\ }}^{j} = \min{(E_{r})\ }$_of the scheduled code_ blocks for
the $j\text{th}$ transmission
\- $N_{cb,i}$ is the circular buffer length
\- $J - 1$ is the current (re)transmission for the _i_ th TB
\- $\mu^{'}$ corresponds to the subcarrier spacing of the BWP (across all
configured BWPs of a carrier) that has the largest configured number of PRBs
\- in case there is more than one BWP corresponding to the largest configured
number of PRBs, _µ\'_ follows the BWP with the largest subcarrier spacing.
\- $\mu$ corresponds to the subcarrier spacing of the active BWP
\- R~LBRM~ = 2/3 as defined in Clause 5.4.2.1 [5, TS 38.212]
> \- TBS~LBRM~ as defined in Clause 5.4.2.1 [5, TS 38.212]
\- X as defined for downlink in Clause 5.4.2.1 [5, TS 38.212].
If the UE skips decoding, the physical layer indicates to higher layer that
the transport block is not successfully decoded.
Within a cell group, a UE is not required to handle PDSCH(s) transmissions in
slot _s~j~_ in serving cell-_j_ , and for _j_ = 0,1,2.. _J-1_ , slot _s~j~_
overlapping with any given point in time, if the following condition is not
satisfied at that point in time:
$$\sum_{j = 0}^{J - 1}\frac{\sum_{m = 0}^{M -
1}V_{j,m}}{T_{\text{slot}}^{\mu(j)}} \leq \text{DataRate}$$
where,
\- _J_ is the number of configured serving cells belonging to a frequency
range
\- for the _j-th_ serving cell,
_\- M_ is the number of TB(s) transmitted in slot _s~j~_. If there are two
PDSCH transmission occasions of the same TB (in time domain or in frequency
domain) in the slot _s~j~_ , each transmission occasion is counted separately.
_\- T~slot~^μ(j)^_ =10^-3^/2 _^μ(j)^_ , where _μ(j)_ is the numerology for
PDSCH(s) in slot _s~j~_ of the _j_ -th serving cell.
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
_\- A_ is the number of bits in the transport block as defined in Clause 7.2.1
[5, TS 38.212]
_\- C_ _is the total number of code blocks for the transport block_ defined in
Clause 5.2.2 [5, TS 38.212].$\ $
_-_ $C'$ is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5, TS 38.212]
\- $\text{DataRate}$ [Mbps] is computed as the maximum data rate summed over
all the carriers in the frequency range for any signaled band combination and
feature set consistent with the configured servings cells, where the data rate
value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including
the scaling factor _f(i)._
For a _j-_ th serving cell, if higher layer parameter _processingType2Enabled_
of _PDSCH-ServingCellConfig_ is configured for the serving cell and set to
\'_enable\',_ or if at least one _I~MCS~ >_ _W_ for a PDSCH, where _W_ = 28
for MCS tables 5.1.3.1-1 and 5.1.3.1-3, and _W_ = 27 for MCS table 5.1.3.1-2,
the UE is not required to handle PDSCH transmissions, if the following
condition is not satisfied:
$$\frac{\sum_{m = 0}^{M - 1}V_{j,m}}{L \times T_{s}^{\mu}} \leq
\text{DataRateCC}$$
_where_
\- $\text{L\ }$is the number of symbols assigned to the PDSCH. For a PDSCH
that consists of two PDSCH transmission occasions in time domain in one slot,
$L$ is the number of symbols of one transmission occasion.
\- M is the number of TB(s) in the PDSCH
\- $T_{s}^{\mu} = \frac{10^{- 3}}{{2^{\mu} \bullet
N}_{\text{symb}}^{\text{slot}}}$ where _μ_ is the numerology of the PDSCH
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
_\- A_ is the number of bits in the transport block as defined in Clause 7.2.1
[5, TS 38.212]
_\- C_ is the total number of code blocks for the transport block defined in
Clause 5.2.2 [5, TS 38.212]
_-_ $C'$ is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5, TS 38.212]
\- $\text{DataRateCC}$ [Mbps] is computed as the maximum data rate for a
carrier in the frequency band of the serving cell for any signaled band
combination and feature set consistent with the serving cell, where the data
rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306],
including the scaling factor _f(i)._
#### 5.1.3.1 Modulation order and target code rate determination
For the PDSCH scheduled by a PDCCH with DCI format 1_0, format 1_1 or format
1_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, SI-RNTI, RA-
RNTI, MSGB-RNTI, or P-RNTI, or for the PDSCH scheduled without corresponding
PDCCH transmissions using the higher-layer-provided PDSCH configuration _SPS-
Config_ ,
if the higher layer parameter _mcs-TableDCI-1-2_ given by _PDSCH-Config_ is
set to \'qam256\', and the PDSCH is scheduled by a PDCCH with DCI format 1_2
with CRC scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with MCS-C-RNTI, the higher layer parameter
_mcs-TableDCI-1-2_ given by _PDSCH-Config_ is set to \'qam64LowSE\', and the
PDSCH is scheduled by a PDCCH with DCI format 1_2 scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the higher layer parameter _mcs-Table_ given by _PDSCH-Config_ is set
to \'qam256\', and the PDSCH is scheduled by a PDCCH with DCI format 1_1 with
CRC scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with MCS-C-RNTI, the higher layer parameter
_mcs-Table_ given by _PDSCH-Config_ is set to \'qam64LowSE\', and the PDSCH is
scheduled by a PDCCH with a DCI format other than DCI format 1_2 in a UE-
specific search space with CRC scrambled by C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is configured with MCS-C-RNTI, and the PDSCH is scheduled by a
PDCCH with CRC scrambled by MCS-C-RNTI
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with the higher layer parameter _mcs-Table_
given by _SPS-config_ , and the higher layer parameter _mcs-TableDCI-1-2_
given by _PDSCH-Config_ is set to \'qam256\',
> \- if the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC
> scrambled by CS-RNTI or
>
> \- if the PDSCH with SPS activated by DCI format 1_2 is scheduled without
> corresponding PDCCH transmission using _SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is not configured with the higher layer parameter _mcs-Table_
given by _SPS-Config_ , and the higher layer parameter _mcs-Table_ given by
_PDSCH-Config_ is set to \'qam256\',
\- if the PDSCH is scheduled by a PDCCH with DCI format 1_1 with CRC scrambled
by CS-RNTI or
\- if the PDSCH with SPS activated by DCI format 1_1 is scheduled without
corresponding PDCCH transmission using _SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
elseif the UE is configured with the higher layer parameter _mcs-Table_ given
by _SPS-Config_ set to \'qam64LowSE\'
\- if the PDSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if the PDSCH is scheduled without corresponding PDCCH transmission using
_SPS-Config_ ,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
else
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-1 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical downlink shared
channel.
end
The UE is not expected to decode a PDSCH scheduled with P-RNTI, RA-RNTI, SI-
RNTI and _Q~m~_ > 2
For a UE configured with the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeB\', and when the UE is indicated with two TCI states in a
codepoint of the DCI field _\'Transmission Configuration Indication\'_ and DM-
RS port(s) within one CDM group in the DCI field \'_Antenna Port(s)_ \', the
determined modulation order of PDSCH transmission occasion associated with the
first TCI state is applied to the PDSCH transmission occasion associated with
the second TCI state.
Table 5.1.3.1-1: MCS index table 1 for PDSCH
+------------+-------------------+---------------------------------+------------+ | MCS Index\ | Modulation Order\ | Target code Rate _R_ x [1024] | Spectral | | _I~MCS~_ | _Q~m~_ | | | | | | | efficiency | +============+===================+=================================+============+ | **0** | 2 | 120 | 0.2344 | +------------+-------------------+---------------------------------+------------+ | **1** | 2 | 157 | 0.3066 | +------------+-------------------+---------------------------------+------------+ | **2** | 2 | 193 | 0.3770 | +------------+-------------------+---------------------------------+------------+ | **3** | 2 | 251 | 0.4902 | +------------+-------------------+---------------------------------+------------+ | **4** | 2 | 308 | 0.6016 | +------------+-------------------+---------------------------------+------------+ | **5** | 2 | 379 | 0.7402 | +------------+-------------------+---------------------------------+------------+ | **6** | 2 | 449 | 0.8770 | +------------+-------------------+---------------------------------+------------+ | **7** | 2 | 526 | 1.0273 | +------------+-------------------+---------------------------------+------------+ | **8** | 2 | 602 | 1.1758 | +------------+-------------------+---------------------------------+------------+ | **9** | 2 | 679 | 1.3262 | +------------+-------------------+---------------------------------+------------+ | **10** | 4 | 340 | 1.3281 | +------------+-------------------+---------------------------------+------------+ | **11** | 4 | 378 | 1.4766 | +------------+-------------------+---------------------------------+------------+ | **12** | 4 | 434 | 1.6953 | +------------+-------------------+---------------------------------+------------+ | **13** | 4 | 490 | 1.9141 | +------------+-------------------+---------------------------------+------------+ | **14** | 4 | 553 | 2.1602 | +------------+-------------------+---------------------------------+------------+ | **15** | 4 | 616 | 2.4063 | +------------+-------------------+---------------------------------+------------+ | **16** | 4 | 658 | 2.5703 | +------------+-------------------+---------------------------------+------------+ | **17** | 6 | 438 | 2.5664 | +------------+-------------------+---------------------------------+------------+ | **18** | 6 | 466 | 2.7305 | +------------+-------------------+---------------------------------+------------+ | **19** | 6 | 517 | 3.0293 | +------------+-------------------+---------------------------------+------------+ | **20** | 6 | 567 | 3.3223 | +------------+-------------------+---------------------------------+------------+ | **21** | 6 | 616 | 3.6094 | +------------+-------------------+---------------------------------+------------+ | **22** | 6 | 666 | 3.9023 | +------------+-------------------+---------------------------------+------------+ | **23** | 6 | 719 | 4.2129 | +------------+-------------------+---------------------------------+------------+ | **24** | 6 | 772 | 4.5234 | +------------+-------------------+---------------------------------+------------+ | **25** | 6 | 822 | 4.8164 | +------------+-------------------+---------------------------------+------------+ | **26** | 6 | 873 | 5.1152 | +------------+-------------------+---------------------------------+------------+ | **27** | 6 | 910 | 5.3320 | +------------+-------------------+---------------------------------+------------+ | **28** | 6 | 948 | 5.5547 | +------------+-------------------+---------------------------------+------------+ | **29** | 2 | reserved | | +------------+-------------------+---------------------------------+------------+ | **30** | 4 | reserved | | +------------+-------------------+---------------------------------+------------+ | **31** | 6 | reserved | | +------------+-------------------+---------------------------------+------------+
Table 5.1.3.1-2: MCS index table 2 for PDSCH
+--------------+----------------+----------------+----------------+ | **MCS Index\ |** Modulation | **Target code |** Spectral**| |**_I~MCS~_ | Order\ | Rate _R_**x | | | | **_Q~m~_ | [1024] | **efficiency**| +==============+================+================+================+ |** 0**| 2 | 120 | 0.2344 | +--------------+----------------+----------------+----------------+ |** 1**| 2 | 193 | 0.3770 | +--------------+----------------+----------------+----------------+ |** 2**| 2 | 308 | 0.6016 | +--------------+----------------+----------------+----------------+ |** 3**| 2 | 449 | 0.8770 | +--------------+----------------+----------------+----------------+ |** 4**| 2 | 602 | 1.1758 | +--------------+----------------+----------------+----------------+ |** 5**| 4 | 378 | 1.4766 | +--------------+----------------+----------------+----------------+ |** 6**| 4 | 434 | 1.6953 | +--------------+----------------+----------------+----------------+ |** 7**| 4 | 490 | 1.9141 | +--------------+----------------+----------------+----------------+ |** 8**| 4 | 553 | 2.1602 | +--------------+----------------+----------------+----------------+ |** 9**| 4 | 616 | 2.4063 | +--------------+----------------+----------------+----------------+ |** 10**| 4 | 658 | 2.5703 | +--------------+----------------+----------------+----------------+ |** 11**| 6 | 466 | 2.7305 | +--------------+----------------+----------------+----------------+ |** 12**| 6 | 517 | 3.0293 | +--------------+----------------+----------------+----------------+ |** 13**| 6 | 567 | 3.3223 | +--------------+----------------+----------------+----------------+ |** 14**| 6 | 616 | 3.6094 | +--------------+----------------+----------------+----------------+ |** 15**| 6 | 666 | 3.9023 | +--------------+----------------+----------------+----------------+ |** 16**| 6 | 719 | 4.2129 | +--------------+----------------+----------------+----------------+ |** 17**| 6 | 772 | 4.5234 | +--------------+----------------+----------------+----------------+ |** 18**| 6 | 822 | 4.8164 | +--------------+----------------+----------------+----------------+ |** 19**| 6 | 873 | 5.1152 | +--------------+----------------+----------------+----------------+ |** 20**| 8 | 682.5 | 5.3320 | +--------------+----------------+----------------+----------------+ |** 21**| 8 | 711 | 5.5547 | +--------------+----------------+----------------+----------------+ |** 22**| 8 | 754 | 5.8906 | +--------------+----------------+----------------+----------------+ |** 23**| 8 | 797 | 6.2266 | +--------------+----------------+----------------+----------------+ |** 24**| 8 | 841 | 6.5703 | +--------------+----------------+----------------+----------------+ |** 25**| 8 | 885 | 6.9141 | +--------------+----------------+----------------+----------------+ |** 26**| 8 | 916.5 | 7.1602 | +--------------+----------------+----------------+----------------+ |** 27**| 8 | 948 | 7.4063 | +--------------+----------------+----------------+----------------+ |** 28**| 2 | reserved | | +--------------+----------------+----------------+----------------+ |** 29**| 4 | reserved | | +--------------+----------------+----------------+----------------+ |** 30**| 6 | reserved | | +--------------+----------------+----------------+----------------+ |** 31** | 8 | reserved | | +--------------+----------------+----------------+----------------+
Table 5.1.3.1-3: MCS index table 3 for PDSCH
+------------+-------------------+---------------------------------+------------+ | MCS Index\ | Modulation Order\ | Target code Rate _R_ x [1024] | Spectral | | _I~MCS~_ | _Q~m~_ | | | | | | | efficiency | +============+===================+=================================+============+ | **0** | 2 | 30 | 0.0586 | +------------+-------------------+---------------------------------+------------+ | **1** | 2 | 40 | 0.0781 | +------------+-------------------+---------------------------------+------------+ | **2** | 2 | 50 | 0.0977 | +------------+-------------------+---------------------------------+------------+ | **3** | 2 | 64 | 0.1250 | +------------+-------------------+---------------------------------+------------+ | **4** | 2 | 78 | 0.1523 | +------------+-------------------+---------------------------------+------------+ | **5** | 2 | 99 | 0.1934 | +------------+-------------------+---------------------------------+------------+ | **6** | 2 | 120 | 0.2344 | +------------+-------------------+---------------------------------+------------+ | **7** | 2 | 157 | 0.3066 | +------------+-------------------+---------------------------------+------------+ | **8** | 2 | 193 | 0.3770 | +------------+-------------------+---------------------------------+------------+ | **9** | 2 | 251 | 0.4902 | +------------+-------------------+---------------------------------+------------+ | **10** | 2 | 308 | 0.6016 | +------------+-------------------+---------------------------------+------------+ | **11** | 2 | 379 | 0.7402 | +------------+-------------------+---------------------------------+------------+ | **12** | 2 | 449 | 0.8770 | +------------+-------------------+---------------------------------+------------+ | **13** | 2 | 526 | 1.0273 | +------------+-------------------+---------------------------------+------------+ | **14** | 2 | 602 | 1.1758 | +------------+-------------------+---------------------------------+------------+ | **15** | 4 | 340 | 1.3281 | +------------+-------------------+---------------------------------+------------+ | **16** | 4 | 378 | 1.4766 | +------------+-------------------+---------------------------------+------------+ | **17** | 4 | 434 | 1.6953 | +------------+-------------------+---------------------------------+------------+ | **18** | 4 | 490 | 1.9141 | +------------+-------------------+---------------------------------+------------+ | **19** | 4 | 553 | 2.1602 | +------------+-------------------+---------------------------------+------------+ | **20** | 4 | 616 | 2.4063 | +------------+-------------------+---------------------------------+------------+ | **21** | 6 | 438 | 2.5664 | +------------+-------------------+---------------------------------+------------+ | **22** | 6 | 466 | 2.7305 | +------------+-------------------+---------------------------------+------------+ | **23** | 6 | 517 | 3.0293 | +------------+-------------------+---------------------------------+------------+ | **24** | 6 | 567 | 3.3223 | +------------+-------------------+---------------------------------+------------+ | **25** | 6 | 616 | 3.6094 | +------------+-------------------+---------------------------------+------------+ | **26** | 6 | 666 | 3.9023 | +------------+-------------------+---------------------------------+------------+ | **27** | 6 | 719 | 4.2129 | +------------+-------------------+---------------------------------+------------+ | **28** | 6 | 772 | 4.5234 | +------------+-------------------+---------------------------------+------------+ | **29** | 2 | reserved | | +------------+-------------------+---------------------------------+------------+ | **30** | 4 | reserved | | +------------+-------------------+---------------------------------+------------+ | **31** | 6 | reserved | | +------------+-------------------+---------------------------------+------------+
#### 5.1.3.2 Transport block size determination
In case the higher layer parameter _maxNrofCodeWordsScheduledByDCI_ indicates
that two codeword transmission is enabled, then one of the two transport
blocks is disabled by DCI format 1_1 if _I~MCS\ ~_ = 26 and if _rv~id~_ = 1
for the corresponding transport block. If both transport blocks are enabled,
transport block 1 and 2 are mapped to codeword 0 and 1 respectively. If only
one transport block is enabled, then the enabled transport block is always
mapped to the first codeword.
For the PDSCH assigned by a PDCCH with DCI format 1_0, format 1_1 or format
1_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, or SI-RNTI, if
Table 5.1.3.1-2 is used and $0\ \leq \ I_{\text{MCS\ }} \leq 27$_,_ or a table
other than Table 5.1.3.1-2 is used and $0\ \leq \ I_{\text{MCS\ }} \leq 28$_,_
the UE shall, except if the transport block is disabled in DCI format 1_1,
first determine the TBS as specified below:
1) The UE shall first determine the number of REs (_N~RE~_)
$N_{\text{RE}})$within the slot.
\- A UE first determines the number of REs allocated for PDSCH within a PRB ()
by , where is the number of subcarriers in a physical resource block,
$N_{\text{symb}}^{\text{slot}}$ is the number of symbols of the PDSCH
allocation within the slot, $N_{\text{DMRS}}^{\text{PRB}}$ is the number of
REs for DM-RS per PRB in the scheduled duration including the overhead of the
DM-RS CDM groups without data, as indicated by DCI format 1_1 or format 1_2 or
as described for format 1_0 in Clause 5.1.6.2, and
$N_{\text{oh}}^{\text{PRB}}$is the overhead configured by higher layer
parameter _xOverhead in PDSCH-ServingCellConfig_. If the _xOverhead_ in
_PDSCH-ServingCellconfig_ is not configured (a value from 6, 12, or 18), the
is set to 0. If the PDSCH is scheduled by PDCCH with a CRC scrambled by SI-
RNTI, RA-RNTI, MSGB-RNTI or P-RNTI, is assumed to be 0.
\- A UE determines the total number of REs allocated for PDSCH
()$N_{\text{RE}})$ by $N_{\text{RE}} = \ {\overline{N}}_{\text{RE}}^{'}_\
n_{\text{PRB}}$, where_ n~PRB~* is the total number of allocated PRBs for the
UE.
2) Unquantized intermediate variable (_N~info~_) $\text{TBS}_{\text{temp}})\
$is obtained by $\text{TBS}_{\text{temp}} = \ N_{\text{RE}}_R_ Q_{m}*ʋ$.
If
Use step 3 as the next step of the TBS determination
else
Use step 4 as the next step of the TBS determination
end if
3) When , TBS is determined as follows
\- quantized intermediate number of information bits , where .
\- use Table 5.1.3.2-1 find the closest TBS that is not less than .
Table 5.1.3.2-1: TBS for
Index TBS Index TBS Index TBS Index TBS
* * *
1 24 31 336 61 1288 91 3624 2 32 32 352 62 1320 92 3752 3 40 33 368 63 1352 93
3824 4 48 34 384 64 1416  
5 56 35 408 65 1480  
6 64 36 432 66 1544  
7 72 37 456 67 1608  
8 80 38 480 68 1672  
9 88 39 504 69 1736  
10 96 40 528 70 1800  
11 104 41 552 71 1864  
12 112 42 576 72 1928  
13 120 43 608 73 2024  
14 128 44 640 74 2088  
15 136 45 672 75 2152  
16 144 46 704 76 2216  
17 152 47 736 77 2280  
18 160 48 768 78 2408  
19 168 49 808 79 2472  
20 176 50 848 80 2536  
21 184 51 888 81 2600  
22 192 52 928 82 2664  
23 208 53 984 83 2728  
24 224 54 1032 84 2792  
25 240 55 1064 85 2856  
26 256 56 1128 86 2976  
27 272 57 1160 87 3104  
28 288 58 1192 88 3240  
29 304 59 1224 89 3368  
30 320 60 1256 90 3496
4) When , TBS is determined as follows.
\- quantized intermediate number of information bits , where and ties in the
round function are broken towards the next largest integer.
\- if
, where
else
if
, where
else
end if
end if
> else if Table 5.1.3.1-2 is used and _,_
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using $0\ \leq \ I_{\text{MCS\ }}
\leq 27$. If there is no PDCCH for the same transport block using $0\ \leq \
I_{\text{MCS\ }} \leq 27$, and if the initial PDSCH for the same transport
block is semi-persistently scheduled, the TBS shall be determined from the
most recent semi-persistent scheduling assignment PDCCH.
> else
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using $0\ \leq \ I_{\text{MCS\ }}
\leq 28$. If there is no PDCCH for the same transport block using$\ 0\ \leq \
I_{\text{MCS\ }} \leq 28$, and if the initial PDSCH for the same transport
block is semi-persistently scheduled, the TBS shall be determined from the
most recent semi-persistent scheduling assignment PDCCH.
The UE is not expected to receive a PDSCH assigned by a PDCCH with CRC
scrambled by SI-RNTI with a TBS exceeding 2976 bits.
For a UE configured with the higher layer parameter _repetitionScheme_ set to
\'fdmSchemeB\' and indicated with two TCI states in a codepoint of the DCI
field _\'Transmission Configuration Indication\'_ and DM-RS port(s) within one
CDM group in the DCI field \'_Antenna Port(s)_ \', the TBS determination
follows the steps 1-4 with the following modification in step 1: a UE
determines the total number of REs allocated for PDSCH ()$N_{\text{RE}})$ by
$N_{\text{RE}} = \ {\overline{N}}_{\text{RE}}^{'}_\ n_{\text{PRB}}$, where_
n~PRB~_is the total number of allocated PRBs corresponding to the first TCI
state, and the determined TBS of PDSCH transmission occasion associated with
the first TCI state is also applied to the PDSCH transmission occasion
associated with the second TCI state. For a UE configured with the higher
layer parameter_ repetitionScheme _set to \'tdmSchemeA\' and indicated with
two TCI states in a codepoint of the DCI field_ \'Transmission Configuration
Indication\'_and DM-RS port(s) within one CDM group in the DCI field \'_
Antenna Port(s)*\', the TBS determination follows the steps 1-4 with the
following modification in step 1: a UE determines the number of REs allocated
for PDSCH within a PRB () by , where is the number of symbols of the PDSCH
allocation within the slot corresponding to the first TCI state, and the
determined TBS of PDSCH transmission occasion associated with the first TCI
state is also applied to the PDSCH transmission occasion associated with the
second TCI state.
For the PDSCH assigned by a PDCCH with DCI format 1_0 with CRC scrambled by
P-RNTI, or RA-RNTI, MsgB-RNTI, TBS determination follows the steps 1-4 with
the following modification in step 2: a scaling is applied in the calculation
of _N~info~_ , where the scaling factor is determined based on the _TB
scaling_ field in the DCI as in Table 5.1.3.2-2.
Table 5.1.3.2-2: Scaling factor of _N~info~_ for P-RNTI, RA-RNTI and MSGB-RNTI
TB scaling field Scaling factor S
* * *
00 1 01 0.5 10 0.25 11
The NDI and HARQ process ID, as signalled on PDCCH, and the TBS, as determined
above, shall be reported to higher layers.
### 5.1.4 PDSCH resource mapping
When receiving the PDSCH scheduled with SI-RNTI and the system information
indicator in DCI is set to 0, the UE shall assume that no SS/PBCH block is
transmitted in REs used by the UE for a reception of the PDSCH.
When receiving the PDSCH scheduled with SI-RNTI and the system information
indicator in DCI is set to 1, RA-RNTI, MSGB-RNTI, P-RNTI or TC-RNTI, the UE
assumes SS/PBCH block transmission according to _ssb-PositionsInBurst_ , and
if the PDSCH resource allocation overlaps with PRBs containing SS/PBCH block
transmission resources the UE shall assume that the PRBs containing SS/PBCH
block transmission resources are not available for PDSCH in the OFDM symbols
where SS/PBCH block is transmitted.
A UE expects a configuration provided by _ssb-PositionsInBurst_ in
_ServingCellConfigCommon_ to be same as a configuration provided by _ssb-
PositionsInBurst_ in _SIB1_.
When receiving PDSCH scheduled by PDCCH with CRC scrambled by C-RNTI, MCS-C-
RNTI, CS-RNTI, or PDSCHs with SPS, the REs corresponding to the configured or
dynamically indicated resources in Clauses 5.1.4.1, 5.1.4.2 are not available
for PDSCH. Furthermore, the UE assumes SS/PBCH block transmission according to
_ssb-PositionsInBurst_ if the PDSCH resource allocation overlaps with PRBs
containing SS/PBCH block transmission resources, the UE shall assume that the
PRBs containing SS/PBCH block transmission resources are not available for
PDSCH in the OFDM symbols where SS/PBCH block is transmitted.
A UE is not expected to handle the case where PDSCH DM-RS REs are overlapping,
even partially, with any RE(s) not available for PDSCH _._
For operation with shared spectrum channel access, SS/PBCH block transmission
according to _ssb-PositionsInBurst_ represents all of the candidate SS/PBCH
blocks corresponding to SS/PBCH block indices provided by _ssb-
PositionsInBurst_ as described in Clause 4.1 of [6, TS 38.213].
#### 5.1.4.1 PDSCH resource mapping with RB symbol level granularity
The procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in
this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by
applying the parameters of _rateMatchPatternGroup1DCI-1-2_ ,
_rateMatchPatternGroup2DCI-1-2_ instead of _rateMatchPatternGroup1_ and
_rateMatchPatternGroup2_.
A UE may be configured with any of the following higher layer parameters
indicating REs declared as not available for PDSCH:
\- _rateMatchPatternToAddModList_ given by _PDSCH-Config,_ by
_ServingCellConfig_ or by _ServingCellConfigCommon_ and configuring up to 4
_RateMatchPattern(s)_ per BWP and up to 4 _RateMatchPattern(s)_ per serving-
cell. A _RateMatchPattern_ may contain:
\- within a BWP, when provided by _PDSCH-Config_ or within a serving cell when
provided by _ServingCellConfig_ or _ServingCellConfigCommon_ , a pair of
reserved resources with numerology provided by higher layer parameter
_subcarrierSpacing_ given by _RateMatchPattern_ when configured per serving
cell or by numerology of associated BWP when configured per BWP. The pair of
reserved resources are respectively indicated by an RB level bitmap (higher
layer parameter _resourceBlocks_ given by _RateMatchPattern_) with 1RB
granularity and a symbol level bitmap spanning one or two slots (higher layer
parameters _symbolsInResourceBlock_ given by _RateMatchPattern_) for which the
reserved RBs apply. A bit value equal to 1 in the RB and symbol level bitmaps
indicates that the corresponding resource is not available for PDSCH. For each
pair of RB and symbol level bitmaps, a UE may be configured with a time-domain
pattern (higher layer parameter _periodicityAndPattern_ given by
_RateMatchPattern_), where each bit of _periodicityAndPattern_ corresponds to
a unit equal to a duration of the symbol level bitmap, and a bit value equal
to 1 indicates that the pair is present in the unit. The
_periodicityAndPattern_ can be {1, 2, 4, 5, 8, 10, 20 or 40} units long, but
maximum of 40 msec. The first symbol of _periodicityAndPattern_ every 40
msec/P periods is a first symbol in frame $n_{f}$ mod 4 = 0, where P is the
duration of _periodicityAndPattern_ in units of msec. When
_periodicityAndPattern_ is not configured for a pair, for a symbol level
bitmap spanning two slots, the bits of the first and second slots correspond
respectively to even and odd slots of a radio frame, and for a symbol level
bitmap spanning one slot, the bits of the slot correspond to every slot of a
radio frame. The pair can be included in one or two groups of resource sets
(higher layer parameters _rateMatchPatternGroup1_ and
_rateMatchPatternGroup2_). The _rateMatchPatternToAddModList_ given by
_ServingCellConfig_ or _ServingCellConfigCommon_ configuration in numerology
_µ_ applies only to PDSCH of the same numerology _µ_.
\- within a BWP, a frequency domain resource of a CORESET configured by
_ControlResourceSet_ with _controlResourceSetId_ or _ControlResourceSetZero_
and time domain resource determined by the higher layer parameters
_monitoringSlotPeriodicityAndOffset,_ _duration_ and
_monitoringSymbolsWithinSlot_ of all search-space-sets configured by
_SearchSpace_ and time domain resource of search-space-set zero configured by
_searchSpaceZero_ associated with the CORESET as well as CORESET duration
configured by _ControlResourceSet_ with _controlResourceSetId_ or
_ControlResourceSetZero._ This resource not available for PDSCH can be
included in one or two groups of resource sets (higher layer parameters
_rateMatchPatternGroup1_ and _rateMatchPatternGroup2_).
A configured group _rateMatchPatternGroup1_ or _rateMatchPatternGroup2_
contains a list of indices of _RateMatchPattern(s)_ forming a union of
resource-sets not available for a PDSCH dynamically if a corresponding bit of
the \'_Rate matching indicator_ \' field of the DCI format 1_1 scheduling the
PDSCH is equal to 1. The REs corresponding to the union of resource-sets
configured by _RateMatchPattern(s)_ that are not included in either of the two
groups are not available for a PDSCH scheduled by a DCI format 1_0, a PDSCH
scheduled by a DCI format 1_1, and PDSCHs with SPS. When receiving a PDSCH
scheduled by a DCI format 1_0 or PDSCHs with SPS activated by a DCI format
1_0, the REs corresponding to configured resources in _rateMatchPatternGroup1_
or _rateMatchPatternGroup2_ are not available for the scheduled PDSCH or the
activated PDSCHs with SPS. When receiving PDSCHs with SPS activated by a DCI
format 1_1, the REs corresponding to configured resources in
_rateMatchPatternGroup1_ or _rateMatchPatternGroup2_ are not available for the
PDSCHs with SPS if a corresponding bit of the Rate matching indicator field of
the DCI format 1_1 activating the PDSCHs with SPS is equal to 1.
For a bitmap pair included in one or two groups of resource sets, the dynamic
indication of availability for PDSCH applies to a set of slot(s) where the
_rateMatchPatternToAddModList_ is present among the slots of scheduled PDSCH.
If a UE monitors PDCCH candidates of aggregation levels 8 and 16 with the same
starting CCE index in non-interleaved CORESET spanning one OFDM symbol and if
a detected PDCCH scheduling the PDSCH has aggregation level 8, the resources
corresponding to the aggregation level 16 PDCCH candidate are not available
for the PDSCH.
If a PDSCH scheduled by a PDCCH would overlap with resources in the CORESET
containing the PDCCH, the resources corresponding to a union of the detected
PDCCH that scheduled the PDSCH and associated PDCCH DM-RS are not available
for the PDSCH. When _precoderGranularity_ configured in a CORESET where the
PDCCH was detected is set to \'_allContiguousRBs\'_ , the associated PDCCH DM-
RS are DM-RS in all REGs of the CORESET. Otherwise, the associated DM-RS are
the DM-RS in REGs of the PDCCH.
#### 5.1.4.2 PDSCH resource mapping with RE level granularity
The procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in
this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by
applying the parameters of _aperiodicZP-CSI-RS-
ResourceSetsToAddModListDCI-1-2_ instead of _aperiodic-ZP-CSI-RS-
ResourceSetsToAddModList_.
A UE may be configured with any of the following higher layer parameters:
_-_ REs indicated by the \'_RateMatchPatternLTE-CRS\'_ in _lte-CRS-
ToMatchAround_ in _ServingCellConfig_ or _ServingCellConfigCommon_ configuring
cell-specific RS, in 15 kHz subcarrier spacing applicable only to 15 kHz
subcarrier spacing PDSCH, of one LTE carrier in a serving cell are declared as
not available for PDSCH.
_-_ REs indicated by _\'RateMatchPatternLTE-CRS\'_ in _lte-CRS-
PatternList1-r16_ in _ServingCellConfig_ configuring cell-specific RS, in 15
kHz subcarrier spacing applicable only to 15 kHz subcarrier spacing PDSCH, of
one LTE carrier in a serving cell are declared as not available for PDSCH.
\- Each _RateMatchPatternLTE-CRS_ configuration contains _v-Shift_ consisting
of LTE-CRS-vshift(s), _nrofCRS-Ports_ consisting of LTE-CRS antenna ports 1, 2
or 4 ports, _carrierFreqDL_ representing the offset in units of 15 kHz
subcarriers from (reference) point A to the LTE carrier centre subcarrier
location, _carrierBandwidthDL_ representing the LTE carrier bandwidth, and may
also configure _mbsfn-SubframeConfigList_ representing MBSFN subframe
configuration. A UE determines the CRS position within the slot according to
Clause 6.10.1.2 in [15, TS 36.211], where slot corresponds to LTE subframe.
\- If the UE is configured by higher layer parameter _PDCCH-Config_ with two
different values of _coresetPoolIndex_ in _ControlResourceSet_ and is also
configured by the higher layer parameter _lte-CRS-PatternList1-r16_ and _lte-
CRS-PatternList2-r16_ in _ServingCellConfig_ , the following REs are declared
as not available for PDSCH:
\- if the UE is configured with _crs-RateMatch-PerCoresetPoolIndex_ , REs
indicated by the CRS pattern(s) in _lte-CRS-PatternList1-r16_ if the PDSCH is
associated with _coresetPoolIndex_ set to \'0\', or the CRS pattern(s) in
_lte-CRS-PatternList2-r16_ if PDSCH is associated with _coresetPoolIndex_ set
to \'1\';
\- otherwise, REs indicated by _lte-CRS-PatternList1-r16_ and _lte-CRS-
PatternList2-r16,_ in _ServingCellConfig_.
\- Within a BWP, the UE can be configured with one or more ZP CSI-RS resource
set configuration(s) for aperiodic, semi-persistent and periodic time-domain
behaviours (higher layer parameters _aperiodic-ZP-CSI-RS-
ResourceSetsToAddModList,_ _sp-ZP-CSI-RS-ResourceSetsToAddModList_ and _p-ZP-
CSI-RS-ResourceSet_ respectively comprised in _PDSCH-Config_), with each ZP
CSI-RS resource set consisting of at most 16 ZP CSI-RS resources (higher layer
parameter _ZP-CSI-RS-Resource_) in numerology of the BWP. The REs indicated by
_p-ZP-CSI-RS-ResourceSet_ are declared as not available for PDSCH. The REs
indicated by _sp-ZP-CSI-RS-ResourceSetsToAddModList_ and aperiodic-ZP-CSI-RS-
ResourceSetsToAddModList are declared as not available for PDSCH when their
triggering and activation are applied, respectively. The following parameters
are configured via higher layer signaling for each ZP CSI-RS resource
configuration:
\- _zp-CSI-RS-ResourceId_ in _ZP-CSI-RS-Resource_ determines ZP CSI-RS
resource configuration identity.
\- _nrofPorts_ in _CSI-RS-ResourceMapping_ defines the number of CSI-RS ports,
where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211].
\- _cdm-Type_ in _CSI-RS-ResourceMapping_ _defines CDM values and pattern,
where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211]._
_\- resourceMapping in ZP-CSI-RS-Resource defines t_ he OFDM symbol and
subcarrier occupancy of the ZP CSI-RS resource within a slot that are given in
Clause 7.4.1.5 of [4, TS 38.211].
_\- periodicityAndOffset in_ _ZP-CSI-RS-Resource defines the ZP-CSI-RS
periodicity and slot offset for periodic/semi-persistent ZP CSI-RS._
The UE may be configured with a DCI field for triggering the aperiodic ZP CSI-
RS. A list of _ZP-CSI-RS-ResourceSet(s)_ , provided by higher layer parameter
_aperiodic-ZP-CSI-RS-ResourceSetsToAddModList_ in _PDSCH-Config_ , is
configured for aperiodic triggering. The maximum number of aperiodic _ZP-CSI-
RS-ResourceSet(s)_ configured per BWP is 3. The bit-length of DCI field _ZP
CSI-RS trigger_ depends on the number of aperiodic _ZP-CSI-RS-ResourceSet(s)_
configured (up to 2 bits). Each non-zero codepoint of \'_ZP CSI-RS\' trigger_
in DCI format 1_1 triggers one aperiodic \'_ZP-CSI-RS-ResourceSet_ \' in the
list _aperiodic-ZP-CSI-RS-ResourceSetsToAddModList_ by indicating the
aperiodic ZP CSI-RS resource set ID. The DCI codepoint \'01\' triggers the
resource set with \'ZP-CSI-RS-ResourceSetId\' set to \'1\', the DCI codepoint
\'10\' triggers the resource set with \'ZP-CSI-RS-ResourceSetId\' set to
\'2\', and the DCI codepoint \'11\' triggers the resource set with \'ZP-CSI-
RS-ResourceSetId\' set to \'3\'. Codepoint \'00\' is reserved for not
triggering aperiodic ZP CSI-RS. When receiving PDSCH scheduled by DCI format
1_0 or PDSCHs with SPS activated by DCI format 1_0, the REs corresponding to
configured resources in _aperiodic-ZP-CSI-RS-ResourceSetsToAddModList_ or in
_aperiodicZP-CSI-RS-ResourceSetsToAddModListDCI-1-2_ are available for PDSCH.
When the UE is configured with multi-slot and single-slot PDSCH scheduling,
the triggered aperiodic ZP CSI-RS is applied to all the slot(s) of the PDSCH
scheduled or the PDSCHs with SPS activated by the PDCCH containing the
trigger.
For a UE configured with a list of semi-persistent _ZP-CSI-RS-ResourceSet(s)_
provided by higher layer parameter _sp-ZP-CSI-RS-ResourceSetsToAddModList_ :
\- when the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the activation command, as described in
clause 6.1.3.19 of [10, TS 38.321], for ZP CSI-RS resource(s), the
corresponding action in [10, TS 38.321] and the UE assumption on the PDSCH RE
mapping corresponding to the activated ZP CSI-RS resource(s) shall be applied
starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS configuration for the
PUCCH.
\- when the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the deactivation command, as described in
clause 6.1.3.19 of [10, TS 38.321], for activated ZP CSI-RS resource(s), the
corresponding action in [10, TS 38.321] and the UE assumption on cessation of
the PDSCH RE mapping corresponding to the de-activated ZP CSI-RS resource(s)
shall be applied starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS configuration for the
PUCCH.
### 5.1.5 Antenna ports quasi co-location
The UE can be configured with a list of up to _M_ _TCI-State_ configurations
within the higher layer parameter _PDSCH-Config_ to decode PDSCH according to
a detected PDCCH with DCI intended for the UE and the given serving cell,
where M depends on the UE capability _maxNumberConfiguredTCIstatesPerCC_. Each
_TCI-State_ contains parameters for configuring a quasi co-location
relationship between one or two downlink reference signals and the DM-RS ports
of the PDSCH, the DM-RS port of PDCCH or the CSI-RS port(s) of a CSI-RS
resource. The quasi co-location relationship is configured by the higher layer
parameter _qcl-Type1_ for the first DL RS, and _qcl-Type2_ for the second DL
RS (if configured). For the case of two DL RSs, the QCL types shall not be the
same, regardless of whether the references are to the same DL RS or different
DL RSs. The quasi co-location types corresponding to each DL RS are given by
the higher layer parameter _qcl-Type_ in _QCL-Info_ and may take one of the
following values:
\- \'typeA\': {Doppler shift, Doppler spread, average delay, delay spread}
\- \'typeB\': {Doppler shift, Doppler spread}
\- \'typeC\': {Doppler shift, average delay}
\- \'typeD\': {Spatial Rx parameter}
The UE receives an activation command, as described in clause 6.1.3.14 of [10,
TS 38.321], used to map up to 8 TCI states to the codepoints of the DCI field
_\'Transmission Configuration Indication\'_ in one CC/DL BWP or in a set of
CCs/DL BWPs, respectively. When a set of TCI state IDs are activated for a set
of CCs/DL BWPs, where the applicable list of CCs is determined by indicated CC
in the activation command, the same set of TCI state IDs are applied for all
DL BWPs in the indicated CCs.
When a UE supports two TCI states in a codepoint of the DCI field
\'_Transmission Configuration Indication\'_ the UE may receive an activation
command, as described in clause 6.1.3.24 of [10, TS 38.321], the activation
command is used to map up to 8 combinations of one or two TCI states to the
codepoints of the DCI field _\'Transmission Configuration Indication\'_. The
UE is not expected to receive more than 8 TCI states in the activation
command.
When the DCI field _\'Transmission Configuration Indication\'_ is present in
DCI format 1_2 and when the number of codepoints S in the DCI field
_\'Transmission Configuration Indication\'_ of DCI format 1_2 is smaller than
the number of TCI codepoints that are activated by the activation command, as
described in clause 6.1.3.14 and 6.1.3.24 of [10, TS38.321], only the first S
activated codepoints are applied for DCI format 1_2.
When the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the activation command, the indicated
mapping between TCI states and codepoints of the DCI field _\'Transmission
Configuration Indication\'_ should be applied starting from the first slot
that is after slot$\ n + {3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS
configuration for the PUCCH. If _tci-PresentInDCI_ is set to \'enabled\' or
_tci-PresentDCI-1-2_ is configured for the CORESET scheduling the PDSCH, and
the time offset between the reception of the DL DCI and the corresponding
PDSCH is equal to or greater than _timeDurationForQCL_ if applicable, after a
UE receives an initial higher layer configuration of TCI states and before
reception of the activation command, the UE may assume that the DM-RS ports of
PDSCH of a serving cell are quasi co-located with the SS/PBCH block determined
in the initial access procedure with respect to _qcl-Type_ set to \'typeA\',
and when applicable, also with respect to _qcl-Type_ set to \'typeD\'.
If a UE is configured with the higher layer parameter _tci-PresentInDCI_ that
is set as \'enabled\' for the CORESET scheduling the PDSCH, the UE assumes
that the TCI field is present in the DCI format 1_1 of the PDCCH transmitted
on the CORESET. If a UE is configured with the higher layer parameter _tci-
PresentDCI-1-2_ for the CORESET scheduling the PDSCH, the UE assumes that the
TCI field with a DCI field size indicated by _tci-PresentDCI-1-2_ is present
in the DCI format 1_2 of the PDCCH transmitted on the CORESET. If the PDSCH is
scheduled by a DCI format not having the TCI field present, and the time
offset between the reception of the DL DCI and the corresponding PDSCH of a
serving cell is equal to or greater than a threshold _timeDurationForQCL_ if
applicable, where the threshold is based on reported UE capability [13, TS
38.306], for determining PDSCH antenna port quasi co-location, the UE assumes
that the TCI state or the QCL assumption for the PDSCH is identical to the TCI
state or QCL assumption whichever is applied for the CORESET used for the
PDCCH transmission within the active BWP of the serving cell.
If the PDSCH is scheduled by a DCI format having the TCI field present, the
TCI field in DCI in the scheduling component carrier points to the activated
TCI states in the scheduled component carrier or DL BWP, the UE shall use the
_TCI-State_ according to the value of the \'_Transmission Configuration
Indication_ \' field in the detected PDCCH with DCI for determining PDSCH
antenna port quasi co-location. The UE may assume that the DM-RS ports of
PDSCH of a serving cell are quasi co-located with the RS(s) in the TCI state
with respect to the QCL type parameter(s) given by the indicated TCI state if
the time offset between the reception of the DL DCI and the corresponding
PDSCH is equal to or greater than a threshold _timeDurationForQCL_ , where the
threshold is based on reported UE capability [13, TS 38.306]. For a single
slot PDSCH, the indicated TCI state(s) should be based on the activated TCI
states in the slot with the scheduled PDSCH. For a multi-slot PDSCH, the
indicated TCI state(s) should be based on the activated TCI states in the
first slot with the scheduled PDSCH, and UE shall expect the activated TCI
states are the same across the slots with the scheduled PDSCH. When the UE is
configured with CORESET associated with a search space set for cross-carrier
scheduling and the UE is not configured with _enableDefaultBeamForCCS_ , the
UE expects _tci-PresentInDCI_ is set as \'enabled\' or _tci-PresentDCI-1-2_ is
configured for the CORESET, and if one or more of the TCI states configured
for the serving cell scheduled by the search space set contains _qcl-Type_ set
to \'typeD\', the UE expects the time offset between the reception of the
detected PDCCH in the search space set and the corresponding PDSCH is larger
than or equal to the threshold _timeDurationForQCL._
Independent of the configuration of _tci-PresentInDCI_ and _tci-
PresentDCI-1-2_ in RRC connected mode, if the offset between the reception of
the DL DCI and the corresponding PDSCH is less than the threshold
_timeDurationForQCL_ and at least one configured TCI state for the serving
cell of scheduled PDSCH contains _qcl-Type_ set to \'typeD\',
\- the UE may assume that the DM-RS ports of PDSCH(s) of a serving cell are
quasi co-located with the RS(s) with respect to the QCL parameter(s) used for
PDCCH quasi co-location indication of the CORESET associated with a monitored
search space with the lowest _controlResourceSetId_ in the latest slot in
which one or more CORESETs within the active BWP of the serving cell are
monitored by the UE. In this case, if the _qcl-Type_ is set to \'typeD\' of
the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they
overlap in at least one symbol, the UE is expected to prioritize the reception
of PDCCH associated with that CORESET. This also applies to the intra-band CA
case (when PDSCH and the CORESET are in different component carriers).
\- If a UE is configured with _enableDefaultTCI-StatePerCoresetPoolIndex_ and
the UE is configured by higher layer parameter _PDCCH-Config_ that contains
two different values of _coresetPoolIndex_ in different _ControlResourceSets,_
\- the UE may assume that the DM-RS ports of PDSCH associated with a value of
_coresetPoolIndex_ of a serving cell are quasi co-located with the RS(s) with
respect to the QCL parameter(s) used for PDCCH quasi co-location indication of
the CORESET associated with a monitored search space with the lowest
_controlResourceSetId_ among CORESETs, which are configured with the same
value of _coresetPoolIndex_ as the PDCCH scheduling that PDSCH, in the latest
slot in which one or more CORESETs associated with the same value of
_coresetPoolIndex_ as the PDCCH scheduling that PDSCH within the active BWP of
the serving cell are monitored by the UE. In this case, if the \'QCL-TypeD\'
of the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they
overlap in at least one symbol and they are associated with same value of
_coresetPoolIndex_ , the UE is expected to prioritize the reception of PDCCH
associated with that CORESET. This also applies to the intra-band CA case
(when PDSCH and the CORESET are in different component carriers).
\- If a UE is configured with _enableTwoDefaultTCI-States_ , and at least one
TCI codepoint indicates two TCI states, the UE may assume that the DM-RS ports
of PDSCH or PDSCH transmission occasions of a serving cell are quasi co-
located with the RS(s) with respect to the QCL parameter(s) associated with
the TCI states corresponding to the lowest codepoint among the TCI codepoints
containing two different TCI states. When the UE is configured by higher layer
parameter _repetitionScheme_ set to \'tdmSchemeA\' or is configured with
higher layer parameter _repetitionNumber_ , and the offset between the
reception of the DL DCI and the first PDSCH transmission occasion is less than
the threshold _timeDurationForQCL,_ the mapping of the TCI states to PDSCH
transmission occasions is determined according to clause 5.1.2.1 by replacing
the indicated TCI states with the TCI states corresponding to the lowest
codepoint among the TCI codepoints containing two different TCI states based
on the activated TCI states in the slot with the first PDSCH transmission
occasion. In this case, if the \'QCL-TypeD\' in both of the TCI states
corresponding to the lowest codepoint among the TCI codepoints containing two
different TCI states is different from that of the PDCCH DM-RS with which they
overlap in at least one symbol, the UE is expected to prioritize the reception
of PDCCH associated with that CORESET. This also applies to the intra-band CA
case (when PDSCH and the CORESET are in different component carriers)
\- In all cases above, if none of configured TCI states for the serving cell
of scheduled PDSCH is configured with _qcl-Type_ set to \'typeD\', the UE
shall obtain the other QCL assumptions from the indicated TCI state(s) for its
scheduled PDSCH irrespective of the time offset between the reception of the
DL DCI and the corresponding PDSCH.
If the PDCCH carrying the scheduling DCI is received on one component carrier,
and the PDSCH scheduled by that DCI is on another component carrier:
\- The _timeDurationForQCL_ is determined based on the subcarrier spacing of
the scheduled PDSCH. If µ~PDCCH~ \ \- other interference signal on REs of NZP CSI-RS resource for channel
> measurement, NZP CSI-RS resource for interference measurement, or CSI-IM
> resource for interference measurement.
For L1-SINR measurement with dedicated interference measurement resources, a
UE assumes:
\- the total received power on dedicated NZP CSI-RS resource for interference
measurement or dedicated CSI-IM resource for interference measurement
corresponds to interference and noise.
##### 5.2.1.4.2 Report Quantity Configurations
A UE may be configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to either \'none\', \'cri-RI-PMI-CQI \', \'cri-
RI-i1\', \'cri-RI-i1-CQI\', \'cri-RI-CQI\', \'cri-RSRP\', \'cri-SINR\', \'ssb-
Index-RSRP\', \'ssb-Index-SINR\' or \'cri-RI-LI-PMI-CQI\'.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity set to \'none\', then the UE shall not report any
quantity for the CSI-ReportConfig._
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-PMI-CQI\', or \'cri-RI-LI-PMI-
CQI\', the UE shall report a preferred precoder matrix for the entire
reporting band, or a preferred precoder matrix per subband, according to
Clause 5.2.2.2.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-i1\',
\- the UE expects, for that _CSI-ReportConfig,_ to be configured with higher
layer parameter _codebookType_ set to \'typeI-SinglePanel\' and _pmi-
FormatIndicator_ set to \'widebandPMI\' and,
\- the UE shall report a PMI consisting of a single wideband indication ( in
Clause 5.2.2.2.1) for the entire CSI reporting band.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-i1-CQI\',
\- the UE expects, for that _CSI-ReportConfig,_ to be configured with higher
layer parameter _codebookType_ set to \'typeI-SinglePanel\' and _pmi-
FormatIndicator_ set to \'widebandPMI\' and,
\- the UE shall report a PMI consisting of a single wideband indication ( in
Clause 5.2.2.2.1) for the entire CSI reporting band. The CQI is calculated
conditioned on the reported assuming PDSCH transmission with precoders
(corresponding to the same but different in Clause 5.2.2.2.1), where the UE
assumes that one precoder is randomly selected from the set of precoders for
each PRG on PDSCH, where the PRG size for CQI calculation is configured by the
higher layer parameter _pdsch-BundleSizeForCSI_.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RI-CQI _\',_
\- if the UE is configured with higher layer parameter _non-PMI-
PortIndication_ contained in a _CSI-ReportConfig,_ _r_ ports are indicated in
the order of layer ordering for rank _r_ and each CSI-RS resource in the CSI
resource setting is linked to the _CSI-ReportConfig_ based on the order of the
associated _NZP-CSI-RS-ResourceId_ in the linked CSI resource setting for
channel measurement given by higher layer parameter
_resourcesForChannelMeasurement_. The configured higher layer parameter _non-
PMI-PortIndication_ contains a sequence of port indices, where are the CSI-RS
port indices associated with rank ν and where is the number of ports in the
CSI-RS resource. The UE shall only report RI corresponding to the configured
fields of _PortIndexFor8Ranks_.
\- if the UE is not configured with higher layer parameter _non-PMI-
PortIndication,_ the UE assumes, for each CSI-RS resource in the CSI resource
setting linked to the _CSI-ReportConfig_ , that the CSI-RS port indices are
associated with ranks where is the number of ports in the CSI-RS resource.
\- When calculating the CQI for a rank, the UE shall use the ports indicated
for that rank for the selected CSI-RS resource. The precoder for the indicated
ports shall be assumed to be the identity matrix scaled by .
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity set to \'cri-RSRP\' or \'ssb-Index-RSRP\',_
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'disabled\', the UE is not required to
update measurements for more than 64 CSI-RS and/or SSB resources, and the UE
shall report in a single report _nrofReportedRS_ (higher layer configured)
different CRI or SSBRI for each report setting.
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'enabled\', the UE is not required to update
measurements for more than 64 CSI-RS and/or SSB resources, and the UE shall
report in a single reporting instance two different CRI or SSBRI for each
report setting, where CSI-RS and/or SSB resources can be received
simultaneously by the UE either with a single spatial domain receive filter,
or with multiple simultaneous spatial domain receive filters.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity set to \'cri-SINR\' or \'ssb-Index-SINR\',_
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'disabled\', _the UE shall report in a
single report_ _nrofReportedRS_ (higher layer configured) different CRI or
SSBRI for each report setting.
\- if the UE is configured with the higher layer parameter
_groupBasedBeamReporting_ set to \'enabled\', the UE shall report in a single
reporting instance two different CRI or SSBRI for each report setting, where
CSI-RS and/or SSB resources can be received simultaneously by the UE.
If the UE is configured with a _CSI-ReportConfig_ with the higher layer
parameter _reportQuantity_ set to \'cri-RSRP\', \'cri-RI-PMI-CQI \', \'cri-
RI-i1\', \'cri-RI-i1-CQI\', \'cri-RI-CQI\', \'cri-RI-LI-PMI-CQI\', or \'cri-
SINR\', and $K_{s} > 1\ $resources are configured in the corresponding
resource set for channel measurement, then the UE shall derive the CSI
parameters other than CRI conditioned on the reported CRI, where CRI _k_ (_k_
≥ 0) corresponds to the configured (_k_ +1)-th entry of associated _nzp-CSI-
RS-Resources_ in the corresponding _NZP-CSI-RS-ResourceSet_ for channel
measurement, and (_k_ +1)-th entry of associated _csi-IM-Resource_ in the
corresponding _csi-IM-ResourceSet_ (if configured) or (_k_ +1)-th entry of
associated _nzp-CSI-RS-Resources_ in the corresponding _NZP-CSI-RS-
ResourceSet_ (if configured for  _CSI-ReportConfig_ with  _reportQuantity_ set
to \'cri-SINR\') for interference measurement. If $K_{s} = 2\ $CSI-RS
resources are configured, each resource shall contain at most 16 CSI-RS ports.
If $2  \- else if the UE is configured with _enableDefaultBeamForCCS_ and when
> receiving the aperiodic CSI-RS, the UE applies the QCL assumption of the
> lowest-ID activated TCI state applicable to the PDSCH within the active BWP
> of the cell in which the CSI-RS is to be received.
\- If the scheduling offset between the last symbol of the PDCCH carrying the
triggering DCI and the first symbol of the aperiodic CSI-RS resources in a
_NZP-CSI-RS-ResourceSet_ is equal to or greater than the UE reported threshold
_beamSwitchTiming_ when the reported value is one of the values of {14,28,48}
and _enableBeamSwitchTiming_ is not provided and the _NZP-CSI-RS-ResourceSet_
is not configured with higher layer parameter _trs-Info_ , or is equal to or
greater than the UE reported threshold _beamSwitchTiming_ when the reported
value is one of the values of {14,28,48} and the _NZP-CSI-RS-ResourceSet_ is
configured with higher layer parameter _trs-Info_ , or is equal to or greater
than 48 when the UE provides _beamSwitchTiming-r16_ and
_enableBeamSwitchTiming_ is provided and the _NZP-CSI-RS-ResourceSet_ is
configured with the higher layer parameter _repetition_ set to \'off\' or
configured without the higher layer parameters _repetition_ and _trs-Info_ ,
or is equal to or greater than the UE reported threshold
_beamSwitchTiming-r16, when enableBeamSwitchTiming_ is provided and the _NZP-
CSI-RS-ResourceSet_ is configured with the higher layer parameter _repetition_
set to \'on\', the UE is expected to apply the QCL assumptions in the
indicated TCI states for the aperiodic CSI-RS resources in the CSI triggering
state indicated by the CSI trigger field in DCI.
\- The UE is not expected to receive aperiodic CSI-RS and PDSCH/aperiodic CSI-
RS associated with different values of _coresetPoolIndex_ in overlapped
symbol(s). The UE is not expected to receive aperiodic CSI-RS and semi-
persistent/periodic CSI-RS with different \'QCL-type D\' in overlapped
symbol(s).
\- A non-zero codepoint of the CSI request field in the DCI is mapped to a CSI
triggering state according to the order of the associated positions of the up
to $2^{N_{\text{TS}}} - 1$ trigger states in _CSI-AperiodicTriggerStateList_
with codepoint \'1\' mapped to the triggering state in the first position.
For a UE configured with the higher layer parameter _CSI-
AperiodicTriggerStateList_ , if a Resource Setting linked to a _CSI-
ReportConfig_ has multiple aperiodic resource sets, only one of the aperiodic
CSI-RS resource sets from the Resource Setting is associated with the trigger
state, and the UE is higher layer configured per trigger state per Resource
Setting to select the one CSI-IM/NZP CSI-RS resource set from the Resource
Setting.
When aperiodic CSI-RS is used with aperiodic reporting, the CSI-RS offset is
configured per resource set by the higher layer parameter
_aperiodicTriggeringOffset_ or _aperiodicTriggeringOffset-r16_. The CSI-RS
triggering offset has the values of {0, 1, 2, 3, 4, 5, 6, ..., 15, 16, 24}
slots. If the UE is not configured with _minimumSchedulingOffsetK0_ for any DL
BWP and _minimumSchedulingOffsetK2_ for any UL BWP and if all the associated
trigger states do not have the higher layer parameter _qcl-Type_ set to
\'typeD\' in the corresponding TCI states, the CSI-RS triggering offset is
fixed to zero. The aperiodic triggering offset of the CSI-IM follows offset of
the associated NZP CSI-RS for channel measurement. The aperiodic CSI-RS is
transmitted in a slot , $K_{s} = n + X + \left\lfloor \left(
\frac{N_{slot,offset,PDCCH}^{\text{CA}}}{2^{\mu_{offset,PDCCH}}} -
\frac{N_{slot,offset,CSIRS}^{\text{CA}}}{2^{\mu_{offset,CSIRS}}} \right)
\bullet 2^{\mu_{\text{CSIRS}}} \right\rfloor$, if UE is configured with _ca-
SlotOffset_ for at least one of the triggered and triggering cell, and in slot
, otherwise, and where
_\- n_ is the slot containing the triggering DCI, _X_ is the CSI-RS triggering
offset according to the higher layer parameter _aperiodicTriggeringOffset_ or
_aperiodicTriggeringOffset-r16_ ,
_-_ $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}\ $and
$\mu_{\text{offset}\text{,PDCCH}}$ are the$\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the which are determined by higher-layer configured
_ca-SlotOffset_ for the cell receiving the PDCCH, $N_{\text{slot,\ offset,\
}\text{CSIRS}}^{\text{CA}}\ $and $\mu_{\text{offset}\text{,CSIRS}}$ are
the$\text{\ N}_{\text{slot,\ offset}}^{\text{CA}}$ and the which are
determined by higher-layer configured _ca-SlotOffset_ for the cell
transmitting the CSI-RS respectively, as defined in [4, TS 38.211] clause 4.5.
The UE does not expect that aperiodic CSI-RS is transmitted before the OFDM
symbol(s) carrying its triggering DCI. When the minimum scheduling offset
restriction is applied, UE is not expected to be triggered by CSI triggering
state indicated by the CSI request field in DCI in which CSI-RS triggering
offset is smaller than the currently applicable minimum scheduling offset
restriction _K_ ~0min~.
If interference measurement is performed on aperiodic NZP CSI-RS, a UE is not
expected to be configured with a different aperiodic triggering offset of the
NZP CSI-RS for interference measurement from the associated NZP CSI-RS for
channel measurement.
If the UE is configured with a single carrier for uplink, the UE is not
expected to transmit more than one aperiodic CSI report triggered by different
DCIs on overlapping OFDM symbols.
##### 5.2.1.5.1a Aperiodic CSI Reporting/Aperiodic CSI-RS when the triggering
PDCCH and the CSI-RS have different numerologies
When the triggering PDCCH and the triggered aperiodic CSI-RS are of different
numerologies, the behavior defined in 5.2.1.5.1 for the case where the
numerologies are the same applies with the following exceptions:
Beam switch timing:
\- If the scheduling offset between the last symbol of the PDCCH carrying the
triggering DCI and the first symbol of the aperiodic CSI-RS resources in a
_NZP-CSI-RS-ResourceSet_ configured without higher layer parameter _trs-Info_
is smaller than _beamSwitchTiming_ \+ _d_ $\bullet
2^{\mu_{\text{CSIRS}}}/2^{\mu_{\text{PDCCH}}}$ in CSI-RS symbols _,_ as
defined in [13, TS 38.306], when the reported value is one of the values of
{14, 28, 48} and _enableBeamSwitchTiming_ is not provided, or is smaller than
48+ $d \bullet 2^{\mu_{\text{CSIRS}}}/2^{\mu_{\text{PDCCH}}}$ in CSI-RS
symbols when the UE provides _beamSwitchTiming-r16_ and
_enableBeamSwitchTiming_ is provided and the _NZP-CSI-RS-ResourceSet_ is
configured with the higher layer parameter _repetition_ set to \'off\' or
configured without the higher layer parameter _repetition,_ or is smaller than
_beamSwitchTiming-r16 +_ $d \bullet
2^{\mu_{\text{CSIRS}}}/2^{\mu_{\text{PDCCH}}}$ in CSI-RS symbols _, when
enableBeamSwitchTiming_ is provided and the _NZP-CSI-RS-ResourceSet_ is
configured with the higher layer parameter _repetition_ set to \'on\', where
if the µ~PDCCH~ \ µ~CSIRS~.. The aperiodic CSI-RS is transmitted in a slot , if UE is
configured with _ca-SlotOffset_ for at least one of the triggered and
triggering cell, and _K~s\ ~_ = {width="1.0in" height="0.5145833333333333in"},
otherwise, and where
_\- n_ is the slot containing the triggering DCI, _X_ is the CSI-RS triggering
offset in the numerology of CSI-RS according to the higher layer parameter
_aperiodicTriggeringOffset_ or _aperiodicTriggeringOffset-r16_ ,
\- $\mu_{\text{CSIRS}}$ and $\mu_{\text{PDCCH}}$ are the subcarrier spacing
configurations for CSI-RS and PDCCH, respectively,
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}$are the$\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH
respectively, $N_{\text{slot,\ offset,\ }\text{CSIRS}}^{\text{CA}}\ $and
$\mu_{\text{offset}\text{,}\text{CSIRS}}$ are the$\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell transmitting the CSI-RS
respectively, as defined in [4, TS 38.211] clause 4.5
\- If the µ~PDCCH~ \ µ~CSIRS~, the UE is expected to be able to measure the
aperiodic CSI RS, if the CSI-RS starts no earlier than at least _Ncsirs_ PDCCH
symbols after the end of the PDCCH triggering the aperiodic CSI-RS.
Table 5.2.1.5.1a: _N~csirs~_ as a function of the subcarrier spacing of the
triggering PDCCH
**_µ~PDCCH~_** **_N~csirs~_ [symbols]**
* * *
0 4 1 5 2 10 3 14
When the triggering PDCCH and the triggered aperiodic CSI-RS are of different
numerologies, the CSI request constraint and CSI reporting constraint defined
in 5.2.1.5.1 for the case where the numerologies are the same applies with the
following additions:
\- CSI request constraints:
\- A UE is not expected to receive more than one CSI request per reference
slot length across all CCs in a cell group, where the SCS of the reference
slot is the minimum of SCS of the PDCCH with which the DCI was transmitted,
the SCS of the PUSCH with which the CSI report is to be transmitted, and the
SCS of the minimum SCS of the CSI-RS associated to the CSI reports triggered
by the DCI. The beginning of a slot length is defined according the PDCCH cell
with which the DCI carrying the CSI request is transmitted.
\- CSI reporting constraints:
\- A UE is not expected to receive more than one CSI request for transmission
in a given reference slot length across all CCs in a cell group, where the SCS
of the reference slot is the minimum of SCS of the PDCCH with which the DCI
was transmitted, the SCS of the PUSCH with which the CSI report is to be
transmitted, and the SCS of the minimum SCS of the CSI-RS associated to the
CSI reports triggered by the DCI. The beginning of a slot length is defined
according the PUSCH cell with which the CSI report is transmitted.
##### 5.2.1.5.2 Semi-persistent CSI/Semi-persistent CSI-RS
For semi-persistent reporting on PUSCH, a set of trigger states are higher
layer configured by _CSI-SemiPersistentOnPUSCH-TriggerStateList,_ where the
CSI request field in DCI scrambled with SP-CSI-RNTI activates one of the
trigger states. A UE is not expected to receive a DCI scrambled with SP-CSI-
RNTI activating one semi-persistent CSI report with the same _CSI-
ReportConfigId_ as in a semi-persistent CSI report which is activated by a
previously received DCI scrambled with SP-CSI-RNTI.
For semi-persistent reporting on PUCCH, the PUCCH resource used for
transmitting the CSI report are configured by _reportConfigType_. Semi-
persistent reporting on PUCCH is activated by an activation command as
described in clause 6.1.3.16 of [10, TS 38.321], which selects one of the
semi-persistent Reporting Settings for use by the UE on the PUCCH. When the UE
would transmit a PUCCH with HARQ-ACK information in slot _n_ corresponding to
the PDSCH carrying the activation command, the indicated semi-persistent
Reporting Setting should be applied starting from the first slot that is after
slot $n + {3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS configuration
for the PUCCH.
For a UE configured with CSI resource setting(s) where the higher layer
parameter _resourceType_ set to \'semiPersistent\'.
\- when a UE receives an activation command, as described in clause 6.1.3.12
of [10, TS 38.321], for CSI-RS resource set(s) for channel measurement and
CSI-IM/NZP CSI-RS resource set(s) for interference measurement associated with
configured CSI resource setting(s), and when the UE would transmit a PUCCH
with HARQ-ACK information in slot _n_ corresponding to the PDSCH carrying the
selection command, the corresponding actions in [10, TS 38.321] and the UE
assumptions (including QCL assumptions provided by a list of reference to
_TCI-State\'s,_ one per activated resource) on CSI-RS/CSI-IM transmission
corresponding to the configured CSI-RS/CSI-IM resource configuration(s) shall
be applied starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS configuration for the
PUCCH. If a _TCI-State_ referred to in the list is configured with a reference
to an RS configured with _qcl-Type_ set to \'_typeD_ \', that RS can be an
SS/PBCH block, periodic or semi-persistent CSI-RS located in same or different
CC/DL BWP.
\- when a UE receives a deactivation command, as described in clause 6.1.3.12
of [10, TS 38.321], for activated CSI-RS/CSI-IM resource set(s) associated
with configured CSI resource setting(s), and when the UE would transmit a
PUCCH with HARQ-ACK information in slot _n_ corresponding to the PDSCH
carrying the deactivation command, the corresponding actions in [10, TS
38.321] and UE assumption on cessation of CSI-RS/CSI-IM transmission
corresponding to the deactivated CSI-RS/CSI-IM resource set(s) shall apply
starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS configuration for the
PUCCH.
A codepoint of the CSI request field in the DCI is mapped to a SP-CSI
triggering state according to the order of the positions of the configured
trigger states in _CSI-SemiPersistentOnPUSCH-TriggerStateList_ , with
codepoint \'0\' mapped to the triggering state in the first position. A UE
validates, for semi-persistent CSI activation or release, a PDCCH on a DCI
only if the following conditions are met:
> \- the CRC parity bits of the DCI format are scrambled with a SP-CSI-RNTI
> provided by higher layer parameter _sp-CSI-RNTI_
\- Special fields for the DCI format are set according to Table 5.2.1.5.2-1 or
Table 5.2.1.5.2-2.
If validation is achieved, the UE considers the information in the DCI format
as a valid activation or valid release of semi-persistent CSI transmission on
PUSCH, and the UE activates or deactivates a CSI Reporting Setting indicated
by CSI request field in the DCI. If validation is not achieved, the UE
considers the DCI format as having been detected with a non-matching CRC.
**Table 5.2.1.5.2-1: Special fields for semi-persistent CSI activation PDCCH
validation**
+---------------------+----------------------+ | | DCI format 0_1/0_2 | +---------------------+----------------------+ | HARQ process number | set to all \'0\'s | | | | | (if present) | | +---------------------+----------------------+ | Redundancy version | set to all \'0\'s | | | | | (if present) | | +---------------------+----------------------+
Table 5.2.1.5.2-2: Special fields for semi-persistent CSI deactivation PDCCH
validation
+------------------------------+--------------------------------------+ | | DCI format 0_1/0_2 | +------------------------------+--------------------------------------+ | HARQ process number | set to all \'0\'s | | | | | (if present) | | +------------------------------+--------------------------------------+ | Modulation and coding scheme | set to all \'1\'s | +------------------------------+--------------------------------------+ | Resource block assignment | If higher layer configures RA type 0 | | | only, set to all \'0\'s; | | | | | | If higher layer configures RA type 1 | | | only, set to all \'1\'s; | | | | | | If higher layer configures dynamic | | | switch between RA type 0 and 1, then | | | if MSB is\'0\', set to all \'0\'s; | | | else, set to all \'1\'s | | | | | | For DCI 0_1, if higher layer | | | configures RA type 2, set to all | | | \'1\'s if _µ_ = 0; set to all \'0\'s | | | if _µ_ = 1 | +------------------------------+--------------------------------------+ | Redundancy version | set to all \'0\'s | | | | | (if present) | | +------------------------------+--------------------------------------+
If the UE has an active semi-persistent CSI-RS/CSI-IM resource configuration,
or an active semi-persistent ZP CSI-RS resource set configuration, and has not
received a deactivation command, the activated semi-persistent CSI-RS/CSI-IM
resource set or the activated semi-persistent ZP CSI-RS resource set
configurations are considered to be active when the corresponding DL BWP is
active, otherwise they are considered suspended.
If the UE is configured with carrier deactivation, the following
configurations in the carrier in activated state would also be deactivated and
need re-activation configuration(s): semi-persistent CSI-RS/CSI- IM resource,
semi-persistent CSI reporting on PUCCH, semi-persistent SRS, semi-persistent
ZP CSI-RS resource set.
#### 5.2.1.6 CSI processing criteria
The UE indicates the number of supported simultaneous CSI calculations
$N_{\text{CPU}}$ with parameter _simultaneousCSI-ReportsPerCC_ in a component
carrier, and _simultaneousCSI-ReportsAllCC_ across all component carriers. If
a UE supports $N_{\text{CPU}}$ simultaneous CSI calculations it is said to
have $N_{\text{CPU}}$ CSI processing units for processing CSI reports. If _L_
CPUs are occupied for calculation of CSI reports in a given OFDM symbol, the
UE has $N_{\text{CPU}} - L$ unoccupied CPUs. If _N_ CSI reports start
occupying their respective CPUs on the same OFDM symbol on which
$N_{\text{CPU}} - L$ CPUs are unoccupied, where each CSI report $n = 0,\
\ldots,\ N - 1$ corresponds to $O_{\text{CPU}}^{(n)}$, the UE is not required
to update the $N - M$ requested CSI reports with lowest priority (according to
Clause 5.2.5), where $0 \leq M \leq N\ $is the largest value such that
$\sum_{n = 0}^{M - 1}O_{\text{CPU}}^{(n)} \leq N_{\text{CPU}} - L\ $ holds.
A UE is not expected to be configured with an aperiodic CSI trigger state
containing more than $N_{\text{CPU}}$ Reporting Settings. Processing of a CSI
report occupies a number of CPUs for a number of symbols as follows:
\- $O_{\text{CPU}} = 0\ \ $for a CSI report with CSI-ReportConfig with higher
layer parameter _reportQuantity_ set to \'none\' and _CSI-RS-ResourceSet_ with
higher layer parameter _trs-Info_ configured
\- $O_{\text{CPU}} = 1\ $ for a CSI report with _CSI-ReportConfig_ with higher
layer parameter _reportQuantity_ set to \'cri-RSRP\', \'ssb-Index-RSRP\',
\'cri-SINR\', \'ssb-Index-SINR\' or \'none\' (and _CSI-RS-ResourceSet_ with
higher layer parameter _trs-Info_ not configured)
\- for a CSI report with _CSI-ReportConfig_ with higher layer parameter
_reportQuantity_ set to \'cri-RI-PMI-CQI\', \'cri-RI-i1\', \'cri-RI-i1-CQI\',
\'cri-RI-CQI\', or \'cri-RI-LI-PMI-CQI\',
\- if a CSI report is aperiodically triggered without transmitting a PUSCH
with either transport block or HARQ-ACK or both when _L_ = 0 CPUs are
occupied, where the CSI corresponds to a single CSI with wideband frequency-
granularity and to at most 4 CSI-RS ports in a single resource without CRI
report and where _codebookType_ is set to \'typeI-SinglePanel\' or where
_reportQuantity_ is set to \'cri-RI-CQI\', $O_{\text{CPU}} =
N_{\text{CPU}}$$O_{\text{CPU}} = N_{\text{CPU}}$,
\- otherwise, $O_{\text{CPU}} = K_{s}$$O_{\text{CPU}} = K_{S}$, where $K_{s}\
$$K_{s}\ $is the number of CSI-RS resources in the CSI-RS resource set for
channel measurement.
For a CSI report with _CSI-ReportConfig_ with higher layer parameter
_reportQuantity_ not set to \'none\', the CPU(s) are occupied for a number of
OFDM symbols as follows:
\- A periodic or semi-persistent CSI report (excluding an initial semi-
persistent CSI report on PUSCH after the PDCCH triggering the report) occupies
CPU(s) from the first symbol of the earliest one of each CSI-RS/CSI-IM/SSB
resource for channel or interference measurement, respective latest CSI-
RS/CSI-IM/SSB occasion no later than the corresponding CSI reference resource,
until the last symbol of the configured PUSCH/PUCCH carrying the report.
\- An aperiodic CSI report occupies CPU(s) from the first symbol after the
PDCCH triggering the CSI report until the last symbol of the scheduled PUSCH
carrying the report.
\- An initial semi-persistent CSI report on PUSCH after the PDCCH trigger
occupies CPU(s) from the first symbol after the PDCCH until the last symbol of
the scheduled PUSCH carrying the report.
For a CSI report with _CSI-ReportConfig_ with higher layer parameter
_reportQuantity_ set to \'none\' and _CSI-RS-ResourceSet_ with higher layer
parameter _trs-Info_ not configured, the CPU(s) are occupied for a number of
OFDM symbols as follows:
\- A semi-persistent CSI report (excluding an initial semi-persistent CSI
report on PUSCH after the PDCCH triggering the report) occupies CPU(s) from
the first symbol of the earliest one of each transmission occasion of periodic
or semi-persistent CSI-RS/SSB resource for channel measurement for L1-RSRP
computation, until $Z_{3}^{'}$ symbols after the last symbol of the latest one
of the CSI-RS/SSB resource for channel measurement for L1-RSRP computation in
each transmission occasion.
\- An aperiodic CSI report occupies CPU(s) from the first symbol after the
PDCCH triggering the CSI report until the last symbol between $Z_{3}$ symbols
after the first symbol after the PDCCH triggering the CSI report and
$Z_{3}^{'}$ symbols after the last symbol of the latest one of each CSI-RS/SSB
resource for channel measurement for L1-RSRP computation.
where $(Z_{3},Z_{3}^{'})$ are defined in the table 5.4-2.
In any slot, the UE is not expected to have more active CSI-RS ports or active
CSI-RS resources in active BWPs than reported as capability. NZP CSI-RS
resource is active in a duration of time defined as follows. For aperiodic
CSI-RS, starting from the end of the PDCCH containing the request and ending
at the end of the scheduled PUSCH containing the report associated with this
aperiodic CSI-RS. For semi-persistent CSI-RS, starting from the end of when
the activation command is applied, and ending at the end of when the
deactivation command is applied. For periodic CSI-RS, starting when the
periodic CSI-RS is configured by higher layer signalling, and ending when the
periodic CSI-RS configuration is released. If a CSI-RS resource is referred
_N_ times by one or more CSI Reporting Settings, the CSI-RS resource and the
CSI-RS ports within the CSI-RS resource are counted _N_ times.
### 5.2.2 Channel state information
#### 5.2.2.1 Channel quality indicator (CQI)
The CQI indices and their interpretations are given in Table 5.2.2.1-2 or
Table 5.2.2.1-4 for reporting CQI based on QPSK, 16QAM and 64QAM. The CQI
indices and their interpretations are given in Table 5.2.2.1-3 for reporting
CQI based on QPSK, 16QAM, 64QAM and 256QAM.
Based on an unrestricted observation interval in time unless specified
otherwise in this Clause, and an unrestricted observation interval in
frequency, the UE shall derive for each CQI value reported in uplink slot _n_
the highest CQI index which satisfies the following condition:
\- A single PDSCH transport block with a combination of modulation scheme,
target code rate and transport block size corresponding to the CQI index, and
occupying a group of downlink physical resource blocks termed the CSI
reference resource, could be received with a transport block error probability
not exceeding:
\- 0.1, if the higher layer parameter _cqi-Table_ in _CSI-ReportConfig_
configures \'table1\' (corresponding to Table 5.2.2.1-2), or \'table2\'
(corresponding to Table 5.2.2.1-3), or
\- 0.00001, if the higher layer parameter _cqi-Table_ in _CSI-ReportConfig_
configures \'table3\' (corresponding to Table 5.2.2.1-4).
If the higher layer parameter _timeRestrictionForChannelMeasurements_ is set
to \"_notConfigured_ \", the UE shall derive the channel measurements for
computing CSI value reported in uplink slot _n_ based on only the NZP CSI-RS,
no later than the CSI reference resource, (defined in TS 38.211[4]) associated
with the CSI resource setting.
If the higher layer parameter _timeRestrictionForChannelMeasurements_ in _CSI-
ReportConfig_ is set to \"_Configured_ \", the UE shall derive the channel
measurements for computing CSI reported in uplink slot _n_ based on only the
most recent, no later than the CSI reference resource, occasion of NZP CSI-RS
(defined in [4, TS 38.211]) associated with the CSI resource setting.
If the higher layer parameter _timeRestrictionForInterferenceMeasurements_ is
set to \"_notConfigured_ \", the UE shall derive the interference measurements
for computing CSI value reported in uplink slot _n_ based on only the CSI-IM
and/or NZP CSI-RS for interference measurement no later than the CSI reference
resource associated with the CSI resource setting.
If the higher layer parameter _timeRestrictionForInterferenceMeasurements_ in
_CSI-ReportConfig_ is set to \"_Configured_ \", the UE shall derive the
interference measurements for computing the CSI value reported in uplink slot
_n_ based on the most recent, no later than the CSI reference resource,
occasion of CSI-IM and/or NZP CSI-RS for interference measurement (defined in
[4, TS 38.211]) associated with the CSI resource setting.
For each sub-band index _s,_ a 2-bit sub-band differential CQI is defined as:
\- Sub-band Offset level (_s_) = sub-band CQI index (_s_) - wideband CQI
index.
The mapping from the 2-bit sub-band differential CQI values to the offset
level is shown in Table 5.2.2.1-1
Table 5.2.2.1-1: Mapping sub-band differential CQI value to offset level
Sub-band differential CQI value Offset level
* * *
0 0 1 1 2 ≥ 2 3 ≤-1
A combination of modulation scheme and transport block size corresponds to a
CQI index if:
\- the combination could be signaled for transmission on the PDSCH in the CSI
reference resource according to the Transport Block Size determination
described in Clause 5.1.3.2, and
\- the modulation scheme is indicated by the CQI index, and
\- the combination of transport block size and modulation scheme when applied
to the reference resource results in the effective channel code rate which is
the closest possible to the code rate indicated by the CQI index. If more than
one combination of transport block size and modulation scheme results in an
effective channel code rate equally close to the code rate indicated by the
CQI index, only the combination with the smallest of such transport block
sizes is relevant.
Table 5.2.2.1-2: 4-bit CQI Table
* * *
CQI index modulation code rate x 1024 efficiency 0 out of range  
1 QPSK 78 0.1523 2 QPSK 120 0.2344 3 QPSK 193 0.3770 4 QPSK 308 0.6016 5 QPSK
449 0.8770 6 QPSK 602 1.1758 7 16QAM 378 1.4766 8 16QAM 490 1.9141 9 16QAM 616
2.4063 10 64QAM 466 2.7305 11 64QAM 567 3.3223 12 64QAM 666 3.9023 13 64QAM
772 4.5234 14 64QAM 873 5.1152 15 64QAM 948 5.5547
* * *
Table 5.2.2.1-3: 4-bit CQI Table 2
* * *
CQI index modulation code rate x 1024 efficiency 0 out of range  
1 QPSK 78 0.1523 2 QPSK 193 0.3770 3 QPSK 449 0.8770 4 16QAM 378 1.4766 5
16QAM 490 1.9141 6 16QAM 616 2.4063 7 64QAM 466 2.7305 8 64QAM 567 3.3223 9
64QAM 666 3.9023 10 64QAM 772 4.5234 11 64QAM 873 5.1152 12 256QAM 711 5.5547
13 256QAM 797 6.2266 14 256QAM 885 6.9141 15 256QAM 948 7.4063
* * *
Table 5.2.2.1-4: 4-bit CQI Table 3
* * *
CQI index modulation code rate x 1024 efficiency 0 out of range  
1 QPSK 30 0.0586 2 QPSK 50 0.0977 3 QPSK 78 0.1523 4 QPSK 120 0.2344 5 QPSK
193 0.3770 6 QPSK 308 0.6016 7 QPSK 449 0.8770 8 QPSK 602 1.1758 9 16QAM 378
1.4766 10 16QAM 490 1.9141 11 16QAM 616 2.4063 12 64QAM 466 2.7305 13 64QAM
567 3.3223 14 64QAM 666 3.9023 15 64QAM 772 4.5234
* * *
##### 5.2.2.1.1 (void)
#### 5.2.2.2 Precoding matrix indicator (PMI)
##### 5.2.2.2.1 Type I Single-Panel Codebook
For 2 antenna ports {3000, 3001} and the UE configured with higher layer
parameter _codebookType_ set to \'typeI-SinglePanel\' each PMI value
corresponds to a codebook index given in Table 5.2.2.2.1-1. The UE is
configured with the higher layer parameter _twoTX-CodebookSubsetRestriction_.
The bitmap parameter _twoTX-CodebookSubsetRestriction_ forms the bit sequence
where is the LSB and is the MSB and where a bit value of zero indicates that
PMI reporting is not allowed to correspond to the precoder associated with the
bit. Bits 0 to 3 are associated respectively with the codebook indices 0 to 3
for layer, and bits 4 and 5 are associated respectively with the codebook
indices 0 and 1 for layers.
Table 5.2.2.2.1-1: Codebooks for 1-layer and 2-layer CSI reporting using
antenna ports 3000 to 3001
Codebook index Number of layers
* * *
                   1                  2
0  
1  
2 - 3 -
For 4 antenna ports {3000, 3001, 3002, 3003}, 8 antenna ports {3000, 3001,
..., 3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000,
3001, ..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna
ports {3000, 3001, ..., 3031}, and the UE configured with higher layer
parameter _codebookType_ set to \'typeI-SinglePanel\', except when the number
of layers (where is the associated RI value), each PMI value corresponds to
three codebook indices ,,. When the number of layers , each PMI value
corresponds to four codebook indices ,,,. The composite codebook index is
defined by
The codebooks for 1-8 layers are given respectively in Tables 5.2.2.2.1-5,
5.2.2.2.1-6, 5.2.2.2.1-7, 5.2.2.2.1-8, 5.2.2.2.1-9, 5.2.2.2.1-10,
5.2.2.2.1-11, and 5.2.2.2.1-12. The mapping from to and for 2-layer reporting
is given in Table 5.2.2.2.1-3. The mapping from to and for 3-layer and 4-layer
reporting when is given in Table 5.2.2.2.1-4. The quantities , , , , and are
given by
\- The values of and are configured with the higher layer parameter _n1-n2_ ,
respectively. The supported configurations of for a given number of CSI-RS
ports and the corresponding values of are given in Table 5.2.2.2.1-2. The
number of CSI-RS ports, , is.
\- UE shall only use and shall not report if the value of _N~2~_ is 1.
The bitmap parameter _n1-n2_ forms the bit sequence where is the LSB and is
the MSB and where a bit value of zero indicates that PMI reporting is not
allowed to correspond to any precoder associated with the bit. The number of
bits is given by . Except when the number of layers and the number of antenna
ports is 16, 24, or 32, bit is associated with all precoders based on the
quantity , , . When the number of layers and the number of antenna ports is
16, 24, or 32,
\- bits , , and are each associated with all precoders based on the quantity ,
, ;
\- if one or more of the associated bits is zero, then PMI reporting is not
allowed to correspond to any precoder based on .
For UE configured with higher layer parameter _codebookType_ set to \'typeI-
SinglePanel\', the bitmap parameter _typeI-SinglePanel-ri‑Restriction_ forms
the bit sequence where is the LSB and is the MSB. When is zero, , PMI and RI
reporting are not allowed to correspond to any precoder associated with
layers.
For UE configured with higher layer parameter _reportQuantity_ set to \'cri-
RI-i1-CQI\', the bitmap parameter _typeI-SinglePanel-
codebookSubsetRestriction-i2_ forms the bit sequence $b_{15},\ldots$,$b_{1},\
b_{0}$ where $b_{0}$ is the LSB and $b_{15}$ is the MSB. The bit $b_{i}$ is
associated with precoders corresponding to codebook index $i_{2} = i$. When
$b_{i}$ is zero, the randomly selected precoder for CQI calculation is not
allowed to correspond to any precoder associated with the bit $b_{i}$.
Table 5.2.2.2.1-2: Supported configurations of and
* * *
Number of\  
CSI-RS antenna ports,
4 (2,1) (4,1)
8 (2,2) (4,4)
                          (4,1)    (4,1)
12 (3,2) (4,4)
                          (6,1)    (4,1)
16 (4,2) (4,4)
                          (8,1)    (4,1)
24 (4,3) (4,4)
                          (6,2)    (4,4)
                          (12,1)   (4,1)
32 (4,4) (4,4)
                          (8,2)    (4,4)
                          (16,1)   (4,1)
* * *
Table 5.2.2.2.1-3: Mapping of to and for 2-layer CSI reporting
* * *
0 0 0 0 0 0 0 0 0 1 0 0 0 0 2 0 0 0 3 0 0
* * *
Table 5.2.2.2.1-4: Mapping of to and for 3-layer and 4-layer CSI reporting
when
* * *
0 0 0 0 0 0 1 0 0 0 0  
2 0 0  
3 0 0
* * *
Table 5.2.2.2.1-5: Codebook for 1-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1
* * *
where .
_codebookMode_ = 2,
* * *
                           0    1    2    3
                           4    5    6    7
                           8    9    10   11
                           12   13   14   15
where .
_codebookMode =_ 2,
* * *
                           0    1    2    3
                           4    5    6    7
                           8    9    10   11
                           12   13   14   15
where .
Table 5.2.2.2.1-6: Codebook for 2-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+ | _codebookMode_ = 1 | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | +------------------------------------------------------------+---+---+---+
+------------------------------------------------------------+---+---+---+ | _codebookMode =_ 2, | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 0 | 1 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 2 | 3 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 4 | 5 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | | | 6 | 7 | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | +------------------------------------------------------------+---+---+---+
+--------------------------------------------------------+---+---+---+---+---+ | _codebookMode =_ 2, | | | | | | +========================================================+===+===+===+===+===+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | | | 0 | 1 | 2 | 3 | +--------------------------------------------------------+---+---+---+---+---+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | | | 4 | 5 | 6 | 7 | +--------------------------------------------------------+---+---+---+---+---+ | | | | | | | +--------------------------------------------------------+---+---+---+---+---+ | where . | | | | | | | | | | | | | | and the mapping from to is given in Table 5.2.2.2.1-3. | | | | | | +--------------------------------------------------------+---+---+---+---+---+
Table 5.2.2.2.1-7: Codebook for 3-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+ | _codebookMode =_ 1-2, | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-4. | | | | +------------------------------------------------------------+---+---+---+
_codebookMode_ = 1-2,
* * *
where .
Table 5.2.2.2.1-8: Codebook for 4-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+ | _codebookMode =_ 1-2, | | | | +============================================================+===+===+===+ | | | | | +------------------------------------------------------------+---+---+---+ | | | | | +------------------------------------------------------------+---+---+---+ | where . | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-4. | | | | +------------------------------------------------------------+---+---+---+
_codebookMode_ = 1-2,
* * *
where .
Table 5.2.2.2.1-9: Codebook for 5-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
Table 5.2.2.2.1-10: Codebook for 6-layer CSI reporting using antenna ports
3000 to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
Table 5.2.2.2.1-11: Codebook for 7-layer CSI reporting using antenna ports
3000 to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
Table 5.2.2.2.1-12: Codebook for 8-layer CSI reporting using antenna ports
3000 to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1-2
* * *
where .
##### 5.2.2.2.2 Type I Multi-Panel Codebook
For 8 antenna ports {3000, 3001, ..., 3007}, 16 antenna ports {3000, 3001,
..., 3015}, and 32 antenna ports {3000, 3001, ..., 3031}, and the UE
configured with higher layer parameter _codebookType_ set to \'typeI-
MultiPanel\',
\- The values of , and are configured with the higher layer parameters
_ng-n1-n2_. The supported configurations of for a given number of CSI-RS ports
and the corresponding values of are given in Table 5.2.2.2.2-1. The number of
CSI-RS ports, , is .
\- When , _codebookMode_ shall be set to either \'1\' or \'2\'. When ,
_codebookMode_ shall be set to \'1\'.
The bitmap parameter _ng-n1-n2_ forms the bit sequence where is the LSB and is
the MSB and where a bit value of zero indicates that PMI reporting is not
allowed to correspond to any precoder associated with the bit. The number of
bits is given by . Bit is associated with all precoders based on the quantity
, , , as defined below. The bitmap parameter _ri‑Restriction_ forms the bit
sequence where is the LSB and is the MSB. When is zero, , PMI and RI reporting
are not allowed to correspond to any precoder associated with layers.
Table 5.2.2.2.2-1: Supported configurations of and
* * *
Number of\  
CSI-RS antenna ports,
8 (2,2,1) (4,1)
16 (2,4,1) (4,1)
                          (4,2,1)   (4,1)
                          (2,2,2)   (4,4)
32 (2,8,1) (4,1)
                          (4,4,1)   (4,1)
                          (2,4,2)   (4,4)
                          (4,2,2)   (4,4)
* * *
Each PMI value corresponds to the codebook indices and , where is the vector
and is the associated RI value. When _codebookMode_ is set to \'1\', is
.
When _codebookMode_ is set to \'2\', and are
.
The mapping from to and for 2-layer reporting is given in Table 5.2.2.2.1-3.
The mapping from to and for 3-layer and 4-layer reporting is given in Table
5.2.2.2.2-2.
\- UE shall only use and shall not report if the value of _N~2~_ is 1.
Table 5.2.2.2.2-2: Mapping of to and for 3-layer and 4-layer CSI reporting
* * *
0 0 0 0 0 0 1 0 0 0 0  
2 0 0  
3 0 0
* * *
Several quantities are used to define the codebook elements. The quantities ,
, , , and are given by
Furthermore, the quantities and () are given by
where
,
and the quantities and () are given by
where
.
The codebooks for 1-4 layers are given respectively in Tables 5.2.2.2.2-3,
5.2.2.2.2-4, 5.2.2.2.2-5, and 5.2.2.2.2-6.
Table 5.2.2.2.2-3: Codebook for 1-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
_codebookMode_ = 1,
* * *
                           ,
where .
_codebookMode_ = 2,
* * *
where .
Table 5.2.2.2.2-4: Codebook for 2-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 1, | | | | | +============================================================+===+===+===+===+ | | | , | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | | +------------------------------------------------------------+---+---+---+---+
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 2, | | | | | +============================================================+===+===+===+===+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.1-3. | | | | | +------------------------------------------------------------+---+---+---+---+
Table 5.2.2.2.2-5: Codebook for 3-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 1, | | | | | +============================================================+===+===+===+===+ | | | , | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 2, | | | | | +============================================================+===+===+===+===+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
Table 5.2.2.2.2-6: Codebook for 4-layer CSI reporting using antenna ports 3000
to 2999+_P_ ~CSI-RS~
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 1, | | | | | +============================================================+===+===+===+===+ | | | , | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
+------------------------------------------------------------+---+---+---+---+ | _codebookMode_ = 2, | | | | | +============================================================+===+===+===+===+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | | | | | | +------------------------------------------------------------+---+---+---+---+ | where | | | | | | | | | | | | and the mapping from to and is given in Table 5.2.2.2.2-2. | | | | | +------------------------------------------------------------+---+---+---+---+
##### 5.2.2.2.3 Type II Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and the UE configured with higher layer parameter
_codebookType_ set to \'typeII\'
\- The values of and are configured with the higher layer parameter
_n1-n2-codebookSubsetRestriction_. The supported configurations of for a given
number of CSI-RS ports and the corresponding values of are given in Table
5.2.2.2.1-2. The number of CSI-RS ports, , is .
\- The value of is configured with the higher layer parameter _numberOfBeams_
, where when and when .
\- The value of is configured with the higher layer parameter
_phaseAlphabetSize_ , where .
\- The UE is configured with the higher layer parameter _subbandAmplitude_ set
to \'true\' or \'false\'.
\- The UE shall not report RI > 2.
When , where is the associated RI value, each PMI value corresponds to the
codebook indices and where
..
The vectors combined by the codebook are identified by the indices and , where
.
Let
and
.
where the values of are given in Table 5.2.2.2.3-1.
Then the elements of and are found from using the algorithm:
> for
>
> Find the largest in Table 5.2.2.2.3-1 such that
When and are known, is found using:
> where the indices are assigned such that increases as increases
>
> , where is given in Table 5.2.2.2.3-1.
\- If , and for , and is not reported.
\- When , and , and is not reported.
\- When and , and , and is not reported.
\- When and , and, and is not reported.
Table 5.2.2.2.3-1: Combinatorial coefficients
       1    2     3     4
* * *
0 0 0 0 0 1 1 0 0 0 2 2 1 0 0 3 3 3 1 0 4 4 6 4 1 5 5 10 10 5 6 6 15 20 15 7 7
21 35 35 8 8 28 56 70 9 9 36 84 126 10 10 45 120 210 11 11 55 165 330 12 12 66
220 495 13 13 78 286 715 14 14 91 364 1001 15 15 105 455 1365
The strongest coefficient on layer is identified by .
The amplitude coefficient indicators and are
for . The mapping from to the amplitude coefficient is given in Table
5.2.2.2.3-2 and the mapping from to the amplitude coefficient is given in
Table 5.2.2.2.3-3. The amplitude coefficients are represented by
for .
Table 5.2.2.2.3-2: Mapping of elements of : to
* * *
0  
1  
2  
3  
4  
5  
6  
7
* * *
Table 5.2.2.2.3-3: Mapping of elements of : to
* * *
0  
1
* * *
The phase coefficient indicators are
for .
The amplitude and phase coefficient indicators are reported as follows:
\- The indicators , , and (). , , and are not reported for .
\- The remaining elements of () are reported, where . Let () be the number of
elements of that satisfy .
\- The remaining elements of and () are reported as follows:
\- When _subbandAmplitude_ is set to \'false\',
\- for , and . is not reported for .
\- For , the elements of corresponding to the coefficients that satisfy , , as
determined by the reported elements of , are reported, where and the remaining
elements of are not reported and are set to .
\- When _subbandAmplitude_ is set to \'true\',
\- For , the elements of and corresponding to the strongest coefficients
(excluding the strongest coefficient indicated by), as determined by the
corresponding reported elements of , are reported, where and . The values of
are given in Table 5.2.2.2.3-4. The remaining elements of are not reported and
are set to . The elements of corresponding to the weakest non-zero
coefficients are reported, where . The remaining elements of are not reported
and are set to .
\- When two elements, and , of the reported elements of are identical (), then
element is prioritized to be included in the set of the strongest coefficients
for and () reporting.
Table 5.2.2.2.3-4: Full resolution subband coefficients when
_subbandAmplitude_ is set to \'true\'
* * *
2 4 3 4 4 6
* * *
The codebooks for 1-2 layers are given in Table 5.2.2.2.3-5, where the indices
and are given by
for , and the quantities , , and are given by
.
Table 5.2.2.2.3-5: Codebook for 1-layer and 2-layer CSI reporting using
antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+-----------------------------------------------------------------+---+ | Layers | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | where , | | | | | | and the mappings from to , , , , , and , and from to , , and | | | are as described above, including the ranges of the constituent | | | indices of and . | | +-----------------------------------------------------------------+---+
When the UE is configured with higher layer parameter _codebookType_ set to
\'typeII\', thebitmap parameter _typeII-RI‑Restriction_ forms the bit sequence
where is the LSB and is the MSB. When is zero, , PMI and RI reporting are not
allowed to correspond to any precoder associated with layers. The bitmap
parameter _n1-n2‑codebookSubsetRestriction_ forms the bit sequence where bit
sequences , and are concatenated to form . To define and , first define the
vector groups as
for
.
The UE shall be configured with restrictions for 4 vector groups indicated by
for and identified by the group indices
for , where the indices are assigned such that increases as increases. The
remaining vector groups are not restricted.
\- If , for , and is empty.
\- If , is the binary representation of the integer where is the MSB and is
the LSB. is found using:
,
> where is defined in Table 5.2.2.2.3-1. The group indices and indicators for
> may be found from using the algorithm:
>
> for
>
> Find the largest such that
The bit sequence is the concatenation of the bit sequences for , corresponding
to the group indices . The bit sequence is defined as
Bits indicate the maximum allowed amplitude coefficient for the vector in
group indexed by , where the maximum amplitude coefficients are given in Table
5.2.2.2.3-6. A UE that does not report parameter _amplitudeSubsetRestriction_
= \'supported\' in its capability signaling is not expected to be configured
with = 01 or 10.
Table 5.2.2.2.3-6: Maximum allowed amplitude coefficients for restricted
vectors
* * *
Bits Maximum Amplitude Coefficient
00  
01  
10  
11
* * *
##### 5.2.2.2.4 Type II Port Selection Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and the UE configured with higher layer parameter
_codebookType_ set to \'typeII-PortSelection\'
\- The number of CSI-RS ports is given by as configured by higher layer
parameter _nrofPorts_.
\- The value of is configured with the higher layer parameter _numberOfBeams_
, where when and when .
\- The value of is configured with the higher layer parameter
_portSelectionSamplingSize_ , where and .
\- The value of is configured with the higher layer parameter
_phaseAlphabetSize_ , where .
\- The UE is configured with the higher layer parameter _subbandAmplitude_ set
to \'true\' or \'false\'.
\- The UE shall not report RI > 2.
The UE is also configured with the higher layer parameter _typeII-
PortSelectionRI‑Restriction_. The bitmap parameter _typeII-
PortSelectionRI‑Restriction_ forms the bit sequence where is the LSB and is
the MSB. When is zero, , PMI and RI reporting are not allowed to correspond to
any precoder associated with layers.
When , where is the associated RI value, each PMI value corresponds to the
codebook indices and where
.
The antenna ports per polarization are selected by the index , where
.
The strongest coefficient on layer is identified by .
The amplitude coefficient indicators and are
for . The mapping from to the amplitude coefficient is given in Table
5.2.2.2.3-2 and the mapping from to the amplitude coefficient is given in
Table 5.2.2.2.3-3. The amplitude coefficients are represented by
for .
The phase coefficient indicators are
for .
The amplitude and phase coefficient indicators are reported as follows:
\- The indicators , , and (). , , and are not reported for .
\- The remaining elements of () are reported, where . Let () be the number of
elements of that satisfy .
\- The remaining elements of and () are reported as follows:
\- When _subbandAmplitude_ is set to \'false\',
\- for , and . is not reported for .
\- For , the elements of corresponding to the coefficients that satisfy , , as
determined by the reported elements of , are reported, where and the remaining
elements of are not reported and are set to .
\- When _subbandAmplitude_ is set to \'true\',
\- For , the elements of and corresponding to the strongest coefficients
(excluding the strongest coefficient indicated by), as determined by the
corresponding reported elements of , are reported, where and . The values of
are given in Table 5.2.2.2.3-4. The remaining elements of are not reported and
are set to . The elements of corresponding to the weakest non-zero
coefficients are reported, where . The remaining elements of are not reported
and are set to .
\- When two elements, and , of the reported elements of are identical (), then
element is prioritized to be included in the set of the strongest coefficients
for and () reporting.
The codebooks for 1-2 layers are given in Table 5.2.2.2.4-1, where the
quantity is given by
and is a -element column vector containing a value of 1 in element and zeros
elsewhere (where the first element is element 0).
Table 5.2.2.2.4-1: Codebook for 1-layer and 2-layer CSI reporting using
antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+-----------------------------------------------------------------+---+ | Layers | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | | | +-----------------------------------------------------------------+---+ | where , | | | | | | and the mappings from to , , and and from to , , , and are as | | | described above, including the ranges of the constituent | | | indices of and . | | +-----------------------------------------------------------------+---+
##### 5.2.2.2.5 Enhanced Type II Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and UE configured with higher layer parameter
_codebookType_ set to \' typeII-r16\'
\- The values of $N_{1}$ and $N_{2}$ are configured with the higher layer
parameter _n1-n2-codebookSubsetRestriction-r16_. The supported configurations
of $\left( N_{1},N_{2} \right)$ for a given number of CSI-RS ports and the
corresponding values of $\left( O_{1},O_{2} \right)$ are given in Table
5.2.2.2.1-2. The number of CSI-RS ports, $P_{CSI - RS}$, is $2N_{1}N_{2}$.
\- The values of $L$, $\beta$ and $p_{\upsilon}$ are determined by the higher
layer parameter _paramCombination-r16_ , where the mapping is given in Table
5.2.2.2.5-1.
\- The UE is not expected to be configured with _paramCombination-r16_ equal
to
\- 3, 4, 5, 6, 7, or 8 when $P_{CSI - RS} = 4$,
\- 7 or 8 when $P_{CSI - RS}  1$.
\- 7 or 8 when $R = 2$.
\- The parameter $R$ is configured with the higher-layer parameter
_numberOfPMI-SubbandsPerCQI-Subband_. This parameter controls the total number
of precoding matrices $N_{3}$ indicated by the PMI as a function of the number
of configured subbands in _csi-ReportingBand_ , the subband size configured by
the higher-level parameter **_subbandSize and of the total number of PRBs in
the bandwidth part according to Table 5.2.1.4-2_** , as follows:
\- When $R = 1$:
\- One precoding matrix is indicated by the PMI for each subband in _csi-
ReportingBand_.
\- When $R = 2$:
\- For each subband in _csi-ReportingBand_ that is not the first or last
subband of a BWP, two precoding matrices are indicated by the PMI: the first
precoding matrix corresponds to the first $N_{\text{PRB}}^{\text{SB}}/2$ PRBs
of the subband and the second precoding matrix corresponds to the last
$N_{\text{PRB}}^{\text{SB}}/2$ PRBs of the subband.
\- For each subband in _csi-ReportingBand_ that is the first or last subband
of a BWP
\- If $\left( N_{\text{BWP},i}^{\text{start}}\text{\ mod\
}N_{\text{PRB}}^{\text{SB}} \right) \geq
\frac{N_{\text{PRB}}^{\text{SB}}}{2}$, one precoding matrix is indicated by
the PMI corresponding to the first subband. If $\left(
N_{\text{BWP},i}^{\text{start}}\text{\ mod\ }N_{\text{PRB}}^{\text{SB}}
\right) 
\frac{N_{\text{PRB}}^{\text{SB}}}{2}$, two precoding matrices are indicated by
the PMI corresponding to the last subband: the first precoding matrix
corresponds to the first $\frac{N_{\text{PRB}}^{\text{SB}}}{2}$ PRBs of the
last subband and the second precoding matrix corresponds to the last $1 +
\left( N_{\text{BWP},i}^{\text{start}} + N_{\text{BWP},i}^{\text{size}} - 1
\right){\text{mod\ }N}_{\text{PRB}}^{\text{SB}} -
\frac{N_{\text{PRB}}^{\text{SB}}}{2}$ PRBs of the last subband.
Table 5.2.2.2.5-1: Codebook parameter configurations for $\mathbf{L}\mathbf{,\
}$ $\mathbf{\beta}$ and $\mathbf{p}_{\mathbf{\upsilon}}$
_paramCombination-r16_ $$L$$ $$p_{\upsilon}$$ $$\beta$$
* * *
                                   $$\upsilon\  \in \left\{ 1,2 \right\}$$   $$\upsilon\  \in \left\{ 3,4 \right\}$$
1 2 ¼ 1/8 ¼ 2 2 ¼ 1/8 ½ 3 4 ¼ 1/8 ¼ 4 4 ¼ 1/8 ½ 5 4 ¼ ¼ ¾ 6 4 ½ ¼ ½ 7 6 ¼ - ½
8 6 ¼ - ¾
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-RI-Restriction-r16_. The UE shall not report
$\upsilon > 4$.
The PMI value corresponds to the codebook indices of and where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
\begin{matrix} i_{1,1} & i_{1,2} & i_{1,5} \ \end{matrix} & \begin{matrix}
i_{1,6,1} & i_{1,7,1} & i_{1,8,1} \ \end{matrix} \ \end{bmatrix} & \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\upsilon = 1 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,2} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} & i_{1,7,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} & i_{1,6,2}\text{\ \ \ \ \
}i_{1,7,2}\text{\ \ \ \ \ }i_{1,8,2} \ \end{matrix} \right\rbrack & \upsilon =
2 \ \end{matrix} \ \begin{matrix} \left\lbrack \begin{matrix} i_{1,1} &
i_{1,2} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} &
i_{1,7,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} &
i_{1,6,2}\text{\ \ \ \ \ }i_{1,7,2}\text{\ \ \ \ \ }i_{1,8,2}\text{\ \ \ \ \
}i_{1,6,3} \ \end{matrix}\text{\ \ \ \ \ }i_{1,7,3}\text{\ \ \ \ \ }i_{1,8,3}
\right\rbrack & \ \ \ \upsilon = 3 \ \left\lbrack \begin{matrix} i_{1,1} &
i_{1,2} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,5} & i_{1,6,1} &
i_{1,7,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,8,1} & i_{1,6,2} &
i_{1,7,2} \ \end{matrix}\text{\ \ \ \ \ }i_{1,8,2}\text{\ \ \ \ \
}\begin{matrix} i_{1,6,3} & i_{1,7,3} & i_{1,8,3}\text{\ \ \ \ \
}\begin{matrix} i_{1,6,4} & i_{1,7,4}\text{\ \ \ \ \ }i_{1,8,4} \ \end{matrix}
\ \end{matrix} \right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix}
\right.\ \ i_{2} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 1 \ \left\lbrack
\begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \
}\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix} \right\rbrack
& \upsilon = 2 \ \end{matrix} \ \begin{matrix} \left\lbrack \begin{matrix}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \ }\begin{matrix}
i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \ \end{matrix} \right\rbrack & \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \upsilon = 3 \
\left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{2,3,4} & i_{2,4,4} & i_{2,5,4}
\ \end{matrix} \right\rbrack & \upsilon = 4 \ \end{matrix} \ \end{matrix}
\right.\ \ \end{matrix}$$
The precoding matrices indicated by the PMI are determined from $L +
M_{\upsilon}$ vectors.
$L$ vectors, $v_{m_{1}^{\left( i \right)},m_{2}^{(i)}},i = 0,1,\ldots,L - 1$,
are identified by the indices $q_{1},q_{2},\ n_{1}$, $n_{2}$, indicated by
$i_{1,1}$, $i_{1,2}$, obtained as in 5.2.2.2.3, where the values of $C\left(
x,y \right)$ are given in Table 5.2.2.2.5-4.
$M_{\upsilon} = \left\lceil p_{\upsilon}\frac{N_{3}}{R} \right\rceil$ vectors,
$\left\lbrack y_{0,l}^{\left( f \right)},y_{1,l}^{\left( f
\right)},\ldots,y_{N_{3} - 1,l}^{\left( f \right)} \right\rbrack^{T}$, $f =
0,1,\ldots,M_{\upsilon} - 1$, are identified by $M_{\text{initial}}$ (for
$N_{3} > 19$) and $n_{3,l}\ \left( l = 1,\ldots,\ \upsilon \right)\ $where
$$M_{\text{initial}} \in \left{ - 2M_{\upsilon} + 1, - 2M_{\upsilon} +
2,\ldots,0 \right}$$
$$n_{3,l} = \left\lbrack n_{3,l}^{(0)},\ldots,n_{3,l}^{(M_{\upsilon} - 1)}
\right\rbrack$$
$${\ n}_{3,l}^{\left( f \right)} \in \left{ 0,1,\ldots,N_{3} - 1 \right}$$
which are indicated by means of the indices $i_{1,5}$ (for $N_{3} > 19$) and
$i_{1,6,l}$ $\left( \text{for\ }M_{\upsilon} > 1\text{\ and\ }l = 1,\ldots,\
\upsilon \right)$, where
$$i_{1,5} \in \left{ 0,1,\ldots,2M_{\upsilon} - 1 \right}$$
$${\ i}_{1,6,l} \in \left{ \begin{matrix} \left{ 0,1,\ldots,\begin{pmatrix}
N_{3} - 1 \ M_{\upsilon} - 1 \ \end{pmatrix} - 1 \right} & N_{3} \leq 19 \
\left{ 0,1,\ldots,\begin{pmatrix} 2M_{\upsilon} - 1 \ M_{\upsilon} - 1 \
\end{pmatrix} - 1 \right} & N_{3} > 19 \ \end{matrix} \right.\ $$
The amplitude coefficient indicators $i_{2,3,l}$ and $i_{2,4,l}$ are
$$i_{2,3,l} = \begin{bmatrix} k_{l,0}^{\left( 1 \right)} & k_{l,1}^{\left( 1
\right)} \ \end{bmatrix}$$
$$i_{2,4,l} = \left\lbrack k_{l,0}^{(2)}\ldots k_{l,M_{\upsilon} - 1}^{(2)}
\right\rbrack$$
$$k_{l,f}^{(2)} = \left\lbrack k_{l,0,f}^{(2)}\ldots k_{l,2L - 1,f}^{(2)}
\right\rbrack$$
$$k_{l,p}^{(1)} \in \left{ 1,\ldots,15 \right}$$
$$k_{l,i,f}^{(2)} \in \left{ 0,\ldots,7 \right}$$
for $l = 1,\ldots,\upsilon$.
The phase coefficient indicator $i_{2,5,l}\ $is
$$i_{2,5,l} = \left\lbrack c_{l,0}\ldots c_{l,M_{\upsilon} - 1}
\right\rbrack$$
$$c_{l,f} = \left\lbrack c_{l,0,f}\ldots c_{l,2L - 1,f} \right\rbrack$$
$$c_{l,i,f} \in \left{ 0,\ldots,15 \right}$$
for $l = 1,\ldots,\upsilon.$
Let $K_{0} = \left\lceil \beta 2LM_{1} \right\rceil$. The bitmap whose nonzero
bits identify which coefficients in $i_{2,4,l}$ and $i_{2,5,l}\ $are reported,
is indicated by $i_{1,7,l}$
$$i_{1,7,l} = \left\lbrack k_{l,0}^{\left( 3 \right)}\ldots k_{l,M_{\upsilon}
- 1}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,f}^{\left( 3 \right)} = \left\lbrack k_{l,0,f}^{\left( 3 \right)}\ldots
k_{l,2L - 1,f}^{\left( 3 \right)} \right\rbrack$$
$$k_{l,i,f}^{(3)} \in \left{ 0,1 \right}$$
for $l = 1,\ldots,\upsilon$, such that $K_{l}^{\text{NZ}} = \sum_{i = 0}^{2L -
1}{\sum_{f = 0}^{M_{\upsilon} - 1}k_{l,i,f}^{(3)}} \leq K_{0}$ is the number
of nonzero coefficients for layer $l = 1,\ldots,\upsilon$ and $K^{\text{NZ}} =
\sum_{l = 1}^{\upsilon}K_{l}^{\text{NZ}} \leq 2K_{0}$ is the total number of
nonzero coefficients.
The indices of $i_{2,4,l}$, $i_{2,5,l}$ and $i_{1,7,l}$ are associated to the
$M_{\upsilon}$ codebook indices in $n_{3,l}$.
The mapping from $k_{l,p}^{(1)}$ to the amplitude coefficient $p_{l,p}^{(1)}$
is given in Table 5.2.2.2.5-2 and the mapping from $k_{l,i,f}^{(2)}$ to the
amplitude coefficient $p_{l,i,f}^{(2)}$ is given in Table 5.2.2.2.5-3. The
amplitude coefficients are represented by
$$p_{l}^{\left( 1 \right)} = \begin{bmatrix} p_{l,0}^{\left( 1 \right)} &
p_{l,1}^{\left( 1 \right)} \ \end{bmatrix}$$
$$p_{l}^{(2)} = \left\lbrack p_{l,0}^{(2)}\ldots p_{l,M_{\upsilon} - 1}^{(2)}
\right\rbrack$$
$$p_{l,f}^{(2)} = \left\lbrack p_{l,0,f}^{(2)}\ldots p_{l,2L - 1,f}^{(2)}
\right\rbrack$$
for$\ l = 1,\ldots,\upsilon$.
Let $f_{l}^{_} \in \left{ 0,1,\ldots,M_{\upsilon} - 1 \right}$ be the index of
$i_{2,4,l}$ and $i_{l}^{_} \in \left{ 0,1,\ldots,2L - 1 \right}$ be the index
of $k_{l,f_{l}^{_}}^{(2)}$ which identify the strongest coefficient of layer
$l$, i.e., the element $k_{l,i_{l}^{_},f_{l}^{_}}^{(2)}$ of $i_{2,4,l}$, for
$\text{\ l} = 1,\ldots,\upsilon$. The codebook indices of $n_{3,l}$$k_{m_{i}}$
are remapped with respect to $n_{3,l}^{(f_{l}^{_})}$ as $n_{3,l}^{(f)} =
\left( n_{3,l}^{(f)} - n_{3,l}^{(f_{l}^{_})} \right)\text{mod\
}N_{3}$${\widetilde{k}}_{m_{i}^{_}} = 0$, such that $n_{3,l}^{(f_{l}^{_})} =
0$, after remapping. The index $f$ is remapped with respect to $f_{l}^{_}$ as
$f = \left( f - f_{l}^{_} \right)\text{mod\ }M_{\upsilon}$, such that the
index of the strongest coefficient is $f_{l}^{_} = 0$ ($l =
1,\ldots,\upsilon$), after remapping. The indices of $i_{2,4,l}$, $i_{2,5,l}$
and $i_{1,7,l}$ indicate amplitude coefficients, phase coefficients and bitmap
after remapping.
The strongest coefficient of layer $l$ is identified by $i_{1,8,l} \in \left{
0,1,\ldots,2L - 1 \right}$, which is obtained as follows
$i_{1,8,l} = \left{ \begin{matrix} \sum_{i = 0}^{i_{1}^{_}}k_{1,i,0}^{(3)} - 1
& \upsilon\mathbf{=}1 \ i_{l}^{_} & 1  19$, $M_{\text{initial}}$ is identified by $i_{1,5}$.
For all values of $N_{3}$, $n_{3,l}^{(0)} = 0$ for $l = 1,\ldots,\upsilon$. If
$M_{\upsilon} > 1$, the nonzero elements of $n_{3,l}$, identified by
$n_{3,l}^{(1)},\ \ldots,\ n_{3,l}^{\left( M_{\upsilon} - 1 \right)},\ $are
found from $i_{1,6,l}$ $(l = 1,\ldots,\upsilon)$, for $N_{3} \leq 19$, and
from $i_{1,6,l}$ $(l = 1,\ldots,\upsilon)$ and $M_{\text{initial}}$, for
$N_{3} > 19$, using $C\left( x,y \right)$ as defined in Table 5.2.2.2.5-4 and
the algorithm:
$s_{0} = 0$
for $f = 1,\ldots,M_{\upsilon} - 1$
Find the largest $x^{*} \in \left{ M_{\upsilon} - 1 - f,\ldots,N_{3} - 1 - f
\right}$ in Table 5.2.2.2.5-4 such that
$i_{1,6,l}\ - s_{f - 1} \geq C\left( x^{*},M_{\upsilon} - f \right)$
$e_{f} = C\left( x^{*},M_{\upsilon} - f \right)$
$s_{f} = s_{f - 1} + e_{f}$
if $N_{3} \leq 19$
$n_{3,l}^{(f)} = N_{3} - 1 - x^{*}$
else
$n_{l}^{(f)} = 2M_{\upsilon} - 1 - x^{*}$
if $n_{l}^{(f)} \leq M_{\text{initial}} + 2M_{\upsilon} - 1$
$n_{3,l}^{(f)} = n_{l}^{(f)}$
else
$n_{3,l}^{(f)} = n_{l}^{(f)} + (N_{3} - 2M_{\upsilon})$
end if
end if
Table 5.2.2.2.5-4: Combinatorial coefficients $\mathbf{C}\left(
\mathbf{x}\mathbf{,y} \right)$
       **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**
* * *
0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 2 2 1 0 0 0 0 0 0 0 3 3 3 1 0 0 0 0 0
0 4 4 6 4 1 0 0 0 0 0 5 5 10 10 5 1 0 0 0 0 6 6 15 20 15 6 1 0 0 0 7 7 21 35
35 21 7 1 0 0 8 8 28 56 70 56 28 8 1 0 9 9 36 84 126 126 84 36 9 1 10 10 45
120 210 252 210 120 45 10 11 11 55 165 330 462 462 330 165 55 12 12 66 220 495
792 924 792 495 220 13 13 78 286 715 1287 1716 1716 1287 715 14 14 91 364 1001
2002 3003 3432 3003 2002 15 15 105 455 1365 3003 5005 6435 6435 5005 16 16 120
560 1820 4368 8008 11440 12870 11440 17 17 136 680 2380 6188 12376 19448 24310
24310 18 18 153 816 3060 8568 18564 31824 43758 48620
When $n_{3,l}$ and $M_{\text{initial}}$ are known, $i_{1,5}\ $and $i_{1,6,l}\
(l = 1,\ldots,\upsilon)$ are found as follows:
\- If $N_{3} \leq 19$, $i_{1,5} = 0$ and is not reported. If $M_{\nu} = 1$,
$i_{1,6,l} = 0$, for $l = 1,\ldots,\nu$, and is not reported. If $M_{\nu} >
1$, $i_{1,6,l} = \sum_{f = 1}^{M_{\upsilon} - 1}{C\left( N_{3} - 1 -
n_{3,l}^{\left( f \right)},M_{\upsilon} - f \right)}$, where $C\left( x,y
\right)$ is given in Table 5.2.2.2.5-4 and where the indices $f =
1,\ldots,M_{\upsilon} - 1$ are assigned such that $n_{3,l}^{(f)}$ increases as
$f$ increases.
\- If $N_{3} > 19$, $M_{\text{initial}}$ is indicated by $i_{1,5}$, which is
reported and given by
$i_{1,5} = \left{ \begin{matrix} M_{\text{initial}} & M_{\text{initial}} = 0\
\ M_{\text{initial}} + 2M_{\upsilon} & M_{\text{initial}}  M_{\text{initial}} + N_{3} - \ 1 \ \end{matrix} \right.\ ,$
then $i_{1,6,l} = \sum_{f = 1}^{M_{\upsilon} - 1}{C\left( 2M_{\upsilon} - 1 -
n_{l}^{\left( f \right)},M_{\upsilon} - f \right)}$, where $C\left( x,y
\right)$ is given in Table 5.2.2.2.5-4.
The codebooks for 1-4 layers are given in Table 5.2.2.2.5-5, where
$m_{1}^{(i)}$, $m_{2}^{(i)}$, for $i = 0,1,\ldots,L - 1,$ $v_{m_{1}^{\left( i
\right)},m_{2}^{(i)}}\ $ are obtained as in clause 5.2.2.2.3, and the
quantities $\varphi_{l,i,f}$ and $y_{t,l}\ $are given by
$$\varphi_{l,i,f} = \ e^{j\frac{2\pi c_{l,i,f}}{16}}$$
$$y_{t,l} = \left\lbrack y_{t,l}^{(0)}\text{\ \ \ \ }y_{t,l}^{(1)}\ \ \
\ldots\ \ \ \ y_{t,l}^{(M_{\upsilon} - 1)} \right\rbrack$$
where $t = \left{ 0,1,\ldots,N_{3} - 1 \right}$, is the index associated with
the precoding matrix, $l = \left{ 1,\ldots,\ \upsilon \right}$, and with
${y_{t,l}^{(f)} = e}^{j\frac{2\pi tn_{3,l}^{(f)}}{N_{3}}}\text{\ \ \ }$
for$\ f = 0,1,\ldots,M_{\upsilon} - 1$.
Table 5.2.2.2.5-5: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI
reporting using antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+----------------------------------+----------------------------------+ | **Layers** | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | $$ | $ | | {\upsilon = 1}$$ | $W_{q_{1},q_{2},\ n_{1},\ n_{2}, | | | n_{3,1},p_{1}^{(1)},p_{1}^{\left | | | ( 2 \right)},i_{2,5,1},t}^{(1)} | | | = W_{q_{1},q_{2},\ n_{1},\ n_{2} | | | ,n_{3,1},p_{1}^{(1)},p_{1}^{\lef | | | t( 2 \right)},i_{2,5,1},t}^{1}$$ | +----------------------------------+----------------------------------+ | $$ | $$W_{q_{1},q_{ | | {\upsilon = 2}$$ | 2},\ n_{1},\ n_{2},n_{3,1},p_{1} | | | ^{(1)},p_{1}^{\left( 2 \right)}, | | | i_{2,5,1},\ n_{3,2},p_{2}^{(1)}, | | | p_{2}^{\left( 2 \right)},i_{2,5, | | | 2},t}^{(2)} = \frac{1}{\sqrt{2}} | | | \left\lbrack W_{q_{1},q_{2},\ n_ | | | {1},\ n_{2},n_{3,1},p_{1}^{(1)}, | | | p_{1}^{\left( 2 \right)},i_{2,5, | | | 1},t}^{1}\text{\ \ }W_{q_{1},q_{ | | | 2},\ n_{1},\ n_{2},n_{3,2},p_{2} | | | ^{(1)},p_{2}^{\left( 2 \right)}, | | | i_{2,5,2},t}^{2} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 3$$ | $$W_{q_{1} | | | ,q_{2},\ n_{1},\ n_{2},n_{3,1},p | | | _{1}^{(1)},p_{1}^{\left( 2 \righ | | | t)},i_{2,5,1},n_{3,2},p_{2}^{(1) | | | },p_{2}^{\left( 2 \right)},i_{2, | | | 5,2},n_{3,3},p_{3}^{(1)},p_{3}^{ | | | \left( 2 \right)},i_{2,5,3},t}^{ | | | (3)} = \frac{1}{\sqrt{3}}\left\l | | | brack W_{q_{1},q_{2},\ n_{1},\ n | | | _{2},n_{3,1},p_{1}^{(1)},p_{1}^{ | | | \left( 2 \right)},i_{2,5,1},t}^{ | | | 1}\text{\ \ }W_{q_{1},q_{2},\ n_ | | | {1},\ n_{2},n_{3,2},p_{2}^{(1)}, | | | p_{2}^{\left( 2 \right)},i_{2,5, | | | 2},t}^{2}\text{\ \ }W_{q_{1},q_{ | | | 2},\ n_{1},\ n_{2},n_{3,3},p_{3} | | | ^{(1)},p_{3}^{\left( 2 \right)}, | | | i_{2,5,3},t}^{3} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 4$$ | $$W | | | _{q_{1},q_{2},\ n_{1},\ n_{2},n_ | | | {3,1},p_{1}^{(1)},p_{1}^{\left( | | | 2 \right)},i_{2,5,1},n_{3,2},p_{ | | | 2}^{(1)},p_{2}^{\left( 2 \right) | | | },i_{2,5,2},n_{3,3},p_{3}^{(1)}, | | | p_{3}^{\left( 2 \right)},i_{2,5, | | | 3},{n_{3,4},p}_{4}^{(1)},p_{4}^{ | | | \left( 2 \right)},i_{2,5,4},t}^{ | | | (4)} = \frac{1}{2}\left\lbrack W | | | _{q_{1},q_{2},\ n_{1},\ n_{2},n_ | | | {3,1},p_{1}^{(1)},p_{1}^{\left( | | | 2 \right)},i_{2,5,1},t}^{1}\text | | | {\ \ }W_{q_{1},q_{2},\ n_{1},\ n | | | _{2},n_{3,2},p_{2}^{(1)},p_{2}^{ | | | \left( 2 \right)},i_{2,5,2},t}^{ | | | 2}\text{\ \ }W_{q_{1},q_{2},\ n_ | | | {1},\ n_{2},n_{3,3},p_{3}^{(1)}, | | | p_{3}^{\left( 2 \right)},i_{2,5, | | | 3},t}^{3}\text{\ \ }W_{q_{1},q_{ | | | 2},\ n_{1},\ n_{2},n_{3,4},p_{4} | | | ^{(1)},p_{4}^{\left( 2 \right)}, | | | i_{2,5,4},t}^{4} \right\rbrack$$ | +----------------------------------+----------------------------------+ | Where | | | $W_{q_{1},q_{2},\ n_{1 | | | },\ n_{2},n_{3,l},p_{l}^{(1)},p_ | | | {l}^{\left( 2 \right)},i_{2,5,l} | | | ,t}^{l} = \frac{1}{\sqrt{N_{1}N_ | | | {2}\gamma_{t,l}}}\begin{bmatrix} | | | \sum_{i = 0}^{L - 1}{v_{m_ | | | {1}^{\left( i \right)},m_{2}^{(i | | | )}}p_{l,0}^{(1)}\sum_{f = 0}^{M_ | | | {\upsilon} - 1}{y_{t,l}^{(f)}p_{ | | | l,i,f}^{(2)}\varphi_{l,i,f}}} \ | | | \s | | | um_{i = 0}^{L - 1}{v_{m_{1}^{\le | | | ft( i \right)},m_{2}^{(i)}}p_{l, | | | 1}^{(1)}\sum_{f = 0}^{M_{\upsilo | | | n} - 1}{y_{t,l}^{(f)}p_{l,i + L, | | | f}^{(2)}\varphi_{l,i + L,f}}} \ | | | \end{bmatrix},\ l = 1,2,3,4,$ | | | | | | $$\gamma_{t,l} = {\sum_{i = 0 | | | }^{2L - 1}{\left( p_{l,\left\lfl | | | oor \frac{i}{L} \right\rfloor}^{ | | | \left( 1 \right)} \right)^{2}\le | | | ft| \sum_{f = 0}^{M_{\upsilon} - | | | 1}{y_{t,l}^{(f)}p_{l,i,f}^{(2)} | | | \varphi_{l,i,f}} \right|}}^{2}$$ | | | | | | and the mappings from $i_{1}$ to | | | $q_{1}$, $q_{2}$, $n_{1}$, | | | $n_{2}$, $n_{3,1}$, $n_{3,2}$, | | | $n_{3,3}$, $n_{3,4}$, and from | | | $i_{2}$ to $i_{2,5,1}$, | | | $i_{2,5,2}$, | | | $i_{2,5,3}$,$\ i_{2,5,4},$ | | | $p_{1}^{(1)}$, $p_{2}^{(1)}$, | | | $p_{3}^{(1)}$and | | | $p_{4}^{(1)},\ \ p_{1}^{(2)}$, | | | $p_{2}^{(2)}$, $p_{3}^{(2)}$ and | | | $p_{4}^{(2)}$ are as described | | | above, including the ranges of | | | the constituent indices of | | | $i_{1}$ and $i_{2}$. | | +----------------------------------+----------------------------------+
For coefficients with $k_{l,i,f}^{(3)} = 0$, amplitude and phase are set to
zero, i.e., $p_{l,i,f}^{(2)} = 0$ and $\varphi_{l,i,f} = 0$.
The bitmap parameter _typeII-RI‑Restriction-r16_ forms the bit sequence
$r_{3},r_{2},r_{1},r_{0}$ where $r_{0}$ is the LSB and $r_{3}$ is the MSB.
When $r_{i}$ is zero, $i \in \left{ 0,1,\ldots,3 \right}$, PMI and RI
reporting are not allowed to correspond to any precoder associated with
$\upsilon = i + 1$ layers.
The bitmap parameter _n1-n2‑codebookSubsetRestriction-r16_ forms the bit
sequence $B = B_{1}B_{2}$ and configures the vector group indices $g^{(k)}$ as
in clause 5.2.2.2.3. Bits $b_{2}^{\left( k,{2(N}_{1}x_{2} + x_{1} \right) +
1)}b_{2}^{\left( k,{2(N}_{1}x_{2} + x_{1} \right))}$ indicate the maximum
allowed average amplitude, $\gamma_{i + pL}$ ($p = 0,1$), with $i \in {
0,1,\ldots,L - 1}$, of the coefficients associated with the vector in group
$g^{(k)}$ indexed by $x_{1},x_{2}$, where the maximum amplitudes are given in
Table 5.2.2.2.5-6 and the average coefficient amplitude is restricted as
follows
$\sqrt{\frac{1}{\sum_{f = 0}^{M_{\upsilon} - 1}k_{l,i +
\text{pL},f}^{(3)}}\sum_{f = 0}^{M_{\upsilon} - 1}{k_{l,i +
\text{pL},f}^{(3)}\left( p_{l,p}^{\left( 1 \right)}p_{l,i +
\text{pL},f}^{\left( 2 \right)} \right)^{2}}} \leq \gamma_{i + \text{pL}}$
for $l = 1,\ldots,\upsilon$, and $p = 0,1$. A UE that does not report the
parameter _amplitudeSubsetRestriction-r16_ = \'supported\' in its capability
signaling is not expected to be configured with $b_{2}^{\left(
k,{2(N}_{1}x_{2} + x_{1} \right) + 1)}b_{2}^{\left( k,{2(N}_{1}x_{2} + x_{1}
\right))} = 01$ or $10$.
Table 5.2.2.2.5-6: Maximum allowed average coefficient amplitudes for
restricted vectors
+----------------------------------+----------------------------------+ | Bit | Maximum | | | | | $$\ma | Average Coefficient Amplitude | | thbf{b}_{\mathbf{2}}^{\left( \ma | $\mathbf{\gamma}_{\mathbf{ | | thbf{k,}\mathbf{2(N}_{\mathbf{1} | i}\mathbf{+}\mathbf{\text{pL}}}$ | | }\mathbf{x}_{\mathbf{2}}\mathbf{ | | | +}\mathbf{x}_{\mathbf{1}} \right | | | )\mathbf{+ 1)}}\mathbf{b}_{\math | | | bf{2}}^{\left( \mathbf{k,}\mathb | | | f{2(N}_{\mathbf{1}}\mathbf{x}_{\ | | | mathbf{2}}\mathbf{+}\mathbf{x}_{ | | | \mathbf{1}} \right)\mathbf{)}}$$ | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | 00 | 0 | +----------------------------------+----------------------------------+ | 01 | $$\sqrt{1/4}$$ | +----------------------------------+----------------------------------+ | 10 | $$\sqrt{1/2}$$ | +----------------------------------+----------------------------------+ | 11 | 1 | +----------------------------------+----------------------------------+
##### 5.2.2.2.6 Enhanced Type II Port Selection Codebook
For 4 antenna ports {3000, 3001, ..., 3003}, 8 antenna ports {3000, 3001, ...,
3007}, 12 antenna ports {3000, 3001, ..., 3011}, 16 antenna ports {3000, 3001,
..., 3015}, 24 antenna ports {3000, 3001, ..., 3023}, and 32 antenna ports
{3000, 3001, ..., 3031}, and the UE configured with higher layer parameter
_codebookType_ set to \' typeII-PortSelection-r16 \'
\- The number of CSI-RS ports is configured as in Clause 5.2.2.2.4
\- The value of $d$ is configured with the higher layer parameter
_portSelectionSamplingSize-r16_ , where $d \in \left{ 1,2,3,4 \right}$ and $d
\leq L$.
\- The values $L$, $\beta$ and $p_{\upsilon}$ are configured as in Clause
5.2.2.2.5, where the supported configurations are given in Table 5.2.2.2.6-1.
Table 5.2.2.2.6-1: Codebook parameter configurations for $\mathbf{L}$,
$\mathbf{\beta}$ and$\mathbf{p}_{\mathbf{\upsilon}}$
_paramCombination-r16_ $$L$$ $$p_{\upsilon}$$ $$\beta$$
* * *
                                   $$\upsilon\  \in \left\{ 1,2 \right\}$$   $$\upsilon\  \in \left\{ 3,4 \right\}$$
1 2 ¼ 1/8 ¼ 2 2 ¼ 1/8 ½ 3 4 ¼ 1/8 ¼ 4 4 ¼ 1/8 ½ 5 4 ¼ ¼ ¾ 6 4 ½ ¼ ½
\- The UE shall report the RI value $\upsilon$ according to the configured
higher layer parameter _typeII-PortSelectionRI-Restriction-r16_. The UE shall
not report $\upsilon > 4$.
\- The value of $R$ is configured as in Clause 5.2.2.2.5.
The UE is also configured with the higher layer bitmap parameter _typeII-
PortSelectionRI-Restriction-r16_ , which forms the bit sequence
$r_{3},r_{2},r_{1},r_{0}$, where $r_{0}\ $is the LSB and $r_{3}$ is the MSB.
When $r_{i}$ is zero, $i \in \left{ 0,1,\ldots,\ 3 \right}$, PMI and RI
reporting are not allowed to correspond to any precoder associated with
$\upsilon = i + 1$ layers.
The PMI value corresponds to the codebook indices $i_{1}$ and $i_{2}$ where
$$\begin{matrix} i_{1} = \left{ \begin{matrix} \begin{matrix} \begin{bmatrix}
i_{1,1}\text{\ \ \ \ \ }i_{1,5} & \begin{matrix} i_{1,6,1} & i_{1,7,1} &
i_{1,8,1} \ \end{matrix} \ \end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\upsilon = 1 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,5} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,1} & i_{1,7,1} & i_{1,8,1}
\ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{1,6,2} & i_{1,7,2}\text{\ \ \ \
\ }i_{1,8,2} \ \end{matrix} \right\rbrack & \ \upsilon = 2 \ \end{matrix} \
\begin{matrix} \left\lbrack \begin{matrix} i_{1,1} & i_{1,5} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,1} & i_{1,7,1} & i_{1,8,1}
\ \end{matrix}\text{\ \ \ }\begin{matrix} i_{1,6,2} & i_{1,7,2}\text{\ \ \ \ \
}i_{1,8,2}\text{\ \ \ \ \ }i_{1,6,3} \ \end{matrix}\text{\ \ \ \ \
}i_{1,7,3}\text{\ \ \ \ \ }i_{1,8,3} \right\rbrack & \ \ \ \ \ \ \ \ \ \ \
\upsilon = 3 \ \left\lbrack \begin{matrix} i_{1,1} & i_{1,5} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,1} & i_{1,7,1} & i_{1,8,1}
\ \end{matrix}\text{\ \ \ }\begin{matrix} i_{1,6,2} & i_{1,7,2} & i_{1,8,2} \
\end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,3} & \ i_{1,7,3} & \
i_{1,8,3}\text{\ \ \ \ \ }\begin{matrix} i_{1,6,4} & i_{1,7,4}\text{\ \ \ \ \
}i_{1,8,4} \ \end{matrix} \ \end{matrix} \right\rbrack & \upsilon = 4 \
\end{matrix} \ \end{matrix} \right.\ \ i_{2} = \left{ \begin{matrix}
\begin{matrix} \begin{bmatrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{bmatrix} & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \upsilon = 1 \ \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} &
i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} &
i_{2,5,2} \ \end{matrix} \right\rbrack & \upsilon = 2 \ \end{matrix} \
\begin{matrix} \left\lbrack \begin{matrix} i_{2,3,1} & i_{2,4,1} & i_{2,5,1} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} & i_{2,4,2} & i_{2,5,2} \
\end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} & i_{2,4,3} & i_{2,5,3} \
\end{matrix} \right\rbrack & \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
\ \ \ \ \ \ \ \ \ \ \upsilon = 3 \ \left\lbrack \begin{matrix} i_{2,3,1} &
i_{2,4,1} & i_{2,5,1} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,2} &
i_{2,4,2} & i_{2,5,2} \ \end{matrix}\text{\ \ \ \ }\begin{matrix} i_{2,3,3} &
i_{2,4,3} & i_{2,5,3} \ \end{matrix}\text{\ \ \ \ \ }\begin{matrix} i_{2,3,4}
& i_{2,4,4} & i_{2,5,4} \ \end{matrix} \right\rbrack & \upsilon = 4 \
\end{matrix} \ \end{matrix} \right.\ \ \end{matrix}$$
The $2L$ antenna ports are selected by the index $i_{1,1}$ as in clause
5.2.2.2.4.
Parameters $N_{3},\ M_{\upsilon}$, $M_{\text{initial}}$ (for $N_{3} > 19$) and
$K_{0}$ are defined as in clause 5.2.2.2.5.
For layer $l$, $l = 1,\ldots,\upsilon$, the strongest coefficient $i_{1,8,l},$
the amplitude coefficient indicators $i_{2,3,l}$ and $i_{2,4,l}$, the phase
coefficient indicator $i_{2,5,l}$ and the bitmap indicator $i_{1,7,l}$ are
defined and indicated as in clause 5.2.2.2.5, where the mapping from
$k_{l,p}^{(1)}$ to the amplitude coefficient $p_{l,p}^{(1)}$ is given in Table
5.2.2.2.5-2 and the mapping from $k_{l,i,f}^{(2)}$ to the amplitude
coefficient $p_{l,i,f}^{(2)}$ is given in Table 5.2.2.2.5-3.
The number of nonzero coefficients for layer $l$, $K_{l}^{\text{NZ}}$, and the
total number of nonzero coefficients $K^{\text{NZ}}$ are defined as in Clause
5.2.2.2.5.
The amplitude coefficients $p_{l}^{(1)}$ and $p_{l}^{(2)}$ $\left( l =
1,\ldots,\upsilon\ \right)$ are represented as in clause 5.2.2.2.5.
The amplitude and phase coefficient indicators are reported as in clause
5.2.2.2.5.
Codebook indicators $i_{1,5}\ $and $i_{1,6,l}\ (l = 1,\ldots,\upsilon)$ are
found as in clause 5.2.2.2.5.
The codebooks for 1-4 layers are given in Table 5.2.2.2.6-2, where $v_{m}$ is
a $P_{CSI - RS}/2\ $-element column vector containing a value of 1 in element
$\left( \text{m\ }\text{mod}\ P_{CSI - RS}/2\ \right)$ and zeros elsewhere
(where the first element is element 0), and the quantities $\varphi_{l,i,f}$
and $y_{t,l}\ \ $are defined as in clause 5.2.2.2.5.
Table 5.2.2.2.6-2: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI
reporting using antenna ports 3000 to 2999+_P_ ~CSI‑RS~
+----------------------------------+----------------------------------+ | **Layers** | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | $$ | $$W_{i_{1,1},n_{3,1},p_{1 | | {\upsilon = 1}$$ | }^{(1)},p_{1}^{\left( 2 \right)} | | | ,i_{2,5,1},t}^{(1)} = W_{i_{1,1} | | | ,n_{3,1},p_{1}^{(1)},p_{1}^{\lef | | | t( 2 \right)},i_{2,5,1},t}^{1}$$ | +----------------------------------+----------------------------------+ | $$ | $$W_{i_{1,1},n_{3, | | {\upsilon = 2}$$ | 1},p_{1}^{(1)},p_{1}^{\left( 2 \ | | | right)},i_{2,5,1},\ n_{3,2},p_{2 | | | }^{(1)},p_{2}^{\left( 2 \right)} | | | ,i_{2,5,2},t}^{(2)} = \frac{1}{\ | | | sqrt{2}}\left\lbrack W_{i_{1,1}, | | | n_{3,1},p_{1}^{(1)},p_{1}^{\left | | | ( 2 \right)},i_{2,5,1},t}^{1}\te | | | xt{\ \ }W_{i_{1,1},n_{3,2},p_{2} | | | ^{(1)},p_{2}^{\left( 2 \right)}, | | | i_{2,5,2},t}^{2} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 3$$ | $$W_{i_{1,1},n_{3,1},p_{1} | | | ^{(1)},p_{1}^{\left( 2 \right)}, | | | i_{2,5,1},n_{3,2},p_{2}^{(1)},p_ | | | {2}^{\left( 2 \right)},i_{2,5,2} | | | ,n_{3,3},p_{3}^{(1)},p_{3}^{\lef | | | t( 2 \right)},i_{2,5,3},t}^{(3)} | | | = \frac{1}{\sqrt{3}}\left\lbrac | | | k W_{i_{1,1},n_{3,1},p_{1}^{(1)} | | | ,p_{1}^{\left( 2 \right)},i_{2,5 | | | ,1},t}^{1}\text{\ \ }W_{i_{1,1}, | | | n_{3,2},p_{2}^{(1)},p_{2}^{\left | | | ( 2 \right)},i_{2,5,2},t}^{2}\te | | | xt{\ \ }W_{i_{1,1},n_{3,3},p_{3} | | | ^{(1)},p_{3}^{\left( 2 \right)}, | | | i_{2,5,3},t}^{3} \right\rbrack$$ | +----------------------------------+----------------------------------+ | $$\upsilon = 4$$ | $$W_{i_{1,1},n_{3,1},p_{1}^{(1) | | | },p_{1}^{\left( 2 \right)},i_{2, | | | 5,1},n_{3,2},p_{2}^{(1)},p_{2}^{ | | | \left( 2 \right)},i_{2,5,2},n_{3 | | | ,3},p_{3}^{(1)},p_{3}^{\left( 2 | | | \right)},i_{2,5,3},{n_{3,4},p}_{ | | | 4}^{(1)},p_{4}^{\left( 2 \right) | | | },i_{2,5,4},t}^{(4)} = \frac{1}{ | | | 2}\left\lbrack W_{i_{1,1},n_{3,1 | | | },p_{1}^{(1)},p_{1}^{\left( 2 \r | | | ight)},i_{2,5,1},t}^{1}\text{\ \ | | | }W_{i_{1,1},n_{3,2},p_{2}^{(1)} | | | ,p_{2}^{\left( 2 \right)},i_{2,5 | | | ,2},t}^{2}\text{\ \ }W_{i_{1,1}, | | | n_{3,3},p_{3}^{(1)},p_{3}^{\left | | | ( 2 \right)},i_{2,5,3},t}^{3}\te | | | xt{\ \ }W_{i_{1,1},n_{3,4},p_{4} | | | ^{(1)},p_{4}^{\left( 2 \right)}, | | | i_{2,5,4},t}^{4} \right\rbrack$$ | +----------------------------------+----------------------------------+ | Where | | | $W_{i_{1,1},n_{3,l},p_{l | | | }^{(1)},p_{l}^{\left( 2 \right)} | | | ,i_{2,5,l},t}^{l} = \frac{1}{\sq | | | rt{\gamma_{t,l}}}\begin{bmatrix} | | | \s | | | um_{i = 0}^{L - 1}{v_{i_{1,1}d + | | | i}p_{l,0}^{(1)}\sum_{f = 0}^{M_ | | | {\upsilon} - 1}{y_{t,l}^{(f)}p_{ | | | l,i,f}^{(2)}\varphi_{l,i,f}}} \ | | | \sum_{i = | | | 0}^{L - 1}{v_{i_{1,1}d + i}p_{l, | | | 1}^{(1)}\sum_{f = 0}^{M_{\upsilo | | | n} - 1}{y_{t,l}^{(f)}p_{l,i + L, | | | f}^{(2)}\varphi_{l,i + L,f}}} \ | | | \end{bmatrix},\ \ l = 1,2,3,4$, | | | | | | $$\gamma_{t,l} = {\sum_{i = 0 | | | }^{2L - 1}{\left( p_{l,\left\lfl | | | oor \frac{i}{L} \right\rfloor}^{ | | | \left( 1 \right)} \right)^{2}\le | | | ft| \sum_{f = 0}^{M_{\upsilon} - | | | 1}{y_{t,l}^{(f)}p_{l,i,f}^{(2)} | | | \varphi_{l,i,f}} \right|}}^{2}$$ | | | | | | and the mappings from $i_{1}$ | | | to$\ i_{1,1}$, $n_{3,1}$, | | | $n_{3,2}$, $n_{3,3}$, $n_{3,4}$, | | | and from $i_{2}$ to $i_{2,5,1}$, | | | $i_{2,5,2}$, | | | $i_{2,5,3}$,$\ i_{2,5,4},$ | | | $p_{1}^{(1)}$, $p_{2}^{(1)}$, | | | $p_{3}^{(1)}$and $p_{4}^{(1)}$, | | | $\ p_{1}^{(2)}$, $p_{2}^{(2)}$, | | | $p_{3}^{(2)}$ and $p_{4}^{(2)}$ | | | are as described above, | | | including the ranges of the | | | constituent indices of $i_{1}$ | | | and $i_{2}$. | | +----------------------------------+----------------------------------+
For coefficients with $k_{l,i,f}^{(3)} = 0$, amplitude and phase are set to
zero, i.e., $p_{l,i,f}^{(2)} = 0$ and $\varphi_{l,i,f} = 0$.
#### 5.2.2.3 Reference signal (CSI-RS)
##### 5.2.2.3.1 NZP CSI-RS
The UE can be configured with one or more NZP CSI-RS resource set
configuration(s) as indicated by the higher layer parameters _CSI-
ResourceConfig, and NZP-CSI-RS-ResourceSet._ Each NZP CSI-RS resource set
consists of _K_ ≥1 NZP CSI-RS resource(s).
The following parameters for which the UE shall assume non-zero transmission
power for CSI-RS resource are configured via the higher layer parameter _NZP-
CSI-RS-Resource, CSI-ResourceConfig_ and _NZP-CSI-RS-ResourceSet_ for each
CSI-RS resource configuration:
_\- nzp-CSI-RS-ResourceId determines CSI-RS resource configuration identity._
_\- periodicityAndOffset defines the CSI-RS periodicity and slot offset for
periodic/semi-persistent CSI-RS. All the CSI-RS resources within one set are
configured with the same periodicity, while the slot offset can be same or
different for different CSI-RS resources._
_\- resourceMapping defines t_ he number of ports, CDM-type, and OFDM symbol
and subcarrier occupancy of the CSI-RS resource within a slot that are given
in Clause 7.4.1.5 of [4, TS 38.211].
_\- nrofPorts_ in _resourceMapping_ _defines the number of CSI-RS ports, where
the allowable values are given in_ Clause 7.4.1.5 of [4, TS 38.211].
_\- density in resourceMapping_ _defines CSI-RS frequency density of each CSI-
RS port per PRB_ , _and CSI-RS PRB offset in case of the density value of
1/2,_ where the _allowable values are given in_ Clause 7.4.1.5 of [4, TS
38.211]. For density 1/2, the odd/even PRB allocation indicated in _density_
is with respect to the common resource block grid.
_\- cdm-Type_ _in resourceMapping_ _defines CDM values and pattern, where the
allowable values are given in Clause 7.4.1.5 of [4, TS 38.211]._
_\- powerControlOffset: which is the assumed ratio of PDSCH EPRE to_ NZP _CSI-
RS EPRE when UE derives CSI feedback and takes values in the range of [-8, 15]
dB with 1 dB step size._
_\- powerControlOffsetSS: which is the assumed ratio of_ NZP _CSI-RS EPRE to
SS/PBCH block EPRE._
_\- scramblingID defines scrambling ID of CSI-RS with length of 10 bits._
_\- BWP-Id in CSI-ResourceConfig defines which bandwidth part the configured
CSI-RS is located in._
\- _repetition_ in _NZP-CSI-RS-ResourceSet_ is associated with a CSI-RS
resource set and defines whether UE can assume the CSI-RS resources within the
NZP CSI-RS Resource Set are transmitted with the same downlink spatial domain
transmission filter or not as described in Clause 5.1.6.1.2. and can be
configured only when the higher layer parameter _reportQuantity_ associated
with all the reporting settings linked with the CSI-RS resource set is set to
\'cri-RSRP\', \'cri-SINR\' or \'none\'.
\- _qcl-InfoPeriodicCSI-RS_ contains a reference to a _TCI-State_ indicating
QCL source RS(s) and QCL type(s). If the _TCI-State_ is configured with a
reference to an RS configured with _qcl-Type_ set to \'typeD\' association,
that RS may be an SS/PBCH block located in the same or different CC/DL BWP or
a CSI-RS resource configured as periodic located in the same or different
CC/DL BWP.
\- _trs-Info_ in _NZP-CSI-RS-ResourceSet_ is associated with a CSI-RS resource
set and for which the UE can assume that the antenna port with the same port
index of the configured NZP CSI-RS resources in the _NZP-CSI-RS-ResourceSet_
is the same as described in Clause 5.1.6.1.1 and can be configured when
reporting setting is not configured or when the higher layer parameter
_reportQuantity_ associated with all the reporting settings linked with the
CSI-RS resource set is set to \'none\'.
All CSI-RS resources within one set are configured with same _density_ and
same _nrofPorts_ , except for the NZP CSI-RS resources used for interference
measurement.
The UE expects that all the CSI-RS resources of a resource set are configured
with the same starting RB and number of RBs and the same _cdm-type_.
The bandwidth and initial common resource block (CRB) index of a CSI-RS
resource within a BWP, as defined in Clause 7.4.1.5 of [4, TS 38.211], are
determined based on the higher layer parameters _nrofRBs_ and _startingRB_ ,
respectively, within the CSI-FrequencyOccupation IE configured by the higher
layer parameter _freqBand_ within the _CSI-RS-ResourceMapping_ IE. Both
_nrofRBs_ and _startingRB_ are configured as integer multiples of 4 RBs, and
the reference point for _startingRB_ is CRB 0 on the common resource block
grid. If $\text{startingRB} 
N_{\text{BWP}}^{\text{size}} + N_{\text{BWP}}^{\text{start}} -
N_{\text{initial}\ \text{RB}}$, the UE shall assume that the bandwidth of the
CSI-RS resource is $N_{\text{CSI} - \text{RS}}^{\text{BW}} =
N_{\text{BWP}}^{\text{size}} + N_{\text{BWP}}^{\text{start}} -
N_{\text{initial}\ \text{RB}}$, otherwise $N_{\text{CSI} -
\text{RS}}^{\text{BW}} = \text{nrofRBs}$. In all cases, the UE shall expect
that $N_{\text{CSI} - \text{RS}}^{\text{BW}} \geq min(24,\
N_{\text{BWP}}^{\text{size}})$.
#### 5.2.2.4 Channel State Information -- Interference Measurement (CSI-IM)
The UE can be configured with one or more CSI-IM resource set configuration(s)
as indicated by the higher layer parameter _CSI-IM-ResourceSet_. Each CSI-IM
resource set consists of _K_ ≥1 CSI-IM resource(s).
The following parameters are configured via higher layer parameter _CSI-IM-
Resource_ for each CSI-IM resource configuration:
_\- csi-IM-ResourceId_ determines CSI-IM resource configuration identity
_\- subcarrierLocation-p0_ or _subcarrierLocation-p1_ defines subcarrier
occupancy of the CSI-IM resource within a slot for _csi-IM-
ResourceElementPattern_ set to \'pattern0\' or \'pattern1\', respectively.
_\- symbolLocation-p0_ or _symbolLocation-p1_ defines OFDM symbol location of
the CSI-IM resource within a slot for _csi-IM-ResourceElementPattern_ set to
\'pattern0\' or \'pattern1\', respectively.
_\- periodicityAndOffset_ defines the CSI-IM periodicity and slot offset for
periodic/semi-persistent CSI-IM.
_-_ f _reqBand_ includes parameters to enable configuration of frequency-
occupancy of CSI-IM
In each of the PRBs configured by f _reqBand,_ the UE shall assume each CSI-IM
resource is located in,
\- resource elements , , and , if _csi-IM-ResourceElementPattern_ is set to
\'pattern0\',
\- resource elements , , and if _csi-IM-ResourceElementPattern_ is set to
\'pattern1\',
where and are the configured frequency-domain location and time-domain
location, respectively, given by the higher layer parameters in the above
list.
#### 5.2.2.5 CSI reference resource definition
The CSI reference resource for a serving cell is defined as follows:
\- In the frequency domain, the CSI reference resource is defined by the group
of downlink physical resource blocks corresponding to the band to which the
derived CSI relates.
\- In the time domain, the CSI reference resource for a CSI reporting in
uplink slot _n\'_ is defined by a single downlink slot _n_ -_n~CSI_ref~_ ,
> \- where $+ \left\lfloor \left(
> \frac{N_{slot,offset,UL}^{\text{CA}}}{2^{\mu_{offset,UL}}} -
> \frac{N_{slot,offset,DL}^{\text{CA}}}{2^{\mu_{offset,DL}}} \right) \bullet
> 2^{\mu_{\text{DL}}} \right\rfloor\ $and and are the subcarrier spacing
> configurations for DL and UL, respectively, and $N_{\text{slot,\
> offset}}^{\text{CA}}$ and are determined by higher-layer configured _ca-
> SlotOffset_ for the cells transmitting the uplink and downlink, as defined
> in clause 4.5 of [4, TS 38.211]
\- where for periodic and semi-persistent CSI reporting
\- if a single CSI-RS/SSB resource is configured for channel measurement
_n~CSI_ref~_ is the smallest value greater than or equal to $4 \cdot
2^{µ_{\text{DL}}}$, such that it corresponds to a valid downlink slot, or
\- if multiple CSI-RS/SSB resources are configured for channel measurement
_n~CSI_ref~_ is the smallest value greater than or equal to , such that it
corresponds to a valid downlink slot.
\- where for aperiodic CSI reporting, if the UE is indicated by the DCI to
report CSI in the same slot as the CSI request, _n~CSI_ref~_ is such that the
reference resource is in the same valid downlink slot as the corresponding CSI
request, otherwise _n~CSI_ref~_ is the smallest value greater than or equal to
, such that slot _n_ \- _n~CSI_ref~_ corresponds to a valid downlink slot,
where _Z\'_ corresponds to the delay requirement as defined in Clause 5.4.
\- when periodic or semi-persistent CSI-RS/CSI-IM or SSB is used for
channel/interference measurements, the UE is not expected to measure
channel/interference on the CSI-RS/CSI-IM/SSB whose last OFDM symbol is
received up to _Z\'_ symbols before transmission time of the first OFDM symbol
of the aperiodic CSI reporting.
A slot in a serving cell shall be considered to be a valid downlink slot if:
\- it comprises at least one higher layer configured downlink or flexible
symbol, and
\- it does not fall within a configured measurement gap for that UE
If there is no valid downlink slot for the CSI reference resource
corresponding to a CSI Report Setting in a serving cell, CSI reporting is
omitted for the serving cell in uplink slot _n\'_.
After the CSI report (re)configuration, serving cell activation, BWP change,
or activation of SP-CSI, the UE reports a CSI report only after receiving at
least one CSI-RS transmission occasion for channel measurement and CSI-RS
and/or CSI-IM occasion for interference measurement no later than CSI
reference resource and drops the report otherwise.
When DRX is configured, the UE reports a CSI report only if receiving at least
one CSI-RS transmission occasion for channel measurement and CSI-RS and/or
CSI-IM occasion for interference measurement in DRX Active Time no later than
CSI reference resource and drops the report otherwise. When the UE is
configured to monitor DCI format 2_6 and if the UE configured by higher layer
parameter _ps-TransmitOtherPeriodicCSI_ to report CSI with the higher layer
parameter _reportConfigType_ set to \'periodic\' and _reportQuantity_ set to
quantities other than \'cri-RSRP\' and \'ssb-Index-RSRP\' when _drx-
onDurationTimer_ is not started, the UE shall report CSI during the time
duration indicated by _drx-onDurationTimer_ in _DRX-Config also outside active
time according to the procedure described in Clause 5.2.1.4_ if receiving at
least one CSI-RS transmission occasion for channel measurement and CSI-RS
and/or CSI-IM occasion for interference measurement during the time duration
indicated by _drx-onDurationTimer_ in _DRX-Config_ outside DRX active time or
in DRX Active Time [ ]{.underline} no later than CSI reference resource and
drops the report otherwise. When the UE is configured to monitor DCI format
2_6 and if the UE configured by higher layer parameter _ps-
TransmitPeriodicL1-RSRP_ to report L1-RSRP with the higher layer parameter
_reportConfigType_ set to \'periodic\' and _reportQuantity_ set to \'cri-
RSRP\' or \'ssb-Index-RSRP\' when _drx-onDurationTimer_ is not started, the UE
shall report L1-RSRP during the time duration indicated by _drx-
onDurationTimer_ in _DRX-Config_ _also outside active time according to the
procedure described in clause 5.2.1.4_ and when _reportQuantity_ set to
\'_cri-RSRP\'_ if receiving at least one CSI-RS transmission occasion for
channel measurement during the time duration indicated by _drx-
onDurationTimer_ in _DRX-Config_ outside DRX active time or in DRX Active Time
no later than CSI reference resource and drops the report otherwise.
When deriving CSI feedback, the UE is not expected that a NZP CSI -RS resource
for channel measurement overlaps with CSI-IM resource for interference
measurement or NZP CSI -RS resource for interference measurement.
If configured to report CQI index, in the CSI reference resource, the UE shall
assume the following for the purpose of deriving the CQI index, and if also
configured, for deriving PMI and RI:
\- The first 2 OFDM symbols are occupied by control signaling.
\- The number of PDSCH and DM-RS symbols is equal to 12.
\- The same bandwidth part subcarrier spacing configured as for the PDSCH
reception
\- The bandwidth as configured for the corresponding CQI report.
\- The reference resource uses the CP length and subcarrier spacing configured
for PDSCH reception
\- No resource elements used by primary or secondary synchronization signals
or PBCH.
\- Redundancy Version 0.
\- The ratio of PDSCH EPRE to CSI-RS EPRE is as given in Clause 5.2.2.3.1.
\- Assume no REs allocated for NZP CSI-RS and ZP CSI-RS.
\- Assume the same number of front-loaded DM-RS symbols as the maximum front-
loaded symbols configured by the higher layer parameter _maxLength_ in _DMRS-
DownlinkConfig._
\- Assume the same number of additional DM-RS symbols as the additional
symbols configured by the higher layer parameter _dmrs-AdditionalPosition_.
\- Assume the PDSCH symbols are not containing DM-RS.
\- Assume PRB bundling size of 2 PRBs.
\- The PDSCH transmission scheme where the UE may assume that PDSCH
transmission would be performed with up to 8 transmission layers as defined in
Clause 7.3.1.4 of [4, TS 38.211]. For CQI calculation, the UE should assume
that PDSCH signals on antenna ports in the set [1000,..., 1000+ν-1] for ν
layers would result in signals equivalent to corresponding symbols transmitted
on antenna ports [3000,..., 3000+_P_ -1], as given by
$\begin{bmatrix} y^{\left( 3000 \right)}(i) \ \cdots \ y^{\left( 3000 + P - 1
\right)}(i) \ \end{bmatrix} = W(i)\begin{bmatrix} x^{\left( 0 \right)}(i) \
\cdots \ x^{\left( \nu - 1 \right)}(i) \ \end{bmatrix}$
where is a vector of PDSCH symbols from the layer mapping defined in Clause
7.3.1.4 of [4, TS 38.211], is the number of CSI-RS ports. If only one CSI-RS
port is configured, _W(i)_ is 1. If the higher layer parameter
_reportQuantity_ in _CSI-ReportConfig_ for which the CQI is reported is set to
either \'cri-RI-PMI-CQI\' or \'cri-RI-LI-PMI-CQI\', _W(i)_ is the precoding
matrix corresponding to the reported PMI applicable to _x(i)_. If the higher
layer parameter _reportQuantity_ in _CSI-ReportConfig_ for which the CQI is
reported is set to \'cri-RI-CQI\', _W(i)_ is the precoding matrix
corresponding to the procedure described in Clause 5.2.1.4.2. If the higher
layer parameter _reportQuantity_ in _CSI-ReportConfig_ for which the CQI is
reported is set to \'cri-RI-i1-CQI\', _W(i)_ is the precoding matrix
corresponding to the reported i1 according to the procedure described in
Clause 5.2.1.4.2 _._ The corresponding PDSCH signals transmitted on antenna
ports [3000,...,3000 + _P_ \- 1] would have a ratio of EPRE to CSI-RS EPRE
equal to the ratio given in Clause 5.2.2.3.1.
### 5.2.3 CSI reporting using PUSCH
A UE shall perform aperiodic CSI reporting using PUSCH on serving cell c upon
successful decoding of a DCI format 0_1 or DCI format 0_2 which triggers an
aperiodic CSI trigger state.
When a DCI format 0_1 schedules two PUSCH allocations, the aperiodic CSI
report is carried on the second scheduled PUSCH. When a DCI format 0_1
schedules more than two PUSCH allocations, the aperiodic CSI report is carried
on the penultimate scheduled PUSCH.
An aperiodic CSI report carried on the PUSCH supports wideband, and sub-band
frequency granularities. An aperiodic CSI report carried on the PUSCH supports
Type I, Type II and Enhanced Type II CSI.
A UE shall perform semi-persistent CSI reporting on the PUSCH upon successful
decoding of a DCI format 0_1 or DCI format 0_2 which activates a semi-
persistent CSI trigger state. DCI format 0_1 and DCI format 0_2 contains a CSI
request field which indicates the semi-persistent CSI trigger state to
activate or deactivate. Semi-persistent CSI reporting on the PUSCH supports
Type I, Type II with wideband, and sub-band frequency granularities and
Enhanced Type II CSI. The PUSCH resources and MCS shall be allocated semi-
persistently by an uplink DCI.
CSI reporting on PUSCH can be multiplexed with uplink data on PUSCH except
that semi-persistent CSI reporting on PUSCH activated by a DCI format is not
expected to be multiplexed with uplink data on the PUSCH. CSI reporting on
PUSCH can also be performed without any multiplexing with uplink data from the
UE.
Type I CSI feedback is supported for CSI Reporting on PUSCH. Type I wideband
and sub-band CSI is supported for CSI Reporting on the PUSCH. Type II CSI is
supported for CSI Reporting on the PUSCH.
For Type I, Type II and Enhanced Type II CSI feedback on PUSCH, a CSI report
comprises of two parts. Part 1 has a fixed payload size and is used to
identify the number of information bits in Part 2. Part 1 shall be transmitted
in its entirety before Part 2.
\- For Type I CSI feedback, Part 1 contains RI (if reported), CRI (if
reported), CQI for the first codeword (if reported). Part 2 contains PMI (if
reported), LI (if reported) and contains the CQI for the second codeword (if
reported) when RI is larger than 4.
\- For Type II CSI feedback, Part 1 contains RI (if reported), CQI, and an
indication of the number of non-zero wideband amplitude coefficients per layer
for the Type II CSI (see Clause 5.2.2.2.3). The fields of Part 1 -- RI (if
reported), CQI, and the indication of the number of non-zero wideband
amplitude coefficients for each layer -- are separately encoded. Part 2
contains the PMI and LI (if reported) of the Type II CSI. The elements of
$i_{1,4,l}$, $i_{2,1,l}$ (if reported) and $i_{2,2,l}$ (if reported) are
reported in the increasing order of their indices, $i = 0,1,\ldots,\ 2L - 1$,
where the element of the lowest index is mapped to the most significant bits
and the element of the highest index is mapped to the least significant bits.
Part 1 and 2 are separately encoded.
\- For Enhanced Type II CSI feedback, Part 1 contains RI (if reported), CQI,
and an indication of the overall number of non-zero amplitude coefficients
across layers for the Enhanced Type II CSI (see Clause 5.2.2.2.5). The fields
of Part 1 -- RI (if reported), CQI, and the indication of the overall number
of non-zero amplitude coefficients across layers -- are separately encoded.
Part 2 contains the PMI of the Enhanced Type II CSI. Part 1 and 2 are
separately encoded.
A Type II CSI report that is carried on the PUSCH shall be computed
independently from any Type II CSI report that is carried on the PUCCH formats
3 or 4 (see Clause 5.2.4 and 5.2.2).
When the higher layer parameter _reportQuantity_ is configured with one of the
values \'cri-RSRP\', \'ssb-Index-RSRP\', \'cri-SINR\' or \'ssb-Index-SINR\',
the CSI feedback consists of a single part.
For both Type I and Type II reports configured for PUCCH but transmitted on
PUSCH, the determination of the payload for CSI part 1 and CSI part 2 follows
that of PUCCH as described in Clause 5.2.4.
When CSI reporting on PUSCH comprises two parts, the UE may omit a portion of
the Part 2 CSI. Omission of Part 2 CSI is according to the priority order
shown in Table 5.2.3-1, where is the number of CSI reports configured to be
carried on the PUSCH. Priority 0 is the highest priority and priority is the
lowest priority and the CSI report _n_ corresponds to the CSI report with the
_n_ th smallest Pri~i,CSI~(_y,k,c,s_) value among the CSI reports as defined
in Clause 5.2.5. The subbands for a given CSI report _n_ indicated by the
higher layer parameter _csi-ReportingBand_ are numbered continuously in
increasing order with the lowest subband of _csi-ReportingBand_ as subband 0.
When omitting Part 2 CSI information for a particular priority level, the UE
shall omit all of the information at that priority level.
\- For Enhanced Type II reports, for a given CSI report $n$, each reported
element of indices $i_{2,4,l}$ $i_{2,5,l}\ $and $i_{1,7,l}$, indexed by $l,i$
and $f$, is associated with a priority value $\text{Pri}\left( l,i,f \right) =
2 \cdot L \cdot \upsilon \cdot \pi\left( f \right) + \upsilon \cdot i + l$,
with $\pi(f) = min(2 \cdot n_{3,l}^{\left( f \right)},2 \cdot \left( N_{3} -
n_{3,l}^{(f)} \right) - 1)$ with $l = 1,2,\ldots,\upsilon$, $i = 0,1,\ldots,2L
- 1$, and $f = 0,1,\ldots,M_{\upsilon} - 1$, and where $n_{3,l}^{(f)}$ is
defined in Clause 5.2.2.2.5. The element with the highest priority has the
lowest associated value $\text{Pri}\left( l,i,f \right)$. Omission of Part 2
CSI is according to the priority order shown in Table 5.2.3-1, where
\- Group 0 includes indices $i_{1,1}$ (if reported), $i_{1,2}$ (if reported)
and $i_{1,8,l}$ ($l = 1,\ldots,\upsilon$).
\- Group 1 includes indices $i_{1,5}$ (if reported), $i_{1,6,l}$ (if
reported), the $\upsilon 2LM_{\upsilon} - \left\lfloor K^{\text{NZ}}/2
\right\rfloor$ highest priority elements of $i_{1,7,l}$, $i_{2,3,l}$, the
$\max\left( 0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon
\right)$ highest priority elements of $i_{2,4,l}$ and the $\max\left(
0,\left\lceil \frac{K^{\text{NZ}}}{2} \right\rceil - \upsilon \right)$ highest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
\- Group 2 includes the $\left\lfloor K^{\text{NZ}}/2 \right\rfloor$ lowest
priority elements of $i_{1,7,l}$, the $\min\left( K^{\text{NZ}} -
\nu,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,4,l}$ and the $\min\left( K^{\text{NZ}} -
\nu,\left\lfloor \frac{K^{\text{NZ}}}{2} \right\rfloor \right)$ lowest
priority elements of $i_{2,5,l}$ ($l = 1,\ldots,\upsilon$).
Table 5.2.3-1: Priority reporting levels for Part 2 CSI
+----------------------------------------------------------------------+ | Priority 0: | | | | For CSI reports 1 to $N_{\text{Rep}}$, Group 0 CSI for CSI reports | | configured as \'typeII-r16\' or \'typeII-PortSelection-r16\'; Part 2 | | wideband CSI for CSI reports configured otherwise | +======================================================================+ | Priority 1: | | | | Group 1 CSI for CSI report 1, if configured as \'typeII-r16\' or | | \'typeII-PortSelection-r16\'; Part 2 subband CSI of even subbands | | for CSI report 1, if configured otherwise | +----------------------------------------------------------------------+ | Priority 2: | | | | Group 2 CSI for CSI report 1, if configured as \'typeII-r16\' or | | \'typeII-PortSelection-r16\'; Part 2 subband CSI of odd subbands for | | CSI report 1, if configured otherwise | +----------------------------------------------------------------------+ | Priority 3: | | | | Group 1 CSI for CSI report 2, if configured as \'typeII-r16\' or | | \'typeII-PortSelection-r16\'; Part 2 subband CSI of even subbands | | for CSI report 2, if configured otherwise | +----------------------------------------------------------------------+ | Priority 4: | | | | Group 2 CSI for CSI report 2, if configured as \'typeII-r16\' or | | \'typeII-PortSelection-r16\'. Part 2 subband CSI of odd subbands for | | CSI report 2, if configured otherwise | +----------------------------------------------------------------------+ | ⁞ | +----------------------------------------------------------------------+ | Priority $2N_{\text{Rep}} - 1$: | | | | Group 1 CSI for CSI report $N_{\text{Rep}}$, if configured as | | \'typeII-r16\' or \'typeII-PortSelection-r16\'; Part 2 subband CSI | | of even subbands for CSI report $N_{\text{Rep}}$, if configured | | otherwise | +----------------------------------------------------------------------+ | Priority $2N_{\text{Rep}}$: | | | | Group 2 CSI for CSI report $N_{\text{Rep}}$, if configured as | | \'typeII-r16\' or \'typeII-PortSelection-r16\'; Part 2 subband CSI | | of odd subbands for CSI report $N_{\text{Rep}}$, if configured | | otherwise | +----------------------------------------------------------------------+
When the UE is scheduled to transmit a transport block on PUSCH not using
repetition type B multiplexed with a CSI report(s), Part 2 CSI is omitted only
when {width="2.8506944444444446in" height="0.4673611111111111in"} is larger
than $\left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,all}}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{ACK/CG - UCI}^{'} - Q_{\text{CSI-1}}^{'}$, where
parameters {width="0.38958333333333334in" height="0.2534722222222222in"},
{width="0.325in" height="0.23402777777777778in"}, {width="0.49375in"
height="0.2465277777777778in"}, {width="0.4284722222222222in"
height="0.2534722222222222in"}, {width="0.50625in"
height="0.2534722222222222in"}, {width="0.5194444444444445in"
height="0.2534722222222222in"}, {width="0.22708333333333333in"
height="0.2534722222222222in"}, {width="0.44166666666666665in"
height="0.2534722222222222in"}, $Q_{ACK/CG - UCI}^{'}$ and
{width="0.15555555555555556in" height="0.1361111111111111in"}are defined in
Clause 6.3.2.4 of [5, TS 38.212].
Part 2 CSI is omitted level by level, beginning with the lowest priority level
until the lowest priority level is reached which causes the
{width="2.8506944444444446in" height="0.4673611111111111in"} to be less than
or equal to $\left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,all}}^{\text{PUSCH}} - 1}{M_{\text{sc}}^{\text{UCI}}\left( l
\right)} \right\rceil - Q_{ACK/CG - UCI}^{'} - Q_{\text{CSI-1}}^{'}$.
When the UE is scheduled to transmit a transport block on PUSCH using
repetition type B multiplexed with a CSI report(s), Part 2 CSI is omitted only
when
$$\left\lceil \frac{\left( O_{\text{CSI-2}} + L_{\text{CSI-2}} \right) \bullet
\beta_{\text{offset}}^{\text{PUSCH}} \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)}}{\sum_{r =
0}^{C_{\text{UL-SCH}} - 1}K_{r}} \right\rceil$$
is larger than
$\min\begin{Bmatrix} \left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)} \right\rceil -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'}\ ,\ \ \
\sum_{l = 0}^{N_{\text{symb,actual}}^{\text{PUSCH}} -
1}{M_{\text{sc,actual}}^{\text{UCI}}\left( l \right)} -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'} \
\end{Bmatrix}$,
where parameters {width="0.38958333333333334in"
height="0.2534722222222222in"}, {width="0.325in"
height="0.23402777777777778in"}, {width="0.49375in"
height="0.2465277777777778in"},
$N_{\text{symb}\text{,nominal}}^{\text{PUSCH}}$,
$N_{\text{symb}\text{,actual}}^{\text{PUSCH}}$,
$M_{\text{sc}\text{,nominal}}^{\text{UCI}}\left( l \right)$,
$M_{\text{sc}\text{,actual}}^{\text{UCI}}\left( l \right)$,
{width="0.5194444444444445in" height="0.2534722222222222in"},
{width="0.22708333333333333in" height="0.2534722222222222in"}, $Q_{ACK/CG -
UCI}^{'}$, {width="0.44166666666666665in" height="0.2534722222222222in"}, and
{width="0.15555555555555556in" height="0.1361111111111111in"}are defined in
Clause 6.3.2.4 of [5, TS 38.212].
Part 2 CSI is omitted level by level, beginning with the lowest priority level
until the lowest priority level is reached which causes
$$\left\lceil \frac{\left( O_{\text{CSI-2}} + L_{\text{CSI-2}} \right) \bullet
\beta_{\text{offset}}^{\text{PUSCH}} \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)}}{\sum_{r =
0}^{C_{\text{UL-SCH}} - 1}K_{r}} \right\rceil$$
to be less than or equal to
$\min\begin{Bmatrix} \left\lceil \alpha \bullet \sum_{l =
0}^{N_{\text{symb,nominal}}^{\text{PUSCH}} -
1}{M_{\text{sc,nominal}}^{\text{UCI}}\left( l \right)} \right\rceil -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'}\ ,\ \ \
\sum_{l = 0}^{N_{\text{symb,actual}}^{\text{PUSCH}} -
1}{M_{\text{sc,actual}}^{\text{UCI}}\left( l \right)} -
Q_{\text{ACK}/\text{CG} - \text{UCI}}^{'} - Q_{\text{CSI-1}}^{'} \
\end{Bmatrix}$.
When part 2 CSI is transmitted on PUSCH with no transport block, lower
priority bits are omitted until Part 2 CSI code rate, which is given by
$\left( O_{\text{CSI-2}} + L_{\text{CSI-2}} \right)/(N_{L} \cdot
Q'_{\text{CSI,2}} \cdot Q_{m})$ where $O_{\text{CSI-2}}$, $L_{\text{CSI-2}}$,
$N_{L},Q'_{\text{CSI,2}},Q_{m}$ are given in clause 6.3.2.4 of [5, 38.212]
before HARQ-ACK puncturing part 2 CSI if any, is below a threshold code rate
lower than one, where
\- is the CSI offset value from Table 9.3-2 of [6, TS 38.213]
\- _R_ is signaled code rate in DCI
If the UE is in an active semi-persistent CSI reporting configuration on
PUSCH, the CSI reporting is deactivated when either the downlink BWP or the
uplink BWP is changed. Another activation command is required to enable the
semi-persistent CSI reporting.
### 5.2.4 CSI reporting using PUCCH
A UE is semi-statically configured by higher layers to perform periodic CSI
Reporting on the PUCCH. A UE can be configured by higher layers for multiple
periodic CSI Reports corresponding to multiple higher layer configured CSI
Reporting Settings, where the associated CSI Resource Settings are higher
layer configured. Periodic CSI reporting on PUCCH formats 2, 3, 4 supports
Type I CSI with wideband granularity.
A UE shall perform semi-persistent CSI reporting on the PUCCH applied starting
from the first slot that is after slot $n + {3N}_{\text{slot}}^{subframe,µ}$
when the UE would transmit a PUCCH with HARQ-ACK information in slot _n_
corresponding to the PDSCH carrying the activation command described in clause
6.1.3.16 of [10, TS 38.321] where _μ_ is the SCS configuration for the PUCCH.
The activation command will contain one or more Reporting Settings where the
associated CSI Resource Settings are configured. Semi-persistent CSI reporting
on the PUCCH supports Type I CSI. Semi-persistent CSI reporting on the PUCCH
format 2 supports Type I CSI with wideband frequency granularity. Semi-
persistent CSI reporting on PUCCH formats 3 or 4 supports Type I CSI with
wideband and sub-band frequency granularities and Type II CSI Part 1.
When the PUCCH carry Type I CSI with wideband frequency granularity, the CSI
payload carried by the PUCCH format 2 and PUCCH formats 3, or 4 are identical
and the same irrespective of RI (if reported), CRI (if reported). For type I
CSI sub-band reporting on PUCCH formats 3, or 4, the payload is split into two
parts. The first part contains RI (if reported), CRI (if reported), CQI for
the first codeword. The second part contains PMI and contains the CQI for the
second codeword when RI > 4.
A semi-persistent report carried on the PUCCH formats 3 or 4 supports Type II
CSI feedback, but only Part 1 of Type II CSI feedback (See Clause 5.2.2 and
5.2.3). Supporting Type II CSI reporting on the PUCCH formats 3 or 4 is a UE
capability _type2-SP-CSI-Feedback-LongPUCCH_. A Type II CSI report (Part 1
only) carried on PUCCH formats 3 or 4 shall be calculated independently of any
Type II CSI reports carried on the PUSCH (see Clause 5.2.3).
When the UE is configured with CSI Reporting on PUCCH formats 2, 3 or 4, each
PUCCH resource is configured for each candidate UL BWP.
If the UE is in an active semi-persistent CSI reporting configuration on PUCCH
and has not received a deactivation command, the CSI reporting takes place
when the BWP in which the reporting is configured to take place is the active
BWP, otherwise the CSI reporting is suspended.
A UE is not expected to report CSI with a total number of UCI bits and CRC
bits larger than 115 bits when configured with PUCCH format 4. For CSI reports
transmitted on a PUCCH, if all CSI reports consist of one part, the UE may
omit a portion of CSI reports. Omission of CSI is according to the priority
order determined from the Pri~i,CSI~(_y,k,c,s_) value as defined in Clause
5.2.5. CSI report is omitted beginning with the lowest priority level until
the CSI report code rate is less or equal to the one configured by the higher
layer parameter _maxCodeRate_.
If any of the CSI reports consist of two parts, the UE may omit a portion of
Part 2 CSI. Omission of Part 2 CSI is according to the priority order shown in
Table 5.2.3-1. Part 2 CSI is omitted beginning with the lowest priority level
until the Part 2 CSI code rate is less or equal to the one configured by
higher layer parameter _maxCodeRate_.
### 5.2.5 Priority rules for CSI reports
For two overlapping PUSCHs, the priority rules in this clause are applied for
physical channels with same priority index according to clause 9 in [6, TS
38.213].
CSI reports are associated with a priority value
$\text{Pri}_{\text{iCSI}}\left( y,k,c,s \right) = 2 \bullet N_{\text{cells}}
\bullet M_{s} \bullet y + N_{\text{cells}} \bullet M_{s} \bullet k + M_{s}
\bullet c + s$ where
\- for aperiodic CSI reports to be carried on PUSCH for semi-persistent CSI
reports to be carried on PUSCH, for semi-persistent CSI reports to be carried
on PUCCH and for periodic CSI reports to be carried on PUCCH;
\- for CSI reports carrying L1-RSRP or L1-SINR and for CSI reports not
carrying L1-RSRP or L1-SINR;
\- _c_ is the serving cell index and $N_{\text{cells}}$ is the value of the
higher layer parameter _maxNrofServingCells_ ;
> \- _s_ is the _reportConfigID_ and is the value of the higher layer
> parameter _maxNrofCSI-ReportConfigurations._
A first CSI report is said to have priority over second CSI report if the
associated value is lower for the first report than for the second report.
Two CSI reports are said to collide if the time occupancy of the physical
channels scheduled to carry the CSI reports overlap in at least one OFDM
symbol and are transmitted on the same carrier. When a UE is configured to
transmit two colliding CSI reports,
\- if _y_ values are different between the two CSI reports, the following
rules apply except for the case when one of the _y_ value is 2 and the other
_y_ value is 3 (for CSI reports transmitted on PUSCH, as described in Clause
5.2.3; for CSI reports transmitted on PUCCH, as described in Clause 5.2.4):
\- The CSI report with higher value shall not be sent by the UE.
\- otherwise, the two CSI reports are multiplexed or either is dropped based
on the priority values, as described in Clause 9.2.5.2 in [6, TS 38.213].
If a semi-persistent CSI report to be carried on PUSCH overlaps in time with
PUSCH data transmission in one or more symbols on the same carrier, and if the
earliest symbol of these PUSCH channels starts no earlier than N~2~+d~2,1~
symbols after the last symbol of the DCI scheduling the PUSCH where d~2,1~ is
the maximum of the d~2,1~ associated with the PUSCH carrying semi-persistent
CSI report and the PUSCH with data transmission, the CSI report shall not be
transmitted by the UE. Otherwise, if the timeline requirement is not satisfied
this is an error case.
If a UE would transmit a first PUSCH that includes semi-persistent CSI reports
and a second PUSCH that includes an UL-SCH on the same carrier, and the first
PUSCH transmission would overlap in time with the second PUSCH transmission,
the UE does not transmit the first PUSCH and transmits the second PUSCH. The
UE expects that the first and second PUSCH transmissions satisfy the above
timing conditions for PUSCH transmissions that overlap in time when at least
one of the first or second PUSCH transmissions is in response to a DCI format
detection by the UE.
## 5.3 UE PDSCH processing procedure time
If the first uplink symbol of the PUCCH which carries the HARQ-ACK
information, as defined by the assigned HARQ-ACK timing _K~1\ ~_ and the PUCCH
resource to be used and including the effect of the timing advance, starts no
earlier than at symbol _L~1~_ , where _L~1~_ is defined as the next uplink
symbol with its CP starting after after the end of the last symbol of the
PDSCH carrying the TB being acknowledged, then the UE shall provide a valid
HARQ-ACK message.
_\- N~1~_ is based on _µ_ of table 5.3-1 and table 5.3-2 for UE processing
capability 1 and 2 respectively, where _µ_ corresponds to the one of
(_µ~PDCCH~_ , _µ~PDSCH~_ , _µ~UL~_) resulting with the largest _T~proc,1~_ ,
where the _µ~PDCCH~_ corresponds to the subcarrier spacing of the PDCCH
scheduling the PDSCH, the _µ~PDSCH~_ corresponds to the subcarrier spacing of
the scheduled PDSCH, and _µ~UL~_ corresponds to the subcarrier spacing of the
uplink channel with which the HARQ-ACK is to be transmitted, and κ is defined
in clause 4.1 of [4, TS 38.211].
_-_ For operation with shared spectrum channel access, is calculated according
to [4, TS 38.211], otherwise =0.
_-_ If the PDSCH DM-RS position $l_{1}$ for the additional DM-RS in Table
7.4.1.1.2-3 in clause 7.4.1.1.2 of [4, TS 38.211] is $l_{1} = 12$ then
_N~1,0~=14_ in Table 5.3-1 _,_ otherwise _N~1,0~=13._
\- If the UE is configured with multiple active component carriers, the first
uplink symbol which carries the HARQ-ACK information further includes the
effect of timing difference between the component carriers as given in [11, TS
38.133].
\- For the PDSCH mapping type A as given in clause 7.4.1.1 of [4, TS 38.211]:
if the last symbol of PDSCH is on the _i-_ th symbol of the slot where _i_ \ µ~PDSCH~, the UE is expected to receive the scheduled PDSCH,
if the first symbol in the PDSCH allocation, including the DM-RS, as defined
by the slot offset _K~0~_ and the start and length indicator _SLIV_ of the
scheduling DCI starts no earlier than _N~pdsch~_ PDCCH symbols after the end
of the PDCCH scheduling the PDSCH, not taking into account the effect of
receive timing difference between the scheduling cell and the scheduled cell.
Table 5.5-1: _N~pdsch~_ as a function of the subcarrier spacing of the
scheduling PDCCH
**_µ~PDCCH~_** **_N~pdsch~_ [symbols]**
* * *
0 4 1 5 2 10 3 14
# 6 Physical uplink shared channel related procedure
## 6.1 UE procedure for transmitting the physical uplink shared channel
PUSCH transmission(s) can be dynamically scheduled by an UL grant in a DCI, or
the transmission can correspond to a configured grant Type 1 or Type 2. The
configured grant Type 1 PUSCH transmission is semi-statically configured to
operate upon the reception of higher layer parameter of _configuredGrantConfig
including rrc-ConfiguredUplinkGrant_ without the detection of an UL grant in a
DCI. The configured grant Type 2 PUSCH transmission is semi-persistently
scheduled by an UL grant in a valid activation DCI according to Clause 10.2 of
[6, TS 38.213] after the reception of higher layer parameter
_configuredGrantConfig_ not including _rrc-ConfiguredUplinkGrant_. If
_configuredGrantConfigToAddModList_ is configured, more than one configured
grant configuration of configured grant Type 1 and/or configured grant Type 2
may be active at the same time on an active BWP of a serving cell.
For the PUSCH transmission corresponding to a Type 1 configured grant or a
Type 2 configured grant activated by DCI format 0_0 or 0_1, the parameters
applied for the transmission are provided by _configuredGrantConfig_ except
for _dataScramblingIdentityPUSCH_ , _txConfig_ , _codebookSubset_ , _maxRank_
, _scaling_ of _UCI-OnPUSCH,_ which are provided by _pusch-Config_. For the
PUSCH transmission corresponding to a Type 2 configured grant activated by DCI
format 0_2, the parameters applied for the transmission are provided by
_configuredGrantConfig_ except for _dataScramblingIdentityPUSCH_ , _txConfig_
, _codebookSubsetDCI-0-2_ , _maxRankDCI-0-2_ , _scaling_ of _UCI-OnPUSCH,
resourceAllocationType1GranularityDCI-0-2_ provided by _pusch-Config_. If the
UE is provided with _transformPrecoder in configuredGrantConfig, the UE
applies the higher layer parameter tp-pi2BPSK_ , if provided in _pusch-Config_
, according to the procedure described in Clause 6.1.4 for the PUSCH
transmission corresponding to a configured grant.
For the PUSCH retransmission scheduled by a PDCCH with CRC scrambled by CS-
RNTI with NDI=1, the parameters in _pusch-Config_ are applied for the PUSCH
transmission except for _p0-NominalWithoutGrant, p0-PUSCH-Alpha,
powerControlLoopToUse,_ _pathlossReferenceIndex_ described in Clause 7.1 of
[6, TS 38.213], _mcs-Table, mcs-TableTransformPrecoder_ described in Clause
6.1.4.1 and _transformPrecoder_ described in Clause 6.1.3.
For a UE configured with two uplinks in a serving cell, PUSCH retransmission
for a TB on the serving cell is not expected to be on a different uplink than
the uplink used for the PUSCH initial transmission of that TB.
A UE shall upon detection of a PDCCH with a configured DCI format 0_0, 0_1 or
0_2 transmit the corresponding PUSCH as indicated by that DCI unless the UE
does not generate a transport block as described in [10, TS38.321]. Upon
detection of a DCI format 0_1 or 0_2 with \'_UL-SCH indicator_ \' set to \'0\'
and with a non-zero \'_CSI request_ \' where the associated _reportQuantity_
in _CSI-ReportConfig_ set to \'_none_ \' for all CSI report(s) triggered by
\'_CSI request_ \' in this DCI format 0_1 or 0_2, the UE ignores all fields in
this DCI except the \'_CSI request_ \' and the UE shall not transmit the
corresponding PUSCH as indicated by this DCI format 0_1 or 0_2. When the UE is
scheduled with multiple PUSCHs by a DCI, HARQ process ID indicated by this DCI
applies to the first PUSCH, as described in clause 6.1.2.1, HARQ process ID is
then incremented by 1 for each subsequent PUSCH(s) in the scheduled order,
with modulo 16 operation applied. For any HARQ process ID(s) in a given
scheduled cell, the UE is not expected to transmit a PUSCH that overlaps in
time with another PUSCH. Except for the case when a UE is configured by higher
layer parameter _PDCCH-Config_ that contains two different values of
_coresetPoolIndex_ in _ControlResourceSet_ for the active BWP of a serving
cell and PDCCHs that schedule two non-overlapping in time domain PUSCHs are
associated to different _ControlResourceSets_ having different values of
_coresetPoolIndex,_ for any two HARQ process IDs in a given scheduled cell, if
the UE is scheduled to start a first PUSCH transmission starting in symbol _j_
by a PDCCH ending in symbol _i_ , the UE is not expected to be scheduled to
transmit a PUSCH starting earlier than the end of the first PUSCH by a PDCCH
that ends later than symbol _i_. The UE is not expected to be scheduled to
transmit another PUSCH by a DCI format 0_0 with CRC scrambled by TC-RNTI, for
a given HARQ process with the DCI received before the end of the expected
transmission of the last PUSCH for that HARQ process if the latter is
scheduled by a DCI format 0_0 with CRC scrambled by TC-RNTI or by an UL grant
in RA Response. The UE is not expected to be scheduled to transmit another
PUSCH by DCI format 0_0, 0_1 or 0_2 scrambled by C-RNTI, CS-RNTI or MCS-C-RNTI
for a given HARQ process with the DCI received before the end of the expected
transmission of the last PUSCH for that HARQ process if the latter is
scheduled by a DCI with CRC scrambled by C-RNTI, CS-RNTI or MCS-C-RNTI.
If a UE is configured by higher layer parameter _PDCCH-Config_ that contains
two different values of _coresetPoolIndex_ in _ControlResourceSet_ for the
active BWP of a serving cell and PDCCHs that schedule two non-overlapping in
time domain PUSCHs are associated to different _ControlResourceSets_ having
different values of _coresetPoolIndex,_ for any two HARQ process IDs in a
given scheduled cell, if the UE is scheduled to start a first PUSCH
transmission starting in symbol _j_ by a PDCCH associated with a value of
_coresetPoolIndex_ ending in symbol _i_ , the UE can be scheduled to transmit
a PUSCH starting earlier than the end of the first PUSCH by a PDCCH associated
with a different value of _coresetPoolIndex_ that ends later than symbol _i_.
A UE is not expected to be scheduled by a PDCCH ending in symbol $i$ to
transmit a PUSCH on a given serving cell overlapping in time with a
transmission occasion, where the UE is allowed to transmit a PUSCH with
configured grant according to [10, TS38.321], starting in a symbol $j$ on the
same serving cell if the end of symbol $i$ is not at least $N_{2}$ symbols
before the beginning of symbol $j$. The value $N_{2}$ in symbols is determined
according to the UE processing capability defined in Clause 6.4, and $N_{2}\
$and the symbol duration are based on the minimum of the subcarrier spacing
corresponding to the PUSCH with configured grant and the subcarrier spacing of
the PDCCH scheduling the PUSCH.
If a UE receives an ACK for a given HARQ process in CG-DFI in a PDCCH ending
in symbol _i_ to terminate a transport block repetition in a PUSCH
transmission with a configured grant on a given serving cell with the same
HARQ process after symbol _i_ , the UE is expected to terminate the repetition
of the transport block in a PUSCH transmission starting from a symbol _j_ if
the gap between the end of PDCCH of symbol _i_ and the start of the PUSCH
transmission in symbol _j_ is equal to or more than _N2_ symbols. The value
_N2_ in symbols is determined according to the UE processing capability
defined in Clause 6.4, and _N2_ and the symbol duration are based on the
minimum of the subcarrier spacing corresponding to the PUSCH and the
subcarrier spacing of the PDCCH indicating CG-DFI.
A UE is not expected to be scheduled by a PDCCH ending in symbol $i$ to
transmit a PUSCH on a given serving cell for a given HARQ process, if there is
a transmission occasion where the UE is allowed to transmit a PUSCH with
configured grant according to [10, TS38.321] with the same HARQ process on the
same serving cell starting in a symbol $j$ after symbol $i$, and if the gap
between the end of PDCCH and the beginning of symbol $j$ is less than $N_{2}$
symbols. The value $N_{2}$ in symbols is determined according to the UE
processing capability defined in Clause 6.4, and $N_{2}\ $and the symbol
duration are based on the minimum of the subcarrier spacing corresponding to
the PUSCH with configured grant and the subcarrier spacing of the PDCCH
scheduling the PUSCH.
For PUSCH scheduled by DCI format 0_0 on a cell, the UE shall transmit PUSCH
according to the spatial relation, if applicable, corresponding to the
dedicated PUCCH resource with the lowest ID within the active UL BWP of the
cell, as described in Clause 9.2.1 of [6, TS 38.213].
For PUSCH scheduled by DCI format 0_0 on a cell and if the higher layer
parameter _enableDefaultBeamPL-ForPUSCH0-0_ is set \'enabled\', the UE is not
configured with PUCCH resources on the active UL BWP and the UE is in RRC
connected mode, the UE shall transmit PUSCH according to the spatial relation,
if applicable, with a reference to the RS configured with _qcl-Type_ set to
\'typeD\' corresponding to the QCL assumption of the CORESET with the lowest
ID on the active DL BWP of the cell.
For PUSCH scheduled by DCI format 0_0 on a cell and if the higher layer
parameter _enableDefaultBeamPL-ForPUSCH0-0_ is set \'enabled\', the UE is
configured with PUCCH resources on the active UL BWP where all the PUCCH
resource(s) are not configured with any spatial relation and the UE is in RRC
connected mode, the UE shall transmit PUSCH according to the spatial relation,
if applicable, with a reference to the RS configured with _qcl-Type_ set to
\'typeD\' corresponding to the QCL assumption of the CORESET with the lowest
ID on the active DL BWP of the cell in case CORESET(s) are configured on the
cell.
For uplink, 16 HARQ processes per cell is supported by the UE.
### 6.1.1 Transmission schemes
Two transmission schemes are supported for PUSCH: codebook based transmission
and non-codebook based transmission. The UE is configured with codebook based
transmission when the higher layer parameter _txConfig_ in _pusch-Config_ is
set to \'codebook\', the UE is configured non-codebook based transmission when
the higher layer parameter _txConfig_ is set to \'nonCodebook\'. If the higher
layer parameter _txConfig_ is not configured, the UE is not expected to be
scheduled by DCI format 0_1 or 0_2. If PUSCH is scheduled by DCI format 0_0,
the PUSCH transmission is based on a single antenna port. Except if the higher
layer parameter _enableDefaultBeamPL-ForPUSCH0-0_ is set \'enabled\', the UE
shall not expect PUSCH scheduled by DCI format 0_0 in a BWP without configured
PUCCH resource with _PUCCH-SpatialRelationInfo_ in frequency range 2 in RRC
connected mode.
#### 6.1.1.1 Codebook based UL transmission
For codebook based transmission, PUSCH can be scheduled by DCI format 0_0, DCI
format 0_1, DCI format 0_2 or semi-statically configured to operate according
to Clause 6.1.2.3. If this PUSCH is scheduled by DCI format 0_1, DCI format
0_2, or semi-statically configured to operate according to Clause 6.1.2.3, the
UE determines its PUSCH transmission precoder based on SRI, TPMI and the
transmission rank, where the SRI, TPMI and the transmission rank are given by
DCI fields of SRS resource indicator and Precoding information and number of
layers in clause 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1
and 0_2 or given by _srs-ResourceIndicator_ and _precodingAndNumberOfLayers_
according to clause 6.1.2.3. The _SRS-ResourceSet(s)_ applicable for PUSCH
scheduled by DCI format 0_1 and DCI format 0_2 are defined by the entries of
the higher layer parameter _srs-ResourceSetToAddModList_ and _srs-
ResourceSetToAddModListDCI-0-2_ in _SRS-config_ , respectively. Only one SRS
resource set can be configured in _srs-ResourceSetToAddModList_ with higher
layer parameter _usage_ in _SRS-ResourceSet_ set to \'codebook\', and only one
SRS resource set can be configured in _srs-ResourceSetToAddModListDCI-0-2_
with higher layer parameter _usage_ in _SRS-ResourceSet_ set to \'codebook\'.
The TPMI is used to indicate the precoder to be applied over the layers
{0..._ν_ -1} and that corresponds to the SRS resource selected by the SRI when
multiple SRS resources are configured, or if a single SRS resource is
configured TPMI is used to indicate the precoder to be applied over the layers
{0..._ν_ -1} and that corresponds to the SRS resource. The transmission
precoder is selected from the uplink codebook that has a number of antenna
ports equal to higher layer parameter _nrofSRS-Ports_ in SRS-Config, as
defined in Clause 6.3.1.5 of [4, TS 38.211]. When the UE is configured with
the higher layer parameter _txConfig_ set to \'codebook\', the UE is
configured with at least one SRS resource. The indicated SRI in slot _n_ is
associated with the most recent transmission of SRS resource identified by the
SRI, where the SRS resource is prior to the PDCCH carrying the SRI.
For codebook based transmission, the UE determines its codebook subsets based
on TPMI and upon the reception of higher layer parameter _codebookSubset_ in
_pusch-Config_ for PUSCH associated with DCI format 0_1 and
_codebookSubsetDCI-0-2_ in _pusch-Config_ for PUSCH associated with DCI format
0_2 which may be configured with _\'_ fullyAndPartialAndNonCoherent _\'_ , or
_\'_ partialAndNonCoherent _\'_ , or \'nonCoherent\' depending on the UE
capability. When higher layer parameter _ul-FullPowerTransmission_ is set to
\'_fullpowerMode2\'_ and the higher layer parameter _codebookSubset_ or the
higher layer parameter _codebookSubsetDCI-0-2_ is set to _\'_
partialAndNonCoherent\', and when the SRS-resourceSet with usage set to
\"codebook\" includes at least one SRS resource with 4 ports and one SRS
resource with 2 ports, the codebookSubset associated with the 2-port SRS
resource is \'nonCoherent\'. The maximum transmission rank may be configured
by the higher layer parameter _maxRank_ in _pusch-Config_ for PUSCH scheduled
with DCI format 0_1 and _maxRankDCI-0-2_ for PUSCH scheduled with DCI format
0_2 _._
A UE reporting its UE capability of \'partialAndNonCoherent\' transmission
shall not expect to be configured by either _codebookSubset_ or
_codebookSubsetDCI-0-2_ with \'fullyAndPartialAndNonCoherent _\'_.
A UE reporting its UE capability of \'nonCoherent\' transmission shall not
expect to be configured by either _codebookSubset_ or _codebookSubsetDCI-0-2_
with _\'_ fullyAndPartialAndNonCoherent _\'_ or with _\'_
partialAndNonCoherent\'.
A UE shall not expect to be configured with the higher layer parameter
_codebookSubset_ or the higher layer parameter _codebookSubsetDCI-0-2_ set to
_\'_ partialAndNonCoherent\' when higher layer parameter _nrofSRS-Ports_ in an
_SRS-ResourceSet_ with _usage_ set to \'codebook\' indicates that the maximum
number of the configured SRS antenna ports in the _SRS-ResourceSet_ is two.
For codebook based transmission, only one SRS resource can be indicated based
on the SRI from within the SRS resource set. Except when higher layer
parameter _ul-FullPowerTransmission_ is set to \'_fullpowerMode2_ \', the
maximum number of configured SRS resources for codebook based transmission is
2. If aperiodic SRS is configured for a UE, the SRS request field in DCI
triggers the transmission of aperiodic SRS resources.
A UE shall not expect to be configured with higher layer parameter _ul-
FullPowerTransmission_ set to \'fullpowerMode1 _\'_ and _codebookSubset_ or
_codebookSubsetDCI-0-2_ set to _\'_ fullAndPartialAndNonCoherent _\'_
simultaneously.
The UE shall transmit PUSCH using the same antenna port(s) as the SRS port(s)
in the SRS resource indicated by the DCI format 0_1 or 0_2 or by
_configuredGrantConfig_ according to clause 6.1.2.3.
The DM-RS antenna ports {width="0.6479166666666667in"
height="0.21736111111111112in"} in Clause 6.4.1.1.3 of [4, TS38.211] are
determined according to the ordering of DM-RS port(s) given by Tables
7.3.1.1.2-6 to 7.3.1.1.2-23 in Clause 7.3.1.1.2 of [5, TS 38.212].
Except when higher layer parameter _ul-FullPowerTransmission_ is set to
\'_fullpowerMode2_ \', when multiple SRS resources are configured by _SRS-
ResourceSet_ with _usage_ set to \'codebook\', the UE shall expect that higher
layer parameters _nrofSRS-Ports_ in _SRS-Resource_ in _SRS-ResourceSet_ shall
be configured with the same value for all these SRS resources.
When higher layer parameter _ul-FullPowerTransmission_ is set to
\'_fullpowerMode2_ \',
\- the UE can be configured with one SRS resource or multiple SRS resources
with same or different number of SRS ports within an SRS resource set with
_usage_ set to \'codebook\'.
**\- up to 2 different spatial relations can be configured for all SRS
resources in the SRS resource set with _usage_ set to \'codebook\' when**
multiple SRS resources are configured in the SRS resource set**.**
**-** subject to UE capability, **a maximum of 2 or 4 SRS resources are
supported in an SRS resource set with _usage_ set to \'codebook\'.**
#### 6.1.1.2 Non-Codebook based UL transmission
For non-codebook based transmission, PUSCH can be scheduled by DCI format 0_0,
DCI format 0_1, DCI format 0_2 or semi-statically configured to operate
according to Clause 6.1.2.3. If this PUSCH is scheduled by DCI format 0_1, DCI
format 0_2, or semi-statically configured to operate according to Clause
6.1.2.3, the UE can determine its PUSCH precoder and transmission rank based
on the SRI when multiple SRS resources are configured, where the SRI is given
by the SRS resource indicator in DCI according to clause 7.3.1.1.2 and
7.3.1.1.3 of [5, 38.212] for DCI format 0_1 and DCI format 0_2, or the SRI is
given by _srs-ResourceIndicator_ according to clause 6.1.2.3. The _SRS-
ResourceSet(s)_ applicable for PUSCH scheduled by DCI format 0_1 and DCI
format 0_2 are defined by the entries of the higher layer parameter _srs-
ResourceSetToAddModList_ and _srs-ResourceSetToAddModListDCI-0-2_ in _SRS-
config_ , respectively. The UE shall use one or multiple SRS resources for SRS
transmission, where, in a SRS resource set, the maximum number of SRS
resources which can be configured to the UE for simultaneous transmission in
the same symbol and the maximum number of SRS resources are UE capabilities.
The SRS resources transmitted simultaneously occupy the same RBs. Only one SRS
port for each SRS resource is configured. Only one SRS resource set can be
configured in _srs-ResourceSetToAddModList_ with higher layer parameter
_usage_ in _SRS-ResourceSet_ set to \'nonCodebook\', and only one SRS resource
set can be configured in _srs-ResourceSetToAddModListDCI-0-2_ with higher
layer parameter _usage_ in _SRS-ResourceSet_ set to \'nonCodebook\'. The
maximum number of SRS resources that can be configured for non-codebook based
uplink transmission is 4. The indicated SRI in slot _n_ is associated with the
most recent transmission of SRS resource(s) identified by the SRI, where the
SRS transmission is prior to the PDCCH carrying the SRI.
For non-codebook based transmission, the UE can calculate the precoder used
for the transmission of SRS based on measurement of an associated NZP CSI-RS
resource. A UE can be configured with only one NZP CSI-RS resource for the SRS
resource set with higher layer parameter usage in _SRS-ResourceSet_ set to
\'nonCodebook\' if configured.
\- If aperiodic SRS resource set is configured, the associated NZP-CSI-RS is
indicated via SRS request field in DCI format 0_1 and 1_1, as well as DCI
format 0_2 (if SRS request field is present) and DCI format 1_2 (if SRS
request field is present), where _AperiodicSRS-ResourceTrigger_ and
_AperiodicSRS-ResourceTriggerList_ (indicating the association between
aperiodic SRS triggering state(s) and SRS resource sets), triggered SRS
resource(s) _srs-ResourceSetId_ , _csi-RS (indicating the associated NZP-CSI-
RS-ResourceId)_ are higher layer configured in _SRS-ResourceSet_. The _SRS-
ResourceSet(s)_ associated with the SRS request by DCI format 0_1 and 1_1 are
defined by the entries of the higher layer parameter _srs-
ResourceSetToAddModList_ and the _SRS-ResourceSet(s)_ associated with the SRS
request by DCI format 0_2 and 1_2 are defined by the entries of the higher
layer parameter _srs-ResourceSetToAddModListDCI-0-2_. A UE is not expected to
update the SRS precoding information if the gap from the last symbol of the
reception of the aperiodic NZP-CSI-RS resource and the first symbol of the
aperiodic SRS transmission is less than 42 OFDM symbols.
\- If the UE configured with aperiodic SRS associated with aperiodic NZP CSI-
RS resource, the presence of the associated CSI-RS is indicated by the SRS
request field if the value of the SRS request field is not \'00\' as in Table
7.3.1.1.2-24 of [5, TS 38.212] and if the scheduling DCI is not used for cross
carrier or cross bandwidth part scheduling. If UE is configured with
_minimumSchedulingOffsetK0_ in the active DL BWP and the currently applicable
minimum scheduling offset restriction _K~0,min~_ is larger than 0, the UE does
not expected to receive the scheduling DCI with the SRS request field value
other than \'00\'. The CSI-RS is located in the same slot as the SRS request
field. If the UE configured with aperiodic SRS associated with aperiodic NZP
CSI-RS resource, any of the TCI states configured in the scheduled CC shall
not be configured with _qcl-Type_ set to \'typeD\'.
\- If periodic or semi-persistent SRS resource set is configured, the _NZP-
CSI-RS-ResourceId_ for measurement is indicated via higher layer parameter
_associatedCSI-RS_ in _SRS-ResourceSet_.
The UE shall perform one-to-one mapping from the indicated SRI(s) to the
indicated DM-RS ports(s) and their corresponding PUSCH layers {0 ... ν-1}
given by DCI format 0_1 or 0_2 or by _configuredGrantConfig_ according to
clause 6.1.2.3 in increasing order.
The UE shall transmit PUSCH using the same antenna ports as the SRS port(s) in
the SRS resource(s) indicated by SRI(s) given by DCI format 0_1 or 0_2 or by
_configuredGrantConfig_ according to clause 6.1.2.3, where the SRS port in
(_i_ +1)-th SRS resource in the SRS resource set is indexed as .
The DM-RS antenna ports {width="0.6479166666666667in"
height="0.21736111111111112in"} in Clause 6.4.1.1.3 of [4, TS 38.211] are
determined according to the ordering of DM-RS port(s) given by Tables
7.3.1.1.2-6 to 7.3.1.1.2-23 in Clause 7.3.1.1.2 of [5, TS 38.212].
For non-codebook based transmission, the UE does not expect to be configured
with both _spatialRelationInfo_ for SRS resource and _associatedCSI-RS_ in
_SRS-ResourceSet_ for SRS resource set.
For non-codebook based transmission, the UE can be scheduled with DCI format
0_1 or 0_2 when at least one SRS resource is configured in _SRS-ResourceSet_
with _usage_ set to \'nonCodebook\'.
### 6.1.2 Resource allocation
#### 6.1.2.1 Resource allocation in time domain
When the UE is scheduled to transmit a transport block and no CSI report by a
DCI or by a RAR UL grant or fallbackRAR UL grant, or the UE is scheduled to
transmit a transport block and a CSI report(s) on PUSCH by a DCI, the \'_Time
domain resource assignment\'_ field value _m_ of the DCI or the _PUSCH time
resource allocation_ field value _m_ of the RAR UL grant or of the fallbackRAR
UL grant provides a row index _m_ \+ 1 to an allocated table. The
determination of the used resource allocation table is defined in Clause
6.1.2.1.1. The indexed row defines the slot offset _K~2~_ , the start and
length indicator _SLIV_ , or directly the start symbol _S_ and the allocation
length _L_ , the PUSCH mapping type, and the number of repetitions (if
_numberOfRepetitions_ is present in the resource allocation table) to be
applied in the PUSCH transmission.
When the UE is scheduled to transmit a PUSCH with no transport block and with
a CSI report(s) by a \'_CSI request\'_ field on a DCI, the \'_Time domain
resource assignment\'_ field value _m_ of the DCI provides a row index _m_ \+
1 to the allocated table as defined in Clause 6.1.2.1.1. The indexed row
defines the start and length indicator SLIV, or directly the start symbol _S_
and the allocation length _L_ , and the PUSCH mapping type to be applied in
the PUSCH transmission and the _K~2~_ value is determined as , where are the
corresponding list entries of the higher layer parameter
\- _reportSlotOffsetListDCI-0-2_ , if PUSCH is scheduled by DCI format 0_2 and
_reportSlotOffsetListDCI-0-2_ is configured;
\- _reportSlotOffsetListDCI-0-1_ , if PUSCH is scheduled by DCI format 0_1 and
_reportSlotOffsetListDCI-0-1_ is configured;
\- _reportSlotOffsetList_ , otherwise;
in _CSI-ReportConfig_ for the triggered CSI Reporting Settings and is the
_(m+1)_ th entry of .
\- The slot _K~s~_ where the UE shall transmit the PUSCH is determined by
_K~2~_ as _K~s\ ~_ =, if UE is configured with _ca-SlotOffset_ for at least
one of the scheduled and scheduling cell, _K~s\ ~_
={width="1.0284722222222222in" height="0.5145833333333333in"}, otherwise, and
where _n_ is the slot with the scheduling DCI, K _~2~_ is based on the
numerology of PUSCH, and and are the subcarrier spacing configurations for
PUSCH and PDCCH, respectively,
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}\ $are the$\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH,$\
N_{\text{slot,\ offset,\ }\text{PU}\text{S}\text{CH}}^{\text{CA}}$ and$\
\mu_{\text{offset}\text{,}\text{P}\text{U}\text{SCH}}$ are the
$N_{\text{slot,\ offset}}^{\text{CA}}$ and the,respectively, which are
determined by higher-layer configured _ca-SlotOffset_ for the cell
transmitting the PUSCH, as defined in clause 4.5 of [4, TS 38.211], and
\- for PUSCH scheduled by DCI format 0_1, if _pusch-RepTypeIndicatorDCI-0-1_
is set to \'_pusch-RepTypeB_ \', the UE applies PUSCH repetition Type B
procedure when determining the time domain resource allocation. For PUSCH
scheduled by DCI format 0_2, if _pusch-RepTypeIndicatorDCI-0-2_ is set to
\'_pusch-RepTypeB_ \', the UE applies PUSCH repetition Type B procedure when
determining the time domain resource allocation. Otherwise, the UE applies
PUSCH repetition Type A procedure when determining the time domain resource
allocation for PUSCH scheduled by PDCCH, by RAR UL grant, or by fallbackRAR UL
grant.
\- For PUSCH repetition Type A, the starting symbol _S_ relative to the start
of the slot, and the number of consecutive symbols _L_ counting from the
symbol _S_ allocated for the PUSCH are determined from the start and length
indicator _SLIV_ of the indexed row:
> if then
>
> else
>
> where, and
\- For PUSCH repetition Type B, the starting symbol _S_ relative to the start
of the slot, and the number of consecutive symbols _L_ counting from the
symbol _S_ allocated for the PUSCH are provided by _startSymbol_ and _length_
of the indexed row of the resource allocation table, respectively.
\- For PUSCH repetition Type A, the PUSCH mapping type is set to Type A or
Type B as defined in Clause 6.4.1.1.3 of [4, TS 38.211] as given by the
indexed row.
\- For PUSCH repetition Type B, the PUSCH mapping type is set to Type B.
The UE shall consider the _S_ and _L_ combinations defined in table 6.1.2.1-1
as valid PUSCH allocations
Table 6.1.2.1-1: Valid _S_ and _L_ combinations
PUSCH mapping type Normal cyclic prefix Extended cyclic prefix
* * *
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
Type A (repetition Type A only) 0 {4,...,14} {4,...,14} 0 {4,...,12}
{4,...,12} Type B {0,...,13} {1,...,14} {1,...,14} for repetition Type A,
{1,...,27} for repetition Type B {0,..., 11} {1,...,12} {1,...,12} for
repetition Type A, {1,...,23} for repetition Type B
For PUSCH repetition Type A, when transmitting PUSCH scheduled by DCI format
0_1 or 0_2 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI, or CS-RNTI
with NDI=1, the number of repetitions _K_ is determined as
\- if _numberOfRepetitions_ is present in the resource allocation table, the
number of repetitions K is equal to _numberOfRepetitions_ ;
\- elseif the UE is configured with _pusch-AggregationFactor_ , the number of
repetitions _K_ is equal to _pusch-AggregationFactor_ ;
\- otherwise _K=1_.
If a UE is configured with higher layer parameter _pusch-
TimeDomainAllocationListForMultiPUSCH_ , the UE does not expect to be
configured with _pusch-AggregationFactor._
For PUSCH repetition Type A, in case _K >1,_ the same symbol allocation is
applied across the _K_ consecutive slots and the PUSCH is limited to a single
transmission layer. The UE shall repeat the TB across the _K_ consecutive
slots applying the same symbol allocation in each slot. The redundancy version
to be applied on the _n_ th transmission occasion of the TB, where n = 0, 1,
... _K_ -1, is determined according to table 6.1.2.1-2.
Table 6.1.2.1-2: Redundancy version for PUSCH transmission
_rv~id\ ~_ indicated by the DCI scheduling the PUSCH _rv~id~_ to be applied to
_n_ ^th^ transmission occasion (repetition Type A) or _n_ ^th^ actual
repetition (repetition Type B)
* * *
                                                        *n* mod 4 = 0                                                                                                                  *n* mod 4 = 1   *n* mod 4 = 2   *n* mod 4 = 3
0 0 2 3 1 2 2 3 1 0 3 3 1 0 2 1 1 0 2 3
When transmitting MsgA PUSCH on a non-initial UL BWP, if the UE is configured
with _startSymbolAndLengthMsgA-PO_ , the UE shall determine the _S_ and _L_
from _startSymbolAndLengthMsgA-PO_.
When transmitting MsgA PUSCH, if the UE is not configured with
_startSymbolAndLengthMsgA-PO_ , and if the TDRA list _PUSCH-
TimeDomainResourceAllocationList_ is provided in _PUSCH-ConfigCommon_ , the UE
shall use _msgA-PUSCH-TimeDomainAllocation_ to indicate which values are used
in the list. If _PUSCH-TimeDomainResourceAllocationList_ is not provided in
_PUSCH-ConfigCommon_ , the UE shall use parameters _S_ and _L_ from table
6.1.2.1.1-2 or table 6.1.2.1.1-3 where _msgA-PUSCH-TimeDomainAllocation_
indicates which values are used in the list. The time offset for PUSCH
transmission is described in [6, TS38.213].
For PUSCH repetition Type A, a PUSCH transmission in a slot of a multi-slot
PUSCH transmission is omitted according to the conditions in Clause 9, Clause
11.1, Clause 11.2A and Clause 15 of [6, TS38.213].
For PUSCH repetition Type B, except for PUSCH transmitting CSI report(s) with
no transport block, the number of nominal repetitions is given by
_numberOfRepetitions_. For the _n_ -th nominal repetition, _n_ = _0_ , ...,
_numberOfRepetitions_ \- 1,
\- The slot where the nominal repetition starts is given by , and the starting
symbol relative to the start of the slot is given by .
\- The slot where the nominal repetition ends is given by , and the ending
symbol relative to the start of the slot is given by .
Here is the slot where the PUSCH transmission starts, and is the number of
symbols per slot as defined in Clause 4.3.2 of [4, TS38.211].
For PUSCH repetition Type B, the UE determines invalid symbol(s) for PUSCH
repetition Type B transmission as follows:
\- A symbol that is indicated as downlink by _tdd-UL-DL-ConfigurationCommon_
or _tdd-UL-DL-ConfigurationDedicated_ is considered as an invalid symbol for
PUSCH repetition Type B transmission.
\- For operation in unpaired spectrum, symbols indicated by _ssb-
PositionsInBurst_ in SIB1 or _ssb-PositionsInBurst_ in
_ServingCellConfigCommon_ for reception of SS/PBCH blocks are considered as
invalid symbols for PUSCH repetition Type B transmission.
\- For operation in unpaired spectrum, symbol(s) indicated by _pdcch-
ConfigSIB1_ in _MIB_ for a CORESET for Type0-PDCCH CSS set are considered as
invalid symbol(s) for PUSCH repetition Type B transmission.
\- For operation in unpaired spectrum, if _numberOfInvalidSymbolsForDL-UL-
Switching_ is configured, _numberOfInvalidSymbolsForDL-UL-Switching_ symbol(s)
after the last symbol that is indicated as downlink in each consecutive set of
all symbols that are indicated as downlink by _tdd-UL-DL-ConfigurationCommon_
or _tdd-UL-DL-ConfigurationDedicated_ are considered as invalid symbol(s) for
PUSCH repetition Type B transmission. The symbol(s) given by
_numberOfInvalidSymbolsForDL-UL-Switching_ are defined using the reference SCS
configuration _referenceSubcarrierSpacing_ provided in _tdd-UL-DL-
ConfigurationCommon_.
\- The UE may be configured with the higher layer parameter
_invalidSymbolPattern_ , which provides a symbol level bitmap spanning one or
two slots (higher layer parameter _symbols_ given by _invalidSymbolPattern_).
A bit value equal to 1 in the symbol level bitmap _symbols_ indicates that the
corresponding symbol is an invalid symbol for PUSCH repetition Type B
transmission. The UE may be additionally configured with a time-domain pattern
(higher layer parameter _periodicityAndPattern_ given by
_invalidSymbolPattern_), where each bit of _periodicityAndPattern_ corresponds
to a unit equal to a duration of the symbol level bitmap _symbols_ , and a bit
value equal to 1 indicates that the symbol level bitmap _symbols_ is present
in the unit. The _periodicityAndPattern_ can be {1, 2, 4, 5, 8, 10, 20 or 40}
units long, but maximum of 40 msec. The first symbol of
_periodicityAndPattern_ every 40 msec/P periods is a first symbol in frame 𝑛𝑓
mod 4 = 0, where P is the duration of _periodicityAndPattern-r16_ in units of
msec. When _periodicityAndPattern_ is not configured, for a symbol level
bitmap spanning two slots, the bits of the first and second slots correspond
respectively to even and odd slots of a radio frame, and for a symbol level
bitmap spanning one slot, the bits of the slot correspond to every slot of a
radio frame. If _invalidSymbolPattern_ is configured, when the UE applies the
invalid symbol pattern is determined as follows:
\- if the PUSCH is scheduled by DCI format 0_1, or corresponds to a Type 2
configured grant activated by DCI format 0_1, and if
_invalidSymbolPatternIndicatorDCI-0-1_ is configured,
\- if invalid symbol pattern indicator field is set 1, the UE applies the
invalid symbol pattern;
\- otherwise, the UE does not apply the invalid symbol pattern;
\- if the PUSCH is scheduled by DCI format 0_2, or corresponds to a Type 2
configured grant activated by DCI format 0_2, and if
_invalidSymbolPatternIndicatorDCI-0-2_ is configured,
\- if invalid symbol pattern indicator field is set 1, the UE applies the
invalid symbol pattern;
\- otherwise, the UE does not apply the invalid symbol pattern;
\- otherwise, the UE applies the invalid symbol pattern.
\- If the UE
\- is configured with multiple serving cells within a cell group and is
provided with _directionalCollisionHandling-r16_ = \'enabled\' for a set of
serving cell(s) among the multiple serving cells, and
\- indicates support of _half-DuplexTDD-CA-SameSCS-r16_ capability, and
\- is not configured to monitor PDCCH for detection of DCI format 2-0 on any
of the multiple serving cells,
\- a symbol indicated to the UE for reception of SS/PBCH blocks in a first
cell of the multiple serving cells by _ssb-PositionsInBurst_ in _SIB1_ or
_ssb-PositionsInBurst_ in _ServingCellConfigCommon is considered as an invalid
symbol for PUSCH repetition Type B transmission in_
\- any of the multiple serving cells if the UE is not capable of simultaneous
transmission and reception as indicated by _simultaneousRxTxInterBandCA_ among
the multiple serving cells, and
\- any one of the cells corresponding to the same band as the first cell,
irrespective of any capability indicated by _simultaneousRxTxInterBandCA_
and
\- a symbol is considered as an invalid symbol in another cell among the set
of serving cell(s) provided with **_directionalCollisionHandling-r16_** for
PUSCH repetition Type B transmission with Type 1 or Type 2 configured grant
except for the first Type 2 PUSCH transmission (including all repetitions)
after activation if the symbol is indicated as downlink by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ on the reference
cell as defined in Clause 11.1 of [6, TS 38.213], or the UE is configured by
higher layers to receive PDCCH, PDSCH, or CSI-RS on the reference cell in the
symbol.
For PUSCH repetition Type B, after determining the invalid symbol(s) for PUSCH
repetition type B transmission for each of the _K_ nominal repetitions, the
remaining symbols are considered as potentially valid symbols for PUSCH
repetition Type B transmission. If the number of potentially valid symbols for
PUSCH repetition type B transmission is greater than zero for a nominal
repetition, the nominal repetition consists of one or more actual repetitions,
where each actual repetition consists of a consecutive set of all potentially
valid symbols that can be used for PUSCH repetition Type B transmission within
a slot. An actual repetition with a single symbol is omitted except for the
case of _L_ =1. An actual repetition is omitted according to the conditions in
Clause 9, Clause 11.1, Clause 11.2A and Clause 15 of [6, TS38.213]. The UE
shall repeat the TB across actual repetitions. The redundancy version to be
applied on the _n_ th actual repetition (with the counting including the
actual repetitions that are omitted) is determined according to table
6.1.2.1-2.
For PUSCH repetition Type B, when a UE receives a DCI that schedules aperiodic
CSI report(s) or activates semi-persistent CSI report(s) on PUSCH with no
transport block by a \'_CSI request\'_ field on a DCI, the number of nominal
repetitions is always assumed to be 1, regardless of the value of
_numberOfRepetitions_. When the UE is scheduled to transmit a PUSCH repetition
Type B with no transport block and with aperiodic or semi-persistent CSI
report(s) by a \'_CSI request\'_ field on a DCI, the first nominal repetition
is expected to be the same as the first actual repetition. For PUSCH
repetition Type B carrying semi-persistent CSI report(s) without a
corresponding PDCCH after being activated on PUSCH by a \'_CSI request\'_
field on a DCI, if the first nominal repetition is not the same as the first
actual repetition, the first nominal repetition is omitted; otherwise, the
first nominal repetition is omitted according to the conditions in Clause 9,
Clause 11.1, Clause 11.2A and Clause 15 of [6, TS38.213].
For PUSCH repetition Type B, when a UE is scheduled to transmit a transport
block and aperiodic CSI report(s) on PUSCH by a \'_CSI request\'_ field on a
DCI, the CSI report(s) is multiplexed only on the first actual repetition. The
UE does not expect that the first actual repetition has a single symbol
duration.
If _pusch-TimeDomainAllocationListForMultiPUSCH_ in _pusch-Config_ contains
row indicating resource allocation for two to eight contiguous PUSCHs, _K~2~_
indicates the slot where UE shall transmit the first PUSCH of the multiple
PUSCHs. **Each PUSCH has a separate SLIV and mapping type. The number of
scheduled PUSCHs is signalled by the number of indicated valid SLIVs in the
row of the** _pusch-TimeDomainAllocationListForMultiPUSCH_ **signalled in DCI
format 0_1.**
When the UE is configured with _minimumSchedulingOffsetK2_ in an active UL BWP
it applies a minimum scheduling offset restriction indicated by the \'_Minimum
applicable scheduling offset indicator_ \' field in DCI format 0_1 or DCI
format 1_1 if the same field is available. When the UE is configured with
_minimumSchedulingOffsetK2_ in an active UL BWP and it has not received
\'_Minimum applicable scheduling offset indicator_ \' field in DCI format 0_1
or 1_1, the UE shall apply a minimum scheduling offset restriction indicated
based on \'_Minimum applicable scheduling offset indicator_ \' value \'0\'.
When the minimum scheduling offset restriction is applied the UE is not
expected to be scheduled with a DCI in slot _n_ to transmit a PUSCH scheduled
with C-RNTI, CS-RNTI, MCS-C-RNTI or SP-CSI-RNTI with _K_ ~2~ smaller than
$\left\lceil K_{2min} \cdot \frac{2^{\mu^{'}}}{2^{\mu}} \right\rceil$, where
_K_ ~2min~ and $\mu$ are the applied minimum scheduling offset restriction and
the numerology of the active UL BWP of the scheduled cell when receiving the
DCI in slot _n_ , respectively, and $\mu^{'}$ is the numerology of the new
active UL BWP in case of active UL BWP change in the scheduled cell and is
equal to $\mu$, otherwise. The minimum scheduling offset restriction is not
applied when PUSCH transmission is scheduled by RAR UL grant or fallbackRAR UL
grant for RACH procedure, or when PUSCH is scheduled with TC-RNTI. The
application delay of the change of the minimum scheduling offset restriction
is determined in Clause 5.3.1.
##### 6.1.2.1.1 Determination of the resource allocation table to be used for
PUSCH
Table 6.1.2.1.1-1, Table 6.1.2.1.1-1A and Table 6.1.2.1.1-1B define which
PUSCH time domain resource allocation configuration to apply.
Table 6.1.2.1.1-4 defines the subcarrier spacing specific values _j_. _j_ is
used in determination of _K~2~_ in conjunction to table 6.1.2.1.1-2, for
normal CP or table 6.1.2.1.1.-3 for extended CP, where $µ_{\text{PUSCH}}$ is
the subcarrier spacing configurations for PUSCH.
Table 6.1.2.1.1-5 defines the additional subcarrier spacing specific slot
delay value for the first transmission of PUSCH scheduled by the RAR or by the
fallbackRAR. When the UE transmits a PUSCH scheduled by RAR or by the
fallbackRAR, the _Δ_ value specific to the PUSCH subcarrier spacing _µ~PUSCH~_
is applied in addition to the _K~2~_ value.
Table 6.1.2.1.1-1: Applicable PUSCH time domain resource allocation for common
search space and DCI format 0_0 in UE specific search space
+-------------+-------------+-------------+-------------+-------------+ | RNTI | PDCCH | _pusch-Co |_ pu | PUSCH time | | | search | nfigCommon _| sch-Config_ | domain | | | space | includes | includes | resource | | | | _pusch-Tim |_ pusch-Tim | allocation | | | | eDomainAllo | eDomainAllo | to apply | | | | cationList _| cationList_ | | +=============+=============+=============+=============+=============+ | PUSCH | No | - | Default A | | | scheduled | | | | | | by MAC RAR | | | | | | as | | | | | | described | | | | | | in clause | | | | | | 8.2 of [6, | | | | | | TS 38.213] | | | | | | or MAC | | | | | | fallbackRAR | | | | | | as | | | | | | described | | | | | | in clause | | | | | | 8.2A of | | | | | | [6, | | | | | | 38.213] or | | | | | | for MsgA | | | | | | PUSCH | | | | | | t | | | | | | ransmission | | | | | +-------------+-------------+-------------+-------------+-------------+ | | Yes | | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pusch-Co | | | | | | nfigCommon_ | | +-------------+-------------+-------------+-------------+-------------+ | C-RNTI, | Any common | No | - | Default A | | MCS-C-RNTI, | search | | | | | TC-RNTI, | space | | | | | CS-RNTI | associated | | | | | | with | | | | | | CORESET 0 | | | | +-------------+-------------+-------------+-------------+-------------+ | | | Yes | | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pusch-Co | | | | | | nfigCommon_ | +-------------+-------------+-------------+-------------+-------------+ | C-RNTI, | Any common | No | No | Default A | | MCS-C-RNTI, | search | | | | | TC-RNTI, | space not | | | | | CS-RNTI | associated | | | | | | with | | | | | | CORESET 0, | | | | | | | | | | | | DCI format | | | | | | 0_0 in | | | | | | | | | | | | UE specific | | | | | | search | | | | | | space | | | | +-------------+-------------+-------------+-------------+-------------+ | | | Yes | No | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pusch-Co | | | | | | nfigCommon_ | +-------------+-------------+-------------+-------------+-------------+ | | | No/Yes | Yes | _pusch-Tim | | | | | | eDomainAllo | | | | | | cationList_ | | | | | | provided in | | | | | | _pu | | | | | | sch-Config_ | +-------------+-------------+-------------+-------------+-------------+
Table 6.1.2.1.1-1A: Applicable PUSCH time domain resource allocation for DCI
format 0_1 in UE specific search space scrambled with C-RNTI, MCS-C-RNTI, CS-
RNTI or SP-CSI-RNTI
_pusch-ConfigCommon_ includes _pusch-TimeDomainAllocationList_ _pusch-Config_
includes _pusch-TimeDomainAllocationList_ _pusch-Config_ includes _pusch-
TimeDomainAllocationListDCI-0-1_ _pusch-Config_ includes _pusch-
TimeDomainAllocationListForMultiPUSCH_ PUSCH time domain resource allocation
to apply
* * *
No No No No Default A Yes No No No _pusch-TimeDomainAllocationList_ provided
in _pusch-ConfigCommon_ No/Yes Yes No No _pusch-TimeDomainAllocationList_
provided in _pusch-Config_ No/Yes No Yes - _pusch-
TimeDomainAllocationListDCI-0-1_ provided in _pusch-Config_ No/Yes No - Yes
_pusch-TimeDomainAllocationListForMultiPUSCH_ provided in _pusch-Config_
Table 6.1.2.1.1-1B: Applicable PUSCH time domain resource allocation for DCI
format 0_2 in UE specific search space scrambled with C-RNTI, MCS-C-RNTI, CS-
RNTI or SP-CSI-RNTI
_pusch-ConfigCommon_ includes _pusch-TimeDomainAllocationList_ _pusch-Config_
includes _pusch-TimeDomainAllocationList_ _pusch-Config_ includes _pusch-
TimeDomainAllocationListDCI-0-2_ PUSCH time domain resource allocation to
apply
* * *
No No No Default A Yes No No _pusch-TimeDomainAllocationList_ provided in
_pusch-ConfigCommon_ No/Yes Yes No _pusch-TimeDomainAllocationList_ provided
in _pusch-Config_ No/Yes No Yes _pusch-TimeDomainAllocationListDCI-0-2_
provided in _pusch-Config_
Table 6.1.2.1.1-2: Default PUSCH time domain resource allocation A for normal
CP
Row index PUSCH mapping type _K~2~_ _S_ _L_
* * *
1 Type A _j_ 0 14 2 Type A _j_ 0 12 3 Type A _j_ 0 10 4 Type B _j_ 2 10 5 Type
B _j_ 4 10 6 Type B _j_ 4 8 7 Type B _j_ 4 6 8 Type A _j_ +1 0 14 9 Type A _j_
+1 0 12 10 Type A _j_ +1 0 10 11 Type A _j_ +2 0 14 12 Type A _j_ +2 0 12 13
Type A _j_ +2 0 10 14 Type B _j_ 8 6 15 Type A _j_ +3 0 14 16 Type A _j_ +3 0
10
Table 6.1.2.1.1-3: Default PUSCH time domain resource allocation A for
extended CP
Row index PUSCH mapping type _K~2~_ _S_ _L_
* * *
1 Type A _j_ 0 8 2 Type A _j_ 0 12 3 Type A _j_ 0 10 4 Type B _j_ 2 10 5 Type
B _j_ 4 4 6 Type B _j_ 4 8 7 Type B _j_ 4 6 8 Type A _j_ +1 0 8 9 Type A _j_
+1 0 12 10 Type A _j_ +1 0 10 11 Type A _j_ +2 0 6 12 Type A _j_ +2 0 12 13
Type A _j_ +2 0 10 14 Type B _j_ 8 4 15 Type A _j_ +3 0 8 16 Type A _j_ +3 0
10
Table 6.1.2.1.1-4: Definition of value _j_
_µ~PUSCH~_ _j_
* * *
0 1 1 1 2 2 3 3
Table 6.1.2.1.1-5: Definition of value _Δ_
_µ~PUSCH~_ _Δ_
* * *
0 2 1 3 2 4 3 6
#### 6.1.2.2 Resource allocation in frequency domain
The UE shall determine the resource block assignment in frequency domain using
the resource allocation field in the detected PDCCH DCI except for a PUSCH
transmission scheduled by a RAR UL grant or fallbackRAR UL grant, in which
case the frequency domain resource allocation is determined according to
clause 8.3 of [6, 38.213] or a MsgA PUSCH transmission with frequency domain
resource allocation determined according to clause 8.1A of [6, 38.213]. Three
uplink resource allocation schemes type 0, type 1 and type 2 are supported.
Uplink resource allocation scheme type 0 is supported for PUSCH only when
transform precoding is disabled. Uplink resource allocation scheme type 1 and
type 2 are supported for PUSCH for both cases when transform precoding is
enabled or disabled.
If the scheduling DCI is configured to indicate the uplink resource allocation
type as part of the \'_Frequency domain resource\'_ assignment field by
setting a higher layer parameter r _esourceAllocation_ in _pusch-Config_ to
\'dynamicSwitch\', for DCI format 0_1 or setting a higher layer parameter
_resourceAllocationDCI-0-2_ in _pusch-Config_ to \'dynamicSwitch\' for DCI
format 0_2, the UE shall use uplink resource allocation type 0 or type 1 as
defined by this DCI field. Otherwise the UE shall use the uplink frequency
resource allocation type as defined by the higher layer parameter
_resourceAllocation_ for DCI format 0_1 or the higher layer parameter
_resourceAllocationDCI-0-2_ for DCI format 0_2. The UE shall assume that when
the scheduling PDCCH is received with DCI format 0_1 and _useInterlacePUCCH-
PUSCH in BWP-UplinkDedicated is configured_ , uplink type 2 resource
allocation is used.
The UE shall assume that when the scheduling PDCCH is received with DCI format
0_0, then uplink resource allocation type 1 is used, except when any of the
higher layer parameters _useInterlacePUCCH-PUSCH in BWP-UplinkCommon and
useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is configured_ in which case
uplink resource allocation type 2 is used.
The UE expects that either none or both of _useInterlacePUCCH-PUSCH in BWP-
UplinkCommon and useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is
configured_.
If a bandwidth part indicator field is not configured in the scheduling DCI or
the UE does not support active bandwidth part change via DCI, the RB indexing
for uplink type 0, type 1 and type 2 resource allocation is determined within
the UE\'s active bandwidth part. If a bandwidth part indicator field is
configured in the scheduling DCI and the UE supports active bandwidh part
change via DCI, the RB indexing for uplink type 0, type 1, type 2 resource
allocation is determined within the UE\'s bandwidth part indicated by
bandwidth part indicator field value in the DCI. The UE shall upon detection
of PDCCH intended for the UE determine first the uplink bandwidth part and
then the resource allocation within the bandwidth part. RB numbering starts
from the lowest RB in the determined uplink bandwidth part.
##### 6.1.2.2.1 Uplink resource allocation type 0
In uplink resource allocation of type 0, the resource block assignment
information includes a bitmap indicating the Resource Block Groups (RBGs) that
are allocated to the scheduled UE where a RBG is a set of consecutive virtual
resource blocks defined by higher layer parameter _rbg-Size_ configured in
_pusch-Config_ and the size of the bandwidth part as defined in Table
6.1.2.2.1-1.
Table 6.1.2.2.1-1: Nominal RBG size _P_
Bandwidth Part Size Configuration 1 Configuration 2
* * *
1 -- 36 _2_ 4 37 -- 72 4 8 73 -- 144 8 16 145 -- 275 16 16
The total number of RBGs () for a uplink bandwidth part _i_ of sizePRBs is
given by where
\- the size of the first RBG is ,
\- the size of the last RBG is if and _P_ otherwise.
\- the size of all other RBG is _P_.
The bitmap is of size bits with one bitmap bit per RBG such that each RBG is
addressable. The RBGs shall be indexed in the order of increasing frequency of
the bandwidth part and starting at the lowest frequency. The order of RBG
bitmap is such that RBG 0 to RBG are mapped from MSB to LSB of the bitmap. The
RBG is allocated to the UE if the corresponding bit value in the bitmap is 1,
the RBG is not allocated to the UE otherwise.
In frequency range 1, only \'almost contiguous allocation\' defined in [8, TS
38.101-1] is allowed as non-contiguous allocation per component carrier for UL
RB allocation for CP-OFDM.
In frequency range 2, non-contiguous allocation per component carrier for UL
RB allocation for CP-OFDM is not supported.
##### 6.1.2.2.2 Uplink resource allocation type 1
In uplink resource allocation of type 1, the resource block assignment
information indicates to a scheduled UE a set of contiguously allocated non-
interleaved virtual resource blocks within the active bandwidth part of size
PRBs except for the case when DCI format 0_0 is decoded in any common search
space in which case the size of the initial UL bandwidth part shall be used.
An uplink type 1 resource allocation field consists of a resource indication
value (_RIV_) corresponding to a starting virtual resource block () and a
length in terms of contiguously allocated resource blocks. The resource
indication value is defined by
if then
else
where≥ 1 and shall not exceed.
When the DCI size for DCI format 0_0 in USS is derived from the initial UL BWP
with size but applied to another active BWP with size of , an uplink type 1
resource block assignment field consists of a resource indication value
(_RIV_) corresponding to a starting resource block and a length in terms of
virtually contiguously allocated resource blocks .
The resource indication value is defined by
if then
else
where, and where shall not exceed .
If , _K_ is the maximum value from set {1, 2, 4, 8} which satisfies ;
otherwise _K_ = 1.
When the scheduling grant is received with DCI format 0_2, an uplink type 1
resource allocation field consists of a resource indication value (_RIV_)
corresponding to a starting resource block group _RBG~start~_ =0, 1, ...,
_N~RBG~_ -1 and a length in terms of virtually contiguously allocated resource
block groups _L~RBGs~_ =1, ..., _N~RBG~_ , where the resource block groups are
defined as in 6.1.2.2.1 with _P_ defined by
_resourceAllocationType1GranularityDCI-0-2_ if the UE is configured with
higher layer parameter _resourceAllocationType1GranularityDCI-0-2_ , and _P=1
otherwise._ The resource indication value is defined by
if then
else
where≥ 1 and shall not exceed .
##### 6.1.2.2.3 Uplink resource allocation type 2
In uplink resource allocation of type 2, the resource block assignment
information defined in [5, TS 38.212] indicates to a UE a set of up to _M_
interlace indices, and for DCI 0_0 monitored in a UE-specific search space and
DCI 0_1 a set of up to $\ N_{\text{RB}\text{-}set,UL}^{\text{BWP}}$ contiguous
RB sets, where _M_ and interlace indexing are defined in Clause 4.4.4.6 in [4,
TS 38.211]. Within the active UL BWP, the assigned physical resource block $n$
is mapped to virtual resource block $\text{n.}$ For DCI 0_0 monitored in a UE-
specific search space and DCI 0_1, the UE shall determine the resource
allocation in frequency domain as an intersection of the resource blocks of
the indicated interlaces and the union of the indicated set of RB sets and
intra-cell guard bands defined in Clause 7 between the indicated RB sets, if
any. For DCI 0_0 monitored in a common search space, the UE shall determine
the resource allocation in frequency domain as an intersection of the resource
blocks of the indicated interlaces and a single uplink RB set of the active UL
BWP. For DCI 0_0 monitored in a CSS with CRC scrambled by an RNTI other than
TC-RNTI, the uplink RB set is the lowest indexed one amongst uplink RB set(s)
that intersects the lowest-indexed CCE of the PDCCH in which the UE detects
the DCI 0_0 in the active downlink BWP. If there is no intersection, the
uplink RB set is RB set 0 in the active uplink BWP. For DCI 0_0 with CRC
scrambled by TC-RNTI, the uplink RB set is the same one in which the UE
transmits the PRACH associated with the RAR UL grant, in which case the UE
assumes that the uplink RB set is defined as when the UE is not configured
with _intraCellGuardBandsUL-List_ (see Clause 7).
For µ=0, the X=6 MSBs of the resource block assignment information indicates
to a UE a set of allocated interlace indices $m_{0} + l$, where the indication
consists of a resource indication value (_RIV_). For $0 \leq RIV  1,_ the UE shall repeat the TB across the _K_ consecutive slots applying
the same symbol allocation in each slot, except if the UE is provided with
higher layer parameters _cg-nrofSlots_ and _cg-nrofPUSCH-InSlot_ , in which
case the UE repeats the TB in the _repK_ earliest consecutive transmission
occasion candidates within the same configuration. A Type 1 or Type 2 PUSCH
transmission with a configured grant in a slot is omitted according to the
conditions in Clause 9, Clause 11.1, Clause 11.2A and Clause 15 of [6,
TS38.213].
6.1.2.3.2 Transport Block repetition for uplink transmissions of PUSCH
repetition Type B with a configured grant
The procedures described in this Clause apply to PUSCH transmissions of PUSCH
repetition type B with a Type 1 or Type 2 configured grant.
For PUSCH transmissions with a Type 1 or Type 2 configured grant, the nominal
repetitions and the actual repetitions are determined according to the
procedures for PUSCH repetition Type B defined in Clause 6.1.2.1. The higher
layer configured parameters _repK-RV_ defines the redundancy version pattern
to be applied to the repetitions. If the parameter _repK-RV_ is not provided
in the _configuredGrantConfig_ , the redundancy version for each actual
repetition with a configured grant shall be set to 0. Otherwise, for the _n_
th transmission occasion among all the actual repetitions (including the
actual repetitions that are omitted) of the _K_ nominal repetitions, it is
associated with _(mod(n-1,4)+1)^th^_ value in the configured RV sequence. If a
configured grant configuration is configured with _startingFromRV0_ set to
_\'off\'_ , the initial transmission of a transport block may only start at
the first transmission occasion of the actual repetitions. Otherwise, the
initial transmission of a transport block may start at
\- the first transmission occasion of the actual repetitions if the configured
RV sequence is {0,2,3,1},
\- any of the transmission occasions of the actual repetitions that are
associated with RV=0 if the configured RV sequence is {0,3,0,3},
\- any of the transmission occasions of the actual repetitions if the
configured RV sequence is {0,0,0,0}, except the actual repetitions within the
last nominal repetition when _K≥8_.
For any RV sequence, the repetitions shall be terminated after transmitting K
nominal repetitions, or at the last transmission occasion among the _K_
nominal repetitions within the period _P_ , or from the starting symbol of an
actual repetition that overlaps with a PUSCH with the same HARQ process
scheduled by DCI format 0_0, 0_1 or 0_2, whichever is reached first. The UE is
not expected to be configured with the time duration for the transmission of
_K_ nominal repetitions larger than the time duration derived by the
periodicity _P_.
### 6.1.3 UE procedure for applying transform precoding on PUSCH
For a PUSCH scheduled by RAR UL grant, or for a PUSCH scheduled by fallbackRAR
UL grant, or for a PUSCH scheduled by DCI format 0_0 with CRC scrambled by TC-
RNTI, the UE shall consider the transform precoding either \'enabled\' or
\'disabled\' according to the higher layer configured parameter
_msg3-transformPrecoder._
For a MsgA PUSCH, the UE shall consider the transform precoding either
\'enabled\' or \'disabled\' according to the higher layer configured parameter
_msgA-TransformPrecoder. If higher layer parameter msgA-TransformPrecoder is
not configured,_ the UE shall consider the transform precoding either
\'enabled\' or \'disabled\' according to the higher layer configured parameter
_msg3-transformPrecoder._
For PUSCH transmission scheduled by a PDCCH with CRC scrambled by CS-RNTI with
NDI=1, C-RNTI, or MCS-C-RNTI or SP-CSI-RNTI:
\- If the DCI with the scheduling grant was received with DCI format 0_0, the
UE shall, for this PUSCH transmission, consider the transform precoding either
enabled or disabled according to the higher layer configured parameter
_msg3-transformPrecoder_.
\- If the DCI with the scheduling grant was not received with DCI format 0_0
\- If the UE is configured with the higher layer parameter _transformPrecoder
in pusch-Config_ , the UE shall, for this PUSCH transmission, consider the
transform precoding either enabled or disabled according to this parameter.
\- If the UE is not configured with the higher layer parameter
_transformPrecoder in pusch-Config_ , the UE shall, for this PUSCH
transmission, consider the transform precoding either enabled or disabled
according to the higher layer configured parameter _msg3-transformPrecoder_.
For PUSCH transmission with a configured grant
\- If the UE is configured with the higher layer parameter _transformPrecoder
in configuredGrantConfig_ , the UE shall, for this PUSCH transmission,
consider the transform precoding either enabled or disabled according to this
parameter.
\- If the UE is not configured with the higher layer parameter
_transformPrecoder in configuredGrantConfig_ , the UE shall, for this PUSCH
transmission, consider the transform precoding either enabled or disabled
according to the higher layer configured parameter _msg3-transformPrecoder_.
### 6.1.4 Modulation order, redundancy version and transport block size
determination
To determine the modulation order, target code rate, redundancy version and
transport block size for the physical uplink shared channel, the UE shall
first
\- read the 5-bit modulation and coding scheme field in the DCI scheduling
PUSCH or provided in a DCI activating a configured grant Type 2 PUSCH, or as
provided by _mcsAndTBS_ as described in Clause 6.1.2.3 for a configured grant
Type 1 PUSCH to determine the modulation order and target code rate (_R_)
based on the procedure defined in Clause 6.1.4.1
\- read redundancy version field (_rv_) in the DCI to determine the redundancy
version for PUSCH scheduled by DCI, or determine the redundancy version
according to Clause 6.1.2.3.1 for configured grant Type 1 and Type 2 PUSCH,
and second
\- use the number of layers , the total number of allocated PRBs to determine
the transport block size based on the procedure defined in Clause 6.1.4.2.
When the UE is scheduled with multiple PUSCHs by a DCI, as described in clause
6.1.2.1, the bits of _rv_ field and NDI field, respectively, in the DCI are
one to one mapped to the scheduled PUSCH(s) with the corresponding transport
block(s) in the scheduled order where the LSB bits of the _rv_ field and NDI
field, respectively, correspond to the last scheduled PUSCH.
Within a cell group, a UE is not required to handle PUSCH(s) transmissions in
slot _s~j~_ in serving cell-_j_ , and for _j_ = 0,1,2.. _J-1_ , slot _s~j~_
overlapping with any given point in time, if the following condition is not
satisfied at that point in time:
$\sum_{j = 0}^{J - 1}\frac{\sum_{m = 0}^{M -
1}V_{j,m}}{T_{\text{slot}}^{\mu(j)}} \leq \text{DataRate}$,
where
_\- J_ is the number of configured serving cells belong to a frequency range
\- for the _j-th_ serving cell,
_\- M_ is the number of TB(s) transmitted in slot-_s~j~_. For PUSCH repetition
Type B, each actual repetition is counted separately.
_\- T~slot~^μ(j)^_ =10^-3^/2^_μ(j_)^, where _μ(j)_ is the numerology for
PUSCH(s) in slot _s~j~_ of the _j_ -th serving cell.
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
_\- A_ is the number of bits in the transport block as defined in Clause 6.2.1
[5, TS 38.212]
_\- C_ _is the total number of code blocks for the transport block_ defined in
Clause 5.2.2 [5, TS 38.212].$\ $
\- $C'$is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5,38.212]
\- $\text{DataRate}$ [Mbps] is computed as the maximum data rate summed over
all the carriers in the frequency range for any signaled band combination and
feature set consistent with the configured servings cells, where the data rate
value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including
the scaling factor _f(i)._
For a _j_ -th serving cell, if higher layer parameter _processingType2Enabled_
of _PUSCH-ServingCellConfig_ is configured for the serving cell and set to
\'_enable\',_ or if at least one _I~MCS~ > W_ for [ ]{.underline} a PUSCH,
where _W_ = 28 for MCS tables 5.1.3.1-1 and 5.1.3.1-3, and _W_ = 27 for MCS
tables 5.1.3.1-2, 6.1.4.1-1, and 6.1.4.1-2, or if it is an actual repetition
for PUSCH repetition Type B, the UE is not required to handle PUSCH
transmissions, if the following condition is not satisfied:
$$\frac{\sum_{m = 0}^{M - 1}V_{j,m}}{L \times T_{s}^{\mu}} \leq
\text{DataRateCC}$$
_where_
\- $\text{L\ }$is the number of symbols assigned to the PUSCH
\- _M_ is the number of TB in the PUSCH
\- $T_{s}^{\mu} = \frac{10^{- 3}}{{2^{\mu} \bullet
N}_{\text{symb}}^{\text{slot}}}$ where μ is the numerology of the PUSCH
\- for the _m_ -th TB, $V_{j,m} = C' \bullet \left\lfloor \frac{A}{C}
\right\rfloor$
\- _A_ is the number of bits in the transport block as defined in Clause 6.2.1
[5, TS 38.212]
\- _C_ is the total number of code blocks for the transport block defined in
Clause 5.2.2 [5, TS 38.212]
\- $C'$ is the number of scheduled code blocks for the transport block as
defined in Clause 5.4.2.1 [5, TS 38.212]
\- $\text{DataRateCC}$ [Mbps] is computed as the maximum data rate for a
carrier in the frequency band of the serving cell for any signaled band
combination and feature set consistent with the serving cell, where the data
rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306],
including the scaling factor _f(i)_
\- _each actual repetition for PUSCH repetition type B is treated as one
PUSCH._
#### 6.1.4.1 Modulation order and target code rate determination
For a PUSCH scheduled by RAR UL grant or
for a PUSCH scheduled by a fallbackRAR UL grant or
for a MsgA PUSCH transmission, or
for a PUSCH scheduled by a DCI format 0_0 with CRC scrambled by C-RNTI, MCS-C-
RNTI, TC-RNTI, CS-RNTI, or
for a PUSCH scheduled by a DCI format 0_1 or DCI format 0_2 with CRC scrambled
by C-RNTI, MCS-C-RNTI, CS-RNTI, SP-CSI-RNTI, or
for a PUSCH with configured grant using CS-RNTI, and
if transform precoding is disabled for this PUSCH transmission according to
Clause 6.1.3
\- if _mcs-TableDCI-0-2_ in _pusch-Config_ is set to \'qam256\', and PUSCH is
scheduled by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-
CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel;
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-TableDCI-0-2_ in
_pusch-Config_ is set to \'qam64LowSE\', and the PUSCH is scheduled by a PDCCH
by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-CSI-RNTI,
> \- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif _mcs-Table_ in _pusch-Config_ is set to \'qam256\', and PUSCH is
scheduled by a PDCCH with DCI format 0_1 with CRC scrambled by C-RNTI or SP-
CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-Table_ in _pusch-
Config_ is set to \'qam64LowSE\', and the PUSCH is scheduled by a PDCCH with a
DCI format other than DCI format 0_2 in a UE-specific search space with CRC
scrambled by C-RNTI or SP-CSI-RNTI,
> \- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif the UE is configured with MCS-C-RNTI, and the PUSCH is scheduled by
a PDCCH with CRC scrambled by MCS-C-RNTI,
> \- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif _mcs-Table_ in _configuredGrantConfig_ is set to \'qam256\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif _mcs-Table_ in _configuredGrantConfig_ is set to \'qam64LowSE\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-3 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif for a MsgA PUSCH transmission,
\- the UE shall use higher layer parameter _msgA-MCS_ for _I~MCS~_ and Table
5.1.3.1-1 to determine the Target code rate (_R_) used in the physical uplink
shared channel.
\- else
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-1 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
else
\- if _mcs-TableTransformPrecoderDCI-0-2_ in _pusch-Config_ is set to
\'qam256\', and PUSCH is scheduled by a PDCCH with DCI format 0_2 with CRC
scrambled by C-RNTI or SP-CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1.-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-
TableTransformPrecoderDCI-0-2_ in _pusch-Config_ is set to \'qam64LowSE\', and
the PUSCH is scheduled by a PDCCH with DCI format 0_2 with CRC scrambled by
C-RNTI or SP-CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif _mcs-TableTransformPrecoder_ in _pusch-Config_ is set to \'qam256\',
and PUSCH is scheduled by a PDCCH with DCI format 0_1 with CRC scrambled by
C-RNTI or SP-CSI-RNTI,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1.-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif the UE is not configured with MCS-C-RNTI, _mcs-
TableTransformPrecoder_ in _pusch-Config_ is set to \'qam64LowSE\', and the
PUSCH is scheduled by a PDCCH with a DCI format other than DCI format 0_2 in a
UE-specific search space with CRC scrambled by C-RNTI or SP-CSI-RNTI,
> \- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif the UE is configured with MCS-C-RNTI, and the PUSCH is scheduled by
a PDCCH with CRC scrambled by MCS-C-RNTI,
> \- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
> order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
> channel.
\- elseif _mcs-TableTransformPrecoder_ in _configuredGrantConfig_ is set to
\'qam256\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant,
\- the UE shall use _I~MCS~_ and Table 5.1.3.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif _mcs-TableTransformPrecoder_ in _configuredGrantConfig_ is set to
\'qam64LowSE\',
\- if PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or
\- if PUSCH is transmitted with configured grant,
\- the UE shall use _I~MCS~_ and Table 6.1.4.1-2 to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
\- elseif for a MsgA PUSCH transmission,
\- the UE shall use higher layer parameter _MsgA-MCS_ for _I~MCS~_ and Table
6.1.4.1-1 to determine the Target code rate (_R_) used in the physical uplink
shared channel.
\- the UE shall use _q=2_ for determining modulation order _Q~m~_ in Table
6.1.4.1-1.
> \- else
\- the UE shall use _I~MCS~_ and Table 6.1.4.1-1to determine the modulation
order (_Q~m~_) and Target code rate (_R_) used in the physical uplink shared
channel.
end
For Table 6.1.4.1-1 and Table 6.1.4.1-2, if higher layer parameter _tp-
pi2BPSK_ is configured, _q_ = 1 otherwise _q_ =2.
Table 6.1.4.1-1: MCS index table for PUSCH with transform precoding and 64QAM
+--------------+----------------+----------------+----------------+ | **MCS Index\ |** Modulation | **Target code |** Spectral**| |**_I~MCS~_ | Order\ | Rate R**x | | | | **_Q~m~_ | 1024**\ | **efficiency** | | | | ** | | +==============+================+================+================+ | **0** | q | 240/ q | 0.2344 | +--------------+----------------+----------------+----------------+ | **1** | q | 314/ q | 0.3066 | +--------------+----------------+----------------+----------------+ | **2** | 2 | 193 | 0.3770 | +--------------+----------------+----------------+----------------+ | **3** | 2 | 251 | 0.4902 | +--------------+----------------+----------------+----------------+ | **4** | 2 | 308 | 0.6016 | +--------------+----------------+----------------+----------------+ | **5** | 2 | 379 | 0.7402 | +--------------+----------------+----------------+----------------+ | **6** | 2 | 449 | 0.8770 | +--------------+----------------+----------------+----------------+ | **7** | 2 | 526 | 1.0273 | +--------------+----------------+----------------+----------------+ | **8** | 2 | 602 | 1.1758 | +--------------+----------------+----------------+----------------+ | **9** | 2 | 679 | 1.3262 | +--------------+----------------+----------------+----------------+ | **10** | ~~4~~ | 340 | 1.3281 | +--------------+----------------+----------------+----------------+ | **11** | 4 | 378 | 1.4766 | +--------------+----------------+----------------+----------------+ | **12** | 4 | 434 | 1.6953 | +--------------+----------------+----------------+----------------+ | **13** | 4 | 490 | 1.9141 | +--------------+----------------+----------------+----------------+ | **14** | 4 | 553 | 2.1602 | +--------------+----------------+----------------+----------------+ | **15** | 4 | 616 | 2.4063 | +--------------+----------------+----------------+----------------+ | **16** | 4 | 658 | 2.5703 | +--------------+----------------+----------------+----------------+ | **17** | 6 | 466 | 2.7305 | +--------------+----------------+----------------+----------------+ | **18** | 6 | 517 | 3.0293 | +--------------+----------------+----------------+----------------+ | **19** | 6 | 567 | 3.3223 | +--------------+----------------+----------------+----------------+ | **20** | 6 | 616 | 3.6094 | +--------------+----------------+----------------+----------------+ | **21** | 6 | 666 | 3.9023 | +--------------+----------------+----------------+----------------+ | **22** | 6 | 719 | 4.2129 | +--------------+----------------+----------------+----------------+ | **23** | 6 | 772 | 4.5234 | +--------------+----------------+----------------+----------------+ | **24** | 6 | 822 | 4.8164 | +--------------+----------------+----------------+----------------+ | **25** | 6 | 873 | 5.1152 | +--------------+----------------+----------------+----------------+ | **26** | 6 | 910 | 5.3320 | +--------------+----------------+----------------+----------------+ | **27** | 6 | 948 | 5.5547 | +--------------+----------------+----------------+----------------+ | **28** | q | reserved | | +--------------+----------------+----------------+----------------+ | **29** | 2 | reserved | | +--------------+----------------+----------------+----------------+ | **30** | 4 | reserved | | +--------------+----------------+----------------+----------------+ | **31** | 6 | reserved | | +--------------+----------------+----------------+----------------+
Table 6.1.4.1-2: MCS index table 2 for PUSCH with transform precoding and
64QAM
+--------------+----------------+----------------+----------------+ | **MCS Index\ |** Modulation | **Target code |** Spectral**| |**_I~MCS~_ | Order\ | Rate R**x | | | | **_Q~m~_ | 1024**\ | **efficiency** | | | | ** | | +==============+================+================+================+ | **0** | _q_ | 60/_q_ | 0.0586 | +--------------+----------------+----------------+----------------+ | **1** | _q_ | 80/_q_ | 0.0781 | +--------------+----------------+----------------+----------------+ | **2** | _q_ | 100/_q_ | 0.0977 | +--------------+----------------+----------------+----------------+ | **3** | _q_ | 128/_q_ | 0.1250 | +--------------+----------------+----------------+----------------+ | **4** | _q_ | 156/_q_ | 0.1523 | +--------------+----------------+----------------+----------------+ | **5** | _q_ | 198/_q_ | 0.1934 | +--------------+----------------+----------------+----------------+ | **6** | 2 | 120 | 0.2344 | +--------------+----------------+----------------+----------------+ | **7** | 2 | 157 | 0.3066 | +--------------+----------------+----------------+----------------+ | **8** | 2 | 193 | 0.3770 | +--------------+----------------+----------------+----------------+ | **9** | 2 | 251 | 0.4902 | +--------------+----------------+----------------+----------------+ | **10** | 2 | 308 | 0.6016 | +--------------+----------------+----------------+----------------+ | **11** | 2 | 379 | 0.7402 | +--------------+----------------+----------------+----------------+ | **12** | 2 | 449 | 0.8770 | +--------------+----------------+----------------+----------------+ | **13** | 2 | 526 | 1.0273 | +--------------+----------------+----------------+----------------+ | **14** | 2 | 602 | 1.1758 | +--------------+----------------+----------------+----------------+ | **15** | 2 | 679 | 1.3262 | +--------------+----------------+----------------+----------------+ | **16** | 4 | 378 | 1.4766 | +--------------+----------------+----------------+----------------+ | **17** | 4 | 434 | 1.6953 | +--------------+----------------+----------------+----------------+ | **18** | 4 | 490 | 1.9141 | +--------------+----------------+----------------+----------------+ | **19** | 4 | 553 | 2.1602 | +--------------+----------------+----------------+----------------+ | **20** | 4 | 616 | 2.4063 | +--------------+----------------+----------------+----------------+ | **21** | 4 | 658 | 2.5703 | +--------------+----------------+----------------+----------------+ | **22** | 4 | 699 | 2.7305 | +--------------+----------------+----------------+----------------+ | **23** | 4 | 772 | 3.0156 | +--------------+----------------+----------------+----------------+ | **24** | 6 | 567 | 3.3223 | +--------------+----------------+----------------+----------------+ | **25** | 6 | 616 | 3.6094 | +--------------+----------------+----------------+----------------+ | **26** | 6 | 666 | 3.9023 | +--------------+----------------+----------------+----------------+ | **27** | 6 | 772 | 4.5234 | +--------------+----------------+----------------+----------------+ | **28** | q | reserved | | +--------------+----------------+----------------+----------------+ | **29** | 2 | reserved | | +--------------+----------------+----------------+----------------+ | **30** | 4 | reserved | | +--------------+----------------+----------------+----------------+ | **31** | 6 | reserved | | +--------------+----------------+----------------+----------------+
#### 6.1.4.2 Transport block size determination
For a PUSCH scheduled by RAR UL grant or
for a PUSCH scheduled by fallbackRAR UL grant or
for a PUSCH scheduled by a DCI format 0_0 with CRC scrambled by C-RNTI, MCS-C-
RNTI, TC-RNTI, CS-RNTI, or
for a PUSCH scheduled by a DCI format 0_1 or DCI format 0_2 with CRC scrambled
by C-RNTI, MCS-C-RNTI, CS-RNTI, or
for a PUSCH transmission with configured grant, or
for a MsgA PUSCH transmission,
if
\- and transform precoding is disabled and Table 5.1.3.1-2 is used, or
\- and transform precoding is disabled and a table other than Table 5.1.3.1-2
is used, or
\- and transform precoding is enabled, the UE shall first determine the TBS as
specified below:
> The UE shall first determine the number of REs (_N~RE~_) within the slot:
\- A UE first determines the number of REs allocated for PUSCH within a PRB by
\- , where is the number of subcarriers in the frequency domain in a physical
resource block, $N_{\text{symb}}^{\text{slot}}$is the number of symbols _L_ of
the PUSCH allocation according to Clause 6.1.2.1 for scheduled PUSCH or Clause
6.1.2.3 for configured PUSCH, is the number of REs for DM-RS per PRB in the
allocated duration including the overhead of the DM-RS CDM groups without
data, as described for PUSCH with a configured grant in Clause 6.1.2.3 or as
indicated by DCI format 0_1 or DCI format 0_2 or as described for DCI format
0_0 in Clause 6.2.2, and is the overhead configured by higher layer parameter
_xOverhead in_ _PUSCH-ServingCellConfig_. If the is not configured (a value
from 6, 12, or 18), the is assumed to be 0. For Msg3 or MsgA PUSCH
transmission the is always set to 0. In case of PUSCH repetition Type B, is
determined assuming a nominal repetition with the duration of _L_ symbols
without segmentation.
\- A UE determines the total number of REs allocated for PUSCH by where is the
total number of allocated PRBs for the UE.
\- Next, proceed with steps 2-4 as defined in Clause 5.1.3.2
\- For a PUSCH scheduled by fallbackRAR UL grant, UE assumes the TB size
determined by the UL grant in the fallbackRAR shall be the same as the TB size
used in the corresponding MsgA PUSCH transmission.
else if
\- and transform precoding is disabled and Table 5.1.3.1-2 is used, or
\- and transform precoding is enabled,
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using . If there is no PDCCH for the
same transport block using , and if the initial PUSCH for the same transport
block is scheduled by a RAR UL grant, the TBS shall be determined from the RAR
UL grant. If there is no PDCCH for the same transport block using , and if the
initial PUSCH for the same transport block is transmitted with configured
grant,
\- the TBS shall be determined from _configuredGrantConfig_ for a configured
grant Type 1 PUSCH.
\- the TBS shall be determined from the most recent PDCCH scheduling a
configured grant Type 2 PUSCH.
> else
\- the TBS is assumed to be as determined from the DCI transported in the
latest PDCCH for the same transport block using . If there is no PDCCH for the
same transport block using , and if the initial PUSCH for the same transport
block is scheduled by a RAR UL grant, the TBS shall be determined from the RAR
UL grant. If there is no PDCCH for the same transport block using , and if the
initial PUSCH for the same transport block is transmitted with configured
grant,
\- the TBS shall be determined from _configuredGrantConfig_ for a configured
grant Type 1 PUSCH.
\- the TBS shall be determined from the most recent PDCCH scheduling a
configured grant Type 2 PUSCH.
### 6.1.5 Code block group based PUSCH transmission
#### 6.1.5.1 UE procedure for grouping of code blocks to code block groups
If a UE is configured to transmit code block group (CBG) based transmissions
by receiving the higher layer parameter _codeBlockGroupTransmission_ in
_PUSCH-ServingCellConfig_ , the UE shall determine the number of CBGs for a
PUSCH transmission as
,
where _N_ is the maximum number of CBGs per transport block as configured by
_maxCodeBlockGroupsPerTransportBlock_ in _PUSCH-ServingCellConfig_ , and _C_
is the number of code blocks in the PUSCH according to the procedure defined
in Clause 6.2.3 of [5, TS 38.212].
Define , , and .
If , CBG _m_ , , consists of code blocks with indices . CBG _m_ , , consists
of code blocks with indices .
#### 6.1.5.2 UE procedure for transmitting code block group based
transmissions
If a UE is configured to transmit code block group-based transmissions by
receiving the higher layer parameter _codeBlockGroupTransmission_ in _PUSCH-
ServingCellConfig_ ,
\- For an initial transmission of a TB as indicated by the \'_New Data
Indicator\'_ field of the scheduling DCI, the UE may expect that the _CBGTI_
field indicates all the CBGs of the TB are to be transmitted, and the UE shall
include all the code block groups of the TB.
\- For a retransmission of a TB as indicated by the \'_New Data Indicator\'_
field of the scheduling DCI, the UE shall include only the CBGs indicated by
the _CBGTI_ field of the scheduling DCI.
A bit value of \'0\' in the _CBGTI_ field indicates that the corresponding CBG
is not to be transmitted and \'1\' indicates that it is to be transmitted. The
order of _CBGTI_ field bits is such that the CBGs are mapped in order from
CBG#0 onwards starting from the MSB.
### 6.1.6 Uplink switching
The UE may omit uplink transmission during the uplink switching gap
$N_{\text{Tx1-Tx2}}$ if the conditions defined in this clause are met and the
UE is configured with _uplinkTxSwitching_. The switching gap
$N_{\text{Tx1-Tx2}}$ is indicated by UE capability _uplinkTxSwitchingPeriod_ :
\- If a UE indicated a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ for a band combination, and if it is for that band combination
\- Configured with a MCG using E-UTRA radio access and with a SCG using NR
radio access (EN-DC), or
\- Configured with uplink carrier aggregation, or
\- Configured in a serving cell with two uplink carriers with higher layer
parameter _supplementaryUplink_.
The conditions under which the switching gap may be present are defined for
each of the cases in clauses 6.1.6.1, 6.1.6.2, and 6.1.6.3 respectively.
If an uplink switching is triggered for an uplink transmission starting at
_T~0~_ , after _T~0~-T~offset~_ , the UE is not expected to cancel the uplink
switching, or to trigger any other new uplink switching occurring before
_T~0~_ for any other uplink transmission that is scheduled after
_T~0~-T~offset~_ , where _T~offset~_ is the UE processing procedure time
defined for the uplink transmission triggering the switch given in clause 5.3,
clause 5.4, clause 6.2.1, clause 6.4 and in clause 9 of [6, TS 38.213].
The UE does not expect to perform more than one uplink switching in a slot
with _µ~UL\ ~_ = max(_µ~UL,\ 1,~ µ~UL,\ 2~_), where the _µ~UL,\ 1~_
corresponds to the subcarrier spacing of the active UL BWP of one uplink
carrier before the switching gap and the _µ~UL,\ 2~_ corresponds to the
subcarrier spacing of the active UL BWP of the other uplink carrier after the
switching gap.
#### 6.1.6.1 Uplink switching for EN-DC
For a UE indicating a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ for a band combination, and if it is for that band combination
configured with a MCG using E-UTRA radio access and with a SCG using NR radio
access (EN-DC), if the UE is configured with uplink switching with parameter
_uplinkTxSwitching_ ,
\- for the UE configured with _switchedUL_ by the parameter
_uplinkTxSwitchingOption_ , when the UE is to transmit in the uplink based on
DCI(s) received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s):
\- when the UE is to transmit an NR uplink that takes place after an E-UTRA
uplink on another uplink carrier then the UE is not expected to transmit for
the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- when the UE is to transmit an E-UTRA uplink that takes place after an NR
uplink on another uplink carrier then the UE is not expected to transmit for
the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
_\- t_ he UE is not expected to transmit simultaneously on the NR uplink and
the E-UTRA uplink. I _f the UE is scheduled or configured to transmit any NR
uplink transmission overlapping with an_ E-UTRA _uplink transmission, the NR
uplink transmission is dropped,_
\- for the UE configured with _uplinkTxSwitchingOption_ set to \'dualUL\'_,_
when the UE is to transmit in the uplink based on DCI(s) received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s):
\- when the UE is to transmit an NR two-port uplink that takes place after an
E-UTRA uplink on another uplink carrier then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- when the UE is to transmit an E-UTRA uplink that takes place after an NR
two-port uplink on another uplink carrier then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
_\- t_ he UE is not expected to transmit simultaneously a two- port
transmission on the NR uplink and the E-UTRA uplink.
\- in all other cases the UE is expected to transmit normally all uplink
transmissions without interruptions.
\- when the UE is configured with _tdm-PatternConfig_ or by _tdm-
PatternConfig2_
\- for the E-UTRA subframes designated as uplink by the configuration, the UE
assumes the operation state in which one-port E-UTRA uplink can be
transmitted.
\- for the E-UTRA subframes other than the ones designated as uplink by the
configuration, the UE assumes the operation state in which two-port NR uplink
can be transmitted.
#### 6.1.6.2 Uplink switching for carrier aggregation
For a UE indicating a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ for a band combination, and if it is for that band combination
configured with uplink carrier aggregation:
\- If the UE is configured with uplink switching with parameter
_uplinkTxSwitching_ , when the UE is to transmit in the uplink based on DCI(s)
received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s):
\- When the UE is to transmit a 2-port transmission on one uplink carrier and
if the preceding uplink transmission is a 1-port transmission on another
uplink carrier, then the UE is not expected to transmit for the duration of
$N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- When the UE is to transmit a 1-port transmission on one uplink carrier and
if the preceding uplink transmission is a 2-port transmission on another
uplink carrier, then the UE is not expected to transmit for the duration of
$N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- For the UE configured with _uplinkTxSwitchingOption_ set to
\'_switchedUL\'_ , when the UE is to transmit a 1-port transmission on one
uplink carrier and if the preceding uplink transmission was a 1-port
transmission on another uplink carrier, then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- For the UE configured with _uplinkTxSwitchingOption_ set to \'_dualUL\'_ ,
when the UE is to transmit a 2-port transmission on one uplink carrier and if
the preceding uplink transmission was a 1-port transmission on the same uplink
carrier and the UE is under the operation state in which 2-port transmission
cannot be supported in the same uplink carrier, then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- For the UE configured with _uplinkTxSwitchingOption_ set to \'_dualUL\'_ ,
when the UE is to transmit a 1-port transmission on one uplink carrier and if
the preceding uplink transmission was a 1-port transmission on another uplink
carrier and the UE is under the operation state in which 2-port transmission
can be supported on the same uplink carrier, then the UE is not expected to
transmit for the duration of $N_{\text{Tx1-Tx2}}$ on any of the two carriers.
\- The UE is not expected to be scheduled or configured with uplink
transmissions that result in simultaneous transmission on two antenna ports on
one uplink carrier, and any transmission on another uplink carrier.
\- In all other cases the UE is expected to transmit normally all uplink
transmissions without interruptions.
#### 6.1.6.3 Uplink switching for supplementary uplink
For a UE indicating a capability for uplink switching with _BandCombination-
UplinkTxSwitch_ for a band combination, and if it is for that band combination
configured in a serving cell with two uplink carriers with higher layer
parameter _supplementaryUplink_ :
\- If the UE is configured with uplink switching with parameter
_uplinkTxSwitching_ ,
\- If the UE is to transmit any uplink channel or signal on a different uplink
from the preceding transmission occasion based on DCI(s) received before
$\mathbf{T}_{\text{0}}\mathbf{-}\mathbf{T}_{\mathbf{\text{offset}}}$ or based
on a higher layer configuration(s), then the UE assumes that an uplink
switching is triggered in a duration of switching gap
$\mathbf{N}_{\text{Tx1-Tx2}}$, where $\mathbf{T}_{\text{0}}$ is the start time
of the first symbol of the transmission occasion of the uplink channel or
signal and $\mathbf{T}_{\mathbf{\text{offset}}}$ is the preparation procedure
time of the transmission occasion of the uplink channel or signal given in
clause 5.3, clause 5.4, clause 6.2.1, clause 6.4 and in clause 9 of [6, TS
38.213], respectively. During the switching gap $\mathbf{N}_{\text{Tx1-Tx2}}$,
the UE is not expected to transmit on any of the two uplinks.
\- In all other cases the UE is expected to transmit normally all uplink
transmissions without interruptions.
## 6.2 UE reference signal (RS) procedure
### 6.2.1 UE sounding procedure
The UE may be configured with one or more Sounding Reference Signal (SRS)
resource sets as configured by the higher layer parameter _SRS-ResourceSet_ or
_SRS-PosResourceSet_. For each SRS resource set configured by _SRS-
ResourceSet_ , a UE may be configured with SRS resources (higher layer
parameter _SRS-Resource_), where the maximum value of K is indicated by UE
capability [13, 38.306]. When SRS resource set is configured with the higher
layer parameter _SRS-PosResourceSet,_ a UE may be configured with _K_ ≥1 SRS
resources (higher layer parameter _SRS-PosResource_), where the maximum value
of K is 16. The SRS resource set applicability is configured by the higher
layer parameter _usage_ in _SRS-ResourceSet._ When the higher layer parameter
_usage_ is set to \'beamManagement\'_,_ only one SRS resource in each of
multiple SRS resource sets may be transmitted at a given time instant, but the
SRS resources in different SRS resource sets with the same time domain
behaviour in the same BWP may be transmitted simultaneously.
For the SRS resource set(s) configured _in srs-ResourceSetToAddModListDCI-0-2_
with higher layer parameter _usage_ set to \'_antennaSwitching_ \' or
\'_beamManagement_ \', the UE expects the same SRS resource set(s) with the
same _usage_ being configured in _srs-ResourceSetToAddModList._
For aperiodic SRS at least one state of the DCI field is used to select at
least one out of the configured SRS resource set(s).
The following SRS parameters are semi-statically configurable by higher layer
parameter _SRS-Resource_ or _SRS-PosResource_.
_\- srs-ResourceId_ or _SRS-PosResourceId determines SRS resource
configuration identity._
_-_ Number of SRS ports, as defined by the higher layer parameter _nrofSRS-
Ports_ and described in Clause 6.4.1.4 of [4, TS 38.211]. If not configured,
_nrofSRS-Ports_ is 1.
_-_ Time domain behaviour of SRS resource configuration as indicated by the
higher layer parameter _resourceType_ , which may be periodic, semi-
persistent, aperiodic SRS transmission as defined in Clause 6.4.1.4 of [4, TS
38.211].
\- Slot level periodicity and slot level offset as defined by the higher layer
parameters _periodicityAndOffset-p_ or _periodicityAndOffset-sp_ for an SRS
resource of type periodic or semi-persistent. The UE is not expected to be
configured with SRS resources in the same SRS resource set _SRS-ResourceSet_
or _SRS-PosResourceSet_ with different slot level periodicities. For an _SRS-
ResourceSet_ configured with higher layer parameter _resourceType_ set to
\'aperiodic\', a slot level offset is defined by the higher layer parameter
_slotOffset._ For an _SRS-PosResourceSet configured w_ ith higher layer
parameter r _esourceType_ set to \'aperiodic\', the slot level offset is
defined by the higher layer parameter _slotOffset for each S_ RS resource.
\- Number of OFDM symbols in the SRS resource, starting OFDM symbol of the SRS
resource within a slot including repetition factor R as defined by the higher
layer parameter _resourceMapping_ and described in Clause 6.4.1.4 of [4, TS
38.211]. If _R_ is not configured, then _R_ is equal to the number of OFDM
symbols in the SRS resource.
\- SRS bandwidth and , as defined by the higher layer parameter _freqHopping_
and described in Clause 6.4.1.4 of [4, TS 38.211]. If not configured, then= 0.
\- Frequency hopping bandwidth , as defined by the higher layer parameter
_freqHopping_ and described in Clause 6.4.1.4 of [4, TS 38.211]. If not
configured, then = 0.
\- Defining frequency domain position and configurable shift, as defined by
the higher layer parameters _freqDomainPosition_ and _freqDomainShift,
respectively,_ and described in Clause 6.4.1.4 of [4, TS 38.211]. If
_freqDomainPosition_ is not configured, _freqDomainPosition_ is zero.
\- Cyclic shift, as defined by the higher layer parameter _cyclicShift-n2_ ,
_cyclicShift-n4, or cyclicShift-n8_ for transmission comb value 2, 4 or 8, and
described in Clause 6.4.1.4 of [4, TS 38.211].
\- Transmission comb value, as defined by the higher layer parameter
_transmissionComb_ described in Clause 6.4.1.4 of [4, TS 38.211].
\- Transmission comb offset, as defined by the higher layer parameter
_combOffset-n2_ , _combOffset-n4,_ and _combOffset-n8_ for transmission comb
value 2, 4, or 8, and described in Clause 6.4.1.4 of [4, TS 38.211].
\- SRS sequence ID, as defined by the higher layer parameter _sequenceId_ in
Clause 6.4.1.4 of [4].
\- The configuration of the spatial relation between a reference RS and the
target SRS, where the higher layer parameter _spatialRelationInfo_ or
_spatialRelationInfoPos_ , if configured, contains the ID of the reference RS.
The reference RS may be an SS/PBCH block, CSI-RS configured on serving cell
indicated by higher layer parameter _servingCellId_ if present, same serving
cell as the target SRS otherwise, or an SRS configured on uplink BWP indicated
by the higher layer parameter _uplinkBWP_ , and serving cell indicated by the
higher layer parameter _servingCellId_ if present, same serving cell as the
target SRS otherwise. When the target SRS is configured by the higher layer
parameter _SRS-PosResourceSet,_ the reference RS may also be a DL PRS
configured on a serving cell or a non-serving cell indicated by the higher
layer parameter _dl-PRS_ , or an SS/PBCH block of a non-serving cell indicated
by the higher layer parameter _ssb-Ncell_.
The UE may be configured by the higher layer parameter _resourceMapping_ in
_SRS-Resource_ with an SRS resource occupying adjacent OFDM symbols within the
last 6 symbols of the slot, or at any symbol location within the slot if
_resourceMapping-r16_ is provided subject to UE capability, where all antenna
ports of the SRS resources are mapped to each symbol of the resource. When the
SRS is configured with the higher layer parameter _SRS-PosResourceSet_ the
higher layer parameter _resourceMapping-r16_ in _SRS-PosResource_ indicates an
SRS resource occupying $N_{S} \in \left{ 1,2,4,8,12 \right}$ adjacent symbols
anywhere within the slot.
If a PUSCH with a priority index 0 and SRS configured by _SRS-Resource_ are
transmitted in the same slot on a serving cell, the UE may only be configured
to transmit SRS after the transmission of the PUSCH and the corresponding DM-
RS.
If a PUSCH transmission with a priority index 1 or a PUCCH transmission with a
priority index 1 would overlap in time with an SRS transmission on a serving
cell, the UE does not transmit the SRS in the overlapping symbol(s).
_For a UE configured with one or more SRS resource configuration(s), and when
the higher layer parameter_ _resourceType_ in _SRS-Resource_ or _SRS-
PosResource is set to \'periodic\':_
\- if the UE is configured with the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ containing the ID of a
reference \'ssb-Index\', \'ssb-IndexServing\', or \'ssb-IndexNcell\', the UE
shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference SS/PBCH block, if
the higher layer parameter _spatialRelationInfo_ or _spatialRelationInfoPos_
contains the ID of a reference \'csi-RS-Index\' or \'csi-RS-IndexServing\',
the UE shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference periodic CSI-RS or
of the reference semi-persistent CSI-RS, if the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ containing the ID of a
reference \'srs\' or \'srs-spatialRelation\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
transmission of the reference periodic SRS. When the SRS is configured by the
higher layer parameter _SRS-PosResource_ and if the higher layer parameter
_spatialRelationInfoPos_ contains the ID of a reference \'dl-PRS\', the UE
shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference DL PRS.
_For a UE configured with one or more SRS resource configuration(s), and when
the higher layer parameter resourceType_ in _SRS-Resource_ or _SRS-PosResource
is set to \'semi-persistent\':_
\- when a UE receives an activation command, as described in clause 6.1.3.17
or 6.1.3.36 of [10, TS 38.321], for an SRS resource, and when the UE would
transmit a PUCCH with HARQ-ACK information in slot _n_ corresponding to the
PDSCH carrying the activation command, the corresponding actions in [10, TS
38.321] and the UE assumptions on SRS transmission corresponding to the
configured SRS resource set shall be applied starting from the first slot that
is after slot $n + {3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS
configuration for the PUCCH. The activation command also contains spatial
relation assumptions provided by a list of references to reference signal IDs,
one per element of the activated SRS resource set. When the SRS is configured
with the higher layer parameter _SRS-ResourceSet_ , each ID in the list refers
to a reference SS/PBCH block, NZP CSI-RS resource configured on serving cell
indicated by _Resource Serving Cell ID_ field in the activation command if
present, same serving cell as the SRS resource set otherwise, or SRS resource
configured on serving cell and uplink bandwidth part indicated by Resource
_Serving Cell ID_ field and _Resource BWP ID_ field in the activation command
if present, same serving cell and bandwidth part as the SRS resource set
otherwise. When the SRS is configured with the higher layer parameter _SRS-
PosResourceSet_ , each ID in the list of reference signal IDs may refer to a
reference SS/PBCH block on a serving or non-serving cell indicated by _PCI_
field in the activation command, NZP CSI-RS resource configured on serving
cell indicated by _Resource Serving Cell ID_ field in the activation command
if present, same serving cell as the SRS resource set otherwise, SRS resource
configured on serving cell and uplink bandwidth part indicated by Resource
_Serving Cell ID_ field and _Resource BWP ID_ field in the activation command
if present, same serving cell and bandwidth part as the SRS resource set
otherwise, or DL PRS resource of a serving or non-serving cell associated with
a _dl-PRS-ID_ indicated by _DL-PRS ID_ field in the activation command.
\- if an SRS resource in the activated resource set is configured with the
higher layer parameter _spatialRelationInfo_ or _spatialRelationInfoPos_ , the
UE shall assume that the ID of the reference signal in the activation command
overrides the one configured in _spatialRelationInfo_ or
_spatialRelationInfoPos._
\- when a UE receives a deactivation command [10, TS 38.321] for an activated
SRS resource set, and when the UE would transmit a PUCCH with HARQ-ACK
information in slot _n_ corresponding to the PDSCH carrying the deactivation
command, the corresponding actions in [10, TS 38.321] and UE assumption on
cessation of SRS transmission corresponding to the deactivated SRS resource
set shall apply starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}$ where _μ_ is the SCS configuration for the
PUCCH.
\- if the UE is configured with the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ containing the ID of a
reference \'ssb-Index\', \'ssb-IndexServing\', or \'ssb-IndexNcell\' the UE
shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference SS/PBCH block, if
the higher layer parameter _spatialRelationInfo_ or _spatialRelationInfoPos_
contains the ID of a reference \'csi-RS-Index\' or \'csi-RS-IndexServing\',
the UE shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference periodic CSI-RS or
of the reference semi-persistent CSI-RS, if the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ contains the ID of a
reference \'srs\' or \'srs-SpatialRelation\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
transmission of the reference periodic SRS or of the reference semi-persistent
SRS. When the SRS is configured by the higher layer parameter _SRS-
PosResourceSet_ and if the higher layer parameter _spatialRelationInfoPos_
contains the ID of a reference \'dl-PRS\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
reception of the reference DL PRS.
If the UE has an active semi-persistent SRS resource configuration and has not
received a deactivation command, the semi-persistent SRS configuration is
considered to be active in the UL BWP which is active, otherwise it is
considered suspended.
For a UE configured with one or more SRS resource configuration(s), and when
the higher layer parameter _resourceType_ in _SRS-Resource_ or _SRS-
PosResource_ is set to \'aperiodic\':
\- the UE receives a configuration of SRS resource sets,
\- the UE receives a downlink DCI, a group common DCI, or an uplink DCI based
command where a codepoint of the DCI may trigger one or more SRS resource
set(s). For SRS in a resource set with usage set to \'codebook\' or
\'antennaSwitching\', the minimal time interval between the last symbol of the
PDCCH triggering the aperiodic SRS transmission and the first symbol of SRS
resource is _N~2\ ~_ symbols and an additional time duration _T~switch~_.
Otherwise, the minimal time interval between the last symbol of the PDCCH
triggering the aperiodic SRS transmission and the first symbol of SRS resource
is _N~2~_ +14 symbols and an additional time duration _T~switch~_. The minimal
time interval unit of OFDM symbol is counted based on the minimum subcarrier
spacing given by min(_µ~PDCCH,~ µ~UL~_) where _µ~UL~_ is given by
min(_µ~UL,carrier1,~ µ~UL,carrier2,~ µ~SRS~_) when the UE is configured with
the higher layer parameter _uplinkTxSwitchingOption set to \'dualUL\' for
uplink carrier aggregation_ , _and by µ~SRS\ ~_ otherwise. _µ~SRS~ and
µ~PDCCH\ ~_ are the subcarrier spacing configurations for triggered SRS and
PDCCH carrying the triggering command respectively.
\- _T~switch~_ , _µ~UL,carrier1~ and µ~UL,carrier2~_ are defined in clause
6.4.
\- If the UE receives the DCI triggering aperiodic SRS in slot _n and_ except
when SRS is configured with the higher layer parameter _SRS-PosResource_ , the
UE transmits aperiodic SRS in each of the triggered SRS resource set(s) in
slot , if UE is configured with _ca-SlotOffset_ for at least one of the
triggered and triggering cell, * K~s\ ~*={width="0.9430555555555555in"
height="0.5222222222222223in"}, otherwise, and where
_\- k_ is configured via higher layer parameter _slotOffset_ for each
triggered SRS resources set and is based on the subcarrier spacing of the
triggered SRS transmission, _µ~SRS~_ and _µ~PDCCH~_ are the subcarrier spacing
configurations for triggered SRS and PDCCH carrying the triggering command
respectively;
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}\ $are the $\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH,
$N_{slot,offset,SRS}^{\text{CA}}$ and $\mu_{offset,SRS}$ are the
{width="0.5833333333333334in" height="0.2777777777777778in"} and the
{width="0.3347222222222222in" height="0.21666666666666667in"}, respectively,
which are determined by higher-layer configured _ca-SlotOffset_ for the cell
transmitting the SRS, as defined in [4, TS 38.211] clause 4.5.
\- If the UE receives the DCI triggering aperiodic SRS in slot _n_ and when
SRS is configured with the higher layer parameter _SRS-PosResource_ , the UE
transmits every aperiodic SRS resource in each of the triggered SRS resource
set(s) in slot , if UE is configured with _ca-SlotOffset_ for at least one of
the triggered and triggering cell, _K~s\ ~_ ={width="0.9430555555555555in"
height="0.5222222222222223in"}, otherwise, and where
_\- k_ is configured via higher layer parameter _slotOffset_ for each
aperiodic SRS resource in each triggered SRS resources set and is based on the
subcarrier spacing of the triggered SRS transmission, _µ~SRS~_ and _µ~PDCCH~_
are the subcarrier spacing configurations for triggered SRS and PDCCH carrying
the triggering command respectively;
\- $N_{\text{slot,\ offset,\ }\text{PDCCH}}^{\text{CA}}$ and
$\mu_{\text{offset}\text{,}\text{PDCCH}}\ $are the $\text{\ N}_{\text{slot,\
offset}}^{\text{CA}}$ and the, respectively, which are determined by higher-
layer configured _ca-SlotOffset_ for the cell receiving the PDCCH,
$N_{slot,offset,SRS}^{\text{CA}}$ and $\mu_{offset,SRS}$ are the
{width="0.5833333333333334in" height="0.2777777777777778in"} and the
{width="0.3347222222222222in" height="0.21666666666666667in"}, respectively,
which are determined by higher-layer configured _ca-SlotOffset_ for the cell
transmitting the SRS, as defined in [4, TS 38.211] clause 4.5.
\- if the UE is configured with the higher layer parameter
_spatialRelationInfo_ or _spatialRelationInfoPos_ containing the ID of a
reference \'ssb-Index\', \'ssb-IndexServing\' or \'ssb-IndexNcell\', the UE
shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference SS/PBCH block, if
the higher layer parameter _spatialRelationInfo_ or _spatialRelationInfoPos_
contains the ID of a reference \'csi-RS-Index\' or \'csi-RS-IndexServing\',
the UE shall transmit the target SRS resource with the same spatial domain
transmission filter used for the reception of the reference periodic CSI-RS or
of the reference semi-persistent CSI-RS, or of the latest reference aperiodic
CSI-RS. If the higher layer parameter _spatialRelationInfo_ or
_spatialRelationInfoPos_ contains the ID of a reference \'srs\' or \'srs-
SpatialRelation\', the UE shall transmit the target SRS resource with the same
spatial domain transmission filter used for the transmission of the reference
periodic SRS or of the reference semi-persistent SRS or of the reference
aperiodic SRS. When the SRS is configured by the higher layer parameter _SRS-
PosResourceSet_ and if the higher layer parameter _spatialRelationInfoPos_
contains the ID of a reference \'dl-PRS\', the UE shall transmit the target
SRS resource with the same spatial domain transmission filter used for the
reception of the reference DL PRS.
\- when a UE receives an spatial relation update command, as described in
clause 6.1.3.26 of [10, TS 38.321], for an SRS resource configured with the
higher layer parameter _SRS-Resource_ , and when the HARQ-ACK corresponding to
the PDSCH carrying the update command is transmitted in slot _n_ , the
corresponding actions in [10, TS 38.321] and the UE assumptions on updating
spatial relation for the SRS resource shall be applied for SRS transmission
starting from the first slot that is after slot $n +
{3N}_{\text{slot}}^{subframe,µ}\ $where _μ_ is the SCS configuration for the
PUCCH. The update command contains spatial relation assumptions provided by a
list of references to reference signal IDs, one per element of the updated SRS
resource set. Each ID in the list refers to a reference SS/PBCH block, NZP
CSI-RS resource configured on serving cell indicated by _Resource Serving Cell
ID_ field in the update command if present, same serving cell as the SRS
resource set otherwise, or SRS resource configured on serving cell and uplink
bandwidth part indicated by _Resource_ _Serving Cell ID_ field and _Resource
BWP ID_ field in the update command if present, same serving cell and
bandwidth part as the SRS resource set otherwise. When the UE is configured
with the higher layer parameter _usage_ in _SRS-ResourceSet_ set to
\'antennaSwitching\', the UE shall not expect to be configured with different
spatial relations for SRS resources in the same SRS resource set.
The UE is not expected to be configured with different time domain behavior
for SRS resources in the same SRS resource set. The UE is also not expected to
be configured with different time domain behavior between SRS resource and
associated SRS resources set.
For operation in the same carrier, the UE is not expected to be configured on
overlapping symbols with a SRS resource configured by the higher layer
parameter _SRS-PosResource_ and a SRS resource configured by the higher layer
parameter _SRS-Resource_ with _resourceType_ of both SRS resources as
\'periodic\'.
For operation in the same carrier, the UE is not expected to be activated or
triggered to transmit SRS on overlapping symbols with a SRS resource
configured by the higher layer parameter _SRS-PosResource_ and a SRS resource
configured by the higher layer parameter _SRS-Resource_ with _resourceType_ of
both SRS resources as \'semi-persistent\' or \'aperiodic\'.
For operations in the same carrier, the UE is not expected to be configured on
overlapping symbols with more than one SRS resources configured by the higher
layer parameter _SRS-PosResource_ with _resourceType_ of the SRS resources as
\'periodic\'.
For operations in the same carrier, the UE is not expected to be activated or
triggered to transmit SRS on overlapping symbols with more than one SRS
resources configured by the higher layer parameter _SRS-PosResource_ with
_resourceType_ of the SRS resources as \'semi-persistent\' or \'aperiodic\'.
For intra-band and inter-band CA operations, a UE can simultaneously transmit
more than one SRS resource configured by _SRS-PosResource_ on different CCs,
subject to UE\'s capability
For intra-band and inter-band CA operations, a UE can simultaneously transmit
more than one SRS resource configured by _SRS-PosResource_ and _SRS-Resource_
on different CCs, subject to UE\'s capability.
The SRS request field [5, TS38.212] in DCI format 0_1, 1_1, 0_2 (if SRS
request field is present), 1_2 (if SRS request field is present) indicates the
triggered SRS resource set given in Table 7.3.1.1.2-24 of [5, TS 38.212]. The
2-bit SRS request field [5, TS38.212] in DCI format 2_3 indicates the
triggered SRS resource set given in Clause 7.3 of [5, TS 38.212] and defined
by the entries of the higher layer parameter _srs-ResourceSetToAddModList_ if
the UE is configured with higher layer parameter _srs-TPC-PDCCH-Group_ set to
\'typeB\', or indicates the SRS transmission on a set of serving cells
configured by higher layers if the UE is configured with higher layer
parameter _srs-TPC-PDCCH-Group_ set to \'typeA\'.
For PUCCH and SRS on the same carrier, a UE shall not transmit SRS when semi-
persistent or periodic SRS is configured in the same symbol(s) with PUCCH
carrying only CSI report(s), or only L1-RSRP report(s), or only L1-SINR
report(s). A UE shall not transmit SRS when semi-persistent or periodic SRS is
configured or aperiodic SRS is triggered to be transmitted in the same
symbol(s) with PUCCH carrying HARQ-ACK, link recovery request (as defined in
clause 9.2.4 of [6, 38.213]) and/or SR. In the case that SRS is not
transmitted due to overlap with PUCCH, only the SRS symbol(s) that overlap
with PUCCH symbol(s) are dropped. PUCCH shall not be transmitted when
aperiodic SRS is triggered to be transmitted to overlap in the same symbol
with PUCCH carrying semi-persistent/periodic CSI report(s) or semi-
persistent/periodic L1-RSRP report(s) only, or only L1-SINR report(s).
In case of intra-band carrier aggregation or in inter-band CA band combination
if simultaneous SRS and PUCCH/PUSCH transmissions are not supported by UE, the
UE is not expected to be indicated with a SRS transmission from a carrier and
to be configured or scheduled with a PUSCH/UL DM-RS/UL PT-RS/PUCCH
transmission from a different carrier in the same symbol.
In case of intra-band carrier aggregation or in inter-band CA band combination
if simultaneous SRS and PRACH/MsgA PUSCH transmissions are not supported by
UE, the UE shall not transmit simultaneously SRS resource(s) from a carrier
and PRACH/MsgA PUSCH from a different carrier.
In case a SRS resource with _resourceType_ set as \'aperiodic\' is triggered
on the OFDM symbol(s) configured with periodic/semi-persistent SRS
transmission, the UE shall transmit the aperiodic SRS resource and only the
periodic/semi-persistent SRS symbol(s) overlapping within the symbol(s) are
dropped, while the periodic/semi-persistent SRS symbol(s) that are not
overlapped with the aperiodic SRS resource are transmitted. In case a SRS
resource with _resourceType_ set as \'semi-persistent\' is triggered on the
OFDM symbol(s) configured with periodic SRS transmission, the UE shall
transmit the semi-persistent SRS resource and only the periodic SRS symbol(s)
overlapping within the symbol(s) are dropped, while the periodic SRS symbol(s)
that are not overlapped with the semi-persistent SRS resource are transmitted.
When the UE is configured with the higher layer parameter _usage_ in _SRS-
ResourceSet_ set to \'antennaSwitching\', and a guard period of Y symbols is
configured according to Clause 6.2.1.2, the UE shall use the same priority
rules as defined above during the guard period as if SRS was configured.
When a _spatialRelationInfo_ is activated/updated for a semi-persistent or
aperiodic SRS resource configured by the higher layer parameter _SRS-Resource_
by a MAC CE for a set of CCs/BWPs, where the applicable list of CCs provided
by higher layer parameter _simultaneousSpatial-UpdatedList1_ or
_simultaneousSpatial-UpdatedList2_ is determined by the indicated CC in the
MAC CE, the _spatialRelationInfo_ is applied for the semi-persistent or
aperiodic SRS resource(s) with the same SRS resource ID for all the BWPs in
the determined CCs.
When the higher layer parameter _enableDefaultBeamPL-ForSRS_ is set
\'enabled\', and if the higher layer parameter _spatialRelationInfo_ for the
SRS resource, except for the SRS resource with the higher layer parameter
_usage_ in SRS-ResourceSet set to \'beamManagement\' or for the SRS resource
with the higher layer parameter _usage_ in SRS-ResourceSet set to
\'nonCodebook\' with configuration of _associatedCSI-RS_ or for the SRS
resource configured by the higher layer parameter _SRS-PosResourceSet_ , is
not configured in FR2 and if the UE is not configured with higher layer
parameter(s) _pathlossReferenceRS_ , and if the UE is not configured with
different values of _coresetPoolIndex_ in _ControlResourceSets_ , and is not
provided at least one TCI codepoint mapped with two TCI states, the UE shall
transmit the target SRS resource in an active UL BWP of a CC,
\- according to the spatial relation, if applicable, with a reference to the
RS configured with _qcl-Type_ set to \'typeD\' corresponding to the QCL
assumption of the CORESET with the lowest _controlResourceSetId_ in the active
DL BWP in the CC.
\- according to the spatial relation, if applicable, with a reference to the
RS configured with _qcl-Type_ set to \'typeD\' in the activated TCI state with
the lowest ID applicable to PDSCH in the active DL BWP of the CC if the UE is
not configured with any CORESET in the active DL BWP of the CC
#### 6.2.1.1 UE SRS frequency hopping procedure
For a given SRS resource, the UE is configured with repetition factor
R∈{1,2,4} by higher layer parameter _resourceMapping_ in _SRS-Resource_ where
_R_ ≤ _N~s~_. When frequency hopping within an SRS resource in each slot is
not configured (_R=N~s~_), each of the antenna ports of the SRS resource in
each slot is mapped in all the symbols to the same set of subcarriers in the
same set of PRBs. When frequency hopping within an SRS resource in each slot
is configured without repetition (_R=1_), according to the SRS hopping
parameters , and defined in Clause 6.4.1.4 of [4, TS 38.211], each of the
antenna ports of the SRS resource in each slot is mapped to different sets of
subcarriers in each OFDM symbol, where the same transmission comb value is
assumed for different sets of subcarriers. When both frequency hopping and
repetition within an SRS resource in each slot are configured (_N~s~=4, R=2_),
each of the antenna ports of the SRS resource in each slot is mapped to the
same set of subcarriers within each pair of R adjacent OFDM symbols, and
frequency hopping across the two pairs is according to the SRS hopping
parameters , and .
For operation with shared spectrum channel access, the UE does not expect that
multiple hops of an SRS resource transmission are in different RB sets.
A UE may be configured adjacent symbol aperiodic SRS resource with intra-slot
frequency hopping within a bandwidth part, where the full hopping bandwidth is
sounded with an equal-size subband across symbols when frequency hopping is
configured with _R=1_. A UE may be configured adjacent symbols aperiodic SRS
resource with intra-slot frequency hopping within a bandwidth part, where the
full hopping bandwidth is sounded with an equal-size subband across two pairs
of _R_ adjacent OFDM symbols, when frequency hopping is configured with _R=2_.
Each of the antenna ports of the SRS resource is mapped to the same set of
subcarriers within each pair of R adjacent OFDM symbols of the resource.
A UE may be configured symbol periodic or semi-persistent SRS resource with
inter-slot hopping within a bandwidth part, where the SRS resource occupies
the same symbol location in each slot. A UE may be configured symbol periodic
or semi-persistent SRS resource with intra-slot and inter-slot hopping within
a bandwidth part, where the SRS resource occupies the same symbol location(s)
in each slot. For _N~s~=4_ , when frequency hopping is configured with _R=2_ ,
intra-slot and inter-slot hopping is supported with each of the antenna ports
of the SRS resource mapped to different sets of subcarriers across two pairs
of _R_ adjacent OFDM symbol(s) of the resource in each slot. Each of the
antenna ports of the SRS resource is mapped to the same set of subcarriers
within each pair of _R_ adjacent OFDM symbols of the resource in each slot.
For _N~s~= R_ , when frequency hopping is configured, inter-slot frequency
hopping is supported with each of the antenna ports of the SRS resource mapped
to the same set of subcarriers in _R_ adjacent OFDM symbol(s) of the resource
in each slot.
#### 6.2.1.2 UE sounding procedure for DL CSI acquisition
When the UE is configured with the higher layer parameter _usage_ in _SRS-
ResourceSet_ set as \'antennaSwitching\', the UE may be configured with only
one of the following configurations depending on the indicated UE capability
_supportedSRS-TxPortSwitch_ (\'t1r2\' for 1T2R, _\'t1r1-t1r2\' for
1T=1R/1T2R,_ \'t2r4\' for 2T4R, \'t1r4\' for 1T4R, _\'t1r1-t1r2-t1r4\' for
1T=1R/1T2R/1T4R,_ \'t1r4-t2r4\' for 1T4R/2T4R, _\'t1r1-t1r2-t2r2-t2r4\' for
1T=1R/1T2R/2T=2R/2T4R, \'__t1r1-t1r2_ _-__t2r2-t1r4-t2r4_ _\' for
1T=1R/1T2R/2T=2R/1T4R/2T4R,_ \'t1r1\' for 1T=1R, \'t2r2\' for 2T=2R,
_\'t1r1-t2r2\' for 1T=1R/2T=2R,_ \'t4r4\' for 4T=4R, or _\'t1r1-t2r2-t4r4\'
for 1T=1R/2T=2R/4T=4R_):
_\- For 1T2R, up to two SRS resource sets configured with a different value
for the higher layer parameter resourceType in SRS-ResourceSet set, where each
set has_ two SRS resources transmitted in different symbols, each SRS resource
in a given set consisting of a single SRS port, and the SRS port of the second
resource in the set is associated with a different UE antenna port than the
SRS port of the first resource in the same set, or
_\- For 2T4R, up to two SRS resource sets configured with a different value
for the higher layer parameter resourceType in SRS-ResourceSet set, where each
SRS resource set has_ two SRS resources transmitted in different symbols, each
SRS resource in a given set consisting of two SRS ports, and the SRS port pair
of the second resource is associated with a different UE antenna port pair
than the SRS port pair of the first resource, or
_\- For 1T4R, zero or one SRS resource set configured with higher layer
parameter resourceType in SRS-ResourceSet set to \'periodic\' or \'semi-
persistent\' with four SRS resources transmitted in different symbols, each
SRS resource in a given set consisting of a single SRS port, and the SRS port
of each resource is associated with a different UE antenna port, and_
_\- For 1T4R, zero or two SRS resource sets each configured with higher layer
parameter resourceType in SRS-ResourceSet set to \'aperiodic\' and with a
total of four SRS resources transmitted in different symbols of two different
slots, and where the SRS port of each SRS resource in the given two sets is
associated with a different UE antenna port. The two sets are each configured
with two SRS resources, or one set is configured with one SRS resource and the
other set is configured with three SRS resources. The UE shall expect that the
two sets are both configured with the same values of the higher layer
parameters alpha, p0, pathlossReferenceRS, and srs-
PowerControlAdjustmentStates in SRS-ResourceSet. The UE shall expect that the
value of the higher layer parameter_ _aperiodicSRS-ResourceTrigger_ or the
value of an entry in _AperiodicSRS-ResourceTriggerList_ _in each SRS-
ResourceSet is the same, and the value of the higher layer parameter
slotOffset in each SRS-ResourceSet is different. Or,_
_\- For 1T=1R, or 2T=2R, or 4T=4R, up to two SRS resource sets each with one
SRS resource, where the number of SRS ports for each resource is equal to 1,
2, or 4._
The UE is configured with a guard period of Y symbols, in which the UE does
not transmit any other signal, in the case the SRS resources of a set are
transmitted in the same slot. The guard period is in-between the SRS resources
of the set.
The UE shall expect to be configured with the same number of SRS ports for all
SRS resources in the SRS resource set(s) with higher layer parameter _usage_
set as \'antennaSwitching\'.
For 1T2R, 1T4R or 2T4R, the UE shall not expect to be configured or triggered
with more than one SRS resource set with higher layer parameter _usage_ set as
\'antennaSwitching\' in the same slot. For 1T=1R, 2T=2R or 4T=4R, the UE shall
not expect to be configured or triggered with more than one SRS resource set
with higher layer parameter _usage_ set as \'antennaSwitching\' in the same
symbol.
The value of _Y_ is defined by Table 6.2.1.2-1.
Table 6.2.1.2-1: The minimum guard period between two SRS resources of an SRS
resource set for antenna switching
* * *
            *Y* \[symbol\]
0 15 1 1 30 1 2 60 1 3 120 2
* * *
#### 6.2.1.3 UE sounding procedure between component carriers
A UE can be configured with SRS resource(s) on a carrier _c~1~_ with slot
formats comprised of DL and UL symbols and not configured for PUSCH/PUCCH
transmission. For carrier _c~1~_ , the UE is configured with higher layer
parameter _srs-SwitchFromServCellIndex_ and _srs-SwitchFromCarrier_ the
switching from carrier _c~2~_ which is configured for PUSCH/PUCCH
transmission. During SRS transmission on carrier _c~1\ ~_(including any
interruption due to uplink or downlink RF retuning time [11, TS 38.133] as
defined by higher layer parameters _switchingTimeUL_ and _switchingTimeDL_ of
_SRS-SwitchingTimeNR_), the UE temporarily suspends the uplink transmission on
carrier _c~2~_.
For an SRS transmission starting in symbol $N_{c_{1}}$ of carrier $c_{1}$ and
a conflicting transmission in carrier $c_{2}$ starting in symbol$\ N_{c_{2}}$,
the UE shall apply the prioritization / dropping rules in the remainder of
this clause taking into account:
\- DCI(s) for which the time interval between the last symbol of PDCCH and
$N_{c_{1}}$ is at least$\text{\ N}_{2}\ $_symbols and an additional time
duration_ $T_{\text{SR}S_{\text{CS}}}$_, and the time interval between the
last symbol of PDCCH and_ $N_{c_{2}}$ is at least $\text{\ N}_{2}$ _symbols;
and_
\- semi-persistent CSI reports or SRS considered _active at least_ $N_{2}$
_symbols and an additional time duration_ $T_{\text{SR}S_{\text{CS}}}$
_before_ $N_{c_{1}}$_, and considered active at least_ $N_{2}$ _symbols
before_ $N_{c_{2}}$_._
_where_ $T_{\text{SR}S_{\text{CS}}} = max{ switchingTimeUL,switchingTimeDL}$_,
and t_ he time interval unit of OFDM symbol is counted based on the smaller
subcarrier spacing across $c_{1},\ c_{2}$ and their corresponding scheduling
cells.
For a carrier of a serving cell with slot formats comprised of DL and UL
symbols, not configured for PUSCH/PUCCH transmission, the UE shall not
transmit SRS whenever SRS transmission (including any interruption due to
uplink or downlink RF retuning time [11, TS 38.133] as defined by higher layer
parameters _switchingTimeUL_ and _switchingTimeDL_ of _SRS-SwitchingTimeNR)_
on the carrier of the serving cell and PUSCH/PUCCH transmission carrying HARQ-
ACK/positive SR/RI/CRI/SSBRI and/or PRACH happen to overlap in the same symbol
[ ]{.underline} and that can result in uplink transmissions beyond the UE\'s
indicated uplink carrier aggregation capability included in [13, TS 38.306].
For a carrier of a serving cell with slot formats comprised of DL and UL
symbols, not configured for PUSCH/PUCCH transmission, the UE shall not
transmit a periodic/semi-persistent SRS whenever periodic/semi-persistent SRS
transmission (including any interruption due to uplink or downlink RF retuning
time [11, TS 38.133] as defined by higher layer parameters _switchingTimeUL_
and _switchingTimeDL_ of _SRS-SwitchingTimeNR)_ on the carrier of the serving
cell and PUSCH transmission carrying aperiodic CSI happen to overlap in the
same symbol and that can result in uplink transmissions beyond the UE\'s
indicated uplink carrier aggregation capability included in [13, TS 38.306].
For a carrier of a serving cell with slot formats comprised of DL and UL
symbols, not configured for PUSCH/PUCCH transmission, the UE shall drop
PUCCH/PUSCH transmission carrying periodic/semi-persistent CSI comprising only
CQI/PMI/L1-RSRP/L1-SINR, and/or SRS transmission on another serving cell
configured for PUSCH/PUCCH transmission whenever the transmission and SRS
transmission (including any interruption due to uplink or downlink RF retuning
time [11, TS 38.133] as defined by higher layer parameters _switchingTimeUL_
and _switchingTimeDL_ of _SRS-SwitchingTimeNR)_ on the serving cell happen to
overlap in the same symbol and that can result in uplink transmissions beyond
the UE\'s indicated uplink carrier aggregation capability included in [13, TS
38.306].
For a carrier of a serving cell with slot formats comprised of DL and UL
symbols, not configured for PUSCH/PUCCH transmission, the UE shall drop PUSCH
transmission carrying aperiodic CSI comprising only CQI/PMI/L1-RSRP/L1-SINR
whenever the transmission and aperiodic SRS transmission (including any
interruption due to uplink or downlink RF retuning time [11, TS 38.133]) as
defined by higher layer parameters _switchingTimeUL_ and _switchingTimeDL_ of
_SRS-SwitchingTimeNR)_ on the carrier of the serving cell happen to overlap in
the same symbol and that can result in uplink transmissions beyond the UE\'s
indicated uplink carrier aggregation capability included in [13, TS 38.306].
For an aperiodic SRS triggered in DCI format 2_3 and if the UE is configured
with higher layer parameter _srs-TPC-PDCCH-Group_ set to \'typeA\', and given
by _SRS-CarrierSwitching,_ without PUSCH/PUCCH transmission, the order of the
triggered SRS transmission on the serving cells follow the order of the
serving cells in the indicated set of serving cells configured by higher
layers, where the UE in each serving cell transmits the configured one or two
SRS resource set(s) from _srs-ResourceSetToAddModList_ with higher layer
parameter _usage_ set to \'antennaSwitching\' and higher layer parameter
_resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\'.
For an aperiodic SRS triggered in DCI format 2_3 and if the UE is configured
with higher layer parameter _srs-TPC-PDCCH-Group_ set to \'typeB\' without
PUSCH/PUCCH transmission, the order of the triggered SRS transmission on the
serving cells follow the order of the serving cells with aperiodic SRS
triggered in the DCI, and the UE in each serving cell transmits the configured
one or two SRS resource set(s) from _srs-ResourceSetToAddModList_ with higher
layer parameter _usage_ set to \'antennaSwitching\' and higher layer parameter
_resourceType_ in _SRS-ResourceSet_ set to \'aperiodic\'.
If the UE is not configured for PUSCH/PUCCH transmission on carrier _c~1\ ~_
with slot formats comprised of DL and UL symbols, and if the UE is not capable
of simultaneous reception and transmission on carrier _c~1~_ and serving cell
_c~2~_ , the UE is not expected to be configured or indicated with SRS
resource(s) such that SRS transmission on carrier _c~1~_ (including any
interruption due to uplink or downlink RF retuning time [11, TS 38.133] as
defined by higher layer parameters _switchingTimeUL_ and _switchingTimeDL_ of
_SRS-SwitchingTimeNR_) would collide with the REs corresponding to the SS/PBCH
blocks configured for the UE or the slots belonging to a control resource set
indicated by _MIB_ or _SIB1_ on serving cell _c~2~_.
For _n_ -th (_n ≥_ 1) aperiodic SRS transmission on a cell _c_ , upon
detection of a positive SRS request on a grant, the UE shall commence this SRS
transmission on the configured symbol and slot provided
\- it is no earlier than the summation of
\- the maximum time duration between the two durations spanned by N OFDM
symbols of the numerology of cell _c_ and the cell carrying the grant
respectively, and
\- the UL or DL RF retuning time [11, TS 38.133] as defined by higher layer
parameters _switchingTimeUL_ and _switchingTimeDL_ of _SRS-SwitchingTimeNR,_
\- it does not collide with any previous SRS transmissions, or interruption
due to UL or DL RF retuning time.
otherwise, _n_ -th SRS transmission is dropped, where N is the reported
capability as the minimum time interval in unit of symbols, between the DCI
triggering and aperiodic SRS transmission.
In case of inter-band carrier aggregation, a UE can simultaneously transmit
SRS and PUCCH/PUSCH across component carriers in different bands subject to
the UE\'s capability.
In case of inter-band carrier aggregation, a UE can simultaneously transmit
PRACH and SRS across component carriers in different bands subject to UE\'s
capability.
#### 6.2.1.4 UE sounding procedure for positioning purposes
When the SRS is configured by the higher layer parameter _SRS-PosResource_ and
if the higher layer parameter _spatialRelationInfoPos_ is configured _,_ it
contains the ID of the configuration fields of a reference RS according to
Clause 6.3.2 of [TS 38.331]. The reference RS can be an SRS configured by the
higher layer parameter _SRS-Resource_ or _SRS-PosResource_ , CSI-RS, SS/PBCH
block, or a DL PRS configured on a serving cell or a SS/PBCH block or a DL PRS
configured on a non-serving cell.
The UE is not expected to transmit multiple SRS resources with different
spatial relations in the same OFDM symbol.
If the UE is not configured with the higher layer parameter
_spatialRelationInfoPos_ the UE may use a fixed spatial domain transmission
filter for transmissions of the SRS configured by the higher layer parameter
_SRS-PosResource_ across multiple SRS resources or it may use a different
spatial domain transmission filter across multiple SRS resources.
The UE is only expected to transmit an SRS configured by the higher layer
parameter _SRS-PosResource_ within the active UL BWP of the UE.
When the configuration of SRS is done by the higher layer parameter _SRS-
PosResource_ , the UE can only be provided with a single RS source in
_spatialRelationInfoPos_ per SRS resource for positioning.
For operation on the same carrier, if an SRS configured by the higher
parameter _SRS-PosResource_ collides with a scheduled PUSCH, the SRS is
dropped in the symbols where the collision occurs.
The UE does not expect to be configured with _SRS-PosResource_ on a carrier of
a serving cell with slot formats comprised of DL and UL symbols, not
configured for PUSCH/PUCCH transmission.
### 6.2.2 UE DM-RS transmission procedure
The DM-RS transmission procedures for PUSCH scheduled by PDCCH with DCI format
0_1 described in this clause equally apply to PUSCH scheduled by PDCCH with
DCI format 0_2, by applying the parameters of _dmrs-UplinkForPUSCH-
MappingTypeA-DCI-0-2_ and _dmrs-UplinkForPUSCH-MappingTypeB-DCI-0-2_ instead
of _dmrs-UplinkForPUSCH-MappingTypeA_ and _dmrs-UplinkForPUSCH-MappingTypeB_.
When transmitted PUSCH is neither scheduled by DCI format 0_1/0_2 with CRC
scrambled by C-RNTI, CS-RNTI, SP-CSI-RNTI or MCS-C-RNTI, nor corresponding to
a configured grant, nor being a PUSCH for Type-2 random access procedure, the
UE shall use single symbol front-loaded DM-RS of configuration type 1 on DM-RS
port 0 and the remaining REs not used for DM-RS in the symbols are not used
for any PUSCH transmission except for PUSCH with allocation duration of 2 or
less OFDM symbols with transform precoding disabled, additional DM-RS can be
transmitted according to the scheduling type and the PUSCH duration as
specified in Table 6.4.1.1.3-3 of [4, TS38.211] for frequency hopping disabled
and as specified in Table 6.4.1.1.3-6 of [4, TS38.211] for frequency hopping
enabled, and
If frequency hopping is disabled:
\- The UE shall assume _dmrs-AdditionalPosition_ equals to \'pos2\' and up to
two additional DM-RS can be transmitted according to PUSCH duration, or
If frequency hopping is enabled:
\- The UE shall assume _dmrs-AdditionalPosition_ equals to \'pos1\' and up to
one additional DM-RS can be transmitted according to PUSCH duration.
When transmitted PUSCH is scheduled by activation DCI format 0_0 with CRC
scrambled by CS-RNTI, the UE shall use single symbol front-loaded DM-RS of
configuration type provided by higher layer parameter _dmrs-Type_ in _DMRS-
UplinkConfig_ on DM-RS port 0 and the remaining REs not used for DM-RS in the
symbols are not used for any PUSCH transmission except for PUSCH with
allocation duration of 2 or less OFDM symbols with transform precoding
disabled, and additional DM-RS with _dmrs-AdditionalPosition_ from C
_onfiguredGrantConfig_ can be transmitted according to the scheduling type and
the PUSCH duration as specified in Table 6.4.1.1.3-3 of [4, TS38.211] for
frequency hopping disabled and as specified in Table 6.4.1.1.3-6 of [4,
TS38.211] for frequency hopping enabled.
For the UE-specific reference signals generation as defined in Clause 6.4.1.1
of [4, TS 38.211], a UE can be configured by higher layers with one or two
scrambling identity(s), $n_{\text{ID}}^{DMRS,i}\ $_i_ = 0,1 which are the same
for both PUSCH mapping Type A and Type B.
When transmitted PUSCH is scheduled by DCI format 0_1 with CRC scrambled by
C-RNTI, CS-RNTI, SP-CSI-RNTI or MCS-C-RNTI, or corresponding to a configured
grant, or being a PUSCH for Type-2 random access procedure,
\- the UE may be configured with higher layer parameter _dmrs-Type_ in _DMRS-
UplinkConfig_ , and the configured DM-RS configuration type is used for
transmitting PUSCH in as defined in Clause 6.4.1.1 of [4, TS 38.211].
\- the UE may be configured with the maximum number of front-loaded DM-RS
symbols for PUSCH by higher layer parameter _maxLength_ in _DMRS-
UplinkConfig,_ or by higher layer parameter _msgA-MaxLength_ in _msgA-DMRS-
Config_ ,
\- if _maxLength_ is not configured, single-symbol DM-RS can be scheduled for
the UE by DCI or configured by the configured grant configuration, and the UE
can be configured with a number of additional DM-RS for PUSCH by higher layer
parameter _dmrs-AdditionalPosition,_ which can be \'pos0\', \'pos1\',
\'pos2\', \'pos3\'.
\- if _maxLength_ is configured, either single-symbol DM-RS or double symbol
DM-RS can be scheduled for the UE by DCI or configured by the configured grant
configuration, and the UE can be configured with a number of additional DM-RS
for PUSCH by higher layer parameter _dmrs-AdditionalPosition,_ which can be
\'pos0\' or \'pos1\'.
\- for MsgA PUSCH for Type-2 random access procedure the UE can be configured
with a number of additional DM-RS for PUSCH by higher layer parameter _msgA-
DMRS-AdditionalPosition,_ which can be \'pos0\', \'pos1\', \'pos2\', \'pos3\'
for single-symbol DM-RS or \'pos0\', \'pos1\' for double-symbol DM-RS.
\- and, the UE shall transmit a number of additional DM-RS as specified in
Table 6.4.1.1.3-3 and Table 6.4.1.1.3-4 in -Clause 6.4.1.1.3 of [4, TS
38.211].
If a UE transmitting PUSCH scheduled by DCI format 0_2 is configured with the
higher layer parameter _phaseTrackingRS_ in _dmrs-UplinkForPUSCH-MappingTypeA-
DCI-0-2_ or _dmrs-UplinkForPUSCH-MappingTypeB-DCI-0-2_ , or a UE transmitting
PUSCH scheduled by DCI format 0_0 or DCI format 0_1 is configured with the
higher layer parameter _phaseTrackingRS_ in _dmrs-UplinkForPUSCH-MappingTypeA_
or _dmrs-UplinkForPUSCH-MappingTypeB_ , the UE may assume that the following
configurations are not occurring simultaneously for the transmitted PUSCH
\- any DM-RS ports among 4-7 or 6-11 for DM-RS configurations type 1 and type
2, respectively are scheduled for the UE and PT-RS is transmitted from the UE.
For PUSCH scheduled by DCI format 0_1, by activation DCI format 0_1 with CRC
scrambled by CS-RNTI, or configured by configured grant Type 1 configuration,
the UE shall assume the DM-RS CDM groups indicated in Tables 7.3.1.1.2-6 to
7.3.1.1.2-23 of Clause 7.3.1.1 of [5, TS38.212] are not used for data
transmission, where \"1\", \"2\" and \"3\" for the number of DM-RS CDM
group(s) correspond to CDM group 0, {0,1}, {0,1,2}, respectively.
For PUSCH scheduled by DCI format 0_0 or by activation DCI format 0_0 with CRC
scrambled by CS-RNTI, the UE shall assume the number of DM-RS CDM groups
without data is 1 which corresponds to CDM group 0 for the case of PUSCH with
allocation duration of 2 or less OFDM symbols with transform precoding
disabled, the UE shall assume that the number of DM-RS CDM groups without data
is 3 which corresponds to CDM group {0,1,2} for the case of PUSCH scheduled by
activation DCI format 0_0 and the _dmrs-Type_ in _DMRS-UplinkConfig_ equal to
\'type2\' and the PUSCH allocation duration being more than 2 OFDM symbols,
and the UE shall assume that the number of DM-RS CDM groups without data is 2
which corresponds to CDM group {0,1} for all other cases.
For MsgA PUSCH transmission, if the UE is not configured with _msgA-PUSCH-
DMRS-CDM-group, the UE_ shall assume that 2 DM-RS CDM groups are configured.
Otherwise, _msgA-PUSCH-DMRS-CDM-group indicates which DM-RS CDM group to use
from the set of {0,1}._
For MsgA PUSCH transmission, if the UE is not configured with _msgA-PUSCH-
NrofPorts, the UE_ shall assume that 4 ports are configured per DM-RS CDM
group for double-symbol DM-RS. Otherwise, _msgA-PUSCH-NrofPorts with value of
0 indicates the first port per DM-RS CDM group, while a value of 1 indicates
the first two ports per DM-RS CDM group_.
For uplink DM-RS with PUSCH, the UE may assume the ratio of PUSCH EPRE to DM-
RS EPRE ( [dB]) is given by Table 6.2.2-1 according to the number of DM-RS CDM
groups without data. The DM-RS scaling factor specified in clause 6.4.1.1.3 of
[4, TS 38.211] is given by .
Table 6.2.2-1: The ratio of PUSCH EPRE to DM-RS EPRE
Number of DM-RS CDM groups without data DM-RS configuration type 1 DM-RS
configuration type 2
* * *
1 0 dB 0 dB 2 -3 dB -3 dB 3 - -4.77 dB
For PUSCH repetition Type B, the DM-RS transmission procedure is applied for
each actual repetition separately based on the allocation duration of the
actual repetition. A UE is not expected to be indicated with an antenna port
configuration that is invalid for the allocated duration of any actual
repetition.
### 6.2.3 UE PT-RS transmission procedure
The procedures on PT-RS transmission described in this clause as well as
clauses 6.2.3.1 and 6.2.3.2 apply to a UE PUSCH transmission scheduled by DCI
format 0_2 if the higher layer parameter _phaseTrackingRS_ in _dmrs-
UplinkForPUSCH-MappingTypeA-DCI-0-2 or dmrs-UplinkForPUSCH-MappingTypeB-
DCI-0-2_ is configured, to PUSCH transmissions scheduled by DCI format 0_0 or
format 0_1 if the higher layer parameter _phaseTrackingRS_ in _dmrs-
UplinkForPUSCH-MappingTypeA or dmrs-UplinkForPUSCH-MappingTypeB_ is configured
and PUSCH transmissions corresponding to a configured grant if the higher
layer parameter _phaseTrackingRS_ in _cg-DMRS-Configuration_ is configured. If
a UE is not configured with the higher layer parameter _phaseTrackingRS_ in
the respective _DMRS-UplinkConfig_ , the UE shall not transmit PT-RS. The PT-
RS is only present on PUSCH scheduled by PDCCH with CRC scrambled by MCS-C-
RNTI, C-RNTI, CS-RNTI, SP-CSI-RNTI and on PUSCH corresponding to a configured
grant. For PUSCH repetition Type B, the PT-RS transmission procedure is
applied for each actual repetition separately based on the allocation duration
of the actual repetition.
#### 6.2.3.1 UE PT-RS transmission procedure when transform precoding is not
enabled
When transform precoding is not enabled and if a UE is configured with the
higher layer parameter _phaseTrackingRS_ in _DMRS-UplinkConfig,_
\- the higher layer parameters _timeDensity_ and _frequencyDensity_ in _PTRS-
UplinkConfig_ indicate the threshold values _ptrs-MCS~i~_ , _i_ =1,2,3 and
_N~RB,i~_ , _i_ =0,1, as shown in Table 6.2.3.1-1 and Table 6.2.3.1-2,
respectively.
\- if either or both higher layer parameters _timeDensity_ and/or
_frequencyDensity_ in _PTRS-UplinkConfig_ are configured, the UE shall assume
the PT-RS antenna ports\' presence and pattern are a function of the
corresponding scheduled MCS and scheduled bandwidth in a corresponding
bandwidth part as shown in Table 6.2.3.1-1 and Table 6.2.3.1-2, respectively,
\- if the higher layer parameter _timeDensity_ is not configured, the UE shall
assume _L~PT-RS\ ~_ = 1.
\- if the higher layer parameter _frequencyDensity_ is not configured, the UE
shall assume _K~PT-RS~_ = 2.
\- if none of the higher layer parameters _timeDensity_ and _frequencyDensity_
in _PTRS-UplinkConfig_ are configured, the UE shall assume _L~PT-RS~_ = 1 and
_K~PT-RS~_ = 2.
Table 6.2.3.1-1: Time density of PT-RS as a function of scheduled MCS
Scheduled MCS Time density()
* * *
I~MCS~ \ _V_ , where _V_ = 28 for MCS Table 5.1.3.1-1 and MCS
Table 5.1.3.1-3 and _V_ = 27 for MCS Table 5.1.3.1-2, respectively, the MCS
for PT-RS time-density determination is obtained from the DCI for the same
transport block in the initial transmission, which is smaller than or equal to
V.
The maximum number of configured PT-RS ports is given by the higher layer
parameter _maxNrofPorts_ in _PTRS-UplinkConfig._ The UE is not expected to be
configured with a larger number of UL PT-RS ports than it has reported need
for.
If a UE has reported the capability of supporting full-coherent UL
transmission, the UE shall expect the number of UL PT-RS ports to be
configured as one if UL-PTRS is configured.
For codebook or non-codebook based UL transmission, the association between UL
PT-RS port(s) and DM-RS port(s) is signalled by _PTRS-DMRS association_ field
in DCI format 0_1 and DCI format 0_2. For a PUSCH corresponding to a
configured grant Type 1 transmission, the UE may assume the association
between UL PT-RS port(s) and DM-RS port(s) defined by value 0 in Table
7.3.1.1.2-25 or value \"00\" in Table 7.3.1.1.1.2-26 described in Clause 7.3.1
of [5, TS38.212].
For PUSCH scheduled by DCI format 0_0 or by activation DCI format 0_0, the UL
PT-RS port is associated to DM-RS port 0.
For non-codebook based UL transmission, the actual number of UL PT-RS port(s)
to transmit is determined based on SRI(s) in DCI format 0_1 and DCI format 0_2
or higher layer parameter _sri-ResourceIndicator_ in _rrc-
ConfiguredUplinkGrant_. A UE is configured with the PT-RS port index for each
configured SRS resource by the higher layer parameter _ptrs-PortIndex_
configured by _SRS-Config_ if the UE is configured with the higher layer
parameter _phaseTrackingRS in DMRS-UplinkConfig_. If the PT-RS port index
associated with different SRIs are the same, the corresponding UL DM-RS ports
are associated to the one UL PT-RS port.
For partial-coherent and non-coherent codebook-based UL transmission, the
actual number of UL PT-RS port(s) is determined based on TPMI and/or number of
layers which are indicated by \'_Precoding information and number of layers\'_
field in DCI format 0_1 and DCI format 0_2 or configured by higher layer
parameter _precodingAndNumberOfLayers_ :
\- if the UE is configured with the higher layer parameter _maxNrofPorts_ in
_PTRS-UplinkConfig_ set to \'n2\', the actual UL PT-RS port(s) and the
associated transmission layer(s) are derived from indicated TPMI as:
\- PUSCH antenna port 1000 and 1002 in indicated TPMI share PT-RS port 0, and
PUSCH antenna port 1001 and 1003 in indicated TPMI share PT-RS port 1.
> \- UL PT-RS port 0 is associated with the UL layer \'x\' of layers which are
> transmitted with PUSCH antenna port 1000 and PUSCH antenna port 1002 in
> indicated TPMI, and UL PT-RS port 1 is associated with the UL layer \'y\' of
> layers which are transmitted with PUSCH antenna port 1001 and PUSCH antenna
> port 1003 in indicated TPMI, where \'x\' and/or \'y\' are given by DCI
> parameter \'_PTRS-DMRS association\'_ as shown in DCI format 0_1 and DCI
> format 0_2 described in Clause 7.3.1 of [5, TS38.212].
When the UE is scheduled with _Q~p~_ ={1,2} PT-RS port(s) in uplink and the
number of scheduled layers is ,
\- If the UE is configured with higher layer parameter _ptrs-Power_ , the
PUSCH to PT-RS power ratio per layer per RE is given by , where is shown in
the Table 6.2.3.1-3 according to the higher layer parameter _ptrs-Power_ , the
PT-RS scaling factor specified in clause 6.4.1.2.2.1 of [4, TS 38.211] is
given by and also on the \'_Precoding Information and Number of Layers\'_
field in DCI.
\- The UE shall assume _ptrs-Power_ in _PTRS-UplinkConfig_ is set to state
\"00\" in Table 6.2.3.1-3 if not configured or in case of non-codebook based
PUSCH.
Table 6.2.3.1-3: Factor related to PUSCH to PT-RS power ratio per layer per RE
_UL-PTRS-power /_ The number of PUSCH layers ( )
* * *
                      1           2                                3                                                  4                                                                                                     
                      All cases   Full coherent                    Partial and non- coherent and non-codebook based   Full coherent   Partial and non- coherent and non-codebook based   Full coherent   Partial coherent   Non-coherent and non-codebook based
00 0 3 3 _Q~p~_ -3 4.77 3 _Q~p~_ -3 6 3 _Q~p~_ 3 _Q~p~_ -3 01 0 3 3 4.77 4.77
6 6 6 10 Reserved  
11 Reserved
#### 6.2.3.2 UE PT-RS transmission procedure when transform precoding is
enabled
When transform precoding is enabled and if a UE is configured with the higher
layer parameter _transformPrecoderEnabled_ in _PTRS-UplinkConfig,_
\- the UE shall be configured with the higher layer parameters _sampleDensity_
and the UE shall assume the PT-RS antenna ports\' presence and PT-RS group
pattern are a function of the corresponding scheduled bandwidth in a
corresponding bandwidth part, as shown in Table 6.2.3.2-1. The UE shall assume
no PT-RS is present when the number of scheduled RBs is less than N~RB0~ if
N~RB0~ > 1 or if the RNTI equals TC-RNTI.
\- and the UE may be configured PT-RS time density _L~PT-RS~_ = 2 with the
higher layer parameter _timeDensityTransformPrecoding._ Otherwise, the UE
shall assume _L~PT-RS~_ = 1.
\- if the higher layer parameter _sampleDensity_ indicates that the sample
density thresholds _N~RB,i~_ = _N~RB,i+1~_ , then the associated row where
both these thresholds appear in Table 6.2.3.2-1 is disabled.
Table 6.2.3.2-1: PT-RS group pattern as a function of scheduled bandwidth
+------------------------------+------------------------+-------------------+ | Scheduled bandwidth | Number of PT-RS groups | Number of samples | | | | | | | | per PT-RS group | +==============================+========================+===================+ | _N~RB0~ N~RB~_ \ 1$. For $\mu = 0$,
the UE expects the number of RBs within a RB set is between 100 and 110. For
$\mu = 1$, the UE expects the number of RBs within a RB set is between 50 and
55 except for at most one RB set which may contain 56 RBs.
# 8 Physical sidelink shared channel related procedures
A UE can be configured by higher layers with one or more sidelink resource
pools. A sidelink resource pool can be for transmission of PSSCH, as described
in Clause 8.1, or for reception of PSSCH, as described in Clause 8.3 and can
be associated with either sidelink resource allocation mode 1 or sidelink
resource allocation mode 2.
In the frequency domain, a sidelink resource pool consists of _sl-
NumSubchannel_ contiguous sub-channels. A sub-channel consists of _sl-
SubchannelSize_ contiguous PRBs, where _sl-NumSubchannel_ and _sl-
SubchannelSize_ are higher layer parameters.
The set of slots that may belong to a sidelink resource pool is denoted by
$(t_{0}^{\text{SL}},t_{1}^{\text{SL}},\cdots,t_{T_{\max} - 1}^{\text{SL}})$
where
\- ${0 \leq t}_{i}^{\text{SL}}  1) the remaining slots excluding $N_{S - SSB}$ slots and $N_{\text{nonSL}}$
> slots from the set of all the slots are denoted by
> $(l_{0},l_{1},\cdots,l_{(10240 \times 2^{\mu} - N_{S - SSB}\ -
> N_{\text{nonSL}} - 1)})$ arranged in increasing order of slot index.
>
> 2) a slot $l_{r}\ (0 \leq r  N_{\text{nonSL}})$ belongs to the reserved slots if $r = \left\lfloor
> \frac{m \bullet (10240 \times 2^{\mu} - N_{S - SSB} -
> N_{\text{nonSL}})}{N_{\text{reserved}}} \right\rfloor$, here $m =
> 0,1,\cdots,N_{\text{reserved}} - 1$ and $N_{\text{reserved}} = \left( 10240
> \times 2^{\mu} - N_{S - SSB} - N_{\text{nonSL}} \right)\text{\ mod\
> }L_{\text{bitmap}}$ where $L_{\text{bitmap}}$ denotes the length of bitmap
> configured by higher layers.
\- The slots in the set are arranged in increasing order of slot index.
The UE determines the set of slots assigned to a sidelink resource pool as
follows:
\- a bitmap $\left( b_{0},b_{1},\ldots,b_{L_{\text{bitmap}} - 1} \right)$
associated with the resource pool is used where $L_{\text{bitmap}}$ the length
of the bitmap is configured by higher layers.
\- a slot $t_{k}^{\text{SL}}\ (0 \leq k  A UE is not expected to receive an SCI indicating $28 \leq I_{\text{MCS}}
> \leq 31$ if Table 5.1.3.1-2 is used, or $29 \leq I_{\text{MCS}} \leq 31$
> otherwise.
### 8.1.4 UE procedure for determining the subset of resources to be reported
to higher layers in PSSCH resource selection in sidelink resource allocation
mode 2
In resource allocation mode 2, the higher layer can request the UE to
determine a subset of resources from which the higher layer will select
resources for PSSCH/PSCCH transmission. To trigger this procedure, in slot
_n,_ the higher layer provides the following parameters for this PSSCH/PSCCH
transmission:
\- the resource pool from which the resources are to be reported;
\- L1 priority, $\text{pri}o_{\text{TX}}$;
\- the remaining packet delay budget;
\- the number of sub-channels to be used for the PSSCH/PSCCH transmission in a
slot, $L_{\text{subCH}}$;
\- optionally, the resource reservation interval, $P_{\text{rsvp_TX}}$, in
units of msec.
\- if the higher layer requests the UE to determine a subset of resources from
which the higher layer will select resources for PSSCH/PSCCH transmission as
part of re-evaluation or pre-emption procedure, the higher layer provides a
set of resources $(r_{0},r_{1},r_{2},\ldots)\ $which may be subject to re-
evaluation and a set of resources $(r_{0}^{'},r_{1}^{'},r_{2}^{'},\ldots)\
$which may be subject to pre-emption.
\- it is up to UE implementation to determine the subset of resources as
requested by higher layers before or after the slot $r_{i}^{''}$ - $T_{3}$,
where $r_{i}^{''}$ is the slot with the smallest slot index among
$(r_{0},r_{1},r_{2},\ldots)\ $and $(r_{0}^{'},r_{1}^{'},r_{2}^{'},\ldots)\ $,
and $T_{3}$ is equal to $T_{proc,1}^{\text{SL}}$, _where_
$T_{proc,1}^{\text{SL}}\ $_is defined in slots in Table 8.1.4-2 where_
$\mu_{\text{SL}}$ _is the SCS configuration of the SL BWP._
The following higher layer parameters affect this procedure:
_\- sl-SelectionWindowList:_ internal parameter $T_{2min}$ is set to the
corresponding value from higher layer parameter _sl-SelectionWindowList_ for
the given value of $\text{pri}o_{\text{TX}}$.
_\- sl-Thres-RSRP-List_ : this higher layer parameter provides an RSRP
threshold for each combination $\left( p_{i},\, p_{j} \right)$, where $p_{i}$
is the value of the priority field in a received SCI format 1-A and $p_{j}$ is
the priority of the transmission of the UE selecting resources; for a given
invocation of this procedure, $p_{j}\ = \ \text{pri}o_{\text{TX}}$.
_\- sl-RS-ForSensing_ selects if the UE uses the PSSCH-RSRP or PSCCH-RSRP
measurement, as defined in clause 8.4.2.1.
_\- sl-ResourceReservePeriodList_
_\- sl-SensingWindow_ : internal parameter $T_{0}$ is defined as the number of
slots corresponding to _sl-SensingWindow_ msec
_\- sl-TxPercentageList: internal parameter_ $X$ _for a given_
$\text{pri}o_{\text{TX}}$ _is defined as sl-TxPercentageList (_
$\text{pri}o_{\text{TX}}$_) converted from percentage to ratio_
_\- sl-PreemptionEnable: if sl-PreemptionEnable is provided, and if it is not
equal to \'enabled\', internal parameter_ $\text{pri}o_{\text{pre}}$ _is set
to the higher layer provided parameter sl-PreemptionEnable_
The resource reservation interval, $P_{\text{rsvp_TX}}$, if provided, is
converted from units of msec to units of logical slots, resulting in
$P_{\text{rsvp}\text{_}\text{TX}}^{'}$ according to clause 8.1.7.
Notation:
$\left( {t'}_{0}^{\text{SL}},\ {t'}_{1}^{\text{SL}},\
{t'}_{2}^{\text{SL}},\ldots \right)$ denotes the set of slots which belongs to
the sidelink resource pool and is defined in Clause 8.
The following steps are used:
1) A candidate single-slot resource for transmission $R_{\text{x,y}}$ is
defined as a set of $L_{\text{subCH}}$ contiguous sub-channels with sub-
channel _x+j_ in slot ${t'}_{y}^{\text{SL}}$ where $j = 0,...,L_{\text{subCH}}
- 1$. The UE shall assume that any set of $L_{\text{subCH}}$ contiguous sub-
channels included in the corresponding resource pool within the time interval
$\lbrack n + T_{1},n + T_{2}\rbrack$ correspond to one candidate single-slot
resource, where
\- selection of $T_{1}$ is up to UE implementation under $0\ \leq \ T_{1}
\leq$ $T_{proc,1}^{\text{SL}}\ $ , where $T_{proc,1}^{\text{SL}}\ $ is defined
in slots in Table 8.1.4-2 where $\mu_{\text{SL}}$ is the SCS configuration of
the SL BWP;
\- if $\text{\ T}_{2min}$ is shorter than the remaining packet delay budget
(in slots) then $T_{2}\ $is up to UE implementation subject to $T_{2min}\ \leq
\ T_{2}$ $\leq$ remaining packet delay budget (in slots); otherwise $T_{2}\
$is set to the remaining packet delay budget (in slots).
The total number of candidate single-slot resources is denoted by
$M_{\text{total}}$.
2) The sensing window is defined by the range of slots [$n\,
–T_{0},n–T_{\text{proc},0}^{\text{SL}}$) where $T_{0}$ is defined above and
$T_{\text{proc},0}^{\text{SL}}$ is defined in slots in Table 8.1.4-1 where
$\mu_{\text{SL}}$ is the SCS configuration of the SL BWP. The UE shall monitor
slots which belongs to a sidelink resource pool within the sensing window
except for those in which its own transmissions occur. The UE shall perform
the behaviour in the following steps based on PSCCH decoded and RSRP measured
in these slots.
3) The internal parameter $Th(p_{i},p_{j})\ $ is set to the corresponding
value of RSRP threshold indicated by the _i_ -th field in _sl-Thres-RSRP-List_
, where $i = p_{i} + \left( p_{j} - 1 \right)*8$.
4) The set $S_{A}$ is initialized to the set of all the candidate single-slot
resources.
5) The UE shall exclude any candidate single-slot resource $R_{\text{x,y}}$
from the set $S_{A}$ if it meets all the following conditions:
\- the UE has not monitored slot ${t'}_{m}^{\text{SL}}$ in Step 2.
\- for any periodicity value allowed by the higher layer parameter _sl-
ResourceReservePeriodList_ and a hypothetical SCI format 1-A received in slot
${t'}_{m}^{\text{SL}}$ with \'_Resource reservation period_ \' field set to
that periodicity value and indicating all subchannels of the resource pool in
this slot, condition c in step 6 would be met.
5a) If the number of candidate single-slot resources $R_{\text{x,y}}$
remaining in the set $S_{A}$ is smaller than $X \cdot M_{\text{total}}$, the
set $S_{A}$ is initialized to the set of all the candidate single-slot
resources as in step 4.
6) The UE shall exclude any candidate single-slot resource $R_{\text{x,y}}$
from the set $S_{A}$ if it meets all the following conditions:
a) the UE receives an SCI format 1-A in slot ${t'}_{m}^{\text{SL}}$, and
\'_Resource reservation period\'_ field, if present, and \'_Priority_ \' field
in the received SCI format 1-A indicate the values $P_{\text{rsvp_RX}}$ and
$\text{pri}o_{\text{RX}}$, respectively according to Clause 16.4 in [6, TS
38.213];
b) the RSRP measurement performed, according to clause 8.4.2.1 for the
received SCI format 1-A, is higher than $Th\left(
\text{pri}o_{\text{RX}},prio_{\text{TX}} \right);$
c) the SCI format received in slot ${t'}_{m}^{\text{SL}}\ $or the same SCI
format which, if and only if the \'_Resource reservation period_ \' field is
present in the received SCI format 1-A, is assumed to be received in slot(s)
${t'}_{m + q \times P_{\text{rsvp}\text{_}\text{RX}}^{'}}^{\text{SL}}$
determines according to clause 8.1.5 the set of resource blocks and slots
which overlaps with $R_{x,y + j \times P_{rsvp_ TX}^{'}}$ for _q_ =1, 2, ...,
_Q_ and _j=_ 0, 1, ..., $C_{\text{resel}} - 1$. Here,
$P_{\text{rsvp}\text{_}\text{RX}}^{'}$ is $P_{\text{rsvp_RX}}$ converted to
units of logical slots according to clause 8.1.7, $Q = \left\lceil
\frac{T_{\text{scal}}}{P_{\text{rsvp}\text{_}\text{RX}}} \right\rceil\ $ if
$P_{rsvp_ RX}  \text{pri}o_{\text{RX}}$
\- _sl-PreemptionEnable_ is provided and is not equal to \'enabled\', and
$\text{pri}o_{\text{RX}}  \text{pri}o_{\text{RX}}$
Table 8.1.4-1: $\mathbf{T}_{\mathbf{proc,0}}^{\mathbf{\text{SL}}}$ depending
on sub-carrier spacing
$$\mathbf{\mu}_{\mathbf{\text{SL}}}$$
$\mathbf{T}_{\mathbf{proc,0}}^{\mathbf{\text{SL}}}$ **[slots]**
* * *
0 1 1 1 2 2 3 4
Table 8.1.4-2: $\mathbf{T}_{\mathbf{proc,1}}^{\mathbf{\text{SL}}}$ depending
on sub-carrier spacing
$$\mathbf{\mu}_{\mathbf{\text{SL}}}$$
$\mathbf{T}_{\mathbf{proc,1}}^{\mathbf{\text{SL}}}$ **[slots]**
* * *
0 3 1 5 2 9 3 17
### 8.1.5 UE procedure for determining slots and resource blocks for PSSCH
transmission associated with an SCI format 1-A
The set of slots and resource blocks for PSSCH transmission is determined by
the resource used for the PSCCH transmission containing the associated SCI
format 1-A, and fields \'_Frequency resource assignment_ \', \'_Time resource
assignment_ \' of the associated SCI format 1-A as described below.
\'_Time resource assignment_ \' carries logical slot offset indication of N =
1 or 2 actual resources when _sl-MaxNumPerReserve_ is 2, and N = 1 or 2 or 3
actual resources when _sl-MaxNumPerReserve_ is 3, in a form of time RIV (TRIV)
field which is determined as follows:
if $N = 1$
$\text{TRIV} = 0$
elseif $N = 2$
$\text{TRIV} = t_{1}$
else
if $\left( t_{2} - t_{1} - 1 \right) \leq 15$
$\text{TRIV} = 30\left( t_{2} - t_{1} - 1 \right) + t_{1} + 31$
else
$\text{TRIV} = 30\left( 31 - t_{2} + t_{1} \right) + 62 - t_{1}$
end if
end if
where the first resource is in the slot where SCI format 1-A was received, and
$t_{i}$ denotes i-th resource time offset in logical slots of a resource pool
with respect to the first resource where for N = 2, $1 \leq t_{1} \leq 31$;
and for N = 3, $1 \leq t_{1} \leq 30$, $t_{1} = 20, i.e. the sub-channel size is at least 20 PRBs.
When a sub-channel size is less than 20 PRBs and the size of PSCCH is less
than the sub-channel size, a UE is not expected to choose a PSSCH DM-RS
pattern to be transmitted in the same OFDM symbol with PSCCH.
### 8.2.3 PT-RS transmission procedure
Transmission of PT-RS is only supported in frequency range 2.
The UE PT-RS transmission procedure specified in clause 6.2.3.1 applies for
derivation of the PT-RS parameters _L~PT-RS~_ and _~,~ K~PT-RS\ ~_ and for
determination of PT-RS presence, with the following changes:
\- _timeDensity_ and _frequencyDensity_ in _PTRS-UplinkConfig_ are replaced by
_sl-PTRS-TimeDensity_ and _sl-PTRS-FreqDensity_ in _SL-PTRS-Config_
respectively, and _SL-PTRS-Config_ is (pre)configured per resource pool;
\- the number of antenna ports is the same as the number of PSSCH DM-RS
antenna ports and the association between a PT-RS antenna port and a PSSCH DM-
RS antenna port is fixed.
## 8.3 UE procedure for receiving the physical sidelink shared channel
For sidelink resource allocation mode 1, a UE upon detection of SCI format 1-A
on PSCCH can decode PSSCH according to the detected SCI formats 2-A and 2-B,
and associated PSSCH resource configuration configured by higher layers. The
UE is not required to decode more than one PSCCH at each PSCCH resource
candidate.
For sidelink resource allocation mode 2, a UE upon detection of SCI format 1-A
on PSCCH can decode PSSCH according to the detected SCI formats 2-A and 2-B,
and associated PSSCH resource configuration configured by higher layers. The
UE is not required to decode more than one PSCCH at each PSCCH resource
candidate.
A UE is required to decode neither the corresponding SCI formats 2-A and 2-B
nor the PSSCH associated with an SCI format 1-A if the SCI format 1-A
indicates an MCS table that the UE does not support.
## 8.4 UE procedure for receiving reference signals
### 8.4.1 CSI-RS reception procedure
The CSI-RS defined in Clause 8.4.1.5 of [4, TS 38.211] may be used for CSI
computation.
### 8.4.2 DM-RS reception procedure for RSRP computation
8.4.2.1 RSRP for resource selection in sidelink resource allocation mode 2
In sidelink resource allocation mode 2, the UE measures RSRP for resource
selection as follows:
\- PSSCH-RSRP over the DM-RS resource elements for the PSSCH according to the
received SCI format 1-A if higher layer parameter _sl-RS-ForSensing_ is set to
\'_pssch\'_ , and
\- PSCCH-RSRP over the DM-RS resource elements for the PSCCH carrying the
received SCI format 1-A if higher layer parameter _sl-RS-ForSensing_ is set to
\'_pscch\'_.
### 8.4.3 PT-RS reception procedure
Reception of PT-RS is only supported in frequency range 2.
The UE PT-RS reception procedure specified in clause 5.1.6.3 applies for
derivation of the PT-RS parameters _L~PT-RS~_ and _K~PT-RS\ ~_ and for
determination of PT-RS presence, with the following changes:
\- _timeDensity_ and f _requencyDensity_ in _PTRS-DownlinkConfig_ are replaced
by _sl-PTRS-TimeDensity_ and _sl-PTRS-FreqDensity_ in _SL-PTRS-Config_
respectively, and _SL-PTRS-Config_ is (pre)configured per resource pool;
\- the number of antenna ports is the same as the number of PSSCH DM-RS
antenna ports and the association between a PT-RS antenna port and a PSSCH DM-
RS antenna port is fixed.
## 8.5 UE procedure for reporting channel state information (CSI)
### 8.5.1 Channel state information framework
CSI consists of Channel Quality Indicator (CQI) and Rank Indicator (RI). The
CQI and RI are always reported together.
#### 8.5.1.1 Reporting configurations
The UE shall calculate CSI parameters (if reported) assuming the following
dependencies between CSI parameters (if reported)
\- CQI shall be calculated conditioned on the reported RI
The CSI reporting can be aperiodic (using [10, TS 38.321]). Table 8.5.1.1-1
shows the supported combinations of CSI reporting configurations and CSI-RS
configurations and how the CSI reporting is triggered for CSI-RS
configuration. Aperiodic CSI-RS is configured and triggered/activated as
described in Clause 8.5.1.2.
Table 8.5.1.1-1 Triggering/Activation of CSI reporting for the possible CSI-RS
Configurations.
**CSI-RS Configuration** **Aperiodic CSI Reporting**
* * *
Aperiodic CSI-RS Triggered by SCI.
For CSI reporting, wideband CQI reporting is supported. A wideband CQI is
reported for a single codeword for the entire CSI reporting band.
#### 8.5.1.2 Triggering of sidelink CSI reports
The CSI-triggering UE is not allowed to trigger another aperiodic CSI report
for the same UE before the last slot of the expected reception or completion
of the ongoing aperiodic CSI report associated with the SCI format 2-A with
the \'_CSI request_ \' field set to 1, where the last slot of the expected
reception of the ongoing aperiodic CSI report is given by [10, TS38.321].
An aperiodic CSI report is triggered by an SCI format 2-A with the \'_CSI
request_ \' field set to 1.
A UE is not expected to transmit a sidelink CSI-RS and a sidelink PT-RS which
overlap.
### 8.5.2 Channel state information
#### 8.5.2.1 CSI reporting quantities
##### 8.5.2.1.1 Channel quality indicator (CQI)
The UE shall derive CQI as specified in clause 5.2.2.1, with the following
changes
\- PDSCH replaced by PSSCH
\- uplink slot replaced by sidelink slot
\- downlink physical resource blocks replaced by sidelink physical resource
blocks
\- Transport Block Size determination according to Clause 8.1.3.2
\- CSI reference resource according to the Clause 8.5.2.3
\- interference measurements are not supported
\- sub-band differential CQI is not supported
\- cqi-Table is determined as follows
\- cqi-Table = \'table1\' if Table 5.1.3.1-1 is determined as the MCS table
according to Clause 8.1.3.1 of [6, 38.214],
\- cqi-Table = \'table2\' if Table 5.1.3.1-2 is determined as the MCS table
according to Clause 8.1.3.1 of [6, 38.214],
\- cqi-Table = \'table3\' if Table 5.1.3.1-3 is determined as the MCS table
according to Clause 8.1.3.1 of [6, 38.214]
#### 8.5.2.2 Reference signal (CSI-RS)
The UE can be configured with one CSI-RS pattern as indicated by the higher
layer parameters _sl-CSI-RS-FreqAllocation, sl-CSI-RS-FirstSymbol_ in _SL-CSI-
RS-Config_.
Parameters for which the UE shall assume non-zero transmission power for CSI-
RS are configured according to clause 8.2.1.
A UE is not expected to be configured such that a CSI-RS and the corresponding
PSCCH can be mapped to the same resource element. A UE is not expected to
receive sidelink CSI-RS and PSSCH DM-RS, nor CSI-RS and 2nd-stage SCI, on the
same symbol.
Sidelink CSI-RS shall be transmitted according to [4, TS 38.211] in the
resource blocks used for the PSSCH associated with the SCI format 2-A
triggering a report.
#### 8.5.2.3 CSI reference resource definition
The CSI reference resource in sidelink is defined as follows:
\- In the frequency domain, the CSI reference resource is defined by the group
of sidelink physical resource blocks containing the sidelink CSI-RS to which
the derived CSI relates.
\- In the time domain, the CSI reference resource for a CSI reporting in
sidelink slot _n_ is defined by a single sidelink slot _n~CSI_ref~_ where
_n~CSI_ref~_ is the same sidelink slot as the corresponding CSI request.
If configured to report CQI index and RI index, in the CSI reference resource,
the UE shall assume the following for the purpose of deriving the CQI index
and RI index:
\- The reference resource uses the CP length and subcarrier spacing configured
for the SL BWP.
\- Redundancy Version 0.
\- PSCCH occupies 2 OFDM symbols.
\- The number of PSSCH and DM-RS symbols is equal to _sl-LengthSymbols_ ‒2.
\- Assume no REs allocated for sidelink CSI-RS.
\- Assume no REs allocated SCI format 2-A or SCI format 2-B.
\- Assume the same number of DM-RS symbols as the smallest one configured by
the higher layer parameter _sl-PSSCH-DMRS-TimePatternList._
\- Assume no REs allocated for sidelink PT-RS.
\- Assume sidelink CSI-RS RE power is the same as PSSCH RE power.
\- The PSSCH transmission scheme where the UE may assume that PSSCH
transmission would be performed with up to 2 transmission layers as defined in
Clause 8.3.1.4 of [4, TS 38.211]. For CQI calculation, the UE should assume
that PSSCH signals on antenna ports in the set [1000,..., 1000+ν-1] for ν
layers would result in signals equivalent to corresponding symbols transmitted
on antenna ports [3000,..., 3000+_P_ -1], as given by
$\begin{bmatrix} y^{\left( 3000 \right)}(i) \ \cdots \ y^{\left( 3000 + P - 1
\right)}(i) \ \end{bmatrix} = W(i)\begin{bmatrix} x^{\left( 0 \right)}(i) \
\cdots \ x^{\left( \nu - 1 \right)}(i) \ \end{bmatrix}$
> where is a vector of PSSCH symbols from the layer mapping defined in Clause
> 8.3.1.4 of [4, TS 38.211], $P \in \left\lbrack 1,2 \right\rbrack$ is the
> number of CSI-RS ports. If only one CSI-RS port is configured, _W(i)_ is 1.
> Otherwise, _W(i)_ is the identity matrix _._
### 8.5.3 CSI reporting
The UE can be configured with one CSI reporting latency bound as indicated by
the higher layer parameter _sl-LatencyBoundCSI-Report_. CSI reporting is
aperiodic and is described in [10, TS 38.321].
## 8.6 UE PSSCH preparation procedure time
For sidelink dynamic grant and for SL configured grant type 2 activation, if
the first sidelink symbol in the sidelink allocation for a PSSCH for a
transport block and the associated PSCCH, including the DM-RS and the
duplicated symbol, as defined by the slot offset $K_{\text{SL}}$ of the
scheduling DCI for dynamic grant or the activating DCI for SL configured grant
type 2, is no earlier than at symbol _L_ , where _L_ is defined as the next
sidelink symbol with its CP starting $T_{\text{proc}} = (N_{2} + d_{2,1})(2048
+ 144) \cdot \kappa 2^{- \mu} \cdot T_{C}$ after the end of the reception of
the last symbol of the PDCCH carrying the DCI scheduling the sidelink
transmissions for dynamic grant or activating the SL configured grant type 2,
then the UE shall transmit the PSSCH and the associated PSCCH.
_\- N~2~_ is based on _µ_ of Table 8.6-1, where _µ_ corresponds to the one of
(_µ~DL~_ , _µ~SL~_) resulting with the largest _T~proc~_ , where the _µ~DL~_
corresponds to the subcarrier spacing of the downlink with which the PDCCH
carrying the DCI scheduling the PSSCH for dynamic grant or activating the SL
configured grant type 2 was transmitted and _µ~SL~_ corresponds to the
subcarrier spacing of the sidelink channel with which the PSSCH and the
associated PSCCH are to be transmitted, and _κ_ is defined in Clause 4.1 of
[4, TS 38.211].
\- _d~2,1\ ~_ = 1.
Otherwise the UE may ignore the scheduling DCI for dynamic grant or the
activating DCI for SL configured grant type 2.
The value of $T_{\text{proc}}$ is used both in the case of normal and extended
cyclic prefix.
Table 8.6-1: PSSCH preparation time
      PSSCH preparation time *N~2~* \[symbols\]
* * *
0 10 1 12 2 23 3 36
For sidelink resource allocation mode 1, the UE does not expect that the first
sidelink symbol in the sidelink allocation for a PSSCH for retransmission of a
transport block and the associated PSCCH, including the DM-RS and the
duplicated symbol as defined by the \"Time resource assignment\" field of the
corresponding DCI for dynamic grant or for SL configured grant type 2, or by
_sl-TimeResourceCG-Type1_ for configured grant type 1 starts earlier than at
symbol $L$ where $L$ is defined as the next sidelink symbol with its CP
starting $T_{\text{prep}} + \delta$ after the end of the last symbol of the
PSFCH occasion corresponding to the most recent transmission of PSSCH for the
same transport block, where $T_{\text{prep}}$ is defined in Clause 16.5 of [6,
TS 38.213] and $\delta = {5 \bullet 10}^{- 4}\text{\ s}$. Otherwise the UE may
skip the retransmission of the PSSCH and the transmission of the corresponding
PSCCH.
#
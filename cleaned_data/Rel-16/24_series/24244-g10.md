# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the procedures of the Wireless LAN control
plane protocol (WLCP) for trusted WLAN access to EPC which is used between
User Equipment (UE) and Trusted WLAN Access Gateway (TWAG) for multi-
connection mode as specified in 3GPP TS 23.402 [2].
This document also defines the message format, information elements coding,
error handling and system parameters applied by the WLCP protocol.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.402: \"Architecture Enhancements for non-3GPP accesses\".
[3] 3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via
non-3GPP access networks; Stage 3\".
[4] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[5] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[6] IEEE Std 802-2014: \"IEEE Standard for Local and Metropolitan Area
Networks: Overview and Architecture\", 30th June 2014.
[7] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[8] IETF RFC 768: \"User Datagram Protocol\"
[9] 3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security
aspects of non-3GPP accesses\".
[10] 3GPP TS 24.161: \"Network-Based IP Flow Mobility (NBIFOM); Stage 3\".
[11] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[12] 3GPP TS 29.274: \"Tunnelling Protocol for Control plane (GTPv2-C); Stage
3\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**PDN connection for emergency bearer services:** A PDN connection which was
activated with request type \"emergency\" or \"handover of emergency bearer
services\".
**Single point-to-point connectivity:** The PDN connectivity service is
provided by one point-to-point connectivity between the UE and the TWAG
concatenated with S2a bearer(s) between the TWAG and the PDN GW.
**Multiple bearer PDN connectivity:** The PDN connectivity service is provided
by the multiple WLCP bearers per PDN connection where a separate WLCP bearer
is established for the default S2a bearer, and for each dedicated S2a bearer
established on the S2a interface between the TWAG and the PDN GW.
**WLCP bearer:** A bearer between the UE and the TWAG which has one-to-one
mapping with the S2a bearer.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
APN Access Point Name
DTLS Datagram Transport Layer Security
EAP Extensible Authentication Protocol
EPC Evolved Packet Core Network
ID Identifier
IE Information Element
IEI Information Element Identifier
LSB Least Significant Bit
MAC Media Access Control
MSB Most Significant Bit
N3G Non-3GPP Access
NBIFOM Network-based IP flow mobility
PCO Protocol Configuration Options
PDN Packet Data Network
PDN GW Packet Data Network Gateway
PTI Procedure Transaction Identity
TWAG Trusted WLAN Access Gateway
UE User Equipment
WLAN Wireless Local Area Network
WLCP Wireless LAN control plane protocol
# 4 General
## 4.1 Overview
WLCP is used between user equipment (UE) and trusted wLAN access gateway
(TWAG) for multi-connection mode as specified in 3GPP TS 23.402 [2].
The WLCP comprises procedures for:
\- establishment of PDN connections including initial request and handover
from a 3GPP access;
\- requesting the release of a PDN connection by the UE or notifying the UE of
the release of a PDN connection;
\- transport of parameters related to PDN connections, such as APN, PDN type,
PCO, handover indication, user-plane MAC address of the TWAG etc.;
\- IP address allocation; and
\- WLCP bearer management including WLCP bearer setup, modification and
release when multiple bearer PDN connectivity is used.
Generally, WLCP procedures described in the clause 5 can be performed only
after the UE has successfully completed the following steps:
\- Authentication and negotiation of the multi-connection mode for the trusted
WLAN access as specified in 3GPP TS 24.302 [3]; and
\- Establishment of a DTLS connection with the TWAG, according to subclause
4.2.4.
## 4.2 Protocol stack
### 4.2.1 General
The protocol stack of WLCP is shown in figure 4.2.1.
Figure 4.2.1: Protocol stack of WLCP
### 4.2.2 UDP port numbers for WLCP
#### 4.2.2.1 General
The WLCP messages are transported over UDP layer as specified in IETF RFC 768
[8]. The security is provided by the DTLS layer.
The WLCP UDP Port number is 36411.
#### 4.2.2.2 UE procedure
The UE shall use the WLCP UDP port number as the source UDP port and the
destination UDP port of WLCP messages.
#### 4.2.2.3 TWAG procedure
The TWAG shall use the WLCP UDP port number as the source UDP port and the
destination UDP port of WLCP messages.
### 4.2.3 IP addresses of WLCP message
#### 4.2.3.1 General
The WLCP/DTLS/UDP packet shall be carried via IPv6 with link local addressing
scope or IPv4 as specified in 3GPP TS 23.402 [2].
#### 4.2.3.2 UE procedure
The UE receives one or two TWAG control-plane addresses during the EAP
authentication and authorization procedure as specified in 3GPP TS 24.302 [3]
subclause 6.4.2.6.3.
> NOTE: If two TWAG control-plane addresses are received, one includes an IPv4
> address and the other includes an IPv6 link-local address.
If the UE receives one TWAG control-plane address, the UE shall select the
TWAG control-plane address. If the UE receives two TWAG control-plane
addresses, the UE shall select one of the TWAG control-plane addresses.
The UE shall use the IP address of the selected TWAG control-plane address as
the destination IP address of WLCP messages.
The UE shall apply the following procedures to set the source IP address of
the WLCP message:
\- if the TWAG IP address for WLCP is an IPv4 address and if the UE supports
IPv4, the UE shall obtain an IPv4 address via DHCPv4 to be used as the source
IP address for WLCP;
\- if the TWAG IP address for WLCP is an IPv6 link-local address and if the UE
supports IPv6, the UE shall use the IPv6 link-local address configured on the
WLAN interface as the source IP address for WLCP; and
\- if the TWAG IP addresses for WLCP are an IPv4 address and an IPv6 link-
local address, which IP version the UE selects is implementation dependent.
#### 4.2.3.3 TWAG procedure
When the UE initiates a WLCP procedure:
\- the TWAG shall use a TWAG control plane address which was included in
TWAG_CP_ADDRESS item provided to the UE during EAP-AKA\' authentication as
described in 3GPP TS 24.302 [3], as the source IP address for WLCP. If two
TWAG control plane addresses were included in TWAG_CP_ADDRESS item provided to
the UE during EAP-AKA\' authentication as described in 3GPP TS 24.302 [3], the
TWAG shall use the TWAG control plane address of the same IP version as the IP
version received from the UE in the WLCP message; and
\- the TWAG shall use the source IP address received from the UE in the WLCP
message as the destination IP address for further WLCP message to the UE.
When the TWAG initiates a WLCP procedure:
\- the TWAG shall use a TWAG control plane address which was included in
TWAG_CP_ADDRESS item provided to the UE during EAP-AKA\' authentication as
described in 3GPP TS 24.302 [3], as the source IP address for WLCP. If two
TWAG control plane addresses were included in TWAG_CP_ADDRESS item provided to
the UE during EAP-AKA\' authentication as described in 3GPP TS 24.302 [3], the
TWAG shall use the TWAG control plane address of the same IP version as the IP
version received from the UE in the WLCP message; and
\- the TWAG shall use the source IP address received from the UE in the
earlier WLCP message as the destination IP address for further WLCP message to
the UE.
### 4.2.4 DTLS usage
The UE and the TWAG shall use DTLS according to 3GPP TS 33.402 [9].
## 4.3 WLCP layer states when single point-to-point connectivity is used
### 4.3.1 General
In this subclause the possible states of WLCP state machine in the UE and in
the TWAG are described when single point-to-point PDN connectivity is used.
Each PDN connection to EPC is associated with an individual state machine, and
single point-to-point connectivity between the UE and the TWAG is used to
transport traffic for all S2a bearer(s) of the PDN connection (see 3GPP TS
23.402 [2]).
### 4.3.2 WLCP layer states in the UE
#### 4.3.2.1 PDN CONNECTIVITY NOT ESTABLISHED
No PDN connectivity to EPC exists over TWAN (see figure 4.3.2.2.1).
#### 4.3.2.2 PDN CONNECTIVITY ESTABLISHED
The PDN connectivity to EPC is established in the UE (see figure 4.3.2.2.1).
Figure 4.3.2.2.1: The WLCP state machine in the UE (overview)
#### 4.3.2.3 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists (see figure 4.3.2.4.1).
#### 4.3.2.4 PROCEDURE TRANSACTION PENDING
The UE has initiated a procedure transaction towards the TWAG (see figure
4.3.2.4.1).
Figure 4.3.2.4.1: The procedure transaction states in the UE (overview)
### 4.3.3 WLCP layer states in the TWAG
#### 4.3.3.1 PDN CONNECTIVITY NOT ESTABLISHED
No PDN connectivity to EPC exists for the UE (see figure 4.3.3.4.1).
#### 4.3.3.2 PDN CONNECTIVITY PENDING
The TWAG has sent PDN connectivity accept towards the UE (see figure
4.3.3.4.1).
#### 4.3.3.3 PDN CONNECTIVITY ESTABLISHED
The PDN connectivity is established in the TWAG (see figure 4.3.3.4.1).
#### 4.3.3.4 PDN DISCONNECT PENDING
The TWAG has initiated a PDN disconnect towards the UE (see figure 4.3.3.4.1).
Figure 4.3.3.4.1: The WLCP states for PDN connectivity handling in the TWAG
(overview)
#### 4.3.3.5 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists.
#### 4.3.3.6 PROCEDURE TRANSACTION PENDING
The TWAG has initiated a procedure transaction towards the UE (see figure
4.3.3.6.1).
Figure 4.3.3.6.1: The procedure transaction states in the TWAG (overview)
## 4.3A WLCP layer states when multiple bearer PDN connectivity is used
### 4.3A.1 General
In this subclause the possible states for WLCP bearer in the UE and in the
TWAG are described when multiple bearer PDN connectivity is used. Each WLCP
bearer context is associated with an individual state machine. This state
machine shall be used when both the UE and the TWAG supports the establishment
of multiple WLCP bearers per PDN connection where a separate WLCP bearer is
established for the default S2a bearer, and for each dedicated S2a bearer
established on the S2a interface (see 3GPP TS 23.402 [2]).
### 4.3A.2 PDN connectivity and default WLCP bearer contextstates in the UE
#### 4.3A.2.1 PDN CONNECTIVITY NOT ESTABLISHED
No PDN connectivity to EPC exists over TWAN (see figure 4.3A.2.2.1).
#### 4.3A.2.1A WLCP BEARER CONTEXT INACTIVE
No default WLCP bearer context exists for the UE (see figure 4.3A.2.2.1A).
#### 4.3A.2.2 PDN CONNECTIVITY ESTABLISHED
The PDN connectivity to EPC is established in the UE (see figure 4.3A.2.2.1).
#### 4.3A.2.2A WLCP BEARER CONTEXT ACTIVE
The default WLCP bearer context exists for the UE (see figure 4.3A.2.2.1A).
Figure 4.3A.2.2.1: PDN connectivity states in the UE (overview)
Figure 4.3A.2.2.1A: Default WLCP bearer context states in the UE (overview)
#### 4.3A.2.3 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists (see figure 4.3A.2.4.1).
#### 4.3A.2.4 PROCEDURE TRANSACTION PENDING
The UE has initiated a procedure transaction towards the TWAG (see figure
4.3A.2.4.1).
Figure 4.3A.2.4.1: The procedure transaction states in the UE (overview)
### 4.3A.2A Dedicated WLCP bearer context states in the UE
#### 4.3A.2A.1 Substate WLCP BEARER CONTEXT INACTIVE
No dedicated WLCP bearer context exists (see figure 4.3A.2.2.1).
#### 4.3A.2A.2 Substate WLCP BEARER CONTEXT ACTIVE
The dedicated WLCP bearer context is active in the UE (see figure 4.3A.2.2.1).
Figure 4.3A.2A.2.1: Dedicated WLCP bearer context states in the UE (overview)
### 4.3A.3 WLCP layer PDN connectivity and default WLCP bearer context states
in the TWAG
#### 4.3A.3.1 PDN CONNECTIVITY NOT ESTABLISHED
No PDN connectivity to EPC exists for the UE (see figure 4.3A.3.5.1).
#### 4.3A.3.1A WLCP BEARER CONTEXT INACTIVE
No WLCP bearer context exists for the UE (see figure 4.3A.3.5.1A).
#### 4.3A.3.2 PDN CONNECTIVITY PENDING
The TWAG has sent PDN connectivity accept towards the UE (see figure
4.3A.3.5.1).
#### 4.3A.3.2A WLCP BEARER CONTEXT ACTIVE PENDING
The TWAG has sent PDN connectivity accept towards the UE (see figure
4.3A.3.5.1).
#### 4.3A.3.3 PDN CONNECTIVITY ESTABLISHED
The PDN connectivity is established in the TWAG (see figure 4.3A.3.5.1).
#### 4.3A.3.3A WLCP BEARER CONTEXT ACTIVE
The WLCP bearer context is active in the TWAG (see figure 4.3A.3.5.1A).
#### 4.3A.3.4 PDN DISCONNECT PENDING
The TWAG has initiated a PDN disconnect towards the UE (see figure
4.3A.3.5.1).
#### 4.3A.3.4A WLCP BEARER CONTEXT INACTIVE PENDING
The TWAG has initiated a PDN disconnect request or WLCP bearer context release
for the default WLCP bearer towards the UE (see figure 4.3A.3.5.1A).
#### 4.3A.3.5 WLCP BEARER MODIFY PENDING
The TWAG has initiated a WLCP bearer context modification towards the UE (see
figure 4.3A.3.5.1A).
Figure 4.3A.3.5.1: PDN connectivity states in the TWAG (overview)
Figure 4.3A.3.5.1A: Default WLCP bearer context states in the TWAG (overview)
### 4.3A.3A WLCP layer dedicated bearer context states in the TWAG
#### 4.3A.3A.1 WLCP BEARER CONTEXT INACTIVE
No WLCP bearer context exists for the UE (see figure 4.3A.3A.5.1).
#### 4.3A.3A.2 WLCP BEARER CONTEXT ACTIVE PENDING
The TWAG has initiated a WLCP bearer context setup towards the UE (see figure
4.3A.3A.5.1).
#### 4.3A.3A.3 WLCP BEARER CONTEXT ACTIVE
The WLCP bearer context is active in the TWAG (see figure 4.3A.3A.5.1).
#### 4.3A.3A.4 WLCP BEARER CONTEXT INACTIVE PENDING
The TWAG has initiated a WLCP bearer context release towards the UE (see
figure 4.3A.3A.5.1).
#### 4.3A.3A.5 WLCP BEARER CONTEXT MODIFY PENDING
The TWAG has initiated a WLCP bearer context modification towards the UE (see
figure 4.3A.3A.5.1).
Figure 4.3A.3A.5.1: Dedicated WLCP bearer context states in the TWAG
(overview)
## 4.4 IP address allocation
WLCP provides the following functionalities related to IP address allocation
for multi-connection mode:
\- requesting PDN type by the UE;
\- allocating IPv4 address to the UE; and
\- allocating IPv6 interface identifier to the UE.
IPv6 network prefix is assigned via stateless address autoconfiguration method
as specified in 3GPP TS 23.402 [2].
Deferred IPv4 address allocation is not supported in the current release of
this specification.
# 5 Wireless LAN control plane protocol Procedures
## 5.1 General
### 5.1.1 Overview
This clause describes principles and procedures used for Wireless LAN control
plane protocol for PDN connectivity handling in the UE and in the TWAG.
Re-transmission of WLCP messages for ensuring reliability of WLCP procedures
is supervised by timers.
### 5.1.2 Services provided by lower layers
Unless explicitly stated otherwise, WLCP procedures can be performed only if
the UE has been authenticated and has successfully negotiated the multi-
connection mode for trusted WLAN access as specified in 3GPP TS 24.302 [3].
### 5.1.3 Principles of address handling for WLCP procedures
WLCP procedures use the PTI as address parameter in the WLCP message header.
When the UE or the TWAG initiates a WLCP procedure, it shall include a valid
PTI value in the message header (see subclause 8.3).
In the response message, the sending entity shall include the PTI value
received with the request message.
Figure 5.1.3.1: Procedure initiated by the UE
Figure 5.1.3.2: Procedure initiated by the TWAG
### 5.1.4 Abnormal cases in the UE
No abnormal cases have been identified.
### 5.1.5 Abnormal cases in the TWAG
The following abnormal cases can be identified:
a) Failure of EAP-AKA\' re-authentication:
When the TWAG receives a failure indication of the re-authentication
procedure, the TWAG shall initiate TWAG-initiated PDN disconnection procedure.
### 5.1.6 Handling of APN based congestion control
As specified in subclause 5.2.4, TWAG can reject PDN connection request for an
APN from a UE and provide a Tw1 timer value to the UE.
## 5.2 PDN connectivity establishment procedure
### 5.2.1 General
The purpose of the PDN connectivity establishment procedure is to establish
PDN connectivity between the UE and the EPC. The procedure is used either to
establish the first PDN connection or to establish subsequent PDN connections.
When multiple bearer PDN connectivity model is used, the default WLCP bearer
is also established. The procedure can be initiated only after successful EAP
authentication and authorization has been completed and multi-connection mode
of operation has been negotiated, as specified in 3GPP TS 24.302 [3].
The UE and the TWAG may include a Protocol configuration options IE in PDN
connectivity establishment procedure if they wish to exchange (protocol) data
(e.g. configuration parameters, error codes or messages/events).
If there is already a PDN connection for emergency bearer services
established, the UE shall not request another PDN connection for emergency
services.
If the UE attached for emergency services, i.e.received an MCM_RESPONSE with
the AT_NOTIFICATION attribute indicating success for an MCM_REQUEST with
ATTACHMENT_TYPE item set to \"emergency attach\" or \"emergency handover\" as
specified in 3GPP TS 24.302 [3]:
\- the UE shall establish the first PDN connection for emergency services or
perform handover of an emergency PDN connection from 3GPP access; and
\- the UE shall not request any additional non-emergency PDN connections so
long as the UE is attached for emergency services.
### 5.2.2 PDN connectivity establishment procedure initiation
The UE requests PDN connectivity establishment by sending a PDN CONNECTIVITY
REQUEST message to the TWAG.
In order to request connectivity to a PDN using the default APN, the UE
includes the Access point name IE in the PDN CONNECTIVITY REQUEST message
according to the following conditions:
\- if use of a PDN using the default APN requires PAP/CHAP, then the UE should
include the Access point name IE; and
\- in all other conditions, the UE need not include the Access point name IE.
In order to request connectivity to a non-default APN or to an additional PDN,
the UE shall send a PDN CONNECTIVITY REQUEST message to the TWAG including the
requested APN.
After sending the PDN CONNECTIVITY REQUEST message the UE shall start timer
T3582 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure
5.2.2.1).
Figure 5.2.2.1: PDN connectivity establishment procedure
The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to
IPv4 if:
\- the UE is only IPv4 capable;
\- the UE is both IPv4 and IPv6 capable, has been allocated an IPv6 address
for this APN and received the ESM cause #52 \"single address bearers only
allowed\" and the request type is \"initial request\" or \"emergency\"; or
\- the UE is both IPv4 and IPv6 capable, has been allocated an IPv4 address
for this APN, received the ESM cause #52 \"single address bearers only
allowed\" and the request type is \"handover\" or \"handover of emergency
bearer services\", and has not been allocated an IPv6 address for this APN.
The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to
IPv6 if:
\- the UE is only IPv6 capable;
\- the UE is both IPv4 and IPv6 capable, has been allocated an IPv4 address
for this APN and received the ESM cause #52 \"single address bearers only
allowed\" and the request type is \"initial request\" or \"emergency\"; or
\- the UE is both IPv4 and IPv6 capable, has been allocated an IPv6 address
for this APN, received the ESM cause #52 \"single address bearers only
allowed\" and the request type is \"handover\" or \"handover of emergency
bearer services\", and has not been allocated an IPv4 address for this APN.
The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to
IPv4v6 if:
\- the UE is both IPv4 and IPv6 capable and has not been allocated an IP
address for this APN and the request type is \"initial request\" or
\"emergency\";
\- the UE capability is unknown in the UE (as in the case when the MT and TE
are separated and the capability of the TE is not known in the MT); or
\- the UE is both IPv4 and IPv6 capable, has been allocated both IPv4 address
and an IPv6 address for this APN and the request type is \"handover\" or
\"handover of emergency bearer services\".
The UE shall not set the PDN type IE to PDN type value other than IPv4, IPv6
and IPv4v6.
The UE shall set the request type to \"initial request\" when the UE is
establishing a new PDN connectivity. The UE shall set the request type to
\"handover\" when the connectivity to a PDN is to be transferred from a 3GPP
access network to the trusted WLAN access network. The UE shall set the
request type to \"emergency\" when the UE is requesting a new PDN connection
for emergency bearer services. The UE shall set the request type to \"handover
of emergency bearer services\" when a PDN connection for emergency bearer
services is to be transferred from a 3GPP access network to the trusted WLAN
access network.
If the UE supports multiple WLCP bearers as specified in 3GPP TS 23.402 [2],
the UE shall set the multiple bearer capability indicator bit to \"Multiple
WLCP bearers supported\" in the UE N3G capability IE in the PDN CONNECTIVITY
REQUEST message.
### 5.2.3 PDN connectivity establishment procedure accepted by the TWAG
Upon receipt of the PDN CONNECTIVITY REQUEST message, the TWAG checks if
connectivity with the requested PDN can be established. If no requested APN is
included in the PDN CONNECTIVITY REQUEST message and the request type is
different from \"emergency\" and from \"handover of emergency bearer
services\", the TWAG shall use the default APN as the requested APN. If the
request type is \"emergency\" or \"handover of emergency bearer services\",
the TWAG uses the APN configured for emergency bearer services or selects the
statically configured PDN GW for unauthenticated UEs, if applicable.
If the requested PDN connection can be established, the TWAG shall send a PDN
CONNECTIVITY ACCEPT message towards the UE. The TWAG shall retrieve the PTI
from the PDN CONNECTIVITY REQUEST message and include it in the PDN
CONNECTIVITY ACCEPT message. If the request type is different from
\"emergency\" and from \"handover of emergency bearer services\", both the
network identifier part and the operator identifier part shall be included in
the Access Point Name IE. Additionally, the TWAG shall include:
\- PDN connection ID to identify the PDN connection between the UE and the
TWAG;
\- MAC address of the TWAG to the UE. This MAC address is used by the UE and
the TWAG to send the user plane packets for this PDN connection; and
\- Default WLCP bearer identity if multiple WLCP bearers are used. This
default WLCP bearer identity shall be allocated by the TWAG and associated
with the default bearer of the PDN connection.
If connectivity with the requested PDN is accepted, but with a restriction of
IP version (i.e. both an IPv4 address and an IPv6 prefix is requested, but
only one particular IP version, or only single IP version bearers are
supported/allowed by the network), cause #50 \"PDN type IPv4 only allowed\",
#51 \"PDN type IPv6 only allowed\" \", or #52 \"single address bearers only
allowed\", respectively, shall be included in the PDN CONNECTIVITY ACCEPT
message. Upon sending the message the TWAG shall enter the state PDN
CONNECTIVITY PENDING and PROCEDURE TRANSACTION PENDING and start the timer
T3585.
If the UE requested PDN type IPv4v6, but the PDN GW configuration or UE
subscription dictates the use of IPv4 only or IPv6 only for this APN, the
network shall override the PDN type requested by the UE to limit it to a
single address PDN type (IPv4 or IPv6). In the PDN CONNECTIVITY ACCEPT message
the TWAG shall set the PDN type IE to either \"IPv4\" or \"IPv6\" and the ESM
cause value to #50 \"PDN type IPv4 only allowed\", or #51 \"PDN type IPv6 only
allowed\", respectively. The UE shall not subsequently initiate another UE
requested PDN connectivity procedure to the same APN to obtain a PDN type
different from the one allowed by the network until:
\- a new EAP Authentication procedure is performed (e.g. a new WLAN is
selected);
\- the PDN type which is used to access to the APN is changed;
\- the UE is switched off; or
\- the USIM is removed.
If the UE requested PDN type IPv4v6, but the operator uses single addressing
per bearer, e.g. due to interworking with nodes of earlier releases, the
network shall override the PDN type requested by the UE to a single IP version
only. In the PDN CONNECTIVITY ACCEPT message sent to the UE, the TWAG shall
set the PDN type IE to either \"IPv4\" or \"IPv6\" and the ESM cause value to
#52 \"single address bearers only allowed\". The UE should subsequently
request another PDN connection for the other IP version using the PDN
connectivity establishment procedure to the same APN with a single address PDN
type (IPv4 or IPv6) other than the one already activated.
The TWAG shall set the value of the IP Address IE in the PDN CONNECTIVITY
ACCEPT message as follows:
\- If the PDN type IE in the PDN CONNECTIVITY ACCEPT message is set to IPv4 or
IPv4v6, the PDN Address IE shall contain an IPv4 address for the UE; and
\- If the PDN type IE in the PDN CONNECTIVITY ACCEPT message is set to IPv6 or
IPv4v6, the PDN Address IE shall contain an IPv6 interface identifier.
Upon receipt of the PDN CONNECTIVITY ACCEPT message, the UE shall check the
PTI to identify the UE requested PDN connectivity, stop timer T3582 and enter
the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the PTI
assigned to this procedure is not released immediately. The way to achieve
this is implementation dependent. While the PTI value is not released, the UE
regards any received PDN CONNECTIVITY ACCEPT message with the same PTI value
as a network retransmission.
If the UE receives an IPv6 interface identifier in the PDN CONNECTIVITY ACCEPT
message, the UE may wait for the Router Advertisement from the network with
the IPv6 prefix information or it may send a Router Solicitation if necessary.
#### 5.2.3.1 PDN connectivity establishment accepted by the UE
If the UE accepts the PDN connection the UE shall send a PDN CONNECTIVITY
COMPLETE message and enter the state PDN CONNECTION ESTABLISHED.
Upon receipt of the PDN CONNECTIVITY COMPLETE message, the TWAG shall enter
the state PDN CONNECTION ESTABLISHED and stop the timer T3585, if the timer is
running (see example in figure 5.2.2.1).
#### 5.2.3.2 PDN connectivity establishment not accepted by the UE
If the UE does not accept the PDN connection the UE shall send a PDN
CONNECTIVITY REJECT message and enter the state PDN CONNECTIVITY NOT
ESTABLISHED.
The PDN CONNECTIVITY REJECT message contains a cause that typically indicates
one of the following cause values:
#31: request rejected, unspecified; or
#95 -- 111: protocol errors.
Upon receipt of the PDN CONNECTIVITY REJECT message, the TWAG shall enter the
state PDN CONNECTIVITY NOT ESTABLISHED and PROCEDURE TRANSACTION INACTIVE and
stop the timer T3585, if the timer is running (see example in figure 5.2.2.1).
### 5.2.4 PDN connectivity procedure not accepted by the TWAG
If connectivity with the requested PDN cannot be accepted by the network, the
TWAG shall send a PDN CONNECTIVITY REJECT message to the UE (see example in
figure 5.2.4.1). The message shall contain the PTI and a cause value
indicating the reason for rejecting the UE-requested PDN connectivity.
Figure 5.2.4.1: PDN connectivity establishment procedure not accepted by TWAG
The cause IE typically indicates one of the following cause values:
#8: operator determined barring;
#26: insufficient resources;
#27: missing or unknown APN;
#28: unknown PDN type;
#29: user authentication failed;
#30: request rejected by PDN GW;
#31: request rejected, unspecified;
#32: service option not supported;
#33: requested service option not subscribed;
#34: service option temporarily out of order;
#35: PTI already in use;
#38: network failure;
#50: PDN type IPv4 only allowed;
#51: PDN type IPv6 only allowed;
#52: single address bearers only allowed;
#54: PDN connection does not exist;
#55: multiple PDN connections for a given APN not allowed;
#95 -- 111: protocol errors;
#113: Multiple accesses to a PDN connection not allowed;
If the PDN type IE in the PDN CONNECTIVITY REQUEST message is set to a PDN
type value other than IPv4, IPv6 and IPv4v6, the TWAG shall set the cause IE
to #95 \"semantically incorrect message\".
If the cause value is #26 \"insufficient resources\", and the request type is
different from \"emergency\" and from \"handover of emergency bearer
services\", the network may include a value for timer Tw1 in the PDN
CONNECTIVITY REJECT message. If the request type is \"emergency\" or
\"handover of emergency bearer services\", the network shall not include the
timer Tw1 in the PDN CONNECTIVITY REJECT message.
Upon receipt of the PDN CONNECTIVITY REJECT message, the UE shall stop timer
T3582 and enter the state PROCEDURE TRANSACTION INACTIVE.
If the cause value is #26 \"insufficient resources\" and the Tw1 value IE is
included, the UE shall take different actions depending on the timer value
received for timer Tw1:
i) if the timer value indicates neither zero nor deactivated, the UE shall
stop timer Tw1 associated with the corresponding APN, if it is running. The UE
shall start timer Tw1 with the value provided in the Tw1 value IE and not send
another PDN CONNECTIVITY REQUEST message for the same APN until timer Tw1
expires, the timer Tw1 is stopped or the USIM is removed;
ii) if the timer value indicates that this timer is deactivated, the UE shall
not send another PDN CONNECTIVITY REQUEST message for the same APN until the
UE is switched off or the USIM is removed; and
iii) if the timer value indicates zero, the UE may send another PDN
CONNECTIVITY REQUEST message for the same APN;
iv) if the WLAN radio is disabled when the timer Tw1 is running and if the
USIM in the UE remains the same when the WLAN radio is enabled, the UE shall
behave as follows when the WLAN radio is enabled:
\- let t1 be the time remaining for Tw1 timeout when the WLAN radio was
disabled and let t be the time elapsed since the WLAN radio was disabled until
the WLAN radio was enabled. If t1 is greater than t, then the timer shall be
restarted with the value t1 -- t. If t1 is equal to or less than t, then the
timer need not be restarted. If the UE is not capable of determining t, then
the UE shall restart the timer with the value t1.
If the cause value is #26 \"insufficient resources\" and the Tw1 IE is not
included, the UE may send a PDN CONNECTIVITY REQUEST message for the same APN.
### 5.2.5 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Expiry of timer T3582:
\- On the first expiry of the timer T3582, the UE shall resend the PDN
CONNECTIVITY REQUEST and shall reset and restart timer T3582. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3582, the UE shall abort the procedure, release the PTI allocated for this
invocation and enter the state PROCEDURE TRANSACTION INACTIVE;
### 5.2.6 Abnormal cases on the network side
The following abnormal cases can be identified:
a) UE initiated PDN connectivity request for an already existing PDN
connection:
If the network receives a PDN CONNECTIVITY REQUEST message with the same
combination of APN and PDN type as an already existing PDN connection:
\- if the information elements in the PDN CONNECTIVITY REQUEST message do not
differ from the ones received within the previous PDN CONNECTIVITY REQUEST
message, and the TWAG has not received the PDN CONNECTIVITY COMPLETE message
from UE, the TWAG shall re-send the PDN CONNECTIVITY ACCEPT message and
continue the previous procedure; and
\- if one or more information elements in the PDN CONNECTIVITY REQUEST message
differ from the ones received within the previous PDN CONNECTIVITY REQUEST
message, and multiple PDN connections for a given APN are not allowed, the
network may release the existing PDN connection locally without notification
to the UE and proceed with the requested PDN connectivity procedure or may
reject this PDN connectivity procedure including the cause #55 \"multiple PDN
connections for a given APN not allowed\", in the PDN CONNECTIVITY REJECT
message; and
If the network receives a PDN CONNECTIVITY REQUEST message with request type
\"emergency\" and the TWAG has not received the PDN CONNECTIVITY COMPLETE
message from UE for the previous PDN connectivity request for emergency bearer
services, the network shall resend the PDN CONNECTIVITY ACCEPT message and
continue the previous procedure. If there is already a PDN connection for
emergency bearer services existing, the TWAG shall reject the request with ESM
cause #55 \"multiple PDN connections for a given APN not allowed\" or
deactivate the existing PDN connection for emergency bearer services locally
without notification to the UE and proceed with the requested PDN connectivity
procedure.
b) UE initiated PDN connectivity request with request type \"handover\" for a
PDN connection that does not exist:
If the network receives a PDN CONNECTIVITY REQUEST message for either a
default APN or a specific APN with request type set to \"handover\" and the
TWAG does not have any information about that PDN connection, then TWAG shall
reject the PDN connectivity request procedure including the cause #54 \"PDN
connection does not exist\", in the PDN CONNECTIVITY REJECT message.
c) Expiry of timer T3585:
On the first expiry of the timer T3585, the TWAG shall resend the PDN
CONNECTIVITY ACCEPT message, reset and restart timer T3585. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3585, the TWAG shall release possibly allocated resources for this activation
and shall abort the procedure.
d) A PDN CONNECTIVITY REQUEST message with request type \"handover of
emergency bearer services\" is received from a UE and the TWAG does not have
any information about a P-GW currently providing emergency bearer services for
the UE or the TWAG is not configured with an address of a P-GW in the TWAG
emergency configuration data:
TWAG shall reject the PDN connectivity request procedure including the ESM
cause #54 \"PDN connection does not exist\", in the PDN CONNECTIVITY REJECT
message.
## 5.3 TWAG initiated PDN disconnection procedure
### 5.3.1 General
The purpose of the PDN disconnection procedure is to disconnect the UE from a
PDN. With this procedure, all resources associated with this PDN connection
are released.
### 5.3.2 Procedure description
The TWAG shall initiate the PDN disconnection procedure by sending a PDN
DISCONNECT REQUEST message to the UE, start the timer T3595, and enter the
state PDN DISCONNECT PENDING and PROCEDURE TRANSACTION PENDING (see example in
figure 5.3.2.1). The PDN DISCONNECT REQUEST message contains a cause typically
indicating one of the following:
#8: operator determined barring;
#36: regular deactivation;
#38: network failure; or
#39: reactivation requested.
The TWAG may include a PCO IE in the PDN DISCONNECT REQUEST message (e.g.
configuration parameters, error codes or messages/events).
If the UE is not authenticated when the TWAG initiates the PDN disconnection
procedure, the TWAG shall locally disconnect the PDN connection towards the UE
without any WLCP signalling between the TWAG and the UE.
Figure 5.3.2.1: PDN disconnect procedure
Upon receipt of the PDN DISCONNECT REQUEST message, the UE shall release all
the resources associated with the PDN connection and respond to the TWAG with
the PDN DISCONNECT ACCEPT.
Upon sending the PDN DISCONNECT ACCEPT message, the UE shall enter the state
PDN CONNECTIVITY NOT ESTABLISHED.
If the PDN DISCONNECT REQUEST message includes cause #39 \"reactivation
requested\" the UE should stop timer Tw1 if it is running for the APN
associated with the PDN connection and re-initiate the PDN connectivity
procedure for the same APN as the disconnected PDN.
NOTE: User interaction may be necessary in some cases when the UE cannot re-
activate the PDN connection automatically.
Upon receipt of the PDN DISCONNECT ACCEPT message, the TWAG shall enter the
states PDN CONNECTIVITY NOT ESTABLISHED and PROCEDURE TRANSACTION INACTIVE and
stop the timer T3595.
### 5.3.3 Abnormal cases in the UE
Apart from the case described in subclause 5.1.3, no abnormal cases have been
identified.
### 5.3.4 Abnormal cases in the TWAG
The following abnormal cases can be identified:
a) Expiry of timer T3595:
On the first expiry of the timer T3595, the TWAG shall resend the PDN
DISCONNECT REQUEST message and shall reset and restart timer T3595. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3595, the TWAG shall abort the procedure and deactivate the PDN connection
locally without any peer-to-peer WLCP signalling between the TWAG and the UE;
and
b) Collision of UE-initiated and TWAG-initiated PDN disconnection procedure:
When the TWAG receives a PDN DISCONNECT REQUEST message during the TWAG-
initiated PDN disconnection procedure the TWAG shall proceed with the PDN
disconnection procedure.
## 5.4 UE requested PDN disconnection procedure
### 5.4.1 General
The purpose of the UE requested PDN disconnection procedure is for a UE to
request disconnection from one PDN. With this procedure, all resources
associated with this PDN connection are released.
### 5.4.2 Procedure description
In order to request PDN disconnection from a PDN, the UE shall send a PDN
DISCONNECT REQUEST message to the TWAG, start the timer T3592 and enter the
state PROCEDURE TRANSACTION PENDING (see example in figure 5.4.2.1).
Figure 5.4.2.1: UE requested PDN disconnection procedure
Upon receipt of the PDN DISCONNECT REQUEST message, the TWAG shall release all
the resources associated with the PDN connection and respond to the UE with
the PDN DISCONNECT ACCEPT message.
Upon receipt of the PDN DISCONNECT ACCEPT message, the UE shall stop the timer
T3592, deactivate all resources associated with this PDN connection and enter
the states PROCEDURE TRANSACTION INACTIVE and PDN CONNECTIVITY NOT
ESTABLISHED.
If the PDN DISCONNECT REQUEST message is not accepted by the network, the TWAG
shall send a PDN DISCONNECT REJECT message to the UE. The PDN DISCONNECT
REJECT message shall contain the PTI and a cause IE that typically indicates
one of the following cause values:
#35: PTI already in use; and
#95 -- 111: protocol errors.
Upon receipt of the PDN DISCONNECT REJECT message, the UE shall stop the timer
T3592, enter the state PROCEDURE TRANSACTION INACTIVE and abort the PDN
disconnection procedure. Additionally, the UE shall deactivate all resources
associated with this PDN connection locally without peer-to-peer signalling
between the UE and the TWAG and enter the state PDN CONNECTIVITY NOT
ESTABLISHED.
### 5.4.3 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Expiry of timer T3592:
On the first expiry of the timer T3592, the UE shall resend the PDN DISCONNECT
REQUEST and shall reset and restart timer T3592. This retransmission is
repeated four times, i.e. on the fifth expiry of timer T3592, the UE shall
abort the procedure, release all resources associated with this PDN connection
locally without peer-to-peer signalling between the UE and the TWAG, release
the PTI allocated for this invocation and enter the state PROCEDURE
TRANSACTION INACTIVE.
### 5.4.4 Abnormal cases in the TWAG
The following abnormal cases can be identified:
a) No PDN connection with the same PTI:
If the PTI included in the PDN DISCONNECT REQUEST message does not belong to
an established PDN connection, the TWAG shall reply with a PDN DISCONNECT
REJECT message with cause #54 \"PDN connection does not exist\";
## 5.5 STATUS message
The purpose of the sending of the STATUS message is to report at any time
certain error conditions detected upon receipt of WLCP protocol data. The
STATUS message can be sent by both the TWAG and the UE (see example in figure
5.5.1).
If the WLCP entity of the UE receives a STATUS message the UE shall take
different actions depending on the received cause value:
#81 (Invalid PTI value);
The UE shall abort any ongoing WLCP procedure related to the received PTI
value and stop any related timer.
#97 (Message type non-existent or not implemented);
The UE shall abort any ongoing WLCP procedure related to the PTI and stop any
related timer.
On receipt of a STATUS message with any other cause value no state transition
and no specific action shall be taken as seen from the WLAN radio interface,
i.e. local actions are possible.
If the WLCP entity of the TWAG receives a STATUS message the TWAG shall take
different actions depending on the received cause value:
#81 (Invalid PTI value);
The TWAG shall abort any ongoing WLCP procedure related to the received PTI
value and stop any related timer.
#97 (Message type non-existent or not implemented);
The TWAG shall abort any ongoing WLCP procedure related to the PTI and stop
any related timer.
The local actions to be taken by the TWAG on receipt of an STATUS message with
any other cause value are implementation dependent.
Figure 5.5.1: STATUS message
## 5.6 TWAG initiated PDN connectivity modification procedure
### 5.6.1 General
The purpose of the TWAG initiated PDN connectivity modification procedure is
for the network to modify the protocol data of the PDN connection (e.g. PCO,
routing rule). If this procedure was initiated by a UE requested PDN
connectivity modification procedure (see subclause 5.7), the PDN MODIFICATION
REQUEST shall contain the procedure transaction identity (PTI) value received
by the TWAG in the PDN MODIFICATION INDICATION message.
### 5.6.2 Procedure description
The TWAG shall initiate the PDN connectivity modification procedure by sending
a PDN MODIFICATION REQUEST message to the UE, starting the timer T3586 and
enter the state PROCEDURE TRANSACTION PENDING (see example in figure 5.6.2.1).
Figure 5.6.2.1: TWAG-initiated PDN connectivity modification procedure
### 5.6.3 PDN connectivity modification procedure accepted by the UE
Upon receipt of the PDN MODIFICATION REQUEST message, the UE may accept the
request from the TWAG by sending a PDN MODIFICATION ACCEPT message to the
TWAG. Upon receipt of the PDN MODIFICATION ACCEPT message, the TWAG shall stop
the timer T3586.
### 5.6.4 PDN connectivity modification procedure not accepted by the UE
Upon receipt of the PDN MODIFICATION REQUEST message, the UE may reject the
request from the TWAG by sending a PDN MODIFICATION REJECT message to the
TWAG.
The PDN MODIFICATION REJECT message contains a cause that typically indicates
one of the following cause values:
#31: request rejected, unspecified; or
#95 -- 111: protocol errors.
### 5.6.5 Abnormal cases in the UE
Apart from the case described in subclause 5.1.3, no abnormal cases have been
identified.
### 5.6.6 Abnormal cases in the TWAG
The following abnormal cases can be identified:
a) Expiry of timer T3586:
On the first expiry of the timer T3586, the TWAG shall resend the PDN
MODIFICATION REQUEST and shall reset and restart timer T3586. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3586, the TWAG shall abort the procedure and enter the state PDN CONNECTION
ESTABLISHED.
The TWAG may continue to use the previous configuration of the PDN
connectivity or initiate PDN disconnection procedure.
b) Collision of TWAG initiated PDN connectivity modification procedure and UE
requested PDN disconnection procedure:
When the TWAG receives a PDN DISCONNECT REQUEST message during a TWAG
initiated PDN connectivity modification procedure, the TWAG shall terminate
the PDN connectivity modification procedure locally and proceed with the PDN
disconnect procedure.
## 5.7 UE requested PDN connectivity modification procedure
### 5.7.1 General
The purpose of the UE requested PDN connectivity modification procedure is for
the UE to request the network to modify the protocol data of the PDN
connection (e.g. PCO, routing rule). If accepted by the network, this
procedure invokes a TWAG initiated PDN connectivity modification procedure
(see subclause 5.6).
### 5.7.2 Procedure description
In order to request the network to initiate PDN connectivity modification
procedure, the UE shall send a PDN MODIFICATION INDICATION message to the
TWAG, start timer T3586 and enter the state PDN MODIFICATION PENDING (see
example in figure 5.7.2.1).
Figure 5.7.2.1: UErequested PDN connectivity modification procedure
### 5.7.3 PDN connectivity modification procedure accepted by the network
Upon receipt of the PDN MODIFICATION REQUEST message, the UE shall stop the
timer T3586.
### 5.7.4 PDN connectivity modification procedure not accepted by the network
Upon receipt of the PDN MODIFICATION INDICATION message, the network may
reject the request from the UE by sending a PDN MODIFICATION REJECT message to
the UE.
The PDN MODIFICATION REJECT message contains a cause that typically indicates
one of the following cause values:
#31: request rejected, unspecified; or
#95 -- 111: protocol errors.
### 5.7.5 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Expiry of timer T3586:
On the first expiry of the timer T3586, the UE shall resend the PDN
MODIFICATION INDICATION and shall reset and restart timer T3586. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3586, the UE shall abort the procedure, release the PTI allocated for this
activation and enter the state PROCEDURE TRANSACTION INACTIVE.
b) Unknown PDN connection ID
Upon receipt of the PDN MODIFICATION REJECT message including ESM cause #43
\"invalid EPS bearer identity\", the UE shall release the existing PDN
connection locally without peer-to-peer signalling between the UE and the
TWAG.
c) Collision of a UE requested PDN connectivity modification procedure and a
TWAG initiated PDN disconnection procedure.
When the UE receives a PDN DISCONNECT REQUEST message during the PDN
connectivity modification procedure, and the PDN connection ID indicated in
the PDN DISCONNECT REQUEST message is the PDN connection ID the UE indicated
in the UE requested PDN connectivity modification procedure, then the UE shall
abort the UE requested PDN connectivity modification procedure and proceed
with the PDN disconnection procedure.
### 5.7.6 Abnormal cases in the TWAG
Apart from the case described in subclause 5.1.3, no abnormal cases have been
identified.
## 5.8 PGW initiated local PDN disconnection in the TWAG
### 5.8.1 General
A PDN connection over trusted WLAN can be released locally in the TWAG, i.e.
without any peer-to-peer signalling between the TWAG and the UE, based on the
trigger from the PGW. This can happen, for example, during the P-CSCF
restoration procedure for NBIFOM PDN connections (see 3GPP TS 23.380 [11]).
### 5.8.2 Procedure description
Upon receiving a request from PGW to release a PDN connection with cause
\"local release\" (see 3GPP TS 29.274 [12]) the TWAG shall:
\- release all resources associated with this PDN connection over WLAN; and
\- not initiate any peer-to-peer WLCP signalling to the UE.
## 5.9 Local PDN disconnection in the UE initiated from 3GPP access
### 5.9.1 General
A PDN connection over trusted WLAN can be released locally in the UE, i.e.
without any peer-to-peer signalling between the TWAG and the UE, based on the
trigger received via 3GPP access. This can happen, for example, during the
P-CSCF restoration procedure for NBIFOM PDN connections (see 3GPP TS 23.380
[11]).
### 5.9.2 Procedure description
Upon receiving over the 3GPP access:
\- a DEACTIVATE EPS BEARER CONTEXT REQUEST message with the EPS bearer context
of a default EPS bearer context and ESM cause #39 \"reactivation requested\"
(see 3GPP TS 24.301 [8]); or
\- a DETACH REQUEST message with the detach type \"re-attach required\" (see
3GPP TS 24.301 [8])
to release the resources for a PDN connection over the 3GPP access, the UE
shall:
\- release all resources associated with this PDN connection over WLAN; and
\- not initiate any peer-to-peer WLCP signalling to the TWAG.
## 5.10 WLCP bearer setup procedure
### 5.10.1 General
The purpose of the WLCP bearer setup procedure is to establish a dedicated
WLCP bearer with specific bearer level QoS and TFT between the UE and the
TWAN. The WLCP bearer setup procedure is initiated by the TWAG if:
\- the UE is connected to a trusted WLAN using the multi-connection mode
(MCM);
\- the TWAG receives from the PDN GW a Create Bearer Request message that
includes TFT and S2a bearer level QoS parameters; and
\- both the UE and TWAG support multiple bearer PDN connectivity and default
WLCP bearer identity has been assigned during PDN connection establishment.
### 5.10.2 Procedure description
#### 5.10.2.1 WLCP bearer setup procedure initiated by the TWAG
The TWAG shall initiate the WLCP bearer setup procedure by sending a WLCP
BEARER SETUP REQUEST message to the UE, start the timer T3587, and enter the
state WLCP BEARER CONTEXT ACTIVE PENDING (see figure 5.10.2.1.1).
In the WLCP BEARER SETUP REQUEST message, the TWAG shall include:
\- WLCP bearer identity to identify the WLCP bearer to be created;
\- PDN connection ID to indicate the associated PDN connection for which the
WLCP bearer is to be created;
\- MAC address of the TWAG to the UE associated with the WLCP bearer to be
created. This MAC address is used by the UE and the TWAG to send the user
plane packets to the corresponding WLCP bearer; and
\- Bearer level QoS and TFT.
Figure 5.10.2.1.1: WLCP bearer setup procedure
#### 5.10.2.2 WLCP bearer setup procedure accepted by the UE
Upon receipt of the WLCP BEARER SETUP REQUEST message, the UE shall check the
received TFT before taking it into use, send a WLCP BEARER SETUP ACCEPT
message and enter the state WLCP BEARER CONTEXT ACTIVE. The WLCP BEARER SETUP
ACCEPT message shall include the WLCP bearer identity. The UE shall use the
received TFT to apply mapping of uplink traffic flows to the WLCP bearer and
shall treat any packet filter without explicit direction as being bi-
directional.
Upon receipt of the WLCP BEARER SETUP ACCEPT message, the TWAG shall stop the
timer T3587 and enter the state WLCP BEARER CONTEXT ACTIVE.
#### 5.10.2.3 WLCP bearer setup procedure not accepted by the UE
Upon receipt of the WLCP BEARER SETUP REQUEST message, the UE may reject the
request from the TWAG by sending a WLCP BEARER SETUP REJECT message. The UE
shall include the WLCP bearer identity and a cause IE indicating the reason
for rejection in the WLCP BEARER SETUP REJECT message.
The cause typically indicates one of the following cause values:
#26: insufficient resources;
#31: request rejected, unspecified;
#41: semantic error in the TFT operation;
#42: syntactical error in the TFT operation;
#43: invalid EPS bearer identity;
#44: semantic error(s) in packet filter(s);
#45: syntactical error(s) in packet filter(s); or
#95 -- 111: protocol errors.
The UE shall check the TFT in the WLCP BEARER SETUP REQUEST request message
for different types of TFT IE errors as follows:
a) Semantic errors in TFT operations:
1) When the _TFT operation_ is an operation other than \"Create a new TFT\"
The UE shall reject the request with cause #41 \"semantic error in the TFT
operation\".
b) Syntactical errors in TFT operations:
1) When the _TFT operation_ = \"Create a new TFT\" and the packet filter list
in the TFT IE is empty.
2) When there are other types of syntactical errors in the coding of the TFT
IE, such as a mismatch between the number of packet filters subfield, and the
number of packet filters in the packet filter list.
The UE shall reject the request with cause #42 \"syntactical error in the TFT
operation\".
c) Semantic errors in packet filters:
1) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
2) When the resulting TFT does not contain any packet filter for the uplink
direction.
The UE shall reject the request with cause #44 \"semantic errors in packet
filter(s)\".
d) Syntactical errors in packet filters:
1) When the _TFT operation_ = \"Create a new TFT\" and two or more packet
filters in the resultant TFT would have identical packet filter identifiers.
2) When the _TFT operation_ = \"Create a new TFT\" and two or more packet
filters in all TFTs associated with this WLCP connection would have identical
packet filter precedence values.
3) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
In cases 1 and 3 the UE shall reject the request with cause #45 \"syntactical
errors in packet filter(s)\".
In case 2, if the old packet filters do not belong to the default WLCP bearer
context, the UE shall not diagnose an error, shall further process the request
and, if it was processed successfully, shall delete the old packet filters
which have identical filter precedence values.
In case 2, if one or more old packet filters belong to the default WLCP bearer
context, the UE shall release the relevant WLCP connection.
Upon receipt of the WLCP BEARER SETUP REJECT message in state WLCP BEARER
CONTEXT ACTIVE PENDING, the TWAG shall abort the WLCP bearer setup procedure,
stop the timer T3587, if the timer is running, and enter the state WLCP BEARER
CONTEXT INACTIVE.
### 5.10.3 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Requested PDN connection ID non-existent
If the requested PDN connection ID included in the WLCP BEARER SETUP REQUEST
message is non-existent, the UE shall reply with a WLCP BEARER SETUP REJECT
message with cause #54 \"PDN connection does not exist\".
b) WLCP bearer setup request for an already activated default WLCP bearer
If the UE receives a WLCP BEARER SETUP REQUEST message with a WLCP bearer
identity identical to the WLCP bearer identity of an already activated default
WLCP bearer, the UE shall delete the existing default WLCP bearer and all the
associated dedicated WLCP bearers, if any, and proceed with the requested
dedicated WLCP bearer setup
c) WLCP bearer setup request for an already activated dedicated WLCP bearer
If the UE receives a WLCP BEARER SETUP REQUEST message with a WLCP bearer
identity identical to the WLCP bearer identity of an already activated
dedicated WLCP bearer, the UE shall locally release the existing dedicated
WLCP bearer context and proceed with the requested dedicated WLCP bearer
setup.
### 5.10.4 Abnormal cases in the TWAG
The following abnormal cases can be identified:
a) Expiry of timer T3587:
On the first expiry of the timer T3587, the TWAG shall resend the WLCP BEARER
SETUP REQUEST and shall reset and restart timer T3587. This retransmission is
repeated four times, i.e. on the fifth expiry of timer T3587, the TWAG shall
abort the procedure, release any resources allocated for this activation and
enter the state WLCP BEARER CONTEXT INACTIVE.
b) Collision of UE requested PDN disconnection procedure and WLCP bearer setup
procedure:
When the TWAG receives a PDN DISCONNECT REQUEST message during the WLCP bearer
setup procedure, and the WLCP bearer to be setup belongs to the PDN connection
the UE wants to disconnect, the TWAG shall terminate the WLCP bearer setup
procedure locally, release any resources related to this procedure and proceed
with the PDN disconnection procedure.
## 5.11 WLCP bearer modify procedure
### 5.11.1 General
The purpose of the WLCP bearer modify procedure is to modify a dedicated WLCP
bearer context between the UE and the TWAN. The WLCP bearer modify procedure
is initiated by the TWAG if:
\- the UE is connected to a trusted WLAN using the multi-connection mode
(MCM);
\- the TWAG receives from the PDN GW a Update Bearer Request message that
includes TFT and updated S2a bearer level QoS parameters; and
\- both the UE and TWAG support multiple bearer PDN connectivity and default
WLCP bearer identity has been assigned during PDN connection establishment.
### 5.11.2 Procedure description
#### 5.11.2.1 WLCP bearer modify procedure initiated by the TWAG
The TWAG shall initiate the WLCP bearer modify procedure by sending a WLCP
BEARER MODIFY REQUEST message to the UE, start the timer T3588, and enter the
state WLCP BEARER CONTEXT MODIFY PENDING (see figure 5.11.2.1.1).
The TWAG shall include the WLCP bearer identity and its associated PDN
connection ID in the WLCP BEARER MODIFY REQUEST message to identify the WLCP
bearer context to be modified.
Figure 5.11.2.1.1: WLCP bearer modify procedure
#### 5.11.2.2 WLCP bearer modify procedure accepted by the UE
Upon receipt of the WLCP BEARER MODIFY REQUEST message, the UE shall check the
received TFT before taking it into use, send a WLCP BEARER MODIFY ACCEPT
message and enter the state WLCP BEARER CONTEXT ACTIVE. The WLCP BEARER MODIFY
ACCEPT message shall include the WLCP bearer identity. The UE shall use the
received TFT to apply mapping of uplink traffic flows to the WLCP bearer and
shall treat any packet filter without explicit direction as being bi-
directional.
The UE shall use the received TFT to apply mapping of uplink traffic flows to
the WLCP bearer if the TFT contains packet filters for the uplink direction.
Upon receipt of the WLCP BEARER MODIFY ACCEPT message, the TWAG shall stop the
timer T3588 and enter the state WLCP BEARER CONTEXT ACTIVE.
#### 5.11.2.3 WLCP bearer modify procedure not accepted by the UE
Upon receipt of the WLCP BEARER MODIFY REQUEST message, the UE may reject the
request from the TWAG by sending a WLCP BEARER MODIFY REJECT message. The UE
shall include the WLCP bearer identity and a cause IE indicating the reason
for rejection in the WLCP BEARER MODIFY REJECT message.
The cause typically indicates one of the following cause values:
#26: insufficient resources;
#31: request rejected, unspecified;
#41: semantic error in the TFT operation;
#42: syntactical error in the TFT operation;
#43: invalid WLCP bearer identity;
#44: semantic error(s) in packet filter(s);
#45: syntactical error(s) in packet filter(s); or
#95 -- 111: protocol errors.
The UE shall check the TFT in the WLCP BEARER MODIFY REQUEST message for
different types of TFT IE errors as follows:
a) Semantic errors in TFT operations:
1) _TFT operation_ = \"Create a new TFT\" when there is already an existing
TFT for the WLCP bearer.
2) When the _TFT operation_ is an operation other than \"Create a new TFT\"
and there is no TFT for the WLCP bearer.
3) _TFT operation_ = \"Delete packet filters from existing TFT\" when it would
render the TFT empty.
4) _TFT operation_ = \"Delete existing TFT\" for a dedicated WLCP bearer.
In case 4 the UE shall reject the WLCP bearer modify request with cause #41
\"semantic error in the TFT operation\".
In the other cases the UE shall not diagnose an error and perform the
following actions to resolve the inconsistency:
In case 1 the UE shall further process the request and, if it was processed
successfully, delete the old TFT.
In case 2 the UE shall:
\- process the request and if the TFT operation is \"Delete existing TFT\" or
\"Delete packet filters from existing TFT\", and if no error according to
items b, c, and d was detected, consider the TFT as successfully deleted;
\- process the request as an activation request, if the TFT operation is \"Add
packet filters in existing TFT\" or \"Replace packet filters in existing
TFT\".
In case 3, if the packet filters belong to a dedicated WLCP bearer and if no
error according to items b, c, and d was detected, the UE shall reject the
request with cause #41 \"semantic error in the TFT operation\".
In case 3, if the packet filters belong to the default WLCP bearer and if no
error according to items b, c, and d was detected, the UE shall delete the
existing TFT.
b) Syntactical errors in TFT operations:
1) When the _TFT operation_ = \"Create a new TFT\", \"Add packet filters in
existing TFT\", \"Replace packet filters in existing TFT\" or \"Delete packet
filters from existing TFT\" and the packet filter list in the TFT IE is empty.
2) _TFT operation_ = \"Delete existing TFT\" or \"No TFT operation\" with a
non-empty packet filter list in the TFT IE.
3) _TFT operation_ = \"Replace packet filters in existing TFT\" when the
packet filter to be replaced does not exist in the original TFT.
4) _TFT operation_ = \"Delete packet filters from existing TFT\" when the
packet filter to be deleted does not exist in the original TFT.
5) _TFT operation_ = \"Delete packet filters from existing TFT\" with a packet
filter list also including packet filters in addition to the packet filter
identifiers.
6) When there are other types of syntactical errors in the coding of the TFT
IE, such as a mismatch between the number of packet filters subfield, and the
number of packet filters in the packet filter list.
In case 3 the UE shall not diagnose an error, further process the replace
request and, if no error according to items c and d was detected, include the
packet filters received to the existing TFT.
In case 4 the UE shall not diagnose an error, further process the deletion
request and, if no error according to items c and d was detected, consider the
respective packet filter as successfully deleted.
Otherwise the UE shall reject the modification request with ESM cause #42
\"syntactical error in the TFT operation\".
c) Semantic errors in packet filters:
1) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
2) When the resulting TFT, which is assigned to a dedicated WLCP bearer
context, does not contain any packet filter applicable for the uplink
direction among the packet filters created on request from the network.
The UE shall reject the request with cause #44 \"semantic errors in packet
filter(s)\".
d) Syntactical errors in packet filters:
1) When the _TFT operation_ = \"Create a new TFT\", \"Add packet filters to
existing TFT\", and two or more packet filters in the resultant TFT would have
identical packet filter identifiers.
2) When the _TFT operation_ = \"Create a new TFT\", \"Add packet filters to
existing TFT\" or \"Replace packet filters in existing TFT\", and two or more
packet filters among all TFTs associated with this PDN connection would have
identical packet filter precedence values.
3) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
In case 1, if two or more packet filters with identical packet filter
identifiers are contained in the new request, the UE shall reject the request
with cause #45 \"syntactical errors in packet filter(s)\". Otherwise, the UE
shall not diagnose an error, further process the new request and, if it was
processed successfully, delete the old packet filters which have the identical
packet filter identifiers.
In case 2, if the old packet filters do not belong to the default WLCP bearer,
the UE shall not diagnose an error, shall further process the new request and,
if it was processed successfully, delete the old packet filters which have
identical filter precedence values.
In case 2, if one or more old packet filters belong to the default WLCP
bearer, the UE shall release the relevant PDN connection. If the relevant PDN
connection is the last one that the UE has, the UE shall initiate PDN
connectivity establishment procedure to re-establish the PDN connectivity to
the network.
Otherwise the UE shall reject the request with cause #45 \"syntactical errors
in packet filter(s)\".
Upon receipt of the WLCP BEARER MODIFY REJECT message with cause value other
than #43 \"invalid WLCP bearer identity\" in state BEARER CONTEXT MODIFY
PENDING, the TWAG shall abort the WLCP bearer modify procedure, stop the timer
T3588, if the timer is running, and enter the state WLCP BEARER CONTEXT
ACTIVE. If the TWAG receives the WLCP BEARER MODIFY REJECT message with cause
#43 \"invalid WLCP bearer identity\", the TWAG locally deactivates the WLCP
bearer without peer-to-peer signalling.
### 5.11.3 Abnormal cases in the UE
No abnormal cases have been identified.
### 5.11.4 Abnormal cases in the TWAG
The following abnormal cases can be identified:
a) Expiry of timer T3588:
On the first expiry of the timer T3588, the TWAG shall resend the WLCP BEARER
MODIFY REQUEST and shall reset and restart timer T3588. This retransmission is
repeated four times, i.e. on the fifth expiry of timer T3486, the TWAG shall
abort the procedure and enter the state WLCP BEARER CONTEXT ACTIVE.
The TWAG may continue to use the previous WLCP bearer context or initiate a
WLCP bearer release procedure.
b) Collision of UE requested PDN disconnection procedure and WLCP bearer
modify procedure
When the TWAG receives a PDN DISCONNECT REQUEST message during an WLCP bearer
modify procedure, and the WLCP bearer to be modified belongs to the PDN
connection the UE wants to disconnect, the TWAG shall terminate the WLCP
bearer modify procedure locally, release any resources related to this
procedure and proceed with the PDN disconnection procedure.
## 5.12 WLCP bearer release procedure
### 5.12.1 General
The purpose of the WLCP bearer release procedure is to release a dedicated
WLCP bearer between the UE and the TWAN. The WLCP bearer release procedure is
initiated by the TWAG if:
\- the UE is connected to a trusted WLAN using the multi-connection mode
(MCM);
\- both the UE and TWAG support multiple bearer PDN connectivity and default
WLCP bearer identity has been assigned during PDN connection establishment;
and
\- the TWAG receives from the PDN GW a Delete Bearer Request message that a
WLCP bearer is to be released and the WLCP bearer to be released is not
default WLCP bearer.
NOTE: if the WLCP bearer to be release is default WLCP bearer, the TWAG
invokes PDN disconnect procedure to disconnect the PDN connection and release
all associated WLCP bearers (see subclause 5.3).
### 5.12.2 Procedure description
#### 5.12.2.1 WLCP bearer release procedure initiated by the TWAG
The TWAG shall initiate the WLCP bearer release procedure by sending a WLCP
BEARER RELEASE REQUEST message to the UE, start the timer T3597, and enter the
state WLCP BEARER CONTEXT INACTIVE PENDING (see figure 5.12.2.1.1).
Figure 5.12.2.1.1: WLCP bearer release procedure
The WLCP BEARER RELEASE REQUEST message contains a cause typically indicating
one of the following:
#8: operator determined barring;
#26: insufficient resources;
#36: regular deactivation;
#38: network failure.
#### 5.12.2.2 WLCP bearer release procedure accepted by the UE
Upon receipt of the WLCP BEARER RELEASE REQUEST message, the UE shall delete
the WLCP bearer identified by the WLCP bearer identity, send a WLCP BEARER
RELEASE ACCEPT message and enter the state WLCP BEARER CONTEXT INACTIVE. The
WLCP BEARER RELEASE ACCEPT message shall include the WLCP bearer identity.
Upon receipt of the WLCP BEARER RELEASE ACCEPT message, the TWAG shall stop
the timer T3597 and enter the state WLCP BEARER CONTEXT INACTIVE.
#### 5.12.2.3 WLCP bearer release procedure not accepted by the UE
Upon receipt of the WLCP BEARER RELEASE REQUEST message, the UE may reject the
request from the TWAG by sending a WLCP BEARER RELEASE REJECT message. The UE
shall include the WLCP bearer identity and a cause IE indicating the reason
for rejection in the WLCP BEARER RELEASE REJECT message.
The cause typically indicates one of the following cause values:
#31: request rejected, unspecified;
#43: invalid WLCP bearer identity;
#95 -- 111: protocol errors.
Upon receipt of the WLCP BEARER RELEASE REJECT message in state WLCP BEARER
CONTEXT INACTIVE PENDING, the TWAG shall abort the WLCP bearer release
procedure, stop the timer T3597, if the timer is running, and enter the state
WLCP BEARER CONTEXT INACTIVE.
### 5.12.3 Abnormal cases in the UE
The following abnormal case can be identified:
a) UE is requested to deactivate a default WLCP bearer context
If the UE determines that the WLCP bearer indicated in the WLCP BEARER RELEASE
REQUEST message is the default WLCP bearer, then the UE shall respond by
performing a UE requested PDN disconnection procedure.
### 5.12.4 Abnormal cases in the TWAG
The following abnormal cases can be identified:
a) Expiry of timer T3589
On the first expiry of the timer T3589, the TWAG shall resend the WLCP BEARER
RELEASE REQUEST and shall reset and restart timer T3589. This retransmission
is repeated four times, i.e. on the fifth expiry of timer T3589, the TWAG
shall abort the procedure and deactivate the WLCP bearer context locally.
b) Collision of UE requested PDN disconnection procedure and WLCP bearer
release
When the TWAG receives a PDN DISCONNECT REQUEST message during the WLCPbearer
release procedure, and the WLCP bearer indicated in the WLCP BEARER RELEASE
REQUEST message is a dedicated WLCP bearer belonging to the PDN connection the
UE wants to disconnect, the TWAG shall proceed with both procedures. If the
WLCP bearer indicated in the WLCP BEARER RELEASE REQUEST message is the
default WLCP bearer, the TWAG shall proceed with the WLCP bearer release
procedure.
# 6 Handling of unknown, unforeseen, and erroneous protocol data
## 6.1 General
The procedures specified in the present document apply to those messages which
pass the checks described in this subclause.
This clause also specifies procedures for the handling of unknown, unforeseen,
and erroneous protocol data by the receiving entity. These procedures are
called \"error handling procedures\", but in addition to providing recovery
mechanisms for error situations they define a compatibility mechanism for
future extensions of the protocols.
Subclauses 6.1 to 6.8 shall be applied in order of precedence, starting with
subclause 6.1.
Most error handling procedures are mandatory for the UE.
Detailed error handling procedures in the TWAG are implementation dependent
and may vary from PLMN to PLMN. However, when extensions of this protocol are
developed, TWAG will be assumed to have the error handling that is indicated
in this subclause as mandatory (\"shall\") and that is indicated as strongly
recommended (\"should\").
Also, the error handling of the TWAG is only considered as mandatory or
strongly recommended when certain thresholds for errors are not reached during
a dedicated connection.
## 6.2 Message too short
When the UE receives a WLCP message which is too short to contain a complete
message type information element, the UE shall discard the message.
The TWAG shall take the same approach.
## 6.3 Unknown or unforeseen procedure transaction identity or PDN connection
ID
### 6.3.1 Procedure transaction identity
The following TWAG procedures shall apply for handling an unknown, erroneous,
or unforeseen PTI received in a WLCP message:
a) If the TWAG receives a PDN CONNECTIVITY REQUEST message with a reserved PTI
value, the TWAG shall respond with a PDN CONNECTIVITY REJECT message including
ESM cause #81 \"invalid PTI value\";
b) If the TWAG receives a PDN DISCONNECT REQUEST message with a reserved PTI
value, the TWAG shall respond with a PDN DISCONNECT REJECT message including
ESM cause #81 \"invalid PTI value\"; and
c) If the TWAG receives a WLCP message other than those listed in items a
through b above with a reserved PTI value, the TWAG shall ignore the message.
The following UE procedures shall apply for handling an unknown, erroneous, or
unforeseen PTI received in a WLCP message:
a) If the UE receives a PDN CONNECTIVITY REJECT message in which the PTI value
is an unassigned or reserved value, or an assigned value that does not match
any PTI in use, the UE shall ignore the message;
b) If the UE receives a PDN DISCONNECT REJECT message in which the PTI value
is an unassigned or reserved value, or an assigned value that does not match
any PTI in use, the UE shall ignore the message; and
c) If the UE receives a WLCP message other than those listed in items a
through b with a reserved PTI value or an assigned value that does not match
any PTI in use, the UE shall ignore the message.
### 6.3.2 PDN connection ID
The following TWAG procedures shall apply for handling an unknown, erroneous,
or unforeseen PDN connection ID received in the header of a WLCP message:
a) If the TWAG receives a PDN CONNECTIVITY REQUEST message which includes an
assigned or reserved PDN connection ID value, the TWAG shall respond with a
PDN CONNECTIVITY REJECT message including ESM cause #43 \"invalid EPS bearer
identity\";
b) If the TWAG receives a PDN DISCONNECT REQUEST message which includes an
unassigned or reserved PDN connection ID value, the TWAG shall respond with a
PDN DISCONNECT REJECT message including ESM cause #43 \"invalid EPS bearer
identity\"; and
c) If the TWAG receives a WLCP message other than those listed in items a
through b above in which the message includes a reserved PDN connection ID
value or an assigned value that does not match an existing PDN connection ID,
the TWAG shall ignore the message.
The following UE procedures shall apply for handling an unknown, erroneous, or
unforeseen PDN connection ID received in the header of a WLCP message:
a) If the UE receives a PDN CONNECTIVITY REJECT message which includes an
assigned or reserved PDN connection ID value, the UE shall ignore the message;
b) If the UE receives a PDN DISCONNECT REJECT message which includes an
unassigned or reserved PDN connection ID value or an assigned PDN connection
ID value which does not match existing PDN connection, the UE shall ignore the
message;
c) If the UE receives a PDN DISCONNECT REQUEST message which includes an
unassigned or reserved PDN connection ID value or an assigned PDN connection
ID value which does not match existing PDN connection, the UE shall ignore the
message; and
d) If the UE receives a WLCP message other than those listed in items a
through c in which the message includes an unassigned or reserved PDN
connection ID value or a value that does not match an existing PDN connection
ID, the UE shall ignore the message.
## 6.4 Unknown or unforeseen message type
If UE receives a WLCP message with message type not defined or not
implemented, the UE shall return a status message with cause #97 \"message
type non-existent or not implemented\".
If the TWAG receives a WLCP message with message type not defined or not
implemented, the TWAG shall ignore the message except that the TWAG should
return a status message with cause #97 \"message type non-existent or not
implemented\".
## 6.5 Non-semantical mandatory information element errors
### 6.5.1 Common procedures
When on receipt of a message,
\- an \"imperative message part\" error; or
\- a \"missing mandatory IE\" error
is diagnosed or when a message containing:
\- a syntactically incorrect mandatory IE;
\- an IE unknown in the message, but encoded as \"comprehension required\"
(see 3GPP TS 24.007 [7]); or
\- an out of sequence IE encoded as \"comprehension required\" (see 3GPP TS
24.007 [7]) is received,
the UE shall proceed as follows:
The UE shall return a status message with cause #96 \"invalid mandatory
information\"; and
the TWAG shall proceed as follows:
The TWAG shall either:
\- try to treat the message (the exact further actions are implementation
dependent); or
\- ignore the message except that the TWAG should return a status message with
cause #96 \"invalid mandatory information\".
### 6.5.2 PDN connection management
The following UE procedures shall apply for handling an error encountered with
a mandatory information element in a WLCP message:
a) If the message is a PDN CONNECTIVITY REQUEST, a PDN CONNECTIVITY REJECT
message with ESM cause #96 \"invalid mandatory information\", shall be
returned.
b) If the message is a PDN DISCONNECT REQUEST, a PDN DISCONNECT ACCEPT message
shall be returned. All resources associated with that PDN connection shall be
released.
The following TWAG procedures shall apply for handling an error encountered
with a mandatory information element in a WLCP message:
a) If the message is a PDN CONNECTIVITY REQUEST, a PDN CONNECTIVITY REJECT
message with ESM cause #96 \"invalid mandatory information\", shall be
returned.
b) If the message is a PDN DISCONNECT REQUEST, a PDN DISCONNECT REJECT message
with ESM cause #96 \"invalid mandatory information\", shall be returned.
## 6.6 Unknown and unforeseen IEs in the non-imperative message part
### 6.6.1 IEIs unknown in the message
The UE shall ignore all IEs unknown in a message which are not encoded as
\"comprehension required\" (see 3GPP TS 24.301 [5]).
The TWAG shall take the same approach.
### 6.6.2 Out of sequence IEs
The UE shall ignore all out of sequence IEs in a message which are not encoded
as \"comprehension required\" (see 3GPP TS 24.301 [5]).
The TWAG shall take the same approach.
### 6.6.3 Repeated IEs
If an information element with format V, TV, or TLV is repeated in a message
in which repetition of the information element is not specified in clause 7 of
the present document, the UE shall handle only the contents of the information
element appearing first and shall ignore all subsequent repetitions of the
information element. When repetition of information elements is specified, the
UE shall handle only the contents of specified repeated information elements.
If the limit on repetition of information elements is exceeded, the UE shall
handle the contents of information elements appearing first up to the limit of
repetitions and shall ignore all subsequent repetitions of the information
element.
The TWAG shall follow the same procedures.
## 6.7 Non-imperative message part errors
### 6.7.1 General
This category includes:
\- syntactically incorrect optional IEs; and
\- conditional IE errors.
### 6.7.2 Syntactically incorrect optional IEs
The UE shall treat all optional IEs that are syntactically incorrect in a
message as not present in the message.
The TWAG shall take the same approach.
### 6.7.3 Conditional IE errors
When upon receipt of a WLCP message the UE diagnoses a \"missing conditional
IE\" error or an \"unexpected conditional IE\" error, or when the UE receives
a WLCP message containing at least one syntactically incorrect conditional IE,
the UE shall ignore the message and shall return a status message with cause
#100 \"conditional IE error\".
When the TWAG receives a message and diagnoses a \"missing conditional IE\"
error or an \"unexpected conditional IE\" error or when the TWAG receives a
message containing at least one syntactically incorrect conditional IE, the
TWAG shall either:
\- try to treat the message (the exact further actions are implementation
dependent); or
\- ignore the message except that the TWAG should return a status message with
cause #100 \"conditional IE error\".
## 6.8 Messages with semantically incorrect contents
When a message with semantically incorrect contents is received, the UE shall
perform the foreseen reactions of the procedural part of the present document
(i.e. of clauses 5). If however no such reactions are specified, the UE shall
ignore the message except that the UE shall return a status message with cause
#95 \"semantically incorrect message\".
The TWAG should follow the same procedure except that a status message is not
normally transmitted.
# 7 Message functional definitions and contents
## 7.1 PDN connectivity request
### 7.1.1 Message definition
This message is sent by the UE to the network to initiate establishment of a
PDN connection. See table 7.1.1.1.
Message type: PDN CONNECTIVITY REQUEST
Direction: UE to network
Table 7.1.1.1: PDN CONNECTIVITY REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | Message | M | V | 1 | | | c | type\ | | | | | | onnectivity | 8.2 | | | | | | request | | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Transaction | M | V | 1 | | | transaction | identifier\ | | | | | | identity | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Request | Request | M | V | 1/2 | | | type | type\ | | | | | | | 8.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN type | PDN type\ | M | V | 1/2 | | | | 8.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | 28 | Access | Access | O | TLV | 3-102 | | | point name | point name\ | | | | | | | 8.6 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options\ | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 33 | NBIFOM | NBIFOM | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 8.13 | | | | +-----+-------------+-------------+----------+--------+--------+ | A- | UE N3G | UE N3G | O | TV | 1 | | | capability | capability | | | | | | | | | | | | | | 8.14 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.1.2 Access point name
This IE is included in the message when the UE wishes to request network
connectivity as defined by a certain access point name during the PDN
connection establishment procedure.
### 7.1.3 Protocol configuration options
This IE is included in the message when the UE wishes to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
### 7.1.4 NBIFOM container
This information element is used to transfer information associated with
network-based IP flow mobility, see 3GPP TS 24.161 [10].
### 7.1.5 UE N3G capability
This IE is included in the message to indicate UE capabilities related to
non-3GPP access when the UE is accessing EPC via trusted WLAN access network
during the PDN connection establishment procedure.
## 7.2 PDN connectivity accept
### 7.2.1 Message definition
This message is sent by the network to the UE to acknowledge activation of a
PDN connection. See table 7.2.1.1.
Message type: PDN CONNECTIVITY ACCEPT
Direction: network to UE
Table 7.2.1.1: PDN CONNECTIVITY ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | Message | M | V | 1 | | | c | type\ | | | | | | onnectivity | 8.2 | | | | | | accept | | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Transaction | M | V | 1 | | | transaction | identifier\ | | | | | | identity | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Access | Access | M | LV | 2-101 | | | point name | point name\ | | | | | | | 8.6 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN Address | PDN | M | LV | 6-14 | | | | address\ | | | | | | | 8.8 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | | User Plane | User Plane | M | V | 6 | | | Connection | Connection | | | | | | ID | ID\ | | | | | | | 8.10 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options\ | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 58 | Cause | Cause\ | O | TV | 2 | | | | 8.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 33 | NBIFOM | NBIFOM | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 8.13 | | | | +-----+-------------+-------------+----------+--------+--------+ | B- | WLCP bearer | WLCP bearer | O | TV | 1 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5B | Bearer | EPS quality | O | TLV | 3-15 | | | level QoS | of service | | | | | | | | | | | | | | 8.16 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5E | APN-AMBR | APN | O | TLV | 4-8 | | | | aggregate | | | | | | | maximum bit | | | | | | | rate | | | | | | | | | | | | | | 8.19 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.2.2 Protocol configuration options
This IE is included in the message when the network wishes to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
### 7.2.3 Cause
The network shall include this IE, if the network allocated a PDN address of a
PDN type which is different from the PDN type requested by the UE.
### 7.2.4 NBIFOM container
This information element is used to transfer information associated with
network-based IP flow mobility, see 3GPP TS 24.161 [10].
### 7.2.5 WLCP bearer identity
This IE is included in the message if multiple bearer PDN connectivity is used
and TWAG has assigned a WLCP bearer identity for the default WLCP bearer of
the newly activated PDN connection.
### 7.2.6 Bearer level QoS
This IE is included in the message if multiple bearer PDN connectivity is used
and the TWAG requests to provide the QoS for default WLCP bearer.
### 7.2.7 APN-AMBR
This IE is included in the message if multiple bearer PDN connectivity is used
and the TWAG requests to provide the APN-AMBR for the PDN connection.
## 7.3 PDN connectivity reject
### 7.3.1 Message definition
This message is sent by the network to the UE to reject activation of a PDN
connection. See table 7.3.1.1.
Message type: PDN CONNECTIVITY REJECT
Direction: network to UE
Table 7.3.1.1: PDN CONNECTIVITY REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | Message | M | V | 1 | | | c | type\ | | | | | | onnectivity | 8.2 | | | | | | reject | | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Transaction | M | V | 1 | | | transaction | identifier\ | | | | | | identity | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Cause | Cause\ | M | V | 1 | | | | 8.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options\ | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 37 | Tw1 value | GPRS timer | O | TLV | 3 | | | | 3 | | | | | | | | | | | | | | 8.12 | | | | +-----+-------------+-------------+----------+--------+--------+ | 33 | NBIFOM | NBIFOM | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 8.13 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.3.2 Protocol configuration options
This IE is included in the message when the network wishes to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
### 7.3.3 Tw1 value
This IE may be included in the message when the cause is #26 \"insufficient
resources\".
## 7.4 PDN disconnect request
### 7.4.1 Message definition
This message is sent by the network or the UE to initiate release of a PDN
connection. See table 7.4.1.1.
Message type: PDN DISCONNECT REQUEST
Direction: both
Table 7.4.1.1: PDN DISCONNECT REQUEST message content
* * *
IEI Information Element Type/Reference Presence Format Length
        PDN disconnect request message identity   Message type\                     M          V        1
                                                  8.2
        Procedure transaction identity            Transaction identifier\           M          V        1
                                                  8.3
        PDN connection ID                         PDN connection ID\                M          V        1
                                                  8.9
58 Cause Cause\ O TV 2 8.11
27 Protocol configuration options Protocol configuration options\ O TLV 3-253
8.7
* * *
### 7.4.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the peer entity.
## 7.5 PDN disconnect accept
### 7.5.1 Message definition
This message is sent by the network or the UE to acknowledge release of a PDN
connection. See table 7.5.1.1.
Message type: PDN DISCONNECT ACCEPT
Direction: both
Table 7.5.1.1: PDN DISCONNECT ACCEPT message content
* * *
IEI Information Element Type/Reference Presence Format Length
        PDN connectivity accept message identity   Message type8.2                   M          V        1
        Procedure transaction identity             Transaction identifier\           M          V        1
                                                   8.3
        PDN connection ID                          PDN connection ID\                M          V        1/2
                                                   8.9
27 Protocol configuration options Protocol configuration options\ O TLV 3-253
8.7
* * *
### 7.5.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the peer entity.
## 7.6 PDN disconnect reject
### 7.6.1 Message definition
This message is sent by the network to the UE to reject release of a PDN
connection. See table 7.6.1.1.
Message type: PDN DISCONNECT REJECT
Direction: network to UE
Table 7.6.1.1: PDN DISCONNECT REJECT message content
* * *
IEI Information Element Type/Reference Presence Format Length
        PDN connectivity reject message identity   Message type\                     M          V        1
                                                   8.2
        Procedure transaction identity             Transaction identifier\           M          V        1
                                                   8.3
        PDN connection ID                          PDN connection ID\                M          V        1
                                                   8.9
58 Cause Cause\ M V 1 8.11
27 Protocol configuration options Protocol configuration options\ O TLV 3-253
8.7
* * *
### 7.6.2 Protocol configuration options
This IE is included in the message when the network wishes to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.7 PDN connectivity complete
### 7.7.1 Message definition
This message is sent by the UE to acknowledge establishment of a PDN
connection. See table 7.7.1.1.
> Message type: PDN CONNECTIVITY COMPLETE
>
> Direction: UE to network
Table 7.7.1.1: PDN CONNECTIVITY COMPLETE message content
* * *
**IEI** **Information Element** **Type/Reference** **Presence** **Format**
**Length**
            PDN connectivity complete        Message type\             M              V            1
                                             8.2
            Procedure transaction identity   Transaction identifier\   M              V            1
                                             8.3
            PDN connection ID                PDN connection ID\        M              V            1
                                             8.9
* * *
## 7.8 Status message
### 7.8.1 Message definition
This message is sent by the network or the UE to report certain error
conditions detected upon receipt of WLCP protocol data as specified in
subclause 5.5. See table 7.8.1.1.
Message type: STATUS
Direction: both
Table 7.8.1.1: STATUS message content
* * *
IEI Information Element Type/Reference Presence Format Length
        Status                           Message type\             M          V        1
                                         8.2
        Procedure transaction identity   Transaction identifier\   M          V        1
                                         8.3
        PDN connection ID                PDN connection ID\        M          V        1
                                         8.9
        Cause                            Cause\                    M          V        1
                                         8.11
* * *
## 7.9 PDN modification request
### 7.9.1 Message definition
This message is sent by the network to initiate modification of a PDN
connection. See table 7.9.1.1.
Message type: PDN MODIFICATION REQUEST
Direction: network to UE
Table 7.9.1.1: PDN MODIFICATION REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN modify | Message | M | V | 1 | | | request | type\ | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Transaction | M | V | 1 | | | transaction | identifier\ | | | | | | identity | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options\ | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 33 | NBIFOM | NBIFOM | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 8.13 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.9.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the peer entity.
### 7.9.3 NBIFOM container
This information element is used to transfer information associated with
network-based IP flow mobility, see 3GPP TS 24.161 [10].
## 7.10 PDN modification accept
### 7.10.1 Message definition
This message is sent by the UE to acknowledge modification of a PDN
connection. See table 7.10.1.1.
Message type: PDN MODIFICATION ACCEPT
Direction: UE to network
Table 7.10.1.1: PDN MODIFICATION ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | Message | M | V | 1 | | | c | type8.2 | | | | | | onnectivity | | | | | | | accept | | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Transaction | M | V | 1 | | | transaction | identifier\ | | | | | | identity | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1/2 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options\ | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 33 | NBIFOM | NBIFOM | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 8.13 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.10.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the peer entity.
### 7.10.3 NBIFOM container
This information element is used to transfer information associated with
network-based IP flow mobility, see 3GPP TS 24.161 [10].
## 7.11 PDN modification reject
### 7.11.1 Message definition
This message is sent by the network or the UE to reject to modify a PDN
connection. See table 7.11.1.1.
Message type: PDN MODIFICATION REJECT
Direction: both
Table 7.11.1.1: PDN MODIFICATION REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | Message | M | V | 1 | | | c | type\ | | | | | | onnectivity | 8.2 | | | | | | reject | | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Transaction | M | V | 1 | | | transaction | identifier\ | | | | | | identity | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | 58 | Cause | Cause\ | M | V | 1 | | | | 8.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options\ | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 33 | NBIFOM | NBIFOM | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 8.13 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.11.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
### 7.11.3 NBIFOM container
This information element is used to transfer information associated with
network-based IP flow mobility, see 3GPP TS 24.161 [10].
## 7.12 PDN modification indication
### 7.12.1 Message definition
This message is sent by the UE to request the network to initiate PDN
connection modification procedure. See table 7.12.1.1.
Message type: PDN MODIFICATION INDICATION
Direction: UE to network
Table 7.12.1.1: PDN MODIFICATION INDICATION message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | Message | M | V | 1 | | | m | type\ | | | | | | odification | 8.2 | | | | | | indication | | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Transaction | M | V | 1 | | | transaction | identifier\ | | | | | | identity | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options\ | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 33 | NBIFOM | NBIFOM | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 8.13 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.12.2 Protocol configuration options
This IE is included in the message when the UE wishes to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
UE.
### 7.12.3 NBIFOM container
This information element is used to transfer information associated with
network-based IP flow mobility, see 3GPP TS 24.161 [10].
## 7.13 WLCP bearer setup request
### 7.13.1 Message definition
This message is sent by the TWAG to the UE to request activation of a WLCP
bearer for the given PDN connection. See table 7.13.1.1.
Message type: WLCP BEARER SETUP REQUEST
Significance: dual
Direction: network to UE
Table 7.13.1.1: WLCP BEARER SETUP REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | setup | type | | | | | | request | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | | User Plane | User Plane | M | V | 6 | | | Connection | Connection | | | | | | ID | ID\ | | | | | | | 8.10 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Bearer | EPS quality | M | LV | 2-14 | | | level QoS | of service | | | | | | | | | | | | | | 8.16 | | | | +-----+-------------+-------------+----------+--------+--------+ | | TFT | Traffic | M | LV | 2-256 | | | | flow | | | | | | | template | | | | | | | | | | | | | | 8.17 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.13.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.14 WLCP bearer setup accept
### 7.14.1 Message definition
This message is sent by the UE to the TWAG to acknowledge activation of a WLCP
bearer context associated with the given PDN connection ID. See table
7.14.1.1.
Message type: WLCP BEARER SETUP ACCEPT
Significance: dual
Direction: UE to TWAG
Table 7.14.1.1: WLCP BEARER SETUP ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | setup | type | | | | | | accept | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.14.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.15 WLCP bearer setup reject
### 7.15.1 Message definition
This message is sent by the UE to the TWAG to reject creation of a WLCP bearer
for the given PDN connection. See table 7.15.1.1.
Message type: WLCP BEARER SETUP REJECT
Significance: dual
Direction: UE to TWAG
Table 7.15.1.1: WLCP BEARER SETUP REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | setup | type | | | | | | reject | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Cause | Cause\ | M | V | 1 | | | | 8.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.15.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.16 WLCP bearer modify request
### 7.16.1 Message definition
This message is sent by the TWAG to the UE to request modification of a WLCP
bearer for the given PDN connection. See table 7.16.1.1.
Message type: WLCP BEARER MODIFY REQUEST
Significance: dual
Direction: network to UE
Table 7.16.1.1: WLCP BEARER MODIFY REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | modify | type | | | | | | request | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Bearer | EPS quality | O | LV | 2-14 | | | level QoS | of service | | | | | | | | | | | | | | 8.16 | | | | +-----+-------------+-------------+----------+--------+--------+ | | TFT | Traffic | O | LV | 2-256 | | | | flow | | | | | | | template | | | | | | | | | | | | | | 8.17 | | | | +-----+-------------+-------------+----------+--------+--------+ | 58 | Cause | Cause\ | O | TV | 2 | | | | 8.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5E | APN-AMBR | APN | O | TLV | 4-8 | | | | aggregate | | | | | | | maximum bit | | | | | | | rate | | | | | | | | | | | | | | 8.19 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.16.2 Bearer level QoS
This IE is included in the message when the TWAG requests a change of QoS for
the indicated traffic flows.
### 7.16.3 TFT
This IE is included in the message when the TWAG requests a change of QoS for
the indicated traffic flows packet filters.
### 7.16.4 Cause
This IE is included in the message to indicate the cause for modification.
### 7.16.5 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
### 7.16.6 APN-AMBR
This IE is included in the message when the TWAG requests to provide the APN-
AMBR for the PDN connection and the WLCP bearer identity indicates the default
bearer.
## 7.17 WLCP bearer modify accept
### 7.17.1 Message definition
This message is sent by the UE to the TWAG to acknowledge modification of a
WLCP bearer context associated with the given PDN connection ID. See table
7.17.1.1.
Message type: WLCP BEARER MODIFY ACCEPT
Significance: dual
Direction: UE to TWAG
Table 7.17.1.1: WLCP BEARER MODIFY ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | modify | type | | | | | | accept | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.17.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.18 WLCP bearer modify reject
### 7.18.1 Message definition
This message is sent by the UE to the TWAG to reject modification of a WLCP
bearer for the given PDN connection. See table 7.18.1.1.
Message type: WLCP BEARER MODIFY REJECT
Significance: dual
Direction: UE to TWAG
Table 7.18.1.1: WLCP BEARER MODIFY REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | modify | type | | | | | | reject | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Cause | Cause\ | M | V | 1 | | | | 8.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.18.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.19 WLCP bearer release request
### 7.19.1 Message definition
This message is sent by the TWAG to the UE to request release of a WLCP bearer
for the given PDN connection. See table 7.19.1.1.
Message type: WLCP BEARER RELEASE REQUEST
Significance: dual
Direction: network to UE
Table 7.19.1.1: WLCP BEARER RELEASE REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | release | type | | | | | | request | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDN | PDN | M | V | 1 | | | connection | connection | | | | | | ID | ID\ | | | | | | | 8.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.19.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.20 WLCP bearer release accept
### 7.20.1 Message definition
This message is sent by the UE to the TWAG to acknowledge release of a WLCP
bearer context associated with the given PDN connection ID. See table
7.20.1.1.
Message type: WLCP BEARER RELEASE ACCEPT
Significance: dual
Direction: UE to TWAG
Table 7.20.1.1: WLCP BEARER RELEASE ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | release | type | | | | | | accept | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.20.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
## 7.21 WLCP bearer release reject
### 7.21.1 Message definition
This message is sent by the UE to the TWAG to reject release of a WLCP bearer
for the given PDN connection. See table 7.21.1.1.
Message type: WLCP BEARER RELEASE REJECT
Significance: dual
Direction: UE to TWAG
Table 7.21.1.1: WLCP BEARER RELEASE REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | Message | M | V | 1 | | | release | type | | | | | | reject | | | | | | | message | 8.2 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Procedure | Procedure | M | V | 1 | | | transaction | transaction | | | | | | identity | identity | | | | | | | | | | | | | | 8.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | WLCP bearer | WLCP bearer | M | V | 1/2 | | | identity | identity | | | | | | | | | | | | | | 8.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 8.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Cause | Cause\ | M | V | 1 | | | | 8.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Protocol | Protocol | O | TLV | 3-253 | | | co | co | | | | | | nfiguration | nfiguration | | | | | | options | options | | | | | | | | | | | | | | 8.7 | | | | +-----+-------------+-------------+----------+--------+--------+
### 7.21.2 Protocol configuration options
This IE is included in the message when the UE or the network wishes to
transmit (protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
# 8 General message format and information elements coding
## 8.1 General
The least significant bit of a field is represented by the lowest numbered bit
of the highest numbered octet of the field. When the field extends over more
than one octet, the order of bit values progressively decreases as the octet
number increases.
Figure 8.1.1 shows an example of a field where the most significant bit of the
field is marked MSB and the least significant bit of the field is marked LSB.
* * *
7 6 5 4 3 2 1 0  
MSB x x x x x x x octet 1 x x x x x x x x  
x x x x x x x LSB octet N
* * *
Figure 8.1.1: Example of bit ordering of a field
Within the protocols defined in the present document, the WLCP message
consists of the following parts:
a) Message type;
b) Procedure transaction identity;
c) other information elements, as required.
The organization of a message is illustrated in the example shown in figure
8.1.2.
* * *
7 6 5 4 3 2 1 0  
Message type octet 1  
Procedure transaction identity octet 2  
octet 3  
Other information elements as required  
octet n
* * *
Figure 8.1.2: General message organization example for a WLCP message
Unless specified otherwise in the message descriptions of clause 7, a
particular information element shall not be present more than once in a given
message.
## 8.2 Message type
The message type octet is the first octet in a WLCP message. Table 8.2.1
defines the value part of the message type IE used in the WLCP protocol. Bit 6
to 7 are coded as \"01\" indicating it is a WLCP message.
Table 8.2.1: Message types for WLCP
Bits |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |  |   
1 | 0 | - | - | - | - | - | - |  | WLCP messages  
1 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | PDN connectivity request  
1 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | PDN connectivity accept  
1 1 | 0 0 | 0 0 | 0 0 | 0 0 | 0 1 | 1 0 | 1 0 |  | PDN connectivity reject PDN connectivity complete  
1 | 0 | 0 | 0 | 0 | 1 | 0 | 1 |  | PDN disconnect request  
1 | 0 | 0 | 0 | 0 | 1 | 1 | 0 |  | PDN disconnect accept  
1 | 0 | 0 | 0 | 0 | 1 | 1 | 1 |  | PDN disconnect reject  
1 | 0 | 0 | 0 | 1 | 0 | 0 | 0 |  | PDN modification request  
1 | 0 | 0 | 0 | 1 | 0 | 0 | 1 |  | PDN modification accept  
1 | 0 | 0 | 0 | 1 | 0 | 1 | 0 |  | PDN modification reject  
1 | 0 | 0 | 0 | 1 | 0 | 1 | 1 |  | PDN modification indication  
1 | 0 | 0 | 1 | 0 | 0 | 0 | 1 |  | WLCP bearer setup request  
1 | 0 | 0 | 1 | 0 | 0 | 1 | 0 |  | WLCP bearer setup accept  
1 | 0 | 0 | 1 | 0 | 0 | 1 | 1 |  | WLCP bearer setup reject  
1 | 0 | 0 | 1 | 0 | 1 | 0 | 1 |  | WLCP bearer modify request  
1 | 0 | 0 | 1 | 0 | 1 | 1 | 0 |  | WLCP bearer modify accept  
1 | 0 | 0 | 1 | 0 | 1 | 1 | 1 |  | WLCP bearer modify reject  
1 | 0 | 0 | 1 | 1 | 0 | 0 | 1 |  | WLCP bearer release request  
1 | 0 | 0 | 1 | 1 | 0 | 1 | 0 |  | WLCP bearer release accept  
1 | 0 | 0 | 1 | 1 | 0 | 1 | 1 |  | WLCP bearer release reject  
1 | 0 | 1 | 0 | 1 | 0 | 0 | 0 |  | Status  
## 8.3 Procedure transaction identity
The procedure transaction identity (PTI) octet is the second octet in a WLCP
message. The PTI allows distinguishing up to 254 different bi-directional
messages flows for a given message type. Such a message flow is called a
transaction. The procedure transaction identity is released when the procedure
is completed. Table 8.3.1 defines the value part of the Procedure transaction
identity IE used in the WLCP.
Table 8.3.1: Procedure transaction identity
* * *
Bits  
7 6 5 4 3 2 1 0  
0 0 0 0 0 0 0 0 No procedure transaction identity assigned 0 0 0 0 0 0 0 1 \
to } Procedure transaction identity value  
1 1 1 1 1 1 1 0 / 1 1 1 1 1 1 1 1 Reserved
In this version of the protocol the sending entity shall not set the PTI to
the value 0. Any entity receiving a request with a PTI set to the value 0
shall consider that as a syntactical error (see subclause 6.5.1).
* * *
## 8.4 Request type
See subclause 10.5.6.17 in 3GPP TS 24.008 [4].
## 8.5 PDN type
See subclause 9.9.4.10 in 3GPP TS 24.301 [5].
## 8.6 Access point name
See subclause 10.5.6.1 in 3GPP TS 24.008 [4].
## 8.7 Protocol configuration options
See subclause 10.5.6.3 in 3GPP TS 24.008 [4].
## 8.8 PDN address
See subclause 9.9.4.9 in 3GPP TS 24.301 [5].
## 8.9 PDN connection ID
The purpose of the PDN connection ID is to identify the PDN connection between
the UE and the TWAG.
The PDN connection ID information element is coded as shown in figure 8.9.1
and table 8.9.1.
* * *
7 6 5 4 3 2 1 0  
PDN connection ID IEI octet 1  
0 0 0 0 PDN connection ID octet 2  
Spare value
* * *
Figure 8.9.1: PDN connection ID information element
Table 8.9.1: PDN connection ID information element
* * *
PDN connection ID (bits 1-4)
3 2 1 0  
0 0 0 0  
to Reserved  
0 1 0 0
0 1 0 1 PDN connection ID value 5 0 1 1 0 PDN connection ID value 6 0 1 1 1
PDN connection ID value 7 1 0 0 0 PDN connection ID value 8 1 0 0 1 PDN
connection ID value 9 1 0 1 0 PDN connection ID value 10 1 0 1 1 PDN
connection ID value 11 1 1 0 0 PDN connection ID value 12 1 1 0 1 PDN
connection ID value 13 1 1 1 0 PDN connection ID value 14 1 1 1 1 PDN
connection ID value 15
* * *
## 8.10 User plane connection ID
The purpose of the user plane connection ID is to identify the user plane for
\- one PDN connection between the UE and the TWAG when multiple WLCP bearers
are not supported; or
\- the WLCP bearer of the PDN connection between the UE and TWAG when multiple
WLCP bearers are supported.
The user plane connection ID value is the MAC address of the TWAG with a
length of 6 octets. The MAC address is defined in subclause 8 of IEEE Std 802
[6].
The user plane connection ID information element is coded as shown in figure
8.10.1.
* * *
7 6 5 4 3 2 1 0  
User plane connection ID IEI octet 1  
User plane connection ID value octet 2
                                   octet 7
* * *
Figure 8.10.1: User plane connection ID information element
## 8.11 Cause
See subclause 9.9.4.4 in 3GPP TS 24.301 [5].
## 8.12 GPRS timer 3
See subclause 10.5.7.4a in 3GPP TS 24.008 [4].
## 8.13 NBIFOM container
See subclause 10.5.6.21 in 3GPP TS 24.008 [4].
## 8.14 UE N3G capability
The purpose of the UE N3G capability information element is to provide the
network with information concerning aspects of the UE capabilities related to
trusted non-3GPP access. The contents might affect the manner in which the
network handles the operation of the UE.
The UE N3G capability information element is coded as shown in figure 8.14.1
and table 8.14.1.
The UE N3G capability is a type 1 information element.
+-----------------------+-------+-------+-------+-------+---------+---+---+---+ | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | | +-----------------------+-------+-------+-------+-------+---------+---+---+---+ | UE N3G capability IEI | 0 | 0 | 0 | MBCI | octet 1 | | | | | | | | | | | | | | | | spare | spare | spare | value | | | | | +-----------------------+-------+-------+-------+-------+---------+---+---+---+
Figure 8.14.1: UE N3G capability information element
**Table 8.14.1: UE N3G capability** information element
* * *
MBCI (Multiple bearer capability indicator)
0 Multiple WLCP bearers not supported 1 Multiple WLCP bearers supported
* * *
## 8.15 WLCP bearer identity
The purpose of the WLCP bearer identity is to identify the WLCP bearer
(default or dedicated) with which one or more packet filters specified in a
traffic flow aggregate are associated.
The WLCP bearer identity information element is coded as shown in figure
8.15.1 and table 8.15.1.
The WLCP bearer identity is a type 1 information element.
* * *
7 6 5 4 3 2 1 0  
WLCP bearer identity IEI WLCP bearer identity value octet 1
* * *
Figure 8.15.1: WLCP bearer identity information element
Table 8.15.1: WLCP bearer identity information element
* * *
WLCP bearer identity (bits 0-3)
0 0 0 0  
to Reserved  
0 1 0 0
0 1 0 1 WLCP bearer identity value 5 0 1 1 0 WLCP bearer identity value 6 0 1
1 1 WLCP bearer identity value 7 1 0 0 0 WLCP bearer identity value 8 1 0 0 1
WLCP bearer identity value 9 1 0 1 0 WLCP bearer identity value 10 1 0 1 1
WLCP bearer identity value 11 1 1 0 0 WLCP bearer identity value 12 1 1 0 1
WLCP bearer identity value 13 1 1 1 0 WLCP bearer identity value 14 1 1 1 1
WLCP bearer identity value 15
* * *
## 8.16 EPS quality of service
See subclause 9.9.4.3 in 3GPP TS 24.301 [5].
## 8.17 Traffic flow template
See subclause 10.5.6.12 in 3GPP TS 24.008 [4].
## 8.18 Spare half octet
See subclause 9.9.2.9 in 3GPP TS 24.301 [5].
## 8.19 APN aggregate maximum bit rate
See subclause 9.9.4.2 in 3GPP TS 24.301 [5].
# 9 List of system parameters
## 9.1 Timers
Table 9.1.1: WLCP timers -- UE side
+----------+----------+----------+----------+----------+----------+ | TIMER | TIMER | STATE | CAUSE OF | NORMAL | ON THE\ | | | VALUE | | START | STOP | 1st, | | | | | | | 2nd, | | | | | | | 3rd, 4th | | | | | | | EXPIRY | | | | | | | (NOTE 1) | +----------+----------+----------+----------+----------+----------+ | T3582 | 8s | P | PDN | PDN | Retran | | | | ROCEDURE | CONN | CONN | smission | | | | TRA | ECTIVITY | ECTIVITY | of the | | | | NSACTION | REQUEST | ACCEPT | same | | | | PENDING | sent | received | message | | | | | | or PDN | | | | | | | CONN | | | | | | | ECTIVITY | | | | | | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3592 | 6s | P | PDN | PDN | Retran | | | | ROCEDURE | DI | DI | smission | | | | TRA | SCONNECT | SCONNECT | of the | | | | NSACTION | REQUEST | ACCEPT | same | | | | PENDING | sent | received | message | | | | | | or PDN | | | | | | | DI | | | | | | | SCONNECT | | | | | | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | Tw1 | NOTE 2 | PDN | PDN | PDN | None | | | | CONN | CONN | DI | | | | | ECTIVITY | ECTIVITY | SCONNECT | | | | | PENDING | REJECT | REQUEST | | | | | or | with a | with | | | | | SCM_ | timer | ca | | | | | RESPONSE | value | use #39 | | | | | (defined | for Tw1 | \"reac | | | | | in | r | tivation | | | | | 3GPP | eceived, | req | | | | | TS 24.30 | SCM_ | uested\" | | | | | 2 [3]) | RESPONSE | | | | | | r | (defined | | | | | | eception | in | | | | | | | 3GPP | | | | | | | TS 24.30 | | | | | | | 2 [3]) | | | | | | | with a | | | | | | | timer | | | | | | | value | | | | | | | for Tw1 | | | | | | | received | | | +----------+----------+----------+----------+----------+----------+ | T3586 | 8s | P | PDN | PDN | Retran | | | | ROCEDURE | MODI | MODI | smission | | | | TRA | FICATION | FICATION | of the | | | | NSACTION | REQUEST | ACCEPT | same | | | | PENDING | sent | received | message | | | | | | or PDN | | | | | | | MODI | | | | | | | FICATION | | | | | | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | Ty | | | | | | | pically, | | | | | | | the | | | | | | | pr | | | | | | | ocedures | | | | | | | are | | | | | | | aborted | | | | | | | on the | | | | | | | fifth | | | | | | | expiry | | | | | | | of the | | | | | | | relevant | | | | | | | timer. | | | | | | | Ex | | | | | | | ceptions | | | | | | | are | | | | | | | d | | | | | | | escribed | | | | | | | in the | | | | | | | corre | | | | | | | sponding | | | | | | | p | | | | | | | rocedure | | | | | | | desc | | | | | | | ription. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | value of | | | | | | | this | | | | | | | timer | | | | | | | can be | | | | | | | provided | | | | | | | by the | | | | | | | network | | | | | | | operator | | | | | | | when a | | | | | | | request | | | | | | | to | | | | | | | activate | | | | | | | a PDN | | | | | | | co | | | | | | | nnection | | | | | | | is | | | | | | | rejected | | | | | | | by the | | | | | | | network | | | | | | | with a | | | | | | | certain | | | | | | | cause or | | | | | | | when a | | | | | | | request | | | | | | | to | | | | | | | activate | | | | | | | a PDN | | | | | | | co | | | | | | | nnection | | | | | | | in | | | | | | | s | | | | | | | ingle-co | | | | | | | nnection | | | | | | | mode | | | | | | | (defined | | | | | | | in | | | | | | | 3GPP | | | | | | | TS 24.30 | | | | | | | 2 [3]) | | | | | | | is | | | | | | | rejected | | | | | | | by the | | | | | | | network | | | | | | | with a | | | | | | | certain | | | | | | | cause. | | | | | | +----------+----------+----------+----------+----------+----------+
Table 9.1.2: WLCP timers -- TWAG side
+----------+----------+----------+----------+----------+----------+ | TIMER | TIMER | STATE | CAUSE OF | NORMAL | ON THE\ | | | VALUE | | START | STOP | 1st, | | | | | | | 2nd, | | | | | | | 3rd, 4th | | | | | | | EXPIRY | | | | | | | (NOTE 1) | +----------+----------+----------+----------+----------+----------+ | T3585 | 8s | PDN | PDN | PDN | Retran | | | | CONN | CONN | CONN | smission | | | | ECTIVITY | ECTIVITY | ECTIVITY | of the | | | | PENDING | ACCEPT | COMPLETE | same | | | | | sent | received | message | | | | P | | | | | | | ROCEDURE | | or PDN | | | | | TRA | | CONN | | | | | NSACTION | | ECTIVITY | | | | | PENDING | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3595 | 8s | PDN | PDN | PDN | Retran | | | | DI | DI | DI | smission | | | | SCONNECT | SCONNECT | SCONNECT | of the | | | | PENDING | REQUEST | ACCEPT | same | | | | | sent | received | message | | | | P | | | | | | | ROCEDURE | | | | | | | TRA | | | | | | | NSACTION | | | | | | | PENDING | | | | +----------+----------+----------+----------+----------+----------+ | T3586 | 8s | P | PDN | PDN | Retran | | | | ROCEDURE | MODI | MODI | smission | | | | TRA | FICATION | FICATION | of the | | | | NSACTION | REQUEST | ACCEPT | same | | | | PENDING | sent | received | message | | | | | | or PDN | | | | | | | MODI | | | | | | | FICATION | | | | | | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3587 | 8s | WLCP | WLCP | WLCP | Retran | | | | BEARER | BEARER | BEARER | smission | | | | CONTEXT | SETUP | SETUP | of the | | | | ACTIVE | REQUEST | ACCEPT | same | | | | PENDING | sent | received | message | | | | | | or WLCP | | | | | | | BEARER | | | | | | | SETUP | | | | | | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3588 | 8s | WLCP | WLCP | WLCP | Retran | | | | BEARER | BEARER | BEARER | smission | | | | CONTEXT | MODIFY | MODIFY | of the | | | | MODIFY | REQUEST | ACCEPT | same | | | | PENDING | sent | received | message | | | | | | or WLCP | | | | | | | BEARER | | | | | | | MODIFY | | | | | | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3597 | 8s | WLCP | WLCP | WLCP | Retran | | | | BEARER | BEARER | BEARER | smission | | | | CONTEXT | RELEASE | RELEASE | of the | | | | INACTIVE | REQUEST | ACCEPT | same | | | | PENDING | sent | received | message | | | | | | or or | | | | | | | WLCP | | | | | | | BEARER | | | | | | | RELEASE | | | | | | | REJECT | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | Ty | | | | | | | pically, | | | | | | | the | | | | | | | pr | | | | | | | ocedures | | | | | | | are | | | | | | | aborted | | | | | | | on the | | | | | | | fifth | | | | | | | expiry | | | | | | | of the | | | | | | | relevant | | | | | | | timer. | | | | | | | Ex | | | | | | | ceptions | | | | | | | are | | | | | | | d | | | | | | | escribed | | | | | | | in the | | | | | | | corre | | | | | | | sponding | | | | | | | p | | | | | | | rocedure | | | | | | | desc | | | | | | | ription. | | | | | | +----------+----------+----------+----------+----------+----------+
###### ## Annex A (informative): Cause values for WLCP protocol
# A.1 Causes related to nature of request
For the purposes of the present document, causes related to nature of request
defined in subclause Annex B.1 of 3GPP TS 24.301 [5] apply.
# A.2 Protocol errors (e.g., unknown message) class
For the purposes of the present document, causes related to nature of request
defined in subclause Annex B.2 of 3GPP TS 24.301 [5] apply except the
following causes which are redefined for WLCP protocol:
Cause #43 -- Invalid WLCP bearer identity
This cause is used by the TWAG or the UE to indicate that the WLCP bearer
identity value provided to it is not a valid value for the received message or
the PDN connection ID provided in the request is not active.
###### ## Annex B (Informative): IANA UDP port registration form
This annex contains information to be provided to IANA for WLCP UDP port
registration. The following information are to be used to register WLCP user
port number and service name in the \"IANA Service Name and Transport Protocol
Port Number Registry\" and specifically \"Service Name and Transport Protocol
Port Number Registry\".
+----------------------------------+----------------------------------+ | Resources required | Port number and service name | +----------------------------------+----------------------------------+ | Transport Protocols | UDP | +----------------------------------+----------------------------------+ | Service Code | | +----------------------------------+----------------------------------+ | Service Name | wlcp | +----------------------------------+----------------------------------+ | Desired Port Number | | +----------------------------------+----------------------------------+ | Description | Wireless LAN Control plane | | | Protocol (WLCP) is a 3GPP | | | control protocol used by the | | | User Equipment (UE) for access | | | to the Evolved Packet Core via | | | trusted Wireless Local Area | | | Network. It enables the | | | management of the Packet Data | | | Network (PDN) connections | | | between the User Equipment (UE) | | | and the Trusted WLAN Access | | | Gateway (TWAG). | | | | | | Wireless LAN Control plane | | | Protocol (WLCP) uses UDP as a | | | transport protocol. | +----------------------------------+----------------------------------+ | Reference | 3GPP TS 24.244 | +----------------------------------+----------------------------------+ | Defined TXT keys | N/A | +----------------------------------+----------------------------------+ | If broadcast/multicast is used, | Neither broadcast, nor multicast | | how and what for? | are used. | +----------------------------------+----------------------------------+ | If UDP is requested, please | At maximum a few WLCP messages | | explain how traffic is limited, | per seconds are expected in | | and whether the protocol reacts | communication between a given | | to congestion. | User Equipment (UE) and a given | | | Trusted WLAN Access Gateway | | | (TWAG). | | | | | | Wireless LAN Control plane | | | Protocol does not support any | | | reaction to congestion. | +----------------------------------+----------------------------------+ | If UDP is requested, please | Wireless LAN Control plane | | indicate whether the service is | Protocol is not used solely for | | solely for the discovery of | discovery of hosts supporting | | hosts supporting this protocol. | this protocol. | +----------------------------------+----------------------------------+ | Please explain how your protocol | Wireless LAN Control plane | | supports versioning. | Protocol does not support | | | versioning. | +----------------------------------+----------------------------------+ | If your request is for more than | N/A | | one transport, please explain in | | | detail how the protocol differs | | | over each transport. | | +----------------------------------+----------------------------------+ | Please describe how your | Wireless LAN Control plane | | protocol supports security. Note | Protocol does not support | | that presently there is no IETF | security. It relies on the | | consensus on when it is | security mechanisms of the lower | | appropriate to use a second port | layers, including EAP-AKA\' | | for an insecure version of a | authentication and IEEE 802.1x | | protocol. | encryption. | +----------------------------------+----------------------------------+ | Please explain why a unique port | > An assigned User Port would | | assignment is necessary as | > make network management | | opposed to a port in range | > easier. It is possible that | | (49152-65535) or existing port. | > packets containing WLCP | | | > messages need to traverse | | | > several firewalls of the | | | > network operator during the | | | > signalling exchange between | | | > the User Equipment (UE) and | | | > the Trusted WLAN Access | | | > Gateway (TWAG). The firewalls | | | > of the network operator are | | | > configured to discard packets | | | > other than those containing | | | > the WLCP messages and other | | | > than those authorized by the | | | > WLCP messages. If a dynamic | | | > ephemeral port is used for | | | > WLCP messages, the firewall | | | > configuration needs to be | | | > updated whenever a new port | | | > starts being used for WLCP | | | > messages in the Trusted WLAN | | | > Access Gateway (TWAG). | | | > | | | > An assigned User Port would | | | > make roaming agreements | | | > between network operators | | | > easier. If a dynamic port is | | | > used, each operator will need | | | > to provide the port number | | | > used by its TWAG to other | | | > operators, then the home | | | > operator needs to configure in | | | > its AAA sever the list of port | | | > numbers (in addition to the IP | | | > addresses) of the TWAGs of its | | | > roaming partners. If dynamic | | | > port is used, the port number | | | > can change frequently (while | | | > the IP address of the TWAG | | | > does not change frequently). | | | > Each time the port number | | | > changes, the roaming agreement | | | > documents needs to be updated. | | | > If dynamic port is used, the | | | > procedure to update the port | | | > numbers on the AAA server can | | | > cause a short interruption of | | | > the service. | | | > | | | > As a general principle, 3GPP | | | > protocols use assigned User | | | > Ports, e.g. GTP-C uses UDP | | | > port number 2123, GTP-U uses | | | > UDP port number 2152, S1AP | | | > uses SCTP port number 36412, | | | > X2AP uses SCTP port number | | | > 36422\. IKEv2 is an example of | | | > an IETF protocol between the | | | > terminal and a gateway that | | | > uses a well-known port number. | | | > | | | > An assigned UDP port number | | | > would simplify the UE | | | > implementation. The UDP port | | | > number management between the | | | > application processor (AP) and | | | > the cellular modem would be | | | > simplified if the UDP port for | | | > WLCP could be set as a | | | > well-known port number. | | | > Specifically, there would be a | | | > need for an additional API | | | > between the WLCP client in the | | | > AP and the modem to identify | | | > the WLCP packets if dynamic | | | > ports are used. | +----------------------------------+----------------------------------+ | Please explain the state of | Protocol Standard definition. No | | development of your protocol. | implementation exists yet. | +----------------------------------+----------------------------------+ | If SCTP is requested, is there | N/A | | an existing TCP and/or UDP | | | service name or port number | | | assignment? If yes, provide the | | | existing service name and port | | | number. | | +----------------------------------+----------------------------------+ | What specific SCTP capability is | N/A | | used by the application such | | | that a user who has the choice | | | of both TCP (and/or UDP) and | | | SCTP ports for this application | | | would choose SCTP? See [RFC | | | 4960] | | | (http://www.iana.org/go/rfc4960) | | | section 7.1. | | +----------------------------------+----------------------------------+ | Please provide any other | This protocol is between the UE | | information that would be | (i.e. mobile device) and the | | helpful in understanding how | Trusted WLAN Gateway. The UDP | | this protocol differs from | ports previously assigned to | | existing assigned services | 3GPP were for protocols between | | | network elements. | +----------------------------------+----------------------------------+
#
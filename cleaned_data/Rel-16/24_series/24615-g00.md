# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the stage 3, Protocol Description of the
Communication Waiting (CW) service, based on stage 1 and stage 2 of the ISDN
call waiting supplementary services. It provides the protocol details in the
IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation
Protocol (SIP) and the Session Description Protocol (SDP).
The **Communication Waiting (CW)** service enables a user to be informed, that
very limited resources are available for an incoming communication. The user
then has the choice of accepting, rejecting or ignoring the waiting call (as
per basic call procedures).
The present document is applicable to User Equipment (UE) and Application
Servers (AS) which are intended to support the CW supplementary service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 22.173: \"IP Multimedia Core Network Subsystem (IMS) Multimedia
Telephony Service and supplementary services; Stage 1\".
[2] 3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol
based on Session Initiation Protocol (SIP) and Session Description Protocol
(SDP); Stage 3\".
[3] Void.
[4] 3GPP TS 24.628: \"Common Basic Communication procedures using IP
Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".
[5] 3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[6] 3GPP TS 22.228: \"Service requirements for the Internet Protocol (IP)
multimedia core network subsystem (IMS); Stage 1\".
[7] 3GPP TS 24.623: \"Extensible Markup Language (XML) Configuration Access
Protocol (XCAP) over the Ut interface for Manipulating Supplementary
Services\".
[8] RFC 7462 (March 2015): \"URNs for the Alert-Info Header Field of the
Session Initiation Protocol (SIP)\".
[9] RFC 5621 (September 2009): \"Message Body Handling in the Session
Initiation Protocol (SIP)\".
[10] 3GPP TS 24.238: \"Session Initiation Protocol (SIP) based user
configuration\".
[11] RFC 6432:(November 2011) \"Carrying Q.850 Codes in Reason Header Fields
in SIP (Session Initiation Protocol) Responses\".
[12] RFC 3326 (December 2002): \"The Reason Header Field for the Session
Initiation Protocol (SIP)\".
[13] RFC 3023 (January 2001): \"XML Media Types\".
[14] RFC 7044 (February 2014): \"An Extension to the Session Initiation
Protocol (SIP) for Request History Info\".
[15] RFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".
[16] RFC 3459 (January 2003): \"Critical Content Multi-purpose Internet Mail
Extensions (MIME) Parameter\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For definitions used in this document see:
\- 3GPP TS 22.173 [1]
**User B:** User B is the user who reacts to the communication waiting at
subscriber B. User B is the served user for the communication waiting service.
**User C:** User C is the user who has originated a communication to
subscriber B which causes the CW supplementary service to be invoked.
**User A:** User A is a user (several such users may exist) who is engaged in
a communication with User B (this communication can be in any state).
**Network determined user busy:** See 3GPP TS 22.173 [1] Annex Da.
**Approaching Network determined user busy:** See 3GPP TS 22.173 [1] Annex Da.
**User determined user busy:** See 3GPP TS 22.228 [6].
**Network based CW:** CW when the network detects the CW condition and informs
the UE about the conditon.
**Terminal based CW:** CW when the UE detects the CW condition and informs the
network about the condition.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
**AoC** Advice of Charge
**CAT** Customized Alerting Tones
**CCBS** Completion of Communication sessions to Busy Subscriber
**CD** Communication Deflection
**CDIV** Communication Diversion
**CFB** Communication Forwarding Busy
**CFNL** Communication Forwarding on Not Logged-in
**CFNR** Communication Forwarding No Reply
**CFU** Communication Forwarding Unconditional
**FA** Flexible Alerting
**OIP** Originating Identification Presentation
**OIR** Originating Identification Restriction
**TIP** Terminating Identification Presentation
**TIR** Terminating Identification Restriction
**CW** Communication Waiting
**GRUU** Globally Routable User agent URI
**HOLD** Communication Hold
**IFC Initial Filter Criteria**
**IMS** IP Multimedia Subsystem
**IP** Internet Protocol
**ISDN** Integrated Services Digital Network
**MCID** Malicious Communication Identification
**MiD** Multi-iDentity
**MuD** Multi-Device
**NDUB Network Determined User Busy**
**SIP** Session Initiation Protocol
**UDUB User Determined User Busy**
**UE** User Equipment
# 4 Communication Waiting (CW)
## 4.1 Introduction
The Communication Waiting (CW) service enables a UE to be informed that no
resources are available for an incoming communication. The user then has the
choice of accepting, rejecting or ignoring the incoming communication (as per
basic communication procedures).
## 4.2 Description
### 4.2.1 General description
Two cases can occur depending on the network\'s ability to validate the status
of the destination user upon receipt of an incoming communication and where
the CW condition is determined (i.e. \"approaching NDUB\" condition):
\- network based CW, i.e. sufficient information on the user is available at
the time a communication is to be delivered to the user, the network validates
the status of this user. If the status of the user is \"approaching NDUB\",
the network presents the waiting communication to the destination user; or
\- terminal based CW, the network may be informed of the communication waiting
situation upon receipt from the destination user of a communication waiting
indication (i.e. the CW condition is determined by the UE using UDUB).
When a communication arrives at the destination user, the UE validates the
status of the user. If the user is already involved in one or more
communications, the terminal notifies the served user of a communication
waiting situation.
The user then has different possibilities to react, for example if it may
decide to free some resources and accept the incoming communication.
NOTE: The procedures for NDUB are out of scope of this specification.
Information for the handling of NDUB can be found in 3GPP TS 22.173 [1] Annex
Da and 3GPP TS 24.628 [4] clause B.2.
## 4.3 Operational requirements
### 4.3.1 Provision/withdrawal
The Communication Waiting service shall be provided after prior arrangement
with the service provider.
The CW service can as a network option, be offered to the corresponding users
with a subscription option. This subscription option is part of the CW profile
of the served user. The subscription option is shown in the table 4.3.1.1.
Table 4.3.1.1: Subscription option for CW
+----------------------------------+----------------------------------+ | Subscription option | Value | +----------------------------------+----------------------------------+ | _Served user_ subscribes to | No (default)\ | | \"calling user receives | ________ | | notification that his/her | ________________ | | communication is waiting\" | | | | Yes (NOTE) | +----------------------------------+----------------------------------+ | NOTE: The notification can take | | | the form of an announcement | | | played to user C, or an out-of | | | band notification or both. This | | | is up to the network operator to | | | decide. | | +----------------------------------+----------------------------------+
Timer T~AS-CW~ is a service provider option. This optional timer specifies the
period the network will wait for a response (answer), from user B, to the
offered communication from user C. The timer value is specified in subclause
4.7.
NOTE: When used, the value of T~AS-CW~ is set by the service provider as a
default value subject to change only by the service provider.
## 4.4 Coding requirements
### 4.4.1 CW indication
The XML schema for the CW information XML body is defined in table 4.4.1.1.
Table 4.4.1.1: IM CN subsystem CW XML body, XML Schema
\
\
\
\
\
\
\
\
\
\
\
\
The CW XML schema shall be transported as a SIP MIME body. The MIME type for
the CW information is \"application/vnd.3gpp.cw+xml\" (see subclause 5.1). Any
SIP message that transports a body with CW information shall identify the
payload as the MIME type associated with CW information (see subclause 5.1).
### 4.4.2 CW notification
Usage of the urn namespace \"alert\" with the sub-label \"service\" and its
initial value \"call-waiting\" within the Alert-Info header field is described
in RFC 7462 [8].
## 4.5 Signalling requirements
### 4.5.1 General
Configuration of supplementary services by the user should:
\- take place over the Ut interface using XCAP as enabling protocol as
described in 3GPP TS 24.623 [7]; or
\- use SIP based user configuration as described in 3GPP TS 24.238 [10].
NOTE: Other possibilities for user configuration, such as web-based
provisioning or pre-provisioning by the operator are outside the scope of the
present document, but are not precluded.
The enhancements to the XML schema for use over the Ut interface is described
in subclause 4.8.
### 4.5.2 Activation/deactivation
The service CW is individually activated at provisioning or at the
subscriber\'s request.
The service CW is individually deactivated at withdrawal or at the
subscriber\'s request.
### 4.5.3 Registration/erasure
The CW service requires no registration. Erasure is not applicable.
### 4.5.4 Interrogation
For interrogation of CW the mechanisms specified in subclause 4.5.1 should be
used.
### 4.5.5 Invocation and operation
#### 4.5.5.1 Actions at the UE of user C
The procedures described for the originating UE in 3GPP TS 24.229 [2] shall
apply with the clarifications below.
Upon receipt of a 180 (Ringing) response with an Alert-Info header field set
to \"\\" according to RFC 7462 [8], the UE may
indicate that the outgoing communication is being treated as a waiting
communication.
#### 4.5.5.2 Actions at the AS of user B
##### 4.5.5.2.1 General
The AS shall operate as a SIP proxy as specified in subclause 5.7.4 of 3GPP TS
24.229 [2] or operate as a routing B2BUA as specified in subclause 5.7.5 of
3GPP TS 24.229 [2] for the incoming INVITE request and all future requests and
responses in the same dialog.
NOTE: For the case when CW, according to the requirements in this document, is
the only service being applied by the AS and if none of the \"approaching
NDUB\" condition, the \"calling user receives notification that his
communication is waiting\" option and the \"T~AS-CW~ timer\" option are used,
then the AS only needs to act as a SIP proxy. If additional services are
applied, then the AS might need to act as a routeing B2BUA.
If a CW condition occurs, upon receipt of a 180 (Ringing) response, the AS
shall as a network option start the T~AS-CW~ timer. Upon expiry of the T~AS-CW
~timer, the AS shall send a CANCEL request towards the user B\'s UE as
described in 3GPP TS 24.229 [2] including a Reason header field (see RFC 3326
[12]) with the protocol set to \"SIP\" and the cause set to \"408\", and a 480
(Temporarily unavailable) response towards user C, including a Reason header
field with the protocol set to \"Q.850\" and the cause set to \"19\", in
accordance with RFC 6432 [11].
##### 4.5.5.2.2 AS supporting the network based CW
The AS shall determine that a CW condition has occurred when one of the
following conditions are met:
\- receipt of an INVITE request that fulfils the \"approaching NDUB\"
condition for user B; or
\- receipt of a 486 (Busy here) response with a 370 Warning header field
indicating \"insufficient bandwidth\".
When the CW condition is met:
\- if the Contact header received from user B in the establishment or
modification of the the existing active communication contained a GRUU then
the AS shall:
a) include that GRUU in the Request-URI in the INVITE request;
b) include as the hi-entry in the History-Info header field the contents of
the Request-URI from the received INVITE request according to RFC 7044 [14] if
it was not already present; and
c) include as the last hi-entry in the History-Info header field the contents
of the new Request-URI (with the GRUU) including the \"rc\" header field
parameter as described in RFC 7044 [14];
\- if the CW indication is supported, the AS may insert a MIME body according
to subclause 4.4.1 in the INVITE request, with the \ element contained in the \ root element. If the MIME body
described in subclause 4.4.1 is inserted, the AS shall set the Content-Type
header field of the inserted MIME body to \"application/vnd.3gpp.cw+xml\", and
set the Content-Disposition header field of the inserted MIME body to
\"render\" as specified in RFC 3261 [15] and include the \"handling\" header
field parameter set to \"optional\" as specified in RFC 3459 [16];
\- if required by operator policy, the AS shall include the Expires header
field set to the value of T~AS-CW~ timer; and
\- the AS shall forward or send the INVITE request to user B.
NOTE: If the user is roaming, and the terminating P-CSCF is in the visited
network, this functionality can only be supported if an SLA (Service Level
Agreement) exists between the operators to provide the related functionality.
If the CW condition was determined by the AS based on validation of the
\"approaching NDUB\" condition and if the subscription option \"calling user
receives notification that his communication is waiting\" is set to \"Yes\",
then after receipt of a 180 (Ringing) response from user B:
\- the AS may provide an announcement to user C in accordance with 3GPP TS
24.628 [4]; and
\- if not included, the AS shall insert an Alert-Info header field set to
\"\\" according to RFC 7462 [8] in the 180
(Ringing) response and forward it to user C.
After the receipt of a 415 (Unsupported Media Type) response, the AS shall
reject the communication by sending a 486 (Busy Here) response to user C.
##### 4.5.5.2.3 AS supporting the terminal based CW
The AS shall determine that a CW condition has occurred on receipt of a 180
(Ringing) response with an Alert-Info header field set to
\"\\" according to RFC 7462 [8].
When the CW condition is met:
a) If the subscription option \"calling user receives notification that
his/her communication is waiting\" is set to \"Yes\", the AS may initiate the
procedures for notifying user C by performing a combination of the following
actions:
1\. provide an announcement to the calling user in accordance with 3GPP TS
24.628 [4]; and
2\. forward the 180 (Ringing) response to the calling party; and
b) If the subscription option \"calling user receives notification that
his/her communication is waiting\" is set to \"No\", the AS shall:
1\. remove the Alert-Info header field set to \"\\" from the received 180 (Ringing) response; and
2\. forward the modified 180 (Ringing) response to the calling party.
#### 4.5.5.3 Actions at the UE of user B
##### 4.5.5.3.1 General
Basic communication procedures according to 3GPP TS 24.229 [2] shall apply
with the clarifications and additions described in the following subclauses.
##### 4.5.5.3.2 Communication waiting presentation procedures
When receiving an initial INVITE request, the UE shall determine the CW
condition and the UDUB condition.
Upon detecting CW condition and if the maximum number of waiting
communications is not reached (i.e. UDUB condition has not occured) the UE
shall:
a) provide a CW indication to the user;
b) optionally, if the INVITE includes an Expires header field, use the value
of this header field to provide the time to expiry information of the
communication waiting to the user;
c) optionally start timer T~UE-CW~;
> NOTE 1: The timer T~UE-CW~ is used in order to limit the duration of the CW
> condition at the UE. For terminals that can provide an indication to the
> user that a CW condition is occuring without disturbing the active
> communication, this timer is not needed.
d) if the received INVITE:
\- does not contain a MIME body according to subclause 4.4.1;
\- the UE does not support the MIME body specified in subclause 4.4.1; or
\- contains a MIME body according to subclause 4.4.1 with the \ element contained in the \ root element and a
Content-Type header field set to \"application/vnd.3gpp.cw+xml\" and the
\"handling\" header field parameter in the Content-Disposition header field of
the inserted MIME body is set to \"optional\";
then the UE shall insert an Alert-Info header field, set to
\"\\", specified in RFC 7462 [8], in the 180
(Ringing) response in accordance with the provisional response procedures
described in 3GPP TS 24.229 [2]; and
e) if the UE supports the MIME body specified in subclause 4.4.1 and the
received INVITE contains a MIME body according to subclause 4.4.1 with the
\ element contained in the \ root
element and a Content-Type header field set to
\"application/vnd.3gpp.cw+xml\", then the UE shall send a 180 (Ringing)
response to the INVITE request according to the provisional response
procedures described in 3GPP TS 24.229 [2];
NOTE 2: RFC 5621 [9] describes conditions under which a 415 (Unsupported Media
Type) response is returned.
##### 4.5.5.3.3 User B actions during communication waiting condition
**[Case A]{.underline}**
If user B accepts the waiting communication and holds (per procedures in 3GPP
TS 24.610 [5]) or releases (per procedures in 3GPP TS 24.229 [2]) the active
communication and timer T~UE-CW~ has not expired, user B\'s UE shall:
\- stop timer T~UE-CW~ (if it has been started);
\- stop providing the CW indication to user B; and
\- apply the procedures for answering the waiting communication to user B as
described in 3GPP TS 24.229 [2].
**[Case B]{.underline}**
If T~UE-CW~ was started and expires, user B\'s UE shall:
\- stop providing the CW indication to user B; and
\- send a 480 (Temporarily Unavailable) response towards user C, optionally
including a Reason header field set to cause \"19\", in accordance with RFC
6432 [11].
##### 4.5.5.3.4 Communication release during a communication waiting condition
If user B\'s UE receives a CANCEL request or BYE request from user C during a
CW condition, user B\'s UE shall:
\- stop timer T~UE-CW~ (if necessary);
\- stop providing the CW indication to user B; and
\- apply the terminating UE procedures upon receipt of CANCEL or BYE as
described in 3GPP TS 24.229 [2].
If user B\'s UE receives a CANCEL request or BYE request from user A and
during a CW condition, user B\'s UE shall:
\- stop timer T~UE-CW~ (if necessary);
\- stop providing the CW indication to user B;
\- apply the terminating UE procedures upon receipt of CANCEL request or BYE
request as described in 3GPP TS 24.229 [2]; and
\- optionally apply the procedure for accepting the waiting communication as
described in 3GPP TS 24.229 [2].
## 4.6 Interaction with other services
### 4.6.1 Communication Waiting (CW)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.2 Communication Hold (HOLD)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.3 Terminating Identification Presentation (TIP)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.4 Terminating Identification Restriction (TIR)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.5 Originating identification presentation (OIP)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.6 Originating identification restriction (OIR)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.7 Conference calling (CONF)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.8 Communication diversion services (CDIV)
#### 4.6.8.1 Communication forwarding unconditional (CFU)
If user B has activated the communication forwarding unconditional
supplementary service, then the execution of the communication forwarding
unconditional supplementary service shall take precedence over the network
based CW service. The communication forwarding unconditional service can be
activated while a communication is waiting without changing the state of the
waiting communication.
A forwarded communication can invoke the CW service.
#### 4.6.8.2 Communication forwarding busy (CFB)
No impact, i.e. neither supplementary service shall affect the operation of
the other supplementary service.
NOTE: The following text clarifies the situation. If user B is NDUB,
communication forwarding busy will take place, and the communication is not
offered to user B. If user B is not NDUB, the communication is offered to B,
and if the UDUB (User Determined User Busy) condition occurs, then the
communication forwarding busy will take place.
A forwarded communication can invoke the CW service.
#### 4.6.8.3 Communication forwarding no reply (CFNR)
If user B has activated the communication forwarding no reply service, then a
waiting communication shall still be offered as described in this document. If
the communication forwarding no reply timer expires before an answer is
received then the communication forwarding no reply service is invoked and the
communication is forwarded and communication waiting ceases.
A forwarded communication can invoke the CW service.
#### 4.6.8.4 Communication forwarding on Not Logged-in (CFNL)
No impact, i.e. neither supplementary service shall affect the operation of
the other service.
A forwarded communication can invoke the CW service.
#### 4.6.8.5 Communication deflection (CD)
When receiving the communication waiting indication, user B can invoke the
communication deflection service.
A deflected communication can invoke the CW service.
### 4.6.9 Advice of charge (AOC)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.10 Completion of calls to busy subscriber (CCBS) Completion of
Communications by No Reply (CCNR)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.11 Malicious communication identification (MCID)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.12 Anonymous Communication Rejection and Communication Barring
(ACR/CB)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.13 Explicit Communication Transfer (ECT)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.14 Message Waiting Indication (MWI)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.15 Flexible Alerting (FA)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.16 Customized Alerting Tones (CAT)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.17 Enhanced Calling Name (eCNAM)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.18 Multi-Device (MuD)
If user B has activated the MuD service, the terminal-based CW (using UDUB)
shall be applied.
### 4.6.19 Multi-Identity (MiD)
No impact.
### 4.7 Parameter values (timers)
The use of T~AS-CW ~timer is a network option. When used, the value of T~AS-CW
~timer shall be set by the network operator as a default value subject to
change only by the network operator. The value of this timer is between 0,5
and 2 minutes.
NOTE 1: When used, the value of T~AS-CW~ is set by the service provider as a
default value subject to change only by the service provider.
The use of T~UE-CW ~timer is a terminal option. This timer has no predefined
value.
NOTE 2: The timer T~UE-CW~ is used in order to limit the duration of the CW
condition at the UE. For terminals that can provide an indication to the user
that a CW condition is occuring without disturbing the active communication,
this timer is not needed.
## 4.8 Service Configuration
### 4.8.1 General
Communication waiting documents are sub-trees of the simservs XML document
specified in 3GPP TS 24.623 [7]. As such, communication waiting documents use
the XCAP application usage in 3GPP TS 24.623 [7].
Data semantics: The semantics of the communication waiting XML configuration
document is specified in subclause 4.8. 2.
XML schema: Implementations in compliance with this specification shall
implement the XML schema that minimally includes the XML Schema defined in
subclause 4.8. 3 and the _simservs_ XML schema specified in subclause 6.3 of
3GPP TS 24.623 [7].
An instance of a communication waiting document is shown:
\
\
\
\
### 4.8.2 Data Semantics
The CW service can be activated/deactivated using the active attribute of the
\ service element.
### 4.8.3 XML Schema
\
\
\
\
\communication waiting
\
\
\
\
# 5 Extensions within the present document
## 5.1 CW information XML body
### 5.1.1 General
This subclause contains the CW information XML body in XML format. The CW
information XML shall be valid against the CW XML schema defined in subclause
4.4.1.
Subclause 5.1.2 provides the associated MIME type definition. Annex C provides
details of IANA registration and optional parameters.
### 5.1.2 MIME type definition
#### 5.1.2.1 Introduction
This subclause defines the MIME type for \"application/vnd.3gpp.cw+xml\". A CW
information XML document can be identified with this media type.
#### 5.1.2.2 Operation
The encoding considerations for \"application/vnd.3gpp.cw+xml\" are identical
to those of \"application/xml\" as described in RFC 3023 [13].
###### ## Annex A (informative): Signalling flows
# A.1 Network based CW flows
Figure A.1.1: CW signalling flow using an AS
Figure A.1.1 shows a basic signalling flow for Communication Waiting.
**Call flows**
1 to 2 The communication is initiated by UE-A by sending an INVITE request.
The Request URI will include the URI of UE-B. After IFC evaluation in the
S-CSCF the INVITE request is routed to the CW AS.
2a. The AS detects the CW condition and inserts a 3GPP IM CN Subsystem XML
body into the INVITE request per procedures in subclause 4.5.5.2, see Table
A.1-1.
Table A.1-1: **SIP IN** VITE request (CW AS to S-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: sip:pcscf1.home1.net:7531;lr;comp=sigcomp>,
> \
>
> Privacy: none
>
> From: \; tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Supported: 100rel; precondition, gruu, 199
>
> Require: sec-agree; replaces
>
> Replaces: me03a0s09a2sdfgjkl491777; to-tag=774321; from-tag=64727891
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi=87654321;
> port1=7531
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE
>
> Accept: application/sdp,application/vnd.3gpp.cw+xml
>
> Content-Type: multipart/mixed;boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=inactive
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
>
> \--boundary1
>
> Content-Type: application/vnd.3gpp.cw+xml
>
> \
>
> \
>
> \
>
> \
>
> \--boundary1--
3\. -- 4. The INVITE request is routed to UE-B.
5\. UE-B recognizes the 3GPP IM CN Subsystem XML body per procedures in
subclause 4.5.5.3.
6\. UE-B sends back a 180 (Ringing) response.
[6a. out of scope: user B uses the HOLD service or releases a session in order
to free resources]
7\. -- 8. The 180 (Ringing) response is routed back to the AS.
8a. The AS optionally inserts a Alert-Info with a \'CW\' urn into the 180
(Ringing) response.
Table A.1-2: 180 (Ringing) response (CW AS to S-CSCF)
SIP/2.0 180 Ringing
Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bk120f34.1
Via: SIP/2.0/UDP 1.2.3.4:1357;branch=z9hG4bKnashds7
From: \;tag=31415
To: \;tag=24615
Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
service.ims.icsi.mmtel\"
Call-ID: b89rjhnedlrfjflslj40a222
CSeq: 61 INVITE
Alert-Info:urn:alert:service:call-waiting
Content-Length: 0
9\. -- 10. The 180 (Ringing) response is routed back to the communication
origin.
[9a. The AS may initiate an announcement to the calling user that the
communication is a waiting communication, in accordance with 3GPP TS 24.628
[4].]
11\. -- 15. UE-B sends back a 200 (OK) response to the communication origin.
# A.2 Terminal based CW flows
## A.2.1 Successful communication establishment
Figure A.2.1: Communication Waiting signalling flow at the terminating side,
successful communication establishment
Explanation Figure A.2.1:
NOTE: only the most relevant messages are shown.
1\. -- 5. A communication invitation arrives at UE-B.
1a. Evaluation of initial filter criteria (CW is subscribed  forwarding to CW
AS).
6\. -- 10. UE-B sends back a provisional response to the communication origin.
11\. -- 15. UE-B sends back a 180 (Ringing) response. UE-B optionally inserts
a Alert-Info with a \"service:call-waiting\" urn into the 180 (Ringing)
response, see Table A.2-1.
Table A.2-1: 180 (Ringing) response (UE-B to P-CSCF)
SIP/2.0 180 Ringing
Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bk120f34.1
Via: SIP/2.0/UDP 1.2.3.4:1357;branch=z9hG4bKnashds7
From: \;tag=31415
To: \;tag=24615
Contact:
\;+g.3gpp.icsi-
ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
Call-ID: b89rjhnedlrfjflslj40a222
CSeq: 61 INVITE
Alert-Info: \
Content-Length: 0
[11a. out of scope: user B uses the HOLD service or releases a session in
order to free resources]
13a. A CW timer is started.
[14a. The AS may initiate an announcement to the calling user that the
communication is a waiting communication, in accordance with 3GPP TS 24.628
[4].]
16\. -- 20. UE-B sends a 200 OK to the communication origin with the SDP offer
of UE-B.
18a. The CW timer stops.
## A.2.2 Timer expires
Figure A.2.2: Communication Waiting signalling flow at the terminating side,
CW timer expires
Explanation Figure A.2.2:
NOTE: Only the most relevant messages are shown.
1\. -- 5. A communication invitation arrives at UE-B.
1a. Evaluation of initial filter criteria (CW is subscribed  forwarding to CW
AS).
6\. -- 10. UE-B sends back a provisional response to the communication origin.
11\. -- 15. UE-B sends back a 180 (Ringing) response. UE-B optionally inserts
a Alert-Info with a \"service:call-waiting\" urn into the 180 (Ringing)
response, see Table A.2-2.
Table A.2-2: 180 (Ringing) response (UE-B to P-CSCF)
SIP/2.0 180 Ringing
Via: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bk120f34.1
Via: SIP/2.0/UDP 1.2.3.4:1357;branch=z9hG4bKnashds7
From: \;tag=31415
To: \;tag=24615
Contact:
\;+g.3gpp.icsi-
ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
Call-ID: b89rjhnedlrfjflslj40a222
CSeq: 61 INVITE
Alert-Info: \
Content-Length: 0
[11a. out of scope: user B uses the HOLD service or releases a session in
order to free resources]
13a. A CW timer is started.
[14a. The AS may initiate an announcement to the calling user that the
communication is a waiting communication, in accordance with 3GPP TS 24.628
[4].]
14b. The CW timer expires.
16\. -- 18. The CW AS sends a CANCEL request to to UE-B.
19\. -- 20. The CW AS sends a 480 (Temporarily unavailable) response to the
communication origin.
###### ## Annex B (informative): Example of Filter Criteria
This annex provides an example of a filter criterion that triggers SIP
requests that are subject to initial filter criteria evaluation.
An example of an IFC when the CW service is active at the terminating S-CSCF
is:
Method: INVITE.
Editor's note: It's needed to consider if further clarification is needed for
Filter Criteria in cases where additional services based upon INVITE are also
deployed.
###### ## Annex C (informative): IANA Registration templates
# C.1 IANA registry for Application Media Types
## C.1.1 IANA Registration template for application/vnd.3gpp.cw+xml
Editor's note: The MIME type \"application/vnd.3gpp.cw+xml\" as defined in
this subclause and subclause 4.4.1 is to be registered in the IANA registry
for Application Media Types based upon the following template.
MIME media type name:
application
MIME subtype name:
vnd.3gpp.cw+xml
Required parameters:
None
Optional parameters:
\"charset\" the parameter has identical semantics to the charset parameter of
the \"application/xml\" media type as specified in RFC 3023.
Encoding considerations:
binary
Security considerations:
3GPP has defined mechanisms for ensuring the privacy and integrity protection
of the bodies of SIP messages used in the 3GPP IM CN Subsystem.
Interoperability considerations:
This content type provides a format for exchanging information in SIP Requests
and Responses and used within the 3GPP IM CN Subsystem.
Published specification:
3GPP TS 24.615: \"Communication Waiting (CW) using IP Multimedia (IM) Core
Network (CN) subsystem\"
Applications which use this media:
Applications that use the network-determined call waiting procedures of 3GPP
IM CN Subsystem as defined by 3GPP.
Intended usage:
This content type provides a format for the network to indicate that the UE
needs special handling of incoming session request due to \"approaching
network determined user busy\" condition.
#
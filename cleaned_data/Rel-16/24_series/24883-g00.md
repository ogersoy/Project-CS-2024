# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides the protocol details for connecting MCPTT
systems to Land Mobile Radio (LMR) systems according to the architectural
procedures specified in 3GPP TS 23.283 [80].
The functional entity that provides connection of MCPTT systems to LMR systems
over the external interface is the IWF. The IWF is expected to behave as a
peer MCPTT system, as further detailed in clause 5 of the present document.
The internal function of the IWF is out of scope of 3GPP.
NOTE: The present document will no longer be updated after its approval by
plenary. All updates are being done directly to the corresponding technical
specifications.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.179: \"Mission Critical Push To Talk (MCPTT) over LTE; Stage
1\".
[3] 3GPP TS 23.379: \"Functional architecture and information flows to support
mission critical communication services; Stage 2\".
[4] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[5] 3GPP TS 24.380: \"Mission Critical Push To Talk (MCPTT) floor control
Protocol specification\".
[6] IETF RFC 3841 (August 2004): \"Caller Preferences for the Session
Initiation Protocol (SIP)\".
[7] IETF RFC 4028 (April 2005): \"Session Timers in the Session Initiation
Protocol (SIP)\".
[8] Void.
[9] IETF RFC 6050 (November 2010): \"A Session Initiation Protocol (SIP)
Extension for the Identification of Services\".
[10] IETF RFC 3550 (July 2003): \"RTP: A Transport Protocol for Real-Time
Applications\".
[11] Void.
[12] IETF RFC 4566 (July 2006): \"Session Description Protocol\".
[13] IETF RFC 3605 (October 2003): \"Real Time Control Protocol (RTCP)
attribute in Session Description Protocol (SDP)\".
[14] IETF RFC 3325 (November 2002): \"Private Extensions to the Session
Initiation Protocol (SIP) for Asserted Identity within Trusted Networks\".
[15] IETF RFC 5626 (October 2009): \"Managing Client-Initiated Connections in
the Session Initiation Protocol (SIP)\".
[16] IETF RFC 3840 (August 2004): \"Indicating User Agent Capabilities in the
Session Initiation Protocol (SIP)\".
[17] IETF RFC 5245 (April 2010): \"Interactive Connectivity Establishment
(ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer
Answer Protocols\".
[18] IETF RFC 5373 (November 2008): \"Requesting Answering Modes for the
Session Initiation Protocol (SIP)\".
[19] Void.
[20] IETF RFC 5366 (October 2008): \"Conference Establishment Using Request-
Contained Lists in the Session Initiation Protocol (SIP)\".
[21] IETF RFC 2046 (November 1996): \"Multipurpose Internet Mail Extensions
(MIME) Part Two: Media Types\".
[22] IETF RFC 4488 (May 2006): \"Suppression of Session Initiation Protocol
(SIP) REFER Method Implicit Subscription\".
[23] IETF RFC 4538 (June 2006): \"Request Authorization through Dialog
Identification in the Session Initiation Protocol (SIP)\".
[24] IETF RFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".
[25] IETF RFC 3515 (April 2003): \"The Session Initiation Protocol (SIP) Refer
Method\".
[26] IETF RFC 6665 (July 2012): \"SIP-Specific Event Notification\".
[27] IETF RFC 7647 (September 2015): \"Clarifications for the use of REFER
with RFC6665\".
[28] 3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE) to
Proximity-services (ProSe) Function Protocol aspects; Stage 3\".
[29] IETF RFC 4412 (February 2006): \"Communications Resource Priority for the
Session Initiation Protocol (SIP)\".
[30] IETF RFC 4575 (August 2006): \"A Session Initiation Protocol (SIP) Event
Package for Conference State\".
[31] 3GPP TS 24.481: \"Mission Critical Services (MCS) group management
Protocol specification\".
[32] IETF RFC 4483 (May 2006): \"A Mechanism for Content Indirection in
Session Initiation Protocol (SIP) Messages.
[33] IETF RFC 3428 (December 2002): \"Session Initiation Protocol (SIP)
Extension for Instant Messaging\".
[34] IETF RFC 4964 (October 2007): \"The P-Answer-State Header Extension to
the Session Initiation Protocol for the Open Mobile Alliance Push-to-talk over
Cellular\".
[35] IETF RFC 7614 (August 2015): \"Explicit Subscriptions for the REFER
Method\".
[36] IETF RFC 5318 (December 2008): \"The Session Initiation Protocol (SIP)
P-Refused-URI-List Private-Header (P-Header)\".
[37] IETF RFC 3903 (October 2004): \"Session Initiation Protocol (SIP)
Extension for Event State Publication\".
[38] IETF RFC 5368 (October 2008): \"Referring to Multiple Resources in the
Session Initiation Protocol (SIP)\".
[39] IETF RFC 5761 (April 2010): \"Multiplexing RTP Data and Control Packets
on a Single Port\".
[40] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[41] 3GPP TS 23.203: \"Policy and charging control architecture\".
[42] 3GPP TS 29.468: \"Group Communication System Enablers for LTE (GCSE_LTE);
MB2 Reference Point; Stage 3\".
[43] 3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core
Network Protocols; Stage 3\".
[44] IETF RFC 3264 (June 2002): \"An Offer/Answer Model with the Session
Description Protocol (SDP)\".
[45] 3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object
(MO)\".
[46] Void.
[47] IETF RFC 4567 (July 2006): \"Key Management Extensions for Session
Description Protocol (SDP) and Real Time Streaming Protocol (RTSP)\".
[48] IETF RFC 8101 \"IANA Registration of New Session Initiation Protocol
(SIP) Resource-Priority Namespace for Mission Critical Push To Talk service\".
[49] 3GPP TS 24.482: \"Mission Critical Services (MCS) identity management
Protocol specification.
[50] 3GPP TS 24.484: \"Mission Critical Services (MCS) configuration
management Protocol specification\".
[51] IETF RFC 3856 (August 2004): \"A Presence Event Package for the Session
Initiation Protocol (SIP)\".
[52] IETF RFC 3863 (August 2004): \"Presence Information Data Format (PIDF)\".
[53] IETF RFC 7519 (May 2015): \"JSON Web Token (JWT)\".
[54] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[55] IETF RFC 4354 (January 2006): \"A Session Initiation Protocol (SIP) Event
Package and Data Format for Various Settings in Support for the Push-to-Talk
over Cellular (PoC) Service\".
[56] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[57] 3GPP TS 23.468: \"Group Communication System Enablers for LTE (GCSE_LTE);
Stage 2\".
[58] 3GPP TS 24.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
3\".
[59] 3GPP TS 29.199-9: \"Open Service Access (OSA); Parlay X Web Services;
Part 9: Terminal location\".
[60] W3C: \"XML Encryption Syntax and Processing Version 1.1\",
https://www.w3.org/TR/xmlenc-core1/.
[61] W3C: \"XML Signature Syntax and Processing (Second Edition)\",
http://www.w3.org/TR/xmldsig-core/.
[62] IETF RFC 2392 (August 1998): \"Content-ID and Message-ID Uniform Resource
Locators\".
[63] IETF RFC 4661 (September 2006): \"An Extensible Markup Language
(XML)-Based Format for Event Notification Filtering\".
[64] IETF RFC 6086 (January 2011): \"Session Initiation Protocol (SIP) INFO
Method and Package Framework\".
[65] IETF RFC 3891 (September 2004): \"The Session Initiation Protocol (SIP)
Replaces Header\".
[66] 3GPP TS 24.216: \"Communication continuity managed object\".
[67] IETF RFC 4122 (July 2005): \"A Universally Unique IDentifier (UUID) URN
Namespace\".
[68] IETF RFC 2045 (November 1996): \"Multipurpose Internet Mail Extensions
(MIME) Part One: Format of Internet Message Bodies\".
[69] 3GPP TS 26.179: \"Mission Critical Push To Talk (MCPTT) Codecs and media
handling\".
[70] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[71] IETF RFC 4648 (October 2006): \"The Base16, Base32, and Base64 Data
Encodings\".
[72] IETF RFC 5627 (October 2009): \"Obtaining and Using Globally Routable
User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP)\".
[73] 3GPP TS 29.283: \"Diameter Data Management Applications\".
[74] 3GPP TS 29.061: \"Interworking between the Public Land Mobile Network
(PLMN) supporting packet based services and Packet Data Networks (PDN)\".
[75] IETF RFC 6509 (February 2012): \"MIKEY-SAKKE: Sakai-Kasahara Key
Encryption in Multimedia Internet KEYing (MIKEY)\".
[76] 3GPP TS 22.280: \"Mission Critical Services Common Requirements (MCCoRe);
Stage 1\".
[77] IETF RFC 7462 (March 2015): \"URNs for the Alert-Info Header Field of the
Session Initiation Protocol (SIP)\".
[78] 3GPP TS 33.180: \"Security of the mission critical service\".
**[79] 3GPP TS 29.214: \"Policy and Charging Control over Rx reference
point\".**
**[80] 3GPP TS 23.283: \"Mission Critical Communication Interworking with Land
Mobile Radio Systems; Stage 2\".**
**[81] 3GPP TS 24.379: \"** Mission Critical Push To Talk (MCPTT) call
control; protocol specification**;\".**
**[82] 3GPP TS 24.282: \"** **Mission Critical Data (MCData) signalling
control; Protocol specification;\"**
[83] 3GPP TS 23.280: \"Common functional architecture to support mission
critical services\".
[84] 3GPP TS 23.282: \"Functional architecture and information flows to
support Mission Critical Data (MCData); Stage 2\".
[85] 3GPP TS 24.582: \"Mission Critical Data (MCData) media plane control;
Protocol specification\".
[86] IETF RFC 1738 (December 1994): \"Uniform Resource Locators (URL)\".
[87] OMA OMA-TS-XDM_Group-V1_1_1-20170124-A: \"Group XDM Specification\".
[88] IETF RFC 4825: \"The Extensible Markup Language (XML) Configuration
Access Protocol (XCAP)\".
[89] IETF RFC 4826: (May 2007): \"Extensible Markup Language (XML) Formats for
Representing Resource Lists\".
Editor\'s Note: reference [86] to RFC 1738 should be considered for update in
both this document and the originating 3GPP TS 24.282 because this RFC has
been obsoleted.
# 3 Definitions, symbols and abbreviations
Delete from the above heading those words which are not applicable.
Clause numbering depends on applicability and should be renumbered
accordingly.
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**Participant homed in the IWF:** same as \"User homed in the IWF\".
**User homed in the IWF:** A user represented by an MCPTT ID in the IWF with
the same domain as the IWF.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.283 [80] apply:
**Interworking Function (IWF)**
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Symbol format (EW)
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
E2EE End-to-End Encryption
IWF InterWorking Function
KEK Key Encryption Key (TETRA)
KMS Key Management Service
MC Mission Critical
MCData Mission Critical Data
MCPTT Mission Critical Push To Talk
LMR Land Mobile Radio
OTAK Over-The-Air-Key Management (TETRA)
OTAR Over-The-Air Rekeying (P25)
P25 Project 25
SDS Short Data Service
TETRA TErrestrial Trunked Radio
UE User Equipment
UKEK Unique Key Encryption Key (P25)
URI Uniform Resource Identifier
Editor\'s Note: Remove unused abbreviations prior to presentation to plenary.
# 4 General
## 4.1 IWF overview
The IWF complies with the inter-server interfaces defined in 3GPP TS 24.379
[81], 3GPP TS 24.380 [5] and 3GPP TS 24.282 [82] and the client-server
interfaces defined in 3GPP TS 24.481 [31]; with the exceptions and additions
defined in the present document needed to fulfil requirements for IWFâ€‘1, IWFâ€‘2
and IWFâ€‘3.
## 4.2 Clause numbering
Content in the present document that is based upon other, existing MC services
specifications will be placed into specially numbered clauses as shown below.
For content based upon 3GPP TS 24.379 **[81] will be placed in clauses
starting with number 1xx. The clause number in the present document will be
100 plus the** 3GPP TS 24.379 **[81] clause number. Subclauses in the present
document will add 100 to the most significant digits of the** 3GPP TS 24.379
**[81] subclause on which the present document\'s subclause content is
based.**
For example, content from 3GPP TS 24.379 **[81] subclause 11.1.5 will be in
subclause 111.1.5 the present document.**
**Similarly, content based upon** 3GPP TS 24.380 **[5] will be placed in
clauses starting with 2xx, content based upon** 3GPP TS 24.282 **[82] will be
placed in clauses starting with 3xx and content based upon** 3GPP TS 24.481
**[31] will be placed in clauses starting with 4xx.**
# 5 Functional entities
## 5.1 General
An IWF can perform the controlling role for group calls and private calls as
defined in 3GPP TS 23.283 [80].
An IWF can perform the participating role for group calls and private calls,
as defined in 3GPP TS 23.283 [80].
An IWF can perform a non-controlling role for temporary group calls involving
groups from multiple MCPTT systems as specified in 3GPP TS 23.283 [80].
An IWF performing the participating role can serve an originating LMR user.
How the IWF serves LMR users is out of scope of 3GPP.
An IWF performing the participating role can serve a terminating LMR user. How
the IWF serves LMR users is out of scope of 3GPP.
The same IWF can perform the participating role and controlling role for the
same group session.
The same IWF can perform the participating role and non-controlling role for
the same group session.
When referring to the procedures in the present document for the IWF acting in
a participating role, the term, \"participating IWF\" is used.
When referring to the procedures in the present document for the IWF acting in
a controlling role, the term \"controlling IWF\" is used.
When referring to the procedures in the present document for the IWF acting in
a non-controlling role for a group call, the term \"non-controlling IWF of an
MCPTT group\" is used.
To be compliant with the procedures in the present document, an IWF shall:
\- support the IWF procedures defined in 3GPP TS 23.283 [80];
\- generate SDP offer and SDP answer in accordance with 3GPP TS 24.229 [4] and
subclause 6.3 of 3GPP TS 24.379 [81];
\- implement the role of a centralised floor control server and implement the
on-network procedures for floor control as specified in 3GPP TS 24.380 [5];
\- for registration and service authorisation, IWF procedures are out of scope
of the present document;
\- for affiliation of users hosted in the MCPTT system, implement the
procedures specified in the present document; for LMR users, the affiliation
process is out of scope of the present document;
\- for group call functionality (including broadcast, emergency and imminent
peril), implement the procedures specified in the present document; and
\- for private call functionality (including emergency), implement the
procedures specified in the present document.
To be compliant with the procedures in the present document requiring the
distribution of private call keying material between MCPTT clients as
specified in 3GPP TS 33.180 [78], an IWF shall behave as an encryption
endpoint on behalf of its LMR users.
NOTE: A scenario with the IWF acting as an encryption endpoint is not end to
end encryption. End to end encryption with LMR users is out of scope of the
present document, but some tools are provided to allow end to end encryption
to be defined outside of 3GPP.
To be compliant with the procedures for confidentiality protection of XML
elements in the present document, the IWF shall implement the procedures
specified in subclause 6.6.2 of 3GPP TS 24.379 [81].
To be compliant with the procedures for integrity protection of XML MIME
bodies in the present document, the IWF shall implement the procedures
specified in subclause 6.6.3 of 3GPP TS 24.379 [81].
## 5.2 Functional connectivity models
The following figures give an overview of the connectivity between the IWF and
the MCPTT system with the IWF in different roles as described in subclause
5.1.
NOTE: The MCPTT functional roles are not defined here. They are defined in
3GPP TS 24.379 [81] but are shown here to illustrate the relationship with the
IWF.
Figure 5.2-1 shows the role of the IWF relative to an MCPTT system. Here, the
controlling MCPTT function is in the MCPTT system and the called user is homed
in the IWF. The IWF plays the role of the terminating participating function.
Figure 5.2-1: Relationship between the IWF and an MCPTT system with the
controlling MCPTT function in the MCPTT system
Figure 5.2-2 shows the role of the IWF relative to an MCPTT system. Here, the
controlling MCPTT function is in the MCPTT system and the calling user is
homed in the IWF. The IWF plays the role of the originating participating
function.
Figure 5.2-2: Relationship between the IWF and an MCPTT system with the
controlling MCPTT function in the MCPTT system
Figure 5.2-3 shows the role of the IWF relative to an MCPTT system. Here, the
controlling MCPTT function is in the IWF and the called user is homed in the
IWF. The IWF plays the role of the controlling function.
Figure 5.2-3: Relationship between the IWF and an MCPTT system with the
controlling MCPTT function in the IWF
Figure 5.2-4 shows the role of the IWF relative to an MCPTT system. Here, the
controlling MCPTT function is in the IWF and the calling user is homed in the
IWF. The IWF plays the role of the controlling function.
Figure 5.2-4: Relationship between the IWF and an MCPTT system with the
controlling MCPTT function in the IWF
Figure 5.2-5 shows the role of the IWF relative to an MCPTT system. Here, the
controlling MCPTT function is in the MCPTT system, the non-controlling
function is in the IWF and the called user is homed in the IWF. The IWF plays
the role of the non-controlling function.
Figure 5.2-5: Relationship between the IWF and an MCPTT system with the
controlling MCPTT function in the MCPTT system and a non-controlling function
in the IWF
Figure 5.2-6 shows the role of the IWF relative to an MCPTT system. Here, the
controlling MCPTT function is in the MCPTT system, the non-controlling
function is in the IWF and the calling user is homed in the IWF. The IWF plays
the role of the non-controlling function.
Figure 5.2-6: Relationship between the IWF and an MCPTT system with the
controlling MCPTT function in the MCPTT system and a non-controlling function
in the IWF
Other functional connectivity models can exist.
# 104 General
## 104.4 Warning Header Field
### 104.4.1 General
An IWF can include a free text string in a SIP response to a SIP request. When
the IWF includes a text string in a response to a SIP INVITE request the text
string is included in a Warning header field as specified in IETF RFC 3261
[24]. The IWF includes the Warning code set to 399 (miscellaneous warning) and
includes the host name set to the host name of the IWF.
### 104.4.2 Warning texts
Existing warning texts a specified in 3GPP TS 24.379 [81] will be used.
### 104.6.0 General
Subclauses 4.6.1, 4.6.2, 4.6.3 and 4.6.4 in 3GPP TS 24.379 [81] describe the
aspects and states that are key in managing priority calls and alerts.
The IWF manages the states on behalf of its homed users. For states that are
managed by clients, the IWF manages an instance of the state for each client
for each user homed in the IWF.
### 104.7.1A Media security at the IWF
With respect to LMR interworking, the IWF provides the interfaces as specified
in 3GPP TS 23.283 [80] and 3GPP TS 33.180 [78] to key management and group
management capabilities of the LMR system.
## 104.12 Broadcast group calls
A broadcast group call is a group call where the initiating user expects no
response from the other users, so that when the user\'s transmission is
complete, so is the call.
## 104.13 MCPTT-LMR interworking overview
To support interworking with existing Land Mobile Radio (LMR) systems, an
Interworking Function (IWF) has been defined in 3GPP TS 23.379 [3] and 3GPP TS
23.283 [80]. The IWF provides the set of functions and roles of an MCPTT
server.
# 106 Call control common procedures
### 106.2.1 SDP offer generation
The SDP offer shall contain only one SDP media-level section for offered
speech according to 3GPP TS 24.229 [4] and, if floor control shall be used
during the session, shall contain one SDP media-level section for a media-
floor control entity according to 3GPP TS 24.380 [5].
When composing an SDP offer according to 3GPP TS 24.229 [4] the IWF:
1) shall set the IP address of the IWF for the offered speech media stream
and, if floor control shall be used, for the offered media-floor control
entity;
2) shall include an \"m=audio\" media-level section for the MCPTT media stream
consisting of:
a) the port number for the media stream selected;
b) the codec(s) and media parameters and attributes with the following
clarification:
i) if the IWF is initiating a call to a group identity;
ii) if the \ element is present in the group
document as specified in 3GPP TS 24.481 [31] containing an \ element
with a \"name\" attribute; and
iii) if the IWF supports the encoding name indicated in the value of the
\"name\" attribute;
then the IWF shall insert the value of the \"name\" attribute in the
\ field of the \"a=rtpmap\" attribute as defined in IETF RFC
4566 [12]; and
c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
3) if floor control shall be used during the session, shall include an
\"m=application\" media-level section as specified in 3GPP TS 24.380 [5]
clause 12 for a media-floor control entity, consisting of:
a) the port number for the media-floor control entity selected as specified in
3GPP TS 24.380 [5]; and
b) the \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14; and
4) if media security is required between the MCPTT client and the IWF for a
private call, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\"
attribute as a \"mikey\" attribute value in the SDP offer as specified in IETF
RFC 4567 [47].
### 106.2.2 SDP answer generation
When the IWF receives an initial SDP offer for an MCPTT session, the IWF shall
process the SDP offer and shall compose an SDP answer according to 3GPP TS
24.229 [4].
When composing an SDP answer, the IWF:
1) shall accept the speech media stream in the SDP offer;
2) shall set the IP address of the IWF for the accepted speech media stream
and, if included in the SDP offer, for the accepted media-floor control
entity;
NOTE: If the IWF is behind a NAT the IP address and port included in the SDP
answer can be a different IP address and port than the actual IP address and
port of the IWF depending on the NAT traversal method used by the SIP/IP Core.
3) shall include an \"m=audio\" media-level section for the accepted MCPTT
speech media stream consisting of:
a) the port number for the media stream;
b) media-level attributes as specified in 3GPP TS 24.229 [4];
c) if the \"a=recvonly\" attribute is present in the SDP offer, include an
\"a=sendonly\" attribute;
d) if the \"a=sendonly\" attribute is present in the SDP offer, include an
\"a=recvonly\" attribute; and
e) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and
4) if included in the SDP offer, shall include the media-level section of the
offered media-floor control entity consisting of:
a) an \"m=application\" media-level section as specified in 3GPP TS 24.380 [5]
clause 12; and
b) \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14.
##### 106.2.3.1.1 Automatic commencement mode for private calls
When performing the automatic commencement mode procedures, the IWF performing
the participating role:
1) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [4];
2) shall include the option tag \"timer\" in a Require header field of the SIP
200 (OK) response;
3) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP 200 (OK) response;
4) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the
SIP 200 (OK) response;
5) shall include the Session-Expires header field in the SIP 200 (OK) response
and start the SIP session timer according to IETF RFC 4028 [7]. The
\"refresher\" parameter in the Session-Expires header field shall be set to
\"uas\";
6) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP INVITE request according to 3GPP TS 24.229 [4] with the
clarifications given in subclause 106.2.2;
7) shall send the SIP 200 (OK) response towards the MCPTT server according to
rules and procedures of 3GPP TS 24.229 [4];
8) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.2.
##### 106.2.3.2.1 Manual commencement mode for private calls
When performing the manual commencement mode procedures:
1) if the user homed in the IWF declines the MCPTT session invitation the IWF
performing the participating role shall send a SIP 480 (Temporarily
Unavailable) response towards the MCPTT controlling function with the warning
text set to: \"110 user declined the call invitation\" in a Warning header
field as specified in subclause 104.4, and not continue with the rest of the
steps in this subclause.
The IWF performing the participating role:
1) shall accept the SIP INVITE request and generate a SIP 180 (Ringing)
response according to rules and procedures of 3GPP TS 24.229 [4];
2) shall include the option tag \"timer\" in a Require header field of the SIP
180 (Ringing) response;
3) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP 180 (Ringing) response;
4) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the
SIP 180 (Ringing) response; and
5) shall send the SIP 180 (Ringing) response to the controlling MCPTT
function.
When sending the SIP 200 (OK) response to the incoming SIP INVITE request, the
IWF performing the participating role shall follow the procedures in subclause
106.2.3.1.1.
### 106.2.6 Receiving an MCPTT session release request
Upon receiving a SIP BYE request, the IWF:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and
2) shall send a SIP 200 (OK) response towards the MCPTT server according to
3GPP TS 24.229 [4].
##### 106.2.8.1.1 SIP INVITE request for originating MCPTT emergency group
calls
This subclause is referenced from other procedures.
When the MCPTT emergency state is set, the IWF performing the participating
role:
1) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
SIP INVITE request, an \ element set to \"true\" and if the
MCPTT emergency group call state is set to \"MEGC 1: emergency-gc-capable\",
shall set the MCPTT emergency group call state to \"MEGC 2: emergency-call-
requested\";
2) if the IWF has determined that an MCPTT emergency alert is to be sent, and
the MCPTT emergency alert state is set to \"MEA 1: no-alert\", shall:
a) set the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body to \"true\" and set the MCPTT emergency alert state to \"MEA 2:
emergency-alert-confirm-pending\"; and
b) include in the SIP INVITE request the specific location information for
MCPTT emergency alert as specified in subclause 106.2.9.1;
3) if the IWF has determined that an MCPTT emergency alert is not to be sent
and the MCPTT emergency alert state is set to \"MEA 1: no-alert\", shall set
the \ element of the application/vnd.3gpp.mcptt-info+xml MIME body
to \"false\"; and
4) if the MCPTT client emergency group state of the user homed in the IWF of
the group is set to a value other than \"MEG 2: in-progress\" set the MCPTT
client emergency group state of the user homed in the IWF of the MCPTT group
to \"MEG 4: confirm-pending\".
NOTE 1: This is the case of a user homed in the IWF already being in the MCPTT
emergency state it initiated previously while originating an MCPTT emergency
group call or MCPTT emergency alert. All group calls the user homed in the IWF
originates while in MCPTT emergency state will be MCPTT emergency group calls.
When the MCPTT emergency state is clear and the MCPTT emergency group call
state is set to \"MEGC 1: emergency-gc-capable\" and the IWF determines that
the request for MCPTT emergency group call is authorized by local policy, the
IWF performing the participating role shall set the MCPTT emergency state and
perform the following actions:
1) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
SIP INVITE request an \ element set to \"true\" and set the
MCPTT emergency group call state to \"MEGC 2: emergency-call-requested\"
state;
2) if the user homed in the IWF has also requested an MCPTT emergency alert to
be sent, shall:
a) include in the application/vnd.3gpp.mcptt-info+xml MIME body the \ element set to \"true\" and set the MCPTT emergency alert state to \"MEA
2: emergency-alert-confirm-pending\"; and
b) include in the SIP INVITE request the specific location information, if
available, for MCPTT emergency alert as specified in subclause 106.2.9.1;
3) if the IWF has determined that an MCPTT emergency alert is not to be sent,
shall set the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body to \"false\"; and
4) if the MCPTT client emergency group state of the user homed in the IWF of
the group is set to a value other than \"MEG 2: in-progress\" shall set the
MCPTT client emergency group state of the user homed in the IWF of the MCPTT
group to \"MEG 4: confirm-pending\".
NOTE 2: This is the case of an initial MCPTT emergency group call and
optionally an MCPTT emergency alert being sent. As the MCPTT emergency state
is not sent, there is no MCPTT emergency alert outstanding.
NOTE 3: An MCPTT group call originated by an affiliated member of an MCPTT
group which is in an in-progress emergency state (as tracked on the MCPTT
client by the MCPTT client emergency group state) but is not in an MCPTT
emergency state of their own will also be an MCPTT emergency group call. The
\ and \ elements of the application/vnd.3gpp.mcptt-
info+xml MIME body do not need to be included in this case and hence no action
needs to be taken in this subclause.
##### 106.2.8.1.2 Resource-Priority header field for MCPTT emergency group
calls
This subclause is referenced from other procedures.
If the MCPTT emergency group call state is set to either \"MEGC 2: emergency-
call-requested\" or \"MEGC 3: emergency-call-granted\", or the MCPTT client
emergency group state of the group is set to \"MEG 2: in-progress\", the IWF
performing the participating role shall include in the SIP INVITE request a
Resource-Priority header field populated with the values for an MCPTT
emergency group call as specified in subclause 106.2.8.1.15.
NOTE: The IWF performing the participating role ideally would not need to
maintain knowledge of the in-progress emergency state of the group (as tracked
for the client by the MCPTT client emergency group state by the IWF performing
the participating role) but can use this knowledge to provide a Resource-
Priority header field set to emergency level priority, which starts the
infrastructure priority adjustment process sooner than otherwise would be the
case.
If the MCPTT client emergency group state of the group is \"no-emergency\" or
\"cancel-pending\", the IWF performing the participating role shall include in
the SIP INVITE request a Resource-Priority header field populated with the
values for a normal MCPTT group call as specified in subclause 106.2.8.1.15.
##### 106.2.8.1.3 SIP re-INVITE request for cancelling MCPTT in-progress
emergency group state
This subclause is referenced from other procedures.
If the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-
granted\" and the MCPTT emergency alert state is set to \"MEA 1: no-alert\",
the IWF performing the participating role shall generate a SIP re-INVITE
request according to 3GPP TS 24.229 [4] with the clarifications given below.
The IWF performing the participating role:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in 3GPP TS 24.379 [81], clause F.1 with the
\ element set to \"false\";
2) shall clear the MCPTT emergency state; and
3) shall set MCPTT emergency group state of the MCPTT group to \"MEG 3:
cancel-pending\".
NOTE 1: This is the case of a user homed in the IWF who has initiated an MCPTT
emergency group call and wants to cancel it.
If the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-
granted\" and the MCPTT emergency alert state is set to a value other than
\"MEA 1: no-alert\" and only the MCPTT emergency group call is to be
cancelled, the IWF performing the participating role:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in 3GPP TS 24.379 [81], clause F.1 with the
\ element set to \"false\"; and
2) shall set the MCPTT emergency group state of the MCPTT group to \"MEG 3:
cancel-pending\".
NOTE 2: This is the case of a user homed in the IWF that has initiated both an
MCPTT emergency group call and an MCPTT emergency alert and wishes to only
cancel the MCPTT emergency group call. This leaves the MCPTT emergency state
set.
If the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-
granted\" and the MCPTT emergency alert state is set to a value other than
\"MEA 1: no-alert\" and the user homed in the IWF has indicated that the MCPTT
emergency alert on the MCPTT group should be cancelled in addition to the
MCPTT emergency group call, the IWF performing the participating role:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in 3GPP TS 24.379 [81], clause F.1 with the
\ element set to \"false\";
2) shall:
a) include in the application/vnd.3gpp.mcptt-info+xml MIME body an \ element set to \"false\";
b) set the MCPTT emergency alert state to \"MEA 4: Emergency-alert-cancel-
pending\"; and
c) clear the MCPTT emergency state; and
3) shall set the MCPTT emergency group state of the MCPTT group to \"MEG 3:
cancel-pending\".
NOTE 3: This is the case of a user homed in the IWF that has initiated both an
MCPTT emergency group call and an MCPTT emergency alert and wishes to cancel
both.
##### 106.2.8.1.4 Receiving a SIP 2xx response to a SIP request for a priority
call
In the procedures in this subclause, a priority group call refers to an MCPTT
emergency group call or an MCPTT imminent peril group call.
On receiving a SIP 2xx response to a SIP request for a priority group call,
the IWF:
1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-
requested\" or \"MEGC 3: emergency-call-granted\":
a) shall set the emergency group state of the user homed in the IWF of the
group to \"MEG 2: in-progress\" if it was not already set;
b) if the MCPTT emergency alert state of the user homed in the IWF is set to
\"MEA 2: emergency-alert-confirm-pending\" and the SIP 2xx response to the SIP
request for a priority group call does not contain a Warning header field as
specified in TS 24.379 [81] subclause 4.4 with the warning text containing the
mcptt-warn-code set to \"149\", shall set the MCPTT emergency alert state of
the user homed in the IWF to \"MEA 3: emergency-alert-initiated;
c) shall set the MCPTT emergency group call state to \"MEGC 3: emergency-call-
granted\"; and
d) shall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-
peril-capable\" and the MCPTT imminent peril group state to \"MIG 1: no-
imminent-peril\"; or
2) if the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-
peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\" and the SIP
2xx response to the SIP request for an imminent peril group call does not
contain a Warning header field as specified in TS 24.379 [81] subclause 4.4
with the warning text containing the mcptt-warn-code set to \"149\":
a) set the MCPTT imminent peril group call state to \"MIGC 3: imminent-peril-
call-granted\"; and
b) set the MCPTT imminent peril group state to \"MIG 2: in-progress\".
##### 106.2.8.1.5 Receiving a SIP 4xx response, SIP 5xx response or SIP 6xx
response to a SIP request for a priority group call
In the procedures in this subclause, a priority group call refers to an MCPTT
emergency group call or an MCPTT imminent peril group call.
Upon receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to a
SIP request for a priority group call the IWF:
1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-
requested\" or \"MEGC 3: emergency-call-granted\":
a) shall set the MCPTT emergency group call state to \"MEGC 1: emergency-gc-
capable\";
b) if the emergency group state of the user homed in the IWF of the group is
\"MEG 4: confirm-pending\" shall set the emergency group state of the user
homed in the IWF of the group to \"MEG 1: no-emergency\"; and
c) if the sent SIP request for a priority group call contained an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element set
to a value of \"true\", shall set the MCPTT emergency alert state of the user
homed in the IWF to \"MEA 1: \"no-alert\"; and
> 2) if the MCPTT imminent peril group call state is set to \"MIGC 2:
> imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\":
>
> a) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
> peril\"; and
>
> b) shall set the MCPTT imminent peril group call state to \"MIGC 1:
> imminent-peril-gc-capable\".
##### 106.2.8.1.9 SIP request for originating MCPTT imminent peril group calls
This subclause is referenced from other procedures.
When the IWF performing the participating role determines to originate an
MCPTT imminent peril group call, the IWF performing the participating role:
1) if the client homed in the IWF\'s imminent peril group state is set to
\"MIGC 1: imminent-peril-gc-capable\" and the in-progress emergency state of
the group is set to a value of \"false\":
a) shall include in the SIP request an application/vnd.3gpp.mcptt-info+xml
MIME body as defined in 3GPP TS 24.379 [81], clause F.1 with the
\ element set to \"true\" and set the MCPTT emergency group
call state to \"MIGC 2: imminent-peril-call-requested\" state; and
b) if the client homed in the IWF\'s imminent peril group state of the group
is set to a value other than \"MIG 2: in-progress\" shall set the client homed
in the IWF\'s emergency group state of the MCPTT group to \"MIG 4: confirm-
pending\".
NOTE: An MCPTT group call originated by an affiliated member of an MCPTT group
which is in an in-progress imminent peril state (as tracked on the client by
the client imminent peril group state) will also have the priority associated
with MCPTT imminent peril group calls. The \ element of the
application/vnd.3gpp.mcptt-info MIME body does not need to be included in this
case, nor do any state changes result and hence no action needs to be taken in
this subclause.
##### 106.2.8.1.11 SIP re-INVITE request for cancelling MCPTT in-progress
imminent peril group state
This subclause is referenced from other procedures.
If the MCPTT imminent peril group call state is set to \"MIGC 3: imminent-
peril-call-granted\" or the MCPTT imminent peril group state of the MCPTT
group is set to \"MIG 2: in-progress\", the IWF shall generate a SIP re-INVITE
request according to 3GPP TS 24.229 [4] with the clarifications given below.
The IWF:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in clause F.1 with the \
element set to \"false\"; and
2) shall set MCPTT imminent peril group state of the MCPTT group to \"MIG 3:
cancel-pending\".
NOTE: This is the case of a user who has initiated an MCPTT imminent peril
group call and wants to cancel it, or another authorised member of the group
who wishes to cancel the in-progress imminent peril state of the group.
##### 106.2.8.1.12 Resource-Priority header field for MCPTT imminent peril
group calls
This subclause is referenced from other procedures.
When the MCPTT imminent peril group call state is set \"MIGC 2: imminent-
peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\", or the
client homed in the IWF\'s imminent peril state of the group is set to \"MIG
2: in-progress\", the IWF performing the participating role:
1) shall include in the SIP INVITE request a Resource-Priority header field
populated with the values for an MCPTT imminent peril group call as specified
in subclause 106.2.8.1.15.
NOTE: The IWF performing the participating role ideally would not need to
maintain knowledge of the in-progress imminent peril state of the group (as
tracked for the client by the client imminent peril group state) but can use
this knowledge to provide a Resource-Priority header field set to imminent
peril level priority, which starts the infrastructure priority adjustment
process sooner than otherwise would be the case.
When the MCPTT imminent peril group call state is set to \"MIGC 1: imminent-
peril-gc-capable\" and the IWF performing the participating role determines
that cancellation of the MCPTT imminent peril group call is authorized, or the
MCPTT client imminent peril group state of the group is \"MIG 1: no-imminent-
peril\" or \"MIG 3: cancel-pending\", the IWF performing the participating
role:
1) shall include in the SIP INVITE request a Resource-Priority header field
populated with the values for a normal MCPTT group call as specified in
subclause 106.2.8.1.15.
##### 106.2.8.1.13 Receiving a SIP INFO request in the dialog of a SIP request
for a priority group call
This subclause is referenced from other procedures.
Upon receiving a SIP INFO request within the dialog of the SIP request for a
priority group call:
\- with the Info-Package header field containing the g.3gpp.mcptt-info package
name;
\- with the application/vnd.3gpp.mcptt-info+xml MIME body associated with the
info package according to IETF RFC 6086 [64]; and
\- with one or more of the \, \ and \ elements set in the application/vnd.3gpp.mcptt-info+xml MIME body;
the IWF:
1) shall send a SIP 200 (OK) response to the SIP INFO request as specified in
3GPP TS 24.229 [4];
2) if the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-
granted\":
a) if the MCPTT emergency alert state of the user homed in the IWF is set to
\"MEA 2: emergency-alert-confirm-pending\":
i) if the \ element is set to a value of \"false\", shall set the
MCPTT emergency alert state to \"MEA 1: no-alert\"; and
ii) if the \ element is set to a value of \"true\", shall set the
MCPTT emergency alert state of the user homed in the IWF to \"MEA 3:
emergency-alert-initiated\";
3) if the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-
peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\":
a) if the \ element is set to a value of \"false\" and an
\ element is set to a value of \"true\", shall:
i) set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\";
ii) set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-
capable\"; and
iii) set the emergency group state of the user homed in the IWF of the group
to \"MEG 2: in-progress\"; and
NOTE 1: This is the case of an IWF attempting to make an imminent peril group
call when the group is in an in-progress emergency group state. The IWF will
then receive a notification that the imminent peril call request was denied,
however the IWF will be participating at the emergency level priority of the
group.
NOTE 2: the emergency group state of the user homed in the IWF above is the
view of the in-progress emergency state of the group for each user homed in
the IWF.
4) if the SIP request for a priority group call sent by the IWF did not
contain an \ element and if the MCPTT emergency alert state of
the user homed in the IWF is set to \"MEA 4: Emergency-alert-cancel-pending\":
a) if the \ element contained in the SIP INFO request is set to a
value of \"true\", shall set the MCPTT emergency alert state of the user homed
in the IWF to \"MEA 3: emergency-alert-initiated\"; and
b) if the \ element contained in the SIP INFO request is set to a
value of \"false\", shall set the MCPTT emergency alert state of the user
homed in the IWF to \"MEA 1: no-alert\".
##### 106.2.8.1.14 SIP re-INVITE request for cancelling the in-progress
emergency group state of a group by a third-party
This subclause is referenced from other procedures.
Upon the need to cancel an in-progress emergency group state of a group, the
IWF performing the participating role shall generate a SIP re-INVITE request
according to 3GPP TS 24.229 [4] with the clarifications given below.
The IWF performing the participating role:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in 3GPP TS 24.379 [81], clause F.1 with the
\ element set to \"false\";
2) shall set MCPTT emergency group state of the MCPTT group to \"MEG 3:
cancel-pending\"; and
3) if the MCPTT emergency alert on the MCPTT group originated by a MCPTT user
is to be cancelled:
a) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
\ element set a value of \"false\"; and
b) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
\ element set to the MCPTT ID of the MCPTT user who originated
the MCPTT emergency alert.
NOTE: When an MCPTT emergency alert is cancelled by a user other than its
originator, the \ element is needed to identify which MCPTT
emergency alert is being cancelled, as more than one MCPTT user could have
originated emergency alerts to the same group.
##### 106.2.8.1.15 Resource-Priority header field values
This subclause is referenced from other procedures.
The IWF performing the participating role may populate the Resource-Priority
header as described for the IWF performing the controlling role in subclause
106.3.3.1.19.
##### 106.2.8.3.2 SIP request for originating MCPTT emergency private calls
This subclause is referenced from other procedures.
When the MCPTT emergency private call state is set to \"MEPC 1: emergency-pc-
capable\", the IWF:
1) shall set the MCPTT emergency state if not already set;
2) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
SIP request an \ element set to \"true\" and set the MCPTT
emergency private call state to \"MEPC 2: emergency-pc-requested\";
3) if an MCPTT emergency alert is to be sent, shall:
a) include in the application/vnd.3gpp.mcptt-info+xml MIME body the \ element set to \"true\" and set the MCPTT private emergency alert state
to \"MPEA 2: emergency-alert-confirm-pending\"; and
b) include in the SIP request the specific location information for MCPTT
emergency alert as specified in subclause 106.2.9.1;
4) if the IWF has determined not to request an MCPTT emergency alert to be
sent, shall set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to \"false\"; and
5) if the MCPTT emergency private priority state of this private call is set
to a value other than \"MEPP 2: in-progress\" shall set the MCPTT emergency
private priority state to \"MEPP 3: confirm-pending\".
##### 106.2.8.3.3 Resource-Priority header field for MCPTT emergency private
calls
This subclause is referenced from other procedures.
If the MCPTT emergency private call state is set to either \"MEPC 2:
emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\", or the MCPTT
emergency private priority state of the call is set to \"MEPP 2: in-
progress\", the IWF shall include in the SIP request a Resource-Priority
header field populated with the values for an MCPTT emergency private call as
specified in subclause 106.2.8.1.15.
NOTE: The IWF ideally would not need to maintain knowledge of the in-progress
emergency state of the call (as tracked on the MCPTT client by the MCPTT
client emergency private state) but can use this knowledge to provide a
Resource-Priority header field set to emergency level priority, which starts
the infrastructure priority adjustment process sooner than otherwise would be
the case.
If this is a request to cancel the MCPTT emergency private call and the MCPTT
emergency private priority state of the private call is \"MEPP 1: no-
emergency\" or \"MEPP 3: cancel-pending\", the IWF shall include in the SIP
request a Resource-Priority header field populated with the values for a
normal MCPTT private call as specified in subclause 106.2.8.1.15.
##### 106.2.8.3.6 SIP re-INVITE request for cancelling MCPTT emergency private
call state
This subclause is referenced from other procedures.
When the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-
granted\" and the MCPTT emergency alert state is set to \"MPEA 1: no-alert\",
the IWF performing the participating role shall generate a SIP re-INVITE
request according to 3GPP TS 24.229 [4] with the clarifications given below.
The IWF performing the participating role:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in 3GPP TS 24.379 [81], 3GPP TS 24.379 [81],
clause F.1 with the \ element set to \"false\";
2) shall clear the MCPTT emergency state; and
3) shall set MCPTT emergency private priority state of the MCPTT emergency
private call to \"MEPP 3: cancel-pending\".
NOTE 1: This is the case where a private call is in emergency and the
emergency is to be cancelled.
When the MCPTT emergency private call state is set to \"MEPPC 3: emergency-pc-
granted\" and the MCPTT emergency alert state is set to a value other than
\"MPEA 1: no-alert\" and the IWF decides that only the MCPTT emergency private
call should be cancelled, the IWF performing the participating role:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in 3GPP TS 24.379 [81], 3GPP TS 24.379 [81],
clause F.1 with the \ element set to \"false\"; and
2) shall set the MCPTT emergency private priority state of the MCPTT emergency
private call to \"MEPP 3: cancel-pending\";
NOTE 2: This is the case where both an MCPTT emergency private call and an
MCPTT emergency alert have been initiated and only the MCPTT emergency on the
private call is to be cancelled. This leaves the MCPTT emergency state set.
When the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-
granted\" and the MCPTT emergency alert state is set to a value other than
\"MPEA 1: no-alert\" and the IWF performing the participating role has
indicated that the MCPTT emergency alert on the MCPTT private call should be
cancelled in addition to the MCPTT emergency private call, the IWF performing
the participating role:
1) shall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-
info+xml MIME body as defined in 3GPP TS 24.379 [81], clause F.1 with the
\ element set to \"false\";
2) shall:
a) include in the application/vnd.3gpp.mcptt-info+xml MIME body an \ element set to \"false\"; and
b) set the MCPTT private emergency alert state to \"MPEA 4: emergency-alert-
cancel-pending\";
3) shall set the MCPTT emergency private priority state of the MCPTT to \"MEPP
3: cancel-pending\"; and
4) shall clear the MCPTT emergency state.
NOTE 3: This is the case where both an MCPTT emergency private call and an
MCPTT emergency alert have been initiated and both are to be cancelled.
#### 106.2.9.1 Location information for location reporting
This procedure is initiated by the IWF performing the participating role when
it is including location report information as part of a SIP request
containing an MCPTT emergency alert.
NOTE 1: Location triggers are out of scope of the present document.
The IWF performing the participating role:
1) shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body as
specified in 3GPP TS 24.379 [81], clause F.3 with a \ element included
in the \ root element;
2) shall set the \ element of the \ element to a value of
\"Emergency\"; and
3) shall include in the \ element of the \ element of
the application/vnd.3gpp.mcptt-location-info+xml MIME body a
\ element populated as specified in 3GPP TS 24.379 [81],
subclause F.3.3.
NOTE 2: According to local policy, additional location information elements
specified in 3GPP TS 24.379 [81], subclause F.3.3 can be included in the
\ element.
## 106.3 IWF server role procedures
#### 106.3.1.3 SIP MESSAGE request
The IWF needs to distinguish between the following SIP MESSAGE request for
originations and terminations:
\- SIP MESSAGE requests routed to the IWF performing the controlling role and
containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-
info+xml\" and includes an XML body containing a \ root element
with a \ element containing an \ element with the
\ element set to a value of \"remotely-initiated-group-call-
request\". Such requests are known as \"SIP MESSAGE request for remotely
initiated group call request for controlling MCPTT function\"; and
\- SIP MESSAGE requests routed to the IWF performing the controlling role and
containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-
info+xml\" and includes an XML body containing a \ root element
with a \ element containing an \ element with the
\ element set to a value of \"remotely-initiated-group-call-
response\". Such requests are known as \"SIP MESSAGE request for remotely
initiated group call response for controlling MCPTT function\".
### 106.3.2 IWF participating role
#### 106.3.2.1 Requests initiated by a participant homed in the IWF
##### 106.3.2.1.1 SDP offer generation
###### 106.3.2.1.1.1 On-demand session
This subclause is referenced from other subclauses.
The SDP offer generated by the IWF performing the participating role:
1) shall contain only one SDP media-level section for speech; and
2) shall contain an SDP media-level section for one media-floor control
entity.
When composing the SDP offer according to 3GPP TS 24.229 [4], the IWF
performing the participating role:
1) shall insert the IP address and port number selected by the IWF performing
the participating role for the media stream in the SDP offer;
NOTE 1: Requirements can exist for the IWF performing the participating role
to be always included in the path of the offered media stream, for example:
for the support of features such as lawful interception and recording. Other
examples can exist.
2) shall insert the IP address and port number selected by the IWF performing
the participating role for the offered media floor control entity, if any, in
the received SDP offer; and
3) shall include an \"m=audio\" media-level section for the media stream
consisting of:
a) the port number for the media stream selected; and
b) the codec(s) and media parameters and attributes with the following
clarification:
i) if a call is being initiated to a group identity; and
ii) if the IWF performing the participating role determines one or more
preferred codecs;
then the IWF:
i) shall include the name of the chosen codec in the \ field of
the \"a=rtpmap\" attribute as defined in IETF RFC 4566 [12];
c) \"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];
4) if floor control shall be used during the session, shall include an
\"m=application\" media-level section as specified in 3GPP TS 24.380 [5]
clause 12 for a media-floor control entity, consisting of:
a) the port number for the media-floor control entity selected as specified in
3GPP TS 24.380 [5]; and
b) the \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause 14; and
5) if security between the IWF and the MCPTT system is required for a private
call, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute
as a \"mikey\" attribute value in the SDP offer as specified in IETF RFC 4567
[47].
6) shall contain an \"a=key-mgmt\" attribute field with a \"mikey\" attribute
value.
Editor's Note: End-to-end security is FFS.
##### 106.3.2.1.3 Sending an INVITE request
This subclause is referenced from other procedures.
When generating an initial SIP INVITE request according to 3GPP TS 24.229 [4]
the IWF performing the participating role:
1) should include the Session-Expires header field according to IETF RFC 4028
[7]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
2) shall include the option tag \"timer\" in the Supported header field;
3) shall include in the P-Asserted-Identity header field the public service
identity of the IWF performing the participating role;
4) shall include the g.3gpp.mcptt media feature tag into the Contact header;
and
5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header
field.
##### 106.3.2.1.6 IWF sending a SIP BYE request
When the IWF is ending participation in an MCPTT session and decides to send a
SIP BYE request, the IWF:
1) shall interact with the media plane as specified in subclause 6.4 in 3GPP
TS 24.380 [5];
2) shall generate a SIP BYE request as specified in 3GPP TS 24.229 [4];
3) shall set the Request-URI to the MCPTT session identity of the MCPTT
session;
4) shall set the P-Asserted-Identity header field of the outgoing SIP BYE
request to the public service identity of the IWF;
5) may insert an application/vnd.3gpp.mcptt-info+xml MIME body into the
outgoing SIP BYE request; and
6) shall send the SIP BYE request toward the controlling MCPTT function,
according to 3GPP TS 24.229 [4].
Upon receiving a SIP 200 (OK) response to the SIP BYE request the IWF should
complete any further actions necessary to dissociate the LMR user from the
MCPTT session and shall interact with the media plane to release any resources
as specified in subclause 6.4 in 3GPP TS 24.380 [5] for releasing media plane
resources associated with the SIP session with the controlling MCPTT function.
##### 106.3.2.1.8 Priority call conditions
###### 106.3.2.1.8.0 General
The subclauses of the parent subclause contain common procedures to be used
for MCPTT emergency group calls and MCPTT imminent peril group calls.
###### 106.3.2.1.8.1 Determining authorisation for originating a priority
group call
When the IWF performing the participating role needs to send a request to
originate an MCPTT emergency group call and needs to determine if the request
is an authorised request for an MCPTT emergency call, the IWF performing the
participating role shall check the following:
1) if the IWF determines that the calling user is authorized for emergency-
group-call; and
2) if the IWF determines that emergency-group-calls for the selected group are
allowed;
then the IWF performing the participating roled shall consider the MCPTT
emergency group call request to be an authorised request for an MCPTT
emergency group call;
In all other cases, the IWF performing the participating role shall consider
the request to originate an MCPTT emergency group call to be an unauthorised
request to originate an MCPTT emergency group call.
NOTE 1: How the IWF authorizes a user to originate a priority group call is
out of scope of the present document.
When the IWF performing the participating role needs to send a request to
originate an MCPTT imminent peril group call and needs to determine if the
request is an authorised request for an MCPTT imminent peril group call the
IWF performing the participating role shall check the following:
1) if the IWF determines that the calling user is authorized for imminent
peril call; and
2) if the IWF determines that imminent paril calls for the selected group are
allowed;
then the IWF performing the participating role shall consider the MCPTT
imminent peril group call request to be an authorised request for an imminent
peril group call;
In all other cases, the IWF performing the participating role shall consider
the request to originate an MCPTT imminent peril group call to be an
unauthorised request to originate an MCPTT imminent peril call.
NOTE 2: How the IWF authorizes a user to originate an imminent peril call is
out of scope of the present document.
###### 106.3.2.1.8.2 Determining authorisation for initiating or cancelling an
MCPTT emergency alert
If the IWF performing the participating role needs to send a SIP request for
an MCPTT emergency alert and:
1) if the calling user is authorized by the IWF to activate emergency alert;
and
2) if the IWF allows emergency alert for the selected group;
then the MCPTT emergency alert request shall be considered to be an authorised
request for an MCPTT emergency alert. In all other cases, it shall be
considered to be an unauthorised request for an MCPTT emergency alert.
NOTE 1: How the IWF authorizes a user to originate a request for an MCPTT
emergency alert is out of scope of the present document.
If the IWF performing the participating role needs to send a SIP request to
cancel an MCPTT emergency alert to an MCPTT group, and if the calling user is
authorized by the IWF to cancel an emergency alert, then the MCPTT emergency
alert cancellation request shall be considered to be an authorised request to
cancel an MCPTT emergency alert. In all other cases, it shall be considered to
be an unauthorised request to cancel an MCPTT emergency alert.
NOTE 2: How the IWF authorizes a user to cancel an MCPTT emergency alert is
out of scope of the present document.
###### 106.3.2.1.8.3 Validate priority request parameters
This subclause is referenced from other procedures.
To validate the combinations of \, \ and
\ which need to be sent in SIP requests, the IWF performing the
participating role shall follow the procedures specified in 3GPP TS 24.379
[81], subclause 6.3.3.1.17, with the IWF acting as the controlling function.
###### 106.3.2.1.8.4 Retrieving Resource-Priority header field values
This subclause is referenced from other procedures.
The IWF performing the participating role shall follow the procedures
specified in subclause 106.3.3.1.19 with the clarification that references in
that procedure to the IWF performing the controlling role should be replaced
with references to the IWF participating role.
##### 106.3.2.1.10 Sending a SIP INVITE request on receipt of SIP 3xx response
This subclause is referenced from other procedures.
Upon:
1) having sent a SIP INVITE request to the controlling MCPTT function; and
2) having received a SIP 302 (Moved Temporarily) response from the controlling
MCPTT function sent to the SIP INVITE request in step 1) with:
a) a Contact header field containing a SIP-URI; and
b) an application/vnd.3gpp.mcptt-info+xml MIME body with an \ element;
the IWF performing the participating role:
1) shall generate a SIP INVITE request with the Request-URI set to the
contents of the Contact header field of the SIP 302 (Moved Temporarily)
response;
2) shall include in the SIP INVITE request all Accept-Contact header fields
and all Reject-Contact header fields, with their feature tags and their
corresponding values along with parameters according to rules and procedures
of IETF RFC 3841 [6] included in the original SIP INVITE request sent to the
controlling MCPTT function;
3) should include the Session-Expires header field according to IETF RFC 4028
[7]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
4) shall include the option tag \"timer\" in the Supported header field;
5) shall set the P-Asserted-Identity header field of the outgoing SIP INVITE
request to the contents of the P-Asserted-Identity header field of the
original SIP INVITE request sent to the controlling MCPTT function;
6) shall include the g.3gpp.mcptt media feature tag into the Contact header
field of the outgoing SIP INVITE request;
7) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the
outgoing SIP INVITE request;
8) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header
field of the outgoing SIP INVITE request;
9) shall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME
body of the original SIP INVITE request sent to the controlling MCPTT function
into the outgoing SIP INVITE request;
10) void
11) shall copy the contents of the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body received in the SIP 302 (Moved
Temporarily) response, to the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE
request;
12) shall set the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the
MCPTT ID of the calling user that was determined by the IWF performing the
participating role; and
13) if the \ element is received in the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP 3xx response, shall
set the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body of the SIP INVITE request to the value of the \
element received in the SIP 3xx response.
#### 106.3.2.2 Requests terminated to the IWF
##### 106.3.2.2.1 SDP offer generation
The IWF performing the participating role shall follow the procedure in
subclause 106.3.2.1.1.
##### 106.3.2.2.8 SIP BYE request towards the terminating IWF
###### 106.3.2.2.8.1 On-demand
Upon receiving a SIP BYE request from the controlling MCPTT function, the IWF
performing the participating role:
1) shall interact with the media plane as specified in subclause 6.4 in 3GPP
TS 24.380 [5] for releasing media plane resource associated with the SIP
session; and
2) shall send a SIP 200 (OK) response to the SIP BYE request received from the
controlling MCPTT function according to 3GPP TS 24.229 [4].
### 106.3.3 IWF performing the controlling role
#### 106.3.3.1 Requests initiated by the IWF performing the controlling role
##### 106.3.3.1.2 Sending an INVITE request
This subclause is referenced from other procedures.
The IWF performing the controlling role shall generate an initial SIP INVITE
request according to 3GPP TS 24.229 [4].
The IWF performing the controlling role:
1) shall include in the Contact header field an MCPTT session identity for the
MCPTT session with the g.3gpp.mcptt media feature tag, the isfocus media
feature tag and the g.3gpp.icsi-ref media feature tag with the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the g.3gpp.mcptt
media feature tag along with the \"require\" and \"explicit\" header field
parameters according to IETF RFC 3841 [6];
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header
field according to IETF RFC 6050 [9] in the SIP INVITE request;
4) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
along with parameters \"require\" and \"explicit\" according to IETF RFC 3841
[6];
5) shall include a Referred-By header field with the public service identity
of the IWF;
6) should include the Session-Expires header field according to rules and
procedures of IETF RFC 4028 [7]. The refresher parameter shall be omitted;
7) shall include the Supported header field set to \"timer\";
8) if the request is for ambient listening, shall include a Priv-Answer-Mode
header field set to a value of \"Auto\" in the outgoing SIP INVITE request;
9) if the request is not for ambient listening, may include an unmodified
Priv-Answer-Mode header field;
10) if the request is not for ambient listening and will not contain a Priv-
Answer-Mode header field, shall include an Answer-Mode header field; and
11) may include an application/vnd.3gpp.mcptt-info+xml MIME body in the
outgoing INVITE request.
##### 106.3.3.1.5 Sending a SIP BYE request
When the IWF performing the controlling role needs to remove an MCPTT
participant:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5] for
the MCPTT session release;
2) shall generate a SIP BYE request according to 3GPP TS 24.229 [4]; and
3) shall send the SIP BYE request to the MCPTT participants according to 3GPP
TS 24.229 [4].
If timer TNG3 (group call timer) has not expired, then when the last
participant is removed from the MCPTT session, the IWF performing the
controlling role shall stop timer TNG3 (group call timer).
When the MCPTT group session needs to be released, the IWF performing the
controlling role shall send SIP BYE requests as described in this subclause,
to all MCPTT participants of the group session.
Upon receiving a SIP 200 (OK) response to a SIP BYE request the IWF performing
the controlling role shall interact with the media plane as specified in
subclause 6.3 in 3GPP TS 24.380 [5] for releasing media plane resources
associated with the session with the MCPTT clients.
##### 106.3.3.1.6 Sending a SIP re-INVITE request for MCPTT emergency group
call
This subclause is referenced from other procedures.
The IWF performing the controlling role shall generate a SIP re-INVITE request
according to 3GPP TS 24.229 [4].
The IWF performing the controlling role:
1) shall include an SDP offer with the media parameters as currently
established with the terminating MCPTT client according to 3GPP TS 24.229 [4];
2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to the MCPTT ID of the initiating MCPTT
user;
3) if the in-progress emergency group state of the group is set to a value of
\"true\" the IWF performing the controlling role:
a) shall include a Resource-Priority header field with the namespace populated
with the values for an MCPTT emergency group call as specified in subclause
106.3.3.1.19;
b) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body the
\ element set to a value of \"true\";
c) if the received request included a request for an emergency alert and MCPTT
emergency alerts are authorised for this group and MCPTT user as determined by
the procedures of subclause 106.3.3.1.13.1, shall populate the
application/vnd.3gpp.mcptt-info+xml MIME body and application/vnd.3gpp.mcptt-
location-info+xml MIME body as specified in subclause 106.3.3.1.12. Otherwise,
shall set the \ element to a value of \"false\" in the
application/vnd.3gpp.mcptt-info+xml MIME body; and
d) if the in-progress imminent peril state of the group is set to a value of
\"true\" shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
\ element set to a value of \"false\"; and
NOTE: If the imminent peril state of the group is true at this point, the
controlling function will be setting it to false as part of the calling
procedure. This is in effect an upgrade of an MCPTT imminent peril group call
to an MCPTT emergency group call.
4) if the in-progress emergency group state of the group is set to a value of
\"false\":
a) shall include a Resource-Priority header field populated with the values
for a normal MCPTT group call as specified in subclause 106.3.3.1.19; and
b) if the received SIP re-INVITE request contained an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"false\" and this is an authorised request to
cancel an MCPTT emergency group call as determined by the procedures of
subclause 106.3.3.1.13.4:
i) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to a value of \"false\"; and
ii) if the received SIP re-INVITE request contained an
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to a value of \"false\" and this is an authorised request to cancel an
MCPTT emergency alert as determined by the procedures of 3GPP TS 24.379 [81],
subclause 6.3.3.1.15 with the IWF acting as the controlling function, shall:
A) include in the application/vnd.3gpp.mcptt-info+xml MIME body an \ element set to a value of \"false\"; and
B) if the received SIP request contains an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body, copy the contents of the
received \ element to an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP re-INVITE
request.
##### 106.3.3.1.7 Sending a SIP INVITE request for MCPTT emergency group call
This subclause is referenced from other procedures.
This subclause describes the procedures for inviting an MCPTT user to an MCPTT
session associated with an MCPTT emergency group call or MCPTT imminent peril
group call. The procedure is initiated by the IWF performing the controlling
role as the result of an action in subclause 110.1.2.4.1.1.
The IWF performing the controlling role:
1) shall generate a SIP INVITE request as specified in subclause 106.3.3.1.2;
2) shall set the Request-URI to the address of the terminating participating
MCPTT function associated with the MCPTT ID of the targeted MCPTT user;
3) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element populated as
follows:
a) the \ element set to the value of the MCPTT ID of the
targeted MCPTT user;
b) the \ element set to the value of the MCPTT ID of
the calling user; and
c) the \ element set to the value of the MCPTT group
ID of the emergency group call.
4) shall include in the P-Asserted-Identity header field the public service
identity of the IWF performing the controlling role;
5) shall include in the SIP INVITE request an SDP offer according to the
procedures specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.1, with the IWF
acting as the controlling function; and
6) if the in-progress emergency group state of the group is set to a value of
\"true\" the IWF performing the controlling role:
a) shall include a Resource-Priority header field populated with the values
for an MCPTT emergency group call as specified in subclause 106.3.3.1.19;
b) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
\ element set to a value of \"true\";
c) if
i) the \ element is set to \"true\" in the received SIP INVITE
request and the requesting MCPTT user and MCPTT group are authorised for the
initiation of MCPTT emergency alerts as determined by the procedures of
subclause 106.3.3.1.13.1, shall populate the application/vnd.3gpp.mcptt-
info+xml MIME body and the application/vnd.3gpp.mcptt-location-info+xml MIME
body as specified in subclause 106.3.3.1.12. Otherwise, shall set the \ element to a value of \"false\" in the application/vnd.3gpp.mcptt-
info+xml MIME body; or
ii) the call request originated from the IWF, and the IWF decides to indicate
an emergency alert, shall populate the application/vnd.3gpp.mcptt-info+xml
MIME body and the application/vnd.3gpp.mcptt-location-info+xml MIME body as
specified in subclause 106.3.3.1.12. Otherwise, shall set the \
element to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml
MIME body; and
d) if the in-progress imminent peril state of the group is set to a value of
\"true\" shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
\ element set to a value of \"false\";
NOTE: If the imminent peril state of the group is true at this point, the
controlling function will set it to false as part of the calling procedure.
7) if the in-progress emergency state of the group is set to a value of
\"false\" and the in-progress imminent peril state of the group is set to a
value of \"true\", the IWF performing the controlling role:
a) shall include a Resource-Priority header field populated with the values
for an MCPTT imminent peril group call as specified in subclause 106.3.3.1.19;
and
b) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to a value of \"true\".
##### 106.3.3.1.8 Sending a SIP UPDATE request for Resource-Priority header
field correction
This subclause is referenced from other procedures.
This subclause describes the procedures for updating an MCPTT session
associated with an MCPTT emergency group call or MCPTT imminent peril group
call when the received SIP INVITE request did not include a correctly
populated Resource-Priority header field. The procedure is initiated by the
IWF performing the controlling role for the purpose of providing the correct
Resource-Priority header field.
1) shall generate a SIP 183 (Session Progress) response according to 3GPP TS
24.229 [4] with the clarifications provided specified in 3GPP TS 24.379 [81],
subclause 6.3.3.2.3.1, with the IWF acting as the controlling function;
2) shall include the option tag \"100rel\" in a Require header field in the
SIP 183 (Session Progress) response;
3) shall include in the SIP 183 (Session Progress) response an SDP answer to
the SDP offer in the incoming SIP INVITE request as specified in 3GPP TS
24.379 [81], subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT
function; and
4) shall send the SIP 183 (Session Progress) response towards the MCPTT client
according to 3GPP TS 24.229 [4].
Upon receiving a SIP PRACK request to the SIP 183 (Session Progress) response
the IWF performing the controlling role:
1) shall send the SIP 200 (OK) response to the SIP PRACK request according to
3GPP TS 24.229 [4].
2) shall generate a SIP UPDATE request according to 3GPP TS 24.229 [4] with
the following clarifications:
3) shall include in the SIP UPDATE request an SDP offer based on the SDP offer
in the received SIP INVITE request from the originating network according to
the procedures specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.1, with the
IWF acting as the controlling function;
4) if the in-progress emergency group state of the group is set to a value of
\"true\" the IWF performing the controlling role shall include a Resource-
Priority header field populated for an MCPTT emergency group call as specified
in subclause 106.3.3.1.19; and
NOTE 1: This is the case when the sending MCPTT client did not send a
Resource-Priority header field populated appropriately to receive emergency-
level priority. In this case, the Resource-Priority header field is populated
appropriately to provide emergency-level priority.
5) if the in-progress emergency group state of the group is set to a value of
\"false\" the IWF performing the controlling role:
a) if the in-progress imminent peril state of the group is set to a value of
\"false\", shall include a Resource-Priority header field populated for a
normal priority MCPTT group call as specified in subclause 106.3.3.1.19; and
b) if the in-progress imminent peril state of the group is set to a value of
\"true\", shall include a Resource-Priority header field populated for an
MCPTT imminent peril group call as specified in subclause 106.3.3.1.19.
NOTE 2: This is the case when the sending MCPTT client incorrectly populated a
Resource-Priority header field for emergency-level or imminent peril-level
priority and the controlling MCPTT function re-populates it as appropriate to
an imminent peril level priority or normal priority level.
##### 106.3.3.1.10 Generating a SIP re-INVITE request to cancel an in-progress
emergency
This subclause is referenced from other procedures.
This subclause describes the procedures for generating a SIP re-INVITE request
to cancel the in-progress emergency state of a group. The procedure is
initiated by the IWF performing the controlling role when it determines the
cancellation of the in-progress emergency state of a group is required.
The IWF performing the controlling role:
1) shall generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4]
with the clarifications specified in 3GPP TS 24.379 [81] subclause 6.3.3.1.9,
with the IWF acting as the controlling function;
2) shall include a Resource-Priority header field populated with the values
for a normal MCPTT group call as specified in subclause 106.3.3.1.19; and
3) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to a value of \"false\".
##### 106.3.3.1.12 Populate mcptt-info and location-info MIME bodies for
emergency alert
This subclause is referenced from other procedures.
This subclause describes the procedures for populating the
application/vnd.3gpp.mcptt-info+xml and application/vnd.3gpp.mcptt-location-
info+xml MIME bodies for an MCPTT emergency alert. The procedure is initiated
by the IWF performing the controlling role when it has received request
initiating an MCPTT emergency alert and generates a message containing the
MCPTT emergency alert information required by 3GPP TS 23.379 [3].
The IWF performing the controlling role:
1) shall include, if not already present, an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in 3GPP TS 24.379 [81], clause F.1, and set
the \ element to a value of \"true\";
2) shall determine the value of the user\'s Mission Critical Organization
identity.
NOTE: How the IWF determines the user\'s Mission Critical Organization
identity is out of scope of the present document;
3) shall include in the \ element containing the \
element containing an \ element set to the value of the user\'s
Mission Critical Organization identity; and
4) shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body in
the outgoing SIP request.
##### 106.3.3.1.13 Authorisations
###### 106.3.3.1.13.1 Determining authorisation for initiating an MCPTT
emergency alert
If the IWF performing the controlling role has received a SIP request targeted
to an MCPTT group with the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\", the
IWF performing the controlling role shall check the following conditions:
1) if the user is authorized by the IWF to initiate an emergency alert; and
2) if the IWF allows emergency alerts on the group;
then the MCPTT emergency alert request shall be considered to be an authorised
request for an MCPTT emergency alert targeted to an MCPTT group. In all other
cases, the MCPTT emergency alert request shall be considered to be an
unauthorised request for an MCPTT emergency alert targeted to an MCPTT group.
NOTE 1: How the IWF authorizes a user to initiate alerts and how the IWF
decides to allow emergency alerts on a group is out of scope of the present
document.
If the IWF performing the controlling role has received a SIP request targeted
to a user with the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body set to a value of \"true\", the IWF performing the
controlling role shall check the following condition:
1) if the calling user is authorized by the IWF for emergency alerts;
then the MCPTT emergency alert request shall be considered to be an authorised
request for an MCPTT emergency alert targeted to a user. In all other cases,
it shall be considered to be an unauthorised request for an MCPTT emergency
alert targeted to a user.
NOTE 2: How the IWF authorizes a user to initiate alerts to other users is out
of scope of the present document.
Editor\'s note: How and whether the IWF obtains user profile information for
MCPTT users, and whether the MCPTT system needs access to IWF user profile
information is FFS.
###### 106.3.3.1.13.2 Determining authorisation for initiating an MCPTT
emergency group or private call
If the IWF performing the controlling role has received a SIP request for an
MCPTT group call with the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and:
1) if the MCPTT user is authorized by the IWF to initiate emergency calls and
if the group is configured to allow emergency calls, then the IWF performing
the controlling role shall consider the MCPTT emergency group call request to
be an authorised request for an MCPTT emergency group call and skip the
remaining step; or
NOTE 1: How the IWF determines whether the user is authorized to initiate an
emergency group call and whether the group supports emergency calls is out of
scope of the current document.
2) if the IWF performing the controlling role does not consider the MCPTT
emergency group call request to be an authorised request for an MCPTT
emergency group call by step 1) above, then the IWF performing the controlling
role shall consider the MCPTT emergency group call request to be an
unauthorised request for an MCPTT emergency group call.
If the IWF performing the controlling role has received a SIP request for an
MCPTT private call with the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\", the
IWF performing the controlling role determines whether the user is authorized
to initiate an emergency private call.
NOTE 2: How the IWF determines whether the user is authorized to initiate an
emergency private call is out of scope of the current document.
Editor\'s note: How and whether the IWF obtains user profile information for
MCPTT users, and whether the MCPTT system needs access to IWF user profile
information is FFS.
###### 106.3.3.1.13.3 Determining authorisation for cancelling an MCPTT
emergency alert
If the IWF performing the controlling role has received a SIP request with the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body set
to a value of \"false\", the IWF may authorize the MCPTT emergency alert
cancellation.
NOTE: How the IWF determines whether to authorize a user to cancel an
emergency alert is out of scope of the present document.
###### 106.3.3.1.13.4 Determining authorisation for cancelling an MCPTT
emergency call
If the IWF performing the controlling role has received a SIP request for an
MCPTT group call with the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"false\", the
IWF may authorize the MCPTT emergency group call cancellation request.
NOTE 1: How the IWF determines whether to authorize a user to cancel a group
call emergency is out of scope of the present document.
If the IWF performing the controlling role has received a SIP request for an
MCPTT private call with the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"false\", the
IWF may authorize the MCPTT emergency private call cancellation request.
NOTE 2: How the IWF determines whether to authorize a user to cancel a private
call emergency is out of scope of the present document.
###### 106.3.3.1.13.5 Determining authorisation for initiating an MCPTT
imminent peril call
If the IWF performing the controlling role has received a SIP request with the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body set to a value of \"true\"; and
1) if the MCPTT user is authorized by the IWF performing the controlling role
to initiate an imminent peril call; and
2) if the IWF allows the group to support imminent peril calls;
NOTE: How the IWF authorizes the user to initiate imminent peril calls and how
the IWF determines whether to allow imminent peril calls on a group is out of
scope of the present document.
then the MCPTT imminent peril call request shall be considered to be an
authorised request for an MCPTT imminent peril call. In all other cases, it
shall be considered to be an unauthorised request for an MCPTT imminent peril
call.
Editor\'s note: How and whether the IWF obtains user profile information for
MCPTT users, and whether the MCPTT system needs access to IWF user profile
information is FFS.
###### 106.3.3.1.13.6 Determining authorisation for cancelling an MCPTT
imminent peril call
If the IWF performing the controlling role has received a SIP request with the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body set to a value of \"false\", the IWF may authorize the MCPTT imminent
peril call cancellation request.
NOTE: How the IWF determines whether to authorize a user to cancel an imminent
peril call is out of scope of the present document.
###### 106.3.3.1.13.7 Sending a SIP OPTIONS request to authorise an MCPTT user
at a non-controlling MCPTT function of a MCPTT group
This subclause is referenced from other procedures.
The IWF performing the controlling role:
1) if the \ element is included in the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request, shall generate a SIP OPTIONS request according to 3GPP TS 24.229 [4]
and the IETF RFC 3261 [24] populated as follows:
a) shall set the Request-URI to the public service identity of the non-
controlling MCPTT function associated with the MCPTT Group ID which was
present in the \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request;
NOTE 1: How the IWF performing the controlling role finds the address of the
non-controlling MCPTT function is out of the scope of the current release.
b) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header
field according to IETF RFC 6050 [9];
c) shall include in the P-Asserted-Identity header field, the public service
identity of the IWF performing the controlling role;
d) shall include an application/vnd.3gpp.mcptt-info+xml MIME body where:
i) the \ element shall be set to the value of the
\ element in the application/vnd.3gpp.mcptt-info+xml MIME
body of the incoming SIP INVITE request; and
ii) the \ element is set to the same value as in the
\ element in the application/vnd.3gpp.mcptt-info+xml
MIME body of the incoming SIP INVITE request;
e) shall include the following in the Contact header field:
i) the g.3gpp.mcptt media feature tag; and
ii) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and
f) send the SIP OPTIONS request as specified in 3GPP TS 24.229 [4]; and
2) if the \ element is not included in the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request, shall for each constituent MCPTT group not homed in the IWF
performing the controlling role generate a SIP OPTIONS request according to
3GPP TS 24.229 [4] and IETF RFC 3261 [24] populated as follows:
a) shall set the Request-URI to the public service identity of the non-
controlling MCPTT function associated with the MCPTT group ID of the
constituent group;
NOTE 2: How the IWF performing the controlling role finds the address of the
non-controlling MCPTT function is out of the scope of the current release.
b) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header
field according to IETF RFC 6050 [9];
c) shall include in the P-Asserted-Identity header field, the public service
identity of the IWF performing the controlling role;
d) shall include an application/vnd.3gpp.mcptt-info+xml MIME body where:
i) the \ element shall be set to the MCPTT group ID of the
constituent group; and
ii) the \ element is set to the same value as in the
\ element in the application/vnd.3gpp.mcptt-info+xml
MIME body of the incoming SIP INVITE request;
e) shall include the following in the Contact header field:
i) the g.3gpp.mcptt media feature tag; and
ii) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and
f) send the SIP OPTIONS request as specified in 3GPP TS 24.229 [4].
Upon receipt of the first SIP 200 (OK) response to the SIP OPTIONS request
with the mcptt-warn-code set to \"147\" in a Warning header field as specified
in 3GPP TS 24.379 [81] subclause 4.4, the IWF acting as the controlling
function shall return a SIP 302 (Moved Temporarily) response to the \"SIP
INVITE request for controlling MCPTT function of an MCPTT group\" populated as
follows:
1) the URI in the Contact header field set to the P-Asserted-Identity received
in the SIP 200 (OK) response;
2) an application/vnd.3gpp.mcptt-info MIME body with:
a) the \ element set to the same value as received in the
\ in the SIP 2xx response to the SIP OPTIONS request; and
b) the \ element set to the value received in the \ element in the application/vnd.3gpp.mcptt.info+xml MIME body of the
received SIP 2xx response to the SIP OPTIONS request; and
3) if more than one OPTIONS request were sent, shall remove any cached SIP
response and ignore any other responses to any other OPTIONS request.
Upon receipt of a SIP 404 (Not Found) response to the SIP OPTIONS request such
that the mcptt-warn-code set to \"113\" in a Warning header field as specified
in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the controlling
function:
1) if more than one SIP OPTIONS request were sent and if no other responses to
SIP OPTIONS request are expected; shall send a SIP 404 (Not Found) response to
\"SIP INVITE request for controlling MCPTT function of an MCPTT group\" and
include the Warning header field received in the SIP 404 (Not Found) response;
and
2) if more than one OPTIONS request were sent and other responses to SIP
OPTIONS request are expected, shall cache the received SIP 404 (Not Found)
response.
Upon receipt of a SIP 403 (Forbidden) response to the SIP OPTIONS request, the
mcptt-warn-code set to \"106\" or \"109\" in a Warning header field as
specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server, and if more than one OPTIONS request were sent and if no other
responses to the SIP OPTIONS request are expected, the IWF performing the
controlling role:
1) if a SIP 404 (Not Found) response is cached, send a SIP 404 (Not Found)
response to \"SIP INVITE request for controlling MCPTT function of an MCPTT
group\" and include the Warning header field received in the SIP 404 (Not
Found) response; and
2) if a SIP 404 (Not Found) response is not cached, shall return a SIP 403
(Forbidden) response to \"SIP INVITE request for controlling MCPTT function of
an MCPTT group\" and include the Warning header field received in the SIP 403
(Forbidden) response.
Upon receipt of any other response to the SIP OPTIONS response than specified
above and if more than one OPTIONS request were sent and if no other responses
to the SIP OPTIONS request are expected, the IWF performing the controlling
role:
1) if a SIP 404 (Not Found) response is cached, send a SIP 404 (Not Found)
response to \"SIP INVITE request for controlling MCPTT function of an MCPTT
group\" and include the Warning header field received in the SIP 404 (Not
Found) response; and
2) if a SIP 404 (Not Found) response is not cached, shall return a SIP 403
(Forbidden) response to \"SIP INVITE request for controlling MCPTT function of
an MCPTT group\".
NOTE 3: The reason for selecting the SIP 404 (Not Found) response when a SIP
404 (Not Found) response is cached is to indicate that it was a valid request
but the MCPTT user identified in the \ is not a member
of any of the constituent MCPTT groups in the temporary group.
##### 106.3.3.1.14 Generating a SIP 403 response for priority call request
rejection
If the IWF performing the controlling role has received a SIP request with the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body
is set to \"true\" and this is an unauthorised request for an MCPTT emergency
call as determined by the procedures of subclause 106.3.3.1.13.2, the
controlling MCPTT function shall:
1) include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in 3GPP TS 24.379 [81], clause F.1 with the
\ element containing the \ element with the
\.
##### 106.3.3.1.16 Handling the expiry of timer TNG2 (in-progress emergency
group call timer)
Upon expiry of timer TNG2 (in-progress emergency group call timer) for an
MCPTT group, the IWF performing the controlling role:
1) shall set the in-progress emergency state of the group to a value of
\"false\";
2) shall, if an MCPTT group call or MCPTT group session is in progress on the
indicated group, for each of the participating members:
a) generate a SIP re-INVITE request as specified in subclause 106.3.3.1.10;
and
b) send the SIP re-INVITE request towards the MCPTT client according to 3GPP
TS 24.229 [4]; and
3) shall for each affiliated but non-participating member of the group:
a) generate a SIP MESSAGE request according to 3GPP TS 24.379 [81] subclause
6.3.3.1.11, with the IWF acting as the controlling function and include in the
application/vnd.3gpp.mcptt-info+xml MIME body an \ element set
to a value of \"false\";
b) shall include in the P-Asserted-Identity header field the public service
identity of the controlling MCPTT function;
c) include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as
specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field
according to IETF RFC 6050 [9]; and
d) send the SIP MESSAGE request towards the MCPTT client according to rules
and procedures of 3GPP TS 24.229 [4].
Upon receiving a SIP 200 (OK) response to a re-SIP INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5].
##### 106.3.3.1.18 Sending a SIP INFO request in the dialog of a SIP request
for a priority call
This subclause is referenced from other procedures and describes how the IWF
performing the controlling role generates a SIP INFO request due to the
receipt of a SIP request for a priority call.
The IWF performing the controlling role:
1) shall generate a SIP INFO request according to rules and procedures of 3GPP
TS 24.229 [4] and IETF RFC 6086 [64];
2) shall include the Info-Package header field set to g.3gpp.mcptt-info in the
SIP INFO request;
3) shall include an application/vnd.3gpp.mcptt-info+xml MIME body in the SIP
INFO request and:
a) if the received SIP request contained application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element set to a value of \"true\" and this is
an unauthorised request for an MCPTT emergency alert as specified in subclause
106.3.3.1.13.1, shall set the \ element to a value of \"true\"
and the \ element to a value of \"false\";
b) if the received SIP request contains an application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element set to a value of \"false\" and if
this is an unauthorised request for an MCPTT emergency alert cancellation,
shall set \ element to a value of \"true\"; and
c) if the received SIP request contains an application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element set to a value of \"true\",
this is an authorised request for an MCPTT imminent peril group call and the
in-progress emergency state of the group is set to a value of \"true\", shall
set the \ element to a value of \"false\" and the
\ element set to a value of \"true\"; and
4) shall send the SIP INFO request towards the inviting MCPTT client in the
dialog created by the SIP request from the inviting MCPTT client, as specified
in 3GPP TS 24.229 [4].
##### 106.3.3.1.19 Retrieving Resource-Priority header field values
This subclause is referenced from other procedures.
The IWF performing the controlling role may populate the Resource-Priority
header field to assist interworked MC systems in setting bearer priorities.
The IWF can set emergency, imminent peril and normal priorities for private
and group calls. The priority values and namespaces are as specified in IETF
RFC 8101 [48].
NOTE: How the IWF obtains the values for Resource-Priority header fields is
out of scope of the present document.
##### 106.3.3.2.4 Receiving a SIP BYE request
Upon receiving a SIP BYE request the IWF performing the controlling role:
1) shall interact with the media plane as specified in subclause 6.3 in 3GPP
TS 24.380 [5] for releasing the media plane resource associated with the SIP
session towards the MCPTT client;
NOTE: The IWF performing the non-controlling role is also regarded as a MCPTT
client in a temporary MCPTT group session.
2) shall generate a SIP 200 (OK) response and send the SIP response towards
the MCPTT client according to 3GPP TS 24.229 [4];
3) shall check the MCPTT session release policy as specified in subclause
106.3.8.1 and subclause 106.3.8.2 whether the MCPTT session needs to be
released for each participant of the MCPTT session;
4) if release of the MCPTT session is required:
a) shall perform the procedures as specified in the subclause 106.3.3.1.5 with
the clarification that if the received SIP BYE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body, copy the
application/vnd.3gpp.mcptt-info+xml MIME body into the outgoing SIP BYE
request; and
5) if a release of the MCPTT session is not required, shall send a SIP NOTIFY
request to all remaining MCPTT clients in the MCPTT session with a
subscription to the conference event package as specified in 3GPP TS 24.379
[81], subclause 10.1.3.4.2 with the IWF acting as the controlling MCPTT
function.
Upon receiving a SIP 200 (OK) response to the SIP BYE request the IWF
performing the controlling shall interact with the media plane as specified in
subclause 6.3 in 3GPP TS 24.380 [5] for releasing media plane resources
associated with the SIP session with the MCPTT participant.
#### 106.3.3.3 Handling of the acknowledged call setup timer (TNG1)
When the IWF performing the controlling role receives a SIP INVITE request to
initiate a group session and there are members of the group that are
affiliated and are deemed by the IWF to be required for the call, then the IWF
performing the controlling role shall start timer TNG1 (acknowledged call
setup timer), prior to sending out SIP INVITE requests inviting group members
to the group session.
NOTE 1: How the IWF obtains the value of the TNG1 timer is out of scope of the
present document.
NOTE 2: How the IWF determines the required participants for the call, whether
to require certain participants for the call or whether to require a certain
number of participants for the call is out of scope of the present document.
When the IWF performing the controlling role receives all SIP 200 (OK)
responses to the SIP INVITE requests, from all affiliated and required members
then the IWF performing the controlling role shall stop timer TNG1
(acknowledged call setup timer) and if the local counter of the number of SIP
200 (OK) responses received from invited members is greater than or equal to
the required number of participants, the IWF performing the controlling role
shall send a SIP 200 (OK) response to the initiating MCPTT client and shall
interact with the media plane as specified in 3GPP TS 24.380 [5].
NOTE 3: MCPTT clients that are affiliated but are not required members that
have not yet responded will be considered as joining an ongoing session when
the IWF performing the controlling role receives SIP 200 (OK) responses from
these MCPTT clients.
After expiry of timer TNG1 (acknowledged call setup timer) and the local
counter of the number of SIP 200 (OK) responses received from invited members
is less than the value required by the IWF performing the controlling role,
then the IWF performing the controlling role shall wait until further
responses have been received from invited clients and the value of the local
counter of the number of SIP 200 (OK) responses received from invited members
is equal to the number required by the IWF performing the controlling role,
before continuing with the timer TNG1 expiry procedures in this subclause.
After expiry of timer TNG1 (acknowledged call setup timer) and the local
counter of the number of SIP 200 (OK) responses received from invited members
is greater or equal to the number required by the IWF performing the
controlling role, the IWF performing the controlling role shall execute the
steps described below:
1) if the IWF is configured to \"proceed\" with the setup of the group call,
then the IWF performing the controlling role:
a) shall perform the following actions:
i) generate a SIP 200 (OK) response to the SIP INVITE request as specified in
the 3GPP TS 24.379 [81] subclause 6.3.3.2.2 before continuing with the rest of
the steps;
ii) include in the SIP 200 (OK) response the warning text set to \"111 group
call proceeded without all required group members\" in a Warning header field
as specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server MCPTT function;
iii) include in the SIP 200 (OK) response an SDP answer to the SDP offer in
the incoming SIP INVITE request as specified in the 3GPP TS 24.379 [81]
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
iv) interact with the media plane as specified in 3GPP TS 24.380 [5]; and
NOTE 4: Resulting media plane processing is completed before the next step is
performed.
v) send a SIP 200 (OK) response to the inviting MCPTT client according to 3GPP
TS 24.229 [4];
b) when a SIP 200 (OK) response to a SIP INVITE request is received from an
invited MCPTT client the IWF performing the controlling role may send an in-
dialog SIP MESSAGE request to the MCPTT client that originated the group
session with the text \"group call proceeded without all required group
members\";
c) when the IWF performing the controlling role receives a SIP BYE request
from an invited MCPTT client, shall take the actions specified in subclause
106.3.3.2.4 and may send an in-dialog SIP MESSAGE request to the MCPTT client
that originated the group session with the text \"group call proceeded without
all required group members\"; and
d) shall generate a notification package as specified in subclause 106.3.3.4
and send a SIP NOTIFY request according to 3GPP TS 24.229 [4] to the MCPTT
clients which have subscribed to the conference event package; and
2) if the IWF is configured to \"abandon\" the setup of the group call, then
the IWF performing the controlling role shall:
a) send a SIP 480 (Temporarily Unavailable) response to the MCPTT client that
originated the group session with the warning text set to \"112 group call
abandoned due to required group members not part of the group session\" in a
Warning header field as specified in 3GPP TS 24.379 [81] subclause 4.4, with
the IWF acting as the MCPTT server;
b) for each confirmed dialog at the IWF performing the controlling role, send
a SIP BYE request towards the MCPTT clients invited to the group session in
accordance with 3GPP TS 24.229 [4] and interact with the media plane as
specified in 3GPP TS 24.380 [5]; and
c) for each non-confirmed dialog at the IWF performing the controlling role,
send a SIP CANCEL request towards the MCPTT clients invited to the group
session in accordance with 3GPP TS 24.229 [4].
If the IWF performing the controlling role receives a final SIP 4xx, 5xx or
6xx response from an affiliated and required group member prior to expiry of
timer TNG1 (acknowledged call setup timer) and based on policy, the IWF
performing the controlling role decides not to continue with the establishment
of the group call without the affiliated and required group member, then the
IWF performing the controlling role:
NOTE 5: It is expected that this action is taken if the policy is to abandon
the call on expiry of timer TNG1 (acknowledged call setup timer).
1) shall stop timer TNG1 (acknowledged call setup timer); and
2) shall forward the final SIP 4xx, 5xx or 6xx response towards the inviting
MCPTT client with the warning text set to \"112 group call abandoned due to
required group member not part of the group session\" in a Warning header
field as specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting
as the MCPTT server.
If:
1) the IWF performing the controlling role receives a final SIP 4xx, 5xx or
6xx response from an affiliated and required group member prior to expiry of
timer TNG1 (acknowledged call setup timer);
2) the local counter of the number of SIP 200 (OK) responses received from
invited members is greater than or equal to the required number of
participants; and
3) based on policy, the IWF performing the controlling role decides to
continue with the establishment of the group call without the affiliated and
required group member;
then the IWF performing the controlling role:
NOTE 6: It is expected that this action is taken if the policy is to proceed
with the call on expiry of timer TNG1 (acknowledged call setup timer).
1) if all other invited clients have not yet responded, shall continue running
timer TNG1 (acknowledged call setup timer); and
2) if all other invited clients have responded with SIP 200 (OK) responses,
shall
a) stop timer TNG1 (acknowledged call setup timer);
b) generate SIP 200 (OK) response to the SIP INVITE request as specified in
the 3GPP TS 24.379 [81] subclause 6.3.3.2.2 before continuing with the rest of
the steps;
c) include in the SIP 200 (OK) response the warning text set to \"111 group
call proceeded without all required group members\" in a Warning header field
as specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server;
d) include in the SIP 200 (OK) response an SDP answer to the SDP offer in the
incoming SIP INVITE request as specified in the 3GPP TS 24.379 [81] subclause
6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
e) interact with the media plane as specified in 3GPP TS 24.380 [5]; and
NOTE 7: Resulting media plane processing is completed before the next step is
performed.
f) send a SIP 200 (OK) response to the inviting MCPTT client according to 3GPP
TS 24.229 [4].
#### 106.3.3.4 Generating a SIP NOTIFY request
The IWF performing the controlling role shall generate a SIP NOTIFY request
according to 3GPP TS 24.229 [4] with the clarification in this subclause.
In the SIP NOTIFY request, the IWF performing the controlling role:
1) shall set the P-Asserted-Identity header field to the public service
identity of the IWF performing the controlling role;
2) shall include an Event header field set to \"conference\";
3) shall include an Expires header field set to 3600 seconds according to IETF
RFC 4575 [30], as default value;
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
field according to IETF RFC 6050 [9]; and
5) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with:
a) the \ set to the value of the MCPTT group ID;
b) if the target is a MCPTT user, the value of \ element
set to the value of MCPTT ID of the targeted MCPTT user; and
c) if the target is the non-controlling MCPTT function, the value of \ element set to the constituent MCPTT group ID.
In the SIP NOTIFY request, the IWF performing the controlling role shall
include an application/conference-info+xml MIME body according to IETF RFC
4575 [30] with the following limitations:
1) the IWF performing the controlling role shall include the MCPTT group ID of
the MCPTT group in the \"entity\" attribute of the \ element;
2) for each non-IWF connected participant in the MCPTT session with the
exception of non-controlling MCPTT functions, the IWF performing the
controlling role shall include a \ element. The \ element:
NOTE 1: Non-controlling MCPTT functions will appear as a participant in
temporary group sessions.
a) shall include the \"entity\" attribute. The \"entity\" attribute:
i) shall for the MCPTT client, which initiated, joined or re-joined an MCPTT
session, include the MCPTT ID of the user that originated the request; and
ii) shall for an invited MCPTT client include the MCPTT ID of the invited
MCPTT user in case of a prearranged group call or chat group call;
b) shall include a single \ element. The \ element:
i) shall include the \"entity\" attribute; and
ii) shall include the \ element indicating the status of the MCPTT
session according to RFC 4575; and
c) may include the \ element.
NOTE 2: The usage of \ is only applicable for human consumption.
#### 106.3.3.5 Handling of the group call timer (TNG3)
##### 106.3.3.5.1 General
When the IWF performing the controlling role receives a SIP INVITE request to
initiate a group session, then after an MCPTT session identity has been
allocated for the group session, the IWF performing the controlling role shall
start timer TNG3 (group call timer).
NOTE 1: How the IWF determines the value of the TNG3 timer is out of scope of
the present document.
If the IWF does not have a TNG3 timer value, then the IWF performing the
controlling role shall not start timer TNG3 (group call timer).
NOTE 2: The group call timer is mandated for a pre-arranged group and is
optional for a chat group.
When merging two or more active group calls into a temporary group call, if
the IWF is hosting at least one of the active group calls shall stop timer
TNG3 (group call timer) for each hosted group call, and the IWF performing the
controlling role hosting the temporary group call shall start timer TNG3
(group call timer) for the temporary group call.
NOTE 3: MCPTT server(s) other than the IWF that are hosting the independent
active group calls become non-controlling MCPTT function(s) of an MCPTT group,
for the temporary group call.
When splitting a temporary group call into independent group calls, the IWF
performing the controlling role hosting the temporary group call shall stop
timer TNG3 (group call timer) and the controlling MCPTT function(s) hosting
the independent group calls shall start TNG3 (group call timer) for each group
call.
When the last MCPTT client leaves the MCPTT session, the IWF performing the
controlling role shall stop timer TNG3 (group call timer).
On expiry of timer TNG3 (group call timer), the IWF performing the controlling
role shall release the MCPTT session by following the procedures in subclause
106.3.3.1.5;
##### 106.3.3.5.2 Interaction with the in-progress emergency group call timer
(TNG2)
If the IWF performing the controlling role starts timer TNG2 (in-progress
emergency group call timer), it shall not start timer TNG3 (group call timer).
If timer TNG3 (group call timer) is running and the MCPTT group call is
upgraded to an MCPTT emergency group call, then the IWF performing the
controlling role shall stop timer TNG3 (group call timer) and shall start
timer TNG2 (in-progress emergency group call timer). If timer TNG2 (in-
progress emergency group call timer) is running and the MCPTT emergency group
call is cancelled, then the IWF performing the controlling role shall stop
timer TNG2 (in-progress emergency group call timer) and shall start timer TNG3
(group call timer).
NOTE 1: How the IWF determines the value of the TNG2 and TNG3 timers is out of
scope of the present document.
If timer TNG2 (in-progress emergency group call timer) is running and
subsequently expires, then the controlling MCPTT function shall start timer
TNG3 (group call timer).
NOTE 2: The above conditions for starting timer TNG2 (in-progress emergency
group call timer) and timer TNG3 (group call timer) also apply in the case
that these timers are re-started. For example: the case where the timer TNG3
was initially running, the MCPTT group call is upgraded to an MCPTT emergency
group call and then the MCPTT emergency group call is cancelled.
### 106.3.4 IWF non-controlling role
#### 106.3.4.1 Request initiated by the IWF performing the non-controlling
role of a group
##### 106.3.4.1.1 SDP offer generation
The SDP offer is generated based on the received SDP offer to be sent to MCPTT
clients that are a member of the group homed in the IWF. The SDP offer
generated by the IWF performing the non-controlling role of a group:
1) shall include only one SDP media-level section for speech as contained in
the received SDP offer; and
2) shall include an SDP media-level section for one media-floor control
entity, if present in the received SDP offer.
When composing the SDP offer according to 3GPP TS 24.229 [4], the IWF
performing the non-controlling role of a group:
1) shall replace the IP address and port number for the offered media stream
in the received SDP offer with the IP address and port number of the IWF
performing the non-controlling role;
2) shall include all media-level attributes from the received SDP offer;
3) shall replace the IP address and port number for the offered media floor
control entity, if any, in the received SDP offer with the IP address and port
number of the IWF performing the non-controlling role; and
4) shall include the offered media floor control entity \'fmtp\' attributes as
specified in 3GPP TS 24.380 [5] clause 14.
##### 106.3.4.1.2 Sending an INVITE request towards the MCPTT client
This subclause is referenced from other procedures.
This subclause covers the situation where a group homed in the IWF is a
constituent group of a group homed in an MCPTT system.
If the IWF receives a \"SIP INVITE request for non-controlling MCPTT function
of an MCPTT group\" and does not support group regroup procedures, the IWF
shall reject the SIP INVITE request with a SIP 403 (Forbidden) response with
the warning text set to \"100 function not allowed due to local policy\" in a
Warning header field as specified in 3GPP TS 24.379 [81] subclause 4.4, and
shall not execute the remainder of this procedure.
If there are MCPTT clients that are members of the group, the IWF performing
the non-controlling role of a group shall generate initial SIP INVITE requests
according to 3GPP TS 24.229 [4].
NOTE 1: How the IWF includes participants homed in the IWF is out of scope.
For each SIP INVITE request, the IWF performing the non-controlling role of a
group:
1) shall generate a new MCPTT session identity for the MCPTT session with the
invited MCPTT client and include it in the Contact header field together with
the g.3gpp.mcptt media feature tag, the g.3gpp.icsi-ref media feature tag with
the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\", and the isfocus media
feature tag according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the g.3gpp.mcptt
media feature tag along with the \"require\" and \"explicit\" header field
parameters according to IETF RFC 3841 [6];
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header
field according to IETF RFC 6050 [9] in the SIP INVITE request;
4) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
along with parameters \"require\" and \"explicit\" according to IETF RFC 3841
[6];
5) shall set the Request-URI to the public service identity of the terminating
participating MCPTT function associated to the MCPTT ID of the MCPTT user to
be invited;
NOTE 2: How the IWF finds the address of the terminating participating MCPTT
function is out of the scope of the current release.
NOTE 3: If the terminating MCPTT user is part of a partner MCPTT system, then
the public service identity can identify an entry point in the partner network
that is able to identify the terminating participating MCPTT function.
6) shall copy the application/vnd.3gpp.mcptt-info+xml MIME body in the
received SIP INVITE request to the outgoing SIP INVITE request;
7) shall update the application/vnd.3gpp.mcptt-info+xml MIME body with: a
\ element set to the MCPTT ID of the invited MCPTT user;
8) shall include the public service identity of the IWF in the P-Asserted-
Identity header field;
9) shall include the received Referred-By header field with the public service
identity of the IWF;
10) should include the Session-Expires header field according to rules and
procedures of IETF RFC 4028 [7]. The refresher parameter shall be omitted;
11) shall include the Supported header field set to \"timer\";
12) shall include an unmodified Answer-Mode header field, if present in the
incoming SIP INVITE request; and
13) shall include the warning text set to \"148 MCPTT group is regrouped\" in
a Warning header field as specified in 3GPP TS 24.379 [81] subclause 4.4.
NOTE 4: As long as the MCPTT group is regrouped the floor control messages in
the media plane includes a grouped regrouped indication as specified in 3GPP
TS 24.380 [5].
##### 106.3.4.1.3 Sending a SIP INFO request
This subclause is referenced from other procedures.
This subclause covers the situation where a group homed in the IWF is a
constituent group of a group homed in an MCPTT system.
If the IWF performing the non-controlling role receives a \"SIP INVITE request
for non-controlling MCPTT function of an MCPTT group\" and does not support
group regroup procedures, the IWF shall reject the SIP INVITE request with a
SIP 403 (Forbidden) response with the warning text set to \"100 function not
allowed due to local policy\" in a Warning header field as specified in 3GPP
TS 24.379 [81] subclause 4.4, and shall not execute the remainder of this
procedure.
The IWF shall generate a SIP INFO request according to rules and procedures of
3GPP TS 24.229 [4] and IETF RFC 6086 [64].
The IWF:
1) shall include the Info-Package header field set to g.3gpp.mcptt-floor-
request;
2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ set to the temporary MCPTT group ID and the \ element with the constituent MCPTT group ID;
3) shall include an application/vnd.3gpp.mcptt-floor-request+xml MIME body
with the Content-Disposition header field set to \"Info-Package\". For each
current speaker the application/vnd.3gpp.mcptt-floor-request+xml MIME body
shall be populated as follows:
a) the \ element set to \"general\" or \"dual\" as described in
3GPP TS 24.379 [81] subclause F.5.3;
b) the SSRC of the MCPTT client or participant homed in the IWF with the
permission to send media in the \ element;
c) the actual floor priority in the \ element;
d) the MCPTT ID of the MCPTT user or participant homed in the IWF with the
permission to send media in the \ element;
e) the queueing capability in the \ element of the
\ element;
f) the participant type in the \ in the \
element;
g) one or more \ elements in the \
element in the same order as the would appear in the Track Info field as
specified in 3GPP TS 24.380 [5] subclause 8.2.3.13; and
h) if available, additional information in the \ element; and
4) if:
a) the user with permission to send media is an MCPTT client, and if:
i) the IWF has location information (see 3GPP TS 24.379 [81] subclause 13.2.4)
for the MCPTT client;
ii) the location information for the MCPTT client either has not been sent to
the controlling MCPTT function or has changed since last sent to the MCPTT
controlling function; and
iii) the IWF determines that the location of the MCPTT client is allowed to be
sent when the MCPTT user is talking; or
b) the user with permission to send media is a participant homed in the IWF,
and if:
i) location information for the user with permission to send media homed in
the IWF is available;
ii) the location information for the participant homed in the IWF has either
not been sent to the controlling MCPTT function or has changed since last sent
to the controlling MCPTT function; and
iii) the IWF determines that the location of the participant homed in the IWF
is allowed to be sent when the participant homed in the IWF is talking;
then shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body
with a \ element included in the \ root element.
##### 106.3.4.1.4 Sending an INVITE request towards the controlling MCPTT
function
This subclause is referenced from other procedures.
The IWF shall generate a SIP INVITE request according to rules and procedures
of 3GPP TS 24.229 [4].
The IWF:
1) shall include in the Contact header field the g.3gpp.mcptt media feature
tag, the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcptt\", and the isfocus media feature tag according to IETF
RFC 3840 [16];
2) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header
field according to IETF RFC 6050 [9] in the SIP INVITE request;
3) shall set the Request-URI to the public service identity of the controlling
MCPTT function;
4) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with:
a) the \ element set to the group identity;
b) the \ element set to the MCPTT ID of the calling
user; and
c) the \ element set to \"true\", if the group document retrieved
from the group management server contains \ group members
as specified in 3GPP TS 24.481 [31];
5) shall include the public service identity of the IWF in the P-Asserted-
Identity header field;
6) should include the Session-Expires header field according to rules and
procedures of IETF RFC 4028 [7]. The refresher parameter shall be omitted; and
7) shall include the Supported header field set to \"timer\".
##### 106.3.4.2.1 SDP answer generation
When composing the SDP answer according to 3GPP TS 24.229 [4], the IWF
performing the non-controlling role of a group:
1) for the accepted media stream in the received SDP offer:
a) shall replace the IP address and port number in the received SDP offer with
the IP address and port number of the IWF performing the non-controlling role;
and
2) for the accepted media-floor control entity, if present in the received SDP
offer:
a) shall replace the IP address and port number in the received SDP offer with
the IP address and port number of the IWF performing the non-controlling role;
and
b) shall include \'fmtp\' attributes as specified in 3GPP TS 24.380 [5] clause
14.
###### 106.3.4.2.2.1 Sending a SIP 183 (Session Progress) response
When sending a SIP 183 (Session Progress) the IWF performing the non-
controlling role of a group:
1) shall generate a SIP 183 (Session Progress) response according to 3GPP TS
24.229 [4];
2) shall include the following in the Contact header field:
a) the g.3gpp.mcptt media feature tag; and
b) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
3) shall include the public service identity determined by the IWF performing
the non-controlling role in the P-Asserted-Identity header field; and
4) shall include the option tag \"tdialog\" in a Supported header field
according to rules and procedures of IETF RFC 4538 [23].
###### 106.3.4.2.2.2 Sending a SIP 200 (OK) response
When sending a SIP 200 (OK) response, the IWF performing the non-controlling
role of a group homed in the IWF:
1) shall generate the SIP 200 (OK) response according to rules and procedures
of 3GPP TS 24.229 [4];
2) shall include the Session-Expires header field and start supervising the
SIP session according to rules and procedures of IETF RFC 4028 [7], \"UAS
Behaviour\". The \"refresher\" parameter in the Session-Expires header field
shall be set to \"uac\";
3) shall include the option tag \"timer\" in a Require header field;
4) shall include the public service identity of the IWF performing the non-
controlling role in the P-Asserted-Identity header field;
5) shall include the following in the Contact header field:
a) the g.3gpp.mcptt media feature tag; and
b) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
6) shall include Warning header field(s) received from MCPTT clients in
incoming responses to the SIP INVITE request;
7) shall include the option tag \"tdialog\" in a Supported header field
according to rules and procedures of IETF RFC 4538 [23]; and
8) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to the constituent MCPTT group ID and the
\ element set to the state of the floor.
#### 106.3.4.3 Generating a SIP NOTIFY request
The IWF performing the non-controlling role shall generate a SIP NOTIFY
request according to 3GPP TS 24.229 [4] with the clarification in this
subclause.
In the SIP NOTIFY request, the IWF:
1) shall set the P-Asserted-Identity header field to the public service
identity of the IWF;
2) shall include an Event header field set to \"conference\";
3) shall include an Expires header field set to 3600 seconds according to IETF
RFC 4575 [30], as default value;
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
field according to IETF RFC 6050 [9]; and
5) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with:
a) the \ set to the value of the constituent MCPTT
group ID;
b) if the target is a MCPTT user, the value of \ element
set to the MCPTT ID of the targeted MCPTT user; and
c) if the target is the controlling MCPTT function the value of \ element set to the temporary MCPTT group ID.
In the SIP NOTIFY request, the IWF shall include application/conference-
info+xml MIME body according to IETF RFC 4575 [30] as specified in subclause
106.3.3.4 with the following exceptions:
1) the IWF performing the non-controlling role shall not regard the
controlling MCPTT function as a participant and not include the controlling
MCPTT function in a \ element; and
NOTE: The controlling MCPTT function initiated the temporary group call and
will appear as a participant in the group session.
2) the IWF shall include stored conference status information received in SIP
NOTIFY requests from the controlling MCPTT function in 3GPP TS 24.379 [81]
subclause 10.1.3.5.3 and status information about MCPTT participants that are
members of the group.
### 106.3.5 Retrieving and processing a group document
#### 106.3.5.1 General
How an IWF performing the controlling role of a group or performing the non-
controlling role of a group obtains information about the group is out of
scope of the present document.
NOTE 1: During the group regrouping operation as specified in 3GPP TS 24.481
[31], the IWF performing the controlling role is notified of the constituent
MCPTT group identities associated with the TGI.
#### 106.3.5.3 Rules for joining a group session
The following conditions shall be met for the IWF performing the controlling
role to allow an MCPTT user to join an existing group session:
1) the MCPTT user is a member of the group; and
2) the MCPTT user is authorized to join the group;
If both of the above conditions are met, then the MCPTT user shall be
authorised to join the group session.
#### 106.3.5.5 Determining the group members to invite
The IWF shall only invite affiliated group members to a group session. The IWF
determines whether MCPTT users are affiliated members of its group by
following the procedures specified in 3GPP TS 24.379 [81], subclause 6.3.6.
NOTE 1: The term \"affiliated group members\" used above also includes those
members that are implicitly affiliated by the IWF performing the controlling
role.
NOTE 2: The IWF need not store its group parameters in a GMS as described in
3GPP TS 24.481 [31] the IWF will have to respond to queries from other systems
on its IWF-3 interface, which is based upon the CSC-16 interface described in
3GPP TS 23.283 [80].
The IWF may limit the maximum number of participants.
### 106.3.7 Error handling
#### 106.3.7.1 Public service identity does not exist
Upon receiving a request that includes the Request-URI set to a public service
identity that is not allocated in the IWF, the IWF performing the
participating role or the controlling role shall return a SIP 404 (Not Found)
response.
#### 106.3.8.1 Session release policy for group call
If:
1) the call is a pre-arranged group call and if the IWF performing the
controlling role receives an indication from the media plane that the T4
(Inactivity) timer specified in 3GPP TS 24.380 [5] expired and if there is at
least one participant of the prearranged group call that is an MCPTT user;
2) there are only one or no participants in the call, including both MCPTT
participants and participants homed in the IWF;
3) if the call is a pre-arranged group call and if it is according to local
policy, the initiator of the group call leaves the call;
4) less than the minimum number of affiliated group members is present;
5) timer TNG3 (group call timer) expires; or
6) the call is a broadcast group call and if the controlling MCPTT function
receives an indication from the media plane that the T4 (Inactivity) timer
specified in 3GPP TS 24.380 [5] expired;
then the IWF performing the controlling role;
1) shall release the MCPTT session for the group call if any participants are
MCPTT users.
#### 106.3.8.2 Session release policy for private call
If:
1) IWF performing the controlling role decides that a private call has been
inactive for longer than a locally determined period; or
2) there are only one or no participants in the MCPTT session;
the IWF performing the controlling role shall release the MCPTT session for a
private call.
## 106.4 Implicit floor request
A SIP re-INVITE request fulfilling the following criteria shall be regarded by
the IWF performing the controlling role as an implicit floor request when the
originator of the request:
1) performs an upgrade of:
a) an MCPTT group call to an emergency MCPTT group call;
b) an MCPTT private call to an emergency MCPTT private call; or
c) an MCPTT group call to an imminent peril MCPTT group call; and
2) includes the \"mc_implicit_request\" \'fmtp\' attribute in the associated
UDP stream for the floor control in the SDP offer/answer as specified in 3GPP
TS 24.380 [5] clause 12.
In all other cases the SIP (re-)INVITE request shall be regarded as received
without an implicit floor request.
## 106.6 Confidentiality and Integrity Protection
### 106.6.1 General
#### 106.6.1.1 Applicability and exclusions
The procedures in subclause 106.6 apply in general to all procedures described
in clause 109, clause 110, clause 111 and clause 112.
#### 106.6.1.2 Performing XML content encryption
Whenever the IWF includes XML elements or attributes pertaining to the data
specified in 3GPP TS 24.379 [81] subclause 4.8 in SIP requests or SIP
responses, the IWF shall perform the procedures in subclause 106.6.2.3.2, with
the exception that when the IWF receives a SIP request with XML elements or
attributes in an MIME body that need to be copied from the incoming SIP
request to an outgoing SIP request without modification, the IWF shall perform
the procedures specified in subclause 106.6.2.5.
NOTE: The procedure in subclause 106.6.2.3.2 first determines (by referring to
configuration) if confidentiality protection is enabled and then call the
necessary procedures to encrypt the contents of the XML elements if
confidentiality protection is enabled.
#### 106.6.1.3 Performing integrity protection on an XML body
The IWF shall perform the procedures in subclause 106.6.3.3.2 just prior to
sending a SIP request or SIP response.
NOTE: The procedure in subclause 106.6.3.3.2 first determines if integrity
protection of XML MIME bodies is required and then calls the necessary
procedures to integrity protect each XML MIME body if integrity protection is
required. Each XML MIME body has its own signature.
#### 106.6.2.2 Keys used in confidentiality protection procedures
Confidentiality protection uses an XPK to encrypt the data which (depending on
who is the sender and who is the receiver of the encrypted information) can be
an SPK as specified in 3GPP TS 24.379 [81] subclause 4.8. An XPK-ID (SPK-ID)
is used to key the XPK (SPK). It is assumed that before the procedures in this
subclause are called, the SPK/SPK-ID is available on the sender and recipient
of the encrypted content as described in 3GPP TS 24.379 [81] subclause 4.8.
The procedures in 3GPP TS 24.379 [81], subclause 6.6.2.3 and 3GPP TS 24.379
[81] subclause 6.6.2.4 are used with an XPK equal to the SPK and a XPK-ID
equal to the SPK-ID in the following circumstances as described in 3GPP TS
33.180 [78]:
1) IWF sends confidentiality protected content to an MCPTT server in the same
domain; and
2) IWF sends confidentiality protected content to an MCPTT server in another
domain.
##### 106.6.2.3.2 IWF performing any role of an MCPTT server
If the IWF performing any role of an MCPTT server determines locally that it
needs to confidentiality protect content sent to an MCPTT server, then sending
confidentiality protected content between MCPTT servers is enabled.
When sending confidentiality protected content, the IWF:
1) shall use the appropriate keying information specified in subclause
106.6.2.2;
2) shall perform the procedures in 3GPP TS 24.379 [81] subclause 6.6.2.3.3 to
confidentiality protect XML elements containing the content described in 3GPP
TS 24.379 [81] subclause 4.8; and
3) shall perform the procedures in 3GPP TS 24.379 [81] subclause 6.6.2.3.4 to
confidentiality protect URIs in XML attributes for URIs described in 3GPP TS
24.379 [81] subclause 4.8.
If the IWF determines locally that it does not need to confidentiality protect
content sent to an MCPTT server, then sending confidentiality protected
content between MCPTT servers is disabled, and content is included in XML
elements and attributes without encryption.
#### 106.6.2.5 IWF copying received XML content
The following procedure is executed when an IWF receives a SIP request
containing XML MIME bodies, where the content needs to be copied from the
incoming SIP request to the outgoing SIP request.
The IWF:
1) shall copy the XML elements from the XML MIME body of the incoming SIP
request that do not contain a \ XML element, to the same XML
body in the outgoing SIP request;
2) for each encrypted XML element in the XML MIME body of the incoming SIP
request as determined by 3GPP TS 24.379 [81] subclause 6.6.2.4.1:
a) shall use the keying information described in subclause 106.6.2.2 to
decrypt the content within the XML element by following the procedures
specified in 3GPP TS 24.379 [81] subclause 6.6.2.4.2, and shall continue with
the steps below if the encrypted XML element was successfully decrypted;
b) if confidentiality protection is enabled as specified in subclause
106.6.2.3.2, then for each decrypted XML element:
i) shall re-encrypt the content within the XML element using the keying
information described in subclause 106.6.2.2 and by following the procedures
specified in 3GPP TS 24.379 [81] subclause 6.6.2.3.3; and
ii) shall include the re-encrypted content into the same XML MIME body of the
outgoing SIP request; and
c) if confidentiality protection is disabled as specified in subclause
106.6.2.3.2, shall include the decrypted content in the same XML MIME body of
the outgoing SIP request.
3) for each encrypted XML URI attribute in the XML MIME body of the incoming
SIP request as determined by 3GPP TS 24.379 [81] subclause 6.6.2.4.1:
a) shall use the keying information described in subclause 106.6.2.2 to
decrypt the URI value of the XML attribute by following the procedures
specified in 3GPP TS 24.379 [81] subclause 6.6.2.4.3, and shall continue with
the steps below if the encrypted XML attribute value was successfully
decrypted;
b) if confidentiality protection is enabled as specified in subclause
106.6.2.3.2, then for each decrypted XML element:
i) shall re-encrypt the URI value of the XML attribute using the keying
information described in subclause 106.6.2.2 and by following the procedures
specified in 3GPP TS 24.379 [81] subclause 6.6.2.3.4; and
ii) shall include the re-encrypted attribute value into the same XML MIME body
of the outgoing SIP request; and
c) if confidentiality protection is disabled as specified in subclause
106.6.2.3.2, shall include the decrypted value in the same XML MIME body of
the outgoing SIP request.
#### 106.6.3.2 Keys used in integrity protection procedures
Integrity protection uses an XPK to sign the data which (depending on who is
the sender and who is the receiver of the signed information) can be an SPK as
specified in 3GPP TS 24.379 [81] subclause 4.8. An XPK-ID (SPK-ID) is used to
key the XPK (SPK). It is assumed that before the procedures in 3GPP TS 24.379
[81] subclause 6.6.3.3 and 3GPP TS 24.379 [81] subclause 6.6.3.4 are called,
the SPK/SPK-ID are available on the sender and recipient of the integrity
protected content, as described in 3GPP TS 24.379 [81] subclause 4.8.
The procedures in 3GPP TS 24.379 [81] subclause 6.6.3.3 and 3GPP TS 24.379
[81] subclause 6.6.3.4 shall be used with a XPK equal to the SPK and a XPK-ID
equal to the SPK-ID in the following circumstances as described in 3GPP TS
33.180 [78]:
1) IWF sends integrity protected content to an MCPTT server in the same
domain; and
2) IWF sends integrity protected content to an MCPTT server in another domain.
##### 106.6.3.3.2 Integrity protection at the IWF
The IWF determines locally whether sending integrity protected content from
the IWF to an MCPTT server is enabled.
NOTE 1: How the IWF determines whether to integrity protect content is out of
scope of the present document.
When sending integrity protected content, the IWF shall use the appropriate
keying information specified in subclause 106.6.3.2 and shall perform the
procedures in 3GPP TS 24.379 [81] subclause 6.6.3.3.3 to integrity protect XML
MIME bodies.
NOTE 2: Each XML MIME body is integrity protected separately.
## 106.7 Priority sharing
The IWF performing the participating role shall enable or disable priority
sharing as specified in 3GPP TS 24.229 [4].
### 106.8 Private call parameters
#### 106.8.1 Private call parameter check
Parameters of an incoming SIP INVITE are indicated as follows:
1) floor control. Floor control operation is indicated by an SDP offer with a
media-level section for a media-floor control entity;
2) commencement mode. The requested commencement mode is according to the
Answer-mode header, i.e. either \"auto\" or \"manual\"; and
3) implicit floor request. An implicit floor request is indicated by inclusion
of the \"mc_implicit_request\" \'fmtp\' attribute for the floor control in the
SDP offer/answer as specified in 3GPP TS 24.380 [5] clause 12.
Additional LMR specific parameters, such as LMR encryption mode, are out of
scope of the present document. The LMR specific parameters may be conveyed in
the \ element of the \ element of
the \ element of the MIME body \ root element as defined in
3GPP TS 24.379 [81], clause F.1.
#### 106.8.2 Private call parameter response values
To reject a private call due to unsupported parameters, the IWF performing the
participating role shall include in its response to the SIP INVITE a list of
parameters from the incoming SIP INVITE that it does support.
To indicate support for one or more private call parameters, in the \ element of the \ element of the \ root element
in the XML body, the IWF:
1) if floor control is requested in the incoming SIP INVITE and is supported,
shall include the \ element;
2) if \"without\" floor control is requested in the incoming SIP INVITE and is
supported by the IWF (i.e. full duplex is not supported), shall include the
\ element;
3) if implicit floor is requested in the incoming SIP INVITE and is supported
by the IWF (i.e. the IWF need not talk first), shall include the \ element;
4) if floor is not implicitly requested in the incoming SIP INVITE and the IWF
supports floor not being implicitly requested (i.e. the IWF must talk first),
shall include the \ element;
5) if manual commencement is requested in the incoming SIP INVITE and is
supported by the IWF, shall include the \ element; and
6) if automatic commencement is requested in the incoming SIP INVITE and is
supported by the IWF, shall include the \ element.
Editor's Note: Add corresponding receive logic to 24.379 to parse and act upon
\.
# 109 Affiliation
## 109.1 General
Subclause 109.2.2.2 contains the procedures for explicit and implicit
affiliation of a user homed in the IWF, in the IWF homing that user.
Subclauses in 109.2.2.2 also cover the case where the IWF manages affiliation
to a group on behalf of the users homed at that IWF (i.e. having only one
affiliation for a whole set of users homed in the IWF). In that case, the IWF
needs to implement the same set of procedures but in those procedures, it
shall use the MCPTT ID and the MCPTT client ID that are associated with the
IWF itself instead of the ones associated with a user homed in the IWF.
NOTE: How the MCPTT ID and MCPTT client ID associated with the IWF are
determined is out of the scope of this specification.
Subclause 109.2.2.3 contains the procedures for explicit and implicit
affiliation of an MCPTT user at the IWF owning the MCPTT group.
The procedures for implicit affiliation in this clause are triggered at the
IWF for a user homed in the IWF in the following circumstances:
\- when the IWF performing the participating role attempts to join an MCPTT
chat group for a user homed in the IWF that is not already affiliated to the
MCPTT group;
\- when the IWF performing the participating role attempts to initiate an
MCPTT emergency group call or MCPTT imminent peril group call for a user homed
in the IWF that is not already affiliated to the MCPTT group;
\- when the IWF performing the participating role attempts to initiate an
MCPTT emergency alert targeted to an MCPTT group for a user homed in the IWF
that is not already affiliated to the MCPTT group.
The procedures for implicit affiliation in this clause are triggered at the
IWF owning the MCPTT group in the following circumstances:
\- on receipt of a SIP INVITE request from an MCPTT server serving an MCPTT
user where the MCPTT user wants to join an MCPTT chat group homed in the IWF
and the MCPTT client is not already affiliated to the MCPTT group homed in the
IWF;
\- on receipt of a SIP INVITE request from an MCPTT server serving an MCPTT
user where the MCPTT user initiates an MCPTT emergency group call or MCPTT
imminent peril group call to a group homed in the IWF and the MCPTT client is
not already affiliated to the MCPTT group homed in the IWF; and
\- on receipt of a SIP MESSAGE request from an MCPTT server serving an MCPTT
user when the MCPTT user initiates an MCPTT emergency alert targeted to an
MCPTT group homed in the IWF and the MCPTT client is not already affiliated to
the MCPTT group homed in the IWF.
## 109.2 Procedures
### 109.2.2 IWF procedures towards the MCPTT system
#### 109.2.2.1 General
The IWF procedures toward the MCPTT system consist of:
\- procedures toward the MCPTT system of an IWF serving the user homed in the
IWF; and
\- procedures of an IWF owning a group that is visible to the MCPTT system.
#### 109.2.2.2 Procedures toward the MCPTT system of an IWF serving the user
homed in the IWF
##### 109.2.2.2.1 General
The procedures toward the MCPTT system of an IWF serving the user homed in the
IWF consist of:
\- a receiving subscription to affiliation status procedure;
\- a sending notification of change of affiliation status procedure;
\- a sending affiliation status change towards MCPTT server owning MCPTT group
procedure;
\- an affiliation status determination from MCPTT server owning MCPTT group
procedure;
\- an affiliation status determination procedure;
\- an affiliation status change by implicit affiliation procedure;
\- an implicit affiliation status change completion procedure;
\- an implicit affiliation status change cancellation procedure; and
\- an automatic affiliation to configured groups procedure.
##### 109.2.2.2.2 Stored information
The IWF maintains information equivalent to that defined in TS 24.379 [81]
subclause 9.2.2.2.2.
NOTE: The virtual data structure referenced in this subclause is for
information only. Implementors may choose other means to track affiliation
status for users homed in the IWF. References to the elements of this virtual
data structure are made in other subclauses with the understanding that
implementors choosing not to use this virtual data structure will take other
appropriate actions.
##### 109.2.2.2.3 Procedure for handling affiliation status change of a user
homed in the IWF
When the IWF determines that affiliation status should change for a user homed
in the IWF, the IWF performing the participating role:
1) shall determine the served MCPTT ID associated with the user homed in the
IWF;
2) shall determine the candidate expiration interval for the affiliation
according to IETF RFC 3903 [37];
3) shall determine the served MCPTT client ID associated with the user homed
in the IWF;
4) shall consider an MCPTT user information entry such that:
a) the MCPTT user information entry is in the list of MCPTT user information
entries described in subclause 109.2.2.2.2; and
b) the MCPTT ID of the MCPTT user information entry is equal to the served
MCPTT ID;
as the served MCPTT user information entry;
5) shall consider an MCPTT client information entry such that:
a) the MCPTT client information entry is in the list of MCPTT client
information entries of the served MCPTT user information entry; and
b) the MCPTT client ID of the MCPTT client information entry is equal to the
served MCPTT client ID;
as the served MCPTT client information entry;
6) shall consider a copy of the list of the MCPTT group information entries of
the served MCPTT client information entry as the served list of the MCPTT
group information entries;
7) if the candidate expiration interval is nonzero:
a) shall construct the candidate list of the MCPTT group information entries
as follows:
i) for each MCPTT group ID which has an MCPTT group information entry in the
served list of the MCPTT group information entries, such that the expiration
time of the MCPTT group information entry has not expired yet, and which is
determined by the IWF to be a group to which the user homed in the IWF is to
be affiliated:
A) shall copy the MCPTT group information entry into a new MCPTT group
information entry of the candidate list of the MCPTT group information
entries;
B) if the affiliation status of the MCPTT group information entry is
\"deaffiliating\" or \"deaffiliated\", shall set the affiliation status of the
new MCPTT group information entry to the \"affiliating\" state and shall reset
the affiliating p-id of the new MCPTT group information entry; and
C) shall set the expiration time of the new MCPTT group information entry to
the current time increased with the candidate expiration interval;
ii) for each MCPTT group ID which has an MCPTT group information entry in the
served list of the MCPTT group information entries, such that the expiration
time of the MCPTT group information entry has not expired yet, and which is
determined by the IWF to be a group to which the user homed in the IWF is not
to be affiliated:
A) shall copy the MCPTT group information entry into a new MCPTT group
information entry of the candidate list of the MCPTT group information
entries; and
B) if the affiliation status of the MCPTT group information entry is
\"affiliated\" or \"affiliating\":
\- shall set the affiliation status of the new MCPTT group information entry
to the \"de-affiliating\" state; and
\- shall set the expiration time of the new MCPTT group information entry to
the current time increased with twice the value of timer F; and
iii) for each MCPTT group ID:
A) which does not have an MCPTT group information entry in the served list of
the MCPTT group information entries; or
B) which has an MCPTT group information entry in the served list of the MCPTT
group information entries, such that the expiration time of the MCPTT group
information entry has already expired;
> and which is determined by the IWF to be a group to which the user homed in
> the IWF is to be affiliated:
A) shall add a new MCPTT group information entry in the candidate list of the
MCPTT group information list for the MCPTT group ID;
B) shall set the affiliation status of the new MCPTT group information entry
to the \"affiliating\" state;
C) shall set the expiration time of the new MCPTT group information entry to
the current time increased with the candidate expiration interval; and
D) shall reset the affiliating p-id of the new MCPTT group information entry;
b) determine the candidate number of MCPTT group IDs as the number of
different MCPTT group IDs which have an MCPTT group information entry:
i) in the candidate list of the MCPTT group information entries; or
ii) in the list of the MCPTT group information entries of an MCPTT client
information entry such that:
A) the MCPTT client information entry is in the list of the MCPTT client
information entries of the served MCPTT user information entry; and
B) the MCPTT client ID of the MCPTT client information entry is not equal to
the served MCPTT client ID;
with the affiliation status set to the \"affiliating\" state or the
\"affiliated\" state and with the expiration time which has not expired yet;
and
c) if the candidate number of MCPTT group IDs is bigger than N2 value of the
served MCPTT ID, shall be based on service provider policy reduce the
candidate MCPTT group IDs to that equal to N2;
NOTE: The service provider policy can determine to remove an MCPTT group ID
based on the importance or priority of the MCPTT group or some other policy to
determine which groups are preferred.
8) if the candidate expiration interval is zero, constructs the candidate list
of the MCPTT group information entries as follows:
a) for each MCPTT group ID which has an entry in the served list of the MCPTT
group information entries:
i) shall copy the MCPTT group entry of the served list of the MCPTT group
information into a new MCPTT group information entry of the candidate list of
the MCPTT group information entries;
ii) shall set the affiliation status of the new MCPTT group information entry
to the \"de-affiliating\" state; and
iii) shall set the expiration time of the new MCPTT group information entry to
the current time increased with twice the value of timer F;
9) shall replace the list of the MCPTT group information entries stored in the
served MCPTT client information entry with the candidate list of the MCPTT
group information entries;
10) shall perform the procedures specified in subclause 109.2.2.2.6 for the
served MCPTT ID and each MCPTT group ID:
a) which does not have an MCPTT group information entry in the served list of
the MCPTT group information entries and which has an MCPTT group information
entry in the candidate list of the MCPTT group information entries with the
affiliation status set to the \"affiliating\" state;
b) which has an MCPTT group information entry in the served list of the MCPTT
group information entries with the expiration time already expired, and which
has an MCPTT group information entry in the candidate list of the MCPTT group
information entries with the affiliation status set to the \"affiliating\"
state;
c) which has an MCPTT group information entry in the served list of the MCPTT
group information entries with the affiliation status set to the
\"deaffiliating\" state or the \"deaffiliated\" state and with the expiration
time not expired yet, and which has an MCPTT group information entry in the
candidate list of the MCPTT group information entries with the affiliation
status set to the \"affiliating\" state; or
d) which has an MCPTT group information entry in the served list of the MCPTT
group information entries with the affiliation status set to the
\"affiliated\" state and with the expiration time not expired yet, and which
has an MCPTT group information entry in the candidate list of the MCPTT group
information entries with the affiliation status set to the \"de-affiliating\"
state.
##### 109.2.2.2.4 Receiving subscription to affiliation status procedure
Upon receiving a SIP SUBSCRIBE request such that:
1) the Request-URI of the SIP SUBSCRIBE request contains the public service
identity identifying the IWF performing the terminating participating role
serving the user homed in the IWF;
2) the SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body containing the\ element which identifies an MCPTT
ID associated with a user homed in the IWF performing the terminating
participating role;
3) the SIP SUBSCRIBE request contains the ICSI value \"urn:urn-7:3gpp-
service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a
P-Asserted-Service header field according to IETF RFC 6050 [9]; and
4) the Event header field of the SIP SUBSCRIBE request contains the
\"presence\" event type;
the IWF performing the terminating participating role:
1) if the IWF does not support receiving a SIP SUBSCRIBE request to the
affiliation status of a user homed in the IWF, the IWF shall generate and send
a SIP 501 (Not Implemented) response to the SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 6665 [26], and shall skip the remainder of this
procedure;
Editor's Note: TS 24.379 needs to be examined to make sure that the reception
of a SIP 501 is properly handled in all cases.
2) shall identify the served MCPTT ID in the \ element of
the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE
request;
3) if the Request-URI of the SIP SUBSCRIBE request contains the public service
identity identifying the IWF performing the terminating participating role
serving the user homed in the IWF, shall identify the originating MCPTT ID in
the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body of the SIP SUBSCRIBE request;
4) if the originating MCPTT ID is not authorized to subscribe to the
affiliation status of the user homed in the IWF, shall send a 403 (Forbidden)
response and shall not continue with the rest of the steps; and
5) shall generate a 200 (OK) response to the SIP SUBSCRIBE request according
to 3GPP TS 24.229 [4], IETF RFC 6665 [26].
For the duration of the subscription, the IWF performing the terminating
participating role shall notify the subscriber about changes of the
information of the served MCPTT ID, as described in subclause 109.2.2.2.5.
##### 109.2.2.2.5 Sending notification of change of affiliation status
procedure
In order to notify the subscriber about changes of the served MCPTT ID, the
IWF:
NOTE: the served MCPTT ID identifies the user homed in the IWF whose
affiliation status has been subscribed.
1) shall consider an MCPTT user information entry such that:
a) the MCPTT user information entry is in the list of MCPTT user information
entries described in subclause 109.2.2.2.2; and
b) the MCPTT ID of the MCPTT user information entry is equal to the served
MCPTT ID;
as the served MCPTT user information entry;
2) shall consider the list of the MCPTT client information entries of the
served MCPTT user information entry as the served list of the MCPTT client
information entries;
3) shall generate an application/pidf+xml MIME body indicating per-user
affiliation information according to 3GPP TS 24.379 subclause 9.3.1 and the
served list of the MCPTT client information entries with the following
clarifications:
a) the IWF shall not include information from an MCPTT group information entry
with the expiration time already expired;
b) the IWF shall not include information from an MCPTT group information entry
with the affiliation status set to the \"deaffiliated\" state; and
c) if the SIP SUBSCRIBE request creating the subscription of this notification
contains an application/simple-filter+xml MIME body indicating per-client
restrictions of presence event package notification information according to
3GPP TS 24.379 subclause 9.3.2, the IWF shall restrict the
application/pidf+xml MIME body according to the application/simple-filter+xml
MIME body; and
4) send a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC
6665 [26] for the subscription created in subclause 109.2.2.2.4. In the SIP
NOTIFY request, the IWF shall include the generated application/pidf+xml MIME
body indicating per-user affiliation information.
##### 109.2.2.2.6 Sending affiliation status change towards MCPTT server
owning MCPTT group procedure
NOTE 1: Usage of one SIP PUBLISH request to carry information about change of
affiliation state of several users homed in the same IWF and/or to several
MCPTT groups owned by the same MCPTT server is not supported in this version
of the specification.
In order:
\- to send an affiliation request of a user homed in the IWF to a handled
MCPTT group ID;
\- to send a de-affiliation request of a user homed in the IWF from a handled
MCPTT group ID; or
\- to send an affiliation request of a user homed in the IWF to a handled
MCPTT group ID due to near expiration of the previously published information;
the IWF shall generate a SIP PUBLISH request according to 3GPP TS 24.229 [4],
IETF RFC 3903 [37] and IETF RFC 3856 [51]. In the SIP PUBLISH request, the
IWF:
1) shall set the Request-URI to the public service identity of the controlling
MCPTT function associated with the handled MCPTT group ID;
2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:
a) shall include the \ element set to the handled MCPTT
group ID; and
b) shall include the \ element set to MCPTT ID
associated with the user homed in the IWF;
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header
field according to IETF RFC 6050 [9];
4) if sending an affiliation request, shall set the Expires header field
according to IETF RFC 3903 [37], to 4294967295;
NOTE 2:4294967295, which is equal to 2^32^-1, is the highest value defined for
Expires header field in IETF RFC 3261 [24].
5) if sending a de-affiliation request, shall set the Expires header field
according to IETF RFC 3903 [37], to zero;
6) shall include a P-Asserted-Identity header field set to the public service
identity of the IWF according to 3GPP TS 24.229 [4];
7) shall set the current p-id to a globally unique value;
8) shall consider an MCPTT user information entry such that:
a) the MCPTT user information entry is in the list of MCPTT user information
entries described in subclause 109.2.2.2.2; and
b) the MCPTT ID of the MCPTT user information entry is equal to the MCPTT ID
associated with the user homed in the IWF;
as the served MCPTT user information entry;
9) for each MCPTT group information entry such that:
a) the MCPTT group information entry has the \"affiliating\" affiliation
status, the MCPTT group ID set to the handled MCPTT group ID, the expiration
time has not expired yet and the affiliating p-id is not set;
b) the MCPTT group information entry is in the list of the MCPTT group
information entries of an MCPTT client information entry; and
c) the MCPTT client information entry is in the list of the MCPTT client
information entries of the served MCPTT user information entry;
shall set the affiliating p-id of the MCPTT group information entry to the
current p-id; and
10) shall include an application/pidf+xml MIME body indicating per-group
affiliation information for a user homed in the IWF constructed according to
3GPP TS 24.379 subclause 9.3.1.2. The IWF shall indicate all MCPTT client IDs
associated with the user homed in the IWF, such that:
a) the affiliation status is set to \"affiliating\" or \"affiliated\", and the
expiration time has not expired yet in an MCPTT group information entry with
the MCPTT group ID set to the handled MCPTT group;
b) the MCPTT group information entry is in the list of the MCPTT group
information entries of an MCPTT client information entry;
c) the MCPTT client information entry has the MCPTT client ID set to the
served MCPTT client ID; and
d) the MCPTT client information entry is in the list of the MCPTT client
information entries of the served MCPTT user information entry.
The IWF shall set the \ child element of the \ root element to
the current p-id.
The IWF shall not include the \"expires\" attribute in the \
element.
The IWF shall send the SIP PUBLISH request according to 3GPP TS 24.229 [4].
If timer F expires for the SIP PUBLISH request sent for a (de)affiliation
request of the user homed in the IWF to the MCPTT group ID or upon receiving a
SIP 3xx, 4xx, 5xx or 6xx response to the SIP PUBLISH request, the IWF:
1) shall remove each MCPTT group ID entry such that:
a) the MCPTT group information entry has the MCPTT group ID set to the handled
MCPTT group ID;
b) the MCPTT group information entry is in the list of the MCPTT group
information entries of an MCPTT client information entry; and
c) the MCPTT client information entry is in the list of the MCPTT client
information entries of the served MCPTT user information entry.
##### 109.2.2.2.7 Affiliation status determination from MCPTT server owning
MCPTT group procedure.
NOTE 1: Usage of one SIP SUBSCRIBE request to subscribe for notification about
change of affiliation state of several users homed in the same IWF is not
supported in this version of the specification.
In order to discover whether a user homed in the IWF was successfully
affiliated to a handled MCPTT group in the MCPTT server owning the handled
MCPTT group, the IWF shall generate an initial SIP SUBSCRIBE request according
to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].
In the SIP SUBSCRIBE request, the IWF:
1) shall set the Request-URI to the public service identity of the controlling
MCPTT function associated with the handled MCPTT group ID;
2) shall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the
application/vnd.3gpp.mcptt-info+xml MIME body, the IWF:
a) shall include the \ element set to the handled MCPTT
group ID; and
b) shall include the \ element set to the MCPTT ID
associated with the user homed in the IWF;
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header
field according to IETF RFC 6050 [9];
4) if the IWF wants to receive the current status and later notification,
shall set the Expires header field according to IETF RFC 6665 [26], to
4294967295;
NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [24].
5) if the IWF wants to fetch the current state only, shall set the Expires
header field according to IETF RFC 6665 [26], to zero;
6) shall include an Accept header field containing the application/pidf+xml
MIME type; and
7) shall include an application/simple-filter+xml MIME body indicating per-
user restrictions of presence event package notification information according
to 3GPP TS 24.379 subclause 9.3.2, indicating the MCPTT ID associated with the
user homed in the IWF.
The IWF shall send the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4].
In order to re-subscribe or de-subscribe, the IWF shall generate an in-dialog
SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and
IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the IWF:
1) if the IWF wants to receive the current status and later notification,
shall set the Expires header field according to IETF RFC 6665 [26], to
4294967295;
NOTE 3: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [24].
2) if the MCPTT server wants to de-subscribe, shall set the Expires header
field according to IETF RFC 6665 [26], to zero; and
3) shall include an Accept header field containing the application/pidf+xml
MIME type.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26], if the SIP NOTIFY request contains an
application/pidf+xml MIME body indicating per-group affiliation information
constructed according to 3GPP TS 24.379 subclause 9.3.1, then the IWF:
1) for each served MCPTT ID and served MCPTT client ID such that the
application/pidf+xml MIME body of SIP NOTIFY request contains:
a) a \ element of the root \ element;
b) the \"id\" attribute of the \ element indicating the MCPTT ID
associated with the user homed in the IWF;
c) an \ child element of the \ element of the \
element;
d) the \"client\" attribute of the \ element indicating the MCPTT
client ID associated with the user homed in the IWF; and
e) the \"expires\" attribute of the \ element indicating
expiration of affiliation;
perform the following:
a) if an MCPTT group information entry exists such that:
i) the MCPTT group information entry has the \"affiliating\" affiliation
status, the MCPTT group ID set to the handled MCPTT group ID, and the
expiration time has not expired yet;
ii) the MCPTT group information entry is in the list of the MCPTT group
information entries of an MCPTT client information entry with the MCPTT client
ID set to the MCPTT client ID associated with the user homed in the IWF;
iii) the MCPTT client information entry is in the list of the MCPTT client
information entries of a served MCPTT user information entry with the MCPTT ID
set to the MCPTT ID associated with the user homed in the IWF; and
iv) the MCPTT user information entry is in the list of MCPTT user information
entries described in subclause 109.2.2.2.2; and
shall set the affiliation status of the MCPTT group information entry to
\"affiliated\"; and
shall set the next publishing time of the MCPTT group information entry to the
current time and half of the time between the current time and the expiration
of affiliation; and
2) for each MCPTT group information entry such that:
a) the MCPTT group information entry has the \"affiliated\" affiliation status
or the \"deaffiliating\" affiliation status, the MCPTT group ID set to the
handled MCPTT group ID, and the expiration time has not expired yet;
b) the MCPTT group information entry is in the list of the MCPTT group
information entries of an MCPTT client information entry with the MCPTT client
ID set to the MCPTT client ID associated with the user homed in the IWF;
c) the MCPTT client information entry is in the list of the MCPTT client
information entries of the served MCPTT user information entry with the MCPTT
ID set to the MCPTT ID associated with the user homed in IWF; and
d) the MCPTT user information entry is in the list of MCPTT user information
entries described in subclause 109.2.2.2.2; and
for which the application/pidf+xml MIME body of SIP NOTIFY request does not
contain
a) a \ element of the root \ element;
b) the \"id\" attribute of the \ element indicating the MCPTT ID
associated with the user homed in the IWF;
c) an \ child element of the \ child element of the
\ element; and
d) the \"client\" attribute of the \ element indicating the MCPTT
client ID associated with the user homed in the IWF\;
perform the following:
a) shall set the affiliation status of the MCPTT group information entry to
\"deaffiliated\"; and
b) shall set the expiration time of the MCPTT group information entry to the
current time; and
3) if a \ element is included in the \ root element of the
application/pidf+xml MIME body of the SIP NOTIFY request, then for each MCPTT
group information entry such that:
a) the MCPTT group information entry has the \"affiliating\" affiliation
status, the MCPTT group ID set to the handled MCPTT group ID, the expiration
time has not expired yet and with the affiliating p-id set to the value of the
\ element;
b) the MCPTT group information entry is in the list of the MCPTT group
information entries of an MCPTT client information entry with the MCPTT client
ID set to the MCPTT client ID associated with the user homed in the IWF;
c) the MCPTT client information entry is in the list of the MCPTT client
information entries of the served MCPTT user information entry with the MCPTT
ID set to the MCPTT ID associated with the user homed in the IWF; and
d) the MCPTT user information entry is in the list of MCPTT user information
entries described in subclause 109.2.2.2.2; and
for which the application/pidf+xml MIME body of SIP NOTIFY request does not
contain:
a) a \ element of the root \ element;
b) the \"id\" attribute of the \ element indicating the MCPTT ID
associated with the user homed in the IWF;
c) an \ child element of the \ child element of the
\ element; and
d) the \"client\" attribute of the \ element indicating the MCPTT
client ID associated with the user homed in the IWF;
perform the following:
a) shall set the affiliation status of the MCPTT group information entry to
\"deaffiliated\"; and
b) shall set the expiration time of the MCPTT group information entry to the
current time.
##### 109.2.2.2.11 Affiliation status determination
This subclause is referenced from other procedures.
If the IWF performing the participating role needs to determine the
affiliation status of a user homed in the IWF to an MCPTT group, the IWF
performing the participating role:
1) shall determine the client and MCPTT client ID associated with the user
homed in the IWF;
2) shall find the user information entry in the list of MCPTT user information
entries described in subclause 109.2.2.2.2 such that the MCPTT ID of the MCPTT
user information entry is equal to the MCPTT ID associated with the user homed
in the IWF;
a) if the applicable MCPTT group information entry cannot be found, then the
IWF performing the participating role shall determine that the user homed in
the IWF is not affiliated to the MCPTT group at the determined client and the
skip the rest of the steps;
3) shall find the MCPTT client information entry in the list of MCPTT client
information entries of MCPTT user information entry found in step 1) in which
the MCPTT client id matches the value of the determined MCPTT client ID;
a) if the applicable MCPTT client information entry cannot be found, then the
IWF performing the participating role shall determine that the user homed in
the IWF is not affiliated to the MCPTT group at the determined client and the
skip the rest of the steps;
4) shall find the MCPTT group information entry in the list of MCPTT group
information entries of MCPTT client information entry found in step 2 such
that the MCPTT group identity matches the value of the identity of the
targeted MCPTT group;
a) if the applicable MCPTT group information entry was found in step 3) and
the affiliation status of the MCPTT group information entry is \"affiliating\"
or \"affiliated\", shall determine that the user homed in the IWF at the
determined client is affiliated to the targeted MCPTT group and skip the rest
of the steps;
b) if the applicable MCPTT group information entry was found in step 3) and
the affiliation status of the MCPTT group information entry is
\"deaffiliating\" or \"deaffiliated\", shall determine that the user homed in
the IWF at the determined client to is not affiliated to the targeted MCPTT
group and skip the rest of the steps; or
c) if the applicable MCPTT group information entry was not found in step 3),
shall determine that the user homed in the IWF at the determined client is not
affiliated to the targeted MCPTT group.
##### 109.2.2.2.12 Affiliation status change by implicit affiliation
This subclause is referenced from other procedures.
Upon determining that a user homed in the IWF is to be implicitly affiliated
to an MCPTT group as per the triggers defined in subclause 109.1, the IWF
performing the participating role:
1) shall determine the served MCPTT client ID as being the MCPTT ID associated
with the user homed in the IWF;
2) shall determine the MCPTT group ID to which the user homed in the IWF is to
be implicitly affiliated;
3) shall determine the served MCPTT ID as being the MCPTT ID associated with
the user homed in the IWF;
4) shall consider an MCPTT user information entry such that:
a) the MCPTT user information entry is in the list of MCPTT user information
entries described in subclause 109.2.2.2.2; and
b) the MCPTT ID of the MCPTT user information entry is equal to the served
MCPTT ID;
as the served MCPTT user information entry;
5) shall consider an MCPTT client information entry such that:
a) the MCPTT client information entry is in the list of MCPTT client
information entries of the served MCPTT user information entry; and
b) the MCPTT client ID of the MCPTT client information entry is equal to the
served MCPTT client ID;
as the served MCPTT client information entry;
6) shall consider a copy of the list of the MCPTT group information entries of
the served MCPTT client information entry as the served list of the MCPTT
group information entries;
7) shall construct the candidate list of the MCPTT group information entries
as follows:
a) for each MCPTT group ID which has an MCPTT group information entry in the
served list of the MCPTT group information entries shall copy the MCPTT group
information entry into a new MCPTT group information entry of the candidate
list of the MCPTT group information entries; and
b) if the determined MCPTT group ID does not have an MCPTT group information
entry in the served list of the MCPTT group information entries or has an
MCPTT group information entry in the served list of the MCPTT group
information entries, such that the expiration time of the MCPTT group
information entry has already expired:
i) shall add a new MCPTT group information entry in the candidate list of the
MCPTT group information list for the determined MCPTT group ID;
ii) shall set the affiliation status of the new MCPTT group information entry
to the \"affiliating\" state; and
iii) shall set the expiration time of the new MCPTT group information entry to
the current time increased with the candidate expiration interval;
8) determine the candidate number of MCPTT group IDs as the number of
different MCPTT group IDs which have an MCPTT group information entry:
a) in the candidate list of the MCPTT group information entries; or
b) in the list of the MCPTT group information entries of an MCPTT client
information entry such that:
i) the MCPTT client information entry is in the list of the MCPTT client
information entries of the served MCPTT user information entry; and
ii) the MCPTT client ID of the MCPTT client information entry is not equal to
the served MCPTT client ID;
with the affiliation status set to the \"affiliating\" state or the
\"affiliated\" state and with the expiration time which has not expired yet;
and
9) if the candidate number of MCPTT group IDs is bigger than the N2 value of
the served MCPTT ID, shall be based on MCPTT service provider policy reduce
the candidate MCPTT group IDs to that equal to N2;
NOTE: The MCPTT service provider policy can determine to remove an MCPTT group
ID based on the importance or priority of other MCPTT groups, received SIP
requests containing an authorised request for originating a priority call as
determined by subclause 106.3.2.1.8.1 or other policy to determine which MCPTT
groups are preferred.
10) if the determined MCPTT group ID cannot be added to the candidate list of
the MCPTT group information entries due to exceeding the N2 limit for the user
homed in the IWF, shall discard the candidate list of the MCPTT group
information entries and skip the remaining steps of the current procedure; and
11) shall replace the list of the MCPTT group information entries stored in
the served MCPTT client information entry with the candidate list of the MCPTT
group information entries.
##### 109.2.2.2.13 Implicit affiliation status change completion
This subclause is referenced from other procedures.
If the IWF performing the participating role has received a SIP 2xx response
from the controlling MCPTT function to a SIP request that had triggered an
affiliation status change by implicit affiliation as per subclause
109.2.2.2.12, the IWF performing the participating role:
1) shall set the affiliation status of the MCPTT group information entry added
to the candidate list of the MCPTT group information entries by the procedures
of subclause 109.2.2.2.12 to \"affiliated\"; and
2) shall perform the procedures specified in subclause 109.2.2.2.5 for the
MCPTT ID associated with the user homed in the IWF.
##### 109.2.2.2.14 Implicit affiliation status change cancellation
This subclause is referenced from other procedures.
If the IWF performing the participating role for a user homed in the IWF
receives a SIP 4xx, 5xx or 6xx response from the controlling MCPTT function to
a SIP request that had triggered an affiliation status change by implicit
affiliation as per subclause 109.2.2.2.12, the IWF performing the
participating role:
1) shall remove the MCPTT group ID entry added by the procedures of subclause
109.2.2.2.12 such that:
a) the MCPTT group information entry has the MCPTT group ID set to the MCPTT
group ID of the MCPTT group targeted by the received SIP request;
b) the MCPTT group information entry is in the list of the MCPTT group
information entries of an MCPTT client information entry containing the MCPTT
client ID associated with the user homed in the IWF; and
c) the MCPTT client information entry is in the list of the MCPTT client
information entries of the MCPTT user information entry containing the MCPTT
ID associated with the user homed in the IWF.
##### 109.2.2.2.15 Automatic affiliation to configured groups procedure
This subclause is referenced from other procedures.
When the IWF determines that automatic affiliation of a user homed in the IWF
to configured groups is needed, the IWF shall perform procedures 109.2.2.2.6
and 109.2.2.2.7 for the user homed in the IWF and the targeted groups.
#### 109.2.2.3 Procedures of MCPTT server owning the MCPTT group
##### 109.2.2.3.1 General
The procedures of the IWF owning the MCPTT group consist of:
\- receiving group affiliation status change procedure;
\- receiving subscription to affiliation status procedure;
\- sending notification of change of affiliation status procedure;
\- affiliation eligibility check procedure;
\- implicit affiliation eligibility check procedure;
\- affiliation status change by implicit affiliation procedure;
\- receiving subscription to group dynamic data procedure and;
\- sending notification of change of group dynamic data procedure.
##### 109.2.2.3.2 Stored information
The IWF maintains information equivalent to that defined in TS 24.379 [81]
subclause 9.2.2.3.2.
NOTE: The virtual data structure referenced in this subclause is for
information only. Implementors may choose other means to track affiliation
status to groups owned by the IWF. References to the elements of this virtual
data structure are made in other subclauses with the understanding that
implementors choosing not to use this virtual data structure will take other
appropriate actions.
##### 109.2.2.3.3 Receiving group affiliation status change procedure
Upon receiving a SIP PUBLISH request such that:
1) Request-URI of the SIP PUBLISH request contains the public service identity
of the IWF owning the served MCPTT group;
2) the SIP PUBLISH request contains an application/vnd.3gpp.mcptt-info+xml
MIME body containing the \ element and the \ element;
3) the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as
specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field
according to IETF RFC 6050 [9];
4) the Event header field of the SIP PUBLISH request contains the \"presence\"
event type; and
5) The SIP PUBLISH request contains an application/pidf+xml MIME body
indicating per-group affiliation information constructed according to 3GPP TS
24.379 [81], subclause 9.3.1.2, with the IWF acting as the controlling MCPTT
function;
then the IWF:
1) shall identify the served MCPTT group ID in the \
element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP
PUBLISH request;
2) shall identify the handled MCPTT ID in the \ element
of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH
request;
3) if the Expires header field of the SIP PUBLISH request is not included or
has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too
Brief) response to the SIP PUBLISH request, where the SIP 423 (Interval Too
Brief) response contains a Min-Expires header field set to 4294967295, and
shall not continue with the rest of the steps;
4) if an MCPTT group for the served MCPTT group ID does not exist in the IWF,
shall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the
SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and
IETF RFC 3856 [51] and skip the rest of the steps;
5) if the handled MCPTT ID is not a member of the MCPTT group identified by
the served MCPTT group ID, shall reject the SIP PUBLISH request with SIP 403
(Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229
[4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;
6) shall respond with SIP 200 (OK) response to the SIP PUBLISH request
according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]. In the SIP 200 (OK)
response, the IWF:
a) shall set the Expires header field according to IETF RFC 3903 [37], to the
selected expiration time;
7) if the \"entity\" attribute of the \ element of the
application/pidf+xml MIME body of the SIP PUBLISH request is different than
the served MCPTT group ID, shall not continue with the rest of the steps;
8) if the handled MCPTT ID is different from the MCPTT ID in the \"id\"
attribute of the \ element of the \ root element of the
application/pidf+xml MIME body of the SIP PUBLISH request, shall not continue
with the rest of the steps;
9) shall consider an MCPTT group information entry such that:
a) the MCPTT group information entry is in the list of MCPTT group information
entries described in subclause 109.2.2.3.2; and
b) the MCPTT group ID of the MCPTT group information entry is equal to the
served MCPTT group ID;
as the served MCPTT group information entry;
10) if the selected expiration time is zero:
a) shall remove the MCPTT user information entry such that:
i) the MCPTT user information entry is in the list of the MCPTT user
information entries of the served MCPTT group information entry; and
ii) the MCPTT user information entry has the MCPTT ID set to the handled MCPTT
ID;
11) if the selected expiration time is not zero:
a) shall consider an MCPTT user information entry such that:
i) the MCPTT user information entry is in the list of the MCPTT user
information entries of the served MCPTT group information entry; and
ii) the MCPTT ID of the MCPTT user information entry is equal to the handled
MCPTT ID;
as the served MCPTT user information entry;
b) if the MCPTT user information entry does not exist:
i) shall insert an MCPTT user information entry with the MCPTT ID set to the
handled MCPTT ID into the list of the MCPTT user information entries of the
served MCPTT group information entry; and
ii) shall consider the inserted MCPTT user information entry as the served
MCPTT user information entry; and
c) shall set the following information in the served MCPTT user information
entry:
i) set the MCPTT client ID list according to the \"client\" attributes of the
\ elements of the \ element of the \ element of
the \ root element of the application/pidf+xml MIME body of the SIP
PUBLISH request; and
ii) set the expiration time according to the selected expiration time;
12) shall identify the handled p-id in the \ child element of the
\ root element of the application/pidf+xml MIME body of the SIP
PUBLISH request; and
13) shall perform the procedures specified in subclause 109.2.2.3.5 for the
served MCPTT group ID.
##### 109.2.2.3.4 Receiving subscription to affiliation status procedure
NOTE: Usage of one SIP SUBSCRIBE request to subscribe for notification about
change of affiliation state of several MCPTT users served by the same IWF is
not supported in this version of the specification.
Upon receiving a SIP SUBSCRIBE request such that:
1) Request-URI of the SIP SUBSCRIBE request contains the public service
identity of the IWF owning the served MCPTT group;
2) the SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body containing the\ element and the \ element;
3) the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as
specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field
according to IETF RFC 6050 [9];
4) the Event header field of the SIP SUBSCRIBE request contains the
\"presence\" event type; and
5) the SIP SUBSCRIBE request contains an application/simple-filter+xml MIME
body indicating per-user restrictions of presence event package notification
information according to 3GPP TS 24.379 [81], subclause 9.3.2 indicating the
same MCPTT ID as in the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;
then the IWF:
1) shall identify the served MCPTT group ID in the \
element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP
SUBSCRIBE request;
2) shall identify the handled MCPTT ID in the \ element
of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE
request;
3) if the Expires header field of the SIP SUBSCRIBE request is not included or
has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too
Brief) response to the SIP SUBSCRIBE request, where the SIP 423 (Interval Too
Brief) response contains a Min-Expires header field set to 4294967295, and
shall not continue with the rest of the steps;
4) if an MCPTT group for the served MCPTT group ID does not exist in the IWF,
shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to
the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]
and IETF RFC 3856 [51] and skip the rest of the steps;
5) if the handled MCPTT ID is not a member of the MCPTT group identified by
the served MCPTT group ID, shall reject the SIP SUBSCRIBE request with SIP 403
(Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229
[4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;
and
6) shall generate and send a SIP 200 (OK) response to the SIP SUBSCRIBE
request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].
For the duration of the subscription, the IWF shall notify subscriber about
changes of the information of the served MCPTT ID, as described in subclause
109.2.2.3.5.
##### 109.2.2.3.5 Sending notification of change of affiliation status
procedure
In order to notify the subscriber identified by the handled MCPTT ID about
changes of the affiliation status of the served MCPTT group ID, the IWF:
1) shall consider an MCPTT group information entry such that:
a) the MCPTT group information entry is in the list of MCPTT group information
entries described in subclause 109.2.2.3.2; and
b) the MCPTT group ID of the MCPTT group information entry is equal to the
served MCPTT group ID;
2) shall consider an MCPTT user information entry such:
a) the MCPTT user information entry is in the list of the MCPTT user
information entries of the served MCPTT group information entry; and
b) the MCPTT ID of the MCPTT user information entry is equal to the handled
MCPTT ID;
as the served MCPTT user information entry;
3) shall generate an application/pidf+xml MIME body indicating per-group
affiliation information according to 3GPP TS 24.379 [81], subclause 9.3.1 and
the served list of the served MCPTT user information entry of the MCPTT group
information entry with following clarifications:
a) the MCPTT server shall include the \"expires\" attribute in the
\ element; and
b) if this procedure is invoked by procedure in subclause 109.2.2.3.3 where
the handled p-id was identified, the IWF shall set the \ child element
of the \ root element of the application/pidf+xml MIME body of the
SIP NOTIFY request to the handled p-id value; and
4) send a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC
6665 [26] for the subscription created in subclause 109.2.2.3.4. In the SIP
NOTIFY request, the IWF shall include the generated application/pidf+xml MIME
body indicating per-group affiliation information.
##### 109.2.2.3.6 Implicit affiliation eligibility check procedure
This subclause is referenced from other procedures.
Upon receiving a SIP request for an MCPTT group that the MCPTT user is not
currently affiliated to and that requires the IWF performing the controlling
role to check on the eligibility of the MCPTT user to be implicitly affiliated
to the MCPTT group, the IWF performing the controlling role:
1) shall perform the procedures of subclause 109.2.2.3.8 to determine if the
MCPTT user is eligible to be affiliated to the MCPTT group; and
2) if the MCPTT user was determined eligible to be affiliated to the MCPTT
group by the procedures of subclause 109.2.2.3.8, shall consider the MCPTT
user to be eligible for implicit affiliation to the MCPTT group.
##### 109.2.2.3.7 Affiliation status change by implicit affiliation procedure
This subclause is referenced from other procedures.
Upon receiving a SIP request for an MCPTT group that the MCPTT user is not
currently affiliated to and that requires the IWF performing the controlling
role to perform an implicit affiliation to, the IWF performing the controlling
role:
1) shall identify the served MCPTT group ID in the \
element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP
request;
2) shall identify the handled MCPTT ID in the \ element
of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP request;
3) shall consider an MCPTT group information entry such that:
a) the MCPTT group information entry is in the list of MCPTT group information
entries described in subclause 109.2.2.3.2 with the IWF acting as the
controlling MCPTT function; and
b) the MCPTT group ID of the MCPTT group information entry is equal to the
served MCPTT group ID;
as the served MCPTT group information entry;
4) shall consider an MCPTT user information entry such that:
a) the MCPTT user information entry is in the list of the MCPTT user
information entries of the served MCPTT group information entry; and
b) the MCPTT ID of the MCPTT user information entry is equal to the handled
MCPTT ID;
as the served MCPTT user information entry;
c) if the MCPTT user information entry does not exist:
i) shall insert an MCPTT user information entry with the MCPTT ID set to the
handled MCPTT ID into the list of the MCPTT user information entries of the
served MCPTT group information entry; and
ii) shall consider the inserted MCPTT user information entry as the served
MCPTT user information entry; and
d) shall make the following modifications in the served MCPTT user information
entry:
i) add the MCPTT client ID derived from the received SIP request to the MCPTT
client ID list if not already present; and
ii) set the expiration time as determined by local policy;
5) shall perform the procedures specified in subclause 109.2.2.3.5 for the
served MCPTT group ID.
##### 109.2.2.3.8 Affiliation eligibility check procedure
This subclause is referenced from other procedures.
Upon receiving a SIP request for an MCPTT group that the MCPTT user is not
currently affiliated to and that requires the IWF performing the controlling
role to check on the eligibility of the MCPTT user to be affiliated to the
MCPTT group, the IWF performing the controlling role:
1) shall identify the served MCPTT group ID in the \
element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP
request;
2) shall identify the handled MCPTT ID in the \ element
of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP request;
3) if an MCPTT group for the served MCPTT group ID does not exist in the IWF,
shall consider the MCPTT user to be ineligible for affiliation and skip the
rest of the steps;
4) if the handled MCPTT ID is not a member of the MCPTT group identified by
the served MCPTT group ID, shall consider the MCPTT user to be ineligible for
affiliation and skip the rest of the steps;
5) if there is no MCPTT group information entry in the list of MCPTT group
information entries described in subclause 109.2.2.3.2, with the IWF acting as
the controlling MCPTT function, with an MCPTT group identity matching the
served MCPTT group ID, then shall consider the MCPTT user to be ineligible for
affiliation and skip the rest of the steps; or
6) shall consider the MCPTT user to be eligible for affiliation.
##### 109.2.2.3.9 Receiving subscription to group dynamic data procedure
Upon receiving a SIP SUBSCRIBE request such that:
1) Request-URI of the SIP SUBSCRIBE request contains the public service
identity of the IWF owning the served MCPTT group;
2) the SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body containing the\ element and the \ element;
3) the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as
specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field
according to IETF RFC 6050 [9];
4) the Event header field of the SIP SUBSCRIBE request contains the
\"presence\" event type; and
5) the SIP SUBSCRIBE request contains an application/simple-filter+xml MIME
body indicating per-group dynamic data of presence event package notification
information according to 3GPP TS 24.379 [81] subclause 9.3.2 indicating the
same MCPTT group ID as in the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;
then the IWF:
1) shall identify the served MCPTT group ID in the \
element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP
SUBSCRIBE request;
2) shall identify the handled MCPTT ID in the \ element
of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE
request;
3) if the Expires header field of the SIP SUBSCRIBE request is not included or
has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too
Brief) response to the SIP SUBSCRIBE request, where the SIP 423 (Interval Too
Brief) response contains a Min-Expires header field set to 4294967295, and
shall not continue with the rest of the steps;
4) if an MCPTT group for the served MCPTT group ID does not exist in the IWF,
shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to
the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]
and IETF RFC 3856 [51] and skip the rest of the steps;
5) if the IWF does not support receiving a SIP SUBSCRIBE request to the group
dynamic data of a group owned by the IWF, the IWF shall generate and send a
SIP 501 (Not Implemented) response to the SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 6665 [26], and skip the rest of the steps;
6) if the handled MCPTT ID is not authorized to subscribe to group dynamic
data of the MCPTT group identified by the served MCPTT group ID, shall reject
the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP
SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF
RFC 3856 [51] and skip the rest of the steps; and
7) shall generate a SIP 200 (OK) response to the SIP SUBSCRIBE request
according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].
For the duration of the subscription, the MCPTT server shall notify subscriber
about changes of the information of the served MCPTT ID, as described in
subclause 109.2.2.3.10.
##### 109.2.2.3.10 Sending notification of change of group dynamic data
procedure
In order to notify the subscriber identified by the handled MCPTT ID about
changes of the per-group dynamic data of the served MCPTT group ID, the IWF:
1) shall consider an MCPTT group information entry such that:
a) the MCPTT group information entry is in the list of MCPTT group information
entries described in subclause 109.2.2.3.2; and
b) the MCPTT group ID of the MCPTT group information entry is equal to the
served MCPTT group ID;
2) shall generate an application/pidf+xml MIME body indicating per-group
dynamic data according to 3GPP TS 24.379 subclause 9.3.1 with the following
clarifications:
a) the IWF shall include the \"expires\" attribute in the \
element; and
3) shall send a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF
RFC 6665 [26] for the subscription created in subclause 109.2.2.3.8. In the
SIP NOTIFY request, the IWF shall include the generated application/pidf+xml
MIME body indicating per-group dynamic data.
# 110 Call signalling - group call
## 110.1 On-network group call
### 110.1.1 Prearranged group call
###### 110.1.1.2.1.1 IWF originating procedures
This subclause is referred to by other subclauses.
To establish an MCPTT prearranged group session, the IWF performing the
participating role shall generate an initial SIP INVITE request by following
the UE originating session procedures specified in 3GPP TS 24.229 [4], with
the clarifications given below.
The IWF performing the participating role:
1) if originating an MCPTT emergency group call or originating an MCPTT
prearranged group call and the MCPTT emergency state is already set, the IWF
performing the participating role shall comply with the procedures in
subclause 106.2.8.1.1;
2) if originating an MCPTT imminent peril group call, the IWF performing the
participating role shall comply with the procedures in subclause 106.2.8.1.9;
3) if originating a broadcast group call, the IWF performing the participating
role shall comply with the procedures in subclause 106.2.8.2;
Editor\'s note: Add subclause 106.2.8.2.
4) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
in the Contact header field of the SIP INVITE request according to IETF RFC
3840 [16];
5) shall include an Accept-Contact header field containing the g.3gpp.mcptt
media feature tag along with the \"require\" and \"explicit\" header field
parameters according to IETF RFC 3841 [6];
6) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
along with the \"require\" and \"explicit\" header field parameters according
to IETF RFC 3841 [6];
7) should include the \"timer\" option tag in the Supported header field;
8) should include the Session-Expires header field according to IETF RFC 4028
[7]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
9) if the emergency group state for this group is set to \"MEG 2: in-
progress\" or \"MEG 4: confirm-pending\", the IWF performing the participating
role shall include the Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.2;
10) if the imminent peril group state for this group is set to \"MIG 2: in-
progress\" or \"MIG 4: confirm-pending\" shall include the Resource-Priority
header field and comply with the procedures in subclause 106.2.8.1.12;
11) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with:
a) the \ element set to a value of \"prearranged\";
b) the \ element set to the group identity;
c) the \ element set to a value determined by the IWF; and
NOTE 1: How the IWF determines the value of the \ element is
out of scope of the present document.
d) if the group identity can be determined to be a TGI and if the IWF
performing the participating role can associate the TGI with a MCPTT group ID,
the \ element set to the MCPTT group ID;
NOTE 2: The MCPTT ID will be inserted into the body of the SIP INVITE request
by the referring subclause.
NOTE 3: The text \"can associate the TGI with a MCPTT group ID\" means that
the IWF performing the participating role is able to determine that there is a
constituent group of the temporary group that it is a member of.
NOTE 4: The IWF performing the participating role is informed about temporary
groups and regouping of MCPTT groups that the users homed in the IWF are
members of as specified in 3GPP TS 24.481 [31].
NOTE 5: If the TGI has several MCPTT groups as constituent groups, where the
user homed in the IWF is a member, the IWF performing the participating role
selects one of those MCPTT groups.
12) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
clarifications given in subclause 106.2.1; and
13) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4; and shall skip the rest of the steps.
On receiving a SIP 2xx response to the SIP INVITE request, the IWF performing
the participating role:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-
requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent peril
group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC
3: imminent-peril-call-granted\", the IWF performing the participating role
shall perform the actions specified in subclause 106.2.8.1.4, with the IWF
acting as the MCPTT client; and
3) may subscribe to the conference event package as specified in subclause
110.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-
requested\" or \"MEGC 3: emergency-call-granted\"; or
2) if the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-
peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
the IWF performing the participating role shall perform the actions specified
in subclause 106.2.8.1.5, with the IWF acting as the MCPTT client.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in subclause
106.2.8.1.13, with the IWF acting as the MCPTT client.
###### 110.1.1.2.1.2 IWF performing the participating role terminating
procedures
This subclause is referenced from other procedures.
In the procedures in this subclause:
1) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.
The IWF performing the participating role:
1) may reject the SIP INVITE request;
2) if the SIP INVITE request is rejected in step 1), shall respond toward the
controlling MCPTT function either with an appropriate reject code as specified
in 3GPP TS 24.229 [4] and warning texts as specified in subclause 104.4.2 or
with a SIP 480 (Temporarily unavailable) response and skip the rest of the
steps of this subclause;
3) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element containing the \ element
with the \ element set to a value of \"true\":
a) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
b) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
peril\"; and
c) shall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-
peril-gc-capable\"; otherwise
4) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element containing the \ element
with the \ element set to a value of \"true\", shall set
the MCPTT imminent peril group state to \"MIG 2: in-progress\";
5) shall perform the automatic commencement procedures specified in subclause
106.2.3.1.1 if one of the following conditions are met:
a) if the SIP INVITE request contains an Answer-Mode header field with the
value \"Auto\" and IWF is configured for automatic commencement mode for
receiving the call;
b) if the SIP INVITE request contains an Answer-Mode header field with the
value \"Auto\" and IWF is configured to allow automatic commencement mode for
receiving the call; or
c) SIP INVITE request contains an Answer-Mode header field with the value
\"Manual\" and IWF is not configured to allow manual commencement mode for
receiving the call;
6) shall perform the manual commencement procedures specified in subclause
106.2.3.2.1 if one of the following conditions are met:
a) if the SIP INVITE request contains an Answer-Mode header field with the
value \"Manual\" and IWF is configured for manual commencement mode for
receiving the call;
b) if the SIP INVITE request contains an Answer-Mode header field with the
value \"Manual\" and IWF is configured to allow manual commencement mode for
receiving the call; or
c) SIP INVITE request contains an Answer-Mode header field with the value
\"Automatic\" and IWF is not configured to allow automatic commencement mode
for receiving the call; and
7) when the SIP 200 (OK) response to the SIP INVITE request is sent, may
subscribe to the conference event package as specified in subclause 110.1.3.1.
Editor\'s note: Add subclause 110.1.3.1.
###### 110.1.1.2.1.3 MCPTT upgrade to in-progress emergency or imminent peril
This subclause is referenced from other procedures.
To upgrade the MCPTT group session to an emergency condition or an imminent
peril condition on an MCPTT prearranged group, the IWF performing the
participating role shall perform the steps below.
1) if the request is to upgrade the MCPTT group session to an MCPTT emergency
call, the IWF performing the participating role:
a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.1.1; and
b) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.2.
2) if the MCPTT user has requested to upgrade the MCPTT group session to an
MCPTT imminent peril call, the IWF performing the participating role:
a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.1.9; and
b) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.12;
3) if the SIP re-INVITE request is to be sent within an on-demand session,
shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS
24.229 [4] with the clarifications specified in subclause 106.2.1;
NOTE: The SIP re-INVITE request can be sent within an on-demand session.
4) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4; and
5) shall exit the procedure in the present subclause.
On receiving a SIP 2xx response to the SIP re-INVITE request the IWF
performing the participating role:
1) shall perform the actions specified in subclause 106.2.8.1.4.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in subclause
106.2.8.1.13.
On receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to the
SIP re-INVITE request the IWF performing the participating role shall perform
the actions specified in subclause 106.2.8.1.5.
###### 110.1.1.2.1.4 MCPTT in-progress emergency cancel
This subclause is referenced from other procedures.
To cancel the in-progress emergency condition on a prearranged MCPTT group,
the IWF performing the participating role shall generate a SIP re-INVITE
request by following the UE originating session procedures specified in 3GPP
TS 24.229 [4], with the clarifications given below.
The IWF performing the participating role:
1) shall, if cancelling an in-progress emergency condition and optionally an
MCPTT emergency alert originated by the user homed in the IWF, include an
application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in
subclause 106.2.8.1.3;
2) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with:
a) the \ element set to a value of \"prearranged\"; and
b) the \ element set to the group identity;
3) shall set the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP re-INVITE request to
the MCPTT ID of the calling user;
4) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP re-INVITE request according to IETF RFC 3840 [16];
5) shall include in the SIP re-INVITE request an SDP offer according to 3GPP
TS 24.229 [4] with the clarifications specified in subclause 106.2.1;
6) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.2; and
7) shall exit the procedure in the present subclause.
On receiving a SIP 2xx response to the SIP re-INVITE request, the IWF
performing the participating role:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
2) shall set the MCPTT emergency group state of the group to \"MEG 1: no-
emergency\";
3) shall set the MCPTT emergency group call state of the group to \"MEGC 1:
emergency-gc-capable\"; and
4) if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-
cancel-pending\", the sent SIP re-INVITE request did not contain an
\ element in the application/vnd.3gpp.mcptt-info+xml MIME body
and the SIP 2xx response to the SIP request for a priority group call does not
contain a Warning header field as specified in subclause 4.4 with the warning
text containing the mcptt-warn-code set to \"149\", shall set the MCPTT
emergency alert state to \"MEA 1: no-alert\".
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in subclause
106.2.8.1.13 with the IWF acting as the MCPTT client.
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
SIP re-INVITE request:
1) shall set the MCPTT emergency group state as \"MEG 2: in-progress\";
2) if the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element set
to a value of \"true\" and the sent SIP re-INVITE request did not contain an
\ element in the application/vnd.3gpp.mcptt-info+xml MIME body,
the IWF performing the participating role shall set the MCPTT emergency alert
state to \"MEA 3: emergency-alert-initiated\"; and
3) if the SIP 4xx response, SIP 5xx response or SIP 6xx response did not
contain an application/vnd.3gpp.mcptt-info+xml MIME body with an \
element and did not contain an \ element, the MCPTT emergency
alert (MEA) state shall revert to its value prior to entering the current
procedure.
NOTE: If the in-progress emergency group state cancel request is rejected, the
state of the session does not change, i.e. continues with MCPTT emergency
group call level priority.
###### 110.1.1.2.1.5 MCPTT in-progress imminent peril cancel
This subclause is referenced from other procedures.
To cancel the in-progress imminent peril condition on a prearranged MCPTT
group, the IWF performing the participating role shall generate a SIP re-
INVITE request by following the procedures specified in 3GPP TS 24.229 [4],
with the clarifications given below.
The IWF performing the participating role:
1) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.1.11, with the IWF acting as the MCPTT client;
2) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.12;
3) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with:
a) the \ element set to a value of \"prearranged\"; and
b) the \ element set to the group identity;
4) shall set the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP re-INVITE request to
the MCPTT ID of the calling user;
5) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP re-INVITE request according to IETF RFC 3840 [16];
6) shall include in the SIP re-INVITE request an SDP offer according to 3GPP
TS 24.229 [4] with the clarifications specified in subclause 106.2.1; and
7) shall exit the procedure in the present subclause.
On receiving a SIP 2xx response to the SIP re-INVITE request, the IWF
performing the participating role:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
2) shall set the MCPTT imminent peril group state of the group to \"MIG 1: no-
imminent-peril\"; and
3) shall set the MCPTT imminent peril group call state of the group to \"MIGC
1: imminent-peril-gc-capable\".
On receiving a SIP 4xx, SIP 5xx response or SIP 6xx response to the SIP re-
INVITE request:
1) if the SIP 4xx response, SIP 5xx response or SIP 6xx response:
a) contains an application/vnd.3gpp.mcptt-info+xml MIME body with an
\ element set to a value of \"true\"; or
b) does not contain an application/vnd.3gpp.mcptt-info+xml MIME body with an
\ element;
then the IWF performing the participating role shall set the MCPTT imminent
peril group state as \"MIG 2: in-progress\".
NOTE: This is the case where the IWF performing the participating role
requested the cancellation of the MCPTT imminent peril in-progress state and
was rejected.
###### 110.1.1.2.1.6 Reception of SIP re-INVITE request
This subclause is referred to by other subclauses.
The IWF:
1) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of \"true\":
a) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
b) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
peril\"; and
c) shall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-
peril-gc-capable\";
2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of
\"true\":
a) shall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";
3) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of \"false\":
a) if the \ element containing the \ element contains
an \ element set to \"false\":
i) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body including an \ element:
A) if the MCPTT ID contained in the \ element is the MCPTT ID
of the receiving user homed in the IWF, shall set the MCPTT emergency alert
state to \"MEA 1: no-alert\";
b) shall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and
c) if the MCPTT emergency group call state of the group is set to \"MEGC 3:
emergency-call-granted\", shall set the MCPTT emergency group call state of
the group to \"MEGC 1: emergency-gc-capable\";
4) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of
\"false\":
a) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
peril\"; and
b) shall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-
peril-gc-capable\";
5) shall accept the SIP re-INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [4];
6) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP 200 (OK) response;
7) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the
SIP 200 (OK) response; and
8) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4] with the
clarifications given in subclause 106.2.2.
#### 110.1.1.3 IWF participating role procedures
##### 110.1.1.3.1 Originating procedures
###### 110.1.1.3.1.1 On demand prearranged group call
Editor\'s Note: Behaviour for cases where the IWF affiliates on behalf of its
LMR users is FFS.
In this subclause, the IWF originates a prearranged group session on behalf of
an LMR user.
NOTE 1: How the IWF determines the MCPTT ID of the calling user is out of
scope of the present document.
The IWF, performing the originating participating function:
1) if the user identified by the MCPTT ID is not affiliated to the group
identified in the \"SIP INVITE request for originating participating MCPTT
function\" as determined by subclause 109.2.2.2.11 and this is an authorised
request for originating a priority call as determined by subclause
106.3.2.1.8.1, shall perform the actions specified in subclause 109.2.2.2.12
for implicit affiliation;
2) shall determine the public service identity of the controlling MCPTT
function associated with the group identity of the group on which the call is
to be originated;
NOTE 2: How the IWF discovers the public service identity of the controlling
MCPTT function associated with the group identity is out of scope of the
present document.
3) shall generate a SIP INVITE request as specified in subclause
110.1.1.2.1.1;
4) shall modify the SIP INVITE request as specified in subclause 106.3.2.1.3;
5) may insert the calling user\'s location information into an
application/vnd.3gpp.mcptt-location-info+xml MIME body to be included in the
outgoing SIP request;
6) shall set the Request-URI to the public service identity of the controlling
MCPTT function associated with the group identity;
7) shall set the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the
MCPTT ID of the calling user;
8) shall update the SDP as specified in subclause 106.3.2.1.1.1; and
9) shall send the SIP INVITE request to the controlling MCPTT function as
specified in 3GPP TS 24.229 [4].
Upon receipt of a SIP 302 (Moved Temporarily) response to the above SIP INVITE
request, the participating IWF function:
1) shall generate a SIP INVITE request as specified in subclause 106.3.2.1.10;
2) shall include an SDP offer based upon the SDP offer in the SIP INVITE
request generated by the IWF in the step above; and
3) shall forward the SIP INVITE request according to 3GPP TS 24.229 [4].
Upon receipt of a SIP 2xx response in response to the above SIP INVITE
request, the IWF performing the participating role:
NOTE 5: If an \ element is received, the IWF ignores that element.
1) if the procedures of subclause 109.2.2.2.12 for implicit affiliation were
performed in the present subclause, shall complete the implicit affiliation by
performing the procedures of subclause 109.2.2.2.13;
2) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [7].
3) shall perform the steps for SIP 2xx as specified in subclause
110.1.1.2.1.1.
Upon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE
request, the participating IWF function:
1) if the implicit affiliation procedures of subclause 109.2.2.2.12 were
invoked in this procedure, shall perform the procedures of subclause
109.2.2.2.14; and
2) shall perform the steps for the received SIP 4xx, 5xx or 6xx as specified
in subclause 110.1.1.2.1.1.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF shall perform the
steps for the received SIP INFO in subclause 110.1.1.2.1.1.
###### 110.1.1.3.1.3 Sending of a SIP re-INVITE request towards MCPTT
controlling function
Upon a need to send a SIP re-INVITE request for an MCPTT session identifying
an on-demand prearranged MCPTT group session, the IWF performing the
participating role:
1) if the request is for an upgrade to an in-progress emergency or an imminent
peril, shall perform the steps in subclause 110.1.1.2.1.3;
2) if the request is for a cancellation of an in-progress emergency, shall
perform the steps in subclause 110.1.1.2.1.4;
3) if the request is for a cancellation of an in-progress imminent peril,
shall perform the steps in subclause 110.1.1.2.1.5;
4) shall include the MCPTT ID of the originating user in \ element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP
re-INVITE request;
NOTE 1: How the IWF determines the MCPTT ID of a user homed in the IWF is out
of scope of the present document.
5) shall include in the SIP re-INVITE request an SDP offer as specified in
subclause 106.3.2.1.1;
6) if the SIP re-INVITE requires a Resource-Priority header field, shall
include a Resource-Priority header field according to 106.2.8.1.15; and
7) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
Upon receipt of a SIP 2xx response to the above SIP re-INVITE request, the IWF
performing the participating role:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
2) if the request in the present subclause above is for an upgrade for
emergency or imminent peril, shall follow the procedures for SIP 200 (OK)
response as specified in subclause 110.1.1.2.1.3;
3) if the request in the present subclause above is for an in-progress
emergency cancel, shall follow the procedures for SIP 200 (OK) response as
specified in subclause 110.1.1.2.1.4; and
4) if the request in the present subclause above is for an in-progress
imminent peril cancel, shall follow the procedures for SIP 200 (OK) response
as specified in subclause 110.1.1.2.1.5.
Upon receipt of a SIP 403 (Forbidden) response to the above SIP re-INVITE
request, the IWF performing the participating role shall interact with the
media plane as specified in 3GPP TS 24.380 [5].
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP re-INVITE request, the IWF performing the participating role:
1) if the request in the present subclause above is for an upgrade for
emergency or imminent peril, shall follow the procedures for SIP 4xx, SIP 5xx
and SIP 6xx responses as specified in subclause 110.1.1.2.1.3;
2) if the request in the present subclause above is for an in-progress
emergency cancel, shall follow the procedures for SIP 4xx, SIP 5xx and SIP 6xx
responses as specified in subclause 110.1.1.2.1.4; or
3) if the request in the present subclause above is for an in-progress
imminent peril cancel, shall follow the procedures for SIP 4xx, SIP 5xx and
SIP 6xx responses as specified in subclause 110.1.1.2.1.5.
Upon receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing session, the IWF performing the
participating role:
1) if the SIP re-INVITE request in the present subclause above is for an
upgrade for emergency or imminent peril, shall follow the procedures for SIP
INFO as specified in subclause 110.1.1.2.1.3;
2) if the SIP re-INVITE request in the present subclause above is for an in-
progress emergency cancel, shall follow the procedures for SIP INFO as
specified in subclause 110.1.1.2.1.4; or
3) if the SIP re-INVITE request in the present subclause above is for an in-
progress imminent peril cancel, shall follow the procedures for SIP INFO as
specified in subclause 110.1.1.2.1.5.
##### 110.1.1.3.2 Terminating Procedures
In the procedures in this subclause:
1) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.
Upon receipt of a \"SIP INVITE request for terminating participating MCPTT
function\", the IWF performing the participating role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the participating role may
include a Retry-After header field to the SIP 500 (Server Internal Error)
response as specified in IETF RFC 3261 [24], and shall not continue with the
rest of the steps;
2) shall check the presence of the isfocus media feature tag in the URI of the
Contact header field and if it is not present then the IWF performing the
participating role shall reject the request with a SIP 403 (Forbidden)
response with the warning text set to \"104 isfocus not assigned\" in a
Warning header field as specified in subclause 4.4, and shall not continue
with the rest of the steps;
3) may reject the request with a SIP 480 (Temporarily Unavailable) response
with the warning text set to \"146 T-PF unable to determine the service
settings for the called user\" in a Warning header field as specified in 3GPP
TS 24.379 [81], subclause 4.4, with the IWF acting as the MCPTT server and
shall not continue with the rest of the steps; and
NOTE: If an \ element is received, the IWF ignores it.
4) shall perform the steps in 3GPP TS 24.379 [81], subclause 10.1.2.1.2.
##### 110.1.1.3.3 IWF participating role ending group call
###### 110.1.1.3.3.1 IWF ending group call on-demand
When the IWF performing the participating role determines it has to send a SIP
BYE request, the IWF shall follow the procedures as specified in subclause
106.3.2.1.6.
##### 110.1.1.3.4 End group call at the IWF performing the participating role
###### 110.1.1.3.4.1 Receipt of SIP BYE request for private call on-demand
Upon receiving a SIP BYE request from the controlling MCPTT function, the IWF
performing the participating role shall follow the procedures as specified in
subclause 106.3.2.2.8.1.
###### 110.1.1.3.5.1 Originating procedures - on demand prearranged group call
To rejoin an on demand prearranged group call, the IWF performing the
participating role shall follow the procedures specified in subclause
110.1.1.3.1.1 with the clarification that the Request-URI of the SIP INVITE
request shall contain a URI of the MCPTT session identity to re-join.
##### 110.1.1.3.6 Reception of a SIP re-INVITE request for terminating a
priority call
In the procedures in this subclause:
1) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.
Upon receipt of a SIP re-INVITE request for an MCPTT group containing an
emergency indication or imminent peril indication, the IWF performing the
participating role:
1) shall perform the steps in subclause 110.1.1.2.1.6;
2) shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and
3) shall send the SIP 200 (OK) response according to 3GPP TS 24.229 [4].
#### 110.1.1.4 IWF Controlling role procedures
##### 110.1.1.4.1 Originating Procedures
###### 110.1.1.4.1.1 INVITE targeted to an MCPTT client
This subclause describes the procedures for inviting an MCPTT user to an MCPTT
session. The procedure is initiated by the IWF performing the controlling role
as the result of a request from the LMR system or an action in subclause
110.1.1.4.2 or as the result of receiving a SIP 403 (Forbidden) response as
described in this subclause.
The IWF performing the controlling role:
1) shall generate a SIP INVITE request as specified in subclause 106.3.3.1.2;
2) shall set the Request-URI to the public service identity of the terminating
participating MCPTT function associated to the MCPTT user to be invited;
NOTE 1: How the IWF performing the controlling role finds the address of the
terminating MCPTT participating function is out of the scope of the current
release.
NOTE 2: If the terminating MCPTT user is part of a partner MCPTT system, then
the public service identity can identify an entry point in the partner network
that is able to identify the terminating participating MCPTT function.
3) shall set the P-Asserted-Identity header field to the public service
identity of the IWF performing the controlling role;
4) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
outgoing SIP INVITE request:
a) the \ element set to the MCPTT ID of the terminating
user; and
b) the \ element set to the group identity;
NOTE 3: The \ is already included in the MIME body as a
result of calling subclause 106.3.3.1.2 in step 1).
5) shall include in the SIP INVITE request an SDP offer based on the SDP offer
in the received SIP INVITE request from the originating network according to
the procedures specified in TS 24.379 [81], subclause 6.3.3.1.1, with the IWF
acting as the controlling MCPTT function;
6) if the in-progress emergency state of the group is set to a value of
\"true\" the IWF performing the controlling role:
a) shall include a Resource-Priority header field populated with the values
for an MCPTT emergency group call as specified in subclause 106.3.3.1.19.
b) if the IWF needs to set the group state to emergency:
i) shall include in the outgoing SIP INVITE request in the
application/vnd.3gpp.mcptt-info+xml MIME body an \ element set
to a value of \"true\"; and
ii) if the IWF needs to set an emergency alert and the MCPTT group is
authorised for the initiation of MCPTT emergency alerts as determined by the
procedures of subclause 106.3.3.1.13.1, shall populate the
application/vnd.3gpp.mcptt-info+xml MIME body and the
application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in
subclause 106.3.3.1.12. Otherwise, shall set the \ element to a
value of \"false\"; and
c) if the in-progress imminent peril state of the group is set to a value of
\"true\" shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an
\ element set to a value of \"false\";
7) if the in-progress emergency state of the group is set to a value of
\"false\" and the in-progress imminent peril state of the group is set to a
value of \"true\", the IWF performing the controlling role:
a) shall include a Resource-Priority header field populated with the values
for an MCPTT imminent peril group call as specified in subclause 106.3.3.1.19;
and
b) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to a value of \"true\"; and
8) shall send the SIP INVITE request towards the terminating network in
accordance with 3GPP TS 24.229 [4].
Upon receiving a SIP 183 (Session Progress) response containing a Require
header field with the option tag \"100rel\" and containing a P-Answer-State
header field with the value \"Unconfirmed\" in response to the SIP INVITE
request the IWF performing the controlling role:
1) shall send a SIP PRACK request towards the MCPTT client according to 3GPP
TS 24.229 [4].
Upon receiving a SIP 200 (OK) response for the SIP INVITE request the IWF
performing the controlling role:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3;
2) shall send a SIP NOTIFY request to all MCPTT participants with a
subscription to the conference event package as specified in subclause
110.1.3.4; and
Editor\'s note: Add subclause 110.1.3.4
3) shall increment the local counter of the number of SIP 200 (OK) responses
received from invited members, by 1.
###### 110.1.1.4.1.2 INVITE targeted to the non-controlling MCPTT function of
an MCPTT group
The IWF performing the controlling role:
1) shall generate a SIP INVITE request as specified in subclause 106.3.3.1.2;
2) shall set the Request-URI to the public service identity of the non-
controlling MCPTT function serving the group identity of the MCPTT group owned
by the partner MCPTT system;
3) shall set the P-Asserted-Identity to the public service identity of the IWF
performing the controlling role;
4) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the
outgoing SIP INVITE request:
a) the \ element set to the group identity of the MCPTT
group hosted by the non-controlling MCPTT function in the partner MCPTT
system; and
b) the \ element set to the group identity of the
group served by the IWF performing the controlling role;
5) shall include the Recv-Info header field set to g.3gpp.mcptt-floor-request;
6) void
7) shall include in the SIP INVITE request an SDP offer; and
8) shall send the SIP INVITE request towards the partner MCPTT system in
accordance with 3GPP TS 24.229 [4].
Upon receiving SIP 403 (Forbidden) response for the SIP INVITE request, if
according to local policy and if:
1) the response contains a Warning header field with the MCPTT warning code
\"128\"; and
2) the response contains a P-Refused-URI-List header field and an
application/resource-lists+xml MIME body as specified in IETF RFC 5318 [36];
NOTE 1: The application/resource-lists+xml MIME body contains MCPTT IDs
identifying MCPTT users in a partner MCPTT system that need to be invited to
the prearranged group call in case of group regrouping using interrogating
method as specified in 3GPP TS 23.379 [3] subclause 10.6.2.4.2.
then the IWF performing the controlling role:
1) shall check if the number of members of the MCPTT group exceeds the maximum
participants allowed by the IWF performing the controlling role. If exceeded,
the IWF performing the controlling role shall invite only enough members from
the application/resource-lists+xml MIME body to reach the maximum allowed by
the IWF performing the controlling role; and
NOTE 2: The IWF determines the maximum number of participants allowed in the
prearranged group session. It is operator policy that determines which
participants in the application/resource-lists+xml MIME body are invited to
the group call.
2) shall invite MCPTT users as specified in this subclause using the list of
MCPTT IDs in URI-List.
Upon receiving a SIP 200 (OK) response for the SIP INVITE request the IWF
performing the controlling role:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3;
NOTE 3: The procedures executed by the IWF performing the controlling role
prior to sending a response to the inviting MCPTT client are specified in
subclause 110.1.1.4.2.
2) if at least one of the invited MCPTT clients has subscribed to the
conference package, shall subscribe to the conference event package in the
non-controlling MCPTT function as specified in subclause 110.1.3.4.3; and
Editor\'s note: Add subclause 110.1.3.4.3.
3) if the 200 (OK) response includes the \ element set to
\"floor-taken\", shall wait for a SIP INFO request containing a floor request
from the non-controlling MCPTT function.
Upon receiving a SIP INFO request containing a floor request where:
1) the Request-URI contains an MCPTT session ID identifying an ongoing
temporary group session; and
2) the application/vnd.3gpp.mcptt-info+xml MIME body contains the \ element with the MCPTT group ID of a MCPTT group invited to
the temporary group session;
then the IWF performing the controlling role:
1) shall send a SIP 200 (OK) response to the SIP INFO request to the non-
controlling MCPTT function as specified in 3GPP TS 24.229 [4]; and
2) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3.
##### 110.1.1.4.2 Terminating Procedures
In this subclause, the IWF is performing the controlling role and is
terminating a call from an MCPTT participating function or an MCPTT non-
controlling function destined for the IWF. For cases where both the call
origination and termination are MCPTT functions, the IWF shall follow 3GPP TS
24.379 [81], subclause 10.1.1.4.2, with the IWF acting as the controlling
MCPTT function.
In the procedures in this subclause:
1) MCPTT ID in an incoming SIP INVITE request refers to the MCPTT ID of the
originating user from the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request;
2) group identity in an incoming SIP INVITE request refers to the group
identity from the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request;
3) indication of required group members in a SIP 183 (Session Progress)
response refers to the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body set to \"true\" in a SIP 183 (Session Progress) sent by the
non-controlling MCPTT function of an MCPTT group;
4) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
5) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.
Upon receipt of a \"SIP INVITE request for controlling MCPTT function of an
MCPTT group\", the IWF performing the controlling role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the controlling role may include
a Retry-After header field to the SIP 500 (Server Internal Error) response as
specified in IETF RFC 3261 [24] and skip the rest of the steps;
NOTE 1: If the SIP INVITE request contains an emergency indication or an
imminent peril indication set to a value of \"true\" and this is an authorised
request for originating an MCPTT emergency group call as determined by
subclause 106.3.3.1.13.2, or for originating an MCPTT imminent peril group
call as determined by subclause 106.3.3.1.13.5, the IWF performing the non-
controlling role can, according to local policy, choose to accept the request.
2) shall determine if the media parameters are acceptable and if not reject
the request with a SIP 488 (Not Acceptable Here) response and skip the rest of
the steps;
3) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if:
a) an Accept-Contact header field does not include the g.3gpp.mcptt media
feature tag; or
b) an Accept-Contact header field does not include the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
4) if received SIP INVITE request includes an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ element included or an
\ element included, shall validate the request as described
in 3GPP TS 24.379 [81], subclause 6.3.3.1.17 with the IWF acting as the
controlling MCPTT function;
5) shall retrieve the necessary group document(s) and carry out initial
processing as specified in 3GPP TS 24.379 [81], subclause 6.3.5.2 with the IWF
acting as the controlling MCPTT function;
6) if the result of the initial processing in 3GPP TS 24.379 [81], subclause
6.3.5.2 was:
a) that authorization of the MCPTT ID at a non-controlling MCPTT function of
an MCPTT group is required, perform the actions in subclause 106.3.3.1.13.7
and do not continue with the rest of the steps in this subclause; and
b) that a SIP 3xx, 4xx, 5xx or 6xx response to the \"SIP INVITE request for
controlling MCPTT function of an MCPTT group\" has been sent, do not continue
with the rest of the steps in this subclause;
7) shall perform the actions as described in 3GPP TS 24.379 [81], subclause
6.3.3.2.2 with the IWF acting as the controlling MCPTT function;
8) shall maintain a local counter of the number of SIP 200 (OK) responses
received from invited members and shall initialise this local counter to zero;
9) shall determine if an MCPTT group call for the group identity is already
ongoing by determining if an MCPTT session identity has already been allocated
for the group call and the MCPTT session is active;
10) if the SIP INVITE request contains an unauthorised request for an MCPTT
emergency group call as determined by subclause 106.3.3.1.13.2:
a) shall reject the SIP INVITE request with a SIP 403 (Forbidden) response as
specified in subclause 106.3.3.1.14; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
11) if the SIP INVITE request contains an unauthorised request for an MCPTT
imminent peril group call as determined by subclause 106.3.3.1.13.5, shall
reject the SIP INVITE request with a SIP 403 (Forbidden) response with the
following clarifications:
a) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 with the \ element containing the \
element with the \ element set to a value of \"false\"; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
12) void
13) if the received SIP INVITE request contains an application/vnd.3gpp.mcptt-
location-info+xml MIME body with a \ element included in the
\ root element, the IWF performing the controlling role can
remember the location information contained in the \ root
element;
14) if the MCPTT group call is not ongoing then:
a) if:
i) the user identified by the MCPTT ID is not affiliated to the group identity
contained in the SIP INVITE request as specified in 3GPP TS 24.379 [81],
subclause 6.3.6, with the IWF acting as the controlling MCPTT function;
ii) the group identity contained in the SIP INVITE request is not a
constituent MCPTT group ID;
iii) the received SIP INVITE request does not contain an emergency indication
or imminent peril indication; or
iv) the received SIP INVITE request is an authorised request for an MCPTT
emergency group call as determined by subclause 106.3.3.1.13.2 or MCPTT
imminent peril group call as determined by steps subclause 106.3.3.1.13.5 and
is determined to not be eligible for implicit affiliation as specified in
subclause 109.2.2.3.6;
then shall return a SIP 403 (Forbidden) response with the warning text set to
\"120 user is not affiliated to this group\" in a Warning header field as
specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server, and skip the rest of the steps below;
b) if the user identified by the MCPTT ID is not authorised to initiate the
prearranged group session, shall send a SIP 403 (Forbidden) response with the
warning text set to: \"119 user is not authorised to initiate the group call\"
in a Warning header field as specified in 3GPP TS 24.379 [81] subclause 4.4,
with the IWF acting as the MCPTT server and skip the rest of the steps below;
NOTE 2: How the IWF determines whether the MCPTT user is authorized to
initiate a prearranged group is out of scope of the present document.
c) if the received SIP INVITE request contains an authorised request for an
MCPTT emergency group call as determined by subclause 106.3.3.1.13.2 or MCPTT
imminent peril group call as determined by subclause 106.3.3.1.13.5 and the
MCPTT user is eligible to be implicitly affiliated with the MCPTT group as
determined as determined in step 13) a) iv) above, shall perform the implicit
affiliation as specified in subclause 109.2.2.3.7;
d) void
e) shall create a prearranged group session and allocate an MCPTT session
identity for the prearranged group call, and shall handle timer TNG3 (group
call timer) as specified in subclause 106.3.3.5;
f) if the group identity in the \"SIP INVITE request for controlling MCPTT
function of an MCPTT group\" is a TGI:
i) shall for each of the constituent MCPTT groups homed in the IWF:
A) invite each member of the IWF homed group to the group session; and
B) interact with the media plane as specified in 3GPP TS 24.380 [5] subclause
6.3; and
ii) shall for each of the constituent MCPTT groups homed on the partner MCPTT
system generate a SIP INVITE request for the MCPTT group identity homed on the
partner MCPTT system as specified in subclause 110.1.1.4.1.2;
g) if the group identity in the \"SIP INVITE request for controlling MCPTT
function of an MCPTT group\" is an MCPTT group ID:
i) shall determine the members to invite to the prearranged MCPTT group call
as specified in subclause 106.3.5.5;
ii) if necessary, shall start timer TNG1 (acknowledged call setup timer)
according to the conditions stated in subclause 106.3.3.3;
iii) if the received SIP INVITE request includes an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element
set to a value of \"true\":
A) shall cache the information that the MCPTT user has initiated an MCPTT
emergency call;
B) if the received SIP INVITE contains an alert indication set to a value of
\"true\" and this is an authorised request for an MCPTT emergency alert
meeting the conditions specified in subclause 106.3.3.1.13.1, shall cache the
information that the MCPTT user has initiated an MCPTT emergency alert; and
C) if the in-progress emergency state of the group is set to a value of
\"false\":
I) shall set the value of the in-progress emergency state of the group to
\"true\"; and
II) shall start timer TNG2 (in-progress emergency group call timer) and handle
its expiry as specified in subclause 106.3.3.1.16;
iv) if the in-progress emergency state of the group is set to a value of
\"false\" and if the received SIP INVITE request contains an imminent peril
indication set to a value of \"true\", the controlling MCPTT function:
A) shall cache the information that the MCPTT user has initiated an MCPTT
imminent peril call; and
B) if the in-progress imminent peril state of the group is set to a value of
\"false\", shall set the in-progress imminent peril state of the group to a
value of \"true\";
v) shall invite each group member determined in step 13)g)i) above, to the
group session, as specified in subclause 110.1.1.4.1.1; and
vi) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3; and
15) if the MCPTT group call is ongoing then:
a) if:
i) the user identified by the MCPTT ID in the SIP INVITE request is not
affiliated to the group identity contained in the SIP INVITE request as
specified in 3GPP TS 24.379 [81] subclause 6.3.6;
ii) the group identity contained in the SIP INVITE request is not a
constituent MCPTT group ID;
iii) the received SIP INVITE request does not contain an emergency indication
or imminent peril indication; or
iv) the received SIP INVITE request is an authorised request for an MCPTT
emergency group call as determined by subclause 106.3.3.1.13.2 or MCPTT
imminent peril group call as determined subclause 106.3.3.1.13.5 and is
determined to not be eligible for implicit affiliation as specified in
subclause 109.2.2.3.6;
then shall return a SIP 403 (Forbidden) response with the warning text set to
\"120 user is not affiliated to this group\" in a Warning header field as
specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server, and skip the rest of the steps below;
b) if the user identified by the MCPTT ID in the SIP INVITE request is not
authorised to join the prearranged group session as specified in subclause
106.3.5.3, shall send a SIP 403 (Forbidden) response with the warning text set
to \"121 user is not allowed to join the group call\" in a Warning header
field as specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF acting
as the MCPTT server and skip the rest of the steps below;
c) void
d) if the maximum number of participants allowed by the IWF performing the
controlling role is already reached:
i) if, according to local policy, the user identified by the MCPTT ID in the
SIP INVITE request is deemed to have a higher priority than an existing user
in the group session, may remove a participant from the session by following
subclause 110.1.1.4.4.3, and skip the next step; and
NOTE 3: The local policy for deciding whether to admit a user to a call that
has reached its maximum amount of participants can include the user\'s
priority and the participant type of the user as well as other information
about the user. The local policy decisions can also include taking into
account whether the imminent-peril indicator or emergency indicator was
received in the SIP INVITE request.
ii) shall return a SIP 486 (Busy Here) response with the warning text set to
\"122 too many participants\" to the originating network as specified in 3GPP
TS 24.379 [81], subclause 4.4, with the IWF acting as the MCPTT server and
skip the rest of the steps;
e) if the received SIP INVITE request contains an authorised request for an
MCPTT emergency group call as determined by subclause 106.3.3.1.13.2 or MCPTT
imminent peril group call as determined by subclause 106.3.3.1.13.5 and the
MCPTT user is eligible to be implicitly affiliated with the MCPTT group as
determined in step 14) a) iv) above, shall perform the implicit affiliation as
specified in subclause 109.2.2.3.7;
f) if the received SIP INVITE request includes an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ element set to a value of
\"true\":
i) shall cache the information that the MCPTT user has initiated an MCPTT
emergency call;
ii) if the received SIP INVITE contains an alert indication set to a value of
\"true\" and this is an authorised request for an MCPTT emergency alert
meeting the conditions specified in subclause 106.3.3.1.13.1, shall cache the
information that the MCPTT user has initiated an MCPTT emergency alert;
iii) if the in-progress emergency state of the group is set to a value of
\"false\":
A) shall set the value of the in-progress emergency state of the group to
\"true\";
B) shall start timer TNG2 (in-progress emergency group call timer) and handle
its expiry as specified in subclause 106.3.3.1.16; and
C) shall generate SIP re-INVITE requests for the MCPTT emergency group call to
the other call participants of the MCPTT group as specified in subclause
106.3.3.1.6;
iv) if the in-progress imminent peril state of the group is set to a value of
\"true\":
A) for each of the other affiliated member of the group generate a SIP MESSAGE
request notification of the MCPTT user\'s imminent peril indication as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.11, with the IWF acting as
the controlling MCPTT function, setting the \ element of
the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and
B) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and
v) upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5];
g) if the in-progress emergency state of the group is set to a value of
\"false\" and if the SIP INVITE request contains an imminent peril indication
set to a value of \"true\", the controlling MCPTT function:
i) shall cache the information that the MCPTT user has initiated an MCPTT
imminent peril call; and
ii) if the in-progress imminent peril state of the group is set to a value of
\"false\":
A) shall set the in-progress imminent peril state of the group to a value of
\"true\";
B) shall generate SIP re-INVITE requests for the MCPTT imminent peril group
call to the other call participants of the MCPTT group as specified in 3GPP TS
24.379 [81], subclause 6.3.3.1.15; and
C) upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the
controlling MCPTT function shall interact with the media plane as specified in
3GPP TS 24.380 [5]; and
iii) if the in-progress imminent peril state of the group is set to a value of
\"true\":
A) for each of the other affiliated member of the group generate a SIP MESSAGE
request notification of the MCPTT user\'s imminent peril indication as
specified in 3GPP TS 24.379 [81] subclause 6.3.3.1.11, with the IWF acting as
the controlling MCPTT function, setting the \ element of
the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and
B) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];
h) shall generate a SIP 200 (OK) response as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.2.3.2;
i) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in the 3GPP TS 24.379 [81]
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
j) shall include in the SIP 200 (OK) response with the warning text set to
\"123 MCPTT session already exists\" as specified in 3GPP TS 24.379 [81]
subclause 4.4, with the IWF acting as the MCPTT server;
k) if the received SIP re-INVITE request contains an alert indication set to a
value of \"true\" and this is an unauthorised request for an MCPTT emergency
alert as specified in subclause 106.3.3.1.13.1, shall include in the SIP 200
(OK) response the warning text set to \"149 SIP INFO request pending\" in a
Warning header field as specified in 3GPP TS 24.379 [81] subclause 4.4, with
the IWF acting as the MCPTT server;
l) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"true\" and if the in-progress emergency state of
the group is set to a value of \"true\", shall include in the SIP 200 (OK)
response the warning text set to \"149 SIP INFO request pending\" in a Warning
header field as specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF
acting as the MCPTT server;
NOTE 4: In this case, the request was for an imminent peril call but a higher
priority MCPTT emergency call was already in progress on the group. Hence, the
imminent peril call request aspect of the request is denied but the request is
granted with emergency level priority.
m) shall interact with media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3;
NOTE 5: Resulting media plane processing is completed before the next step is
performed.
n) shall send the SIP 200 (OK) response towards the inviting MCPTT client or
inviting non-controlling MCPTT function according to 3GPP TS 24.229 [4];
o) shall generate a notification to the MCPTT clients, which have subscribed
to the conference event package that the inviting MCPTT User has joined in the
MCPTT group session, as specified in subclause 106.3.3.4;
NOTE 6: As a group document can potentially have a large content, the IWF
performing the controlling role can notify using content-indirection as
defined in IETF RFC 4483 [32].
p) shall send a SIP NOTIFY request to each MCPTT client according to 3GPP TS
24.229 [4];
q) Upon receiving a SIP ACK to the above SIP 200 (OK) response and the SIP 200
(OK) response contained a Warning header field as specified in 3GPP TS 24.379
[81] subclause 4.4, with the IWF acting as the MCPTT server with the warning
text containing the mcptt-warn-code set to \"149\", shall follow the
procedures in subclause 106.3.3.1.18; and
r) shall not continue with the rest of the subclause.
Upon receiving a SIP 183 (Session Progress) response to the SIP INVITE request
specified in subclause 110.1.1.4.1 containing a P-Answer-State header field
with the value \"Unconfirmed\" as specified in IETF RFC 4964 [34], the timer
TNG1 (acknowledged call setup timer) is not running, the controlling MCPTT
function supports media buffering and the SIP final response is not yet sent
to the inviting MCPTT client:
1) shall generate a SIP 200 (OK) response to SIP INVITE request as specified
in the 3GPP TS 24.379 [81] subclause 6.3.3.2.3.2, with the IWF acting as the
controlling MCPTT function;
2) shall include the warning text set to \"122 too many participants\" as
specified in 3GPP TS 24.379 [81] subclause 4.4 with the IWF acting as the
MCPTT server, in the SIP 200 (OK) response, if the prearranged MCPTT group has
more than the maximum number of members as allowed by the IWF;
3) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in the 3GPP TS 24.379 [81]
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
4) shall include a P-Answer-State header field with the value \"Unconfirmed\";
5) if the SIP INVITE request contains an alert indication set to a value of
\"true\" and this is an unauthorised request for an MCPTT emergency alert as
specified in subclause 106.3.3.1.13.1, shall include in the SIP 200 (OK)
response the warning text set to \"149 SIP INFO request pending\" in a Warning
header field as specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF
acting as the MCPTT server;
6) if the received SIP INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"true\" and if the in-progress emergency state of the group is set to a value
of \"true\", shall include in the SIP 200 (OK) response the warning text set
to \"149 SIP INFO request pending\" in a Warning header field as specified in
3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the MCPTT server;
7) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3;
NOTE 7: Resulting user plane processing is completed before the next step is
performed.
8) shall send the SIP 200 (OK) response towards the inviting MCPTT client
according to 3GPP TS 24.229 [4];
9) shall generate a notification to the MCPTT clients, which have subscribed
to the conference event package that the inviting MCPTT User has joined in the
MCPTT group session, as specified in subclause 106.3.3.4; and
NOTE 8: As a group document can potentially have a large content, the
controlling MCPTT function can notify using content-indirection as defined in
IETF RFC 4483 [32].
10) shall send a SIP NOTIFY request to each MCPTT client according to 3GPP TS
24.229 [4].
Upon receiving a SIP 183 (Session Progress) response for a SIP INVITE request
as specified in subclause 110.1.1.4.1.2 containing an indication of required
group members, the timer TNG1 (acknowledged call setup timer) is running and
all SIP 200 (OK) responses have been received to all SIP INVITE requests sent
to MCPTT clients specified in subclause 110.1.1.4.1.1, then the IWF performing
the controlling role shall wait until the SIP 200 (OK) response has been
received to the SIP INVITE request specified in subclause 110.1.1.4.1.2 before
generating a SIP 200 (OK) response to the \"SIP INVITE request for controlling
MCPTT function of an MCPTT group\".
Upon receiving a SIP 200 (OK) response for a SIP INVITE request as specified
in subclause 110.1.1.4.1 that was sent to an affiliated and required group
member; and
1) if the MCPTT ID in the SIP 200 (OK) response matches to the MCPTT ID in the
corresponding SIP INVITE request;
2) there are no outstanding SIP 200 (OK) responses to SIP INVITE requests
which were sent to affiliated and required group members; and
3) there is no outstanding SIP 200 (OK) response to a SIP INVITE request sent
in subclause 110.1.1.4.1.2 where the SIP 183 (Session Progress) response
contained an indication of required group members;
the IWF performing the controlling role:
1) shall stop timer TNG1 (acknowledged call setup timer) as described in
subclause 106.3.3.3;
2) shall generate SIP 200 (OK) response to the SIP INVITE request as specified
in the 3GPP TS 24.379 [81] subclause 6.3.3.2.3.2, with the IWF acting as the
controlling MCPTT function, before continuing with the rest of the steps;
3) shall include the warning text set to \"122 too many participants\" as
specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server in the SIP 200 (OK) response, if all members were not invited
because the prearranged MCPTT group has been exceeded the maximum number of
members as allowed by the IWF;
4) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in the 3GPP TS 24.379 [81]
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
5) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3;
NOTE 9: Resulting media plane processing is completed before the next step is
performed.
6) shall send a SIP 200 (OK) response to the inviting MCPTT client according
to 3GPP TS 24.229 [4];
7) shall generate a notification to the MCPTT clients, which have subscribed
to the conference event package that the inviting MCPTT user has joined in the
MCPTT group session, as specified in subclause 106.3.3.4; and
NOTE 10: As a group document can potentially have a large content, the IWF
performing the controlling role can notify using content-indirection as
defined in IETF RFC 4483 [32].
8) shall send the SIP NOTIFY request to the MCPTT clients according to 3GPP TS
24.229 [4].
Upon:
1) receiving a SIP 200 (OK) response for a SIP INVITE request as specified in
subclause 110.1.1.4.1;
2) the timer TNG1 (acknowledged call setup timer) is not running;
3) the local counter of the number of SIP 200 (OK) responses received from
invited members is equal to the value of the minimum number of participants
that the IWF requires to start a call;
4) the IWF performing the controlling role supports media buffering; and
5) the SIP final response has not yet been sent to the inviting MCPTT client;
the IWF performing the controlling role according to local policy:
1) shall generate SIP 200 (OK) response to the SIP INVITE request as specified
in the 3GPP TS 24.379 [81] subclause 6.3.3.2.2, with the IWF acting as the
controlling MCPTT function;
2) shall include the warning text set to \"122 too many participants\" as
specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server in the SIP 200 (OK) response, if all members were not invited
because the prearranged MCPTT group has exceeded the number of members as
allowed by the IWF performing the controlling role;
3) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in the 3GPP TS 24.379 [81]
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
4) if the SIP INVITE request contains an alert indication set to a value of
\"true\" and this is an unauthorised request for an MCPTT emergency alert as
specified in subclause 106.3.3.1.13.1, shall include in the SIP 200 (OK)
response the warning text set to \"149 SIP INFO request pending\" in a Warning
header field as specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF
acting as the MCPTT server;
5) if the received SIP INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"true\" and if the in-progress emergency state of the group is set to a value
of \"true\", shall include in the SIP 200 (OK) response the warning text set
to \"149 SIP INFO request pending\" in a Warning header field as specified in
3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the MCPTT server;
6) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3;
NOTE 11: Resulting media plane processing is completed before the next step is
performed.
7) shall send a SIP 200 (OK) response to the inviting MCPTT client according
to 3GPP TS 24.229 [4];
8) shall generate a notification to the MCPTT clients, which have subscribed
to the conference event package that the inviting MCPTT user has joined in the
MCPTT group session, as specified in subclause 106.3.3.4; and
NOTE 12: As a group document can potentially have a large content, the IWF
performing the controlling role can notify using content-indirection as
defined in IETF RFC 4483 [32].
9) shall send the SIP NOTIFY request to the MCPTT clients according to 3GPP TS
24.229 [4].
Upon expiry of timer TNG1 (acknowledged call setup timer), if there are
outstanding SIP 200 (OK) responses to SIP INVITE requests sent to affiliated
and required group members, the IWF performing the controlling role shall
follow the procedures specified in subclause 106.3.3.3 _._
If timer TNG1 (acknowledged call setup timer) is running and a final SIP 4xx,
5xx or 6xx response is received from an affiliated and required group member,
the IWF performing the controlling role shall follow the relevant procedures
specified in subclause 106.3.3.3 _._
If:
1) timer TNG1 (acknowledged call setup timer) is not running;
2) the local counter of the number of SIP 200 (OK) responses received from
invited members is equal to the value of the minimum number of group members
required by the IWF to start a call; and
3) a final SIP 4xx, 5xx or 6xx response is received from an invited MCPTT
client;
then the IWF performing the controlling role shall perform one of the
following based on policy:
1) send the SIP final response towards the inviting MCPTT client, according to
3GPP TS 24.229 [4], if a SIP final response was received from all the other
invited MCPTT clients and the SIP 200 (OK) response is not yet sent; or
2) remove the invited MCPTT client from the MCPTT Session as specified in
subclause 106.3.3.1.5, if a SIP final response other than 2xx or 3xx was
received from all the invited MCPTT clients and the SIP 200 (OK) response is
already sent. The IWF performing the controlling role may invite an additional
member of the prearranged MCPTT group as specified in subclause 110.1.1.4.1
that has not already been invited, if the prearranged MCPTT group has less
than the maximum number of members as allowed by the IWF, and all members have
not yet been invited.
If the group identity in the \"SIP INVITE request for controlling MCPTT
function of an MCPTT group\" is a TGI and constituent MCPTT groups were
invited as specified in subclause 110.1.1.4.1.2 and,
1) if all non-controlling MCPTT functions hosting the constituent MCPTT groups
have responded with a SIP 2xx, SIP 3xx, SIP 4xx, SIP 5xx or SIP 6xx responses
to the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT
group\"; and
2) if all expected SIP INFO requests containing a floor request are received;
then the IWF performing the controlling role shall indicate to the media plane
that all final responses are received.
NOTE 13: If the SIP 200 (OK) response to the SIP INVITE request for non-
controlling MCPTT function of an MCPTT group included the
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to \"floor-taken\", the controlling MCPTT function expects that the non-
controlling MCPTT functions sends a SIP INFO request containing a floor
request.
Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning
text set to \"149 SIP INFO request pending\" in a Warning header field as
specified in 3GPP TS 24.379 [81] subclause 4.4, with the IWF acting as the
MCPTT server, the controlling MCPTT function shall follow the procedures in
subclause 106.3.3.1.18.
##### 110.1.1.4.3 End group call at the IWF performing the terminating
controlling role
Upon receiving a SIP BYE request the IWF performing the controlling role shall
follow the procedures as specified in subclause 106.3.3.2.4.
##### 110.1.1.4.4 End group call initiated by the IWF performing the
controlling role
###### 110.1.1.4.4.1 General
This subclause describes the procedures of each functional entity for ending
the group call initiated by the IWF performing the controlling role.
###### 110.1.1.4.4.2 SIP BYE request for releasing MCPTT session for a group
call
When the MCPTT session for group call needs to be released as specified in
subclause 106.3.8.1, the IWF performing the controlling role, shall follow the
procedures in subclause 106.3.3.1.5.
###### 110.1.1.4.4.3 SIP BYE request toward a MCPTT client
When an MCPTT client needs to be removed from the MCPTT session (e.g. due to
de-affiliation or admitting a higher priority user), the IWF performing the
controlling role shall follow the procedures in subclause 106.3.3.1.5.
After successful removing the MCPTT client from the MCPTT session, the IWF
performing the controlling role may generate a notification to the MCPTT
clients, which have subscribed to the conference event package that an MCPTT
user has been removed from the MCPTT session, as specified in subclause
106.3.3.4 and send the SIP NOTIFY request to the MCPTT client according to
3GPP TS 24.229 [4].
##### 110.1.1.4.5 Re-join procedures
###### 110.1.1.4.5.1 Terminating procedures
Upon receipt of a SIP INVITE request that includes an MCPTT session identity
of an ongoing MCPTT session in the Request-URI the IWF performing the
controlling role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the controlling role may include
a Retry-After header field to the SIP 500 (Server Internal Error) response as
specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the
steps;
NOTE 1: if the SIP INVITE request contains an emergency indication or an
imminent peril indication set to a value of \"true\" and this is an authorised
request for originating an MCPTT emergency group call as determined by
subclause 106.3.3.1.13.2, or for originating an MCPTT imminent peril group
call as determined by subclause 106.3.3.1.13.5, with the IWF performing the
controlling role can according to local policy choose to accept the request.
2) shall reject the SIP request with a SIP 404 (Not Found) response if the
MCPTT group call represented by the MCPTT session identity in Request-URI
header is not present;
3) shall determine if the media parameters are acceptable and the MCPTT speech
codec is offered in the SDP offer and if not, reject the request with a SIP
488 (Not Acceptable Here) response. Otherwise, continue with the rest of the
steps;
4) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if:
a) an Accept-Contact header field does not include the g.3gpp.mcptt media
feature tag; or
b) an Accept-Contact header field does not include the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
5) shall determine the MCPTT ID of the calling user;
6) if the user identified by the MCPTT ID is not authorised to join the
prearranged group session as specified in subclause 106.3.5.3, shall send a
SIP 403 (Forbidden) response with the warning text set to \"121 user is not
authorised to join the group call\" in a Warning header field as specified in
3GPP TS 24.379 [81], subclause 4.4, with the IWF acting as the controlling
MCPTT function. Otherwise continue with the rest of the steps below;
7) shall perform the actions on receipt of an initial SIP INVITE request as
described in 3GPP TS 24.379 [81], subclause 6.3.3.2.2, with the IWF acting as
the controlling MCPTT function;
8) if the user identified by the MCPTT ID is not affiliated to the MCPTT group
ID associated with the MCPTT session identity as specified in 3GPP TS 24.379
[81], subclause 106.3.6, with the IWF acting as the MCPTT server, shall return
a SIP 403 (Forbidden) response with the warning text set to \"120 user is not
affiliated to this group\" in a Warning header field as specified in subclause
4.4;
Editor\'s Note: Add subclause 106.3.6.
9) shall check if a Resource-Priority header field is included in the incoming
SIP INVITE request and may apply any preferential treatment to the SIP request
as specified in 3GPP TS 24.229 [4];
10) if \ as specified in 3GPP TS 24.481 [31]
is already reached:
a) if, according to local policy, the user identified by the MCPTT ID in the
SIP INVITE request is deemed to have a higher priority than an existing user
in the group session, may remove a participant from the session by following
subclause 110.1.1.4.4.3, and skip the next step; and
NOTE 2: The local policy for deciding whether to admit a user to a call that
has reached its maximum amount of participants can include the \ and the \ of the user as well as other information
of the user from the group document as specified in 3GPP TS 24.481 [31]. The
local policy decisions can also include taking into account whether the
imminent-peril indicator or emergency indicator was received in the SIP INVITE
request.
b) shall return a SIP 486 (Busy Here) response with the warning text set to
\"122 too many participants\" to the originating network as specified in 3GPP
TS 24.379 [81], subclause 4.4 with the IWF acting as the controlling MCPTT
function. Otherwise, continue with the rest of the steps;
11) shall generate a SIP 200 (OK) response as specified in 3GPP TS 24.379
[81], subclause 6.3.3.2.3.2, with the IWF acting as the controlling MCPTT
function;
12) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
13) shall interact with media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3;
NOTE 3: Resulting media plane processing is completed before the next step is
performed.
14) shall send the SIP 200 (OK) response towards the inviting MCPTT client
according to 3GPP TS 24.229 [4];
15) shall generate a notification to the MCPTT clients, which have subscribed
to the conference event package that the inviting MCPTT User has joined in the
MCPTT group session, as specified in subclause 106.3.3.4; and
NOTE 4: As a group document can potentially have a large content, the IWF
performing the controlling role can notify using content-indirection as
defined in IETF RFC 4483 [32].
16) shall send a SIP NOTIFY request to each MCPTT client according to 3GPP TS
24.229 [4].
##### 110.1.1.4.6 Late call entry initiated by IWF performing the controlling
role
When the IWF performing the controlling role is notified that an MCPTT client
is newly affiliated or comes back from out of coverage, the IWF performing the
controlling role shall invite the MCPTT client to join an ongoing MCPTT group
call by following the procedures specified in subclause 110.1.1.4.1.
NOTE: How the IWF is informed when an MCPTT client is coming back from out of
coverage is out of scope of present document.
##### 110.1.1.4.7 Receipt of a SIP re-INVITE request
In the procedures in this subclause:
1) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.
Upon receipt of a SIP re-INVITE request for an MCPTT session identity
identifying an on-demand prearranged MCPTT group session, the IWF performing
the controlling role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP re-INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the controlling role may include
a Retry-After header field to the SIP 500 (Server Internal Error) response as
specified in IETF RFC 3261 [24] and skip the rest of the steps;
NOTE 1: If the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"true\", the IWF performing the controlling role can choose to accept the
request.
2) if received SIP re-INVITE request includes an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ element included or an
\ element included, shall validate the request as described
in 3GPP TS 24.379 [81], subclause 6.3.3.1.17, with the IWF acting as the
controlling MCPTT function;
3) if the received SIP re-INVITE request contains an unauthorised request for
an MCPTT emergency call as determined by subclause 106.3.3.1.13.2:
a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response
as specified in subclause 106.3.3.1.14; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
4) if the received SIP re-INVITE request contains an imminent peril indication
set to \"true\" for an MCPTT imminent peril group call and this is an
unauthorised request for an MCPTT imminent peril group call as determined by
subclause 106.3.3.1.13.6, shall reject the SIP re-INVITE request with a SIP
403 (Forbidden) response with the following clarifications:
a) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 with the \ element containing the \
element with the \ element set to a value of \"false\"; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
5) if a Resource-Priority header field is included in the received SIP re-
INVITE request:
a) if the Resource-Priority header field is set to the value indicated for
emergency calls and the SIP re-INVITE request does not contain an emergency
indication and the in-progress emergency state of the group is set to a value
of \"false\", shall reject the SIP re-INVITE request with a SIP 403
(Forbidden) response and skip the rest of the steps; and
b) if the Resource-Priority header field is set to the value indicated for
imminent peril calls and the SIP re-INVITE request does not contain an
imminent peril indication and the in-progress imminent peril state of the
group is set to a value of \"false\", shall reject the SIP INVITE request with
a SIP 403 (Forbidden) response and skip the rest of the steps;
6) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"true\" and is an authorised request to initiate an
MCPTT emergency group call as determined by subclause 106.3.3.1.13.2, the IWF
performing the controlling role:
i) shall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT
emergency call;
ii) if the received SIP INVITE contains an alert indication set to a value of
\"true\" and this is an authorised request for an MCPTT emergency alert
meeting the conditions specified in subclause 106.3.3.1.13.1, shall cache the
MCPTT ID of the MCPTT user that has initiated an MCPTT emergency alert;
iii) if the in-progress emergency state of the group is set to a value of
\"true\":
A) for each of the other affiliated MCPTT members of the group generate a SIP
MESSAGE request notification of the MCPTT user\'s emergency indication as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.11, with the IWF acting as
the controlling MCPTT function, setting the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";
B) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and
C) if the in-progress imminent peril state of the group is set to a value of
\"true\", shall set it to a value of \"false\"; and
iv) if the in-progress emergency state of the group is set to a value of
\"false\":
A) shall set the value of the in-progress emergency state of the group to
\"true\";
B) shall start timer TNG2 (in-progress emergency group call timer) and handle
its expiry as specified in subclause 106.3.3.1.16;
NOTE 2: The interactions of TNG2 with the TNG3 (group call timer) are
explained in subclause 106.3.3.5.2.
C) shall generate SIP re-INVITE requests for the MCPTT emergency group call to
the other MCPTT participants of the MCPTT group call as specified in subclause
106.3.3.1.6;
D) shall send the SIP re-INVITEs towards the other MCPTT participants of the
MCPTT group call; and
E) upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5];
7) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"false\" and is an unauthorised request for an
MCPTT emergency group call cancellation as determined by subclause
106.3.3.1.13.4:
a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response;
b) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 with an \ element set to a value of \"true\";
c) if an \ element of the application/vnd.3gpp.mcptt-info+xml MIME
body is included in the SIP re-INVITE request set to \"false\", and there is
an outstanding MCPTT emergency alert for the MCPTT user, shall include in the
application/vnd.3gpp.mcptt-info+xml MIME body an \ element set to a
value of \"true\"; and
d) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
8) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"false\" and is determined to be an authorised
request for an MCPTT emergency call cancellation as specified in subclause
106.3.3.1.16 and the in-progress emergency state of the group to is set to a
value of \"true\" the IWF performing the controlling role:
a) shall set the in-progress emergency group state of the group to a value of
\"false\";
b) shall clear the cache of the MCPTT ID of the MCPTT user as having an
outstanding MCPTT emergency group call;
c) if an \ element of the application/vnd.3gpp.mcptt-info+xml MIME
body is included and set to \"false\" and is determined to be an authorised
request for an MCPTT emergency alert cancellation as specified in subclause
106.3.3.1.13.3 and there is an outstanding MCPTT emergency alert for the MCPTT
user shall:
i) if the received SIP re-INVITE request contains an \ element
in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the
MCPTT ID of the MCPTT user identified by the \ element as
having an outstanding MCPTT emergency alert; or
ii) if the received SIP re-INVITE request does not contain an \
element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache
of the MCPTT ID of the sender of the SIP re-INVITE request as having an
outstanding MCPTT emergency alert;
d) shall generate SIP re-INVITE requests to the MCPTT participants in the
group call as specified in subclause 106.3.3.1.6. The MCPTT controlling
function:
i) for each of the other MCPTT participants in the group call shall send the
SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229
[4]; and
ii) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the
IWF performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5];
NOTE 3: Subclause 106.3.3.1.6 will inform the group call (MCPTT) participants
of the cancellation of the MCPTT group\'s in-progress emergency state and the
cancellation of the MCPTT emergency alert if applicable.
e) shall stop timer TNG2 (in-progress emergency group call timer); and
NOTE 4: The interactions of TNG2 with the TNG3 (group call timer) are
explained in subclause 106.3.3.5.2;
f) for each of the affiliated MCPTT members of the group that are not
participating in the call:
i) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s emergency call as specified in 3GPP TS 24.379 [81], subclause
6.3.3.1.11, with the IWF acting as the controlling MCPTT function;
ii) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"false\";
iii) if indicated above in step 8) c), set the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\"; and
iv) send the SIP MESSAGE request according to 3GPP TS 24.229 [4];
9) if the received SIP re-INVITE request contains an imminent peril indication
and the in-progress emergency group state of the group is set to a value of
\"false\", shall perform the procedures specified in subclause 110.1.1.4.8 and
skip the rest of the steps.
Upon receiving a SIP 200 (OK) response to a SIP re-INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5];
1) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [4];
2) shall include in the SIP 200 (OK) response an SDP answer according to 3GPP
TS 24.229 [4] with the clarifications specified in 3GPP TS 24.379 [81],
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
3) shall include the \"norefersub\" option tag in a Supported header field
according to IETF RFC 4488 [22];
4) shall include the \"tdialog\" option tag in a Supported header field
according to IETF RFC 4538 [23];
5) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to a value of \"true\" and if this is an unauthorised request for an MCPTT
emergency alert as determined by subclause 106.3.3.1.13.1, shall include in
the SIP 200 (OK) response the warning text set to \"149 SIP INFO request
pending\" in a Warning header field as specified in 3GPP TS 24.379 [81],
subclause 4.4, with the IWF acting as the controlling MCPTT function;
6) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to a value of \"false\" and if this is an unauthorised request for an
MCPTT emergency alert cancellation as determined by subclause 106.3.3.1.13.3,
shall include in the SIP 200 (OK) response the warning text set to \"149 SIP
INFO request pending\" in a Warning header field as specified in 3GPP TS
24.379 [81], subclause 4.4, with the IWF acting as the controlling MCPTT
function;
7) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"true\", this is an authorised request for an MCPTT
imminent peril group call and the in-progress emergency state of the group is
set to a value of \"true\", shall include in the SIP 200 (OK) response the
warning text set to \"149 SIP INFO request pending\" in a Warning header field
as specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF acting as the
controlling MCPTT function;
NOTE 5: In this case, the request was for an imminent peril call but a higher
priority MCPTT emergency call was already in progress on the group. Hence, the
imminent peril call request aspect of the request is denied but the request is
granted with emergency level priority.
8) shall interact with media plane as specified in 3GPP TS 24.380 [5]; and
9) shall send the SIP 200 (OK) response towards the MCPTT client according to
3GPP TS 24.229 [4].
Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning
text set to \"149 SIP INFO request pending\" in a Warning header field as
specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF acting as the
controlling MCPTT function, the IWF performing the controlling role shall
follow the procedures in subclause 106.3.3.1.18.
Upon receipt of a SIP 2xx response for an outgoing SIP MESSAGE request, shall
handle according to 3GPP TS 24.229 [4].
##### 110.1.1.4.8 Handling of a SIP re-INVITE request for imminent peril
session
This procedure is initiated by the IWF performing the controlling role as the
result of an action in subclause 110.1.1.4.7.
In the procedures in this subclause:
1) imminent peril indication in an incoming SIP re-INVITE request refers to
the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body.
When the IWF performing the controlling role receives a SIP re-INVITE request
with an imminent peril indication set to \"true\", the IWF performing the
controlling role:
1) if the in-progress emergency state of the group is set to a value of
\"false\" and if the SIP re-INVITE request contains an imminent peril
indication set to a value of \"true\" or the in-progress imminent peril state
of the group to \"true\", the IWF performing the controlling role shall:
NOTE 1: The calling procedure has already determined that this is not an
unauthorised request for an MCPTT imminent peril call, therefore that check
does not need to be repeated in the current procedure.
a) if the in-progress imminent peril state of the group is set to a value of
\"true\" and the MCPTT user is indicating a new imminent peril indication:
i) for each of the other affiliated MCPTT member of the group generate a SIP
MESSAGE request notification of the MCPTT user\'s imminent peril indication as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.11, with the IWF acting as
the controlling MCPTT function, with the following clarifications;
A) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"true\"; and
B) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];
b) if the in-progress imminent peril state of the group is set to a value of
\"false\";
i) set the value of the in-progress imminent peril state of the group to
\"true\";
ii) generate SIP re-INVITE requests for the MCPTT imminent peril group call to
MCPTT participants in the MCPTT group call as specified in 3GPP TS 24.379
[81], subclause 6.3.3.1.15, with the IWF acting as the controlling MCPTT
function;
iii) send the SIP re-INVITES to all of the other MCPTT participants in the
MCPTT group call;
iv) for each of the affiliated MCPTT members of the group not participating in
the group call, generate a SIP MESSAGE request notification of the MCPTT
user\'s imminent peril indication as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.1.11, with the IWF acting as the controlling MCPTT function,
with the following clarifications;
A) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"true\"; and
B) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and
c) cache the information that the MCPTT user has initiated an MCPTT imminent
peril call;
2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is an unauthorised request for an MCPTT imminent peril group
call cancellation as determined by subclause 106.3.3.1.13.6 shall:
a) reject the SIP re-INVITE request with a SIP 403 (Forbidden) response to the
SIP re-INVITE request; and
b) include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in 3GPP TS 24.379 [81], clause F.1 with the
\ element containing the \ element with the
\ element set to a value of \"false\";
c) send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4];
and
d) skip the rest of the steps;
3) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is determined to be an authorised request for an MCPTT imminent
peril call cancellation as specified in subclause 106.3.3.1.13.6 and the in-
progress imminent peril state of the group to is set to a value of \"true\"
the IWF performing the controlling role shall:
a) set the in-progress imminent peril state of the group to a value of
\"false\";
b) cache the information that the MCPTT user no longer has an outstanding
MCPTT imminent peril group call;
c) generate SIP re-INVITES requests to the other MCPTT participants in the
MCPTT group call as specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.15,
with the IWF acting as the controlling MCPTT function. The MCPTT controlling
function:
i) for each MCPTT participant shall send the SIP re-INVITE request towards the
MCPTT client as specified in 3GPP TS 24.229 [4]; and
ii) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the
IWF performing the controlling role interact with the media plane as specified
in 3GPP TS 24.380 [5]; and
NOTE 2: 3GPP TS 24.379 [81], subclause 6.3.3.1.15, with the IWF acting as the
controlling MCPTT function, will inform the affiliated and joined MCPTT
members of the cancellation of the MCPTT group\'s in-progress emergency state
and the cancellation of the MCPTT emergency alert if applicable.
d) for each of the affiliated MCPTT members of the group not participating in
the call shall:
i) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s imminent peril call as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.1.11, with the IWF acting as the controlling MCPTT function;
ii) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"false\"; and
iii) send the SIP MESSAGE request according to 3GPP TS 24.229 [4];
4) shall include in the SIP 200 (OK) response an SDP answer according to 3GPP
TS 24.229 [4] with the clarifications specified in 3GPP TS 24.379 [81],
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function;
5) shall include the \"norefersub\" option tag in a Supported header field
according to IETF RFC 4488 [22];
6) shall include the \"tdialog\" option tag in a Supported header field
according to IETF RFC 4538 [23];
7) shall interact with media plane as specified in 3GPP TS 24.380 [5]; and
8) shall send the SIP 200 (OK) response towards the MCPTT client according to
3GPP TS 24.229 [4].
Upon receipt of a SIP 2xx response for an outgoing SIP MESSAGE request, shall
handle according to 3GPP TS 24.229 [4].
#### 110.1.1.5 Non-controlling function of an MCPTT group procedures
##### 110.1.1.5.1 Originating procedures
This subclause describes the procedures for inviting an MCPTT user to an MCPTT
session. The procedure is initiated by the IWF performing the non-controlling
role of a group homed in the IWF as the result of an action in subclause
110.1.1.5.2 or subclause 110.1.1.5.5.
The IWF performing the non-controlling role:
1) shall invite the MCPTT clients as specified in subclause 106.3.4.1.2;
2) shall include in each SIP INVITE request an SDP offer based on the SDP
offer in the received SIP INVITE request from the IWF performing the non-
controlling role according to the procedures specified in subclause
106.3.4.1.1 with respect to a group homed in the IWF; and
3) shall send each SIP INVITE request towards the terminating network in
accordance with 3GPP TS 24.229 [4].
For each SIP 183 (Session Progress) response received to each SIP INVITE
request sent to an MCPTT client, the IWF performing the non-controlling role
of a group homed in the IWF:
1) For each SIP 183 (Session Progress) response containing the option tag
\"100rel\", shall send a SIP PRACK request towards the MCPTT client according
to 3GPP TS 24.229 [4]; and
2) shall cache the received response;
For each SIP 200 (OK) response received to each SIP INVITE request sent to an
MCPTT client, the IWF performing the non-controlling role of a group homed in
the IWF:
1) shall send a SIP ACK request towards the MCPTT client according to 3GPP TS
24.229 [4];
2) shall cache the SIP 200 (OK) response;
3) shall start the SIP session timer according to rules and procedures of IETF
RFC 4028 [7]; and
4) if at least one of the participants has subscribed to the conference event
package, shall send a SIP NOTIFY request to all participants with a
subscription to the conference event package as specified in TS 24.379 [81],
subclause 10.1.3.5.2.
On receipt of a SIP 3xx, 4xx, 5xx or 6xx response from an invited MCPTT
client, the IWF performing the non-controlling role of an MCPTT group:
1) shall send an SIP ACK request towards the MCPTT client as specified in 3GPP
TS 24.229 [4];
2) shall remove the cached provisional responses received from the MCPTT
client, if any cached provisional responses exist; and
3) if the procedures are initiated by the receipt of the \"SIP INVITE request
for non-controlling MCPTT function of an MCPTT group\" as specified in
subclause 110.1.1.5.2, shall cache the SIP 3xx, 4xx, 5xx or 6xx response.
##### 110.1.1.5.2 Terminating procedures
###### 110.1.1.5.2.1 General
When receiving the \"SIP INVITE request for non-controlling MCPTT function of
an MCPTT group\" the IWF can be performing the controlling role in an ongoing
prearranged group call or, if a prearranged group call is not ongoing, be
initiated as an IWF performing the non-controlling role and invite both MCPTT
users and participants homed in the IWF. MCPTT users are invited per the
procedures of 3GPP TS 24.379 [81].
NOTE: How participants homed in the IWF are invited is out of the scope of
this document.
If a prearranged group call is not ongoing the IWF performing the non-
controlling role shall perform the actions specified in subclause
110.1.1.5.2.2.
If the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT
group\" is received when a prearranged group call is ongoing, the IWF
performing the controlling role may switch roles from operating as an IWF
performing the controlling role to operate as an IWF performing the non-
controlling role as specified in subclause 110.1.1.5.2.3.
When operating in the non-controlling mode and a SIP BYE request is received
from the controlling MCPTT function, the IWF performing the non-controlling
role shall change from operating in the non-controlling mode to operating in
the controlling mode as specified in subclause 110.1.1.5.2.4.
###### 110.1.1.5.2.2 Initiating a prearranged group call
Upon receipt of a \"SIP INVITE request for non-controlling MCPTT function of
an MCPTT group\" and if a group call for the group homed in the IWF is not
ongoing, the IWF performing the non-controlling role of a group:
NOTE 1: The Contact header field of the SIP INVITE request contains the
\"isfocus\" feature media tag.
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the non-controlling role may
include a Retry-After header field to the SIP 500 (Server Internal Error)
response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest
of the steps;
2) shall determine if the media parameters are acceptable and if not reject
the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue
with the rest of the steps;
3) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if:
a) an Accept-Contact header field does not include the g.3gpp.mcptt media
feature tag; or
b) an Accept-Contact header field does not include the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
4) if the partner system does not have a mutual aid relationship with the
primary MCPTT system identified by the contents of the P-Asserted-Identity,
shall reject the \"SIP INVITE request for non-controlling MCPTT function of an
MCPTT group\" with a SIP 403 (Forbidden) response, with warning text set to
\"128 isfocus already assigned\" in a Warning header field as specified in
3GPP TS 24.379 [81], subclause 4.4, and shall not process the remaining steps;
5) if a trusted mutual aid relationship exists between the partner system and
the primary MCPTT system and the procedure in 3GPP TS 23.379 [3] subclause
10.6.2.4.2 is supported:
NOTE 2: 3GPP TS 23.379 [3] subclause 10.6.2.4.2 provides the ability for the
non-controlling function to send back to the controlling function a list of
affiliated members. The controlling function then issues SIP INVITE messages
to each of those affiliated members itself. Steps (a-f) below implement that
procedure.
a) shall generate a SIP 403 (Forbidden) response as specified in 3GPP TS
24.229 [4];
b) shall determine the group members of the group homed in the IWF identified
by the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body of the SIP INVITE request;
c) if the IWF performing the non-controlling role determined that at least one
member of the group homed in the IWF is affiliated, shall include a P-Refused-
URI-List header field populated with affiliated members of the prearranged
group in accordance with the IETF RFC 5318 [36]:
d) if the IWF performing the non-controlling role determined that no members
of the group homed in the IWF are affiliated, shall include the warning text
set to \"128 isfocus already assigned\" in a Warning header field as specified
in 3GPP TS 24.379 [81], subclause 4.4; and
e) shall send the SIP 403 (Forbidden) response towards the controlling MCPTT
function as specified in 3GPP TS 24.229 [4]; and
f) shall not process the remaining steps;
6) if any members of the group homed in the IWF are MCPTT users, shall
determine the group parameters for the MCPTT group ID contained in the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body of the SIP INVITE request and continue with the rest of the steps;
7) shall cache the content of the SIP INVITE request, if received in the
Contact header field and if the specific feature tags are supported;
8) shall check if a Resource-Priority header field is included in the incoming
SIP INVITE request and may apply any preferential treatment to the SIP request
as specified in 3GPP TS 24.229 [4];
9) shall determine the members of the group homed in the IWF to invite as
specified in subclause 106.3.5.5;
Editor's Note: How affiliation of an MCPTT ID on behalf of multiple LMR users
is handled requires further study.
10) if the IWF performing the non-controlling role determines that there are
members of the group homed in the IWF that are required, shall send a SIP 183
(Session Progress) response to the SIP INVITE request for IWF performing the
non-controlling role of a group homed in the IWF as specified in subclause
106.3.4.2.2.1 and shall populate the response with an
application/vnd.3gpp.mcptt-info+xml MIME body containing the \
element set to \"true\".
11) if the IWF performing the non-controlling role determines that there are
no group members homed in the IWF that are required, may, according to local
policy, send a SIP 183 (Session Progress) response to the \"SIP INVITE request
for non-controlling MCPTT function of an MCPTT group\" as specified in
subclause 106.3.4.2.2.1;
12) shall invite each MCPTT group member determined in step 9) above, to the
group session, as specified in subclause 110.1.1.5.1; and
13) shall interact with the media plane toward MCPTT group members as
specified in 3GPP TS 24.380 [5] subclause 6.3;
Unless a SIP response has been sent to the controlling MCPTT function as
specified in step 10 or 11 above, the IWF performing the non-controlling role
of a group homed in the IWF shall wait for the first SIP provisional response
or first SIP 200 (OK) response from one of the invited MCPTT clients or an
indication that one of the invited participants home in the IWF is affiliated,
before sending a response to the SIP INVITE request for non-controlling MCPTT
function of an MCPTT group.
Upon receiving the first 18x response to a SIP INVITE request sent to an
invited MCPTT client as specified in subclause 110.1.1.5.1, not containing a
P-Answer-State header field or an indication that a participant homed in the
IWF is affiliated, and if a SIP 183 (Session Progress) response has not
already been sent in response to the \"SIP INVITE request for non-controlling
MCPTT function of an MCPTT group\", the IWF performing the non-controlling
role of a group homed in the IWF:
1) shall generate a SIP 183 (Session Progress) response as described in
subclause 106.3.4.2.2.1; and
2) shall forward the SIP 183 (Session Progress) response to the controlling
MCPTT function according to 3GPP TS 24.229 [4].
When;
1) the IWF performing the non-controlling role receives;
a) the first 18x response to a SIP INVITE request sent to an invited MCPTT
client as specified in subclause 110.1.1.5.1, containing a P-Answer-State
header field with the value \"Unconfirmed\" as specified in IETF RFC 4964
[34]; or
b) an indication that a participant homed in the IWF is affiliated;
2) a SIP 183 (Session Progress) response has not already been sent in response
to the SIP INVITE request for non-controlling MCPTT function of an MCPTT
group; and
3) the IWF performing the non-controlling role of a group supports media
buffering;
then the IWF performing the non-controlling role of a group:
1) shall generate SIP 200 (OK) response to the SIP INVITE request as specified
in subclause 106.3.4.2.2.2 before continuing with the rest of the steps;
2) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in subclause 106.3.4.2.1;
3) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.3.5; and
NOTE 3: Resulting media plane processing is completed before the next step is
performed.
4) shall send a SIP 200 (OK) response to the controlling MCPTT function
according to 3GPP TS 24.229 [4].
If the IWF performing the non-controlling role does not determine that any
participants homed in the IWF are required, then upon receiving the first SIP
200 (OK) response to a SIP INVITE request sent to an invited MCPTT client as
specified in subclause 110.1.1.5.1 or an indication that a participant homed
in the IWF is affiliated, the IWF performing the non-controlling role of a
group:
1) shall generate SIP 200 (OK) response to the SIP INVITE request as specified
in subclause 106.3.4.2.2.2 before continuing with the rest of the steps;
2) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in subclause 106.3.4.2.1;
3) shall interact with the media plane toward the MCPTT clients as specified
in 3GPP TS 24.380 [5] subclause 6.3.5; and
NOTE 4: Resulting media plane processing is completed before the next step is
performed.
4) shall send a SIP 200 (OK) response to the controlling MCPTT function
according to 3GPP TS 24.229 [4];
If the IWF performing the non-controlling role determines that one or more
participants homed in the IWF are required, then the IWF performing the non-
controlling role of a group homed in the IWF shall wait until all SIP 200 (OK)
responses to SIP INVITE requests have been received from the required MCPTT
clients and all required participants homed in the IWF are affiliated before
sending a SIP 200 (OK) response back to the controlling MCPTT function, as
specified above.
If all invited MCPTT clients have rejected SIP INVITE requests with a SIP 3xx,
4xx, 5xx or 6xx response and no invited participants homed in the IWF have
affiliated, the non-controlling MCPTT function of an MCPTT group:
1) shall generate a SIP reject response as specified in 3GPP TS 24.229 [4];
2) shall, from the list of reject response codes cached by the IWF performing
the non-controlling role of a group homed in the IWF, select the highest
prioritized cached reject response code as specified in IETF RFC 3261 [24];
and
3) shall send the reject response towards the controlling MCPTT function as
specified in 3GPP TS 24.229 [4].
###### 110.1.1.5.2.3 Joining an ongoing prearranged group call
Upon receipt of a \"SIP INVITE request for non-controlling MCPTT function of
an MCPTT group\" and if a prearranged group call is already ongoing, the IWF
performing the non-controlling role of a group:
NOTE 1: The Contact header field of the SIP INVITE request contains the
\"isfocus\" feature media tag.
1) shall determine if the media parameters are acceptable and if not, reject
the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue
with the rest of the steps;
2) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if:
a) an Accept-Contact header field does not include the g.3gpp.mcptt media
feature tag; or
b) an Accept-Contact header field does not include the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
3) if the partner MCPTT system does not have a mutual aid relationship to
merge an ongoing prearranged call with the primary MCPTT system identified by
the contents of the P-Asserted-Identity, shall reject the \"SIP INVITE request
for non-controlling MCPTT function of an MCPTT group\" with a SIP 403
(Forbidden) response, with warning text set to \"128 isfocus already
assigned\" in a Warning header field as specified in subclause 4.4, and shall
not process the remaining steps;
4) shall cache the content of the SIP INVITE request, if received in the
Contact header field and if the specific feature tags are supported;
5) shall check if a Resource-Priority header field is included in the incoming
SIP INVITE request and may apply any preferential treatment to the SIP request
as specified in 3GPP TS 24.229 [4];
6) shall generate a SIP 200 (OK) response to the SIP INVITE request as
specified in the subclause 106.3.4.2.2.2 before continuing with the rest of
the steps;
7) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in the subclause 106.3.4.2.1;
8) shall instruct the media plane to initialise the switch to non-controlling
mode as specified in 3GPP TS 24.380 [5] subclause 6.5.2.3;
NOTE 2: Resulting media plane processing is completed before the next step is
performed. The media plane indicates the state of the floor and if the state
is \"floor-taken\", information about the current speaker.
9) if the media plane provided information about the current speaker, cache
the information about the current speaker(s);
10) shall send a SIP 200 (OK) response to the controlling MCPTT function
according to 3GPP TS 24.229 [4].
Upon receipt of the SIP ACK request, the non-controlling MCPTT function of an
MCPTT group:
1) if information about a current speaker is cached:
a) shall generate a SIP INFO request as specified in subclause 106.3.4.1.3;
and
b) shall send the SIP INFO request to the controlling MCPTT function as
specified in 3GPP TS 24.229 [4];
2) shall instruct the media plane to finalise the switch to the non-
controlling mode as specified in 3GPP TS 24.380 [5] subclause 6.3.5.3; and
3) if the IWF performing the non-controlling role has at least one MCPTT
clients in the pre-arranged group session that has a subscription to the
conference event package, shall subscribe to the conference event package from
the controlling MCPTT function as specified in 3GPP TS 24.379 [81], subclause
10.1.3.5.3.
###### 110.1.1.5.2.4 Splitting an ongoing prearranged group call
Upon receipt of a SIP BYE request or a final SIP reject response from the
controlling MCPTT function, the IWF performing the non-controlling role of a
group homed in the IWF:
1) if keeping the prearranged group call active is according to the release
policy in subclause 106.3.8.1, shall request the media plane towards the MCPTT
clients to switch to controlling mode as specified in 3GPP TS 24.380 [5]
subclause 6.3.5;
NOTE 1: Resulting media plane processing is completed before the next step is
performed.
2) if a SIP BYE request was received, shall send a SIP 200 (OK) response to
the SIP BYE request; and
3) if keeping the prearranged group call active is according to the release
policy in subclause 106.3.8.1 and if the IWF performing the non-controlling
role has at least one remaining MCPTT client that has subscribed to the
conference package, shall send a NOTIFY request to all MCPTT participants with
a subscription to the conference event package as specified in subclause
110.1.3.5.2.
Editor\'s note: Add subclause 110.1.3.5.2.
NOTE 2: The SIP NOTIFY request will indicate to MCPTT clients that all
participants, with the exception of the users belonging to the constituent
group homed in the IWF hosted by the IWF performing the non-controlling role,
have left the prearranged group call.
###### 110.1.1.5.3.1 Terminating procedures
Upon receipt of a SIP INVITE request that includes an MCPTT session identity
of an ongoing MCPTT session in the Request-URI, the IWF performing the non-
controlling role acts as a controlling MCPTT function towards the MCPTT client
and shall perform the actions in the subclause 110.1.1.4.5.1 with the
following clarifications:
1) the MCPTT session identity in the Contact header field of the SIP 200 (OK)
response shall be the MCPTT session identity generated by the IWF; and
2) the subclause 110.1.3.5.2 shall be used when sending the SIP NOTIFY request
for subscriptions to the conference event package.
###### 110.1.1.5.3.2 Late call entry initiated by IWF performing the non-
controlling role
When IWF performing the non-controlling role is notified that an MCPTT client
is newly affiliated or comes back from out of coverage, the IWF performing the
non-controlling role shall invite the MCPTT client to join an ongoing group
call homed in the IWF by following the procedures specified in subclause
110.1.1.5.1.
NOTE: How the IWF performing the non-controlling role is informed when an
MCPTT client comes back from out of coverage is out of scope of the present
document.
##### 110.1.1.5.4 SIP OPTIONS request authorization procedure
Upon receipt of an SIP OPTIONS request containing a P-Asserted-Identity header
field containing the public service identity of a MCPTT server not authorized
to send the SIP OPTIONS request, the IWF performing the non-controlling role
of an MCPTT group shall send a SIP 403 (Forbidden) response as specified in
3GPP TS 24.229 [4] and exit this subclause.
Upon receipt of an SIP OPTIONS request containing a P-Asserted-Identity header
field containing the public service identity of a MCPTT server authorized to
send the SIP OPTIONS request, the IWF performing the non-controlling role of
an MCPTT group shall perform the actions in this subclause.
NOTE: The action of the IWF performing the non-controlling role of an MCPTT
group on receipt of the SIP OPTIONS request mimics the actions of the IWF
performing the non-controlling role of an MCPTT group on receipt of the SIP
INVITE request.
The IWF performing the non-controlling role shall:
1) if the IWF performing the non-controlling role does not recognize the group
identified by the SIP OPTIONS request, shall send the SIP 404 (Not Found)
response to the SIP OPTIONS request with the warning text set to \"113 group
document does not exist\" in a Warning header field as specified in TS 24.379
[81], subclause 4.4;
2) if the IWF performing the non-controlling role determines that one of the
following conditions are fulfilled:
a) if the constituent group homed in the IWF is a chat group and the rules for
joining a group conference as specified in subclause 106.3.5.3 are fulfilled;
or
b) if the constituent group homed in the IWF is a prearranged group and the
rules for initiating a prearranged group session as specified in 3GPP TS
24.379 [81], subclause 6.3.5.4, with the IWF acting as the non-controlling
MCPTT function;
then the IWF performing the non-controlling role:
a) shall send the SIP 200 (OK) response to the SIP OTIONS response as
specified in 3GPP TS 24.229 [4] and the IETF RFC 3261 [24] populated as
follows:
i) shall include a warning text set to \"147 user is authorized to initiate a
temporary group call\" in a Warning header field as specified in TS 24.379
[81], subclause 4.4;
ii) shall include an application/vnd.3gpp.mcptt-info MIME body with:
A) the \ element set to \"chat\", if the constituent MCPTT group
is a chat group; and
B) the \ element set to \"prearranged\", if the constituent
MCPTT group is a prearranged group; and
iii) shall include the P-Asserted-Identity of the IWF performing the non-
controlling role of a group; and
3) if none of the conditions in step 2 above) are fulfilled, shall send a SIP
403 (Forbidden) response with the warning text set to \"119 user is not
authorised to initiate the group call\" in a Warning header field as specified
in TS 24.379 [81], subclause 4.4.
##### 110.1.1.5.5 Initiating a temporary group session
Upon receiving a \"SIP INVITE request for controlling MCPTT function of an
MCPTT group\" when a prearranged group session is not ongoing, the IWF
performing the non-controlling role shall:
NOTE 1: The difference between a \"SIP INVITE request for controlling MCPTT
function of an MCPTT group\" and a \"SIP INVITE request for non-controlling
MCPTT function of an MCPTT group\" is that the latter SIP INVITE request
contains the isfocus media feature tag in the Contact header field.
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the non-controlling role may
include a Retry-After header field to the SIP 500 (Server Internal Error)
response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest
of the steps;
2) shall determine if the media parameters are acceptable and if not reject
the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue
with the rest of the steps;
3) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if:
a) an Accept-Contact header field does not include the g.3gpp.mcptt media
feature tag; or
b) an Accept-Contact header field does not include the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
4) shall retrieve the group document from the group management server for the
MCPTT group ID contained in the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request and
carry out initial processing as specified in 3GPP TS 24.379 [81], subclause
6.3.5.2, with the IWF acting as the non-controlling MCPTT function, and
continue with the rest of the steps if the checks in 3GPP TS 24.379 [81],
subclause 6.3.5.2 succeed;
NOTE 2: If the checks are not successful, the SIP response to the \"SIP INVITE
request for controlling MCPTT function of an MCPTT group\" is already sent in
3GPP TS 24.379 [81], subclause 6.3.5.2, with the IWF acting as the controlling
MCPTT function.
5) shall cache the content of the SIP INVITE request;
6) shall check if a Resource-Priority header field is included in the incoming
SIP INVITE request and may apply any preferential treatment to the SIP request
as specified in 3GPP TS 24.229 [4];
7) shall authorize the MCPTT user in the \ element in
the application/vnd.3gpp.mcptt-info+xml MIME body of the \"SIP INVITE request
for controlling MCPTT function of an MCPTT group\" as specified in 3GPP TS
24.379 [81], subclause 6.3.5.4, with the IWF acting as the non-controlling
MCPTT function, if the MCPTT user is unauthorized to initiated a pre-arranged
group session the IWF performing the non-controlling role shall send a SIP 403
(Forbidden) response with the warning text set to \"119 user is not authorised
to initiate the group call\" in a Warning header field as specified in 3GPP TS
24.379 [81], subclause 4.4.
8) shall generate a SIP INVITE request to the controlling MCPTT function as
specified in subclause 106.3.4.1.4; and
9) shall send the SIP INVITE request to the controlling MCPTT function as
specified in 3GPP TS 24.229 [4].
Upon receipt of a SIP 2xx response to the SIP INVITE request sent to the
controlling MCPTT function as specified above, the IWF performing the non-
controlling role:
1) shall send the SIP ACK request to the controlling MCPTT function as
specified in 3GPP TS 24.229 [4];
2) shall generate a SIP 200 (OK) to the \"SIP INVITE request for controlling
MCPTT function of an MCPTT group\" as specified in 3GPP TS 24.229 [4]
populated as follows:
a) shall include an SDP answer as specified in subclause 106.3.4.2.1 based on
the SDP answer in the SIP 200 (OK) response;
b) shall include the public service identifier of the IWF performing the non-
controlling role in the P-Asserted-Identity header field;
c) shall include the warning text set to \"148 MCPTT group is regrouped\" in a
Warning header field as specified in 3GPP TS 24.379 [81], subclause 4.4; and
d) shall send the SIP 200 (OK) request according to 3GPP TS 24.229 [4];
NOTE 3: As long as the MCPTT group is regrouped the floor control messages in
the media plane include a grouped regrouped indication as specified in 3GPP TS
24.380 [5].
3) shall start acting as a non-controlling MCPTT function and interact with
the media plane as specified in 3GPP TS 24.380 [5] subclause 6.5;
4) shall determine the members to invite to the prearranged group call as
specified in subclause 106.3.5.5 and per the policies of the LMR system; and
5) shall invite each MCPTT group member determined in step 4) immediately
above, to the group session, as specified in subclause 110.1.1.5.1.
Upon receipt of other final SIP responses with the exception of the SIP 2xx
response to the INVITE request sent to the controlling MCPTT function as
specified above, the IWF performing the non-controlling role:
1) shall send the SIP ACK response to the controlling MCPTT function as
specified in 3GPP TS 24.229 [4]; and
2) shall start acting as a controlling MCPTT function as specified in
subclause 110.1.1.4 and invite members as specified in subclause 106.3.4.1.2.
NOTE 4: Regardless if the controlling MCPTT function accepts or rejects the
SIP INVITE request sent above the prearranged group session continues to be
initiated with only the members of the group homed in the non-controlling
MCPTT function of the group being invited to the group call.
The IWF performing the non-controlling role shall handle SIP responses (other
than the SIP 2xx response) to the SIP INVITE requests sent to invited members
as specified in 3GPP TS 24.229 [4].
Upon receipt of a SIP 2xx response to SIP INVITE requests sent to invited
members or upon determining that at least one participant homed in the IWF is
affiliated, the IWF performing the non-controlling role:
1) shall send the SIP ACK request as specified in 3GPP TS 24.229 [4]; and
2) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
###### 110.1.2.2.1.1 Procedure for initiating an MCPTT chat group session and
procedure for joining an MCPTT chat group session
This subclause is referenced from other procedures.
To initiate or join an MCPTT group session using an MCPTT group identity,
identifying an MCPTT chat group, the IWF performing the participating role
shall generate an initial SIP INVITE request by following the UE originating
session procedures specified in 3GPP TS 24.229 [4], with the clarifications
given below.
The IWF performing the participating role:
1) if the IWF is originating an MCPTT emergency group call shall comply with
the procedures in subclause 106.2.8.1.1;
2) if the IWF is originating an MCPTT imminent peril group call, shall comply
with the procedures in subclause 106.2.8.1.9;
3) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
in the Contact header field of the SIP INVITE request according to IETF RFC
3840 [16];
4) shall include an Accept-Contact header field containing the g.3gpp.mcptt
media feature tag along with the \"require\" and \"explicit\" header field
parameters according to IETF RFC 3841 [6];
5) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
field according to IETF RFC 6050 [9] in the SIP INVITE request;
6) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
along with the \"require\" and \"explicit\" header field parameters according
to IETF RFC 3841 [6];
7) if the emergency group state for this group is set to \"MEG 2: in-
progress\" or \"MEG 4: confirm-pending\", shall comply with the procedures in
subclause 106.2.8.1.2;
8) if the imminent peril group state for this group is set to \"MIG 2: in-
progress\" or \"MIG 4: confirm-pending\", shall include the Resource-Priority
header field and comply with the procedures in subclause 106.2.8.1.12;
9) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with:
a) the \ element set to a value of \"chat\";
b) the \ element set to the group identity; and
c) the \ element set to a value determined by the IWF;
NOTE 1: How the IWF determines the value of the \ element is
out of scope of the present document.
NOTE 2: The \ will be inserted into the body of the SIP
INVITE request by the referring subclause.
10) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
clarifications specified in subclause 106.2.1;
11) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4; and
12) shall not perform the remainder of this procedure.
On receiving a SIP 2xx response to the SIP INVITE request, the IWF performing
the participating role:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
2) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-
requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent peril
group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC
3: imminent-peril-call-granted\", shall perform the actions specified in
subclause 106.2.8.1.4, with the IWF acting as the MCPTT client on behalf of
the IWF user homed in the IWF; and
3) may subscribe to the conference event package as specified in subclause
110.1.3.1.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request, the IWF performing the participating role:
1) if the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-
requested\" or \"MEGC 3: emergency-call-granted\"; or
2) if the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-
peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";
shall perform the actions specified in subclause 106.2.8.1.5, with the IWF
acting as the MCPTT client on behalf of the user homed in the IWF.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in subclause
106.2.8.1.13, with the IWF acting as the MCPTT client on behalf of the user
homed in the IWF.
###### 110.1.2.2.1.2 IWF performing the terminating participating role
receives SIP re-INVITE request for an MCPTT chat group
This subclause is referenced from other procedures.
Upon receipt of a SIP re-INVITE request the IWF performing the participating
role:
1) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of \"true\":
a) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
b) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
peril\"; and
c) shall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-
peril-gc-capable\";
2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of
\"true\", shall set the MCPTT imminent peril group state to \"MIG 2: in-
progress\";
3) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of \"false\":
a) if the \ element containing the \ element contains
an \ element set to \"false\":
i) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body including an \ element:
A) if the MCPTT ID contained in the \ element is the MCPTT ID
associated with the targeted user, shall set the MCPTT emergency alert state
to \"MEA 1: no-alert\";
b) shall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and
c) if the MCPTT emergency group call state of the group is set to \"MEGC 3:
emergency-call-granted\", shall set the MCPTT emergency group call state of
the group to \"MEGC 1: emergency-gc-capable\";
4) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of
\"false\":
a) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
peril\"; and
b) shall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-
peril-gc-capable\";
5) shall accept the SIP re-INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [4];
6) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP 200 (OK) response;
7) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the
SIP 200 (OK) response;
8) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4] with the
clarifications given in subclause 106.2.2; and
9) shall send the SIP 200 (OK) response towards the controlling MCPTT server
according to rules and procedures of 3GPP TS 24.229 [4].
###### 110.1.2.2.1.3 MCPTT in-progress emergency cancel
This subclause is referenced from other procedures.
To cancel an in-progress emergency state on an MCPTT chat group, the IWF
performing the participating role shall generate a SIP re-INVITE request as
specified in 3GPP TS 24.229 [4], with the clarifications given below.
The IWF performing the participating role:
1) shall, if cancelling an in-progress emergency state and optionally an MCPTT
emergency alert originated by the user homed in the IWF, include an
application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in
subclause 106.2.8.1.3;
2) shall, if cancelling an in-progress emergency state and optionally an MCPTT
emergency alert originated by another MCPTT user, include an
application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in
subclause 106.2.8.1.14;
3) shall include in the SIP re-INVITE request an SDP offer according to 3GPP
TS 24.229 [4] with the clarifications specified in subclause 106.2.1;
4) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.2; and
5) shall exit the procedure in the present subclause.
On receiving a SIP 2xx response to the SIP re-INVITE request, the IWF
performing the participating role:
1) shall set the MCPTT emergency group state of the group to \"MEG 1: no-
emergency\";
2) shall set the MCPTT emergency group call state of the group to \"MEGC 1:
emergency-gc-capable\"; and
3) if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-
cancel-pending\", the sent SIP re-INVITE request did not contain an
\ element in the application/vnd.3gpp.mcptt-info+xml MIME body
and the SIP 2xx response to the SIP request for a priority group call does not
contain a Warning header field as specified in TS 24.379 [81], subclause 4.4,
with the IWF acting as the MCPTT server with the warning text containing the
mcptt-warn-code set to \"149\", shall set the MCPTT emergency alert state to
\"MEA 1: no-alert\".
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
SIP re-INVITE request:
1) shall set the MCPTT emergency group state as \"MEG 2: in-progress\";
2) if the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element set
to a value of \"true\" and the sent SIP re-INVITE request did not contain an
\ element in the application/vnd.3gpp.mcptt-info+xml MIME body,
the IWF performing the participating role shall set the MCPTT emergency alert
state to \"MEA 3: emergency-alert-initiated\"; and
3) if the SIP 4xx response, SIP 5xx response or SIP 6xx response did not
contain an application/vnd.3gpp.mcptt-info+xml MIME body with an \
element and did not contain an \ element, the MCPTT emergency
alert (MEA) state shall revert to its value prior to entering the current
procedure.
NOTE: If the in-progress emergency group state cancel request is rejected, the
state of the session does not change, i.e. continues with MCPTT emergency
group call level priority.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in subclause
106.2.8.1.13.
###### 110.1.2.2.1.4 MCPTT upgrade to in-progress emergency or imminent peril
This subclause is referenced from other procedures.
To upgrade the MCPTT group session to an emergency condition or an imminent
peril condition on a MCPTT chat group, the IWF performing the participating
role shall generate a SIP re-INVITE request as specified in 3GPP TS 24.229
[4], with the clarifications given below.
1) if upgrading the MCPTT group session to an MCPTT emergency call, the IWF
performing the participating role:
a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.1.1; and
b) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.2
2) if upgrading the MCPTT group session to an MCPTT imminent peril call, the
IWF performing the participating role:
a) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.1.9; and
b) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.12;
3) if the SIP re-INVITE request is to be sent within an on-demand session, the
IWF performing the participating role shall include in the SIP re-INVITE
request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications
specified in subclause 106.2.1;
4) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4; and
5) shall skip the rest of the steps.
On receiving a SIP 2xx response to the SIP re-INVITE request the the IWF
performing the participating role:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5]; and
2) shall perform the actions specified in subclause 106.2.8.1.4, with the IWF
acting as the MCPTT client.
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
SIP re-INVITE request the IWF performing the participating role shall perform
the actions specified in subclause 106.2.8.1.5, with the IWF acting as the
MCPTT client.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in subclause
106.2.8.1.13.
###### 110.1.2.2.1.5 MCPTT in-progress imminent peril cancel
This subclause is referenced from other procedures.
To cancel the in-progress imminent peril state on a MCPTT chat group, the IWF
performing the participating role shall generate a SIP re-INVITE request by
following the procedures specified in 3GPP TS 24.229 [4], with the
clarifications given below.
The IWF performing the participating role:
1) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.1.11;
2) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.1.12;
3) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with:
a) the \ element set to a value of \"chat\"; and
b) the \ element set to the group identity;
4) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP re-INVITE request according to IETF RFC 3840 [16];
5) if the SIP re-INVITE request is to be sent within an on-demand session,
shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS
24.229 [4] with the clarifications specified in subclause 106.2.1; and
6) shall exit the procedure in the present subclause.
On receiving a SIP 2xx response to the SIP re-INVITE request, the IWF
performing the participating role:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
2) shall set the MCPTT imminent peril group state of the group to \"MIG 1: no-
imminent-peril\"; and
3) shall set the MCPTT imminent peril group call state of the group to \"MIGC
1: imminent-peril-gc-capable\".
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
SIP re-INVITE request:
1) if the SIP 4xx response, SIP 5xx response or SIP 6xx response:
a) contains an application/vnd.3gpp.mcptt-info+xml MIME body with an
\ element set to a value of \"true\"; or
b) does not contain an application/vnd.3gpp.mcptt-info+xml MIME body with an
\ element;
then the IWF performing the participating role shall set the MCPTT imminent
peril group state as \"MIG 2: in-progress\".
NOTE: This is the case where the IWF performing the participating role
requested the cancellation of the MCPTT imminent peril in-progress state and
was rejected.
###### 110.1.2.2.1.6 IWF performing the terminating participating role
receives a SIP INVITE request for an MCPTT chat group call
This subclause is referenced from other procedures.
This procedure is used for MCPTT emergency and MCPTT imminent peril calls when
the targeted client is affiliated but not joined to the chat group.
In the procedures in this subclause:
1) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.
Upon receipt of an initial SIP INVITE request, the IWF performing the
participating role:
1) may reject the SIP INVITE request for any reason outside the scope of this
specification;
2) if the SIP INVITE request is rejected in step 1), shall respond toward
controlling MCPTT function either with appropriate reject code as specified in
3GPP TS 24.229 [4] and warning texts as specified in subclause 104.4.2 or with
SIP 480 (Temporarily unavailable) and skip the rest of the steps of this
subclause;
3) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element containing the \ element
with the \ element set to a value of \"true\":
a) shall set the MCPTT emergency group state to \"MEG 2: in-progress\";
b) shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-
peril\"; and
c) shall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-
peril-gc-capable\"; otherwise
4) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element containing the \ element
with the \ element set to a value of \"true\", shall set
the MCPTT imminent peril group state to \"MIG 2: in-progress\";
5) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [4];
6) shall include the option tag \"timer\" in a Require header field of the SIP
200 (OK) response;
7) shall include the g.3gpp.mcptt media feature tag in the Contact header
field of the SIP 200 (OK) response;
8) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the
SIP 200 (OK) response;
9) shall include the Session-Expires header field in the SIP 200 (OK) response
and start the SIP session timer according to IETF RFC 4028 [7]. If no
\"refresher\" parameter was included in the received SIP INVITE request the
\"refresher\" parameter in the Session-Expires header field shall be set to
\"uas\", otherwise shall include a \"refresher\" parameter set to the value
received in the Session-Expires header field the received SIP INVITE request;
10) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP INVITE request according to 3GPP TS 24.229 [4] with the
clarifications given in subclause 106.2.2;
11) shall send the SIP 200 (OK) response towards the controlling MCPTT server
according to rules and procedures of 3GPP TS 24.229 [4]; and
12) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
###### 110.1.2.3.1.1 MCPTT chat session establishment
Editor\'s Note: Behaviour for cases where the IWF affiliates on behalf of
users homed in the IWF is FFS.
In this subclause, the IWF originates a chat group session on behalf of a user
homed in the IWF.
NOTE 1: How the IWF determines the public user identity and the MCPTT ID of
the calling user is out of scope of the present document.
The IWF, performing the originating participating role:
1) shall determine the public service identity of the controlling MCPTT
function associated with the group identity of the group on which the call is
to be originated;
NOTE 2: How the IWF discovers the public service identity of the controlling
MCPTT function associated with the group identity is out of scope of the
current document.
2) if the calling user identified by the MCPTT ID is not affiliated to the
group on which the call is to be originated, as determined by subclause
109.2.2.2.11, shall perform the actions specified in subclause 109.2.2.2.12
for implicit affiliation;
Editor's note: whether step 2 is needed here is ffs.
3) shall generate a SIP INVITE request as specified in subclause
110.1.2.2.1.1;
4) if step 3 was performed successfully, shall complete the SIP INVITE request
as specified in subclause 106.3.2.1.3;
5) if steps 3 and 4 were performed successfully:
a) shall set the Request-URI to the public service identity of the controlling
MCPTT function;
b) shall set the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body to the MCPTT ID of the calling
user;
c) may insert the calling user\'s location information into an
application/vnd.3gpp.mcptt-location-info+xml MIME body;
d) shall send the SIP INVITE request to the controlling MCPTT function as
specified in 3GPP TS 24.229 [4].
Upon receipt of a SIP 302 (Moved Temporarily) response to the above SIP INVITE
request, the IWF, performing the originating participating role:
1) shall generate a SIP INVITE request as specified in subclause 106.3.2.1.10;
2) shall include an SDP offer based upon the SDP offer in the SIP INVITE
request generated by the IWF in the step above; and
3) shall send the SIP INVITE request to the controlling MCPTT function
according to 3GPP TS 24.229 [4];
Upon receipt of a SIP 2xx response to the above SIP INVITE request in step 3)
the IWF performing the participating role:
1) shall perform the procedures for receiving a SIP 2xx response as specified
in subclause 110.1.2.2.1.1;
2) if the procedures of subclause 109.2.2.2.12 in 3GPP TS 24.379 [81] for
implicit affiliation were performed in the present subclause, shall complete
the implicit affiliation by performing the procedures of subclause
109.2.2.2.13 in 3GPP TS 24.379 [81];
Editor's Note: step 2) above needs to be revised when 109.2.2.2.12 and
109.2.2.2.13 are inserted into this TS.
3) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [7].
Upon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request
in step 14) the IWF performing the participating role:
1) shall perform the procedures for receiving a SIP 4xx response, a SIP 5xx
response or a SIP 6xx response as specified in subclause 110.1.2.2.1.1;
2) if the implicit affiliation procedures of subclause 109.2.2.2.12 in 3GPP TS
24.379 [81], were invoked in the current procedure, shall perform the
procedures of subclause 109.2.2.2.14 in 3GPP TS 24.379 [81].
Editor's Note: step 2) above needs to be revised when 109.2.2.2.12 and
109.2.2.2.13 are inserted into this specification.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions for SIP INFO as specified in
subclause 110.1.2.2.1.1.
###### 110.1.2.3.1.2 Sending of a SIP re-INVITE request towards the MCPTT
controlling function
Upon a need to send a SIP re-INVITE request for an MCPTT session identifying
an on-demand MCPTT chat group session, the IWF performing the participating
role:
1) if the request is for an upgrade to an in-progress emergency group state or
an imminent peril group state, the IWF performing the participating role shall
perform the steps in subclause 110.1.2.2.1.4;
2) if the request is for a cancellation of an in-progress emergency group
state, the IWF performing the participating role shall perform the steps in
subclause 110.1.2.2.1.3;
3) if the request is for a cancellation of an in-progress imminent peril group
state, the IWF performing the participating role shall perform the steps in
subclause 110.1.2.2.1.5;
4) shall include the MCPTT ID of the originating user in the \ element of the application/vnd.3gpp.mcptt-info+xml MIME body of the
SIP re-INVITE request;
NOTE: How the IWF determines the MCPTT ID of a user homed in the IWF is out of
scope of the present document.
5) shall include in the SIP re-INVITE request an SDP offer as specified in
subclause 106.3.2.1.1.1; and
6) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
Upon receipt of a SIP 2xx response to the above SIP re-INVITE request, the
participating MCPTT function:
1) if the SIP re-INVITE request above is for an upgrade for emergency or
imminent peril, follow the procedures for SIP 2xx response as specified in
subclause 110.1.2.2.1.4;
2) if the SIP re-INVITE request above is for an in-progress emergency cancel,
follow the procedures for SIP 2xx response as specified in subclause
110.1.2.2.1.3; or
3) if the SIP re-INVITE request above is for an in-progress imminent peril
cancel, follow the procedures for SIP 2xx response as specified in subclause
110.1.2.2.1.5.
Upon receipt of a SIP 403 (Forbidden) response to the sent SIP re-INVITE
request the participating MCPTT function, the IWF action is out of scope of
the present document.
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
SIP re-INVITE request the IWF:
1) if the SIP re-INVITE request above is for an upgrade for emergency or
imminent peril, follow the procedures for SIP 4xx, 5xx or 6xx response as
specified in subclause 110.1.2.2.1.4;
2) if the SIP re-INVITE request above is for an in-progress emergency cancel,
follow the procedures for SIP 4xx, 5xx or 6xx response as specified in
subclause 110.1.2.2.1.3; or
3) if the SIP re-INVITE request above is for an in-progress imminent peril
cancel, follow the procedures for SIP 4xx, 5xx or 6xx response as specified in
subclause 110.1.2.2.1.5.
Upon receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing session, the IWF performing the
participating role shall:
1) if the SIP re-INVITE request above is for an upgrade for emergency or
imminent peril, follow the procedures for SIP INFO as specified in subclause
110.1.2.2.1.4; or
2) if the SIP re-INVITE request above is for an in-progress emergency cancel,
follow the procedures for SIP INFO as specified in subclause 110.1.2.2.1.3.
###### 110.1.2.3.1.3 Reception of a SIP INVITE request by an IWF performing
the terminating participating role
Upon receipt of a \"SIP INVITE request for terminating participating MCPTT
function\", targeting a user homed in the IWF for an MCPTT chat group, the IWF
performing the participating role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the \"SIP INVITE request for terminating
participating MCPTT function\" with a SIP 500 (Server Internal Error)
response. The IWF performing the participating role may include a Retry-After
header field to the SIP 500 (Server Internal Error) response as specified in
IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;
2) shall check the presence of the isfocus media feature tag in the Contact
header field and if it is not present then the IWF performing the
participating role shall reject the request with a SIP 403 (Forbidden)
response with the warning text set to \"104 isfocus not assigned\" in a
Warning header field as specified in subclause 104.4. Otherwise, continue with
the rest of the steps; and
3) shall perform the steps in 110.1.2.2.1.6.
###### 110.1.2.3.1.4 Reception of a SIP re-INVITE request by an IWF performing
the terminating participating role
Upon receipt of a SIP re-INVITE targeting a user homed in the IWF for an MCPTT
chat group, the IWF performing the participating role shall perform the steps
in 110.1.2.2.1.2.
##### 110.1.2.3.3 End group call at the originating participating IWF
###### 110.1.2.3.3.1 IWF ending on-demand chat session
When the IWF performing the participating role determines a need to send a SIP
BYE request, the IWF shall follow the procedures as specified in subclause
106.3.2.1.6.
##### 110.1.2.3.4 End group call at the terminating participating IWF
###### 110.1.2.3.4.1 Receipt of SIP BYE request for on-demand chat session
Upon receiving a SIP BYE request from the controlling MCPTT function, the IWF
performing the participating role shall follow the procedures as specified in
subclause 106.3.2.2.8.1.
#### 110.1.2.4 IWF controlling role procedures
##### 110.1.2.4.1 On-demand chat group call
###### 110.1.2.4.1.1 Procedure for establishing an MCPTT chat session and
procedure for joining an established MCPTT chat session
In the procedures in this subclause:
1) MCPTT ID in an incoming SIP INVITE request refers to the MCPTT ID of the
originating user from the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request;
2) group identity in an incoming SIP INVITE request refers to the group
identity from the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request;
3) MCPTT ID in an outgoing SIP INVITE request refers to the MCPTT ID of the
called user in the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE
request;
4) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
5) alert indication in an incoming SIP INVITE request refers to the \ element of the application/vnd.3gpp.mcptt-info+xml MIME body.
Upon receipt of a \"SIP INVITE request for controlling MCPTT function of an
MCPTT group\" containing a group identity identifying a MCPTT chat group, the
IWF performing the controlling role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the controlling role may include
a Retry-After header field to the SIP 500 (Server Internal Error) response as
specified in IETF RFC 3261 [24] and skip the rest of the steps;
NOTE 1: If the SIP INVITE request contains an emergency indication set to a
value of \"true\", the IWF performing the controlling role can by means beyond
the scope of this specification choose to accept the request.
2) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if:
a) an Accept-Contact header field does not include the g.3gpp.mcptt media
feature tag;
b) an Accept-Contact header field does not include the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
or
c) the isfocus media feature tag is present in the Contact header field;
3) if received SIP INVITE request includes an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ element included or an
\ element included, shall validate the request as described
in 3GPP TS 24.379 [81], subclause 6.3.3.1.17, with the IWF acting as the
controlling MCPTT function;
4) shall retrieve the necessary group document(s) from the group management
server for the group identity contained in the SIP INVITE request and carry
out initial processing as specified in 3GPP TS 24.379 [81], subclause 6.3.5.2,
with the IWF acting as the participating MCPTT function and continue with the
rest of the steps if the checks in 3GPP TS 24.379 [81], subclause 6.3.5.2
succeed;
5) if the MCPTT user identified by the MCPTT ID in the SIP INVITE request is
not affiliated with the MCPTT group identified by the group identity in the
SIP INVITE request as determined by the procedures of 3GPP TS 24.379 [81],
subclause 6.3.6, with the IWF acting as the controlling MCPTT function:
a) shall check if the MCPTT user is eligible to be implicitly affiliated with
the MCPTT chat group as determined by subclause 109.2.2.3.6; and
b) if the MCPTT user is not eligible for implicit affiliation, shall reject
the SIP INVITE request with a SIP 403 (Forbidden) response with the warning
text set to \"120 user is not affiliated to this group\" in a Warning header
field as specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF acting
as the controlling MCPTT function and skip the rest of the steps below;
6) if the SIP INVITE request contains unauthorised request for an MCPTT
emergency group call as determined by subclause 106.3.3.1.13.2:
a) shall reject the SIP INVITE request with a SIP 403 (Forbidden) response as
specified in subclause 106.3.3.1.14; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
7) if the SIP INVITE request contains an unauthorised request for an MCPTT
imminent peril group call as determined by subclause 106.3.3.1.13.6, shall
reject the SIP INVITE request with a SIP 403 (Forbidden) response with the
following clarifications:
a) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 with the \ element containing the \
element with the \ element set to a value of \"false\"; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
8) if a Resource-Priority header field is included in the SIP INVITE request:
a) if the Resource-Priority header field is set to the value indicated for
emergency calls and the SIP INVITE request does not contain an emergency
indication and the in-progress emergency state of the group is set to a value
of \"false\", shall reject the SIP INVITE request with a SIP 403 (Forbidden)
response and skip the remaining steps; and
b) if the Resource-Priority header field is set to the value indicated for
imminent peril calls and the SIP INVITE request does not contain an imminent
peril indication and the in-progress imminent peril state of the group is set
to a value of \"false\", shall reject the SIP INVITE request with a SIP 403
(Forbidden) response; and skip the remaining steps;
9) shall determine if the media parameters are acceptable and the MCPTT speech
codec is offered in the SDP offer and if not reject the request with a SIP 488
(Not Acceptable Here) response and skip the rest of the steps;
10) shall create a chat group session and allocate an MCPTT session identity
for the chat group session if the MCPTT chat group session identity does not
already exist, and may handle timer TNG3 (group call timer) as specified in
subclause 106.3.3.5;
11) if the chat group session is ongoing and the \ as specified in 3GPP TS 24.481 [31] is already reached:
a) if, according to local policy, the user identified by the MCPTT ID in the
SIP INVITE request is deemed to have a higher priority than an existing user
in the chat group session, may remove a participant from the session by
following subclause 110.1.1.4.4.3, and skip the next step; and
NOTE 2: The local policy for deciding whether to admit a user to a call that
has reached its maximum amount of participants can include the \ and the \ of the user as well as other information
of the user from the group document as specified in 3GPP TS 24.481 [31]. The
local policy decisions can also include taking into account whether the
imminent-peril indicator or emergency indicator was received in the SIP INVITE
request.
b) shall return a SIP 486 (Busy Here) response with the warning text set to
\"122 too many participants\" to the originating network as specified in 3GPP
TS 24.379 [81], subclause 4.4, with the IWF acting as the controlling MCPTT
function. Otherwise, continue with the rest of the steps;
12) if the received SIP INVITE request was determined to be eligible for
implicit affiliation in step 5) and if subclause 109.2.2.3.7 was not
previously invoked in the present subclause, shall perform the implicit
affiliation as specified in subclause 109.2.2.3.7;
13) if the SIP INVITE request contains an emergency indication set to a value
of \"true\" or the in-progress emergency state of the group to \"true\" the
IWF performing the controlling role shall:
a) validate that the SIP INVITE request includes a Resource-Priority header
field populated with the values for an MCPTT emergency group call as specified
in subclause 106.3.3.1.19, and if not:
i) perform the actions specified in subclause 106.3.3.1.8;
ii) send the SIP UPDATE request generated in subclause 106.3.3.1.8 towards the
initiator of the SIP INVITE request according to 3GPP TS 24.229 [4]; and
iii) upon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in
subclause 106.3.3.1.8, proceed with the rest of the steps.
NOTE 3: Verify that the Resource-Priority header is included and properly
populated for both ongoing and newly- entered in-progress emergency states of
the specified group.
b) if the in-progress emergency state of the group is set to a value of
\"true\" and the MCPTT user is indicating a new emergency indication:
i) for each of the other affiliated MCPTT members of the group generate a SIP
MESSAGE request notification of the MCPTT user\'s emergency indication as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.11, with the IWF acting as
the controlling MCPTT function, with the following clarifications:
A) set the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body to a value of \"true\";
B) if the received SIP INVITE contains an alert indication set to a value of
\"true\" and this is an authorised request for an MCPTT emergency alert
meeting the conditions specified in subclause 106.3.3.1.13.1, perform the
procedures specified in subclause 106.3.3.1.12; and
C) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];
ii) cache the information that the MCPTT user has initiated an MCPTT emergency
call; and
iii) if the SIP INVITE request contains an authorised request for an MCPTT
emergency alert as determined in step i) B) above, cache the information that
the MCPTT user has initiated an MCPTT emergency alert; and
c) if the in-progress emergency state of the group is set to a value of
\"false\":
i) shall set the value of the in-progress emergency state of the group to
\"true\";
ii) shall start timer TNG2 (in-progress emergency group call timer) and handle
its expiry as specified in subclause 106.3.3.1.16;
iii) shall generate SIP re-INVITE requests for the MCPTT emergency group call
to the other MCPTT affiliated and joined participants of the MCPTT chat group
as specified in subclause 106.3.3.1.6;
iv) shall generate SIP INVITE requests for the MCPTT emergency group call to
the affiliated but not joined MCPTT members of the MCPTT chat group as
specified in subclause 106.3.3.1.7;
A) for each affiliated but not joined MCPTT member shall send the SIP INVITE
request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) upon receiving a SIP 200 (OK) response to the SIP INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5];
v) shall cache the information that the MCPTT user has initiated an MCPTT
emergency call; and
vi) if the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body is set to \"true\" and is an authorised request for an MCPTT
emergency alert as specified in subclause 106.3.3.1.13.1, shall cache the
information that the MCPTT user has initiated an MCPTT emergency alert; and
vii) if the in-progress imminent peril state of the group is set to a value of
\"true\", shall set it to a value of \"false\";
14) if the in-progress emergency state of the group is set to a value of
\"false\" and if the SIP INVITE request contains an imminent peril indication
set to a value of \"true\" or the in-progress imminent peril state of the
group is set to \"true\", the IWF performing the controlling role shall:
a) validate that the SIP INVITE request includes a Resource-Priority header
field populated with the values for an MCPTT imminent peril group call as
specified in subclause 106.3.3.1.19, and if not:
i) perform the actions specified in subclause 106.3.3.1.8;
ii) send the SIP UPDATE request generated in subclause 106.3.3.1.8 towards the
initiator of the SIP INVITE request according to 3GPP TS 24.229 [4]; and
iii) upon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in
subclause 106.3.3.1.8 proceed with the rest of the steps.
NOTE 4: Verify that the Resource-Priority header is included and properly
populated for both ongoing and newly- entered in-progress imminent peril
states of the specified group.
b) if the in-progress imminent peril state of the group is set to a value of
\"true\" and the MCPTT user is indicating a new imminent peril indication:
i) for each of the other affiliated MCPTT member of the group generate a SIP
MESSAGE request notification of the MCPTT user\'s imminent peril indication as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.11, with the IWF acting as
the controlling MCPTT function, with the following clarifications;
A) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"true\"; and
B) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and
ii) cache the information that the MCPTT user has initiated an MCPTT imminent
peril call; and
c) if the in-progress imminent peril state of the group is set to a value of
\"false\":
i) shall set the value of the in-progress imminent peril state of the group to
\"true\";
ii) shall generate SIP re-INVITE requests for the MCPTT imminent peril group
call to the other MCPTT affiliated and joined participants of the MCPTT chat
group as specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.15, with the IWF
acting as the controlling MCPTT function;
iii) shall generate SIP INVITE requests for the MCPTT imminent peril call to
the affiliated but not joined MCPTT members of the MCPTT chat group as
specified in subclause 106.3.3.1.7;
A) for each affiliated but not joined MCPTT member shall send the SIP INVITE
request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) Upon receiving a SIP 200 (OK) response to the SIP INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5]; and
iv) shall cache the information that the MCPTT user has initiated an MCPTT
imminent peril call;
15) shall accept the SIP request and generate a SIP 200 (OK) response to the
SIP INVITE request according to 3GPP TS 24.229 [4];
16) shall include in the SIP 200 (OK) response an SDP answer according to 3GPP
TS 24.229 [4] with the clarifications specified in 3GPP TS 24.379 [81],
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function,
unless the procedures of subclause 106.3.3.1.8 were performed in step 13)a) or
step 14)a) above;
17) should include the Session-Expires header field and start supervising the
SIP session according to IETF RFC 4028 [7]. It is recommended that the
\"refresher\" header field parameter is omitted. If included, the
\"refresher\" header field parameter shall be set to \"uac\";
18) shall include the \"timer\" option tag in a Require header field;
19) shall include the following in a Contact header field:
a) the g.3gpp.mcptt media feature tag;
b) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
c) the MCPTT session identity; and
d) the media feature tag isfocus;
20) shall include the \"tdialog\" option tag in a Supported header field
according to IETF RFC 4538 [23];
21) if the SIP INVITE request contains an alert indication set to a value of
\"true\" and this is an unauthorised request for an MCPTT emergency alert as
specified in subclause 106.3.3.1.13.1, shall include in the SIP 200 (OK)
response the warning text set to \"149 SIP INFO request pending\" in a Warning
header field as specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF
acting as the controlling MCPTT function;
22) if the received SIP INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"true\" and if the in-progress emergency state of the group is set to a value
of \"true\", shall include in the SIP 200 (OK) response the warning text set
to \"149 SIP INFO request pending\" in a Warning header field as specified in
3GPP TS 24.379 [81], subclause 4.4, with the IWF acting as the controlling
MCPTT function;
NOTE 5: In this case, the request was for an imminent peril call but a higher
priority MCPTT emergency call was already in progress on the group. Hence, the
imminent peril call request aspect of the request is denied but the request is
granted with emergency level priority.
23) shall interact with media plane as specified in 3GPP TS 24.380 [5];
24) shall send the SIP 200 (OK) response to the MCPTT client according to 3GPP
TS 24.229 [4]; and
25) if the chat group session was already ongoing and if at least one of the
MCPTT participants has subscribed to the conference event package, shall send
a SIP NOTIFY request to all MCPTT participants with a subscription to the
conference event package as specified in 3GPP TS 24.379 [81], subclause
10.1.3.4.2 with the IWF acting as the controlling MCPTT function.
Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning
text set to \"149 SIP INFO request pending\" in a Warning header field as
specified in subclause 4.4, the IWF performing the controlling role shall
follow the procedures in subclause 106.3.3.1.18.
###### 110.1.2.4.1.2 Receipt of a SIP re-INVITE request
In the procedures in this subclause:
1) emergency indication in an incoming SIP re-INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) imminent peril indication in an incoming SIP re-INVITE request refers to
the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body.
Upon receipt of a SIP re-INVITE request for an MCPTT session identity
identifying a MCPTT chat group session, the IWF performing the controlling
role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP re-INVITE request with a SIP 500 (Server
Internal Error) response. The IWF performing the controlling role may include
a Retry-After header field to the SIP 500 (Server Internal Error) response as
specified in IETF RFC 3261 [24] and skip the rest of the steps;
NOTE 1: if the SIP re-INVITE request contains an emergency indication or an
imminent peril indication set to a value of \"true\" and this is an authorised
request for originating an MCPTT emergency group call as determined by
subclause 106.3.3.1.13.2, or for originating an MCPTT imminent peril group
call as determined by subclause 106.3.3.1.13.5, the IWF performing the
controlling role can according to local policy choose to accept the request.
2) if the received SIP re-INVITE request includes an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element
included or an \ element included, shall validate the
request as described in 3GPP TS 24.379 [81], subclause 6.3.3.1.17, with the
IWF acting as the controlling MCPTT function;
3) if the SIP re-INVITE request contains an unauthorised request for an MCPTT
emergency call as determined by subclause 106.3.3.1.13.2:
a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response
as specified in subclause 106.3.3.1.14; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
4) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"true\" and is an authorised request to initiate an MCPTT emergency group
call as determined by subclause 106.3.3.1.13.2, the IWF performing the
controlling role shall:
a) validate that the SIP re-INVITE request includes a Resource-Priority header
field is populated correctly for an MCPTT emergency group call as specified in
subclause 106.3.3.1.19, and if not:
i) shall perform the actions specified in subclause 106.3.3.1.8; and
ii) upon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in
subclause 106.3.3.1.8 shall proceed with the rest of the steps.
NOTE 2: Verify that the Resource-Priority header is included and properly
populated for both ongoing and newly-entered in-progress emergency states of
the specified group.
b) if the in-progress emergency state of the group is set to a value of
\"true\" and the MCPTT user is indicating a new emergency indication:
i) shall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT
emergency call;
ii) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of \"true\"
and is an authorised request for an MCPTT emergency alert as determined by
subclause 106.3.3.1.13.1, shall cache the MCPTT ID of the MCPTT user that has
initiated an MCPTT emergency alert; and
iii) for each of the other affiliated members of the group, generate a SIP
MESSAGE request notification of the MCPTT user\'s emergency indication as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.11, with the IWF acting as
the controlling MCPTT function, with the following clarifications:
A) set the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body to a value of \"true\";
B) if the received SIP re-INVITE contains an alert indication set to a value
of \"true\" and this is an authorised request for an MCPTT emergency alert
meeting the conditions specified in subclause 106.3.3.1.13.1, perform the
procedures specified in subclause 106.3.3.1.12; and
C) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and
c) if the in-progress emergency state of the group is set to a value of
\"false\":
i) shall set the value of the in-progress emergency state of the group to
\"true\";
ii) shall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT
emergency call;
iii) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of \"true\"
and this is an authorised request for an MCPTT emergency alert as specified in
subclause 106.3.3.1.13.1, shall cache the MCPTT ID of the MCPTT user that has
initiated an MCPTT emergency alert;
iv) shall start timer TNG2 (in-progress emergency group call timer) and handle
its expiry as specified in subclause 106.3.3.1.16;
v) shall generate SIP re-INVITE requests for the MCPTT emergency group call to
the other affiliated and joined participants of the MCPTT chat group as
specified in subclause 106.3.3.1.6. The IWF performing the controlling role:
A) for each affiliated and joined member shall send the SIP re-INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5]; and
vi) shall generate SIP INVITE requests for the MCPTT emergency group call to
the affiliated but not joined MCPTT members of the MCPTT chat group as
specified in subclause 106.3.3.1.7. The IWF performing the controlling role:
A) for each affiliated but not joined MCPTT member shall send the SIP INVITE
request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) Upon receiving a SIP 200 (OK) response to the SIP INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5]; and
vii) if the in-progress imminent peril state of the group is set to a value of
\"true\", shall set it to a value of \"false\";
5) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is an unauthorised request for an MCPTT emergency group call
cancellation as determined by subclause 106.3.3.1.13.4:
a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response;
b) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 with an \ element set to a value of \"true\";
c) if an \ element of the application/vnd.3gpp.mcptt-info+xml MIME
body is included set to \"false\" and there is an outstanding MCPTT emergency
alert for the MCPTT user, shall include in the application/vnd.3gpp.mcptt-
info+xml MIME body and \ element set to a value of \"true\"; and
d) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
6) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is determined to be an authorised request for an MCPTT emergency
call cancellation as specified in subclause 106.3.3.1.13.4 and the in-progress
emergency state of the group to is set to a value of \"true\" the IWF
performing the controlling role shall:
a) validate that the SIP re-INVITE request includes a Resource-Priority header
field is populated correctly for a normal priority MCPTT group call as
specified in subclause 106.3.3.1.19, and if not:
i) shall perform the actions specified in subclause 106.3.3.1.8; and
ii) upon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in
subclause 106.3.3.1.8 shall proceed with the rest of the steps;
NOTE 3: Verify that the Resource-Priority header is included and properly
populated for an in-progress emergency state cancellation of the specified
group.
b) set the in-progress emergency group state of the group to a value of
\"false\";
c) clear the cache of the MCPTT ID of the MCPTT user identified by the
\ element as having an outstanding MCPTT emergency group call;
d) if an \ element of the application/vnd.3gpp.mcptt-info+xml MIME
body is included and set to \"false\" and is determined to be an authorised
request for an MCPTT emergency alert cancellation as specified in subclause
106.3.3.1.13.3 and there is an outstanding MCPTT emergency alert for the MCPTT
user shall:
i) if the received SIP re-INVITE request contains an \ element
in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the
MCPTT ID of the MCPTT user identified by the \ element as
having an outstanding MCPTT emergency alert; and
ii) if the received SIP re-INVITE request does not contain an \
element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache
of the MCPTT ID of the sender of the SIP re-INVITE request as having an
outstanding MCPTT emergency alert;
e) generate SIP re-INVITE requests to the other affiliated and joined members
of the MCPTT group as specified in subclause 106.3.3.1.6. The IWF performing
the controlling role:
i) for each affiliated and joined member shall send the SIP re-INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
ii) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the
IWF performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5]; and
NOTE 4: Subclause 106.3.3.1.6 will inform the affiliated and joined members of
the cancellation of the MCPTT group\'s in-progress emergency state and the
cancellation of the MCPTT emergency alert if applicable.
f) for each of the affiliated but not joined members of the group shall:
i) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s emergency call as specified in 3GPP TS 24.379 [81], subclause
6.3.3.1.11, with the IWF acting as the controlling MCPTT function;
ii) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"false\";
iii) if indicated above in step d), set the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\"; and
iv) send the SIP MESSAGE request according to 3GPP TS 24.229 [4];
7) if a Resource-Priority header field is included in the SIP re-INVITE
request:
a) if the Resource-Priority header field is set to the value indicated for
emergency calls and the received SIP re-INVITE request does not contain an
authorised request for an MCPTT emergency call as determined in step 4) above
and the in-progress emergency state of the group is set to a value of
\"false\", shall reject the SIP re-INVITE request with a SIP 403 (Forbidden)
response and skip the remaining steps; or
b) if the Resource-Priority header field is set to the value indicated for
imminent peril calls and the received SIP re-INVITE request does not contain
an authorised request for an MCPTT imminent peril call as determined by the
procedures of subclause 106.3.3.1.13.5 and the in-progress imminent peril
state of the group is set to a value of \"false\", shall reject the SIP re-
INVITE request with a SIP 403 (Forbidden) response and skip the remaining
steps;
8) if the received SIP re-INVITE request contains an imminent peril
indication, shall perform the procedures specified in subclause 110.1.2.4.1.3
and skip the rest of the steps;
9) shall include in the SIP 200 (OK) response an SDP answer according to 3GPP
TS 24.229 [4] with the clarifications specified in 3GPP TS 24.379 [81],
subclause 6.3.3.2.1, with the IWF acting as the controlling MCPTT function,
unless the procedures of subclause 106.3.3.1.8 were performed in step 6) a) i)
above;
10) shall include the \"tdialog\" option tag in a Supported header field
according to IETF RFC 4538 [23];
11) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to a value of \"true\" and if this is an unauthorised request for an MCPTT
emergency alert as determined by subclause 106.3.3.1.13.1, shall include in
the SIP 200 (OK) response the warning text set to \"149 SIP INFO request
pending\" in a Warning header field as specified in 3GPP TS 24.379 [81],
subclause 4.4, with the IWF acting as the controlling MCPTT function;
12) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to a value of \"false\" and if this is an unauthorised request for an
MCPTT emergency alert cancellation as determined by subclause 106.3.3.1.13.3,
shall include in the SIP 200 (OK) response the warning text set to \"149 SIP
INFO request pending\" in a Warning header field as specified in 3GPP TS
24.379 [81], subclause 4.4, with the IWF acting as the controlling MCPTT
function;
13) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"true\", this is an authorised request for an MCPTT
imminent peril group call and if the in-progress emergency state of the group
is set to a value of \"true\", shall include in the SIP 200 (OK) response the
warning text set to \"149 SIP INFO request pending\" in a Warning header field
as specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF acting as the
controlling MCPTT function;
NOTE 5: In this case, the request was for an imminent peril call but a higher
priority MCPTT emergency call was already in progress on the group. Hence, the
imminent peril call request aspect of the request is denied but the request is
granted with emergency level priority.
14) shall interact with media plane as specified in 3GPP TS 24.380 [5]; and
15) shall send the SIP 200 (OK) response towards the MCPTT client according to
3GPP TS 24.229 [4].
Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning
text set to \"149 SIP INFO request pending\" in a Warning header field as
specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF acting as the
controlling MCPTT function, the IWF performing the controlling role shall
follow the procedures in subclause 106.3.3.1.18.
###### 110.1.2.4.1.3 Handling of a SIP re-INVITE request for imminent peril
session
In the procedures in this subclause:
1) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.
When the IWF performing the controlling role receives a SIP re-INVITE request
with and imminent peril indication, the IWF performing the controlling role:
1) if the SIP re-INVITE request contains an unauthorised request for an MCPTT
imminent peril group call as determined by subclause 106.3.3.1.13.5, shall
reject the SIP re-INVITE request with a SIP 403 (Forbidden) response with the
following clarifications:
a) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 with the \ element containing the \
element with the \ element set to a value of \"false\"; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
2) if the in-progress emergency group state of the group is set to a value of
\"false\" and if the SIP re-INVITE request contains an imminent peril
indication set to a value of \"true\" or the in-progress imminent peril state
of the group to \"true\", the IWF performing the controlling role shall:
a) validate that the SIP re-INVITE request includes a Resource-Priority header
field with the namespace set to the MCPTT-specific namespace specified in IETF
RFC 8101 [48] and the priority set to the priority designated for imminent
peril calls and if not:
i) perform the actions specified in subclause 106.3.3.1.8;
ii) send the SIP UPDATE request generated in subclause 106.3.3.1.8 towards the
initiator of the SIP re-INVITE request according to 3GPP TS 24.229 [4]; and
iii) upon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in
subclause 106.3.3.1.8 proceed with the rest of the steps.
NOTE 1: Verify that the Resource-Priority header is included and properly
populated for both ongoing and newly- entered in-progress imminent peril
states of the specified group.
b) if the in-progress imminent peril state of the group is set to a value of
\"true\" and the MCPTT user is indicating a new imminent peril indication:
i) for each of the other affiliated member of the group generate a SIP MESSAGE
request notification of the MCPTT user\'s imminent peril indication as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.11, with the IWF acting as
the controlling function, with the following clarifications;
A) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"true\"; and
B) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and
ii) cache the information that the MCPTT user has initiated an MCPTT imminent
peril call; and
c) if the in-progress imminent peril state of the group is set to a value of
\"false\":
i) shall set the value of the in-progress imminent peril state of the group to
\"true\";
ii) shall generate SIP re-INVITE requests for the MCPTT imminent peril group
call to the other affiliated and joined participants of the MCPTT chat group
as specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.15, with the IWF acting
as the controlling MCPTT function;
iii) shall generate SIP INVITE requests for the MCPTT imminent peril group
call to the affiliated but not joined members of the MCPTT chat group as
specified in subclause 106.3.3.1.7;
A) for each affiliated but not joined member shall send the SIP INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) Upon receiving a SIP 200 (OK) response to the SIP INVITE request the IWF
performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5]; and
iv) shall cache the information that the MCPTT user has initiated an MCPTT
imminent peril call;
3) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is an unauthorised request for an MCPTT imminent peril group
call cancellation as determined by subclause 106.3.3.1.13.6 shall:
a) reject the SIP re-INVITE request with a SIP 403 (Forbidden) response to the
SIP re-INVITE request; and
b) include in the SIP 403 (Forbidden) response:
i) include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in 3GPP TS 24.379 [81], clause F.1 with the
\ element containing the \ element with the
\ element set to a value of \"false\";
ii) send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4];
and
iii) skip the rest of the steps;
4) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is determined to be an authorised request for an MCPTT imminent
peril call cancellation as specified in subclause 106.3.3.1.13.6 and the in-
progress imminent peril state of the group to is set to a value of \"true\"
the IWF performing the controlling role shall:
a) validate that the SIP re-INVITE request includes a Resource-Priority header
field with the namespace set to the MCPTT-specific namespace specified in IETF
RFC 8101 [48], and the priority set to the priority level designated for a
normal priority MCPTT group call, and if not:
i) perform the actions specified in subclause 106.3.3.1.8; and
ii) upon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in
subclause 106.3.3.1.8, proceed with the rest of the steps;
NOTE 2: verify that the Resource-Priority header is included and properly
populated for an in-progress emergency group state cancellation of the
specified group.
b) set the in-progress imminent peril state of the group to a value of
\"false\";
c) cache the information that the MCPTT user no longer has an outstanding
MCPTT imminent peril group call;
d) generate SIP re-INVITES requests to the other affiliated and joined members
of the MCPTT group as specified in 3GPP TS 24.379 [81], subclause 6.3.3.1.15,
with the IWF acting as the controlling MCPTT function. The IWF performing the
controlling role:
i) for each affiliated and joined member shall send the SIP re-INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
ii) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE request the
IWF performing the controlling role shall interact with the media plane as
specified in 3GPP TS 24.380 [5]; and
NOTE 3: 3GPP TS 24.379 [81], subclause 6.3.3.1.15, with the IWF acting as the
controlling MCPTT function, will inform the affiliated and joined members of
the cancellation of the MCPTT group\'s in-progress emergency group state and
the cancellation of the MCPTT emergency alert if applicable.
e) for each of the affiliated but not joined MCPTT members of the group:
i) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s imminent peril call as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.1.11, with the IWF acting as the controlling MCPTT function;
ii) set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"false\"; and
iii) send the SIP MESSAGE request according to 3GPP TS 24.229 [4];
5) include in the SIP 200 (OK) response an SDP answer according to 3GPP TS
24.229 [4] with the clarifications specified in 3GPP TS 24.379 [81], subclause
6.3.3.2.1 unless the procedures of subclause 106.3.3.1.8 were performed in
step 2) or 4) above;
6) include the \"norefersub\" option tag in a Supported header field according
to IETF RFC 4488 [22];
7) include the \"tdialog\" option tag in a Supported header field according to
IETF RFC 4538 [23];
8) interact with media plane as specified in 3GPP TS 24.380 [5]; and
9) send the SIP 200 (OK) response towards the MCPTT client according to 3GPP
TS 24.229 [4].
##### 110.1.2.4.2 End group call at the terminating IWF performing the
controlling role
Upon receiving a SIP BYE request the IWF performing the controlling role shall
follow the procedures as specified in subclause 106.3.3.2.4.
##### 110.1.2.4.3 End group call initiated by the IWF performing the
controlling role
###### 110.1.2.4.3.1 General
This subclause describes the procedures of each functional entity for ending
the group call initiated by the IWF performing the controlling role.
###### 110.1.2.4.3.2 SIP BYE request for releasing MCPTT session for a group
call
When the MCPTT session for group call needs to be released as specified in
subclause 106.3.8.1, the IWF performing the controlling role shall follow the
procedures in subclause 106.3.3.1.5.
###### 110.1.2.4.3.3 SIP BYE request toward a MCPTT client
When an MCPTT client needs to be removed from the MCPTT session (e.g. due to
de-affiliation or admitting a higher priority user), the IWF performing the
controlling role shall follow the procedures in subclause 106.3.3.1.5.
After successfully removing the MCPTT client from the MCPTT session, the IWF
performing the controlling role may generate a notification to the MCPTT
clients, which have subscribed to the conference event package that an MCPTT
user has been removed from the MCPTT session, as specified in subclause
106.3.3.4 and send the SIP NOTIFY request to the MCPTT client according to
3GPP TS 24.229 [4].
###### 110.1.2.4.3.4 Removal of participant homed in the IWF
After successfully removing a participant homed in the IWF from the MCPTT
session, the IWF performing the controlling role may generate a notification
to any MCPTT clients in the session, which have subscribed to the conference
event package that a user has been removed from the MCPTT session, as
specified in subclause 106.3.3.4 and send the SIP NOTIFY request to the MCPTT
client according to 3GPP TS 24.229 [4].
#### 110.1.5.3 IWF performing the participating role
##### 110.1.5.3.1 Originating procedures
Originating procedures are not supported in this version of the specification.
##### 110.1.5.3.2 Terminating procedures
Upon receiving a \"SIP MESSAGE request for remotely initiated group call for
terminating participating function\" the IWF performing the participating role
shall reject the SIP MESSAGE request with a SIP 501 (Not Implemented)
response.
#### 110.1.5.4 IWF performing the controlling role
Upon receiving:
\- a \"SIP MESSAGE request for remotely initiated group call request for
controlling MCPTT function\"; or
\- a \"SIP MESSAGE request for remotely initiated group call response for
controlling MCPTT function\";
the IWF performing the controlling role shall reject the SIP MESSAGE request
with a SIP 501 (Not Implemented) response.
# 111 Private call call control
## 111.1 On-network private call
### 111.1.1 Private call with floor control
###### 111.1.1.2.1.1 Originating procedures
This subclause is referenced from other procedures.
To establish an MCPTT private call the IWF performing the participating role
shall generate an initial SIP INVITE request by following the UE originating
session procedures specified in 3GPP TS 24.229 [4], with the clarifications
given below.
The IWF performing the participating role:
1) if originating an MCPTT emergency private call or originating an MCPTT
private call and the MCPTT emergency state is already set, the IWF performing
the participating role, shall comply with the procedures in subclause
106.2.8.3.2;
2) shall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref
media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
in the Contact header field of the SIP INVITE request according to IETF RFC
3840 [16];
3) shall include an Accept-Contact header field containing the g.3gpp.mcptt
media feature tag along with the \"require\" and \"explicit\" header field
parameters according to IETF RFC 3841 [6];
4) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\"
according to IETF RFC 3841 [6];
5) for the establishment of a private call shall insert in the SIP INVITE
request a MIME resource-lists body with the MCPTT ID of the invited MCPTT
user, according to rules and procedures of IETF RFC 5366 [20];
6) if a security context needs to be established between the IWF and the MCPTT
client and if the user homed in the IWF is initiating a private call then:
a) if necessary, request keying material from the key management server as
described in 3GPP TS 33.180 [78];
b) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [78];
c) shall use the PCK to generate a PCK-ID with the four most significant bits
set to \"0001\" to indicate that the purpose of the PCK is to protect private
call communications and with the remaining twenty-eight bits being randomly
generated as described in 3GPP TS 33.180 [78];
d) shall encrypt the PCK to a UID associated to the MCPTT client using the
MCPTT ID and KMS URI of the invited user and a time related parameter as
described in 3GPP TS 33.180 [78];
NOTE 1: How the IWF obtains the KMS URI of the invited user is out of scope of
the present document.
e) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [78]; and
f) shall add the MCPTT ID of the originating user homed in the IWF to the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];
and
g) shall sign the MIKEY-SAKKE I_MESSAGE using the originating user homed in
the IWF\'s signing key provided in the keying material together with a time
related parameter, and add this to the MIKEY-SAKKE payload, as described in
3GPP TS 33.180 [78];
7) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
clarification given in subclause 106.2.1 and with a media stream of the
offered media-floor control entity;
8) if implicit floor control is required, shall comply with the conditions
specified in subclause 106.4;
9) if force of automatic commencement mode at the invited MCPTT client is
requested by the user homed in the IWF, shall include in the SIP INVITE
request a Priv-Answer-Mode header field with the value \"Auto\" according to
the rules and procedures of IETF RFC 5373 [18];
10) if force of automatic commencement mode at the invited MCPTT client is not
requested by the user homed in the IWF:
a) if automatic commencement mode at the invited MCPTT client is requested by
the user homed in the IWF, shall include in the SIP INVITE request an Answer-
Mode header field with the value \"Auto\" according to the rules and
procedures of IETF RFC 5373 [18]; and
b) if manual commencement mode at the invited MCPTT client is requested by the
user homed in the IWF, shall include in the SIP INVITE request an Answer-Mode
header field with the value \"Manual\" according to the rules and procedures
of IETF RFC 5373 [18]; and
11) shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with the
\ element set to a value of \"private\"; and
12) if the MCPTT emergency private call state of the user homed in the IWF is
set to either \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-
granted\" or the MCPTT emergency private priority state for this private call
is set to \"MEPP 2: in-progress\", the IWF shall comply with the procedures in
subclause 106.2.8.3.3.
NOTE 2: Upon receiving a SIP 183(Session Progress) response to the SIP INVITE
request the IWF performing the participating role\'s actions are out of scope
of the present document.
Upon receiving a SIP 200 (OK) response to the SIP INVITE request the IWF
performing the participating role:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5];
2) if the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-
requested\" or \"MEPC 3: emergency-pc-granted\", shall perform the actions
specified in 3GPP TS 24.379 [81], subclause 6.2.8.3.4, with the IWF acting as
the MCPTT client on behalf of the IWF user homed in the IWF; and
3) shall consider the call successfully established.
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request:
1) if the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-
requested\"; or
2) if the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-
granted\";
the IWF performing the participating role shall perform the actions specified
in 3GPP TS 24.379 [81], subclause 6.2.8.3.5, with the IWF acting as the MCPTT
client on behalf of the IWF user homed in the IWF.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing session, the IWF performing the
participating role shall follow the actions specified in 3GPP TS 24.379 [81],
subclause 6.2.8.3.7 with the IWF acting as the MCPTT client on behalf of the
IWF user homed in the IWF.
###### 111.1.1.2.1.2 IWF terminating procedures
This subclause is referenced from other procedures.
The IWF performing the participating role:
1) may reject the SIP INVITE request for any other reason outside the scope of
this specification otherwise, continue with the rest of the steps.
2) if the SIP INVITE request is rejected in step 1), shall respond toward the
controlling MCPTT function either with appropriate reject code as specified in
3GPP TS 24.229 [4] and warning texts as specified in subclause 4.4.2 or with
SIP 480 (Temporarily unavailable) response and skip the rest of the steps of
this subclause;
3) if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml
MIME body with the \ element containing the \ element
with the \ element set to a value of \"true\":
c) shall set the MCPTT emergency private priority state to \"MEPP 2: in-
progress\" for this private call;
4) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
I_MESSAGE:
a) shall extract the MCPTT ID of the originating MCPTT from the initiator
field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];
b) shall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [78];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as
specified in IETF RFC 4567 [47], and include warning text set to \"136
authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header field
as specified in subclause 104.4; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[78];
NOTE: With the PCK successfully shared between the originating and the
terminating parties, the IWF and the MCPTT client are able to use SRTP/SRTCP
to create a secure session.
5) shall perform the automatic commencement procedures specified in subclause
106.2.3.1.1 if one of the following conditions are met:
a) SIP INVITE request contains an Answer-Mode header field with the value
\"Auto\" and the IWF is configured for automatic commencement mode for the
user receiving the call;
c) SIP INVITE request contains a Priv-Answer-Mode header field with the value
of \"Auto\" and the IWF is able to process an automatic commencement; and
6) shall perform the manual commencement procedures specified in subclause
106.2.3.2.1 if either of the following conditions are met:
a) SIP INVITE request contains an Answer-Mode header field with the value
\"Manual\" and the IWF is configured for manual commencement mode for the user
receiving the call;
b) SIP INVITE request contains a Priv-Answer-Mode header field with the value
of \"Manual\" and the IWF is able to process a manual commencement.
Upon receiving the SIP CANCEL request cancelling a SIP INVITE request for
which a dialog exists at the IWF performing the participating role and a SIP
200 (OK) response has not yet been sent to the SIP INVITE request then the IWF
performing the participating role:
1) shall send a SIP 200 (OK) response to the SIP CANCEL request according to
3GPP TS 24.229 [4]; and
2) shall send a SIP 487 (Request Terminated) response to the SIP INVITE
request according to 3GPP TS 24.229 [4].
Upon receiving a SIP BYE request for an established dialog, the IWF performing
the participating role:
1) shall follow the procedures in subclause 111.1.4.2.
###### 111.1.1.2.1.3 Terminating procedures for reception of SIP re-INVITE
request
This subclause is referenced from other procedures.
Upon receipt of a SIP re-INVITE request for an existing private call session,
the IWF performing the participating role shall:
1) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of \"true\":
b) shall set the MCPTT emergency private priority state to \"MEPP 2: in-
progress\" for this private call;
2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element containing the \ element with the \ element set to a value of \"false\":
a) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body including an \ element:
i) if the MCPTT ID contained in the \ element is the MCPTT ID
of the receiving MCPTT user, shall set the MCPTT emergency alert state to
\"MPEA 1: no-alert\";
b) shall set the MCPTT emergency private priority state to \"MEPP 1: no-
emergency\" for this private call; and
c) if the MCPTT emergency private call state of the call is set to \"MEPC 3:
emergency-call-granted\", shall set the MCPTT emergency private call state of
the call to \"MEPC 1: emergency-pc-capable\";
3) may check if a Resource-Priority header field is included in the incoming
SIP INVITE request and may perform further actions outside the scope of this
specification to act upon an included Resource-Priority header field as
specified in 3GPP TS 24.229 [4]; and
NOTE: As this is a re-INVITE for an existing MCPTT private call session, there
is no attempt made to change the answer-mode from its current state.
4) include an SDP answer in the SIP 200 (OK) response to the SDP offer in the
incoming SIP INVITE request according to 3GPP TS 24.229 [4] with the
clarifications given in subclause 106.2.2 with the IWF acting as the MCPTT
client.
###### 111.1.1.2.1.4 MCPTT in-progress emergency cancel
This subclause is referenced from other procedures.
This subclause covers on-demand sessions.
To cancel the in-progress emergency condition on an MCPTT emergency private
call, the IWF performing the participating role shall generate a SIP re-INVITE
request by following the UE session procedures specified in 3GPP TS 24.229
[4], with the clarifications given below.
The IWF performing the participating role:
1) shall, if cancelling an in-progress emergency condition and optionally an
MCPTT emergency alert originated for the user homed in the IWF, include an
application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in
subclause 106.2.8.3.6;
2) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.3.3;
3) shall include in the SIP re-INVITE request an SDP offer with the media
parameters as currently established;
4) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4; and
5) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request, the IWF
performing the participating role:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5];
2) shall set the MCPTT emergency private priority state of the MCPTT private
call to \"MEPP 1: no-emergency\";
3) shall set the MCPTT emergency private call state of the call to \"MEPC 1:
emergency-pc-capable\"; and
4) if the MCPTT emergency alert state is set to \"MPEA 4: Emergency-alert-
cancel-pending\", the sent SIP re-INVITE request did not contain an
\ element in the application/vnd.3gpp.mcptt-info+xml MIME body
and the SIP 2xx response to the SIP request for a priority group call does not
contain a Warning header field as specified in 3GPP TS 24.379 [81], subclause
4.4 with the warning text containing the mcptt-warn-code set to \"149\", shall
set the MCPTT emergency alert state to \"MPEA 1: no-alert\".
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
SIP re-INVITE request:
1) if the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element
set to a value of \"true\", the IWF performing the participating role shall
set the MCPTT emergency private priority state as \"MEPP 2: in-progress\";
2) if the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element set
to a value of \"true\" and the sent SIP re-INVITE request did not contain an
\ element in the application/vnd.3gpp.mcptt-info+xml MIME body,
the IWF performing the participating role shall set the MCPTT emergency alert
state to \"MPEA 3: emergency-alert-initiated\"; and
3) if the SIP 4xx response, SIP 5xx response or SIP 6xx response did not
contain an application/vnd.3gpp.mcptt-info+xml MIME body, the IWF performing
the participating role shall set the MCPTT emergency private priority state as
\"MEPP 2: in-progress\" and the MCPTT emergency alert (MPEA) state shall
revert to its value prior to entering the current procedure.
NOTE: If the in-progress emergency private priority state cancel request is
rejected, the state of the session does not change, i.e. continues with MCPTT
emergency private call level priority.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in 3GPP TS 24.379 [81],
subclause 6.2.8.3.7 with the IWF acting as the MCPTT client.
###### 111.1.1.2.1.5 Upgrade to MCPTT emergency private call
This subclause is referenced by other subclauses.
To upgrade the ongoing MCPTT private call to an MCPTT emergency private call,
the IWF performing the participating role shall generate a SIP re-INVITE
request as specified in 3GPP TS 24.229 [4], with the clarifications given
below.
1) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.3.2;
2) shall include a Resource-Priority header field and comply with the
procedures in subclause 106.2.8.3.3.
3) shall include an SDP offer with the media parameters as currently
established according to 3GPP TS 24.229 [4];
4) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4; and
5) shall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].
On receiving a SIP 2xx response to the SIP re-INVITE request the IWF
performing the participating role:
1) shall interact with the user plane as specified in 3GPP TS 24.380 [5]; and
2) shall perform the actions specified in 3GPP TS 24.379 [81], subclause
6.2.8.3.4 with the IWF acting as the MCPTT client.
On receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the
SIP re-INVITE request, the IWF performing the participating role shall perform
the actions specified in 3GPP TS 24.379 [81], subclause 6.2.8.3.5 with the IWF
acting as MCPTT client.
On receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing group session, the IWF performing the
participating role shall follow the actions specified in 3GPP TS 24.379 [81],
subclause 6.2.8.3.7 with the IWF acting as the MCPTT client.
#### 111.1.1.3 IWF participating role procedures
###### 111.1.1.3.1.1 On-demand private call
In the present subclause, the IWF performing the participating role initiates
an on-demand private call. The IWF performing the participating role:
1) shall determine the MCPTT ID of the calling user;
NOTE 1: How the IWF determines the MCPTT ID of a user homed in the IWF is out
of scope of the present document.
2) shall determine the public service identity of the controlling MCPTT
function for the private call service associated with the originating user\'s
MCPTT ID identity;
3) shall generate a SIP INVITE request as specified in subclause
111.1.1.2.1.1;
4) shall modify the SIP INVITE as specified in subclause 106.3.2.1.3;
5) shall set the Request-URI to the public service identity of the controlling
MCPTT function hosting the private call service as determined by step 3;
6) shall set the \ element in an
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the
MCPTT ID of the calling user;
7) if the SIP INVITE request contains an emergency indication set to a value
of \"true\", may include a Resource-Priority header field populated with the
values for an emergency call as specified in subclause 106.2.8.1.15;
otherwise, may include a Resource-Priority header field populated with the
values for a normal call as specified in subclause 106.2.8.1.15; and
8) shall forward the SIP INVITE request, according to 3GPP TS 24.229 [4].
Upon receiving a SIP 180 (Ringing) response, the IWF performing the
participating role\'s action are out of scope of the present document.
Upon receiving a SIP 200 (OK) response, the IWF performing the participating
role:
1) shall perform the procedures for receiving a SIP 200 ok as specified in
subclause 111.1.1.2.1.1; and
2) shall start the SIP session timer according to rules and procedures of IETF
RFC 4028 [7].
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request, the IWF performing the participating role shall follow
the procedures for SIP 4xx, SIP 5xx and SIP 6xx responses as specified in
subclause 111.1.1.2.1.1.
Upon receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing session, the IWF performing the
participating role shall follow the procedures for SIP INFO as specified in
subclause 111.1.1.2.1.1.
###### 111.1.1.3.1.3 SIP re-INVITE for MCPTT private call
Upon deciding to send a SIP re-INVITE for an existing private call session,
the IWF performing the participating role:
1) shall determine the MCPTT ID of the calling user;
NOTE 1: How the IWF determines the MCPTT ID of a user homed in the IWF is out
of scope of the present document.
2) if the SIP re-INVITE is to upgrade the call to an emergency call, shall
generate a SIP re-INVITE request as specified in subclause 111.1.1.2.1.5;
3) if the SIP re-INVITE is to cancel the emergency on the call, shall generate
a SIP re-INVITE request as specified in subclause 111.1.1.2.1.4;
4) shall set the \ element in an
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP re-INVITE request to
the MCPTT ID of the calling user homed in the IWF;
NOTE 2: How the IWF determines the MCPTT ID of a user homed in the IWF is out
of scope of the present document.
5) shall, if the SIP re-INVITE is to be sent within an on-demand session
include in the SIP re-INVITE request an SDP containing the current media
parameters used by the existing session;
6) shall include a Resource-Priority header field as specified in subclause
106.2.8.1.15; and
7) shall forward the SIP re-INVITE request, according to 3GPP TS 24.229 [4].
Upon receiving a SIP 200 (OK) response, the IWF performing the participating
role:
1) shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and
2) shall follow the procedures for SIP 200 (OK) response as specified in
subclause 111.1.1.2.1.4 if an emergency is being cancelled in the present
subclause or as specified in subclause 111.1.1.2.1.5 if the call is being
upgraded to emergency in the present subclause. The IWF performing the
participating role shall forward any other SIP response that does not contain
SDP, including any MIME bodies contained therein, along the signalling path to
the originating network according to 3GPP TS 24.229 [4].
On receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to
the SIP INVITE request, the IWF performing the participating role shall follow
the procedures for SIP 4xx, SIP5xx and SIP 6xx responses as specified in
subclause 111.1.1.2.1.4 if an emergency is being cancelled in the present
subclause or as specified in subclause 111.1.1.2.1.5 if the call is being
upgraded to emergency in the present subclause.
Upon receiving a SIP INFO request where the Request-URI contains an MCPTT
session ID identifying an ongoing session, the IWF performing the
participating role shall follow the procedures for SIP INFO as specified in
subclause 111.1.1.2.1.4 if an emergency is being cancelled in the present
subclause or as specified in subclause 111.1.1.2.1.5 if the call is being
upgraded to emergency in the present subclause.
##### 111.1.1.3.2 Terminating procedures
Upon receipt of a \"SIP INVITE request for terminating participating MCPTT
function\", the IWF performing the participating role:
1) shall respond with a SIP 488 (not acceptable here) with a body part as
described in subclause 106.8.2 if the IWF does not support one or more
parameters of the call as described in subclause 106.8.1;
2) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the \"SIP INVITE request for terminating
participating MCPTT function\" with a SIP 500 (Server Internal Error)
response. The IWF may include a Retry-After header field to the SIP 500
(Server Internal Error) response as specified in IETF RFC 3261 [24], and shall
not continue with the rest of the steps;
NOTE: If the received SIP INVITE request contains an emergency indication set
to a value of \"true\", the IWF can choose to accept the request.
3) shall check the presence of the isfocus media feature tag in the URI of the
Contact header field and if it is not present then the IWF shall reject the
request with a SIP 403 (Forbidden) response with the warning text set to \"104
isfocus not assigned\" in a Warning header field as specified in 3GPP TS
24.379 [81], subclause 4.4, and shall not continue with the rest of the steps;
4) shall use the MCPTT ID present in the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request to retrieve the binding between the MCPTT ID and public user identity;
and
5) the IWF may reject the \"SIP INVITE request for terminating participating
MCPTT function\" with a SIP 403 (Forbidden) response including warning text
set to \"127 user not authorised to be called in private call\" in a Warning
header field as specified in 3GPP TS 24.379 [81], subclause 4.4.
The IWF performing the participating role sends the SIP 200 (OK) response to
the originating network:
1) shall generate a SIP 200 (OK) response as described in 3GPP TS 24.379 [81],
subclause 6.3.2.2.4.2;
2) shall include in the SIP 200 (OK) response an SDP answer based on the SDP
answer in the received SIP 200 (OK) response as specified in 3GPP TS 24.379
[81], subclause 6.3.2.2.2.1;
3) shall copy the P-Asserted-Identity header field from the incoming SIP 200
(OK) response to the outgoing SIP 200 (OK) response;
4) shall interact with the media plane as specified in 3GPP TS 24.380 [5]
subclause 6.4; and
5) shall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].
##### 111.1.1.3.3 Receipt of SIP re-INVITE request by terminating
participating function
Upon receipt of a SIP re-INVITE request for an existing MCPTT private call
session the IWF performing the participating role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, shall reject the SIP re-INVITE with a SIP 500 (Server
Internal Error) response. The IWF performing the participating role may
include a Retry-After header field to the SIP 500 (Server Internal Error)
response as specified in IETF RFC 3261 [24] and shall skip the rest of the
steps;
NOTE 1: If the SIP re-INVITE request contains an emergency indication, the IWF
performing the participating role can choose to accept the request.
NOTE 2: As this is the modification of an in-progress MCPTT private call, this
procedure does not attempt modification of the existing answer-mode of the
call.
2) shall generate a SIP 200 (OK) response as described in 3GPP TS 24.379 [81],
subclause 6.3.2.2.4.2, with the IWF acting as the participating MCPTT
function;
3) shall perform the procedures in subclause 111.1.1.2.1.3;
4) shall modify the SDP answer in the received SIP 200 (OK) response as
specified in 3GPP TS 24.379 [81], subclause 6.3.2.2.2.1 with the IWF acting as
the participating function;
5) shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and
6) shall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].
##### 111.1.1.4.1 Originating procedures
This subclause describes the procedures for inviting an MCPTT user to an MCPTT
session. The procedure is initiated by the IWF performing the controlling
role.
The IWF performing the controlling role:
1) shall generate a SIP INVITE request as specified in subclause 106.3.3.1.2;
2) shall set the \ to the calling user\'s MCPTT ID in
the outgoing SIP INVITE;
3) if the received SIP INVITE request contains an authorised request for an
MCPTT emergency private call as determined by subclause 106.3.3.1.13.2:
a) shall set the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body to a value of \"true\";
b) if the received SIP INVITE request contains an alert indication set to a
value of \"true\" and this is an authorised request for an MCPTT emergency
alert meeting the conditions specified in subclause 106.3.3.1.13.1, perform
the procedures specified in subclause 106.3.3.1.12; and
c) if the received SIP INVITE request did not contain an alert indication or
contains an alert indication set to a value of \"true\" and is not an
authorised request for an MCPTT emergency alert meeting the conditions
specified in subclause 106.3.3.1.13.1, shall set the \ element of
the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\";
4) shall copy the MCPTT ID of the called MCPTT user into the \ element in the application/vnd.3gpp.mcptt-info+xml MIME body of the
outgoing SIP INVITE request;
5) shall set the Request-URI to the public service identity of the terminating
participating MCPTT function associated to the MCPTT user to be invited;
NOTE 1: How the IWF performing the controlling role finds the address of the
terminating MCPTT participating function is out of the scope of the current
release.
NOTE 2: The terminating MCPTT user is part of a partner MCPTT system,
therefore the public service identity can identify an entry point in the
partner network that is able to identify the terminating participating MCPTT
function.
6) shall include a Resource-Priority header field populated with the values
for an MCPTT emergency private call as specified in subclause 106.3.3.1.19, if
either of the following conditions is met:
a) if the request is for an MCPTT emergency private call as determined in step
2 above; or
b) the originating user homed in the IWF is in an in-progress emergency
private call state with the targeted MCPTT user;
7) shall include an SDP offer according to 3GPP TS 24.229 [4] with the
clarification given in subclause 106.2.1 and with a media stream of the
offered media-floor control entity and according to the procedures specified
in 3GPP TS 24.379 [81], subclause 6.3.3.1.1 with the IWF acting as the
controlling MCPTT function;
8) shall send the SIP INVITE request towards the core network according to
3GPP TS 24.229 [4]; and
9) shall start a private call timer with a value set to the configured max
private call duration for the user.
Upon receiving SIP 200 (OK) response for the SIP INVITE request the IWF
performing the controlling role:
1) shall cache the contact received in the Contact header field; and
2) shall interact with the media plane as specified in 3GPP TS 24.380 [5].
Upon expiry of the private call timer, the IWF performing the controlling role
shall follow the procedure for releasing private call session as specified in
subclause 111.1.4.4.
##### 111.1.1.4.2 Terminating procedures
In the procedures in this subclause:
1) \ refers to the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body;
2) \ refers to the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body; and
3) \ refers to the \ element of an
application/vnd.3gpp.mcptt-info+xml MIME body.
Upon receipt of a \"SIP INVITE request for controlling MCPTT function of a
private call\", the IWF performing the controlling role:
1) if the \ in the SIP INVITE request is set to \"private\":
a) shall check whether the public service identity contained in the Request-
URI is allocated for private call and perform the actions specified in
subclause 106.3.7.1 if it is not allocated and skip the rest of the steps; and
b) shall perform actions to verify the MCPTT ID of the inviting MCPTT user in
the \ element of the application/vnd.3gpp.mcptt-
info+xml MIME body of the SIP INVITE request, and authorise the request
according to local policy, and if it is not authorised the IWF performing the
controlling role shall return a SIP 403 (Forbidden) response with the warning
text as specified in \"Warning header field\" and skip the rest of the steps;
2) if the incoming SIP INVITE request does not contain an
application/resource-lists MIME body shall reject the SIP INVITE request with
a SIP 403 (Forbidden) response including warning text set to \"145 unable to
determine called party\" in a Warning header field as specified in 3GPP TS
24.379 [81], subclause 4.4, and shall not continue with the rest of the steps;
3) if the \ is set to \"private\" and the application/resource-
lists MIME body contains more than one \ element, shall reject the
\"SIP INVITE request for originating participating MCPTT function\" with a SIP
403 (Forbidden) response including warning text set to \"145 unable to
determine called party\" in a Warning header field as specified in 3GPP TS
24.379 [81], subclause 4.4, and shall not continue with the rest of the steps;
4) shall validate that the received SDP offer includes at least one media
stream for which the media parameters and at least one codec or media format
is acceptable by the IWF performing the controlling role and if not, reject
the request with a SIP 488 (Not Acceptable Here) response and skip the rest of
the steps;
5) if received SIP INVITE request includes an \, shall validate
the request as described in 3GPP TS 24.379 [81], subclause 6.3.3.1.17, with
the IWF acting as the controlling function;
6) if the received SIP INVITE request contains an unauthorised request for an
MCPTT emergency private call as determined by subclause 106.3.3.1.13.2:
a) shall reject the SIP INVITE request with a SIP 403 (Forbidden) response as
specified in subclause 106.3.3.1.14; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
7) if a Resource-Priority header field is included in the received SIP INVITE
request and if the Resource-Priority header field is set to the value
indicated for emergency calls, shall reject the SIP INVITE request with a SIP
403 (Forbidden) response and skip the remaining steps if neither one of the
following conditions are true:
a) the SIP INVITE request does not contain an authorised request for an MCPTT
emergency call as determined in step 4 above; or
b) the originating MCPTT user is not in an in-progress emergency private call
state with the targeted MCPTT user;
8) if:
a) the received SIP INVITE request contains an emergency indication set to a
value of \"true\";
b) the originating MCPTT user is not in an in-progress emergency private call
state with the targeted user homed in the IWF; and
c) if the \ in the SIP INVITE request is set to \"private\";
then:
a) shall cache the information that the MCPTT user has initiated an MCPTT
emergency private call to the targeted user; and
b) shall cache the information that the MCPTT user is in an in-progress
emergency private call state with the targeted user homed in the IWF;
9) shall perform actions as described in 3GPP TS 24.379 [81], subclause
6.3.3.2.2, with the IWF acting as the controlling MCPTT function;
10) shall allocate an MCPTT session identity for the MCPTT session; and
11) shall set up a private call with the targeted user homed in the IWF (the
user whose MCPTT ID is listed in the MIME resource-lists body of received SIP
INVITE request).
NOTE 1: How the IWF sets up calls internally is out of scope of the present
document.
Upon deciding to send a SIP 180 (Ringing) response and if the SIP 180
(Ringing) response or the SIP final response has not yet been sent to the
inviting MCPTT client, the IWF performing the controlling role shall generate
a SIP 180 (Ringing) response to the SIP INVITE request and send the SIP 180
(Ringing) response towards the inviting MCPTT client according to 3GPP TS
24.229 [4].
Upon deciding to accept the call, the IWF performing the controlling role:
1) shall generate a SIP 200 (OK) response to the SIP INVITE request as
specified in the 3GPP TS 24.379 [81] subclause 6.3.3.2.3.2, with the IWF
acting as the MCPTT controlling function, before continuing with the rest of
the steps;
2) shall include in the SIP 200 (OK) response an SDP answer to the SDP offer
in the incoming SIP INVITE request as specified in the 3GPP TS 24.379 [81]
subclause 6.3.3.2.2, with the IWF acting as the controlling MCPTT function;
3) if the received SIP INVITE request contains an alert indication set to a
value of \"true\" and this is an unauthorised request for an MCPTT emergency
alert as specified in subclause 106.3.3.1.13.1, shall include in the SIP 200
(OK) response the warning text set to \"149 SIP INFO request pending\" in a
Warning header field as specified in 3GPP TS 24.379 [81], subclause 4.4, with
the IWF acting as the controlling function;
NOTE 2: This is the case when the MCPTT user\'s request for an MCPTT emergency
private call was granted but the request for the MCPTT emergency alert was
denied.
4) shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and
NOTE 3: Resulting media plane processing is completed before the next step is
performed.
5) shall send a SIP 200 (OK) response towards the inviting MCPTT client
according to 3GPP TS 24.229 [4].
Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, where the SIP 200 (OK) response was sent with a Warning
header field as specified in 3GPP TS 24.379 [81], subclause 4.4, with the IWF
acting as the controlling function with the warning text containing the mcptt-
warn-code set to \"149\", the IWF performing the controlling role shall follow
the procedures in subclause 106.3.3.1.18.
Upon receiving a SIP BYE request from the originating MCPTT client containing
an application/vnd.3gpp.mcptt-info+xml MIME body containing a \ element set to a value of \"authentication of the MIKEY-SAKE I_MESSAGE
failed\", the IWF performing the controlling role shall follow the procedures
in subclause 106.3.3.2.4.
##### 111.1.1.4.3 Receiving a SIP re-INVITE for upgrade to emergency private
call
In the procedures in this subclause:
1) emergency indication in an incoming SIP re-INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) alert indication in an incoming SIP re-INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body.
Upon receiving a SIP re-INVITE request with an emergency indication set to a
value of \"true\", the IWF performing the controlling role:
1) shall validate that the received SDP offer includes at least one media
stream for which the media parameters and at least one codec or media format
is acceptable by the IWF performing the controlling role and if not, reject
the request with a SIP 488 (Not Acceptable Here) response and skip the rest of
the steps;
2) shall validate the request as described in 3GPP TS 24.379 [81], subclause
6.3.3.1.17 with the IWF acting as the MCPTT server;
3) if the SIP re-INVITE request contains an unauthorised request for an MCPTT
emergency private call as determined by subclause 106.3.3.1.13.2:
a) shall reject the SIP INVITE request with a SIP 403 (Forbidden) response as
specified in subclause 106.3.3.1.14; and
b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
4) if the SIP re-INVITE request contains an emergency indication set to a
value of \"true\" and the originating MCPTT user is not in an in-progress
emergency private call state with the targeted user:
a) shall cache the information that the MCPTT user is in an in-progress
emergency private call state with the targeted user; and
b) if the SIP re-INVITE request contains an alert indication set to \"true\",
shall cache the information that the MCPTT user has sent an MCPTT emergency
alert to the targeted user; and
5) shall perform the steps in subclause 111.1.1.3.3 with the IWF performing
the participating role but shall not forward the SIP 200 (OK) response.
If the SIP response has not yet been sent towards the inviting MCPTT client,
the IWF performing the controlling role:
1) shall modify the SIP 200 (OK) response to the SIP re-INVITE request as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.2.3.2 with the IWF acting as
the controlling function before continuing with the rest of the steps;
2) if the received SIP re-INVITE request contains an alert indication set to a
value of \"true\" and this is an unauthorised request for an MCPTT emergency
alert as specified in subclause 106.3.3.1.13.1, shall include in the SIP 200
(OK) response the warning text set to \"149 SIP INFO request pending\" in a
Warning header field as specified in 3GPP TS 24.379 [81], subclause 4.4 with
the IWF acting as the MCPTT server.
NOTE: When a SIP 200 (OK) response sent towards the originator as a response
to a SIP INVITE request that contained authorised request(s) for an MCPTT
emergency private call and optionally an MCPTT emergency alert, the originator
will consider a SIP 200 (OK) response populated in this manner as confirmation
that its request(s) for an upgrade to an MCPTT emergency private call and
optionally an MCPTT emergency alert were accepted by the IWF performing the
controlling role.
3) shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and
4) shall send the SIP 200 (OK) response towards the inviting MCPTT client
according to 3GPP TS 24.229 [4].
Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning
text set to \"149 SIP INFO request pending\" in a Warning header field as
specified in 3GPP TS 24.379 [81], subclause 4.4 with the IWF acting as the
MCPTT server, the IWF performing the controlling role shall follow the
procedures in subclause 106.3.3.1.18.
##### 111.1.1.4.4 Receiving a SIP re-INVITE for cancellation of emergency
private call
In the procedures in this subclause:
1) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) alert indication in an incoming SIP INVITE request refers to the \ element of the application/vnd.3gpp.mcptt-info+xml MIME body.
Upon receiving a SIP re-INVITE request with an emergency indication set to a
value of \"false\", the IWF performing the controlling role:
1) shall validate that the received SDP offer includes at least one media
stream for which the media parameters and at least one codec or media format
is acceptable by the IWF performing the controlling role and if not, reject
the request with a SIP 488 (Not Acceptable Here) response and skip the rest of
the steps;
2) shall validate the request as described in 3GPP TS 24.379 [81], subclause
6.3.3.1.17 with the IWF acting as the controlling function;
3) if the SIP re-INVITE request contains an unauthorised request for an MCPTT
emergency private call cancellation as determined by local policy:
a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response;
b) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 with an \ element set to a value of \"true\";
c) if the SIP re-INVITE request contains an alert indication set to \"false\"
and this is an unauthorised request for an MCPTT emergency alert cancellation
as determined by local policy, shall include in the SIP 403 (Forbidden)
response an application/vnd.3gpp.mcptt-info+xml MIME body with an \
element set to \"true; and
d) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;
4) if the SIP re-INVITE request contains an authorised request for an MCPTT
emergency private call cancellation as determined by subclause 106.3.3.1.13.4:
a) shall clear the cache of the MCPTT ID of the originator of the MCPTT
emergency private call that is no longer in an in-progress emergency private
call state with the targeted user; and
b) if the SIP re-INVITE request contains an alert indication set to \"false\"
and this is an authorised request for an MCPTT emergency alert cancellation
meeting the conditions specified in subclause 106.3.3.1.13.3:
i) if the received SIP re-INVITE request contains an \ element
in the application/vnd.3gpp.mcptt-info+xml MIME body, shall clear the cache of
the MCPTT ID of user identified by the \ element as having an
outstanding MCPTT emergency alert; and
ii) if the received SIP re-INVITE request does not contain an \
element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache
of the MCPTT ID of the sender of the SIP re-INVITE request as having an
outstanding MCPTT emergency alert; and
5) shall perform the steps in subclause 111.1.1.3.3 but shall not forward the
SIP 200 (OK) response.
If the SIP response has not yet been sent towards the inviting MCPTT client,
the IWF performing the controlling role:
1) shall modify the SIP 200 (OK) response to the SIP re-INVITE request as
specified in 3GPP TS 24.379 [81], subclause 6.3.3.2.3.2 with the IWF acting as
the controlling function before continuing with the rest of the steps;
2) if the received SIP re-INVITE request contains an alert indication set to a
value of \"false\" and this is an unauthorised request for an MCPTT emergency
alert cancellation as specified in subclause 106.3.3.1.13.3, shall include in
the SIP 200 (OK) response the warning text set to \"149 SIP INFO request
pending\" in a Warning header field as specified in 3GPP TS 24.379 [81],
subclause 4.4 with the IWF acting as the MCPTT server.
NOTE: When a SIP 200 (OK) response sent towards the originator as a response
to a SIP INVITE request that contained authorised request(s) for an MCPTT
emergency private call cancellation and optionally an MCPTT emergency alert
cancellation, the originator will consider a SIP 200 (OK) response populated
in this manner as confirmation that its request(s) for cancellation of an
MCPTT emergency private call and optionally an MCPTT emergency alert were
accepted by the IWF performing the controlling role.
3) shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and
4) shall send the SIP 200 (OK) response towards the inviting MCPTT client
according to 3GPP TS 24.229 [4].
Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning
text set to \"149 SIP INFO request pending\" in a Warning header field as
specified in 3GPP TS 24.379 [81], subclause 4.4 with the IWF acting as the
MCPTT server, with the IWF acting as the controlling function shall follow the
procedures in subclause 106.3.3.1.18.
##### 111.1.1.4.5 Sending a SIP re-INVITE for upgrade to emergency private
call
This subclause describes the procedures for sending a re-INVITE request to an
MCPTT user in an MCPTT private call for the purpose of upgrading the session
to an emergency private call session. The procedure is initiated by the IWF
performing the controlling role.
The IWF performing the controlling role:
1) shall generate a SIP re-INVITE request as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.1.9, with the IWF acting as the controlling function;
2) if the originating user homed in the IWF is not in an in-progress emergency
private call state with the targeted MCPTT user:
a) shall cache the information that the user homed in the IWF is in an in-
progress emergency private call state with the targeted MCPTT user; and
b) if this is a request for an MCPTT emergency alert, shall cache the
information that the user homed in the IWF has sent an MCPTT emergency alert
to the targeted user;
3) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.3.2;
4) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4 and may include an application/vnd.3gpp.mcptt-location-
info+xml MIME body with a \ element included in the \
root element;
5) shall set the \ element in an
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP re-INVITE request to
the MCPTT ID of the calling user homed in the IWF;
NOTE 1: How the IWF determines the MCPTT ID of a user homed in the IWF is out
of scope of the present document.
6) shall include in the SIP re-INVITE request an SDP containing the current
media parameters used by the existing session;
7) if this is a request for an MCPTT emergency alert:
a) shall determine the value of the user\'s Mission Critical Organization
identity; and.
NOTE 2: How the IWF determines the user\'s Mission Critical Organization
identity is out of scope of the present document;
b) shall include in the \ element containing the \
element containing an \ element set to the value of the user\'s
Mission Critical Organization identity;
8) shall include a Resource-Priority header field populated with the values
for an MCPTT emergency private call as specified in subclause 106.3.3.1.19;
and
9) shall send the SIP re-INVITE request towards the core network according to
3GPP TS 24.229 [4].
Upon receiving SIP 200 (OK) response for the SIP re-INVITE request the IWF
performing the controlling role:
1) shall cache the contact received in the Contact header field;
2) shall interact with the user plane as specified in 3GPP TS 24.380 [5]; and
3) shall perform the actions specified in 3GPP TS 24.379 [81], subclause
6.2.8.3.4 with the IWF acting as the MCPTT client.
##### 111.1.1.4.6 Sending a SIP re-INVITE for cancellation of emergency
private call
This subclause describes the procedures for sending a re-INVITE request to an
MCPTT user in an MCPTT emergency private call for the purpose of downgrading
the session to a normal priority private call session. The procedure is
initiated by the IWF performing the controlling role.
The IWF performing the controlling role:
1) shall generate a SIP re-INVITE request as specified 3GPP TS 24.379 [81],
subclause 6.3.3.1.9, with the IWF acting as the controlling function;
2) shall clear the cache of the MCPTT ID of the originator of the MCPTT
emergency private call that is no longer in an in-progress emergency private
call state with the targeted user;
3) if this is a request for an MCPTT emergency alert cancellation, shall clear
the cache of the MCPTT ID of user homed in the IWF as having an outstanding
MCPTT emergency alert;
4) shall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as
specified in subclause 106.2.8.3.6;
5) if an implicit floor request is required, shall indicate this as specified
in subclause 106.4;
6) shall set the \ element in an
application/vnd.3gpp.mcptt-info+xml MIME body of the SIP re-INVITE request to
the MCPTT ID of the calling user homed in the IWF;
NOTE: How the IWF determines the MCPTT ID of a user homed in the IWF is out of
scope of the present document.
7) shall include in the SIP re-INVITE request an SDP containing the current
media parameters used by the existing session;
Editor\'s note: Determine whether TS 24.379 should set the \ to
\"true\" if it\'s not a valid cancel request. The alert might not be in
effect.
8) shall include a Resource-Priority header field populated with the values
for a normal MCPTT private call as specified in subclause 106.3.3.1.19; and
9) shall send the SIP re-INVITE request towards the core network according to
3GPP TS 24.229 [4].
Upon receiving SIP 200 (OK) response for the SIP re-INVITE request the IWF
performing the controlling role:
1) shall cache the contact received in the Contact header field;
2) shall set the MCPTT emergency private priority state of the MCPTT private
call to \"MEPP 1: no-emergency\";
3) shall set the MCPTT emergency private call state of the call to \"MEPC 1:
emergency-pc-capable\"; and
4) shall interact with the user plane as specified in 3GPP TS 24.380 [5].
#### 111.1.2.3 Participating role procedures
##### 111.1.2.3.1 Originating procedures
To request a private call without floor control, the IWF performing the
participating role shall follow the procedures as specified in subclause
111.1.1.3.1.1 for an on-demand session but with an SDP offer not including
media-level section for media-floor control entity.
##### 111.1.2.3.2 Terminating procedures
Upon receipt of a \"SIP INVITE request for terminating participating MCPTT
function\" for the private call with SDP offer not including media-level
section for media-floor control entity, the IWF performing the participating
role consider it as the request for the private call without floor control and
shall follow the procedures as specified in subclause 111.1.1.3.2.
#### 111.1.2.4 Controlling role procedures
##### 111.1.2.4.1 Originating procedures
The IWF performing the controlling role shall follow the procedures as
specified in subclause 111.1.1.4.1.
### 111.1.3 Ending the private call initiated by a client
#### 111.1.3.2 IWF performing the participating role procedures
##### 111.1.3.2.2 Terminating procedures
###### 111.1.3.2.2.1 Receipt of SIP BYE request for private call on-demand
Upon receiving a SIP BYE request from the controlling MCPTT function, the IWF
performing the participating role shall follow the procedures as specified in
subclause 106.3.2.2.8.1.
#### 111.1.4.2 Receiving a SIP BYE request for private call session
Upon receiving a SIP BYE request for private call session, the IWF shall
follow the procedures as specified in subclause 106.2.6.
###### 111.1.4.3.2.1 Receipt of SIP BYE request for private call on-demand
Upon receiving a SIP BYE request from the controlling MCPTT function, the IWF
performing the participating role shall follow the procedures as specified in
subclause 106.3.2.2.8.1.
#### 111.1.4.4 IWF controlling role procedures
When the MCPTT session for private call needs to be released as specified in
subclause 106.3.8.2 with the IWF acting as the controlling MCPTT function, the
IWF performing the controlling role shall follow the procedures in subclause
106.3.3.1.5.
# 12 Emergency alert
## 12.1 On-network emergency alert
### 112.1.2 IWF performing the participating role procedures
#### 112.1.2.1 IWF to send SIP MESSAGE request for emergency notification
When the IWF performing originating participating role needs to send a SIP
MESSAGE request for emergency notification, the IWF:
1) void _;_
2) if the MCPTT ID for which the SIP MESSAGE is sent is not affiliated with
the MCPTT group as determined by subclause 109.2.2.2.11, shall perform the
actions specified in subclause 109.2.2.2.12 for implicit affiliation;
3) if the actions for implicit affiliation specified in step 2) above were
performed but not successful, shall skip the rest of the steps.
4) shall determine the public service identity of the controlling MCPTT
function associated with the group identity in the received request for
emergency notification;
5) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4]
and IETF RFC 3428 [33];
6) shall set the Request-URI of the outgoing SIP MESSAGE request to the public
service identity of the controlling MCPTT function associated with the MCPTT
group;
7) shall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified
in 3GPP TS 24.379 [81], 3GPP TS 24.379 [81], clause F.1 included in the
outgoing SIP MESSAGE request based on information received from signalling
received from the originating LMR user and its network entities;
8) shall set the \ element of the \ element
containing the \ element to the MCPTT ID of the user homed in
the IWF;
9) if location information is available in the received request for emergency
notification, include an application/vnd.3gpp.mcptt-location-info+xml MIME
body as specified in 3GPP TS 24.379 [81], subclause F.3 in the outgoing SIP
MESSAGE request;
10) shall set the P-Asserted-Identity in the outgoing SIP MESSAGE request to
the public service identity of the IWF; and
11) shall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].
Upon receipt of a SIP 2xx response to the SIP MESSAGE request:
1) if the procedures of subclause 109.2.2.2.12 for implicit affiliation were
performed in the present subclause, shall complete the implicit affiliation by
performing the procedures of subclause 109.2.2.2.13.
Upon receipt of a SIP 4xx, 5xx or 6xx response to the sent SIP MESSAGE request
and if the implicit affiliation procedures of subclause 109.2.2.2.12 were
invoked in the present subclause, the IWF shall perform the procedures of
subclause 109.2.2.2.14.
#### 112.1.2.2 Receipt of a SIP MESSAGE request for emergency notification for
terminating LMR user
In the procedures in this subclause:
1) emergency indication in an incoming SIP MESSAGE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and
2) alert indication in an incoming SIP MESSAGE request refers to the \ element of the application/vnd.3gpp.mcptt-info+xml MIME body.
Upon receipt of a \"SIP MESSAGE requests for emergency notification for
terminating participating MCPTT function\", the IWF performing the
participating role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server
Internal Error) response. The IWF performing the participating role may
include a Retry-After header field to the SIP 500 (Server Internal Error)
response as specified in IETF RFC 3261 [24] and skip the rest of the steps;
NOTE 1: if the SIP MESSAGE request contains an emergency indication set to a
value of \"true\" or an alert indication set to a value of \"true\", the IWF
can by means beyond the scope of this specification choose to accept the
request.
2) shall use the MCPTT ID present in the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE
request to determine the terminating target;
3) if the terminating target is not served by the IWF the IWF shall reject the
SIP MESSAGE request with a SIP 404 (Not Found) response.
NOTE 2: LMR specific signalling is outside the scope of this specification.
The IWF shall generate s SIP 2xx response and follow the procedures specified
in 3GPP TS 24.229 [4].
#### 112.1.2.3 Receipt of a SIP MESSAGE request indicating successful delivery
of emergency notification
Upon receipt of an indication for successful delivery of an emergency
notification the IWF performing the terminating participating role:
1) shall generate an outgoing SIP MESSAGE request to the MCPTT user in
accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:
a) shall include in the SIP MESSAGE request all needed Accept-Contact header
fields and all Reject-Contact header fields, with their feature tags and their
corresponding values along with parameters according to rules and procedures
of IETF RFC 3841 [6];
b) shall set the Request-URI of the outgoing SIP MESSAGE request to the public
user identity associated to user information of the user homed to the IWF;
c) shall generate an application/vnd.3gpp.mcptt-info+xml MIME body based on
signalling received from the LMR system and include in the outgoing SIP
MESSAGE request; and
d) shall set the P-Asserted-Identity header field of the outgoing SIP MESSAGE
request to the public user identity associated with the MCPTT ID of the user
homed in the IWF; and
2) shall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].
Editor\'s Note: it is ffs if both directions are needed.
### 112.1.3 IWF controlling role procedures
#### 112.1.3.1 Handling of a SIP MESSAGE request for emergency notification
Upon receipt of a \"SIP MESSAGE request for emergency notification for
controlling MCPTT function\", the IWF performing the controlling role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server
Internal Error) response. The controlling MCPTT function may include a Retry-
After header field to the SIP 500 (Server Internal Error) response as
specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the
steps;
NOTE: If the SIP MESSAGE request contains an alert indication set to a value
of \"true\", the controlling MCPTT function can, according to local policy,
choose to accept the request.
2) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if an Accept-Contact header field does not include
the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\";
3) if the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of \"false\",
shall perform the procedures specified in subclause 112.1.3.2 and skip the
rest of the steps;
4) if the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of \"true\":
a) if the received SIP MESSAGE request is an unauthorised request for an MCPTT
emergency alert as specified in subclause 106.3.3.1.13.1 shall reject the SIP
MESSAGE request with a SIP 403 (Forbidden) response to the SIP MESSAGE request
as specified in 3GPP TS 24.229 [4] with the following clarifications:
i) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81], clause F.1 of **3GPP TS 24.379 [81]** with the \ element
containing the \ element with the \ element set to a
value of \"false\"; and
ii) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps; and
b) if the received SIP MESSAGE request is an authorised request for an MCPTT
emergency alert as specified in subclause 106.3.3.1.13.1:
i) if the sending MCPTT user identified by the \
element included in the application/vnd.3gpp.mcptt-info+xml MIME body is not
affiliated with the MCPTT group identified by the \ element
of the MIME body as determined by the procedures of 3GPP TS 24.379 [81],
subclause 6.3.6, with the IWF acting as the MCPTT server:
I) shall check if the MCPTT user is eligible to be implicitly affiliated with
the MCPTT group as determined by subclause 109.2.2.3.6;
II) if the MCPTT user is determined not to be eligible to be implicitly
affiliated to the MCPTT group shall reject the SIP MESSAGE request with a SIP
403 (Forbidden) response with the warning text set to \"120 user is not
affiliated to this group\" in a Warning header field as specified in subclause
4.4 and skip the rest of the steps below; or
III) if the procedures of subclause 9.2.2.3.6 determined the MCPTT user to be
eligible to be implicitly affiliated to the MCPTT group shall, perform the
implicit affiliation as specified in subclause 109.2.2.3.7;
ii) for each of the other affiliated members of the group:
A) generate an outgoing SIP MESSAGE request notification of the MCPTT user\'s
emergency alert indication as specified in 3GPP TS 24.379 [81], subclause
6.3.3.1.11, with the IWF acting as the controlling MCPTT function, with the
clarifications of subclause 106.3.3.1.12;
B) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with the \ element set to the value of the \
element in the received SIP MESSAGE request; and
C) send the SIP MESSAGE request according to according to rules and procedures
of 3GPP TS 24.229 [4];
iii) shall generate a SIP 200 (OK) response to the received SIP MESSAGE
request as specified in 3GPP TS 24.229 [4] with the following clarifications:
A) shall cache the information that the MCPTT user has initiated an MCPTT
emergency alert;
iv) shall send the SIP 200 (OK) response to the received SIP MESSAGE according
to rules and procedures of 3GPP TS 24.229 [4].
v) shall generate a SIP MESSAGE request as described in 3GPP TS 24.379 [81],
subclause 6.3.3.1.20, with the IWF acting as the controlling MCPTT function,
to indicate successful receipt of an emergency alert, and shall include in the
application/vnd.3gpp.mcptt-info+xml MIME body:
A) the \ element set to a value of \"true\";
B) the \ element set to a value of true; and
C) the \ element with the MCPTT client ID that was included
in the incoming SIP MESSAGE request; and
vi) shall send the SIP MESSAGE request according to according to rules and
procedures of 3GPP TS 24.229 [4].
Upon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the
controlling MCPTT function shall follow the procedures specified in 3GPP TS
24.229 [4].
If the IWF performing the controlling role needs to generate a SIP MESSAGE
request for emergency notification, the IWF performing the controlling role:
1) shall check if authorization to initiate an emergency alert is provided and
if the IWF allows emergency alerts on the group. If both checks are passed,
the IWF shall continue with the rest of the steps;
2) if the user homed in the IWF is not affiliated with the targeted MCPTT
group:
a) shall check if the user homed in the IWF is eligible to be implicitly
affiliated with the MCPTT group as determined by subclause 109.2.2.3.6;
c) if the user homed in the IWF is determined not to be eligible to be
implicitly affiliated to the MCPTT group shall skip the rest of the steps; or
c) if the user homed in the IWF is eligible to be implicitly affiliated to the
MCPTT group shall, perform the implicit affiliation as specified in subclause
109.2.2.3.7;
Editor's Note: procedures for implicit affiliation as described above require
further clarification.
3) for each of the other affiliated members of the group:
a) shall generate an outgoing SIP MESSAGE request notification of the MCPTT
user\'s emergency alert indication as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.1.11 with the IWF acting as the controlling MCPTT function,
with the clarifications of subclause 106.3.3.1.12;
b) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with the \ element set to a value of \"false\", the IWF
performing the controlling role:
1) if the received SIP MESSAGE request is an unauthorised request for an MCPTT
emergency alert cancellation as specified in subclause 106.3.3.1.13.1:
a) and if the received SIP MESSAGE request does not contain an \ element or is an unauthorised request for an MCPTT emergency call
cancellation as specified in subclause 106.3.3.1.13.4, shall reject the SIP
MESSAGE request with a SIP 403 (Forbidden) response to the SIP MESSAGE request
as specified in 3GPP TS 24.229 [4] with the following clarifications:
i) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in 3GPP TS 24.379
[81] clause F.1 with the \ element containing the \
element with the \ element set to a value of \"true\";
ii) if the received SIP MESSAGE request contains an \ element
of the \ element set to a value of \"false\" and if the in-progress
emergency state of the group is set to a value of \"true\" and this is an
unauthorised request for an MCPTT emergency call cancellation as determined in
step i) above, shall include an \ element set to a value of
\"true\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP 403
(Forbidden) response; and
iii) shall send the SIP 403 (Forbidden) response according to rules and
procedures of 3GPP TS 24.229 [4] and skip the rest of the steps; and
b) and if the received SIP MESSAGE request contains an \
element and is an authorised request for an MCPTT emergency call cancellation
as specified in 3GPP TS 24.379 [81] subclause 106.3.3.1.13.4 and the in-
progress emergency state of the MCPTT group is set to a value of \"true\":
i) shall set the in-progress emergency state of the group to a value of
\"false\";
ii) shall clear the cache of the MCPTT ID of the MCPTT user that triggered the
setting of the in-progress emergency state of the MCPTT group to \"true\";
iii) shall generate SIP re-INVITE request to the other affiliated and joined
members of the MCPTT group as specified in subclause 106.3.3.1.6. The IWF
performing the controlling role:
A) for each affiliated and joined member shall send the SIP re-INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) upon receiving a SIP 200 (OK) response to the SIP re-INVITE request shall
interact with the media plane as specified in 3GPP TS 24.380 [5];
iv) for each of the affiliated but not joined members of the group:
A) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s emergency call as specified in 3GPP TS 24.379 [81], subclause
6.3.3.1.11 with the IWF acting as the controlling MCPTT function;
B) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with the \ element set to the value of the \
element in the received SIP MESSAGE request; and
C) shall include an \ element set to a value of \"false\" in
the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request;
v) shall generate a SIP 200 (OK) response to the received SIP MESSAGE request
as specified in 3GPP TS 24.229 [4];
vi) shall send the SIP 200 (OK) response to the received SIP MESSAGE as
specified in 3GPP TS 24.229 [4] and skip the rest of the steps;
vii) shall generate a SIP MESSAGE request as described in 3GPP TS 24.379 [81],
subclause 6.3.3.1.20 with the IWF acting as the controlling MCPTT function to
indicate successful receipt of the request for emergency alert cancellation
viii) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body of
the SIP MESSAGE request:
A) the \ element set to a value of \"true\";
B) the \ element set to a value of true;
C) the \ element set to a value of \"false\"; and
D) the \ element with the MCPTT client ID that was included
in the incoming SIP MESSAGE request; and
ix) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [4]; and
2) if the received SIP MESSAGE request is an authorised request for an MCPTT
emergency alert cancellation as specified in subclause 106.3.3.1.13.1:
a) if the received SIP MESSAGE request contains an \ element in
the application/vnd.3gpp.mcptt-info+xml MIME body, shall clear the cache of
the MCPTT ID of the MCPTT user identified by the \ element as
having an outstanding MCPTT emergency alert;
b) if the received SIP MESSAGE request does not contain an \
element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache
of the MCPTT ID of the sender of the SIP MESSAGE request as having an
outstanding MCPTT emergency alert;
Editor's Note: Handling of states in the IWF requires further study.
c) if the received SIP MESSAGE request does not contain an \
element or is an unauthorised request for an MCPTT emergency call cancellation
as specified in subclause 106.3.3.1.13.4, for each of the affiliated but not
joined members of the group:
i) shall generate a SIP MESSAGE request notification of the cancellation of
the MCPTT user\'s emergency alert as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.1.11 with the IWF acting as the controlling MCPTT function;
ii) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with
the \ element containing the \ element with the
\ element set to the value of the \ element in the received SIP MESSAGE request;
iii) if the received SIP MESSAGE request contains an \ element
in the application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the contents
of the received \ element to an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request;
iv) shall include an \ element set to a value of \"false\" in the
application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request; and
v) send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];
d) if the received SIP MESSAGE request contains an \ element
and is an authorised request for an MCPTT emergency call cancellation as
specified in subclause 106.3.3.1.13.4 and the in-progress emergency state of
the MCPTT group is set to a value of \"true\":
i) shall set the in-progress emergency state of the group to a value of
\"false\";
ii) cache the information that the MCPTT user has cancelled the outstanding
in-progress emergency state of the group;
iii) shall generate SIP re-INVITES requests to the other affiliated and joined
members of the MCPTT group as specified in subclause 106.3.3.1.6. The MCPTT
controlling function:
A) for each affiliated and joined member shall send the SIP re-INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE request shall
interact with the media plane as specified in 3GPP TS 24.380 [5]; and
iv) for each of the affiliated but not joined members of the group shall:
A) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s emergency call as specified in 3GPP TS 24.379 [81], subclause
6.3.3.1.11 with the IWF acting as the controlling MCPTT function;
B) include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with the \ element set to the value of the \
element in the received SIP MESSAGE request;
C) if the received SIP MESSAGE request contains an \ element in
the application/vnd.3gpp.mcptt-info+xml MIME body, copy the contents of the
received \ element to an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request;
D) include in the application/vnd.3gpp.mcptt-info+xml MIME body an \ element set to a value of \"false\"; and
E) shall include an \ element set to a value of \"false\" in
the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request;
e) shall generate a SIP 200 (OK) response to the received SIP MESSAGE request
as specified in 3GPP TS 24.229 [4];
f) shall send the SIP 200 (OK) response to the received SIP MESSAGE as
specified in 3GPP TS 24.229 [4].
g) shall generate a SIP MESSAGE request as described in 3GPP TS 24.379 [81],
subclause 6.3.3.1.20 with the IWF acting as the controlling MCPTT function to
indicate successful receipt of the request for emergency alert cancellation;
h) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body, the
\ element set to a value of \"false\" and the \ set
to \"true\";
i) shall populate the \ element with the MCPTT client ID that
was included in the incoming SIP MESSAGE request;
j) if the received SIP MESSAGE request contains an \ element of
the \ element set to a value of \"false\":
i) if this is an authorised request for an MCPTT emergency call cancellation
as specified in subclause 106.3.3.1.13.4, shall include an \
element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml
MIME body in the outgoing SIP MESSAGE request; and
B) otherwise, if this is an unauthorised request for an MCPTT emergency call
cancellation as specified in subclause 106.3.3.1.13.4, and the in-progress
emergency state of the group is set to a value of \"true\", shall include an
\ element set to a value of \"true\" in the
application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request; and
k) shall send the SIP MESSAGE request according to the rules and procedures of
3GPP TS 24.229 [4].
Upon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the
IWF performing the controlling role shall follow the procedures specified in
3GPP TS 24.229 [4].
If the IWF performing the controlling role needs to generate a SIP MESSAGE for
emergency alert cancellation, the IWF performing the controlling role:
1) if the request for emergency alert a cancellation is an unauthorised
request for an MCPTT emergency alert cancellation:
a) and if the request does not contain an \ element or is an
unauthorised request for an MCPTT emergency call cancellation, shall skip the
rest of the steps; and
b) if the request contains an \ element and is an authorised
request for an MCPTT emergency call cancellation and the in-progress emergency
state of the MCPTT group is set to a value of \"true\":
Editor's Note: it is FFS how the IWF determines the in-progress emergency
state of the MCPTT group.
i) shall set the in-progress emergency state of the group to a value of
\"false\";
ii) shall generate SIP re-INVITE requests to the other affiliated and joined
members of the MCPTT group as specified in subclause 106.3.3.1.6. The IWF
performing the controlling function:
A) for each affiliated and joined member shall send the SIP re-INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE shall interact
with the media plane as specified in 3GPP TS 24.380 [5];
iii) for each of the affiliated but not joined members of the group shall:
A) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s emergency call as specified in 3GPP TS 24.379 [81], subclause
6.3.3.1.11 with the IWF acting as the controlling MCPTT function;
B) shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with the \ element set to the MCPTT ID of the user homed in the IWF; and
C) shall include an \ element set to a value of \"false\" in
the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request;
Editor's Note: the need for sending of MESSAGE described in steps above
requires further study.
2) if the request is an authorised request for an MCPTT emergency alert
cancellation:
a) if the request does not contain an \ element or is an
unauthorised request for an MCPTT emergency call cancellation, for each of the
affiliated but not joined members of the group:
i) shall generate a SIP MESSAGE request notification of the cancellation of
the MCPTT user\'s emergency alert as specified in 3GPP TS 24.379 [81],
subclause 6.3.3.1.11 with the IWF acting as the controlling MCPTT function;
ii) shall include an \ element in the
application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request set to the MCPTT ID of the user homed in the IWF;
iii) shall include an \ element set to a value of \"false\" in the
application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request; and
iv) shall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];
b) if the request contains an \ element and is an authorised
request for an MCPTT emergency call cancellation.4 and the in-progress
emergency state of the MCPTT group is set to a value of \"true\":
i) shall set the in-progress emergency state of the group to a value of
\"false\";
ii) cache the information that the MCPTT user has cancelled the outstanding
in-progress emergency state of the group;
iii) shall generate SIP re-INVITES requests to the other affiliated and joined
members of the MCPTT group as specified in subclause 106.3.3.1.6. The IWF
performing the controlling function:
A) for each affiliated and joined member shall send the SIP re-INVITE request
towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and
B) Upon receiving a SIP 200 (OK) response to the SIP re-INVITE request shall
interact with the media plane as specified in 3GPP TS 24.380 [5]; and
iv) for each of the affiliated but not joined members of the group shall:
A) generate a SIP MESSAGE request notification of the cancellation of the
MCPTT user\'s emergency call as specified in 3GPP TS 24.379 [81], subclause
6.3.3.1.11 with the IWF acting as the controlling MCPTT function;
B) include in the application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element containing the \ element with the \ element set to MCPTT ID of the user home in the IWF;
C) include in the application/vnd.3gpp.mcptt-info+xml MIME body an \ element set to a value of \"false\"; and
D) shall include an \ element set to a value of \"false\" in
the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE
request;
c) if this is an unauthorised request for an MCPTT emergency call
cancellation, and the in-progress emergency state of the group is set to a
value of \"true\", shall include an \ element set to a value of
\"true\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing
SIP MESSAGE request; and
d) shall send the SIP MESSAGE requests according to the rules and procedures
of 3GPP TS 24.229 [4].
Upon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the
IWF performing the controlling role shall follow the procedures specified in
3GPP TS 24.229 [4].
# 113 Location procedures
## 113.1 General
It is outside the scope of this specification how the IWF performing the
participating role configures a participant homed in the IWF to provide
location information or how the IWF performing the participating role
explicitly request a participant homed in the IWF to provide location
information.
## 113.2 IWF participating role location procedures
### 113.2.1 General
The IWF performing participating role provides procedures to send a location
information report from a participant homed in the IWF.
### 113.2.2 Location reporting configuration
Procedures for configuration of location reporting of participants homed in
the IWF are out of scope of the current document.
### 113.2.3 Location reporting request
Procedures for requesting participants homed in the IWF to report location
information are out of scope of the current document.
### 113.2.4 Location information report
The IWF performing the participating role uses location information of users
homed in the IWF as appropriate.
# 304 General
## 304.1 MCData overview
The MCData service supports communication between a pair of users (i.e. one-
to-one communication) and several users (i.e. group communication), where each
user has the ability to share data using Short Data Service (SDS.
The present document provides the signalling control protocol enhancements to
support the MCData architectural procedures for MCData SDS interworking
between onâ€‘network Mission Critical users and users homed in the IWF, as
specified in 3GPP TS 23.283[80].
The present document makes use of the existing IMS procedures specified in
3GPP TS 24.229 [4].
The procedures in this document allow an onâ€‘network MCData user to:
\- send a standalone SDS using signalling control plane to a user homed in the
IWF or to a group including at least one user homed in the IWF; and
\- send a standalone SDS using media plane to a user homed in the IWF or to a
group including at least one user homed in the IWF.
The procedures in this document allow a user homed in the IWF to:
\- send a standalone SDS using signalling control plane to an onâ€‘network
MCData user or to a group of onâ€‘network MCData users; and
\- send a standalone SDS using media plane to an onâ€‘network MCData user or to
a group of onâ€‘network MCData users.
The present document does not support the interworking of SDS sessions with
users homed in the IWF.
The MCData procedures provided by the present document refer to:
\- the media plane procedures defined in 3GPP TS 24.582 [85]
\- the group management procedures defined in 3GPP TS 24.481 [31];
\- the identity management procedures defined in 3GPP TS 24.482 [49]; and
\- the security procedures defined in 3GPP TS 33.180 [78].
The following procedures are provided within this document:
\- common procedures are specified in clause 306;
\- procedures for registration in the IM CN subsystem and service
authorisation are specified in clause 307;
\- procedures for affiliation are specified in clause 308;
\- procedures for SDS are specified in clause 309;
\- procedures for transmission and reception control are specified in clause
311;
\- procedures for dispositions and notifications are specified in clause 312;
and
\- procedures for communication release are specified in clause 313.
Editor\'s note: check the above list before completion of the present
document.
The user homed in the IWF obtains access to the MCData service via the IWF.
The procedures by which the user homed in the IWF accesses the IWF are outside
the scope of the present document.
## 304.2 Identity, URI and address assignments
### 304.2.1 Public Service identities
In order to support MCData interworking with LMR, the following URI and
address assignments are assumed:
1) the IWF performing the participating role is configured to be reachable
using the public service identity of the IWF performing the participating role
that is serving the user homed in the IWF.
### 304.2.3 MCData client ID
The MCData client ID is described in 3GPP TS 24.282 [82] subclause 4.8.
## 304.5 MCData Protocol
Subclause 315 describes the TLV based message formats used in MCData
communications. Annex I of 3GPP TS 24.379 [81] describes the standard format
of the messages and the encoding rules for each type of information element.
## 304.6 Protection of sensitive XML application data
In certain deployments, for example, in the case that the MCData operator uses
the underlying SIP core infrastructure from the carrier operator, the MCData
operator can prevent certain sensitive application data from being visible in
the clear to the SIP layer. The following data are classed as sensitive
application data:
\- MCData ID;
\- MCData group ID;
\- alert indicator;
\- access token (containing the MCData ID); and
\- MCData client ID.
The above data is transported as XML content in SIP messages. in XML elements
or XML attributes.
NOTE: SIP layer protection terminates at the IWF.
Data is transported in attributes in the following circumstances in the
procedures in the present document:
\- an MCData ID, an MCData Group ID, and an MCData client ID in an XML
document published in SIP PUBLISH request for affiliation according to IETF
RFC 3856 [51];
\- an MCData ID or an MCData Group ID in XML document notified in a SIP NOTIFY
request for affiliation according to IETF RFC 3856 [51]; and
\- an MCData ID in application/resource-lists+xml document included in a SIP
MESSAGE or SIP INVITE request for one-to-one SDS, according to IETF RFC 5366
[20];
3GPP TS 33.180 [78] describes a method to provide confidentiality protection
of sensitive application data in elements by using XML encryption (i.e.
xmlenc) and in attributes by using an attribute confidentiality protection
scheme described in 3GPP TS 24.282 [82] subclause 6.6.2.3. Integrity
protection can also be provided by using XML signatures (i.e. xmlsig).
Protection of the data relies on a shared XML protection key (XPK) used to
encrypt and sign data:
\- between the MCData client and the MCData server, the XPK is a client-server
key (CSK); and
\- between MCData servers and an IWF, the XPK is a signalling protection key
(SPK).
The CSK (XPK) and a key-id CSK-ID (XPK-ID) are generated from keying material
provided by the key management server. Identity based public key encryption
based on MIKEY-SAKKE is used to transport the CSK between SIP end-points. The
encrypted CSK is transported from the MCData client to the MCData server when
the MCData client performs service authorisation as described in 3GPP TS
24.282 [82] clause 7 and is also used during service authorisation to protect
the access token.
The SPK (XPK) and a key-id SPK-ID (XPK-ID) are directly provisioned in the
MCData server and IWF.
Configuration in the MCData client, IWF and MCData server is used to determine
whether one or both of confidentiality protection and integrity protection are
required.
3GPP TS 24.282 [82] subclause 4.6 provides examples of confidentiality and
integrity protection applied to application data.
## 304.7 Protection of TLV signalling and media content
The protection of TLV signalling and media content is based on 3GPP MCData
security solution as defined in 3GPP TS 33.180 [78].
For different security requirements of different information elements of a
MCData message, the information elements of MCData messages are bifurcated in
the following components:
\- **MCData** **Data signalling payload** : information elements necessary for
identification and management of the MCData messages e.g. conversation
identifiers, session identifiers, transaction identifiers, disposition
requests, etc. This payload is confidentiality and integrity protected between
the MCData Client and the MCData server and between the MCData server and the
IWF.
\- **MCData** **Data payload** : the actual user payload for MCData user or
application consumption. This payload is confidentiality and integrity
protected between the MCData client and the IWF.
An SDS message can be sent over both signalling plane and media plane. When an
SDS message is sent using the signalling plane, the body included in the SIP
MESSAGE request, which carries MCData Data signalling payload, is protected
separately between each pair of entities if protection is applied. On the
other hand, the body included in the SIP MESSAGE request which carries the
MCData data payload is protected between the MC Data client and the IWF. The
procedures for the protection of the SDS messages over the signalling plane
are specified in 3GPP TS 24.282 [82]. Protection of SDS messages over the
media control plane is specified in 3GPP TS 24.582 [85].
NOTE: The method by which SDS messages are protected between the IWF and the
user homed in the IWF is outside the scope of the present document.
## 304.9 Warning Header Field
### 304.9.1 General
An IWF can include a free text string in a SIP response to a SIP request. When
the IWF includes a free text string in a response to a SIP MESSAGE or SIP
INVITE request the free text string is included in a Warning header field as
specified in IETF RFC 3261 [24]. The IWF includes the Warning code set to 399
(miscellaneous warning) and includes the host name set to the host name of the
IWF.
EXAMPLE: Warning: 399 TETRA.gov.uk \"200 user not authorised to transmit
data\"
### 304.9.2 Warning texts
The warning texts are specified in 3GPP TS 24.282 [82] subclause 4.9.2.
# 305 Functional entities
Editor\'s Note: the parent subclause of this section is 3GPP TS 24.282
subclause 5.
## 305.1 Introduction
This clause associates the functional entities with the MCData roles described
in the stage 2 architecture document (see 3GPP TS 23.282 [84]).
## 305.3 IWF
### 305.3.1 General
When referring to the procedures in the present document for the IWF acting as
a participating MCData server for the user homed in the IWF, the term, \"IWF
performing the participating role\" is used.
When referring to the procedures in the present document for the IWF acting as
a controlling MCData server for the user homed in the IWF, the term \"IWF
performing the controlling role\" is used.
An IWF can perform the controlling role for short data service as defined in
3GPP TS 23.282 [84].
An IWF can perform the participating role for short data service as defined in
3GPP TS 23.282 [84].
An IWF in the participating role can serve an originating user homed in the
IWF.
An IWF in the participating role can serve a terminating user homed in the
IWF.
The same IWF can perform the participating role and controlling role for the
same group short data service transaction.
To be compliant with the procedures in the present document, an IWF shall:
\- support the MCData server procedures defined in 3GPP TS 23.282 [84];
\- implement the role of an AS performing 3rd party call control acting as a
routing B2BUA as defined in 3GPP TS 24.229 [4];
\- generate SDP offer and SDP answer in accordance with 3GPP TS 24.229 [4] and
3GPP TS 24.282 [82] subclause 9.2.3 and 3GPP TS 24.282 [82] subclause 9.2.4
for short data service;
\- for registration and service authorisation, implement the procedures
specified in 3GPP TS 24.282 [82] subclause 7.3;
\- for affiliation, implement the procedures specified in 3GPP TS 24.282 [82]
subclause 9.2.2;
\- for short data service (SDS) functionality implement the MCData server
procedures specified in:
a) 3GPP TS 24.282 [82] subclause 9.2; and
b) clause 6 of 3GPP TS 24.582 [85];
\- for transmission and reception control functionality implement the MCData
server procedures specified in 3GPP TS 24.282 [82] clause 11;
\- for disposition notification functionality implement the MCData server
procedures specified in 3GPP TS 24.282 [82] clause 12.2; and
\- for communication release functionality implement the MCData server
procedures specified in 3GPP TS 24.282 [82] clause 13.2.
To be compliant with the procedures for confidentiality protection of XML
elements in the present document, the IWF shall implement the procedures
specified in 3GPP TS 24.282 [82] subclause 6.5.2.
To be compliant with the procedures for integrity protection of XML MIME
bodies in the present document, the IWF shall implement the procedures
specified in 3GPP TS 24.282 [82] subclause 6.5.3.
### 305.3.1A SIP failure case
When initiating a SIP failure response to any received SIP request, depending
on operator policy, the IWF may insert a SIP Response-Source header field in
accordance with the procedures in subclause 5.7.1.0 of 3GPP TS 24.229 [4],
where the \"role\" header field parameter is set to \"pf-mcdata-server\" or
\"cf-mcdata-server\" depending on the current role endorsed by the MCData
server.
# 306 IWF MCData procedures
## 306.1 Introduction
This clause describes the IWF procedures for MCData.
### 306.2.2 MCData conversation items
#### 306.2.2.1 IWF generating an SDS Message
In order to generate an SDS message, the IWF acting on behalf of a user homed
in the IWF:
1) shall generate an SDS SIGNALLING PAYLOAD message as specified in subclause
315.1.2;
2) shall generate a DATA PAYLOAD message as specified in subclause 315.1.4;
3) shall include in the SIP request, the SDS SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [82] subclause E.1; and
4) shall include in the SIP request, the DATA PAYLOAD message in an
application/vnd.3gpp.mcdata-payload MIME body as specified in 3GPP TS 24.282
[82] subclause E.2.
Editor's Note: The order of the above items, currently aligned with 3GPP TS
24.282, should be reconsidered when the work moves to normative phase.
When generating an SDS SIGNALLING PAYLOAD message as specified in subclause
315.1.2, the IWF acting for a user homed in the IWF:
1) shall set the Date and time IE to the current time as specified in 3GPP TS
24.282 [82] subclause 15.2.8;
2) if the SDS message starts a new conversation, shall set the Conversation ID
IE to a newly generated Conversation ID value as specified in subclause
315.2.9;
3) if the SDS message continues an existing unfinished conversation, shall, if
available, set the Conversation ID IE to the Conversation ID value of the
existing conversation as specified in subclause 315.2.9, or shall set the
Conversation ID IE to the Conversation ID value \"UNKNOWN CONVERSATION\" as
specified in subclause 315.2.9;
4) shall set the Message ID IE to a newly generated Message ID value as
specified in subclause 315.2.10;
5) if the SDS message is in reply to a previously received SDS message shall
include the InReplyTo message ID IE with the Message ID value:
i) set to the Message ID value in the previously received SDS message;
ii) set to the Message ID value \"LMR MESSAGE ID\"as specified in subclause
315.2.10, with the value of octet 16 of the LMR MESSAGE ID set to the value of
octet 16 of the Message ID in the previously received SDS message; or
iii) set to the Message ID value \"UNKNOWN ORIGINATING MESSAGE ID\" as
specified in subclause 315.2.10
6) if the SDS message is for user consumption, shall not include an
Application ID IE as specified in 3GPP TS 24.282 [82] subclause 15.2.7 and
shall not include an Extended application ID IE as specified in 3GPP TS 24.282
[82] subclause 15.2.24;
7) if the SDS message is intended for an application on the terminating MCData
client, shall include:
a) an Application ID IE with a Application ID value representing the intended
application as specified in 3GPP TS 24.282 [82] subclause 15.2.7; or
b) an Extended application ID IE with an Extended application ID value
representing the intended application as specified in 3GPP TS 24.282 [82]
subclause 15.2.24;
NOTE: The value chosen for the Application ID value is decided by the mission
critical organisation.
8) if only a delivery disposition notification is required shall include a SDS
disposition request type IE set to \"DELIVERY\" as specified in 3GPP TS 24.282
[82] subclause 15.2.3;
9) if only a read disposition notification is required shall include a SDS
disposition request type IE set to \"READ\" as specified in 3GPP TS 24.282
[82] subclause 15.2.3; and
10) if both a delivery and read disposition notification is required shall
include a SDS disposition request type IE set to \"DELIVERY AND READ\" as
specified in 3GPP TS 24.282 [82] subclause 15.2.3.
When generating an DATA PAYLOAD message for SDS as specified in subclause
315.1.4, the IWF acting on behalf of a user homed in the IWF:
1) shall set the Number of payloads IE to the number of Payload IEs that needs
to be encoded, as specified in 3GPP TS 24.282 [82] subclause 15.2.12;
2) if end-to-end security is required for a one-to-one communication, shall
include the Security parameters and Payload IE with security parameters as
described in 3GPP TS 33.180 [78]. Otherwise, if end-to-end security is not
required for a one-to-one communication, shall include the Payload IE as
specified in subclause 315.1.4; and
3) for each Payload IE included:
a) if the payload is text, shall set the Payload content type as \"TEXT\" as
specified in subclause 315.2.13;
b) if the payload is binary data, shall set the Payload content type as
\"BINARY\" as specified in subclause 315.2.13;
c) if the payload is hyperlinks, shall set the Payload content type as
\"HYPERLINKS\" as specified in subclause 315.2.13;
d) if the payload is location, shall set the Payload content type as
\"LOCATION\" as specified in subclause 315.2.13;
e) if payload is enhanced status for a group, shall set the Payload content
type as "ENHANCED STATUS" as specified in subclause 315.2.13;
f) if payload is a native LMR message, shall set the Payload content type as
"LMR MESSAGE" as specified in subclause 315.2.13; and
g) shall include the data to be sent in the Payload data.
### 306.2.3 Disposition Notifications
#### 306.2.3.1 Generating an SDS Notification
In order to generate an SDS notification, the IWF performing the participating
role:
1) shall generate an SDS NOTIFICATION message as specified in clause 315.1.5;
and
2) shall include in the SIP request, the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in clause E.1.
When generating an SDS NOTIFICATION message as specified in clause 315.1.5,
the IWF performing the participating role:
1) if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\" as specified in clause 315.2.5;
2) if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\" as specified in clause 315.2.5;
3) if sending a delivered and read notification, shall set the SDS disposition
notification type IE as \"DELIVERED AND READ\" as specified in clause 315.2.5;
4) if the SDS message could not be delivered, shall set the SDS disposition
notification type IE as \"UNDELIVERED\" as specified in clause 315.2.5;
5) shall set the Date and time IE to the current time to as specified in
clause 315.2.8;
6) shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message as specified in clause 315.2.9;
7) shall set the Message ID to the value of the Message ID that was received
in the SDS message as specified in clause 315.2.10;
8) if the SDS message was destined for the user, shall not include an
Application ID IE (as specified in clause 315.2.7) and shall not include an
Extended application ID IE (as specified in clause 315.2.24); and
9) if the SDS message was destined for an application, shall include:
a) an Application ID IE set to the value of the Application ID that was
included in the SDS message as specified in clause 315.2.3; or
b) an Extended application ID IE set to the value of the Extended application
ID that was included in the SDS message as specified in clause 315.2.24.
### 306.2.4 Sending SIP requests and receiving SIP responses
#### 306.2.4.1 Generating a SIP MESSAGE request towards the controlling MCData
function
This clause is referenced from other procedures.
In a SIP MESSAGE request, the IWF performing the participating role:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [6];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [6]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header
field according to IETF RFC 6050 [9] in the SIP MESSAGE request;
2) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [4]; and
3) shall set the Request-URI to the public service identity identifying the
IWF performing the participating role.
## 306.3 IWF performing MCData server role procedures
### 306.3.0 Introduction
The IWF operates as an MCData server when exchanging SDS messages with MCData
servers within the MC system. It does not communicate directly with MCData
clients. It does not support the FD service. Subclause 306.3 and its
subclauses describe the IWF operating as a controlling and participating
MCData server.
### 306.3.1 Distinction of requests at the IWF
#### 306.3.1.1 SIP MESSAGE request
The IWF shall; perform the role of an MCData server in distinguishing between
the following SIP MESSAGE requests for originations and terminations from 3GPP
TS 24.282 [82] subclause 6.3.1.1. as described below:
\- SIP MESSAGE request routed to the terminating participating MCData function
with an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\", and an
ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in a P-Asserted-
Service header field. Such requests are known as \"SIP MESSAGE request for
standalone SDS for terminating participating MCData function\";
\- SIP MESSAGE request routed to an MCData server with an Accept-Contact
header field with the g.3gpp.icsi-ref media feature tag containing the value
of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\", an ICSI value
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in a P-Asserted-Service header
field, and with an application/vnd.3gpp.mcdata-signalling MIME body containing
an SDS NOTIFICATION message Such requests are known as \"SIP MESSAGE request
for SDS disposition notification for MCData server\"; and
\- SIP MESSAGE request routed to the controlling MCData function with an
Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\", and an
ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in a P-Asserted-
Service header field. Such requests are known as \"SIP MESSAGE request for
standalone SDS for controlling MCData function\".
If a SIP MESSAGE request is received at the IWF that is not in accordance with
the SIP MESSAGE requests listed above, then the IWF shall reject the SIP
MESSAGE request with a SIP 403 (Forbidden) response.
#### 306.3.1.2 SIP INVITE request
The IWF shall; perform the role of an MCData server in distinguishing between
the following SIP INVITE requests for originations and terminations from 3GPP
TS 24.282 [82] subclause 6.3.1.2. as described below:
\- SIP INVITE request routed to the terminating participating MCData function
with an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\", and an
ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in a P-Asserted-
Service header field and a \ element set to \"one-to-one-sds\"
or \"group-sds\" contained in an application/vnd.3gpp.mcdata-info+xml MIME
body. Such requests are known as \"SIP INVITE request for standalone SDS over
media plane for terminating participating MCData function\";
\- SIP INVITE request routed to the controlling MCData function with an
Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\", and an
ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in a P-Asserted-
Service header field and a \ element set to \"one-to-one-sds\"
or \"group-sds\" contained in an application/vnd.3gpp.mcdata-info+xml MIME
body. Such requests are known as \"SIP INVITE request for controlling MCData
function for standalone SDS over media plane\";
\- SIP INVITE request routed to the terminating participating MCData function
with an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\", and an
ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in a P-Asserted-
Service header field and a \ element set to \"one-to-one-sds-
session\" or \"group-sds-session\" contained in an
application/vnd.3gpp.mcdata-info+xml MIME body. Such requests are known as
\"SIP INVITE request for SDS session for terminating participating MCData
function\"; and
\- SIP INVITE request routed to the controlling MCData function with an
Accept-Contact header field with the g.3gpp.icsi-ref media feature tag
containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\", and an
ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in a P-Asserted-
Service header field and a \ element set to \"one-to-one-sds-
session\" or \"group-sds-session\" contained in an
application/vnd.3gpp.mcdata-info+xml MIME body. Such requests are known as
\"SIP INVITE request for controlling MCData function for SDS session\".
### 306.3.2 Sending SIP requests and receiving SIP responses
#### 306.3.2.1 Generating a SIP MESSAGE request towards the terminating MCData
client
This subclause is referenced from other procedures. Refer to 3GPP TS 24.282
[82] subclause 6.3.2.1.
### 306.3.3 Retrieving a group document
How an IWF performing the controlling role of a group obtains information
about the group is out of scope of the present document.
NOTE: During the group regrouping operation as specified in 3GPP TS 24.481
[31], the IWF performing the controlling role is notified of the constituent
MCData group identities associated with the TGI.
### 306.3.4 Determining targeted group members for MCData communications
The IWF shall only send MCData messages to affiliated group members.
The IWF determines whether a user is affiliated to a group by following the
procedures in subclause 306.3.5.
The IWF performs the affiliation check in subclause 306.3.5 on each entry
contained in the \ element of the group document.
NOTE: How the IWF obtains the group document is out scope of the present
document.
### 306.3.5 Affiliation check
The IWF shall determine that the MCData user, with MCData ID, is affiliated to
the MCData group, with MCData Group ID, at the MCData client, with MCData
client ID, if the elements, as described in TS 24.282 [82] subclause 8.3.3.2,
exist with their expected values, as below:
1) an MCData group information entry with MCData group ID same as the MCData
group ID under consideration;
2) in the MCData group information entry found in 1, an MCData user
information entry with the MCData ID same as the MCData ID under
consideration;
3) in the MCData user information entry found in 2, an MCData client
information entry with MCData Client ID same as the MCData client ID under
consideration; and
4) in the MCData user information entry found in 2, an expiration time, which
has not expired.
NOTE: How the IWF determines which users homed in the IWF are affiliated to
the MCData group is out of scope of the present document.
## 306.4 Handling of MIME bodies in a SIP message
The IWF shall support several MIME bodies in SIP requests and SIP responses
according to 3GPP TS 24.282 [82] subclause 6.4.
## 306.5 Confidentiality and Integrity Protection of sensitive XML content
### 306.5.1 General
#### 306.5.1.1 Applicability and exclusions
The procedures in subclause 306.5 apply in general to all procedures described
in subclause 309, subclause 312 and subclause 313 with the exception that the
confidentiality and integrity protection procedures for the registration and
service authorisation procedures are described in subclause 307.
Editor's Note: The references to the subclauses will need to reviewed
depending on which subclauses are included in the current document from the
parent specification 3GPP TS 24.282 [82]
#### 306.5.1.2 Performing XML content encryption
Whenever the IWF includes XML elements or attributes pertaining to the data
specified in subclause 304.6 in SIP requests or SIP responses, the IWF shall
perform the procedures in subclause 306.5.2.3.2, with the exception that when
the MCData server receives a SIP request with XML elements or attributes in an
MIME body that need to be copied from the incoming SIP request to an outgoing
SIP request without modification, the MCData server shall perform the
procedures specified in subclause 306.5.2.5.
NOTE: The procedures in subclause 306.5.2.3.2 first determine (by referring to
configuration) if confidentiality protection is enabled and then call the
necessary procedures to encrypt the contents of the XML elements if
confidentiality protection is enabled.
#### 306.5.1.3 Performing integrity protection on an XML body
The IWF shall perform the procedures in subclause 306.5.3.3.2 just prior to
sending a SIP request or SIP response.
NOTE: The procedures in subclause 306.5.3.3.2 first determine if integrity
protection of XML MIME bodies is required and then calls the necessary
procedures to integrity protect each XML MIME body if integrity protection is
required. Each XML MIME body has its own signature.
### 306.5.2 Confidentiality Protection
#### 306.5.2.2 Keys used in confidentiality protection procedures
Confidentiality protection uses an XPK to encrypt the data which (depending on
who is the sender and who is the receiver of the encrypted information) can be
a CSK or an SPK as specified in subclause 304.6. In the case of an IWF as a
server sending or receiving to another server this key will be an SPK. An SPK-
ID is used to key the SPK. It is assumed that before the procedures in this
subclause are called, the SPK/SPK-ID are available on the sender and recipient
of the encrypted content as described in 3GPP TS 24.282 [82] subclause 4.6.
The procedures in subclause 306.5.2.3 and 3GPP TS 24.282 [82] subclause
6.5.2.4 are used with an XPK equal to the SPK and a XPK-ID equal to the SPK-ID
when the IWF sends confidentiality protected content to an MCData server.
#### 306.5.2.3 Procedures for sending confidentiality protected content
##### 306.5.2.3.2 IWF performing the role of an MCData server
If the IWF performing the role of an MCData server determines locally that it
needs to confidentially protect content to an MCData server, then sending
confidentially protected content between MCData servers is enabled.
When sending confidentiality protected content, the IWF:
1) shall use the appropriate keying information specified in subclause
306.5.2.2;
2) shall perform the procedures in 3GPP TS 24.282 [82] subclause 6.5.2.3.3 to
confidentiality protect XML elements containing the content described in
subclause 304.6; and
3) shall perform the procedures in 3GPP TS 24.282 [82] subclause 6.5.2.3.4 to
confidentiality protect URIs in XML attributes for URIs described in subclause
304.6.
If the IWF determines locally that it does not need to confidentiality protect
content sent to an MCData server, then sending confidentiality protected
content between MCData servers is disabled, and the content is included in XML
elements and attributes without encryption.
#### 306.5.2.5 IWF copying received XML content
The following procedure is executed when an IWF receives a SIP request
containing XML MIME bodies, where the content needs to be copied from the
incoming SIP request to the outgoing SIP request.
The IWF:
1) shall copy the XML elements from the XML MIME body of the incoming SIP
request that do not contain a \ XML element, to the same XML
body in the outgoing SIP request;
2) for each encrypted XML element in the XML MIME body of the incoming SIP
request as determined by 3GPP TS 24.282 [82] subclause 6.5.2.4.1:
a) shall use the keying information described in subclause 306.5.2.2 to
decrypt the content within the XML element by following the procedures
specified in subclause 3GPP TS 24.282 [82] 6.5.2.4.2, and shall continue with
the steps below if the encrypted XML element was successfully decrypted;
b) if confidentiality protection is enabled as specified in subclause
306.5.2.3.2, then for each decrypted XML element:
i) shall re-encrypt the content within the XML element using the keying
information described in subclause 306.5.2.2 and by following the procedures
specified in 3GPP TS 24.282 [82] subclause 6.5.2.3.3; and
ii) shall include the re-encrypted content into the same XML MIME body of the
outgoing SIP request; and
c) if confidentiality protection is disabled as specified in subclause
306.5.2.3.2, shall include the decrypted content in the same XML MIME body of
the outgoing SIP request; and
3) for each encrypted XML URI attribute in the XML MIME body of the incoming
SIP request as determined by 3GPP TS 24.282 [82] subclause 6.5.2.4.1:
a) shall use the keying information described in subclause 306.5.2.2 to
decrypt the URI value of the XML attribute by following the procedures
specified in 3GPP TS 24.282 [82] subclause 6.5.2.4.3, and shall continue with
the steps below if the encrypted XML attribute value was successfully
decrypted;
b) if confidentiality protection is enabled as specified in subclause
306.5.2.3.2, then for each decrypted XML element:
i) shall re-encrypt the URI value of the XML attribute using the keying
information described in subclause 306.5.2.2 and by following the procedures
specified in 3GPP TS 24.282 [82] subclause 6.5.2.3.4; and
ii) shall include the re-encrypted attribute value into the same XML MIME body
of the outgoing SIP request; and
c) if confidentiality protection is disabled as specified in subclause
306.5.2.3.2, shall include the decrypted value in the same XML MIME body of
the outgoing SIP request.
### 306.5.3 Integrity Protection of XML documents
#### 306.5.3.2 Keys used in integrity protection procedures
Integrity protection uses an XPK to sign the data which (depending on who is
the sender and who is the receiver of the signed information) can be a CSK or
an SPK as specified in subclause 304.6. In the case of an IWF as a server
sending or receiving to another server this key will be an SPK. An SPK-ID is
used to key the SPK. It is assumed that before the procedures in subclause
306.5.3.3 and 3GPP TS 24.282 [82] subclauses 6.5.3.3.1, 6.5.3.3.3 and 6.5.3.4
are called, the SPK/SPK-ID are available on the sender and recipient of the
integrity protected content, as described in subclause 304.6.
The procedure in subclause 306.5.3.3 and 3GPP TS 24.282 [82] subclause 6.5.3.4
shall be used with a XPK equal to the SPK and a XPK-ID equal to the SPK-ID
when the IWF sends integrity protected content to an MCData server
Editor's Note: It is believed that the IWF will always use an SPK when
applying integrity protection for communication with other MCData servers,
including the case when it is originating a message on behalf of a user homed
in the IWF. If this is not the case then this subclause will require re-
wording.
#### 306.5.3.3 Sending integrity protected content
##### 306.5.3.3.2 Integrity protection at the IWF
The IWF determines locally whether sending integrity protected content from
the IWF to an MCData server is enabled.
When sending integrity protected content, the MCData server shall use the
appropriate keying information specified in subclause 306.5.3.2 and shall
perform the procedures in 3GPP TS 24.282 [82] subclause 6.5.3.3.3 to integrity
protect XML MIME bodies.
NOTE: Each XML MIME body is integrity protected separately.
## 306.6 IWF Confidentiality and Integrity Protection of TLV messages
### 306.6.1 General
Signalling plane provides confidentiality and integrity protection for the
MCData data signalling and MCData data messages sent over the signalling
plane. Signalling plane security also provides the authentication of MCData
data messages.
The signalling plane security is based on 3GPP MCData security solution
including key management and end-to-end protection as defined in 3GPP TS
33.180 [78].
Various keys and associated key identifiers protect the MCData data signalling
and MCData data messages carried on the signalling plane.
The MCData signalling messages sent and received by an IWF are on-network
communications and do not include FD.
The MCData data signalling messages may be:
1\. SDS SIGNALLING PAYLOAD;
2\. SDS NOTIFICATION; or
3\. COMMUNICATION RELEASE.
The MCData data messages may be:
1\. DATA PAYLOAD.
In an on-network MCData communication for an MCData group, if protection of
MCData data messages is negotiated, the GMK and the GMK-ID of the MCData group
protect the MCData data messages sent and received by the IWF acting on behalf
of users homed in the IWF.
In an on-network one-to-one MCData communications, if protection of MCData
data messages is negotiated, the PCK and the PCK-ID protect the MCData data
messages sent and received by the IWF acting on behalf of MCData clients homed
in the IWF. The IWF acts as termination point for protection of one-to-one
MCData data messages that are sent and received by the IWF acting on behalf of
MCData clients homed in the IWF.
The protection of MCData communications between the user homed in the IWF and
the IWF acting on behalf of the user homed in the IWF is outside the scope of
the present document.
If protection of MCData data signalling messages between the IWF and another
MCData function acting in a participating or controlling role is configured,
the SPK and the SPK-ID protect the MCData data signalling messages sent and
received between the IWF and that MCData function.
The GMK and the GMK-ID are distributed to the IWF acting on behalf of users
homed in the IWF using the group document subscription and notification
procedure specified in 3GPP TS 24.481 [31].
The PCK and the PCK-ID are generated by the IWF initiating the standalone SDS
using signalling control plane or standalone one-to-one SDS using media plane
on behalf of the user homed in the IWF.
Editor\'s note: We will need to remove the \"standalone one-to-one SDS using
media plane\" if it gets deâ€‘prioritized.
The SPK and the SPK-ID are configured in the IWF if it is acting as the
participating MCData function or if it is acting as the controlling MCData
function.
The key material for creating and verifying the authentication signature (SSK,
PVT and KPAK) is provisioned to the MCData clients by the KMS as specified in
3GPP TS 33.180 [78].
### 306.6.3 Protection of MCData signalling and MCData messages
#### 306.6.3.1 General
The MCData messages may be encrypted and integrity protected between the IWF
and the MCData system. When encryption is applied the media shall be encrypted
as specified in 3GPP TS 33.180 [78].
Both unprotected MCData messages and MCData messages that are encypted and/or
integrity protected can also be end-to-end encrypted for interworking between
an MCData client and the IWF.
NOTE: The end to end encryption is independent of 3GPP encryption and is out
of scope of the present document.
# 307 Registration and service authorisation
## 307.3 IWF performing MCData server procedures
### 307.3.1 General
How the IWF authorises MCData service for users homed in the IWF is out of
scope of the present document.
# 308 Affiliation
## 308.1 General
Clause 308.2 describes the procedures for explicit affiliation by a user homed
in the IWF.
Clause 308.3 contains the IWF procedures for handling explicit affiliation by:
\- an MCData client to a group homed in the IWF; and
\- an IWF on behalf of a user homed in the IWF towards an MCData server owning
an MCData group.
Clause 308.3 contains the IWF procedures for handling implicit affiliation by:
\- an MCData client to a group homed in the IWF; and
\- an IWF on behalf of a user homed in the IWF towards an MCData server owning
an MCData group.
The procedures for implicit affiliation in this clause are triggered at the
IWF performing the participating role in the following circumstances:
\- when generating a SIP MESSAGE request on behalf of a user homed in the IWF
to initiate an MCData emergency alert targeted to an MCData group and the user
homed in the IWF is not already affiliated to that MCData group.
The procedures for implicit affiliation in this clause are triggered at the
IWF performing the controlling role in the following circumstances:
\- on receipt of a SIP MESSAGE request from the participating MCData function
when the MCData user initiates an MCData emergency alert targeted to an MCData
group and the MCData client is not already affiliated to the MCData group.
Clause 308.4 describes the coding used for explicit affiliation.
## 308.2 Procedures for users homed in the IWF
The procedures regarding support in the IWF for users homed in the IWF are out
of scope of the present document.
## 308.3 IWF performing MCData server procedures
### 308.3.1 General
The procedures performed by the IWF in the role of the MCData server consist
of:
\- procedures of the IWF serving users homed in the IWF; and
\- procedures of the IWF owning the MCData group.
### 308.3.2 Procedures of the IWF performing the role of MCData server serving
users homed in the IWF
#### 308.3.2.1 General
The procedures of the IWF serving users homed in the IWF provide:
\- sending affiliation status change towards the MCData server owning an
MCData group in clause 308.3.2.6;
\- affiliation status determination from the MCData server owning an MCData
group in clause 308.3.2.7;
authorizing affiliation status change request in negotiated mode sent to a
user homed in the IWF in clause 308.3.2.8;
\- affiliation status determination in clause 308.3.2.11;
\- affiliation status change by implicit affiliation in clause 308.3.2.12;
\- implicit affiliation status change completion in clause 308.3.2.13;
\- implicit affiliation status change cancellation in clause 308.3.2.14; and
\- automatic affiliation to configured groups in clause 308.3.2.15.
#### 308.3.2.2 Stored information
The IWF maintains information equivalent to that defined in 3GPP TS 24.282
[82] subclause 8.3.2.2.
NOTE: The virtual data structure referenced in this subclause is for
information only. Implementors may choose other means to track affiliation
status for users homed in the IWF. References to the elements of this virtual
data structure are made in other subclauses with the understanding that
implementors choosing not to use this virtual data structure will take other
appropriate actions.
#### 308.3.2.3 Receiving affiliation status change from a user homed in the
IWF procedure
Any notification of the IWF by users homed in the IWF of changes in their
affiliation status is out of scope of 3GPP.
#### 308.3.2.4 Receiving subscription to affiliation status procedure
Any notification of users homed in the IWF of their affiliation status is out
of scope of 3GPP.
#### 308.3.2.5 Sending notification of change of affiliation status procedure
Any notification of users homed in the IWF of their affiliation status is out
of scope of 3GPP.
#### 308.3.2.6 Sending affiliation status change towards MCData server owning
MCData group procedure
NOTE 1: Usage of one SIP PUBLISH request to carry information about change of
affiliation state of several users homed in the IWF served by the same IWF is
not supported in this version of the specification.
In order:
\- to send an affiliation request of a served MCData ID to a handled MCData
group ID;
\- to send an de-affiliation request of a served MCData ID from a handled
MCData group ID; or
\- to send an affiliation request of a served MCData ID to a handled MCData
group ID due to near expiration of the previously published information;
the IWF performing the role of the MCData server shall generate a SIP PUBLISH
request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856
[51]. In the SIP PUBLISH request, the IWF performing the role of the MCData
server:
1) shall set the Request-URI to the public service identity of the controlling
MCData function associated with the handled MCData group ID;
2) shall include an application/vnd.3gpp.mcdata-info+xml MIME body. In the
application/vnd.3gpp.mcdata-info+xml MIME body, the MCData server:
a) shall include the \ element set to the handled MCData
group ID; and
b) shall include the \ element set to the served
MCData ID;
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header
field according to IETF RFC 6050 [9];
4) if sending an affiliation request, shall set the Expires header field
according to IETF RFC 3903 [37], to 4294967295;
NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [24].
5) if sending a de-affiliation request, shall set the Expires header field
according to IETF RFC 3903 [37], to zero;
6) shall include a P-Asserted-Identity header field set to the public service
identity of the IWF performing the role of the MCData server according to 3GPP
TS 24.229 [4];
7) shall set the current p-id to a globally unique value;
8) shall consider an MCData user information entry such that:
a) the MCData user information entry is in the list of MCData user information
entries described in subclause 308.3.2.2; and
b) the MCData ID of the MCData user information entry is equal to the served
MCData ID;
as the served MCData user information entry;
9) for each MCData group information entry such that:
a) the MCData group information entry has the \"affiliating\" affiliation
status, the MCData group ID set to the handled MCData group ID, the expiration
time has not expired yet and the affiliating p-id is not set;
b) the MCData group information entry is in the list of the MCData group
information entries of an MCData client information entry; and
c) the MCData client information entry is in the list of the MCData client
information entries of the served MCData user information entry;
shall set the affiliating p-id of the MCData group information entry to the
current p-id; and
10) shall include an application/pidf+xml MIME body indicating per-group
affiliation information constructed according to TS 24.282 [82] subclause
8.4.1. The IWF performing the role of the MCData server shall indicate all
served MCData client IDs, such that:
a) the affiliation status is set to \"affiliating\" or \"affiliated\", and the
expiration time has not expired yet in an MCData group information entry with
the MCData group ID set to the handled MCData group;
b) the MCData group information entry is in the list of the MCData group
information entries of an MCData client information entry;
c) the MCData client information entry has the MCData client ID set to the
served MCData client ID; and
d) the MCData client information entry is in the list of the MCData client
information entries of the served MCData user information entry.
The IWF performing the role of the MCData server shall set the \ child
element of the \ root element to the current p-id.
The IWF performing the role of the MCData server shall not include the
\"expires\" attribute in the \ element.
The IWF performing the role of the MCData server shall send the SIP PUBLISH
request according to 3GPP TS 24.229 [4].
If timer F expires for the SIP PUBLISH request sent for a (de)affiliation
request of served MCData ID to the MCData group ID or upon receiving a SIP
3xx, 4xx, 5xx or 6xx response to the SIP PUBLISH request, the IWF performing
the role of the MCData server:
1) shall remove each MCData group ID entry such that:
a) the MCData group information entry has the MCData group ID set to the
handled MCData group ID;
b) the MCData group information entry is in the list of the MCData group
information entries of an MCData client information entry; and
c) the MCData client information entry is in the list of the MCData client
information entries of the served MCData user information entry.
#### 308.3.2.7 Affiliation status determination from IWF performing the role
of the MCData server owning MCData group procedure
NOTE 1: Usage of one SIP SUBSCRIBE request to subscribe for notification about
change of affiliation state of several MCData users served by the same IWF
performing the role of the MCData server is not supported in this version of
the specification.
In order to discover whether a served user homed in the IWF was successfully
affiliated to a handled MCData group in the MCData server owning the handled
MCData group, the IWF performing the role of the MCData server shall generate
an initial SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26].
In the SIP SUBSCRIBE request, the IWF performing the role of the MCData
server:
1) shall set the Request-URI to the public service identity of the controlling
MCData function associated with the handled MCData group ID;
2) shall include an application/vnd.3gpp.mcdata-info+xml MIME body. In the
application/vnd.3gpp.mcdata-info+xml MIME body, the IWF performing the role of
the MCData server:
a) shall include the \ element set to the handled MCData
group ID; and
b) shall include the \ element set to the served
MCData ID;
3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\"
(coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header
field according to IETF RFC 6050 [9];
4) if the IWF performing the role of the MCData server wants to receive the
current status and later notification, shall set the Expires header field
according to IETF RFC 6665 [26], to 4294967295;
NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [24].
5) if the IWF performing the role of the MCData server wants to fetch the
current state only, shall set the Expires header field according to IETF RFC
6665 [26], to zero;
6) shall include an Accept header field containing the application/pidf+xml
MIME type; and
7) shall include an application/simple-filter+xml MIME body indicating per-
user restrictions of presence event package notification information according
to 3GPP TS 24.282 [82] subclause 8.4.2, indicating the served MCData ID.
In order to re-subscribe or de-subscribe, the IWF performing the role of
MCData server shall generate an in-dialog SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26]. In the SIP
SUBSCRIBE request, the IWF performing the role of the MCData server:
1) if the IWF performing the role of the MCData server wants to receive the
current status and later notification, shall set the Expires header field
according to IETF RFC 6665 [26], to 4294967295;
NOTE 3: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [24].
2) if the IWF performing the role of the MCData server wants to de-subscribe,
shall set the Expires header field according to IETF RFC 6665 [26], to zero;
and
3) shall include an Accept header field containing the application/pidf+xml
MIME type.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC
3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an
application/pidf+xml MIME body indicating per-group affiliation information
constructed according to 3GPP TS24.282 [82], subclause 8.4.1, then the IWF
performing the role of the MCData server:
1) for each served MCData ID and served MCData client ID such that the
application/pidf+xml MIME body of SIP NOTIFY request contains:
a) a \ element of the root \ element;
b) the \"id\" attribute of the \ element indicating the served MCData
ID;
c) an \ child element of the \ element of the \
element;
d) the \"client\" attribute of the \ element indicating the
served MCData client ID; and
d) the \"expires\" attribute of the \ element indicating
expiration of affiliation;
perform the following:
a) if an MCData group information entry exists such that:
i) the MCData group information entry has the \"affiliating\" affiliation
status, the MCData group ID set to the handled MCData group ID, and the
expiration time has not expired yet;
ii) the MCData group information entry is in the list of the MCData group
information entries of an MCData client information entry with the MCData
client ID set to the served MCData client ID;
iii) the MCData client information entry is in the list of the MCData client
information entries of a served MCData user information entry with the MCData
ID set to the served MCData ID; and
iv) the MCData user information entry is in the list of MCData user
information entries described in subclause 308.3.2.2; and
shall set the affiliation status of the MCData group information entry to
\"affiliated\"; and
shall set the next publishing time of the MCData group information entry to
the current time and half of the time between the current time and the
expiration of affiliation; and
2) for each MCData group information entry such that:
a) the MCData group information entry has the \"affiliated\" affiliation
status or the \"deaffiliating\" affiliation status, the MCData group ID set to
the handled MCData group ID, and the expiration time has not expired yet;
b) the MCData group information entry is in the list of the MCData group
information entries of an MCData client information entry with the MCData
client ID set to a served MCData client ID;
c) the MCData client information entry is in the list of the MCData client
information entries of the served MCData user information entry with the
MCData ID set to a served MCData ID; and
d) the MCData user information entry is in the list of MCData user information
entries described in subclause 308.3.2.2; and
for which the application/pidf+xml MIME body of SIP NOTIFY request does not
contain:
a) a \ element of the root \ element;
b) the \"id\" attribute of the \ element indicating the served MCData
ID;
c) an \ child element of the \ child element of the
\ element; and
d) the \"client\" attribute of the \ element indicating the
served MCData client ID.
perform the following:
a) shall set the affiliation status of the MCData group information entry to
\"deaffiliated\"; and
b) shall set the expiration time of the MCData group information entry to the
current time; and
3) if a \ element is included in the \ root element of the
application/pidf+xml MIME body of the SIP NOTIFY request, then for each MCData
group information entry such that:
a) the MCData group information entry has the \"affiliating\" affiliation
status, the MCData group ID set to the handled MCData group ID, the expiration
time has not expired yet and with the affiliating p-id set to the value of the
\ element;
b) the MCData group information entry is in the list of the MCData group
information entries of an MCData client information entry with the MCData
client ID set to a served MCData client ID;
c) the MCData client information entry is in the list of the MCData client
information entries of the served MCData user information entry with the
MCData ID set to a served MCData ID; and
d) the MCData user information entry is in the list of MCData user information
entries described in subclause 308.3.2.2; and
for which the application/pidf+xml MIME body of SIP NOTIFY request does not
contain:
a) a \ element of the root \ element;
b) the \"id\" attribute of the \ element indicating the served MCData
ID;
c) an \ child element of the \ child element of the
\ element; and
d) the \"client\" attribute of the \ element indicating the
served MCData client ID;
perform the following:
a) shall set the affiliation status of the MCData group information entry to
\"deaffiliated\"; and
b) shall set the expiration time of the MCData group information entry to the
current time.
#### 308.3.2.8 Procedure for authorising affiliation status change request in
negotiated mode sent to a user homed in the IWF
Authorising affiliation status change request in negotiated mode sent to a
user homed in the IWF is not supported in the present document.
Editor\'s Note: The IWF returning a \"Not supported\" response code in this
case is FFS.
#### 308.3.2.9 Forwarding affiliation status change towards an MCData user
procedure
The procedure for forwarding affiliation status change towards an MCData user
is not supported in the present specification.
#### 308.3.2.10 Forwarding subscription to affiliation status towards an
MCData user procedure
The procedure for forwarding a subscription to affiliation status towards an
MCData user is not supported in the present specification.
#### 308.3.2.11 Affiliation status determination
This subclause is referenced from other procedures.
If the IWF performing the participating role needs to determine the
affiliation status of an user homed in the IWF to an MCData group, the IWF
performing the participating role:
1) shall find the user information entry in the list of MCData user
information entries described in subclause 308.3.2.2 such that the MCData ID
of the MCData user information entry is equal to the MCData ID associated with
the user homed in the IWF;
a) if the applicable MCData user information entry cannot be found, then the
IWF performing the participating role shall determine that the user homed in
the IWF is not affiliated to the MCData group and skip the rest of the steps;
2) shall find the MCData client information entry in the list of MCData client
information entries of MCData user information entry found in step 1) in which
the MCData client ID matches the MCData client ID associated with the user
homed in the IWF;
a) if the applicable MCData client information entry cannot be found, then the
IWF performing the participating role shall determine that the user homed in
the IWF is not affiliated to the MCData group and skip the rest of the steps;
and
3) shall find the MCData group information entry in the list of MCData group
information entries of MCData client information entry found in step 2 such
that the MCData group identity matches the value of the identity of the
targeted MCData group;
a) if the applicable MCData group information entry was found in step 3) and
the affiliation status of the MCData group information entry is
\"affiliating\" or \"affiliated\", shall determine that the user homed in the
IWF is affiliated to the targeted MCData group and skip the rest of the steps;
b) if the applicable MCData group information entry was found in step 3) and
the affiliation status of the MCData group information entry is
\"deaffiliating\" or \"deaffiliated\", shall determine that the user homed in
the IWF is not affiliated to the targeted MCData group and skip the rest of
the steps; or
c) if the applicable MCData group information entry was not found in step 3),
shall determine that the user homed in the IWF is not affiliated to the
targeted MCData group.
#### 308.3.2.12 Affiliation status change by implicit affiliation
This subclause is referenced from other procedures.
Upon determining that implicit affiliation of a user homed in the IWF is
required to an MCData group, the IWF performing the participating role:
1) shall determine the MCData client ID of the user homed in the IWF;
2) shall determine the MCData group ID to which the user homed in the IWF is
to be affiliated;
3) shall determine the MCData ID associated with the user homed in the IWF;
4) shall consider an MCData user information entry such that:
a) the MCData user information entry is in the list of MCData user information
entries described in subclause 308.3.2.2; and
b) the MCData ID of the MCData user information entry is equal to the MCData
ID determined in step 3;
as the served MCData user information entry;
5) shall consider an MCData client information entry such that:
a) the MCData client information entry is in the list of MCData client
information entries of the served MCData user information entry; and
b) the MCData client ID of the MCData client information entry is equal to the
served MCData client ID;
as the served MCData client information entry;
6) shall consider a copy of the list of the MCData group information entries
of the served MCData client information entry as the served list of the MCData
group information entries;
7) shall construct the candidate list of the MCData group information entries
as follows:
a) for each MCData group ID which has an MCData group information entry in the
served list of the MCData group information entries shall copy the MCData
group information entry into a new MCData group information entry of the
candidate list of the MCData group information entries; and
b) if the determined MCData group ID does not have an MCData group information
entry in the served list of the MCData group information entries or has an
MCData group information entry in the served list of the MCData group
information entries, such that the expiration time of the MCData group
information entry has already expired:
i) shall add a new MCData group information entry in the candidate list of the
MCData group information list for the determined MCData group ID;
ii) shall set the affiliation status of the new MCData group information entry
to the \"affiliating\" state; and
iii) shall set the expiration time of the new MCData group information entry
to the current time increased with the candidate expiration interval;
8) determine the candidate number of MCData group IDs as the number of
different MCData group IDs which have an MCData group information entry:
a) in the candidate list of the MCData group information entries; or
b) in the list of the MCData group information entries of an MCData client
information entry such that:
i) the MCData client information entry is in the list of the MCData client
information entries of the served MCData user information entry; and
ii) the MCData client ID of the MCData client information entry is not equal
to the served MCData client ID;
with the affiliation status set to the \"affiliating\" state or the
\"affiliated\" state and with the expiration time which has not expired yet;
and
9) if the candidate number of MCData group IDs is bigger than a maximum limit
associated by the IWF to the user homed in the IWF, shall, based on MCData
service provider policy, reduce the candidate MCData group IDs to that maximum
value;
10) if the determined MCData group ID cannot be added to the the candidate
list of the MCData group information entries due to exceeding the maximum
limit associated with the user homed in the IWF, shall discard the candidate
list of the MCData group information entries and skip the remaining steps of
the current procedure; and
11) shall replace the list of the MCData group information entries stored in
the served MCData client information entry with the candidate list of the
MCData group information entries.
#### 308.3.2.13 Implicit affiliation status change completion
This subclause is referenced from other procedures.
If the IWF performing the participating role has received a SIP 2xx response
from the controlling MCData function to a SIP request that had triggered
performing the procedures of subclause 308.3.2.12, the IWF performing the
participating role:
1) shall set the affiliation status of the MCData group information entry
added to the candidate list of the MCData group information entries by the
procedures of subclause 308.3.2.12 to \"affiliated\".
#### 308.3.2.14 Implicit affiliation status change cancellation
This subclause is referenced from other procedures.
If the IWF performing the participating role receives a SIP 4xx, 5xx or 6xx
response from the controlling MCData function for an implicit affiliation
status change operation, the IWF performing the participating role:
1) shall remove the MCData group ID entry added by the procedures of subclause
308.3.2.12 such that:
a) the MCData group information entry has the MCData group ID set to the
MCData group ID of the MCData group associated with the received SIP 4xx, 5xx,
or 6xx response;
b) the MCData group information entry is in the list of the MCData group
information entries of an MCData client information entry containing the
MCData client ID determined in the execution of the procedure in subclause
308.3.2.12; and
c) the MCData client information entry is in the list of the MCData client
information entries of the MCData user information entry containing the MCData
ID associated with the user homed in the IWF.
#### 308.3.2.15 Automatic affiliation to configured groups procedure
This subclause is referenced from other procedures.
When the IWF performing the participating role determines that automatic
affiliation of a user homed in the IWF to configured groups is needed, the IWF
shall perform the procedures specified in subclause 308.3.2.6 for the served
MCData ID and each configured MCData group ID.
### 308.3.3 Procedures of the IWF performing the controlling role
#### 308.3.3.1 General
The procedures of the IWF performing the role of an MCData server owning the
MCData group consist of:
\- receiving group affiliation status change procedure;
\- receiving subscription to affiliation status procedure;
\- sending notification of change of affiliation status procedure;
\- implicit affiliation eligibilty check procedure; and
\- affiliation status change by implicit affiliation procedure.
#### 308.3.3.2 Stored information
The IWF maintains information equivalent to that defined in 3GPP TS 24.282
[82], subclause 8.3.3.2.
NOTE: The virtual data structure referenced in this subclause is for
information only. Implementors can choose other means to track affiliation
status for users homed in the IWF. References to the elements of this virtual
data structure are made in other subclauses with the understanding that
implementors choosing not to use this virtual data structure will take other
appropriate actions.
#### 308.3.3.3 Receiving group affiliation status change procedure
Upon receiving a SIP PUBLISH request such that:
1) Request-URI of the SIP PUBLISH request contains the public service identity
of the IWF performing the controlling role associated with the served MCData
group;
2) the SIP PUBLISH request contains an application/vnd.3gpp.mcdata-info+xml
MIME body containing the \ element and the \ element;
3) the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\" (coded as
specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field
according to IETF RFC 6050 [9];
4) the Event header field of the SIP PUBLISH request contains the \"presence\"
event type; and
5) SIP PUBLISH request contains an application/pidf+xml MIME body indicating
per-group affiliation information constructed according to subclause 308.4.1;
then the IWF performing the controlling role:
1) shall identify the served MCData group ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
PUBLISH request;
2) shall identify the handled MCData ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
PUBLISH request;
3) if the Expires header field of the SIP PUBLISH request is not included or
has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too
Brief) response to the SIP PUBLISH request, where the SIP 423 (Interval Too
Brief) response contains a Min-Expires header field set to 4294967295, and
shall not continue with the rest of the steps;
4) if an MCData group for the served MCData group ID is not available to the
IWF performing the controlling role, shall reject the SIP PUBLISH request with
SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS
24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the
steps;
5) if the handled MCData ID is not a member of the MCData group identified by
the served MCData group ID, shall reject the SIP PUBLISH request with SIP 403
(Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229
[4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;
6) shall respond with SIP 200 (OK) response to the SIP PUBLISH request
according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]. In the SIP 200 (OK)
response, the IWF performing the controlling role:
a) shall set the Expires header field according to IETF RFC 3903 [37], to the
selected expiration time;
7) if the \"entity\" attribute of the \ element of the
application/pidf+xml MIME body of the SIP PUBLISH request is different than
the served MCData group ID, shall not continue with the rest of the steps;
8) if the handled MCData ID is different from the MCData ID in the \"id\"
attribute of the \ element of the \ root element of the
application/pidf+xml MIME body of the SIP PUBLISH request, shall not continue
with the rest of the steps;
9) shall consider an MCData group information entry such that:
a) the MCData group information entry is in the list of MCData group
information entries described in subclause 308.3.3.2; and
b) the MCData group ID of the MCData group information entry is equal to the
served MCData group ID;
as the served MCData group information entry;
10) if the selected expiration time is zero:
a) shall remove the MCData user information entry such that:
i) the MCData user information entry is in the list of the MCData user
information entries of the served MCData group information entry; and
ii) the MCData user information entry has the MCData ID set to the served
MCData ID;
11) if the selected expiration time is not zero:
a) shall consider an MCData user information entry such that:
i) the MCData user information entry is in the list of the MCData user
information entries of the served MCData group information entry; and
ii) the MCData ID of the MCData user information entry is equal to the handled
MCData ID;
as the served MCData user information entry;
b) if the MCData user information entry does not exist:
i) shall insert an MCData user information entry with the MCData ID set to the
handled MCData ID into the list of the MCData user information entries of the
served MCData group information entry; and
ii) shall consider the inserted MCData user information entry as the served
MCData user information entry; and
c) shall set the following information in the served MCData user information
entry:
i) set the MCData client ID list according to the \"client\" attributes of the
\ elements of the \ element of the \ element of
the \ root element of the application/pidf+xml MIME body of the SIP
PUBLISH request; and
ii) set the expiration time according to the selected expiration time;
12) shall identify the handled p-id in the \ child element of the
\ root element of the application/pidf+xml MIME body of the SIP
PUBLISH request; and
13) shall perform the procedures specified in subclause 308.3.3.5 for the
served MCData group ID.
#### 308.3.3.4 Receiving subscription to affiliation status procedure
NOTE: Usage of one SIP SUBSCRIBE request to subscribe for notification about
change of affiliation state of several MCData users served by the same MCData
server is not supported in this version of the specification.
Upon receiving a SIP SUBSCRIBE request such that:
1) Request-URI of the SIP SUBSCRIBE request contains the public service
identity of the IWF performing the controlling role associated with the served
MCData group;
2) the SIP SUBSCRIBE request contains an application/vnd.3gpp.mcdata-info+xml
MIME body containing the\ element and the \ element;
3) the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\" (coded as
specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field
according to IETF RFC 6050 [9];
4) the Event header field of the SIP SUBSCRIBE request contains the
\"presence\" event type; and
5) the SIP SUBSCRIBE request contains an application/simple-filter+xml MIME
body indicating per-user restrictions of presence event package notification
information according to subclause 308.4.2 indicating the same MCData ID as in
the \ element of the
application/vnd.3gpp.mcdata-info+xml MIME body of the SIP SUBSCRIBE request;
then the IWF performing the controlling role:
1) shall identify the served MCData group ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
SUBSCRIBE request;
2) shall identify the handled MCData ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
SUBSCRIBE request;
3) if the Expires header field of the SIP SUBSCRIBE request is not included or
has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too
Brief) response to the SIP SUBSCRIBE request, where the SIP 423 (Interval Too
Brief) response contains a Min-Expires header field set to 4294967295, and
shall not continue with the rest of the steps;
4) if an MCData group for the served MCData group ID is not available to the
IWF performing the controlling role, shall reject the SIP SUBSCRIBE request
with SIP 403 (Forbidden) response to the SIP SUBSCRIBE request according to
3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the
rest of the steps;
5) if the handled MCData ID is not a member of the MCData group identified by
the served MCData group ID, shall reject the SIP SUBSCRIBE request with SIP
403 (Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS
24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the
steps; and
6) shall generate a SIP 200 (OK) response to the SIP SUBSCRIBE request
according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].
For the duration of the subscription, the IWF shall notify subscriber about
changes of the information of the served MCData ID, as described in subclause
308.3.3.5.
#### 308.3.3.5 Sending notification of change of affiliation status procedure
In order to notify the subscriber identified by the handled MCData ID about
changes of the affiliation status of the served MCData group ID, the IWF:
1) shall consider an MCData group information entry such that:
a) the MCData group information entry is in the list of MCData group
information entries described in clause 308.3.3.2; and
b) the MCData group ID of the MCData group information entry is equal to the
served MCData group ID;
2) shall consider an MCData user information entry such:
a) the MCData user information entry is in the list of the MCData user
information entries of the served MCData group information entry; and
b) the MCData ID of the MCData user information entry is equal to the handled
MCData ID;
as the served MCData user information entry;
3) shall generate an application/pidf+xml MIME body indicating per-group
affiliation information according to clause 308.4.1 and the served list of the
served MCData user information entry of the MCData group information entry
with following clarifications:
a) the IWF shall include the \"expires\" attribute in the \
element; and
b) if this procedure is invoked by procedure in clause 308.3.3.3 where the
handled p-id was identified, the IWF shall set the \ child element of
the \ root element of the application/pidf+xml MIME body of the SIP
NOTIFY request to the handled p-id value; and
4) send a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC
6665 [26] for the subscription created in clause 308.3.3.4. In the SIP NOTIFY
request, the IWF shall include the generated application/pidf+xml MIME body
indicating per-group affiliation information.
#### 308.3.3.6 Implicit affiliation eligibilty check procedure
This clause is referenced from other procedures.
Upon receiving a SIP request for an MCData group that the MCData user is not
currently affiliated to and that requires the IWF performing the controlling
role to check on the eligibility of the MCData user to be implicitly
affiliated to the MCData group, the IWF performing the controlling role:
1) shall identify the served MCData group ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
request;
2) shall identify the handled MCData ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
request;
3) if an MCData group for the served MCData group ID is not available to the
IWF performing the controlling role, shall consider the MCData user to be
ineligible for implicit affiliation and skip the rest of the steps;
4) if the handled MCData ID is not a member of the MCData group identified by
the served MCData group ID, shall consider the MCData user to be ineligible
for implicit affiliation and skip the rest of the steps;
5) if there is no MCData group information entry in the list of MCData group
information entries described in clause 308.3.3.2 with an MCData group
identity matching the served MCData group ID, then shall consider the MCData
user to be ineligible for implicit affiliation and skip the rest of the steps;
or
6) shall consider the MCData user to be eligible for implicit affiliation.
#### 308.3.3.7 Affiliation status change by implicit affiliation procedure
This clause is referenced from other procedures.
Upon receiving a SIP request for an MCData group that the MCData user is not
currently affiliated to and that requires the IWF performing the controlling
role to perform an implicit affiliation to, the IWF performing the controlling
role:
1) shall identify the served MCData group ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
request;
2) shall identify the handled MCData ID in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body of the SIP
request;
3) shall consider an MCData group information entry such that:
a) the MCData group information entry is in the list of MCData group
information entries described in clause 308.3.3.2; and
b) the MCData group ID of the MCData group information entry is equal to the
served MCData group ID;
as the served MCData group information entry;
4) shall consider an MCData user information entry such that:
a) the MCData user information entry is in the list of the MCData user
information entries of the served MCData group information entry; and
b) the MCData ID of the MCData user information entry is equal to the handled
MCData ID;
as the served MCData user information entry;
c) if the MCData user information entry does not exist:
i) shall insert an MCData user information entry with the MCData ID set to the
handled MCData ID into the list of the MCData user information entries of the
served MCData group information entry; and
ii) shall consider the inserted MCData user information entry as the served
MCData user information entry; and
d) shall make the following modifications in the served MCData user
information entry:
i) add the MCData client ID derived from the received SIP request to the
MCData client ID list if not already present; and
ii) set the expiration time as determined by local policy;
5) shall perform the procedures specified in clause 308.3.3.5 for the served
MCData group ID.
## 308.4 Coding
The IWF shall support the coding specified in 3GPP TS 24.282 [82] clause 8.4.
# 309 IWF Short Data Service (SDS)
## 309.1 General
The group administrator can disable the SDS service on a MCData group by
setting the \ element under the \ element, in the group document, to \"false\".
If the \ element under the \
element, in the group document, is set to \"false\" for a MCData group:
\- an IWF shall not send an SDS to the said MCData group on behalf of users
homed in the IWF.
\- an IWF performing the terminating MCData controlling role shall reject a
request to send SDS to the said MCData group.
### 309.2.2 Standalone SDS using signalling control plane
#### 309.2.2.1 General
The procedures in the subordinate clauses of the parent clause are used by the
IWF to send or receive:
\- a one-to-one standalone SDS message using the signalling control plane; or
\- a group standalone SDS message using the signalling control plane.
#### 309.2.2.2 Procedures used by the IWF for users homed in the IWF
##### 309.2.2.2.1 Originating procedures
The IWF shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229
[4] and IETF RFC 3428 [33] with the clarifications given below.
The IWF:
1) if a one-to-one standalone SDS message is to be sent, shall insert in the
SIP MESSAGE request:
a) an application/resource-lists+xml MIME body with the MCData ID of the
target MCData user, according to rules and procedures of IETF RFC 4826 [89];
b) an application/vnd.3gpp.mcdata-info+xml MIME body with a \
element set to a value of \"one-to-one-sds\"; and
c) if end-to-end security is required and the security context does not exist
or if the existing security context has expired, an application/mikey MIME
body with the MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [78]. The
IWF:
i) if necessary, shall determine keying material from the key management
server as described in 3GPP TS 33.180 [78];
NOTE: How the IWF accesses the key management server is out of scope of the
present document.
ii) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [78];
iii) shall use the PCK to generate a PCK-ID with the four most significant
bits set to \"0001\" to indicate that the purpose of the PCK is to protect
one-to-one communications and with the remaining twenty eight bits being
randomly generated as described in 3GPP TS 33.180 [78];
iv) shall encrypt the PCK to a UID associated to the MCData client using the
MCData ID of the invited user and a time related parameter as described in
3GPP TS 33.180 [78];
v) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [78];
vi) shall add the MCData ID associated with the originating user homed in the
IWF to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS
33.180 [78];
vii) shall sign the MIKEY-SAKKE I_MESSAGE using the originating signing key
determined by the IWF performing the role of an MCData server provided in the
keying material together with a time related parameter; and
viii) shall include the MIKEY-SAKKE I_MESSAGE in an application/mikey MIME
body as specified in 3GPP TS 33.180 [78];
2) if a group standalone SDS message is to be sent:
a) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with:
i) the \ element set to a value of \"group-sds\";
ii) the \ element set to the MCData group identity; and
iii) the \ element set to the MCData client ID associated
with the originating user homed in the IWF; and
3) shall generate a standalone SDS message as specified in subclause
306.2.2.1.
##### 309.2.2.2.2 Terminating procedures
Upon receipt of an SDS intended for a user homed in the IWF, the IWF processes
the message according to the procedures in clause 309.2.2.3.2.
#### 309.2.2.3 IWF performing the Participating MCData function procedures
##### 309.2.2.3.1 Originating participating MCData function procedures
If the IWF acting as a participating MCData role determines that it needs to
send an SDS message:
1) shall determine the MCData ID of the originating user;
2) shall determine the public service identity of the controlling MCData
function associated with the requested SDS message:
a) if the SDS message to be sent is a group SDS message the public service
identity is that of the controlling MCData function associated with the MCData
group identity of the destination group; or
b) if the SDS message to be sent is a one-to-one SDS message the public
service identity is that of the controlling MCData function hosting the one-
to-one standalone SDS service for the calling user;
NOTE 1: How the IWF determines the public service identity of the controlling
MCData function is out of scope of the present document.
3) if unable to identify the controlling MCData function for standalone SDS
shall complete any further actions to notify the user homed in the IWF, and
shall not continue with any of the remaining steps;
4) shall ensure that the payload size of the message is not larger than a
configured value compatible with the MCData service;
NOTE 2: The term \"payload size\" refers to the \"Length of Payload contents\"
of the payload IE of the DATA PAYLOAD message transported in the SIP MESSAGE
request, minus 1 (to account for the added \"Payload content type\" field).
NOTE 3: The configured value for maximum payload size should not be larger
than the value contained in the \ element
in the MCData service configuration document as specified in 3GPP TS 24.484
[50]. How the IWF determines the value to configure is out of scope of the
present document.
5) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4]
and IETF RFC 3428 [33];
6) shall set the Request-URI of the outgoing SIP MESSAGE request to the public
service identity of the controlling MCData function as determined by step 2)
in this subclause;
7) shall include MIME bodies in to the outgoing SIP MESSAGE request according
to clause 309.2.2.2.1;
8) shall include the MCData ID of the originating user in the \ element of the application/vnd.3gpp.mcdata-info+xml
MIME body of the outgoing SIP MESSAGE request;
9) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header
field of the outgoing SIP MESSAGE request;
10) shall set the P-Asserted-Identity in the outgoing SIP MESSAGE request to
the public service identity of the IWF; and
11) shall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].
Upon receipt of a SIP response in response to the SIP MESSAGE request in step
11) the IWF completes any further actions needed to handle the response --
e.g. notify the user homed in the IWF.
##### 309.2.2.3.2 IWF performing the Terminating participating MCData role
procedures
Upon receipt of a \"SIP MESSAGE request for standalone SDS for terminating
participating MCData function\", the IWF performing the participating role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server
Internal Error) response. The IWF may include a Retry-After header field to
the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261
[24] and skip the rest of the steps;
2) shall use the MCData ID present in the \ element of the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SIP MESSAGE
request to identify the user homed in the IWF;
3) if the user homed in the IWF does not exist, then the participating IWF
shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response, and
shall not continue with the rest of the steps;
4) if the SIP MESSAGE request contains an application/mikey MIME body
containing a MIKEY-SAKKE I_MESSAGE and decryption of the content of the MIME
body is to occur at the IWF, then the IWF:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [78];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [78];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP MESSAGE request with a SIP 606 (Not Acceptable) response, and
include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE
failed\" in a Warning header field as specified in subclause 4.9 and not
continue with rest of the steps in this subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[78]; and
NOTE: Any trans-encryption between the IWF and the user homed in the IWF is
out of scope of the present document.
5) takes any further steps necessary to handle the message -- e.g. notify the
user homed in the IWF.
If the IWF determines that a SIP 200 (OK) response shall be sent on behalf of
a user homed in the IWF in response to the SIP message request, the IWF shall
send a SIP 200 (OK) response to the controlling MCData function according to
3GPP TS 24.229 [4].
If the IWF determines that a SIP 4xx, 5xx or 6xx response shall be sent on
behalf of a user homed in the IWF in response to the SIP message request, the
IWF shall send said SIP 4xx, 5xx or 6xx response to the controlling MCData
function according to 3GPP TS 24.229 [4]:
1) shall determine which Warning header field(s) to place in the SIP response;
and
2) shall send the SIP response to the controlling MCData function according to
3GPP TS 24.229 [4].
#### 309.2.2.4 Controlling IWF MCData procedures
##### 309.2.2.4.1 Originating controlling IWF procedures
This clause describes the procedures for sending a SIP MESSAGE from the IWF
performing the controlling role and is initiated by the IWF performing the
role of a controlling MCData function as a result of an action in subclause
309.2.2.4.2 or upon the determination by the IWF performing the controlling
role that a SIP MESSAGE is to be sent on behalf of a user homed in the IWF.
The controlling MCData function:
1) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4]
and IETF RFC 3428 [33];
2) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [6] in the
outgoing SIP MESSAGE request;
3) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with parameters \"require\" and
\"explicit\" according to IETF RFC 3841 [6] in the outgoing SIP MESSAGE
request;
4) if the SIP MESSAGE is to be sent as the result of receiving a SIP MESSAGE
originated by an MCData client, shall copy the following MIME bodies in the
received SIP MESSAGE request into the outgoing SIP MESSAGE request by
following the guidelines in clause 306.4; otherwise, if the SIP MESSAGE is to
be sent on behalf of a user homed in the IWF, shall create the following MIME
bodies in the outgoing SIP MESSAGE request by following the guidelines in
clause 306.4 and the procedures in clause 309.2.2.2.1:
a) application/vnd.3gpp.mcdata-info+xml MIME body;
b) application/vnd.3gpp.mcdata-signalling MIME body; and
c) application/vnd.3gpp.mcdata-payload MIME body
5) in the application/vnd.3gpp.mcdata-info+xml MIME body:
a) shall set the \ element set to the MCData ID of the
terminating user; and
b) if the SIP MESSAGE is to be sent as the result of receiving a SIP MESSAGE
originated by an MCData client,then if the \ element in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SIP MESSAGE
request was set to a value of \"group-sds\", or if the SIP MESSAGE is to be
sent on behalf of a user homed in the IWF and the IWF performing the
controlling role determines that the outgoing SIP MESSAGE is associated with a
group,
i) shall set the \ element to the group identity;
6) shall set the Request-URI to the public service identity of the terminating
participating MCData function associated to the MCData user to be invited;
7) if the SIP MESSAGE is to be sent as the result of receiving a SIP MESSAGE
originated by an MCData client shall copy the public user identity of the
calling MCData user from the P-Asserted-Identity header field of the incoming
SIP MESSAGE request into the P-Asserted-Identity header field of the outgoing
SIP MESSAGE request; otherwise, if the SIP MESSAGE is to be sent on behalf of
a user homed in the IWF, the IWF performing the controlling role shall insert
its own public user identity into the P-Asserted-Identity header field of the
outgoing SIP MESSAGE request;
8) shall include a P-Asserted-Service header field with the value
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"; and
9) shall send the SIP MESSAGE request according to according to rules and
procedures of 3GPP TS 24.229 [4].
##### 309.2.2.4.2 Terminating controlling MCData function procedures
Upon receipt of a \"SIP MESSAGE request for standalone SDS for controlling
MCData function\", the IWF performing the controlling role:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server
Internal Error) response. The IWF performing the controlling role may include
a Retry-After header field to the SIP 500 (Server Internal Error) response as
specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the
steps;
2) if the SIP MESSAGE does not contain:
a) an application/vnd.3gpp.mcdata-info+xml MIME body;
b) an application/vnd.3gpp.mcdata-signalling MIME body; and
c) an application/vnd.3gpp.mcdata-payload MIME body;
> shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response,
> with warning text set to \"199 expected MIME bodies not in the request\" in
> a Warning header field as specified in subclause 304.9, and shall not
> continue with the rest of the steps in this clause;
3) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body contained in the SIP MESSAGE;
4) if the application/vnd.3gpp.mcdata-signalling MIME body contains a SDS
SIGNALLING PAYLOAD message with a SDS disposition request type IE, shall store
the value of the Conversation ID IE and the value of the Message ID IE in the
SDS SIGNALLING PAYLOAD message;
NOTE: The IWF performing the controlling role uses the Conversation ID and
Message ID for correlation with disposition notifications.
5) if the \ element in the application/vnd.3gpp.mcdata-info+xml
MIME body of the SIP MESSAGE request is set to a value of \"one-to-one-sds\"
and:
a) the conditions in subclause 311.1 indicate that the MCData user is not
allowed to send SDS communications due to message size as determined by step
3) of subclause 311.1, shall reject the SIP MESSAGE request with a SIP 403
(Forbidden) response to the SIP MESSAGE request, with warning text set to
\"218 user not authorised for one-to-one SDS communications due to message
size\" in a Warning header field as specified in subclause 304.9, and shall
not continue with the rest of the steps in this clause; and
b) the SIP MESSAGE request:
i) does not contain an application/resource-lists MIME body or contains an
application/resource-lists MIME body with more than one \ element,
shall return a SIP 403 (Forbidden) response with the warning text set to \"204
unable to determine targeted user for one-to-one SDS\" in a Warning header
field as specified in clause 304.9, and skip the rest of the steps below; and
ii) contains an application/resource-lists MIME body with exactly one \
element, shall send a SIP MESSAGE request to the MCData user identified in the
\ element of the MIME body, as specified in subclause 309.2.2.4.1, or
if the MCData user identified in the \ element of the MIME body
indicates a user homed in the IWF, the processes used by IWF performing the
controlling role to handle the incoming SIP MESSAGE request are out of scope;
6) if the \ element in the application/vnd.3gpp.mcdata-info+xml
MIME body of the SIP MESSAGE request is set to a value of \"group-sds\":
a) shall retrieve the group document associated with the group identity in the
SIP MESSAGE request by following the procedures in subclause 306.3.3, and
shall continue with the remaining steps if the procedures in subclause 306.3.3
were successful;
b) if the \ element is present in the group document,
shall send a SIP 403 (Forbidden) response with the warning text set to \"115
group is disabled\" in a Warning header field as specified in subclause 304.9
and shall not continue with the rest of the steps;
c) if the \ element of the \ element of the \
element in the group document does not contain an \ element
with a \"uri\" attribute matching the MCData ID of the originating user
contained in the \ element of the
application/vnd.3gpp.mcdata-info+xml MIME body in the SIP MESSAGE request,
shall send a SIP 403 (Forbidden) response with the warning text set to \"116
user is not part of the MCData group\" in a Warning header field as specified
in subclause 304.9 and shall not continue with the rest of the steps;
d) if the \ element contains a \ element in the group document set to a value of \"false\", shall send
a SIP 403 (Forbidden) response with the warning text set to \"206 short data
service not allowed for this group\" in a Warning header field as specified in
subclause 304.9 and shall not continue with the rest of the steps;
e) if the \ element is not present in the group document
or is present and contains a \ element containing an \"enabler\"
attribute which is not set to the value \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\", shall send a SIP 488 (Not Acceptable) response
with the warning text set to \"207 SDS services not supported for this group\"
in a Warning header field as specified in subclause 304.9 and shall not
continue with the rest of the steps;
f) if the group SDS procedures in subclause 311.1 indicate that the user
identified by the MCData ID:
i) is not allowed to send group MCData communications on this group identity
as determined by step 2) of subclause 311.1, shall reject the SIP MESSAGE
request with a SIP 403 (Forbidden) response, with warning text set to \"201
user not authorised to transmit data on this group identity\" in a Warning
header field as specified in subclause 304.9, and shall not continue with the
rest of the steps in this subclause;
ii) is not allowed to send group MCData communications on this group identity
due to exceeding the maximum amount of data that can be sent in a single
request as determined by step 8) of subclause 311.1, shall reject the SIP
MESSAGE request with a SIP 403 (Forbidden) response to the SIP MESSAGE
request, with warning text set to \"208 user not authorised for MCData
communications on this group identity due to exceeding the maximum amount of
data that can be sent in a single request\" in a Warning header field as
specified in subclause 304.9, and shall not continue with the rest of the
steps in this subclause; and
iii) is not allowed to send SDS communications on this group identity due to
message size as determined by step 5) of subclause 311.1, shall reject the SIP
MESSAGE request with a SIP 403 (Forbidden) response to the SIP MESSAGE
request, with warning text set to \"217 user not authorised for SDS
communications on this group identity due to message size\" in a Warning
header field as specified in clause 304.9, and shall not continue with the
rest of the steps in this subclause;
g) the originating user identified by the MCData ID is not affiliated to the
group identity contained in the SIP MESSAGE request, as specified in clause
306.3.5, shall return a SIP 403 (Forbidden) response with the warning text set
to \"120 user is not affiliated to this group\" in a Warning header field as
specified in clause 304.9, and skip the rest of the steps below;
h) shall determine targeted group members for MCData communications by
following the procedures in subclause 306.3.4;
j) if the procedures in subclause 306.3.4 result in no affiliated members
found in the selected MCData group, shall return a SIP 403 (Forbidden)
response with the warning text set to \"198 no users are affiliated to this
group\" in a Warning header field as specified in clause 304.9, and skip the
rest of the steps below; and
k) shall send SIP MESSAGE requests to the targeted MCData group members
identified in step h) above by following the procedure in subclause
309.2.2.4.1;
7) shall generate a SIP 202 (Accepted) response in response to the \"SIP
MESSAGE request for standalone SDS for controlling MCData function\"; and
8) shall send the SIP 202 (Accepted) response towards the originating
participating MCData function according to 3GPP TS 24.229 [4].
### 309.2.3 Standalone SDS using media plane
The IWF does not support standalone SDS using the media plane in the present
document.
### 309.2.4 SDS session
The IWF does not support an SDS session in the present document.
## 309.3 Off-network SDS
Off-network SDS is not applicable to interworking.
# 310 File Distribution (FD)
File distribution is not supported by the IWF in the present document.
# 311 Transmission and Reception Control
## 311.1 General
How the IWF determines authorisation of a user homed in the IWF to initiate
MCData communications is out of scope.
## 311.2 Auto-receive for File Distribution
File distribution is not supported by the IWF in the present document.
## 311.3 Accessing list of deferred data group communications
Accessing list of deferred data group communication is associated with file
distribution which is not supported by the IWF in the present document.
# 312 Dispositions and Notifications
## 312.1 General
The procedures in clause 312 describe:
\- the on-network procedures for generating out-of-band dispositions for on-
network SDS.
The IWF acting on behalf of a participant homed in the IWF can send a
disposition notification as a direct result of receiving an MCData message
(e.g. delivery notification) or can send a disposition notification at a later
time (e.g. read notification). In certain circumstances the delivery and read
notification can be delivered in one notification message.
## 312.2 On-network disposition notifications
### 312.2.1 Procedures of the IWF performing the participating role on behalf
of the user homed in the IWF
#### 312.2.1.1 Sending a disposition notification message
The IWF performing the participating role can follow the procedures in this
clause if it decides to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report; or
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery.
Before sending a disposition notification the IWF performing the participating
role needs to determine:
\- the group identity related to an SDS message request received as part of a
group communication. The IWF performing the participating role determines the
group identity from the contents of the \ element
contained in the application/vnd.3gpp.mcdata-info+xml MIME body of the
incoming SDS message request; and
\- the MCData user targeted for the disposition notification. The IWF
performing the participating role determines the targetted MCData user from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS message
request.
The IWF performing the participating role generates a SIP MESSAGE request in
accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the
clarifications given below.
The IWF performing the participating role:
1) shall build the SIP MESSAGE request as specified in clause 306.2.4.1;
2) shall follow the rules specified in clause 306.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this clause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [20];
4) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
5) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
clause 306.2.3.1; and
6) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [4].
### 312.2.2 Participating IWF procedures
#### 312.2.2.1 IWF performing the MCData participating role
If the IWF acting in a MCData participating role determines that it shall send
a disposition notification
the IWF shall follow the procedures of clause 312.2.1.1.
Upon receipt of a SIP 202 (Accepted) response in response to the SIP MESSAGE
request, the IWF:
1) shall complete any further actions needed to notify the user homed in the
IWF.
Upon receipt of a SIP 200 (OK) response in response to the SIP MESSAGE
request, the IWF:
1) shall complete any further actions needed to notify the user homed in the
IWF.
Upon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, the
IWF:
1) shall complete any further actions needed to notify the user homed in the
IWF.
#### 312.2.2.2 Participating IWF receives disposition notification from a
Controlling MCData function
Upon receipt of a:
\- \"SIP MESSAGE request for SDS disposition notification for terminating
MCData client \";
The IWF:
1) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server
Internal Error) response. The IWF may include a Retry-After header field to
the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [4]
and skip the rest of the steps;
2) shall use the MCData ID present in the \ element of the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SIP MESSAGE
request to identify the user homed in the IWF;
3) if the identity of the user homed in the IWF does not exist, then the
participating IWF shall reject the SIP MESSAGE request with a SIP 404 (Not
Found) response. Otherwise, continue with the rest of the steps; and
4) shall notify the user homed in the IWF.
If the IWF determines that a SIP 2xx response shall be sent on behalf of a
user homed in the IWF in response to the SIP MESSAGE requests, the IWF shall
send a SIP 2xx response to the controlling MCData function.
If the IWF determines that a SIP 4xx, 5xx or 6xx response shall be sent on
behalf of a user homed in the IWF in response to the SIP MESSAGE request, the
IWF shall send the response to the controlling MCData function.
### 312.2.3 IWF performing the MCData controlling role
Upon receipt of a:
\- \"SIP MESSAGE request for SDS disposition notification for MCData server\";
or
\- if the IWF determines that it shall send an SDS disposition notification
the IWF performing the MCData controlling role:
1) if the IWF has received the SIP MESSAGE;
a) if unable to process the request due to a lack of resources or a risk of
congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server
Internal Error) response. The IWF may include a Retry-After header field to
the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261
[24]. Otherwise, continue with the rest of the steps;
b) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if an Accept-Contact header field does not include
the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\";
c) if the incoming SIP MESSAGE request does not contain an
application/resource-lists MIME body or contains an application/resource-lists
MIME body with more than one \ element, shall reject the SIP MESSAGE
request with a SIP 403 (Forbidden) response including warning text set to
\"145 unable to determine called party\" in a Warning header field as
specified in subclause 4.4, and shall not continue with the rest of the steps;
d) shall attempt to correlate the disposition notification to the original SDS
request using the values contained in the Conversation ID and Message ID of
the SDS NOTIFICATION message contained in the application/vnd.3gpp.mcdata-
signalling MIME body of the SIP MESSAGE; and
e) if unable to correlate the disposition notification as determined by step
d), shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response
including warning text set to \"216 unable to correlate the disposition
notification\" in a Warning header field as specified in 3GPP TS 24.282 [82]
subclause 4.4, and shall not continue with the rest of the steps;
2) shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4]
and IETF RFC 3428 [33];
3) when sending an SDS disposition notification:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [6] in the
outgoing SIP MESSAGE request;
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with parameters \"require\" and
\"explicit\" according to IETF RFC 3841 [6] in the outgoing SIP MESSAGE
request;
4) shall set the Request-URI to the public service identity of the terminating
participating MCData function associated to the MCData user to be invited or
the public service identity of the IWF of the participant homed in the IWF to
be invited;
NOTE 1: How the IWF finds the address of the terminating MCData participating
function is out of the scope of the current release.
5) shall include a P-Asserted-Service header field with the value
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\";
6) shall copy the public user identity of the calling MCData user or the
public user identity of the IWF of the participant homed in the IWF from the
P-Asserted-Identity header field of the incoming SIP MESSAGE request into the
P-Asserted-Identity header field of the outgoing SIP MESSAGE request;
7) shall copy the MCData ID of the MCData user or participant homed in the IWF
listed in the MIME resources body of the incoming SIP MESSAGE request, into
the \ element in the application/vnd.3gpp.mcdata-info+xml
MIME body of the outgoing SIP MESSAGE request;
8) if an incoming SIP MESSAGE request contains an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element:
a) shall retrieve the group document for the MCData group id contained in the
\ element from the group management server, if not
already cached, and identify the group members;
NOTE 2: How the IWF obtains the group document is out scope of the present
document.
b) shall verify that the MCData ID contained in the \ element matches to a group member. If there is no match, the IWF
shall reject the SIP request with a SIP 403 (Forbidden) response including
warning text set to \"116 user is not part of the MCData group\" in a Warning
header field as specified in 3GPP TS 24.282 [82] subclause 4.4, and shall not
continue with the rest of the steps;
c) if MCData disposition notifications need to be aggregated and an aggregated
disposition notification has not yet been sent:
i) if timer TDC1 (disposition aggregation timer) is not running, shall start
timer TDC1 (disposition aggregation timer) with the timer value as specified
in 3GPP TS 24.282 [82] subclause F.2.2;
ii) shall copy the application/vnd.3gpp.mcdata-signalling MIME body in the
received SIP MESSAGE request to the outgoing SIP MESSAGE request;
NOTE 3: If the aggregated MCData disposition notifications do not fit into one
SIP MESSAGE request, then the IWF needs to generate a new SIP MESSAGE request
for the remaining disposition notifications.
iii) on expiry of timer TDC1 (disposition aggregation timer) shall continue
with step 9; and
iv) if all MCData disposition notifications have been received from all group
members shall continue with step 9; and
d) if MCData disposition notifications do not need to be aggregated, shall
copy the application/vnd.3gpp.mcdata-signalling MIME body in the received SIP
MESSAGE request to the outgoing SIP MESSAGE request and shall continue with
step 9;
9) if an incoming SIP MESSAGE request contains an application/vnd.3gpp.mcdata-
info+xml MIME body without an \ element shall copy
the application/vnd.3gpp.mcdata-signalling MIME body in the received SIP
MESSAGE request to the outgoing SIP MESSAGE request;
10) when notifying other users:
a) shall send the SIP MESSAGE request to those users homed in the MCData
system according to rules and procedures of 3GPP TS 24.229 [4]; and
b) shall notify users homed in the IWF;
11) when acknowledging the message that triggered the
a)shall generate a SIP 202 (Accepted) response in response to any
\- \"SIP MESSAGE request for SDS disposition notification for MCData server\";
and
b)shall notify users home in the IWF; and
12) shall notify the originating participating MCData function by
a) sending a SIP 202 (Accepted) response to any external originating
participating MCData function according to 3GPP TS 24.229 [4]; and
b) notifying an original participating MCData function internal to the IWF.
# 313 Communication Release
The IWF shall handle communication release with the MCData system as specified
in 3GPP TS 24.282 [82] clause 13.
Communication release in the LMR system is out of scope of 3GPP.
# 314\. Enhanced Status (ES)
## 314.1 General
## 314.2 On-network ES
### 314.2.2 IWF acting as participating MCData function procedures
#### 314.2.2.1 Originating participating MCData function procedures
If the IWF acting as a participating MCData function determines that an
Enhanced Status message needs to be sent on behalf of a participant homed in
the IWF then it follows the procedure described in subclause 309.2.2.3.1.
#### 314.2.2.2 Terminating participating MCData function procedures
Upon receipt of a \"SIP MESSAGE request for standalone SDS for terminating
participating MCData function\", the IWF acting as a participating MCData
function should follow the procedure described in subclause 309.2.2.3.2.
### 314.2.3 IWF acting as controlling MCData function procedures
#### 314.2.3.1 Originating controlling MCData function procedures
If the IWF acting as a controlling MCData function determines that an Enhanced
Status message needs to be sent on behalf of a participant homed in the IWF
then it follows the procedure described in subclause 309.2.2.4.1.
#### 314.2.3.2 Terminating controlling MCData function procedures
Upon receipt of a \"SIP MESSAGE request for standalone SDS for controlling
MCData function\", the IWF acting as a controlling MCData function should
follow the procedure described in subclause 309.2.2.4.2.
# 315 Message Formats
### 315.1 MCData message functional definitions and contents
### 315.1.1 General
The following subclauses describe the MCData message functional definitions
and contents. Each message consists of a series of information elements. The
standard format of an MCData message and the encoding rules for each type of
information element follow that defined for the MCPTT Off-Network Protocol
(MONP) as documented in annex I of 3GPP TS 24.379 [81].
### 315.1.2 SDS SIGNALLING PAYLOAD message
#### 315.1.2.1 Message definition
This message is sent by the UE towards a participant homed in the IWF via the
network and vice versa when sending an SDS data payload. This message provides
the signalling content related to the SDS data payload. For the contents of
the message see Table 315.1.2.1-1.
Message type: SDS SIGNALLING PAYLOAD
Direction: MCData server to IWF and vice versa
Table 315.1.2.1-1: SDS SIGNALLING PAYLOAD message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | SDS | Message | M | V | 1 | | | signalling | type\ | | | | | | payload | 3GPP TS 24 | | | | | | message | .282 [82] | | | | | | identity | subcl | | | | | | | ause 15.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Date and | Date and | M | V | 5 | | | time | time\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.8 | | | | +-----+-------------+-------------+----------+--------+--------+ | | C | C | M | V | 16 | | | onversation | onversation | | | | | | ID | ID | | | | | | | | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Message ID | Message ID\ | M | V | 16 | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.10 | | | | +-----+-------------+-------------+----------+--------+--------+ | 21 | InReplyTo | InReplyTo | O | TV | 17 | | | message ID | message ID\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | 22 | Application | Application | O | TV | 2 | | | ID | ID | | | | | | | | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 8- | SDS | SDS | O | TV | 1 | | | disposition | disposition | | | | | | request | request | | | | | | type | type\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | 7D | Extended | Extended | O | TLV-E | 3-x | | | application | application | | | | | | ID | ID\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.24 | | | | +-----+-------------+-------------+----------+--------+--------+
Editor's Note: The term UE should be replaced by MCData client for
correctness, but the terminology is maintained for alignment with the parent
subclause.
### 315.1.4 DATA PAYLOAD message
#### 315.1.4.1 Message definition
This message is sent by the UE towards a participant homed in the IWF via the
network and vice versa when sending an SDS data payload. This message provides
the data to be delivered to the user or application. For the contents of the
message see Table 315.1.4.1-1.
Message type: DATA PAYLOAD
Direction: MCData server to IWF and vice versa
Table 315.1.4.1-1: DATA PAYLOAD message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Data | Message | M | V | 1 | | | payload | type\ | | | | | | message | 3GP | | | | | | identity | P TS 24.282 | | | | | | | [82] | | | | | | | subcl | | | | | | | ause 15.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Number of | Number of | M | V | 1 | | | payloads | payloads\ | | | | | | | 3GP | | | | | | | P TS 24.282 | | | | | | | [82] | | | | | | | subcla | | | | | | | use 15.2.12 | | | | +-----+-------------+-------------+----------+--------+--------+ | 7A | Security | MCData | O | TLV-E | 32-x | | | parameters | Protected | | | | | | and Payload | Payload | | | | | | | message | | | | | | | | | | | | | | 3GPP TS 33 | | | | | | | .180 [78] | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | Payload | Payload | O | TLV-E | 3-x | | | | | | | | | | | 315.2.13 | | | | +-----+-------------+-------------+----------+--------+--------+
NOTE 1: The Number of payloads IE dictates the number of Payload IEs that are
included in the message by the sender. Multiple Payload IEs can be part of
Security parameters and Payload IE if end-to-end security is required.
NOTE 2: If end-to-end security is required for a one-to-one communication,
Security parameters and Payload IE is included. Otherwise, if end-to-end
security is not required for a one-to-one communication, Payload IE is
included. For group communication, Payload IE is included.
NOTE 3: Formatting of payloads as part of the Security parameters and Payload
IE is specified in subclause 315.2.13.
Editor's Note: The term UE should be replaced by MCData client for
correctness, but the terminology is maintained for alignment with the parent
subclause.
### 315.1.5 SDS NOTIFICATION message
#### 315.1.5.1 Message definition
This message is sent by the UE towards a participant homed in the IWF via the
network and vice versa to share SDS disposition information. For the contents
of the message see Table 315.1.5.1-1.
Message type: SDS NOTIFICATION
Direction: MCData server to IWF and vice versa
Table 315.1.5.1-1: SDS NOTIFICATION message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | SDS | Message | M | V | 1 | | | n | type\ | | | | | | otification | 3GPP TS 24 | | | | | | message | .282 [82] | | | | | | identity | subcl | | | | | | | ause 15.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | SDS | SDS | M | V | 1 | | | disposition | disposition | | | | | | n | n | | | | | | otification | otification | | | | | | type | type\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Date and | Date and | M | V | 5 | | | time | time\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.8 | | | | +-----+-------------+-------------+----------+--------+--------+ | | C | C | M | V | 16 | | | onversation | onversation | | | | | | ID | ID | | | | | | | | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Message ID | Message ID\ | M | V | 16 | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.10 | | | | +-----+-------------+-------------+----------+--------+--------+ | 22 | Application | Application | O | TV | 2 | | | ID | ID | | | | | | | | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 7D | Extended | Extended | O | TLV-E | 3-x | | | application | application | | | | | | ID | ID\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.24 | | | | +-----+-------------+-------------+----------+--------+--------+
Editor's Note: The term UE should be replaced by MCData client for
correctness, but the terminology is maintained for alignment with the parent
subclause.
### 315.1.10 COMMUNICATION RELEASE message
#### 315.1.10.1 Message definition
In this subclause the term \"MCData server\" can apply to an MCData server or
an IWF performing the role of an MCData server.
This message is sent by the MCData server to an MCData UE or a participant
homed in the IWF to indicate about intention to release the MCData
communication. This message is also sent by the MCData UE or the IWF to the
MCData server to request extension for the MCData communication. The MCData
server responds back to the request using this message. For the contents of
the message see Table 315.1.10.1-1.
Message type: COMMUNICATION RELEASE
Direction: MCData server to UE or participant homed in the IWF, MCData UE or
IWF to MCData server
Table 315.1.10.1-1: COMMUNICATION RELEASE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Comm | Message | M | V | 1 | | | Release | type\ | | | | | | message | 3GPP TS 24 | | | | | | identity | .282 [82] | | | | | | | subcl | | | | | | | ause 15.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Comm | Comm | M | V | 1 | | | Release | Release | | | | | | Information | Information | | | | | | type | type\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.20 | | | | +-----+-------------+-------------+----------+--------+--------+ | B- | Data query | Data query | O | TV | 1 | | | type | type\ | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.19 | | | | +-----+-------------+-------------+----------+--------+--------+ | C- | Extension | Extension | O | TV | 1 | | | response | response | | | | | | type | type | | | | | | | | | | | | | | 3GPP TS 24 | | | | | | | .282 [82] | | | | | | | subcla | | | | | | | use 15.2.21 | | | | +-----+-------------+-------------+----------+--------+--------+
## 315.2 General message format and information elements coding
315.2.2 Message type
The purpose of the Message type information element is to identify the type of
the message.
The IWF shall support the following Message types as defined in clause 15.2.2
of 3GPP TS 24.282 [82]:
\- SDS SIGNALING PAYLOAD;
\- DATA PAYLOAD;
\- SDS NOTIFICATION;
\- COMMUNICATION RELEASE.
### 315.2.9 Conversation ID
The Conversation ID information element uniquely identifies the conversation.
The Conversation ID information element is coded as shown in Figure 315.2.9-1
and Table 315.2.9-1.
The Conversation ID information element is a type 3 information element with a
length of 16 octets.
+-----------------------+----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-----------------------+----------+---+---+---+---+---+---+---+ | Conversation ID value | octet 1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet 16 | | | | | | | | +-----------------------+----------+---+---+---+---+---+---+---+
Figure 315.2.9-1: Conversation ID value
Table 315.2.9-1: Conversation ID value
+----------------------------------------------------------------------+ | Conversation identifier value (octet 1 to 16) | | | | The Conversation ID contains a number uniquely identifying the | | conversation. The value is a universally unique identifier as | | specified in IETF RFC 4122 [67] with the exception of the | | following designated value shown in Table 315.2.9-2, denoted | | \"UNKNOWN CONVERSATION\". | +----------------------------------------------------------------------+
Table 315.2.9-2: Conversation ID value \"UNKNOWN CONVERSATION\"
+---+---+---+---+---+---+---+---+----------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---+---+---+---+---+---+---+---+----------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | octet 1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet 16 | +---+---+---+---+---+---+---+---+----------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +---+---+---+---+---+---+---+---+----------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +---+---+---+---+---+---+---+---+----------+
### 315.2.10 Message ID
The Message ID information element uniquely identifies a message within a
conversation.
The Message ID information element is coded as shown in Figure 15.2.10-1 and
Table 15.2.10-1.
The Message ID information element is a type 3 information element with a
length of 16 octets.
+------------------+----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------+----------+---+---+---+---+---+---+---+ | Message ID value | octet 1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet 16 | | | | | | | | +------------------+----------+---+---+---+---+---+---+---+
Figure 315.2.10-1: Message ID value
Table 315.2.10-1: Message ID value
+----------------------------------------------------------------------+ | Message ID value (octet 1 to 16) | | | | The Message ID contains a number uniquely identifying a message. The | | value is a universally unique identifier as specified in | | IETF RFC 4122 [67] with the exception of the designated value | | \"UNKNOWN ORIGINATING MESSAGE ID\" and \"LMR MESSAGE ID\" shown in | | Tables 315.2.10-2 and 315.2.10â€‘3, where \'x\' represents a variable | | value. | +----------------------------------------------------------------------+
Table 315.2.10-2: Message ID value \"UNKNOWN ORIGINATING MESSAGE ID\"
+---+---+---+---+---+---+---+---+----------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---+---+---+---+---+---+---+---+----------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | octet 1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet 16 | +---+---+---+---+---+---+---+---+----------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +---+---+---+---+---+---+---+---+----------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +---+---+---+---+---+---+---+---+----------+
Table 315.2.10-3: Message ID value \"LMR MESSAGE ID\"
+---+---+---+---+---+---+---+---+----------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---+---+---+---+---+---+---+---+----------+ | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | octet 1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet 15 | | | | | | | | | | | | | | | | | | | | octet 16 | +---+---+---+---+---+---+---+---+----------+ | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | | +---+---+---+---+---+---+---+---+----------+ | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | | +---+---+---+---+---+---+---+---+----------+ | x | x | x | x | x | x | x | x | | +---+---+---+---+---+---+---+---+----------+
### 315.2.13 Payload
The Payload information element contains the payload intended for the
recipient user or application;
The Payload information element is coded as shown in Figure 315.2.13-1, Table
315.2.13-1, Table 315.2.13-2 and Table 315.2.13-3.
The Payload information element is a type 6 information element.
* * *
8 7 6 5 4 3 2 1  
Payload IEI octet 1  
Length of Payload contents octet 2  
octet 3  
octet 4  
Payload contents  
octet n
* * *
Figure 315.2.13-1: Payload information element
Table 315.2.13-1: Payload contents
* * *
8 7 6 5 4 3 2 1  
Payload content type octet 4  
octet 5  
Payload data  
octet n
* * *
Table 315.2.13-2: Payload content type
Bits |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
|  |  |  |  |  |  |  |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | TEXT  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | BINARY  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 1 |  | HYPERLINKS  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 0 |  | FILEURL  
0 | 0 | 0 | 0 | 0 | 1 | 0 | 1 |  | LOCATION  
0 | 0 | 0 | 0 | 0 | 1 | 1 | 0 |  | ENHANCED STATUS  
0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 |  | LMR MESSAGE  
|  |  |  |  |  |  |  |  |   
All other values are reserved. NOTE: The LMR MESSAGE format identifies the payload content as a native LMR format message for transport between LMR aware endpoints as per 3GPP TS 23.283 [80] |  |  |  |  |  |  |  |  |   
Table 315.2.13-3: Payload data
+----------------------------------------------------------------------+ | Payload data is included in octet 5 to octet n; Max value of 65535 | | octets. | | | | Payload data contains the payload destined for the user or | | application. | | | | A file URL is encoded as specified in IETF RFC 1738 [86]. | | | | The length of location information payload content is 6 bytes. First | | 3 bytes contain the latitude information and next 3 bytes contain | | the longitude information. | +----------------------------------------------------------------------+
## 405.6 Interworking Function (IWF)
To be compliant with the procedures in the present document, an IWF:
\- shall support the role of XCAP server as specified in IETF RFC 4825 [88];
\- shall support the role of Group XDMS as specified in OMA OMA-TS-
XDM_Group-V1_1_1 [87];
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.2.5, with
the IWF acting as the GMS;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.3.3, with
the IWF acting as the GMS;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.8.3, with
the IWF acting as the GMS;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.11.3,
with the IWF acting as the GMS;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.13.2.3,
with the IWF acting as the GMS;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.13.3.2.4,
with the IWF acting as the GMS, with the clarification: the IWF need not
interwork the received information in 3GPP TS 24.481 [31], subclause
6.3.13.2.2;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.13.3.3,
with the IWF acting as the GMS;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.14.3,
with the IWF acting as the GMS;
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.15.3,
with the IWF acting as the GMS; and
\- shall support the procedure in 3GPP TS 24.481 [31], subclause 6.3.16.3,
with the IWF acting as the GMS.
# Annex A: Proposed changes to 3GPP TS 24.379 [81] for non-controlling check
of user profile
# A.1 General
Editor\'s note: The subclauses in this annex are intended to be applied as CRs
to 3GPP TS 24.379 [81] directly, whether or not the other clauses in the
present document become a new TS or are moved to existing TSs. The letter A is
prepended to target 3GPP TS 24.379 [81] subclause title numbers. References
within the subclauses do not prepend the letter A since the text body will be
directly ported to 3GPP TS 24.379 [81]. The following markup is required, so
that it survives when tracking is cleared on the TR and still indicate the
changes required to 3GPP TS 24.379 [81]: deleted text is highlighted in red,
added text highlighted in green. Additionally, added text will be with
underlined font and deleted text will be with a strikethru font.
The present annex provides one approach for checking user profile information
in a multi-system scenario. In the current release of 3GPP TS 24.379, the
controlling function checks the user profile document for the user\'s
authorization to initiate priority calls and emergency alerts. Where the
controlling function is in a partner system, the originating system is better
suited to check the user profile. The approach in the present annex moves the
user profile checks to a non-controlling function in the originating system.
### A.5.3.2 Functional connectivity models
The following figures give an overview of the connectivity between the
different functions of the MCPTT server as described in subclause 5.3.1.
NOTE: Separate boxes are shown for each of the functions of the MCPTT server.
In each MCPTT system, these functions can be physically combined into one
MCPTT server or can be implemented on more than one MCPTT server. For example,
there could be an instantiation of an MCPTT server that only serves as a
controlling MCPTT function, but not as a participating MCPTT function for any
MCPTT clients. When an MCPTT server supports more than one function, then
sending requests from one function to another does not incur a traversal of
the underlying IMS SIP core network.
Figure 5.3.2-1 shows the basic functions of the MCPTT server when operating
within the primary MCPTT system.
Figure 5.3.2-1: Functions of the MCPTT server in the primary MCPTT system
Figure 5.3.2-2 shows the use of the non-controlling MCPTT function of an MCPTT
group within the primary MCPTT system. This can occur due to group re-grouping
of groups within the same MCPTT system, where the MCPTT server(s) of one or
more of the constituent groups are not controlled by the same controlling
MCPTT function as that of the temporary group. The non-controlling MCPTT
function of an MCPTT group either provide the identities of the users of the
group to the controlling MCPTT function, or the non-controlling MCPTT function
of an MCPTT group can invite the users of the group on behalf of the
controlling MCPTT function.
Figure 5.3.2-2: The non-controlling function operating in the primary MCPTT
system
Figure 5.3.2-3 shows the roles of the MCPTT server in a mutual aid
relationship between a primary MCPTT system and a partner MCPTT system. Here,
the controlling MCPTT function is in the primary MCPTT system and the called
user is homed in a partner MCPTT system.
Figure 5.3.2-3: Mutual aid relationship between the primary MCPTT system and a
partner MCPTT system with the controlling MCPTT function in the primary MCPTT
system
Figure 5.3.2-4 shows the roles of the MCPTT server in a mutual aid
relationship between a primary MCPTT system and a partner MCPTT system. Here,
the controlling MCPTT function is in the partner MCPTT system.
Figure 5.3.2-4: Mutual aid relationship between the primary MCPTT system and a
partner MCPTT system with the controlling MCPTT function in the partner MCPTT
system
Figure 5.3.2-5 shows the roles of the MCPTT server in a mutual aid
relationship between a primary MCPTT system and a partner MCPTT with the use
of a non-controlling MCPTT function of an MCPTT group within the partner MCPTT
system. This can occur due to group re-grouping where the MCPTT server(s) of
one or more of the constituent groups are homed on the partner system. If the
primary MCPTT system and partner MCPTT system operate in a trusted mutual aid
relationship, then the non-controlling MCPTT function of an MCPTT group can
provide the identities of the users of the group to the controlling MCPTT
function. If the primary MCPTT system and partner MCPTT system operate in an
untrusted mutual aid relationship, then the non-controlling MCPTT function of
an MCPTT group invites the users of the group on behalf of the controlling
MCPTT function.
Figure 5.3.2-5: Mutual aid relationship between the primary MCPTT system and a
partner MCPTT system involving the use of a non-controlling MCPTT function of
an MCPTT group in the partner MCPTT system
Figure 5.3.2-6 illustrates a functional connectivity model involving multiple
partner systems where the partner system that owns the group does not home any
of the group members.
Figure 5.3.2-6: Mutual aid relationship between the primary MCPTT system and
more than one partner MCPTT system
Other functional connectivity models can exist.
#### A.6.3.1.1 SIP INVITE request
The MCPTT server needs to distinguish between the following initial SIP INVITE
requests for originations and terminations:
\- SIP INVITE requests routed to the participating MCPTT function as a result
of processing initial filter criteria at the S-CSCF in accordance with the
origination procedures as specified in 3GPP TS 24.229 [4] with the Request-URI
set to a public service identity of the participating MCPTT function that
identifies the pre-established session set-up. Such requests are known as
\"SIP INVITE request for establishing a pre-established session\" in the
procedures in the present document;
\- SIP INVITE requests routed to the participating MCPTT function as a result
of processing initial filter criteria at the S-CSCF in accordance with the
origination procedures as specified in 3GPP TS 24.229 [4] and the Request-URI
is set to a public service identity of the participating MCPTT function that
does not identify the pre-established session set-up. Such requests are known
as \"SIP INVITE request for originating participating MCPTT function\" in the
procedures in the present document;
\- SIP INVITE requests routed to the participating MCPTT function as a result
of processing initial filter criteria at the S-CSCF in accordance with the
termination procedures as specified in 3GPP TS 24.229 [4] and the Request-URI
contains a PSI of the terminating participating MCPTT function. Such requests
are known as \"SIP INVITE request for terminating participating MCPTT
function\" in the procedures in the present document;
\- SIP INVITE requests routed to the controlling MCPTT function as a result of
PSI routing on the originating side in accordance with the originating
procedures as specified in 3GPP TS 24.229 [4], or as a result of direct PSI
routing, in accordance with the termination procedures as specified in 3GPP TS
24.229 [4], the Request-URI is set to a public service identity for MCPTT
private call and the Contact header field does not contain the isfocus media
feature tag specified in IETF RFC 3840 [16]. Such requests are known as \"SIP
INVITE request for controlling MCPTT function of a private call\" in the
procedures in the present document;
\- SIP INVITE requests routed to the controlling MCPTT function as a result of
PSI routing on the originating side in accordance with the originating
procedures as specified in 3GPP TS 24.229 [4], or as a result of direct PSI
routing, in accordance with the termination procedures as specified in 3GPP TS
24.229 [4], the Request-URI is set to a public service identity serving an
MCPTT group and the Contact header field does not contain the isfocus media
feature tag specified in IETF RFC 3840 [16]. Such requests are known as \"SIP
INVITE request for controlling MCPTT function of an MCPTT group\" in the
procedures in the present document;
\- SIP INVITE requests routed to the non-controlling MCPTT function of an
MCPTT group as a result of direct PSI routing, in accordance with the
termination procedures as specified in 3GPP TS 24.229 [4], the Request-URI is
set to a public service identity serving an MCPTT group and the Contact header
field contains the isfocus media feature tag specified in IETF RFC 3840 [16];
Such requests are known as \"SIP INVITE request for non-controlling MCPTT
function of an MCPTT group\" in the procedures in the present document;
[- SIP INVITE requests routed to the non-controlling MCPTT function as a
result of PSI routing on the originating side in accordance with the
originating procedures as specified in 3GPP TS 24.229 [4], or as a result of
direct PSI routing, in accordance with the termination procedures as specified
in 3GPP TS 24.229 [4] and the Request-URI is set to a public service identity
serving an MCPTT group hosted in a partner system. Such requests are known as
\"SIP INVITE request for non-controlling MCPTT function of an MCPTT group in a
partner system\" in the procedures in the present document;]{.underline}
\- SIP INVITE requests routed to the controlling MCPTT function as a result of
PSI routing on the originating side in accordance with the originating
procedures as specified in 3GPP TS 24.229 [4], or as a result of direct PSI
routing, in accordance with the termination procedures as specified in 3GPP TS
24.229 [4], the Request-URI is set to a public service identity for first-to-
answer call and the Contact header field does not contain the isfocus media
feature tag specified in IETF RFC 3840 [16]. Such requests are known as \"SIP
INVITE request for controlling MCPTT function of a first-to-answer call\" in
the procedures in the present document; and
\- SIP INVITE requests routed to the controlling MCPTT function as a result of
PSI routing on the originating side in accordance with the originating
procedures as specified in 3GPP TS 24.229 [4], or as a result of direct PSI
routing, in accordance with the termination procedures as specified in 3GPP TS
24.229 [4], the Request-URI is set to a public service identity for MCPTT
ambient listening call and the Contact header field does not contain the
isfocus media feature tag specified in IETF RFC 3840 [16]. Such requests are
known as \"SIP INVITE request for controlling MCPTT function of an ambient
listening call\" in the procedures in the present document.
##### A.6.3.3.1.12 Populate mcptt-info and location-info MIME bodies for
emergency alert
This subclause is referenced from other procedures.
This subclause describes the procedures for populating the
application/vnd.3gpp.mcptt-info+xml and application/vnd.3gpp.mcptt-location-
info+xml MIME bodies for an MCPTT emergency alert. The procedure is initiated
by the controlling MCPTT function when it has received a SIP request
initiating an MCPTT emergency alert and generates a message containing the
MCPTT emergency alert information required by 3GPP TS 23.379 [3].
The controlling MCPTT function:
1) shall include, if not already present, an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in Annex F.1, and set the \ element
to a value of \"true\";
[2) if the initiating user is homed in the same system as the controlling
MCPTT function:]{.underline}
a) shall determine the value of the MCPTT user\'s Mission Critical
Organization from the \ element, of the MCPTT
user profile document (see the MCPTT user profile document in 3GPP TS 24.484
[50]); and
b) shall include in the \ element containing the \
element containing an \ element set to the value of the MCPTT user\'s
Mission Critical Organization;
3) [if the initiating user is homed in a different system than the controlling
MCPTT function, shall copy the \ element containing the \ element containing an \ element from the incoming SIP request
to the outgoing SIP request;]{.underline} and
4) shall copy the contents of the application/vnd.3gpp.mcptt-location-info+xml
MIME body in the received SIP request into an application/vnd.3gpp.mcptt-
location-info+xml MIME body included in the outgoing SIP request.
##### [A.10.1.1.5.6 Procedures for SIP INVITE targeted to partner
system]{.underline}
[When receiving the \"SIP INVITE request for non-controlling MCPTT function of
an MCPTT group in a partner system\", the MCPTT server in the same system as
the participating MCPTT function acts as a non-controlling MCPTT function,
performs user profile checking and forwards the invite to the controlling
MCPTT function in the partner system.]{.underline}
[NOTE 1: This subclause is applicable to prearranged and chat group
calls.]{.underline}
[In the procedures in this subclause:]{.underline}
[1) MCPTT ID in an incoming SIP INVITE request refers to the MCPTT ID of the
originating user from the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request;]{.underline}
[2) group identity in an incoming SIP INVITE request refers to the group
identity from the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE
request;]{.underline}
[3) MCPTT ID in an outgoing SIP INVITE request refers to the MCPTT ID of the
called user in the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE
request;]{.underline}
[4) emergency indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and]{.underline}
[5) imminent peril indication in an incoming SIP INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME
body.]{.underline}
[Upon receipt of a \" SIP INVITE request for non-controlling MCPTT function of
an MCPTT group in a partner system\", the non-controlling MCPTT
function:]{.underline}
[1) shall reject the SIP request with a SIP 403 (Forbidden) response and not
process the remaining steps if:]{.underline}
[a) an Accept-Contact header field does not include the g.3gpp.mcptt media
feature tag; or]{.underline}
[b) an Accept-Contact header field does not include the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcptt\";]{.underline}
[2) if received SIP INVITE request includes an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ element included or an
\ element included, shall validate the request as described
in subclause 6.3.3.1.17;]{.underline}
[3) if received SIP INVITE request includes an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ and if the \ element is
set to \"true\" in the received SIP INVITE request and the requesting MCPTT
user and MCPTT group are authorised for the initiation of MCPTT emergency
alerts as determined by the procedures of subclause 6.3.4.5.1, shall populate
the application/vnd.3gpp.mcptt-info+xml MIME body and the
application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in
subclause 6.3.3.1.12. Otherwise, shall set the \ element to a value
of \"false\";]{.underline}
[Editor\'s note: Add subclause 6.3.4.5.1, based upon 6.3.3.1.13.1, modified
for the non-controlling function to only check for user profile
authorizations. Modify subclause 6.3.3.1.13.1 to remove any user profile
checking.]{.underline}
[4) if the SIP INVITE request contains an unauthorised request for an MCPTT
emergency group call as determined by subclause 6.3.4.5.2:]{.underline}
[Editor\'s note: Add subclause 6.3.4.5.2, based upon 6.3.3.1.13.2, modified
for the non-controlling function to only check for user profile
authorizations. Modify subclause 6.3.3.1.13.2 to remove any user profile
checking.]{.underline}
[a) shall reject the SIP INVITE request with a SIP 403 (Forbidden) response as
specified in subclause 6.3.3.1.14; and]{.underline}
[b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[5) if the SIP INVITE request contains an unauthorised request for an MCPTT
imminent peril group call as determined by subclause 6.3.4.5.6, shall reject
the SIP INVITE request with a SIP 403 (Forbidden) response with the following
clarifications:]{.underline}
[Editor\'s note: Add subclause 6.3.4.5.6, based upon 6.3.3.1.13.6, modified
for the non-controlling function to only check for user profile
authorizations. Modify subclause 6.3.3.1.13.6 to remove any user profile
checking.]{.underline}
[a) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with
the \ element containing the \ element with the
\ element set to a value of \"false\"; and]{.underline}
[b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[6) if a Resource-Priority header field is included in the SIP INVITE
request:]{.underline}
[a) if the Resource-Priority header field is set to the value indicated for
emergency calls and the SIP INVITE request does not contain an emergency
indication and the in-progress emergency state of the group is set to a value
of \"false\", shall reject the SIP INVITE request with a SIP 403 (Forbidden)
response and skip the rest of the steps; or]{.underline}
[b) if the Resource-Priority header field is set to the value indicated for
imminent peril calls and the SIP INVITE request does not contain an imminent
peril indication and the in-progress imminent peril state of the group is set
to a value of \"false\", shall reject the SIP INVITE request with a SIP 403
(Forbidden) response and skip the rest of the steps;]{.underline}
[7) shall determine the public service identity of the controlling MCPTT
function in the partner system associated with the group identity in the SIP
INVITE request;]{.underline}
[8) shall forward the SIP INVITE request to the controlling MCPTT function in
the partner system.]{.underline}
[NOTE 2: How the non-controlling MCPTT server discovers the public service
identity of the controlling MCPTT function in the partner system associated
with the group identity is out of scope of the current release.]{.underline}
[Upon receipt of a SIP 2xx, 4xx, 5xx or 6xx response to the above SIP INVITE
request, the participating MCPTT function:]{.underline}
[1) shall generate a SIP response according to 3GPP TS 24.229
[4];]{.underline}
[2) shall include any warning header field(s) that were received in the
incoming SIP response; and]{.underline}
[3) shall forward the SIP response to the originating participating MCPTT
server according to 3GPP TS 24.229 [4];]{.underline}
##### A.6.3.3.1.14 Generating a SIP 403 response for priority call request
rejection
If the [non-controlling or]{.underline} controlling MCPTT function has
received a SIP request with the \ element of the
application/vnd.3gpp.mcptt-info+xml MIME body is set to \"true\" and this is
an unauthorised request for an MCPTT emergency call as determined by the
procedures of [subclause 6.3.4.5.2 for the non-controlling function
or]{.underline} subclause 6.3.3.1.13.2 [for the controlling
function]{.underline}, the [non-controlling or]{.underline} controlling MCPTT
function shall:
1) include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in Annex F.1 with the \ element
containing the \ element with the \ element set
to a value of \"false\" and the \ element set to a value of
\"false\".
##### [A.10.1.1.5.7 Receipt of a SIP re-INVITE request]{.underline}
[In the procedures in this subclause:]{.underline}
[1) emergency indication in an incoming SIP re-INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and]{.underline}
[2) imminent peril indication in an incoming SIP re-INVITE request refers to
the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body.]{.underline}
[Upon receipt of a SIP re-INVITE request for an MCPTT session identity
identifying an on-demand prearranged MCPTT group session, the non-controlling
MCPTT function:]{.underline}
[1) if received SIP re-INVITE request includes an application/vnd.3gpp.mcptt-
info+xml MIME body with an \ element included or an
\ element included, shall validate the request as described
in subclause 6.3.3.1.17;]{.underline}
[2) if the received SIP re-INVITE request contains an unauthorised request for
an MCPTT emergency call as determined by subclause 6.3.4.5.2:]{.underline}
[a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response
as specified in subclause 6.3.3.1.14; and]{.underline}
[b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[3) if the received SIP re-INVITE request contains an imminent peril
indication set to \"true\" for an MCPTT imminent peril group call and this is
an unauthorised request for an MCPTT imminent peril group call as determined
by subclause 6.3.4.5.6, shall reject the SIP re-INVITE request with a SIP 403
(Forbidden) response with the following clarifications:]{.underline}
[a) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with
the \ element containing the \ element with the
\ element set to a value of \"false\"; and]{.underline}
[b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[4) if a Resource-Priority header field is included in the received SIP re-
INVITE request:]{.underline}
[a) if the Resource-Priority header field is set to the value indicated for
emergency calls and the SIP re-INVITE request does not contain an emergency
indication and the in-progress emergency state of the group is set to a value
of \"false\", shall reject the SIP re-INVITE request with a SIP 403
(Forbidden) response and skip the rest of the steps; and]{.underline}
[b) if the Resource-Priority header field is set to the value indicated for
imminent peril calls and the SIP re-INVITE request does not contain an
imminent peril indication and the in-progress imminent peril state of the
group is set to a value of \"false\", shall reject the SIP INVITE request with
a SIP 403 (Forbidden) response and skip the rest of the steps;]{.underline}
[5) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"true\" and is an authorised request to initiate an
MCPTT emergency group call as determined by subclause 6.3.4.5.2, the non-
controlling MCPTT function shall:]{.underline}
[a) if the received SIP INVITE contains an alert indication set to a value of
\"true\" and this is not an authorised request for an MCPTT emergency alert
meeting the conditions specified in subclause 6.3.4.5.1, shall remove the
\ from element of the application/vnd.3gpp.mcptt-info+xml MIME body
of the received SIP re-INVITE.]{.underline}
[6) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"false\" and is an unauthorised request for an
MCPTT emergency group call cancellation as determined by subclause
6.3.4.5.4:]{.underline}
[Editor\'s note: Add subclause 6.3.4.5.4, based upon 6.3.3.1.13.4, modified
for the non-controlling function to only check for user profile
authorizations. Modify 6.3.3.1.13.4 to remove any user profile
checks.]{.underline}
[a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden)
response;]{.underline}
[b) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in annex F.1 with
an \ element set to a value of \"true\";]{.underline}
[c) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[7) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \
element set to a value of \"false\" and is determined to be an authorised
request for an MCPTT emergency call cancellation as specified in subclause
6.3.3.1.16 and the in-progress emergency state of the group to is set to a
value of \"true\" the non-controlling MCPTT function:]{.underline}
[a) if an \ element of the application/vnd.3gpp.mcptt-info+xml MIME
body is included and set to \"false\" and is determined to be an unauthorised
request for an MCPTT emergency alert cancellation as specified in subclause
6.3.4.5.3 shall]{.underline} [remove the \ from element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP re-
INVITE.]{.underline}
[Editor\'s note: Add subclause 6.3.4.5.3, based upon 6.3.3.1.13.3, modified
for the non-controlling function to only check for user profile
authorizations. Modify 6.3.3.1.13.3 to remove any user profile
checks.]{.underline}
[8) if the received SIP re-INVITE request contains an imminent peril
indication and the in-progress emergency group state of the group is set to a
value of \"false\", shall perform the procedures specified in subclause
A.10.1.1.5.8 and skip the rest of the steps.]{.underline}
[9) shall forward the SIP re-INVITE request to the controlling MCPTT function
in the partner system.]{.underline}
[NOTE: How the non-controlling MCPTT server discovers the public service
identity of the controlling MCPTT function in the partner system associated
with the group identity is out of scope of the current release.]{.underline}
[]{.underline}
[Upon receipt of a SIP 2xx, 4xx, 5xx or 6xx response to the above SIP INVITE
request, the participating MCPTT function:]{.underline}
[1) shall generate a SIP response according to 3GPP TS 24.229
[4];]{.underline}
[2) shall include any warning header field(s) that were received in the
incoming SIP response; and]{.underline}
[3) shall forward the SIP response to the originating participating MCPTT
server according to 3GPP TS 24.229 [4];]{.underline}
##### A.10.1.1.5.8 Handling of a SIP re-INVITE request for imminent peril
session
[This procedure is initiated by the non-controlling MCPTT function as the
result of an action in subclause A.10.1.1.5.7.]{.underline}
[In the procedures in this subclause:]{.underline}
[1) imminent peril indication in an incoming SIP re-INVITE request refers to
the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body.]{.underline}
[When the non-controlling function receives a SIP re-INVITE request with an
imminent peril indication set to \"true\", the non-controlling
function:]{.underline}
[1) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is an unauthorised request for an MCPTT imminent peril group
call cancellation as determined by subclause 6.3.4.5.6 shall:]{.underline}
[a) reject the SIP re-INVITE request with a SIP 403 (Forbidden) response to
the SIP re-INVITE request; and]{.underline}
[b) include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in Annex F.1 with the \ element
containing the \ element with the \ element
set to a value of \"false\";]{.underline}
[c) send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4];
and]{.underline}
[d) skip the rest of the steps;]{.underline}
[2) shall forward the SIP re-INVITE request to the controlling MCPTT function
in the partner system.]{.underline}
[NOTE: How the non-controlling MCPTT server discovers the public service
identity of the controlling MCPTT function in the partner system associated
with the group identity is out of scope of the current release.]{.underline}
[Upon receipt of a SIP 2xx, 4xx, 5xx or 6xx response to the above SIP INVITE
request, the participating MCPTT function:]{.underline}
[1) shall generate a SIP response according to 3GPP TS 24.229
[4];]{.underline}
[2) shall forward the SIP response to the originating participating MCPTT
function according to 3GPP TS 24.229 [4];]{.underline}
##### [A.10.1.2.5.2 Receipt of a SIP re-INVITE request]{.underline}
[In the procedures in this subclause:]{.underline}
[1) emergency indication in an incoming SIP re-INVITE request refers to the
\ element of the application/vnd.3gpp.mcptt-info+xml MIME body;
and]{.underline}
2) imminent peril indication in an incoming SIP re-INVITE request refers to
the \ element of the [application/vnd.3gpp.mcptt-info+xml
MIME body.]{.underline}
[Upon receipt of a SIP re-INVITE request for an MCPTT session identity
identifying a chat MCPTT group session, the non-controlling MCPTT
function:]{.underline}
[1) if the received SIP re-INVITE request includes an
application/vnd.3gpp.mcptt-info+xml MIME body with an \ element
included or an \ element included, shall validate the
request as described in subclause 6.3.3.1.17;]{.underline}
[2) if the SIP re-INVITE request contains an unauthorised request for an MCPTT
emergency call as determined by subclause 6.3.4.5.2:]{.underline}
[a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response
as specified in subclause 6.3.3.1.14; and]{.underline}
[b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[3) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"true\" and is an authorised request to initiate an MCPTT emergency group
call as determined by subclause 6.3.4.5.2, the controlling MCPTT function
shall:]{.underline}
[a) if the in-progress emergency state of the group is set to a value of
\"true\" and the MCPTT user is indicating a new emergency
indication:]{.underline}
[i) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of \"true\"
and is an unauthorised request for an MCPTT emergency alert as determined by
subclause 6.3.4.5.1, shall c remove the \ from element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP re-
INVITE.]{.underline}
[b) if the in-progress emergency state of the group is set to a value of
\"false\":]{.underline}
[i) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of \"true\"
and this is an authorised request for an MCPTT emergency alert as specified in
subclause 6.3.4.5.1, shall remove the \ from element of the
application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP re-
INVITE.]{.underline}
[4) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is an unauthorised request for an MCPTT emergency group call
cancellation as determined by subclause 6.3.4.5.4:]{.underline}
[a) shall reject the SIP re-INVITE request with a SIP 403 (Forbidden)
response;]{.underline}
[b) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in annex F.1 with
an \ element set to a value of \"true\";]{.underline}
[c) if an \ element of the application/vnd.3gpp.mcptt-info+xml MIME
body is included set to \"false\" and there is an outstanding MCPTT emergency
alert for the MCPTT user, shall include in the application/vnd.3gpp.mcptt-
info+xml MIME body and \ element set to a value of \"true\";
and]{.underline}
[d) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[5) if the received SIP re-INVITE request contains an imminent peril
indication, shall perform the procedures specified in subclause A.10.1.2.5.3
and skip the rest of the steps;]{.underline}
[6) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to a value of \"true\" and if this is an unauthorised request for an MCPTT
emergency alert as determined by subclause 6.3.4.5.1, shall include in the SIP
200 (OK) response the warning text set to \"149 SIP INFO request pending\" in
a Warning header field as specified in subclause 4.4;]{.underline}
[7) if the received SIP re-INVITE request contains an
application/vnd.3gpp.mcptt-info+xml MIME body with the \ element
set to a value of \"false\" and if this is an unauthorised request for an
MCPTT emergency alert cancellation as determined by subclause 6.3.4.5.3, shall
include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO
request pending\" in a Warning header field as specified in subclause
4.4;]{.underline}
[NOTE 1: In this case, the request was for an imminent peril call but a higher
priority MCPTT emergency call was already in progress on the group. Hence, the
imminent peril call request aspect of the request is denied but the request is
granted with emergency level priority.]{.underline}
[8) shall forward the SIP re-INVITE request to the controlling MCPTT function
in the partner system.]{.underline}
[NOTE 2: How the non-controlling MCPTT server discovers the public service
identity of the controlling MCPTT function in the partner system associated
with the group identity is out of scope of the current release.]{.underline}
[Upon receiving a SIP 200 (OK) response to the forwarded SIP re-INVITE, the
non-controlling MCPTT function shall:]{.underline}
[2) forward the SIP 200 (OK) response to the originating participating MCPTT
function.]{.underline}
[Upon receiving a SIP ACK to the SIP 200 (OK) response sent towards the
inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning
text set to \"149 SIP INFO request pending\" in a Warning header field as
specified in subclause 4.4, the controlling MCPTT function shall follow the
procedures in subclause 6.3.3.1.18, where the non-controlling function
performs the controlling role.]{.underline}
##### [A.10.1.2.5.3 Handling of a SIP re-INVITE request for imminent peril
session]{.underline}
[In the procedures in this subclause:]{.underline}
[1) imminent peril indication in an incoming SIP re-INVITE request refers to
the \ element of the application/vnd.3gpp.mcptt-info+xml
MIME body.]{.underline}
[When the non-controlling function receives a SIP re-INVITE request with and
imminent peril indication, the non-controlling function:]{.underline}
[1) if the SIP re-INVITE request contains an unauthorised request for an MCPTT
imminent peril group call as determined by subclause 6.3.4.5.5, shall reject
the SIP re-INVITE request with a SIP 403 (Forbidden) response with the
following clarifications:]{.underline}
[Editor\'s note: Add subclause 6.3.4.5.5, based upon 6.3.3.1.13.5, modified
for the non-controlling function to only check for user profile
authorizations.]{.underline}
[a) shall include in the SIP 403 (Forbidden) response an
application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with
the \ element containing the \ element with the
\ element set to a value of \"false\"; and]{.underline}
[b) shall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229
[4] and skip the rest of the steps;]{.underline}
[2) if the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-
info+xml MIME body with the \ element set to a value of
\"false\" and is an unauthorised request for an MCPTT imminent peril group
call cancellation as determined by subclause 6.3.4.5.6 shall:]{.underline}
[a) reject the SIP re-INVITE request with a SIP 403 (Forbidden) response to
the SIP re-INVITE request; and]{.underline}
[b) include in the SIP 403 (Forbidden) response:]{.underline}
[i) include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-
info+xml MIME body as specified in Annex F.1 with the \ element
containing the \ element with the \ element
set to a value of \"false\";]{.underline}
[ii) send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4];
and]{.underline}
[iii) skip the rest of the steps;]{.underline}
[3) shall forward the SIP re-INVITE request to the partner
system.]{.underline}
[NOTE: How the non-controlling MCPTT server discovers the public service
identity of the partner system associated with the group identity is out of
scope of the current release.]{.underline}
[Upon receiving a SIP 200 (OK) response to the forwarded SIP re-INVITE, the
non-controlling MCPTT function shall:]{.underline}
[1) forward the SIP 200 (OK) response to the originating participating MCPTT
function.]{.underline}
###### ## Annex B (normative): IWF MCData media feature tags supported within
the current document
> Editor's Note: This Annex is based on 3GPP TS 24.282 [82] Annex B.
# B.1 General
This clause describes the media feature tag definitions that are applicable
for the 3GPP IM CN Subsystem for the realisation of the Mission Critical Data
(MCData) service.
# B.2 Definition of media feature tag for Mission Critical Data (MCData)
communications Short Data Service (SDS)
The IWF shall support the media feature tag(s) specified in 3GPP TS 24.282
[82] clause B.2.
# B.3 Definition of media feature tag for Mission Critical Data (MCData)
communications File Distribution (FD)
The IWF does not support the media feature tag(s) specified in 3GPP TS 24.282
[82] clause B.3 in the present document.
###### ## Annex C: (normative): IWF MCData ICSI values supported within the
current document
Editor's Note: This Annex is based on 3GPP TS 24.282 [82] Annex C
# C.1 General
This subclause describes the IMS Communications Service Identifier (ICSI)
definitions that are applicable for the 3GPP IM CN Subsystem for the
realisation of the Mission Critical Data (MCData) service.
# C.2 Definition of ICSI value for the Mission Critical Data (MCData) service
The IWF shall support the ICSI value(s) specified in 3GPP TS 24.282 [82]
clause C.2.
# C.3 Definition of ICSI value for the Mission Critical Data (MCData)
communications Short Data Service (SDS)
The IWF shall support the ICSI value(s) specified in 3GPP TS 24.282 [82]
clause C.3.
# C.4 Definition of ICSI value for Mission Critical Data (MCData)
communications File Distribution (FD)
The IWF does not support the ICSI value(s) specified in 3GPP TS 24.282 [82]
clause C.4 in the present document.
###### ## Annex D (normative): IWF MCData XML schemas
Editor's Note: This Annex is based on 3GPP TS 24.282 [82] Annex D.
The IWF shall support the XML schemas specified in 3GPP TS 24.282 [82] Annex
D.
###### ## Annex F (normative): IWF MCData Timers
Editor's Note: This Annex is based on 3GPP TS 24.282 [82] Annex F.
# F.1 General
The following tables give a brief description of the timers used in the
present document.
For the on-network timers described in the present document, the following
timer families are used:
\- TDPx: Timer Data Participating function x; and
\- TDCy: Timer Data Controlling function y.
where x and y represent numbers.
## F.2 On-network timers
## F.2.1 Timers in the IWF performing the MCData participating role
Timers in the IWF performing the participating MCData role towards a user
homed in the IWF are out of scope of the present document.
## F.2.2 Timers in the IWF performing the MCData controlling role
Table F.2.2-1: IWF performing the MCData controlling role timers
+-------------+-------------+-------------+-------------+-------------+ | Timer | Timer value | Cause of | Normal stop | On expiry | | | | start | | | +-------------+-------------+-------------+-------------+-------------+ | TDC1 | Default | On | On | Send the | | ( | value: 5 | reception | reception | aggregated | | disposition | seconds | of a \"SIP | of a \"SIP | disposition | | n | | MESSAGE | MESSAGE | no | | otification | Co | request for | request for | tifications | | timer) | nfigurable. | SDS | SDS | to the | | | | disposition | disposition | MCData | | (NOTE 1) | | n | n | user. | | | | otification | otification | | | | | for MCData | for MCData | | | | | server\" | server\" | | | | | from a | from a | | | | | group | group | | | | | member and | member | | | | | aggregation | where | | | | | of | aggregation | | | | | d | of | | | | | ispositions | disposition | | | | | is | no | | | | | required. | tifications | | | | | | is required | | | | | | and all | | | | | | other | | | | | | disposition | | | | | | no | | | | | | tifications | | | | | | have been | | | | | | received | | | | | | from all | | | | | | other group | | | | | | members | | +-------------+-------------+-------------+-------------+-------------+ | TDC3 | Default | Upon | Upon | Release the | | (request | value: 15 | receiving | receiving | MCData | | for | seconds | SIP 200 | request for | co | | extension) | | (OK) from | extension | mmunication | | | Co | MCData | of MCData | i | | | nfigurable. | client for | co | mmediately. | | | | the SIP | mmunication | | | | | INFO | from MCData | | | | | message | client. | | | | | sent as | | | | | | intent to | | | | | | release | | | | | | co | | | | | | mmunication | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: | | | | | | More than | | | | | | one | | | | | | instance of | | | | | | this timer | | | | | | can be | | | | | | running in | | | | | | the | | | | | | controlling | | | | | | MCData | | | | | | function, | | | | | | each | | | | | | instance | | | | | | associated | | | | | | with a | | | | | | specific | | | | | | group SDS | | | | | | message. | | | | | +-------------+-------------+-------------+-------------+-------------+
###### ## Annex G (normative): IWF counters and states
Editor's Note: This Annex is based on 3GPP TS 24.282 [82] Annex G.
# G.1 General
The following tables give a brief description of counters and states used in
the present document.
# G.2 On-network counters
None defined.
# G.3 Off-network counters
The IWF performing the role of an MCData server does not support off-network
counters in the present document.
# G.4 On-network emergency related states
The IWF acting on behalf of users homed in the IWF shall support the on-
network emergency related states specified in 3GPP TS 24.282 [82] clause G.4
in messaging passing over the IWF-1 interface.
###### ## Annex H (informative): IWF INFO packages defined in the present
document
Editor's Note: This Annex is based on 3GPP TS 24.282 [82] Annex H.
The IWF with respect to communications with the MCData system, supports the
INFO packages defined in 3GPP TS 24.282 [82] Annex H.
# Annex I: Proposed changes to 3GPP TS 24.379 [81] for XML schema
## I.1 General
Editor\'s note: The subclauses in this annex are intended to be applied as CRs
to 3GPP TS 24.379 [81] directly, whether or not the other clauses in the
present document become a new TS or are moved to existing TSs. The letter I is
prepended to target 3GPP TS 24.379 [81] subclause title numbers. References
within the subclauses do not prepend the letter I since the text body will be
directly ported to 3GPP TS 24.379 [81]. The following markup is required, so
that it survives when tracking is cleared on the TR and still indicate the
changes required to 3GPP TS 24.379 [81]: deleted text is highlighted in red,
added text highlighted in green. Additionally, added text will be with
underlined font and deleted text will be with a strikethru font.
## I.F.1.2 XML schema
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
[\]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[ \]{.underline}
[]{.underline}
[ \]{.underline}
[ \]{.underline}
[]{.underline}
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
## I.F.1.3 Semantic
The \ element is the root element of the XML document. The
\ element can contain subelements.
NOTE 1: The subelements of the \ are validated by the \ particle of the \ element
If the \ contains the \ element then:
1) the \, \, \,
\, \, \,
\, \, \ and \
can be included with encrypted content;
2) for each element in 1) that is included with content that is not encrypted:
a) the element has the \"type\" attribute set to \"Normal\";
b) if the element is the \, \,
\ or \ or \ then
the \ element is included;
c) if the element is the \ or \, then the
\ element is included; and
d) if the element is \, \, \ or
\ elements then the \ element is included;
[and]{.underline}
3) for each element in 1) that is included with content that is encrypted:
a) the element has the \"type\" attribute set to \"Encrypted\";
b) the \ element from the
\"http://www.w3.org/2001/04/xmlenc#\" namespace is included and:
i) can have a \"Type\" attribute can be included with a value of
\"http://www.w3.org/2001/04/xmlenc#Content\";
ii) can include an \ element with the \"Algorithm\"
attribute set to value of \"http://www.w3.org/2009/xmlenc11#aes128-gcm\";
iii) can include a \ element with a \ element containing the
base 64 encoded XPK-ID; and
iv) includes a \ element with a \ element containing
the encrypted data.
NOTE 2: When the optional attributes and elements are not included within the
\ element, the information they contain is known to sender
and the receiver by other means.
If the \ contains the \ element then:
1) the \ can be included with the access token received
during authentication procedure as described in 3GPP TS 24.482 [49];
2) the \ can be included with:
a) a value of \"chat\" to indicate that the MCPTT client wants to join a chat
group call
b) a value of \"prearranged\" to indicate the MCPTT client wants to make a
prearranged group call;
c) a value of \"private\" to indicate the MCPTT client wants to make a private
call;
d) a value of \"first-to-answer\" to indicate that the MCPTT client wants to
make a first-to-answer call; or
e) a value of \"ambient-listening\" to indicate the MCPTT client wants to make
an ambient listening call;
3) the \ can be included with:
a) a value set to an MCPTT group ID or temporary MCPTT group ID when the
\ is set to a value of \"prearranged\" or \"chat\"; and
b) a value set to the MCPTT ID of the called MCPTT user when the \ is set to a value of \"private\";
4) the \ can be included, set to MCPTT ID of the
originating user;
5) the \ can be included, set to the MCPTT ID of the
terminating user;
6) the \ can be included to indicate the MCPTT group
identity to the terminating user;
7) the \ can be included in a SIP 183 (Session Progress) from a non-
controlling MCPTT function of an MCPTT group to inform the controlling MCPTT
function that the group on the non-controlling MCPTT function has group
members in the group document which are marked as \, as
specified in 3GPP TS 24.481 [31];
8) the \ can be:
a) set to \"true\" to indicate that the call that the MCPTT client is
initiating is an emergency MCPTT call; or
b) set to \"false\" to indicate that the MCPTT client is cancelling an
emergency MCPTT call (i.e. converting it back to a non-emergency call);
9) the \ can be:
a) set to \"true\" in an emergency call initiation to indicate that an alert
to be sent; or
b) set to \"false\" when cancelling an emergency call which requires an alert
to be cancelled also;
10) if the \ is set to \"chat\" or \"prearranged\":
a) the \ can be set to \"true\" to indicate that the call
that the MCPTT client is initiating is an imminent peril group MCPTT call;
11) the \ can be:
a) set to \"true\" indicates that the MCPTT client is initiating a broadcast
group call; or
b) set to \"false\" indicates that the MCPTT client is initiating a non-
broadcast group call;
12) the \ can be:
a) set to the MCPTT user\'s Mission Critical Organization in an emergency
alert sent by the MCPTT server to terminating MCPTT clients;
13) the \ can be:
a) set to \"floor-idle\", if the floor is idle in a non-controlling MCPTT
function; or
b) set to \"floor-taken\" if the floor state in a non-controlling MCPTT
function is taken;
14) the \:
a) if the \ element contains a group identity then this
element can include an MCPTT group ID associated with the group identity in
the \ element. E.g. if the \ element
contains a temporary group identity (TGI), then the \
element can contain the constituent MCPTT group ID;
15) the \:
a) can be included, set to the MCPTT ID of the originating user of an MCPTT
emergency alert when being cancelled by another authorised MCPTT user;
16) the \:
a) contains a group key transport payload carrying one or more MKFC(s) and
MKFC-ID(s) as described in3GPP TS 24.481 [31] subclause 7.4, to be used for
protection of multicast floor control signalling when the UE operates on the
network;
17) the \:
a) can be included, set to the MCPTT client ID of the MCPTT client that
originated a SIP INVITE request, SIP REFER request or SIP MESSAGE request;
18) the \
a) can be set to true and included in a SIP MESSAGE to indicate that the
emergency alert or cancellation was received successfully; ~~and~~
19) the \ can be included with the following elements not declared in
the XML schema:
a) an \ of type \"xs:string\":
i) set to a value of \"remote-init\" when the listening MCPTT user of an
ambient listening call initiates the call; or
ii) set to a value of \"local-init\" when the listened-to MCPTT user of an
ambient listening call initiates the call; ~~and~~
b) a \ of type \"xs:string\":
i) set to a value of \"private-call-expiry\" when the ambient listening call
is release due to the expiry of the private call timer;
ii) set to a value of \"administrator-action\" when the ambient listening call
is released by an MCPTT administrator;
iii) set to a value of \"not selected for call\" when the when a dialog is
released with an MCPTT client that was not selected as the terminating client
of a first-to-answer call;
iv) set to a value of \"call-request-for-listened-to-client\" when there is a
call request targeted to the listened-to client;
v) set to a value of \"call-request-initiated-by-listened-to-client\" when
there is a call request initiated by the listened-to client; or
vi) set to a value of \"authentication of the MIKEY-SAKE I_MESSAGE failed\" by
a MCPTT client when the signature of the cannot be verified;
c) a \ of type \"xs:string\":
i) set to value of \"private-call-call-back-request\" when a client initiates
a private call call-back request;
ii) set to a value of \"private-call-call-back-cancel-request\" when a client
initiates a private call call-back cancel request;
iii) set to a value of \"group-selection-change-request\" when a client
initiates a group selection change request;
iv) set to a value of \"remotely-initiated-group-call-request\" when a client
initiates a remotely initiated group call request; or
v) set to a value of \"remotely-initiated-private-call-response\" when a
client responds to a remotely initiated private call request;
d) a \ of type \"xs:string\":
i) set to a value of \"private-call-call-back-response\" when a client
responds to a private call call-back request;
ii) set to a value of \"private-call-call-back-cancel-response\" when a client
responds to a private call call-back cancel request;
iii) set to a value of \"group-selection-change-response\" when a client
responds to a group selection change request;
iv) set to a value of \"remotely-initiated-group-call-response\" when a client
responds to a remotely initiated call request; or
v) set to a value of \"remotely-initiated-private-call-response\" when a
client responds to a remotely initiated private call request;
e) an \ of type \"xs:string\":
(i) set to a value of \"low\", \"normal\" or \"high\" to indicate the urgency
of a private call call-back request; ~~and~~
f) a \ of type \"xs:dateTime\":
(i) set to the date and time at which the private call call-back request was
initiated, in the form: \"YYYY-MM-DDThh:mm:ss\" where:
\- YYYY indicates the year;
\- MM indicates the month;
\- DD indicates the day;
\- T indicates the start of the required time section;
\- hh indicates the hour;
\- mm indicates the minute; and
\- ss indicates the second;
g) a \ of type \"xs:string\":
i) set to a value of \"success\" when a client reports that it has
successfully changed its selected group as requested by a received group
selection change request; or
ii) set to a value of \"fail\" when a client reports that it has failed to
change its selected group as requested by a received group selection change
request;
h) an\ of type \"xs:Boolean\":
i) set to a value of \"true\" when received by a client in a group-selection-
change-request indicates that the client needs to affiliate to the specified
group;
i) a \ of type \"xs:string\":
i) set to a value of \"success\" when a client reports that it has
successfully initiated a call requested by a received remotely initiated call
request; or
ii) set to a value of \"fail\" when a client reports that it has failed to
initiate a call triggered as requested by a received group selection change
request;
j) a \ of type \"xs:Boolean\":
i) set to a value of \"true\" when the remote user is to be notified of a
remotely initiated call request; or
ii) set to a value of \"false\" when the remote user is to be notified of a
received remotely initiated call request;
k) a \ of type \"mcpttinfo:contentType\" set to a value
of the functional-alias that is used together with the \"mcptt-calling-user-
id\";
l) an \ of type \"xs:Boolean\":
i) set to a value of \"true\" when the MCPTT client has entered an emergency
alert area; or
ii) set to a value of \"false\" when the MCPTT client has exited an emergency
alert area;
m) an \ of type \"xs:Boolean\":
i) set to a value of \"true\" when the MCPTT client has entered a group
geographic area; or
ii) set to a value of \"false\" when the MCPTT client has exited a group
geographic area; and
[n) a \ element, when responding to a SIP INVITE for a
private call, with the following elements:]{.underline}
[i) an element indicating support for the type of floor control:]{.underline}
[A) if the client supports private calls with floor control and the offer if
for floor control, shall include a \ element;]{.underline}
[B) if the client supports private calls without floor control and the offer
is for no floor control, shall include a \
element;]{.underline}
[ii) an element indicating support for type of first talker:]{.underline}
[A) if the client supports not talking first and the offer is for the caller
to talk first, shall include an \ element; or]{.underline}
[B) if the client supports talking first and the offer is for the receiver to
talk first, shall include a \ element;
and]{.underline}
[iii) an element indicating support for type of first talker:]{.underline}
[A) if the client supports private calls with automatic commencement mode and
the offer is for automatic commencement mode, shall include a
\ element; or]{.underline}
[B) if the client supports private calls with manual commencement mode and the
offer is for manual commencement mode, shall include a \
element.]{.underline}
[NOTE: The \ element is included in responses only from
the IWF.]{.underline}
Absence of the \, \ and \ in a
SIP INVITE request indicates that the MCPTT client is initiating a non-
emergency private call or non-emergency group call.
Absence of the \ in a SIP INVITE request indicates that the
MCPTT client is initiating a non-broadcast group call.
Absence of the \ in a SIP 200 (OK) response from the non-
controlling MCPTT function indicates that the floor is idle.
The recipient of the XML ignores any unknown element and any unknown
attribute.
#
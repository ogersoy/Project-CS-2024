# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides the protocol details for the Customized Alerting
Tones (CAT) service in the IP Multimedia (IM) Core Network (CN) subsystem
based on the requirements from 3GPP TS 22.182 [2].
The CAT service is an operator specific service by which an operator enables
the subscriber to customize the media which is played to the calling party
during alerting of the called party.
The present document is applicable to User Equipment (UE) and Application
Servers (AS) which are intended to support the CAT service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.182: \"Customized Alerting Tones (CAT) Requirements; Stage 1\".
[3] 3GPP TS 24.238: \"Session Initiation Protocol (SIP) based user
configuration; Stage 3\".
[4] 3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol
based on Session Initiation Protocol (SIP) and Session Description Protocol
(SDP); Stage 3\".
[5] RFC 3262: \"Reliability of Provisional Responses in the Session Initiation
Protocol (SIP)\".
[6] 3GPP TS 24.623: \"Extensible Markup Language (XML) Configuration Access
Protocol (XCAP) over the Ut interface for Manipulating Supplementary
Services\".
[7] RFC 3959: \"The Early Session Disposition Type for the Session Initiation
Protocol (SIP)\".
[8] RFC 3960: \"Early Media and Ringing Tone Generation in the Session
Initiation Protocol (SIP)\".
[9] RFC 5009 (September 2007): \"Private Header (P-Header) Extension to the
Session Initiation Protocol (SIP) for Authorization of Early Media\".
[10] 3GPP TS 24.607: \"Originating Identification Presentation (OIP) and
Originating Identification Restriction (OIR) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[11] RFC 6086 (January 2011): \"Session Initiation Protocol (SIP) INFO Method
and Package Framework\".
[12] RFC 4796 (February 2007): \"The Session Description Protocol (SDP)
Content Attribute\".
[13] RFC 3311: \"The Session Initiation Protocol (SIP) UPDATE Method\".
[14] 3GPP TS 24.628: \"Common Basic Communication procedures; Protocol
specification\".
[15] RFC 4566: \"SDP: Session Description Protocol\".
[16] 3GPP TS 24.174: \"Support of Multi-Device and Multi-Identity in IMS;
Stage 3\".
[17] RFC 3312: \"Integration of Resource Management and Session Initiation
Protocol (SIP)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
B2BUA Back-to-Back User Agent
CAT Customized Alerting Tones
DTMF Dual Tone Multi Frequency
MRF Media Resource Function
# 4 Customized Alerting Tones (CAT)
## 4.1 Introduction
The CAT service is an operator specific service by which an operator enables
the subscriber to customize the media which is played to the calling party
during alerting of the called party. The media can consist of favourable
songs, multi-media clips or other customized alerting tones. CAT service
should not negatively affect the conversation between calling and called
parties.
## 4.2 Description
### 4.2.1 General description
The service user is able to subscribe to the CAT service, activate (or de-
activate) the service, and update the settings, e.g., to change by
configuration the active CAT media. The media can consist of favourable songs,
multimedia clips or other customized alerting tones. The CAT subscriber is
able to refine the CAT media selection behaviour with configured rules, e.g.
time, calling party\'s location, called party\'s location, the identity of the
calling and called party. The CAT service is able to select the appropriate
CAT media according to the rules.
CAT is a terminating network service, but can also have an originating network
functional component. That is, CAT media can be selected on behalf of the
called subscriber for playback to the calling party, but the calling (IMS)
subscriber can also subscribe to and activate the CAT service. In such a case,
the CAT media selected by the calling party takes precedence for playback
purposes over that selected by the called party. Whether or not the calling
party's CAT media has precedence over the called party\'s selected CAT media
is a matter of configuration in the calling party's (originating) network.
The start of playback of the selected CAT media toward the calling party
occurs some time following the initiation of a session, but prior to session
answer. When the called party answers, playback of the CAT media either stops
or continues to play during the conversation, depending on operator or user
preferences. When the CAT media is playing, the calling party is able to stop
(e.g. mute) it.
## 4.3 Operational requirements
### 4.3.1 Provision/withdrawal
#### 4.3.1.1 CAT provision/withdrawal
The CAT service may be provided after prior arrangement with the service
provider.
The CAT service may be withdrawn at the subscriber's request or for
administrative reasons.
#### 4.3.1.2 Requirements on the originating network side
The originating network side may support the \"early-session\" extension as
described in RFC 3959 [7].
NOTE 1: the CAT service implementing the early-session model needs the early-
session extension to be supported by intermediate entities and the originating
UE, else CAT media can not be provided to the caller.
The CAT service implementing the forking model and gateway model add no
additional requirements on the originating network side.
For the early session model, if the CAT service is provided by the originating
network, the CAT AS shall control an MRF as described in 3GPP TS 24.229 [4]
that is acting on behalf of a calling subscriber who has activated CAT.
NOTE 2: The interworking between different models for CAT service is out of
scope of this specification.
#### 4.3.1.3 Requirements on the terminating network side
For the early session model, if the CAT service is provided by the terminating
network, the CAT AS shall control an MRF as described in 3GPP TS 24.229 [4]
that is acting on behalf of a called subscriber who has activated CAT.
NOTE: The interworking between different models for CAT service is out of
scope of this specification.
## 4.4 Syntax requirements
There are no special SIP syntax requirements for the CAT service.
## 4.5 Signalling procedures
### 4.5.1 General
Configuration of supplementary services by the user should:
\- take place over the Ut interface using XCAP as enabling protocol as
described in 3GPP TS 24.623 [6]; or
\- use SIP based user configuration as described in 3GPP TS 24.238 [3];
NOTE: Other possibilities for user configuration, such as web-based
provisioning or pre-provisioning by the operator are outside the scope of the
present document, but are not precluded.
The details of the Ut interface based user configuration of CAT service are
not specified in this version of the document.
### 4.5.2 Activation/deactivation
The CAT service is activated at provisioning and deactivated at withdrawal.
When a CAT service is activated a subscriber can specify which CAT a calling
user should experience, or use the operator\'s default setting.
After a subscriber has activated their CAT service a calling user experiences
the CAT that was chosen by the subscriber.
### 4.5.3 Registration/erasure
The CAT service requires no registration. Erasure is not applicable.
### 4.5.4 Interrogation
For CAT, interrogation is not applicable.
### 4.5.5 Invocation and operation
#### 4.5.5.1 Actions at the originating UE
##### 4.5.5.1.1 General
The UE shall follow the procedures specified in 3GPP TS 24.229 [4] for session
initiation and termination.
If the originating UE supports the early session mechanism then the UE shall
make use of the procedures as specified in RFC 3959 [7].
The originating UE shall follow the actions at the originating UE in 3GPP TS
24.628 [14] with addition that the UE may play CAT media if an early media
session is already established between the UE and the CAT AS, independently of
receiving 180 (Ringing) response.
##### 4.5.5.1.2 UE Actions for CAT copy
In order for the calling party to copy the media for the CAT service, the UE
shall send a specific DTMF digit for CAT copy to the AS.
NOTE: The definition of which DTMFs are used is outside the scope of this
specification and is dependant on the implementation of operator.
##### 4.5.5.1.3 UE Actions for CAT stop
In order for the calling party to stop the media for the CAT service, the UE
shall send a specific DTMF digit for CAT stop to the AS.
In order for the calling party to restart the media for the CAT service, the
UE shall send a specific DTMF digit for CAT restart to the AS.
NOTE: The definition of which DTMFs are used is outside the scope of this
specification and is dependant on the implementation of operator.
##### 4.5.5.1.4 UE support of DTMF
In addition to indicating support of the telephone-event media subtype in the
SDP offer, as defined in 3GPP TS 24.229 [4], the UE shall indicate support the
SIP INFO mechanism for DTMF transport, as defined in 3GPP TS 24.229 [4], by
including a Recv-Info header field with a \"infoDtmf\" value, as defined in
IETF RFC 6086 [11].
NOTE: For telephone-event based DTMF transport, the DTMF digits are sent to
the AS via an MRF.
The AS will indicate to the UE which DTMF transport mechanism to use for CAT
control.
#### 4.5.5.2 Actions at the AS serving the originating UE
##### 4.5.5.2.1 General
The procedures specified in 3GPP TS 24.229 [4] for an AS acting as a routing
B2BUA apply with additions described in the subclauses below.
If the initial INVITE originated from the served user includes a Supported
header field with \"early-session\" option-tag and the AS supports the
\"early-session\" extension as described in RFC 3959 [7], the AS shall based
on operator policy follow the procedures in subclause 4.5.5.2.3 to provide CAT
service. The procedures in subclause 4.5.5.2.3 shall not be used if there are
intermediaries in the network that do not understand the procedures.
The interactions between the AS and the MRF are described in 3GPP TS 24.229
[4].
##### 4.5.5.2.2 AS Actions for forking model
The AS performing the forking model shall follow the procedure as specified in
annex D in 3GPP TS 24.628 [14] with the additional procedures described in
this subclause.
If the terminating network provides early media (e.g. CAT service) towards the
originating UE, the AS decides which CAT service should have priority based on
the operator policy and the calling CAT service subscriber's preferences. The
procedures in this subclause are applicable if the CAT service provided by the
AS serving the originating UE has priority. If the CAT service provided by the
AS serving the originating UE has no priority, the AS does not perform any CAT
specific procedures. The AS can determine whether the terminating network
provides early media if the AS receives a P-Early-Media header field with a
\"sendrecv\" value or a \"sendonly\" value.
Upon receiving an initial SIP INVITE request destined to the terminating UE,
the AS shall:
a) based on local policy remove the P-Early-Media header field, if present;
b) forward the initial SIP INVITE request to the terminating UE;
c) contact the MRF to request CAT resources; and
d) send a reliable SIP 183 (Session Progress) response to the originating UE.
The AS shall include in the SIP 183 (Session Progress) provisional response:
\- a P-Asserted-Identity header field containing the public user identity of
the terminating UE unless privacy policy or restriction services prevent
providing any public user identity of the terminating party;
\- a To header field with a To tag locally generated by the AS;
\- a P-Early-Media header field with a \"sendrecv\" value or a \"sendonly\"
value;
\- an SDP answer, based on information received from the MRF. The AS shall
include an SDP a=content media-level attribute, as specified in RFC 4796 [12],
with a \"g.3gpp.cat\" value in the SDP answer; and
\- if a Supported header field with an option tag \" precondition\" was
received in the initial INVITE request and the AS decides to use the
precondition mechanism , an indication in the SDP answer that the local
preconditions are fulfilled.
If preconditions are used, the AS shall not instruct the MRF to start
applicable media for the CAT service before the originating UE has indicated
that preconditions are fulfilled. The point when the AS instructs the MRF to
start applicable media for the CAT service is based on local policy. If the AS
can provide CAT media for media lines not included in the original SDP offer
and the UE in the Contact header field included media feature tags indicating
support for the additional media, the AS shall send an UPDATE request towards
the UE in the dialog with a negotiated SDP. The AS shall include in this
UPDATE request:
a) an SDP offer based on an offer from the MRF with any new media lines placed
after the existing media-lines. The AS shall include an SDP a=content media-
level attribute, as specified in RFC 4796 [12], with a \"g.3gpp.cat\" value in
all the media lines;
b) a P-Early-Media header field with a \"sendrecv\" value or a \"sendonly\"
value; and
c) if preconditions are used, an indication in the SDP offer that local
preconditions are fulfilled.
NOTE 1: The AS can, based on local policy, wait to send the SIP 183 (Session
Progress) response to the originating UE until the AS has received a SIP 180
(Ringing) provisional response from the terminating UE.
NOTE 2: The AS can, based on local policy, wait to instruct the MRF to start
CAT media until the AS has received a SIP 180 (Ringing) provisional response
from the terminating UE.
NOTE 3: The interaction between the AS and MRF is not specified for the CAT
service but can use the Cr reference point as described in 3GPP TS 24.229 [4].
NOTE 4: If the AS acts as a Proxy and does not want to remain in the
signalling path between the originating UE and the terminating UE, the AS does
not need to add its own SIP-URI to the SIP Record-Route header field. If the
AS acts as a B2BUA, the AS will always remain in the signalling path.
NOTE 5: The AS can, if it supports the P-Early-Media header field, based on
local policy choose to not provide the CAT service to the originating UE if
the initial INVITE request does not contain a P-Early-Media header field with
a \"supported\" value.
Upon receiving a reliable provisional response from a terminating UE
containing an SDP answer to the original SIP INVITE request, the AS:
a) may forward the provisional response to the originating UE reliably;
b) may, unless the provisional response contained a 199 response code, change
the response code to SIP 183 (Session Progress) response;
c) shall insert a P-Early-Media header field, or modify an existing header
field, with an \"inactive\" value before forwarding the provisional response;
d) shall, if the reliable provisional response is not forwarded to the
originating UE, acknowledge the received provisional response by sending a SIP
PRACK request as defined in RFC 3262 [5] to the terminating UE; and
e) shall, if the reliable provisional response contained an SDP answer and the
provisional response is not forwarded to the originating UE, save the SDP
answer contained in the reliable provisional response for that particular
early dialog. If forking has occurred toward the terminating UE, the AS may
save SDP answers from several different UEs;
If precondition procedures are used between the originating UE and the
terminating UE, the AS shall forward reliable provisional responses which
contain SDP to the originating UE, in order to allow the UEs to exchange
additional SDP offers and answers associated with the precondition procedures.
Upon receiving an unreliable provisional response from the terminating UE to
the original SIP INVITE request, the AS may forward the provisional response
to the originating UE reliably. Unless the provisional response contained a
199 response code, the AS may change the response code to SIP 183 (Session
Progress) response.
If the AS supports the P-Early-Media header field, the AS shall insert a
P-Early-Media header field with an \"inactive\" value before forwarding the
provisional response.
Upon receiving a SIP 200 (OK) response to the initial SIP INVITE request from
the terminating UE indicating that the terminating UE has answered the call,
the AS shall:
a) instruct the MRF to stop the media for the CAT service;
b) forward the SIP 200 (OK) response to the originating UE; and
c) if the AS has saved the SDP answer associated with the dialog confirmed by
the SIP 200 (OK) response and if the AS has not forwarded the SDP answer to
the originating UE, the AS shall include the saved SDP answer in the SIP 200
(OK) response.
Upon receiving a SIP 4xx, 5xx or 6xx response from a terminating UE the AS
shall:
a) instruct the MRF to stop the media for the CAT service; and
b) forward the final response to the originating UE.
Upon receiving a SIP PRACK request including the P-Early-Media header field
with an \"inactive\" value, the AS shall:
a) instruct the MRF to release the media resource reserved for the CAT
service; and
b) forward the SIP PRACK request to the terminating UE.
##### 4.5.5.2.3 AS Actions for early session model
The procedures in subclause 4.5.5.3.3 shall apply with following additions:
\- Upon receiving the first SIP 18x response containing an early-session SDP
offer containing an SDP a=content media-level attribute, as specified in RFC
4796 [12], with a \"g.3gpp.cat\" value to the initial INVITE request, the AS:
\- decides which CAT service should have priority based on the operator policy
and the calling CAT service subscriber's preferences;
NOTE 1: Based on the operator policy, the AS can decide which CAT service
should have priority when receiving the first SIP INVITE request or receiving
the first SIP 18x response.
\- if the CAT service provided by the AS serving the originating UE has no
priority, then forward the SIP 18x response and do not provide CAT service;
\- if the CAT service provided by the AS serving the originating UE has
priority, then:
\- send a reliable SIP 18x response to the originating UE. The SIP 18x
response shall:
\- include a P-Asserted-Identity header containing the public user identity of
the served user unless privacy policy or restriction services prevent
providing any public user identity of the terminating party;
\- include a Require header with option tag \"early-session\";
\- include the SDP content, with an SDP a=content media-level attribute, as
specified in RFC 4796 [12], with a \"g.3gpp.cat\" value, for CAT service
provided by the AS serving the originating UE instead of the CAT service
provided by the AS serving the terminating UE as early-session SDP offer and
if preconditions are used, and CAT resource has been requested, indicate the
local preconditions are fulfilled;
\- if a SIP PRACK request from originating UE containing an SDP answer related
to an early session is received, the AS shall forward the SIP PRACK request
with a new SDP answer related to the early-session and set all port numbers of
the media types to \"0\".
\- Upon receiving the first SIP 18x response including the P-Early-Media
header and an SDP answer containing an SDP a=content media-level attribute, as
specified in RFC 4796 [12], with a \"g.3gpp.cat\" value, the AS:
\- decides which CAT service should have priority based on the operator policy
and the calling CAT service subscriber\'s preferences;
\- if the CAT service provided by the AS serving the originating UE has no
priority, then forward the SIP 18x response and do not provide CAT service;
\- if the CAT service provided by the AS serving the originating UE has
priority, then:
\- send a reliable SIP 18x response to the originating UE. The SIP 18x
response shall:
\- include a P-Asserted-Identity header containing the public user identity of
the served user unless privacy policy or restriction services prevent
providing any public user identity of the terminating party;
\- include a Require header with option tag \"early-session\";
\- include the SDP content, with an SDP a=content media-level attribute, as
specified in RFC 4796 [12], with a \"g.3gpp.cat\" value, for CAT as early-
session SDP offer and if preconditions are used, and CAT resource has been
requested, indicate the local preconditions are fulfilled;
\- if a SIP PRACK request from originating UE containing an SDP answer related
to an early session is received, the AS shall forward the SIP PRACK after
removing the SDP answer related to the early session and including the
P-Early-Media header field with an \"inactive\" value.
##### 4.5.5.2.3A AS Actions for CAT Reject
This subclause describes the procedures when the CAT AS has decided to reject
CAT offered by the AS serving the terminating UE.
Upon receiving the first reliable SIP 18x response containing an early-session
SDP offer, containing an SDP a=content media-level attribute, as specified in
RFC 4796 [12], with a \"g.3gpp.cat\" value, to the initial INVITE request, the
AS shall decide whether CAT service provided by the AS serving the terminating
UE needs to be rejected or not based on the operator policy and the calling
CAT service subscribers preferences.
NOTE 1: Based on the operator policy, the AS can decide whether to reject the
terminating CAT service when receiving the first SIP INVITE request or
receiving the first SIP 18x response.
If the CAT service provided by the AS serving the terminating UE needs to be
rejected, when the AS receives a reliable SIP 18x response, the AS shall:
\- include a P-Asserted-Identity header field containing the public user
identity of the terminating user unless privacy policy or restriction services
prevent providing any public user identity of the terminating party;
\- if present, remove the early-session SDP offer from the response;
\- forward the SIP 18x response to the originating UE; and
\- when a SIP PRACK request from originating UE is received, if the SIP 18x
response contained an early-session SDP offer, ,the AS shall insert an early-
session SDP answer with all media port numbers set to \"0\" before forwarding
the SIP PRACK request.
Upon receiving the first SIP 18x response including the P-Early-Media header
field and an SDP answer containing an SDP a=content media-level attribute, as
specified in RFC 4796 [12], with a \"g.3gpp.cat\" value, the AS shall decide
whether CAT service provided by the AS serving the terminating UE needs to be
rejected or not based on the operator policy and the calling CAT service
subscriber's preferences;
NOTE 2: Based on the operator policy, the AS can decide whether to reject the
terminating CAT service when receiving the first SIP INVITE request or
receiving the first SIP 18x response.
If the CAT service provided by the AS serving the terminating UE needs to be
rejected, when the AS receives a SIP 18x response, the AS shall:
\- include a P-Asserted-Identity header field containing the public user
identity of the terminating user unless privacy policy or restriction services
prevent providing any public user identity of the terminating party;
\- if the AS supports the P-Early-Media header field, the AS shall insert a
P-Early-Media header field, or modify an existing header field, with an
\"inactive\" value before forwarding the provisional response;
\- remove the SDP a=content media-level attribute \"g.3gpp.cat\" value;
\- forward the SIP 18x response to the originating UE; and
\- when a SIP PRACK request from originating UE is received, the AS shall
forward the SIP PRACK including the P-Early-Media header field with an
\"inactive\" value.
##### 4.5.5.2.4 AS Actions for CAT stop
Upon receipt of specific DTMF digit for CAT stop, the AS instructs the MRF to
stop the media for the CAT service.
Upon receipt of specific DTMF digit for CAT restart, the AS instructs the MRF
to restart the media for the CAT service.
##### 4.5.5.2.5 AS support of DTMF
If the UE has indicated support of both the \"telephone-event\" media subtype
and the SIP INFO mechanism for DTMF transport, the AS shall based on operator
policy choose which DTMF transport mechanism to use for CAT control between
the UE and the AS.
If the AS wants to use the SIP INFO mechanism for DTMF transport, as defined
in 3GPP TS 24.229 [4], the AS shall indicate support of the mechanism in a
response sent to the UE by including a Recv-Info header field with a
\"infoDtmf\" value, as defined in IETF RFC 6086 [11].
If the AS wants to use the \"telephone-event\" media subtype for DTMF
transport, the AS shall include the \"telephone-event\" in the SDP for CAT
media, sent to the UE.
NOTE: The usage of the \"telephone-event\" media subtype for CAT control
requires that intermediates allow the telephone-event packages to traverse
from the UE to the AS during the early dialog.
For the remainder of this subclause, when the term \"receipt of DTMF digit\"
is used, it means either the detection of a DTMF digit by the MRF, which is
then passed to the AS over the Cr interface, or the receipt of an INFO request
containing the appropriate INFO package, as negotiated above.
##### 4.5.5.2.6 AS Actions for Gateway model
The AS performing the Gateway model shall follow the procedure as specified in
RFC 3960 [8] and annex G in 3GPP TS 24.628 [14] with the additional procedures
described in this subclause.
Upon receiving an initial INVITE request, before forwarding the initial INVITE
request towards the terminating UE, the AS shall:
a) store the SDP offer sent from the originating side if the AS is going to
update media with both originating side and terminating side when the 200 (OK)
response to the initial INIVTE request is received;
b) if required by local policy, remove the P-Early-Media header field, if
present; and
c) contact the MRF to request CAT resource.
When the video media feature tag is not included in the Contact header field
of the initial INVITE request towards the terminating UE and there is no video
description in the SDP offer included in the initial INVITE request, the AS
shall not request video CAT resource from MRF, and shall not apply video CAT
media to the originating UE.
Editor's note: [TEI15, CR0096] the mechanism and procedure to support the
selection of the media type of early media by end users is FFS.
NOTE: If playing customized media before alerting is allowed based on
operator\'s policy, upon forwarding the initial INVITE request to the
terminating UE, the AS can play customized media before alerting by following
the procedure as specified in annex G in 3GPP TS 24.628 [14]. When to stop the
customized media depends on operator\'s policy.
Upon receiving an SIP 180 (Ringing) response or SIP 183 (Session Progress)
response to the initial SIP INVITE request sent to the terminating UE, before
forwarding the response towards the originating UE, the AS shall:
a) if the SIP 180 (Ringing) response or the SIP 183 (Session Progress)
response to the initial SIP INVITE request includes an SDP answer, store the
SDP answer received from the terminating UE;
b) if the AS has not sent an SDP answer:
1) generate an SDP answer, either:
i) based on the SDP answer as received from the terminating UE, if:
\- the originating UE indicated support for the precondition mechanism by
including the \"precondition\" option tag in the Supported header field in the
initial INVITE request and the terminating UE applied the precondition
mechanism to the session by including \"precondition\" option tag in the
Require header field in the 18x response sent to the originating UE as
described in RFC 3312 [17], and the resources required between the originating
UE and the terminating UE are more than the resources required between
originating UE and MRF associated with the AS for CAT; or
\- the media types required between originating UE and MRF associated with the
AS for CAT are different from the media types required between the originating
UE and the terminating UE; or
ii) based on the information received from the MRF associated with AS for CAT,
for all other cases;
2) include an SDP content media-level attribute, as specified in RFC 4796
[12], with a \"g.3gpp.cat\" value in the generated SDP answer; and
3) remove the received P-Early-Media header field if present, and include a
P-Early-Media header field with a \"sendrecv\" value or a \"sendonly\" value;
and
c) if the AS has sent an SDP answer, the AS shall not generate an SDP answer.
NOTE: The procedures for handling multiple early dialogs, due to forking, is
not specified in the current release of this specification.
If the originating UE indicated support for the precondition mechanism and the
precondition mechanism was applied to the session, the AS shall not instruct
the MRF to start applicable media for the CAT service before the originating
UE has indicated that preconditions are fulfilled. The point when the AS
instruct the MRF to start applicable media for the CAT service is based on
local policy.
If the originating UE indicated support for the precondition mechanism and
local resources were indicated not available in the initial INVITE request,
and if the precondition mechanism was applied to the session, after forwarding
an UPDATE request from the originating UE to the terminating UE which
indicates that resources at the originating UE are available, upon receiving
an SIP 200 (OK) response for the UPDATE request from the terminating UE, the
AS shall:
a) store the SDP of the terminating UE; and
b) forward the SDP of the terminating UE to the originating UE.
Upon receiving the first 18x response without applying the precondition
mechnism or a 180 (Ringing) response to the initial INVITE request from the
terminating UE used to indicate that resources are available on the
terminating UE and user is being alerted,
a) if the originating UE indicated support for the precondition mechanism and
1) if the precondition mechanism was applied to the session, the AS shall
i) send an UPDATE request with an SDP offer based on the SDP of CAT to the
originating UE, the media types required in the SDP offer can include
additional media types compared to the SDP offer initiated by the originating
UE in the previous INVITE request, and
ii) use the precondition mechanism in the UPDATE request as specified in RFC
3312 [17], and not instruct the MRF to start applicable media for the CAT
service before the originating UE has indicated that preconditions are
fulfilled in the 200 (OK) response to the UPDATE request or subsequent UPDATE
request; or
2) if the precondition mechanism was not applied to the session, when the
media types required in the SDP of the CAT and the previous SDP offer in
INVITE request are different,
i) the AS shall send an UPDATE request with an SDP offer based on the SDP of
the CAT to the originating UE; and
ii) the AS may based on local policy use the precondition mechanism in the
UPDATE request as specified in RFC 3312 [17], if the precondition mechanism is
used in the UPDATE request, the AS shall not instruct the MRF to start
applicable media for the CAT service before the originating UE has indicated
that preconditions are fulfilled in the 200 (OK) response to the UPDATE
request or subsequent UPDATE request; or
b) if the originating UE did not indicate support for the precondition
mechanism, and if the media types required in the SDP of the CAT and the
previous SDP offer in the initial INVITE request are different, the AS shall
send an UPDATE request to the originating UE with an SDP offer based on the
SDP of the CAT.
If UPDATE request containing an SDP offer from terminating side is received
when a 180 (Ringing) response has been sent and a 200 (OK) response to the
initial INVITE has not been sent yet, the AS shall:
a) not forward the UPDATE request to the originating side;
b) store the SDP offer contained in the UPDATE request, and if SDP answer or
SDP offer from terminating side has been stored previously, the AS shall
replace it with the new received SDP offer; and
c) respond to the UPDATE request with a 200 (OK) response and generate an SDP
answer based on the SDP offer previously sent from the originating side.
Upon receiving an SIP 200 (OK) (INVITE) from terminating UE, if it is not
allowed to continue playing video CAT by operator or user settings, or if
video CAT media has not been played during the called party alerting, the AS
shall instruct the MRF to stop the media for the CAT service and either:
a) if the AS is going to update media only with the originating side, generate
an UPDATE request as specified in RFC 3311 [13] to update the media with the
originating UE using either:
1) if the AS has previously stored the SDP answer or SDP offer sent from the
terminating side, the SDP answer of the terminating UE as previously stored;
or
2) if the AS has not previously stored SDP answer or SDP offer sent from the
terminating side, the SDP answer received in the immediate 200 (OK) response
to the SIP INVITE request; or
b) if the AS is going to update media with both originating side and
terminating side:
1) send an offerless re-INVITE request to the terminating side;
2) upon receiving a SIP response to the re-INVITE request containing an SDP
offer from the terminating side, generate an UPDATE request as specified in
RFC 3311 [13] to send an SDP offer to the originating UE. The SDP offer shall
only contain the media components which appeared both in the SDP offer
contained in the SIP response to the re-INVITE request and the previously
stored SDP offer in the initial INVITE, and set the port number of the
corresponding m-line to zero if it has been set to zero during previous SDP
negotiation; and
3) upon receiving a 200 (OK) response to the UPDATE request from the
originating side, generate an SDP answer to the terminating side, included in
the ACK request associated with the re-INVITE request. The SDP answer shall be
based on the SDP answer contained in the 200 (OK) response to the UPDATE
request, and for the media components which not appear in the SDP answer in
the 200 (OK) response, set the port number of the corresponding m-line to
zero.
If video CAT has been played during the called party alerting, and if it is
allowed to continue playing video CAT by operator and user settings during
converstion, upon receiving an SIP 200 (OK) (INVITE) from terminating UE, the
AS shall perform either above bullet a) or bullet b) in the paragraph above
related to the reception of 200 (OK) on INVITE with additions described below:
a) before using the SDP answer received from terminating UE to update media
with originating UE by UPDATE request, the AS shall:
1) if the SDP answer only includes audio components, which means the
conversation is going to be audio conversation, insert video components into
this SDP answer based on the CAT information previously received from MRF, the
video components shall include:
i) a media-level attribute \"c=\", as specified in RFC 4566 [15], with a value
of the corresponding IP address for CAT media;
ii) a media-level attribute with a \"g.3gpp.cat\" value; and
iii) an \"a=sendonly\" attribute.
2) if the SDP answer includes video components but with zero port number or
with an \"a=inactive\" attribute, which also means the conversation is going
to be audio conversation, replace the existed video components with new video
components based on the CAT information previously received from MRF, the new
video media components shall include:
i) a media-level attribute \"c=\", as specified in RFC 4566 [15], with a value
of the corresponding IP address for CAT media;
ii) a media-level attribute with a \"g.3gpp.cat\" value; and
iii) an \"a=sendonly\" attribute.
3) if the SDP answer includes video descriptions with port number greater than
zero and without an \"a=inactive\" attribute, instruct the MRF to stop to play
CAT media.
b) upon receiving a 200 (OK) response associated with the UPDATE request
mentioned in the first sentence of bullet a) from the originating side:
1) if the AS is going to forward the SDP answer contained in this 200 (OK)
response to terminating UE, before forwarding the SDP answer to the
terminating UE, the AS shall exclude CAT related media descriptions from the
SDP answer; and
2) if the SDP answer in this 200 (OK) response includes the video components
of video CAT, after the media update in bullet a) in the paragraph above
related to continue playing video CAT is finished, the AS shall instruct the
MRF to stop the audio stream of video CAT.
#### 4.5.5.3 Actions at the AS serving the terminating UE
##### 4.5.5.3.1 General
The procedures specified in 3GPP TS 24.229 [4] for an AS acting as a routing
B2BUA apply with additions described in the subclauses below.
If the initial INVITE destined to served user includes a Supported header
field with \"early-session\" option-tag and the AS supports the \"early-
session\" extension as described in RFC 3959 [7], the AS shall based on
operator policy follow the procedures in subclause 4.5.5.3.3 to provide CAT
service. The procedures in subclause 4.5.5.3.3 shall not be used if there are
intermediaries in the network that do not understand the procedures.
Depending on the operator policy, it shall also be possible for the AS to
perform the actions specifed as Gateway model in RFC 3960 [8].
The AS shall follow procedures specified in subclause 4.6 for any services
where interaction shall be considered.
##### 4.5.5.3.2 AS actions for forking model
The AS performing the forking model shall follow the procedure as specified in
annex D in 3GPP TS 24.628 [14] with the additional procedures described in
this subclause.
Upon receiving an initial SIP INVITE request destined to the served user, the
AS shall:
a) based on local policy remove the P-Early-Media header field, if present;
b) forward the initial SIP INVITE request to the served user;
c) contact the MRF to request CAT resources; and
d) send a reliable SIP 183 (Session Progress) response to the originating UE.
The SIP 183 (Session Progress) provisional response shall:
\- include a P-Asserted-Identity header field containing the public user
identity of the served user unless privacy policy or restriction services
prevent providing any public user identity of the terminating party;
\- include a To header field with a To tag locally generated by the AS;
\- include a P-Early-Media header field with a \"sendrecv\" value or a
\"sendonly\" value;
\- include an SDP answer, based on information received from the MRF. The AS
shall include an SDP a=content media-level attribute, as specified in RFC 4796
[12], with a \"g.3gpp.cat\" value in the SDP answer; and
\- if a Supported header field with an option tag \"precondition\"was received
in the initial INVITE request and the AS decides to use the precondition
mechanism , indicate in the SDP answer that the local preconditions are
fulfilled.
If preconditions are used, the AS shall not instruct the MRF to start
applicable media for the CAT service before the originating UE has indicated
that preconditions are fulfilled. The point when the AS instructs the MRF to
start applicable media for the CAT service is based on local policy. If the AS
can provide CAT media for media lines not included in the original SDP offer
and the UE in the Contact header field included media feature tags indicating
support for the additional media, the AS shall send an UPDATE request towards
the UE in the dialog with a negotiated SDP. The AS shall include in this
UPDATE request:
a) an SDP offer based on an offer from the MRF with any new media lines placed
after the existing media-lines. The AS shall include an SDP a=content media-
level attribute, as specified in RFC 4796 [12], with a \"g.3gpp.cat\" value in
all the media lines;
b) a P-Early-Media header field with a \"sendrecv\" value or a \"sendonly\"
value; and
c) if preconditions are used, an indication in the SDP offer that local
preconditions are fulfilled.
NOTE 1: The AS can, based on local policy, wait to send the SIP 183 (Session
Progress) response to the originating UE until the AS has received a SIP 180
(Ringing) provisional response from the served UE.
NOTE 2: The AS can, based on local policy, wait to instruct the MRF to start
CAT media until the AS has received a SIP 180 (Ringing) provisional response
from the served UE.
NOTE 3: The interaction between the AS and MRF is not specified for the CAT
service but can use the Cr reference point as described in 3GPP TS 24.229 [4].
NOTE 4: If the AS acts as a Proxy and does not want to remain in the
signalling path between the originating UE and the terminating UE, the AS does
not need to add its own SIP-URI to the SIP Record-Route header field. If the
AS acts as a B2BUA, the AS will always remain in the signalling path.
NOTE 5: The AS can, if it supports the P-Early-Media header field, based on
local policy choose to not provide the CAT service to the originating UE if
the initial INVITE request does not contain a P-Early-Media header field with
a \"supported\" value.
Upon receiving a reliable provisional response from a served UE containing an
SDP answer to the original SIP INVITE request, the AS:
\- may forward the provisional response to the originating UE reliably and,
unless the provisional response contained a 199 response code, after changing
the Status-Line to SIP 183 (Session Progress) response;
\- shall insert a P-Early-Media header field, or modify an existing header
field, with an \"inactive\" value before forwarding the provisional response;
\- shall, if the reliable provisional response is not forwarded to the
originating UE, acknowledge the received provisional response by sending a SIP
PRACK request as defined in RFC 3262 [5] to the served UE; and
\- shall, if the reliable provisional response contained an SDP answer and the
provisional response is not forwarded to the originating UE, save the SDP
answer contained in the reliable provisional response for that particular
early dialog. If forking has occurred toward the served user, the AS may save
SDP answers from several different UEs;
If precondition procedures are used between the originating UE and the served
UE, the AS shall forward reliable provisional responses which contain SDP to
the originating UE, in order to allow the UEs to exchange additional SDP
offers and answers associated with the precondition procedures.
Upon receiving an unreliable provisional response from a served UE to the
original SIP INVITE request, the AS may forward the provisional response to
the originating UE and, unless the provisional response contained a 199
response code, after changing the Status-Line to SIP 183 (Session Progress)
response.
If the AS supports the P-Early-Media header field, the AS shall insert a
P-Early-Media header field with an \"inactive\" value before forwarding the
provisional response.
Upon receiving a SIP 200 (OK) response to the initial SIP INVITE request from
a served UE indicating that the served user has answered the call, the AS
shall:
\- instruct the MRF to stop the media for the CAT service;
\- forward the SIP 200 (OK) response to the originating UE; and
\- if the AS has saved the SDP answer associated with the dialog confirmed by
the SIP 200 (OK) response and if the AS has not forwarded the SDP answer to
the originating UE, the AS shall include the saved SDP answer in the SIP 200
(OK) response.
Upon receiving a SIP 4xx, 5xx or 6xx response from a served UE the AS shall:
\- instruct the MRF to stop the media for the CAT service; and
\- forward the final response to the originating UE.
Upon receiving a SIP PRACK request including the P-Early-Media header field
with an \"inactive\" value, the AS shall:
\- instruct the MRF to release the media resource reserved for the CAT
service; and
\- forward the SIP PRACK request to the served UE.
##### 4.5.5.3.3 AS Actions for early session model
Upon receiving an initial INVITE request destined to the served user including
a Supported header with \"early-session\" tag, as described in RFC 3959 [7],
the AS:
\- may contact the MRF to request CAT resource if session SDP preconditions
are not used, or local preconditions are fulfilled;
\- if required by local policy, remove the P-Early-Media header field, if
present; and
\- shall forward the initial INVITE request to the served user.
Upon receiving the first SIP 18x response to the initial INVITE request, the
AS shall:
\- if session SDP preconditions are not used in the initial INVITE request, or
local preconditions in the initial INVITE request are fulfilled, then contact
the MRF to request CAT resource if it has not been requested;
\- send a reliable SIP 18x response to the originating UE. The SIP 18x
response shall:
\- include a P-Asserted-Identity header containing the public user identity of
the served user unless privacy policy or restriction services prevent
providing any public user identity of the terminating party;
\- include a Require header with option tag \"early-session\";
\- include the SDP content, with an SDP a=content media-level attribute, as
specified in RFC 4796 [12], with a \"g.3gpp.cat\" value, for CAT as early-
session SDP offer and if preconditions are used, and CAT resource has been
requested, indicate the local preconditions are fulfilled;
Upon receiving additional SIP 18x response to the initial INVITE request, the
AS shall forward it to the originating UE.
Upon receiving a SIP request containing an early-session SDP offer that
indicates the local preconditions are fulfilled, the AS shall:
\- contact the MRF to request CAT resource;
\- generate an early-session SDP answer based on the information from the MRF
and, if preconditions are used, indicate that the local preconditions are
fulfilled; and
\- after receiving a SIP 200 (OK) response to the request, include the early-
session SDP answer in the SIP 200 (OK) response, and forwards it to the
originator.
If preconditions are used, the AS should not instruct the MRF to start
applicable media for the CAT service before the originating UE indicates that
early-session SDP local preconditions are fulfilled. Wheter to start
applicable media for the CAT service before or after receiving the SIP 180
(Ringing) response from the served UE is based on local policy.
If a SIP message from served UE containing an SDP offer related to an early
session is received, the AS shall send an SDP answer to the SDP offer related
to the early-session sent by the served UE and set all port numbers of the
media types to \"0\".
Upon receiving a SIP 200 (OK) response form the served UE to the initial
INVITE request, the AS shall instruct the MRF to stop media for the CAT
service and forward the SIP 200 (OK) response to the originating UE.
NOTE 1: The interaction between the AS and MRF is not specified for the CAT
service but can use the Cr reference point as described in 3GPP TS 24.229 [4].
Upon receiving a SIP 4xx, 5xx or 6xx response from a served UE the AS shall:
\- instruct the MRF to stop the media for the CAT service; and
\- forward the final response to the originating UE.
##### 4.5.5.3.4 AS Actions for CAT copy
Upon receipt of the specific DTMF digit, the AS copies the media for the
called party\'s CAT service.
NOTE: How the AS copies the called party\'s CAT is out of the scope of this
document.
##### 4.5.5.3.5 AS Actions for CAT stop
Upon receipt of the specific DTMF digit for CAT stop, the AS instructs the MRF
to stop the media for the CAT service.
Upon receipt of the specific DTMF digit for CAT restart, the AS instructs the
MRF to restart the media for the CAT service.
##### 4.5.5.3.6 AS support of DTMF
If the UE has indicated support of both the \"telephone-event\" media subtype
and the SIP INFO mechanism for DTMF transport, the AS shall based on operator
policy choose which DTMF transport mechanism to use for CAT control between
the UE and the AS.
If the AS wants to use the SIP INFO mechanism for DTMF transport, as defined
in 3GPP TS 24.229 [4], the AS shall indicate support of the mechanism in a
response sent to the UE by including a Recv-Info header field with a
\"infoDtmf\" value, as defined in IETF RFC 6086 [11].
If the AS wants to use the \"telephone-event\" media subtype for DTMF
transport, the AS shall include the \"telephone-event\" in the SDP for CAT
media, sent to the UE.
NOTE: The usage of the \"telephone-event\" media subtype for CAT control
requires that intermediates allow the telephone-event packages to traverse
from the UE to the AS during the early dialog.
For the remainder of this subclause, when the term \"receipt of DTMF digit\"
is used, it means either the detection of a DTMF digit by the MRF, which is
then passed to the AS over the Cr interface, or the receipt of an INFO request
containinga DTMF Info Package, as negotiated above.
##### 4.5.5.3.7 AS Actions for Gateway model
The AS performing the Gateway model shall follow the procedure as specified in
RFC 3960 [8] and annex G in 3GPP TS 24.628 [14] with the additional procedures
described in this subclause.
Upon receiving an initial INVITE request, before forwarding the initial INVITE
request towards the terminating UE, the AS shall:
a) store the SDP offer sent from the originating side if the AS is going to
update media with both originating side and terminating side when the 200 (OK)
response to the initial INIVTE request is received;
b) if required by local policy, remove the P-Early-Media header field, if
present; and
c) contact the MRF to request CAT resource.
When the video media feature tag is not included in the Contact header field
of the initial INVITE request towards the terminating UE and there is no video
description in the SDP offer included in the initial INVITE request, the AS
shall not request video CAT resource from MRF, and shall not apply video CAT
media to the originating UE.
Editor's note: [TEI15, CR0096] the mechanism and procedure to support the
selection of the media type of early media by end users is FFS.
NOTE: If playing customized media before alerting is allowed based on
operator\'s policy, upon forwarding the initial INVITE request to the
terminating UE, the AS can play customized media before alerting by following
the procedure as specified in annex G in 3GPP TS 24.628 [14]. When to stop the
customized media depends on operator\'s policy.
Upon receiving an SIP 180 (Ringing) response or SIP 183 (Session Progress)
response to the initial SIP INVITE request sent to the terminating UE, before
forwarding the response towards the originating UE, the AS shall:
a) if the SIP 180 (Ringing) response or the SIP 183 (Session Progress)
response to the initial SIP INVITE request includes an SDP answer, store the
SDP answer received from the terminating UE;
b) if the AS has not sent an SDP answer:
1) generate an SDP answer, either:
i) based on the SDP answer as received from the terminating UE, if:
\- the originating UE indicated support for the precondition mechanism by
including the\"precondition\" option tag in the Supported header field in the
initial INVITE request and the terminating UE applied the precondition
mechanism to the session by including \"precondition\" option tag in the
Require header field in the 18x response sent to the originating UE as
described in RFC 3312 [17], and the resources required between the originating
UE and the terminating UE are more than the resources required between
originating UE and MRF associated with the AS for CAT; or
\- the media types required between originating UE and MRF associated with the
AS for CAT are different from the media types required between the originating
UE and the terminating UE; or
ii) based on the information received from the MRF associated with AS for CAT,
for all other cases;
2) include an SDP content media-level attribute, as specified in RFC 4796
[12], with a \"g.3gpp.cat\" value in the generated SDP answer; and
3) remove the received P-Early-Media header field if present, and include a
P-Early-Media header field with a \"sendrecv\" value or a \"sendonly\" value;
and
c) if the AS has sent an SDP answer, the AS shall not generate an SDP answer.
NOTE: The procedures for handling multiple early dialogs, due to forking, is
not specified in the current release of this specification.
If the originating UE indicated support for the precondition mechanism and the
precondition mechanism was applied to the session, the AS shall not instruct
the MRF to start applicable media for the CAT service before the originating
UE has indicated that preconditions are fulfilled. The point when the AS
instruct the MRF to start applicable media for the CAT service is based on
local policy.
If the originating UE indicated support for the precondition mechanism and
local resources were indicated not available in the initial INVITE request,
and if the precondition mechanism was applied to the session after forwarding
an UPDATE request from the originating UE to the terminating UE which
indicates that resources at the originating UE are available, upon receiving
an SIP 200 (OK) response for the UPDATE request from the terminating UE, the
AS shall:
a) store the SDP of the terminating UE; and
b) forward the SDP of the terminating UE to the originating UE.
Upon receiving the first 18x response without applying the precondition
mechnism or a 180 (Ringing) response to the initial INVITE request from the
terminating UE used to indicate that resources are available on the
terminating UE and user is being alerted,
a) if the originating UE indicated support for the precondition mechanism and
1) if the precondition mechanism was applied to the session, the AS shall
i) send an UPDATE request with an SDP offer based on the SDP of CAT to the
originating UE, the media types required in the SDP offer can include
additional media types compared to the SDP offer initiated by the originating
UE in the previous INVITE request, and
ii) use the precondition mechanism in the UPDATE request as specified in RFC
3312 [17], and not instruct the MRF to start applicable media for the CAT
service before the originating UE has indicated that preconditions are
fulfilled in the 200 (OK) response to the UPDATE request or subsequent UPDATE
request; or
2) if the precondition mechanism was not applied to the session, when the
media types required in the SDP of the CAT and the previous SDP offer in
INVITE request are different,
i) the AS shall send an UPDATE request with an SDP offer based on the SDP of
the CAT to the originating UE; and
ii) the AS may based on local policy use the precondition mechanism in the
UPDATE request as specified in RFC 3312 [17], if the precondition mechanism is
used in the UPDATE request, the AS shall not instruct the MRF to start
applicable media for the CAT service before the originating UE has indicated
that preconditions are fulfilled in the 200 (OK) response to the UPDATE
request or subsequent UPDATE request; or
b) if the originating UE did not indicate support for the precondition
mechanism, and if the media types required in the SDP of the CAT and the
previous SDP offer in the initial INVITE request are different, the AS shall
send an UPDATE request to the originating UE with an SDP offer based on the
SDP of the CAT.
If UPDATE request containing an SDP offer from terminating side is received
when a 180 (Ringing) response has been sent and a 200 (OK) response to the
initial INVITE has not been sent yet, the AS shall:
a) not forward the UPDATE request to the originating side; and
b) store the SDP offer contained in the UPDATE request, and if SDP answer or
SDP offer from terminating side has been stored previously, the AS shall
replace it with the new received SDP offer; and
c) respond to the UPDATE request with a 200 (OK) response and generate an SDP
answer based on the SDP offer previously sent from the originating side.
Upon receiving an SIP 200 (OK) (INVITE) from terminating UE, if it is not
allowed to continue playing video CAT by operator or user settings, or if
video CAT media has not been played during the called party alerting, the AS
shall instruct the MRF to stop the media for the CAT service and either:
a) if the AS is going to update media only with the originating side, generate
an UPDATE request as specified in RFC 3311 [13] to update the media with the
originating UE using either:
1) if the AS has previously stored the SDP answer or SDP offer sent from the
terminating side, the SDP answer of the terminating UE as previously stored;
or
2) if the AS has not previously stored SDP answer or SDP offer sent from the
terminating side, the SDP answer received in the immediate 200 (OK) response
to the SIP INVITE request.or
b) if the AS is going to update media with both originating side and
terminating side:
1) send an offerless re-INVITE request to the terminating side;
2) upon receiving a SIP response to the re-INVITE request containing an SDP
offer from the terminating side, generate an UPDATE request as specified in
RFC 3311 [13] to send an SDP offer to the originating UE. The SDP offer shall
only contain the media components which appeared both in the SDP offer
contained in the SIP response to the re-INVITE request and the previously
stored SDP offer in the initial INVITE, and set the port number of the
corresponding m-line to zero if it has been set to zero during previous SDP
negotiation; and
3) upon receiving a 200 (OK) response to the UPDATE request from the
originating side, generate an SDP answer to the terminating side, included in
the ACK request associated with the re-INVITE request. The SDP answer shall be
based on the SDP answer contained in the 200 (OK) response to the UPDATE
request, and for the media components which not appear in the SDP answer in
the 200 (OK) response, set the port number of the corresponding m-line to
zero.
If video CAT has been played during the called party alerting, and if it is
allowed to continue playing video CAT by operator and user settings during
converstion, upon receiving an SIP 200 (OK) (INVITE) from terminating UE, the
AS shall perform either above bullet a) or bullet b) in the paragraph above
related to the reception of 200 (OK) on INVITE with additions described below:
a) before using the SDP answer received from terminating UE to update media
with originating UE by UPDATE request, the AS shall:
1) if the SDP answer only includes audio components, which means the
conversation is going to be audio conversation, insert video components into
this SDP answer based on the CAT information previously received from MRF, the
video components shall include:
i) a media-level attribute \"c=\", as specified in RFC 4566 [15], with a value
of the corresponding IP address for CAT media;
ii) a media-level attribute with a \"g.3gpp.cat\" value; and
iii) an \"a=sendonly\" attribute.
2) if the SDP answer includes video components but with zero port number or
with an \"a=inactive\" attribute, which also means the conversation is going
to be audio conversation, replace the existed video components with new video
components based on the CAT information previously received from MRF, the new
video media components shall include:
i) a media-level attribute \"c=\", as specified in RFC 4566 [15], with a value
of the corresponding IP address of CAT media;
ii) a media-level attribute with a \"g.3gpp.cat\" value; and
iii) an \"a=sendonly\" attribute.
3) if the SDP answer includes video descriptions with port number greater than
zero and without an \"a=inactive\" attribute, which means the conversation is
going to be video conversation, instruct the MRF to stop to play CAT media.
b) upon receiving a 200 (OK) response associated with the UPDATE request
mentioned in the first sentence of bullet a) from the originating side:
1) if the AS is going to forward the SDP answer contained in this 200 (OK)
response to terminating UE, before forwarding the SDP answer to the
terminating UE, the AS shall exclude CAT related media descriptions from the
SDP answer; and
2) if the SDP answer in this 200 (OK) response includes the video components
of video CAT, after the media update in bullet a) in the paragraph above
related to continue playing video CAT is finished, the AS shall instruct the
MRF to stop the audio stream of video CAT.
## 4.6 Interaction with other services
### 4.6.1 Communication session Hold (HOLD)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.2 Termination Identification Presentation (TIP)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.3 Termination Identification Restriction (TIR)
The TIR service takes precedence over the CAT service subscribed by the called
party. If the TIR service prevents CAT media from being played to the calling
party, then the AS providing CAT service shall not apply the CAT service to
the session.
### 4.6.4 Originating Identification Presentation (OIP)
The order of the services in the filter criteria list should be configured so
that CAT service appears before OIP service, in order for the CAT service to
provide CAT media associated with the calling party\'s identity (i.e., the
called party may play one type of CAT media to a particular caller and other
types of CAT media to other callers depending on the called party\'s
subscription).
NOTE: If the called party does not subscribe to OIP service, the AS providing
OIP service will remove P-Asserted-Identity according to 3GPP TS 24.607 [10],
and it will not be possible to provide CAT service based on calling party\'s
identity if the OIP service was applied prior to CAT service in this given
case. Unless the network operator can assure that such scenario do not occur
based on their service configuration, as CAT service cannot be aware of
whether OIP service is subscribed by the user, and OIP service cannot be aware
of how CAT service is to be performed, CAT service will always need to be
performed prior to OIP service.
### 4.6.5 Originating Identification Restriction (OIR)
The OIR service takes precedence over the CAT service subscribed by the called
party. The behaviour of the CAT service is dependent on whether if the called
party has a CAT service associated with the calling party\'s identity (i.e.,
the called party may play one type of CAT media to a particular caller and
other types of CAT media to other callers depending on the called party\'s
subscription) and whether OIR service is requested.
The AS providing CAT service shall:
1) if the called party has CAT service associated with that specific calling
party\'s identity, the AS shall:
\- inspect the priv-value set in the Privacy header field in the request; and
\- if the Privacy header field is set to either \"id\", \"header\", or
\"user\", i.e. OIR service is requested, then the AS shall not apply CAT
service to the session.
2) in all other cases (i.e. except for the case if the called party has CAT
service associated with that specific calling party\'s identity, and OIR
service is requested), the AS shall process CAT service based on the called
party\'s subscription.
NOTE: OIR service itself is independent from CAT service, as the identities
that need to be restricted towards the terminating user will be handled, i.e.
restricted, appropriately by other functional entities as specified in 3GPP TS
24.229 [4], e.g. at the boundary of trust domain which may be the terminating
P-CSCF.
### 4.6.6 Conference (CONF)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.7 Communication DIVersion services (CDIV)
#### 4.6.7.1 General
If the diverting party has both CAT service and CDIV active, and the diverted-
to party has CAT service active, based on operator policy, either:
1) the CAT service of the diverted-to party shall be applied to the session by
the AS providing the CAT service of diverted-to party, except in the case of
CFNR. The interaction of CAT service with CFNR is described in subclause
4.6.7.2; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session.
NOTE 1: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
If the diverting party has both CAT service and CDIV active, and the diverted-
to party does not have an active service, based on operator policy, either:
1) no CAT service shall be applied to the session when CDIV is invoked; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session.
NOTE 2: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
#### 4.6.7.2 CFNR
If the diverting party has both CAT service and CFNR active, and the diverted-
to party has CAT service active, based on operator policy, either:
1) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party until the CFNR timer
expires. Upon the CFNR timer expiring, the AS providing CAT service for the
diverting party shall stop applying the CAT for the diverting user and the AS
providing CAT service for the diverted-to party shall apply the CAT service of
the diverted-to party; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session.
NOTE 1: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
If the diverting party has CAT service and CFNR active, and the diverted-to
party does not have an active service, based on operator policy, either:
1) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party until the CFNR timer
expires; or
2) the CAT service of the diverting party shall be applied to the session by
the AS providing CAT service for the diverting party, without the CAT service
for the diverted-to party applied to the session, until reception of a final
SIP response to the INVITE.
NOTE 2: the above network operator option can be deployed in cases where
diversion of the call is hidden from the calling party.
### 4.6.8 Message Waiting Indication (MWI)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.9 Communication Barring (CB)
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.10 Explicit Call Transfer (ECT)
If the transfer target has CAT service active, the AS providing CAT service
shall apply the transfer target\'s CAT in the case of blind transfer. The AS
providing CAT service shall not apply the transfer target\'s CAT in the case
of consultative transfer while the call is transferring to the transfer
target.
The CAT service of the transferor shall not be applied when ECT is invoked.
### 4.6.11 Communication Wait
In the case that the called party has Communication Waiting and CAT services
active, the AS providing the CAT service for the called party shall apply the
called party\'s CAT to the session if the called party is considered
\'approaching network determined user busy\' as a network operator option.
Alternatively, the AS providing the call party's CAT shall not apply the CAT
service and the Communication Waiting alert shall be applied.
### 4.6.12 Completion of Communications to Busy Subscriber
No impact, i.e. neither service shall affect the operation of the other
service.
### 4.6.13 Customized Ringing Signal (CRS)
In following scenarios,
\- both CAT and CRS is provided using early session model, calling party has
CRS service and called party has CAT service;
\- both CAT and CRS is provided using early session model, calling party has
CAT and CRS service, and CRS has high iFC priority than CAT; or
\- both CAT and CRS is provided using early session model, called party has
CAT and CRS service, and CRS has high iFC priority than CAT,
if receiving a SIP PRACK request include two early session SDP, i.e. the early
session SDP answer from originating UE for early session model CAT and the
early seesion SDP offer from CRS AS for early session model CRS, CAT AS shall:
\- recognize the SDP which includes an SDP a=content attribute with a
\"g.3gpp.cat\" value for each media description is the SDP answer from
originating UE for CAT service; and
\- remove the selected SDP before forwarding the SIP PRACK request.
In other scenarios, neither service shall affect the operation of the other
service.
### 4.6.14 Multi-Device (MuD)
No impact.
### 4.6.15 Multi-Identity (MiD)
In the terminating network, if identity D, as defined in 3GPP TS 24.174 [16],
has CAT service active, and user B, as defined in 3GPP TS 24.174 [16], has CAT
service active, based on operator policy, either:
1) the CAT service of user B shall be applied to the session by the AS
providing the CAT service of user B; or
2) the CAT service of identity D shall be applied to the session by the AS
providing CAT service for identity D, without the CAT service of user B
applied to the session.
If identity D has CAT service active, and user B does not have CAT service
active, based on operator policy, either:
1) no CAT service shall be applied to the session; or
2) the CAT service of identity D shall be applied to the session by the AS
providing CAT service for identity D, without the CAT service of user B
applied to the session.
In the originating network, no impact.
## 4.7 Parameter values (timers)
No timers for CAT service are defined
## 4.8 Service configuration
User configuration of CAT service is not specified in this version of the
document.
###### ## Annex A (informative): Signalling flows
# A.1 Scope of signalling flows
This annex gives examples of signalling flows for the CAT service within the
IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation
Protocol (SIP).
# A.2 Void
# A.3 CAT forking model signalling flows
## A.3.1 Introduction
The following flows show establishment of a session between UE#1 and UE#2,
using the forking model described in subclause 4.5.5.3.2 to provide CAT to
UE#1. The following flows are included:
\- subclause A.3.2 shows CAT, using the forking, model, when UE#1 and UE#2
have resources available;
\- subclause A.3.3 shows CAT, using the forking, model, when UE#1 does not
have resources available;
\- subclause A.3.4 shows CAT, using the forking, model, when UE#2 does not
have resources available;
## A.3.2 CAT when UE#1 and UE#2 have resources available
Figure A.3.2-1: CAT, no resource reservation
> **1 INVITE request (UE#1 to S-CSCF) see example in table A.3.2-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.3.2-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: IEEE-802.11a
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
>
> Contact:\;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.3.2-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
An early dialog (D1) is established between UE#1 and the CAT-AS.
NOTE: As an alternative, the CAT-AS can send the SIP 183 (Session Progress)
provisional response when the initial SIP INVITE request is received from
UE#1.
Table A.3.2-2: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Recv-Info: infoDtmf
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 6666::eee:fff:bbb:aaa
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**Recv-Info:** The CAT-AS indicates willingness to receive DTMF Info Packages
in INFO requests.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT and, in this example, includes a SDP \"a=content\" attribute with a
\"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.3.2-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.3.2-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **15-16 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A dialog (D2) is established between UE#1 and UE#2.
The early dialog (D1) between UE#1 and the CAT-AS is terminated.
> **17-78 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.3.3 CAT when UE#1 does not have required resources available while UE#2
has resources available
Figure A.3.3-1: CAT, UE#1 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.3.3-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.3.3-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept: application/sdp, application/3gpp-ims+xml
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The local preconditions are
indicated as not fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.3.3-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#2.
An early dialog (D1) is established between UE#1 and the CAT-AS.
NOTE: As an alternative, the CAT-AS can send the SIP 183 (Session Progress)
provisional response when a SIP 180 (Ringing) provisional response is received
from UE#2.
Table A.3.3-2: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Recv-Info: infoDtmf
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \ service.ims.icsi.mmtel\">
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 6666::eee:fff:bbb:aaa
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**Recv-Info:** The CAT-AS indicates willingness to receive DTMF Info Packages
in INFO requests.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT and, in this example, includes a SDP \"a=content\" attribute with a
\"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **7-8 PRACK request (UE#1 to CAT-AS) see example in table A.1.3-4**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
Table A.3.3-3: PRACK request (UE#1 to CAT-AS)
> PRACK sip:cat-as.home1.net
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> From:
>
> To: \ tag=2236
>
> Call-ID:
>
> Cseq: 129 PRACK
>
> Rack: 9022
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933669 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The local preconditions are indicated as fulfilled, and media are set
to \"sendrecv\".
> **9-10 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **11-12 180 (Ringing) provisional response (UE#2 to CAT-AS) see example in
> table A.3.3-4**
The called party is alerted. UE#2 sends an unreliable SIP 180 (Ringing)
provisional response for the INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to start CAT media.
Table A.3.3-4: 180 (Ringing) response (UE#2 to CAT-AS)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote none
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. The local preconditions are indicated as fulfilled.
> **13-14 183 (Session Progress) provisional response (CAT-AS to UE#1)**
The CAT-AS changes the response code to SIP 183 (Session Progress) response
and forwards the SIP provisional response to UE#1.
An early dialog (D2) is established between UE#1 and UE#2.
> **15-16 PRACK request (UE#1 to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to UE#2.
**SDP:** The local preconditions are indicated as fulfilled, and media are set
to \"sendrecv\".
> **17-18 200 (OK) response to PRACK request (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **19-20 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
> **21-22 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
The CAT-AS instructs the MRF to stop CAT media.
The early dialog (D1) between UE#1 and the CAT-AS is terminated.
> **23-24 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.3.4 CAT when UE#1 has resources available while UE#2 does not have
required resources available
Figure A.3.4-1: CAT, UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.3.4-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.3.4-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: IEEE-802.11a
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
>
> Contact:\;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the local preconditions are fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS) see example in
> table A.3.4-2**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
Table A.3.4-2: 180 (Ringing) response (UE#2 to CAT-AS)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote none
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=content:g.3gpp.cat
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session and, in this example, includes a SDP \"a=content\" attribute with a
\"g.3gpp.cat\" value for each media description. The local preconditions are
indicated as fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1)**
The CAT-AS changes the response code to 183 (Session Progress) response, and
forwards the SIP provisional response to UE#1.
An early dialog (D2) is established between UE#1 and UE#2.
> **9-10 PRACK request (UE#1 to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the 183 (Session Progress)
provisional response, to UE#2.
> **11-12 200 (OK) response to PRACK (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.3.3-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#2.
An early dialog (D1) is established between UE#1 and the CAT-AS.
NOTE: As an alternative, the CAT-AS can send the SIP 183 (Session Progress)
provisional response when the initial SIP INVITE request is received from
UE#1.
Table A.3.3-4: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Recv-Info: infoDtmf
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 6666::eee:fff:bbb:aaa
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**P-Early-Media:** The CAT-AS requests authorization for early media.
**Recv-Info:** The CAT-AS indicates willingness to receive DTMF Info Packages
in INFO requests.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT. The SDP content is based on information received from the MRF. The
SDP contains an indication that the local preconditions are fulfilled.
> **15-16 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to start CAT media.
> **17-18 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **19-20 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
> **21-22 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
The early dialog (D1) between UE#1 and the CAT-AS is terminated.
> **23-24 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the 200 (OK) final response,
to UE#2.
# A.4 CAT early session model signalling flows
## A.4.1 Introduction
The following flows show establishment of a session between UE#1 and UE#2,
using the early session model described in subclause 4.5.5.3.3 to provide CAT
to UE#1. The following flows are included:
\- subclause A.4.2 shows CAT, using the early session model, when UE#1 and
UE#2 have resources available;
\- subclause A.4.3 shows CAT, using the early session model, when UE#1 does
not have resources available;
\- subclause A.4.4 shows CAT, using the early session model, when UE#2 does
not have resources available;
## A.4.2 CAT when UE#1 and UE#2 have resources available
Figure A.4.2-1: CAT, no resource reservation
> **1 INVITE request (UE#1 to S-CSCF) see example in table A.4.2-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.4.2-1: INVITE request (UE#1 to S-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, early-session
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, and early-session SDP.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. If preconditions are used, the
local preconditions are indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
**3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
**5-6 Reliable 180 (Ringing) provisional response (UE#2 to CAT-AS) see example
in table A.4.2-5**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.4.2-5: 180 (Ringing) response (UE#2 to CAT-AS)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK472a32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.2, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> RSeq: 9022
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Length: 0
**7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see example
in table A.4.2-7**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
An early-session SDP is sent to the UE#1 via the 183 (Session Progress)
provisional response.
Table A.4.2-7: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: precondition, 100rel, early-session
>
> Recv-Info: dtmfInfo
>
> RSeq: 9022
>
> Contact:\;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=content:g.3gpp.cat
**early SDP** The early-session SDP offer (early SDP_O) contains a set of
codecs supported to be used for CAT and, in this example, includes a SDP
\"a=content\" attribute with a \"g.3gpp.cat\" value for each media
description. The early-session SDP content is based on information received
from the MRF. The local preconditions are indicated as fulfilled.
**Recv-Info:** The CAT-AS indicates willingness to receive DTMF Info Packages
in INFO requests.
> **9-10 PRACK request (UE#1 to CAT-AS) see example in table A.4.2-9**
UE#1 sends a SIP PRACK request with a early-session SDP answer, which
acknowledges the SIP 183 (Session Progress) provisional response, towards
UE#2.
The CAT-AS instructs the MRF to play CAT media.
Table A.4.2-9: PRACK request (UE#1 to CAT-AS)
> PRACK sip:cat-as.home1.net SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3466 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**early SDP** The early-session SDP answer (early SDP_A) contains a set of
codecs supported by UE#1 to be used for CAT. The local preconditions are
indicated as fulfilled.
> **11-12 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.4.2-13**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request towards UE#1.
The CAT-AS instructs the MRF to stop CAT media.
Table A.4.2-13: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
> \ >;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **15-16 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A regular session is established between UE#1 and UE#2.
The early session between UE#1 and the CAT-AS is terminated.
> **17 18 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.4.3 CAT when UE#1 does not have required resources available while UE#2
has resources available
Figure A.4.3-1: CAT, UE#1 does not have resources available
> **1-2 INVITE request (UE#1 to CAT-AS) see example in table A.4.3-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.4.3-1: INVITE request (UE#1 to S-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, early-session
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, and early-session SDP.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O1) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the local preconditions are not fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.4.3-5**
UE#2 sends a SIP 183 (Session Progress) provisional response for the INVITE
request to the CAT-AS.
Table A.4.3-5: 183 (Session Progress) response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**SDP** The SDP answer (SDP_A1) contains a set of codecs to be used for the
session and, in this example, includes a SDP \"a=content\" attribute with a
\"g.3gpp.cat\" value for each media description. The local preconditions are
indicated as fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.4.3-7**
The CAT-AS forwards the SIP 183 (Session Progress) provisional response with
early-session SDP for CAT to UE#1.
Table A.4.3-7: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition, early-session
>
> RSeq: 9021
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::ccc:aaa:bbb:acc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**early SDP** The early-session SDP offer (early SDP_O1) contains a set of
codecs to be used for CAT. The preconditions are indicated as not fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS) see example in table A.4.3-9**
UE#1 sends a SIP PRACK request with early-session SDP answer, which
acknowledges the 183 (Session Progress) provisional response, towards UE#2.
Table A.4.3-9: PRACK request (UE#1 to CAT-AS)
> PRACK
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3500 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3556 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**early SDP** The early-session SDP answer (early SDP_A1) contains a set of
codecs supported by UE#1 to be used for CAT. The preconditions are indicated
as not fulfilled.
> **11-12 PRACK request (CAT-AS to UE#2) see example in table A.4.3-11**
CAT-AS forwards the SIP PRACK request without early-session SDP answer to
UE#2.
Table A.4.3-11: PRACK request (CAT-AS to UE#2)
> PRACK
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK614Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK464z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK351b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK582f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 66
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Length: 0
>
> **13-16 200 (OK) response to PRACK request (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **17-18 UPDATE request (UE#1 to CAT-AS) see example in table A.4.3-17**
UE#1 reserved resources for regular session and early session, it sends an SIP
UPDATE request with session SDP offer and early-session SDP offer towards
UE#2.
Table A.4.3-17: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3500 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3556 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**SDP** The offer (SDP_O2) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the preconditions are fulfilled.
**early SDP** The early-session SDP offer (early SDP_O2) contains a set of
codecs supported by UE#1 to be used for CAT. The local preconditions are
indicated as fulfilled.
> **19-20 UPDATE request (CAT-AS to UE#2) see example in table A.4.3-19**
CAT-AS forwards the SIP UPDATE request towards UE#2 without early-session SDP.
The CAT-AS instructs the MRF to reserve CAT resources.
Table A.4.3-19: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK164Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK442z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK514b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK812f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 66
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> **21-22 200 (OK) response to UPDATE request (UE#2 to CAT-AS) see example in
> table A.4.3-21**
UE#2 sends a SIP 200 (OK) for the SIP UPDATE request to the CAT-AS.
Table A.4.3-21: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK611k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764KS12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK164Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK442z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK514b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK812f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A2) contains a set of codecs to be used for the
session. The preconditions are indicated as fulfilled.
> **23-24 200 (OK) response to UPDATE request (CAT-AS to UE#1) see example in
> table A.4.3-23**
CAT-AS forwards the SIP 200 (OK) for the SIP UPDATE request to UE#1.
Table A.4.3-23: 200 (OK) response (CAT-AS to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK164Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK442z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK514b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK812f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::ccc:aaa:bbb:acc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**early SDP** The early-session SDP answer (early SDP_A2) contains a set of
codecs supported by UE#1 to be used for CAT. The early-session SDP content is
based on information received from the MRF. The preconditions are indicated as
fulfilled.
> **25-26 180 (Ringing) response to INVITE request (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request towards UE#1.
The CAT-AS terminates the provisional response.
The CAT-AS instructs the MRF to play CAT media.
> **27-28 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request towards UE#1.
The CAT-AS instructs the MRF to stop CAT media.
> **29-30 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A regular session is established between UE#1 and UE#2.
The early session between UE#1 and the CAT-AS is terminated.
> **31-32 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the 200 (OK) final response,
to UE#2.
## A.4.4 CAT when UE#1 has resources available while UE#2 does not have
required resources available
Figure A.4.4-1: CAT, UE#2 does not have resources available
> **1-2 INVITE request (UE#1 to CAT-AS) see example in table A.4.4-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.4.4-1: INVITE request (UE#1 to S-CSCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, early-session
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \
> >;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, and early-session SDP.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O1) contains a set of codecs supported by UE#1 and
desired by the user at UE#1 for this session. The SDP contains an indication
that the local preconditions are fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.4.4-5**
UE#2 sends a SIP 183 (Session Progress) provisional response for the INVITE
request to the CAT-AS.
Table A.4.4-5: 183 (Session Progress) response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition
>
> RSeq: 9021
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**SDP** The SDP answer (SDP_A1) contains a set of codecs to be used for the
session and, in this example, includes a SDP \"a=content\" attribute with a
\"g.3gpp.cat\" value for each media description. The preconditions are
indicated as fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.4.4-7**
The CAT-AS forwards the SIP 183 (Session Progress) provisional response with
early-session SDP for CAT to UE#1.
Table A.4.4-7: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel, precondition, early-session
>
> RSeq: 9021
>
> Contact:
>
> Content-Type: multipart/mixed; boundary=\"boundary1\"
>
> Content-Length: (...)
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: session
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
>
> \--boundary1
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::ccc:aaa:bbb:acc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:bbb:acc
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> \--boundary1
**early SDP** The early-session SDP offer (early SDP_O1) contains a set of
codecs to be used for CAT. The local preconditions are indicated as fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS) see example in table A.4.4-9**
UE#1 sends a SIP PRACK request with early-session SDP answer, which
acknowledges the 183 (Session Progress) provisional response, towards UE#2.
Table A.4.4-9: PRACK request (UE#1 to CAT-AS)
> PRACK
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> Privacy: none
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3500 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> m=audio 3556 RTP/AVP 97
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**early SDP** The early-session SDP answer (early SDP_A1) contains a set of
codecs supported by UE#1 to be used for CAT. The preconditions are indicated
as fulfilled.
> **11-12 PRACK request (CAT-AS to UE#2) see example in table A.4.4-11**
CAT-AS forwards the SIP PRACK request without early-session SDP answer to
UE#2.
Table A.4.4-11: PRACK request (CAT-AS to UE#2)
> PRACK
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74SIP/2.0
>
> Via: SIP/2.0/UDP catas.home2.net;branch=z9hG4bK614Q63.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK464z73.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK351b51.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK582f12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKna234s7
>
> Max-Forwards: 66
>
> Privacy:
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq: 128 PRACK
>
> Contact:
>
> Content-Length: 0
>
> **13-16 200 (OK) response to PRACK request (UE#2 to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **17-18 180 (Ringing) response to INVITE request (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request towards UE#1.
The CAT-AS terminates the provisional response.
The CAT-AS instructs the MRF to play CAT media.
> **19-20 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request towards UE#1.
The CAT-AS instructs the MRF to stop CAT media.
> **21-22 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS forwards the SIP 200 (OK) response to UE#1.
A regular session is established between UE#1 and UE#2.
The early session between UE#1 and the CAT-AS is terminated.
> **23-24 ACK request (UE#1 to UE#2)**
UE#1 sends a SIP ACK request, which acknowledges the 200 (OK) final response,
to UE#2.
# A.5 CAT Gateway model signalling flows
## A.5.1 Introduction
The following flows show establishment of a session between UE#1 and UE#2,
using the gateway model as defined in RFC 3960 [8] to provide CAT to UE#1. The
following flows are included:
\- subclause A.5.2 shows CAT, using the gateway model, when UE#1 and UE#2 have
resources available;
\- subclause A.5.2A shows gateway model CAT using reINVITE request, when UE#1
and UE#2 have resources available;
\- subclause A.5.3 shows CAT, using the gateway model, when UE#1 does not have
resources available;
\- subclause A.5.3A shows gateway model CAT using reINVITE request, when UE#1
does not have resources available;
\- subclause A.5.4 shows CAT, using the gateway model, when UE#2 does not have
resources available;
\- subclause A.5.4A shows gateway model CAT using reINVITE request, when UE#2
does not have resources available;
\- subclause A.5.7 shows CAT, using the gateway model, when both UE#1 and UE#2
do not have resources available
\- subclause A.5.8 shows CAT with different media types during one session,
using gateway model, when both UE#1 and UE#2 do not have resources available
NOTE: Flows in subclauses A.5.2A, A.5.3A and A.5.4A shall apply when the
originating UE will release or change the ports used from the original SDP
offer during a session.
The following flows show establishment of a session between UE#1,UE#2 and
UE#3, among which the UE#3 is the diverted UE for UE#2, using the gateway
model as defined in RFC 3960 [8] to provide CAT to UE#1. The following flows
are included:
\- subclause A.5.5 shows CAT signalling flow for a successful communication
forwarding on no reply using the gateway model with reINVITE request, when
UE#1 , UE#2 and UE#3 have resources available;
## A.5.2 CAT when UE#1 and UE#2 have resources available
Figure A.5.1-1: CAT, no resource reservation
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.2-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.2-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.**SDP** The SDP offer (SDP_O) contains a set of codecs supported
by UE#1 and desired by the calling user for this session. The local
preconditions are indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 180 (Ringing) provisional response (CAT-AS to UE#1) see example in
> table A.5.2-2**
The CAT-AS sends a reliable SIP 180 (Ringing) provisional response to UE#1.
Table A.5.2-2: 180 (Ringing) response (CAT-AS to UE#1)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 340051372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.5.2-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.2-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. If preconditions are used, they are indicated as fulfilled.
> **15-16 UPDATE request (CAT-AS to UE#1) see example in table A.5.2-4**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
response from UE#2.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
Table A.5.2-4: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336278 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The SDP content is based on information received from previous
200 (OK) response. The local preconditions are indicated as fulfilled.
> **17-18 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. UE#1
includes a SDP answer (SDP_O2) in the 200 (OK) response to the corresponding
SIP UPDATE request.
> **19-20 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **21-22 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **23-24 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 2: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 (OK) response from UE#2 in step 14.
## A.5.2A CAT using reINVITE request when UE#1 and UE#2 have resources
available
Figure A.5.2A-1: CAT, no resource reservation
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.2A-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.2A-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 180 (Ringing) provisional response (CAT-AS to UE#1) see example in
> table A.5.2A-2**
The CAT-AS sends a reliable SIP 180 (Ringing) provisional response to UE#1.
Table A.5.2A-2: 180 (Ringing) response (CAT-AS to UE#1)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 340051372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.5.2A-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.2A-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. If preconditions are used, they are indicated as fulfilled.
**15-16 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
**17-18 re INVITE request (CAT-AS to UE#2)**
The CAT-AS sends a SIP reINVITE request without SDP to UE#2.
> **19-20 200 (OK) response to reINVITE request (UE#2 to CAT-AS) see example
> in** **table A.5.2A-4**
UE#2 sends a SIP 200 (OK) response for the SIP reINVITE request (step 18) with
SDP_O_UE2_regular to the CAT-AS.
Table A.5.2A-4: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_UE2_regular) contains a set of codecs supported
by UE#2 and desired by the called user for this session. The local
preconditions are indicated as fulfilled.
> **21-22 UPDATE request (CAT-AS to UE#1) see example in table A.5.2A-5**
The CAT-AS sends an UPDATE request containing values received in the 200 OK
from UE#2 (step 20).
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
Table A.5.2A-5: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336278 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_UE2_regular) contains a set of codecs to be used
for the session. The SDP content is based on information received from
previous 200 (OK) response (step 20). The local preconditions are indicated as
fulfilled.
> **23-24 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. UE#1
includes a SDP answer (SDP_ A_UE1_regular) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **25-26 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **27-28 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **29-30 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response (step 19), with SDP answer (SDP_A_UE1_regular) to UE#2.
## A.5.3 CAT when UE#1 does not have required resources available while UE#2
has resources available
Figure A.5.3-1 shows an example call flow for CAT when UE#1 does not have
required resources available and UE#2 have resources available.
Figure A.5.3-1: CAT, UE#1 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.3-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.3-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \ >;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as not fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.5.3-2**
UE#2 sends a reliable SIP 183 (Session Progress) provisional response for the
INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.5.3-2: 183 (Session Progress) provisional response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> RSeq: 9022
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The local preconditions are indicated as not fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.3-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1. The CAT-AS shall take into account, when creating the SDP message, the
media indicated by UE#2 in the previously received 183 (Session Progress)
provisional response and the one used by MRF for the media for CAT.
Table A.5.3-3: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF and information in the previously received
183 (Session Progress) provisional response from UE#2. The local preconditions
are indicated as not fulfilled.
> **9-12 PRACK request (UE#1 to CAT-AS, and to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS, which is further sent to UE#2.
> **13-16 200 (OK) response to PRACK request (UE#2 to CAT-AS, and to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to CAT-AS, which
is further sent to UE#1.
**17-18 UPDATE request (UE#1 to CAT-AS) - see example in table A.5.3-4**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table A.5.3-4: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_cat) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received from the MRF.
The local preconditions are indicated as fulfilled.
**19-20 UPDATE request (CAT-AS to UE#2) - see example in table A.5.3-5**
CAT-AS indicates to UE#2 that UE#1 can send and receive media as the necessary
resources are available.
Table A.5.3-5: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74;comp=sigcomp
> SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 56101 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_regular) contains a set of codecs supported to be
used for regular conversation. The local preconditions are indicated as
fulfilled.
**21-22 200 (OK) response (UE#2 to CAT-AS) - see example in table A.5.3-6**
UE#2 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. The
SDP shall contain information relevant to the media that will be used after
the session is established.
CAT-AS shall store the relevant information in SDP for later use in step 31.
Table A.5.3-6: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The local preconditions are indicated as fulfilled.
**23-24 200 (OK) response (CAT-AS to UE#1) - see example in table A.5.3-7**
CAT-AS sends a SIP 200 (OK) response for the SIP UPDATE request to UE#1. The
SDP shall contain information relevant to the media for CAT used by the MRF.
Table A.5.3-7: 200 (OK) response (CAT-AS to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336157 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs to be used for
CAT. The local preconditions are indicated as fulfilled.
> **25-26 180 (Ringing) provisional response (UE#2 to CAT-AS)**
UE#2 sends a SIP 180 (Ringing) provisional response for the INVITE request to
the CAT-AS.
The CAT-AS instructs the MRF to play CAT media upon receipt of 180.
> **27-28 180 (Ringing) provisional response (CAT-AS to UE#1)**
CAT-AS sends a SIP 180 (Ringing) provisional response for the INVITE request
to the UE#1.
> **29-30 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
> **31-32 UPDATE request (CAT-AS to UE#1) see example in table A.5.3-8**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
for UPDATE request from UE#2 in step 22.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.3-8: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_A_regular) contains a set of codecs to be used for
the session. The SDP content is based on information received from previous
200 (OK) response.
> **33-34 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response.UE#1 includes a SDP answer (SDP_O2) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **35-36 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **37-38 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **39-40 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 3: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 (OK) from UE#2 in step 18.
## A.5.3A CAT using reINVITE request when UE#1 does not have required
resources available while UE#2 has resources available
Figure A.5.3A-1 shows an example call flow for CAT when UE#1 does not have
required resources available and UE#2 have resources available.
Figure A.5.3A-1: CAT, UE#1 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.3A-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.3A-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \ >;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as not fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.5.3A-2**
UE#2 sends a reliable SIP 183 (Session Progress) provisional response for the
INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.5.3A-2: 183 (Session Progress) provisional response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> RSeq: 9022
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The local preconditions are indicated as not fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.3A-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1. The CAT-AS shall take into account, when creating the SDP message, the
media indicated by UE#2 in the previously received 183 provisional response
and the one used by MRF for the media for CAT.
Table A.5.3A-3: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF and information in the previously received
183 (Session Progress) provisional response from UE#2. The local preconditions
are indicated as not fulfilled.
> **9-12 PRACK request (UE#1 to CAT-AS, and to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS, which is further sent to UE#2.
> **13-16 200 (OK) response to PRACK request (UE#2 to CAT-AS, and to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to CAT-AS, which
is further sent to UE#1.
**17-18 UPDATE request (UE#1 to CAT-AS) - see example in table A.5.3A-4**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table A.5.3A-4: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_cat) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received from the MRF.
The local preconditions are indicated as fulfilled.
**19-20 UPDATE request (CAT-AS to UE#2) - see example in table A.5.3A-5**
CAT-AS indicates to UE#2 that UE#1 can send and receive media as the necessary
resources are available.
Table A.5.3A-5: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74;comp=sigcomp
> SIP/2.0
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 66
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 56101 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_regular) contains a set of codecs supported to be
used for regular conversation. The local preconditions are indicated as
fulfilled.
**21-22 200 (OK) response (UE#2 to CAT-AS) - see example in table A.5.3A-6**
UE#2 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. The
SDP shall contain information relevant to the media that will be used after
the session is established.
CAT-AS shall store the relevant information in SDP for later use in step 31.
Table A.5.3A-6: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The local preconditions are indicated as fulfilled.
**23-24 200 (OK) response (CAT-AS to UE#1) - see example in table A.5.3A-7**
CAT-AS sends a SIP 200 (OK) response for the SIP UPDATE request to UE#1. The
SDP shall contain information relevant to the media for CAT used by the MRF.
Table A.5.3A-7: 200 (OK) response (CAT-AS to UE#1)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336157 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs to be used for
CAT. The local preconditions are indicated as fulfilled.
> **25-26 180 (Ringing) provisional response (UE#2 to CAT-AS)**
UE#2 sends a SIP 180 (Ringing) provisional response for the INVITE request to
the CAT-AS.
The CAT-AS instructs the MRF to play CAT media upon receipt of 180 (Ringing)
response.
> **27-28 180 (Ringing) provisional response (CAT-AS to UE#1)**
CAT-AS sends a SIP 180 (Ringing) provisional response for the INVITE request
to the UE#1.
> **29-30 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
**31-32 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
**33-34 reINVITE request (CAT-AS to UE#2)**
The CAT-AS sends a SIP reINVITE request without SDP to UE#2.
> **35-36 200 (OK) response to reINVITE request (UE#2 to CAT-AS) see example
> in table A.5.3A-8**
UE#2 sends a SIP 200 (OK) response for the SIP reINVITE request (step 34) with
SDP_O_UE2_regular to the CAT-AS.
Table A.5.3A-8: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_UE2_regular) contains a set of codecs supported
by UE#2 and desired by the called user for this session. The local
preconditions are indicated as fulfilled.
> **37-38 UPDATE request (CAT-AS to UE#1) see example in table A.5.3A-9**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
for UPDATE request from UE#2 in step 36.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.3A-9: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_UE2_regular) contains a set of codecs to be used
for the session. The SDP content is based on information received from
previous 200 (OK) response.
> **39-40 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response.UE#1 includes a SDP answer (SDP_ A_UE1_regular) in the 200 (OK)
response to the corresponding SIP UPDATE request.
> **41-42 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **43-44 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **45-46 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response in step 36, with SDP_A_UE1_regular to UE#2.
## A.5.4 CAT when UE#1 has resources available while UE#2 does not have
required resources available
Figure A.5.4-1 shows an example call flow for CAT when UE#1 has resources
available while UE#2 does not have required resources available.
Figure A.5.4-1: CAT, UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.4-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.4-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 180 (Ringing) provisional response (CAT-AS to UE#1) see example in
> table A.5.4-2**
The CAT-AS sends a reliable SIP 180 (Ringing) provisional response to UE#1.
Table A.5.4-2: 180 (Ringing) response (CAT-AS to UE#1)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.5.4-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.4-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. If preconditions are used, they are indicated as fulfilled.
> **15-16 UPDATE request (CAT-AS to UE#1) see example in table A.5.4-4**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
response from UE#2.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
Table A.5.4-4: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336278 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. The SDP content is based on information received from previous
200 (OK) response.
> **17-18 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response. UE#1 includes a SDP answer (SDP_O2) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **19-20 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **21-22 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **23-24 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 2: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 OK from UE#2 in step 14.
## A.5.4A CAT using reINVITE request when UE#1 has resources available while
UE#2 does not have required resources available
Figure A.5.4A-1 shows an example call flow for CAT when UE#1 has resources
available while UE#2 does not have required resources available.
Figure A.5.4A-1: CAT, UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.4A-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.4A-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **7-8 180 (Ringing) provisional response (CAT-AS to UE#1) see example in
> table A.5.4A-2**
The CAT-AS sends a reliable SIP 180 (Ringing) provisional response to UE#1.
Table A.5.4A-2: 180 (Ringing) response (CAT-AS to UE#1)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **9-10 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **11-12 200 (OK) response to PRACK request (CAT-AS to UE#1)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
> **13-14 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.5.4A-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.4A-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. If preconditions are used, they are indicated as fulfilled.
**15-16 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
**17-18 reINVITE request (CAT-AS to UE#2)**
The CAT-AS sends a SIP reINVITE request without SDP to UE#2.
> **19-20 200 (OK) response to reINVITE request (UE#2 to CAT-AS) see example
> in table A.5.4A-4**
UE#2 sends a SIP 200 (OK) response for the SIP reINVITE request (step 18) with
SDP_O_UE2_regular to the CAT-AS.
Table A.5.4A-4: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_UE2_regular) contains a set of codecs supported
by UE#2 and desired by the called user for this session. The local
preconditions are indicated as fulfilled.
> **21-22 UPDATE request (CAT-AS to UE#1) see example in table A.5.4A-5**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
response from UE#2 (step 20).
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
Table A.5.4A-5: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336278 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_UE2_regular) contains a set of codecs to be used
for the session. The SDP content is based on information received from
previous 200 (OK) response (step 20).
> **23-24 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response. UE#1 includes a SDP answer (SDP_A_UE1_regular) in the 200 (OK)
response to the corresponding SIP UPDATE request.
> **25-26 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **27-28 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **29-30 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response (step 19), with SDP answer (SDP_A_UE1_regular) to UE#2.
## A.5.5 CAT diverting for CFNR using reINVITE request when UE#1, UE#2 and
UE#3 have resources available
Figures A.5.5-1a and A.5.5-1b show an example CAT signalling flow for a
successful communication forwarding on no reply based on a CDIV AS providing
the forwarding.
Figure A.5.5-1a: CAT with CFNR, no resource reservation
Figure A.5.5-1b: CAT with CFNR, no resource reservation
> **1 INVITE request (UE#1 to S-CSCF) see example in table A.5.5-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem with UE#2
as the desired called UE. The URI-UE#2 is subscribed to the CFNR service.
Table A.5.5-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
**2 INVITE request (S-CSCF to CDIV AS)**
The S-CSCF forwards the SIP INVITE request to the CDIV AS.
> **3-5 INVITE request (CDIV AS to CAT-AS)**
Via the S-CSCF, the CDIV AS forwards the request to the CAT-AS serving UE#2.
The CAT-AS instructs the MRF to reserve CAT resources.
**5-6 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
**7-8 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **9-12 180 (Ringing) provisional response (CAT-AS to UE#1) see example in
> table A.5.5-2**
The CAT-AS sends a reliable SIP 180 (Ringing) provisional response to UE#1.
The CDIV AS starts the no reply timer.
Table A.5.5-2: 180 (Ringing) response (CAT-AS to UE#1)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 340051372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **13 PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **14 200 (OK) response to PRACK (CAT-AS to UE#1)**
A SIP 200 (OK) response sent by the CAT-AS for the SIP PRACK request traverses
through CDIV AS and S-CSCF to UE#1.
> **15 No reply timer expires**
The no reply timer expires.
> **16-19 CANCEL request (CDIV AS to CAT-AS) and 200 (OK) response to CANCEL
> request (CAT-AS to CDIV AS)**
The CDIV AS sends CANCEL request to the CAT-AS. The CAT AS instructs the MRF
to stop CAT media. The CAT-AS sends 200 (OK) response for the CANCEL request
to the CDIV AS.
> **20-23 CANCEL request (CAT-AS to UE#2) and 200 (OK) response to CANCEL
> request (UE#2 to CAT-AS)**
The CAT-AS sends CANCEL request to UE#2. The UE#2 sends 200 (OK) response for
the CANCEL request to the CAT-AS.
> **24 181 (Call Is Being Forwarded) response (CDIV AS to UE#1)**
Depending on the value of CDIV subscription option "Originating user receives
notification that his communication has been diverted (forwarded or
deflected)", a 181 (Call Is Being Forwarded) response is sent towards UE#1
indicating that the communication is diverted.
> **25-28 487 (Request Terminated) response (CAT-AS to CDIV) and ACK request**
A 487 (Request Terminated) response with a ACK request finalize the
termination of the dialog between CDIV AS and CAT-AS.
> **29-32 487 (Request Terminated) response (UE#2 to CAT-AS) and ACK request**
A 487 (Request Terminated) response with a ACK request finalize the
termination of the dialog between CAT-AS and UE#2.
> **33 INVITE request (CDIV AS to S-CSCF) see example in table A.5.5-3**
>
> An INVITE request including URI-UE#3 as destination is sent towards the
> S-CSCF. Additional the History-Info header is included.
Table A.5.5-3: INVITE request (CDIV AS to UE#3)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **34 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the INVITE request to the CAT-AS serving UE#3.
> The CAT-AS instructs the MRF to reserve CAT resources.
>
> **35-36 INVITE request (CAT-AS to UE#3)**
The CAT-AS forwards the request to UE#3.
> **37-38 180 (Ringing) provisional response (UE#3 to CAT-AS)**
The called party is alerted. UE#3 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **39-40 183 (Session Progress) provisional response (CAT-AS to CDIV AS) see
> example in table A.5.5-4**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
CDIV AS.
Table A.5.5-4: 183 (Session Progress) response (CAT-AS to CDIV AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat#3) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received from the MRF.
The local preconditions are indicated as fulfilled.
> **41 UPDATE request (CDIV AS to UE#1) see example in table A5.5-5**
The CDIV AS sends UPDATE request to UE#1.
Table A.5.5-5: UPDATE request (CDIV AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336278 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_A_cat_#3) contains a set of codecs supported to be
used for CAT. The SDP content is based on information received in previous 183
response.
> **42 200 (OK) response (UE#1 to CDIV AS) see example in table A5.5-6**
The UE#1 sends 200 (OK) response for the UPDATE request to CDIV AS. UE#1
includes a SDP answer (SDP_O_cat_#3) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **43-44 PRACK request (CDIV AS to CAT-AS)**
The CDIV AS sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS. A SDP offer (SDP_O_cat_#3) is
included.
> **45-46 200 (OK) response (CAT-AS to CDIV AS)**
The CAT-AS sends a SIP 200 (OK) response for the PRACK request to CDIV AS. A
SDP answer (SDP_A2_CAT_#3) is included in the 200(OK) response. The set of
codecs supported to be used for CAT is based on information from MRF. The CAT-
AS instructs the MRF to play the CAT media.
> **47-48 200 (OK) response to INVITE (UE#3 to CAT-AS) see example in table
> A.5.2-6**
The called party answers the call. UE#3 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.2-6: 200 (OK) response (UE#3 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular_#3) contains a set of codecs to be used
for the session. If preconditions are used, they are indicated as fulfilled.
**49-50 ACK request (CAT-AS to UE#3)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#3.
**51-52 reINVITE request (CAT-AS to UE#3)**
The CAT-AS sends a SIP reINVITE request without SDP to UE#3.
> **53-54 200 (OK) response to reINVITE request (UE#3 to CAT-AS) see example
> in table A.5.2-7**
UE#3 sends a SIP 200 (OK) response for the SIP reINVITE request with
SDP_O2_regular_#3 to the CAT-AS.
Table A.5.2-7: 200 (OK) response (UE#3 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O2_regular_#3) contains a set of codecs supported
by UE#3 and desired by the called user for this session. The local
preconditions are indicated as fulfilled.
> **55 UPDATE request (CAT-AS to UE#1) see example in table A.5.2-8**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
response from UE#3.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#3.
Table A.5.2-8: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336389 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O2_regular_#3) contains a set of codecs to be used
for the session. The SDP content is based on information received from
previous 200 (OK) response (step 52). The local preconditions are indicated as
fulfilled.
> **56 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. UE#1
includes a SDP answer (SDP_A2_regular_#3) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **57 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **58 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **59-60 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response (step 54), with SDP answer (SDP_A2_regular_#3) to UE#2.
## A.5.6 CAT diverting for CFU
## A.5.6.1 General
Subclause A.5.6.2 shows an example CAT signalling flow for an successful
communication forwarding unconditional based on an CDIV AS providing the
forwarding.
## A.5.6.2 Gateway model CAT diverting for CFU when UE#1, UE#2 and UE#3 have
resources available
Figure A.5.6.2-1: CAT with CFU, no resource reservation
> **1 SIP INVITE request (UE#1 to CAT-AS)-see example in table A.5.6.2-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.6.2-1: SIP INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact: \ user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6>;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for GRUU, 199 responses, reliable
provisional responses and preconditions.
**P-Early-Media:** The UE indicates support for the P-Early-Media header.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.**SDP** The SDP offer (SDP_O) contains a set of codecs supported
by UE#1 and desired by the calling user for this session. The local
preconditions are indicated as fulfilled.
**2 SIP INVITE request (S-CSCF to CDIV AS)**
The S-CSCF forwards the SIP INVITE request to the CDIV AS.
**3 Procedures for CFU are executed.**
> **4-5 SIP 181 (Call Is Being Forwarded) response (CDIV AS to UE#1)**
>
> Depending on the value of subscription option \"Originating user receives
> notification that his communication has been diverted (forwarded or
> deflected)\", a 181 (Call Is Being Forwarded) response is sent towards the
> UE#1 indicating that the communication is diverted.
>
> **6-7 SIP INVITE request (CDIV AS to S-CSCF)-see example in table
> A.5.6.2-6**
>
> A SIP INVITE request including SIP URI of UE#3 as destination is sent
> towards the S-CSCF. Additionally, the History-Info header is included.
Table A.5.6.2-6: INVITE request (CDIV AS to UE#3)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> **8-9 SIP INVITE request (CAT-AS to UE#3)**
The CAT-AS forwards the SIP INVITE request to UE#3.
**10-11 SIP 180 (Ringing) provisional response (UE#3 to CAT-AS)**
The called party is alerted. UE#3 sends a SIP 180 (Ringing) provisional
response for the INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
> **12-15 SIP 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.6.2-12**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
Table A.5.6.2-12: SIP 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 340051372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP** The SDP answer (SDP_A_cat) contains a set of codecs supported to be
used for CAT and, in this example, includes a SDP \"a=content\" attribute with
a \"g.3gpp.cat\" value for each media description. The SDP content is based on
information received from the MRF. The local preconditions are indicated as
fulfilled.
> **16-18 SIP PRACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **19-21 SIP 200 (OK) response to PRACK request (CAT-AS to UE#1)**
A SIP 200 (OK) response sent by the CAT-AS for the SIP PRACK request traverses
through CDIV AS and S-CSCF to UE#1.
> **22-23 SIP 200 (OK) response to INVITE request (UE#3 to CAT-AS) see example
> in table A.5.6.2-22**
The called party answers the call. UE#3 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.5.6.2-22: 200 (OK) response (UE#3 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP answer (SDP_A_regular) contains a set of codecs to be used for
the session. If preconditions are used, they are indicated as fulfilled.
**24-25 SIP ACK request (CAT-AS to UE#3)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#3.
**26-27 SIP reINVITE request (CAT-AS to UE#3)**
The CAT-AS sends a SIP reINVITE request without SDP to UE#3.
> **28-29 SIP 200 (OK) response to reINVITE request (UE#3 to CAT-AS) see
> example in table A.5.6.2-28**
UE#2 sends a SIP 200 (OK) response for the SIP reINVITE request (step 18) with
SDP_O_UE2_regular to the CAT-AS.
Table A.5.6.2-28: 200 (OK) response (UE#3 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_regular) contains a set of codecs supported by
UE#3 and desired by the called user for this session. The local preconditions
are indicated as fulfilled.
> **30-31 SIP UPDATE request (CAT-AS to UE#1) see example in table
> A.5.6.2-30**
The CAT-AS sends a SIP UPDATE request containing values received in the 200
(OK) response from UE#3.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#3.
Table A.5.6.2-30: SIP UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336278 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_ regular) contains a set of codecs to be used for
the session. The SDP content is based on information received from previous
200 (OK) response.
> **32-33 SIP 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response. UE#1 includes a SDP answer (SDP_A2_regular) in the 200 (OK) response
to the corresponding SIP UPDATE request.
> **34-35 SIP 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **36-37 SIP ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **38-39 SIP ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, with SDP answer (SDP_A2_ regular) to UE#3.
## A.5.7 CAT when both UE#1 and UE#2 do not have required resources available
Figure A.5.7-1 shows an example call flow for CAT when UE#1 and UE#2 does not
have required resources available, and the session bandwidth between UE#1 and
UE#2 is rather than the session bandwidth between UE#1 and CAT-AS.
Figure A.5.7-1: CAT, UE#1 and UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.7-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.7-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \ >;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
Supported: The UE indicates support for 199 responses, reliable provisional
responses and preconditions.
P-Early-Media: The UE indicates support for the P-Early-Media header.
Recv-Info: The UE indicates willingness to receive DTMF Info Packages in INFO
requests.
SDP: The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as not fulfilled.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.5.7-2**
UE#2 sends a reliable SIP 183 (Session Progress) provisional response for the
INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.5.7-2: 183 (Session Progress) provisional response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> RSeq: 9022
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** : The SDP answer (SDP_A_regular) contains a set of codecs to be used
for the session. The local preconditions are indicated as not fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.7-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1. The CAT-AS shall take into account, when creating the SDP message, the
media indicated by UE#2 in the previously received 183 (Session Progress)
provisional response.
Table A.5.7-3: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 51372 RTP/AVPF 98
>
> a=acfg:1 t=1
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP:** The SDP answer (SDP_A_regular) contains a set of codecs to be used
for the session and, in this example, includes a SDP \"a=content\" attribute
with a \"g.3gpp.cat\" value for each media description. The local
preconditions are indicated as not fulfilled.
> **9-12 PRACK request (UE#1 to CAT-AS, and to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS, which is further sent to UE#2.
> **13-16 200 (OK) response to PRACK request (UE#2 to CAT-AS, and to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to CAT-AS, which
is further sent to UE#1.
**17-18 UPDATE request (UE#1 to CAT-AS) - see example in table A.5.7-4**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table A.5.7-4: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP answer (SDP_O2) contains a set of codecs supported to be used
for the session. The SDP content is based on information received from the
UE#2. The local preconditions are indicated as fulfilled.
**19-20 UPDATE request (CAT-AS to UE#2) - see example in table A.5.7-5**
CAT-AS indicates to UE#2 that UE#1 can send and receive media as the necessary
resources are available.
Table A.5.7-5: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74;comp=sigcomp
> SIP/2.0
>
> Via: [5555::ccc:aaa:abc:abc]:1357;comp=sigcomp;branch=z9hG4bKnashds8
>
> Max-Forwards: 66
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 56101 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP offer (SDP_O2) contains a set of codecs supported to be used
for the session. The SDP content is based on information received from the
UE#1. The local preconditions are indicated as fulfilled.
**21-24 200 (OK) response (UE#2 to CAT-AS, and to UE#1) - see example in table
A.5.7-6**
UE#2 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. The
SDP shall contain information relevant to the media that will be used after
the session is established.
CAT-AS shall store the relevant information in SDP for later use in step 35.
Table A.5.7-6: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP answer (SDP_A_regular2) contains a set of codecs to be used
for the session. The local preconditions are indicated as fulfilled.
> **25-26 180 (Ringing) provisional response (UE#2 to CAT-AS)**
UE#2 sends a SIP 180 (Ringing) provisional response for the INVITE request to
the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources upon receipt of 180.
> **27-28 UPDATE request (CAT-AS to UE#1) see example in table A.5.7-7**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
for UPDATE request from UE#2 in step 22.
Session between UE#1 and UE#2 is replaced with session between UE#1 and CAT-
AS.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.7-7: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** The SDP offer (SDP_O_cat) contains a set of codecs to be used for CAT.
The SDP content is based on information received from previous 200 (OK)
response.
> **29-30 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. UE#1
includes a SDP answer (SDP_A_cat) in the 200 (OK) response to the
corresponding SIP UPDATE request. The CAT-AS instructs MRF to start playing
the CAT media.
> **31-32 180 (Ringing) provisional response (CAT-AS to UE#1)**
CAT-AS sends a SIP 180 (Ringing) provisional response for the INVITE request
to the UE#1.
> **33-34 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
> **35-36 UPDATE request (CAT-AS to UE#1) see example in table A.5.7-8**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
for UPDATE request from UE#2 in step 22.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.7-8: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP offer (SDP_O_regular2) contains a set of codecs to be used
for the session. The SDP content is based on information received from
previous 200 (OK) response.
> **37-38 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response.UE#1 includes a SDP answer (SDP_A3) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **39-40 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **41-42 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **43-44 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 3: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 (OK) from UE#2 in step 18.
## A.5.8 CAT with different media types during one SIP session when both UE#1
and UE#2 do not have required resources available
Figure A.5.8-1 shows an example call flow for CAT when UE#1 and UE#2 does not
have required resources available, and the media type required by CAT service
which is video in this example, and the media type required by the call which
is audio, are different during one session.
Figure A.5.8-1: CAT with different media types during one session, UE#1 and
UE#2 does not have required resources available
> **1 INVITE request (UE#1 to CAT-AS) see example in table A.5.8-1**
UE#1 sends a SIP INVITE request to the intermediate IM CN subsystem.
Table A.5.8-1: INVITE request (UE#1 to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> P-Early-Media: supported
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \ >;video;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> a=tcap:1 RTP/AVPF
>
> a=pcfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
Supported: The UE indicates support for 199 responses, reliable provisional
responses and preconditions.
P-Early-Media: The UE indicates support for the P-Early-Media header.
Recv-Info: The UE indicates willingness to receive DTMF Info Packages in INFO
requests.
Contact: The UE indicates support for video handling.
SDP: The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as not fulfilled. In this example, only audio media description has
been included in SDP_O in case of audio call.
**2 INVITE request (S-CSCF to CAT-AS)**
The S-CSCF forwards the SIP INVITE request to the CAT-AS.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the request to UE#2.
> **5-6 183 (Session Progress) provisional response (UE#2 to CAT-AS) see
> example in table A.5.8-2**
UE#2 sends a reliable SIP 183 (Session Progress) provisional response for the
INVITE request to the CAT-AS.
The CAT-AS terminates the provisional response.
Table A.5.8-2: 183 (Session Progress) provisional response (UE#2 to CAT-AS)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> RSeq: 9022
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 8386 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP** : The SDP answer (SDP_A_regular) contains a set of codecs to be used
for the session. The local preconditions are indicated as not fulfilled.
> **7-8 183 (Session Progress) provisional response (CAT-AS to UE#1) see
> example in table A.5.8-3**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
UE#1. The CAT-AS shall take into account, when creating the SDP message, the
media indicated by UE#2 in the previously received 183 (Session Progress)
provisional response.
Table A.5.8-3: 183 (Session Progress) response (CAT-AS to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336156 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 49170 RTP/AVPF 97 96
>
> a=acfg:1 t=1
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**SDP:** The SDP answer (SDP_A_regular) contains a set of codecs to be used
for the session and, in this example, includes a SDP \"a=content\" attribute
with a \"g.3gpp.cat\" value for each media description. The local
preconditions are indicated as not fulfilled.
> **9-12 PRACK request (UE#1 to CAT-AS, and to UE#2)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS, which is further sent to UE#2.
> **13-16 200 (OK) response to PRACK request (UE#2 to CAT-AS, and to UE#1)**
UE#2 sends a SIP 200 (OK) response for the SIP PRACK request to CAT-AS, which
is further sent to UE#1.
**17-18 UPDATE request (UE#1 to CAT-AS) - see example in table A.5.8-4**
UE#1 indicates that it can send and receive media as the necessary resources
are available.
Table A.5.8-4: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP offer (SDP_O2) contains a set of codecs supported to be used
for the session. The SDP content is based on information received from the
UE#2. The local preconditions are indicated as fulfilled.
**19-20 UPDATE request (CAT-AS to UE#2) - see example in table A.5.8-5**
CAT-AS indicates to UE#2 that UE#1 can send and receive media as the necessary
resources are available.
Table A.5.8-5: UPDATE request (CAT-AS to UE#2)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74;comp=sigcomp
> SIP/2.0
>
> Via: [5555::ccc:aaa:abc:abc]:1357;comp=sigcomp;branch=z9hG4bKnashds8
>
> Max-Forwards: 66
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 56101 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP offer (SDP_O2) contains a set of codecs supported to be used
for the session. The SDP content is based on information received from the
UE#1. The local preconditions are indicated as fulfilled.
**21-24 200 (OK) response (UE#2 to CAT-AS, and to UE#1) - see example in table
A.5.8-6**
UE#2 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. The
SDP shall contain information relevant to the media that will be used after
the session is established.
CAT-AS shall store the relevant information in SDP for later use in step 35.
Table A.5.8-6: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1, SIP/2.0/UDP
> pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \, \,
> \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336157 29879336157 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP answer (SDP_A_regular2) contains a set of codecs to be used
for the session. The local preconditions are indicated as fulfilled.
> **25-26 180 (Ringing) provisional response (UE#2 to CAT-AS)**
UE#2 sends a SIP 180 (Ringing) provisional response for the INVITE request to
the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources upon receipt of 180.
> **27-28 UPDATE request (CAT-AS to UE#1) see example in table A.5.8-8**
The CAT-AS sends an UPDATE request containing the SDP offer based on the CAT
media information received from MRF.
Session between UE#1 and UE#2 is replaced with session between UE#1 and CAT-
AS.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.8-7: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 5555::ccc:aaa:abc:abc
>
> t=0 0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendonly
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendonly
>
> a=des:qos mandatory remote recvonly
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
**SDP** The SDP offer (SDP_O_cat) contains a set of codecs to be used for CAT.
The SDP content is based on information received from MRF, in this example,
includes an additional video media description and related attributes. The
local preconditions are indicated as fulfilled, and the remote preconditions
are indicated as not fulfilled because UE#1 is expected to reserve additional
resources for video media required by CAT-AS.
> **29-30 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. UE#1
includes a SDP answer (SDP_A_cat) in the 200 (OK) response to the
corresponding SIP UPDATE request. UE#1 starts to reserve CAT resources. The
CAT-AS should not instruct MRF to start playing the CAT media unless the
remote preconditions are indicated as fulfilled in SDP answer included in this
200 (OK) response or in SDP offer included in consequent UPDATE request.
> **31-32 UPDATE request (UE#1 to CAT-AS) see example in table A.5.8-8**
UE#1 indicates that it can receive CAT media as the necessary resources are
available.
The CAT-AS instructs MRF to start playing the CAT media.
Table A.5.8-8: UPDATE request (UE#1 to CAT-AS)
> UPDATE
> sip:user2_public1\@home2.net;gr=urn:uuid:2ad8950e-48a5-4a74-8d99-ad76cc7fc74
> SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \, \,
> \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq: 129 UPDATE
>
> Require: sec-agree
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; ealg=aes-cbc;
> spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
>
> m=video 7398 RTP/AVPF 98
>
> b=AS:75
>
> a=curr:qos local sendonly
>
> a=curr:qos remote recvonly
>
> a=des:qos mandatory local sendonly
>
> a=des:qos mandatory remote recvonly
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
**SDP:** The SDP offer (SDP_O3) contains a set of codecs supported to be used
for the session. The SDP content is based on information received from the
CAT-AS in Step 27. The remote preconditions are indicated as fulfilled.
> **33-34 200 (OK) response to UPDATE request (CAT-AS to UE#1)**
CAT-AS sends a SIP 200 (OK) UPDATE response for the SIP UPDATE request to
UE#1.
> **35-36 180 (Ringing) provisional response (CAT-AS to UE#1)**
CAT-AS sends a SIP 180 (Ringing) provisional response for the INVITE request
to the UE#1.
> **37-38 200 (OK) response to INVITE request (UE#2 to CAT-AS)**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
> **39-40 UPDATE request (CAT-AS to UE#1) see example in table A.5.8-9**
The CAT-AS sends an UPDATE request containing values received in the 200 (OK)
for UPDATE request from UE#2 in step 22.
Session between UE#1 and CAT-AS is replaced with session between UE#1 and
UE#2.
NOTE 1: The AS will remain in the signalling path, i.e. work as a B2BUA, in
order to align and maintain information in SDP for further exchanged messages
between UE#1 and UE#2.
Table A.5.8-9: UPDATE request (CAT-AS to UE#1)
> UPDATE
> sip:user1_public1\@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
> SIP/2.0
>
> Via: SIP/2.0/UDP [5555::ccc:aaa:abc:abc]:8805;branch=z9hG4bK182D87.1
>
> Max-Forwards: 70
>
> Route: \, \
>
> From: \;tag=2236
>
> To: \;tag=171828
>
> Call-ID:
>
> Cseq: 12814111 UPDATE
>
> Require:
>
> Contact:
> \+g.3gpp.icsi-
> ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 29879336156 29879336158 IN IP6 5555::ccc:aaa:abc:abc
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 8386 RTP/AVPF 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=rtpmap:96 telephone-event
**SDP:** The SDP offer (SDP_O_regular2) contains a set of codecs to be used
for the session. The SDP content is based on information received from
previous 200 (OK) response.
> **41-42 200 (OK) response (UE#1 to CAT-AS)**
UE#1 sends a SIP 200 (OK) response for the SIP UPDATE request to CAT-AS. If
the resources indicated for the media cannot be reused by the one reserved for
the CAT media, UE#1 shall reserve necessary resources prior to sending the
response.UE#1 includes a SDP answer (SDP_A3) in the 200 (OK) response to the
corresponding SIP UPDATE request.
> **43-44 200 (OK) response to INVITE request (CAT-AS to UE#1)**
The CAT-AS sends the SIP 200 (OK) response for the (initial) SIP INVITE
request to UE#1.
> **45-46 ACK request (UE#1 to CAT-AS)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to CAT-AS.
> **47-48 ACK request (CAT-AS to UE#2)**
CAT-AS sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
NOTE 3: The ACK request from CAT-AS towards UE#2 may be sent after receiving
200 (OK) from UE#2 in step 18.
# A.6 Interworking with CS domain
## A.6.1 Introduction
The following signalling flows show interworking with the CS domain, when CAT
is provided by the terminating CS domain to the IMS, and when CAT is provided
to the originating CS domain from the IMS. The following flows are included:
\- subclause A.6.2 shows CAT when CAT is provided by the terminating CS
domain;
\- subclause A.6.3 shows CAT, using the forking model, when CAT is provided to
the originating CS domain;
\- subclause A.6.4 shows CAT, using the early session, model, when CAT is
provided to the originating CS domain;
The signalling flow in subclause A.6.2 is not dependent on which CAT model is
used.
## A.6.2 CAT provided by the terminating CS domain
Figure A.6.2-1: CAT provided by terminating CS system
> **1-2 INVITE request (UE#1 to MGCF) see example in table A.6.2-1**
UE#1 sends a SIP INVITE request to the MGCF.
The MGCF sends an ISUP IAM message to CS.
Table A.6.2-1: INVITE request (UE#1 to MGCF)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \,
> \
>
> P-Preferred-Identity: \"John Doe\" \
>
> P-Access-Network-Info: IEEE-802.11a
>
> P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Privacy: none
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Require: sec-agree
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Proxy-Require: sec-agree
>
> Security-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432;
> spi-s=87654321; port-c=8642; port-s=7531
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Accept:application/sdp, application/3gpp-ims+xml
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by UE#1 and
desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
> **3 183 (Session Progress) provisional response (MGCF to UE#1) see example
> in table A.6.2-2**
The MGCF sends a reliable SIP 183 (Session Progress) provisional response to
UE#1.
An early dialog is established between UE#1 and the MGCF.
CAT media is received from CS.
Table A.6.2-2: 183 (Session Progress) response (MGCF to UE#1)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> scscf1.home1.net;branch=z9hG4bK332b23.1pcscf1.visited1.net;branch=z9hG4bK240f34.1,
> SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f34.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Recv-Info: infoDtmf
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendonly
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 0 RTP/AVP 98
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**P-Early-Media:** The MGCF requests authorization for early media.
**Recv-Info:** The MGCF indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. The video stream is rejected. The local preconditions are indicated
as fulfilled.
> **4 PRACK request (UE#1 to MGCF)**
UE#1 sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the MGCF.
> **5 200 (OK) response to PRACK request (MGCF to UE#1)**
The MGCF sends a SIP 200 (OK) response for the SIP PRACK request to UE#1.
**6 ACM message (CS to MGCF)**
The MGCF receives an ISUP ACM message from CS.
> **7-8 200 (OK) response to INVITE request (MGCF to UE#1)**
The MGCF receives an ISUP ANM message from CS.
The MGCF sends a SIP 200 (OK) response for the SIP INVITE request to UE#1.
> **9 ACK request (UE#1 to MGCF)**
UE#1 sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to the MGCF.
## A.6.3 CAT provided to the originating CS domain with the CAT forking model
Figure A.6.3-1: CAT provided to originating CS system
> **1-2 INVITE request (MGCF to CAT-AS) see example in table A.6.3-1**
The MGCF receives an ISUP IAM message from CS.
The MGCF sends a SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to reserve CAT resources.
Table A.6.3-1: INVITE request (MGCF to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Privacy: none
>
> P-Early-Media: supported
>
> P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, 199
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 6666::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes=2
>
> a=rtpmap:96 telephone-event
**Supported:** The MGCF indicates support for preconditions, reliable
provisional responses, gruu and the 199 provisional response.
**P-Early-Media:** The MGCF indicates support for the P-Early-Media header.
**Recv-Info:** The MGCF indicates willingness to receive DTMF Info Packages in
INFO requests.
**Supported:** The MGCF indicates support for reliable provisional responses.
**SDP:** The SDP offer (SDP_O) contains a set of codecs supported by the MGCF
and desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
> **3-4 INVITE request (CAT-AS to UE#2)**
The CAT-AS forwards the SIP INVITE request to UE#2.
> **5-6 180 (Ringing) provisional response (UE#2 to CAT-AS)**
The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
response for the SIP INVITE request to the CAT-AS.
The CAT-AS terminates the SIP 180 (Ringing) provisional response.
> **7-8 183 (Session Progress) provisional response (CAT-AS to MGCF) see
> example in table A.6.3-2**
The CAT-AS sends a reliable SIP 183 (Session Progress) provisional response to
the MGCF.
An early dialog (D1) is established between the MGCF and the CAT-AS.
The MGCF sends an ISUP ACM message to CS.
Table A.6.3-2: 183 (Session Progress) response (CAT-AS to MGCF)
> SIP/2.0 183 Session Progress
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Recv-Info: infoDtmf
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> P-Early-Media: sendrecv
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::eee:fff:bbb:aaa
>
> s=-
>
> c=IN IP6 5555::eee:fff:bbb:aaa
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
>
> a=content:g.3gpp.cat
**P-Early-Media:** The CAT-AS requests authorization for early media.
**Recv-Info:** The CAT-AS indicates willingness to receive DTMF Info Packages
in INFO requests.
**SDP:** The SDP answer (SDP_A) contains a set of codecs supported to be used
for CAT and, in this example, includes a SDP \"a=content\" attribute with a
\"g.3gpp.cat\" value. The SDP content is based on information received from
the MRF. The local preconditions are indicated as fulfilled.
> **9 PRACK request (MGCF to CAT-AS)**
The MGCF sends a SIP PRACK request, which acknowledges the SIP 183 (Session
Progress) provisional response, to the CAT-AS.
The CAT-AS instructs the MRF to play CAT media.
> **10 200 (OK) response to PRACK request (CAT-AS to MGCF)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to the
MGCF.
> **11-12 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.6.3-3**
The called party answers the call. UE#2 sends a SIP 200 (OK) final response
for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.6.3-3: 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \,
> \, \,
> \
>
> From:
>
> To: \;tag=6322
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 6666::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 6666::eee:fff:aaa:bbb
>
> t=0 0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; maxframes
**SDP:** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **13-14 200 (OK) response to INVITE request (CAT-AS to MGCF)**
The CAT-AS forwards the SIP 200 (OK) response to the MGCF.
A dialog (D2) is established between the MGCF and UE#2.
The early dialog (D1) between the MGCF and the CAT-AS is terminated.
The MGCF sends an ISUP ANM message to CS.
> **15 ACK request (MGCF to UE#2)**
The MGCF sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
response, to UE#2.
## A.6.4 CAT provided to the originating CS domain with the CAT early session
model
Figure A.6.4-1: CAT provided to originating CS domain with the CAT early-
session model
> **1-2. INVITE request (MGCF to CAT-AS) see example in table A.6.4-2**
>
> The MGCF receives an ISUP IAM message from CS domain.
>
> The MGCF sends a SIP INVITE request to the CAT-AS.
>
> The CAT-AS instructs the MRF to reserve CAT resources.
Table A.6.4-2: INVITE request (MGCF to CAT-AS)
> INVITE tel:+1-212-555-2222 SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Privacy: none
>
> P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
>
> Accept-Contact: *;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> From: \;tag=171828
>
> To: \
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 127 INVITE
>
> Recv-Info: infoDtmf
>
> Supported: precondition, 100rel, gruu, early-session
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3400 RTP/AVP 98 99
>
> b=AS:75
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> a=rtpmap:99 MP4V-ES
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos none remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
**Supported:** The UE indicates support for preconditions, reliable
provisional responses, gruu and early-session disposition type.
**Recv-Info:** The UE indicates willingness to receive DTMF Info Packages in
INFO requests.
**SDP** The SDP offer (SDP_O) contains a set of codecs supported by the MGCF
and desired by the calling user for this session. The local preconditions are
indicated as fulfilled.
> **3 INVITE request (CAT-AS to UE#2)**
>
> The CAT-AS forwards the SIP INVITE request to UE#2.
>
> **4 180 (Ringing) provisional response (UE#2 to CAT-AS)**
>
> The called party is alerted. UE#2 sends a SIP 180 (Ringing) provisional
> response for the SIP INVITE request to the CAT-AS.
>
> **5 180 (Ringing) provisional response (CAT-AS to MGCF) see example in
> table** **A.6.4-5**
>
> The CAT-AS sends a reliable SIP 180 (Ringing) provisional response to the
> MGCF.
Table A.6.4-5: SIP 180 (Ringing) responses (CAT-AS to MGCF)
> SIP/2.0 180 Ringing
>
> Via: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Record-Route: \
>
> From:
>
> To: \;tag=2236
>
> Call-ID:
>
> Cseq:
>
> Require: 100rel
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> RSeq: 9022
>
> Contact: \;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-
> service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::eee:fff:aaa:bbb
>
> s=-
>
> c=IN IP6 5555::eee:fff:aaa:bbb
>
> t=0 0
>
> m=video 10001 RTP/AVP 98 99
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:98 H263
>
> a=rtpmap:99 MP4V-ES
>
> a=fmtp:98 profile-level-id=0
>
> a=content:g.3gpp.cat
>
> m=audio 6544 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=conf:qos remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
>
> a=content:g.3gpp.cat
**Early Session SDP** The early session SDP offer (early-session SDP_O)
contains a set of codecs supported to be used for CAT and, in this example,
includes a SDP \"a=content\" attribute with a \"g.3gpp.cat\" value for each
media description. The SDP content is based on information received from the
MRF. The local preconditions are indicated as fulfilled.
> **6 ACM/CPG message (MGCF to CS domain)**
>
> The MGCF sends an ACM or CPG message to CS domain.
>
> If the IMS CAT is multimedia, the MGCF shall take an indication in ACM or
> CPG message which instructs originating MSC to initiate H.245 negotiation
> between CS user and MGCF.
NOTE: How to take the indication in ACM or CPG message is out of scope of this
specification.
**7** **PRACK request (MGCF to CAT AS) see example in table A.6.4-7**
> The MGCF sends a SIP PRACK request, which acknowledges the SIP 180 (Ringing)
> provisional response, to the CAT-AS.
>
> An early dialog using early-session SDP is established between the MGCF and
> the CAT-AS.
>
> The CAT-AS instructs the MRF to play CAT media.
**Table A.6.4-7: SIP PRACK Request (MGCF to CAT AS)**
> PRACK sip:cat-as.home1.net SIP/2.0
>
> Via: SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> Max-Forwards: 70
>
> Route: \
>
> From: \;tag=171828
>
> To: \;tag=2236
>
> Call-ID: cb03a0s09a2sdfglkj490333
>
> Cseq: 128 PRACK
>
> Require: precondition
>
> RAck: 9022 127 INVITE
>
> Content-Type: application/sdp
>
> Content-Disposition: early-session
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933616 2987933616 IN IP6 5555::aaa:bbb:ccc:ddd
>
> s=-
>
> c=IN IP6 5555::aaa:bbb:ccc:ddd
>
> t=0 0
>
> m=video 3402 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3458 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
**Early Session SDP** The early session SDP answer (early-session SDP_A)
contains a set of codecs to be used for the CAT. If preconditions are used,
they are indicated as fulfilled.
> **8 200 (OK) response to PRACK request (CAT-AS to MGCF)**
The CAT-AS sends a SIP 200 (OK) response for the SIP PRACK request to the
MGCF.
> **9 200 (OK) response to INVITE request (UE#2 to CAT-AS) see example in
> table A.6.4-9**
>
> The called party answers the call. UE#2 sends a SIP 200 (OK) final response
> for the SIP INVITE request to the CAT-AS.
The CAT-AS instructs the MRF to stop CAT media.
Table A.6.4-9: SIP 200 (OK) response (UE#2 to CAT-AS)
> SIP/2.0 200 OK
>
> Via: SIP/2.0/UDP
> pcscf2.visited2.net:5088;comp=sigcomp;branch=z9hG4bK361k21.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764XC12.1, SIP/2.0/UDP
> catas.home2.net;branch=z9hG4bK764Q32.1, SIP/2.0/UDP
> scscf2.home2.net;branch=z9hG4bK764z87.1, SIP/2.0/UDP
> icscf2_s.home2.net;branch=z9hG4bK871y12.1, SIP/2.0/UDP
> [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7
>
> From:
>
> To:
>
> Call-ID:
>
> Cseq:
>
> Allow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE
>
> Contact:
> \ >;+g.3gpp.icsi_ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"
>
> Content-Type: application/sdp
>
> Content-Length: (...)
>
> v=0
>
> o=- 2987933615 2987933615 IN IP6 5555::ggg:hhh:iii:jjj
>
> s=-
>
> c=IN IP6 5555::ggg:hhh:iii:jjj
>
> t=0 0
>
> m=video 3400 RTP/AVP 98
>
> b=AS:75
>
> a=curr:qos local sendrecv
>
> a=curr:qos remote sendrecv
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:98 H263
>
> a=fmtp:98 profile-level-id=0
>
> m=audio 3456 RTP/AVP 97 96
>
> b=AS:25.4
>
> a=curr:qos local none
>
> a=curr:qos remote none
>
> a=des:qos mandatory local sendrecv
>
> a=des:qos mandatory remote sendrecv
>
> a=rtpmap:97 AMR
>
> a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
>
> a=rtpmap:96 telephone-event
>
> a=maxptime:20
**SDP** The SDP answer (SDP_A) contains a set of codecs to be used for the
session. If preconditions are used, they are indicated as fulfilled.
> **10-11 200 (OK) responses to INVITE request (CAT-AS to MGCF)**
>
> The CAT-AS forwards the SIP 200 (OK) response to the MGCF.
>
> The dialog for session is established between the MGCF and UE#2.
>
> The early dialog using early-session SDP between the MGCF and the CAT-AS is
> terminated.
>
> The MGCF sends an ISUP ANM message to CS domain.
>
> **12 ACK request (MGCF to UE#2)**
>
> The MGCF sends a SIP ACK request, which acknowledges the SIP 200 (OK) final
> response, to UE#2.
###### ## Annex B (normative): SDP a=content attribute \"g.3gpp.cat\" value
## B.1 Introduction
This annex provides the IANA registration information for a new value,
g.3gpp.cat, for the SDP a=content media-level attribute defined in RFC 4796
[12]. The attribute value is used indicate that an SDP media descriptions is
associated with the CAT service.
## B.2 New value
IANA registration table: \"content SDP Parameters\" table of \"Session
Description Protocol (SDP) Parameters\" registry
SDN name: g.3gpp.cat
Description: Stream associated with the 3GPP Customized Alerting Ringtone
(CAT) service.
Reference: 3GPP TS 24.182
#
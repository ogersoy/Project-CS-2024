# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies a Reliable Data Service (RDS) protocol.
The present document defines the frame structure, format of fields and
procedures for operation of the RDS protocol. RDS is mainly intended to be
used for acknowledged data transfer, but it also supports unacknowledged data
transfer.
The present document is applicable to the UE, the SCEF and to the P-GW in the
Evolved Packet System (EPS) and to the UE, the SMF, NEF and to the UPF in the
5G System (5GS).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
with packet data networks and applications\".
[3] IETF RFC 4122: \"A Universally Unique IDentifier (UUID) URN Namespace\".
[4] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.682 [2] apply:
**SCEF**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.501 [4] apply:
**SMF**
**NEF**
**UPF**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
RDS Reliable Data Service
# 4 Overview
## 4.1 General
The Reliable Data Service (RDS) protocol supports the following requirements:
\- RDS supports peer-to-peer data transfers and shall provide reliable data
delivery between the UE and the network. In EPS the data is transferred via a
PDN connection between the UE and SCEF or P-GW. In 5GS the data is transferred
between the UE and NEF or UPF via a PDU session between the UE and SMF.
\- A UE can connect to multiple network entities. In EPS a UE can connect to
multiple SCS/AS via the SCEF or P-GW. In 5GS a UE can connect to multiple AF
via the NEF or UPF.
\- RDS shall support multiple applications on the UE to simultaneously conduct
data transfers with their peer entities on the network using a single PDN
connection or a PDU session between the UE and the network.
\- RDS shall support both acknowledged and unacknowledged data transfers.
\- RDS shall support variable-length frames and shall allow detection and
elimination of duplicate frames at the receiving endpoint.
## 4.2 Reference Model
Figure 4.2-1: Protocol layering for reliable data transfer between UE and SCEF
in EPS
The reference model showing the protocol layering for reliable data transfer
between UE and SCEF in EPS is illustrated in figure 4.2-1.
Figure 4.2-2: Protocol layering for reliable data transfer between UE and NEF
in 5GS
The reference model showing the protocol layering for reliable data transfer
between UE and NEF in 5GS is illustrated in figure 4.2-2.
## 4.3 Description of RDS protocol
### 4.3.1 Protocol functions
RDS establishes a peer-to-peer logical link between the UE and the network.
The logical link is identified by,
-a pair of port numbers and EPS bearer ID in EPS; or
\- a pair of port numbers, PDU session identity and the QoS Flow Identifier in
5GS.
Each port number is used to identify an application on the UE side or at the
network side and is carried in the address field of each frame. The source
port number identifies the application on the originator and the destination
port number identifies the application on the receiver. When a single
application on the originator conducts data transfer with a single application
on the receiver, the source port number and destination port number need not
be used. Each RDS frame shall consist of a header and an information field of
variable length. The header shall contain information about port numbers and
the frame number that is used to identify the frame and provide reliable
transmission. The information field contains the payload to be transferred
between the UE and the network.
In EPS,
\- the UE establishes a PDN connection with the SCEF or P-GW either during
Attach or through UE requested PDN connectivity. The UE shall use the EPS
bearer ID to select the bearer to transfer RDS PDUs to the SCEF or P-GW. The
EPS bearer ID identifies the destination (at the UE or at the SCEF or P-GW)
and is not carried in the frame as it is already included in the NAS ESM
message header.
In 5GS,
\- the UE establishes a PDU session with the SMF through UE requested PDU
session establishment procedure. The UE shall use the PDU session identity and
the QoS Flow Identifier to select the flow to transfer RDS PDUs to the NEF or
UPF. The PDU session identity identifies the destination (at the UE or at the
NEF or UPF) and is not carried in the frame as it is already included in the
NAS 5GSM message header.
Once the UE and network successfully negotiate to use RDS for a particular PDN
connection or a PDU session, the PDN connection or PDU session shall transfer
data only using RDS protocol.
RDS shall support both single and multiple applications within the UE. RDS
enables applications to reserve source and destination port numbers for their
use and also subsequently release the reserved port numbers. RDS also enables
applications to query their peer entities to determine which port numbers are
reserved and which are available for use at any given time. RDS shall provide
fuctionality for flow control and sequence control to maintain the sequential
order of frames across the logical link. The UE and the network may support
reservation of the source and the destination port numbers for their use and
subsequent release of the reserved port numbers.
### 4.3.2 Acknowledged operation
In acknowledged operation the information is transmitted in order in numbered
Information (I) frames. The I frames are acknowledged at the RDS layer. Error
recovery and reordering mechanisms based on retransmission of acknowledged I
frames are specified. Several I frames can be acknowledged at the same time.
Flow control is implemented via a sliding window mechanism.
The procedure for establishment of acknowledged transfer is described in
clause 6.
### 4.3.3 Unacknowledged operation
In unacknowledged operation the information is transmitted in numbered
Unconfirmed Information (UI) frames. The UI frames are not acknowledged at the
RDS layer. Error recovery and reordering mechanisms are not defined. Duplicate
UI frames are discarded. Flow control procedures are not defined.
# 5 Frame structure and format of fields
## 5.1 General
The peer-to-peer transfers using RDS shall conform to the frame format as
shown in figure 5.1-1. The frame header shall consist of the Address and
Control field and is a minimum of 1 octet and a maximum of 3 octets long. The
Information field is of variable length.
* * *
8 7 6 5 4 3 2 1
Address and Control field  
(variable length, max. 3 octets)
Information field  
(variable length, max. N201 octets)
* * *
Figure 5.1-1: RDS frame format
## 5.2 Address and Control field
### 5.2.1 Address and Control field format
The Address and Control field identifies the type of frame and consists of
minimum of 1 octet and maximum of 3 octets. The following types of control
field frames are specified:
\- confirmed information transfer (I frame);
\- supervisory functions (S frame);
\- unconfirmed information transfer (UI frame); and
\- control functions (U frame).
The address and control field format for RDS is shown in figure 5.2.1-1.The
description of address and control field bits is shown in Table 5.2.1-1.
Figure 5.2.1-1: Address and Control field format
Table 5.2.1-1: Address and Control field bits description
* * *
Control field bits Description A Acknowledgement request bit M~n~ Unnumbered
function bit N(R) Receive sequence number N(S) Send sequence number N(U)
Unconfirmed sequence number S~n~ Supervisory function bit R~n~ Selective
acknowledgement bitmap bit PD Protocol Discriminator bit C/R Command /
Response bit ADS Address bit Source Port Source port number Destination Port
Destination port number X Spare bit
* * *
### 5.2.2 Protocol Discriminator bit (PD)
The PD bit indicates whether a frame is an RDS frame or belongs to a different
protocol. RDS frames shall have the PD bit set to 0. If a frame with the PD
bit set to 1 is received, then it shall be treated as an invalid frame.
### 5.2.3 Address bit (ADS)
The ADS bit controls if the Source Port and Destination Port are included in
the frame format. When a single application on UE side conducts data transfer
with a single application on networkside, the source and destination port
numbers need not be used. The source and destination port numbers enable
multiple applications on the UE side to simultaneously communicate with their
peer entities on the network side using the same PDN connection or PDU
session. Source Port and Destination Port are included in the frame format
only if the ADS bit is set to 1.
### 5.2.4 Source port number (Source Port)
When a UE application starts to use the PDN connection or a PDU session to
transmit RDS frames, the UE and the network establish which source port number
will be used for the application on the UE side for MO traffic and which
destination port number will be used for the application intended to receive
the frames on the network side. Similarly for MT traffic when an application
in the network starts to use the PDN connection or PDU session to transmit RDS
frames, the UE and the network establish which source port number will be used
for the application on the network side and which destination port number will
be used for the application intended to receive the frames on the UE side.
Applications on the originator side and their peer entities on receiver side
can synchronize port numbers using port management functionality as described
in subclause 5.4.2.6 or using means outside the scope of this specification.
Source Port is included only if the ADS bit is 1. Source Port shall have
values from 0 to 15.
### 5.2.5 Destination port number (Destination Port)
The Destination Port is used to identify the destination application on the
receiver that is receiving the frame.
Destination Port is included only if the ADS bit is 1. Destination Port shall
have values from 0 to 15.
### 5.2.6 Information transfer frame - I
The I frame shall be used to perform an information transfer between peer
entities with acknowledgement. Each I frame has a send sequence number N(S), a
receive sequence number N(R) and an acknowledgement request bit A, that may be
set to 0 or 1. The use of N(S), N(R), and A is defined in clause 6.
Each I frame also contains supervisory function bits S(n) and the Selective
Acknowledgement bitmap R(n) which are defined in subclause 5.3.2.
### 5.2.7 Supervisory frame - S
The S frame shall be used to perform supervisory control functions such as
acknowledge I frames. The supervisory frame has supervisory function bits S(n)
that are used for encoding commands and responses which perform the
supervisory control functions. Each supervisory frame has a receive sequence
number N(R) and an acknowledgement request bit A, that may be set to 0 or 1.
In acknowledged operation, all I and S frames contain R(n), the Selective
Acknowledgement bitmap. The commands and responses are defined in subclause
5.4 and the use of S(n), N(R), A and R(n) is defined in clause 6.
### 5.2.8 Unconfirmed Information frame - UI
The UI frame shall be used to perform an information transfer between peer
entities without acknowledgement. The UI frames contain N(U), the unconfirmed
sequence number of transmitted UI frames. No verification of sequence numbers
is performed for UI frames.
### 5.2.9 Unnumbered frame â€‘ U
The U frame shall be used to provide additional link control functions. Each U
frame has Unnumbered function bits M(n) that are used to encode link control
commands and response. The U frame has Command/Response bit (C/R) that
identifies a U frame as either a command or a response. The U fame contains no
sequence number. The commands and responses are defined in subclause 5.4 and
the use of M(n) is defined in clause 6.
### 5.2.10 Command / Response bit (C/R)
The C/R bit identifies a frame as either a command or a response. The UE side
shall send commands with the C/R bit set to 0, and responses with the C/R bit
set to 1. The network side shall do the opposite; i.e., commands are sent with
C/R set to 1, and responses are sent with C/R set to 0. The combinations for
the network side and UE side are shown in table 5.2.10-1.
Table 5.2.10-1: C/R field bit usage
* * *
Type Direction C/R value Command Network side to UE side 1 Command UE side to
Network side 0 Response Network side to UE side 0 Response UE side to Network
side 1
* * *
## 5.3 Control field parameters and associated state variables
The various parameters associated with the control field frames are described
in this subclause.
### 5.3.1 Acknowledgement request bit (A)
All I and S frames contain the Acknowledgement Request (A) bit.
The A bit set to 1 is used to solicit an acknowledgement (i.e., an I frame or
S frame) from the receiver. The A bit set to 0 is used to indicate that the
receiver is not requested to send an acknowledgement.
### 5.3.2 Acknowledged operation variables and parameters
#### 5.3.2.1 Send state variable V(S)
In acknowledged operation, each originator shall have an associated send state
variable V(S) when using I frames. V(S) denotes the sequence number of the
next in-sequence I frame to be transmitted. V(S) can take on the value 0
through (MAX SEQUENCE NUMBER -1). The value of V(S) shall be incremented by 1
with each successive I frame transmission, and shall not exceed acknowledge
state variable V(A) by more than the maximum number of outstanding I frames k.
The value of k may be in the range 1 â‰¤ k â‰¤ (MAX SEQUENCE NUMBER/2 -1). V(S)
shall not be incremented when an I frame is retransmitted.
#### 5.3.2.2 Acknowledge state variable V(A)
In acknowledged operation, each peer originator shall have an associated
acknowledge state variable V(A) when using I frame and supervisory frame
commands and responses. V(A) identifies the first I frame in the transmit
window, so that V(A) â€‘ 1 equals N(S) of the last in-sequence acknowledged I
frame. V(A) can take on the value 0 through (MAX SEQUENCE NUMBER -1). The
value of V(A) shall be updated by the valid N(R) values received from its peer
(see subclause 5.3.2.5). A valid N(R) value is in the range V(A) â‰¤ N(R) â‰¤
V(S).
#### 5.3.2.3 Send sequence number N(S)
In acknowledged operation, only I frames contain N(S), the send sequence
number of transmitted I frames. At the time that an in-sequence I frame is
designated for transmission, the value of N(S) is set equal to the value of
the send state variable V(S).
#### 5.3.2.4 Receive state variable V(R)
In acknowledged operation, each receiver shall have an associated receive
state variable V(R) when using I frame and supervisory frame commands and
responses. V(R) denotes the sequence number of the next in-sequence I frame
expected to be received. V(R) can take on the value 0 through (MAX SEQUENCE
NUMBER -1). The value of V(R) shall be incremented by one with the receipt of
an error-free, in-sequence I frame whose send sequence number N(S) equals
V(R).
#### 5.3.2.5 Receive sequence number N(R)
In acknowledged operation, all I frames and S frames contain N(R), the
expected send sequence number of the next in-sequence received I frame. At the
time that a frame of the above types is designated for transmission, the value
of N(R) is set equal to the value of the receive state variable V(R). N(R)
indicates that the receiver transmitting the N(R) has correctly received all I
frames numbered up to and including N(R) â€‘ 1.
#### 5.3.2.6 Selective Acknowledgement (SACK) bitmap R(n)
In acknowledged operation, all I frames and S frames contain R(n), the SACK
bitmap. At the time that a S frame is designated for transmission, the value
of each bit R(n) in the bitmap shall be set to 0 or 1 depending on whether I
frame number N(R) + n has been received or not. R(n) = 1 indicates that the
receiver transmitting the S frame has correctly received I frame number N(R) +
n. R(n) = 0 indicates that the receiver transmitting the S frame has not
correctly received I frame number N(R) + n. The SACK bitmap contains (k) bits.
### 5.3.3 Unacknowledged operation variables and parameters
#### 5.3.3.1 Unconfirmed send state variable V(U)
Each peer entity shall have an associated unconfirmed send state variable V(U)
when using UI frame commands. V(U) denotes the sequence number of the next UI
frame to be transmitted. V(U) can take on the value 0 through 7. The value of
V(U) shall be incremented by 1 with each successive UI frame transmission.
#### 5.3.3.2 Unconfirmed sequence number N(U)
Only UI frames contain N(U), the unconfirmed sequence number of transmitted UI
frames. At the time that a UI frame is designated for transmission, the value
of N(U) is set equal to the value of the unconfirmed send state variable V(U).
#### 5.3.3.3 Unconfirmed receive state variable V(UR)
Each peer entity shall have an associated unconfirmed receive state variable
V(UR) when using UI frame commands. V(UR) denotes the sequence number of the
next in-sequence UI frame expected to be received. V(UR) can take on the value
0 through 7.
#### 5.3.3.4 Other parameters and variables
The only other parameter defined for unacknowledged operation is the number of
octets (N201) in the information field of the UI frame. See subclause 6.4.6.
## 5.4 Commands and responses
### 5.4.1 General
The following commands and responses are used by the UE side and Network side
as shown in table 5.4.1-1. Each link connection shall support the appropriate
set of commands and responses for the type of operation desired.
Table 5.4.1-1: Commands and responses
+---------+-----------------+-----------------+----------+----+----+----+----+----+ | Frame | Commands | Responses | Encoding | | | | | | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | | | | S1 | S2 | M4 | M3 | M2 | M1 | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | S Frame | SACK | SACK | 1 | 1 | - | - | - | - | | | | | | | | | | | | or | | | | | | | | | | | | | | | | | | | | I Frame | | | | | | | | | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | U Frame | ERROR | ERROR | - | - | 0 | 0 | 0 | 1 | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | U Frame | DISCONNECT | - | - | - | 0 | 1 | 0 | 0 | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | U Frame | - | ACCEPT | - | - | 0 | 1 | 1 | 0 | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | U Frame | SET_ACK_MODE | - | - | - | 0 | 1 | 1 | 1 | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | U Frame | SET_PARAMETERS | SET_PARAMETERS | - | - | 1 | 0 | 1 | 1 | +---------+-----------------+-----------------+----------+----+----+----+----+----+ | U Frame | MANAGE_PORT | MANAGE_PORT | - | - | 1 | 0 | 1 | 0 | +---------+-----------------+-----------------+----------+----+----+----+----+----+
### 5.4.2 Unnumbered (U) frames
#### 5.4.2.1 SET_ACK_MODE command
The originator shall use the SET_ACK_MODE command to initiate acknowledged
operation between the UE and network.
The receiver shall confirm acceptance of a SET_ACK_MODE command by the
transmission of an ACCEPT response. Upon acceptance of SET_ACK_MODE command,
the send state variable V(S), acknowledge state variable V(A), and receive
state variable V(R), shall be set to 0. The transmission of a SET_ACK_MODE
command indicates the clearance of any exception conditions.
Previously transmitted I frames that are unacknowledged when this command is
sent shall be discarded. It is the responsibility of higher layers to recover
from the possible loss of the contents of such I frames.
#### 5.4.2.2 DISCONNECT command
The DISCONNECT command shall be transmitted in order to terminate the
acknowledged operation.
No information field is permitted with the DISCONNECT command. Prior to
executing the command, the receiver side receiving the DISCONNECT command
shall confirm the acceptance of a DISCONNECT command by the transmission of an
ACCEPT response. The originator that sends the DISCONNECT command shall
terminate the acknowledge mode operation when it receives the ACCEPT or ERROR
response.
Previously transmitted I frames that are unacknowledged when this command is
executed shall remain unacknowledged and shall be discarded. It is the
responsibility of higher layers to recover from the possible loss of the
contents of such I frames.
#### 5.4.2.3 ACCEPT response
The ACCEPT response shall be used by the originator to acknowledge the receipt
and acceptance of the SET_ACK_MODE or DISCONNECT commands. The SET_ACK_MODE or
DISCONNECT commands are acted upon only after the ACCEPT response is
transmitted.
#### 5.4.2.4 ERROR command / response
The ERROR unnumbered command shall be used by the originator to report to the
receiver that the originator is in a state such that acknowledged operation
cannot be performed. The receiver shall transmit an ERROR response to any
valid command received that it cannot execute. No information field is
permitted with the ERROR command or ERROR response.
#### 5.4.2.5 SET_PARAMETERS command / response
The SET_PARAMETERS command and response is used to negotiate values of
parameters between originator and receiver in both acknowledged and
unacknowledged mode of transfer. These parameters shall include the version of
the RDS.
If the originator wants to negotiate the value of parameters, the originator
shall send a SET_PARAMETERS command including the set of parameters along with
their values to the receiver. The receiver shall send a SET_PARAMETERS
response, either confirming these parameter values by returning the requested
values, or proposing different ones in their place. Both, the originator and
the receiver shall use the negotiated values after the completion of the
negotiation process.
Table 5.4.2.5-1 lists the negotiable RDS layer parameters. Figure 5.4.2.5-1
shows the SET_PARAMETERS field format. A parameter item consists of Type and
Length octets followed by the value of that parameter. The Length octet
indicates the number of octets that the value actually occupies.
Figure 5.4.2.5-1: SET_PARAMETERS field format
Table 5.4.2.5-1: RDS layer parameters
* * *
Parameter Name Type Length Format (87654321) Range RDS_Version 0 1 bbbbbbbb 0
through 255
* * *
#### 5.4.2.6 MANAGE_PORT command / response
##### 5.4.2.6.1 General
The originator and receiver may support the handling specified in subclause
5.4.2.6.
The MANAGE_PORT command and response is used to manage association of
applications with source and destination port numbers between originator and
receiver in both acknowledged and unacknowledged mode of transfer. The
MANAGE_PORT command and response can be used to:
\- reserve a combination of source and destination port numbers for use with a
specific application;
\- release a combination of source and destination port numbers that are
reserved;
\- query the list of port numbers that are reserved for use with a specific
application; and
\- notify the list of port numbers that are reserved for use with a specific
application.
Port number 0 shall not be reserved at the originator or receiver. If an
application at the originator communicates with multiple applications at the
receiver, then the application does not reserve a port number at destination
and shall set the Destination Port to 0. The ADS bit in the U frame header of
MANAGE_PORT command and response is set to 0. Table 5.4.2.6.1-1 lists the
parameters used in MANAGE_PORT command and response frames.
Table 5.4.2.6-1: MANAGE_PORT parameters
+----------------------------------------------------------------------+ | Action (Bits 1 to 4, octet 1) | | | | This field indicates the operation that the originator or receiver | | performs as part of MANAGE_PORT command or response and can have | | the following values | +----------------------------------------------------------------------+ | Bits | | | | **4 3 2 1** | | | | 0 0 0 1 Reserve port | | | | 0 0 1 0 Release port | | | | 0 0 1 1 Query port | | | | 0 1 0 0 Notify port | | | | All other values are reserved. | | | | Application Id | | | | This field shall be encoded as a sequence of a sixteen octet OS Id | | field, a one octet OS App Id length field, and an OS App Id field. | | The OS Id is the operating system Identifier and it contains a UUID | | as specified in IETF RFC 4122 [3]. The OS App Id field contains an | | OS specific application identifier of variable length octets. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Status (octet 2) | | | | This field is used only in the response frame in the direction from | | the receiver to the originator. It specifies the status of the | | operation and can have the following values: | | | | Bits\ | | **8 7 6 5 4 3 2 1** | | | | 0 0 0 0 0 0 0 0 Success\ | | 0 0 0 0 0 0 0 1 Port not free\ | | 0 0 0 0 0 0 1 0 Port not associated with specified application\ | | \ | | All other values are reserved. | | | | Requested port numbers | | | | This field indicates the destination port numbers that the | | originator wants to query and shall be encoded as a bitmap of two | | octets as indicated below. | | | | Port numbers not available | | | | This field indicates the port numbers that are reserved and for | | which information is not included in the command or response frame. | | This field shall be encoded as a bitmap of two octets as indicated | | below. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+
a) Requested port numbers
> The port numbers that are requested are coded in the first and second octet
> of the Requested port numbers bitmap as follows:
* * *
bit 8 7 6 5 4 3 2 bit 1  
Port 7 Port 6 Port 5 Port 4 Port 3 Port 2 Port 1 (reserved) Octet 1
* * *
* * *
bit 16 15 14 13 12 11 10 bit 9  
Port 15 Port 14 Port 13 Port 12 Port 11 Port 10 Port 9 Port 8 Octet 2
* * *
> A port number is requested, if the corresponding bit is set to \"1\". All
> reserved bits shall be set to \"0\".
b) Port numbers not available
> The port numbers that are not available are coded in the first and second
> octet of the Port numbers not available bitmap as follows:
* * *
bit 8 7 6 5 4 3 2 bit 1  
Port 7 Port 6 Port 5 Port 4 Port 3 Port 2 Port 1 (reserved) Octet 1
* * *
* * *
bit 16 15 14 13 12 11 10 bit 9  
Port 15 Port 14 Port 13 Port 12 Port 11 Port 10 Port 9 Port 8 Octet 2
* * *
> A port number is not available, if the corresponding bit is set to \"1\".
> All reserved bits shall be set to \"0\".
##### 5.4.2.6.2 Reserve port numbers
If the originator wants to reserve a combination of source and destination
port numbers for an application, the originator shall send a MANAGE_PORT
command as shown in figure 5.4.2.6.2-1 by setting the Action field to
\"Reserve port\" and setting the Application ID field to the application to be
associated with the combination of the Source Port and Destination Port
numbers specified in the MANAGE_PORT command.
Figure 5.4.2.6.2-1: MANAGE_PORT command field format for Action \"Reserve
port\"
The receiver shall send a MANAGE_PORT response as shown in figure 5.4.2.6.2-2,
by setting the Action field in response frame to \"Reserve port\". If the
destination port specified in the MANAGE_PORT command frame is not associated
with any application on the receiver, the receiver shall reserve the
destination port for use with the application identifier included in the
MANAGE_PORT command frame, and shall set the Status field in MANAGE_PORT
response frame to \"Success\", otherwise the Status field is set to \"Port not
free\".
Figure 5.4.2.6.2-2: MANAGE_PORT response field format for Action \"Reserve
port\"
If the Status field is set to \"Success\" in the MANAGE_PORT response frame,
the originator shall reserve the Source Port for use with the application
specified in the MANAGE_PORT command.
##### 5.4.2.6.3 Release port numbers
If the originator wants to release a combination of source and destination
port numbers for an application, the originator shall send a MANAGE_PORT
command as shown in figure 5.4.2.6.3-1 by setting the Action field to
\"Release port\" and setting the Application ID field to the application
currently associated with the combination of the Source Port and Destination
Port numbers in the MANAGE_PORT command.
Figure 5.4.2.6.3-1: MANAGE_PORT command field format for Action \"Release
port\"
The receiver shall send a MANAGE_PORT response, by setting the Action field in
response frame to \"Release port\". If the Destination Port specified in the
header of the MANAGE_PORT command frame on the receiver is associated with the
application specified in the MANAGE_POR command frame, the receiver shall
release the Destination Port from use with the application identifier included
in the MANAGE_PORT command frame and shall set the Status field in MANAGE_PORT
response frame to \"Success\", otherwise the Status field is set to \"Port not
associated with specified application\".
**Figure 5.4.2.6.3-2: MANAGE_PORT response field format for Action \"Release
port\"**
If the Status field is set to \"Success\" in the MANAGE_PORT response frame,
the originator shall release the Source Port from use with the application
that it is associated with.
##### 5.4.2.6.4 Query port numbers
If the originator wants to query the destination port numbers that are
reserved, the originator shall send a MANAGE_PORT command as shown in figure
5.4.2.6.4-1 by setting the Action field to \"Query port\" and indicating the
destination port numbers that it intends to query in the optional Requested
port numbers. If the originator intends to query all the port numbers, then it
shall not include the Requested port numbers.
Figure 5.4.2.6.4-1: MANAGE_PORT command field format for Action \"Query port\"
The receiver shall send a MANAGE_PORT response as shown in figure 5.4.2.6.4-2,
by setting the Action field in response frame to \"Query port\". For each
destination port included in the Requested port numbers in the MANAGE_PORT
command that is reserved on the receiver and is associated with an
application, the receiver shall include an entry in the MANAGE_PORT response.
The receiver shall set the Num Entries field in the MANAGE_PORT response to
the number of destination ports entries that are included in the MANAGE_PORT
response. For each destination port entry, the receiver shall include the
Source Port number that the destination port is paired with and the associated
Application ID. If the receiver does not have any reserved source port number
for the associated Application ID, the Source Port number shall be set to 0.
In the case that the entries for all the destination port numbers requested by
the originator do not fit in the MANAGE_PORT response, the receiver shall
include as many entries for destination port numbers as possible in the
MANAGE_PORT response. For all the destination port numbers that are reserved
on the receiver, for which the originator has requested information in
Requested port numbers in the MANAGE_PORT command and for which information
cannot be included in the MANAGE_PORT response, the receiver shall set the
corresponding entry in the optional Port numbers not available bitmap. The
originator can subsequently query information on these destination port
numbers by sending another MANAGE_PORT command and setting Requested port
numbers to Port numbers not available in the received MANAGE_PORT response. If
the entries for all the destination port numbers requested by the originator
fit in the MANAGE_PORT response, the receiver shall not include the optional
Port numbers not available.
NOTE: The entries for all the destination port numbers requested by the
originator will fit in the MANAGE_PORT response for cases where the maximum
length of the OS specific application identifier is equal-to or less-than 64
octets.
Figure 5.4.2.6.4-2: MANAGE_PORT response field format for Action \"Query
port\"
##### 5.4.2.6.5 Notify port numbers
If the originator wants to notify the receiver of the source port numbers that
are reserved at the originator, the originator shall send a MANAGE_PORT
command as shown in figure 5.4.2.6.5-1 by setting the Action field to \"Notify
port\".
For each source port that is reserved on the originator and is associated with
an application, the originator shall include an entry in the MANAGE_PORT
command. The originator shall set the Num Entries field in the MANAGE_PORT
command to the number of source ports entries that are included in the
MANAGE_PORT response. For each source port that is reserved, the originator
shall include the Destination Port number that the source port is paired with
and the associated Application ID. If the originator does not have any
reserved destination port number for the associated Application ID, the
Destination Port number shall be set to 0.
In the case that the entries for all the source port numbers do not fit in the
MANAGE_PORT command, the originator shall include as many entries on source
port numbers as possible in the MANAGE_PORT command. For all the source port
numbers that are reserved on the originator and for which information cannot
be included in the MANAGE_PORT command, the originator shall set the
corresponding entry in the optional Port numbers not available bitmap. The
receiver can subsequently query information on these source port numbers by
sending another MANAGE_PORT command by setting the Action field to \"Query
port\" and setting Requested port numbers to Port numbers not available in the
received MANAGE_PORT command. If the entries for all the source port numbers
fit in the MANAGE_PORT command, the originator shall not include the Port
numbers not available.
NOTE: The entries for all the source port numbers will fit in the MANAGE_PORT
command for cases where the maximum length of the OS specific application
identifier is equal-to or less-than 64 octets.
Figure 5.4.2.6.5-1: MANAGE_PORT command field format for Action \"Notify
port\"
There is no response frame sent by receiver when it receives the MANAGE_PORT
command with Action field set to \"Notify port\".
### 5.4.3 Information (I) and Supervisory (S) frames
#### 5.4.3.1 General
The function of the information (I) frame is to transfer, sequentially-
numbered frames containing information fields provided by upper layers. This
frame shall only be used in acknowledge operation.
Numbered I frames shall also carry supervisory information. A separate S frame
is sent when there is no information field to be transferred. Whether an I or
S frame is transmitted as a command or as a response is insignificant in the
acknowledge operation.
#### 5.4.3.2 Selective Acknowledgement (SACK) command / response
The supervisory frame containing the SACK bitmap shall be used by a receiver
to acknowledge a single or multiple I frames. Frames up to and including N(R)
â€‘ 1, and frames indicated by the SACK bitmap, are deemed to have been received
correctly. The format of the SACK control field is shown in figure 5.2.1-1.
In addition to indicating the status of received I frames, the I or S frame
containing the SACK bitmap with the A bit set to 1 may be used by the
originator to request an acknowledgement from receiver.
# 6 Protocol procedures
## 6.1 Overview
This clause describes the RDS protocol procedures between the UE and network
for acknowledged data service.
## 6.2 Procedures
### 6.2.1 Types of RDS procedures
The following RDS protocol procedures are defined:
\- Establishment of acknowledged transfer;
\- Acknowledged information transfer;
\- Termination of acknowledged transfer;
\- Unacknowledged information transfer;
\- Reserve port numbers;
\- Release port numbers;
\- Query port numbers; and
\- Notify port numbers.
### 6.2.2 Establishment of acknowledged transfer procedure
#### 6.2.2.1 General
The purpose of the establishment of acknowledged transfer procedure is for the
originator to establish acknowledged transmission of information with the
receiver. All frames other than U and UI frames received during the
establishment of acknowledged transfer procedure shall be ignored.
#### 6.2.2.2 Establishment of acknowledged transfer procedure initiation
The originator shall initiate the establishment of acknowledged transfer
procedure when upper layers indicate information is to be transmitted using
acknowledged operation. The originator and the receiver identify the source
and destination port numbers before initiating establishment of acknowledged
transfer procedure.
The originator initiates the establishment of acknowledged transfer procedure
by transmitting a SET_ACK_MODE command to receiver. When a single application
on the originator conducts data transfer with a single application on the
receiver, the Source Port and Destination Port numbers need not be used;
otherwise the originator shall set the Source Port to the port number of the
source application on the originator and the Destination Port to the port
number of the destination application on the receiver. The originator shall
clear all exception conditions, discard all queued I frames, reset the
retransmission counter and timer T200 shall be set.
If a logical link between the UE and network identified without port numbers
exists and the originator needs to initiate establishment of an additional
acknowledged transfer procedure, the additional logical link between the UE
and network shall be identified with port numbers while the first logical link
can remain without port numbers.
Figure 6.2.2.2-1: Establishment of acknowledged transfer procedure
#### 6.2.2.3 Establishment of acknowledged transfer procedure accepted by
receiver
Upon receiving a SET_ACK_MODE command, the receiver checks if the Destination
Port number contained in the SET_ACK_MODE command corresponds to an
application on the receiver.
If the check is successful and if the application accepts to enter
acknowledged transfer mode, the receiver shall send an ACCEPT response to the
originator. When a single application on the originator conducts data transfer
with a single application on the receiver, the Source Port and Destination
Port numbers need not be used; otherwise the receiver shall set the Source
Port to the port number of the application on the receiver and the Destination
Port to the port number of the application on the originator. The receiver
shall reset timer T200 if active, clear all exception conditions and set V(S),
V(R) and V(A) to 0.
#### 6.2.2.4 Establishment of acknowledged transfer procedure completed by
originator
Upon receipt of the ACCEPT response and if the Destination Port number
corresponds to the application which initiated the establishment of
acknowledged transfer procedure, the originator enters acknowledged mode
transfer. The originator shall reset timer T200 if active, clear all exception
conditions and set V(S), V(R) and V(A) to 0 and the establishment of
acknowledged transfer procedure is successfully completed.
#### 6.2.2.5 Establishment of acknowledged transfer procedure not accepted by
receiver
Upon receiving a SET_ACK_MODE command if the Destination Port number contained
in the SET_ACK_MODE command,
\- is not supported by the receiver; or
\- corresponds to an application that is not able to perform acknowledged
transfer mode,
then the receiver shall send an ERROR response to the originator.
### 6.2.3 Acknowledged information transfer procedure
#### 6.2.3.1 General
The purpose of the acknowledged information transfer procedure is for the
originator to transfer I frames to receiver and receive acknowledgements for
these frames from receiver.
The originator shall store the history of the transmitted I frames, and shall
remember the Iâ€‘frame transmission sequence. The history is used to decide
which I frames to retransmit. Due to retransmission, the history is not
necessarily an in-order sequence.
A frame within the receive window is either:
\- received: the frame has been correctly received; or
\- not received: the frame has not been correctly received.
A frame within the transmit window is either:
\- not yet transmitted: the frame has not yet been transmitted;
\- transmitted: the frame has been (reâ€‘) transmitted, but the originator does
not know if the frame has been received by the receiver;
\- acknowledged: the frame has been acknowledged by the receiver; or
\- marked for retransmission: the originator has decided to retransmit this I
frame.
I frames shall be transmitted in ascending N(S) order. When I frames are
retransmitted, the frame with the lowest N(S) shall be retransmitted first.
This is used by the receiver to detect lost frames.
#### 6.2.3.2 Transmitting I frames and requesting acknowledgements
If the originator has received information to be transmitted from upper
layers, the information is inserted in an I frame. The control field
parameters N(S) and N(R) shall be assigned the values V(S) and V(R),
respectively. V(S) shall be incremented by 1 at the end of the transmission of
the I frame.
The originator shall request an acknowledgement from the receiver by
transmitting an I or S frame with the A bit set to 1. The originator may
request an acknowledgement at any time. An acknowledgement shall be requested
when:
\- the last I frame in a sequence of one or more I frames is transmitted; or
\- V(S) = V(A) + k as a result of the transmission of the I frame.
The originator shall transmit a frame in the following order of priority:
\- If there are any I frames marked for retransmission then the originator
shall increment by 1 the retransmission count variable for the I frame with
the lowest send sequence number N(S). If the retransmission count variable
exceeds the value of N200, then the originator shall initiate the
Establishment of acknowledged operation procedure as described in subclause
6.2.2. If the retransmission count variable does not exceed the value of N200,
then the originator shall retransmit the I frame.
\- If the originator has a new I frame to transmit, if V(S) \< V(A) + k (where
k is the maximum number of outstanding I frames) then the new I frame shall be
transmitted.
\- If the originator has an acknowledgement to transmit then the originator
shall transmit an S frame.
When requesting an acknowledgement, the originator shall set timer T201 and
associate the timer with the I frame currently being transmitted, or, if the A
bit is transmitted in an S frame, with the I frame last transmitted.
Figure 6.2.3.2-1: Acknowledged information transfer procedure
#### 6.2.3.3 Receiving I frames and sending acknowledgements
When the receiver receives a valid I frame whose N(S) is equal to the current
V(R), the receiver shall:
\- pass the contents of the Information field to the appropriate upper layer
entity;
\- increment its V(R) by 1; and
\- respond with a I or S frame containing the SACK bitmap, if the A bit of the
received I frame was set to 1.
When the receiver receives a valid I frame whose N(S) is not in the range V(R)
â‰¤ N(S) \< V(R) + k, the receiver shall discard the frame as a duplicate.
When the receiver receives a valid I frame where V(R) \< N(S) \< V(R) + k,
then the receiver shall store the I frame until all frames from V(R) to N(S) â€‘
1 inclusive are correctly received. Once all the frames are correctly received
the receiver shall then:
\- pass the contents of the Information field to the appropriate upper layer
entity; and
\- set its V(R) = N(S) + 1.
Whenever the receiver detects an error in the sequence of received I frames,
it shall transmit an I or S frame.
If the receiver receives an I frame with a higher N(S) than the N(S) of the
previously received I frame, and if there are I frames missing between these
two N(S) values, then the receiver shall assume that the missing I frames have
been lost. If the receiver receives an I frame with a lower N(S) than the N(S)
of the previously received I frame, it can assume that its peer originator has
(reâ€‘) started retransmission due to the reception of an acknowledgement.
#### 6.2.3.4 Receiving acknowledgements
On receipt of a valid I or S frame , the originator shall, if N(R) is valid,
treat the N(R) contained in this frame as an acknowledgement for all the I
frames it has transmitted with an N(S) up to and including the received N(R) â€‘
1. A valid N(R) value is one that is in the range V(A) â‰¤ N(R) â‰¤ V(S). If N(R)
is not valid, then the received SACK bitmap shall be disregarded.
V(A) shall then be set to N(R).
On receipt of a valid I or S frame containing the SACK bitmap, the originator
shall consider all I frames with the corresponding bit set to 1 in the SACK
bitmap as acknowledged.
If timer T201 is active and associated with an acknowledged I frame, then
timer T201 shall be reset.
The originator shall determine which I frames to retransmit by analysing it's
I frame transmission sequence history and the acknowledgements received. An
unacknowledged I frame that was transmitted prior to an acknowledged I frame
shall be considered lost and shall be marked for retransmission. Acknowledged
I frames shall be removed from the I frame transmission sequence history.
### 6.2.4 Termination of acknowledged transfer procedure
#### 6.2.4.1 General
The purpose of the termination of acknowledged transfer procedure is to
terminate the acknowledged transmission of information between the UE side and
the network side. All frames other than U and UI frames received during the
termination of acknowledged transfer procedure shall be ignored and all queued
I frames shall be discarded.
#### 6.2.4.2 Termination of acknowledged transfer procedure initiation
The originator or receiver shall initiate the termination of acknowledged
transfer procedure when upper layers indicate termination of acknowledged
operation.
The originator initiates the termination of acknowledged transfer procedure by
transmitting a DISCONNECT command. When a single application on the originator
conducts data transfer with a single application on the receiver, the Source
Port and Destination Port numbers need not be used; otherwise the originator
shall set the Source Port to the port number of the source application on the
originator and the Destination Port to the port number of the destination
application on the receiver. The originator shall reset the retransmission
counter and timer T200 shall be set.
Figure 6.2.4.2-1: Termination of acknowledged transfer procedure
#### 6.2.4.3 Termination of acknowledged transfer procedure accepted by
receiver
Upon receiving a DISCONNECT command, the receiver checks if the Destination
Port number contained in the DISCONNECT command corresponds to an application
on the receiver.
If the check is successful the receiver shall send an ACCEPT response to the
originator. When a single application on the originator conducts data transfer
with a single application on the receiver, the Source Port and Destination
Port numbers need not be used; otherwise the receiver shall set the Source
Port to the port number of the application on the receiver and the Destination
Port to the port number of the application on the originator.
#### 6.2.4.4 Termination of acknowledged transfer procedure completed by
originator
Upon receipt of the ACCEPT response and if the Destination Port number
corresponds to the application which initiated the termination of acknowledged
transfer procedure, the originator terminates acknowledged transfer mode. The
originator shall reset timer T200 if active, and the termination of
acknowledged transfer procedure is successfully completed.
#### 6.2.4.5 Termination of acknowledged transfer procedure not accepted by
receiver
Upon receiving a DISCONNECT command if the Destination Port number contained
in the DISCONNECT command
\- is not supported by the receiver; or
\- corresponds to an application that is not in acknowledged transfer mode,
then the receiver shall send an ERROR response to the originator.
### 6.2.5 Unacknowledged information transfer procedure
#### 6.2.5.1 General
The purpose of the unacknowledged information transfer procedure is for the
originator to perform unacknowledged transmission of information to the
receiver. No error recovery mechanisms are defined for unacknowledged
operation
#### 6.2.5.2 Unacknowledged information transfer procedure initiation
The originator shall initiate the unacknowledged information transfer
procedure when information from upper layers is to be transmitted using
unacknowledged operation. The originator and the receiver negotiate the use of
source and destination port numbers before initiating unacknowledged
information transfer.
The originator initiates the unacknowledged information transfer procedure by
transmitting a UI frame to receiver. When a single application on the
originator conducts data transfer with a single application on the receiver,
the Source Port and Destination Port numbers need not be used; otherwise the
originator shall set the Source Port to the port number of the source
application on the originator and the Destination Port to the port number of
the destination application on the receiver. The originator shall set the
unconfirmed sequence number N(U) in UI frame to the value of unconfirmed send
state variable V(U).
Figure 6.2.5.2-1: Unacknowledged information transfer procedure
#### 6.2.5.3 Unacknowledged information transfer procedure accepted by
receiver
Upon receiving a UI frame the receiver passes the contents of the Information
field to the appropriate upper layer corresponding to the Destination Port.
The receiver shall set the unconfirmed receive state variable V(UR) to N(U) +
1.
#### 6.2.5.4 Unacknowledged information transfer procedure completed by
originator
Upon transmission of the UI frame the unacknowledged information transfer
procedure is completed by the originator.
#### 6.2.5.5 Unacknowledged information transfer procedure not accepted by
receiver
Upon receiving a UI frame,
\- if the Destination Port number is not in use by the receiver; or
\- if N(U) of the received UI frame is in the range ( V(UR) -- k' ) â‰¤ N(U) \<
V(UR) and if a UI frame with the same N(U) has already been received,
then the UI frame is discarded by the receiver without any further action. The
value of k\' may be in the range 1 \< k\' \< MAX SEQUENCE NUMBER/2.
### 6.2.6 Reserve port numbers procedure
#### 6.2.6.1 General
The originator and the receiver use the reserve port number procedure if they
support the handling as specified in subclause 5.4.2.6. The purpose of the
reserve port numbers procedure is for the originator to reserve a combination
of source and destination port numbers for use with a specific application.
All frames other than U and UI frames received during the reserve port numbers
procedure shall be ignored. It is optional for the receiver to support the
reserve port number functionality.
#### 6.2.6.2 Reserve port numbers procedure initiation
The originator shall initiate the reserve port numbers procedure when upper
layers indicate information is to be transferred using a specific application.
The upper layers may identify the source and destination port numbers to be
reserved based on the available port numbers at originator and receiver before
initiating the reserve port numbers procedure.
The originator initiates the reserve port numbers procedure by transmitting a
MANAGE_PORT command to the receiver. The originator shall set the Source Port
to the port number to be reserved on the originator, the Destination Port to
the port number to be reserved on the receiver, the Action field to \"Reserve
port\" and the Application ID field to the identifier of the application to be
associated with the combination of the Source Port and Destination Port
numbers specified in the MANAGE_PORT command. The originator shall clear all
exception conditions, discard all queued I frames, reset the retransmission
counter and timer T200 shall be set.
#### 6.2.6.3 Reserve port numbers procedure accepted by receiver
If the receiver supports the reserve port number functionality then upon
receiving a MANAGE_PORT command with the Action field set to \"Reserve port\",
the receiver checks if the Destination Port number contained in the
MANAGE_PORT command is associated with any application on the receiver.
If the check is successful the receiver shall reserve the Destination Port for
use with the application identifier included in the MANAGE_PORT command. The
receiver shall send a MANAGE_PORT response to the originator by setting the
Action field in response frame to \"Reserve port\" and the Status field in
MANAGE_PORT response frame to \"Success\". The receiver shall reset timer T200
if active and clear all exceptions.
#### 6.2.6.4 Reserve port numbers procedure completed by originator
Upon receipt of the MANAGE_PORT response with the Action field set to
\"Reserve port\", and if the Status field is set to \"Success\", the
originator shall reserve the Source Port for use with the application
identifier included in the MANAGE_PORT command. The originator shall reset
timer T200 if active, clear all exception conditions and the reserve port
numbers procedure is successfully completed.
#### 6.2.6.5 Reserve port numbers procedure not accepted by receiver
If the receiver supports the reserve port number functionality then upon
receiving a MANAGE_PORT command with the Action field set to \"Reserve port\",
if the Destination Port number contained in the MANAGE_PORT command is already
reserved for use with another application on the receiver then the receiver
shall send a MANAGE_PORT response to the originator by setting the Action
field in response frame to \"Reserve port\" and the Status field in
MANAGE_PORT response frame to \"Port not free\".
### 6.2.7 Release port numbers procedure
#### 6.2.7.1 General
The originator and the receiver use the release port number procedure if they
support the handling as specified in subclause 5.4.2.6. The purpose of the
release port numbers procedure is for the originator to release a combination
of source and destination port numbers that have been reserved for use with a
specific application. All frames other than U and UI frames received during
the release port numbers procedure shall be ignored. It is optional for the
receiver to support the release port number functionality.
#### 6.2.7.2 Release port numbers procedure initiation
The originator shall initiate the release port numbers procedure when upper
layers indicate that information transfer using a specific application is over
and that it is permissible to release the combination of ports used by this
application.
The originator initiates the release port numbers procedure by transmitting a
MANAGE_PORT command to the receiver. The originator shall set the Source Port
to the port number to be released on the originator, the Destination Port to
the port number to be released on the receiver, the Action field to \"Release
port\" and the Application ID field to the identifier of the application that
is associated with the combination of the Source Port and Destination Port
numbers specified in the MANAGE_PORT command. The originator shall clear all
exception conditions, discard all queued I frames, reset the retransmission
counter and timer T200 shall be set.
#### 6.2.7.3 Release port numbers procedure accepted by receiver
If the receiver supports the release port number functionality then upon
receiving a MANAGE_PORT command with the Action field set to \"Release port\",
the receiver checks if the Destination Port number contained in the
MANAGE_PORT command is reserved on the receiver for use with the application
specified by the Application ID field in the MANAGE_PORT command.
If the check is successful the receiver shall release the Destination Port
from use with the application identifier included in the MANAGE_PORT command.
The receiver shall send a MANAGE_PORT response to the originator by setting
the Action field in response frame to \"Reserve port\" and the Status field in
MANAGE_PORT response frame to \"Success\". The receiver shall reset timer T200
if active and clear all exceptions.
#### 6.2.7.4 Release port numbers procedure completed by originator
Upon receipt of the MANAGE_PORT response with the Action field set to
\"Release port\", and if the Status field is set to \"Success\", the
originator shall release the Source Port from use with the application
identifier included in the MANAGE_PORT command. The originator shall reset
timer T200 if active, clear all exception conditions and the release port
numbers procedure is successfully completed.
#### 6.2.7.5 Release port numbers procedure not accepted by receiver
If the receiver supports the release port number functionality then upon
receiving a MANAGE_PORT command with the Action field set to \"Release port\",
if the Destination Port number contained in the MANAGE_PORT command is not
reserved on the receiver for use with specified application identifier in the
MANAGE_PORT command then the receiver shall send a MANAGE_PORT response to the
originator by setting the Action field in response frame to \"Release port\"
and the Status field in MANAGE_PORT response frame to \"Port not associated
with specified application\".
### 6.2.8 Query port numbers procedure
#### 6.2.8.1 General
The originator and the receiver use the query port number procedure if they
support the handling as specified in subclause 5.4.2.6. The purpose of the
query port numbers procedure is for the originator to query the list of port
numbers that are reserved for use with a specific application. All frames
other than U and UI frames received during the query port numbers procedure
shall be ignored. It is optional for the receiver to support the query port
number functionality.
#### 6.2.8.2 Query port numbers procedure initiation
The originator shall initiate the query port numbers procedure when upper
layers indicate the need to determine any port numbers on receiver that are
available for use with an application.
The originator initiates the query port numbers procedure by transmitting a
MANAGE_PORT command to the receiver by setting the Action field to \"Query
port\" and setting Requested port numbers to the destination port numbers that
it intends to query. If the originator intends to query all the port numbers,
then it shall not include the Requested port numbers. The originator shall
clear all exception conditions, discard all queued I frames, reset the
retransmission counter and timer T200 shall be set.
#### 6.2.8.3 Query port numbers procedure accepted by receiver
If the receiver supports the query port number functionality then upon
receiving a MANAGE_PORT command with the Action field set to \"Query port\",
the receiver shall send a MANAGE_PORT response to the originator by setting
the Action field in response frame to \"Query port\". For each Destination
Port that is reserved on the receiver for use by an application, the receiver
shall include an entry in the MANAGE_PORT response. The receiver shall set the
Num Entries field in the MANAGE_PORT response to the number of entries that
are included in the MANAGE_PORT response. For each Destination Port that is
reserved on the receiver, the receiver shall include the Source Port number
that the Destination Port is paired with and the Application ID of the
application to be used with the reserved Destination Port. If the receiver
does not have any reserved Source Port number for the associated Application
ID, the Source Port number shall be set to 0. If the entries for all the
source port numbers do not fit in the MANAGE_PORT response, the receiver shall
include as many entries on source port numbers as possible. For all the source
port numbers that are reserved on the receiver and for which information
cannot be included in the MANAGE_PORT response, the receiver shall set the
corresponding entry in the Port numbers not available bitmap. If the entries
for all the destination port numbers requested by the originator fit in the
MANAGE_PORT response, the receiver shall not include the optional Port numbers
not available bitmap. The receiver shall reset timer T200 if active and clear
all exceptions.
#### 6.2.8.4 Query port numbers procedure completed by originator
Upon receipt of the MANAGE_PORT response with the Action field set to \"Query
port\", the originator shall make a note of all Destination Ports that are
reserved for use with an application and may pass this information to upper
layers. If the Port numbers not available bitmap is not set to zero, the
originator can subsequently query information on these source port numbers by
sending another MANAGE_PORT command by setting the Action field to \"Query
port\" and setting Requested port numbers to Port numbers not available in the
received MANAGE_PORT response. The originator shall reset timer T200 if
active, clear all exception conditions and the query port numbers procedure is
successfully completed.
### 6.2.9 Notify port numbers procedure
#### 6.2.9.1 General
The originator and the receiver use the notify port number procedure if they
support the handling as specified in subclause 5.4.2.6. The purpose of the
notify port numbers procedure is for the originator to notify the receiver of
the list of port numbers that are reserved for use with a specific
application. All frames other than U and UI frames received during the notify
port numbers procedure shall be ignored. It is optional for the receiver to
support the notify port number functionality.
#### 6.2.9.2 Notify port numbers procedure initiation
The originator shall initiate the notify port numbers procedure when a Source
Port on the originator may be reserved for use with an application.
The originator initiates the notify port numbers procedure by transmitting a
MANAGE_PORT command to the receiver by setting the Action field to \"Notify
port\". For each Source Port that is reserved on the originator for use by an
application, the receiver shall include an entry in the MANAGE_PORT command.
The originator shall set the Num Entries field in the MANAGE_PORT command to
the number of entries that are included in the MANAGE_PORT response. For each
Source Port that is reserved on the originator, the originator shall include
the Destination Port number that the Source Port is paired with and the
Application ID of the application to be used with the reserved Source Port. If
the originator does not have any reserved Destination Port number for the
associated Application ID, the Destination Port number shall be set to 0\. If
the entries for all the source port numbers do not fit in the MANAGE_PORT
command, the originator shall include as many entries on source port numbers
as possible. For all the source port numbers that are reserved on the
originator and for which information cannot be included in the MANAGE_PORT
command, the originator shall set the corresponding entry in the Port numbers
not available bitmap. If the entries for all the source port numbers fit in
the MANAGE_PORT command, the originator shall not include the Port numbers not
available bitmap. The originator shall clear all exception conditions, discard
all queued I frames and reset the retransmission counter.
#### 6.2.9.3 Notify port numbers procedure accepted by receiver
If the receiver supports the notify port number functionality then upon
receipt of the MANAGE_PORT command with the Action field set to \"Notify
port\", the receiver shall make a note of all Source Ports that are reserved
for use with an application on the originator and may pass this information to
upper layers. The receiver shall clear all exception conditions and the notify
port numbers procedure is successfully completed.
If the Port numbers not available bitmap is included in the MANAGE_PORT
command, the receiver can subsequently query information on these source port
numbers by sending a MANAGE_PORT command by setting the Action field to
\"Query port\" and setting Requested port numbers to Port numbers not
available in the received MANAGE_PORT command as described in subclause 6.2.8.
## 6.3 Abnormal cases
### 6.3.1 Expiry of timer T200
Timer T200 is set when a U frame with any of the following commands is
transmitted.
\- SET_ACK_MODE;
\- DISCONNECT;
\- SET_PARAMETERS; and
\- MANAGE_PORT.
If timer T200 expires before a response to the sent command is received then
the originator shall retransmit the command, and shall reset and start timer
T200 and increment the retransmission counter. After retransmission of the
command N200 times, the originator shall abort the operation and notify the
upper layers.
### 6.3.2 Expiry of timer T201
On expiry of timer T201, the originator shall increment by 1 the
retransmission count variable for the I frame associated with timer T201. If
the value of the retransmission count variable does not exceed N200, the
originator shall reset and start timer T201, and retransmit the I frame with
the A bit set to 1. If the value of the retransmission count variable exceeds
N200, the originator shall send the ERROR command to the receiver and initiate
the establishment of acknowledged transfer procedure to re-establish the
acknowledged transfer mode with the receiver.
### 6.3.3 Collision during reserving the same port number between originator
and receiver
If the originator is trying to reserve a combination of source port number on
the originator and a destination port number on the receiver by sending a
MANAGE_PORT command to the receiver and if it receives another MANAGE_PORT
command from the receiver trying to reserve the same port number on the
originator then,
a) if both the originator and the receiver are trying to reserve the same
combination of port numbers with the same application identifier, then the
originator shall accept the MANAGE_PORT command from the receiver, reserve the
Destination Port for use with the application identifier included in the
MANAGE_PORT command and send a MANAGE_PORT response to the receiver by setting
the Action field in response frame to \"Reserve port\" and the Status field in
MANAGE_PORT response frame to \"Success\"; or
b) otherwise the originator shall not accept the MANAGE_PORT command from the
receiver and shall send a MANAGE_PORT response to the receiver by setting the
Action field in response frame to \"Reserve port\" and the Status field in
MANAGE_PORT response frame to \"Port not free\".
## 6.4 List of RDS Parameters
### 6.4.1 General
The following parameters are applicable for Reliable Data Service (RDS).
### 6.4.2 RDS version number (Version)
The RDS version number (Version) is an RDS layer parameter. The default
version number is 0.
### 6.4.3 Retransmission timers (T200 and T201)
The default value of timers T200 and T201 is 250 seconds.
### 6.4.4 Maximum number of retransmissions (N200)
The default value of N200 is 3.
### 6.4.5 Maximum number of outstanding I frames (k)
k is the maximum number of sequentially-numbered I frames that may be
outstanding (i.e. unacknowledged) at any given time. k is also denoted as
window size. The default value of k is 3. The value of MAX SEQUENCE NUMBER is
8.
### 6.4.6 Maximum length of Information Field (N201)
The default value of N201 is 1520 octets.
#
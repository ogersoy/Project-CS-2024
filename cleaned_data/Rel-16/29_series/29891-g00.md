# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document analyses the CT4 aspects of the 5G System (5GS) -- Phase
1, based on t**he service requirements defined in 3GPP TS 22.261 [5], the
stage 2 system architecture requirements defined in 3GPP TS 23.501 [2] and the
stage 2 procedures and flows defined in 3GPP** TS 23.502 [3].
**These CT4 aspects include the study and selection of the protocols and the
definition of the procedures and services that will be used in the 5GS,
including:**
\- the protocol and procedures for User Plane interfaces;
\- the protocols, procedures and services for Control Plane interfaces
(excluding PCC interfaces);
\- the User Plane management procedures over N4;
\- the interworking with E-UTRAN connected to EPC;
\- specific services in the 5GS (SMS, PWS, LCS, IMS, Emergency Services, MPS,
PEI checking);
\- numbering, addressing and identification in the 5GS;
\- subscriber data in 5GS;
\- Network slicing impacts;
\- Impacts due to Virtualization.
The present document also helps assessing the appropriate CT4 specifications
structure for documenting the CT4 impacts for the 5GS. It is used as a place
holder for CT4 5GS materials to be moved to appropriate 3GPP technical
specifications when the TR is sufficiently stable.
SA2 or SA3 status is added as a note when unstable topics in SA2 or SA3 are
described in this document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 23.008: \"Organization of subscriber data\".
[5] 3GPP TS 22.261: \"Service requirements for the 5G system; Stage 1\".
[6] 3GPP TS 23.214: \"Architecture enhancements for control and user plane
separation of EPC nodes; Stage 2\".
[7] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
of EPC Nodes; Stage 3\".
[8] 3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)
Point to Point (PP)\".
[9] 3GPP TS 23.003: \"Numbering, addressing and identification\"
[10] IETF RFC 6763: \"DNS-Based Service Discovery\".
[11] IETF RFC 7542: \"Network Access Identifier\".
[12] 3GPP TS 29.335: \"User Data Convergence (UDC); User data repository
access protocol over the Ud interface; Stage 3\".
[13] IETF RFC 793: \"Transmission Control Protocol\".
[14] IETF RFC 5246, \"The Transport Layer Security (TLS) Protocol Version
1.2\".
[15] IETF RFC 7540: \"Hypertext Transfer Protocol Version 2 (HTTP/2)\".
[16] IETF RFC 7159: \"The JavaScript Object Notation (JSON) Data Interchange
Format\".
[17] IETF RFC 768: \"User Datagram Protocol\".
[18] IETF draft-ietf-quic-transport-05: \" QUIC: A UDP-Based Multiplexed and
Secure Transport\".
[19] IETF draft-ietf-quic-tls-05: \"Using Transport Layer Security (TLS) to
Secure QUIC\".
[20] IETF draft-ietf-quic-http-05: \"Hypertext Transfer Protocol (HTTP) over
QUIC\".
[21] IETF draft-ietf-quic-recovery-05: \"QUIC Loss Detection and Congestion
Control\".
[22] IETF draft-newton-json-content-rules-08: \"A Language for Rules
Describing JSON Content\".
[23] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[24] 3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP network
layer security\".
[25] IETF RFC 6733: \"Diameter Base Protocol\".
[26] IETF RFC 7230: \"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax
and Routing\".
[27] 3GPP TS 29.060: \"General Packet Radio Service (GPRS); GPRS Tunnelling
Protocol (GTP) across the Gn and Gp interface\".
[28] 3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General
Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C);
Stage 3\".
[29] 3GPP TS 38.300: \"NR; Overall description; Stage 2.\"
[30] 3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling Protocol
User Plane (GTPv1-U)\".
[31] 3GPP TR 38.801: \"Study on new radio access technology: Radio access
architecture and interfaces\".
[32] IETF RFC 7231: \"Hypertext Transfer Protocol (HTTP/1.1): Semantics and
Content\".
[33] IETF RFC 7232: \"Hypertext Transfer Protocol (HTTP/1.1): Conditional
Requests\".
[34] IETF RFC 7233: \"Hypertext Transfer Protocol (HTTP/1.1): Range
Requests\".
[35] IETF RFC 7234: \"Hypertext Transfer Protocol (HTTP/1.1): Caching\".
[36] IETF RFC 7235: \"Hypertext Transfer Protocol (HTTP/1.1):
Authentication\".
[37] IETF RFC 7541: \"HPACK: Header Compression for HTTP/2\".
[38] Draft ETSI GS MEC 009 V1.0.1 (2017): \"Mobile Edge Computing (MEC);
General principles for Mobile Edge Service APIs\".
[39] 3GPP TS 29.116: \"Representational state transfer over xMB reference
point between Content Provider and BM-SC\".
[40] 3GPP TS 29.251: \"Gw and Gwn reference points for sponsored data
connectivity\".
[41] 3GPP TS 29.155: \"Traffic steering control; Representational state
transfer (REST) over St reference point\".
[42] IETF RFC 6202: \"Known Issues and Best Practices for the Use of Long
Polling and Streaming in Bidirectional HTTP\".
[43] IETF RFC 6455: \"The Websocket Protocol\".
[44] IETF RFC 6020: \"YANG - A Data Modeling Language for the Network
Configuration Protocol (NETCONF)\".
[45] IETF RFC 6991: \"Common YANG Data Types\".
[46] IETF RFC 7950; \"The YANG 1.1 Data Modeling Language\".
[47] IETF RFC 7951: \"JSON Encoding of Data Modeled with YANG\".
[48] IETF RFC 8040: \"RESTCONF Protocol\".
[49] OpenAPI Initiative, \"OpenAPI 3.0.0 Specification\",
https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.0.md.
[50] 3GPP TS 29.250: \"**Nu reference point between SCEF and PFDF for
sponsored data connectivity\".**
[51] IETF draft-wright-json-schema-01: \"JSON Schema: A Media Type for
Describing JSON Documents\".
[52] IETF draft-wright-json-schema-validation-01: \"JSON Schema Validation: A
Vocabulary for Structural Validation of JSON\".
[53] IETF draft-ietf-cbor-cddl-00: \"Concise data definition language (CDDL):
a notational convention to express CBOR data structures\".
[54] IETF draft-ietf-core-yang-cbor-04: \"CBOR Encoding of Data Modeled with
YANG\".
[55] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[56] 3GPP TS 29.328: \"IP Multimedia (IM) Subsystem Sh interface; Signalling
flows and message contents\".
[57] Dissertation of Roy T. Fielding at the University of California at
Irvine, USA (2000): \"Architectural Styles and the Design of Network-based
Software Architectures\", Chapter 5 \"Representational State Transfer
(REST)\",
https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm.
[58] Presentation of Leonard Richardson at the QCon Conference. San Francisco
(2008): \"Justice Will Take Us Millions Of Intricate Moves\", Act Three: \"The
Maturity Heuristic\",
https://www.crummy.com/writing/speaking/2008-QCon/act3.html.
[59] Wikipedia article: \"Remote procedure call\",
https://en.wikipedia.org/wiki/Remote_procedure_call.
[60] API Design Guide, Google, https://cloud.google.com/apis/design/
[61] ETSI GS MEC 011: \"Mobile Edge Computing (MEC); Mobile Edge Platform
Application Enablement\".
[62] 3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\".
[63] 3GPP TS 33.501: \"Security Architecture and Procedures for 5G System\".
[64] 3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx interface;
signalling flows and message contents\".
[65] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[66] IETF RFC 7049: \"Concise Binary Object Representation (CBOR)\".
> [67] 3GPP TS 29.122: \"T8 reference point for Northbound APIs\".
[68] IETF RFC 7807: \"Problem Details for HTTP APIs\".
[69] IETF RFC 2045: \"Multipurpose Internet Mail Extensions (MIME) Part One:
Format of Internet Message Bodies\".
[70] IETF RFC 2046: \"Multipurpose Internet Mail Extensions (MIME) Part Two:
Media Types\".
[71] IETF RFC 2387: \"The MIME Multipart/Related Content-type\".
[72] IETF RFC 6838: \"Media Type Specifications and Registration Procedures\".
[73] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[74] 3GPP TS 38.413: \"NG Radio Access Network (NG-RAN); NG Application
Protocol (NGAP)\".
[75] IETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".
[76] IETF RFC 2183: \"Communication Presentation Information in Internet
Messages: The Content-Disposition Header Field\".
[77] IETF RFC 7578: \"Returning Values from Forms: multipart/form data\".
[78] IETF RFC 5789: \"PATCH method for HTTP\".
[79] 3GPP TS 23.335: \"User Data Convergence (UDC); Technical realization and
information flows; Stage 2\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1], 3GPP TS 23.501 [2] and the following apply. A term defined
in the present document takes precedence over the definition of the same term,
if any, in 3GPP TR 21.905 [1] or 3GPP TS 23.501 [2].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1], 3GPP TS 23.501 [2] and the following apply.\ An abbreviation
defined in the present document takes precedence over the definition of the
same abbreviation, if any, in 3GPP TR 21.905 [1] or 3GPP TS 23.501 [2].
CRUD Create, Read, Update and Delete
HOL Head-of-line
HTTP Hypertext Transfer Protocol
JSON JavaScript Object Notation
REST Representational State Transfer
RPC Remote procedure call
SCTP Stream Control Transmission Protocol
TCP Transmission Control Protocol
UDP User Datagram Protocol
# 4 Architecture and Requirements
## 4.1 Reference Architecture
The 5GS architecture reference model is specified in subclause 4.2 of 3GPP TS
23.501 [2].
The interaction between network functions is represented in two ways:
\- a service-based representation, where network functions (e.g. AMF) within
the control plane enables other authorized network functions to access their
services.
\- a reference point representation, focusing on the interactions between
pairs of network functions described by point-to-point reference point between
any two network functions.
For illustrative purposes, the 5GS roaming architecture is copied further
down, for the local breakout and home routed scenarios, with the service-based
and reference point representations. See subclause 4.2 of 3GPP TS 23.501 [2]
for a comprehensive description of the 5GS reference architecture.
Figure 4.1-1 depicts the 5GS roaming architecture with local breakout with
service-based interfaces within the Control Plane.
Figure 4.1-1 Roaming 5GS architecture- local breakout scenario with AF in
VPLMN in service-based interface representation
Figure 4.1-2 depicts the 5GS roaming architecture in case of home routed
scenario when service-based interfaces within the Control Plane.
Figure 4.1-2 Roaming 5GS architecture - home routed scenario in service-based
interface representation
Figure 4.1-3 depicts 5GS roaming architecture in case of local break out
scenario with AF in VPLMN using the reference point representation.
Figure 4.1-3: Roaming 5GS architecture - local breakout scenario with AF in
VPLMN in reference point representation
Following figure 4.1-4 depicts the 5GS roaming architecture in case of home
routed scenario using the reference point representation.
Figure 4.1-4: Roaming 5GS architecture-Home routed scenario in reference point
representation
The lists of service-based interfaces and reference points defined for the 5GS
are specified in subclauses 4.2.6 and 4.2.7 of 3GPP TS 23.501 [2].
## 4.2 General Requirements
The following CT4 requirements apply:
\- Although the 5GS architecture is depicted in 3GPP TS 23.501 [2] with two
different representations (see subclause 4.1), there shall be only one
protocol solution for supporting a given interaction between two NFs in stage
3.
# 5 Protocol and procedures for User Plane interfaces
## 5.1 Requirements
### 5.1.1 General requirements
The following user plane interfaces are supported within the 5GS:
\- N3 interface between the (R)AN and the UPF;
\- N9 interface between two UPFs (intra or inter-PLMN interface);
NOTE 1: There is also an Xn interface within the RAN to interconnect two
5G-RAN nodes.
The following CT4 requirements apply:
\- the same user plane protocol stack shall be defined over N3 and N9 to avoid
the need for user plane interworking at the UPF;
\- the same user plane protocol stack shall be defined over N3 for both 3GPP
and non-3GPP accesses, i.e. for the interface between the UPF and the 5G-RAN
and the interface between the UPF and N3IWF.
Stage 2 requires the following information to be sent in an encapsulation
header over the N3 and N9 interfaces:
\- QFI (QoS Flow Identifier), see subclause 5.7.1 of 3GPP TS 23.501 [2]:
\"A QoS Flow ID (QFI) is used to identify a QoS flow in the 5G system. User
Plane traffic with the same QFI within a PDU session receives the same traffic
forwarding treatment **_(e.g._** scheduling, admission threshold). The QFI is
carried in an encapsulation header on N3 (and N9) i.e. without any changes to
the e2e packet header. It can be applied to PDUs with different types of
payload, i.e. IP packets, non-IP PDUs and Ethernet frames. The QFI shall be
unique within a PDU session.\"
The QFI is sent for both downlink and uplink user plane traffic.
\- RQI (Reflective QoS Identifier), see subclause 5.7.5.4.2 of 3GPP TS 23.501
[2]:
\"When the 5GC determines to activate reflective QoS via U-plane, the SMF
shall include a QoS rule including an indication to the UPF via N4 interface
to activate User Plane with user plane reflective. When the UPF receives a DL
packet matching the QoS rule that contains an indication to activate
reflective QoS, the UPF shall include the RQI in the encapsulation header on
N3 reference point. The UE creates a UE derived QoS rule when the UE receives
a DL packet with a RQI.\"
The RQI is sent for downlink user plane traffic only.
NOTE 2: Other information elements are likely to be added in the future. For
example, SA2 is discussing means to deactivate reflective QoS and one of the
solutions can be based on user plane.
Support of RAN initiated QoS Flow mobility, when using Dual connectivity, also
requires the QFI to be sent within End Marker packets. See subclause 5.11.1 of
3GPP TS 23.501 [2] and subclause 4.14.1 of 3GPP TS 23.502 [3] respectively:
\" For some other PDU sessions of an UE: Direct the DL User Plane traffic of
some QoS flows of the PDU session to the Secondary (respectively Master) RAN
Node while the remaining QoS flows of the PDU session are directed to the
Master (respectively Secondary) RAN Node. In this case there are, irrespective
of the number of QoS Flows, two N3 tunnel terminations at the RAN for such PDU
session.\"
\"6. In order to assist the reordering function in the Master RAN node and/or
Secondary RAN node, for the QFIs that are switched between Master RAN node and
Secondary RAN node, the UPF sends one or more \"end marker\" packets along
with QFI on the old tunnel immediately after switching the tunnel for the QFI.
The UPF starts sending downlink packets to the Target RAN.\"
### 5.1.2 User Plane Protocol Stack
The protocol stack for the User Plane transport for a PDU session is specified
in subclause 8.3.1 of 3GPP TS 23.501 [2] and copied hereafter.
**Legend:**
\- **PDU layer:** This layer corresponds to the PDU carried between the UE and
the DN over the PDU session. When the PDU session Type is IPV6, it corresponds
to IPv6 packets; When the PDU session Type is Ethernet, it corresponds to
Ethernet frames; etc.
**\- GPRS Tunnelling Protocol for the user plane (GTP‑U):** This protocol
supports multiplexing traffic of different PDU sessions (possibly
corresponding to different PDU session Types) by tunnelling user data over N3
(i.e. between the AN node and the UPF) in the backbone network. GTP shall
encapsulate all end user PDUs. It provides encapsulation on a per PDU session
level. This layer carries also the marking associated with a QoS Flow.
\- **5G Encapsulation:** This layer supports multiplexing traffic of different
PDU sessions (possibly corresponding to different PDU session Types) over N9
(i.e. between different UPF of the 5GC). It provides encapsulation on a per
PDU session level. This layer carries also the marking associated with a QoS
Flow.
Figure 5.1.2-1: User Plane Protocol Stack
3GPP RAN has decided to use GTP-U as the 5G UP Encapsulation over N3, see 3GPP
TS 38.300 [29].
> \"The NG user plane (NG-U) interface is defined between the gNB/eNB and the
> UPF. The NG-U interface provides non-guaranteed delivery of user plane PDUs
> between the gNB/eNB and the UPF. The protocol stack for NG-U is shown in
> Figure 5.1.2-2. The transport network layer is built on IP transport and
> GTP-U is used on top of UDP/IP to carry the user plane PDUs between the
> gNB/eNB and the UPF.\"
Figure 5.1.2-2: User Plane Protocol Stack
## 5.2 Solution and Protocol Selection
### 5.2.1 Solution 1 -- N3 and N9 based on GTPv1-U
#### 5.2.1.1 Solution Description
GTPv1-U as defined in 3GPP TS 29.281 [30] is used over the N3 and N9
interfaces.
A GTP-U tunnel is used per PDU session to encapsulate T-PDUs and GTP-U
signalling messages (e.g. End Marker, Echo Request, Error Indication) between
GTP-U peers.
The following approaches can be envisaged for conveying the information to be
encapsulated over the N3 and N9 interfaces (i.e. the QFI and RQI):
\- the elements are directly added to GTP-U as new individual GTP-U Extension
Headers (option 1); or
\- a 5GS Container is defined as a new single GTP-U Extension Header over the
N3 and N9 interfaces and the elements are added to this container as they
appear with the forthcoming features and releases. (option 2)
The contents of the 5GS Container would be specified by RAN3.
A single approach shall be selected, in coordination with 3GPP RAN WG3.
#### 5.2.1.2 Evaluation
The first approach would not allow to separate the Transport Network Layer
(TNL) and Radio Network Layer (RNL) as required in 3GPP TR 38.801 [31]
subclause 7.3.2 (\"_the NG interface shall separate Radio Network Layer and
Transport Network Layer\")._
The second approach would allow to design the 5GS information elements
independently from the tunnelling protocol used within the 5GS, i.e. it would
achieve the separation of the Transport Network Layer (TNL) and Radio Network
Layer (RNL) as required in 3GPP TR 38.801 [31] subclause 7.3.2. This would
allow to not impact the RNL if in a future release a new transport network
layer (TNL) other than GTP-U/UDP/IP (e.g. GRE/IP) was decided to be supported.
## 5.3 Conclusions
See subclause 11.2.
# 6 Protocols, procedures and services for Control Plane interfaces
## 6.1 General
This clause describes the protocols and the overall architecture for the
Control Plane interfaces within the 5G Core Network, excluding PCC related
interfaces (out of scope of CT4), and excluding the N4 interface which is
studied separately in clause 7.
This covers the following interfaces specified in 3GPP TS 23.501 [2]:
\- in service-based representation: Namf, Nsmf, Nudm, Nnrf, Nnssf, Nausf,
Nnef, Nsmsf, Nudr, N5g-eir, Nudsf.
\- in reference point representation: N8, N10, N11, N12, N13, N14, N16, N17,
N18, N20, N21, N22.
## 6.2 Service Based Architecture
### 6.2.1 Common Requirements
#### 6.2.1.1 Definition of Service and Service Based Architecture
A NF service is a discrete unit of functionality that is exposed by a NF
through a service based interface and that can be consumed by other authorized
NFs. A NF service is composed of one or more NF service operation(s).
Network Functions may offer different functionalities and thus different NF
services. Each of the NF services offered by a Network Function shall be self-
contained, acted upon and managed independently from other NF services offered
by the same Network Function (e.g. for scaling, healing).
A system architecture in which the system functionality is achieved by
utilizing a set of services is termed as a service based architecture.
A service based interface represents how the set of services is
provided/exposed by a given NF. This is the interface where the NF service
operations are invoked.
The following relationship exists between Network Functions, NF Services and
NF services\' operations:
\- a Network Function (e.g. SMF, AMF) implements one or more NF Services;
\- a Network Function exposes a NF Service via its related NF service
operations.
Figure 6.2.1.1-1: Network Function, NF Service and NF Service Operation
NF services are registered with a well- known network registry function (NRF)
to allow their discovery by other NFs.
#### 6.2.1.2 Properties of a NF Service
Any NF service which is defined should have the following properties:
\- it has to logically represent an activity with a specified outcome;
\- it has to be self-contained and independent from other services supported
by the same or other NF, e.g. it operates on its own set of context(s);
NOTE 1: This goes towards the requirement for having a loosely coupled system.
\- it has to appear as a black box for its consumers;
\- it allows independent software upgrade of the services without affecting
other services offered by the same or different NF(s);
\- it may invoke other services;
\- it has to be discoverable: consumers of the service need to be able to
discover NF instances supporting the service; the discovery can be done via
NRF;
\- it has to expose a standardized service contract, via the set of operations
it supports;
\- only authorized NF consumers shall be able to access the service.
Service operations that operate on common states or a common context data
shall be defined within a single service, as exemplified in Figure 6.2.1.2-1.
Figure 6.2.1.2-1: Proper Service granularity
NOTE 2: This allows the NF service to be deployed, versioned and upgraded
independently from other NF services.
Defining service operations that are tied to common states as separate
services requiring independent life cycle management would lead to
incompatible interfaces and result in non-functional networks, as exemplified
in Figure 6.2.1.2-2. Such an approach would cause technical and operational
difficulties with OAM, life cycle management, e2e system integration, software
upgrades, etc, for deploying carrier grade network, e.g.:
\- dependency and conflicts between multiple services relying on the same
states;
\- incompatible interfaces, e.g. if the create session service is upgraded
independently from the modify session service, with new or modified
parameters;
\- the requester NF would need to select a specific combination of compatible
NF services (versions) to create, read, modify or delete the same context
data, on the same NF, to avoid incompatibilities;
\- the number of services to be registered (with all the associated
information) in the NRF and to be discovered (and cached) by the requester NF
instances would increase dramatically.
Figure 6.2.1.2-2: Improper Service granularity
#### 6.2.1.3 NF Service Framework
The Service Based Architecture shall support the following framework
mechanisms that enable the use of NF services (see subclause 7.1 of 3GPP TS
23.501 [2]):
\- NF service discovery: to enable a NF to discover NF instance(s) which
provide the expected NF service(s);
\- NF service authorization: to ensure the service requester NF is authorized
to access the NF service provided by the service provider;
\- NF service (de-)registration: to make the NRF aware of the available NF
instances and supported services.
Corresponding requirements and solutions are further studied in subclause 6.8.
#### 6.2.1.4 Requirements for solution selection
This subclause identifies requirements expected to be met by candidate
solutions. These requirements do not aim at ruling out a particular solution,
but are intended to appraise the candidate solutions on whether and how easily
they can fulfill the requirements.
R1. Support of bidirectional communication and how easily this requirement can
be fulfilled; rational: stage 2 requirements that service based interfaces
support Request-Response and Subscription-Notification, where subscription can
be optional.
R2. Support of reliable communication and whether this is built in protocol or
on top of it: in some level of the protocol stack, a reliable message delivery
needs to be guaranteed. It appears preferable not to burden the application
with that to exploit communalities. Is link-level failover supported?
R3. Forward compatibility and ease of upgrade: protocol needs to be
extensible, also outside standards, and a concept for operation between nodes
with different capability levels is required.
R4. Low Response Time. The solution shall also support varying response times,
e.g. in roaming and interconnection, latency between 100ms and 5s are usually
considered for signalling end-to-end transport.
R5. Scalability to large numbers of transactions per service, support long-
lived connection and the number of required transport connections should be
manageable and not cause hindrance to system performance.
R6. Ease and speed of deployment and instantiation/deinstantiation of network
functions and services with minimal impacts on the network.
R7. Open and public Source/Standardization body: 3GPP needs to be able to
access SDO sources; this also includes support of the protocol maintenance and
ease for 3GPP to extend the protocol.
#### 6.2.1.5 Additional evaluation criteria for solution selection
This subclause identifies additional criteria which will be used to appraise
candidate solutions.
A1. Resource-efficiency: message size and processing requirements.
A2. Reusability of existing 3GPP implementations: can existing implementations
and deployments be partially reused? How large are the impacts for inter-
operator and/or inter-domain interfaces? This includes interworking with
legacy networks.
A3. Minimize number of protocols in network: the overall number of protocols
to be supported in a network and at any a given type of network function
should be minimized. Selected protocol should be able to support intra- and
inter-operator interfaces.
A4. Congestion, load and overload control.
A5. Support of Security: in particular per service authentication,
authorization and possibly encryption, in particular for inter-operator
communication.
A6. Ease of troubleshooting and Monitoring: Message Traceability and
Monitoring. For monitoring and reporting for roaming/interconnection, it is
very helpful that an answer follows the same path (i.e. same proxies) as its
request.
A7. Ease of use of 3GPP services from operator owned application functions:
such application function can be used to implement operator-specific services.
A8. Support of service and/or message based failover and failback.
A9. Support of network entity selection based on UE context information, e.g.
based on dynamic UE session information.
A10. Ease of traversal of carrier-grade ALG/NAT/firewall within a PLMN and
towards another PLMN.
A11. Impacts to GSMA GRX/IPX
A12. Time of Availability of used standards.
A13. Protocol enables stateless operation.
A14. Routing support and related mechanisms. The solution shall support the
use of proxies in the path, e.g. in inter-operator networks (IPX) and/or in
operator networks.
A15. Support of strong error detection and error reporting capabilities.
A16. Support of multiplexing of messages belonging to multiple sessions over a
single transport connection.
A17. Support of well-defined s**chema and** unambiguous interpretation of
transported data**.**
A18. Support of a message priority mechanism.
NOTE: The requirements and additional evaluation criteria listed in subclauses
6.2.1.4 and 6.2.1.5 take into account the considerations about virtualization
documented in subclause 10.4.
### 6.2.2 Solution and Protocol Selection (Common Aspects)
#### 6.2.2.1 Solution 1 -- Diameter
##### 6.2.2.1.1 Solution Description
Diameter is an authentication, authorization, and accounting protocol for
computer networks. It evolved from and replaces the much less capable RADIUS
protocol that preceded it.
The Diameter base protocol is defined by IETF RFC 6733 [25], Diameter
applications can extend the base protocol by adding new commands, attributes,
or both.
The communication between two diameter peers starts with the establishment of
a transport connection (TCP or SCTP). Diameter security is provided by IPsec
or TLS/DTLS.
The protocol stack of Diameter is described in Figure 6.2.2.1.1-1.
{width="3.5631944444444446in" height="1.2354166666666666in"}
Figure 6.2.2.1.1-1: Diameter stack
The message format of Diameter is described in Figure 6.2.2.1.1-2.
{width="4.522222222222222in" height="2.7006944444444443in"}
Figure 6.2.2.1.1-2: Diameter message format
The characteristics of Diameter protocol set are as follows:
\- A pure binary formatted protocol, mainly used in mobile network,
\- Session based connection setup and maintenance. Transaction based
communication between servers, andprovides stateless and stateful interaction,
\- A peer-to-peer communication model, while supports relay, proxy and
redirect agents, and provides mechanisms for policy decision, message routing
and session state maintenance,
\- Flexible routing method: both Diameter header and application AVPs can be
applied as filters and routing rules,
\- Enhanced extendibility: operators and vendors can define their own commands
and AVPs,
\- Reliable transport is provided by the underlying transport protocol, e.g.
SCTP (see IETF RFC 4960 [23]),
\- TLS/DTLS/IPSec can be applied to provide a transport level security.
##### 6.2.2.1.2 Evaluation
The evaluation is done in subclause 6.2.2.4.
#### 6.2.2.2 Solution 2 -- HTTP
##### 6.2.2.2.1 Solution Description
###### 6.2.2.2.1.1 General
The Hypertext Transfer Protocol (HTTP) is an IETF defined protocol, which
provides stateless application-level protocol for distributed, collaborative,
hypertext information systems.
###### 6.2.2.2.1.2 HTTP/1.1
HTTP/1.1 is specified in IETF RFC 7230 [26], IETF RFC 7231 [32], IETF RFC 7232
[33], IETF RFC 7233 [34], IETF RFC 7234 [35] and IET FRF C7235 [36].
The HTTP/1.1 architecture and routing mechanism are defined in IETF RFC 7230
[26].
Few main characteristics of HTTP/1.1 are listed below:
\- Text formatted protocol: text-based framing and text-based HTTP Header;
\- Text-based or binary-encoded HTTP Body (see subclauses 6.2.2.5 for further
description and assessment of candidate protocols for Serialization);
\- supports HTTP Pipelining: an HTTP client can send multiple HTTP requests to
an HTTP server within one HTTP/1.1 connection without having to wait for the
HTTP responses of the earlier requests; however the HTTP server shall send the
responses in the same order as the corresponding requests, which can result in
delayed responses if an earlier request cannot be responded yet (known as HOL
blocking at HTTP level);
\- practically requires to open multiple TCP connections towards the same
server to mitigate the problem of HOL blocking when it is required to send
multiple requests to that server;
\- support of forwarding and routing mechanism, such as redirector, proxy;
\- TLS can be applied to provide a transport level security;
\- Extendibility: both HTTP Header and Body can be extended as discussed in
subclause 6.2.2.2.1.6; and
\- Supporting of Request/Response, Subscription/Notification communication
pattern (see subclause 6.2.2.2.1.5).
###### 6.2.2.2.1.3 HTTP/2
HTTP/2 is specified in IETF RFC 7540 [15] and IETF RFC 7541 [37].
HTTP/2 does not obsolete the HTTP/1.1 message syntax. HTTP/1.1 semantics
remain unchanged.
Few main characteristics of HTTP/2 are listed below:
\- Binary formatted protocol: binary framing, binary encoded HTTP Header;
HTTP/2 sends binary frames, all with the same layout. Binary framing eases
implementations figuring out the start and end of frames.
Figure 6.2.2.2.1.3-1 HTTP/2 Frame Layout
\- Text-based or binary encoded HTTP Body (like supported by HTTP/1.1, see
subclauses 6.2.2.5 for further description and assessment of candidate
protocols for Serialization);
\- Header compression, which enables to encode headers in 1 or 2 octets only
(relying on static and/or dynamic tables for header compression);
\- Multiplexed streams: a stream is an independent, bi-directional sequence of
frames exchanged between the client and server within an HTTP/2 connection. A
single HTTP/2 connection can contain multiple concurrently open streams, with
either endpoint interleaving frames from multiple streams. This solves the
problem of HOL of HTTP/1.1;
\- one TCP connection possible per client-server pair (a new TCP connection
needs to be set up when exhausting the available streams ids);- Server side
initiated push, which allows the server to proactively push information to the
client that can be used upon subsequent matching requests from the client;
\- Stream based transfer with priority and dependency control: each stream has
a priority which tells the peer which streams to consider most important in
case of resource restraints at the server (e.g. overload); the client can also
tell the server which other stream a particular stream depends on, to enable
the server to prioritize the completion of the parent stream;
\- Flow control at connection and stream\'s levels: the HTTP connection and
each of its streams have their own advertised flow window that the other end
is allowed to send data for.
###### 6.2.2.2.1.4 Transport protocol
Many transport layer protocols can be applied to HTTP, such as:
\- TCP/TLS/HTTP: HTTP is in most cases transported using TCP/TLS (see IETF RFC
793 [13]), which provides a reliable/security transport;
\- UDP/QUIC/HTTP: QUIC (see IETF draft-ietf-quic-transport [18], IETF draft-
ietf-quic-tls [19], IETF draft-ietf-quic-http [20], and IETF draft-ietf-quic-
recovery [21]) is a multiplexed and secure transport protocol that runs on top
of UDP, while without incurring a dependency on upgrades to middle-boxes.
See subclause 6.2.2.6 for further description and assessment of candidate
transport protocols.
###### 6.2.2.2.1.5 Support of Server-initiated communication from a server to
a client
###### # 6.2.2.2.1.5.1 General
Subclause 7.1.2 of 3GPP TS 23.501 [2] requires support of Subscribe-Notify
service operations, where
\- a Control Plane NF_A (NF Service Consumer) subscribes to NF Service offered
by another Control Plane NF_B (NF Service Producer).
\- NF_B notifies the results of this NF service to the interested NF(s) that
subscribed to this NF service. The subscription request from consumer may
include notification request for periodic updates or notification triggered
through certain events (e.g., the information requested gets changed, reaches
certain threshold etc.). This mechanism also covers the case where NFs (NF_B)
are subscribed to certain notifications implicitly without explicit
subscription request (e.g. due to successful registration procedure).
Figure 6.2.2.2.1.5.1-1: \"Subscribe-Notify\" NF Service illustration
A Control Plane NF_A may also subscribe to NF Service offered by Control Plane
NF_B on behalf of Control Plane NF_C, i.e. it requests the NF Service Producer
to send the event notification to another consumer(s).
Figure 6.2.2.2.1.5.1-2: \"Subscribe-Notify\" NF Service on behalf of another
NF Service Consumer
Subscribe/Notify service operations require bidirectional communication
between the NFs and the support of server-initiated communication from a
server to a client, which may occur a long time (e.g. several days) after the
client\'s subscription to the server, when the server needs to communicate
information to the client.
With HTTP, a server cannot initiate a connection with a client nor send an
unrequested HTTP response to a client; thus the server cannot push
asynchronous events to the client. Possible solutions are investigated below.
###### # 6.2.2.2.1.5.2 Solution with two client-server pairs
Subscribe/Notify service operations can be supported with HTTP with two
client-server pairs, one per direction, as follows:
\- NF A acts as an HTTP client and NF B as an HTTP server when NF A subscribes
to NF B\'s notifications;
\- NF B acts as an HTTP client and NF A as an HTTP server when NF B delivers
notifications to NF A;
\- with RESTful APIs, e.g. like specified in subclause 7.12 of ETSI GS MEC 009
[38]:
\- to manage subscriptions, the server exposes a resource under which the
client can request the creation/deletion of subscription resources. Those
resources define criteria of subscription.
\- to receive notifications, the client exposes one or more HTTP endpoints on
which the client (or another NF Service Consumer) can receive POST requests.
When creating a subscription, the client shall inform the server of the
endpoint to which the server will later deliver notifications related to that
particular subscription.
\- to deliver notifications, the server includes the actual notification
payload in the payload body of a POST request, and sends that request to the
endpoint it knows from the subscription.
{width="5.069444444444445in" height="3.2256944444444446in"}
Figure 6.2.2.2.1.5.2-2: Creation of subscriptions and delivery of a
notification
NOTE: A similar approach is also supported in few HTTP-based 3GPP interfaces,
e.g. xMB interface (see 3GPP TS 29.116 [39]), Gw/Gwn interfaces (see 3GPP TS
29.251 [40]) or St interface (3GPP TS 29.155 [41]).
\- with RPC APIs, with different RPC operations for subscribing and delivering
notifications respectively.
This solution is transparent to intermediaries.
This mechanism has the following drawbacks:
\- overhead of setting up two TCP connections;
\- requirement for the NF to act both as HTTP client and HTTP server;
\- possible need to configure operator-grade firewalls to pass TCP/TLS/HTTP.
However, most 5G NFs need to support both the roles of client and server
regardless of the need to support notifications, which mitigate the above
drawbacks. For instance, an SMF acts over N11 as an HTTP server to establish
PDU sessions, and as an HTTP client to request the AMF to send N1 or N2
signalling to the UE or RAN.
###### # 6.2.2.2.1.5.3 Solutions with a single client-server pair prior to
HTTP/2
IETF RFC 6202 [42] documents few existing workarounds and associated issues to
enable server push communication on a single HTTP connection, such as
\- periodic HTTP polling from the client;
\- HTTP Long Polling where the server attempts to hold open (i.e. not
immediately reply to) each HTTP request, responding only when there are events
to deliver;
\- HTTP Streaming where the server keeps a request open indefinitely, i.e. it
never terminates the request or close the connection, even after it pushes
data to the client.
Due to the issues described in IETF RFC 6202 [42], none of them provides a
satisfactory solution for the SBA.
###### # 6.2.2.2.1.5.4 Solutions with a single client-server pair: HTTP/2
Server Push
HTTP/2 supports Server side initiated push (see subclause 8.2 of IETF RFC 7540
[15]), which allows the server to proactively push responses (along with
corresponding \"promised\" requests) to a client in association with a
previous client initiated request:
> \"Promised requests MUST be cacheable (see [RFC7231], Section 4.2.3), MUST
> be safe (see [RFC7231], Section 4.2.1), and MUST NOT include a request body.
> Clients that receive a promised request that is not cacheable, that is not
> known to be safe, or that indicates the presence of a request body MUST
> reset the promised stream with a stream error (Section 5.4.2) of type
> PROTOCOL_ERROR. Note this could result in the promised stream being reset if
> the client does not recognize a newly defined method as being safe.
>
> Pushed responses that are cacheable (see [RFC7234], Section 3) can be stored
> by the client, if it implements an HTTP cache.
>
> Pushed responses are considered successfully validated on the origin server
> (e.g., if the \"no-cache\" cache response directive is present ([RFC7234],
> Section 5.2.2)) while the stream identified by the promised stream ID is
> still open. Pushed responses that are not cacheable MUST NOT be stored by
> any HTTP cache. They MAY be made available to the application separately.\"
The mechanism is understood to be designed to send proactively responses into
client\'s cache to decrease latency upon subsequent requests from that client
matching the pushed responses, and not as a mechanism for the server to send
notifications to the application on the client side, although the latter does
not seem precluded by the very last sentence of the text quoted above (\"They
MAY be made available to the application separately\") but is not further
described (e.g. the use and handling of the promised request is not further
described in such a case). Many APIs for HTTP/2, e.g. in browsers, seem to
only support making pushed responses available to the application after the
application provides the corresponding \"promised\" request.
This mechanism also has the following drawbacks:
\- it is not guaranteed to work in presence of intermediaries:\ \ \"An
intermediary can receive pushes from the server and choose not to forward them
on to the client. In other words, how to make use of the pushed information is
up to that intermediary. Equally, the intermediary might choose to make
additional pushes to the client, without any action taken by the server.\"\ \
However, 3GPP standards could address this problem by putting corresponding
requirements on intermediaries in their controlled environment.
\- it requires the server to generate and send a promised request for every
pushes response;\ While this requirement could probably be met by 3GPP
standards, it would mean some overhead;
\- it requires to keep the stream of the original request of the client to the
\"open\" or \"half-closed (remote)\" state with respect to the server.
###### # 6.2.2.2.1.5.5 Solution based on Websocket
The Websocket protocol, defined in IETF RFC 6455 [43], provides support for
bidirectional communications over a TCP connection that allows the sending of
server\'s notifications to a client.
The main characteristics of Websocket are:
\- it relies on the client to open the Websocket;
\- opening handshake based on HTTP/1.1 (HTTP/2 not supported) using HTTP
Upgrade Header;
\- followed by basic message framing (binary) on top of TCP. This is no more
an HTTP connection, but just a transport connection;
\- text or binary data can be sent over a Websocket;
\- provides 2 ways communication without having to open multiple HTTP
connections.
The main intention of Websocket is to enable signaling towards a peer behind a
firewall (In a typical Web-browsing scenario, this peer sends the first HTTP
requests but may need to be updated with changing contents of a Webpage later
on.). However, no such firewalls are expected within the 3GPP core network.
Operator grade firewalls between different core networks are expected to be
configured anyway but can use security gateways to reduce the number of
required connections and related configuration (see 3GPP TS 33.210 [24]).
But as Websocket does not support server-initiated communication from a server
to a client, the client and the server would be forced to maintain the
websocket (set up after the opening handshake initiated by the client) for a
long duration (e.g. several days) to allow the server to push information to
the client when required. Keeping connections between all potential clients
and servers for long durations when no information needs to be exchanged is
not acceptable.
Besides, Websocket just provides a transport connection and is not an HTTP
connection.
For the above reasons, this solution is not further considered.
###### 6.2.2.2.1.6 Extensibility mechanism
The Service-Based Architecture applications are likely to evolve, and indeed
one of the key characteristics of the new architecture is that it needs to be
flexible and allow innovation and development in an easy manner.
There are a number of different aspects in extending the system. These include
ability to operate over different IP versions, evolve and change the
underlying web protocol framework, and the ability to evolve the application
components in Service-Based Architecture itself. Experience with Diameter
applications in 3GPP has shown that 3GPP applications are frequently extended.
Examples of extensibility mechanisms:
a) Discover the connectivity options, protocols and possibly features
supported by the server via the NRF.
b) HTTP/1.1 contains an upgrade mechanism to change the protocol, which can be
used to upgrade e.g. to HTTP/2. It is not expected that this mechanism is
useful for 3GPP to extend applications on top of HTTP.
c) HTTP/1.1 can be extended by the definition of new header fields; recipients
are recommended to ignore unrecognized header fields (see subclause 3.2.1 of
IETF RFC 7230 [26]). Such header fields can be, and already have been, defined
by 3GPP (see below). In addition, new methods and status codes can be defined.
HTTP/2 continues to allow extensions via new header field, new methods and new
status codes, but in addition extensions are permitted to use new frame types,
new settings, or new error codes (see subclause 5.5 of IETF RFC 7540 [15]).
d) Whether the JSON payload within HTTP for an application can be extended
without defining a new version of the application that is addressed via URL
depends on the IDL that describes the payload: Such extensions are possible if
information related to optional or added features is expressed in information
elements that will be ignored by a recipient not supporting them. Such
extensions are supported by some of the IDLs under consideration:
\- draft-newton-json-content-rules [22] specifies that additional properties
within an object are ignored.
\- The OpenAPI 3.0.0 Specification [49] specifies that by default, additional
properties within an object are ignored; this can be controlled via the
\"additionalProperties\" keyword.
e) It is common practise to express the versions of an application that needs
to be addressed in the URL. HTTP routeing will direct the request to a server
that supports the URL, and thus also the version. A server can also support
different versions of an application and select which version of an
application code to invoke based on version information in an URL.
f) Negotiate supported features which can be used in communication between
client and server: 3GPP CT3 has designed a supported feature mechanism for
HTTP based applications and uses this mechanism in 3GPP TS 29.155 [41], 3GPP
TS 29.251 [40], 3GPP TS 29.116 [39] and 3GPP TS 29.122 [67]. The mechanism
works as follows:
\- the \"3gpp-Optional-Features\" and \"3gpp-Required-Features\" HTTP header
fields defined in 3GPP TS 29.155 [41], allow an HTTP client to express in an
HTTP request features it desires or requires using, respectively;
\- the \"3gpp-Accepted-Features\" HTTP header field defined in 3GPP TS 29.155
[41] allows an HTTP client to express in an HTTP responses features it accepts
to use;
\- those features can be used in subsequent communication between the client
and server; and
\- the mechanism assumes that an IDL is used where information related to
optional or added features is expressed in information elements that will be
ignored by a recipient not supporting them.
A versioning of services according to bullet e) influences request routeing
(e.g. by versioning services in the request URI). This mechanism seems
appropriate in cases where non-backward-compatible changes occur or new
features are absolutely required. An example for such changes from past CT4
work is the introduction of new GTP versions. Such a mechanism should be
supported by the 5G Service Based Interfaces, but it is expected that version
upgrades will not be frequently applied.
Experience with Diameter applications in 3GPP has shown that 3GPP applications
are frequently extended (typically in each release and also possibly with
several independent optional features within one release). It was considered
beneficial not to impact service routeing with those multiple extensions, but
rather negotiate supported features between client and server once
communication has been established, and 3GPP has designed a Diameter supported
feature negotiation for that purpose. (Note that also in Diameter a versioning
within application names would have allowed a routeing by DRAs similar to the
routeing by http proxies based on versioning in the request URI). Such a fine-
granular negotiation mechanism is required for 5G Service Based Interfaces.
To negotiate such fine-granular extensions, the following protocol mechanisms
could be used:
1) A mechanism based on the 3gpp-Optional-Features\" and \"3gpp-Accepted-
Features\" HTTP custom headers fields similar to the mechanism designed by CT3
(see bullet f) above). Note that the \"3gpp-Required-Features\" HTTP header
field may not be required as extensions with mandatory new feature are rather
expected to be handled via URI versioning.
2) A mechanism based on similar information embedded in HTTP bodies,
An advantage of mechanism 2 is that HTTP custom headers can be stripped by
some HTTP proxies. However, in the well-controlled environment of a 3GPP core
network it is expected that this problem can be avoided. Another possible
advantage of mechanism 2 is that HTTP bodies are handled directly by
applications rather than the HTTP protocol layer. However, the OpenAPI IDL
allows applications to also handle HTTP custom headers and it is also expected
that other HTTP custom headers with relevance to applications will be defined,
e.g. to indicate the type of HTTP payloads. Another advantage of mechanism 2
is that the scope of negotiation results is defined in a straightforward
manner by including attributes used for the negotiation in the definition of a
suitable resource for the service associated to or representing the NF Service
Consumer (e.g. a top-level resource or a subresource representing the NF
Service Consumer): the results apply for that resource and any subordinate
resources and remain valid as long as the resource associated to or
representing the NF Service Consumer exists. If a service defines multiple
resources, the negotiation results would also apply to subordinate resources;
it would also apply to custom operations related to that resource and, if the
resource is used to subscribe to notifications, for the related notifications.
NOTE: How to negotiate features for APIs that would be designed without any
resource (if any) will be clarified during the normative work.
A disadvantage of mechanism 2 is that it is not suitable for HTTP methods that
allow no HTTP body, e.g. HTTP GET. However, a capability negotiation within a
GET would fail anyway if HTTP responses are cached, and GET request are seldom
used as first request when a service is started. Further, as a GET request
only returns a resource representation it seems acceptable that a server then
also provides information that the client does not understand and simply
ignores. Further attributes enabling the mechanism would need to be defined
for resource representation of those service operations that can be used as
first service operation for a service (apart from HTTP GET) and related
responses of each API, typically for the request to create a resource.
However, common data types and procedures applicable for all API can still be
defined, so the standardisation effort to add the procedures to a given API
can be kept very small.
In summary, HTTP offer sufficient extensibility mechanisms to address the
needs of 5G Service Based Interface. A versioning of services in the request
URI according to bullet e) above will be supported by 3GPP 5G APIs, but it is
expected that version upgrades will only be applied for non-backward
compatible changes or the introduction of new mandatory features. In addition,
a negotiation mechanism embedded in HTTP bodies to negotiate optional features
for the upper-level resources of a service will be supported by 3GPP 5G APIs.
Further details of those mechanisms will be covered in upcoming 3GPP Technical
Specification on Principles and Guidelines for 5G System Services Definition.
Additionally, it should be possible for NF instances to register features (or
a subset of the features) they support to the NRF, to enable NF Service
Consumers to discover NF Service Producers supporting some specific features.
Which features NF instances should register to the NRF will be determined by
operator policy.
###### 6.2.2.2.1.7 Load/Overload Control
Load Control and Overload Control mechanisms require conveyance of
corresponding information between Network Functions i.e. from NF Service
Producer to NF Service Consumer in HTTP response messages, to be taken into
account by the NF Service Consumer e.g. for load sharing or to mitigate
overload situations at subsequent service requests. This functionality can be
achieved e.g. by transporting load/overload information in HTTP response
messages as additional information piggybacked. The data conveyed and the
associated procedures may be defined inline with Rel-12 mechanisms defined for
Diameter and GTP based protocols.
As an alternative mechanism, a centralized solution via the NRF may be
considered. This alternative assumes that load/overload information of the NF
Service Producer is sent to the NRF and can be retrieved by or pushed to the
NF Service Consumer.
NOTE: The evaluation of different mechanisms is FFS.
###### 6.2.2.2.1.8 Message Priority
Support of a message priority mechanism is one of the additional evaluation
criteria (see A18 in subclause 6.2.1.5). The mechanism requires message
priority information to be transported within signalling messages sent between
Network Functions. This allows sending Network Functions to indicate the
relative priority of the message to the receiving Network Function, which then
can prioritize the received request accordingly. This functionality can be
achieved e.g. by adding fields transporting priority information to HTTP
messages. The data conveyed and the associated procedures may be defined
inline with Rel-13 mechanisms defined for DRMP.
An alternative method is to make use of the stream priority mechanism offered
by HTTP/2.
NOTE: The evaluation of different mechanisms is FFS.
###### 6.2.2.2.1.9 HTTP Proxy
The GSMA has requested that the selected protocol provides the following
capabilities:
\- Use of proxies in the path, especially in the inter-operator networks (IPX)
to ease the interconnection between roaming partners and roaming agreement
setup.
\- Use of proxies at the edge of the network acting as kind of signalling
gateways to the rest of the world and performing topology hiding.
As operator will setup roaming agreement with most of the other operators, if
the NF in VPLMN connects to the NF in HPLMN directly, there will be lots of
long-lived connections. In order to aggregate the number of connections, the
HTTP Proxy can be used in the network, especially in the inter-operator
networks (IPX).
Operators willing to hide its network topology may deploy reverse HTTP Proxies
(for ingress traffic) at the edge of their network.
A client that is configured to use a proxy over HTTP/2 directs requests to
that proxy through a single connection. That is, all requests sent via a proxy
reuse the connection to the proxy. The proxy performs the URL based routing to
forward the received message to the corresponding peer NF.
NOTE: The detail mechanism of HTTP Proxy will be further clarified.
###### 6.2.2.2.1.10 HTTP Heartbeat mechanism between NFs
A heartbeat mechanism needs to be specified for use over the 5GC Service Based
Interfaces to enable:
\- a NF Service Consumer to check the aliveness of a service on a peer NF
Service Producer, in absence of regular HTTP traffic, e.g. to allow the V-SMF
to check that the H-SMF supporting certain PDU sessions is responsive and to
tear down the PDU sessions otherwise;
\- a NF Service Producer to check the aliveness of a service on a peer NF
Service Consumer, in absence of regular HTTP traffic, to allow the NF Service
Producer to tear down resources allocated to an NF Service Producer that has
failed, e.g. to allow the H-SMF to check that a V-SMF is responsive and to
tear down the PDU sessions otherwise.
The following approaches may be considered:
a) Solution 1: sending HTTP/2 PING frames, see subclauses 6.7 and 8.1.4 of
IETF RFC 7540 [15]:
> \"The PING frame (type=0x6) is a mechanism for measuring a minimal round-
> trip time from the sender, as well as determining whether an idle connection
> is still functional. PING frames can be sent from any endpoint.\ \ Receivers
> of a PING frame that does not include an ACK flag MUST send a PING frame
> with the ACK flag set in response, with an identical payload. PING responses
> SHOULD be given higher priority than any other frame.\"\ \ \"In addition to
> these mechanisms, the PING frame provides a way for a client to easily test
> a connection. Connections that remain idle can become broken as some
> middleboxes (for instance, network address translators or load balancers)
> silently discard connection bindings. The PING frame allows a client to
> safely test whether a connection is still active without sending a request.
> \"
b) Solution 2: sending an HTTP request, e.g. HEAD request with the Cache-
Control header set to \"no-cache\", see subclause 4.3.2 of IETF RFC 7231 [32],
with the URI set to {apiRoot}/{apiName}/{apiVersion}:\ \ \"The server SHOULD
send the same header fields in response to a HEAD request as it would have
sent if the request had been a GET, except that the payload header fields
(Section 3.3) MAY be omitted. This method can be used for obtaining metadata
about the selected representation without transferring the representation data
and is often used for testing hypertext links for validity, accessibility, and
recent modification\".\ \ For APIs for which a NF Service Producer should be
able to check the aliveness of a service on a peer NF Service Consumer, the NF
Service Consumer should provide a \"Heartbeat URI\" to the NF Service
Producer, to allow the NF Service Producer to send subsequent HEAD requests
targeting the service on the NF Service Consumer.\ \ The Cache-Control header
is set to \"no-cache\" to force caches to submit the request to the origin
server for validation before releasing a cached copy.
c) Solution 3: sending an HTTP request, e.g. PUT (or POST) request, on a
generic \"status\" resource (or on a high-level NF specific resource) that
would be defined for each service, e.g. PUT {apiRoot}/pdus/v1/status. The http
server returns an HTTP 204 No Content message.\ \ For APIs for which a NF
Service Producer should be able to check the aliveness of a service on a peer
NF Service Consumer, the NF Service Consumer should provide a \"Heartbeat
URI\" to the NF Service Producer, to allow the NF Service Producer to send
subsequent PUT requests targeting the service on the NF Service Consumer.
The solution 1 allows any endpoint to check the aliveness of the HTTP
connection with a direct HTTP peer, but does not allow to check the
responsiveness of a remote HTTP peer (e.g. behind a HTTP proxy); it does not
allow either to check that the peer NF service (above the HTTP layer) is
alive.
The solution 2 allows an NF Service Consumer and NF Service Producer to check
the aliveness of a peer NF service, with or without intermediate HTTP proxies
in the path. The HEAD request and response do not contain any message body;
the HEAD response may contain headers, but this should not cause significant
overhead thanks to the support of header compression by HTTP/2. This solution
however requires to force HEAD request not to be cached, HEAD being a safe
method.
The solution 3 allows an HTTP client to check the aliveness of the peer NF
service (on the HTTP server), with or without intermediate HTTP proxies in the
path. The PUT request may need to contain a message body (e.g. to avoid facing
interoperability issues with intermediaries); the PUT response would not need
to contain any Body. It may require the modeling of an extra \"status\"
resource to be supported by the NF service. This method is not a safe method
and naturally allows to send a request to the origin server.
It is proposed to retain the solution 3 to allow a NF Service Consumer or NF
Service Producer to check the aliveness of a service on a peer NF in absence
of regular traffic. The need for support of this heartbeat mechanism will be
decided on a per API basis in the respective stage 3 specifications.
##### 6.2.2.2.2 Evaluation
###### 6.2.2.2.2.1 Comparison of HTTP versions
HTTP/1.1 is widely available but HOL blocking at HTTP level is a major concern
for its possible use in the 5GC. This would require 5GC NFs acting as HTTP
clients to open numerous concurrent TCP connections towards other 5GC NFs
acting as HTTP servers. Text-based framing also results in a more complex and
inefficient parsing of HTTP frames.
HTTP/2 provides higher performances by supporting:
\- the multiplexing of HTTP requests over the same TCP connection without HOL
blocking at HTTP level, thus also avoiding the need to open multiple TCP
connections towards a same HTTP server;
NOTE: HOL blocking at TCP level still exists with HTTP/2 over TCP.
\- binary framing, which allows easier and more efficient parsing of HTTP
frames;
\- header compression.
Consequently HTTP/2 shall be used if an HTTP solution is adopted for the SBA
protocol.
###### 6.2.2.2.2.2 Support of Server-initiated communication from a server to
a client
Subscribe/Notify service operations can be supported in the SBA using two
client-server pairs between a consumer NF and a provider NF as specified in
subclause 6.2.2.2.1.5.2, without any significant concern, if an HTTP solution
is adopted for the SBA protocol.
###### 6.2.2.2.2.3 Overall evaluation
See subclause 6.2.2.4 for the overall evaluation of HTTP solution.
#### 6.2.2.3 Solution 3 -- GTPv2-C
##### 6.2.2.3.1 Solution Description
GTP (GPRS Tunnelling Protocol) is a 3GPP defined protocol, which was initially
defined by 3GPP in 3GPP TS 29.060 [27] for the Gn interface (between GSNs
within a PLMN) and Gp interface (between GSNs in different PLMNs). It includes
both the GTP control plane (GTP-C) and user plane (GTP-U) protocols.
GTP-C was upgraded to version 2 in 3GPP R8 in 3GPP TS 29.274[28].In EPC,
GTPv2-C is used for creating, maintaining and deleting tunnels on multiple
interfaces. It is used for the control plane path management, tunnel
management and mobility management. It also supports the forwarding relocation
messages between MME/SGSNs during UE mobility and the creation of forward
tunnels during inter handovers.
The protocol stack of GTPv2-C is described in Figure 6.2.2.3.1-1.
{width="3.4694444444444446in" height="2.303472222222222in"}
Figure 6.2.2.3.1-1: GTPv2-C stack
The message format of GTPv2-C is described in Figure 6.2.2.3.1-2.
Figure 6.2.2.3.1-2: GTPv2-C message format
The characteristics of GTPv2-C are:
\- A pure binary formatted protocol, only used in mobile network,
\- A peer-to-peer communication model, no forwarding and routing mechanism was
defined,
\- UDP applied as the transport layer, does not include security solution,
\- The \"Sequence Number\" is applied for transmission reliability, which
shall be controlled and confirmed by application layer.
##### 6.2.2.3.2 Evaluation
For the following reasons, GTPv2-C is not suitable for SBA interface protocol:
\- **GTP-C is not suitable for interfaces not related to session management.
So this would require at least 2 protocols to be supported in the 5GC and by
some NFs;**
\- No native support of transport layer security mechanism, although DTLS can
be applied, but it is not a popular solution;
\- The transmission reliability relies on application layer;
\- Do not support message relay and routing mechanism.
#### 6.2.2.4 Comparison of RESTful and RPC protocol design
##### 6.2.2.4.1 Characteristics of RPCs
Remote procedure calls (RPCs) do not have a formal definition, but typical
characteristics are described in the related Wikipedia article [59].
RPCs enable inter-process communication where a client entity invokes a
certain functionality on a server entity over a network protocol. They
typically use a request-response protocol. Unlike the RESTful design, the
client typically does not operate on resources, but invokes \"functions\" or
\"services\".
It should be pointed out that this architectural style is, essentially, how
3GPP has modelled the mobile networks during the last 20 years, with tight
coupling of client and servers, and thorough and detailed protocol
specifications mandatory for both ends of each interface.
Many different implementations of RPCs exist that use various protocols for
the data transfer and the encoding of the transported data. Among them are
also implementations that use HTTP.
Some typical characteristics of RPCs over HTTP are:
\- The POST verb is used in most cases, sometimes also PUT or GET.
\- The specific operation (service) to invoke may be included as part of the
URI.
\- For HTTP GET, the input parameters are coded as URI parameters.
\- For HTTP POST or PUT, the input parameters are coded in the HTTP body.
\- The result (output parameters) is coded in the body of the HTTP response.
Example of an HTTP request/response interaction following an RPC-style (the
example represents an interaction from a well-known S6a protocol in the EPC
system, just for the purpose to illustrate how a similar interaction would
look like in the 5GC):
> POST /operations/S6a:Authentication_Information_Request HTTP/1.1\ Host:
> hss.operator.com\ Content-Type: application/json\ {\ \"S6a:input\" : {\
> \"IMSI\" : \"987654321098765\",\ \"VPLMNID\" : \"123456\",\
> \"RequestedEUTRANAuthenticationInfo\" : {\ \"NumberOfRequestedVectors\" :
> 1,\ \"ImmediateResponsePreferred\" : true\ },\ \"Flags\" :
> \"Request_UE_Usage_Type\"\ }\ }
>
> HTTP/1.1 200 OK\ Date: Thu, 26 Jan 2017 20:56:30 GMT\ Content-Type:
> application/json\ {\ \"S6a:output\" : {\ "AuthenticationInfo" : {\
> \"EUTRANAuthenticationVectors\" : [\ {\ \"VectorNumber\" : 1,\ \"RAND\" :
> \"NzA5Mzg0MDI5ODA4NDMyMQ==\",\ \"XRES\" : \"MjA5Mzg0MDU5ODYwMDM4MQ==\",\
> \"AUTN\" : \"MTIzNDU2Nzg5MDEyMzQ1Ng==\",\ \"KASME\" :
> \"OTg3NjU0MzIxMDY1NDMyMQ==\"\ }\ ]\ },\ \"UE_Usage_Type\" : 1\ }\ }
This style of modelling interactions between network entities is also referred
as \"Custom API methods\" in subclause 6.2.2.4.7, as a way to complement a
RESTful API with additional methods where it is not easy to find a mapping to
a CRUD operation.
##### 6.2.2.4.2 Characteristics of REST
REST (Representational State Transfer) is a set of architectural principles
introduced by of Roy T. Fielding in his Dissertation [57]. Those principles
are frequently associated to the Service Oriented Architecture. The principles
are:
1\. **Client/Server:\** Split of responsibilities between client and server. A
Client sends a request to the server which returns a response. This allows
separating different tasks, e.g. the user interface generation from the data
storage, which simplifies the single tasks and enhances portability and
scalability.
2\. **Stateless:\** Each request from client to server must contain all the
information necessary to understand the request. Session state is therefore
kept entirely on the client. The server does not keep history/memory of
previous requests. Possible session state can be transferred by the server to
another service such as a database to maintain a persistent state for a
period. Different request can be served by different servers, improving
reliability and scalability.
3\. **Cacheable:\** If a response is cacheable, then a client cache is given
the right to reuse that response data for later, equivalent requests. This
allows to eliminate some interactions, improving efficiency, scalability, and
average latency.
4\. **Uniform interface:\** The interface is based on an identification of
resources, and allows a manipulation of resources through representations of
these resources. Individual resources are identified in requests, for example
using URIs. The resources themselves are conceptually separate from the
representations that are returned to the client. When a client holds a
representation of a resource, including any metadata attached, it should then
be able to use server-provided links dynamically to discover all the available
actions and has enough information to modify or delete the resource. Messages
should be self-descriptive (e.g. indicate format via MIME type.\ The overall
system architecture is simplified and the visibility of interactions is
improved. Implementations are decoupled from the services they provide, which
encourages independent evolvability. The trade-off, though, is that a uniform
interface degrades efficiency, since information is transferred in a
standardized form rather than one which is specific to an application\'s
needs.\"
5\. **Layered system:\** The system is composed of hierarchical layers by
constraining component behaviour such that each component cannot \"see\"
beyond the immediate layer with which they are interacting. Intermediary
servers may improve system scalability by enabling load balancing and by
providing shared caches. The client does not care about how the server
provides the response.
6\. **Code on Demand** (optional):\ REST allows client functionality to be
extended by downloading and executing code in the form of applets or scripts.
This simplifies clients by reducing the number of features required to be pre-
implemented.
The practise has shown that those principles are adhered to in varying degrees
by APIs that claim to be RESTful. The Richardson maturity model for REST APIs
(as originally suggested by Leonard Richardson during a conference
presentation [58], see also Annex C of ETSI GS MEC 009 [38]) defines the
following compliance levels for HTTP-based REST APIs
**Level 0** :\ A single service endpoint (e.g. API) is addressed via URI and
HTTP is used as a tunnelling mechanism for remote interaction. RPCs using SOAP
are mentioned as an example.
**Level 1** : **Resources** :\ Individual resources are addressed via URIs.
Does not make use of the different HTTP methods, but uses HTTP POST only.
**Level 2** : **HTTP Verbs** :\ Using the HTTP verbs or methods as intended
(e.g. POST, GET, DELETE, PUT) to keep apart different operations on resources.
**Level 3** : **Hypermedia** **Controls** :\ Hypermedia indicate to the client
what is possible to do with a resource. This helps client developers explore
the protocol. The links give client developers a hint as to what may be
possible next and allow the server to advertise new capabilities.
NOTE: The API design guidelines in ETSI GS MEC 009 [38] recommend compliance
with Level 3.
##### 6.2.2.4.3 Degree of Compliance of the stage 2 requirements with RPC
Stage 2 documents requirements in an RPC-like fashion: It defines \"service
operations\" (i.e. actions described in terms of messages and their
parameters).
However, stage 2 also requires that \"network functions within the 5GC Control
Plane shall only use service-based interfaces for their interactions\".
General characteristics of those \"service based interfaces\" are described in
Clause 7 of 3GPP TS TS 23.501 [2]. Among them are requirements that an NF can
expose multiple services and that one service can have several consumers.
Stage 3 protocol design for a RPC solution would need to take those
requirements into consideration.
In addition to those concrete requirements, stage 2 wording and related
argumentation in the preparatory study also signals an intent to align with
principles of a service oriented architecture, for which the use of RPCs is
prone to result in a proliferation of heterogenous interfaces and methods and
lack of reuse.
##### 6.2.2.4.4 Degree of Compliance of the stage 2 requirements with REST
Table 6.2.2.4.4-1 analyses the extent to which REST principles according to
Roy T. Fielding`s Dissertation [57], as outlined in subclause 6.2.2.4.2 are
met by the stage 2 architecture and procedures of the 5GC Control Plane.
Table 6.2.2.4.4-1: Compliance of 5G service based architecture with REST
principles.
+----------------------------------+----------------------------------+ | REST Principle | **Compliance of 5G Service Based | | | Architecture** | +----------------------------------+----------------------------------+ | **1\. Client/Server** | **_Mostly met_**.\ | | | Services are defined in such a | | | way that a provider NFs offers | | | services to consumer NFs.\ | | | However, services can include | | | asynchronous notifications from | | | server to client which may need | | | to be modelled as a separate | | | pair of client and server with | | | reversed roles. | +----------------------------------+----------------------------------+ | **2\. Stateless** | **_Not fully met_**.\ | | | Stage 2 requires that a resource | | | at a particular server, rather | | | than a resource at an arbitrary | | | server, is addressed after a | | | separate server selection via | | | the NRF.\ | | | The server also needs to | | | maintain some state to provide | | | asynchronous notifications. | | | | | | However, there are no stage 2 | | | requirements to maintain a | | | \"session\" state at the server | | | on many interfaces (e.g. N8, | | | N10, N12, N13), and other | | | interfaces (e.g. N11, N7) can | | | also be designed as session | | | stateless. | +----------------------------------+----------------------------------+ | **3\. Cacheable** | **_Not fully met_**.\ | | | It is anticipated that most | | | interactions will relate to | | | resources for a particular | | | served UE that can be changing | | | frequently. Caching related | | | responses would offer little | | | benefit.\ | | | However, NFs can cache NRF | | | responses. | +----------------------------------+----------------------------------+ | **4\. Uniform interface** | **_Can be met_**.\ | | | It is largely a stage 3 decision | | | how to document interfaces and | | | whether to document service | | | based interface in a uniform | | | fashion.\ | | | Adherence to level 3 of the | | | Richardson maturity model seems | | | possible. | +----------------------------------+----------------------------------+ | **5\. Layered system** | **_Met_.**\ | | | Consumer NF does not need to be | | | aware of how producer NF | | | provides a response. | +----------------------------------+----------------------------------+ | **6\. Code on Demand** (optional) | **_Not met._** | | | | | | _No related stage2 requirements | | | exist._ | +----------------------------------+----------------------------------+
Table 6.2.2.4.4-2 analyses the REST compliance level according to Richardson
maturity model, as outlined in subclause 6.2.2.4.2, that APIs for service
based interfaces of the 5GC Control Plane could achieve.
Table 6.2.2.4.4-2: Achievable Richardson Maturity Levels for Restful APIs in
the 5GC Control Plane.
+----------------------------------+----------------------------------+ | Level | Restful APIs in the 5GC Control | | | Plane | +----------------------------------+----------------------------------+ | **Level 1** : **Resources** | **_It is expected that this | | | level can be achieved to a large | | | extent_.** | | | | | | Stage 2 requirements are not | | | documented in terms of | | | resources, so additional stage 3 | | | analysis will be required to | | | derive resources. | | | | | | Some services could map easily | | | to resources, e.g. PDU session | | | as resource for SMF services, or | | | stored data as resource for UDM | | | services.\ | | | Designing resources for some | | | other services may require more | | | discussions, e.g. | | | | | | • AMF services (N1N2 Message | | | Transfer/Notify, Forward | | | Relocation Request) | | | | | | • AUSF services | | | (UEAuthentication Request) | | | | | | • 5G-EIR services (Check ME | | | Identity) | | | | | | As a possible remedy, RPC-like | | | resources have been defined in | | | previous Restful APIs, e.g. the | | | \"task\" resource defined in of | | | ETSI GS MEC 009 [38]. | +----------------------------------+----------------------------------+ | **Level 2** : **HTTP Verbs** | **_It is expected that this | | | level can be achieved to a large | | | extent._** | | | | | | Once resources are defined in a | | | suitable fashion, in most cases | | | applying suitable HTTP methods | | | should be simple. | | | | | | However, for some special | | | resources mainly the POST HTTP | | | might be suitable, e.g.\ | | | • Notifications could be | | | described as resources posted by | | | the client, but there might not | | | be a requirement to subsequently | | | manipulate those resources with | | | other HTTP methods. | | | | | | • Resources representing | | | transferred messages at the AMF | | | would likely also only be | | | posted. | | | | | | • There might be a need to pass | | | some parameters when deleting a | | | resource (see e.g. GTP-C DSR/DBR | | | in EPC) | | | | | | Note: Also for the \"task\" | | | resource defined in of ETSI GS | | | MEC 009 [38], only the POST | | | method is supported, | +----------------------------------+----------------------------------+ | **Level 3** : **Hypermedia** | **_It is expected that this | |_ *Controls** | level can be achieved to a large | | | extent.*** | | | | | | Once resources and HTTP verbs | | | are defined in a suitable | | | fashion, Hypermedia can also be | | | provided. | +----------------------------------+----------------------------------+
##### 6.2.2.4.5 Evaluation of RPC
For 5GC, the SBA definitions in stage-2 follow an architectural style that
matches much more closely an RPC style of interaction, rather than a REST
approach.
It should be noted that a RESTful or RPC approach is not inherently better or
worse, and that several of the advantages present in REST, are also achievable
by RPC.
Maybe, one of the advantages where REST is clearly superior is the higher
degree of decoupling between client and server (allegedly achieved by the use
of the HATEOAS principles). However, this characteristic is expected to bring
more benefits in a scenario where the SDO defining an API has no, or little,
control over the clients of such API; but this is NOT the case of 3GPP 5GC,
where both client and servers are internal network entities fully specified,
in all detail (including backwards compatibility across releases, feature
negotiation mechanisms, protocol extensibility, etc..), by 3GPP; these
criteria, however, may be different for interfaces exposed towards external
clients of the 3GPP system.
##### 6.2.2.4.6 Evaluation of REST
###### 6.2.2.4.6.1 General
It is evident that the REST architectural style offers remarkable benefits,
and that\'s why its acceptance in the design of web systems has grown
exponentially in the last years. However, it should be also noted that the
current architectural definition (stage-2) of the 3GPP 5GC has followed a
totally opposite paradigm, mainly based on describing interactions between
entities by following a procedure/service invocation, or the triggering of a
certain action on the server (very much like a Remote Procedure Call), rather
than a resource-oriented architectural definition, which would have been
desirable in order to achieve a smooth and straightforward stage-3 protocol
specification phase.
This fact does not mean that RESTful protocol design cannot be used, since it
is often rather straightforward to map the service invocation described in
stage-2 to a RESTful resource manipulation operation; when such mapping is
easy or straightforward, it is indeed recommended to follow such design
approach.
However, in other cases, mapping the stage-2 service invocation style of
interaction to a resource operation is quite awkward and totally counter-
intuitive, making it very hard and cumbersome the stage-3 protocol definition,
which will affect the understanding of the relationship between stage-3
protocol and stage-2 service operations for implementers, making the system
prone to inter-operability problems.
###### 6.2.2.4.6.2 Level 3 of the Richardson maturity model
Level 3 of the Richardson maturity model is supposed to offer the following
benefits:
a) Hyperlinks allow developers to explore the possibilities of the API.
b) The structure of resources can be modified and extended by the server at
any time and the client automatically adjust to such changes.
However, benefit a) seems not compelling in a 3GPP environment where 3GPP
standards provide an open and extensive documentation.\ Benefit b) seems to be
very hard to achieve in practice, because for each hyperlink the meaning (what
type of resource or custom operation does the hyperlink point to?), and
possible operations (HTTP verbs, URI query parameters, etc.) would need to be
communicated in a clearly standardized and machine readable fashion to allow a
client to automatically make use of that hyperlink. Even then, it seems very
unrealistic that a client can make automatic use of new API extensions
advertised in such a fashion as it would also need the capability to further
handle related extensions (e.g. to interwork with similar extensions at other
interfaces).
The main drawbacks of adhering to Level 3 of the Richardson maturity model are
a) Increased message size and computational effort.
b) Increased standardization effort, in particular if a stringent machine-
readable format to describe all possible operations on a resource and the
semantics associated with a hyperlink to a resource is defined.
It is thus suggested that 5G APIs do not need to support Level 3 of the
Richardson maturity model.
##### 6.2.2.4.7 HTTP APIs types
The API Design Guide from Google [60] provides general design guidelines for
HTTP-based REST APIs and RPC APIs to design simple, consistent and easy-to-use
APIs. Table 6.2.2.4.7-1 provides an overview of standard and custom API
methods described in this document.
Table 6.2.2.4.7-1: Standard and Custom API methods
+----------------------+----------------------+----------------------+ | | Standard API methods | Custom API methods | +----------------------+----------------------+----------------------+ | Usage | API functionality | API functionality | | | that naturally maps | that does not | | | to one of the | naturally map to one | | | standard method | of the standard | | | | methods | | | (CRUD operations). | | | | | (non-CRUD | | | | operations) | +----------------------+----------------------+----------------------+ | Method | Standard method: | Custom methods | | | | | | | List, Get, Create, | | | | Update, Delete | | +----------------------+----------------------+----------------------+ | Resource/Scope | Applies to the | Can be associated | | | resource indicated | with a resource, a | | | in the URI | collection (see | | | | NOTE) or a service | +----------------------+----------------------+----------------------+ | HTTP mapping | Standard HTTP method | Custom method | | | | included in URI. | | | List: GET | | | | \ | Mapped to the most | | | | suitable HTTP method | | | Get: GET \ | | | | | | | | Create: POST | | | | \ | | | | | | | | Update: PUT or PATCH | | | | \ | | | | | | | | Delete: DELETE | | | | \ | | +----------------------+----------------------+----------------------+ | Parameters | Parameters/objects | Parameters/objects | | | in Body or URI (e.g. | in Body | | | search parameters in | | | | URI) | | +----------------------+----------------------+----------------------+ | Properties | Large number of | Large number of | | | resources, only few | methods permitted | | | methods (CRUD) | | | | allowed | | +----------------------+----------------------+----------------------+ | API examples | POST /Sessions/ | POST /messages:send | | | | | | | DELETE | POST | | | /sessions/123456 | /sess | | | | ions/123456:activate | +----------------------+----------------------+----------------------+ | Example use cases | CRUD operations | Cancel an | | | | outstanding | | | | operation | | | | | | | | Move a resource from | | | | one parent to | | | | another | | | | | | | | Activate/Deactivate | | | | a resource | +----------------------+----------------------+----------------------+ | NOTE: A collection | | | | contains a list of | | | | resources of the | | | | same type. | | | +----------------------+----------------------+----------------------+
##### 6.2.2.4.8 Conclusions
It would be straight forward to design RPCs based on the stage 2 service /
service operations documentation, but such a protocol design might not
adequately match the expectation motivating the selection of service based
interfaces and could also block a future evolution to a larger compliance with
a Service Oriented Architecture.
Designing RESTful APIs meeting stage 2 requirements for service based
interfaces seems feasible but will require more stage 3 analysis to model
resources. RESTful APIs offer the advantage of homogenous, easy to use
interfaces, enhanced HTTP visibility (HTTP method accessible e.g. for
proxying, logging, monitoring) and a larger decoupling between client and
server compared to RPCs. For some operations, an RPC like design might be
necessary, but experience exist how to embed such operations in a RESTful
framework (see e.g. custom methods associated with a resource in subclause
6.2.2.4.7).
The 5GC manages resources such as UEs, sessions or database records where
large number of instances exist and which can be mapped typically to simple
resource operations like CRUD.
It is recommended to apply a RESTful framework for the protocol design as
follows:
\- service operations should implement the Level 2 of the Richardson maturity
model, with standard API methods, whenever it is a good match for the style of
interaction to model, e.g. service operations that can naturally map to one of
the standard method (CRUD operations); this should be the preferred modelling
attempt;
\- service operations may use custom API methods (RPC interaction), when it is
seen a better fit for the style of interaction to model, e.g. non-CRUD service
operations.
#### 6.2.2.5 Data Serialization Format
##### 6.2.2.5.0 Introduction
There is a huge number of alternatives to encode structured data over-the-
wire. As can be seen in
https://en.wikipedia.org/wiki/Comparison_of_data_serialization_formats, the
list is quite exhaustive. Probably the main properties to focus, to select the
most appropriate encoding format would be:
\- Standard (defined and backed-up by an SDO)
\- Widespread industry adoption
\- Performance (related in part to another property: binary vs textual)
So, from the list included in the reference above, the evaluation has been
narrowed down to 3 alternatives: JSON (text-based, and being an IETF standard,
with the widest adoption), and 2 binary alternatives (BSON and CBOR) to
consider other approaches with a potential better performance.
Alternatives such as ASN.1 have not been considered, given the lack of
industry acceptance of such format as data serialization over HTTP.
Alternatives such as Protocol Buffers / Apache Avro / MessagePack, etc., have
not been considered given that they are not backed up by an SDO (despite the
specification being publicly available, and being categorized as
\"Standardized\" in the list of alternatives included in the reference above).
##### 6.2.2.5.1 Solution 1 -- JSON
###### 6.2.2.5.1.1 Description
JSON is specified in IETF RFC 7159 [16], and it is a lightweight text-based
data interchange format, originated from a subset of the JavaScript
programming language.
It is the most widespread format, especially in the area of HTTP web services,
given its simplicity and ease of use. It has a very simple and straightforward
specification, and the tools availability is immense, both from a development
perspective (programming language support for code generation to encode/decode
documents) and from an application specification perspective (with IDL
frameworks such as OpenAPI / Swagger, targeting primarily JSON as data
format).
###### 6.2.2.5.1.2 Evaluation
The main advantage of JSON is its widespread adoption and deployment, being
the de-facto industry standard, and also its simplicity (human-readable).
The main drawback is that it is considered as too verbose, with other binary
alternatives having better performance, in terms of encoding/decoding and
message size.
Given its de-facto industry standard for HTTP web services development, and
the tool availability, it is regarded as the primary recommendation for usage
in 3GPP 5GC specification. At the same time, it is recommended for further
releases to consider a more efficient alternative, which should be assessed
once more data regarding expected performance gains are collected by 3GPP
members.
Regarding performance, it should be noted that sometimes the critical factor
is the usage of a well-optimized encoder/decoder library; this is especially
applicable to JSON, where many libraries included by default in a certain
software platforms, can be greatly outperformed by specialized libraries
(e.g., UltraJson (https://github.com/esnme/ultrajson), or Jackson
(https://github.com/FasterXML/jackson).
##### 6.2.2.5.2 Solution 2 -- BSON
###### 6.2.2.5.2.1 Description
BSON (short name for Binary JSON) is specified in
http://bsonspec.org/spec.html. It should be noted that this format is not
backed up by a Standards Developing Organization (SDO) and, instead, it was
mainly developed as the binary format used in the MongoDB
(https://www.mongodb.com/) document database to store JSON documents
internally.
###### 6.2.2.5.2.2 Evaluation
The main design goal of BSON is the ease of traversal of documents, given its
primary applicability to document databases. It was not designed to be
specially more compact of faster than JSON.
BSON offers minimal performance gains (compared with JSON), with some tests
claiming that the encoding and decoding might be even slower than a JSON
equivalent document. The potential gains are quite dependent on the type of
document (numeric fields are encoded/decoded more efficiently than textual
fields). Also, when some \"native\" BSON data types are used during the
encoding of the data structures, the performance gains are higher, but the
obvious disadvantage is that by using them, the JSON/BSON equivalence is not
possible anymore.
Similarly, the gains in message size are minimal, and in some cases, the BSON
document may be even larger than the corresponding equivalent JSON document.
Overall, considering its non-standard status, its primary applicability to a
\"document database\" environment, and its questionable performance benefits,
BSON is not recommended for 3GPP 5GC protocols.
##### 6.2.2.5.3 Solution 3 -- CBOR
###### 6.2.2.5.3.1 Description
Concise Binary Object Representation (CBOR) is specified in IETF RFC 7049 [66]
and it is a binary serialization format specification developed primarily for
constrained devices and applications, such as IoT devices.
The main goal of CBOR is to achieve a higher degree of compactness and
efficiency, for both encoder and decoder, at least when compared with other
text-based serialization formats such as JSON.
###### 6.2.2.5.3.2 Evaluation
CBOR is often hyped as being dramatically more efficient than JSON, claiming
sometimes an efficiency gain of 2x-3x; however, according to benchmarks run
over the Jackson processor (a high-efficiency JSON processor for Java), the
efficiency gain in encoding/decoding, is typically around 20-30% (source:
https://groups.google.com/forum/#!topic/jackson-user/OSOnFl2izbo). It seems
questionable whether a performance gain in this range makes up for some other
clear advantages in JSON, such as the widespread industry usage, tools
availability, and simplicity.
Another source worth checking is the academic Thesis work \"Implementation and
evaluation of the CBOR protocol\"
(https://is.cuni.cz/webapps/zzp/download/130156104 _)_ where it is stated
that, while acknowledging the higher efficiency of CBOR, it is concluded that
\"while a viable alternative to JSON or MsgPack, CBOR's unique combination of
features does not give it a significant competitive edge over these formats in
their respective domains\".
In addition, using CBOR makes it more difficult to use an IDL such as Open API
(Swagger 2.0), which is mainly used along with JSON. There is, in fact, a
specification language intended to cover this gap (CDDL -- Concise Data
Definition Language), currently under definition in IETF, but the status as of
today is only an IETF draft (https://tools.ietf.org/html/draft-ietf-cbor-
cddl-00), probably not mature enough to be used as a basis for specification
in 3GPP 5GC.
In any case, CBOR is an alternative worth considering for usage in 3GPP 5GC,
mostly because its expected higher efficiency and performance when handling
specific data structures, such as byte arrays (octet streams), which are
arguably one of the most common data structure expected in 5GC protocols (as
they were in EPC protocols). For those, JSON is particularly poorly suited.
##### 6.2.2.5.4 Solution 4 -- Multiple payload formats including binary
formats
###### 6.2.2.5.4.1 Description
###### # 6.2.2.5.4.1.1 General
Many application layer protocols can carry multiple data sets of same or
different format in the body of a single message. This capability is called
multipart and messages that carry multiple data sets are called multipart
messages. Multipart is frequently applied to HTTP, e.g. to transfer a binary
encoded picture together with its text-encoded metadata. As such, many tools
are available for service development and service specification of multipart
applications. The OpenAPI IDL supports multipart from version 3.0 and the
corresponding parsers are updated accordingly.
Multipart HTTP messages are identified by a multipart Content-Type field,
which indicates that the message body contains multiple body parts. Each body
part is preceded by an encapsulation boundary. The last body part is followed
by a closing boundary. Each body part consists of a header area, a blank line,
and a body area. A body part is structured very much like a \"regular\" body
preceded by the content-header fields.
According to IETF RFC 2045 [69] and IETF RFC 2387 [71], HTTP messages with
multiple independent body parts should use the content-type
\"multipart/mixed\", and HTTP messages with multiple inter-related body parts
should use the content-type \"multipart/related\". The Content-types
multipart/mixed and multipart/related allow to include, in one multipart HTTP
message, multiple content types, each with its own serialization format. The
different content parts can be distinguished and identified by different
content-types. If several body parts host payloads of the same type, a HTTP
Content-ID header can be added to the body for differentiation. In this way,
payloads in one body part can include references to related payloads in other
body parts.
According to IETF RFC 2387 [71], the first body part the application processes
when receiving a multipart/related message is called \"root\" object (or
\"root\" body part). The default root is the first body within the
multipart/related message. A multipart/related message shall include a
\"type\" parameter specifying the media type of the root body part, and may
include a \"Start\" parameter indicating the root body part (e.g. when this is
not the first body part in the message) and a \"Start-Info\" parameter
pointing to another body part in the message. Figure 6.2.2.5.4.1.1-1 shows an
example HTTP message with 3 body parts. Body part 1 contains the JSON payload
associated with resource/4711. Body part 2 contains a N1_SM_Container, which
is binary formatted and contains a content-ID header such that it can be
referenced by the JSON payload in body part 1. Body part 3 contains a
N2_SM_Container which is binary formatted and identified by the vendor
specific application sub-type \"vnd.3GPP.N2-SM\".
Figure 6.2.2.5.4.1.1-1: Multipart HTTP message which 3 body parts
###### # 6.2.2.5.4.1.2 Content-type of binary body part
For container objects which contain binary data of unknown content type, IETF
RFC 2046 [70] has defined the content-type application/octet-stream. This
content-type carries no information on how an application shall process the
payload. Such information must be included in the payload of some known
content-type, e.g. application/JSON, along with the references to the
different binary payloads. IETF RFC 2045 [69] has defined the Content-ID
header field to allow one body part to make references to another body part.
NOTE 1: The \"Content-Disposition\" header and its parameter \"name=\" are not
considered for use in the 5GC SBI since:\ \ a) the \"Content-Disposition\"
parameter \"name=\" is specific to the MIME-type multipart/form-data (see IETF
RFC 7578 [77]) and cannot be used to name a body part for MIME-type
multipart/mixed;\ \ b) According to IETF RFC 2183 [76] and IETF RFC 2387 [71],
the \"Content-Disposition\" header field communicates optional Presentation
Information to the recipients of Internet Messages. A typical use of this
parameter is form data conveyed via http multipart messages or mail
attachments sent via smtp. The \"Content-Disposition\" tells the recipient how
to present a body part, as a single document with a list of attachments or as
a single document with attachments expanded. With MIME-type multipart/form-
data, the \"Content-Disposition\" header and its parameter \"name=\" are
mandatory and the \"name=\" parameter value conveys the field name of the form
corresponding to the body part. This is of no use for the 5GC, as Presentation
Information is not needed for the processing of the http messages.
Alternatively, in accordance with IETF RFC 6838 [72], vendor specific content
subtypes \"vnd.\" can be used to designate vendor specific payload types (e.g.
vnd.3GPP.N1-SM for N1 SM containers and vnd.3GPP.N2-SM for N2 SM containers).
3GPP defined \"vnd.\"subtypes would allow to fully describe the nature of
opaque payloads without having to rely on metadata included in some other
payload, and thus enable the application to determine how to process the body
part. Having distinct \"vnd.\" subtypes may also allow consumers to announce
support for specific payload types by means of the HTTP Accept header.
NOTE 2: IANA registration of vendor specific content subtypes is not an issue.
This is what has been done e.g. for IMS/SIP, where XML or JSON message bodies
were defined with their own vnd-subtypes. IETF RFC 6838 [72] states that
\"public exposure and review of media types to be registered in the vendor
tree are not required\".
Figure 6.2.2.5.4.1.2-1 below illustrates how HTTP multipart messages could be
used on the N11 reference point using 3GPP vendor specific subtypes. The
figure shows an example of Nsmf_PDUSession_UpdateSMContext operation including
N1 and N2 payloads formatted as a standard PATCH method with multiple body
parts (the same approach can also apply to custom methods, e.g. if this
service operation is defined as such). The binary part may be included in the
request, response or both.
Figure 6.2.2.5.4.1.2-1: AMF-SMF: UpdateSMContext using PATCH with
\"multipart\" HTTP message
Figure 6.2.2.5.4.1.2-2 provides an example definition of a multipart Request
Body including a JSON body part and a binary body part with OpenAPI 3.0, using
3GPP vendor specific subtypes.
Figure 6.2.2.5.4.1.2-2: Exampe OpenAPI 3.0 definition of a multipart HTTP
message
###### # 6.2.2.5.4.1.3 Use of Content-ID header to link the json and binary
body parts
Several binary body parts may need to be included in a single multipart
message.
If 3GPP vendor specific subtypes are defined for the few use cases in the 5GC
requiring to transfer large opaque binary payloads, different binary body
parts in a same multipart message would typically use different content-types,
and thus would not require the inclusion of a Content-ID header and linkage
between the json and binary body parts.
If several binary body parts can host payloads of the same Content-type, a
HTTP Content-ID header can be added to the binary body part for
differentiation and be referenced by the json body part. Although this is
adding more overhead to the multipart message and requires the parser to rely
on metadata included in the JSON payload to understand the semantic of the
information encoded in the binary body part, the use of the Content-ID is a
**common practice when mixing different body parts in a message and is a
future proof protocol design**.
###### 6.2.2.5.4.2 Evaluation
###### # 6.2.2.5.4.2.1 Large opaque binary payloads over 5GC SBIs
The 5GC presents several use cases, which may require to transfer one or more
large opaque binary payloads over certain service based interfaces:
\- N1 SM payload over N11, encoded in binary TLV format as specified in 3GPP
TS 24.501 [73], e.g.
\- a PDU Session Establishment Request or Accept message can contain several
tens of octets, depending on the size of parameters such as the DNN (2-100),
QoS Rules (2-65537), ePCO (4-65538);
\- N1 SMS payload over N20, encoded in binary TLV format as specified in 3GPP
TS 24.501 [73], e.g.
\- by analogy with EPS, the Downlink NAS Transport message and Uplink NAS
Transport message allows to encode a NAS message container with a maximum
length of 252 octets;
\- N2 SM payload over N11, encoded in binary ASN.1 format as specified in 3GPP
TS 38.413 [74], e.g.
\- a PDU Session Setup Request or Response message can contain several tens of
octets, dependent on parameters such as the number of Qos Flows;
\- RAN Transparent Containers over N14, e.g. encoding
\- a RRC Handover Command prepared by the Target RAN and to be sent by the
source RAN to the UE), encoded in binary ASN.1 format as specified in 3GPP TS
38.413 [74].
NOTE: It is FFS whether EAP payloads (see IETF RFC 3748 [75]) are large enough
to justify encoding them in binary format over the N12 SBI.
This list is not meant to be exhaustive and additional use cases of large
binary payload types may be identified during the stage 3 normative work.
Note that the size of the above payloads may also be shorter in some
scenarios, e.g. depending on the SM message type and message contents.
###### # 6.2.2.5.4.2.2 Use of HTTP multipart messages over 5GC SBIs
The support of multipart messages and binary body parts would be beneficial
for large opaque binary payloads such as those listed in subclause
6.2.2.5.4.2.1 which, with a single JSON content-type approach, would require
encoding and decoding at both ends of the SBI. For example, in the case of
json, binary objects would typically get Base64 formatted, resulting in
processing overhead at both ends of the SBI and in an increase of 1/3 of the
size of the encoded payload.
NOTE 1: The use of multipart messages primarily aims at avoiding the
processing overhead of encoding and decoding the binary payload into Base64
encoded string at both sides of the 5GC SBI. The size of the message is less a
concern for core network internal interfaces. Note that for small payloads
(e.g. \ QUIC connections are expected to commonly use 0-RTT handshakes, meaning that
> for most QUIC connections, data can be sent immediately following the client
> handshake packet, without waiting for a reply from the server.
**2\. Multiplexing without head-of-line blocking**
> QUIC ensures that lost packets carrying data for an individual stream only
> impact that specific stream.
**3\. Authenticated and encrypted header and payload**
> Generally, QUIC packets are always authenticated and the payload is
> typically fully encrypted.
**4\. Rich signalling for congestion control and loss recovery**
> QUIC's packet framing and acknowledgments carry rich information that helps
> both congestion control and loss recovery in fundamental ways.
**5\. Stream and connection flow control**
> QUIC implements stream- and connection-level flow control. A QUIC receiver
> advertises the maximum amount of data that it is willing to receive on each
> stream. And QUIC implements connection-level flow control to limit the
> aggregate buffer that a QUIC receiver is willing to allocate to all streams
> on a connection.
Some key issues to be studied are identified below:
a) As some of the HTTP/2 features are subsumed by QUIC, it needs to be studied
how these features work, e.g. Stream in both QUIC and HTTP/2, per-
stream/connection flow control in both QUIC and HTTP/2.
b) Several HTTP/2 frame type are not required in HTTP/2+QUIC, when an HTTP/2
defined frame is no longer used, the frame ID has been reserved in order to
maximize portability between HTTP/2 and HTTP/2+QUIC implementations as
described in IETF draft-ietf-quic-http-05 [20].
c) QUIC allocates error codes 0x0000-0x3FFF to application protocol
definition, HTTP/2 may need to adapt these error codes as described in IETF
draft-ietf-quic-http-05 [20].
d) QUIC/UDP will solve Head-Of-Line blocking issue of TCP; UDP path management
and load balancing under the same QUIC session shall be considered.
e) How to support the HTTP Proxy under QUIC.
f) End-to-end security is mandatory in QUIC, which could cause issues for
intermediaries.
g) How to negotiate the use of QUIC vs. TCP.
##### 6.2.2.6.3 Comparison of transport layer protocols
TCP protocol is widely used in a variety of network systems, especially based
on HTTP. Although the HTTP/2 protocol solves the HOL blocking problem from the
HTTP layer, but if the transport layer protocol is TCP, there may still be HOL
blocking problem at TCP level, in addition, the slow start and congestion
control mechanism of TCP protocol will bring some impediment to 5GC.
QUIC provides a good solution to the problems of transport layer and
application layer, including dealing with more connections, security, and low
latency. QUIC incorporates some of the features such as transport connections,
TLS, HTTP/2, but is based on UDP transport.
QUIC also provides multiplexing which solves the HOL blocking problem of TCP.
Because the work on QUIC specifications is still in progress in IETF, QUIC/UDP
cannot be considered within the 3GPP Rel-15 timeframe. Consequently, it is
recommended to adopt TCP as the transport layer protocol for Rel-15. QUIC/UDP
can be further studied for Rel-16.
#### 6.2.2.7 Interface Definition Language
##### 6.2.2.7.0 Introduction
An Interface Definition Language (IDL) is a specification language used to
describe data models, and interactions between distributed software
components.
Ideally, and IDL should have the following characteristics:
\- Formal: It has to be machined-parsed, so it allows automatic checking of
correctness and consistency
\- Abstract: It is not bound to specific realizations, in terms of data
modelling, or protocol mechanisms
\- Independent of programming language or developing environment
\- Independent of protocol or Inter-Process Communication mechanisms
\- Independent of the data serialization format
\- Provides definitions for frequently required data types
In 3GPP, one of the IDLs with a widest usage, traditionally, has been ASN.1;
however, for SBA, and specifically for web technology (RESTful APIs,
HTTP/JSON, etc.), there are other approaches with a wider adoption currently
in the industry.
A non-exhaustive list of alternatives could be:
\- Standards-based
\- ITU-T/ETSI: ASN.1
\- OASIS: RELAX-NG
\- W3C: WSDL / XML Schema
\- IETF: ABNF, YANG
\- Non-Standard (De-facto Industry standards)
\- OpenAPI Specification (Swagger)
\- JSON Schema
\- JSON Content Rules
\- JSON RPC
\- RAML
\- Protocol Buffers
\- Apache Thrift
In particular, for those protocols using a data serialization format such as
JSON or CBOR, there is a need to further describe the data that can be
transported in the protocol. IDLs typically are supported by tooling that
allows to verify if a JSON or CBOR file complies with an interface definition
written in the corresponding language, and possibly also to generate APIs and
related code in various programming languages to generate or parse conformant
JSON or CBOR files. Some of the IDL do not only contain information related to
JSON or CBOR bodies, but also related to the underlying transport protocols,
and thus allow for tooling with more extensive automation.
The IDL alternatives in the above list have been narrowed down to six
alternatives that best characteristics for SBA and specifically for Web
technology. An exhaustive and detailed analysis of each and every alternative
from the above list is not intended.
##### 6.2.2.7.1 Solution 1 -- YANG/RESTCONF
###### 6.2.2.7.1.1 Description
YANG is a data modelling language developed by IETF for the NETCONF protocol.
It was originally designed for Network Management, as a replacement for the
SNMP protocol (and the associated SMI information modelling framework).
It allows the definition of data models (both \"configuration\" data and
\"state\" data), and also specific interactions between network elements, in
the form of \"Event Notifications\" and \"Actions\" (associated to data
objects), and generic \"Remote Procedure Calls\" to be invoked in a network
entity.
YANG is defined in IETF RFC 6020 [44].
In addition, IETF RFC 8040 [48] defines an HTTP-based protocol (RESTCONF) to
access data, and invoke actions, defined in YANG following a REST approach,
with standard serialization options based on XML or JSON.
###### 6.2.2.7.1.2 Evaluation
The main characteristic of this alternative is its capability in terms of
abstract data modelling. It shows a higher level of decoupling between the
generic data model definition and the actual concrete implementation, in the
form of a specific protocol realization and a specific data serialization
format.
Additionally, a YANG data model can be used in a standard manner to describe a
RESTful type of interaction between client and server, and at the same time,
it can also describe RPC (Remote Procedure Call) interactions.
The main issue, from a 3GPP perspective, is that this language was not
originally conceived as a general-purpose modeling language and, instead, its
primary scope was the Network Management area. In addition, the learning curve
is higher than other simpler alternatives.
##### 6.2.2.7.2 Solution 2 -- OpenAPI Specification (Swagger)
###### 6.2.2.7.2.1 Description
OpenAPI (formerly known as Swagger) defines a standard, programming language-
agnostic, interface description for REST APIs. It is specified at:
\- https://github.com/OAI/OpenAPI-Specification
It consists on a language specification itself, and also on a number of tools
intended for specification, documentation and code generation for
implementation of client and server sides of the API, together with automation
of test cases.
The files describing the RESTful API in accordance with the Swagger
specification are represented as JSON objects and conform to the JSON
standards. YAML, being a superset of JSON, can be used as well to represent a
Swagger specification file.
For the definition of primitive data types, the specification is based on the
JSON Schema draft-4 (https://tools.ietf.org/html/draft-zyp-json-
schema-04#section-3.5).
The last version of OpenAPI Specification, recently approved (June 2017), is
version 3.0.0 [49], although the most stable version is 2.0, which has been in
production for several years now (since 2014). In version 3.0.0, certain new
features have been added, which are expected to be useful in the definition of
5GC interfaces (e.g., language support for adding HATEOAS content, and
language support for handling of multipart media types in HTTP bodies).
###### 6.2.2.7.2.2 Evaluation
The main characteristic of this alternative is its massive and widespread
adoption in the industry, for RESTful API design. It can be considered as a
de-facto standard (although not backed-up by a formal SDO), and it has the
biggest ecosystem of tools (both commercial an Open Source) and community
support.
The main criticism to Swagger 2.0 relied on its lack of support for
hypermedia, when the framework is mainly targeted for RESTful API
specification. This implies that attempting to fulfil the HATEOAS (Hypermedia
As The Engine Of Application State) principle, is not straightforward.
Sources:
\- http://blog.novatec-gmbh.de/the-problems-with-swagger/
\- https://jimmybogard.com/swagger-the-rest-kryptonite/
In addition, given it primary focus on the RESTful architectural style, its
support for RPC style of interactions is not so well supported, although there
are workarounds to overcome this issue.
##### 6.2.2.7.3 Solution 3 -- Protocol Buffers
###### 6.2.2.7.3.1 Description
Protocol Buffers is a mechanism, originally developed by Google and then
turned to Open Source, to serialize structured data. It defines its own
language (proto3, as the last version), to specify the structure of the data
(messages, parameters, data types, etc.) so, in that sense, it can be
considered as an IDL.
Protocol Buffers documentation can be found in:
\- https://developers.google.com/protocol-buffers/, and
\- https://github.com/google/protobuf/
The encoding of the data over-the-wire is binary and it is very compact and
efficient, at the expense of not being self-describing (that is, there is no
way to tell the names, meaning, or full datatypes of fields without an
external specification).
Protocol Buffers were originally conceived for usage with RPC-style of
interactions, internally at Google, and there is a specific protocol (gRPC)
designed for high-performance RPC interactions; nevertheless, they can also be
used to model RESTful APIs.
###### 6.2.2.7.3.2 Evaluation
The main characteristic of this alternative is its efficiency and higher
performance.
The main drawback is that the language is maintained and evolved by Google,
and it is bound to a number of tools (compilers, code generators, runtimes...)
also developed and maintained mainly by Google, so it is not a system fully
specified by an SDO. Therefore, this option is not considered further.
##### 6.2.2.7.4 Solution 4 -- JSON Content Rules
###### 6.2.2.7.4.1 Description
IETF draft-newton-json-content-rules [22] is used by 3GPP CT3 in several
specifications (3GPP TS 29.155 [41], 3GPP TS 29.250 [50], 3GPP TS 29.251
[40]). An expired version of this draft has been a de-facto standard in the
industry for several years. IETF work resumed a while ago with new versions of
the draft. The draft provides an IDL for JSON bodies in a relativey simple
format
###### 6.2.2.7.4.2 Evaluation
The main characteristic of this alternative is its simplicity. As the draft
has seen some usage in the industry for several years, tooling support is
available. However, the industry seems to have moved towards the more
powerfull OPenAPI Swagger.
##### 6.2.2.7.5 Solution 5 -- JSON Schema
###### 6.2.2.7.5.1 Description
IETF draft-wright-json-schema [51] and IETF draft-wright-json-schema-
validation [52] are not directly referenced in 3GPP specs, but are used by the
OpenAPI 3.0.0 Specification\" [49] (see below). The draft provides an IDL for
JSON bodies in a relatively simple format.
###### 6.2.2.7.5.2 Evaluation
The main characteristic of this alternative is its simplicity. As the draft
has seen some usage in the industry for several years, tooling support is
available. However, the industry seems to have moved towards the more powerful
OpenAPI Swagger.
##### 6.2.2.7.6 Solution 6 -- CBOR IDL
###### 6.2.2.7.6.1 Description
IETF draft-ietf-cbor-cddl [53] is not used by 3GPP so far. The draft provides
an IDL for CBOR bodies.
###### 6.2.2.7.6.2 Evaluation
For CBOR as serialization language, this draft is typically used as IDL. Only
limited tooling is currently available and the draft seems not yet widely
used.
##### 6.2.2.7.7 Comparison of IDLs
Table 6.2.2.7.7-1: Comparison of IDLs.
+----------+----------+----------+----------+----------+----------+ | | YANG | OpenAPI | IET | IETF | IETF dra | | | (see | 3.0.0 | F draft- | draft-w | ft-ietf- | | | IETF | Speci | newton-j | right-js | cbor-cdd | | | RFC 6020 | fication | son-cont | on-schem | l [53] | | | [44], | [49] | ent-rule | a [51] | | | | IETF | | s [22] | and | | | | RFC 6991 | | | IETF dr | | | | [45], | | | aft-wrig | | | | IETF | | | ht-json- | | | | RFC 7950 | | | schema-v | | | | [46], | | | alidatio | | | | IETF | | | n [52] | | | | RFC 7951 | | | | | | | [47], | | | | | | | and\ | | | | | | | IETF d | | | | | | | raft-iet | | | | | | | f-core-y | | | | | | | ang-cbor | | | | | | | [54]) | | | | | +----------+----------+----------+----------+----------+----------+ | S | JSON, | JSON, | JSON | JSON | CBOR | | upported | XML, | XML | | | | | MIME | CBOR | | | | | | Formats | | | | | | +----------+----------+----------+----------+----------+----------+ | S | Boolean\ | boolean | B | boolean | B | | upported | int8, | | oolean,\ | | oolean,\ | | P | int16, | Integer | i | Integer | int, | | rimitive | int32, | with | nteger,\ | with | uint. | | Data | int64, | optional | integer | optional | nint\ | | types | uint8, | int32 or | numbers | int32 or | float, | | | uint16, | int64 | in a | int64 | float16, | | | uint32, | format | range,\ | format | float32, | | | and | and/or | float,\ | and/or | float64\ | | | uint64, | range | double,\ | range | bytes\ | | | optional | | floating | | text\ | | | with | Number | point | Number | choices | | | range\ | with | numbers | with | (allows | | | de | optional | in a | optional | to | | | cimal64, | float or | range,\ | float or | describe | | | optional | double | s | double | enumer | | | with | format | trings,\ | format | ations), | | | range\ | and/or | URI | and/or | regular | | | string, | range\ | (op | range\ | exp | | | optional | string | tionally | string | ressions | | | with | with | i | with | | | | length | optional | ncluding | optional | | | | and/or | byte, | URI | byte, | | | | pattern\ | binary, | scheme)\ | binary, | | | | enum | date, | regular | date, | | | | eration\ | d | expre | d | | | | bits | ate-time | ssions,\ | ate-time | | | | | or | Fixed | or | | | | binary | password | string | password | | | | | format, | values | format, | | | | | | (e.g. | | | | | | enum | allowing | enum | | | | | | to | | | | | | | define | | | | | | | enum | | | | | | | erations | | | | | | | via | | | | | | | groups) | | | +----------+----------+----------+----------+----------+----------+ | De | yes | yes | yes, via | yes | yes | | finition | | | named | | | | of own | | | rules | | | | types | | | | | | | s | | | | | | | upported | | | | | | +----------+----------+----------+----------+----------+----------+ | I | yes | yes | yes | yes | no | | ncluding | | | | | | | external | | | | | | | def | | | | | | | initions | | | | | | | via URI | | | | | | | s | | | | | | | upported | | | | | | +----------+----------+----------+----------+----------+----------+ | Support | IETF RFC | E | no | no | no | | for | 8040 | xtensive | | | | | t | [48] | HTTP | | | | | ransport | defines | support | | | | | protocol | an | well | | | | | | HT | aligned | | | | | | TP-based | with | | | | | | protocol | Restful | | | | | | that | style:\ | | | | | | provides | Allows | | | | | | a | to | | | | | | RESTful | define | | | | | | prog | HTTP | | | | | | rammatic | methods | | | | | | i | ap | | | | | | nterface | plicable | | | | | | for | to data | | | | | | a | str | | | | | | ccessing | uctures, | | | | | | data | i | | | | | | defined | ncluding | | | | | | in YANG. | pa | | | | | | In | rameters | | | | | | a | and | | | | | | ddition, | response | | | | | | R | codes. | | | | | | PC-based | | | | | | | inte | | | | | | | ractions | | | | | | | are also | | | | | | | mapped | | | | | | | to | | | | | | | HTTP- | | | | | | | request/ | | | | | | | response | | | | | | | tran | | | | | | | sactions | | | | | | | in a | | | | | | | standard | | | | | | | way. | | | | | +----------+----------+----------+----------+----------+----------+ | S | RFCs | Webpage | In | In | WG IETF | | tability | | by | dividual | dividual | draft | | of | | OpenApi | IETF | IETF | | | r | | Specif | draft | draft | | | eference | | ication, | | | | | | | also | | | | | | | i | | | | | | | ncluding | | | | | | | r | | | | | | | eference | | | | | | | to | | | | | | | outdated | | | | | | | version | | | | | | | of two | | | | | | | in | | | | | | | dividual | | | | | | | IETF | | | | | | | drafts. | | | | | | | | | | | | | | However | | | | | | | widely | | | | | | | used in | | | | | | | the | | | | | | | Op | | | | | | | enSource | | | | | | | c | | | | | | | ommunity | | | | | | | and thus | | | | | | | re | | | | | | | latively | | | | | | | stable. | | | | +----------+----------+----------+----------+----------+----------+ | Avai | Tools | Tools | Some | Tools | Little | | lability | listed | a | tools | a | tooling | | of | at | vailable | a | vailable | at | | tooling |  | | | | | +----------+----------+----------+----------+----------+----------+ | Forward | It is | Yes;\ | Yes:\ | Yes;\ | Yes:\ | | compa | possible | By | Ad | By | \"S | | tibility | to | default, | ditional | default, | tructs\" | | | define | ad | pr | ad | can be | | | optional | ditional | operties | ditional | extended | | | elements | pr | within | pr | with | | | as part | operties | an | operties | a | | | of the | within | Object | within | rbitrary | | | data | an | are | an | key | | | def | Object | ignored | Object | value | | | inition, | are | | are | pairs if | | | via the | ignored, | | ignored, | a key | | | \"m | This can | | This can | value | | | andatory | be | | be | pair | | | = | co | | co | with | | | true | ntrolled | | ntrolled | wi | | | /false\" | via the | | via the | ldcarded | | | st | \"additi | | \"additi | de | | | atement. | onalProp | | onalProp | finition | | | | erties\" | | erties\" | is | | | | keyword. | | keyword. | included | | | | | | | in their | | | | | | | def | | | | | | | inition. | | | | | | | How the | | | | | | | receiver | | | | | | | would | | | | | | | handle | | | | | | | such | | | | | | | ex | | | | | | | tensions | | | | | | | is nor | | | | | | | directly | | | | | | | sp | | | | | | | ecified. | +----------+----------+----------+----------+----------+----------+ | Other | Or | De-facto | Simplest | Simple | Little | | aspects | iginally | industry | alt | | tooling | | | designed | standard | ernative | | av | | | for | (widest | co | | ailable. | | | Network | ac | nsidered | | | | | Man | ceptance | | | | | | agement, | in | | | | | | not as a | i | | | | | | general | ndustry, | | | | | | -purpose | at this | | | | | | fr | moment). | | | | | | amework. | | | | | | | | Simpler | | | | | | Steeper | to use | | | | | | learning | than | | | | | | curve | other | | | | | | compared | more | | | | | | with | formal | | | | | | other | alter | | | | | | simpler | natives. | | | | | | app | | | | | | | roaches. | Powerful | | | | | | | enough | | | | | | | to | | | | | | | address | | | | | | | expected | | | | | | | needs in | | | | | | | 3GPP | | | | | | | specifi | | | | | | | cations. | | | | +----------+----------+----------+----------+----------+----------+
##### 6.2.2.7.8 Conclusion
Given the widest industry acceptance for design of RESTful APIs, and the
availability of a big ecosystem of tools and community support, it is
recommended to use OpenAPI Specification, version 3.0.0 [49], as the IDL for
usage in 5GC.
It is recommended that the definition of each interface is done by including a
normative annex, containing the OpenAPI specification file, in each Technical
Specification in 5GC, similar to how it has been done is previous TS\'s in
3GPP (e.g. ASN.1 in 3GPP TS 29.002 [55], XML Schema in 3GPP TS 29.328 [56],
Swagger in 3GPP TS 29.116 [39], etc.).
It is also expected that the API/protocol specification will include not only
a formal OpenAPI specification file, but also textual and/or tabular format in
the main body of the specification describing application-level detailed
description handling of parameters (Information Elements) and their mapping to
actual protocol structures.
#### 6.2.2.8 Comparison of candidate solutions
Table 6.2.2.4-1 provides a comparison of different candidate solutions based
on the requirements and additional evaluation criteria in subclauses 6.2.1.4
and 6.2.1.5 respectively. The colours of the cells provide an evaluation how
well the criteria are met (Dark green: Criterion well met. Light green:
Criterion mostly met. White: Criterion partially met or no substantial
differences between candidate protocols. Orange: Criterion not met.)
Table 6.2.2.4 -1: Comparison of candidate solutions.
+----------------+----------------+----------------+----------------+ | Requirement/ | TCP/ | UDP/Q | SCTP/Diameter | | Evaluation | TLS/HTTP2/JSON | UIC/HTTP2/JSON | | | Criterion | | | (see | | | (see | (see | IETF RF | | | IETF R | IETF RFC 768 | C 4960 [23], | | | FC 793 [13], | [17],\ | 3GPP TS | | | IETF RF | IETF draft- | 33.210 [24] | | | C 5246 [14], | ietf-quic-tran | and | | | IETF RF | sport [18],\ | IETF RF | | | C 7540 [15], | IETF | C 6733 [25]) | | | IETF R | draft-ietf-qui | | | | FC 7159 [16] | c-tls [19],\ | | | | and | IETF d | | | | IE | raft-ietf-quic | | | | TF draft-newto | -http [20],\ | | | | n-json-content | IETF draf | | | | -rules [22]) | t-ietf-quic-re | | | | | covery [21], | | | | | IETF RF | | | | | C 5246 [14], | | | | | IETF RF | | | | | C 7540 [15], | | | | | IETF R | | | | | FC 7159 [16] | | | | | and | | | | | IE | | | | | TF draft-newto | | | | | n-json-content | | | | | -rules [22]) | | +----------------+----------------+----------------+----------------+ | R1. Support of | Service | Service | Diameter | | bidirectional | communication | communication | support | | communication | is | is | Request-Answer | | | u | u | command pairs | | | nidirectional, | nidirectional, | in both | | | i.e. fully | i.e. fully | directions. | | | bidirectional | bidirectional | | | | communication | communication | | | | requires 2 | requires 2 | | | | client-server | client-server | | | | pairs - 1 per | pairs - 1 per | | | | direction. | direction. | | +----------------+----------------+----------------+----------------+ | R2. Support of | TCP supports | QUIC supports | SCTP supports | | reliable | packet | packet | packet | | communication | retransmission | retransmission | retransmission | | | for a reliable | for a reliable | and failover | | | communication. | communication. | to alternate | | | | | paths for a | | | Failover to | Failover to | reliable | | | alternate | alternate | communication. | | | paths can be | paths can be | | | | supported by | supported by | | | | setting up | using | | | | additional TCP | additional | | | | connections. | QUIC | | | | | connections. | | +----------------+----------------+----------------+----------------+ | R3. Forward | HTTP and JSON | HTTP and JSON | Diameter | | compatibility | payload | payload | allows to | | and ease of | support | support | control | | upgrade | versioning of | versioning of | whether | | | service. New | service. New | unknown AVPs | | | IEs added to | IEs added to | will be | | | JSON schema | JSON schema | ignored. 3GPP | | | will be | will be | defined | | | ignored. 3GPP | ignored. 3GPP | supported | | | defined | defined | feature | | | supported | supported | mechanism is | | | feature | feature | well | | | mechanism has | mechanism has | understood and | | | already been | already been | has been | | | added also to | added also to | proven to work | | | some HTTP/JSON | some HTTP/JSON | well. | | | interfaces. | interfaces. | | +----------------+----------------+----------------+----------------+ | R4. Low | Radical | UDP based | Performance | | Response Time | throughput | transport | proven to be | | | reduction by | avoids head | appropriate | | | TCP in | of-line | for EPC. | | | overload and | blocking. QUIC | | | | TCP | support | See also A1. | | | head-of-line | multiple | | | | blocking are | streams. | | | | potential | | | | | issues. | See also A1. | | | | | | | | | See also A1. | Avoiding head | | | | | of line | | | | TCP is known | blocking also | | | | to work also | offers | | | | in network | benefits when | | | | conditions | large jitter | | | | with long | and round trip | | | | round-trip | times are | | | | times and | encountered. | | | | adjust the | | | | | retransmission | | | | | timer | | | | | accordingly. | | | +----------------+----------------+----------------+----------------+ | R5. | Potentially | UDP based | SCTP | | Scalability | limited by | | associations | | | high number of | QUIC scales to | between | | | TCP | very high | Diameter peers | | | connections, | number of | can be used | | | but HTTP2 | transport | for many | | | streams allows | connections | Diameter | | | a reuse of TCP | (64-bit | sessions. | | | connections | identifier) | | | | between | | (3GPP extended | | | service | | Diameter Agent | | | instances. | | for UE context | | | | | discovery may | | | | | impact | | | | | scalability, | | | | | but this is | | | | | considered an | | | | | architectural | | | | | issue as | | | | | similar | | | | | solutions | | | | | would be | | | | | required | | | | | should other | | | | | protocols be | | | | | selected) | +----------------+----------------+----------------+----------------+ | R6. Ease and | If client | If client | How well | | speed of | authentication | authentication | secondary SCTP | | deployment of | requires | requires | paths can be | | network | static | static | supported in | | functions and | configuration | configuration | dynamic manner | | services | is ffs. | is ffs. | (e.g. via DNS) | | | Otherwise | Otherwise | is ffs. Should | | | dynamic | dynamic | static | | | endpoint | endpoint | configuration | | | discovery and | discovery and | be required, | | | connection | connection | Diameter | | | establishment | establishment | Agents can | | | is supported. | is supported. | help. | +----------------+----------------+----------------+----------------+ | R7. Time of | Already | Planned | Already | | Availability | available. | completion in | available. | | of used | | November 2018 | | | standards | | (according to | | | | | IETF QUIC | | | | | working group | | | | | milestones) | | +----------------+----------------+----------------+----------------+ | A1. | Text encoding | Text encoding | Binary | | Resou | of HTTP and | of HTTP and | encoding at | | rce-efficiency | JSON brings | JSON brings | the | | | small | small | application | | | processing | processing | layer, but | | | overhead and | overhead and | message size | | | increases | increases | increase due | | | message size. | message size. | to AVP header | | | | | overhead. | | | (But only a | (But only a | | | | small number | small number | | | | of HTTP | of HTTP | | | | headers will | headers will | | | | be needed and | be needed and | | | | HTTP2 provides | HTTP2 provides | | | | header | header | | | | compression. | compression. | | | | HTTP2 also | HTTP2 also | | | | supports | supports | | | | binary | binary | | | | encoding at | encoding at | | | | the HTTP | the HTTP | | | | layer, | layer, | | | | application | application | | | | still provides | still provides | | | | a text encoded | a text encoded | | | | payload) | payload) | | +----------------+----------------+----------------+----------------+ | A2. | Many libraries | Many libraries | Diameter is | | Reusability of | to choose from | to choose from | widely used in | | existing 3GPP | for HTTP/JSON | for HTTP/JSON | EPC | | i | layer. But | layer, but | | | mplementations | existing | QUIC support | (roaming and | | | application | not yet so | non-roaming | | | code based on | widespread. | interfaces | | | Diameter will | Existing | | | | require large | application | | | | adaptations. | code based on | | | | Also, need to | Diameter will | | | | implement HTTP | require large | | | | equivalent of | adaptations. | | | | Diameter Agent | Also, need to | | | | with 3GPP | implement HTTP | | | | extensions. | equivalent of | | | | | Diameter Agent | | | | | with 3GPP | | | | | extensions. | | +----------------+----------------+----------------+----------------+ | A3. Minimize | Already some | No | Already | | number of | limited usage | standardised | widespread | | protocols in | within | usage of QUIC | usage in and | | network | operators´ | within | between | | | networks and | operators´ | operator´s | | | for external | networks up to | networks. | | | interfaces at | now. | | | | the SCEF (with | | Diameter not | | | earlier HTTP | However | supported on | | | versions). | already some | external | | | HTTP/JSON | limited usage | interfaces. | | | could be used | of HTTP/JSON | | | | both for | (with earlier | | | | external and | HTTP versions) | | | | internal | within | | | | interfaces. | operators´ | | | | | networks and | | | | Legacy | for external | | | | interfaces in | interfaces at | | | | EPC use | the SCEF. | | | | different | HTTP/JSON | | | | protocols. | could be used | | | | | both for | | | | | external and | | | | | internal | | | | | interfaces. | | +----------------+----------------+----------------+----------------+ | A4. | HTTP/2: | HTTP/2: | Congestion | | Congestion, | multiple | multiple | control | | load and | streams, each | streams, each | supported by | | overload | with priority | with priority | SCTP | | control | (weight) and | (weight) and | | | | dependency (on | dependency (on | App | | | another | another | lication-Level | | | streams) | streams) | Load/Overload | | | | | Control | | | Mechanisms | Mechanisms | supported by | | | documented in | documented in | Diameter. | | | subclause | subclause | | | | 6.2.2.2.1.7 | 6.2.2.2.1.7 | | | | can be used to | can be used to | | | | fully support | fully support | | | | Load/Overload | Load/Overload | | | | Control. TCP | Control. QUIC | | | | provides | provides a | | | | end-to-end | mechanism for | | | | congestion | loss detection | | | | control, but | and overload | | | | with radical | control, but | | | | throughput | performance is | | | | reduction. | ffs. | | +----------------+----------------+----------------+----------------+ | A5. Support of | TLS for | TLS for | IPsec for | | Security | transport | transport | transport | | | level. | level. | level (see | | | | | 3GPP TS 3 | | | Support for | Support for | 3.210 [24]). | | | app | app | | | | lication-level | lication-level | | | | authentication | authentication | | | | and | and | | | | authorization | authorization | | | | via HTTP | via HTTP | | | | header. | header. | | +----------------+----------------+----------------+----------------+ | A6. Ease of | Many tools | Many tools | Operators | | t | exist to | exist to | likely already | | roubleshooting | trace/monitor | trace/monitor | have tools for | | and Monitoring | HTTP REST APIs | HTTP REST | Diameter. | | | | APIs, but no | | | | Distributed | widespread | Centralized | | | logging. | support for | logging by | | | | QUIC so far. | Diameter Agent | | | If TLS | | or Distributed | | | end-to-end | Distributed | logging. | | | encryption is | logging. | | | | used, this | | Binary | | | renders | QUIC requires | decoding | | | centralized | end-to-end | required for | | | logging at | encryption | tr | | | intermediates | that would | oubleshooting. | | | impossible. | render | | | | | centralized | A Diameter | | | An HTTP | logging at | answer follows | | | response | intermediates | the same path | | | follows the | impossible. | as its | | | same path as | | command. | | | its request as | An HTTP | | | | it is sent on | response | | | | the same TCP | follows the | | | | connection. | same path as | | | | | its request as | | | | | it is sent on | | | | | the same QUIC | | | | | connection. | | +----------------+----------------+----------------+----------------+ | A7. Ease of | Largest user | Large user | Mainly 3GPP | | use of 3GPP | community for | community for | user | | services from | Web services. | HTTP/JSON Web | community, but | | operator owned | Already | services, but | already | | application | supported by | limited | supported by | | functions | some operator | experience for | some operator | | | owned | QUIC. | owned | | | application | | application | | | functions | | functions. | | | (with earlier | | (P-CSCF acting | | | HTTP versions) | | as AF. GCS AS, | | | | | SCS) | +----------------+----------------+----------------+----------------+ | A8. Support of | Supported by | Supported by | Supported by | | failover | HTTP error | HTTP error | error codes | | | codes and HTTP | codes and HTTP | and Diameter | | | proxies. | proxies. | Agent. | +----------------+----------------+----------------+----------------+ | A9. Support of | Supported, | Supported, | Supported by | | network entity | whether new | whether new | Diameter Agent | | selection | HTTP proxy | HTTP proxy | with existing | | based on UE | extensions are | extensions are | 3GPP | | context | required is | required is | extensions. | | information | FFS. | FFS. | | +----------------+----------------+----------------+----------------+ | A10. Ease of | Need to | Need to | Need to | | traversal of | configure | configure | configure | | carrier-grade | operator-grade | operator-grade | operator-grade | | AL | firewalls to | firewalls to | firewalls to | | G/NAT/firewall | pass | pass UDP/QUIC. | pass IPSec, | | | TCP/TLS/HTTP. | For | but security | | | For | bidirectional | gateways | | | bidirectional | communication, | reduce the | | | communication, | configuration | number of | | | configuration | for two | required | | | for two | connections | connections | | | connections | may be | (see | | | may be | required, but | 3GPP TS 3 | | | required, but | security | 3.210 [24]). | | | security | gateways can | | | | gateways can | reduce the | | | | reduce the | number of | | | | number of | required | | | | required | connections | | | | connections | (see | | | | (see | 3GPP TS 3 | | | | 3GPP TS 3 | 3.210 [24]). | | | | 3.210 [24]). | | | +----------------+----------------+----------------+----------------+ | A11. Impacts | No HTTP | No HTTP/QUIC | Existing | | to GSMA | support so | support so | Diameter | | GRX/IPX | far. (e.g. | far. (e.g. | support. | | | GSMA uses | GSMA uses | | | | home-routed | home-routed | | | | APN for | APN for | | | | HTTP-based Ut | HTTP-based Ut | | | | interface). | interface). | | +----------------+----------------+----------------+----------------+ | A12. Open and | yes | yes | yes | | public | | | | | Source/S | | | | | tandardization | | | | | body | | | | +----------------+----------------+----------------+----------------+ | A13. Protocol | HTTP is a | HTTP is a | Diameter | | enables | stateless | stateless | supports | | stateless | protocol where | protocol where | stateless | | operation | each | each | operations | | | re | re | with the | | | quest-response | quest-response | concept of | | | message pair | message pair | implicit | | | is | is | session | | | independent. | independent. | termination. | | | | | An implicitly | | | | | terminated | | | | | session is one | | | | | for which the | | | | | server does | | | | | not maintain | | | | | state | | | | | information. | +----------------+----------------+----------------+----------------+ | A14. Routing | HTTP requests | HTTP requests | Diameter | | support and | are routed | are routed | supports both | | related | based on the | based on the | routeing based | | mechanisms | request URI. | request URI. | on realm and | | | The request | The request | service and | | | URI can point | URI can point | routeing based | | | e.g. to a host | e.g. to a host | on a Diameter | | | or a resource | or a resource | host Id. | | | (only the | (only the | | | | later applies | later applies | Diameter | | | for RESTful | for RESTful | supports the | | | protocol | protocol | use of proxies | | | design). | design). | (DA) in the | | | | | path. | | | HTTP supports | HTTP supports | | | | the use of | the use of | | | | proxies in the | proxies in the | | | | path. | path. | | +----------------+----------------+----------------+----------------+ | A15. Error | Many HTTP | Many HTTP | Many Diameter | | detection and | error codes | error codes | error codes | | error | are defined | are defined | are defined | | reporting | and own error | and own error | and own error | | capabilities | codes can be | codes can be | codes can be | | | defined as | defined as | defined as | | | extensions by | extensions by | extensions by | | | 3GPP (IANA | 3GPP (IANA | 3GPP. | | | registration | registration | | | | requires | requires | Well defined | | | expert review) | expert review) | unambiguous | | | | | transported | | | Well defined | Well defined | data enable an | | | unambiguous | unambiguous | unambiguous | | | transported | transported | interpretation | | | data enable an | data enable an | of transported | | | unambiguous | unambiguous | data (see A17) | | | interpretation | interpretation | | | | of transported | of transported | | | | data (see A17) | data (see A17) | | +----------------+----------------+----------------+----------------+ | A16. Sessions | HTTP/2 | QUIC/HTTP2 | Diameter | | multiplexing | supports | supports | supports reuse | | over a single | multiplexing | multiplexing | of SCTP | | transport | multiple | of multiple | connections | | connection | parallel | parallel | for multiple | | | requests in | requests in | Diameter | | | separate | separate | sessions. | | | streams in a | streams in a | | | | non-blocking | non-blocking | SCTP supports | | | fashion (at | fashion over | ordered and | | | HTTP level) | the same UDP | unordered | | | over the same | connection. | delivery of | | | TCP | | data. | | | connection. | HTTP/2 streams | Head-of-line | | | | are mapped one | blocking may | | | TCP provides | to one into | occur within | | | order-o | QUIC streams | an STCP stream | | | f-transmission | and an HTTP | using ordered | | | delivery of | re | data delivery | | | data, which | quest/response | if SCTP | | | can result in | consumes a | segments get | | | HOL blocking | pair of | lost. HOL | | | within a TCP | streams | blocking may | | | connection if | ensuring a | be mitigated | | | TCP segments | reliable and | if both | | | get lost. | in order | Diameter peers | | | | delivery of | support a | | | | re | large number | | | | quest/response | of streams. | | | | without HOL | | | | | blocking | | | | | issue. | | +----------------+----------------+----------------+----------------+ | A17. | IETF R | IETF R | Diameter AVPs | | Well-defined | FC 7159 [16] | FC 7159 [16] | allow an | | s**chema and** | and | and | encoding that | | unambiguous | IE | IE | enables the | | interpretation | TF draft-newto | TF draft-newto | unambiguous | | of transported | n-json-content | n-json-content | interpretation | | data | -rules [22]) | -rules [22]) | of transported | | | provide the | provide the | data. | | | framework of | framework of | | | | schema that | schema that | | | | enable the | enable the | | | | unambiguous | unambiguous | | | | interpretation | interpretation | | | | of transported | of transported | | | | data, | data, | | +----------------+----------------+----------------+----------------+ | A18. Support | Mechanisms | Mechanisms | Existing | | of a message | documented in | documented in | Diameter | | priority | subclause | subclause | support (RFC | | mechanism | 6.2.2.2.1.8 | 6.2.2.2.1.8 | 7944) | | | can be used to | can be used to | | | | fully support | fully support | | | | message | message | | | | priority | priority | | +----------------+----------------+----------------+----------------+
## 6.3 Void
## 6.4 Session Management Function Procedures and Services
### 6.4.1 Requirements
#### 6.4.1.1 General
This subclause provides an overview of the stage 2 requirements and procedures
for Session Management specified in subclause 5.6 of 3GPP TS 23.501 [2] and
subclause 4.3 of 3GPP TS 23.502 [3]. Refer to these stage 2 references for a
comprehensive description of the requirements.
The SMF offers services to the AMF, other SMF (V-SMF or H-SMF), PCF and NEF
via the Nsmf service based interface.
The NAS Session Management procedures are addressed by CT1.
The services offered by the SMF to the PCF are addressed by CT3.
#### 6.4.1.2 Key Principles
##### 6.4.1.2.1 PDU Connectivity Service
The 5GC supports a PDU Connectivity Service that provides exchange of PDUs
between a UE and a data network identified by a DNN. The PDU Connectivity
Service is supported via PDU sessions that are established upon request from
the UE, and that can be modified and/or released by the UE and the 5GC.
Each PDU session is characterized by:
\- a PDU Session Id;
\- one PDU session type: IPv4, IPv6, Ethernet, Unstructured (type of PDU
totally transparent to the 5GS);
\- Slicing information.
\- one DNN (Data Network Name);
\- one SSC mode (Session and Service Continuity mode).
A PDU session is routed over only a single access network but may be moved
between 3GPP and non-3GPP accesses.
An UE may establish multiple PDU sessions, to the same data network or to
different data networks, via 3GPP and via and Non-3GPP access networks at the
same time.
An UE may establish multiple PDU sessions to the same Data Network and served
by different UPF terminating N6.
A UE with multiple established PDU sessions may be served by different SMF.
The UP connection of different PDU sessions of a UE can be activated (via UE
or network triggered service request procedures) or deactivated independently.
The activation or deactivation of the UP connection of an existing PDU session
causes the UE-CN User Plane connection (i.e. data radio bearer and N3 tunnel)
for the PDU session to be activated or deactivated respectively.
##### 6.4.1.2.2 Roaming scenarios
The following roaming scenarios are supported:
\- Local Breakout (LBO), where the SMF and all UPF(s) involved by the PDU
Session are in the VPLMN;
\- Home Routed (HR), where the PDU session is supported by a SMF and at least
one UPF in the HPLMN and by a SMF and at least one UPF in the VPLMN.
##### 6.4.1.2.3 Single PDU session with multiple PDU session anchors
In order to support traffic offloading or to support SSC mode 3 (see subclause
6.4.1.2.4), a PDU session may have multiple N6 interfaces (to the same DN).
The UPF that terminates each of these interfaces is said to support a PDU
session anchor functionality.
This may correspond to:
\- the Usage of an UL Classifier functionality for an IPv4, IPv6 or Ethernet
PDU session. An UL Classifier is a functionality supported by a UPF to divert
locally some traffic matching traffic filters provided by the SMF (e.g. based
on the destination IP address/Prefix of the UL PDU), whose insertion/removal
is decided and controlled by the SMF during or after the PDU session
establishment; the UE is unaware of the insertion of an UL CL in the data path
of a PDU session; the UL CL provides forwarding of UL traffic towards
different PDU session anchors and merge of DL traffic from the different PDU
session anchors to the UE.
Figure 6.4.1.2.3-1 User plane Architecture for the Uplink Classifier
\- the Usage of an IPv6 multi-homing for an IPv6 PDU session. A PDU session
may be associated with multiple IPv6 prefixes (referred to as a \"multi-homed
PDU session\"). The different user plane paths leading to the IP anchors
branch out at a \"common\" UPF referred to as a UPF supporting \"Branching
Point\" functionality. The Branching Point provides forwarding of UL traffic
towards the different IP anchors (based on the source Prefix of the PDU) and
merge of DL traffic to the UE i.e. merging the traffic from the different IPv6
anchors on the link towards the UE. Insertion/removal of a Branching Point is
decided by the SMF during or after the PDU session establishment.
Figure 6.4.1.2.3-2: Multi-homed PDU Session: local access to a DN
##### 6.4.1.2.4 Session and Service Continuity
The following SSC modes are defined:
\- SSC Mode 1: the PDU session anchor at the establishment of the PDU session
is maintained during the lifetime of the PDU session; for IP PDU sessions, the
IP address is preserved;
\- SSC Mode 2 (\"break before make\"): the network may trigger the release of
the PDU Session and instruct the UE to establish a new PDU session to the same
data network immediately. At establishment of the new PDU Session, a new UPF
acting as PDU session anchor can be selected;
\- SSC Mode 3 (\"make before break\"): the network allows the establishment of
UE connectivity via a new PDU session anchor to the same data network before
connectivity between the UE and the previous PDU session anchor is released;
for IP PDU sessions, the IP address is not preserved during the relocation of
the PDU session anchor.
Each mode may apply to any PDU session type and any access type. The UE may be
provisioned with SSC mode selection policy. The user subscription also
includes the list of allowed SSC modes and the default SSC mode per DNN.
##### 6.4.1.2.5 QoS model
The QoS flow is the finest granularity of QoS differentiation in the PDU
session. The 5G QoS model supports QoS flows that require guaranteed flow bit
rate and QoS flows that do not require guaranteed flow bit rate.
A QoS Flow ID (QFI) is used to identify a QoS flow in the 5GS. User Plane
traffic with the same QFI value within a PDU session receives the same traffic
forwarding treatment. The QFI is carried in an encapsulation header on N3 i.e.
without any changes to the e2e packet header. The QFI shall be unique within a
PDU session.
Each QoS flow (GBR and Non-GBR) is associated with the following QoS
parameters:
\- 5G QoS Indicator (5QI),
\- Allocation and Retention Priority (ARP).
Each GBR QoS flow is in addition associated with the following QoS parameters:
\- Guaranteed Flow Bit Rate (GFBR) - UL and DL;
\- Maximum Flow Bit Rate (MFBR) - UL and DL;
\- Notification control, indicating whether notification should be made by the
RAN to the SMF if the QoS targets cannot be fulfilled for a QoS flow during
the lifetime of the QoS flow.
The 5QI is a scalar that is used as a reference to 5G QoS characteristics (GBR
or Non-GBR, Priority Level, Packet Delay Budget, Packet Error Rate), i.e.
access node-specific parameters that control QoS forwarding treatment for the
QoS flow (e.g. scheduling weights, admission thresholds, queue management
thresholds, link layer protocol configuration, etc.).
Each PDU Session of a UE is associated with the following aggregate rate limit
QoS parameter:
\- per Session Aggregate Maximum Bit Rate (Session-AMBR).
Each UE is associated with the following aggregate rate limit QoS parameter:
\- per UE Aggregate Maximum Bit Rate (UE-AMBR).
The 5G QoS model also supports reflective QoS (see subclause 5.7.5 of 3GPP TS
23.501 [2]).
NOTE: It is FFS whether all of the above QoS model description is applicable
to a Non-3GPP access, e.g. GBR flows.
##### 6.4.1.2.6 DN Access Identifier (DNAI)
The DNAI is defined as, for a DNN, an Identifier of a user plane access to the
DN (see 3GPP TS 23.501 [2], clauses 3 and 5.6.7):
\- A DN may have a local access identified by a DNAI. Routing decisions may
result in the SMF selecting or reselecting to a UPF that supports local access
identified by a DNAI;
\- An Application Function (AF) may send requests to influence SMF routing
decisions and selection of a DNAI for a PDU session. The DNAI may correspond
to the location of an application;
\- When a DNAI serving the UE is changed by the SMF, an AF may be informed
based on AF subscription to event notifications;
\- The SMF is responsible to handle the mapping between the UE location (TAI /
Cell-Id) and DNAI(s) associated with UPF and applications.
##### 6.4.1.2.7 Local Area Data Network (LADN)
The 5G Network provides support for a UE to be made aware of and connect to a
LADN. In Registration Accept messages, the AMF supplies the UE with LADN
availability information consisting of LADN DNN and LADN service areas (see
3GPP TS 23.501 [2] sub-clause 5.6.5). The LADN service area, which consists of
a set of Tracking Areas is the region where the LADN is available to the UE.
When the UE resides within the area permitted for an LADN, it may request PDU
session establishment to the LADN. The network validates that the UE is
located within the LADN availability area before setting up a PDU Session.
When a UE with a LADN PDU session moves outside of the LADN availability area,
it may according to operator policy either disconnect the PDU session, or
release the user plane resources for the PDU session but maintain the PDU
session.
#### 6.4.1.3 Session management procedures involving the SMF
##### 6.4.1.3.1 Stage 2 procedures
The following stage 2 procedures shall be supported (see subclause 4.3 of 3GPP
TS 23.502 [3]):
\- PDU Session establishment, including:
\- Non-roaming and Roaming with LBO;
\- HR Roaming;
\- PDU session establishment with DN authentication/authorization
\- PDU Session modification;
\- PDU Session release
\- Session continuity, service continuity and UP path management, including:
\- PDU session anchor relocation for SSC mode 2;
\- PDU session anchor relocation for SSC mode 3 with multiple PDU sessions;
\- Change of PDU session anchor for SSC mode 3 with IPv6 Multi homed PDU
session;
\- Addition of PDU session Anchor and Branching Point or UL CL for a PDU
session;
\- Removal of PDU session Anchor and Branching Point or UL CL for a PDU
session;
\- Relocation of UL CL for a PDU session
\- CN-initiated deactivation of UP connection of an existing PDU session
\- Service Request procedure, including:
\- UE triggered Service Request in CM-IDLE state;
\- UE triggered Service Request in CM-CONNECTED state;
\- Network triggered Service Request;
\- Handover procedures, including:
\- Xn based inter NG RAN handover, with or without UPF relocation;
\- Inter NG RAN handover without Xn interface;
\- Handover of a PDU session between 3GPP and untrusted non-3GPP access.
NOTE: Handover procedures between 5GS and EPS are studied in clause 8.
\- RAN Initiated QoS Flow Mobility
##### 6.4.1.3.2 Interactions between the AMF and SMF
###### 6.4.1.3.2.1 General
Subclause 5.6.2 of 3GPP TS 23.501 [2] describes the principles of the
interactions taking place between the AMF and SMF.
###### 6.4.1.3.2.2 During a PDU Session Establishment
The SMF shall provide the means to create a new PDU session in the 5GS.
According to 3GPP TS 23.502 [3] subclause 4.3.2.2.1:
\- at step 3, the AMF determines that the message corresponds to a request for
a new PDU session and sends an Nsmf_PDUSession_CreateSMContext Request (SUPI,
DNN, S-NSSAI, PDU Session ID, AMF ID, N1 SM information [PDU Session
Establishment Request], ULI, Access Technology Type, PEI) to the SMF. The SMF
establishes the PDU session.
\- at step 10, the SMF sends an Nsmf_PDUSession_CreateSMContext Response
(Cause, N2 SM information [PDU Session ID, QoS Profile(s), CN Tunnel Info,
S-NSSAI], N1 SM information [PDU Session Establishment Accept]. The SM
Response further contains PDU Session ID and information allowing the AMF to
know the target UE and target access towards the UE to use.
\- at step 14, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (N2 SM
information).
\- at step 16, the SMF sends an Nsmf_PDUSession_UpdateSMContext Response
(Cause). After this step, the AMF forwards relevant events to the SMF, e.g. UE
mobility events.
Upon successful PDU session establishment, the AMF stores the association
between the UE\'s PDU session and the SMF ID.
###### 6.4.1.3.2.3 During a PDU Session Modification
According to 3GPP TS 23.502 [3] subclause 4.3.3.2:
\- at step 1a, for a UE initiated PDU session modification procedure, the AMF
sends an Nsmf_PDUSession_UpdateSMContext Request (N1 SM information [PDU
Session Modification Request], PDU Session ID) to the SMF.
\- at step 1e, if the (R)AN notifies that the Qos targets of a GBR flow cannot
be fulfilled, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (N2 SM
Information) to the SMF.
\- at step 3a, the SMF sends an Nsmf_PDUSession_UpdateSMContext Response (N2
SM information [PDU Session ID, QoS Profile, Session-AMBR], N1 SM container
[PDU Session Modification Command]) to the AMF.
\- at step 3b, for network initiated modification, the SMF invokes
Namf_Communication_N1N2MessageTransfer (see subclause 6.5).
\- at step 7, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (N1 SM
Container [PDU Session Modification Command Ack], N2 SM Information) and SMF
returns a corresponding Response message to the AMF.
###### 6.4.1.3.2.4 During a PDU Session Release
The SMF indicates to the AMF when a PDU session has been released. Upon a PDU
session release, the AMF deletes the association between the UE\'s PDU session
and the SMF ID.
According to 3GPP TS 23.502 [3] subclause 4.3.4.2:
\- at step 1a, for a UE initiated PDU session release procedure, the AMF sends
an Nsmf_PDUSession_UpdateSMContext Request (N1 SM information [PDU Session
Release Request]) to the SMF.
\- at step 3a, the SMF sends an Nsmf_PDUSession_UpdateSMContext Response (N2
SM Resource Release request, N1 SM Information [PDU Session Release Command])
to the AMF.
\- at step 3b, for PDU session release initiated by the SMF, the SMF invokes
Namf_Communication_N1N2MessageTransfer (see subclause 6.5).
\- at step 7, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (N1 SM
Information [PDU Session Release Ack], N2 SM information [SM Resource Release
Ack]) to the SMF. This makes use of the Namf_N1N2Message_Notify service
operation (see subclause 5.2.2.3.1 of 3GPP TS 23.502 [3]).
\- at step 8, the SMF responds to the AMF that the PDU session is released
with an Nsmf_PDUSession_UpdateSMContext Response.
###### 6.4.1.3.2.5 During a Xn based inter NG RAN handover
According to 3GPP TS 23.502 [3] subclause 4.9.1.2.2:
\- at step 2, the AMF sends a Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID, User Location Information set to the target RAN Identifier), to
each SMF associated with the list of PDU sessions received in the N2 Path
Switch Request.
\- at step 7, the SMF sends a Nsmf_PDUSession_UpdateSMContext Response (CN
Tunnel Information) for the PDU sessions which have been switched
successfully.
###### 6.4.1.3.2.6 During an Inter NG RAN N2 based handover
According to 3GPP TS 23.502 [3] subclause 4.9.1.3.2 (preparation phase):
\- at step 4, the AMF sends a _Nsmf_PDUSession_UpdateSMContext Request_ (PDU
Session ID, Target ID) for each PDU session to be handed over.
\- at step 7, the SMF returns a _Nsmf_PDUSession_UpdateSMContext Response_
(PDU Session ID, N2 SM information [PDU Session ID, N3 Tunnel info of UPF,
QoS]).
\- at step 11, the AMF may send a Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID, Cause) to the SMF.
\- at step 12a, the AMF sends a Nsmf_PDUSession_UpdateSMContext _Request_ (PDU
Session ID, N2 SM response, Target RAN N3 SM forwarding information list) for
PDU sessions without active UP connections.
\- at step 12f, the AMF sends a Nsmf_PDUSession_UpdateSMContext Response (PDU
Session ID, N2 SM information containing the DL forwarding tunnel information
to be sent to the S-RAN) for PDU sessions being handed over.
According to 3GPP TS 23.502 [3] subclause 4.9.1.3.3 (execution phase):
\- at step 7, the AMF sends a Nsmf_PDUSession_UpdateSMContext Request
(Handover Complete indication for PDU Session ID). SMF switches downlink user
plane to the target RAN.
\- at step 11, the SMF returns Nsmf_PDUSession_UpdateSMContext response (PDU
session ID).
###### 6.4.1.3.2.7 During a UE triggered Service Request in CM-IDLE state
According to 3GPP TS 23.502 [3] subclause 4.2.3.2:
\- at step 4, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID(s), Cause(s), ULI) to the SMF in the following scenarios:
\- if the user plane connection of a PDU session needs to be activated, in
which case the Cause is set to indicate \"establishment of user plane
resources\";
\- if the AMF needs to notify the SMF about a change of user location;
\- if the AMF needs to notify the SMF that the UE is reachable (e.g. for a UE
that was in MICO mode).
\- at step 10, the SMF sends an Nsmf_PDUSession_UpdateSMContext Response (N1
SM information [PDU Session ID, PDU Session re-establishment indication], N2
SM information [PDU Session ID, Qos Profile, CN N3 Tunnel info, S-NSSAI]) to
the AMF.\ \ When the Cause in step 4 indicates \"establishment of user plane
resources\", the message includes N2 SM information when using the current PDU
Session Anchor, and N1 SM Information the PDU Session Anchor needs to be
relocated.\ \ When step 4 indicates that the UE is reachable, if the SMF has
pending DL data, the SMF sends N11 message to the AMF to establish the user
plane for the PDU session(s).
\- at step 15, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (N2 SM
information [RAN Tunnel Info], RAT-Type) per accepted PDU session to the SMF.
The message shall also include the UE Time Zone if it has changed compared to
the last reported UE Time Zone.
\- at step 18, the SMF responds by an Nsmf_PDUSession_UpdateSMContext
Response.
###### 6.4.1.3.2.8 During a UE triggered Service Request in CM-CONNECTED state
According to 3GPP TS 23.502 [3] subclause 4.2.3.3:
\- at step 4, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (PDU
Session ID(s), Cause(s), UE location information, Access Type).
\- at step 10, the SMF sends an Nsmf_PDUSession_UpdateSMContext Response (N1
SM information (PDU Session ID, PDU Session re-establishment indication), N2
SM information [PDU Session ID, Qos Profile, CN N3 Tunnel info, S-NSSAI]) to
the AMF.
\- at step 15, the AMF sends an Nsmf_PDUSession_UpdateSMContext Request (N2 SM
information [RAN Tunnel Info, List of accepted QoS flows, List of Rejected QoS
flows]) per accepted PDU session to the SMF.
\- at step 18, the SMF responds by an Nsmf_PDUSession_UpdateSMContext
Response.
###### 6.4.1.3.2.9 During a Network triggered Service Request
The call flow proceeds same as for a UE initiated Service Request procedure.
###### 6.4.1.3.2.10 During a CN initiated deactivation of UP connection of an
existing PDU session
According to 3GPP TS 23.502 [3] subclause 4.3.7:
\- at step 3, the SMF sends a N11 message (N2 SM information [Session Release
Request]) to release the (R)AN resources associated with the PDU session.
NOTE: it is FFS which service operation this uses. This is assumed to use an
AMF service, e.g. Namf_Communication_N1N2MessageTransfer.
###### 6.4.1.3.2.11 During an Inter NG-RAN node N2 based handover, cancel
According to 3GPP TS 23.502 [3]:
\- at step 5, the AMF sends a Nsmf_PDUSession_UpdateSMContext request (SUPI,
Relocation Cancel Indication) for each PDU session indicated by S-RAN;
\- at step 7, the SMF responds with the Nsmf_PDUSession_UpdateSMContext
response.
##### 6.4.1.3.3 Procedures requirements between the V-SMF and H-SMF
###### 6.4.1.3.3.1 During a PDU Session Establishment
The H-SMF shall provide the means for the V-SMF to create a new PDU session in
the 5GS.
According to 3GPP TS 23.502 [3] subclause 4.3.2.2.2:
\- at step 6, the V-SMF requests the H-SMF to establish a PDU session by
sending an Nsmf_PDUSession_Create Request (SUPI, DNN, S-NSSAI, PDU Session ID,
V-SMF ID, V-CN Tunnel Info, PDU Type, PCO, ULI, SM PDU DN Request Container).
\- at step 13, the H-SMF sends an Nsmf_PDUSession_Create Response (Authorized
QoS Rule, SSC mode, H-CN Tunnel Info) to the V-SMF. The response shall also
indicate if the VPLMN is allowed to insert an UL CL or a Branching Point for
the PDU session.
This makes use of the Nsmf_PDUSession_Create service operation (see 3GPP TS
23.502 [3] subclause 5.2.8.4).
###### 6.4.1.3.3.2 During a PDU Session Modification
According to 3GPP TS 23.502 [3] subclause 4.3.3.3:
\- at step 1a, the V-SMF sends an Nsmf_PDUSession_Update Request (SUPI, PDU
Session ID, N1 SM information) to the H-SMF.
\- at step 1e, the V-SMF sends an Nsmf_PDUSession_Update Request to the H-SMF;
\- at step 3, the H-SMF sends an Nsmf_PDUSession_Update Response (PDU Session
ID, Qos rule, Session-AMBR) if this procedure was triggered by step 1a or 1e;
otherwise the SMF sends an Nsmf_PDUSession_Update Request.
\- at step 10, the V-SMF sends an Nsmf_PDUSession_Update Request to the H-SMF
and H-SMF returns a corresponding Response.
###### 6.4.1.3.3.3 During a PDU Session Release
According to 3GPP TS 23.502 [3] subclause 4.3.4.3:
\- at step 1a, in the UE initiated release, the V-SMF requests the H-SMF to
release a PDU session using a Nsmf_PDUSession_Update Request (SUPI, PDU
Session ID, NAS SM from the UE).
\- at step 1b, in the serving network initiated release, the V-SMF initiates
the release of the PDU session at the H-SMF by invoking the
Nsmf_PDUSession_Release request.- at step 3a, the H-SMF sends a
Nsmf_PDUSession_Update Response (SUPI, PDU Session ID, NAS message) to the
V-SMF.
\- at step 3b, for PDU session release initiated by the H-SMF, the H-SMF sends
a Nsmf_PDUSession_Release Request (SUPI, PDU Session ID, NAS message) to the
V-SMF.
\- at step 14, the V-SMF sends a Nsmf_PDUSession_Release Response to the
H-SMF.
The SMF shall tell the AMF to dissociate the PDU session ID from itself when
the SMF knows that the UE and the 5G-AN have acknowledged the PDU session
release.
#### 6.4.1.4 Requirements on Services offered by the SMF
NOTE: The set of parameters and their condition of presence in the SMF service
operations is FFS.
##### 6.4.1.4.1 Nsmf_PDUSession
###### 6.4.1.4.1.1 General
###### 6.4.1.4.1.2 Nsmf_PDUSession_CreateSMContext service operation
The AMF uses this service to create an SM Context for a PDU session in the SMF
during a PDU session establishment procedure or a handover of an existing PDU
session between 3GPP access and non-3GPP access.
Table 6.4.1.4.1.2-1: Parameters in Nsmf_PDUSession_CreateSMContext Request
+-------------------------------+---+-------------------------------+ | Information elements | P | Comment | +-------------------------------+---+-------------------------------+ | SUPI | M | Subscriber Permanent ID | +-------------------------------+---+-------------------------------+ | PDU Session ID | M | Identifier of the PDU Session | +-------------------------------+---+-------------------------------+ | DNN | M | Requested Data Network Name | +-------------------------------+---+-------------------------------+ | S-NSSAI | M | Requested S-NSSAI | +-------------------------------+---+-------------------------------+ | AMF ID | M | Identifier of the serving AMF | +-------------------------------+---+-------------------------------+ | Request Type | M | \"Initial Request\", | | | | \"Existing PDU Session\", | | | | \"Emergency Request\" or | | | | \"Existing Emergency PDU | | | | Session\" | +-------------------------------+---+-------------------------------+ | N1 SM Information | M | N1 SM container with NAS SM | | | | PDU _(PDU Session | | | | Establishment Request)_ | | | | received from UE | +-------------------------------+---+-------------------------------+ | PEI | O | Permanent Equipment | | | | Identifier. Present if | | | | available at the AMF. | +-------------------------------+---+-------------------------------+ | User Location Information | O | | | | | | | - in case of 5G-RAN: Cell-Id | | | | | | | | - in case of N3IWF: UE local | | | | IP address and optionally UDP | | | | or TCP source port number (if | | | | NAT is detected) | | | +-------------------------------+---+-------------------------------+ | Access Network Type | M | Access Network Type with | | | | which the PDU session is | | | | associated | +-------------------------------+---+-------------------------------+ | UE Time Zone | O | | +-------------------------------+---+-------------------------------+ | H-SMF ID / address | O | Identfiier or address of | | | | selected H-SMF, for home | | | | routed roaming scenario | +-------------------------------+---+-------------------------------+
NOTE: How the SMF determines whether the UE is within the LADN service area,
for a DNN corresponding to an LADN, is FFS.
Table 6.4.1.4.1.2-2: Parameters in Nsmf_PDUSession_CreateSMContext Response
* * *
Information elements P Comment Cause M Result Indication N1 SM Information O
N1 SM container with NAS SM PDU _(PDU Session Establishment Accept, including
Authorized QoS Rule, SSC mode, S-NSSAI, IPv4 address, Session-AMBR)_ to be
sent to UE N2 SM Information O N2 SM container with N2 SM PDU _(including PDU
session ID, QoS Profile(s), CN Tunnel Info, S-NSSAI, Session-AMBR)_ to be sent
to (R)AN Access Network Type M Access Network Type to use for signalling
* * *
###### 6.4.1.4.1.3 Nsmf_PDUSession_UpdateSMContext service operation
The AMF uses this service to update an SM Context for a PDU session in the
SMF, e.g. due to receipt of N1/N2 SM information or MM NAS Service Request.
Table 6.4.1.4.1.3-1: Parameters in Nsmf_PDUSession_UpdateSMContext Request
+-------------------------------+---+-------------------------------+ | Information elements | P | Comment | +-------------------------------+---+-------------------------------+ | SUPI | M | Subscriber Permanent ID | +-------------------------------+---+-------------------------------+ | PDU Session ID | M | Identifier of the PDU Session | +-------------------------------+---+-------------------------------+ | N1 SM Information | O | N1 SM container with NAS SM | | | | PDU _(e.g. PDU Session | | | | Modification Request, PDU | | | | Session Release Request)_ | | | | received from UE | +-------------------------------+---+-------------------------------+ | N2 SM Information | O | N2 SM container with N2 SM | | | | PDU _(e.g. notification that | | | | QoS targets of a GBR flow | | | | cannot be fulfilled)_ | | | | received from (R)AN | +-------------------------------+---+-------------------------------+ | Operation Type | O | E.g. activate, deactivate | | | | user plane resources | | | | | | | | See NOTE 1. | +-------------------------------+---+-------------------------------+ | User Location Information | O | See NOTE 2. | | | | | | - in case of 5G-RAN: Cell-Id | | | | | | | | - in case of N3IWF: UE local | | | | IP address and optionally UDP | | | | or TCP source port number (if | | | | NAT is detected) | | | +-------------------------------+---+-------------------------------+ | Access Network Type | O | Access Network Type with | | | | which the PDU session is | | | | associated | +-------------------------------+---+-------------------------------+ | UE Time Zone | O | Included if this information | | | | has changed compared to the | | | | last reported UE Time Zone | +-------------------------------+---+-------------------------------+ | AMF ID | O | Identifier of the serving AMF | +-------------------------------+---+-------------------------------+ | NOTE 1: Step 4 of subclause | | | | 4.2.3.2 of | | | | 3GPP TS 23.502 [3] refers | | | | instead to a Cause parameter | | | | set to \"establishment of | | | | user plane resources\". | | | | | | | | NOTE 2: Step 2 of subclause | | | | 4.9.1.2.2 of | | | | 3GPP TS 23.502 [3] (Xn | | | | based inter NG RAN handover) | | | | specifies that the AMF sets | | | | the User Location Information | | | | to the Target RAN Identifier. | | | +-------------------------------+---+-------------------------------+
Table 6.4.1.4.1.3-2: Parameters in Nsmf_PDUSession_UpdateSMContext Response
* * *
Information elements P Comment Cause M Result Indication N1 SM Information O
N1 SM container with NAS SM PDU _(e.g. PDU Session Modification Command, PDU
Session Release Command)_ to be sent to UE N2 SM Information O N2 SM container
with N2 SM PDU _(e.g. N2 SM Resource Release Request)_ to be sent to (R)AN
* * *
NOTE: It is FFS how the SMF indicates to the AMF that a PDU session is
released during a UE or network requested PDU session release (see step 8 of
subclause 4.3.4.2 of 3GPP TS 23.502 [3]).
###### 6.4.1.4.1.4 Nsmf_PDUSession_ReleaseSMContext service operation
The AMF uses this service to release an SM Context for a PDU session in the
SMF, e.g. UE is being deregistered.
Table 6.4.1.4.1.4-1: Parameters in Nsmf_PDUSession_ReleaseSMContext Request
* * *
Information elements P Comment SUPI M Subscriber Permanent ID PDU Session ID M
Identifier of the PDU Session User Location Information O  
Access Network Type O
* * *
Table 6.4.1.4.1.4-2: Parameters in Nsmf_PDUSession_ReleaseSMContext Response
* * *
Information elements P Comment Cause M Result Indication
* * *
###### 6.4.1.4.1.5 Nsmf_PDUSession_Create service operation
The V-SMF uses this service to create a new PDU session in the H-SMF.
Table 6.4.1.4.1.5-1: Parameters in Nsmf_PDUSession_Create Request
+-------------------------------+---+-------------------------------+ | Information elements | P | Comment | +-------------------------------+---+-------------------------------+ | SUPI | M | Subscriber Permanent ID | +-------------------------------+---+-------------------------------+ | PDU Session ID | M | Identifier of the PDU Session | +-------------------------------+---+-------------------------------+ | DNN | M | Requested Data Network Name | +-------------------------------+---+-------------------------------+ | S-NSSAI | M | Requested S-NSSAI | +-------------------------------+---+-------------------------------+ | V-SMF ID | M | Identifier of the serving SMF | +-------------------------------+---+-------------------------------+ | PDU Session Type | M | Requested PDU session type | | | | (IP, IPv4, IPv6, Ethernet or | | | | Unstructured) | +-------------------------------+---+-------------------------------+ | V-CN Tunnel Information | M | N9 tunnel information of UPF | | | | in VPLMN | +-------------------------------+---+-------------------------------+ | SSC mode | O | Requested SSC mode | +-------------------------------+---+-------------------------------+ | Request Type | O | \"Initial Request\" or | | | | \"Existing PDU session\". | +-------------------------------+---+-------------------------------+ | PCO | O | | +-------------------------------+---+-------------------------------+ | PEI | O | | +-------------------------------+---+-------------------------------+ | User Location Information | O | | | | | | | - in case of 5G-RAN: Cell-Id | | | | | | | | - in case of N3IWF: UE local | | | | IP address and optionally UDP | | | | or TCP source port number (if | | | | NAT is detected) | | | +-------------------------------+---+-------------------------------+ | Access Network Type | M | Access Network Type with | | | | which the PDU session is | | | | associated | +-------------------------------+---+-------------------------------+ | SM PDU DN Request Container | O | For PDU session authorization | | | | by the external DN | +-------------------------------+---+-------------------------------+
Table 6.4.1.4.1.5-2: Parameters in Nsmf_PDUSession_Create Response
* * *
Information elements P Comment Cause M Result Indication Authorized QoS Rule M
Multiple Authorized QoS Rules may be included. H-CN Tunnel Information M N9
tunnel information of UPF in HPLMN Selected SSC mode M  
UE IP address O IPv4 address QoS Profile(s) O  
Session-AMBR M  
Authorization Info for routing the traffic locally in the VPLMN M Indicates
whether the VPLMN is allowed to insert an UL CL or a Branching Point for the
PDU session.
* * *
###### 6.4.1.4.1.6 Nsmf_PDUSession_Update service operation
The V-SMF uses this service to update an existing PDU session in the H-SMF,
e.g. during a UE or network requested PDU session modification or to inform
the H-SMF about a UPF change in the VPLMN.
Table 6.4.1.4.1.6-1: Parameters in Nsmf_PDUSession_Update Request (V-SMF to
H-SMF)
* * *
Information elements P Comment SUPI M Subscriber Permanent ID PDU Session ID M
Identifier of the PDU Session Requested PDU session parameters (QoS) M  
V-CN Tunnel Information O N9 tunnel information of UPF in VPLMN User Location
Information O  
Access Network Type O Access Network Type with which the PDU session is
associated
* * *
NOTE 1: The set of parameters required to notify the H-SMF that the QoS
targets of a GBR flow cannot be fulfilled (e.g. QFI and associated
notification) are FFS.
NOTE 2: The full set of parameters (e.g. requested QoS, PCO, etc) that need to
be supported towards the H-SMF, upon a UE requested PDU session modification,
is FFS.
NOTE 3: The parameters (e.g. PDU session release request) that need to be
supported towards the H-SMF, upon a UE or V-SMF requested PDU session release,
is FFS.
Table 6.4.1.4.1.6-2: Parameters in Nsmf_PDUSession_Update Response (V-SMF to
H-SMF)
* * *
Information elements P Comment Cause M Result Indication Authorized QoS Rule M  
H-CN Tunnel Information M N9 tunnel information of UPF in HPLMN Session AMBR O
* * *
NOTE 4: The parameters (e.g. PDU session release command) that need to be
supported towards the V-SMF, upon a UE or V-SMF requested PDU session release,
is FFS. See step 4a of subclause 4.3.4.2 of 3GPP TS 23.502 [3]).
The H-SMF uses this service to update an existing PDU session in the V-SMF,
e.g. during a network requested PDU session modification.
Table 6.4.1.4.1.6-3: Parameters in Nsmf_PDUSession_Update Request (H-SMF to
V-SMF)
* * *
Information elements P Comment SUPI M Subscriber Permanent ID PDU Session ID M
Identifier of the PDU Session Authorized QoS Rule O  
Session AMBR O
* * *
Table 6.4.1.4.1.6-4: Parameters in Nsmf_PDUSession_Update Response (H-SMF to
V-SMF)
* * *
Information elements P Comment Cause M Result Indication
* * *
###### 6.4.1.4.1.7 Nsmf_PDUSession_Release service operation
The H-SMF uses this service to release an existing PDU session, e.g. upon
receipt of a request from the V-SMF to release the PDU session.
Table 6.4.1.4.1.7-1: Parameters in Nsmf_PDUSession_Release Request
* * *
Information elements P Comment SUPI M Subscriber Permanent ID PDU Session ID M
Identifier of the PDU Session N1 SM Information M N1 SM information needed for
SM session release towards the UE
* * *
NOTE: The parameters (N1 SM Information) that need to be supported towards the
V-SMF, upon a H-SMF requested PDU session release, is FFS. See step 4b of
subclause 4.3.4.2 of 3GPP TS 23.502 [3]).
Table 6.4.1.4.1.7-2: Parameters in Nsmf_PDUSession_Release Response
* * *
Information elements P Comment Cause M Result Indication User Location
Information O  
Access Network Type O
* * *
## 6.5 Access and Mobility Management Function Procedures and Services
### 6.5.1 Requirements
#### 6.5.1.1 General
For 3GPP access and Non-3GPP access the same AMF is used if both access belong
to the same core network. A UE is connected to two different AMFs if the 3GPP
access and the non 3GPP access belong to different networks.
The AMF has UE subscription information even when there is no session active
anymore (after release or handover from non 3GPP access to 3GPP access).
**Common parameters and information with regard to the interfaces**
An AMF associates the RM context for an UE with:
\- a Temporary Identifier that is common between 3GPP and Non 3GPP. This
Temporary Identifier is globally unique.
\- A registration state and registration areas per access type.
TAI lists for 3GPP and non 3GPP accesses are different, two TAI lists in AMF
if UE is registered in both.
#### 6.5.1.2 Procedures between two AMFs
##### 6.5.1.2.0 General
AMF to AMF interface is used to support AMF change.
The change of network slices may lead to AMF change.
##### 6.5.1.2.1 During a Registration Procedure
During registration procedure (see subclause 4.2.2.2.2 in 3GPP TS 23.502 [3])
the following messages are exchanged when AMF change applies:
**_Namf_Communication_UEContextTransfer Request message_** new AMF to old AMF:
Namf_Communication_UEContextTransfer Request (complete Registration Request).
If the UE\'s Temporary User ID (5G-GUTI) was included in the Registration
Request and the serving AMF has changed since last registration, the new AMF
may send Namf_Communication_UEContextTransfer Request to old AMF including the
integrity protected complete Registration Request IE to request the UE\'s SUPI
and MM Context.
**_Namf_Communication_UEContextTransferResponse message_** old AMF to new AMF:
Namf_Communication_UEContextTransfer Response (SUPI, MM Context, SMF
information, ..), see subclause 5.2.2.2.2 in 3GPP TS 23.502 [3] for summary
content.
Old AMF responds with Information Response to new AMF including the UE\'s
SUPI, UE Radio Capability (information contains information on RATs that the
UE supports (e.g. power class, frequency bands, etc)) and MM Context.
If old AMF holds information about active PDU Sessions, the old AMF includes
SMF information including SMF identities and PDU session identities.
The old AMF includes SMF identifier as part of UE context transfer during AMF
relocation to new AMF.
**_Namf_Communication_RegistrationCompleteNotify_** new AMF to old AMF, see
subclause 5.2.2.2.3 in 3GPP TS 23.502 [3] for summary content.
If the AMF has changed the new AMF acknowledge the transfer of UE MM context.
If the authentication/security procedure fails, then the Registration shall be
rejected, and the new AMF sends a reject indication to the old AMF. The old
AMF continues as if the Namf_Communication_UEContextTransfer Request was never
received.
**_Reroute NAS message_** Initial AMF to target AMF (option, alternative
signalling via RAN) Namf_Communication_N1Message Notify service (see subclause
5.2.2.2.4 of 3GPP TS 23.502 [3])
> If the initial AMF, based on local policy and subscription information,
> determines to forward the NAS message to the target AMF directly, the
> initial AMF sends a Reroute NAS message to the target AMF.
>
> The Reroute NAS message contains: (R)AN to identify the N2 terminating point
> (receive the initial setup message), optionally the UE\'s SUPI and MM
> Context, the Allowed NSSAI is included together with the corresponding NSI
> IDs (for network slicing).
NOTE: It is FFS if Namf_Communication_N1MessageNotify service or to introduce
a new update request/response service operation in AMF for this step.
##### 6.5.1.2.2 During a Inter NG-RAN node N2 based handover
According to 3GPP TS 23.502 [3] subclause 4.9.1.3 Inter NG-RAN node N2 based
handover:
\- at step 3, the S-AMF sends _Namf_Communication_CreateUEContext Request(N2
Information(_ Target ID, Source to Target transparent container, _SM N2
information list),_ UE context information containing SUPI and the list of PDU
session IDs along with the corresponding SMF information _) to the T-AMF_.
\- at step 11, the T-AMF responses the Namf_Communication_CreateUEContext
Response (N2 information necessary for S-AMF to send Handover Command to S-RAN
including Target to Source transparent container, N2 SM information (PDU
sessions failed to be setup list, and the N3 DL forwarding information)).
\- at step 6a, the T-AMF sends Namf_Communication_N2InfoNotify to the S-AMF.
\- at step 6b, S-AMF to T-AMF: Namf_Communication_N2InfoNotify ACK.
##### 6.5.1.2.3 During a Inter NG-RAN node N2 based handover, Cancel
According to 3GPP TS 23.502 [3] subclause 4.9.1.3 Inter NG-RAN node N2 based
handover:
\- at step 3, the S-AMF sends N _amf_Communication_ ReleaseUEContext Request
(S_ UPI, PDU session IDs, Relocation Cancel Indication) _to the T-AMF_.
\- at step 8, the T-AMF responses the Namf_Communication_ ReleaseUEContext
Response (SUPI, result).
#### 6.5.1.3 Procedures between the AMF and SMF
##### 6.5.1.3.1 General
The following procedures take place during the interactions described in
subclause 6.4.1.3.2.
NOTE: The identification of the NF services is still in progress in stage 2.
The following subclauses will be aligned with the services specified in stage
2 (and in the stage 2 call flows) once the latter is stable.
##### 6.5.1.3.2 Transfer of N1/N2 messages from UE and/or AN
After the AMF has selected the SMF, the AMF shall transfer N1 and/or N2 SM
signalling from the UE/5G-AN to the SMF serving the related PDU session:
\- in the PDU session modification procedure in 3GPP TS 23.502 [3] subclause
4.3.3.2:
\- at step 1a, for a UE initiated PDU session modification procedure, the AMF
sends an SM Request (N1 SM information [PDU Session Modification Request]) to
the SMF.
\- in the UE or network requested PDU session release for Non-Roaming and
Roaming with Local Breakout procedure in 3GPP TS 23.502 [3] subclause 4.3.4.2;
\- in the UE or network requested PDU session release for Home-routed Roaming
procedure in 3GPP TS 23.502 [3] subclause 4.3.4.3;
\- during handover procedure for _each PDU session not indicated by the S-RAN_
as an N2 Handover candidate in the Handover Required message see subclause
4.9.1.2.2 of 3GPP TS 23.502 [3].
The AMF is not expected to know what a N1 message it is relaying is about,
e.g. a N1 SM \"PDU Session Modification Request\" is transparent to the AMF.
NOTE: There is a specific exception for PDU session creation as this procedure
requires specific actions from the AMF, e.g. to select an SMF and associate
the PDU Session ID with the SMF-Id for a PDU session creation. See subclause
6.4.1.3.2.1.
##### 6.5.1.3.3 Transfer of N1/N2 messages to UE and/or AN
Network triggered service request the SMF sends
_Namf_Communication_N1N2MessageTransfer_ message to the AMF to trigger paging
of the UE, see sublause 4.2.3.4 of 3GPP TS 23.502 [3].
The AMF shall transfer N1 and/or N2 SM signalling from the SMF to the
UE/5G-AN, e.g. in the PDU session modification procedure in 3GPP TS 23.502 [3]
subclause 4.3.3.2 and 4.3.4.2:
\- at step 3b, the SMF sends an Namf_Communication_N1N2MessageTransfer Request
(N2 SM information [PDU Session ID, QoS Profile, Session-AMBR], N1 SM
container [PDU Session Modification Command]) to the AMF.
The AMF is not expected to know what a N1 or N2 message it is relaying is
about, e.g. a N1 SM container \"PDU Session Modification Command\" is
transparent to the AMF.
NOTE 1: There is a specific exception for PDU session release as this
procedure require specific actions from the AMF, e.g. to delete the
association between a PDU session ID and an SMF ID. See subclause 6.4.1.3.2.3.
NOTE 2: The SMF can tell the AMF to skip sending N1 SM container to the UE.
NOTE 3: Whether N2 SM container contains complete N2 message or it requires
the AMF to create N2 message is FFS.This makes use of the
Namf_Communication_N1N2Message_Transfer service operations (see subclause
5.2.2.2.7 of 3GPP TS 23.502 [3]).
##### 6.5.1.3.4 Notification of Mobility Events
The AMF shall notify the SMF about mobility event affecting the PDU session
(e.g. location change, AMF relocation) with a set of messages for N1 and or N2
related messages see below.
\- Namf_Communication_N1MessageNotify service (see subclause 5.2.2.2.4 of 3GPP
TS 23.502 [3])
\- Namf_Communication_N1MessageSubscribe service (see subclause 5.2.2.2.5 of
3GPP TS 23.502 [3])
\- Namf_Communication_N1MessageUnsubscribe service (see subclause 5.2.2.2.6 of
3GPP TS 23.502 [3])
Namf_Communication_N1Message do not have an expected output, no confirmation
is expected.
Namf_Communication_N1N2Message transfer service operation (Message type,
message container, session ID, AN type) see subclause 5.2.2.2.7 of 3GPP TS
23.502 [3]. It is a confirmed service initiated by the SMF see subclauses
4.3.2.3, 4.3.3.2 of 3GPP TS 23.502 [3].
\- Namf_Communication_N2InfoSubscribe service operation (see subclause
5.2.2.2.8 of 3GPP TS 23.502 [3]). It is used to e.g. notify the SMF about N3
tunnel setup information and path switch requests, no acknowledge is expected.
\- Namf_Communication_N2InfoUnsubscribe service operation (see subclause
5.2.2.2.9 of 3GPP TS 23.502 [3]).
\- Namf_Communication_N2InfoNotify service operation (see subclause 5.2.2.2.10
of 3GPP TS 23.502 [3]).
\- Namf_MobileTermination service (see subclause 5.2.2.4 of 3GPP TS 23.502
[3]).
\- Namf_MobileTermination_EnableReachability service operation (see subclause
5.2.2.4.2 of 3GPP TS 23.502 [3]).
\- Namf_EventExposure_Subscribe service operation (see subclause 5.2.2.3.2 of
3GPP TS 23.502 [3]), reply required.
\- Namf_EventExposure_UnSubscribe service operation (see subclause 5.2.2.3.3
of 3GPP TS 23.502 [3]), reply required.
\- Namf_EventExposure_Notify service operation (see subclause 5.2.2.3.2 of
3GPP TS 23.502 [3]), no reply required.
The AMF invokes the Namf_EventExposure_Notify (see clause 5.2.2.3.4 of 3GPP TS
23.502 [3]) in the following scenarios:
\- If the AMF is changed, the new AMF notifies each SMF of the new AMF serving
the UE by informing the UE reachability status including the PDU session
status from the UE relevant for each SMF. In case the AMF has changed, it is
assumed that the old AMF provides the available SMF information.
\- If the UE was in MICO mode and the AMF had notified an SMF of the UE being
unreachable and that the SMF needs not to send DL data notifications to the
AMF, the AMF informs the SMF that the UE is reachable.
> \- If the AMF had notified an SMF of the UE being reachable only for
> regulatory prioritized service and the UE enters into Allowed area, the AMF
> informs the SMF that the UE is reachable.
NOTE 1: the AMF will also notify any other NF that subscribed to UE reach
ability that the UE is reachable.
> \- If an SMF has subscribed to UE location change notification via
> Namf_EventExposure_Subscribe service operation and if the AMF detects that
> the UE has moved out the area of interest subscribed by an SMF serving the
> UE, the AMF invokes Namf_EventExposure_Notify service operation to inform
> the SMF of the new location information of the UE.
NOTE 2: Whether notification Ack need a separate message or be realized in the
transport layer will be determined in stage 3.
#### 6.5.1.4 Procedures between the AMF and PCF
The AMF invokes the Namf_EventExposure_Notify (see clause 5.2.2.3.4 of 3GPP TS
23.502 [3]) in the following scenarios:
\- If an PCF has subscribed to UE location change notification or change of UE
presence in Area of interest notification via Namf_EventExposure_Subscribe
service operation and if the AMF detects that the UE has moved out the area of
interest subscribed by an PCF serving the UE, the AMF invokes
Namf_EventExposure_Notify service operation to inform the SMF of the new
location information of the UE.
\- If the subscribed service restriction area or subscribed RFSP index is
change, the AMF invokes Namf_EventExposure_Notify service operation to inform
the new subscribed service restriction area or subscribed RFSP index to the
PCF.
## 6.6 Authentication Server Function Procedures and Services
NOTE: The content of the following subclauses is not stable. It will heavily
depend on the work done at SA3 and the progress of the TS 33.501 not yet
initiated, capturing the conclusions of the TR 33.899 not yet stable.
### 6.6.1 Requirements
#### 6.6.1.1 General
The following subclauses provide an overview of the Authentication Server
Function (AUSF) and the functional requirements associated with the services
provided by the AUSF to the AMF related to the UE authentication and security-
AUSF information exchange.
#### 6.6.1.2 AUSF Environment
According to the 3GPP TS 23.501 [2], the AUSF and the AMF may be located:
\- into the same PLMN in non-roaming case, see subclause 4.2.3 of the 3GPP TS
23.501 [2].
\- in different PLMNs in roaming cases; see subclause 4.2.4 of the 3GPP TS
23.501 [2].
The AMF-AUSF message exchange may be internal to a single domain and across
multiple domains, with 0 or N interworking networks between the visited PLMN
and the Home PLMN.
Moreover, the 5G system should be flexible enough to support 3^rd^ party
services and 3rd party based UE authentication, e.g. for credential
provisioning or secondary authentication performed by 3^rd^ party service
providers. The use of 3^rd^ party credentials for mutual authentication could
be achieved in several ways. One of these candidate solutions would be to use
a direct interface between the AUSF of the 3GPP 5G operator and the ARPF of
the 3^rd^ party domain. In such a case, the AUSF could act as a proxy between
the AMF and the 3^rd^ party service provider.
The figure 6.6.1.2-1 depicts the possible interactions of the AUSF with the
other network functions and 3^rd^ Party Service Providers for 3^rd^ party
authentication.
Figure 6.6.1.2-1: AUSF Environment
#### 6.6.1.3 AUSF Functionalities
In the present release, EAP-AKA\' and 5G-AKA are the only authentication
methods that are mandatory to support by the UE and the serving network.
5G-AKA, compared to EPS-AKA, allows the home network (through the AUSF) to
request an Authentication Confirmation message from the visited network
(through the AMF) that confirms successful authentication of the UE.
EAP-AKA\' and 5G-AKA can be used over 3GPP access. Only EAP-based
authentication can be used over non-3GPP access.
NOTE 1: the EAP method over non-3GPP access is still under discussion at SA2.
The Authentication Server Function (AUSF) provides the following
functionalities:
During the registration procedure over the 5G access network (see subclause
4.2.2 in 3GPP TS 23.502 [3]), if 5G-AKA is used, the AUSF is contacted by the
AMF to retrieve security material used by the AMF to authenticate the UE and
generate NAS, CP and UP specific security keys. For this purpose, the AUSF
requests AVs from the ARPF/UDM. The AUSF is then in charge of deriving new AVs
(named AV*s) from this material which will be provided to the AMF (see
subclause 6.1.3.2 in 3GPP TS 33.501 [63]). If the AUSF requests a confirmation
from the AMF, it will store a key (HXRES*) and expects a message from the AMF.
It will be then able to confirm the authentication.
The figure 6.6.1.3-1 depicts the registration phase for UE accessing the 5G
core network via a 3GPP access network if 5G-AKA is used and a confirmation
message is requested.
Figure 6.6.1.3-1: Authentication during Registration via 3GPP access with
5G-AKA (with Confirmation)
The AUSF may also be contacted as an EAP server if the 5G UE is authenticated
with EAP-AKA\'. In this case, it is the AUSF which is responsible of
performing authentication of the UE. Several EAP request/response messages may
be required between the UE and AUSF (via the AMF) depending on the chosen EAP
authentication method (i.e. EAP-AKA\'). Upon successful UE authentication, the
AUSF provides the AMF with a security key that will be used by the AMF to
generate NAS, CP and UP specific security keys.
The figure 6.6.1.3-2 depicts the registration phase fwhen the UE is
authenticated with EAP-AKA\' over 5G access.
Figure 6.6.1.3-2: Authentication during Registration via 3GPP access with EAP-
AKA\'
NOTE 2: The interaction between AUSF and 3^rd^ party service provider
authentication repository/server is FFS
#### 6.6.1.4 Information Elements
This subclause identifies the set of main information elements exchanged
between the AMF (acting as SEAF) and the AUSF.
From AMF (acting as SEAF) to AUSF:
\- The access keys used by the AMF to contact the AUSF are:
\- A subscriber identifier from which the AUSF can derive the SUPI (5G
Subscriber Permanent Identity) for the 5G access network. As stated in 3GPP TS
23.501 [2], IMSI has been identified as at least one valid SUPI type for UEs
supporting at least one 3GPP Access Technology.
\- An indication whether the authentication is for 3GPP or non-3GPP access.
\- The serving network name.
NOTE 1: It is not clear if other type of SUPI will be supported.
\- For EAP based authentication, AMF forwards to the AUSF EAP messages
received from the UE
NOTE 2: it is not clear if the AMF or the N3IWF acts as EAP authenticator.
From AUSF to AMF:
\- For AKA-based authentication (i.e. 5G-AKA), the AUSF provides one or more
Authentication Vector (AV*) including the challenge and expected UE response
provided by the UDM and the intermediate key generated by the AUSF (e.g. key K
ASME*).
\- For EAP-based authentication, the AUSF sends the EAP messages generated as
EAP server, and, in successful authentication cases, the anchor key generated
by the AUSF (e.g. the key MSK)
NOTE 3: The interaction between AUSF and 3^rd^ party service provider
authentication repository/server is FFS
#### 6.6.1.5 State model
In the 5G system, the real security anchor is the AMF. The AUSF is used to
authenticate the UE and/or retrieve intermediate security key during the
registration phase. In both cases, the user identity provided by the AMF is
used by the AUSF to retrieve security material derived from the security root
key stored in the UDM. In the case of EAP-based authentication, after
delivering the security material to the AMF, it is assumed that the AUSF
selected by the AMF during the registration phase does not need to maintain
any session state. As long as the intermediate key retrieved by the AMF is
valid, there is no need for the AMF to contact an AUSF. When the UE is
anchored to a new AMF, a new authentication procedure is performed. It is then
assumed that the AUSF is session stateless. In the case of 5G-AKA, if a
confirmation message is required, the AUSF stores temporarily a key until a
protocol timer expires. As a consequence, the AUSF is stateful.
Depending on the UE authentication method and the role of the AUSF in the UE
authentication process, the dialogue between the AMF and the AUSF can consist
of:
\- 1 request/response message pair, e.g. when the AUSF only provide an
authentication vector to the AMF
\- N request/response message pairs, N >= 2, when the AUSF acts as an EAP
server.
It is then assumed that the AUSF is transaction stateful, at least when acting
as EAP server.
NOTE: The state model is still FFS
### 6.6.2 Solution and Protocol Selection for Services offered by the AUSF for
use over N12
#### 6.6.2.1 Solution 1 -- N12 Diameter-based Implementation
##### 6.6.2.1.1 Solution Description
The AUSF can be implemented as a Diameter node that will either act as
\- a Diameter server when terminating request from the AMF, e.g. when the AUSF
is acting as EAP server;
\- or a Diameter proxy agent when forwarding requests received from the AMF to
remote Diameter servers, e.g. for 3^rd^ party UE authentication.
There are several ways to implement the Diameter application that will be used
over N12:
\- A new Diameter application is defined by 3GPP, with new commands,
specifically designed to support EAP request/message exchanges and AV
retrieval from the AUSF.
\- An existing Diameter application is enhanced with new mandatory-to-
understand AVP to support new functionalities required by N12, with the need
for a new application identifier. For instance, SWm already used to support
EAP protocol between the ePDG and 3GPP AAA could be reused and improved to
retrieve AV from UDM,
\- A combination of Diameter applications are reused with minor changes
(optional AVP) to cover N12 requirements, e.g. reuse the Diameter EAP
application to support EAP authentication and retrieval of AV.
NOTE: The solution description should be further detailed
##### 6.6.2.1.2 Evaluation
NOTE: The evaluation of the N12 Diameter-based implementation is FFS
### 6.6.3 Conclusion
The N12 interface is a Service-Based Interface.
## 6.7 Unified Data Management Services and Operations
### 6.7.1 Requirements
#### 6.7.1.1 General
This subclause provides an overview of the stage 2 requirements for services
offered by the UDM to other NFs. In the service-based representation of the
architecture the interfaces between the UDM and the other NFs which consume
services offered by the UDM are referred to as Nudm.
#### 6.7.1.2 Architecture Overview
Within the 5GC the UDM offers services to the AMF, SMF, AUSF, NEF, and SMSF
via the Nudm service based interface. For details see 3GPP TS 23.501 [2] and
3GPP TS 23.502 [3].
For Migration and Interworking with the EPC the UDM may be colocated with the
HSS. In this case UDM and HSS are assumed to have access to a common
subscriber database (e.g. UDR) and the interaction between UDM and HSS is
implementation specific. For details see 3GPP TS 23.501 [2] clause 5.17.
Figure 6.7.1.2-1 provides an architecture overview with focus on the UDM.
Figure 6.7.1.2-1: Architecture Overview
#### 6.7.1.3 Requirements on Services offered by the UDM to the AMF
##### 6.7.1.3.1 Nudm_UEContextManagement Service
This service offered by the UDM to the AMF allows the AMF to make use of the
following service operations:
Registration:
> The AMF registers to the UDM (corresponds to S6a-ULR/ULA, however without
> subscription data retrieval).
Deregistration:
> The AMF de-registers from the UDM (corresponds to S6a-PUR/PUA).
Update:
> The AMF updates the UDM (to which it is registered) with information
> relevant to the existing registration (corresponds to S6a-NOR/NOA).
RemoveNotification:
> The UDM notifies the AMF about its deregistration (corresponds to
> S6a-CLR/CLA). The subscription to this notification is implied by a
> successful Registration and ceases with a successful Deregistration /
> RemoveNotification.
NOTE: It is ffs whether a service operation (corresponding to S6a-RSR/RSA) is
needed that allows the AMF to be notified about the need for the AMF to re-
register.
##### 6.7.1.3.2 Nudm_SubscriberDataManagement Service
This service offered by the UDM to the AMF allows the AMF to make use of the
following service operations:
Get:
> The AMF retrieves subscription data from the UDM (e.g. Slice Selection Data,
> see 3GPP TS 23.502 [3] figure 4.2.2.2.3-1 step 3).
UpdateNotification:
> The UDM notifies the AMF about relevant subscription data. This may be an
> initial data push caused by the AMF\'s registration (corresponds to S6a-ULA)
> or a subsequent update (corresponds to S6a-IDR/IDA and S6a-DSR/DSA). The
> subscription to this notification is implied by a successful Registration
> and ceases with a successful Deregistration / RemoveNotification.
#### 6.7.1.4 Requirements on Services offered by the UDM to the SMF
##### 6.7.1.4.1 Nudm_UEContextManagement Service
This service offered by the UDM to the SMF allows the SMF to make use of the
following service operations:
Registration:
> The SMF (for a DNN) registers to the UDM (see 3GPP TS 23.502 [3] figure
> 4.3.2.2.1-1 step 19).
Deregistration:
> The SMF de-registers from the UDM.
NOTE 1: Use cases where the SMF de-registers from the UDM are ffs.
RemoveNotification:
> The UDM notifies the SMF about its deregistration.
NOTE 2: Use cases where the UDM notifies the SMF about its de-registration are
ffs.
##### 6.7.1.4.2 Nudm_SubscriberDataManagement Service
This service offered by the UDM to the SMF allows the SMF to make use of the
following service operations:
Get:
> The SMF retrieves subscription data from the UDM (see 3GPP TS 23.502 [3]
> figure 4.3.2.2.1-1 step 4).
UpdateNotification:
> The UDM notifies the registered SMF about an update of relevant subscription
> data. The subscription to this notification is implied by a successful
> Registration and ceases with a successful Deregistration /
> RemoveNotification.
#### 6.7.1.5 Requirements on Services offered by the UDM to the AUSF
##### 6.7.1.5.1 Nudm_UEAuthentication Service
This service offered by the UDM to the AUSF allows the AUSF to make use of the
following service operations:
Get:
> The AUSF retrieves authentication data from the UDM (see 3GPP TS 23.502 [3]
> figure 5.2.10.1.2-1 step 2).
#### 6.7.1.6 Requirements on Services offered by the UDM to the NEF
##### 6.7.1.6.1 Nudm_UEContextManagement Service
This service offered by the UDM to the NEF allows the NEF to make use of the
following service operations:
Get:
> The NEF retrieves the address of a registered serving NF from the UDM (see
> 3GPP TS 23.502 [3] figure 5.2.6.1-1 step 2).
##### 6.7.1.6.2 Nudm_Event Exposure Service
This service offered by the UDM to the NEF allows the NEF to make use of the
following service operations:
Subscribe:
> The NEF subscribes to notifications at the UDM (see 3GPP TS 23.502 [3]
> figure 4.15.2.3-1 step 2).
Un-Subscribe:
> The NEF un-subscribes from notifications at the UDM.
Notify:
> The UDM notifies the NEF about the occurrence of a previously subscribed
> event (see 3GPP TS 23.502 [3] figure 4.15.2.3-1 step 5).
#### 6.7.1.7 Requirements on Services offered by the UDM to the SMSF
##### 6.7.1.7.1 Nudm_UEContextManagement Service
This service offered by the UDM to the SMSF allows the SMSF to make use of the
following service operations:
Registration:
> The SMSF registers to the UDM (see 3GPP TS 23.502 [3] figure 4.13.3.1-1 step
> 5b).
Deregistration:
> The SMSF de-registers from the UDM (see 3GPP TS 23.502 [3] clause 4.13.3.2).
RemoveNotification:
> The UDM notifies the SMSF about its deregistration.
NOTE: Use cases where the UDM notifies the SMSF about its deregistration are
ffs.
##### 6.7.1.7.2 Nudm_SubscriberDataManagement Service
This service offered by the UDM to the SMF allows the SMF to make use of the
following service operations:
Get:
> The SMSF retrieves subscription data from the UDM (see 3GPP TS 23.502 [3]
> figure 4.13.3.1-1 step 5a).
UpdateNotification:
> The UDM notifies the registered SMSF about an update of relevant
> subscription data. The subscription to this notification is implied by a
> successful Registration and ceases with a successful Deregistration /
> RemoveNotification.
## 6.8 Network Function Service Registration, Discovery and Selection
### 6.8.1 Requirements
#### 6.8.1.1 General
Stage 2 requirements for Network Function (NF) Service discovery and for
Network Function (NF) discovery and selection are specified in subclauses
7.1.3 and 6.3 of 3GPP TS 23.501 [2].
The NF service discovery enables a NF to discover NF instance(s) which provide
the expected NF service(s). The NF service discovery is implemented by
supporting NF discovery using the NRF (Network Repository Function).
The NF selection consists in selecting one NF instance among the NF
instance(s) discovered during the NF service discovery. The NF selection is
implemented by the requester NF, e.g. the SMF selection is supported by the
AMF.
Stage 2 requirements for Service registration and de-registration are
specified in subclause 7.1.5 of 3GPP TS 23.501 [2].
For the NRF to properly maintain the information of available NF instances and
their supported services, each NF instance informs the NRF of the list of NF
services that it supports.
#### 6.8.1.2 NF service discovery
The following CT4 requirements apply for NF service discovery:
1) A NF instance shall be able to find the NRF by its own, e.g. using local
configuration or DNS. The NRF may be network slice specific.
2) The NF instance information in the NRF includes:
\- the NF instance identifier;
\- the NF Set identifier (for AMFs);
\- the NF type (e.g. SMF);
\- the NF services it supports;
\- NF service authorization information to control whether a requester NF is
permitted to discover the NF; this includes:
\- the type(s) and PLMN ID of the NFs allowed to discover the NF instance
during the NF service discovery procedure;
\- the network slice(s) of the NFs allowed to discover the NF instance during
the NF service discovery procedure.
\- NF service specific information, per supported NF service, including:
\- NF service name;
\- NF service version;
\- protocols and addresss information (e.g. URI, IP address or FQDN) for use
by other NF to access the NF service; a NF service in a NF instance may be
accessible via different protocols and address information. Different services
of a same NF instance may be accessible via different address information;
\- NF service authorization information to control whether a requester NF is
permitted to access the NF service; this includes:
\- the type(s) and PLMN ID of the NFs allowed to access the NF for consuming
the NF service;
\- the network slice(s) of the NFs allowed to access the NF for consuming the
NF service;
\- notification endpoint (e.g. notification URL) for each type of notification
that the NF service is interested in receiving (i.e. subscription to
notifications via the NRF);
\- the PLMN ID and the network slice instance(s) to which the NF instance
pertains;
\- the static capacity of the NF instance at the NF or NF service level
(relative to other NF instances of the same type);
\- the supported DNNs, for SMF instances;
\- the location of the NF (e.g. list of TAIs the NF instance can serve);
\- Load information at the NF and NF service level.
3) A Requester NF instance shall include in the discovery request to the NRF:
\- the target NF Service Name;
\- the NF type of the target NF (e.g. SMF);
\- the NF Type of the Requester NF.
The Requester NF instance may additionally include the following parameters in
the discovery request to the NRF:
\- S-NSSAI;
\- target NF/NF service PLMN ID (e.g. to select an SMF in a HPLMN);
\- serving PLMN ID;
\- NF Service Consumer ID;
\- DNN (applicable to SMF instances only);
\- DNAI (applicable to SMF instances only);
\- specific NF Service Producer Instance (e.g. to get discovery information if
a Requesting NF is a NF Service Producer with an existing binding to a NF from
which it wants to receive reciprocal services);
\- user location information (e.g. TAI or Cell Id), e.g. to discover a target
AMF during inter-AMF handovers based on the target cell, or to discover an SMF
in a certain service area;
4) The NRF shall return only those NF instances and NF service instance(s)
that match the attributes specified by the Requester NF. It shall provide all
NF instance and NF service instance information specified in 2), except NF
Service Authorization Information shall only indicate for each returned NF
instance, the subset of the NF service instance(s) authorized for the
Requesting NF, and DNN / DNAI information shall only be a subset of the
requested DNNs/DNAIs.
5) The NRF shall be able to authenticate the Requester NF and authorize the NF
service discovery request based on the Requester NF attributes (e.g. NF type,
PLMN ID) and the requested NF service attributes (e.g. NF type).
6) A Requester NF instance shall be able to cache the NF instance(s) and NF
service instance(s) it has discovered. The cache may be used for future NF
service discovery, for the same or different UEs. The NRF shall be able to
return in the NF service discovery response a validity period during which the
returned information is considered as valid and can be cached by the requester
NF instance.
7) A NF instance shall be able to subscribe to loading level updates and
registration events (update or new registration, or de-registration) for
specific NF type(s), NF service(s), Network Slices and/or NF instance(s), e.g.
to get notified about the availability of a new NF instance or about the
unavailability of existing NF instances.
NOTE: Requirements about subscriptions to loading level updates need further
discussion.
8) Multiple UDM instances serving dedicated subscriber groups may be deployed
within one PLMN. Hence it shall be possible to discover and select the UDM
instance based on the subscriber identity (SUPI).
#### 6.8.1.3 NF service selection
The following CT4 requirements apply for NF service selection:
1) If there is already a binding between the Requester NF and the Provider NF,
both NFs consume services from each other; e.g. if an AMF-1 instance has
selected an SMF-1 instance for a PDU session establishment, SMF-1 shall use
AMF-1\'s services for the same PDU session;
2) If there is no binding yet between a Requester NF and a Provider NF, the
Requester NF discovers the NF instances supporting the expected NF service
according to the principles of subsclause 6.8.1.2. The Requester NF then
selects one NF instance among the discovered NF functions.
#### 6.8.1.4 NF Service Registration and De-registration
The stage 2 requirements on NF Service Registration and De-registration
requires CT4 to specify a mechanism to enable a NF Service Producer or another
authorized entity such as an OAM function to:
\- register its NF instance related information and supported NF service
instance(s) on the NRF;
\- update the NRF if there is any change on the information it has registered
on the NRF, e.g. due to upgrade of the services, the change of Endpoint
information of a NF service;
\- de-register itself from the NRF;
in order to keep the NRF aware of the available NF Service Producer instances
and their supported services.
The NF instance while registering the list of NF services it supports, for
each NF service, may provide a notification endpoint information for each type
of notification service that the NF service is prepared to consume, to the NRF
during the NF instance registration. The NF instance may also update or delete
the NF service related parameters (e.g to delete the notification endpoint
information).
### 6.8.2 Solution and Protocol Selection
#### 6.8.2.1 Solution 1 -- NRF interface realized by Service Based Interface
##### 6.8.2.1.1 Solution Description
The NRF exhibits a service based interface, designed according to the general
design principles of the 5GC Service Based Architecture, enabling:
\- a NF Service Producer to register, update or de-register its NF instance
information and the list of services it supports to the NRF, according to the
requirements specified in subclause 6.8.1.4; this includes the possibility for
the NF Service Producer to update the NRF with its load level information;
\- a NF Service Producer to renew periodically its registration to the NRF, to
a**llow the NRF to monitor the availability of the registered NF Service
Producers and stop advertising NF Service Producers, that would fail to renew
their registration, during subsequent NF Discovery procedures;**
\- a NF Service Consumer to discover NF Service Producer instances supporting
a specific NF type and NF service(s) according to the requirements specified
in subclause 6.8.1.2;
\- a NF Service Consumer to subscribe (or unsubscribe) to load level updates,
registration events and/or other information, for specific NF type(s), NF
service(s) and/or NF instance(s) according to the requirements specified in
subclause 6.8.1.2;
\- the NRF to notify NF instances about load level updates and/or subscribed
registration events according to the requirements specified in subclause
6.8.1.2.
NOTE 1: It is not yet decided whether to transfer the load information via the
NRF or not.
Figure 6.8.2.1.1-1: NF Service Registration
Figure 6.8.2.1.1-2: NF Service Update
Figure 6.8.2.1.1-3: NF Service De-Registration
Figure 6.8.2.1.1-4: NF Service Discovery in the same PLMN
Figure 6.8.2.1.1-5: NF Service Discovery across PLMNs
Figure 6.8.2.1.1-6: NF Service Subscription
Subscription to load level updates and/or registration events may be performed
as part of a discovery request procedure or in a standalone NFStatus_Subscribe
request procedure.
Figure 6.8.2.1.1-7: NF Service Unsubscription
Figure 6.8.2.1.1-8: NF Service Notification
A NF Service Producer may signal Load level updates to the NRF as part of
renewing its registration to the NRF.
The NRF communication protocol is the same protocol as chosen for other 5GC
Service Based Interfaces (e.g. HTTP/2). The NRF service operations are
modelled as REST APIs.
How the NRF stores and handles NF instances\' information (see subclause
6.8.1.2) and NF subscription requests is out of scope of 3GPP, i.e.
implementation specific.
NOTE 2: Implementations can rely e.g. on DNS, DSF or internal data storage.
##### 6.8.2.1.2 Evaluation
The solution enables to support all the stage 2 NRF requirements specified in
3GPP TS 23.501 [2] and 3GPP TS 23.502 [3] and is future proof to support more
stage 2 requirements.
NOTE: Existing service discovery protocols, such as DNS procedures, would not
easily accommodate the variety of 5G functional requirements (e.g. location
awareness, network slicing, integration with MANO, DNN, DNAI, 3GPP security
requirements, etc). DNS may be used internally by the NRF to aid with NF
discovery, but this is implementation specific.
The NRF is an integral part of the 5G Service Based Architecture and supports
the same protocol (e.g. HTTP/2) as other 5G CP NFs. 5G CP NFs do not need to
support a different and specific protocol for NF service discovery.
NRF messaging is defined in 3GPP. NRF APIs are easily extensible.
This approach is similar in principle to the (RESTful) Service Discovery APIs
supported by the MEC architecture (see ETSI GS MEC 011 [61]).
The solution allows 3GPP to focus on the NRF interface definition only, which
provides a great flexibility on how to design the NRF.
#### 6.8.2.2 Solution 2 -- Service Discovery and Registration using NRF
services
##### 6.8.2.2.1 Solution Description
The solution includes the following aspects:
1) The NRF shall employ Nnrf_NFManagement Service for the service registration
and Nnrf_NFDiscovery Service for discovery;
2) The Nnrf_NFManagement service and Nnrf_NFDiscovery service are invoked by
using a standardized RESTful HTTP API;
3) Each NF which offers at least one NF service (so it is the Service Producer
for that service) shall perform self-registration, e.g. informing its NF
Profile and other NF services parameters to the NRF, by invoking the
Nnrf_NFManagement service, e.g. using POST to create, PUT to update, DELETE to
de-registration when the NF and its services are initiated, or modified
subsequently, or removed for maintenance.
4) The NF Service Producer shall update the NRF when there is any change to
the information it has registered in the NRF, e.g. changing end point
information for a NF service;
**5) To allow NRF monitoring the availability of the NF and/or it NF services
in case of failure, a** heartbeat on the NF service level between NF Service
Producer and NRF may be employed, or the NF Service producer shall
periodically update the status of NF service, using an NRF service operation;
6) The NF Service Consumer shall query desired NF services by invoking the
Nnrf_NFDiscovery service, using HTTP GET, with a set of information (as
specified in subclause 6.8.1.2) as keyword. The candidates NF instance
information may be cached in the Service Consumer but should be valid less
than the period to Service Provider NF update)
##### 6.8.2.2.2 Evaluation
Pros:
\- The solution utilizes the same protocol as for invoking the NF service by
using HTTP, thus it reduces the complexities;
\- The Self-Service Registration makes that the information posted on the NRF
always truly reflect the latest status of the NF services (without any delay).
Cons:
\- More network signalling, e.g. for HTTP PUT, if NF and NF service are
updated frequently, e.g. due to Service upgrade, due to new instantiation.
#### 6.8.2.3 Solution 3 -- Classification and Update of NF Instance Parameters
##### 6.8.2.3.1 Solution Description
A normal way to configure the NF instance parameters to the NRF is via
management system, e.g. OAM or MANO system. In addition, it is useful to allow
the NF to update its own NF instance parameters to the NRF, e.g. at the first
time when the NF is deployed, or when the NF changes its NF service
parameters. Before a NF can initiate parameters update to the NRF, it requires
some fundamental NF instance parameters to be pre-configured in the NRF so as
to provide a record entry for updating and allow the NRF to authenticate the
requester NF.
NOTE: It is up to SA3 to define the security requirements and mechanisms that
should apply to the NF registration procedures.
Based on the above consideration, the NF instance parameters stored in the NRF
can be classified in two categories:
a) Fundamental parameters which need to be pre-configured in the NRF;
b) Other parameters which allow dynamically updated by the NF;
The category (A) parameters are pre-configured in the NRF via management
system e.g. OAM or MANO system. The category (B) parameters may also be pre-
configured in the NRF, but it allows dynamically updated by the NF hosting the
NF instance identifier.
Furthermore, a requester NF can subscribe the change of NF instance parameters
of the requested NF, and thus be notified with the change if the requested NF
performs NF instance parameter update procedure to the NRF.
##### 6.8.2.3.2 Classification of NF Instance Parameters in NRF
NF instance parameters stored in the NRF are classified into two different
categories:
a) Fundamental NF instance parameters that need to be pre-configured in the
NRF:
> \- the NF instance identifier;
>
> \- the NF type (e.g. AMF, SMF);
>
> \- the NF instance authentication info (e.g. NF instance token-id);
>
> The NF instance token-id is used for authenticate the requester NF when the
> requester NF attempts to update the NF instance parameters belonging to the
> requester NF.
b) Other NF instance parameters that allow dynamic updated by NF:
> \- NF service authorization information to control whether a requester NF is
> permitted to discover the NF;
>
> \- NF supported NF services and NF service info, such as: NF service
> version, protocol and address info, NF service authorization info, etc;
>
> \- the PLMN ID and the network slice instance(s) to which the NF instance
> pertains;
>
> \- the static capacity of the NF instance at the NF or NF service level;
>
> \- the supported DNNs, for SMF instances.
The parameters listed in category B are not complete and will be updated
according to further studying in CT group.
NOTE: It is FFS which criteria are used to determine which parameter is to be
provisioned via 3rd party, e.g. OAM and which parameter is to be provided by
NF (service producer).
##### 6.8.2.3.3 Update NF Instance Parameters in NRF
When a NF is deployed in the network for the first time, or a NF changes its
NF instance parameters, the NF initiates NF Parameter Update procedure (e.g.
by invoking the NF Register procedure provided by the Nnrf service interface)
to the NRF, including the NF instance parameters to be updated.
Figure 6.8.2.3.3-1 NF Parameter Update procedure
Step 1. The requester NF sends NF Parameter Update Request to the NRF,
including NF instance identifier, NF instance token, NF instance parameters to
be updated;
Step 2. The NRF authenticates the requester NF and verifies the provided NF
instance token. If successful, the NRF updates NF instance parameters stored
in the NRF with the new NF instance parameters provided by the requested NF,
and sends response message to the requester NF.
##### 6.8.2.3.4 Subscribe and Notify Change of NF Instance Parameters
When a NF needs to discover certain type of NF, it performs NF discovery
procedure to the NRF. After successfully retrieving the information of
requested NF, the requester NF can subscribe the change of NF instance
parameters of the requested NF(s) from the NRF, if needed.
When the requested NF performs NF instance parameter update to the NRF, the
NRF initiates notification to all NFs which have subscribed the change of NF
instance parameters of that requested NF, including the changed NF instance
parameters.
##### 6.8.2.3.5 Evaluation
The solution provides the capability to allow a NF to update its NF instance
parameters stored in the NRF. Other NFs can be notified about the change of NF
instance parameter of a dedicated NF if those NFs have subscribed the change
of NF instance parameters of this dedicated NF.
#### 6.8.2.4 Solution 4 -- Report the Status of NF (NF Service) to the NRF by
Management System
##### 6.8.2.4.1 Solution Description
As specified in 3GPP TS 23.501 [2], during the NF (NF service) discovery
procedure, the NRF shall select appropriate NF (NF service) instance(s) which
are available to serve the requester NF. Such requirement implies that the NRF
needs to know the status of a NF (NF service) instance so as avoid selection
of unavailable NF (NF service) instance. Hence, certain mechanism is required
to make the NRF be aware of the status of NF (NF service) instance.
Normally, management interfaces are deployed between NFs and management system
(e.g. MANO), and the status detection of a NF (NF service) instance is one of
the basic functionality for such management interfaces.
Once the management system detects one NF (NF service) instance is now
unavailable, its reporting function can thus notify the unavailable status of
detected NF (NF service) to the NRF. To allow such status notification, the
reporting function of the management system shall be configured as an
authorized NF.
The reporting function of the management system can use the NF
Registration/Registration-Update procedure to notify the unavailable status of
a detected NF (NF service), as illustrated in figure 6.8.2.4.1-1. The NRF may
further detect the status of detected NF (NF service) instance, before it
changes the status of detected NF (NF service) to unavailable.
Figure 6.8.2.4.1-1 Report the Status of NF (NF Service)
##### 6.8.2.4.2 Evaluation
Pros:
\- Signalling load to NRF is reduced, since no need for the NRF to
continuously send Heartbeat message to a large number of NFs;
\- Possible to reuse the capability of management system (e.g. MANO) to detect
the status of NFs.
Cons:
\- Need to configure the reporting function of the management system as
authorized NF for reporting NF (NF service) status.
### 6.8.3 SMF discovery and selection
#### 6.8.3.1 Requirements
The SMF selection function is supported by the AMF.
The following criteria are considered during the SMF selection:
\- selected Data Network Name (DNN);
\- network slice instance (derived from S-NSSAI);
\- subscription information from UDM, e.g. whether LBO may apply to the PDU
session;
\- local operator policies;
\- load conditions of the candidate SMFs;
\- user location information, e.g. to select an SMF in a certain service area.
In the HR roaming case, the SMF selection function selects an SMF in the VPLMN
and in the HPLMN.
### 6.8.4 UPF discovery and selection
#### 6.8.4.1 Requirements
In selecting a UPF, the SMF may consider the following (see subclause 6.3.3 of
3GPP TS 23.501 [2]):
\- UPF\'s dynamic load.
\- UPF\'s relative static capacity among UPFs supporting the same DNN.
\- UPF location available at the SMF.
\- UE location information
\- Capability of the UPF and the functionality required for the particular UE
session: An appropriate UPF can be selected by matching the functionality and
features required for an UE.
\- Data Network Name (DNN).
\- PDU session type.
\- Features required from the UPF such as support of UL CL, IPv6 branching
Point or PDU session anchor.
\- UE subscription profile in UDM (e.g. whether LBO is permitted or not for
the PDU session).
\- Application requests (e.g. DNAIs to be used for UPF selection to divert
locally some traffic matching traffic filters provided by the PCF, see
subclause 5.6.7 of 3GPP TS 23.501 [2]).
\- Local operator policies.
\- Network slicing related information.
The SMF shall attempt to setup a PDU session to a UPF that supports the
requested LADN if:
\- the SMF receives a request for PDU session setup to a LADN,
\- the UE is authorized to access the LADN, and
\- the UE is located within the LADN availability area.
The SMF shall attempt to select/reselect the UPF with the indicated DNAI if:
\- the UE is located within the LADN availability area for a PDU session,
\- the SMF receives a PCC rule containing a DNAI, and
\- the SSC Mode of the PDU Session permits.
#### 6.8.4.2 Solution 1 -- UPF Discovery Using the NRF
##### 6.8.4.2.1 Solution Description
Solution 1 uses the NRF to support discovery of UPFs by the SMF. For this
solution, the requirements in subclause 6.8.1.2 for discovery of CP NFs also
apply to discovery of the UPF by the SMF. Since the UPF has no services based
interface with the NRF, the NRF receives registration/de-registration and
registration modification of UPF records via OAM functions.
The SMF may supply one or more DNN and optionally a DNAI per DNN in a UPF
discovery query to the NRF. The NRF returns only those UPFs that can serve a
requested DNN and DNAI (if included); for each UPF returned in the response,
the NRF indicates the DNN(s) and DNAI(s) supported by the UPF.
### 6.8.5 AUSF discovery and selection
#### 6.8.5.1 Requirements
The AMF may use the NRF function in order to discover the AUSF instance. When
contacting the AUSF, the AMF provides the user identity (e.g. SUPI or NAI) to
the AUSF. However, this user identity is only used by the AUSF as an access
key into the UDM to retrieve the security material derived from the security
root key stored into the UDM and shared with the UE.
Moreover, the AUSF does not maintain any state after the UE authentication. It
means that the AMF can contact any AUSF in the home network that will be then
able to contact the relevant UDM based on the user identity provided by the
AMF.
NOTE: It is FFS whether an AUSF can contact a UDM for any user.
Therefore, the requirements for the AUSF selection are the following:
\- Identify the home operator network in charge of the UE
\- find an AUSF instance in the home network
#### 6.8.5.2 Candidate Solutions
##### 6.8.5.2.1 DNS-based implementation
In this solution, the following principles apply:
\- The home network domain name derivation:
\- The home network domain name is derived from the user identity.
\- It is assumed that the user identity (SUPI or NAI) will either contain a
home network domain name or there is a simple mechanism that can be used to
derive the home network domain name based on the user identity (e.g. IMSI-
based derivation defined in the 3GPP TS 23.003 [9]).
\- DNS-based Service Instance Resolution query:
\- The list of AUSF instance available in the home network domain name is
discovered using a DNS SRV and DNS TXT record. The SRV record has a name of
the form \"\.\.\\", with \"ausf\" used as service
name, and gives the target host and port where the service instance can be
reached.
\- The client (e.g. AMF) discovers the list of available instances of a given
service type \"ausf\" using a query for a DNS PTR record with a name of the
form \"\.\\", which returns a set of zero or more names,
which are the names of the aforementioned DNS SRV/TXT record pairs. For more
details, see IETF RFC 6763 [10].
##### 6.8.5.2.2 Evaluation
### 6.8.6 UDM discovery and selection
#### 6.8.6.1 Requirements
Multiple UDM instances serving dedicated subscriber groups may be deployed
within one PLMN.
It shall be possible to discover and select the UDM instance serving a
particular subscriber based on the subscriber identity (SUPI).
The NRF shall provide UDM discovery information irrespective of any specific
subscriber identity or based on a SUPI. A proxy or similar function in the
HPLMN can be used to ensure that requests are sent to a specific UDM instance
based on the SUPI.
### 6.8.7 AMF discovery and selection
#### 6.8.7.1 AMF discovery by 5G-AN via DNS
The 5G-AN (NG-RAN and N3IWF) is responsible for initiating SCTP connectivity
with the AMF. This requires the 5G-AN to first obtain the AMF\'s IP address.
In E-UTRAN, the association of MMEs to an eNB is quite static. Therefore, the
IP addresses of MMEs are typically pre-configured to the eNB via OAM.
In 5GS however, the association of AMFs to 5G-AN nodes can be dynamic, e.g. in
virtualized deployments where AMF instances may be added or removed for
scalability or planned maintenance. In order to support dynamic associations
between AMF and NG-RAN nodes, SA2 agreed the following requirement in
subclause 5.21.2.1 (AMF Addition/Update) of 3GPP TS 23.501 [3]:
> _Information about new AMF should be published and available in the DNS
> system. It should allow 5G-AN to discover AMF and setup associations with
> the AMF required._
It allows the option for the 5G-AN to obtain the AMF IP endpoint(s) via DNS,
as a possible alternative to OAM.
It is proposed to standardize in CT4 (in 3GPP TS 29.303 [62]) the stage 3 DNS
procedure for AMF discovery by 5G-AN to ease 5G-AN implementations and
interoperability (RAN and CN operators may be different when using network
sharing), and ensure a clear and uniform AMF discovery procedure for all
5G-ANs (eNBs, gNBs, N3IWF connected to 5GC).
5G-ANs may discover available AMFs e.g. based on (pre-configured) AMF Regions
or AMF Set IDs or based on the TAIs the 5G-ANs are serving. The exact
procedure (and criteria for AMF discovery) will be determined during the stage
3 normative work.
NOTE: The 5G-AN learns during the subsequent setup of the NGAP association the
GUAMIs and S-NSSAIs the AMF is supporting (see subclause 16.3.4.2 of 3GPP TS
38.300 [29]).
### 6.8.8 SMSF discovery and selection
#### 6.8.8.1 Requirements
The SMSF selection function is supported by the AMF.
The following criteria are considered during the SMSF selection:
\- the PLMN ID and network slice instance;
\- load conditions of the candidate SMSFs;
For roaming scenario, it is required to always select an SMSF in the visited
PLMN.
### 6.8.9 Conclusions
## 6.9 Unstructured Data Storage Function Procedures and Services
### 6.9.1 Requirements
The 5G system supports \"stateless\" NFs where the \"compute\" resource is
decoupled from the \"storage\" resource. When NFs are implemented according to
this architecture, they store and retrieve their unstructured data into/from a
storage function: the Unstructured Data Storage Function (UDSF).
NOTE 1: Unstructured data does not mean the data has no structure but rather
that it does not need to be specified by 3GPP CT4. The data of one NF is
opaque for the UDSF, for the NFs of a different type (e.g. the AMF is a NF of
a different type than the SMF) and for the NFs of the same type but from
different vendors.
Figure 6.9.1-1 shows the data storage architecture for unstructured data.
{width="2.9805555555555556in" height="0.7034722222222223in"}
Figure 6.9.1-1: Data storage architecture for unstructured data from any NF
The requirements to the UDSF function are described below.
[Data management requirements:]{.underline}
The NF shall be able to store and retrieve the data with the following basic
operations:
\- Create data.
\- Read data.
\- Update data.
\- Delete data.
In addition the solution should support the following capabilities:
\- Transaction integrity.
\- Pessimistic locking.
If multiple instances of the same NF type and same vendor can read and write
the same data, the following additional operations may be considered:
\- Subscribe to notifications of data change.
\- Notification of a data change.
[Performance requirements:]{.underline}
The UDSF may be used to store data with very different characteristics and
with different real time performance requirements ranging from low to very
high ones.
The protocol used over N18 shall provide latency as low as possible.
[Multiple logical storage spaces:]{.underline}
NFs of the same type and same vendor may need to store different data in
different repositories. The UDSF shall support multiple logical storage
spaces. Each logical storage unit shall have a unique identifier.
[UDSF sharing:]{.underline}
NFs may share a UDSF for storing their respective unstructured data. NFs of
the same type and vendor shall have one or more different logical storage
spaces and it shall be possible to prevent NFs of another type or another
vendor from accessing it. NFs of different types or of different vendors shall
use different access keys.
[Collocation with UDR:]{.underline}
UDSF may be collocated with the UDR.
[Load and overload requirement:]{.underline}
The solution shall support load control mechanisms to allow an automatic
distribution of the traffic load amongst the different instances of the UDSF.
The solution shall support overload control mechanisms to protect UDSF
instance when they reach a congestion state and to request the NFs to throttle
the requests sent to the UDSF.
[Multiple data consistency levels:]{.underline}
Different NFs may require different data consistency levels.
NOTE 2: Whether the consistency level shall be passed over the N18 reference
point or used by the NF to select the UDSF and the logical storage space is
FFS.
[Security requirements:]{.underline}
Transport of messages between the NFs and UDSF should be protected to provide
privacy and data integrity. Client applications should be authenticated.
[NF independent:]{.underline}
The architecture described in Figure 6.9.1-1 is applicable to any NF. The
solution shall be independent from the NF type.
### 6.9.2 Solution and Protocol Selection
#### 6.9.2.1 Solution 1 -- Reuse of the Ud interface
##### 6.9.2.1.1 Solution Description
The solution 1 reuses the protocol defined in 3GPP TS 29.335 [12] based on
LDAP for data management messages and SOAP for notification and subscription
management.
LDAP is an extensible protocol. Load and overload management and consistency
level can be supported by defining new LDAP attributes and passing them in
existing commands and response codes.
##### 6.9.2.1.2 Evaluation
Pros:
\- The solution requires minimal work to the existing specification.
\- It supports most of the requirements.
\- LDAP is an extensible protocol.
Cons:
\- LDAP was designed to access directory servers with well-defined and
structured directory information models.
\- No load and overload management solution is specified in 3GPP TS 29.335
[12].
\- SOAP is heavier than required.
\- The capability to select the consistency level is not specified in 3GPP TS
29.335 [12].
#### 6.9.2.2 Solution 2 -- New Diameter application for data management
##### 6.9.2.2.1 Solution Description
The solution 2 relies on a new stateless Diameter application. A few commands
are needed to support the data management operations, the notification and the
subscription to notifications. The list below provides a mapping of CRUD
operations to new Diameter commands.
\- Database-Update-Request/Answer for Create/Update/Delete operations;
\- Database-Read-Request/Answer for Read operation;
\- Database-Subscribe-Request/Answer for subscribing to notification of data
change;
\- Database-Notify-Request/Answer for notifying the client of a data change;
The following list of AVPs has to be defined:
\- Key to identify the data;
\- Key-Space identifier;
\- Value to carry the data. The structure of the data is not defined at
Diameter level but XML or JSON could be used to structure it inside the AVP.
An empty value means that the data identified by the Key shall be deleted;
\- Consistency specifies the consistency requirement.
Load and overload control will be supported by the application by reusing
existing Diameter load and overload mechanisms.
NOTE: Whether advanced querying capabilities are required by the UDSF is FFS.
##### 6.9.2.2.2 Evaluation
Pros:
> \- Diameter is transported over SCTP that ensures in-sequence transport of
> messages. Multi-homing and redundant paths ensure resilience and
> reliability;
>
> \- SCTP doesn't suffer HOL blocking;
>
> \- Diameter is lightweight and provides high real time performances;
>
> \- The Diameter application is stateless. Hence it fulfils the stateless
> principle of the REST architecture;
>
> \- It is possible to design a very simple Diameter application fulfilling
> all requirements;
>
> \- Lot of operating systems now support SCTP API.
Cons:
> \- Diameter is not a native protocol to access core database;
>
> \- Lack of Diameter API support by operating systems.
#### 6.9.2.3 Solution 3 -- REST compliant HTTP based solution for managing
data in UDSF
##### 6.9.2.3.1 Solution Description
The solution 3 is based on HTTP/2 protocol. The list below provides a mapping
of CRUD operations to HTTP/2 methods.
\- Create operation => POST or PUT with URI;
\- Read operation => GET;
\- Update operation => PUT or PATCH;
\- Delete operation => DELETE.
The transport protocol will be TCP in Rel-15.
TCP may be replaced by QUIC over UDP in a later release to solve the HOL
blocking issue at transport level.
TCP can be secured with TLS that provides privacy and data integrity as well
as various methods for client and server authentication. QUIC is always
secured with TLS 1.3 ensuring compulsory privacy and data integrity.
JSON is used as the serialization mechanism.
OpenAPI is the Interface Description Language.
The "two client-server pair" solution for subscription and notification as
specified in subclause 6.2.2.2 will be used.
HTTP/2 is an extensible protocol and new headers can be defined by 3GPP to
fulfil 3GPP specific requirement such as load and overload management
information. Other solution such as modifying the JSON payload is under
consideration.
##### 6.9.2.3.2 Evaluation
Pros:
\- HTTP allows defining RESTful API;
\- The solution is aligned with the selected SBI protocol stack;
\- If QUIC becomes the transport protocol, it would solve the HOL blocking
issue at transport level like SCTP with embedded security features and fast
connection setup.
Cons:
\- HOL blocking issue if the transport protocol is TCP;
\- No native support of bi-directional communication, which is required for
notification;
\- Low real time performance.
#### 6.9.2.4 Solution 4 -- CQL based solution for managing data in UDSF
##### 6.9.2.4.1 Solution Description
The solution 4 is based on Cassandra Query Language. Cassandra is an open
source Column Store of the NoSQL database family. Cassandra and CQL are
developed and maintained by the Apache community. CQL supports basic CRUD
operations and many more advanced ones. Some are listed below:
\- Inserting data;
\- Querying;
\- Ordering;
\- Pagination;
\- Others...
CQL has a binary protocol version. CQL binary protocol is transported over
TCP/IP. It is an asynchronous protocol allowing multiplexing several requests
on a single connection. It supports connection pooling to achieve a reasonable
performance and scalability.
It is possible to tune the consistency level on a per-query basis with CQL.
CQL does not support it subscriptions and notifications as such. So it
requires using a different solution like Ud uses LDAP for CRUD and SOAP for
notifications.
CQL supports basic login/password client authentication and allows defining
Permissions on database resources per client application. CQL does not support
any ciphering capability as such but it can be transported over TLS providing
privacy and data integrity.
CQL does not support any load and overload management capability. It does not
define any framework for proprietary language extension making it hard to
enhance the language for 3GPP specific purposes.
##### 6.9.2.4.2 Evaluation
Pros:
\- High real-time performance;
\- CQL + TLS provide required security requirements.
Cons:
\- No load and overload management capability;
\- No proprietary language extension support;
> \- Apache Software Foundation is not an SDO;
>
> \- No native support of subscription and notification feature.
## 6.10 Structured Data Storage Function Procedures and Services
### 6.10.1 Requirements
#### 6.10.1.1 General
The UDR stores permanent data (Subscription Data, Policy Data) that are
subject to provisioning where the data structure need not be standardized, and
it stores transient/temporary data that are not subject to provisioning where
the data structure shall be standardize.
As depicted in Figure 6.10.1-1, the 5G system architecture allows any NF
(Provisioning-FE, UDM-FE, PCF-FE, NEF-FE, see 3GPP TS 23.501 [2] figure
4.2.5.2 and 3GPP TS 23.502 [3] table 5.2.11.1-1) to manage structured data in
the UDR using services offered by the UDR via the Nudr service based
interface. The UDR belongs to the same PLMN where the NF is located.
Figure 6.10.1-1: Data storage architecture for structured data
NOTE 1: structured data means that the UDR shall be aware of the structure
(data model). The data of the NF is not opaque for the UDR. For specific data
(e.g. subscription data, authentication data, policy data) the data\'s
structure is not to be standardized and a proprietary data model is used; for
other data (e.g. for exposure) the data\'s structure will be standardized by
3GPP.
NOTE 2: The UDR can store transient/temporary data for roaming subscribers.
NOTE 3: There can be multiple UDRs deployed in the network, each of which can
serve different kinds of NFs and store data for them, e.g. separate UDRs can
be deployed to serve UDM FE, PCF and NEF respectively.
The requirements for the Unified Data Repository Function include all
requirements for the User Data Repository as specified in 3GPP TS 23.335 [12].
In addition, the following requirements are identified:
[Data management requirements:]{.underline}
Same as the UDSF.
[Performance requirements:]{.underline}
Same as the UDSF.
[Multiple logical storage spaces:]{.underline}
Same as the UDSF.
[UDR sharing:]{.underline}
The UDR can be shared by the NEF, the PCF and the UDM.
[Collocation with UDSF:]{.underline}
The UDR can be collocated with UDSF.
[Load and overload requirement:]{.underline}
Same as for the UDSF.
[Multiple data consistency levels:]{.underline}
Same as UDSF.
[Security requirements:]{.underline}
Transport of messages between the NEF, UDM, PCF and UDR can be protected.
Client applications should be authenticated.
[Data structure requirements:]{.underline}
The structure of the following data stored in the UDR shall be standardized
(see 3GPP TS 23.501 [2] subclause 4.2.5):
\- Packet Flow Descriptions (PFDs) for application detection.
\- application request information for multiple UEs
\- structured data for exposure.
NOTE 4: Standardization of data models for these data are in the scope of CT3.
#### 6.10.1.2 Requirements on Services offered by the UDR
##### 6.10.1.2.1 Nudr_User Data Management Service
This service offered by the UDR to the Provisioning-FE allows the
Provisioning-FE to make use of the following service operations:
Create:
The Provisioning-FE inserts a new data record to the UDR.
Delete:
The Provisioning-FE deletes an existing data record from the UDR.
Update:
The Provisioning-FE modifies an existing data record in the UDR.
This service offered by the UDR to the NF allows the NF to make use of the
following service operations:
Query:
The NF retrieves data from the UDR.
Subscribe/Un-subscribe:
The NF subscribes/un-subscribes to notifications of data changes at the UDR.
Notify:
The UDR notifies the NF about a data change.
NOTE: UDR services according to 3GPP TS 23.502 [3] clause 5.2.11 (so far) seem
to only cover permanent subscription data (created, updated and deleted by the
Provisioning-FE, read and subscribed by/notified to the UDM and the PCF),
however, the UDR also stores transient/temporary data not subject to
provisioning. It is ffs which NFs create, update and delete
transient/temporary data stored at the UDR.
### 6.10.2 Solution and Protocol Selection
#### 6.10.2.1 Solution 1 -- Reuse of the Ud interface
##### 6.10.2.1.1 Solution Description
The solution 1 reuses the protocol defined in 3GPP TS 29.335 [12] based on
LDAP for data management messages and SOAP for notification and subscription
management.
LDAP is an extensible protocol. Load and overload management and consistency
level can be supported by defining new LDAP attributes and passing them in
existing commands and response codes.
##### 6.10.2.1.2 Evaluation
Pros:
\- The solution requires minimal work to the existing specification.
\- It supports most of the requirements.
\- LDAP is well adapted for storing structured data.
\- LDAP is an extensible protocol.
Cons:
\- No load and overload management solution is specified in 3GPP TS 29.335
[12].
\- SOAP is heavier than required.
\- The capability to select the consistency level is not specified in 3GPP TS
29.335 [12].
#### 6.10.2.2 Solution 2 -- New Diameter application for data management
##### 6.10.2.2.1 Solution Description
The solution 2 relies on a new stateless Diameter application as described in
subclause 6.9.2.2.
In addition, CT4 shall define the structure of the data carried in the Value
AVP in the same manner 3GPP CT4 defined the structure of the User-Data AVP of
the Sh. It is proposed to use JavaScript Object Notation (JSON). It is an open
and text-based data exchange format. Its syntax allows structuring the data
while being flexible, \"self-describing\" and easy to understand.
JSON data is written as name/value pairs where values can take one of the data
types below:
\- A string;
\- A number;
\- An object (JSON object);
\- An array;
\- A Boolean;
\- Null.
NOTE 1: Other data formats than JSON are FFS.
NOTE 2: Whether advanced querying capabilities are required by the UDR is FFS.
##### 6.10.2.2.2 Evaluation
Pros:
> \- Diameter is transported over SCTP that ensures in-sequence transport of
> messages. Multi-homing and redundant paths ensure resilience and
> reliability;
>
> \- SCTP doesn't suffer HOL blocking;
>
> \- Diameter is lightweight and provides high real time performances;
>
> \- The application is stateless. Hence it fulfils the stateless principle of
> the REST architecture;
>
> \- It is possible to design a very simple Diameter application fulfilling
> all requirements;
>
> \- Lots of operating system now supports SCTP API;
>
> \- JSON format allows structuring the data in a simple, human readable,
> flexible and effective way;
>
> \- JSON is lightweight for structured format.
Cons:
> \- Diameter is not a native protocol to access core database;
>
> \- Lack of Diameter API support by operating systems.
#### 6.10.2.3 Solution 3 -- REST compliant HTTP based solution for managing
data in UDR
##### 6.10.2.3.1 Solution Description
The solution 3 relies on the HTTP based solution as described in subclause
6.9.2.3 which is aligned on the selected SBI one.
JSON schema used by the OpenAPI specification allows structuring the data as
desired.
##### 6.10.2.3.2 Evaluation
Pros:
\- HTTP allows defining RESTful API;
\- The solution is aligned with the selected SBI protocol stack;
\- If QUIC becomes the transport protocol, it would solve the HOL blocking
issue at transport level like SCTP with embedded security features and fast
connection setup.
Cons:
\- HOL blocking issue if the transport protocol is TCP;
\- No native support of bi-directional communication, which is required for
notification;
Low real-time performance.
## 6.11 Void
## 6.12 Network Slice Selection Function Service and Procedures
### 6.12.1 Requirements
#### 6.12.1.1 General
The following subclauses provide an overview of the Network Slice Selection
Function (NSSF) and the functional requirements associated with the services
provided by the NSSF to the AMF related to the network slice selection.
#### 6.12.1.2 Overview of the NSSF
The NSSF supports the following functionality:
\- Selecting the set of network slice instances,
\- Determining the Allowed NSSAI,
\- Determining the AMF Set to be used to serve the UE, or, based on
configuration, a list of candidate AMF(s), possibly by querying the NRF,
\- Determine the NRF(s) to be used to select NFs/services.
#### 6.12.1.3 Requirements on Services offered by the NSSF to the AMF
As specified in subclause 5.15.5 of 3GPP TS 23.501 [2] and subclause 4.2.2 of
3GPP TS 23.502 [3], the following CT4 requirement applied between NSSF and
AMF:
AMF selection:
\- The AMF queries the NSSF, with Requested NSSAI, the Subscribed S-NSSAIs,
PLMN ID of the SUPI, location information, and possibly access technology
being used by the UE.
\- The NSSF returns to the current AMF the Allowed NSSAI and the target AMF
Set, or, based on configuration, the list of candidate AMF(s). The NSSF may
return the NRF(s) to be used to select NFs/services within the selected
Network Slice instance(s). It may return also information regarding rejection
causes for S-NSSAI(s) not included in the Allowed NSSAI which were part of the
Requested NSSAI.
SMF/UPF selection:
\- During the PDU session establishment procedure, if a Network Slice instance
was not selected during the Registration procedure for this specific S-NSSAI,
the AMF may query the NSSF with this specific S-NSSAI, location information,
PLMN ID of the SUPI to select the Network Slice instance to serve the UE and
to determine the NRF to be used to select NFs/services within the selected
Network Slice instance.
# 7 User Plane Management Procedures over N4
## 7.1 Requirements
This subclause provides an overview of the stage 2 requirements and procedures
for the UPF and the User Plane management over N4 specified in subclauses
5.7.1, 5.8.2, 6.2.3 and A.3.1.3 of 3GPP TS 23.501 [2] and subclauses 4.4 and
4.3.7 of 3GPP TS 23.502 [3]. Refer to these stage 2 references for a
comprehensive description of the requirements.
The User Plane Function (UPF) handles the user plane path of PDU sessions. The
UPF transmits the PDUs of the PDU session in a single tunnel between 5GC and
(R)AN.
The UPF supports the following functionalities:
\- External PDU session point of interconnect to Data Network;
\- Anchor point for Intra-/Inter-RAT mobility (including sending End Marker
packets);
\- PDU session type: IPv4, IPv6, Ethernet, Unstructured (type of PDU totally
transparent to the 5GS);
\- support of IPv6 multi-homed PDU session;
\- traffic detection capabilities;
\- packet routing & forwarding;
\- traffic usage reporting, e.g. allowing SMF support for charging, and/or
allowing the SMF to initiate a CN initiated deactivation of UP connection of
an existing PDU session when the UPF detects that the PDU Session has no user
plane data activity for a specified Inactivity period provided by the SMF;
\- SDF mapping to QoS Flows;
\- QoS enforcement for user plane, including:
\- packet filtering, gating, UL/DL rate enforcement, UL/DL Session-AMBR
enforcement (with the Session-AMBR computed by the UPF over the Averaging
window provisioned over N4, see subclause 5.7.3 of 3GPP TS 23.501 [2]), UL/DL
Guaranteed Flow Bit Rate (GFBR) enforcement, UL/DL Maximum Flow Bit Rate
(MFBR) enforcement, etc;
\- marking packets with the QoS Flow ID (QFI) in an encapsulation header on N3
(the QoS flow is the finest granularity of QoS differentiation in the PDU
session);
\- enabling/disabling reflective QoS activation via the User Plane, i.e.
marking DL packets with the Reflective QoS Indication (RQI) in the
encapsulation header on N3, for DL packets matching a QoS Rule that contains
an indication to activate reflective QoS.
\- Downlink packet buffering and downlink data notification triggering;
\- this includes the support and handling of the ARP priority of QoS Flows
over the N4 interface, to support priority mechanism (see subclause 5.22 of
3GPP TS 23.501 [2]):
\- \"For a UE that is not configured for priority treatment, upon receiving
the \"N7 PDU-CAN Session Modification\" message from the PCF with an ARP
priority level that is entitled for priority use, the SMF sends an \"N4
Session Modification Request\" to update the ARP for the Signalling QoS Flows,
and sends an \"N11 SM Request with PDU Session Modification Command\" message
to the AMF, as specified in clause 4.3.3.2 of TS 23.502 [3].
\- \"If an IP packet arrives at the UPF for a UE that is CM-IDLE over a QoS
Flow which has an ARP priority level value that is entitled for priority use,
delivery of priority indication during the Paging procedure is provided by
inclusion of the ARP in the N4 interface \"Downlink Data Notification\"
message, as specified in clause 4.2.3.4 of TS 23.502 [3].\"
\- Activation and release of the UP connection of an PDU session, upon UE
transition between the CM-IDLE and CM-CONNECTED states (i.e. activation and
release of N3 tunnelling towards the access network);
\- Uplink Classifier enforcement to support routing traffic flows to a data
network, e.g. based on the destination IP address/Prefix of the UL PDU;
\- Branching Point to support routing of traffic flows of an IPv6 multi-homed
PDU session to a data network, based on the source Prefix of the PDU;
\- Lawful intercept;
\- Uplink Traffic verification (SDF to QoS flow mapping, i.e. checking that
QFIs in the UL PDUs are aligned with the QoS Rules provided to the UE or
implicitly derived by the UE e.g. when using reflective QoS);
\- Transport level packet marking in the uplink and downlink, e.g. based on
5QI and ARP of the associated QoS flow;
\- Data forwarding between the SMF and the UE or DN, e.g. IP address
allocation or DN authorization during the establishment of a PDU session;
For IP PDU session type, the UPF traffic detection capabilities may detect
traffic using traffic pattern based on at least any combination of:
\- PDU session;
\- QFI;
\- IP Packet Filter Set, comprising:
\- Source/destination IP address or IPv6 network prefix;
\- Source / destination port number;
\- Protocol ID of the protocol above IP/Next header type;
\- Type of Service (TOS) (IPv4) / Traffic class (IPv6) and Mask;
\- Flow Label (IPv6);
\- Security parameter index.
\- Application Identifier: The Application ID is an index to a set of
application detection rules configured in UPF.
In the IP Packet Filter Set:
\- a value left unspecified in a filter matches any value of the corresponding
information in a packet;
\- an IP address or Prefix may be combined with a prefix mask;
\- port numbers may be specified as port ranges.
For Ethernet PDU session type, the SMF may control UPF traffic detection
capabilities based on at least any combination of:
\- PDU session;
\- QFI;
\- Ethernet Packet Filter Set, comprising:
\- Source/destination MAC address;
\- EtherType as defined in IEEE 802.3;
\- Customer-VLAN tag (C-TAG) and/or Service-VLAN tag (S-TAG) VID fields as
defined in IEEE 802.1Q
\- Customer-VLAN tag (C-TAG) and/or Service-VLAN tag (S-TAG) PCP/DEI fields as
defined in IEEE 802.1Q
\- IP Packet Filter Set, in case Ethertype indicates IPv4/IPv6 payload.
Packet Filter Set is used in the QoS rules or SDF template to identify a QoS
flow. The Packet Filter Set may contain packet filters for the DL direction,
the UL direction or packet filters that are applicable to both directions.
## 7.2 Comparison with Sxa/Sxb/Sxc reference points (CUPS in EPC)
### 7.2.1 General
This subclause analyses the commonalities and differences between the
requirements to be supported over the N4 reference point and those supported
over the Sxa, Sxb or Sxc reference points for Control and User Plane
Separation of EPC nodes (SGW, PGW and TDF) as specified in 3GPP TS 23.214 [6]
and 3GPP TS 29.244 [7].
### 7.2.2 Mapping of N4 requirements to CUPS
Table 7.2.2-1 provides an overview, for all the N4 requirements identified in
subclause 7.1, whether the required functionality over N4 is:
\- already supported by CUPS (this is denoted as \"S\");
\- not supported by CUPS (this is denoted as \"NS\");
\- partially supported by CUPS (this is denoted as \"PS\"); in this case, the
missing functionality or required modifications are documented in the
Comments.
Table 7.2.2-1: Mapping of N4 requirements to CUPS
+------------------+------------------+---------+------------------+ | N° | Main | CUPS | Comments | | | functionality | | | +------------------+------------------+---------+------------------+ | 1 | UPF transmits | S | There is no | | | the PDUs of the | | concept of | | | PDU session in a | | bearer within | | | single tunnel | | the 5G CN and | | | between 5GC and | | over N3. CUPS | | | (R)AN | | has been | | | | | designed in a | | | | | way to make the | | | | | UP function and | | | | | Sx interface | | | | | agnostic to the | | | | | concept of | | | | | bearer. | +------------------+------------------+---------+------------------+ | 2 | External PDU | S | | | | session point of | | | | | interconnect to | | | | | Data Network | | | +------------------+------------------+---------+------------------+ | 3 | Anchor point for | S | | | | Intra-/Inter-RAT | | | | | mobility | | | | | (including | | | | | sending End | | | | | Marker packets) | | | +------------------+------------------+---------+------------------+ | 4 | PDU session | PS | IPv4, IPv6 and | | | type: IPv4, | | non-IP PDN | | | IPv6, Ethernet, | | connections are | | | Unstructured | | supported in | | | (type of PDU | | CUPS. Ethernet | | | totally | | PDUs are not | | | transparent to | | supported. | | | the 5GS) | | | +------------------+------------------+---------+------------------+ | 5 | Support of IPv6 | S | In EPC, a UE can | | | multi-homed PDU | | request | | | session | | additional IPv6 | | | | | prefixes from | | | | | the PGW after | | | | | completing | | | | | stateless IPv6 | | | | | address | | | | | a | | | | | utoconfiguration | | | | | procedures. | +------------------+------------------+---------+------------------+ | 6 | Traffic | PS | Traffic | | | detection | | detection is not | | | capabilities, | | supported in | | | using traffic | | CUPS based on: | | | pattern based | | | | | on: | | - PDU session | | | | | | | | a) for IP | | - QFI | | | traffic | | | | | | | - Ethernet | | | - PDU session; | | traffic pattern | | | | | | | | - QFI; | | | | | | | | | | - | | | | | So | | | | | urce/destination | | | | | IP address or | | | | | IPv6 network | | | | | prefix; | | | | | | | | | | - Source / | | | | | destination | | | | | port; | | | | | | | | | | - Application | | | | | Identifier: The | | | | | Application ID | | | | | is an index to a | | | | | set of | | | | | application | | | | | detection rules | | | | | configured in | | | | | UPF; | | | | | | | | | | - protocol ID | | | | | of the protocol | | | | | above IP; | | | | | | | | | | - Type of | | | | | Service (TOS) | | | | | (IPv4) / Traffic | | | | | class (IPv6) and | | | | | Mask. | | | | | | | | | | b) for Ethernet | | | | | traffic | | | | | | | | | | - PDU session; | | | | | | | | | | - QFI; | | | | | | | | | | - 802.1q | | | | | header: VLAN | | | | | identifier | | | | | (VID), Priority | | | | | code point (PCP) | | | | | in case of | | | | | simple VLAN | | | | | tagging and in | | | | | case of double | | | | | VLAN tagging per | | | | | IEEE 802.1ad; | | | | | | | | | | - MAC address | | | | | with a | | | | | possibility to | | | | | identify | | | | | Multicast / | | | | | Broadcast | | | | | addresses; | | | | | | | | | | - EtherType as | | | | | defined in IEEE | | | | | 802.3; | | | | | | | | | | - when the | | | | | EtherType refers | | | | | to IP, any | | | | | combination of | | | | | the information | | | | | defined for the | | | | | IP PDU session | | | | | type | | | +------------------+------------------+---------+------------------+ | 7 | Packet routing & | S | | | | forwarding | | | +------------------+------------------+---------+------------------+ | 8 | Downlink packet | S | | | | buffering and | | | | | downlink data | | | | | notification | | | | | triggering | | | +------------------+------------------+---------+------------------+ | 9 | Activation and | S | | | | release of the | | | | | UP connection of | | | | | an PDU session, | | | | | upon UE | | | | | transition | | | | | between the | | | | | CM-IDLE and | | | | | CM-CONNECTED | | | | | states (i.e. | | | | | activation and | | | | | release of N3 | | | | | tunnelling | | | | | towards the | | | | | access network) | | | +------------------+------------------+---------+------------------+ | 9A | Release of the | S | | | | UP connection of | | | | | a PDU session, | | | | | when the UPF | | | | | detects that the | | | | | PDU Session has | | | | | no user plane | | | | | data activity | | | | | for a specified | | | | | Inactivity | | | | | period provided | | | | | by the SMF (i.e. | | | | | release of N3 | | | | | tunnelling | | | | | towards the | | | | | access network). | | | +------------------+------------------+---------+------------------+ | 10 | Uplink | PS | There is no | | | Classifier | | concept of UL | | | enforcement to | | Classifier | | | support routing | | enforcement in | | | traffic flows to | | CUPS. However, | | | a data network, | | the packet | | | e.g. based on | | forwarding model | | | the destination | | allows to | | | IP | | provision the UP | | | address/Prefix | | function with | | | of the UL PDU | | multiple Packet | | | | | Detection Rules | | | | | (PDRs) per Sx | | | | | session and with | | | | | different | | | | | forwarding | | | | | instructions | | | | | (i.e. FARs) | | | | | associated to | | | | | each PDR. For UL | | | | | traffic, PDRs do | | | | | only require | | | | | though to | | | | | consider the | | | | | F-TEIDu of the | | | | | incoming GTP-U | | | | | endpoint and | | | | | optionally the | | | | | source IP | | | | | address of the | | | | | packet (for | | | | | uplink bearer | | | | | binding | | | | | verification) | | | | | | | | | | The UL | | | | | Classifier | | | | | functionality | | | | | requires to | | | | | support UL PDRs | | | | | with Packet | | | | | Detection | | | | | Information also | | | | | comprising the | | | | | destination IP | | | | | address of the | | | | | packets. | +------------------+------------------+---------+------------------+ | 11 | Branching Point | PS | There is no | | | to support | | concept of | | | routing of | | Branching Point | | | traffic flows of | | in CUPS. | | | an IPv6 | | However, the | | | multi-homed PDU | | packet | | | session to a | | forwarding model | | | data network, | | allows to | | | based on the | | provision the UP | | | source Prefix of | | function with | | | the PDU | | multiple Packet | | | | | Detection Rules | | | | | (PDRs) per Sx | | | | | session and with | | | | | different | | | | | forwarding | | | | | instructions | | | | | (i.e. FARs) | | | | | associated to | | | | | each PDR. For UL | | | | | traffic, PDRs do | | | | | only require | | | | | though to | | | | | consider the | | | | | F-TEIDu of the | | | | | incoming GTP-U | | | | | endpoint and | | | | | optionally the | | | | | source IP | | | | | address of the | | | | | packet (for | | | | | uplink bearer | | | | | binding | | | | | verification) | | | | | | | | | | The Branching | | | | | Point | | | | | functionality | | | | | requires to | | | | | support UL PDRs | | | | | with Packet | | | | | Detection | | | | | Information | | | | | comprising | | | | | possibly | | | | | different source | | | | | IP addresses for | | | | | the packets. | +------------------+------------------+---------+------------------+ | 12 | Lawful intercept | S | | +------------------+------------------+---------+------------------+ | 13 | Data forwarding | S | | | | between the SMF | | | | | and the UE or | | | | | DN, e.g. IP | | | | | address | | | | | allocation or DN | | | | | authorization | | | | | during the | | | | | establishment of | | | | | a PDU session | | | +------------------+------------------+---------+------------------+ | | | | | +------------------+------------------+---------+------------------+ | PCC related | | | | | features | | | | +------------------+------------------+---------+------------------+ | 14 | SDF mapping to | PS | CUPS supports | | | QoS Flows | | Service | | | | | Detection and | | | | | Bearer binding, | | | | | i.e. mapping SDF | | | | | to bearers by | | | | | associating PDRs | | | | | with FARs | | | | | including the | | | | | remote GTP-U\'s | | | | | F-TEID. | +------------------+------------------+---------+------------------+ | 15 | QoS enforcement | | | | | for user plane, | | | | | including: | | | +------------------+------------------+---------+------------------+ | | - service | PS | Bearer MBR, | | | detection, per | | bearer GBR and | | | SDF traffic | | APN-AMBR | | | matching, for IP | | enforcement is | | | and Ethernet PDU | | supported in | | | traffic | | CUPS, which | | | | | corresponds to | | | - packet | | MFBR, GFBR and | | | filtering, | | Session-AMBR | | | | | enforcement in | | | - UL/DL SDF | | 5GS. | | | level gating, | | | | | | | Service | | | - UL/DL SDF | | detection using | | | level MBR | | Ethernet traffic | | | enforcement, | | pattern is not | | | | | supported in | | | - UL/DL SDF | | CUPS. | | | level GBR | | | | | enforcement, | | | | | | | | | | - UL/DL MFBR | | | | | enforcement, | | | | | | | | | | - UL/DL GFBR | | | | | enforcement, | | | | | | | | | | - UL/DL | | | | | Session-AMBR | | | | | enforcement,etc; | | | +------------------+------------------+---------+------------------+ | | - marking | NS | | | | packets with the | | | | | QoS Flow ID | | | | | (QFI) in an | | | | | encapsulation | | | | | header on N3; | | | +------------------+------------------+---------+------------------+ | | - Reflective | NS | | | | QoS Control, | | | | | i.e. | | | | | en | | | | | abling/disabling | | | | | reflective QoS | | | | | activation via | | | | | the User Plane, | | | | | i.e. marking DL | | | | | packets with the | | | | | Reflective QoS | | | | | Indication (RQI) | | | | | in the | | | | | encapsulation | | | | | header on N3, | | | | | for DL packets | | | | | matching a QoS | | | | | Rule that | | | | | contains an | | | | | indication to | | | | | activate | | | | | reflective QoS. | | | +------------------+------------------+---------+------------------+ | 16 | UL QFI to QoS | PS | CUPS supports | | | flow mapping | | Uplink bearer | | | verification | | binding | | | (i.e. checking | | verification, | | | that QFIs in the | | i.e. checking | | | UL PDUs are | | that UL traffic | | | aligned with the | | of an SDF or an | | | QoS Rules | | Application is | | | provided to the | | sent by the UE | | | UE or implicitly | | on the expected | | | derived by the | | uplink bearer | | | UE e.g. when | | and thus with | | | using reflective | | the right QoS. | | | QoS) | | This is done by | | | | | configuring UL | | | | | PDRs with the | | | | | uplink local | | | | | F-TEIDu, the UE | | | | | IP address and | | | | | SDF Filter or | | | | | Application ID. | | | | | | | | | | UL traffic | | | | | verification in | | | | | the 5GS requires | | | | | to check that | | | | | the UL traffic | | | | | matching the PDR | | | | | for the specific | | | | | SDF or | | | | | Application ID | | | | | carries the | | | | | expected QFI in | | | | | the N3 | | | | | encapsulation | | | | | header. | +------------------+------------------+---------+------------------+ | 17 | Transport level | S | Transport level | | | packet marking | | packet marking | | | in the uplink | | is based on the | | | and downlink, | | QCI and ARP in | | | e.g. based on | | CUPS, but this | | | 5QI and ARP of | | has no impact on | | | the associated | | the Sx interface | | | QoS flow | | since the DSCP | | | | | (and not the | | | | | QCI/ARP) is | | | | | signalled over | | | | | Sx. | +------------------+------------------+---------+------------------+ | 18 | UL/DL SDF level | S (FFS) | UL/DL SDF level | | | charging (online | | charging (online | | | & offline, per | | & offline) is | | | charging key) | | supported by | | | | | CUPS. | | | | | | | | | | Potential | | | | | extensions can | | | | | be required | | | | | depending on the | | | | | charging | | | | | requirements | | | | | which will be | | | | | specified by | | | | | 3GPP SA WG5. | +------------------+------------------+---------+------------------+ | 19 | Usage Monitoring | S | | +------------------+------------------+---------+------------------+ | 20 | Event Reporting | S | | | | (including | | | | | application | | | | | detection) | | | +------------------+------------------+---------+------------------+ | 21 | Traffic | S | | | | Redirection | | | +------------------+------------------+---------+------------------+ | 22 | Predefined PCC | S | | | | rules activation | | | | | and deactivation | | | +------------------+------------------+---------+------------------+ | 23 | PCC support for | S | | | | SDCI | | | +------------------+------------------+---------+------------------+ | 24 | Traffic steering | S | | | | control | | | +------------------+------------------+---------+------------------+
CUPS assumes the use of GTP-U tunnels within the Core Network.
### 7.2.3 Mapping of CUPS features to N4
The requirements for N4 are not yet defined in stage 2 with the same level of
details as those specified for CUPS in 3GPP TS 23.214 [6].
Table 7.2.3-1 provides an overview, for all the CUPS features specified in
3GPP TS 23.214 [6] and 3GPP TS 29.244 [7], on whether the functionality:
\- may apply to N4 (\"Y\");
\- does not apply to N4 (\"N\");
\- may partially apply to N4 (\"P\"); in this case, the expected differences
are documented in the Comments.
NOTE: Whether an existing CUPS feature will apply or not to N4 will ultimately
depend on the detailed stage 2 requirements, when available.
Table 7.2.3-1: Mapping of CUPS features to N4
* * *
CUPS Main functionality CUPS Sub-functionality N4 Applicability Comments A.
Session management (default & dedicated bearer establishment, bearer
modification, bearer deactivation) 1. Resource management for bearer resources
P For QoS flows establishment, modification and release. No bearer concept.
2\. IP address and TEID assignment for GTP-U Y  
3\. Packet forwarding Y  
4\. Transport level packet marking Y  
B. UE IP address management 1. IP address allocation from local pool Y  
2\. DHCPv4 / DHCPv6 client Y  
3\. DHCPv4 / DHCPv6 server Y  
4\. Router advertisement, router solicitation, neighbour advertisement,
neighbour solicitation (as in RFC 4861) Y  
C. Support for UE mobility 1. Forwarding of \"end marker\" (as long as user
plane to source eNB exists) Y  
2\. Sending of \"end marker\" after switching the path to target node Y  
3\. Forwarding of buffered packet Y  
4\. Change of target GTP-U endpoint within 3GPP accesses Y  
5\. Change of target GTP-U endpoint between 3GPP and non-3GPP access Y  
D. S1-Release / Buffering / Downlink Data Notification 1. ECM-IDLE mode DL
packet buffering; Triggering of Downlink Data Notification message generation
per bearer (multiple, if DL packet received on higher ARP than previous DDN);
Inclusion of DSCP of packet in DDN message for Paging Policy Differentiation Y  
2\. Delay Downlink Data Notification Request (if terminating side replies to
uplink data after UE service request before SGW gets updated) FFS Depends on
5GS requirements. 3\. Extended buffering of downlink data when the UE is in a
power saving state and not reachable (high latency communication); dropping of
downlink data (if MME has requested SGW to throttle downlink low priority
traffic and if the downlink data packet is received on such a bearer (see
clause 4.3.7.4.1a). FFS Depends on 5GS requirements. 4\. PGW pause of charging
procedure based on operator policy/configuration the SGW (failed paging,
abnormal radio link release, number/fraction of packets/bytes dropped at SGW)
FFS Depends on 5GS requirements. E. Bearer/APN policing 1. UL/DL APN-AMBR
enforcement Y Session-AMBR enforcement 2\. UL/DL bearer MBR enforcement (for
GBR bearer) Y UL/DL MFBR enforcement per QoS Flow 3\. UL/DL bearer MBR
enforcement (for nonGBR bearer on Gn/Gp interface) Y UL/DL GFBR enforcement
per QoS Flow F. PCC related functions 1. Service detection (DPI, IP-5-tuple) Y  
2\. Bearer binding (bearer QoS & TFT) P SDF mapping to QoS Flows 3\. UL bearer
binding verification and mapping of DL traffic to bearers P UL traffic
verification (SDF to QoS flow mapping) 4\. UL and DL service level gating Y  
5\. UL and DL service level MBR enforcement Y  
6\. UL and DL service level charging (online & offline, per charging key) Y
(FFS) Potential extensions can be required depending on the charging
requirements which will be specified by 3GPP SA WG5. 7\. Usage monitoring Y  
8\. Event reporting (including application detection) Y  
9\. Request for forwarding of event reporting Y  
10\. Redirection Y  
11\. Traffic steering Y  
12\. PCC support for NBIFOM N A PDU session is supported over a single access
network. 13\. DL DSCP marking for application indication N  
14\. Predefined PCC/ADC rules activation and deactivation Y  
15\. PCC support for SDCI Y  
G. NBIFOM Non-PCC aspects of NBIFOM N A PDU session is supported over a single
access network. H. Inter-operator accounting (counting of volume and time) 1.
Accounting per UE and bearer Y Traffic usage reporting is required over N4.
2\. Interfacing OFCS through reference points specified in TS 32.240 [9] Y
Traffic usage reporting is required over N4. I. Load/overload control
functions Exchange of load/overload control information and actions during
peer node overload Y  
J. Legal intercept Interfacing LI functions through reference points specified
in TS 33.107 [10] and performing LI functionality Y  
K. Packet screening function Y  
L. Restoration and recovery Y  
M. RADIUS / Diameter on SGi Y  
N. OAM interfaces FFS Depends on 5GS requirements. O. GTP bearer and path
management Generation of echo request, handling of echo response, echo request
timeout and Error Indication message Y Assuming re-use of GTP-U and
corresponding procedures P. Sx Heartbeat procedure Checking the responsiveness
of the Sx peer. Y  
Q. PFD Management procedures For Sponsored Data Connectivity Improvements Y  
R. Sx Association Setup / Update / Release procedure Sx Node related
procedures for establishing an Sx Association between the CP and UP function
before setting up Sx sessions. Y
* * *
## 7.3 Solution and Protocol selection for N4
### 7.3.1 Solution 1 -- N4 based on PFCP
#### 7.3.1.1 Solution Description
The analysis in subclauses 7.2.2 and 7.2.3 shows that there are a lot of
commonalities between the requirements for the N4 reference point and those
supported over the Sxa, Sxb or Sxc reference points for Control and User Plane
Separation of EPC nodes (SGW, PGW and TDF).
Besides, GTPv1-U is also used over the N3 and N9 interfaces (see clause 5),
like in the EPC.
The packet forwarding model specified in subclause 5.2 of 3GPP TS 29.244 [7],
which defines how the CP controls the processing of the packets in the UP
function, enables to support all the current N4 requirements without any
change to the model.
It is thus proposed to use PFCP (Packet Forwarding Control Protocol, see 3GPP
TS 29.244 [7]) over the N4 interface, with the addition of the extensions
required to support the 5GS requirements not supported by CUPS (see subclause
7.2.2); this includes:
\- new PDU session type Ethernet;
\- PDR extensions to support:
\- additional traffic detection capabilities (e.g. Ethernet PDU traffic
pattern);
\- the Uplink Classifier functionality, i.e. UL PDR which may include not only
the F-TEIDu of the incoming GTP-U endpoint and optionally a source IP address,
but also the destination IP address for routing specific traffic towards a
particular PDU session anchor;
\- the Branching Point functionality, i.e. the possibility to provision
multiple UL PDRs for a same N4 session comprising different source IPv6
address prefixes;
\- the QFI of a QoS flow for UL traffic detection, QoS flow mapping
verification and QoS flow enforcement;
\- QER extensions to support:
\- marking DL packets with QFI. SDF mapping to QoS flow can be supported by
associating a QER to a PDR (as per CUPS principles);
\- marking DL packets with RQI to enable/disable Reflective QoS Indication via
the user plane;
\- potential extensions for charging support (dependent on the charging
requirements which will be specified by 3GPP SA WG5).
NOTE: The list of required extensions can evolve as stage 2 normative work is
still in progress.
#### 7.3.1.2 Evaluation
Pros:
\- Only one protocol for CUPS and N4 interface.
\- Extensions valid for 5G and EPC have to be incorporated only once.
\- Combined node has to support only one session for Sx and N4, e.g. for EPC
interworking, a single NF acting as SMF+PGW-C controls a single UPF+PGW-U.
Cons:
\- Unnecessary IEs and references to Sxa/Sxb/Sxc interface in case of pure 5GC
where only N4 interface will be used.
\- Unnecessary IEs and references to N4 interface in case of EPC.
\- Future extensions have to be always backward compatible to both
architectures.
### 7.3.2 Solution 2 -- A new protocol based on PFCP
#### 7.3.2.1 Solution Description
As explained in subclause 7.3.1.1, there are a lot of commonalities between
the requirements for the N4 reference point and those supported over the Sxa,
Sxb or Sxc reference points for Control and User Plane Separation of EPC
nodes.
However, compared to subclause 7.3.1.1, it is proposed to define a new
protocol based on PFCP for this N4 interface and to document it in another
specification.
This new protocol will reuse the same message structure (headers and IEs) and
general PFCP mechanisms but it will have its own protocol number and will only
reuse common IEs while defining new required ones.
#### 7.3.2.2 Evaluation
Pros:
\- the PFCP protocol will not be impacted by N4 requirements;
\- the N4 protocol will not be impacted by new Sxa/Sxb/Sxc requirements;
\- the N4 protocol still benefit from the work done for PFCP while being
totally independent for the future;
\- Evolutions in the different architecture can be handled independently.
Cons:
\- a new port number must be allocated;
\- a new specification must be done;
\- the UPF will have to support two protocols for interworking with EPC: PFCP
with PGW-C and PFCP-N4 with SMF;
\- a combined SMF/PGW-C will have to support both protocols;
\- result in a lot of redundant text between the two specifications (or would
require to add a lot of cross references to 3GPP TS 29.244 -- not making it
easy to read), and would not make it easy to identify the differences.
## 7.4 Conclusions
It is concluded to choose solution 1 and enhance 3GPP TS 29.244 [7] to support
the N4 interface.
# 8 Interworking with E-UTRAN connected to EPC
## 8.1 Requirements
### 8.1.1 General
This subclause analyses the interworking between the 5GC and EPC when the UE
moves between an E-UTRAN connected to EPC and a 5G-AN connected to the 5GC.
This subclause provides an overview of the stage 2 requirements for 5GS
interworking with E-UTRAN connected to EPC specified in subclauses 4.3 and
5.17.2 of 3GPP TS 23.501 [2] and subclause 4.11 of 3GPP TS 23.502 [3]. Refer
to these stage 2 references for a comprehensive description of the
requirements.
### 8.1.2 Architecture Overview
In order to interwork with EPC, the UE that supports both 5GC and EPC NAS can
operate in single-registration mode or dual-registration mode:
\- In single-registration mode, UE has only one active MM state (either RM
state in 5GC or EMM state in EPC) and it is either in 5GC NAS mode or in EPC
NAS mode (when connected to 5GC or EPC, respectively). Similarly, the network
maintains one state either in the AMF or in the MME. UE maintains _a single
coordinated registration_ for 5GC and EPC.
\- In dual-registration mode, UE can handle independent registrations for 5GC
and EPC. In this mode, the UE may be registered to 5GC only, EPC only, or to
both 5GC and EPC.
Figure 8.1.2-1 represents the non-roaming architecture for interworking
between 5GS and EPC/E-UTRAN. Roaming architectures are described in subclause
4.3 of 3GPP TS 23.501 [2].
Figure 8.1.2-1: Non-roaming architecture for interworking between 5GS and
EPC/E-UTRAN
The support of the N26 interface is optional for the network and applicable to
the single-registration mode only. The dual-registration mode does not require
the support of the N26 interface.
Interworking procedures using the N26 interface enable the exchange of MM and
SM states between the source and target network. Single-registration mode
requires support for the N26 interface between the AMF in 5GC and the MME in
EPC to enable seamless session continuity (e.g. for voice services) for inter-
system change.
N26 supports a subset of the functionalities (essential for interworking) that
are supported over S10 (see subclause 4.3.1 of 3GPP TS 23.501 [2]).
Interworking procedures without the N26 interface are applicable to single-
registration and dual-registration modes. For interworking without the N26
interface, IP address continuity is provided to the UEs on inter-system
mobility by storing and fetching PGW-C+SMF and corresponding APN/DDN
information via the HSS+UDM. See details in subclause 5.17.2.3 of 3GPP TS
23.501 [2].
PCF + PCRF, PGW-C + SMF and UPF + PGW-U are dedicated for interworking between
5GS and EPC.
### 8.1.3 Procedure Requirements for the N26 interface
#### 8.1.3.1 Idle mode mobility from 5GS to EPS in single-registration mode
For idle-mode mobility from 5GC to EPC, the UE performs:
\- a TAU procedure with 4G-GUTI mapped from 5G-GUTI and the MME retrieves the
UE\'s MM and SM context from 5GC, if the UE has a PDU session established or
if the UE or the EPC support \"attach without PDN connectivity\";
\- an attach procedure, if the UE is registered without PDU session in 5GC and
the UE or the EPC does not support attach without PDN connectivity.
This requires the support of the following N26 procedure:
\- procedure allowing the MME to request the UE\'s MM and SM contexts from the
AMF, such as the Context Request procedure defined over S10.
#### 8.1.3.2 Idle mode mobility from EPS to 5GS in single-registration mode
For idle-mode mobility from EPC to 5GC, the UE performs registration procedure
with 5G-GUTI mapped from 4G-GUTI and the AMF and SMF retrieve the UE\'s MM and
SM context from EPC.
This requires the support of the following N26 procedure:
\- procedure allowing the AMF to request the UE\'s MM and SM contexts from the
MME, such as the Context Request procedure defined over S10.
#### 8.1.3.3 Handover from 5GS to EPS in single-registration mode
For connected-mode mobility from 5GC to EPC, inter-system handover is
performed (see subclause 4.11.1.1 of 3GPP TS 23.502 [3]).
This requires the support of the following N26 procedure:
\- Relocation Request (Target E-UTRAN Node ID, Source to Target Transparent
Container, mapped MM and SM EPS UE Context (default and dedicated bearers),
from AMF to MME; the SGW-C and SGW-U F-TEIDs are such that target MME selects
a new SGW;
\- Relocation Response (Cause, List of Set Up Bearers, MME\'s TEID for Control
Plane, RAN Cause, Target to Source Transparent Container, Address(es) and
TEID(s) for Data Forwarding), from MME to AMF.
NOTE As described in 3GPP TS 23.502 [3], during PDU session establishment and
GBR QoS flow establishment, EPS QoS mappings and EPS Bearer IDs are allocated
such that non-GBR flows map to default EPS bearer (which is allocated an EPS
bearer ID) and EPS Bearer IDs are allocated for the GBR flows that are mapped
to dedicated bearers in EPC. The EPS Bearer Id and mapped QoS parameters for
these bearer is also provided to the UE and PGW-C+SMF. The mapped EPS QoS
parameters may be provided to PGW-C+SMF by the PCF+PCRF, if PCC is deployed.
The source AMF selects the target MME based on the Target ID (including the
target eNB ID and TAI) received from the source NG RAN.
#### 8.1.3.4 Handover from EPS to 5GS in single-registration mode
For connected-mode mobility from EPC to 5GC, inter-system handover is
performed (see subclause 4.11.1.2 of 3GPP TS 23.502 [3]).
This requires the support of the following N26 procedure:
\- Forward Relocation Request (Target 5G-RAN Node ID, Source to Target
Transparent Container, EPS MM Context, EPS Bearer Context(s)), from MME to
AMF; the MME UE context includes IMSI, ME Identity, UE security context, UE
Network Capability and EPS Bearer context(s). An EPS bearer context includes
the common SMF+PGW-C address and V-CN Tunnel Info at the UPF+PGW-U for uplink
traffic, and APN;
\- Forward Relocation Response (Cause, Target to Source Transparent Container,
SGW Change Indication, EPS Bearer Setup List, AMF F-TEID for Control Plane,
Addresses and TEIDs), from AMF to MME;
\- Forward Relocation Complete Notification, from AMF to MME;
\- Forward Relocation Complete Notification Ack, from MME to AMF.
The source MME selects the target AMF based on the Target ID (including the
target 5G-RAN Node ID and TAI) received from the source eNB.
## 8.2 Solution and Protocol Selection
### 8.2.1 Solution 1 -- N26 interface realized by Reference Point based on S10
interface
#### 8.2.1.1 Solution Description
It is proposed to define the N26 interface based on the S10 interface
specified in 3GPP TS 29.274 [28], limited to the following set of messages and
with the following tentative adaptations:
\- Context Request, with:
\- a new RAT-type value for NR;
\- Context Response, with:
\- changes to the SGW S1/S4/S12/S11 IP Address and TEID for user plane IE (no
SGW in 5GS);
\- possible additions of new PDU session and bearer context related parameters
that would need to be preserved upon mobility back and forth between 5GC and
EPC (e.g. SSC mode);
\- possible additions to the MM Context for parameters that would need to be
preserved upon mobility back and forth between 5GC and EPC;
\- Forward Relocation Request, with:
\- changes to the SGW S11/S4 IP Address and TEID for Control Plane and SGW
node name IEs (no SGW in 5GS);
\- using the E-UTRAN Transparent Container IE to exchange RAN Transparent
Containers between E-UTRAN and the NG RAN;
\- with a new NG-AP Cause IE to forward causes received from the NG-RAN;
\- possible additions of new PDU session and bearer context related parameters
that would need to be preserved upon mobility back and forth between 5GC and
EPC (e.g. SSC mode);
\- possible additions to the MM Context for parameters that would need to be
preserved upon mobility back and forth between 5GC and EPC;
\- Forward Relocation Response, with:
\- requiring the List of Set-up Bearers IE to be present if the source or
target access is 5G-RAN;
\- with a new NG-AP Cause IE to forward causes received from the NG-RAN;
\- using the E-UTRAN Transparent Container IE to exchange RAN Transparent
Containers between E-UTRAN and the NG RAN;
\- new IE or renaming of existing IEs (e.g. eNodeB F-TEID for DL data
forwarding) for use with 5GS;
\- Forward Relocation Complete Notification;
\- Forward Relocation Complete Acknowledge;
\- Identification Request;
\- Identification Response.
NOTE: The registration call flows in subclause 4.2.2.2.2 make use of a single
Information Request/Response message over N14. The stage 2 call flows for idle
mode mobility between 5GS and EPS are not specified yet in 3GPP TS 23.502 [3].
But with GTP-C, Identification Request and Context Request messages expect
different parameters, e.g. Complete Attach Request Message IE and Complete TAU
Request Message IE respectively.
The MME selects the AMF using the DNS procedures for MME selection specified
in 3GPP TS 29.303 [62].
The AMF selects the MME using the DNS procedures for MME selection specified
in 3GPP TS 29.303 [62].
For the sake of clarity, the description of the N26 messages could be
documented in a different specification, and only containing the information
applicable to N26 (e.g. a lot of IEs of the S10 messages do not apply to N26).
#### 8.2.1.2 Evaluation
Pros:
\- Minimal impacts on legacy MME implementations, limited to passing the right
set of parameters and parameter values for interworking with the 5GC, which
helps early availability of solutions for 5GC interworking with EPC.
Cons:
\- AMF implementations need to support GTP-C. No harmonized protocol for N26
and other 5GC interfaces (e.g. N14).
### 8.2.2 Solution 2 -- N26 interface realized by Service Based Interface
#### 8.2.2.1 Solution Description
It is proposed to define the N26 interface as a service based interface
designed according to the general design principles of the 5GC Service Based
Architecture. The protocol is the same protocol as chosen for other 5GC
Service Based Interfaces (e.g. HTTP/2).
The MME selects the AMF using the NRF Service Discovery services.
The AMF selects the MME using the DNS procedures for MME selection specified
in 3GPP TS 29.303 [62].
#### 8.2.2.2 Evaluation
Pros:
\- AMF implementations do not need to support GTP-C;
\- clean slate approach allowing to define N26 messages with only the
information required for 5GC Interworking with EPC;
Cons:
\- Legacy MME implementations need redesign to support the new 5GC SBA
protocol, e.g. support HTTP/2 client and server functions, which results in
extra costs (development, testing, interworking) and can delay the
availability of solutions for 5GC interworking with EPC.
### 8.2.3 Solution 3 -- PGW/SMF address information mapping
#### 8.2.3.1 General
Interconnection with EPC is required from stage 2, an SMF which integrates the
functionality of a PGW-C will behave as an unchanged anchor during inter-RAT
system change. If different kinds of protocols are used in EPC and 5GC, it
should be allowed that the endpoint using the new protocol (e.g. HTTP) on the
SMF side and the endpoint using GTP-C at PGW-C being integrated in the SMF use
different interfaces and IP addresses. And the transforming mechanism for the
interface information (e.g. IP address, port and session ID) of different
interfaces in inter-RAT system shall be defined.
#### 8.2.3.2 Assign both PGW S5/S8 F-TEID and SMF N11/N16 URI
##### 8.2.3.2.1 Solution Description
It is proposed to define the transforming mechanism for the interface
information of different interfaces based on the S10 interface specified in
3GPP TS 29 274 [28], with the following adaptations:
\- Create Session Response in PDN Connectivity procedure/SM Context Response
in 5GS to EPS mobility from combined PGW-C+SMF to MME/AMF, with:
\- PGW S5/S8 F-TEID for GTP based Control Plane interface;
\- SMF N11/N16 URI for HTTP/2;
\- Context Response/ Forward Relocation Request between MME and AMF, with:
\- PGW S5/S8 F-TEID for GTP based Control Plane interface;
\- SMF N11/N16 URI for HTTP/2.0.
The combined PGW-C+SMF assigns the PGW S5/S8 F-TEID for GTP based Control
Plane interface and the SMF N11/N16 URI for HTTP/2, and sends to the AMF/MME.
During the mobility from MME to AMF procedure, the related SM Context in the
SMF identified by the received SMF N11/N16 URI for HTTP/2 from the MME.
##### 8.2.3.2.2 Evaluation
Pros:
\- Supports different interface information (IP address and session identity)
provided by the combined PGW-C+SMF during S5/S8 interface and N11/N16
interface.
Cons:
\- Legacy MME and PGW shall support the SMF N11/N16 URI for HTTP/2.
#### 8.2.3.3 Mapping from PGW S5/S8 F-TEID to SMF N11/N16 URI
##### 8.2.3.3.1 Solution Description
During the mobility procedure from MME to AMF, the AMF maps the received PGW
S5/S8 F-TEID for GTP based Control Plane interface to the SMF N11/N16 URI for
HTTP/2. The related SM Context in the SMF is identified by the mapped SMF
N11/N16 URI for HTTP/2.
During the mobility procedure from AMF to MME, the AMF/SMF maps the SMF
N11/N16 URI for HTTP/2 to the PGW S5/S8 F-TEID for GTP based Control Plane
interface. The mapped PGW S5/S8 F-TEID for GTP based Control Plane interface
is sent to the target MME by AMF.
##### 8.2.3.3.2 Evaluation
Pros:
\- No impact to the legacy network.
Cons:
\- TEID is 32bits long, may limit the length of the SM Context ID.
\- The combined PGW-C+SMF shall use the same interface information (IP address
and session identity) on S5/S8 GTP-C and N11/N16 HTTP/2.
#### 8.2.3.4 Assign both PGW S5/S8 F-TEID and SMF N11/N16 IP address
##### 8.2.3.4.1 Solution Description
The solution shall be based on the S10 interface with the following
adaptations:
\- Create Session Response in PDN Connectivity procedure from PGW to MME,
with:
\- PGW S5/S8 F-TEID for GTP based Control Plane interface;
\- SMF N11/N16 IP address for HTTP/2;
\- SM Context Response in 5GS to EPS mobility from SMF to AMF, with:
\- PGW S5/S8 IP address;
\- Context Response/ Forward Relocation Request from MME to AMF, with:
\- PGW S5/S8 F-TEID for GTP based Control Plane interface;
\- SMF N11/N16 IP address for HTTP/2;
\- Context Response/ Forward Relocation Request from AMF to MME, with:
\- PGW S5/S8 F-TEID for GTP based Control Plane interface;
\- SMF N11/N16 IP address for HTTP/2.
During the mobility procedure from MME to AMF, the AMF maps the received PGW
S5/S8 TEID for GTP based Control Plane interface and the SMF N11/N16 IP
address for HTTP/2 to the SMF N11/N16 URI for HTTP/2. The related SM Context
in the SMF identified by the mapped SMF N11/N16 URI for HTTP/2.
During the mobility procedure from AMF to MME, the AMF maps the SM Context ID
in the SMF N11/N16 URI for HTTP/2 and the PGW S5/S8 IP address to the PGW
S5/S8 F-TEID for GTP based Control Plane interface. The mapped PGW S5/S8
F-TEID for GTP based Control Plane interface is sent to the target MME by AMF.
##### 8.2.3.4.2 Evaluation
Pros:
\- Supports different interface information (IP address) provided by the
combined PGW-C+SMF during S5/S8 interface and N11/N16 interface.
Cons:
\- Legacy MME and PGW shall support the SMF N11/N16 IP address for HTTP/2;
\- TEID is 32bits long, may limit the length of the SM Context ID;
\- The combined PGW-C+SMF shall use the same interface information (session
identity) on S5/S8 GTP-C and N11/N16 HTTP/2.0.
# 9 Specific Services
## 9.1 SMS services
### 9.1.1 Requirements
#### 9.1.1.1 General
This subclause provides an overview of the stage 2 requirements for services
offered by the SMSF to other NFs. In the service-based representation of the
architecture the interfaces between the SMSF and other NFs which consume
services offered by the SMSF are referred to as Nsmsf.
#### 9.1.1.2 Architecture Overview
The SMSF offers services to the AMF via the Nsmsf service based interface. In
addition, the SMSF consumes services offered by the AMF (via Namf, see
subclause 6.5) and consumes services offered by the UDM (via Nudm, see
subclause 6.7). For detaills see 3GPP TS 23.501 [2] clause 4.4.2.
The SMSF is connected to the SMS-GMSC/IWMSC/SMS-Router via one of the
standardized interfaces as shown in 3GPP TS 23.040 [8] (which is MAP or
Diameter SGd).
Figure 9.1.1.2-1 provides an architecture overview with focus on the SMSF.
Figure 9.1.1.2-1: Architecture Overview
#### 9.1.1.3 Requirements on Services offered by the SMSF to the AMF
##### 9.1.1.3.1 Nsmsf_SMService Service
This service offered by the SMSF to the AMF allows the AMF to make use of the
following service operations:
Activate:
The AMF activates the SMS service at the SMSF (see 3GPP TS 23.502 [3] figure
4.13.3-1 step 4).
UplinkSMS:
The AMF transmitts upling SMS messages to the SMSF (see 3GPP TS 23.502 [3]
figure 4.13.3-1 steps 2b and 6d)
## 9.2 Public Warning System
### 9.2.1 Requirements
### 9.2.2 Solution and Protocol Selection
#### 9.2.2.1 Solution X -- \
##### 9.2.2.1.1 Solution Description
##### 9.2.2.1.2 Evaluation
## 9.3 Location services
### 9.3.1 Requirements
### 9.3.2 Solution and Protocol Selection
## 9.4 IMS support
### 9.4.1 Requirements
#### 9.4.1.1 General Requirements
5GS supports IMS with the following functionalities described in subclause
5.16.3 in TS 23.501 [2]:
\- Indication toward the UE if IMS voice over PS session is supported.
\- Capability to transport the P-CSCF address(es) to UE.
\- Paging Policy Differentiation for IMS.
\- IMS emergency service.
The HSS is used to store IMS related subscription. HSS continues to be a
standalone functionality, regardless of whether it is co-located or
implemented as part of UDM.
The following CT4 requirements apply:
\- Transport the P-CSCF address from SMF to the UE (via AMF) for P-CSCF
discovery.
\- Support the paging policy differentiation for IMS.
\- Support the IMS emergency service.
\- Support the signaling of homogenous support of IMS voice over PS session,
\- Support the T-ADS.
\- Support the P-CSCF restoration.
#### 9.4.1.2 Paging Policy Differentiation
The following CT4 impacts are identified in order to support the paging policy
differentiation:
1\. The UPF shall detect and report to the SMF over the N4 interface Downlink
Data Service Information including the Paging Policy Indication value encoded
in the DSCP field of the ToS or TC header of packets received from the IMS.
2\. The SMF forwards the Paging Policy Indication to the AMF over the N11
interface.
#### 9.4.1.3 IMS Emergency Service
#### 9.4.1.4 Signaling of Homogenous Support of IMS voice over PS session
The \"Homogenous Support of IMS Voice over PS Sessions\" indication is
provided by the AMF to the UDM, and can be used by the UDM to avoid requesting
the serving nodes whether or not an IMS Voice over PS session is supported.
The UDM shall support to store the indication for the signalling of homogenous
support of IMS voice over PS session per subscriber. This indication is stored
in the AMF MM Context.
The AMF shall support to send the \"Homogenous Support of IMS Voice over PS
Sessions\" indication to the UDM during update location procedure. See 3GPP TS
23.501 [2] subclause 5.16.3.3.
#### 9.4.1.5 T-ADS
In CT4 aspects, in order to support T-ADS, the UDM shall support to inquire
the AMF for selection of an access network for delivery of the incoming
session. See 3GPP TS 23.501 [2] subclause 5.16.3.2.
NOTE: The relationship between HSS and UDM is FFS.
#### 9.4.1.6 P-CSCF Restoration
The UDM shall support the P-CSCF restoration procedure. The AMF or the SMF may
support the UDM triggered P-CSCF restoration procedure. In this case the AMF
or SMF shall indicate to the UDM the P-CSCF restoration support indication.
During the P-CSCF restoration procedure, the S-CSCF interacts with the HSS
using the existing Cx interface as specified in 3GPP TS 29.228 [64].
The interaction between the HSS and the UDM for P-CSCF restoration information
transmitting is implementation specific.
### 9.4.2 Solutions
#### 9.4.2.1 P-CSCF restoration for 5G access
##### 9.4.2.1.1 Solution 1 - AMF Support of P-CSCF restoration for 5G access
###### 9.4.2.1.1.1 Solution Description
The solution of AMF supporting P-CSCF restoration consists of a basic
mechanism that makes usage of a path through UDM/HSS and AMF to request the
release of the IMS PDU session to the corresponding UE.
The UDM/HSS shall identify whether the AMF supports P-CSCF restoration based
on feature support information and shall send a P-CSCF restoration indication
to the serving AMF where the IMSI associated to the received Private Identity
is registered.
The following figure 9.4.2.1.1-1 illustrates how the AMF supports the P-CSCF
restoration procedure in 5G access.
Figure 9.4.2.1.1-1: AMF Support of P-CSCF restoration procedure
Step 1-5. The S-CSCF receives incoming SIP message. If the S-CSCF detects the
previous P-CSCF is failed (e.g. due to return SIP error or lack of response),
the S-CSCF sends Cx SAR message to the HSS, including P-CSCF restoration
indication;
Step 6. The HSS/UDM sends P-CSCF restoration indication to the serving AMF, to
trigger the P-CSCF restoration procedure. The interaction between the HSS and
the UDM is implementation specific;
Step 7. The S-CSCF sends a SIP response back to the originating side;
For 5G access, when the AMF receives the P-CSCF restoration indication from
the UDM, in the case of:
a) If PCO-based optional extension is not supported, the AMF performs step 8-9
to trigger the UE to re-establish IMS PDU session;
b) If PCO-based optional extension is supported, the AMF performs step 10-12
to trigger the SMF to update the IMS PDU session in order to send new P-CSCF
list in the PCO. The procedure is similar as 3GPP TS 23.380 [65], sub-clause
5.4.3.
Step 13-14. The UE retrieves new P-CSCF list and selects one P-CSCF to perform
SIP registration. After the SIP registration is successful, the S-CSCF
continues the SIP message delivery.
###### 9.4.2.1.1.2 Evaluation
The solution utilizes similar mechanism for support P-CSCF restoration as in
EPC P-CSCF restoration. Since PCO extension should be supported by default in
5G, this solution involves both the AMF and the SMF while it is not optimized.
##### 9.4.2.1.2 Solution 2 - SMF Support of P-CSCF restoration for 5G access
###### 9.4.2.1.2.1 Solution Description
If IMS service from 5G access is required, the UE performs Registration
Procedure and PDU Session Establishment procedure towards 5GC. After IMS PDU
session is established successfully, the UDM is aware of both the AMF address
and the SMF address.
When the UDM determines P-CSCF restoration need to be triggered, instead of
sending the P-CSCF restoration indication to the serving AMF, the UDM directly
selects the SMF serving IMS to trigger the P-CSCF restoration procedure.
Sending the P-CSCF restoration indication directly to the SMF but not the AMF,
can avoid the unnecessary procedure of AMF forwards the P-CSCF restoration
indication to the SMF.
To support the P-CSCF restoration procedure, the SMF shall provide sufficient
information to the UDM during the SMF registration to the UDM, e.g. the DNN,
the P-CSCF supported feature bit, etc.
The following figure 9.4.2.1.2-1 illustrates how the SMF support P-CSCF
restoration procedure in 5G access.
Figure 9.4.2.1.2-1: SMF Support of P-CSCF restoration procedure
Step 1-5. The S-CSCF receives incoming SIP message. If the S-CSCF detects the
previous P-CSCF is failed (e.g. due to return SIP error or lack of response),
the S-CSCF sends Cx SAR message to the HSS, including P-CSCF restoration
indication.
Step 6. The HSS/UDM selects the SMF serving IMS PDU, and sends P-CSCF
restoration indication to that SMF, to trigger the P-CSCF restoration
procedure. The interaction between the HSS and the UDM is implementation
specific.
Step 7. The S-CSCF sends a SIP response back to the originating side.
Step 8. The SMF triggers IMS PDU update procedure to the UE, in order to send
new P-CSCF list in the PCO. The procedure is similar as 3GPP TS 23.380 [65],
subclause 5.4.3.
Step 9-10. The UE retrieves new P-CSCF list and selects one P-CSCF to perform
SIP registration. After the SIP registration is successful, the S-CSCF
continues the SIP message delivery.
###### 9.4.2.1.2.2 Evaluation
Sending P-CSCF restoration indication directly to the SMF but not to the AMF
can avoid the unnecessary procedure of AMF forwards the P-CSCF restoration
indication to the SMF, and thus can get more efficiency then the AMF solution
for P-CSCF restoration.
#### 9.4.2.2 T-ADS for 5G access
Upon receiving incoming call the SCC AS interacts with HSS/UDM via Sh
interface to retrieve T-ADS information, the HSS/UDM:
\- based on the registration states of the UE on AMF, MME and SGSN; and
\- taking into account the "homogenous support of IMS voice over PS session"
indication sent by the AMF, MME and SGSN
decides whether to contact the serving node(s) to get the information of:
\- RAT type;
\- IMS voice over PS session supported indication;
\- the last UE Activity Time.
Based on the information retrieved from the serving node(s), the HSS/UDM
responds to SCC AS with the T-ADS information as specified in 3GPP TS 29.328
[56].
Figure 9.4.2.2-1: T-ADS procedure
1\. The SCC AS receives an incoming call to the served user.
2\. The SCC AS performs T-ADS procedure and queries the HSS/UDM via the
existing Sh interface for the T-ADS information.
3a-1. If there is AMF registration state for the served user in the UDM, the
HSS/UDM subscribes the T-ADS data using the Namf_EventExposure service
provided by that AMF.
3a-2. The AMF notifies the HSS/UDM about the T-ADS information.
3b. If there is MME registration state for the served user in the UDM, the
HSS/UDM retrieves the T-ADS information from the MME.
3c. If there is SGSN registration state for the served user in the UDM, the
HSS/UDM retrieves the T-ADS information from the SGSN.
4\. The HSS/UDM responds to the SCC AS with the T-ADS information.
## 9.5 Emergency services
### 9.5.1 Requirements
#### 9.5.1.1 General
5GS supports emergency service with the following functionalities described in
subclause 5.6.14 in 3GPP TS 23.501 [2]:
\- IMS emergency service is supported with emergency PDU session service by
establishing a PDU session with an Emergency APN (or DNN).
\- UE determines whether the serving network support IMS emergency service
support for UE in limited service state, is based on Access Stratum broadcast
indication.
\- A serving network shall provide an Access Stratum broadcast indication to
UEs as to whether eCall Over IMS is supported.
#### 9.5.1.2 Architecture Reference Model for Emergency Services
According to TS 23.501 [2], the non-roaming architectures (Figure 4.2.3-1 and
Figure 4.2.3-2 of 3GPP TS 23.501 [2]) and roaming architecture with the
visited operator\'s application function (Figure 4.2.4-1 and Figure 4.2.4-4 of
3GPP TS 23.501 [2]) apply for emergency services. The other roaming
architectures with services provided by the home network do not apply for
emergency services.
#### 9.5.1.3 SMF / UPF Selection for Emergency services
To support emergency services, a SMF and UPF in the visited PLMN shall be
selected, which also guarantees that the IP address is allocated by the
visited PLMN.
The AMF selects a SMF based on the Emergency DNN locally configured in the
visited PLMN, or the AMF selects the SMF directly from the AMF Emergency
Configuration Data. The AMF Emergency Configuration Data contains the
Emergency DNN which is used to derive a SMF, or the AMF Emergency
Configuration Data may also contain the statically configured SMF for the
Emergency DNN.
The SMF selects a UPF based on the Emergency DNN, or the SMF selects the UPF
directly from the SMF Emergency Configuration Data. The SMF Emergency
Configuration Data contains the Emergency DNN which is used to derive a UPF,
or the SMF Emergency Configuration Data may also contain the statically
configured UPF for the Emergency DNN.
#### 9.5.1.4 IP Address Allocation
Emergency service is provided by the serving PLMN. The UE and PLMN must have
compatible IP address versions in order for the UE to obtain a local emergency
PDU Session. IP address allocation in the serving PLMN is provided per
subclause 5.8.1 of 3GPP TS 23.501 [2].
#### 9.5.1.5 Mobility and Access Restriction for Emergency services
When Emergency Services are supported and local regulation requires Emergency
Sessions to be provided regardless of mobility or access restrictions, the
Mobility Restrictions in 3GPP TS 23.501 [2] subclause 5.3.4.1 should not be
applied to UEs receiving emergency services. When the AN resources for
emergency services are established, the ARP value indicates the usage for
emergency services to the 5G-AN.
During handovers, the source 5G-AN and source AMF ignore any UE related
restrictions during handover evaluation when there are active emergency
bearers / PDU session. During handover to a cell in limited service area, the
target 5G-AN only accepts the emergency bearers and the target AMF releases
the non-emergency PDU sessions that were not accepted by the target 5G-AN.
During Registration Update procedures, the target AMF ignores any mobility or
access restrictions for UE with emergency PDU session where required by local
regulation. Any non-emergency PDU session are deactivated by the target AMF
when not allowed by the subscription for the target location.
Such UEs with only emergency PDU sessions behave as emergency registered. To
allow the emergency registered UE to get access to normal services after the
emergency session has ended and when it has moved to another area that is not
stored by the UE as a forbidden area, after allowing a period of time for
subsequent emergency services, the UE may explicitly deregister and register
to normal services without waiting for the emergency PDU session deactivation
by the SMF.
#### 9.5.1.6 QoS for Emergency services
Where local regulation requires supporting emergency calls from an
unauthorised caller, the SMF may not have subscription data. Additionally, the
local network may want to provide IMS emergency services support differently
than what is allowed by a UE subscription. Therefore, the initial QoS values
used for establishing emergency PDU session are configured in the V-SMF (local
network) in the SMF Emergency Configuration Data.
This functionality is used by the UE Requested PDU Session procedure, when
establishing PDU session for emergency services.
#### 9.5.1.7 Handling of PDU Sessions for Emergency Services
The QoS flow of a PDU Session associated with the emergency DNN shall be
dedicated for IMS emergency sessions and shall not allow any other type of
traffic. The emergency contexts shall not be changed to non-emergency contexts
and vice versa. The UPF shall block any traffic that is not from or to
addresses of network entities (e.g. P-CSCF) providing IMS emergency service.
If there is already an emergency PDU session, the UE shall not request another
emergency PDU session. The network shall reject any additional emergency PDU
session requests. The UE shall not request PDU session modification for the
emergency PDU session. The network shall reject any UE requested PDU session
modification that is for the emergency PDU session. The ARP reserved for
emergency service shall only be assigned to QoS flow associated with an
emergency PDU session.
#### 9.5.1.8 PCC for Emergency Services
When an operator allows IMS emergency sessions, dynamic PCC is used for UEs
establishing IMS emergency services and shall be used to manage these
sessions. When establishing emergency services with a SMF, the PCF provides
the SMF with the QoS parameters, including an ARP value reserved for the
emergency services to prioritize the QoS Flows when performing admission
control.
The PCF rejects an IMS session established via the emergency PDU session if
the AF (i.e. P-CSCF) does not provide an emergency indication to the PCF.
### 9.5.2 Solution
#### 9.5.2.1 Solution 1 -- Emergency Configuration Data in AMF and SMF
To support Emergency Service, a set of parameters for emergency service shall
be pre-configured in the AMF and the SMF within the Emergency Configuration
Data.
The AMF Emergency Configuration Data is used instead of UE subscription data
received from the UDM, for all emergency PDU sessions that are established by
an AMF on UE request.
Table 9.5.2.1-1: AMF Emergency Configuration Data
* * *
Field Description Emergency Data Network Name (em DNN) A label according to
DNS naming conventions describing the data network entry point used for
Emergency PDU session (wild card not allowed). Emergency SMF identity The
statically configured identity of the SMF used for emergency DNN. The SMF
identity may be either an FQDN or an IP address. NOTE-1: The FQDN always
resolves to one SMF.
* * *
The SMF Emergency Configuration Data is used instead of UE subscription data
received from the UDM, for all emergency PDU sessions that are established by
an AMF on UE request.
Table 9.5.2.1-2: SMF Emergency Configuration Data
* * *
Field Description Emergency Data Network Name (em DNN) A label according to
DNS naming conventions describing the data network entry point used for
Emergency PDU session (wild card not allowed). Emergency QoS profile The flow
level QoS parameter values for Emergency DNN\'s default QoS flow (5QI and
ARP). The ARP is an ARP value reserved for emergency QoS flows. Emergency
Session AMBR The Maximum Aggregated uplink and downlink MBR values to be
shared across all Non-GBR QoS flows, which are established for the Emergency
DNN, as decided by the SMF. Emergency UPF identity The statically configured
identity of the UPF used for emergency DNN. The PDN GW identity may be either
an FQDN or an IP address. NOTE-1: The FQDN always resolves to one UPF.
* * *
NOTE: 5QI for Emergency DNN\'s default QoS flow is set per operator
configuration.
#### 9.5.2.2 Solution 2 -- Select Emergency SMF from NRF
To support emergency services, an appropriate SMF needs to be selected by the
AMF to establish emergency PDU session. The AMF may be configured with an IP
address of an SMF serving emergency services. Alternatively, the AMF requests
the NRF to allocate an SMF for emergency services, by providing emergency DNN
and visited PLMN ID. The NRF shall derive an SMF in the visited PLMN.
## 9.6 Multimedia Priority Services
### 9.6.1 Requirements
5GS supports MPS with functionality as described in subclause 5.16.5 in 3GPP
TS 23.501 [2]. MPS priority mechanisms can be classified as subscription-
related, invocation-related, and those applied to existing QoS Flows, as
described in subclause 5.22 of 3GPP TS 23.501 [2].
MPS subscription includes information to support priority PDU connectivity
service and IMS priority service. The subscription information also includes
MPS Priority Level information.
The UDM shall maintain an indication that an UE is subscribed to MPS in the
EPS domain.
The UDM shall maintain an indication that an UE is subscribed to MPS in the
5GS domain.
### 9.6.2 Solution
## 9.7 PEI checking
### 9.7.1 Requirements
### 9.7.2 Solution and Protocol Selection
## 9.8 Mission Critical Services
### 9.8.1 Requirements
### 9.8.2 Solution
# 10 Other Aspects
## 10.1 Numbering, Addressing and Identification in 5G System
### 10.1.1 General
This clause describes the numbering, addressing and identification aspects in
the 5G System.
### 10.1.2 Identities in 5G System
### 10.1.3 Identifiers for Domain Name System procedures
## 10.2 Subscriber data in 5G System
### 10.2.1 General
This subclause describes subscriber data stored in the 5G System.
The terms \"permanent subscriber data\" and \"temporary subscriber data\" are
defined in 3GPP TS 23.008 [4].
### 10.2.2 Subscriber data storage in 5G System
Table 10.2.2-1: Overview of subscriber data stored in 5G System
* * *
PARAMETER Subclause UDM AMF SMF UPF AUSF N3IWF NEF TYPE Subscriber Permanent
Identity (SUPI) 10.2.3.1 M C C - FFS FFS FFS P UE Radio Capability 10.2.3.2
FFS C FFS - FFS FFS FFS T Supported UE Feature list 10.2.3.3 FFS C FFS - FFS
FFS FFS T MM Context 10.2.3.4 - C FFS - FFS FFS FFS T
* * *
### 10.2.3 Definition of Subscriber data in 5G System
#### 10.2.3.1 Subscriber Permanent Identity
Subscriber Permanent Identity (SUPI) is defined in 3GPP TS 23.501 [2].
SUPI is permanent subscriber data conditionally stored by UDM, AMF and SMF.
#### 10.2.3.2 UE Radio Capability
UE Radio Capability is defined in 3GPP TS 23.501 [2].
UE Radio Capability is temporary subscriber data conditionally stored by AMF.
#### 10.2.3.3 Supported UE Feature list
Supported UE Feature list is defined in 3GPP TS 23.501 [2].
Supported UE Feature list is temporary subscriber data conditionally stored by
AMF.
#### 10.2.3.4 MM Context
MM Context list is defined in 3GPP TS 23.501 [2].
MM Context list is temporary subscriber data conditionally stored by AMF.
## 10.3 Network slicing
### 10.3.1 Requirements
#### 10.3.1.1 General Requirements
The 5GS network slicing is specified in subclause 5.15 of 3GPP TS 23.501 [2].
A network slice comprises all the resources required to fulfil the service and
may include the Core Network control plane and user plane Network Function and
the 5G Radio Access Network and the N3IWF functions to the non-3GPP Access
Network.
An S-NSSAI (Single Network Slice Selection Assistance information) assists the
network in selecting a specific Network Slice instance. The NSSAI is a
collection of S-NSSAIs (Single Network Slice Selection Assistance
Information).
When a UE Registers with a PLMN, the UE shall provide to the network in RRC
and NAS layer either the Configured-NSSAI, the Accepted NSSAI or sub-set of
those, if stored in the UE, for the RAN to sends NAS signalling to the
specific AMF. If the UE does not provide any NSSAI (Accepted or Configured)
for the selected PLMN in RRC Connection Establishment and in NAS, the RAN
sends NAS signalling to a default AMF.
The NSSF shall support the following functionality:
The AMF queries the NSSF, with Requested NSSAI, the Subscribed S-NSSAIs,
location information, and possibly access technology being used by the UE.
Based on this information, local configuration, and other locally available
information including RAN capabilities in the registration area, the NSSF does
the following:
\- Selecting the set of network slice instances serving the UE;
\- Determining the Allowed NSSAI;
\- Determining the AMF Set to be used to serve the UE, or, based on
configuration, a list of candidate AMF(s), possibly by querying the NRF;
\- May determine the NRF(s) to be used to select NFs/services within the
selected Network Slice instance(s).
The AMF selects an SMF in a network slice instance based on S-NSSAI, DNN and
other information e.g. UE subscription and local operator policies. The
selected SMF establishes a PDU session based on S-NSSAI and DNN.
The following CT4 requirements apply:
\- Subscription data in UDM including the S-NSSAI of the Network Slices that
the UE subscribes to.
\- The selection mechanism for initial AMF to select target AMF by querying
the NSSF, and the redirect mechanism between initial AMF and the target AMF.
\- The selection mechanism for AMF to select SMF based on the selected network
slice instance, DNN and other information e.g. UE subscription and local
operator policies.
\- The selection mechanism for SMF to select UPF based on the selected network
slice instance, DNN and other information e.g. UE subscription and local
operator policies.
### 10.3.2 CT4 impacts of Network slicing
The following CT4 impacts are identified:
1\. New subscription data: the S-NSSAI(s) (Single Network Slice Selection
Assistance information) of the Network Slices that the user subscribes to
shall be defined as a possible parameter of the subscription data.
2\. NF discovery and selection: it shall be possible to discover and select a
specific NF instance in a given network slice instance.
## 10.4 Impacts due to Virtualization
### 10.4.1 General
The following subclause captures some properties of NFV and corresponding
impacts for the selection of the protocol for service based architecture. The
specific requirements for virtualization are mapped to the SBA requirements or
the protocol selection criteria specified in subclauses 6.2.1.4 and 6.2.1.5.
1\. In a virtualized environment, the NFs are typically smaller compared to
NFs based on appliances. This means that there could be a large number of NF
instances. Hence any protocol used in a virtualized environment should be
capable to support a large number of endpoints. (R5)
2\. In a virtualized environment, NF instances may be instantiated/torn-down
dynamically. Hence the SBA shall allow to discover the NFs (see subclause
6.8).
3\. Virtualized NFs can potentially move across the physical infrastructure;
this can potentially make the connectivity maintenance complex, hence the
protocol selected should allow seamless reconnection to the NFs in case of
movement. (A8)
4\. A virtualized environment can introduce additional security concerns due
to the fact that the NFs may be deployed in a common data center. Hence the
protocol selected should be able to support security. (A5).
### 10.4.2 Support of stateless NFs
#### 10.4.2.1 General
One property of NF instances in a virtualized environment is that NF instances
may be instantiated/torn-down dynamically, i.e. for a given NF-type from the
same vendor in the same slice, the set of active NF instances may dynamically
change. Such change needs to be made aware to the NRF to allow other NFs to
discover the currently active instances.
Another property of NF instances is that they may decide to become stateless,
i.e. they store UE-related information as opaque data in the UDSF after UE
specific request be processed, so that the NF instances don\'t have UE
-related information until they retrieve the stored state information when
needed, e.g. when a new UE specific request is received.
As a consequence of these two properties, during periods of time where no NF
instance holds state for the UE, any binding to a virtual NF actually is a
binding to the set of active NF instances. Hence it shall be possible to
derive from the identity of a given NF instance the identity of the set of
active NF instances the given NF instance belongs to.
Different types of NFs may have different requirements with regard to
virtualization and statelessness. Applicability of a given type of NF to
virtualization and statelessness is outlined in the following sub-clauses.
#### 10.4.2.2 Stateless AMFs
##### 10.4.2.2.1 Solution 1: Support Stateless AMF by using UDSF
The following figure shows an example flow of AMF Registration to the UDM
followed by an Update Notification.
Figure 10.4.2.2.1-1 Example Flow
1\. Triggered by the UE\'s initial registration AMF instance x1 creates an
AMF-Set-X-specific entry in the UDSF for the UE. Only AMF instances from AMF
set X can access and understand this opaque data.
2\. AMF instance x1 registers with the UDM (Update Location). UDM discovery
and selection is not shown in the figure. The UDM stores AMF-Set-X-ID + AMF
instance x1 + PLMN-ID for later use when the new serving AMF needs to be
contacted. Actually the structure of the Globaly Unique AMF ID (GUAMI) which
is\ \:= \\\\\\
easily allows to identify the PLMN and Set the instance belongs to.
3\. UDM sends the acknowledgement. AMF instance x1 serves the UE.
4\. AMF x1 decides to no longer keep state for the (inactive) UE. This
decision may be caused by an upcoming maintenance break or instance tear-down
event. AMF x1 therefore updates the UDSF with state information which is AMF-
Set-X-specific opaque data.
5\. In this example flow after some time due to the virtualization property,
AMF instance x1 is torn down. The NRF is updated accordingly (how this is done
is ffs). If the UDM has subscribed to notifications, the NRF notifies the UDM
accordingly (not shown in the figure).
6\. In this example flow after some time the UDM detects that it needs to
contact the UE\'s serving AMF in order to update subscription data. The UDM
therefore queries the NRF to discover all active AMF instances from AMF Set x,
especially whether instance x1 is still active. (This query may be skipped if
the UDM has a valid cache using the subscription to notification mechanism).
7\. NRF returns the addresses of AMF instances x2 and x3 (as x1 is no longer
active).
8\. UDM selects AMF x2 and sends Update Notification (Insert Subscriber Data).
The UDM also replaces the stored AMF instance x1 with the new AMF instance x2.
9\. AMF x2 retrieves the AMF-Set-X-specific opaque data from the UDSF.
10\. AMF x2 sends the acknowledgement and serves the update request.
Note that in this example scenario, where the AMFs are subject to be torn down
dynamically, the UDM needs to contact the NRF in step 6 (or alternatively keep
a valid cache by means of the subscribe/notify mechanism) in order to detect
whether
a) the stored AMF instance is unavailable for processing UE transactions
(caused by an AMF planned removal procedure with UDSF deployed; see 3GPP TS
23.501 [2] clause 5.21.2.2.1) and another AMF from the AMF set needs to be
selected to which the following request shall be sent (e.g. step 8 in figure
10.4.2-1), or
b) the stored AMF instance is available and the following request shall be
sent to that AMF instance.
This need may be hidden from the UDM when proxies on the route between AMF and
UDM are used (e.g. in roaming scenarios for topology hiding). In this case the
proxy would do the NRF query in order to detect whether the AMF is down and an
alternative AMF from the same set must be selected.
As shown in the example flow, one consequence of having stateless AMFs in a
virtualized environment is that AMF Registration at the UDM (or in general UE
to AMF binding stored in any another NF) has to be done with the AMF\'s Set-ID
+ the AMF\'s instance-ID, where the AMF-Set-ID is used to query the NRF in
order to detect whether the AMF-instance is still active, and -- if torn down
-- to detect which alternative AMF instances may be selected instead when the
UDM (or in general any other NF) needs to contact the AMF.
##### 10.4.2.2.2 Solution 2: Support Stateless AMF without UDSF
The solution of stateless AMF without UDSF is shown as in the following
figure.
Figure 10.4.2.2.2-1 Example Flow
1\. UEs initiates registration to AMF instance x1. AMF instance x1 is
registered in the UDM with Globally Unique AMF ID (GUAMI), which includes AMF
Region ID + AMF-Set-X-ID + AMF Pointer + PLMN-ID.
2\. UDM sends the acknowledgement. AMF instance x1 serves the UEs.
> 3\. AMF x1 performs the removal procedure without UDSF (see 3GPP TS 23.501
> [2] clause 5.21.2.2.2), UE contexts associated with the same GUAMI are
> transferred to AMF x2 in the same AMF set; or AMF x2 is configured to be as
> a backup AMF for the GUAMI, and in this case, the backup AMF x2 may not be
> in the same AMF set with AMF x1 (see 3GPP TS 23.501 [2] clause 5.21.2.3).\ \
> The AMF x1 requests transferring all UE Contexts associated with the same
> GUAMI to the AMF x2. The AMF x2 shall retrieves all UE contexts associated
> with the GUAMI from AMF x1 and be ready for serving.
NOTE: The Namf_Communication_CreateUEContext service operation is designed to
transfer only one UE Context in a handover procedure, in this case, all UE
contexts associated with the same GUAMI need to be transferred, therefore the
service operation(s) to be used to transfer the UE contexts with the same
GUAMI, in a AMF removal procedure, or in a backup procedure for handling AMF
failure case is to be determined and specified in the normative specification.
4\. AMF x1 notifies the AMF x2 that it will be unavailable.
5\. AMF x1 notifies the UDM that it will be unavailable, the UDM uses the
Namf_Communication_AMFStatusChangeSubscribe service operation and
Namf_Communication_AMFStatusChangeNotify service operation to subscribe the
notification of the status change in the AMF.
6\. UDM sends the acknowledgement.
7a. Before tear down, the NRF is updated accordingly, the AMF deregisters in
NRF.
7b. The AMF x2 instructs NRF to add GUAMI(s) of the AMF x1 in the AMF x2\'s NF
profile by Nnrf_NFManagement_NFUpdate Service Operation. Actually, AMF x2 acts
as AMF x1 now.
8\. In this example flow after some time the UDM detects that it needs to
contact the UE\'s serving AMF in order to update subscription data. The UDM
therefore queries the NRF using GUAMI to discover AMF x2, which is the node
currently serves the UE.
9\. NRF returns the addresses of AMF x2.
10\. UDM sends Update Notification (Insert Subscriber Data) to AMF x2.
11\. AMF x2 sends the acknowledgement and serves the update request.
#### 10.4.2.3 Stateless UDMs
Following the UDC principles as specified in 3GPP TS 23.335 [79], the UDM may
(as an option) become stateless by storing user data in the UDR. NFs that
consume UDM services may select any (available) UDM that has access to the UDR
storing the user\'s data.
#### 10.4.2.4 Principles
All NF instances from the same set support exactly the same functionality,
they have the same NF type, from the same vendor, the same feature support.
Opaque data stored in the UDSF are uniquely identified (within a PLMN) by NF-
Set-ID + UE Identity which serves as a key to access the data.
UDSF access may be limited to create/delete/read/update operations; need for
subscribe/notify use cases is ffs.
NRF query with NF-Set-ID + PLMN-ID may be used to discover all currently
active NF- instances belonging to the NF-Set in the PLMN.
NFs that store a UE\'s binding to another NF, e.g. SMF stores the AMF ID,
while the AMF is stateless. need to detect whether the other NF is a
potentially stateless NF within a virtualized environment (i.e. may disappear
at any time). If so, these NFs use the stored Set-ID to query the NRF to
discover whether the stored instance is still active (if not active: discover
alternative instances within the set); as an alternative to the NRF query NFs
may keep a valid cache by means of the subscribe/notify mechanism.
Only one NF instance in the NF set can perform update or delete operation for
a UE related information in the UDSF at a time, i.e. the UE related
information (e.g. context and state) is then locked by this NF instance and
this NF instance shall provide its endpoint address information to allow re-
direct; the other NF instance in the NF set can only read this UE related
information, and if a UE specific request is received by other NF instance in
the same NF set, that NF instance should be able to re-direct the request to
the NF instance which has locked the UE related information in the UDSF.
For the Stateless AMF without UDSF, the UE's binding shall be updated in the
following way:
a) An AMF instructs other peer CP NFs, subscribed to receive such a
notification, that it will be unavailable for processing UE transactions by
including GUAMI(s) configured on this the AMF;
b) The backup AMF shall update the NF profile in the NRF to include the
GUAMI(s) of the old AMF;
c) The other CP NFs query NRF by GUAMI to obtain the current AMF with that
GUAMI serving the UE, or use the backup AMF information which was provided by
the old AMF (has failed) during the first interaction with that CP NF(s).
d) One AMF can be registered as a Serving AMF of one GUAMI, optionally as a
target AMF and/or a backup AMF of other GUAMI. For the AMF discovery based on
GUAMI the NRF provides the associated AMF to the requester. One GUAMI uniquely
points to an AMF instance.
NOTE: The possible clarifications and enhancements to support Stateless AMF
without UDSF are to be specified in the normative specification.
## 10.5 Network Sharing
### 10.5.1 Requirements
### 10.5.2 Solution
# 11 Conclusions and Recommendations
## 11.1 General
## 11.2 User Plane interfaces
It is decided to use GTPv1-U as the 5G UP Encapsulation protocol over N9, like
decided by 3GPP RAN over N3.
It is further decided to specify a 5GS Container to be carried within a GTP
Extension Header over the N3 and N9 interfaces, to carry the information
required to be sent in the encapsulation header over the N3 and N9 interfaces,
as per the option 2 of the solution 1.
3GPP RAN3 will specify the contents of the 5GS Container.
NOTE: It is FFS whether CT4 needs to specify new GTP-U extension header(s) in
3GPP TS 29.281 for the 5GS Container.
## 11.3 Control Plane interfaces
NOTE: the following interfaces are FFS:
\- Interfaces for Location procedures (e.g. interfaces to E-SMLC and GMLC);
\- Cell Broadcast Centre interface with the 5G System.
### 11.3.1 Service Based Architecture
#### 11.3.1.1 Service Based Interfaces
The 5GC architecture is defined as service-based, with NFs within the 5G
Control Plane using service-based interfaces for their interactions (see
subclause 4.2.1 of 3GPP TS 23.501 [2]).
Service-based interfaces are listed in subclause 4.2.6 of 3GPP TS 23.501 [2].
The following reference points, defined in subclauses 4.2.7 and 4.4.2.2 of
3GPP TS 23.501 [2] are realized by corresponding NF service-based interfaces.
Table 11.3.1.1-1: Service Based Interfaces
+----------------------+----------------------+----------------------+ | Reference Point Name | Reference Point | CT4 responsibility | | | Definition | | +----------------------+----------------------+----------------------+ | N5 | between PCF and AF | No (CT3) | +----------------------+----------------------+----------------------+ | N7 | between SMF and PCF | No (CT3) | +----------------------+----------------------+----------------------+ | N8 | between UDM and AMF | Yes | +----------------------+----------------------+----------------------+ | N10 | between UDM and SMF | Yes | +----------------------+----------------------+----------------------+ | N11 | between AMF and SMF | Yes | +----------------------+----------------------+----------------------+ | N12 | between AMF and AUSF | Yes | +----------------------+----------------------+----------------------+ | N13 | between UDM and AUSF | Yes | +----------------------+----------------------+----------------------+ | N14 | between two AMFs | Yes | +----------------------+----------------------+----------------------+ | N15 | between PCF and AMF | No (CT3) _(PCF | | | | services)_ | | | | | | | | Yes _(AMF services)_ | +----------------------+----------------------+----------------------+ | N16 | between two SMFs | Yes | +----------------------+----------------------+----------------------+ | N17 | between AMF and EIR | Yes | +----------------------+----------------------+----------------------+ | N20 | between AMF and SMSF | Yes | +----------------------+----------------------+----------------------+ | N21 | between SMSF and UDM | Yes | +----------------------+----------------------+----------------------+ | N22 | between AMF and NSSF | Yes | +----------------------+----------------------+----------------------+ | N24 | between two PCFs | No (CT3) | +----------------------+----------------------+----------------------+ | | between any NF and | Yes | | | NRF | | +----------------------+----------------------+----------------------+ | | between NFs and NEF | Depends on the NF | +----------------------+----------------------+----------------------+ | N18 | between NFs and UDSF | Yes | +----------------------+----------------------+----------------------+ | | between NFs and UDR | Yes (protocol | | | | definitions and UDM | | | | related data model) | | | | | | | | No (CT3) (PCF and | | | | NEF related data | | | | model) | +----------------------+----------------------+----------------------+
#### 11.3.1.2 Protocol solution for Service Based Interfaces
##### 11.3.1.2.1 General
Based on the protocol solutions and evaluations described in subclause 6.2,
HTTP is preferred for the following reasons:
\- allows to design the 5G Service Based Architecture using cloud-native and
Web technologies:
\- HTTP based APIs are cloud-friendly, easy to deploy and open;
\- largest user community for Web services. Rich landscape of frameworks,
tools and software.
\- HTTP is native to service based architecture;
\- use of HTTP is future proof as it is used in large non-telecom ecosystem;
\- eases and speeds deployment and continuous integration/delivery of new or
upgraded network functions and services;
\- eases use of operator owned application functions and interworking with
third parties\' applications:
\- largest user community for Web services;
\- already supported by some operator owned application functions (e.g. MEC);
\- HTTP REST APIs are supported on northbound NEF interfaces.
It is concluded to standardize the following protocol solution for the Service
Based Interfaces under CT4 responsibility identified in Table 11.3.1.1-1 with
the exception of N18 (see subclause 11.3.1.2.2):
\- protocol: HTTP/2 (see IETF RFC 7540 [15] and IETF RFC 7541 [37]), as
specified in subclause 6.2.2.2;
\- transport: TCP (see IETF RFC 793 [13]);
\- serialization protocol: JSON (see IETF RFC 7159 [16]);
\- support binary body part and multipart messages (with the multipart/related
content-type), as specified in subclause 6.2.2.5.4, to transmit large parts of
opaque binary data along with JSON;
\- API design style: apply a RESTful framework for the protocol design
whenever possible and use custom methods otherwise, as specified in subclause
6.2.2.4;
\- support of notification with two HTTP client-server pairs, as specified in
subclause 6.2.2.2;
\- Interface Definition Language: OpenAPI Specification, version 3.0.0 [49];
each interface will be specified by textual and/or tabular format description
in the main body of the Technical Specification and by an OpenAPI
specification file in a normative annex, as specified in subclause 6.2.2.7;
\- support of HTTP Heartbeat to check the aliveness of a service in a peer NF
based on exchange of HTTP PUT or POST request/response, using a solution
similar to the solution 3 specified in subclause 6.2.2.2.1.10. The 5GC APIs
which may require support of this mechanism will be determined during the
stage 3 normative work per API.
HTTP/2 over QUIC/UDP (see IETF draft-ietf-quic-transport [18]), and other
binary encoding alternatives such as CBOR, are regarded as potential
evolutions in a later release for enhanced performances and may be subject to
further studies and contributions following the normal 3GPP working
procedures.
##### 11.3.1.2.2 N18
CT4 could not agree on protocol selection for N18 (Nudsf) in Rel-15. It is
preferred to postpone the protocol selection for N18 (Nudsf) to Rel-16.
#### 11.3.1.3 NF Service Registration, Discovery and Selection
It is decided to design the NF Service Registration and Discovery procedures
using NRF service operations, as documented in solutions 1 and 2 in subclauses
6.8.2.1 and 6.8.2.2.
NOTE: No conclusion is decided yet regarding the heartbeat mechanism.
## 11.4 User Plane Management Procedures over N4
It is concluded to support PFCP on the N4 interface and enhance 3GPP TS 29.244
[7] to support the N4 interface (see subclause 7.4).
## 11.5 Interworking with E-UTRAN connected to EPC
To keep impacts on legacy MME implementations minimal and help early
availability of solutions for 5GC interworking with EPC, it is concluded to
define the N26 interface based on the S10 interface as specified in subclause
8.2.1.
The MME selects the AMF, and the AMF selects the MME, using the DNS procedures
for MME selection specified in 3GPP TS 29.303 [62].
The description of the N26 messages will be documented in3GPP TS 29.274 [28].
The interface information (IP address, port) on PGW S5/S8 for GTP based
Control Plane interface and SMF N11/N16 for HTTP/2 are allowed to be
different. It is decided to design detail mechanism in stage 3 normative
specifications.
## 11.6 Specific Services
### 11.6.1 IMS support
#### 11.6.1.1 P-CSCF Restoration
Based on the evaluation of P-CSCF restoration solutions, the SMF based
solution as described in subclause 9.4.2.1.2 is preferred as basic solution
for P-CSCF restoration in 5G.
#### 11.6.1.2 T-ADS
It is concluded to standardize the solution described in subclause 9.4.2.2 for
T-ADS.
## 11.7 Other Aspects
### 11.7.1 Support of Stateless NFs
It is concluded to standardize the solution for Stateless AMFs to cover the
AMF planned removal procedure with UDSF deployed as specified in 3GPP TS
23.501 [2] subclause 5.21.2.2.
It is concluded to standardize the solution described in subclause 10.4.2.3 on
support of Stateless UDMs for UDMs that support the option to become
stateless.
###### ### Annex A: Impacts to Specifications
NOTE: Potential specifications impacts on the following topics are FFS:
\- Location procedures (e.g. interfaces to E-SMLC and GMLC);
\- Cell Broadcast Centre interface with the 5G System;
\- Potential impacts to legacy SMS interfaces, e.g. to retrieve the
identity/address of the user\'s serving SMSF.
## A.1 New specifications
Table A.1-1 identifies the new specifications that are required to define the
CT4 aspects of the 5G System.
> ..
Table A.1-1: New specifications for the CT4 aspects of the 5G System
+------+--------+---+------------------------+------------------------+ | Type | Series | | Title | Scope | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Technical | Technical Realization | | | | | Realization of Service | of Service Based | | | | | Based Architecture; | Architecture: | | | | | Stage 3 | | | | | | | > \- Protocol | | | | | | > requirements | | | | | | > | | | | | | > \- Support of | | | | | | > Server-initiated | | | | | | > communication from a | | | | | | > server to a client | | | | | | > | | | | | | > \- Routing | | | | | | > | | | | | | > \- Load Control | | | | | | > | | | | | | > \- Overload Control | | | | | | > | | | | | | > \- Authentication to | | | | | | > access NF services | | | | | | > | | | | | | > \- Authorization to | | | | | | > access NF services | | | | | | > | | | | | | > \- Stateless NFs | | | | | | > | | | | | | > \- Etc... | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Principles | Principles and | | | | | and Guidelines for | Guidelines for 5G | | | | | Services Definition; | System Services | | | | | Stage 3 | Definition: | | | | | | | | | | | | > \- Design principles | | | | | | > | | | | | | > \- Naming | | | | | | > conventions | | | | | | > | | | | | | > \- Documentation | | | | | | > | | | | | | > \- Version Control | | | | | | > | | | | | | > \- Addressing and | | | | | | > namespaces | | | | | | > | | | | | | > \- Extensibility | | | | | | > mechanisms | | | | | | > (including supported | | | | | | > features mechanism) | | | | | | > | | | | | | > \- Error Handling | | | | | | > | | | | | | > \- Service | | | | | | > Discoverability | | | | | | > | | | | | | > \- etc | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Access and | AMF services; Stage 3 | | | | | Mobility Management | | | | | | Services; Stage 3 | - includes services | | | | | | supported over N8, | | | | | | N11, N14, N20, NEF | | | | | | interface | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Session | SMF services; Stage 3: | | | | | Management Services; | | | | | | Stage 3 | > \- excluding policy | | | | | | > related services | | | | | | > which will be | | | | | | > specified by CT3; | | | | | | > | | | | | | > \- includes H-SMF | | | | | | > and V-SMF services. | | | | | | > | | | | | | > \- includes services | | | | | | > supported over N11, | | | | | | > N16, NEF interface | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Unified | UDM services; Stage 3 | | | | | Data Management | | | | | | Services; Stage 3 | > \- includes services | | | | | | > supported over N8, | | | | | | > N10, N13, N21, NEF | | | | | | > interface | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; | AUSF services; Stage 3 | | | | | Authentication Server | | | | | | Services; Stage 3 | > \- includes services | | | | | | > supported over N12 | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; SMS | SMSF services; Stage 3 | | | | | Services; Stage 3 | | | | | | | > \- includes services | | | | | | > supported over N20, | | | | | | > N21 | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; NF | NRF services; Stage 3 | | | | | Repository Services; | | | | | | Stage 3 | | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Network | NSSF services; Stage 3 | | | | | Slice Selection | | | | | | Services; Stage 3 | | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Equipment | EIR services; Stage 3 | | | | | Identity Register | | | | | | Services; Stage 3 | > \- includes services | | | | | | > supported over N17. | +------+--------+---+------------------------+------------------------+ | TS | 23.xxx | | 5G System; Restoration | Restoration procedures | | | | | Procedures; Stage 2 | in the 5G System | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Common Data | Definition of common | | | | | Types for Service | data types | | | | | Based Interfaces; | | | | | | Stage 3 | | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Unified | UDR services; Stage 3 | | | | | Data Repository | | | | | | Services; Stage 3 | | +------+--------+---+------------------------+------------------------+ | TS | 29.xxx | | 5G System; Usage of | Definition of | | | | | the Unified Data | subscription data | | | | | Repository services | modelling (5G only) | | | | | for Subscription Data; | for UDR services | | | | | Stage3 | | +------+--------+---+------------------------+------------------------+
## A.2 Impacted specifications
Table A.2-1 identifies the impacted existing specifications that are required
to define the CT4 aspects of the 5G System.
Table A.2-1: Impacted specifications for the CT4 aspects of the 5G System
* * *
Type Series Title Brief description of the impacts TS 23.003 Numbering,
addressing and identification Numbering, addressing and identification for the
5G System TS 23.008 Organization of subscriber data Subscriber data for the 5G
System TS 23.380 IMS Restoration Procedures IMS restoration procedures with 5G
System, e.g. P-CSCF failure. TS 29.281 General Packet Radio System (GPRS)
Tunnelling Protocol User Plane (GTPv1-U) Use of GTP-U over the user plane
interfaces in the 5G System. New GTP-U Extension header(s) for the 5G System.
TS 29.272 Evolved Packet System (EPS); Mobility Management Entity (MME) and
Serving GPRS Support Node (SGSN) related interfaces based on Diameter protocol
Possible impacts to control the user\'s mobility with the 5G System, e.g.
access restriction data. TS 29.274 3GPP Evolved Packet System (EPS); Evolved
General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane
(GTPv2-C); Stage 3 Impacts to support mobility between 5GS and EPC (N26
interface). TS 29.303 Domain Name System Procedures; Stage 3 Impacts to
document MME selection by AMF and AMF discovery by 5G-ANs. TS 29.244 Interface
between the Control Plane and the User Plane of EPC Nodes; Stage 3
Specification of the protocol for the N4 interface between the SMF and UPF.
* * *
#
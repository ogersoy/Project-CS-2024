# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
This 3GPP Technical Specification (TS) specifies:
1\. The interactions between the HSS (Home Subscriber Server) and the SIP AS
(Application Server) and between the HSS and the OSA SCS (Service Capability
Server). This interface is referred to as the Sh reference point.
2\. The interactions between the SIP AS and the SLF (Subscription Locator
Function) and between the OSA SCS and the SLF. This interface is referred to
as the Dh reference point.
The IP Multimedia (IM) Core Network Subsystem stage 2 is specified in 3GPP TS
23.228 [1] and the signalling flows for the IP multimedia call control based
on SIP and SDP are specified in 3GPP TS 24.228 [2].
The IP Multimedia (IM) Session Handling with the IP Multimedia (IM) call model
is specified in 3GPP TS 23.218 [4].
This document addresses the signalling flows and message contents for the
protocol at the Sh and Dh interface.
This document also addresses how the functionality of Ph interface is
accomplished.
The Presence Service Stage 2 description (architecture and functional
solution) is specified in 3GPP TS 23.141 [18].
# 2 References
[1] 3GPP TS 23.228: \"IP Multimedia (IM) Subsystem -- Stage 2\".
[2] 3GPP TS 24.228: \"Signalling flows for the IP multimedia call control
based on SIP and SDP (Release 5)\".
[3] 3GPP TS 23.002: \"Network architecture\".
[4] 3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IP Multimedia (IM)
call model\".
[5] 3GPP TS 29.329: \"Sh Interface based on Diameter -- Protocol details\".
[6] 3GPP TS 29.228: \"IP multimedia (IM) Subsystem Cx Interface; Signalling
flows and Message Elements\".
[7] 3GPP TS 29.229: \"Cx and Dx Interfaces based on the Diameter protocol ;
Protocol details\".
[8] Void.
[9] ITU-T recommendation Q.763: \"Signalling System No. 7 - ISDN User Part
formats and codes\".
[10] 3GPP TS 23.018: \"Basic Call Handling; Technical realization\".
[11] 3GPP TS 23.003: \"Numbering, Addressing and Identification\".
[12] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[13] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[14] 3GPP TS 23.078: \"Customised Applications for Mobile network Enhanced
Logic (CAMEL) Phase 3 - Stage 2\".
[15] IETF RFC 2045: \"Multipurpose Internet Mail Extensions (MIME) Part One:
Format of Internet Message Bodies\".
[16] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[17] IETF RFC 3966: \"The tel URI for Telephone Numbers\".
[18] 3GPP TS 23.141: \"Presence Service; Architecture and Functional
Description\".
[19] 3GPP TS 23.012: \"**Location Management Procedures** \".
[20] ANSI X3.4: \"Coded Character Set - 7-bit American Standard Code for
Information Interchange\"
[21] Void
[22] 3GPP TS 33.203: \"Access Security for IP-based services\".
[23] IETF RFC 791: \"Internet Protocol\".
[24] IETF RFC 4291: \"IP Version 6 Addressing Architecture\".
[25] IETF RFC 4412: \"Communications Resource Priority for the Session
Initiation Protocol (SIP)\".
[26] 3GPP TS 29.272: \"MME and SGSN Related Interfaces Based on Diameter
Protocol \".
[27] 3GPP TS 23.008: \"Organization of subscriber data\".
[28] 3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".
[29] 3GPP TS 23.060: \"3rd Generation Partnership Project; Technical
Specification Group Services and System Aspects; General Packet Radio Service
(GPRS); Service description; Stage 2\".
[30] 3GPP TS 29.118: \"SGs interface specification\".
[31] 3GPP TS 29.272: \"Evolved Packet System; MME and SGSN Related Interfaces
Based on Diameter Protocol\".
[32] 3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
2\".
[33] 3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) centralized services;
Stage 2\".
[34] 3GPP TS 29.273: \"3GPP EPS AAA interfaces\".
[35] IETF RFC 4776: \"Dynamic Host Configuration Protocol (DHCPv4 and DHCPv6)
Option for Civic Addresses Configuration Information\".
[36] IETF RFC 7683: \"Diameter Overload Indication Conveyance\".
[37] ETSI ES 283 034: \"e4 interface based on the DIAMETER protocol\".
[38] 3GPP TS 22.153: \"Multimedia Priority Service\".
[39] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and
SDP\" -- stage 3.
[40] 3GPP TS 29.364: \"IP Multimedia Subsystem (IMS) Application Server (AS)
service data description for AS interoperability\".
[41] IETF RFC 5952: \"A Recommendation for IPv6 Address Text Representation\".
[42] IETF RFC 7944: \"Diameter Routing Message Priority\".
[43] IETF RFC 8583: \"Diameter Load Information Conveyance\".
[44] IETF RFC 6733: \"Diameter Base Protocol\".
[45] 3GPP TS 24.323: \"3GPP IP Multimedia Subsystem (IMS) service level
tracing management object (MO)\".
[46] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces; Stage 3\".
[47] 3GPP TS 29.518: \"5G System; Access and Mobility Management Services;
Stage 3\".
[48] 3GPP TS 23.632: \"User data interworking, coexistence and migration;
Stage 2\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply.
**IP Multimedia session:** IP Multimedia session and IP Multimedia call are
treated as equivalent in this specification.
**Transparent data** : Data that is understood syntactically but not
semantically by the HSS. It is data that an AS may store in the HSS to support
its service logic. One example is data that an AS stores in the HSS, using it
as a repository.
**Non-transparent data** : Data that is understood both syntactically and
semantically by the HSS.
**AS (Application Server)** : a term used to denote either of a SIP
Application Server or an OSA Service Capability Server.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AS Application Server
C Conditional
CSCF Call Session Control Function
CSG Closed Subscriber Group
DRMP Diameter Routing Message Priority
DSCP Differentiated Services Code Point
GIBA GPRS-IMS-Bundled-Authentication
HSS Home Subscriber Server
IE Information Element
IP Internet Protocol
IM IP Multimedia
IMS IP Multimedia Subsystem
M Mandatory
O Optional
SIP Session Initiation Protocol
SLF Subscription Locator Function
S-CSCF Serving CSCF
# 4 Main Concept
This document presents the Sh interface related functional requirements of the
communicating entities.
It gives a functional classification of the procedures and describes the
procedures and message parameters.
Error handling flows, protocol version identification, etc. procedures are
also included.
# 5 General Architecture
This clause further specifies the architectural assumptions associated with
the Sh reference point, building on 3GPP TS 23.228 [1], 3GPP TS 23.218 [4] and
also the Ph reference point building upon 3GPP TS 23.141 [18].
## 5.1 Functional requirements of network entities
### 5.1.1 Functional Requirements of the Application Server
The Application Server may communicate with the HSS over the Sh interface.
For functionality of the Application Server refer to 3GPP TS 23.002 [3], 3GPP
TS 23.228 [1] and 3GPP TS 23.218 [4].
### 5.1.2 Functional requirements of HSS
The HSS may communicate with the Application Server over the Sh interface and
with the Presence Network Agent over the Ph interface. The functionality of
the Ph interface shall be the same as the functionality of the Sh interface.
For functionality of the HSS refer to 3GPP TS 23.002 [3], 3GPP TS 23.228 [1]
and 3GPP TS 23.218 [4].
### 5.1.3 Functional Requirements of the Presence Network Agent
The Presence Network Agent may communicate with the HSS over the Ph interface.
In this case, all references to an Application Server in this specification
apply also to a Presence Network Agent.
## 5.2 Functional classification of Sh interface procedures
Operations on the Sh interface are classified in functional groups:
1\. Data handling procedures
\- The download of data from the HSS to an AS.
\- The update of data in the HSS.
2\. Subscription/notification procedures
\- An AS can subscribe to receive notifications from the HSS of changes in
data.
\- The HSS can notify an AS of changes in data for which the AS previously had
subscribed.
# 6 Procedure Descriptions
In the tables that describe the Information Elements transported by each
command, each Information Element is marked as (M) Mandatory, (C) Conditional
or (O) Optional.
\- A mandatory Information Element (marked as (M) in the table) shall always
be present in the command. If this Information Element is absent, an
application error occurs at the receiver and an answer message shall be sent
back to the originator of the request with the Result-Code set to
DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP AVP
containing the missing Information Element i.e. the corresponding Diameter AVP
defined by the AVP Code and the other fields set as expected for this
Information Element.
\- A conditional Information Element (marked as (C) in the table) shall be
present in the command if certain conditions are fulfilled.
\- If the receiver detects that those conditions are fulfilled and the
Information Element is absent, an application error occurs and an answer
message shall be sent back to the originator of the request with the Result-
Code set to DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP
AVP containing the missing Information Element i.e. the corresponding Diameter
AVP defined by the AVP Code and the other fields set as expected for this
Information Element.
\- If those conditions are not fulfilled, the Information Element shall be
absent. If however this Information Element appears in the message, it shall
not cause an application error and it may be ignored by the receiver if this
is not explicitly defined as an error case. Otherwise, an application error
occurs at the receiver and an answer message with the Result-Code set to
DIAMETER_AVP_NOT_ALLOWED shall be sent back to the originator of the request.
A Failed-AVP AVP containing a copy of the corresponding Diameter AVP shall be
included in this message.
\- An optional Information Element (marked as (O) in the table) may be present
or absent in the command, at the discretion of the application at the sending
entity. Absence or presence of this Information Element shall not cause an
application error and may be ignored by the receiver.
When a procedure is required to determine the Public Identity used for an
identity lookup in HSS and SLF, the HSS and SLF shall derive the Public
Identity from the SIP URI or Tel URI contained in the Public-Identity AVP, if
not already in canonical form as per 3GPP TS 23.003 [11], as described below:
\- If the Public-Identity AVP contains a SIP URI, the HSS and SLF shall follow
rules for conversion of SIP URI into canonical form as specified in IETF RFC
3261 [16] chapter 10.3.
\- If the Public-Identity AVP contains a Tel URI in E.164 format, the HSS and
SLF shall remove visual separators and remove all URI parameters.
When a command contains a ServiceData XML element with or without content
(i.e. \\), the Service Data element is defined as
present in the clauses 6.1 to 6.4.
Unknown permanent failure error codes shall be treated in the same way as
DIAMETER_UNABLE_TO_COMPLY. For unknown transient failure error codes the
request may be repeated, or handled in the same way as
DIAMETER_UNABLE_TO_COMPLY.
## 6.1 User data handling procedures
### 6.1.1 Data read (Sh-Pull)
This procedure is used between the AS and the HSS. The procedure is invoked by
the AS and is used:
\- To read transparent and/or non-transparent data for a specified user from
the HSS.
This procedure is mapped to the commands User-Data-Request/Answer in the
Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.1.1 and
6.1.1.2 detail the involved information elements.
Table 6.1.1.1: Sh-Pull
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | (See 7.1) | | | Identity, Public | | | | | Service Identity, | | | | | MSISDN or | | | | | External | | | | | Identifier of the | | | | | user for whom the | | | | | data is required. | | | | | | | | | | See clause 7.1 | | | | | for the content | | | | | of this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | PSI. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded Public | | | | | User Identity | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public User | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | Public User | | | | | Identity. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded PSI | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Requested data | Data-Reference | M | This information | | | | | element indicates | | (See 7.3) | | | the reference to | | | | | the requested | | | | | information. The | | | | | set of valid | | | | | reference values | | | | | are defined in | | | | | 7.6. | +-------------------+-------------------+------+-------------------+ | Requested | Identity-Set | O | If Data-Reference | | Identity set (See | | | indicates that | | 7.11) | | | IMS Public | | | | | Identities is the | | | | | requested data | | | | | set to be | | | | | downloaded, this | | | | | information | | | | | element should be | | | | | included and it | | | | | indicates the | | | | | information to be | | | | | downloaded. See | | | | | clause 7.6.2. | +-------------------+-------------------+------+-------------------+ | Requested domain | Requested-Domain | C | This information | | | | | element indicates | | (See 7.2) | | | the domain to | | | | | which the | | | | | operation is | | | | | applicable. Check | | | | | table 7.6.1 to | | | | | see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Requested nodes | Requested-Nodes | O | This information | | | | | element indicates | | (See 7.2A) | | | the Node Types to | | | | | which the | | | | | operation is | | | | | applicable. Check | | | | | table 7.6.1 to | | | | | see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Current Location | Current-Location | C | This information | | | | | element indicates | | (See 7.8) | | | whether an active | | | | | location | | | | | retrieval has to | | | | | be initiated or | | | | | not. It shall be | | | | | present if | | | | | Location | | | | | Information is | | | | | requested. | | | | | | | | | | If this | | | | | information | | | | | element takes the | | | | | value | | | | | InitiateActive | | | | | LocationRetrieval | | | | | (1) the HSS shall | | | | | indicate to the | | | | | MSC/VLR and/or | | | | | SGSN and/or MME | | | | | the need to | | | | | initiate an | | | | | active location | | | | | retrieval. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Service | S | C | IE that | | Indication | ervice-Indication | | identifies, | | | | | together with the | | (See 7. 4) | | | User Identity | | | | | included in the | | | | | User-Identity AVP | | | | | and | | | | | Data-Reference, | | | | | the set of | | | | | service related | | | | | transparent data | | | | | that is being | | | | | requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Application | Origin-Host | M | IE that | | Server Identity | | | identifies the AS | | (See 7.9) | | | originator of the | | | | | request and that | | | | | is used to check | | | | | the AS permission | | | | | list. | +-------------------+-------------------+------+-------------------+ | Application | Server-Name | C | IE that is used, | | Server Name (See | | | together with the | | 7.10) | | | User Identity | | | | | included in the | | | | | User-Identity AVP | | | | | and | | | | | Data-Reference, | | | | | as key to | | | | | identify the | | | | | filter criteria. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | DSAI Tag (See | DSAI-Tag | C | IE that is used, | | 7.14) | | | together with the | | | | | User Identity | | | | | included in the | | | | | User-Identity AVP | | | | | and | | | | | Data-Reference, | | | | | as key to | | | | | identify the | | | | | instance of | | | | | Dynamic Service | | | | | Activation Info | | | | | (DSAI) requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Session Priority | Session-Priority | O | This information | | (see 7.15) | | | element, if | | | | | present, shall | | | | | indicate the | | | | | session\'s | | | | | priority to the | | | | | HSS. | +-------------------+-------------------+------+-------------------+ | Private Identity | User-Name | C | Private Identity | | | | | of the user for | | (see 7.6.19) | | | whom the data is | | | | | required. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Serving Node | Servin | O | This information | | Indication | g-Node-Indication | | element shall | | | | | indicate that | | (See 7.2B) | | | only the serving | | | | | node | | | | | address/identity | | | | | associated to the | | | | | location data is | | | | | required. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Pre-paging | Pre | O | This information | | Supported | -paging-Supported | | element shall | | | | | indicate whether | | (See 7.18) | | | the AS supports | | | | | pre-paging or | | | | | not. | | | | | | | | | | It indicates by | | | | | its absence that | | | | | the AS does not | | | | | support | | | | | pre-paging. For | | | | | details see 3GPP | | | | | TS 23.018 [10]. | +-------------------+-------------------+------+-------------------+ | Local Time Zone | Local-Tim | O | This information | | Indication | e-Zone-Indication | | element shall | | | | | indicate that the | | (See 7.19) | | | Local Time Zone | | | | | is requested and | | | | | shall indicate | | | | | whether only the | | | | | Local Time Zone | | | | | is required or | | | | | the Local Time | | | | | Zone is required | | | | | together with | | | | | other location | | | | | data. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | UDR Flags | UDR-Flags | O | This Information | | | | | Element contains | | (See 7.20) | | | a bit mask. See | | | | | 7.x for the | | | | | meaning of the | | | | | bits. | +-------------------+-------------------+------+-------------------+ | Ca | Ca | O | This Information | | ll-Reference-Info | ll-Reference-Info | | Element contains | | | | | a Call Reference | | (See 7.21) | | | Number and the | | | | | AS-Number. May be | | | | | present when Data | | | | | Reference is | | | | | CSRN. It allows a | | | | | later retry of | | | | | the call setup in | | | | | the context of | | | | | MTRR. See 3GPP TS | | | | | 23.292 [33] | +-------------------+-------------------+------+-------------------+
Table 6.1.1.2: Sh-Pull Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Exp | | request. | | (See 7.5) | erimental_Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter base | | | | | protocol (see | | | | | IETF | | | | | RFC 6733 [44]). | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | specific PSI | | | | | matching a | | | | | Wildcarded PSI | | | | | and the | | | | | Wildcarded PSI | | | | | was not included | | | | | in the request | | | | | and is not | | | | | included in the | | | | | User-Data AVP, | | | | | the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Public User | | | | | Identity matching | | | | | a Wildcarded | | | | | Public User | | | | | Identity and the | | | | | Wildcarded-IMPU | | | | | AVP was not | | | | | included in the | | | | | request and is | | | | | not included in | | | | | the User-Data | | | | | AVP, the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded Public | | | | | User Identity. | +-------------------+-------------------+------+-------------------+ | Data | User-Data | C | Requested data. | | | | | This information | | (See 7.6) | | | element shall be | | | | | present if the | | | | | requested data | | | | | exists in the HSS | | | | | and the AS has | | | | | permissions to | | | | | read it. | +-------------------+-------------------+------+-------------------+
#### 6.1.1.1 Detailed behaviour
The HSS may prioritise the received request message according to priority
level received within the Session-Priority AVP.
NOTE 1: Refer to Annex I for HSS procedures associated with the handling of
both the Session-Priority AVP and DRMP AVP received in the request message.
The conditions for the inclusion of Requested-Domain and Requested-Node as an
additional key to the requested data are described in table 7.6.1. If
repository data is requested, Service-Indication shall be present in the
request. If initial filter criteria are requested, the Server-Name AVP shall
contain the SIP URL of the AS that initiates the request; requests for initial
filter criteria are limited to those initial filter criteria which are
relevant to the requesting AS. If DSAI information is requested, the DSAI-Tag
AVP shall be present.
Upon reception of the Sh-Pull request, the HSS shall, in the following order:
1\. In the AS permission list (see clause 6.2) check that the requested user
data is allowed to be read (Sh-Pull) by this AS by checking the combination of
the identity of the AS sending the request (identified by the Origin-Host AVP)
and the supplied Data-Reference.
> If one or more Data References in the request are not allowed to be read,
> Experimental-Result shall be set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_READ
> in the Sh-Pull Response.
2\. Check that the User Identity for whom data is asked exists in HSS. If not,
Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-Pull
Response.
2a. Check if the Private Identity (if received) corresponds to
IMPU/MSISDN/External Identifier received in User-Identity. If not,
Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.
3\. If the type of the User Identity (i.e. IMS Public User Identity or Public
Service Identity, MSISDN or External Identifier) does not apply according to
Table 7.6.1 as access key for the Data-Reference (if Notif-Eff is in use: for
all the Data-References) indicated in the request, Experimental-Result shall
be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Pull Response.
3a. If data-reference is IPAddressSecureBindingInformation (22) and the User
Identity is an IMS Public User Identity that is shared between multiple
Private User Identities, Experimental-Result shall be set to
DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Pull Response.
4\. Check whether or not the data that is requested to be downloaded by the AS
is currently being updated by another entity. If there is an update of the
data in progress, the HSS may delay the Sh-Pull-Resp message until the update
has been completed. The HSS shall ensure that the data returned is not
corrupted by this conflict. If HSS is not able to delay the Sh-Pull-Resp
message e.g. due to timeout the Experimental-Result-Code shall be set to
DIAMETER_USER_DATA_NOT_AVAILABLE.
4a. If T-ADS Information is requested, the HSS/UDM shall take into account
information possibly received from MME ,SGSN, and/or AMF during the
registration, location update or notification procedure, in order to decide
whether MME, SGSN and/or AMF need to be contacted before a response is sent to
the AS.
\- The HSS/UDM shall provide the most recent IMS Voice over PS Sessions
support indication as indicated by the serving nodes. The HSS/UDM shall
provide the Access Type and RAT type, if available. The HSS/UDM may also
provide the last UE activity time, if available which should include a
specific timezone. See Annex E.
NOTE 2: The last UE activity time without a specific timezone can result in
IMS receiving unexpected time if timezone is not included, especially for
roaming to PLMN with different timezone.
\- If all serving nodes need to be contacted, and if at least one serving node
does not support T-ADS Data Retrieval or did not successfully answer to the
T-ADS request from the HSS, the HSS shall indicate that IMS Voice over PS
Sessions support is unknown, i.e., the HSS shall not indicate support, or non-
support, of IMS Voice over PS Sessions unless all registered serving nodes
have provided indication of their support, non-support, or detached status.
\- If the HSS/UDM knows that one of the registered serving nodes is a Gn/Gp-
SGSN, the HSS/UDM shall not contact the MME for T-ADS Data Retrieval, and
shall provide the most recent IMS Voice over PS Sessions support indication as
indicated by the Gn/Gp-SGSN and/or the AMF. If the Gn/Gp-SGSN needs to be
contacted and it does not support T-ADS Data Retrieval, the HSS shall indicate
IMS Voice over PS Sessions support is unknown.
NOTE 3: If the UE is registered with both MME and SGSN, and the HSS knows that
the SGSN is a Gn/Gp-SGSN, the HSS does not need to know if the MME supports
IMS Voice over PS Sessions or not. The HSS can determine that the SGSN
registered is a Gn/Gp-SGSN by different ways, e.g. by configuration, or
according to the information (e.g. EPS Subscription Data Not Needed Indicator)
received in MAP_UpdateGPRSLocation request.
NOTE 4: If the UE is registered with both MME and SGSN, and the HSS is unable
to know that the SGSN is a Gn/Gp-SGSN, the HSS will indicate IMS Voice over PS
Sessions support as unknown if the MME does not support T-ADS Data Retrieval
or did not successfully answer to the T-ADS request from the HSS, even if the
Gn/Gp-SGSN indicated IMS Voice over PS Sessions is supported.
\- If the serving node answers successfully to the T-ADS data request, but it
does not include any of the T-ADS Information Elements (IMS Voice over PS
Sessions Supported, Access Type, RAT Type and Last UE Activity Time), the HSS
shall indicate IMS Voice over PS Sessions support is not supported, unless the
subscriber is attached in another node that indicates support (if applicable).
\- If at least one serving node provided T-ADS data to the HSS, the HSS may
also provide the received last UE activity time which should include a
specific timezone, Access Type and RAT type. If all serving nodes successfully
answer to the T-ADS request from the HSS, the HSS shall provide the most
recent IMS Voice over PS Sessions support indication as indicated by the
serving nodes.
NOTE 5: The last UE activity time without a specific timezone can result in
IMS receiving unexpected time if timezone is not included, especially for
roaming to PLMN with different timezone.
4b. If CSRN is requested but roaming number retrieval from the MSC/VLR fails,
the HSS shall include an empty CSRN element in the xml document returned to
the AS. In addition, if MTRR is applicable (see 3GPP TS 23.018 [10]), the HSS
shall set an MTRR-Indication in the xml document. See 3GPP TS 23.292 [33].
5\. The HSS shall include the data pertinent to the requested Data Reference
in the User-Data AVP. The HSS shall set the Result-Code to DIAMETER_SUCCESS.
This includes cases where the data is not available to the HSS. The pertinent
data included shall refer to the received IMPU/MSISDN/External Identifier and
Private Identity (if present).
NOTE 6: Data referred to a Private Identity (e.g. IMS Private User Identity)
implies that only the data (e.g. Location Information) specific for that
Private Identity is included, regardless of the type of User Identity received
(e.g. IMS Public User Identity shared by multiple IMS Private User
Identities).
If both the AS and the HSS have determined via mutual feature evaluation to
not support the Notif-Eff feature and in the case that requested data is not
available to the HSS, the HSS shall not include the User-Data AVP in the Sh-
Pull Response.
If both the AS and the HSS support the Notif-Eff feature, the HSS shall
include the data pertinent to all the requested Data References, Service
Indications and Identity Sets in the User-Data AVP. The following applies:
\- If none of the requested data is available to the HSS, the HSS shall not
include the User-Data AVP in the Sh-Pull Response.
\- If some of the requested data is not available to the HSS, it shall be
indicated as follows:
\- Empty repository data shall be indicated with the RepositoryData element
that contains a Service Indication and a Sequence Number but does not contain
a ServiceData element (i.e. ServiceData is not present).
\- Unavailable Public Identifiers shall be indicated with an empty
PublicIdentifiers element.
\- Unavailable location information shall be indicated by an empty
CSLocationInformation and/or an empty PSLocationInformation element and/or an
empty EPSLocationInformation element.
\- Unavailable CS-UserState shall be indicated by a missing CSUserState
element.
\- Unavailable PS-UserState shall be indicated by a missing PSUserState
element.
\- Unavailable EPS-UserState shall be indicated by a missing EPSUserState
element.
\- Unavailable elements of Sh IMS Data shall be indicated as follows:
\- An unavailable S-CSCF name shall be indicated with empty SCSCFName element.
\- An unavailable IP Address Secure Binding Information shall be indicated
with empty IPv4address element or empty IPv6prefix element.
\- If all iFCs for the user that are relevant for the AS are unavailable it
shall be indicated with empty IFCs element.
\- Not available UE SRVCC capability shall be indicated with missing UE-SRVCC-
Capability element.
\- Not available UE 5G SRVCC capability shall be indicated with missing
UE-5G-SRVCC-Capability element.
\- Not available STN-SR shall be indicated with empty STN-SR element.
NOTE 7: If the HSS supports interworking with UDM, the HSS can also take into
account the availability of the STN-SR from the UDM as described in 3GPP TS
23.632 [48].
\- Not available CSRN shall be indicated with empty CSRN element.
\- Not available IMSI shall be indicated with empty IMSI element.
NOTE 8: If there is no available STN-SR in the HSS, it indicates that the user
is not SRVCC subscribed and if there is no available STN-SR from the UDM, it
indicates that the user is not 5G-SRVCC subscribed, as described in 3GPP TS
23.008 [27] and 3GPP TS 23.632 [48].
If there is an error in any of the above steps, then the HSS shall stop
processing and shall return the error code specified in the respective step
(see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7] for an explanation of the error
codes).
If the HSS cannot fulfil the received request for reasons not stated in the
above steps, e.g. due to a database error or empty mandatory data elements, it
shall stop processing the request and set Result-Code to
DIAMETER_UNABLE_TO_COMPLY.
Otherwise, the requested operation shall take place and the HSS shall return
the Result-Code AVP set to DIAMETER_SUCCESS. Result-Code DIAMETER_SUCCESS is
used also if the requested data does not exist in the HSS i.e. when the HSS is
indicating valid empty data elements.
### 6.1.2 Data Update (Sh-Update)
This procedure is used between the AS and the HSS. The procedure is invoked by
the AS and is used:
\- To allow the AS to update the transparent (repository) data stored at the
HSS for each IMS Public User Identity (for Public User Identities matching a
Wildcarded Public User Identity, the transparent data shall be stored per
Wildcarded Public User Identity, and not for each specific Public User
Identity matching that Wildcarded Public User Identity) or Public Service
Identity (for Public Service Identities matching a Wildcarded PSI, the
transparent data shall be stored per Wildcarded PSI, and not for each specific
Public Service Identity matching that Wildcarded PSI).
\- To allow the AS to update the PSI Activation State of a distinct Public
Service Identity in the HSS.
\- To allow the AS to update the Dynamic Service Activation Info stored at the
HSS.
\- To allow the AS to update the Short Message Service Registration Info
stored at the HSS.
\- To allow the AS to update the STN-SR stored at the HSS and/or the STN-SR
stored at the UDM.
NOTE: In accordance with 3GPP TS 23.632 [48], if there is only an STN-SR
available in the UDM, the STN-SR in the UDM is updated. If there is only an
STN-SR available in the HSS, the STN-SR in the HSS is updated. If there is an
STN-SR available in the UDM and in the HSS, the STN-SR in the UDM and the HSS
are updated.
This procedure is mapped to the commands Profile-Update-Request/Answer in the
Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.2.1 and
6.1.2.2 detail the involved information elements.
Table 6.1.2.1: Sh-Update
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | | | | Identity or | | (See 7.1) | | | Public Service | | | | | Identity or | | | | | MSISDN or | | | | | External | | | | | Identifier for | | | | | which data is | | | | | updated. | | | | | | | | | | See clause 7.1 | | | | | for the content | | | | | of this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | PSI. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded Public | | | | | User Identity | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public User | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | Public User | | | | | Identity. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded PSI | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Requested data | Data-Reference | M | This information | | | | | element includes | | (See 7.3) | | | the reference to | | | | | the data on which | | | | | updates are | | | | | required | | | | | (possible values | | | | | of the Data | | | | | Reference are | | | | | defined in Table | | | | | 7.6.1). | +-------------------+-------------------+------+-------------------+ | Data | User-Data | M | Updated data. | | | | | | | (See 7.6) | | | | +-------------------+-------------------+------+-------------------+ | Application | Origin-Host | M | IE that | | Server Identity | | | identifies the AS | | | | | originator of the | | (See 7.9) | | | request and that | | | | | is used to check | | | | | the AS permission | | | | | list. | +-------------------+-------------------+------+-------------------+ | Private identity | User-Name | C | Private Identity | | | | | of the user for | | (see 7.6.19) | | | whom the data is | | | | | required. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+
Table 6.1.2.2: Sh-Update Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | update of data in | | (See 7.5) | perimental-Result | | the HSS. | | | | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter base | | | | | protocol (see | | | | | IETF | | | | | RFC 6733 [44]). | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | specific PSI | | | | | matching a | | | | | Wildcarded PSI | | | | | and the | | | | | Wildcarded-PSI | | | | | was not included | | | | | in the request, | | | | | the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Public User | | | | | Identity matching | | | | | a Wildcarded | | | | | Public User | | | | | Identity and the | | | | | Wildcarded-IMPU | | | | | AVP was not | | | | | included in the | | | | | request, the HSS | | | | | may include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded Public | | | | | User Identity. | +-------------------+-------------------+------+-------------------+ | Repository Data | R | O | If the HSS and | | ID (See 7.17) | epository-Data-ID | | the AS support | | | | | the Update-Eff | | | | | feature or the | | | | | U | | | | | pdate-Eff-Enhance | | | | | feature and if a | | | | | Sh-Update Request | | | | | with multiple | | | | | repository data | | | | | fails, this | | | | | information | | | | | element shall | | | | | include the | | | | | service | | | | | indication and | | | | | the sequence | | | | | number of the | | | | | repository data | | | | | instance that has | | | | | generated the | | | | | error. | +-------------------+-------------------+------+-------------------+ | Requested data | Data-Reference | O | If the HSS and | | | | | the AS support | | (See 7.3) | | | the | | | | | U | | | | | pdate-Eff-Enhance | | | | | feature and if an | | | | | Sh-Update Request | | | | | with multiple | | | | | data references | | | | | fails, this | | | | | information | | | | | element shall | | | | | include the Data | | | | | reference for the | | | | | data instance | | | | | that has | | | | | generated the | | | | | error. | +-------------------+-------------------+------+-------------------+
#### 6.1.2.1 Detailed behaviour
Within the Sh-Update Request, the keys to determine the updated data are part
of the information element Data (See 7.6). When data in the repository is
updated (i.e. added, modified or removed) Service-Indication and Sequence-
Number are also sent as part of the information element Data.
Newly added transparent data shall be associated with a Sequence Number of 0
in the Sh-Update Request. Sequence Number value 0 is reserved exclusively for
indication of newly added transparent data.\ Modified and removed transparent
data shall be associated within the Sh-Update Request with a Sequence Number
of n+1 where n is the original Sequence Number associated with the transparent
data before modification or removal. If n equals 65535, then the next
modification or deletion of that transparent data shall be associated with a
Sequence Number of 1.
Upon reception of the Sh-Update request, the HSS shall, in the following
order:
1\. In the AS permission list (see clause 6.2) check that the data that is
requested to be updated (Sh-Update) by this AS, is allowed to be updated by
checking the combination of the identity of the AS sending the request
(identified by the Origin-Host AVP) and the supplied Data-Reference.
> \- If the data is not allowed to be updated, Experimental-Result shall be
> set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_MODIFIED in the Sh-Update
> Response.
2\. Check that the User Identity in the request exists in the HSS. If not,
Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-
Update Response.
2a. Check if the Private User Identity (if received) corresponds to the
IMPU/MSISDN/External Identifier received in User-Identity. If not,
Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.
3\. If the type of the User Identity (i.e. IMS Public User Identity or Public
Service Identity or MSISDN or External Identifier) does not apply according to
Table 7.6.1 as access key for the Data-Reference (if Update-Eff-Enhance is in
use: for all the Data-References) indicated in the request, Experimental-
Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Update
Response.
4\. If Data-Reference is PSIActivation (18), then the HSS shall check that the
User Identity contains a distinct Public Service Identity. If it does, then
the HSS shall update the corresponding PSI Activation State and return the
Result-Code AVP set to DIAMETER_SUCCESS. If it does not, then the
Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in
the Sh-Update Response.
The change of a Public Service Identity from ACTIVE to INACTIVE shall trigger
the network initiated deregistration of the Public Service Identity in the
HSS.
4a. If Data-Reference is DSAI (19), check whether or not, for the Public
Identity, there is an instance of DSAI matching the DSAI-Tag contained in the
Sh-Update command. If so, then the HSS shall update the DSAI value and return
the Result-Code AVP set to DIAMETER_SUCCESS. If not, Experimental-Result shall
be set to DIAMETER_ERROR_DSAI_NOT_AVAILABLE.
The changes of DSAI value shall trigger the procedures described in clause
7.14 in order to determine which initial filter criteria should be masked or
unmasked. If these procedures change the set of unmasked initial filter
criteria, the HSS should behave as if the initial filter criteria had been
administratively changed, which implies e.g. sending Sh-Notif or Cx-
Update_Subscr_Data messages (see 3GPP TS 29.228 [6]).
4b. If Data-Reference is SMSRegistrationInfo (24), check whether or not, for
the IMS Public User Identity or MSISDN or External Identifier, IP-SM-GW number
element contained in the Sh-Update command is empty. If it is empty, then the
HSS shall delete the stored registered IP-SM-GW number (if any) and the stored
registered IP-SM-GW Diameter Identity (if any), and return the Result-Code AVP
set to DIAMETER_SUCCESS. A preconfigured IP-SM-GW number and preconfigured IP-
SM-GW Diameter Identity shall not be deleted.
If it is not empty, the HSS shall store/update the registered IP-SM-GW number
and, if S6c is supported, the IP-SM-GW Diameter Identity as received within
the Origin-Host and Origin-Realm AVPs, and return the Result-Code AVP set to
DIAMETER_SUCCESS. A preconfigured IP-SM-GW number and preconfigured IP-SM-GW
Diameter Identity shall not be overwritten.
The Service Centre Address in the HSS shall not be updated by this operation.
NOTE 1: The address of the Short Message Service Centre as defined in 7.6.16
is only applicable to Sh-Pull operation.
4c. If the Data-Reference indicates that repository data is present, and if
the HSS and the AS supports the Update-Eff feature, check whether there are
multiple repository data instances. If so, then repeat the steps 5 and 6 below
for each instance of repository data ensuring that no repository data is
changed until the checks done in the steps 5 and 6 have been successful for
all the repository data instances.
4d. If the Data-Reference is STN-SR (27) and if the STN-SR is different from
the one previously stored or provisioned in the HSS, the HSS shall overwrite
the STN-SR. If the Data-Reference is STN-SR (27), the HSS supports
interworking with the UDM (see in 3GPP TS 23.632 [48]), and if the STN-SR is
different from the one previously stored or provisioned in the UDM, the UDM
shall overwrite the STN-SR. If the Data-Reference is STN-SR (27), and if there
is no stored STN-SR in the HSS and there is no stored STN-SR in the UDM,
Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in
the Sh-Update Response.
NOTE 2: If there is no stored STN-SR in the HSS, it indicates that the user is
not SRVCC subscribed and if there is no stored STN-SR in the UDM, it indicates
that the user is not 5G-SRVCC subscribed, as described in 3GPP TS 23.008 [27].
5\. Check whether or not the data that is requested to be updated by the AS,
as identified by the Service-Indication, is currently being updated by another
entity. If there is an update of the data in progress, Experimental-Result
shall be set to DIAMETER_PRIOR_UPDATE_IN_PROGRESS in the Sh-Update Response.
6\. Check whether or not there is any repository data stored at the HSS
already for the specified Service-Indication and the associated IMS Public
User Identity (or group if the IMS Public User Identity is alias) or Public
Service Identity.
\- If repository data identified by the Service-Indication is stored at the
HSS for the specified IMS Public User Identity, IMS Public User Identity group
or Public Service Identity, check the following premises:
1\. Sequence_Number_in_Sh_Update is not equal to 0
2\. (Sequence_Number_in_Sh_Update - 1) is equal to (Sequence_Number_In_HSS
modulo 65535)
\- If either of the above premises is false then Experimental-Result shall be
set to DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC in the Sh-Update Response.
\- If both of the above premises are true, then check whether or not Service
Data is received within the Sh-Update Req.
\- If Service Data element is present in the Sh-Update Req, check whether or
not the size of the data is greater than that which the HSS is prepared to
accept.
\- If there is more data than the HSS is prepared to accept then Experimental-
Result shall be set to DIAMETER_ERROR_TOO_MUCH_DATA and the new data shall be
discarded.
\- If the HSS is prepared to accept the data, then the repository data stored
at the HSS shall be updated with the repository data sent in the Sh-Update Req
and the Sequence Number associated with that repository data shall be updated
with that sent in the Sh-Update Req. This triggers the sending of Sh-Notif
messages to any other ASs that are subscribed to Notifications for updates to
the service data for that IMS Public User Identity or Public Service Identity.
This also triggers the sending of Sh-Notif messages for an alias of that IMS
Public User Identity to any AS that is subscribed to Notifications for updates
to the service data for that alias of the received IMS Public User Identity
(see clause 6.1.4).
\- If Service Data element is not present in the Sh-Update Req, the data
stored in the repository at the HSS shall be removed, and as a consequence the
Service Indication and the Sequence Number associated with the removed data
shall also be removed. This triggers the sending of Sh-Notif messages with
that Service Indication and Sequence Number to be deleted but with an absent
Service Data element, to any other ASs that are subscribed to Notifications
for updates to the service data for that IMS Public User Identity or Public
Service identity (see 6.1.4). After sending Sh-Notif messages, the
subscriptions to Notifications for the removed Repository Data shall be
deleted.
\- If repository data identified by the Service-Indication is not stored for
the IMS Public User Identity, IMS Public User Identity group or Public Service
Identity i.e. the Sh-Update Req intends to create a new repository data, check
whether or not the Sequence Number in the Sh-Update Req is 0.
\- If the sequence number is not set to 0, Experimental-Result shall be set to
DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC
\- If the sequence number is set to 0 check whether Service Data is included
within the Sh-Update Req.
\- If Service Data is not present in the Sh-Update Req, then Experimental-
Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED and the operation
shall be ignored by the HSS.
\- If Service Data element is present in the Sh-Update Req, check whether or
not the size of the data is greater than that which the HSS is prepared to
accept.
\- If there is more data than the HSS is prepared to accept then
Experimental‑Result shall be set to DIAMETER_ERROR_TOO_MUCH_DATA and the new
data shall be discarded.
\- If the HSS is prepared to accept the data included in the Sh-Update Req,
then the data shall be stored in the data repository in the HSS.
If the HSS receives a request to update data other than Repository Data while
a previous update request of the same data for the same user identity is still
in progress, the HSS should stop processing the later request and set the
Experimental-Result-Code to DIAMETER_PRIOR_UPDATE_IN_PROGRESS.
NOTE 3: If the HSS receives a request to update data other than Repository
Data while a previous update request of the same data for the same user
identity is still in progress, it identifies either an AS or network
misbehavior. If the HSS processed those requests it could cause a network
unexpected behaviour.
If there is an error in any of the above steps then the HSS shall stop
processing and shall return the error code specified in the respective step
(see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7] for an explanation of the error
codes).
If the HSS cannot fulfil the received request for reasons not stated in the
above steps, e.g. due to database error, it shall stop processing the request
and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.
If the HSS and the AS support the Update-Eff feature, the Sh Update is
successful only if it is successful for the update of all the repository data
instances in the request. Otherwise the HSS shall keep or restore all the
stored repository data as they were before receiving the Sh Update request. If
the error occurs during the steps 5 or 6 and if there were several repository
data instances in the request, the Sh Update response shall contain a
Repository Data ID indicating the service indication and the sequence number
of (one of) the repository data instance(s) for which an error occurred.
If the HSS and the AS support the Update-Eff-Enhance feature, the Sh Update is
successful only if it is successful for the update of all the data instances
in the request. Otherwise the HSS shall keep or restore all the stored data as
they were before receiving the Sh Update request. If an error occurs during
the steps 5 or 6 with any of the data instance in the request, the Sh Update
response shall contain the corresponding Data Reference indicating the first
data instance for which an error occurred. If there were several repository
data instances in the request, the HSS shall behave the same as specified for
Update-Eff feature.
Otherwise, the requested operation shall take place and the HSS shall return
the Result-Code AVP set to DIAMETER_SUCCESS.
NOTE 4: When an AS receives DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC the AS
may attempt to resolve the inconsistency between the version of the repository
data that it holds and that stored at the HSS. It may execute a Sh-Pull to
retrieve the current version of the data from the HSS or it may wait to
receive a subsequent Sh-Notif message from the HSS for the affected repository
data.
### 6.1.3 Subscription to notifications (Sh-Subs-Notif)
This procedure is used between the AS and the HSS. The procedure is invoked by
the AS and is used:
\- To subscribe to Notifications for when particular transparent and/or non-
transparent data for a specified IMS Public User Identity or Public Service
Identity is updated, from the HSS.
\- Optionally to request the user data from the HSS in the same operation.
This procedure is mapped to the commands Subscribe-Notifications-
Request/Answer in the Diameter application specified in 3GPP TS 29.329 [5].
Tables 6.1.3.1 and 6.1.3.2 detail the information elements involved.
Table 6.1.3.1: Sh-Subs-Notif
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | | | | Identity or | | (See 7.1) | | | Public Service | | | | | Identity or | | | | | MSISDN or | | | | | External | | | | | Identifier for | | | | | which | | | | | notifications of | | | | | data changes are | | | | | requested. See | | | | | clause 7.1 for | | | | | the content of | | | | | this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | PSI. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded Public | | | | | User Identity | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the AS may | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it | | | | | should be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public User | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | Public User | | | | | Identity. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded PSI | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Requested Data | Data-Reference | M | This information | | | | | element includes | | (See 7.3) | | | the reference to | | | | | the data on which | | | | | notifications of | | | | | change are | | | | | required (valid | | | | | reference values | | | | | are defined in 7. | | | | | 6). | +-------------------+-------------------+------+-------------------+ | Subscription | Subs-Req-Type | M | This information | | request type (See | | | element indicates | | 7.7) | | | the action | | | | | requested on | | | | | subscription to | | | | | notifications. | +-------------------+-------------------+------+-------------------+ | Send Data | Sen | O | This information | | Indication | d-Data-Indication | | element requests | | | | | that the data is | | (See 7.13) | | | sent in the | | | | | response. | | | | | | | | | | Send Data | | | | | Indication is not | | | | | applicable to one | | | | | time | | | | | subscriptions to | | | | | UE reachability | | | | | for IP. | +-------------------+-------------------+------+-------------------+ | Service | S | C | IE that | | Indication | ervice-Indication | | identifies, | | | | | together with the | | (See 7.4) | | | User Identity and | | | | | Data-Reference, | | | | | the set of | | | | | service related | | | | | transparent data | | | | | for which | | | | | notifications of | | | | | changes are | | | | | requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Application | Origin-Host | M | IE that | | Server Identity | | | identifies the AS | | (See 7.9) | | | originator of the | | | | | request and that | | | | | is used to check | | | | | the AS permission | | | | | list. | +-------------------+-------------------+------+-------------------+ | Application | Server-Name | C | IE that is used, | | Server Name (See | | | together with the | | 7.10) | | | User Identity and | | | | | Data-Reference, | | | | | as key to | | | | | identify the | | | | | filter criteria. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Expiry Time (See | Expiry-Time | O | Gives the | | 7.12) | | | absolute time | | | | | requested at | | | | | which the | | | | | subscription | | | | | expires. | +-------------------+-------------------+------+-------------------+ | Dynamic Service | DSAI-Tag | C | IE that | | Activation | | | identifies, | | Information Tag | | | together with the | | (see 7.14) | | | User Identity and | | | | | Data-Reference, | | | | | the instance of | | | | | Dynamic Service | | | | | Activation Info | | | | | (DSAI) requested. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+ | Requested | Identity-Set | C | If Data-Reference | | Identity set (See | | | indicates that | | 7.11) | | | IMS Public | | | | | Identities is the | | | | | requested data | | | | | set, this | | | | | information | | | | | element shall be | | | | | included and it | | | | | indicates the | | | | | information to be | | | | | subscribed to | | | | | (and optionally | | | | | to be | | | | | downloaded). See | | | | | clause 7.6.2. | +-------------------+-------------------+------+-------------------+ | One time | One-Time- | C | This information | | notification (See | Notification | | element indicates | | 7.16) | | | if subscription | | | | | shall be ended by | | | | | the HSS after | | | | | sending the first | | | | | notification. | | | | | | | | | | This IE shall be | | | | | present for UE | | | | | reachability for | | | | | IP. | +-------------------+-------------------+------+-------------------+ | Private identity | User-Name | O | Private Identity | | | | | of the user for | | (see 7.6.19) | | | whom the data is | | | | | required. | | | | | | | | | | Check table 7.6.1 | | | | | to see when it is | | | | | applicable. | +-------------------+-------------------+------+-------------------+
Table 6.1.3.2: Sh-Subs-Notif Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Expiry Time (See | Expiry-Time | O | Acknowledges the | | 7.12) | | | absolute time at | | | | | which the | | | | | subscription | | | | | expires. | +-------------------+-------------------+------+-------------------+ | Data (See 7.6) | User-Data | O | Current values of | | | | | the data for | | | | | which | | | | | notifications | | | | | have been | | | | | requested. | | | | | | | | | | It should be | | | | | present if the | | | | | Sen | | | | | d-Data-Indication | | | | | AVP is set to | | | | | value | | | | | USER\ | | | | | _DATA_REQUESTED. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | specific PSI | | | | | matching a | | | | | Wildcarded PSI | | | | | and the | | | | | Wildcarded PSI | | | | | was not included | | | | | in the request | | | | | and is not | | | | | included in the | | | | | User-Data AVP, | | | | | the HSS may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded PSI. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Public User | | | | | Identity matching | | | | | a Wildcarded | | | | | Public User | | | | | Identity and the | | | | | Wildcarded-IMPU | | | | | AVP was not | | | | | included in the | | | | | request, the HSS | | | | | may include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. This | | | | | information may | | | | | be used by the AS | | | | | to identify the | | | | | affected | | | | | Wildcarded Public | | | | | User Identity. | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | request. | | (See 7.5) | perimental-Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter base | | | | | protocol (see | | | | | IETF | | | | | RFC 6733 [44]). | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+
#### 6.1.3.1 Detailed behaviour
The HSS shall take note of the subscription request on the data identified by
User Identity and Data-Reference. If notifications on changes of repository
data are requested, Service-Indication shall be present in the request. If
notifications on changes of filter criteria are requested, the Server-Name AVP
shall be used as key to the filter criteria. If the request contains a
specific Public Service Identity matching a Wildcarded PSI, the HSS shall
interpret that the subscription refers to the information associated to the
Wildcarded PSI. The Server-Name AVP shall contain the SIP URL of the AS
sending the request. If notifications on changes of DSAI are requested, the
DSAI-Tag AVP shall be used as key of the DSAI whose changes are to be
monitored.
Upon reception of the Sh-Subs-Notif request, the HSS shall, in the following
order (if there is an error in any of the following steps the HSS shall stop
processing and return the corresponding error code, see 3GPP TS 29.329 [5] and
3GPP TS 29.229 [7]), process the hereafter steps that, unless otherwise
stated, apply both for the Subscription request type information element
indicating the request is to subscribe or to unsubscribe:
1\. In the AS permission list (see clause 6.2) the HSS shall check that the AS
is allowed to subscribe to notifications (Sh-Subs-Notif) for the requested
data by checking the combination of the identity of the AS sending the request
(identified by the Origin-Host AVP) and the supplied Data-Reference.
> \- If this AS does not have Sh-Subs-Notif permission for the data
> referenced, Experimental-Result shall be set to
> DIAMETER_ERROR_USER_DATA_CANNOT_BE_NOTIFIED in the Sh-Subs-Notif Response.
2\. The HSS shall check that the User Identity in the request exists in HSS.
If not, Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the
Sh-Subs-Notif Response.
2a. Check if the Private Identity (if received) corresponds to
IMPU/MSISDN/External Identifier received in User-Identity. If not,
Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.
3\. If the type of the User Identity (i.e. IMS Public User Identity or Public
Service Identity or MSISDN or External Identifier) does not apply according to
Table 7.6.1 as access key for the Data-Reference (if Notif-Eff is in use: for
all the Data-References) indicated in the request, Experimental-Result shall
be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Subs-Notif Response.
3a. If Data-Reference is DSAI (19), check whether or not, for the Public
Identity, there is an instance of DSAI matching the DSAI-Tag contained in the
Sh-Subs-Notif command. If not, Experimental-Result shall be set to
DIAMETER_ERROR_DSAI_NOT_AVAILABLE.
4\. If the Sh-Subs-Notif Request contains an Expiry Time, the HSS should also
include in the Sh-Subs-Notif Response an Expiry Time IE with the absolute time
at which the subscription expires in the case of a successful subscription.
This time may be earlier than the requested expiry time. If the HSS includes
this IE, then no notification shall be sent to the AS after the expiration
time. If the HSS receives a Sh-Subs-Notif Request without the Expiry Time IE,
the HSS should treat it as a request for an unlimited subscription.
If the HSS does not include this IE in the response, that indicates an
unlimited subscription.
If a subsequent request is received by the HSS where the Expiry Time IE is
present but different from what the HSS has previously stored, the HSS should
replace the stored expiration time with what was received in the request.
5\. If Data-Reference is RepositoryData(0) and the transparent data associated
with the Service Indication does not exist in the HSS (i.e. Service Data is
not present), then Experimental-Result shall be set to
DIAMETER_ERROR_SUBS_DATA_ABSENT.
6\. If the Subscription request type information element indicates that this
is a request to subscribe, the HSS shall associate the Application Server
Identity with the list of entities that need to be notified when the data
identified by the request is modified and set the Result-Code to
DIAMETER_SUCCESS in the Sh-Subs-Notify response. If the Subscription request
type information element indicates that this is a request to unsubscribe, the
HSS shall remove the association of the Application Server Identity with the
same list. In this last case, the Result-Code shall be set to DIAMETER_SUCCESS
if the operation is successful or if the Application Server Identity was not
present in the list.
7\. If the HSS and AS supports the Notif-Eff feature and if multiple Data-
Reference AVPs occur in the Sh-Subs-Notif Request, each Data-Reference shall
be treated as a request to establish a separate notification request. When
multiple notification requests are requested, and all of them succeed, the HSS
shall set the Result-Code to DIAMETER_SUCCESS in the Sh-Subs-Notify response.
If one of them is unsuccessful, the HSS shall return the Result code with the
relevant Diameter error indication and come back to the situation regarding to
subscriptions as before the reception of the Sh-Subs-Notif Request.
8\. If the HSS and the AS supports the Notif-Eff feature and if multiple
Service-Indication AVPs occur in the Sh-Subs-Notif Request, each Service-
Indication shall be treated as a request to establish a separate notification
request for change of Transparent data. When multiple notification requests
are requested, and all of them are successful, the HSS shall return the
Result-Code set to DIAMETER_SUCCESS in the Sh-Subs-Notify response. If one of
them is unsuccessful, the HSS shall return the Result code with the relevant
Diameter error value and come back to the situation regarding to subscriptions
as before the reception of the Sh-Subs-Notif Request.
8a. If the HSS and the AS supports the Notif-Eff feature and if different
Identity-Set AVPs occur in the Sh-Subs-Notif Request, each Identity-Set shall
be treated as a request to establish a separate notification request. When
multiple notification requests are requested, and all of them are successful,
the HSS shall return the Result-Code set to DIAMETER_SUCCESS in the Sh-Subs-
Notify response. If one of them is unsuccessful, the HSS shall return the
Result code with the relevant Diameter error value and come back to the
situation regarding to subscriptions as before the reception of the Sh-Subs-
Notif Request.
9\. If the Send Data Indication information element is present in the request
and the HSS supports the return of the User-Data in this request, check
whether or not the data that is requested to be downloaded by the AS is
currently being updated by another entity. If there is an update of the data
in progress, the HSS may delay the response until the update has been
completed. The HSS shall ensure that the data returned is not corrupted by
this conflict.
10\. If the Send Data Indication information element is present in the
request, the HSS should include the data pertinent to the requested Data
Reference in the User-Data AVP and if the HSS supports the Notif-Eff feature,
the HSS should include the data pertinent to all the requested Data References
in the User-Data AVP. The HSS shall set the Result-Code to DIAMETER_SUCCESS.
This includes cases where the data is not available to the HSS and an empty
tag is included as follows.
\- Unavailable elements of Sh IMS Data shall be indicated as follows.
\- An unavailable S-CSCF name shall be indicated with empty SCSCFName element.
\- If all iFCs for the user that are relevant for the AS are unavailable it
shall be indicated with empty IFCs element.
\- Similarly for PSI activation information.
If the HSS cannot fulfil the received request for reasons not stated in the
above steps, e.g. due to database error, it shall stop processing the request
and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.
### 6.1.4 Notifications (Sh-Notif)
This procedure is used between the HSS and the AS. The procedure is invoked by
the HSS and is used:
\- To inform the AS of changes in transparent and/or non-transparent data to
which the AS has previously subscribed to receive Notifications for, using Sh-
Subs-Notif (see 6.1.3).
This procedure is mapped to the commands Push-Notification-Request/Answer in
the Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.4.1 and
6.1.4.2 detail the involved information elements.
Table 6.1.4.1: Sh-Notif
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | User-Identity | M | IMS Public User | | | | | Identity or | | (See 7.1) | | | Public Service | | | | | Identity or | | | | | MSISDN or | | | | | External | | | | | Identifier for | | | | | which data has | | | | | changed. | | | | | | | | | | If the request | | | | | refers to a | | | | | Wildcarded PSI, | | | | | the HSS may | | | | | include any PSI | | | | | matching the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. The AS | | | | | shall find the | | | | | corresponding | | | | | Wildcarded PSI | | | | | with this | | | | | information. | | | | | | | | | | See clause 7.1 | | | | | for the content | | | | | of this AVP. | +-------------------+-------------------+------+-------------------+ | Wildcarded PSI | Wildcarde | O | If the request | | (See 7.1A) | d-Public-Identity | | refers to a | | | | | Wildcarded PSI, | | | | | the HSS shall | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it shall | | | | | be used by the AS | | | | | instead of the | | | | | User Identity to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | PSI. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded Public | | | | | User Identity | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarded-IMPU | O | If the request | | User Identity | | | refers to a | | (See 7.1B) | | | Wildcarded Public | | | | | User Identity, | | | | | the HSS shall | | | | | include the | | | | | corresponding | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, it shall | | | | | be used by the AS | | | | | instead of the | | | | | User Identity to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | If that is the | | | | | case, the terms | | | | | User Identity or | | | | | Public User | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | to the Wildcarded | | | | | Public User | | | | | Identity. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present, | | | | | Wildcarded PSI | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Data | User-Data | M | Changed data. | | | | | | | (See 7.6) | | | | +-------------------+-------------------+------+-------------------+ | Private Identity | User-Name | C | Private Identity | | | | | of the user for | | (see 7.6.19) | | | whom the data is | | | | | required. | | | | | | | | | | This information | | | | | element shall be | | | | | present only if | | | | | the associated | | | | | request included | | | | | the Private | | | | | Identity. | +-------------------+-------------------+------+-------------------+
Table 6.1.4.2: Sh-Notif Resp
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | request. | | (See 7.5) | perimental-Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter base | | | | | protocol (see | | | | | IETF | | | | | RFC 6733 [44]). | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Sh errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+
#### 6.1.4.1 Detailed behaviour
The keys to the updated data are part of the information element User-Data
AVP. When data repository is updated Service-Indication and Sequence Number
shall also be part of the information element User-Data.
Since authentication pending is a transient state of normally very short
duration, notification of an IMS user\'s state change, to and from the
authentication pending state shall not be sent to Application Servers, when
the previous state before authentication pending and next state after
authentication pending are the same. If the states are different before the
authentication pending state is entered and after the authentication pending
state is left then notification is sent to the AS of this new state.
If the HSS and AS supports the Notif-Eff feature and if multiple subscriptions
to notifications are associated with a Public User Identity, the HSS may
combine the notifications for multiple Data References and Service Indications
into a single notification message.
If the HSS supports the Update-Eff and Notif-Eff features, the HSS may
generate only one notification message to be sent to the AS(s) supporting the
Notif-eff feature, grouping the data changes notifications according to the
subscribed notifications and the resulting successful achievement of a Sh-
Update procedure with multiple repository data instances, from an AS that
supports the Update-Eff feature. This notification message may also include
other notifications as described with the Notif-Eff feature.
Removal of the subscribed data is indicated with the content of User-Data AVP.
The content shall be compliant with the XML-schema defined in Annex D. Removed
repository data shall be indicated with RepositoryData element that does not
contain ServiceData element. Removed S-CSCF name shall be indicated with empty
SCSCFName element. Removed IP Address Secure Binding Information shall be
indicated with empty IPv4Addres, or IPv6Prefix and/ or IPv6 interface element
respectively. If all iFCs for the user that are relevant for the AS have been
removed it shall be indicated with empty IFCs element.
Removal of Public Identity for which the AS has any active subscription shall
be indicated in the DeletedIdentities element.
If One-Time-Notification AVP was included by the AS in Sh-Subs-Notif, the HSS
shall remove the related subscription information after sending Sh-Notif, i.e.
no subsequent notifications shall be sent to AS.
Notifications shall include the data updated for the received
IMPU/MSISDN/External Identifier and Private Identity (if present).
> NOTE: Data referred to a Private Identity (e.g. IMS Private User Identity)
> implies that only the data (e.g. UE reachability) specific for that Private
> Identity is included, regardless of the type of User Identity received (e.g.
> IMS Public User Identity shared by multiple IMS Private User Identities).
Table 6.1.4.1 details the valid result codes that the AS can return in the
response.
Table 6.1.4.1.1: Sh-Notif response valid result codes
* * *
Result-Code AVP value Condition DIAMETER_SUCCESS The request succeeded.
DIAMETER_ERROR_USER_DATA_NOT_RECOGNIZED The request failed. The AS informs the
HSS that the received user information contained information, which was not
recognized or supported by the AS. DIAMETER_ERROR_USER_UNKNOWN The request
failed because the Public Identity or MSISDN or External Identifier is not
found in the AS. DIAMETER_ERROR_TOO_MUCH_DATA The request failed. The AS
informs the HSS that it tried to push too much data into the AS.
DIAMETER_ERROR_NO_SUBSCRIPTION_TO_DATA The request failed. The AS informs the
HSS that the notification refers to information to which the AS is not
subscribed. DIAMETER_UNABLE_TO_COMPLY The request failed.
* * *
If DIAMETER_ERROR_USER_UNKNOWN is received in the Sh-Notif response, the HSS
shall remove all of the subscription to notification information subscribed by
the AS related to the specific User Identity.
## 6.2 AS permissions list
In table 7.6.1, the contents of the Data-AVP are described. Some of the
individual elements carried within Data-AVP may be requested by the AS from
the HSS using the Sh-Pull command (see clause 6.1.1) or may be updated at the
HSS by the AS using the Sh-Update command (see clause 6.1.2). The AS may also
request that the HSS notifies the AS of changes to specific elements within
the Data-AVP using the Sh-Subs-Notif command (see clause 6.1.3). The HSS will
only allow these operations to take place if the element of the Data-AVP is
permitted to be included in the specific command requested by the AS, as
indicated in table 7.6.1.
To manage whether an AS may request each element of Data-AVP with a specific
command, the HSS shall maintain a list of AS permissions (the \'AS Permissions
List\'). AS permissions are identified by AS identity and Data Reference with
the possible permissions associated with each Data Reference being Sh-Pull,
Sh-Update, Sh-Subs-Notif or any combination of these permissions (see table
7.6.1 for details of which permissions are allowed for each Data Reference).
The permissions apply to all users served by the HSS, they are not user
specific. When an AS requests Sh-Pull, Sh-Update or Sh-Subs-Notif the HSS
shall check permissions and return an error result if the AS does not have the
required permission. If the AS permissions change in a later stage, i.e. the
AS does not longer have the required permission, the HSS shall remove all the
subscription to notifications for the AS for which required permissions have
been prohibited.
## 6.3 Void
## 6.4 Void
## 6.5 User identity to HSS resolution
The User identity to HSS resolution mechanism enables the AS to find the
identity of the HSS that holds the subscriber data for a given IMS Public User
Identity or Public Service Identity when multiple and separately addressable
HSSs have been deployed by the network operator. The resolution mechanism is
not required in networks that utilise a single HSS or when an AS is configured
to use pre-defined HSS.
The resolution mechanism described in 3GPP TS 23.228 [1] shall use a
Subscription Locator Function (SLF) or a Diameter Proxy Agent.
The AS accesses the SLF via the Dh interface. The Dh interface shall always be
used in conjunction with the Sh interface. The Dh interface shall be based on
the Diameter base protocol as specified in IETF RFC 6733 [44]. The SLF
functionality shall use the routing mechanism provided by an enhanced Diameter
redirect agent.
The SLF or the Diameter Proxy Agent shall be to determine the HSS identity.
To get the HSS identity the AS shall send the Sh request normally destined to
the HSS to a pre-configured Diameter address/name.
\- If this Sh Request is received by an SLF (acting as a Diameter redirect
agent), the SLF shall determine the HSS address and shall send to the AS a
notification of redirection towards the HSS identity, in response to the Sh
request. Multiple HSS identities may be included in the response, as specified
in IETF RFC 6733 [44]. In such a case, the AS shall send the Sh Request to the
first HSS identity in the ordered list received in the Sh Response from the
SLF. If the AS does not receive a successful response to the Sh Request, the
AS shall send a Sh Request to the next HSS identity in the ordered list. This
procedure shall be repeated until a successful response from an HSS is
received.
\- If this Sh Request is received by the Diameter Proxy Agent, the Diameter
Proxy Agent shall determine the HSS identity based on the provided user
identity and - if the Diameter load control mechanism is supported (see IETF
RFC 8583 [43]) - optionally also based on previously received load values from
Load AVPs of type HOST. The Diameter Proxy Agent shall then forward the Sh
request directly to the determined HSS. The AS shall determine the HSS
identity from the response to the Sh request received from the HSS.
The AS should store the HSS identity/name/Realm and shall use it in further Sh
requests associated to the same IMS Public Identity.
In networks where the use of the user identity to HSS resolution mechanism is
required and the AS is not configured to use a predefined HSS, each AS shall
be configured with the pre-configured address/name of the SLF or the Diameter
Proxy Agent to enable use of these resolution mechanisms.
# 7 Information element contents
## 7.1 User Identity
This information element contains an IMS Public User Identity, Public Service
Identity, MSISDN or External Identifier according to the conditions described
in table 7.1.1.
Table 7.1.1: User Identity content
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | IMS Public User | Public-Identity | C | IMS Public User | | Identity / Public | | | Identity or | | Service Identity | | | Public Service | | | | | Identity for | | (See 7.1.1) | | | which data is | | | | | required. If the | | | | | MSISDNand | | | | | External | | | | | Identifier are is | | | | | not included in | | | | | the User-Identity | | | | | AVP, the | | | | | Public-Identity | | | | | AVP shall be | | | | | included in Sh | | | | | messages only for | | | | | allowed Data | | | | | References as | | | | | described in | | | | | Table 7.6.1. | +-------------------+-------------------+------+-------------------+ | MSISDN | MSISDN | C | MSISDN for which | | | | | data is required. | | (See 7.1.2) | | | If the | | | | | Public-Identity | | | | | AVP and External | | | | | Identifier are | | | | | not included in | | | | | the User-Identity | | | | | AVP, the MSISDN | | | | | AVP shall be | | | | | included in the | | | | | Sh-Pull or | | | | | Sh-Subs-Notif or | | | | | Sh-Update | | | | | messages only for | | | | | allowed Data | | | | | References as | | | | | described in | | | | | Table 7.6.1. | +-------------------+-------------------+------+-------------------+ | External | Ex | C | External | | Identifier | ternal-Identifier | | Identifier for | | | | | which data is | | (See 7.1.3) | | | required. If the | | | | | Public-Identity | | | | | AVP and MSISDN | | | | | are not included | | | | | in the | | | | | User-Identity | | | | | AVP, the External | | | | | Identifier AVP | | | | | shall be included | | | | | in the Sh-Pull or | | | | | Sh-Subs-Notif or | | | | | Sh-Update | | | | | messages only for | | | | | allowed Data | | | | | References as | | | | | described in | | | | | Table 7.6.1. | +-------------------+-------------------+------+-------------------+
### 7.1.1 IMS Public User Identity / Public Service Identity
This information element contains an IMS Public User Identity / Public Service
Identity (either SIP URI or tel URI). See 3GPP 23.003 [11].
### 7.1.2 MSISDN
This information element contains the MSISDN, or the Basic MSISDN if
multinumbering is used (see 3GPP TS 23.012 [19]).
### 7.1.3 External Identifier
This information element contains the External Identifier (see 3GPP TS 23.003
[11]).
## 7.1A Wildcarded PSI
This information element contains a Wildcarded PSI that is hosted by an
application server. For definition of a Wildcarded PSI, see 3GPP TS 23.003
[11].
## 7.1B Wildcarded Public User Identity
This information element contains a Wildcarded Public User Identity that is
stored in the HSS. For definition of a Wildcarded Public User Identity, see
3GPP TS 23.003 [11].
## 7.2 Requested Domain
This information element details the access domains for which certain data
(e.g. user state, location information) are requested. See 3GPP TS 29.329 [5]
for the list of possible values.
## 7.2A Requested Nodes
This information element details the access node types for which certain data
(e.g. user state, location information) are requested. See 3GPP TS 29.329 [5]
for the list of possible values.
## 7.2B Serving Node Indication
This information element indicates that the sender does not require any
location information other than the serving node address/identity (i.e. MME
name and/or SGSN number, or VLR number) for the requested domain and the
requested nodes (if included). Other location information (e.g. Global Cell
ID, Tracking Area ID) may be absent.
This information element is only applicable to Location Information.
## 7.3 Requested Data
\- Reference to the data that an AS is requesting from the HSS.
\- Reference to the data which, an AS wants to be notified of, when changed.
\- Reference to data for which subscription to notification of change is
rejected.
\- Reference to data for which updates are required.
\- Reference to data for which update fails.
See clause 7.6.
## 7.4 Service Indication
Identifier of one set of service related transparent data, which is stored in
an HSS in an operator network per Public Identity. The HSS shall allocate
memory space to implement a data repository to store transparent data per IMS
Public User Identity or Public Service Identity and value of Service
Indication with a Sequence Number for verification. For Public Service
Identities matching a Wildcarded Public Service Identity, the repository data
shall be stored per Wildcarded Public Service Identity and not for each
specific Public Service Identity.
## 7.5 Result
This information element contains the result code of the operation. See 3GPP
TS 29.329 [5] for the list of possible values.
## 7.6 Data
This information element contains an XML document conformant to the XML schema
defined in Annex D.
Annex C specifies the UML logical model of the data downloaded via the Sh
interface.
Table 7.6.1 defines the data reference values and tags, access key and
recommended AS permissions (as described in clause 6.2) for the operation(s)
on data accessible via the Sh interface, i.e. the listed operation(s) in the
Operations column are the only ones allowed to be used with this Data Ref
value. It is a matter of operator policy to further restrict the AS permission
rights defined in table 7.6.1.
An access key between square brackets is considered as optional, while when
more than one access key is separated by logical OR and included between
brackets, it means that one (and only one) of these access keys is mandatory.
Table 7.6.1: Data accessible via Sh interface
+-------------+-------------+------------+-------------+-------------+ | Data Ref. | XML tag | Defined in | Access key | Operations | +-------------+-------------+------------+-------------+-------------+ | 0 | Rep | 7.6.1 | Data | Sh-Pull | | | ositoryData | | Reference | | | | | | | Sh-Update | | | | | + ( IMS | | | | | | Public User | Sh | | | | | Identity OR | -Subs-Notif | | | | | Public | | | | | | Service | (Note 1, | | | | | Identity ) | Note 3) | | | | | | | | | | | + Service | | | | | | Indication | | +-------------+-------------+------------+-------------+-------------+ | 10 | IMSPub | 7.6.2 | Data | Sh-Pull | | | licIdentity | | Reference | | | | | | | Sh | | | | | + ( IMS | -Subs-Notif | | | | | Public User | | | | | | Identiy OR | | | | | | Public | | | | | | Service | | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Requested | | | | | | Identity | | | | | | Set ] | | +-------------+-------------+------------+-------------+-------------+ | 11 | I | 7.6.3 | Data | Sh-Pull | | | MSUserState | | Reference | | | | | | | Sh | | | | | + IMS | -Subs-Notif | | | | | Public User | | | | | | Identity | | +-------------+-------------+------------+-------------+-------------+ | 12 | S-CSCFName | 7.6.4 | Data | Sh-Pull | | | | | Reference | | | | | | | Sh | | | | | + ( IMS | -Subs-Notif | | | | | Public User | | | | | | Identity OR | (Note 1) | | | | | Public | | | | | | Service | | | | | | Identity ) | | +-------------+-------------+------------+-------------+-------------+ | 13 | InitialFil | 7.6.5 | Data | Sh-Pull | | | terCriteria | | Reference | | | | | | | Sh | | | | | + ( IMS | -Subs-Notif | | | | | Public User | | | | | | Identity OR | (Note 1) | | | | | Public | | | | | | Service | | | | | | Identity ) | | | | | | | | | | | | + | | | | | | Application | | | | | | Server Name | | +-------------+-------------+------------+-------------+-------------+ | 14 | Location | 7.6.6 | Data | Sh-Pull | | | Information | | Reference | | | | | | | (Note 5) | | | | | + ( IMS | | | | | | Public User | (Note 6) | | | | | Identity OR | | | | | | MSISDN OR | (Note 7) | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | | | | | | | | | | | + | | | | | | Requested | | | | | | Domain | | | | | | | | | | | | + Current | | | | | | Location | | | | | | | | | | | | + [ | | | | | | Serving | | | | | | Node | | | | | | Indication | | | | | | ] | | | | | | | | | | | | + [ | | | | | | Requested | | | | | | Nodes ] | | | | | | | | | | | | + [ Local | | | | | | Time Zone | | | | | | Indication | | | | | | ] | | | | | | | | | | | | + [ | | | | | | RAT-Type | | | | | | Requested | | | | | | ] | | +-------------+-------------+------------+-------------+-------------+ | 15 | UserState | 7.6.7 | Data | Sh-Pull | | | | | Reference | | | | | | | (Note 5) | | | | | + ( IMS | | | | | | Public User | (Note 7) | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | | | | | | | | | | | + | | | | | | Requested | | | | | | Domain | | | | | | | | | | | | + [ | | | | | | Requested | | | | | | Nodes ] | | +-------------+-------------+------------+-------------+-------------+ | 16 | Charging | 7.6.8 | Data | Sh-Pull | | | information | | Reference | | | | | | | Sh | | | | | + ( IMS | -Subs-Notif | | | | | Public User | | | | | | Identity OR | | | | | | Public | | | | | | Service | | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | +-------------+-------------+------------+-------------+-------------+ | 17 | MSISDN or | 7.6.9 | Data | Sh-Pull | | | MSISDN | | Reference | | | | +Ext | | | (Note 4) | | | endedMSISDN | | + ( IMS | | | | | | Public User | | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 18 | PS | 7.6.10 | Data | Sh-Pull | | | IActivation | | Reference | | | | | | | Sh-Update | | | | | + IMS | | | | | | Public | Sh | | | | | Service | -Subs-Notif | | | | | Identity | | | | | | | (Note 1) | +-------------+-------------+------------+-------------+-------------+ | 19 | DSAI | 7.6.11 | Data | Sh-Pull | | | | | Reference | | | | | | | Sh-Update | | | | | + ( IMS | | | | | | Public User | Sh | | | | | Identity OR | -Subs-Notif | | | | | Public | | | | | | Service | (Note 1) | | | | | Identity ) | | | | | | | | | | | | + DSAI Tag | | | | | | | | | | | | + | | | | | | Application | | | | | | Server Name | | +-------------+-------------+------------+-------------+-------------+ | 20 | Reserved | | | | +-------------+-------------+------------+-------------+-------------+ | 21 | ServiceLev | 7.6.13 | Data | Sh-Pull | | | elTraceInfo | | Reference | | | | | | | Sh | | | | | + ( IMS | -Subs-Notif | | | | | Public User | | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | +-------------+-------------+------------+-------------+-------------+ | 22 | IP Address | 7.6.14 | Data | Sh-Pull | | | Secure | | Reference | | | | Binding | | | Sh | | | Information | | + IMS | -Subs-Notif | | | | | Public User | | | | | | Identity | | +-------------+-------------+------------+-------------+-------------+ | 23 | Service | 7.6.15 | Data | Sh-Pull | | | Priority | | Reference | | | | Level | | | Sh | | | | | + IMS | -Subs-Notif | | | | | Public User | | | | | | Identity | | +-------------+-------------+------------+-------------+-------------+ | 24 | SMSRegis | 7.6.16 | Data | Sh-Pull | | | trationInfo | | Reference | | | | | | | Sh-Update | | | | | + ( IMS | | | | | | Public User | (Note 5) | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 25 | UE | 7.6.17 | Data | Sh | | | r | | Reference | -Subs-Notif | | | eachability | | | | | | for IP | | + ( IMS | (Note 5) | | | | | Public User | | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 26 | T-ADS | 7.6.18 | Data | Sh-Pull | | | Information | | Reference | | | | | | | (Note 5) | | | | | + ( IMS | | | | | | Public User | | | | | | Identity OR | | | | | | MSISDN ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 27 | STN-SR | 7.6.20 | Data | Sh-Pull | | | | | Reference | | | | | | | Sh-Update\ | | | | | + ( IMS | (Note 5) | | | | | Public User | | | | | | Identity OR | | | | | | MSISDN ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 28 | UE-SRVCC | 7.6.21 | Data | Sh-Pull | | | -Capability | | Reference | | | | | | | Sh- | | | | | + ( IMS | Subs-Notif\ | | | | | Public User | (Note 5) | | | | | Identity OR | | | | | | MSISDN ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 29 | Exten | 7.6.15A | Data | Sh-Pull\ | | | dedPriority | | Reference | Sh | | | | | | -Subs-Notif | | | | | + IMS | | | | | | Public User | | | | | | Identity | | +-------------+-------------+------------+-------------+-------------+ | 30 | CSRN | 7.6.22 | Data | Sh-Pull | | | | | Reference | | | | | | | (Note 5) | | | | | + ( IMS | | | | | | Public User | | | | | | Identity OR | | | | | | MSISDN ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 31 | Reference | 7.6.23 | Data | Sh-Pull | | | Location | | Reference | | | | Information | | | (Note 5) | | | | | + IMS | | | | | | Public User | | | | | | Identity | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 32 | IMSI | 7.6.24 | Data | Sh-Pull | | | | | Reference | | | | | | | (Note 5) | | | | | + ( IMS | | | | | | Public User | (Note 8) | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 33 | IMSPrivateU | 7.6.25 | Data | Sh-Pull | | | serIdentity | | Reference | | | | | | | Sh | | | | | + IMS | -Subs-Notif | | | | | Public User | | | | | | Identity | (Note 8) | +-------------+-------------+------------+-------------+-------------+ | 34 | IMEISV | 7.6.26 | Data | Sh-Pull | | | | | Reference | | | | | | | (Note 5) | | | | | + ( IMS | | | | | | Public User | | | | | | Identity OR | | | | | | MSISDN OR | | | | | | External | | | | | | Identifier | | | | | | ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | 35 | UE-5G-SRVCC | 7.6.21A | Data | Sh-Pull | | | -Capability | | Reference | | | | | | | Sh- | | | | | + ( IMS | Subs-Notif\ | | | | | Public User | (Note 5) | | | | | Identity OR | | | | | | MSISDN ) | | | | | | | | | | | | + [ | | | | | | Private | | | | | | Identity ] | | +-------------+-------------+------------+-------------+-------------+ | Note 1: If | | | | | | an AS | | | | | | subscribes | | | | | | to a | | | | | | Specific | | | | | | PSI | | | | | | matching a | | | | | | Wildcarded | | | | | | PSI, the | | | | | | n | | | | | | otification | | | | | | shall be | | | | | | sent as if | | | | | | the | | | | | | s | | | | | | ubscription | | | | | | was made to | | | | | | the | | | | | | co | | | | | | rresponding | | | | | | Wildcarded | | | | | | PSI. | | | | | | | | | | | | If an AS | | | | | | requires | | | | | | reading for | | | | | | a Specific | | | | | | PSI | | | | | | matching a | | | | | | Wildcarded | | | | | | PSI, the | | | | | | response | | | | | | shall be | | | | | | sent as if | | | | | | the request | | | | | | was made to | | | | | | the | | | | | | co | | | | | | rresponding | | | | | | Wildcarded | | | | | | PSI. | | | | | | | | | | | | Note 2: If | | | | | | not | | | | | | specified | | | | | | otherwise | | | | | | Public User | | | | | | Identity | | | | | | and Public | | | | | | Service | | | | | | Identity | | | | | | refer also | | | | | | to the | | | | | | wildcarded | | | | | | identities. | | | | | | | | | | | | Note 3: Any | | | | | | IMS Public | | | | | | User | | | | | | Identity in | | | | | | an Alias | | | | | | Public User | | | | | | Identity | | | | | | Set may be | | | | | | used as a | | | | | | key for the | | | | | | repository | | | | | | data of the | | | | | | group. All | | | | | | IMS Public | | | | | | User | | | | | | Identities | | | | | | within the | | | | | | same set | | | | | | shall be | | | | | | considered | | | | | | alias of | | | | | | each other | | | | | | and shall | | | | | | share the | | | | | | same | | | | | | transparent | | | | | | data. See | | | | | | 3GPP TS | | | | | | 23.008 | | | | | | [27] for | | | | | | the | | | | | | definition | | | | | | of an Alias | | | | | | Public User | | | | | | Identity | | | | | | Set. | | | | | | | | | | | | Note 4: If | | | | | | several | | | | | | MSISDNs are | | | | | | associated | | | | | | to the | | | | | | Public | | | | | | identity, | | | | | | an AS shall | | | | | | be required | | | | | | to indicate | | | | | | the IMS | | | | | | Private | | | | | | User | | | | | | Identity to | | | | | | fetch the | | | | | | C-MSISDN. | | | | | | See 3GPP TS | | | | | | 23.003 | | | | | | [11] and | | | | | | 3GPP TS | | | | | | 23.237 | | | | | | [32] for | | | | | | the | | | | | | definition | | | | | | of | | | | | | C-MSISDN. | | | | | | Ext | | | | | | endedMSISDN | | | | | | is returned | | | | | | in addition | | | | | | to MSISDN | | | | | | when | | | | | | Additi | | | | | | onal-MSISDN | | | | | | feature is | | | | | | enabled | | | | | | | | | | | | Note 5: If | | | | | | a Sh | | | | | | procedure | | | | | | refers to a | | | | | | specific | | | | | | Private | | | | | | Identity | | | | | | within a | | | | | | set of | | | | | | multiple | | | | | | Private | | | | | | identities | | | | | | associated | | | | | | to an IMS | | | | | | Public User | | | | | | Identity or | | | | | | MSISDN, the | | | | | | co | | | | | | rresponding | | | | | | Sh request | | | | | | shall | | | | | | include | | | | | | this | | | | | | Private | | | | | | Identity as | | | | | | part of the | | | | | | access key. | | | | | | | | | | | | Note 6: | | | | | | Serving | | | | | | Node | | | | | | Indication | | | | | | is | | | | | | optionally | | | | | | included | | | | | | only if | | | | | | Current | | | | | | Location | | | | | | takes the | | | | | | value | | | | | | DoNotNe | | | | | | edInitiateA | | | | | | ctiveLocati | | | | | | onRetrieval | | | | | | | | | | | | Note 7: | | | | | | Requested | | | | | | Nodes is | | | | | | only | | | | | | applicable | | | | | | when | | | | | | Requested | | | | | | Domain is | | | | | | PS | | | | | | | | | | | | Note 8: | | | | | | IMSI and | | | | | | IMS Private | | | | | | User | | | | | | Identity | | | | | | may be | | | | | | considered | | | | | | sensitive | | | | | | data, which | | | | | | not all ASs | | | | | | may be | | | | | | permitted | | | | | | to | | | | | | retrieve. | | | | | | See clause | | | | | | 6.2. | | | | | | | | | | | | Note 9: If | | | | | | Data | | | | | | Reference | | | | | | and | | | | | | External | | | | | | Identifier | | | | | | are used as | | | | | | access key, | | | | | | Private | | | | | | Identity is | | | | | | not | | | | | | applicable | | | | | | as | | | | | | additional | | | | | | access key. | | | | | +-------------+-------------+------------+-------------+-------------+
### 7.6.1 Repository Data
This information element contains transparent data. A data repository may be
shared by more than one AS implementing the same service.
### 7.6.2 IMSPublicIdentity
This data contents included in the Sh-Pull Resp, Sh-Subs-Notif Resp or Sh-
Notif depends on whether Requested Identity Set information element was
included in the Sh-Pull or Sh-Subs-Notif, as follows:
\- When this information element takes the value IMPLICIT_IDENTITIES, the HSS
shall provide all non-barred IMS Public Identities that belong to the same
implicit registration set as the IMS Public Identity included in the message
in the User-Identity AVP. The MSISDN and External Identifier within the User-
Identity AVP are not applicable for this value. If the User Identity is a
Public Service Identity, the HSS shall return only the User Identity received
in the request.
\- When this information element takes the value ALIAS_IDENTITIES, the HSS
shall provide all non-barred IMS Public User Identities that are in the same
Alias Public User Identity Set as the IMS Public User Identity included in the
message in the User-Identity AVP (see 3GPP TS 23.008 [27] for the definition
of Alias Public User Identity Set). The MSISDN, the Public Service Identity
and the External Identifier within the User-Identity AVP are not applicable
for this value.
\- When this information element takes the value REGISTERED_IDENTITIES, the
HSS shall provide all non-barred IMS Public Identities whose state is
registered, belonging to all Private Identities that the IMS Public Identity
or MSISDN or External Identifier in the User-Identity AVP is associated with.
If the User Identity is a Public Service Identity, the HSS shall return no
identities in the response.
\- When this information element takes the value ALL_IDENTITIES, the HSS shall
provide all non-barred IMS Public Identities, belonging to all Private
Identities that the User Identity is associated with.
\- When this information element is not included, the HSS shall download the
set of IMS Public Identities that would be downloaded if the value of this
information element had been ALL_IDENTITIES.
An IMS Public Identity would be either:
\- associated with the same Private User Identity or Private Service Identity
as the User Identity included in the request or
\- associated with the MSISDN present in the request or
\- associated with an External Identifier present in the request.
Multiple instances of this information element may be included in the message.
### 7.6.3 IMS User State
This information element contains the IMS User State of the public identifier
referenced. Its possible values are:
\- REGISTERED,
\- NOT_REGISTERED,
\- AUTHENTICATION_PENDING,
\- REGISTERED_UNREG_SERVICES.
If the IMS Public User Identity is shared between multiple Private User
Identities, HSS shall indicate the most registered state of the shared IMS
Public User Identity to an AS. The most registered state of a shared IMS
Public User Identity is defined as follows:
\- If the shared IMS Public User Identity is registered with any of the
Private User Identities, the most registered state of the shared IMS Public
User Identity is REGISTERED.
\- If the shared IMS Public User Identity is not currently registered with any
of the Private User Identities, but it is in state REGISTERED_UNREG_SERVICES,
then the most registered state of the shared IMS Public User Identity is
REGISTERED_UNREG_SERVICES.
\- If the shared IMS Public User Identity is not currently registered with any
of the Private User Identities, and it is not in state
REGISTERED_UNREG_SERVICES, but it is in the process of being authenticated
with any of the Private User Identities, then the most registered state of the
shared IMS Public User Identity is AUTHENTICATION_PENDING.
\- If the shared IMS Public User Identity is not currently registered with any
of the Private User Identities, and it is not in state
REGISTERED_UNREG_SERVICES, and it is not in the process of being authenticated
with any of the Private User Identities, then the most registered state of the
shared IMS Public User Identity is NOT_REGISTERED.
### 7.6.4 S-CSCF Name
This information element contains the name of the S‑CSCF assigned to the IMS
Subscription.
### 7.6.5 Initial Filter Criteria
This information element contains the triggering information for a service.
For a more detailed description, refer to 3GPP TS 23.218 [4] and 3GPP TS
29.228 [6].
### 7.6.6 Location Information
This information element contains either:
\- the location of the served subscriber in the MSC/VLR if the requested
domain is CS, or
\- the location of the served subscriber in the SGSN if the requested domain
is PS and either the requested node is solely SGSN or the requested node is
not present, or
\- the location of the served subscriber in the MME if the requested domain is
PS and the requested nodes is solely MME, or
\- the locations of the served subscriber in the 3GPP AAA Server for TWAN if
the requested domain is PS and the requested nodes is solely 3GPP AAA SERVER
for TWAN, or
\- the location of the served subscriber in the AMF (for 3GPP access) if the
requested domain is PS and the requested nodes is solely AMF.
\- the locations of the served subscriber in the MME and the SGSN and 3GPP AAA
Server for TWAN and AMF if the requested domain is PS and the requested nodes
are all of MME and SGSN and 3GPP AAA SERVER for TWAN and AMF, or
\- the locations of the served subscriber in any of the two or three serving
nodes among the MME, the SGSN, the 3GPP AAA Server for TWAN and the AMF if the
requested domain is PS and the requested nodes indicates the corresponding
nodes for which the location are to be requested.
If the HSS has to communicate with the MSC/VLR or SGSN and/or MME and/or 3GPP
AAA Server and/or AMF (via UDM) to retrieve location information, it shall
make use of the service MAP-PROVIDE-SUBSCRIBER-INFO or S6a/S6d-IDR or SWx-PPR
or make use (via UDM) of the Namf Service-Based Interface services. This
information element shall contain the location information as received from
the access nodes.
If the HSS or HSS/UDM cannot communicate with the VLR or SGSN or MME or AMF
(e.g., because the UE is purged), or if the HSS or HSS/UDM cannot retrieve the
location information from the serving nodes because they do not support such
feature, the HSS shall provide locally stored location information if
available (e.g., serving node name, Visited PLMN ID) received in a previous
Update Location message, and the last known UE\'s location if available e.g.
as received in the Purge message from VLR or SGSN or MME or AMF.
If the Serving Node Indication was present in the request, the location
information shall contain the serving node address(es) as stored in the HSS,
according to the requested domain and the requested nodes (if received). Other
location information may be absent, in order to eliminate unnecessary
communication with the MSC/VLR or SGSN and/or MME and/or 3GPP AAA Server
and/or AMF when the AS does not require these information elements.
For both Location Information for CS and Location Information for GPRS, the
considerations described in 3GPP TS 23.078 [14] apply.
#### 7.6.6.1 Location information for CS
This information element consists of the following subordinate information
elements:
\- Location number: defined in ITU-T Recommendation Q.763 [9]. Considerations
described in 3GPP TS 23.018 apply [10].
\- Service area ID: defined in 3GPP TS 23.003 [11].
\- Cell Global ID: defined in 3GPP TS 23.003 [11].
\- Location area ID: defined in 3GPP TS 23.003 [11].
\- Geographical Information: defined in 3GPP TS 23.032 [12]. Considerations
described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- Geodetic Information: defined in ITU-T Recommendation Q.763 [9].
Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- VLR Number: defined in 3GPP TS 23.003 [11].
\- MSC Number: defined in 3GPP TS 23.003 [11].
\- Age of location information: defined in 3GPP TS 23.018 [10].
\- Current Location Retrieved: shall be present when location information was
obtained after a successful paging procedure for Active Location Retrieval if
the MS is in idle state or when the location was provided if the MS is in
active state.
\- User CSG information: defined in 3GPP TS 23.060 [29].
\- E-UTRAN Cell Global ID: defined in 3GPP TS 23.003 [11].
\- Tracking Area ID: defined in 3GPP TS 23.003 [11].
\- Local Time Zone: the Local Time Zone information (Time Zone and Daylight
Saving Time) of the location in the visited network where the UE is attached,
as defined in 3GPP TS 29.272 [26].
NOTE: When the MSC receives the location information via SGs interface as
specified in 3GPP TS 29.118 [30], the E-UTRAN Cell Global ID and Tracking Area
ID are included, rather than Location number, Service area ID, Cell Global ID
and Location area ID.
#### 7.6.6.2 Location information for GPRS
This information element consists of the following subordinate information
elements:
\- Service area ID: defined in 3GPP TS 23.003 [11].
\- Cell Global ID: defined in 3GPP TS 23.003 [11].
\- Location area ID: defined in 3GPP TS 23.003 [11].
\- Geographical Information: defined in 3GPP TS 23.032 [12]. Considerations
described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- Geodetic Information: defined in ITU-T Recommendation Q.763 [9].
Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- SGSN Number: defined in 3GPP TS 23.003 [11].
\- Routing Area ID: defined in 3GPP TS 23.003 [11].
\- Current Location Retrieved: shall be present when location information was
obtained after a successful paging procedure for Active Location Retrieval if
the UE is in idle mode or when the location was provided if the UE is in
connected mode.
\- Age of location information: defined in 3GPP TS 23.018 [10].
\- User CSG information: defined in 3GPP TS 23.060 [29].
\- Visited PLMN ID: defined in 3GPP TS 23.003 [11].
\- Local Time Zone: the Local Time Zone information (Time Zone and Daylight
Saving Time) of the location in the visited network where the UE is attached,
as defined in 3GPP TS 29.272 [26].
\- RAT type: the possible values of RAT type are specified in 3GPP TS 29.212
[28], clause 5.3.31.
#### 7.6.6.3 Location information for EPS
This information element consists of the following subordinate information
elements:
\- E-UTRAN Cell Global ID: defined in 3GPP TS 23.003 [11].
\- Geographical Information: defined in 3GPP TS 23.032 [12]. Considerations
described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- Geodetic Information: defined in ITU-T Recommendation Q.763 [9].
Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- MME Name: Diameter Identity of the MME as received by the HSS within the
S6a ULR Origin-Host AVP; see 3GPP TS 29.272 [31].
\- Tracking Area ID: defined in 3GPP TS 23.003 [11].
\- Current Location Retrieved: shall be present when location information was
obtained after a successful paging procedure for Active Location Retrieval if
the UE is in idle mode or when the location was provided if the UE is in
connected mode.
\- Age of location information: defined in 3GPP TS 23.018 [10].
\- Visited PLMN ID: defined in 3GPP TS 23.003 [11].
\- User CSG information: defined in 3GPP TS 23.060 [29].
\- Local Time Zone: the Local Time Zone information (Time Zone and Daylight
Saving Time) of the location in the visited network where the UE is attached,
as defined in 3GPP TS 29.272 [26]. .
\- RAT type: the possible values of RAT type are specified in 3GPP TS 29.212
[28], clause 5.3.31.
#### 7.6.6.4 Location Information for TWAN
This information element consists of the following subordinate information
elements:
\- TWAN SSID: defined in 3GPP TS 29.273 [34].
\- TWAN BSSID: defined in 3GPP TS 29.273 [34].
\- TWAN PLMN ID: defined in clause 12.1 of 3GPP TS 23.003 [11] for PLMN
Identifer.
\- Civic Address: defined in clause 3.1 of IETF RFC 4776 [35] excluding the
first 3 octets.
\- TWAN Operator Name: defined in clause 19.8 of 3GPP TS 23.003 [11].
\- Local Time Zone: the Local Time Zone information (Time Zone and Daylight
Saving Time) of the location in the visited network where the UE is attached,
as defined in 3GPP TS 29.272 [26].
\- Logical Access ID defined in ETSI ES 283 034 [37].
NOTE: The location information defined for EPS in clause 7.6.6.3 is not
relevant to the TWAN location information.
#### 7.6.6.5 Location Information for 5GS
This information element consists of the following subordinate information
elements:
\- NR Cell Global ID: defined in 3GPP TS 23.003 [11].
\- E-UTRAN Cell Global ID: defined in 3GPP TS 23.003 [11].
\- Geographical Information: defined in 3GPP TS 23.032 [12]. Considerations
described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.
\- AMF Address: Identity of the serving AMF (for 3GPP access).
\- SMSF Address: Identity of the serving SMSF (for 3GPP access).
\- Tracking Area ID: defined in 3GPP TS 23.003 [11].
\- Current Location Retrieved: shall be present when location information was
obtained after a successful paging procedure for Active Location Retrieval if
the UE is in idle mode or when the location was provided if the UE is in
connected mode.
\- Age of location information: defined in 3GPP TS 23.018 [10].
\- Visited PLMN ID: defined in 3GPP TS 23.003 [11].
\- Local Time Zone: Time zone information (Time Zone and Daylight Saving Time)
of the location in the visited network where the UE is attached, as defined in
3GPP TS 29.272 [26].
\- RAT type: the possible values of RAT type are specified in 3GPP TS 29.212
[28], clause 5.3.31.
### 7.6.7 User state
This information element indicates the state of the User Identity in the
domain/node indicated by the Requested-Domain/Requested-Node (see 7.2), with
the values specified in 3GPP TS 23.078 [14] for Subscriber State and PS Domain
Subscriber State, and with the values specified in 3GPP TS 29.272 [31] for EPS
User State and 3GPP TS 29.518 [47] for the 5GS User State.
\- The HSS shall make use of the operation MAP-PROVIDE-SUBSCRIBER-INFO towards
the MSC/VLR to obtain this information if the requested domain is CS.
\- The HSS shall make use of the operation S6a-IDR towards the MME to obtain
this information if the requested domain is PS and the requested node is MME.
\- The HSS shall make use of the operation MAP-PROVIDE-SUBSCRIBER-INFO or
S6d-IDR towards the SGSN to obtain this information if the requested domain is
PS and either the requested node is SGSN or the requested node is not present.
\- The HSS shall make use of the operation S6a-IDR towards the MME and MAP-
PROVIDE-SUBSCRIBER-INFO or S6d-IDR towards the SGSN to obtain this information
if the requested domain is PS and the Requested Nodes is MME and SGSN.
\- The UDM+HSS shall make use of the Namf_EventExposure Subscribe Service
Operation towards the AMF to obtain this information if the requested domain
is PS and the requested node is AMF.
This information element shall contain the information as received from the
access nodes.The UDM+HSS may retrieve the User States from the MME, SGSN or
AMF within one procedure.
The UDM+HSS shall include the value \"NotProvidedFromSGSN or MME or AMF\" in
the \"EPSUserState\" / \"PSUserState\" / \" Sh-5GSUserState\" fields, if the
MME, SGSN or AMF does not support the retrieval of User State over
S6a/S6d-IDR/ Namf_EventExposure Service, or it did not provide any information
on subscriber state even though it was requested by UDM+HSS.
### 7.6.8 Charging information
This information element contains the addresses of the charging functions:
primary Online Charging Function (PrimaryEventChargingFunctionName), secondary
Online Charging Function (SecondaryEventChargingFunctionName), primary
Charging Data Function (PrimaryChargingCollectionFunctionName), and secondary
Charging Data Function (SecondaryChargingCollectionFunctionName). When a
**clash occurs between the charging function address(es) received over the ISC
interface and those received over the Sh interface, the address(es) received
over the ISC interface should take precedence.**
NOTE: The use of the Sh interface to retrieve charging function addresses is
not intended as a general-purpose alternative to receiving charging function
addresses from the ISC interfaces. Rather, it is meant to address a special
case where the AS needs to interact with the charging system before initiating
a request to a user when the AS has not received the third party REGISTER for
that user.
The AS shall extract the FQDN of the DiameterURI in these information elements
and may use it as content of the Destination-Host AVP for the Diameter
accounting requests. The parent domain of the FQDN in the DiameterURI shall be
used as Destination-Realm. The number of labels used for the Destination-Realm
shall be determined before the Charging Information is provisioned and may be
a configuration option.
NOTE: A FQDN is an absolute domain name including a subdomain and its parent
domain. The subdomain and the parent domain contain one or more labels
separated by dots.
### 7.6.9 MSISDN
This information element contains the MSISDN, or the Basic MSISDN if
multinumbering is used, that is associated with the User Identity present in
the request. See 3GPP TS 23.012 [19] for Basic MSISDN definition.
Multiple instances of this information element shall only occur if the Public
User Identity is shared and no Private Identity was included in the request,
otherwise only one instance shall be included in the message.
If Additional-MSISDN feature is supported by the HSS but the AS has indicated
that it does not support it, it is up to operator policy to decide what
information is returned by the HSS, either what is provisioned in MSISDN or in
Additional MSISDN (A-MSISDN).
### 7.6.9A Extended MSISDN
This information element is returned in addition to MSISDN if Additional-
MSISDN feature is supported by the HSS, the AS has indicated as well its
support and an Additional MSISDN (A-MSISDN) is provisioned..
It contains the Additional-MSISDN that is associated with the User Identity
present in the request.
All valid instances of this information element shall be included in the
message.
### 7.6.10 PSIActivation
This information element contains the activation state of the Public Service
Identity present in the request. Its possible values are:
\- ACTIVE,
\- INACTIVE.
### 7.6.11 DSAI
When a service is provisioned but not active, an Application Server is
typically involved through the ISC interface in sessions where the Application
Server is not supposed to perform any task but to proxy incoming transactions.
In order to avoid this disoptimization, a mechanism is provided for the
Application Server to signal the HSS that a set of initial filter criteria
should be \"masked\" for a specific Public User Identity or Public Service
Identity. This is, from the Application Server\'s perspective, just an
indication, and an Application Server must be prepared to be involved in
sessions even if the trigger that caused its involvement has been masked by
that Application Server.
This information element contains the activation state of a Service
(identified by its DSAI-tag, see clause 7.14, for a specific user identified
by a Public User Identity or of a Service identified by its PSI). Its possible
values are:
\- ACTIVE,
\- INACTIVE.
In the HSS the DSAI can also be associated to a wildcarded PSI. In that case,
there is a set of identities matching a specific wildcarded PSI and all the
identities in the set share the same DSAIs. Any change in these DSAIs masked
from a single identity of the set will apply to all the identities associated
to that wildcarded PSI.
Each DSAI is implicitly bound to a list of (at least one) initial filter
criteria. The binding is not exclusive, i.e. one instance of initial filter
criteria may be bound to zero or more DSAIs, however all the iFCs bound to a
given DSAI should trigger to the same AS (i.e. they should share the same
ServerName), which is the only one allowed to update it.
An instance of initial filter criteria shall be included into the Service-
Profile sent through the Cx Interface according to the operations described in
3GPP TS 29.228 [6] if at least one of the following conditions applies:
\- No DSAI is bound to those initial filter criteria;
\- At least one of the DSAIs bound to those initial filter criteria is set to
ACTIVE.
### 7.6.12 Void
### 7.6.13 Service Level Trace Information
This information element contains the Service Level Tracing Information (see
3GPP TS 24.323 [45]) that is related to a specific Public Identifier. If the
ServiceLevelTraceInfo is present, service level tracing shall be enabled in
the Application Server for the related Public Identifier according to the
configuration data received. If the ServiceLevelTraceInfo is not present,
service level tracing is disabled in the Application Server for the related
Public Identifier.
### 7.6.14 IP address secure binding information
This information element contains the IP address (or the prefix in the case of
IPv6 stateless autoconfiguration) at any given time.See 3GPP TS 33.203 [22],
Annex T.
### 7.6.15 Service Priority Level
This information element contains the Priority Level allowed for the Public
Identity for Priority Service. If the ServicePriority Level is present,
priority services are allowed for the Public Identity. See IETF RFC 4412 [25].
### 7.6.15A Extended Priority
This information element contains the following information elements:
\- The PriorityNamespace information element provides the namespace as
specified in IETF RFC 4412 [25] and to which the Extended Priority refers.
\- The PriorityLevel information element provides the Priority Level allowed
for the Public User Identity for a given PriorityNamespace.
### 7.6.16 SMSRegistrationInfo
This information element contains an IP-SM-GW number and the address of a
Short Message Service Centre. For the definition of an IP-SM-GW number and
Service Centre Address, see 3GPP TS 23.008[27].
### 7.6.17 UE reachability for IP
This information element reflects the change of URRP-MME and/or URRP-SGSN
parameters and indicates whether the UE has become reachable, i.e. when the
URRP-MME and/or URRP-SGSN parameters was set and has been cleared due to UE
activity notification from the MME and/or the SGSN, see 3GPP TS 29.272 [26].
This information element also indicates whether the UE has become reachable at
the AMF for 3GPP access and/or at the AMF for non 3GPP access.
It consists of the following subordinate information elements:
\- UE-IP-REACHABILITY-MME. Its possible values are:
\- REACHABLE (0)
\- UE-IP-REACHABILITY-SGSN. Its possible values are:
\- REACHABLE (0)
\- UE-IP-REACHABILITY-AMF-3GPP. Its possible values are:
\- REACHABLE (0)
\- UE-IP-REACHABILITY-AMF-NON-3GPP. Its possible values are:
\- REACHABLE (0)
### 7.6.18 T-ADS Information
This information element indicates the RAT type that is serving the UE and
whether or not IMS voice over PS Session is supported at the current Routing
Area/Tracking Area.
The HSS shall make use of the appropriate S6a operation towards the MME and/or
S6d/MAP operation towards the SGSN to retrieve the T-ADS information. The
UDM/HSS shall make use of appropriate Namf service operation towards the AMF
to retrieve the T-ADS information.
The possible values for IMS voice over PS Session support are:
\- IMS-VOICE-OVER-PS-NOT-SUPPORTED (0)
\- IMS-VOICE-OVER-PS-SUPPORTED (1)
\- IMS-VOICE-OVER-PS-SUPPORT-UNKNOWN (2)
The possibles values of RAT type are specified in 3GPP TS 29.212 [28], clause
5.3.31.
### 7.6.19 Private Identity
This information element contains the IMS Private User Identity or the IMSI.
See 3GPP TS 23.003 [17]).
### 7.6.20 STN-SR
This information element indicates the Session Transfer Number for SRVCC or
5G-SRVCC (see 3GPP TS 23.003 [11]).
When STN-SR is updated, the HSS shall make use of the service S6a/S6d-IDR to
update the STN-SR in the MME/SGSN and, if the HSS supports interworking with
the UDM (see in 3GPP TS 23.632 [48]), the UDM shall make use of the
Nudm_MT_Update operation to update the STN-SR in the AMF.
### 7.6.21 UE SRVCC Capability
This information element indicates the SRVCC capability of the UE.
The possible values for the UE-SRVCC capability are:
\- UE-SRVCC-CAPABILITY-NOT-SUPPORTED (0)
\- UE-SRVCC-CAPABILITY-SUPPORTED (1)
### 7.6.21A UE 5G SRVCC Capability
This information element indicates the 5G SRVCC capability of the UE.
The possible values for the UE-5G-SRVCC capability are:
\- UE-5G-SRVCC-CAPABILITY-NOT-SUPPORTED (0)
\- UE-5G-SRVCC-CAPABILITY-SUPPORTED (1)
### 7.6.22 CSRN
This information element contains a CS Domain Routeing Number (see 3GPP TS
23.003) associated to the user identity of the request.
The HSS shall make use of the operation MAP-PROVIDE-ROAMING-NUMBER towards the
MSC/VLR to obtain this information and shall indicate the Suppression of
Announcement to the MSC/VLR.
This information element is requested by AS when all terminating services have
been already executed, then HSS is only interested in the CSRN received from
MSC/VLR.
### 7.6.23 Reference Location Information
This information element contains the reference location of the user, e.g. the
physical location of the fixed line in the case of a fixed line access, that
is associated with the User Identity and Private Identity (if present) in the
request. See 3GPP TS 23.008 [27].
### 7.6.24 IMSI
This information element contains the IMSI that is associated with the IMS
Public User Identity present in the request. See 3GPP TS 23.003 [11] for IMSI
definition.
### 7.6.25 IMSPrivateUserIdentity
This information element contains all IMS Private User Identities associated
with the IMS Public User Identity present in the request. See 3GPP TS 23.003
[11] for Private User Identity definition.
### 7.6.26 IMEISV
This information element contains the IMEI or IMEISV (see 3GPP TS 23.003 [11])
of the UE employed by the user identity of the request, during the attach to
the access network.
## 7.7 Subscription request type
This information element indicates the action requested for subscription to
notifications. See 3GPP TS 29.329 [5] for the list of valid values.
## 7.8 Current Location
This information element indicates whether an active location retrieval has to
be initiated or not when an AS requested location information. See 3GPP TS
29.329 [5] for the list of possible values.
## 7.9 Application Server Identity
This information element contains the identity of the Application Server. It
is used for the AS permission check (see 6.2).
## 7.10 Application Server Name
This information element indicates application server\'s SIP URI. See 3GPP TS
29.229 [7] for the detailed definition of the AVP.
## 7.11 Requested Identity Set
This information element indicates the set of IMS Public Identities that the
AS wishes to download. See 3GPP TS 29.329 [5] for the detailed definition of
the AVP.
## 7.12 Expiry Time
This information element indicates the expiry time of the subscription to
notifications in the HSS. See 3GPP TS 29.329 [5] for the detailed definition
of this AVP.
## 7.13 Send Data Indication
This information element indicates the request that the User Data is sent in
the response. See 3GPP TS 29.329 [5] for the detailed definition of this AVP.
## 7.14 DSAI Tag
An instance of Dynamic Service Activation Info is uniquely identified by the
Public User/Service Identity and a DSAI tag. The same DSAI tag may be used for
all the user profiles when indicating the same type of information, but not
all the user profiles may contain the same set of tags.
Application Servers shall signal that they are not interested in being
involved in new sessions by manipulating Dynamic Service Activation Info
(DSAI) inside of dynamic service information data, see clause 7.6.11.
## 7.15 Session-Priority
This information element indicates the session\'s priority level to the HSS.
See 3GPP TS 29.229 [7].
## 7.16 One Time Notification
This information element indicates that the sender requests to be notified
only one time. After the notification, the HSS shall remove the subscription.
See 3GPP TS 29.329 [5] for the list of possible values.
## 7.17 Repository Data ID
This information element includes the service indication and the sequence
number of a repository data. See 3GPP TS 29.329 [5] for the detailed
definition of this AVP.
## 7.18 Pre-paging Supported
This information element indicates whether Pre-paging is supported by the AS.
See 3GPP TS 29.329 [5] for the detailed definition of this AVP.
## 7.19 Local Time Zone Indication
This information element indicates that the Local Time Zone information (Time
Zone and Daylight Saving Time) of the location in the visited network where
the UE is attached for the requested domain and the requested nodes (if
included) is requested and indicates whether only the Local Time Zone is
required or the Local Time Zone is required together with other location data.
If only the Local Time Zone is required, other location information (e.g.
Global Cell ID, Tracking Area ID) may be absent.
This information element is only applicable to Location Information.
## 7.20 UDR Flags
This information element carries the following indications (see 3GPP 29.329
[5] for coding details):
Table 7.20/1: UDR Flags
+----------------------------------+----------------------------------+ | Name | Description | +==================================+==================================+ | Lo | Location Information EPS | | cation-Information-EPS-Supported | Supported shall be only | | | applicable if CS Location | | | Information is requested. | | | | | | It indicates that EPS Location | | | Information may be sent to the | | | AS when CS Location Information | | | is requested. | | | | | | When set, the HSS shall indicate | | | to the MSC/VLR the support of | | | Location Information EPS. | +----------------------------------+----------------------------------+ | RAT-Type-Requested | RAT Type Requested shall be only | | | applicable if PS or EPS Location | | | Information is requested | | | | | | When set, it indicates that RAT | | | Type is requested as part of the | | | PS or EPS Location Information. | +----------------------------------+----------------------------------+
## 7.21 Call Reference Info
This information element contains information used for MTRR (see 3GPP TS
23.018 [10]):
\- Call Reference Number (see 7.22)
\- AS-Number (see 7.23)
The HSS uses this information to populate the parameters callReferenceNumber
and gmsc-Address within MAP-Provide-Roaming-Number.
## 7.22 Call Reference Number
This information element contains a temporary reference number identifying the
call in progress (see 3GPP TS 23.018 [10]).
## 7.23 AS-Number
This information element contains the Application Server\'s E.164 Number.
# 8 Protocol version identification
See 3GPP TS 29.329 [5].
# 9 Operational Aspects
See 3GPP TS 29.329 [5].
###### ## Annex A (normative): Mapping of Sh operations and terminology to
Diameter
# A.1 Introduction
This appendix gives mappings from Sh to Diameter protocol elements. Diameter
protocol elements are defined in 3GPP TS 29.329 [5].
# A.2 Sh message to Diameter command mapping
The following table defines the mapping between stage 2 operations and
Diameter commands:
Table A.2.1: Sh message to Diameter command mapping
* * *
Sh message Source Destination Command-Name Abbreviation Sh-Pull AS HSS User-
Data-Request UDR Sh-Pull Resp HSS AS User-Data-Answer UDA Sh-Update AS HSS
Profile-Update-Request PUR Sh-Update Resp HSS AS Profile-Update-Answer PUA Sh-
Subs-Notif AS HSS Subscribe-Notifications-Request SNR Sh-Subs-Notif Resp HSS
AS Subscribe-Notifications-Answer SNA Sh-Notif HSS AS Push-Notification-
Request PNR Sh-Notif Resp AS HSS Push-Notification-Answer PNA
* * *
# A.3 Void
###### ## Annex B (informative): Message flow
# B.1 Message flows
The following message flows give examples regarding which Diameter messages
shall be sent in scenarios described in 3GPP TS 23.218 [4].
## B.1.1 Data Update, Registration, Notification Subscription.
Figure B.1.1: Data Update, Registration, Notification Subscription
1\. A user subscribes to a new service. The operator provisions the service in
an AS. The AS stores some service data for a user in the HSS, Sh-Update (user
identity, updated data) e.g. repository data.
2\. HSS confirms the data is updated
3\. Some time later, user registers with the network
4\. S-CSCF downloads the data from the HSS (during the procedure S-CSCF
Registration Notification on Cx interface). Filter criteria specify that the
AS wants to be notified that the end user is registered.
5\. 200 OK
6\. S-CSCF sends third party registration message to the application server to
notify that user is registered.
7\. 200 OK
8\. The AS subscribes to notifications and downloads data needed for providing
service from HSS, by means of Sh-Subs-Notif (user identity, requested data,
service information and send data indication).
9\. HSS confirms the subscription request and sends data to AS
10\. At some moment, the AS decides to update user\'s service data e.g.
repository data in the HSS, by means of Sh-Update (user identity, updated
data).
11\. The HSS confirms the service data is updated.
12\. At some moment, user data is updated in the HSS. As the AS subscribed to
notifications (step 8), the HSS sends to the AS the requested updates, by
means of Sh-Notif (user identity, updated data).
13\. The AS acknowledges the notification.
###### ## Annex C (informative): UML model of the data downloaded over Sh
interface
The purpose of this UML model is to define in an abstract level the structure
of the data downloaded over the Sh interface and describe the purpose of the
different information classes included in it.
# C.1 General description
The following picture gives an outline of the UML model of the user profile,
which is exchanged between the HSS and an AS:
Figure C.1.1: Sh-Data
Class Sh-Data contains the following attributes:
\- An optional instance of CSUserState attribute.
\- An optional instance of PSUserState attribute.
\- An optional instance of IMSI attribute.
\- Zero or more instances of IMSPrivateUserIdentity attribute.
\- An optional instance of IMEISV attribute.
Class Sh-Data contains the following classes:
\- An optional instance of the class PublicIdentifiers.
\- Zero or moreinstances of the class RepositoryData.
\- An optional instance of the class Sh-IMS-Data.
\- An optional instance of the class CSLocationInformation.
\- An optional instance of the class PSLocationInformation.
\- An optional instance of the class RegisteredIdentities.
\- An optional instance of the class ImplicitIdentities.
\- An optional instance of the class AllIdentities.
\- An optional instance of the class AliasIdentities.
\- An optional instance of the class DeletedIdentities.
If the AS and the HSS both support the Notif-Eff feature and the AS requires
to read more than one Identity Sets of a Public Identity, or regardless
whether or not the Notif-Eff feature is supported, the AS has subscribed to be
notifed of changes to IMSPublicIdentity for more than one Identity Sets (see
table 7.6.1), the class PublicIdentifiers shall not be used to convey IMS
Public Identities (it shall however still be used to convey the MSISDNs if so
requested). Instead the classes RegisteredIdentities, ImplicitIdentities,
AllIdentities and AliasIdentities shall be used and they contain the
REGISTERED_IDENTITIES, IMPLICIT_IDENTITIES, ALL_IDENTITIES and
ALIAS_IDENTITIES associated with the IMS Public Identity included in the
request respectively. See clause 7.6.2 for the detailed information. The class
PublicIdentifiers or the one among the four which may be used to contain the
corresponding identity set can both be used to convey IMS Public Identities
when AS requires only one identity set of a public identity.
If Public Identity(ies) are deleted and the AS has any subscription active for
the deleted identity(ies), the HSS shall notify the AS of the deletion of the
identity(ies) using the class DeletedIdentities.
Class RepositoryData contains repository data (transparent data) for a given
service that are associated to a Public user Identity or a group of alias
Public User Identities. It has attributes ServiceIndication, SequenceNumber
and ServiceData.
Class CSUserState contains the state of a user in the CS domain. Its only
attribute, State, is an enumeration whose possible values are defined in
clause 7.6.7.
Class PSUserState contains the state of a user in the PS domain (SGSN). Its
only attribute, State, is an enumeration whose possible values are defined in
clause 7.6.7.
NOTE: the fact that attribute State is an enumeration is a difference from
what can be carried in the MAP protocol.
Class EPSUserState contains the state of a user in the PS domain (MME). Its
only attribute, State, is an enumeration whose possible values are defined in
clause 7.6.7. .
Class Sh-5GSUserState contains the state of a user in the PS domain (AMF). Its
only attribute, State, is an enumeration whose possible values are defined in
clause 7.6.7.
Class CSLocationInformation has the attributes LocationNumber, ServiceAreaID,
CellGlobalId, LocationAreaId, GeographicalInformation, GeodeticInformation,
VLRNumber, MSCNumber, AgeOfLocationInformation, CurrentLocationRetrieved,
UserCSGInformation, TrackingAreaId, E-UTRANCellGlobalId and LocalTimeZone.
They are defined in 7.6.
Class PSLocationInformation has the attributes ServiceAreaId, CellGlobalId,
LocationAreaID, RoutingAreaID, GeographicalInformation, GeodeticInformation,
SGSNNumber, AgeOfLocationInformation, CurrentLocationRetrieved,
UserCSGInformation, VisitedPLMNID, LocalTimeZone and RATtype. They are defined
in 7.6.
Class EPSLocationInformation has the attributes E-UTRANCellGlobalId,
TrackingAreaID, GeographicalInformation, GeodeticInformation, MMEName,
AgeOfLocationInformation, CurrentLocationRetrieved, UserCSGInformation,
VisitedPLMNID, LocalTimeZone and RATtype. They are defined in 7.6.
Class TWANLocationInformation has the attributes TWAN-SSID, TWAN-BSSID, TWAN-
PLMNID, CivicAddress, TWANOperatorName, LocalTimeZone and LogicalAccessID.
They are defined in 7.6.
Class Sh-5GSLocationInformation has the attributes NRCellGlobalId,
E-UTRANCellGlobalId, TrackingAreaID, GeographicalInformation, AMFAddress,
SMSFAddress, AgeOfLocationInformation, CurrentLocationRetrieved,
VisitedPLMNID, LocalTimeZone and RATtype. They are defined in 7.6.
Class DeletedIdentities contains Public Identities (IMS Public User Identities
or Public Service Identities) removed from the HSS.
Class UEReachabilityForIP contains the UE reachability for IP. Its attributes,
UEIPReachabilityMME, UEIPReachabilitySGSN, UEIPReachabilityAMF3GPP and
UEIPReachabilityAMFnon3GPP are enumerations whose possible values are defined
in clause 7.6.17.
Class IMSVoiceOverPSSessionsSupport contains the support of IMS voice over PS
at the current access. Its only attribute, SupportIndication, is an
enumeration whose possible values are defined in clause 7.6.18.
Class IMSI contains the UE\'s IMSI. See clause 7.6.24.
Class IMSPrivateUserIdentity contains an IMS Private Identity associated with
the IMS Public Identity included in the request.
## C.2 PublicIdentifiers
The following picture details the UML model of the class PublicIdentifiers:
Figure C.2.1: The UML model of the class PublicIdentifiers
Class PublicIdentifiers contains the following attributes:
\- Zero or more instances of IMSPublicIdentity attribute. Each instance is a
Public Identity. See clause 7.6.2 for information about contents.
\- An optional instance of IdentityType attribute. If only one instance of
IMSPublicIdentity attribute is included, then this attribute identifies the
identity type in the IMSPublicIdentity attribute, it could be either:
\- A distinct Public User Identity
\- A distinct Public Service Identity
If more than one instance of IMSPublicIdentity attribute is included, this
attribute is assumed to apply to all of them.
If IdentityType attribute is not present, it is assumed to be a distinct
Public User Identity.
If more than one instance of IMSPublicIdentity shall be returned, if the
identities are of different types the EnhancedIMSPublicIdentifiers class
should be used instead.
\- An optional instance of WilcardedPSI attribute, if the Public Service
Identity in the request matches a Wildcarded PSI.
NOTE: This attribute can be omitted if this information is conveyed including
Wildcarded PSI information element in the response. See clause 6.1.1 and
6.1.3.
\- An optional instance of WilcardedIMPU attribute, if the Public User
Identity in the request matches a Wildcarded IMPU.
NOTE: This attribute can be omitted if this information is conveyed including
Wildcarded Public User Identity information element in the response. See
clause 6.1.1 and 6.1.3.
\- Zero or more instances of MSISDN attribute, that contains an MSISDN.
Class PublicIdentifiers contains the following classes:
\- Zero to more instances of EnhancedIMSPublicIdentifiers. This class is
required when more than one instance of IMSPublicIdentity shall be returned
and the identities are of different types. See clause 7.6.2 for more
information about contents. It includes the following attributes:
\- One instance of IMSPublicIdentity attribute that contains a Public
Identity.
\- One instance of the IdentityType attribute that identifies the identity
type in the IMSPublicIdentity attribute, it could be either:
\- A distinct Public User Identity
\- A distinct Public Service Identity
\- A Wildcarded Public Service Identity
\- A Wildcarded Public User Identity
\- Zero or more instances of ExtendedMSISDN, only when Additional-MSISDN
feature is enabled. It includes the following attributes:
\- One instance of MSISDN attribute that contains an MSISDN.
\- One instance of MSISDNType attribute that indicates the MSISDN Type.
Figure C.2.2: Void
# C.3 Sh-IMS-Data
The following picture details the UML model of the class Sh-IMS-Data.
Figure C.3.1: Sh-IMS-Data
Each instance of the class Sh-IMS-Data contains 0 or 1 instance of the class
S-CSCFName, 0 to 1 instance of the class IFCs, 0 or 1 instance of the class
IMSUserState, 0 or 1 instance of the class ChargingInformation, 0 or 1
instance of the class PSIActivation, 0 to n instances of the class DSAI, 0 or
1 instance of the class ServiceLevelTraceInfo, 0 or 1 instance of the class
IPAddressSecureBindingInformation, and 0 or 1 instance of the class
ReferenceLocationInformation.
Class S-CSCFName contains a SIP URI. See clause 7.6.4 for further details.
Class IFCs contains 0 to n instances of the initial filter criteria of the
multimedia public identity that the AS included in the request. The initial
filter criteria is defined in 3GPP TS 29.228 [6].
Class IMSUserState contains the registration state of the identity given by
the attribute of class Sh-IMS-Data. See clause 7.6 for possible values.
Class Charging Information contains the online and offline charging function
addresses. See clause 7.6 for possible values.
Class PSIActivation contains the activation state of the Public Service
Identity given by the attribute of class Sh-IMS-Data. See clause 7.6 for
possible values.
Class DSAI contains the DSAI Tag and a DSAI Value (reflecting the activation
state) for services the user is subscribed to. See clause 7.14 for contents
and usage.
Class ServiceLevelTraceInfo contains the Service Level Trace configuration
information to enable the Application Server to perform service level tracing
related to a specific Public Identifier. See clause 7.6.13 for contents and
usage.
Class IPAddressSecureBindingInformation contains either 0 or one IPv4 address,
either 0 or one IPv6 prefix and/or IPv6 interface identifier. See clause
7.6.14 for contents and usage.
Class ServicePriorityLevel contains the Service Priority Level allowed for the
Public Identity to be used for priority services. See clause 7.6.15 for
contents and usage.
Class SMSRegistrationInfo contains the IP-SM-GW-Number and the Service Centre
Address. See clause 7.6.16 for further details.
Class Enhanced SRVCC contains the Session Transfer Number (see 3GPP TS 23.003
[11]) and the SRVCC Capability of the UE (see 3GPP TS 23.237 [32]). See
clauses 7.6.20 and 7.6.21 respectively for further details.
Class 5G SRVCC contains the 5G SRVCC Capability of the UE (see 3GPP TS 23.237
[32]). See clause 7.6.21A for further details.
Class ExtendedPriority contains the PriorityNamespace and the PriorityLevel
information elements. See Clause 7.6.15A for further details.
Class Reference Location Information contains zero or one attribute
AccessType, zero or one attribute AccessInfo, and zero or one attribute
AccessValue, see 3GPP TS 29.228 [6].
###### ## Annex D (normative): XML schema for the Sh interface user profile
The file ShDataType_Rel15.xsd, attached to this specification, contains the
XML schema for the user profile that is sent over the Sh interface. The user
profile XML schema defines the data types that are used in the user profile
XML.\ The data that is allowed to be sent in the user profile may vary
depending on the features supported by the Diameter end points, see 3GPP TS
29.329 [5]. The user profile XML schema file is intended to be used by an XML
parser.\ The version of the Sh application sending the user profile XML shall
be the same as the version of the sent user profile XML and thus it implies
the version of the user profile XML schema to be used to validate it.
Tables D.1 and D.2 describe the data types and the dependencies among them
that configure the user profile XML schema.
Table D.1: XML schema for the Sh user profile interface: simple data types
+----------------+----------------+--------------+----------------+ | Data type | Tag | Base type | Comments | +----------------+----------------+--------------+----------------+ | tPriority | Priority | integer | >= 0 | +----------------+----------------+--------------+----------------+ | tProfil | Profil | enumerated | Possible | | ePartIndicator | ePartIndicator | | values: | | | | | | | | | | 0 (REGISTERED) | | | | | | | | | | 1 | | | | | (UNREGISTERED) | +----------------+----------------+--------------+----------------+ | tGroupID | Group | integer | >= 0 | +----------------+----------------+--------------+----------------+ | tRe | Re | enumerated | Possible | | gistrationType | gistrationType | | values: | | | | | | | | | | 0 | | | | | (**INITIAL_R | | | | | EGISTRATION**) | | | | | | | | | | 1 | | | | | (RE | | | | | -REGISTRATION) | | | | | | | | | | 2 | | | | | (DE | | | | | -REGISTRATION) | +----------------+----------------+--------------+----------------+ | tD | D | enumerated | Possible | | efaultHandling | efaultHandling | | values: | | | | | | | | | | 0 | | | | | (SESSI | | | | | ON_CONTINUED) | | | | | | | | | | 1 | | | | | (SESSIO | | | | | N_TERMINATED) | +----------------+----------------+--------------+----------------+ | tDire | SessionCase | enumerated | Possible | | ctionOfRequest | | | values: | | | | | | | | | | 0 | | | | | (ORIGINA | | | | | TING_SESSION) | | | | | | | | | | 1 | | | | | TERMIN | | | | | ATING_SESSION | | | | | | | | | | 2 | | | | | (TERMINATING\ | | | | | _UNREGISTERED) | | | | | | | | | | 3 | | | | | (ORIGINATING\ | | | | | _UNREGISTERED) | | | | | | | | | | 4 | | | | | (ORIG | | | | | INATING_CDIV) | +----------------+----------------+--------------+----------------+ | tIMSUserState | IMSUserState | Enumerated | Possible | | | | | values: | | | | | | | | | | 0 | | | | | (NO | | | | | T_REGISTERED) | | | | | | | | | | 1 (REGISTERED) | | | | | | | | | | 2 | | | | | ( | | | | | REGISTERED_UN | | | | | REG_SERVICES) | | | | | | | | | | 3 | | | | | (AUTHENTICA | | | | | TION_PENDING) | +----------------+----------------+--------------+----------------+ | tCSUserState | CSUserState | Enumerated | Possible | | | | | values (as | | | | | defined in | | | | | 3GPP TS 23.078 | | | | | [14]): | | | | | | | | | | 0 (CAMELBusy) | | | | | | | | | | 1 | | | | | (Ne | | | | | tworkDetermine | | | | | dNotReachable) | | | | | | | | | | 2 | | | | | (AssumedIdle) | | | | | | | | | | 3 | | | | | (NotPr | | | | | ovidedfromVLR) | +----------------+----------------+--------------+----------------+ | tPSUserState | PSUserState | Enumerated | Possible | | | | | values (as | | | | | defined in | | | | | 3GPP TS 23.078 | | | | | [14]): | | | | | | | | | | 0 (Detached) | | | | | | | | | | 1 | | | | | (At | | | | | tachedNotReach | | | | | ableForPaging) | | | | | | | | | | 2 | | | | | (AttachedReach | | | | | ableForPaging) | | | | | | | | | | 3 | | | | | (Con | | | | | nectedNotReach | | | | | ableForPaging) | | | | | | | | | | 4 | | | | | ( | | | | | ConnectedReach | | | | | ableForPaging) | | | | | | | | | | 5 | | | | | (NotPr | | | | | ovidedFromSGSN | | | | | or MME or AMF) | | | | | | | | | | 6 | | | | | (Ne | | | | | tworkDetermine | | | | | dNotReachable) | +----------------+----------------+--------------+----------------+ | t | LocationNumber | string | Syntax | | LocationNumber | | | described in | | | | | ITU-T Q.763 | | | | | [9] (Base64 | | | | | encoded | | | | | according to | | | | | IETF RFC 2045 | | | | | [15]). | | | | | | | | | | Length >=4 | | | | | and \=0, \= 4 | | | | | and \=0, \ Choice | Cell | tCell | 0 to 1 | | | | > of | GlobalId | GlobalId | | +----------+----------+----------+----------+----------+--------+ | | | | Servi | tServi | 0 to 1 | | | | | ceAreaId | ceAreaId | | +----------+----------+----------+----------+----------+--------+ | | | | Locati | tLocati | 0 to 1 | | | | | onAreaId | onAreaId | | +----------+----------+----------+----------+----------+--------+ | | | Geograp | tGeograp | 0 to 1 | | | | | hicalInf | hicalInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | Geo | tGeo | 0 to 1 | | | | | deticInf | deticInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | V | tISD | 0 to 1 | | | | | LRNumber | NAddress | | | +----------+----------+----------+----------+----------+--------+ | | | M | tISD | 0 to 1 | | | | | SCNumber | NAddress | | | +----------+----------+----------+----------+----------+--------+ | | | CurrentL | tBool | 0 to 1 | | | | | ocationR | | | | | | | etrieved | | | | +----------+----------+----------+----------+----------+--------+ | | | AgeOfLoc | t | 0 to 1 | | | | | ationInf | AgeOfLoc | | | | | | ormation | ationInf | | | | | | | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | E | tCSLocat | 0 to 1 | | | | | xtension | ionInfor | | | | | | | mation-E | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tCSLocat | CSLocat | Us | tUs | 0 to 1 | | | ionInfor | ionInfor | erCSGInf | erCSGInf | | | | mation-E | mation-E | ormation | ormation | | | | xtension | xtension | | | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | 0 to 1 | | | | | xtension | CSLocati | | | | | | | onInform | | | | | | | ation-Ex | | | | | | | tension2 | | | +----------+----------+----------+----------+----------+--------+ | t | CSLocati | E-U | tE-U | 0 to 1 | | | CSLocati | onInform | TRANCell | TRANCell | | | | onInform | ation-Ex | GlobalId | GlobalId | | | | ation-Ex | tension2 | | | | | | tension2 | | | | | | +----------+----------+----------+----------+----------+--------+ | | | Tracki | tTracki | 0 to 1 | | | | | ngAreaId | ngAreaId | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | 0 to 1 | | | | | xtension | CSLocati | | | | | | | onInform | | | | | | | ation-Ex | | | | | | | tension3 | | | +----------+----------+----------+----------+----------+--------+ | t | CSLocati | Local | tLocal | 0 to 1 | | | CSLocati | onInform | TimeZone | TimeZone | | | | onInform | ation-Ex | | | | | | ation-Ex | tension3 | | | | | | tension3 | | | | | | +----------+----------+----------+----------+----------+--------+ | tPSLoc | PSLoc | > Choice | Cell | tCell | 0 to 1 | | ationInf | ationInf | > of | GlobalId | GlobalId | | | ormation | ormation | | | | | +----------+----------+----------+----------+----------+--------+ | | | | Servi | tServi | 0 to 1 | | | | | ceAreaId | ceAreaId | | +----------+----------+----------+----------+----------+--------+ | | | | Locati | tLocati | 0 to 1 | | | | | onAreaId | onAreaId | | +----------+----------+----------+----------+----------+--------+ | | | Routi | tRouti | 0 to 1 | | | | | ngAreaId | ngAreaId | | | +----------+----------+----------+----------+----------+--------+ | | | Geograp | tGeograp | 0 to 1 | | | | | hicalInf | hicalInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | Geo | tGeo | 0 to 1 | | | | | deticInf | deticInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | SG | tISD | 0 to 1 | | | | | SNNumber | NAddress | | | +----------+----------+----------+----------+----------+--------+ | | | CurrentL | tBool | 0 to 1 | | | | | ocationR | | | | | | | etrieved | | | | +----------+----------+----------+----------+----------+--------+ | | | AgeOfLoc | t | 0 to 1 | | | | | ationInf | AgeOfLoc | | | | | | ormation | ationInf | | | | | | | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | E | tPSLocat | 0 to 1 | | | | | xtension | ionInfor | | | | | | | mation-E | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tPSLocat | PSLocat | Us | tUs | 0 to 1 | | | ionInfor | ionInfor | erCSGInf | erCSGInf | | | | mation-E | mation-E | ormation | ormation | | | | xtension | xtension | | | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | 0 to 1 | | | | | xtension | PSLocati | | | | | | | onInform | | | | | | | ation-Ex | | | | | | | tension2 | | | +----------+----------+----------+----------+----------+--------+ | t | PSLocati | Visit | tVisit | 0 to 1 | | | PSLocati | onInform | edPLMNID | edPLMNID | | | | onInform | ation-Ex | | | | | | ation-Ex | tension2 | | | | | | tension2 | | | | | | +----------+----------+----------+----------+----------+--------+ | | | Local | tLocal | 0 to 1 | | | | | TimeZone | TimeZone | | | +----------+----------+----------+----------+----------+--------+ | | | RATtype | tRATtype | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | tLocal | Local | TimeZone | t | 1 | | | TimeZone | TimeZone | | TimeZone | | | +----------+----------+----------+----------+----------+--------+ | | | Da | tDa | 1 | | | | | ylightSa | ylightSa | | | | | | vingTime | vingTime | | | +----------+----------+----------+----------+----------+--------+ | tEPSLoc | EPSLoc | E-U | tE-U | 0 to 1 | | | ationInf | ationInf | TRANCell | TRANCell | | | | ormation | ormation | GlobalId | GlobalId | | | +----------+----------+----------+----------+----------+--------+ | | | Tracki | tTracki | 0 to 1 | | | | | ngAreaId | ngAreaId | | | +----------+----------+----------+----------+----------+--------+ | | | Geograp | tGeograp | 0 to 1 | | | | | hicalInf | hicalInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | Geo | tGeo | 0 to 1 | | | | | deticInf | deticInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | MMEName | tString | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | | | CurrentL | tBool | 0 to 1 | | | | | ocationR | | | | | | | etrieved | | | | +----------+----------+----------+----------+----------+--------+ | | | AgeOfLoc | t | 0 to 1 | | | | | ationInf | AgeOfLoc | | | | | | ormation | ationInf | | | | | | | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | Us | tUs | | | | | | erCSGInf | erCSGInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | 0 to 1 | | | | | xtension | EPSLocat | | | | | | | ionInfor | | | | | | | mation-E | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | t | EPSLocat | Visit | tVisit | 0 to 1 | | | EPSLocat | ionInfor | edPLMNID | edPLMNID | | | | ionInfor | mation-E | | | | | | mation-E | xtension | | | | | | xtension | | | | | | +----------+----------+----------+----------+----------+--------+ | | | Local | tLocal | 0 to 1 | | | | | TimeZone | TimeZone | | | +----------+----------+----------+----------+----------+--------+ | | | E | tE | 0 to 1 | | | | | xtension | PSLocati | | | | | | | onInform | | | | | | | ation-Ex | | | | | | | tension2 | | | +----------+----------+----------+----------+----------+--------+ | tE | E | RATtype | tRATtype | 0 to 1 | | | PSLocati | PSLocati | | | | | | onInform | onInform | | | | | | ation-Ex | ation-Ex | | | | | | tension2 | tension2 | | | | | +----------+----------+----------+----------+----------+--------+ | tS | S | NRCell | tNRCell | 0 to 1 | | | h-5GSLoc | h-5GSLoc | GlobalId | GlobalId | | | | ationInf | ationInf | | | | | | ormation | ormation | | | | | +----------+----------+----------+----------+----------+--------+ | | | E-U | tE-U | 0 to 1 | | | | | TRANCell | TRANCell | | | | | | GlobalId | GlobalId | | | +----------+----------+----------+----------+----------+--------+ | | | Tracki | tTracki | 0 to 1 | | | | | ngAreaId | ngAreaId | | | +----------+----------+----------+----------+----------+--------+ | | | Geograp | tGeograp | 0 to 1 | | | | | hicalInf | hicalInf | | | | | | ormation | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | AM | tString | 0 to 1 | | | | | FAddress | | | | +----------+----------+----------+----------+----------+--------+ | | | SMS | tString | 0 to 1 | | | | | FAddress | | | | +----------+----------+----------+----------+----------+--------+ | | | CurrentL | tBool | 0 to 1 | | | | | ocationR | | | | | | | etrieved | | | | +----------+----------+----------+----------+----------+--------+ | | | AgeOfLoc | t | 0 to 1 | | | | | ationInf | AgeOfLoc | | | | | | ormation | ationInf | | | | | | | ormation | | | +----------+----------+----------+----------+----------+--------+ | | | Visit | tVisit | 0 to 1 | | | | | edPLMNID | edPLMNID | | | +----------+----------+----------+----------+----------+--------+ | | | Local | tLocal | 0 to 1 | | | | | TimeZone | TimeZone | | | +----------+----------+----------+----------+----------+--------+ | | | RATtype | tRATtype | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | tUs | Us | CSGId | tCSGId | 1 | | | erCSGInf | erCSGInf | | | | | | ormation | ormation | | | | | +----------+----------+----------+----------+----------+--------+ | | | E | tUser | 0 to 1 | | | | | xtension | CSGInfor | | | | | | | mation-E | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tUser | User | Ac | tAc | 0 to 1 | | | CSGInfor | CSGInfor | cessMode | cessMode | | | | mation-E | mation-E | | | | | | xtension | xtension | | | | | +----------+----------+----------+----------+----------+--------+ | | | CMI | tBool | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | **tT |** T | IMSV | tIMSV | 1 | | | ADSinfor | ADSinfor | oiceOver | oiceOver | | | | mation**| mation** | PSSessio | PSSessio | | | | | | nSupport | nSupport | | | +----------+----------+----------+----------+----------+--------+ | | | RATtype | tRATtype | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | | | E | t | 0 to 1 | | | | | xtension | TADSinfo | | | | | | | rmationE | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tTWANLoc | TWANLoc | T | tT | **0 to | | | ationInf | ationInf | WAN-SSID | WAN-SSID | 1** | | | ormation | ormation | | | | | +----------+----------+----------+----------+----------+--------+ | | | TW | tTW | **0 to | | | | | AN-BSSID | AN-BSSID | 1** | | +----------+----------+----------+----------+----------+--------+ | | | TWA | tVisit | **0 to | | | | | N-PLMNID | edPLMNID | 1** | | +----------+----------+----------+----------+----------+--------+ | | | Civi | tCivi | **0 to | | | | | cAddress | cAddress | n** | | +----------+----------+----------+----------+----------+--------+ | | | TWANOper | t | **0 to | | | | | atorName | TWANOper | 1** | | | | | | atorName | | | +----------+----------+----------+----------+----------+--------+ | | | Local | tLocal | 0 to 1 | | | | | TimeZone | TimeZone | | | +----------+----------+----------+----------+----------+--------+ | | | Logical | tLogical | 0 to 1 | | | | | AccessID | AccessID | | | +----------+----------+----------+----------+----------+--------+ | t | TADSinfo | La | t | 0 to 1 | | | TADSinfo | rmationE | stUEActi | DateTime | | | | rmationE | xtension | vityTime | | | | | xtension | | | | | | +----------+----------+----------+----------+----------+--------+ | | | E | tT | 0 to 1 | | | | | xtension | ADSinfor | | | | | | | mationEx | | | | | | | tension2 | | | +----------+----------+----------+----------+----------+--------+ | tT | T | Ac | tAc | 0 to 1 | | | ADSinfor | ADSinfor | cessType | cessType | | | | mationEx | mationEx | | | | | | tension2 | tension2 | | | | | +----------+----------+----------+----------+----------+--------+ | tISD | SGS | Address | tAddre | 1 | | | NAddress | NNumber, | | ssString | | | | | VL | | | | | | | RNumber, | | | | | | | M | | | | | | | SCNumber | | | | | +----------+----------+----------+----------+----------+--------+ | tPublic | Pu | I | tI | 0 to n | | | Identity | blicIden | MSPublic | MSPublic | | | | | tifiers, | Identity | Identity | | | | | Regi | | | | | | | steredId | | | | | | | entites, | | | | | | | | | | | | | | Imp | | | | | | | licitIde | | | | | | | ntities, | | | | | | | AllIde | | | | | | | ntities, | | | | | | | AliasIde | | | | | | | ntities, | | | | | | | D | | | | | | | eletedId | | | | | | | entities | | | | | +----------+----------+----------+----------+----------+--------+ | | | MSISDN | tMSISDN | 0 to n | | +----------+----------+----------+----------+----------+--------+ | | | E | tPublicI | 0 to 1) | | | | | xtension | dentityE | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tPublicI | E | Iden | tIden | (0 to 1) | | | dentityE | xtension | tityType | tityType | | | | xtension | | | | | | +----------+----------+----------+----------+----------+--------+ | | | Wildc | tWildc | (0 to 1) | | | | | ardedPSI | ardedPSI | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | (0 to 1) | | | | | xtension | PublicId | | | | | | | entityEx | | | | | | | tension2 | | | +----------+----------+----------+----------+----------+--------+ | t | E | Wildca | tWildca | (0 to 1) | | | PublicId | xtension | rdedIMPU | rdedIMPU | | | | entityEx | | | | | | | tension2 | | | | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | 0 to 1 | | | | | xtension | PublicId | | | | | | | entityEx | | | | | | | tension3 | | | +----------+----------+----------+----------+----------+--------+ | t | E | Extend | tExtend | 0 to n | | | PublicId | xtension | edMSISDN | edMSISDN | | | | entityEx | | | | (NOTE 5) | | | tension3 | | | | | | +----------+----------+----------+----------+----------+--------+ | | | E | t | 0 to 1 | | | | | xtension | PublicId | | | | | | | entityEx | | | | | | | tension4 | | | +----------+----------+----------+----------+----------+--------+ | t | E | Enha | tE | 0 to n | | | PublicId | xtension | ncedIMSP | nhancedI | | | | entityEx | | ublicIde | MSPublic | | | | tension4 | | ntifiers | Identity | | | +----------+----------+----------+----------+----------+--------+ | tE | Enha | I | tI | 1 | | | nhancedI | ncedIMSP | MSPublic | MSPublic | | | | MSPublic | ublicIde | Identity | Identity | | | | Identity | ntifiers | | | | | +----------+----------+----------+----------+----------+--------+ | | | Iden | tIden | 1 | | | | | tityType | tityType | | | +----------+----------+----------+----------+----------+--------+ | tIniti | Initi | Priority | t | 1 | | | alFilter | alFilter | | Priority | | | | Criteria | Criteria | | | | | +----------+----------+----------+----------+----------+--------+ | | | Trig | tTrigger | 0 to 1 | | | | | gerPoint | | | | +----------+----------+----------+----------+----------+--------+ | | | A | tA | 1 | | | | | pplicati | pplicati | | | | | | onServer | onServer | | | +----------+----------+----------+----------+----------+--------+ | | | Prof | tProf | 0 to 1 | | | | | ilePartI | ilePartI | | | | | | ndicator | ndicator | | | +----------+----------+----------+----------+----------+--------+ | tTrigger | Trig | Conditio | tBool | 1 | | | | gerPoint | nTypeCNF | | | | +----------+----------+----------+----------+----------+--------+ | | | SPT | tSePoTri | 1 to n | | +----------+----------+----------+----------+----------+--------+ | tSePoTri | SPT | Conditio | tBool | 0 to 1 | | | | | nNegated | | | | +----------+----------+----------+----------+----------+--------+ | | | Group | tGroupID | 1 to n | | +----------+----------+----------+----------+----------+--------+ | | | Choice | Re | tString | 1 | | | | of | questURI | | | +----------+----------+----------+----------+----------+--------+ | | | | Method | tString | 1 | +----------+----------+----------+----------+----------+--------+ | | | | S | tHeader | 1 | | | | | IPHeader | | | +----------+----------+----------+----------+----------+--------+ | | | | Ses | tDi | 1 | | | | | sionCase | rectionO | | | | | | | fRequest | | +----------+----------+----------+----------+----------+--------+ | | | | Se | tSe | 1 | | | | | ssionDes | ssionDes | | | | | | cription | cription | | +----------+----------+----------+----------+----------+--------+ | | | **Ext |** tSe | **(0 to | | | | | ension** | PoTriExt | 1)**| | | | | | ension** | | | +----------+----------+----------+----------+----------+--------+ | t | E | Registra | t | (0 to 2) | | | SePoTriE | xtension | tionType | Registra | | | | xtension | | | tionType | | | +----------+----------+----------+----------+----------+--------+ | tHeader | S | Header | tString | 1 | | | | IPHeader | | | | | +----------+----------+----------+----------+----------+--------+ | | | Content | tString | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | tSe | Se | Line | tString | 1 | | | ssionDes | ssionDes | | | | | | cription | cription | | | | | +----------+----------+----------+----------+----------+--------+ | | | Content | tString | 0 to 1 | | +----------+----------+----------+----------+----------+--------+ | tA | A | Se | t | 1 | | | pplicati | pplicati | rverName | SIP_URL | | | | onServer | onServer | | | | | +----------+----------+----------+----------+----------+--------+ | | | Default | tDefault | 0 to 1 | | | | | Handling | Handling | | | +----------+----------+----------+----------+----------+--------+ | | | Ser | tSer | 0 to 1 | | | | | viceInfo | viceInfo | | | +----------+----------+----------+----------+----------+--------+ | | | E | tAp | 0 to 1 | | | | | xtension | plicatio | | | | | | | nServerE | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tAp | E | Includ | tInclud | 0 to 1 | | | plicatio | xtension | eRegiste | eRegiste | | | | nServerE | | rRequest | rRequest | | | | xtension | | | | | | +----------+----------+----------+----------+----------+--------+ | | | Include | tInclude | 0 to 1 | | | | | Register | Register | | | | | | Response | Response | | | +----------+----------+----------+----------+----------+--------+ | tInclud | Includ | (NOTE 4) | (NOTE 4) | 0 to 1 | | | eRegiste | eRegiste | | | | | | rRequest | rRequest | | | | | +----------+----------+----------+----------+----------+--------+ | tInclude | tInclude | (NOTE 4) | (NOTE 4) | 0 to 1 | | | Register | Register | | | | | | Response | Response | | | | | +----------+----------+----------+----------+----------+--------+ | tCha | Cha | PrimaryE | tDia | 0 to 1 | | | rgingInf | rgingInf | ventChar | meterURI | | | | ormation | ormation | gingFunc | | (NOTE 2) | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | | | Se | tDia | 0 to 1 | | | | | condaryE | meterURI | | | | | | ventChar | | | | | | | gingFunc | | | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | | | Primary | tDia | 0 to 1 | | | | | Charging | meterURI | | | | | | Collec | | (NOTE 2) | | | | | tionFunc | | | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | | | S | tDia | 0 to 1 | | | | | econdary | meterURI | | | | | | Charging | | | | | | | Collec | | | | | | | tionFunc | | | | | | | tionName | | | | +----------+----------+----------+----------+----------+--------+ | tDSAI | DSAI | DSAI-Tag | t | 1 | | | | | | DSAI-Tag | | | +----------+----------+----------+----------+----------+--------+ | | | DS | tDS | 1 | | | | | AI-Value | AI-Value | | | +----------+----------+----------+----------+----------+--------+ | tUER | UER | UEI | tUEI | (0 to 1) | | | eachabil | eachabil | PReachab | PReachab | | | | ityForIP | ityForIP | ilityMME | ilityMME | | | +----------+----------+----------+----------+----------+--------+ | | | **Ext |** t**|**(0 to | | | | | ension**| UEReacha | 1)** | | | | | | bilityFo | | | | | | | rIP**Ext | | | | | | | ension** | | | +----------+----------+----------+----------+----------+--------+ | t | **Ext | UEIP | tUEIP |**(0 to | | | UEReacha | ension**| Reachabi | Reachabi | 1)** | | | bilityFo | | litySGSN | litySGSN | | | | rIP**Ext | | | | | | | ension** | | | | | | +----------+----------+----------+----------+----------+--------+ | | | E | tUERea | **(0 to | | | | | xtension | chabilit | 1)** | | | | | | yForIPEx | | | | | | | tension2 | | | +----------+----------+----------+----------+----------+--------+ | tU | **Ext | UEIPRea | tUEIPRea |**(0 to | | | EReachab | ension**| chabilit | chabilit | 1)** | | | ilityFor | | yAMF3GPP | yAMF3GPP | | | | IP**Exte | | | | | | | nsion2** | | | | | | +----------+----------+----------+----------+----------+--------+ | | | UE | tUE | **(0 to | | | | | IPReacha | IPReacha | 1)** | | | | | bilityAM | bilityAM | | | | | | Fnon3GPP | Fnon3GPP | | | +----------+----------+----------+----------+----------+--------+ | tSMS | SMS | IP-SM-G | tIP-SM-G | 1 | | | Registra | Registra | W-Number | W-Number | | | | tionInfo | tionInfo | | | | | +----------+----------+----------+----------+----------+--------+ | | | **Ext | tSMSR |**(0 to | | | | | ension**| egistrat | 1)** | | | | | | ionInfoE | | | | | | | xtension | | | +----------+----------+----------+----------+----------+--------+ | tSMSR | SMSR | S | tS | **(0 to | | | egistrat | egistrat | CAddress | CAddress | 1)** | | | ionInfoE | ionInfoE | | | | | | xtension | xtension | | | | | +----------+----------+----------+----------+----------+--------+ | t | Extended | P | tP | 1 | | | Extended | Priority | riorityN | riorityN | | | | Priority | | amespace | amespace | | | +----------+----------+----------+----------+----------+--------+ | | | Prior | tPrior | 1 | | | | | ityLevel | ityLevel | | | +----------+----------+----------+----------+----------+--------+ | tExtend | Extend | MSISDN | tMSISDN | 1 | | | edMSISDN | edMSISDN | | | | | +----------+----------+----------+----------+----------+--------+ | | | MS | tMS | 1 | | | | | ISDNType | ISDNType | | | +----------+----------+----------+----------+----------+--------+ | NOTE 1: | | | | | | | \"n\" | | | | | | | shall be | | | | | | | int | | | | | | | erpreted | | | | | | | as | | | | | | | non- | | | | | | | bounded. | | | | | | | | | | | | | | NOTE 2: | | | | | | | At least | | | | | | | one of | | | | | | | these | | | | | | | two | | | | | | | inf | | | | | | | ormation | | | | | | | elements | | | | | | | ( | | | | | | | PrimaryE | | | | | | | ventChar | | | | | | | gingFunc | | | | | | | tionName | | | | | | | or | | | | | | | Primar | | | | | | | yChargin | | | | | | | gCollect | | | | | | | ionFunct | | | | | | | ionName) | | | | | | | shall be | | | | | | | present. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The | | | | | | | syntax | | | | | | | of | | | | | | | Acc | | | | | | | essType, | | | | | | | Ac | | | | | | | cessInfo | | | | | | | and | | | | | | | Acc | | | | | | | essValue | | | | | | | is as | | | | | | | d | | | | | | | escribed | | | | | | | in 3GPP | | | | | | | TS | | | | | | | 29.228 | | | | | | | [6]. | | | | | | | | | | | | | | NOTE 4: | | | | | | | empty | | | | | | | cells | | | | | | | shall be | | | | | | | int | | | | | | | erpreted | | | | | | | as | | | | | | | complex | | | | | | | XML | | | | | | | elements | | | | | | | without | | | | | | | defined | | | | | | | content. | | | | | | | | | | | | | | NOTE 5: | | | | | | | P | | | | | | | ublicIde | | | | | | | ntifiers | | | | | | | contains | | | | | | | Extend | | | | | | | edMSISDN | | | | | | | in | | | | | | | addition | | | | | | | to | | | | | | | MSISDN | | | | | | | when | | | | | | | A | | | | | | | dditiona | | | | | | | l-MSISDN | | | | | | | feature | | | | | | | is | | | | | | | enabled. | | | | | | | | | | | | | | NOTE 6: | | | | | | | Syntax | | | | | | | d | | | | | | | escribed | | | | | | | in 3GPP | | | | | | | TS | | | | | | | 23.003 | | | | | | | [11]; | | | | | | | it shall | | | | | | | contain | | | | | | | either | | | | | | | an IMEI | | | | | | | value (a | | | | | | | string | | | | | | | of 14 | | | | | | | digits) | | | | | | | or an | | | | | | | IMEISV | | | | | | | value (a | | | | | | | string | | | | | | | of 16 | | | | | | | digits). | | | | | | | | | | | | | | NOTE 7: | | | | | | | The HSS | | | | | | | shall | | | | | | | not send | | | | | | | more | | | | | | | than one | | | | | | | instance | | | | | | | of | | | | | | | Refe | | | | | | | renceLoc | | | | | | | ationInf | | | | | | | ormation | | | | | | | and if | | | | | | | the | | | | | | | App | | | | | | | lication | | | | | | | Server | | | | | | | receives | | | | | | | more | | | | | | | than one | | | | | | | instance | | | | | | | of | | | | | | | Refe | | | | | | | renceLoc | | | | | | | ationInf | | | | | | | ormation | | | | | | | it may | | | | | | | arb | | | | | | | itrarily | | | | | | | pick one | | | | | | | for | | | | | | | further | | | | | | | pro | | | | | | | cessing. | | | | | | +----------+----------+----------+----------+----------+--------+
###### ##
###### ## Annex E (informative): T-ADS request handling in the HSS
E.1 T-ADS request handling in the HSSThe following figure shows a possible
detailed handling of T-ADS Information request in the HSS:
When receiving a T-ADS request from an Application Server, the HSS checks
whether serving nodes (i.e. SGSN and/or MME) are registered (i.e. GPRS
services and/or EPS services are actually subscribed, serving node addresses
are stored and not marked as purged).
If neither MME nor SGSN is registered, a response indicating that IMS voice
over PS sessions is not supported is returned to the Application Server. UE
Activity Time and the Last RAT Type are not reported.
If both MME and SGSN are registered but the registered SGSN is a Gn/Gp-SGSN,
the HSS treats the MME as not registered in the following T-ADS request
handling.
Otherwise,
if in the previous ULR(s) the AVP Homogeneous-Support-of-IMS-Voice-Over-PS-
Sessions was received from all the registered serving nodes with the same
value (either with SUPPORTED or NOT_SUPPORTED), a response with the received
value is returned to the Application Server. UE Activity Time and the Last RAT
Type are not reported.
if in previous ULRs the AVP Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions
was received from all the registered serving nodes but with different values,
the HSS continues processing as follows:
if MME or SGSN (or both) did not indicated support of T-ADS Data Retrieval
within the previous ULR, a response indicating IMS-VOICE-OVER-PS-SUPPORT-
UNKNOWN is returned to the Application Server. UE Activity Time and the Last
RAT Type are not reported.
otherwise the HSS retrieves T-ADS Data from MME and from SGSN. After
retrieval, the HSS returns a response to the Application Server indicating the
response from MME or SGSN whichever reported the most recent UE Activity Time.
UE Activity Time and the Last RAT Type are also reported.
if in the previous ULR(s) the AVP Homogeneous-Support-of-IMS-Voice-Over-PS-
Sessions was not received from at least one of the registered serving nodes,
the HSS continues processing as follows:
if at least one of the registered serving nodes that did not send an
Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP within the previous ULR
did not indicate support of T-ADS Data Retrieval within the previous ULR, a
response indicating IMS-VOICE-OVER-PS-SUPPORT-UNKNOWN is returned to the
Application Server. UE Activity Time and the Last RAT Type are not reported.
otherwise the HSS retrieves T-ADS Data from all the registered serving nodes
that did not send an Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP
within the previous ULR. When all responses are received the HSS continues
processing as follows:
if two T-ADS Data responses were receive (one from MME and one from SGSN), the
HSS returns a response to the Application Server indicating the response from
MME or SGSN whichever reported the most recent UE Activity Time. UE Activity
Time and the Last RAT Type are also reported.
if one T-ADS Data response was received (from MME or SGSN) and the other
serving node (SGSN or MME) was not registered, the HSS returns a response to
the Application Server indicating the response from responding serving node.
UE Activity Time and the Last RAT Type are also reported.
if one T-ADS Data response was received (from MME or SGSN) and the other
serving node (SGSN or MME) has sent an Homogeneous-Support-of-IMS-Voice-Over-
PS-Sessions AVP within the previous ULR, the HSS continues processing as
follows:
if information about support / non-support of IMS voice over PS sessions from
both serving nodes are identical, the HSS returns this information to the
Application Server. UE Activity Time and the Last RAT Type are not reported.
if information about support / non-support of IMS voice over PS sessions from
both serving nodes are not identical, the HSS continues processing as follows:
if the serving node that sent an Homogeneous-Support-of-IMS-Voice-Over-PS-
Sessions AVP within the previous ULR did not indicate support of T-ADS Data
Retrieval within the previous ULR, a response indicating IMS-VOICE-OVER-PS-
SUPPORT-UNKNOWN is returned to the Application Server. UE Activity Time and
the Last RAT Type are not reported.
otherwise the HSS retrieves T-ADS Data from the serving node that sent an
Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP within the previous ULR.
When the response is received, the HSS returns a response to the Application
Server indicating the response from MME or SGSN whichever reported the most
recent UE Activity Time. UE Activity Time and the Last RAT Type are also
reported.
###### ## Annex F (normative): Diameter overload control mechanism
## F.1 General
Diameter overload control mechanism is an optional feature.
IETF RFC 7683 [36] specifies a Diameter overload control mechanism which
includes the definition and the transfer of related AVPs between Diameter
nodes.
It is recommended to make use of IETF RFC 7683 [36] on the Sh interface where,
when applied, the AS shall behave as a reacting node and the HSS as a
reporting node.
Depending on regional/national requirements and network operator policy,
priority traffic (e.g. MPS as described in 3GPP TS 22.153 [38]) shall be
exempted from throttling due to Diameter overload control up to the point
where requested traffic reduction cannot be achieved without throttling the
priority traffic.
## F.2 HSS behaviour
The HSS requests traffic reduction from the AS when the HSS is in an overload
situation, including OC-OLR AVP in answer commands as described in IETF RFC
7683 [36].
The HSS identifies that it is in an overload situation by implementation
specific means. For example, the HSS may take into account the traffic over
the Sh interfaces or other interfaces, the level of usage of internal
resources (CPU, memory), the access to external resources, etc.
The HSS determines the specific contents of OC-OLR AVP in overload reports and
the HSS decides when to send OC-OLR AVPs by implementation specific means.
## F.3 AS behaviour
The AS applies required traffic reduction received in answer commands to
subsequent applicable requests, as per IETF RFC 7683 [36].
The AS achieves requested traffic reduction by implementation specific means.
For example, the AS may implement message throttling with prioritization or a
message retaining mechanism for operations that can be postponed.
Diameter requests related to priority traffic (e.g. MPS) and emergency,
detected via the presence of priority information (e.g., Resource-Priority
header field for MPS) in SIP messages as described in 3GPP TS 24.229 [39],
have the highest priority. Depending on regional/national regulatory and
operator policies, these Diameter requests shall be the last to be throttled,
when the AS has to apply traffic reduction. Relative priority amongst various
priority traffic (e.g. MPS) and emergency traffic is subject to
regional/national regulatory and operator policies.
###### ## Annex G (Informative): Diameter overload node behaviour
## G.1 Message prioritization
This clause describes possible behaviours of the AS regarding message
prioritization in an informative purpose.
The AS may take the following into account when making throttling decisions:
\- Identification of the procedures that can be deferred (e.g. Subscription to
notification of Data Update), so to avoid to drop non deferrable procedures;
\- Prioritization of certain types of request (e.g. between PUR and SNR)
according to the context of their use, in particular:
\- Higher prioritization of commands for AS that are related to a registered
user for a service, so to avoid the interruption of the registered service for
the user.
\- Lower prioritization of commands for AS that are related to massive
subscription data update due to provisioning.
\- Priority level of a priority user (e.g., MPS user).
###### ## Annex H (Informative): Data shared among multiple subscribers
## H.1 General
This clause applies only to Repository Data.
As defined by this specification, Repository Data is updated using a Sh-Update
procedure per subscriber and Service Indication. This means that when
Repository Data needs to be modified, it requires an update operation per
subscriber, even if the same Repository Data is also part of other
subscribers\' data set.
If Repository Data for a specific Service Indication is shared by a large
amount of subscribers, it implies a large amount of update operations, which
may trigger a large amount of notifications if any AS subscribed to changes
for these corresponding subscribers.
See 3GPP TS 29.364 [40] for a description of a solution to avoid this massive
amount of update operations. However, it is important to remark that there may
be other implementation specific solutions that handle data sharing among
multiple individual subscribers.
###### ## Annex I (normative): Diameter message priority mechanism
## I.1 General
IETF draft-ietf-drmp-02 [42] specifies a Diameter message priority mechanism
that allows Diameter nodes to indicate the relative priority of Diameter
messages. With this information, other Diameter nodes may leverage the
relative priority of Diameter messages into routing, resource allocation, set
the DSCP marking for transport of the associated Diameter message, and also
abatement decisions when overload control is applied.
## I.2 Sh/Dh interface
### I.2.1 General
The Diameter message priority mechanism is an optional feature.
It is recommended to make use of IETF draft-ietf-drmp-02 [42] over the Sh/Dh
interface of an operator network when the overload control defined in Annex F
is applied on this Sh/Dh interface.
### I.2.2 AS/OSA SCS behaviour
When the AS/OSA SCS supports the Diameter message priority mechanism, the
AS/OSA SCS shall comply with IETF RFC 7944 [42].
The AS/OSA SCS sending a request shall determine the required priority
according to its policies. When priority is required, the AS/OSA SCS shall
include the DRMP AVP indicating the required priority level in the request it
sends, and shall prioritise the request according to priority level received.
When the AS/OSA SCS receives the corresponding response, it shall prioritise
the received response according to the priority level received within the DRMP
AVP if present in the response, otherwise according to the priority level of
the corresponding request.
When the AS/OSA SCS receives a request, it shall handle the request according
to the received DRMP AVP priority level. For the response, it may modify the
priority level received in the DRMP AVP according to its policies and shall
handle the response according to the required priority level. If the required
priority level is different from the priority level received in the request,
it shall include the DRMP AVP in the response.
If:
\- the AS/OSA SCS supports using the Diameter message priority mechanism for
DSCP marking purposes,
\- the transport network utilizes DSCP marking, and
\- message-dependant DSCP marking is possible for the protocol stack
transporting Diameter,
then the AS/OSA SCS shall set the DSCP marking for transport of the request or
response according to the required priority level.
Diameter requests related to priority traffic (e.g. MPS as identified by the
AS through SIP procedures, emergency) shall contain a DRMP AVP with a high
priority of which the level value is operator dependent.
When not-explicitly requested, the inclusion and priority value of the DRMP
AVP in Diameter messages are implementation specific.
### I.2.3 HSS/SLF behaviour
When the HSS/SLF supports the Diameter message priority mechanism, the HSS/SLF
shall comply with IETF RFC 7944 [42].
The HSS/SLF sending a request shall determine the required priority according
to its policies. When priority is required, the HSS/SLF shall include the DRMP
AVP indicating the required priority level in the request it sends, and shall
prioritise the request according to the required priority level.
When the HSS/SLF receives the corresponding response, it shall prioritise the
received response according to the priority level received within the DRMP AVP
if present in the response, otherwise according to the priority level of the
corresponding request.
When the HSS/SLF receives a request, it shall handle the request according to
the received DRMP AVP priority level. For the response, it may modify the
priority level received in the DRMP AVP according to its policies and shall
handle the response according to the required priority level. If the required
priority level is different from the priority level received in the request,
it shall include the DRMP AVP in the response.
If:
\- the HSS/SLF supports using the Diameter message priority mechanism for DSCP
marking purposes,
\- the transport network utilizes DSCP marking, and
\- message-dependant DSCP marking is possible for the protocol stack
transporting Diameter,
then the HSS/SLF shall set the DSCP marking for transport of the request or
response according to the required priority level.
When not-explicitly requested, the inclusion and priority value of the DRMP
AVP in Diameter messages are implementation specific.
### I.2.4 Interactions
If the HSS/SLF supporting the Diameter message priority mechanism receives the
request message containing both the Session-Priority AVP and DRMP AVP, the
HSS/SLF shall prioritize the request according to priority level received
within the DRMP AVP.
###### ## Annex J (normative): Diameter load control mechanism
## J.1 General
Diameter load control mechanism is an optional feature.
It is recommended to make use of IETF RFC 8583 [43] on the Sh interface where,
when applied, the AS shall behave as reacting nodes and the HSS as a reporting
node.
## J.2 HSS behaviour
The HSS may report its current load by including a Load AVP of type HOST in
answer commands as described in IETF RFC 8583 [43].
The HSS calculates its current load by implementation specific means. For
example, the HSS may take into account the traffic over the Sh interface or
other interfaces, the level of usage of internal resources (e.g. CPU, memory),
the access to external resources, etc.
The HSS determines when to send Load AVPs of type HOST by implementation
specific means.
## J.3 AS behaviour
When performing next hop Diameter Agent selection for requests that are routed
based on realm, the AS may take into account load values from Load AVPs of
type PEER received from candidate next hop Diameter nodes, as per IETF RFC
8583 [43].
#
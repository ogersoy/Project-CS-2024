# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the stage 3 protocol and data model for the
Nsoraf Service Based Interface. It provides stage 3 protocol definitions and
message flows, and specifies the API for each service offered by the SOR-AF.
The 5G System stage 2 architecture and procedures are specified in 3GPP TS
23.501 [2] and 3GPP TS 23.502 [3]. The stage 2 architecture and procedures for
5G Steering of Roaming are specified in 3GPP TS 23.122 [14].
The Technical Realization of the Service Based Architecture and the Principles
and Guidelines for Services Definition are specified in 3GPP TS 29.500 [4] and
3GPP TS 29.501 [5].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 29.500: \"5G System; Technical Realization of Service Based
Architecture; Stage 3\".
[5] 3GPP TS 29.501: \"5G System; Principles and Guidelines for Services
Definition; Stage 3\".
[6] OpenAPI: \"OpenAPI 3.0.0 Specification\", https://github.com/OAI/OpenAPI-
Specification/blob/master/versions/3.0.0.md.
[7] 3GPP TR 21.900: \"Technical Specification Group working methods\".
[8] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[9] IETF RFC 6749: \"The OAuth 2.0 Authorization Framework\".
[10] 3GPP TS 29.510: \"5G System; Network Function Repository Services; Stage
3\".
[11] IETF RFC 7540: \"Hypertext Transfer Protocol Version 2 (HTTP/2)\".
> [12] IETF RFC 8259: \"The JavaScript Object Notation (JSON) Data Interchange
> Format\".
[13] IETF RFC 7807: \"Problem Details for HTTP APIs\".
[14] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station (MS) in idle mode\".
[15] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".
[16] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces Stage 3\".
[17] 3GPP TS 31.115: \"Secured packet structure for (Universal) Subscriber
Identity Module (U)SIM Toolkit applications\".
# 3 Definitions, symbols and abbreviations
## 3.1 Terms
**SoR Information:** In this specification, this refers to the following HPLMN
information:
a) an indication of whether the SOR-AF requires the UDM to request an
acknowledgement from the UE for successful reception of the Steering of
Roaming information; and
b) one of the following:
\- a list of preferred PLMN/access technology combinations with an indication
that it is included;
\- a secured packet with an indication that it is included; or
\- the HPLMN indication that \'no change of the \"Operator Controlled PLMN
Selector with Access Technology\" list stored in the UE is needed and thus no
list of preferred PLMN/access technology combinations is provided\'.
NOTE: The secured packet contains the list of preferred PLMN/access technology
combinations encapsulated with a security mechanism as described in 3GPP TS
31.115 [17].
## 3.2 Symbols
Void.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
NF Network Function
JSON Javascript Object Notation
SOR-AF Steering Of Roaming Application Function
SoR Steering of Roaming
SUPI Subscription Permanent Identifier
UE User Equipment
UDM Unified Data Management
# 4 Overview
## 4.1 Introduction
Within the 5GC, the Steering Of Roaming Application Function (SOR-AF) provides
services (see 3GPP TS 23.122 [14]) to NF service consumers (e.g. UDM) via the
Nsoraf service based interface.
NOTE: The generation and calculation of the SoR information and associated
roaming business logic are out of scope of this document.
Figure°4.1-1 depicts the reference architecture of the SOR-AF.
Figure 4.1-1: Reference model -- SOR-AF
# 5 Services offered by the SOR-AF
## 5.1 Introduction
The SOR-AF offers the following services to NF consumers (e.g. UDM) via the
Nsoraf service based interface:
\- Nsoraf_SteeringOfRoaming
Table 5.1-1 summarizes the corresponding APIs defined for this specification.
Table 5.1-1: APIs Description
**Service Name** **Clause** **Description** **OpenAPI Specification File**
**apiName** **Annex**
* * *
Nsoraf_SteeringOfRoaming 6.1 Nsoraf Steering Of Roaming Service
TS29550_Nsoraf_SOR.yaml nsoraf-sor A.2
## 5.2 Nsoraf_SteeringOfRoaming Service
### 5.2.1 Service Description
The Nsoraf_SteeringOfRoaming (Nsoraf_SOR) service provides Steering of Roaming
services to NF consumers (e.g. UDM) to enable the retrieval of SoR information
(i.e. the list of preferred PLMN/access technology combinations or an
indication that no update to the list of preferred PLMN/access technology
combinations is needed) to be conveyed to the UE, as specified in Annex C of
3GPP°TS°23.122 [14]. The latter specifies the 5GS control plane mechanism for
Steering of Roaming that aims at allowing the HPLMN to update the \"Operator
Controlled PLMN Selector with Access Technology\" list in the UE by providing
and updating this list of preferred PLMN/access technology combinations.
### 5.2.2 Service Operations
#### 5.2.2.1 Introduction
For the Nsoraf_SteeringOfRoaming service, the following service operations are
defined:
\- Get
\- Info
#### 5.2.2.2 Get
##### 5.2.2.2.1 General
This service operation is used by a NF consumer (e.g. UDM) to retrieve SoR
information.
The returned information can consist of either:
\- a list of preferred PLMN/access technology combinations;
\- a secured packet;
\- neither of them.
NOTE: The secured packet contains the list of preferred PLMN/access technology
combinations encapsulated with a security mechanism as described in 3GPP TS
31.115 [17].
The following procedures are supported using the \"Get\" service operation:
\- SoR Information Retrieval
##### 5.2.2.2.2 SoR Information Retrieval
Figure 5.2.2.2.2-1 depicts a scenario where a NF consumer (e.g. UDM) sends a
request to the SOR-AF to retrieve the SoR information for a UE (see also
clause C.2 in Annex C of 3GPP°TS°23.122°[14]).
The request contains the UE\'s identity (/{supi}) and a set of query
parameters (e.g. PLMN ID of the visited PLMN the UE is roaming in).
Figure 5.2.2.2.2-1: SoR Information Retrieval Procedure
1\. The NF service consumer (e.g. UDM) sends a GET request to the resource
representing the SoR information (sor-information), with query parameters
indicating the PLMN ID and other relevant information (e.g. Access type).
2a. On success, the SOR-AF responds with the HTTP status code \"200 OK\" with
the message body containing the SoR information for the concerned UE. The
response also contains a Cache-Control HTTP header set to the value \"no-
cache\" instructing the NF consumer (e.g. UDM) to not cache the received SoR
information.
> 2b. If there is no valid SoR information for the UE (e.g. the resource does
> not exist, the SUPI is unknown to the SOR-AF), the SOR-AF responds with the
> HTTP status code \"404 Not Found\" including additional error information in
> the response body (within the \"ProblemDetails\" IE).
NOTE: An operator configurable timer shall be used by the NF Service Consumer
(e.g. UDM) to control the acceptable time during which it shall wait for the
GET response from the SOR-AF, as specified in clause C.2 of
3GPP°TS°23.122°[14] (step 3d of the procedure description). The default value
and range of this timer is operator specific and shall take into account the
importance of the related procedure (e.g. registration procedure).
On failure, the appropriate HTTP status code indicating the error shall be
returned and appropriate additional error information should be returned in
the GET response body.
#### 5.2.2.3 Info
##### 5.2.2.3.1 General
This service operation is used by a NF consumer (e.g. UDM) to provide the SOR-
AF with the reception status of the acknowledgment on successful reception of
SoR information by the UE, in case an acknowledgment was requested to the UE.
The following procedures are supported using the \"Info\" service operation:
\- SoR Acknowledgment Reception Notification
##### 5.2.2.3.2 SoR Acknowledgment Reception Notification
Figure 5.2.2.3.2-1 depicts a scenario where a NF consumer (e.g. UDM) sends an
indication to the SOR-AF on the reception status of SoR information by the UE
(see also clauses C.2 and C.3 in Annex C of 3GPP°TS°23.122°[14]).
The request contains the UE\'s identity (/{supi}), the type of acknowledgment
(/sor-information/sor-ack) and the indication (SorAckInfo).
Figure 5.2.2.3.2-1: SoR Acknowledgment Reception Notification procedure
1\. The NF service consumer (e.g. UDM) sends a PUT request to the resource
representing the SoR information acknowledgment (/{supi}/sor-information/sor-
ack) with the SorAckInfo containing an indication on the reception status of
SoR information by the UE.
2a. The SOR-AF responds with the HTTP status code \"204 No Content\".
2b. If there is an error (e.g. the SUPI is unknown to the SOR-AF), the SOR-AF
shall respond with the HTTP status code \"404 Not Found\" including additional
error information in the response body (within the \"ProblemDetails\" IE).
On failure, the appropriate HTTP status code indicating the error shall be
returned and appropriate additional error information should be returned in
the PUT response body.
# 6 API Definitions
## 6.1 Nsoraf_SteeringOfRoaming Service API
### 6.1.1 Introduction
The Nsoraf_SOR service shall use the Nsoraf_SOR service API.
The request URI used in HTTP request from the NF service consumer towards the
NF service producer shall have the structure defined in clause 4.4.1 of 3GPP
TS 29.501 [5], i.e.:
**{apiRoot}/\ /\/\**
with the following components:
\- The {apiRoot} shall be set as described in 3GPP TS 29.501 [5].
\- The \ shall be \"nsoraf-sor\".
\- The \ shall be \"v1\".
\- The \ shall be set as described in clause
6.1.3.
### 6.1.2 Usage of HTTP
#### 6.1.2.1 General
HTTP/2, IETF RFC 7540 [11], shall be used as specified in clause 5 of 3GPP TS
29.500 [4].
HTTP/2 shall be transported as specified in clause 5.3 of 3GPP TS 29.500 [4].
The OpenAPI [6] specification of HTTP messages and content bodies for the
Nsoraf_SOR API is contained in Annex A.
#### 6.1.2.2 HTTP standard headers
##### 6.1.2.2.1 General
See clause 5.2.2 of 3GPP TS 29.500 [4] for the usage of HTTP standard headers.
##### 6.1.2.2.2 Content type
JSON, IETF RFC 8259 [12], shall be used as content type of the HTTP bodies
specified in the present specification as specified in clause 5.4 of 3GPP TS
29.500 [4]. The use of the JSON format shall be signalled by the content type
\"application/json\".
\"Problem Details\" JSON object shall be used to indicate additional details
of the error in a HTTP response body and shall be signalled by the content
type \"application/problem+json\", as defined in IETF RFC 7807 [13].
##### 6.1.2.2.3 Cache-Control
The \"Cache-Control\" header set to the value \"no-cache\" shall be included
in HTTP responses for resources that shall not be cached (e.g.
SorInformation).
#### 6.1.2.3 HTTP custom headers
The mandatory HTTP custom header fields specified in clause 5.2.3.2 of 3GPP TS
29.500 [4] shall be applicable.
### 6.1.3 Resources
#### 6.1.3.1 Overview
The structure of the Resource URIs of the \"Nsoraf_SOR\" service is depicted
in Figure 6.1.3.1-1.
Figure 6.1.3.1-1: Resource URI structure of the Nsoraf_SOR API
Table 6.1.3.1-1 provides an overview of the resources and applicable HTTP
methods.
Table 6.1.3.1-1: Resources and methods overview
+----------------+----------------+----------------+----------------+ | Resource name | Resource URI | HTTP method or | Description | | | | custom | | | | | operation | | +================+================+================+================+ | s | /{supi}/s | GET | Retrieve the | | or-information | or-information | | SoR | | | | | information. | | (Document) | | | | +----------------+----------------+----------------+----------------+ | sor-ack | /{s | PUT | Inform the | | | upi}/sor-infor | | SOR-AF of the | | (Document) | mation/sor-ack | | reception | | | | | status of the | | | | | Acknowledgment | | | | | of successful | | | | | reception of | | | | | SoR | | | | | information by | | | | | the UE. | +----------------+----------------+----------------+----------------+
#### 6.1.3.2 Resource: sor-information
##### 6.1.3.2.1 Description
This resource represents the SoR information for a SUPI. It is used by NF
consumers (e.g. UDM) to:
\- request the retrieval of the SoR information during registration in a VPLMN
as specified in clause C.2 in Annex C of 3GPP°TS°23.122°[14].
##### 6.1.3.2.2 Resource Definition
Resource URI: **{apiRoot}/nsoraf-sor/v1/{supi}/sor-information**
This resource shall support the resource URI variables defined in table
6.1.3.2.2-1.
Table 6.1.3.2.2-1: Resource URI variables for this resource
* * *
Name Data type Definition
* * *
apiRoot string See clause 6.1.1
supi Supi Represents the Subscription Permanent Identifier (see 3GPP TS 23.501
[2] clause 5.9.2)\ pattern: \"\^(imsi-[0-9]{5,15}\|nai-.+\|.+)\$\"
* * *
##### 6.1.3.2.3 Resource Standard Methods
###### 6.1.3.2.3.1 GET
This method shall support the URI query parameters specified in table
6.1.3.2.3.1-1.
Table 6.1.3.2.3.1-1: URI query parameters supported by the GET method on this
resource
* * *
Name Data type P Cardinality Description Applicability supported-features
SupportedFeatures O 0..1 See 3GPP TS 29.500 [4] clause 6.6.  
plmn-id PlmnId M 1 PLMN identity of the PLMN serving the UE.  
access-type AccessType O 0..1 Access type used by the UE.
* * *
This method shall support the request data structures specified in table
6.1.3.2.3.1-2 and the response data structures and response codes specified in
table 6.1.3.2.3.1-3.
Table 6.1.3.2.3.1-2: Data structures supported by the GET Request Body on this
resource
* * *
Data type P Cardinality Description n/a
* * *
Table 6.1.3.2.3.1-3: Data structures supported by the GET Response Body on
this resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | | | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | S | M | 1 | 200 OK | Upon success, | | orInformation | | | | a response | | | | | | with \"200 | | | | | | OK\" status | | | | | | code and a | | | | | | response body | | | | | | containing | | | | | | the SoR | | | | | | information | | | | | | as requested | | | | | | by the NF | | | | | | consumer | | | | | | (e.g. UDM) | | | | | | shall be | | | | | | returned by | | | | | | the SOR-AF. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 307 Temporary | Temporary | | irectResponse | | | Redirect | redirection. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing a | | | | | | URI pointing | | | | | | to a resource | | | | | | located on | | | | | | alternative | | | | | | SOR-AF or the | | | | | | initial | | | | | | target SOR-AF | | | | | | when this is | | | | | | a redirection | | | | | | triggered by | | | | | | an SCP via | | | | | | another SCP. | | | | | | | | | | | | (NOTE 2) | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 308 Permanent | Permanent | | irectResponse | | | Redirect | redirection. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing a | | | | | | URI pointing | | | | | | to a resource | | | | | | located on | | | | | | alternative | | | | | | SOR-AF or the | | | | | | initial | | | | | | target SOR-AF | | | | | | when this is | | | | | | a redirection | | | | | | triggered by | | | | | | an SCP via | | | | | | another SCP. | | | | | | | | | | | | (NOTE 2) | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 404 Not Found | The \"cause\" | | roblemDetails | | | | attribute may | | | | | | be set to one | | | | | | of the | | | | | | following | | | | | | application | | | | | | errors: | | | | | | | | | | | | - | | | | | | USE | | | | | | R_NOT_FOUND | +---------------+---+-------------+---------------+---------------+ | NOTE 1: The | | | | | | manadatory | | | | | | HTTP error | | | | | | status code | | | | | | for the GET | | | | | | method listed | | | | | | in Table | | | | | | 5.2.7.1-1 of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | also apply. | | | | | | | | | | | | NOTE 2: | | | | | | Redi | | | | | | rectResponses | | | | | | may be | | | | | | inserted by | | | | | | an SCP, see | | | | | | cl | | | | | | ause 6.10.9.1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4]. | | | | | +---------------+---+-------------+---------------+---------------+
Table 6.1.3.2.3.1-4: Headers supported by the 200 Response Code on this
resource
* * *
**Name** **Data type** **P** **Cardinality** **Description** Cache-Control
string M 1 The Cache-Control HTTP header is set to the value \"no-cache\"
instructing the NF consumer (e.g. UDM) to not cache the received SoR
information.
* * *
Table 6.1.3.2.3.1-5: Headers supported by the 307 Response Code on this
endpoint
* * *
Name Data type P Cardinality Description Location string M 1 A URI pointing to
a resource located on alternative SOR-AF or the initial target SOR-AF when
this is a redirection triggered by an SCP via another SCP.
* * *
Table 6.1.3.2.3.1-6: Headers supported by the 308 Response Code on this
endpoint
* * *
Name Data type P Cardinality Description Location string M 1 A URI pointing to
a resource located on alternative SOR-AF or the initial target SOR-AF when
this is a redirection triggered by an SCP via another SCP.
* * *
#### 6.1.3.3 Resource: sor-ack
##### 6.1.3.3.1 Description
This resource represents the notification from the NF consumer (e.g. UDM) of
the reception status of the acknowledgment of successful reception of SoR
information by the UE as specified in in Annex C of 3GPP°TS°23.122 [14].
##### 6.1.3.3.2 Resource Definition
Resource URI: **{apiRoot}/nsoraf-sor/v1/{supi}/sor-information/sor-ack**
This resource shall support the resource URI variables defined in table
6.1.3.3.2-1.
Table 6.1.3.3.2-1: Resource URI variables for this resource
* * *
Name Data type Definition
* * *
apiRoot string See clause 6.1.1
supi Supi Represents the Subscription Permanent Identifier (see 3GPP TS 23.501
[2] clause 5.9.2)\ pattern: \"\^(imsi-[0-9]{5,15}\|nai-.+\|.+)\$\"
* * *
##### 6.1.3.3.3 Resource Standard Methods
###### 6.1.3.3.3.1 PUT
This method shall support the URI query parameters specified in table
6.1.3.3.3.1-1.
Table 6.1.3.3.3.1-1: URI query parameters supported by the PUT method on this
resource
* * *
Name Data type P Cardinality Description Applicability n/a
* * *
This method shall support the request data structures specified in table
6.1.3.3.3.1-2 and the response data structures and response codes specified in
table 6.1.3.3.3.1-3.
Table 6.1.3.3.3.1-2: Data structures supported by the PUT Request Body on this
resource
* * *
Data type P Cardinality Description SorAckInfo M 1 Contains an indication on
the reception status of the acknowledgment of successful reception of SoR
information by the UE.
* * *
Table 6.1.3.3.3.1-3: Data structures supported by the PUT Response Body on
this resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | | | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | n/a | | | 204 No | Upon success, | | | | | Content | a response | | | | | | with \"204 No | | | | | | Content\" | | | | | | status code | | | | | | shall be | | | | | | returned. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 307 Temporary | Temporary | | irectResponse | | | Redirect | redirection. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing a | | | | | | URI pointing | | | | | | to a resource | | | | | | located on | | | | | | alternative | | | | | | SOR-AF or the | | | | | | initial | | | | | | target SOR-AF | | | | | | when this is | | | | | | a redirection | | | | | | triggered by | | | | | | an SCP via | | | | | | another SCP. | | | | | | | | | | | | (NOTE 2) | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 308 Permanent | Permanent | | irectResponse | | | Redirect | redirection. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing a | | | | | | URI pointing | | | | | | to a resource | | | | | | located on | | | | | | alternative | | | | | | SOR-AF or the | | | | | | initial | | | | | | target SOR-AF | | | | | | when this is | | | | | | a redirection | | | | | | triggered by | | | | | | an SCP via | | | | | | another SCP. | | | | | | | | | | | | (NOTE 2) | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 404 Not Found | The \"cause\" | | roblemDetails | | | | attribute may | | | | | | be set to the | | | | | | following | | | | | | application | | | | | | error: | | | | | | | | | | | | - | | | | | | USE | | | | | | R_NOT_FOUND | +---------------+---+-------------+---------------+---------------+ | NOTE 1: The | | | | | | manadatory | | | | | | HTTP error | | | | | | status code | | | | | | for the PUT | | | | | | method listed | | | | | | in Table | | | | | | 5.2.7.1-1 of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | also apply. | | | | | | | | | | | | NOTE 2: | | | | | | Redi | | | | | | rectResponses | | | | | | may be | | | | | | inserted by | | | | | | an SCP, see | | | | | | cl | | | | | | ause 6.10.9.1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4]. | | | | | +---------------+---+-------------+---------------+---------------+
Table 6.1.3.3.3.1-4: Headers supported by the 307 Response Code on this
endpoint
* * *
Name Data type P Cardinality Description Location string M 1 A URI pointing to
a resource located on alternative SOR-AF or the initial target SOR-AF when
this is a redirection triggered by an SCP via another SCP.
* * *
### 6.1.4 Custom Operations without associated resources
No custom operations without associated resources are defined for the
Nsoraf_SOR Service.
### 6.1.5 Notifications
#### 6.1.5.1 General
In this release of this specification, no notifications are defined for the
Nsoraf_SOR Service.
### 6.1.6 Data Model
#### 6.1.6.1 General
This clause specifies the application data model supported by the API.
Table 6.1.6.1-1 specifies the data types defined for the Nsoraf_SOR service
based interface protocol.
Table 6.1.6.1-1: N~soraf~ specific Data Types
Data type Clause defined Description Applicability
* * *
SorInformation 6.1.6.2.2 Contains the SoR information to be conveyed to the
UE.  
SorAckInfo 6.1.6.2.3 Contains an indication to the SOR-AF on the reception
status of the acknowledgment of successful reception of SoR Information by the
UE.  
SorAckStatus 6.1.6.3.3 Contains the reception status of the acknowledgment of
successful reception of SoR Information by the UE.
Table 6.1.6.1-2 specifies data types re-used by the Nsoraf_SOR service based
interface protocol from other specifications, including a reference to their
respective specifications and when needed, a short description of their use
within the N~soraf~ service based interface.
Table 6.1.6.1-2: N~soraf~ re-used Data Types
Data type Reference Comments Applicability
* * *
PlmnId 3GPP TS 29.571 [16] PLMN Identity  
ProblemDetails 3GPP TS 29.571 [16] Common data type used in response bodies  
RedirectResponse 3GPP TS 29.571 [10] Redirect Response  
SupportedFeatures 3GPP TS 29.571 [16] see 3GPP TS 29.500 [4] clause 6.6  
SteeringContainer 3GPP TS 29.503 [15] Contains the SoR Information  
Supi 3GPP TS 29.571 [16] Contains the SUPI information.  
DateTime 3GPP TS 29.571 [16] Date Time  
AccessType 3GPP TS 29.571 [16] Access type (e.g. 3GPP)
#### 6.1.6.2 Structured data types
##### 6.1.6.2.1 Introduction
This clause defines the structures to be used in resource representations.
##### 6.1.6.2.2 Type: SorInformation
Table 6.1.6.2.2-1: Definition of type SorInformation
+-----------+-----------+---+-----------+-----------+-----------+ | Attribute | Data type | P | Ca | De | Appl | | name | | | rdinality | scription | icability | +===========+===========+===+===========+===========+===========+ | steering | Steering | C | 0..1 | When | | | Container | Container | | | present, | | | | | | | this | | | | | | | attribute | | | | | | | contains | | | | | | | the | | | | | | | in | | | | | | | formation | | | | | | | needed to | | | | | | | update | | | | | | | the | | | | | | | \ | | | | | | | "Operator | | | | | | | C | | | | | | | ontrolled | | | | | | | PLMN | | | | | | | Selector | | | | | | | with | | | | | | | Access | | | | | | | Tec | | | | | | | hnology\" | | | | | | | list | | | | | | | stored in | | | | | | | the UE, | | | | | | | either as | | | | | | | an array | | | | | | | of | | | | | | | preferred | | | | | | | PL | | | | | | | MN/Access | | | | | | | Tec | | | | | | | hnologies | | | | | | | com | | | | | | | binations | | | | | | | in | | | | | | | priority | | | | | | | order | | | | | | | (with the | | | | | | | first | | | | | | | entry in | | | | | | | the array | | | | | | | i | | | | | | | ndicating | | | | | | | the | | | | | | | highest | | | | | | | priority | | | | | | | and the | | | | | | | last | | | | | | | entry | | | | | | | i | | | | | | | ndicating | | | | | | | the | | | | | | | lowest) | | | | | | | or a | | | | | | | secured | | | | | | | packet. | | | | | | | | | | | | | | If no | | | | | | | change of | | | | | | | the | | | | | | | \ | | | | | | | "Operator | | | | | | | C | | | | | | | ontrolled | | | | | | | PLMN | | | | | | | Selector | | | | | | | with | | | | | | | Access | | | | | | | Tec | | | | | | | hnology\" | | | | | | | list | | | | | | | stored in | | | | | | | the UE is | | | | | | | needed, | | | | | | | then this | | | | | | | attribute | | | | | | | shall be | | | | | | | absent. | | +-----------+-----------+---+-----------+-----------+-----------+ | sorAckI | Boolean | M | 1 | This | | | ndication | | | | attribute | | | | | | | indicates | | | | | | | to the NF | | | | | | | consumer | | | | | | | (e.g. | | | | | | | UDM) | | | | | | | whether | | | | | | | an | | | | | | | Ackno | | | | | | | wledgment | | | | | | | of | | | | | | | s | | | | | | | uccessful | | | | | | | reception | | | | | | | of SoR | | | | | | | in | | | | | | | formation | | | | | | | shall be | | | | | | | requested | | | | | | | to the UE | | | | | | | (when set | | | | | | | to | | | | | | | \"True\") | | | | | | | or not | | | | | | | (when set | | | | | | | to | | | | | | | \" | | | | | | | False\"). | | +-----------+-----------+---+-----------+-----------+-----------+ | sorSe | DateTime | M | 1 | Contains | | | ndingTime | | | | the date | | | | | | | and time | | | | | | | at which | | | | | | | SOR-AF | | | | | | | returns | | | | | | | SorInf | | | | | | | ormation. | | | | | | | | | | | | | | It is | | | | | | | used to | | | | | | | correlate | | | | | | | the SoR | | | | | | | acknow | | | | | | | ledgement | | | | | | | with the | | | | | | | a | | | | | | | ssociated | | | | | | | SoR | | | | | | | inf | | | | | | | ormation. | | +-----------+-----------+---+-----------+-----------+-----------+
##### 6.1.6.2.3 Type: SorAckInfo
Table 6.1.6.2.3-1: Definition of type SorAckInfo
Attribute name Data type P Cardinality Description Applicability
* * *
sorAckStatus SorAckStatus M 1 Contains the reception status of the
acknowledgment of successful reception of SoR Information by the UE.  
sorSendingTime DateTime M 1 Contains the date and time at which SOR-AF sent
the SorInformation to which the acknowledgment status relates.
#### 6.1.6.3 Simple data types and enumerations
##### 6.1.6.3.1 Introduction
This clause defines simple data types and enumerations that can be referenced
from data structures defined in the previous clauses.
##### 6.1.6.3.2 Simple data types
The simple data types defined in table 6.1.6.3.2-1 shall be supported.
Table 6.1.6.3.2-1: Simple data types
* * *
Type Name Type Definition Description Applicability n/a
* * *
##### 6.1.6.3.3 Enumeration: SorAckStatus
The enumeration SorAckStatus represents an indication to the SOR-AF on whether
the acknowledgment of successful reception of SoR information was received
from the UE. It shall comply with the provisions defined in table 6.1.6.3.3-1.
Table 6.1.6.3.3-1: Enumeration SorAckStatus
Enumeration value Description Applicability
* * *
\"ACK_SUCCESSFUL\" Indicates to the SOR-AF that the acknowledgment of
successful reception of SoR information was received from the UE and the
integrity check was successful.  
\"ACK_NOT_RECEIVED\" Indicates to the SOR-AF that the acknowledgment of
successful reception of SoR information was NOT received from the UE.  
\"ACK_NOT_SUCCESSFUL\" Indicates to the SOR-AF that the acknowledgment of
successful reception of SoR information was received from the UE and the
integrity check was NOT successful.
### 6.1.7 Error Handling
#### 6.1.7.1 General
For the Nsoraf_SOR API, HTTP error responses shall be supported as specified
in clause 4.8 of 3GPP TS 29.501 [5]. Protocol errors and application errors
specified in table 5.2.7.2-1 of 3GPP TS 29.500 [4] shall be supported for an
HTTP method if the corresponding HTTP status codes are specified as mandatory
for that HTTP method in table 5.2.7.1-1 of 3GPP TS 29.500 [4].
In addition, the requirements in the following clauses are applicable for the
Nsoraf_SOR API.
#### 6.1.7.2 Protocol Errors
No specific procedures for the Nsoraf_SOR service are specified.
#### 6.1.7.3 Application Errors
The application errors defined for the Nsoraf_SOR service are listed in Table
6.1.7.3-1.
Table 6.1.7.3-1: Application errors
+-------------------+------------------+-----------------------------+ | Application Error | HTTP status code | Description | +===================+==================+=============================+ | USER_NOT_FOUND | 404 Not Found | The user does not exist | | | | | | | | This error is applicable to | | | | all Nsoraf_SOR operations. | +-------------------+------------------+-----------------------------+
### 6.1.8 Feature negotiation
The optional features in table 6.1.8-1 are defined for the Nsoraf_SOR API.
They shall be negotiated using the extensibility mechanism defined in clause
6.6 of 3GPP TS 29.500 [4].
Table 6.1.8-1: Supported Features
Feature number Feature Name Description
* * *
n/a
### 6.1.9 Security
As indicated in 3GPP TS 33.501 [8] and 3GPP TS 29.500 [4], the access to the
Nsoraf_SOR API may be authorized by means of the OAuth2 protocol (see IETF RFC
6749 [9]), based on local configuration, using the \"Client Credentials\"
authorization grant, where the NRF (see 3GPP TS 29.510 [10]) plays the role of
the authorization server.
If OAuth2 is used, an NF Service Consumer, prior to consuming services offered
by the Nsoraf_SOR API, shall obtain a \"token\" from the authorization server,
by invoking the Access Token Request service, as described in 3GPP TS 29.510
[10], clause 5.4.2.2.
NOTE: When multiple NRFs are deployed in a network, the NRF used as
authorization server is the same NRF that the NF Service Consumer used for
discovering the Nsoraf_SOR service.
The Nsoraf_SOR API defines a single scope \"nsoraf-sor\" for the entire
service, and it does not define any additional scopes at resource or operation
level.
###### ## Annex A (normative): OpenAPI specification
# A.1 General
This Annex specifies the formal definition of the API(s) defined in the
present specification. It consists of OpenAPI 3.0.0 specifications in YAML
format.
This Annex takes precedence when being discrepant to other parts of the
specification with respect to the encoding of information elements and methods
within the API(s).
NOTE: The semantics and procedures, as well as conditions, e.g. for the
applicability and allowed combinations of attributes or values, not expressed
in the OpenAPI definitions but defined in other parts of the specification
also apply.
Informative copies of the OpenAPI specification files contained in this 3GPP
Technical Specification are available on a Git-based , that uses the GitLab
software version control system (see 3GPP TS 29.501 [5] clause 5.3.1 and 3GPP
TR 21.900 [7] clause 5B).
# A.2 Nsoraf_SOR API
openapi: 3.0.0
info:
title: \'Nsoraf_SOR\'
version: 1.0.2
description: \|
Nsoraf Steering Of Roaming Service.
© 2022, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA,
TTC).
All rights reserved.
externalDocs:
description: 3GPP TS 29.550 V16.5.0; Steering Of Roaming Application Function
Services.
url: http://www.3gpp.org/ftp/Specs/archive/29_series/29.550/
servers:
\- url: \'{apiRoot}/nsoraf-sor/v1\'
variables:
apiRoot:
default: https://example.com
description: apiRoot as defined in clause 4.4 of 3GPP TS 29.501
security:
\- {}
\- oAuth2ClientCredentials:
\- nsoraf-sor
paths:
/{supi}/sor-information:
get:
summary: retrieve the steering of roaming information for a UE
operationId: GetSorInformation
tags:
\- SoR Information Retrieval
parameters:
\- name: supi
in: path
description: Identifier of the UE
required: true
schema:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
\- name: supported-features
in: query
description: Supported Features
schema:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/SupportedFeatures\'
\- name: plmn-id
in: query
description: serving PLMN ID
required: true
content:
application/json:
schema:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/PlmnId\'
\- name: access-type
in: query
description: Access type used by the UE
schema:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/AccessType\'
responses:
\'200\':
description: Expected response to a valid request
content:
application/json:
schema:
\$ref: \'#/components/schemas/SorInformation\'
headers:
Cache-Control:
description: Cache-Control (as described in RFC 7234) with value \"no-cache\"
to indicate that the returned SoR information should not be cached
schema:
type: string
\'307\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/307\'
\'308\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/308\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
description: Unexpected error
/{supi}/sor-information/sor-ack:
put:
summary: SoR Acknowledgment Reception Notification
operationId: SorAckInfo
tags:
\- Providing the reception status of the acknowledgement of Steering of
Roaming information reception by the UE
parameters:
\- name: supi
in: path
description: Identifier of the UE
required: true
schema:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/SorAckInfo\'
responses:
\'204\':
description: Successful reception of the indication
\'307\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/307\'
\'308\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/308\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
description: Unexpected error
components:
securitySchemes:
oAuth2ClientCredentials:
type: oauth2
flows:
clientCredentials:
tokenUrl: \'{nrfApiRoot}/oauth2/token\'
scopes:
nsoraf-sor: Access to the Nsoraf_SOR API
schemas:
# API specific definitions
SorInformation:
type: object
required:
\- sorAckIndication
\- sorSendingTime
properties:
steeringContainer:
\$ref: \'TS29503_Nudm_SDM.yaml#/components/schemas/SteeringContainer\'
sorAckIndication:
type: boolean
sorSendingTime:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/DateTime\'
SorAckInfo:
type: object
required:
\- sorAckStatus
\- sorSendingTime
properties:
sorAckStatus:
\$ref: \'#/components/schemas/SorAckStatus\'
sorSendingTime:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/DateTime\'
SorAckStatus:
anyOf:
\- type: string
enum:
\- ACK_SUCCESSFUL
\- ACK_NOT_RECEIVED
\- ACK_NOT_SUCCESSFUL
\- type: string
#
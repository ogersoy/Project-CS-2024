# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, certain modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" shall not to be used as substitutes
for \"may\" and \"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
Subscriber and Equipment Trace, standardized by 3GPP SA5 in the family of
specifications TS 32.421 [2] / TS 32.422 [3] / TS 32.423 [4], was originally
introduced for diagnostic and troubleshooting purposes. With the introduction
of Self Organized Networks (SON) concepts in 3GPP Rel-8, the Trace was being
considered as one of the data sources for Centralized SON (C-SON) algorithms.
In addition to traditional Trace, other Trace job types such as collection of
MDT measurements, Radio Link Failure (RLF) and Radio Connection Establishment
Failure (RCEF) reports were added to trace specifications and used extensively
for the NM centralized Coverage and Capacity Optimization (NM CCO TR 32.836
[5]).
Traditional trace reporting is file-based and therefore implies certain time
restrictions on the availability of trace data preventing it from being used
in fast control loop automation processes. In addition, file-based trace
reporting may cause scalability issues in scenarios involving processing the
records of multiple traces delivered at high rate.
# 1 Scope
The present document investigates the opportunities for new trace reporting
methods. It identifies and documents use cases and potential requirements for
non-file-based trace reporting, documents and evaluates potential solutions,
and provides recommendations for the normative work aligned with 5G Services
Based Management Architecture (SBMA).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 32.421: \"Telecommunication management; Subscriber and equipment
trace; Trace concepts and requirements\".
[3] 3GPP TS 32.422: \"Telecommunication management; Subscriber and equipment
trace; Trace control and configuration management\".
[4] 3GPP TS 32.423: \"Telecommunication management; Subscriber and equipment
trace; Trace data definition and management\"
[5] 3GPP TR 32.836: \"Telecommunication management; Study on Network
Management (NM) centralized Coverage and Capacity Optimization (CCO) Self-
Organizing Networks (SON) function\".
[6] 3GPP TS 37.320: \"Universal Terrestrial Radio Access (UTRA) and Evolved
Universal Terrestrial Radio Access (E-UTRA); Radio measurement collection for
Minimization of Drive Tests (MDT); Overall description; Stage 2\".
[7] 3GPP TS 28.532: \"Management and orchestration; Generic management
services\".
[8] 3GPP TS 28.533: \"Management and orchestration; Architecture framework\".
[9] IETF RFC 6455: \"The WebSocket Protocol\".
[10] IETF RFC 8446: \"The Transport Layer Security (TLS) Protocol Version
1.3\".
[11] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[12] 3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1], TS 32.421 [2], TS 32.422 [3], TS 32.423 [4] and the following apply. A
term defined in the present document takes precedence over the definition of
the same term, if any, in 3GPP TR 21.905 [1].
## 3.2 Symbols
Void.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1], TS 32.421 [2], TS 32.422 [3], TS 32.423 [4] and the following
apply. An abbreviation defined in the present document takes precedence over
the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].
# 4 Concepts and Background
## 4.1 Introduction
The sub-clauses of clause 4 introduce relevant background information on the
Cell Traffic Trace, MDT, RLF and RCEF reports collection concepts as a
foundation for the use cases documented in clause 5 and for the reader\'s
convenience.
## 4.2 Cell Traffic Trace
Cell Traffic Trace defined in TS 32.421 [2] as the ability to trace one or
more active calls in one or more cells.
The high-level Trace Session activation requirements (specific to Management
activation) state the following:
\- In the case of a Cell Traffic Trace, Trace Session activation should be
possible for all calls active in a cell or multiple cells without knowledge of
the UEs\' identification (IMEI or IMEISV).
\- In the case of a Cell Traffic Trace, Trace Sessions should be activated for
all the NEs where Cell Traffic Trace is specified.
\- In the case of Cell Traffic Trace (in a shared network only), a Trace
Session shall be started for UEs which are served by the Participating
Operator that has made the request to the Master Operator.
The high-level requirements for starting a Trace Recording Session (specific
to Management activation) state the following:
\- In the case of a Cell Traffic Trace, the Trace Recording Session should
start upon the Trace control and configuration parameters being received by
the NEs in the Trace Session activation and the presence of call activity.
Furthermore, the Core Network node that handles the traced session should be
requested to:
\- provide a trace log including Trace Reference, Trace Recording Session
Reference and the identity of the UE (i.e. IMSI or IMEI(SV) to the Trace
Collection Entity, or
\- provide a notification including Trace Reference, Trace Recording Session
Reference and the identity of the UE (i.e. IMSI or IMEI(SV)) to the Trace
Collection Entity.
\- In the case of a Cell Traffic Trace (in a shared network only), the Trace
Recording Session shall only be started for UEs which are served by the
Participating Operator that has made the request to the Master Operator.
The concept of Cell Traffic Trace was originally introduced to address the
\"checking radio coverage\" legacy use case (see annex A.4 in TS 32.421 [2])
where it\'s used to collect trace data on all of the cells active in the area
of interest.
Another legacy use case relying on Cell Traffic Trace is the \"fine-tuning and
optimization of algorithms/procedures\" documented in the annex A.6 of TS
32.421 [2].
According to the TS 32.422 [3], the Cell Traffic Trace is supported for both
UTRAN, E-UTRAN and NG-RAN. Using NG-RAN case as example, the Cell Traffic
Trace starting mechanism is as following (see clause 4.2.2.10 of TS 32.422 [3]
for additional details):
In NG-RAN, after the Cell Traffic Trace has been activated in the monitored
cell(s), the NG-RAN node shall start a Trace Recording Session for new
call(s)/session(s) and for already existing call(s)/session(s) (events for
existing call(s)/session(s) are not required to be recorded prior to the
activation of the cell traffic trace). When the NG-RAN node starts a Trace
Recording Session it shall allocate a Trace Recording Session Reference (TRSR)
for the given call or session. The NG-RAN node shall send the allocated Trace
Recording Session Reference, and the Trace Reference and the Trace Collection
Entity address in the CELL TRAFFIC TRACE message to the AMF via the NG
connection.
When AMF receives this new NG signalling message containing the Trace
Recording Session Reference (TRSR) and Trace Reference (TR), the AMF shall
look up the SUPI/IMEI(SV) of the given call from its database and shall send
the SUPI/IMEI(SV) numbers together with the Trace Recording Session Reference
and Trace Reference to the Trace Collection Entity.
The figure below illustrates the procedure.
{width="4.479166666666667in" height="4.777777777777778in"}
Figure 4.2.1: NG-RAN trace starting mechanism (figure 4.2.2.10.1 in TS 32.422
[3])
## 4.3 MDT
The collection of radio measurements for minimization of drive tests (MDT)
feature has been introduced by 3GPP Rel-10 (see TS 37.320 [6] for stage 2
details) for UTRAN and E-UTRAN. The work on MDT for NG-RAN targeted for 3GPP
Rel-16.
TS 37.320 [6] defines two modes of MDT (immediate and logged) as following:
\- Immediate MDT: MDT functionality involving measurements performed by the UE
in CONNECTED state and reporting of the measurements to eNB/RNC available at
the time of reporting condition as well as measurements by the network for MDT
purposes.
\- Logged MDT: MDT functionality involving measurement logging by UE in IDLE
mode, CELL_PCH, URA_PCH states and CELL_FACH state when second DRX cycle is
used (when UE is in UTRA) for reporting to eNB/RNC at a later point in time,
and logging of MBSFN measurements by E-UTRA UE in IDLE and CONNECTED modes.
The general principles and requirements guiding the definition of MDT
functions include the following (see clause 4.1 in TS 37.320 [6] for
additional details):
\- There are two modes for the MDT measurements: Logged MDT and Immediate MDT.
There are also cases of measurement collection not specified as either
immediate or logged MDT, such as Accessibility measurements.
\- It is possible to configure MDT measurements for the UE logging purpose
independently from the network configurations for normal RRM purposes.
However, in most cases, the availability of measurement results is
conditionally dependent on the UE RRM configuration.
\- UE MDT measurement logs consist of multiple events and measurements taken
over time. The time interval for measurement collection and reporting is
decoupled in order to limit the impact on the UE battery consumption and
network signalling load.
\- It is possible to configure the geographical area where the defined set of
measurements will be collected.
\- The measurements will be linked to available location information and/or
other information or measurements that can be used to derive location
information.
\- The measurements in measurement logs will be linked to a time stamp.
\- The network may use UE capabilities to select terminals for MDT
measurements.
\- The solutions for MDT are able to work independently from SON support in
the network. Relation between measurements/solution for MDT and UE side SON
functionswill be established in a way that re-use of functions is achieved
where possible.
\- The subscriber/cell trace functionality is reused and extended to support
MDT. If the MDT is initiated toward to a specific UE (e.g. based on IMSI,
IMEI-SV, etc.), the signalling-based trace procedure is used, otherwise the
management-based trace procedure (or cell traffic trace procedure) is used.
Network signalling and overall control of MDT is described in TS 32.422 [3].
According to the clause 5.2 in TS 37.320 [6], the E-UTRAN Immediate MDT
measurements are not limited to those performed by the UE and do include
measurements performed by the eNB (per cell or per UE):
\- M1: RSRP and RSRQ measurement by UE.
\- M2: Power Headroom measurement by UE.
\- M3: Received Interference Power measurement by eNB. This is a cell
measurement. One sample is logged each measurement collection period, where
one sample corresponds to a measurement period.
\- M4: Data Volume measurement separately for DL and UL, per QCI per UE, by
eNB.
\- M5: Scheduled IP Throughput for MDT measurement separately for DL and UL,
per RAB per UE and per UE for the DL, per UE for the UL, by eNB.
\- M6: Packet Delay measurement, separately for DL and UL, per QCI per UE, see
UL PDCP Delay, by the UE, and Packet Delay in the DL per QCI, by the eNB.
\- M7: Packet Loss rate measurement, separately for DL and UL per QCI per UE,
by the eNB.
\- M8: RSSI measurement by UE.
\- M9: RTT measurement by UE.
The LTE trace use cases relevant to collection of MDT data are \"periodical
sampling of network performance\", \"differentiation of area-based MDT data by
terminal type\", \"subscriber complaint about MBMS service in the eUTRAN
network\" and \"check MBMS service quality and performance of the eUTRAN
network\" (see annexes A.12, A.13, A.14 and A.15 in TS 32.421 [2]).
TS 32.422 [3] defines several trace Job types including dedicated to MDT data
collection only and combined with trace data collection (see clause 5.9a in TS
32.422 [3] for additional details).
## 4.4 RLF and RCEF reports collection
In addition to regular subscriber and equipment trace and MDT results
collection, the trace mechanisms are used for collection of Radio Link Failure
(RLF) and RRC Connection Establishment Failure (RCEF) reports.
The Radio Link Failure report contains information related to the latest
connection failure experienced by the UE. The connection failure can be Radio
Link Failure (RLF) or Handover Failure (HOF). Upon RLF/HOF detection in the
UE, RLF report also includes available location information on where RLF
occurred (see TS 37.320 [6] for additional details). RLF reports may also
include available WLAN measurement results and/or Bluetooth measurement
results for calculating UE location.
Example scenarios of RLF reporting using special Trace Session where the job
type indicates RLF reporting only are illustrated on the following figures
(see clause 4.3.1 in TS 32.422 [3] for additional details).
Figure 4.4.1: Example scenario for RLF reporting when UE reestablishment is
successful at source eNB (figure 4.3.1.1 in TS 32.422 [3])
Figure 4.4.2: Example scenario for RLF reporting when the UE reestablishment
is successful at target eNB when there is X2 Link between target eNB and
source eNB (figure 4.3.1.2 in TS 32.422 [3])
Example scenarios of RCEF reporting using special Trace Session where the job
type indicates RCEF reporting only are illustrated on the following figure
(see clause 4.8.1 in TS 32.422 [3] for additional details).
Figure 4.4.3: Example scenario for RCEF reporting when the UE RRC
establishment is successful to a different eNB (figure 4.8.1.2 in TS 32.422
[3])
The trace Job types \"RLF reports only\" and \"RCEF reports only\" are
applicable only in management based trace activation in E-UTRAN (see clause
5.9a in TS 32.422 [3]).
# 5 Use Cases
## 5.1 Collecting Cell and UE data for analytics
### 5.1.1 Goal
Being able to analyse and optimize the mobility management and traffic
handling behaviour for on-going sessions is important, as it offers an
opportunity to address potential problems before it\'s \"too late\" (while
something can be done to mitigate them or prevent the problem from happening).
Cell Traffic Trace, Immediate MDT, RLF reports and RCEF reports are the
examples of RAN data relevant to this goal.
### 5.1.2 Pre-conditions
The consumers (e.g. specific instances of MDAS producers, NWDAF) and producers
(e.g. specific E-UTRAN or NG-RAN nodes) of data have been identified and are
operational.
The data to be collected (e.g. particular call processing events, relevant
interfaces, signalling messages and IEs, MDT measurements, UE location
information, failure reports) has been selected.
### 5.1.3 Description/steps
1\. 3GPP Management System configures/activates the data producers with
appropriate Trace measurement control and configuration parameters (e.g. those
specified in sub-clauses of clause 5 in TS 32.422 [3]).
NOTE 1: For the illustrative purposes of this use case, it is assumed that
Trace Job types \"Immediate MDT and Trace\", \"RLF reports only\" and \"RCEF
reports only\" have been selected (see clause 5.9a in TS 32.422 [3]) and the
information about data consumer (e.g. address, identity) has been provided.
2\. The data producer establishes connection to the data consumer and
exchanges the data collection session metadata (e.g. identity of the data
producer, nature of the data being collected, Trace Reference).
3\. While the Trace Session is active on the data producer, the data producer
performs UE selection (see clauses 4.1.1.6a and 4.1.1.9 in TS 32.422 [3]),
receives RLF and RCEF reports (see clauses 4.3 and 4.8 in TS 32.422 [3]),
starts trace recording sessions (see clauses 4.2.2.5 and 4.2.2.10 in TS 32.422
[3]), enables MDT measurements (see clause 4.2.2.7 in TS 32.422 [3]).
4\. Periodically, upon the data availability, the data producer sends the
collected data to the data consumer. The periodicity and the amount of data in
each burst sent from producer to consumer may be standardized, made
configurable or left implementation-specific. But the key point here is that
the data is being delivered to the consumer while it\'s still relevant to the
analytical task performed by the consumer.
NOTE 2: The actions described by steps 3 and 4 repeated until the Trace
Session is deactivated (e.g. via explicit configuration/deactivation by the
3GPP Management System or if Trace Session requirements such as amount of data
or duration have been satisfied).
5\. 3GPP Management System configures/deactivates the data producers.
6\. The data producer terminates the connection to the data consumer and
potentially informs it that the data collection task has been completed and no
further data is expected.
The use case ends upon successful termination of the data collection task.
### 5.1.4 Post-conditions
The data consumer has the necessary data to perform the analytical tasks. The
data (reported per UE) may include, but is not limited to:
\- LTE MDT measurements (see TSs 37.320 [6] and 32.422 [3]) such as:
\- M1: RSRP and RSRQ measurement by UE with Periodic, event A2 as reporting
triggers;
\- M2: Power Headroom (PH) measurement by UE;
\- M3: Received Interference Power measurement by eNB;
\- M4: Data Volume measurement separately for DL and UL by eNB;
\- M5: Scheduled IP Throughput measurement separately for DL and UL by eNB.
NOTE: 5G MDT measurements are FFS (pending on-going work in RAN WG).
\- Radio Link Failure reports;
\- RRC Connection Establishment Failure reports;
\- Raw signalling messages (see TS 32.423 clauses 4.13 and 4.29 for additional
details);
\- UE location information (see TS 32.423 clause 4.16.2 for additional
details).
The specific methods for analysing and/or correlating the captured data, as
well as any actions that may be triggered by such analysis are out of scope of
the present use case.
## 5.2 Collecting subscriber and equipment trace data for near-real-time
diagnostics and troubleshooting
### 5.2.1 Goal
Being able to diagnose and troubleshoot various problems reported by
subscribers (e.g. as described in sub-clauses of Annex A in TS 32.421 [2]) for
on-going sessions is important, as it offers an opportunity to investigate and
address potential problems while they are happening, and to evaluate the
corrective actions (e.g. based on subscriber\'s feedback or automated
algorithms).
Subscriber and equipment Trace with Signalling Based Activation performed on
RAN and Core NEs are the examples of trace data relevant to this goal.
### 5.2.2 Pre-conditions
The consumers (e.g. management applications and/or functions) and producers
(e.g. specific NG-RAN and 5GC nodes) of data have been identified and are
operational.
The subscriber or equipment to be traced has been identified.
The data to be collected (e.g. triggering events, trace depth, relevant NE
types, relevant interfaces, signalling messages and IEs, MDT measurements, UE
location information, failure reports) has been selected.
### 5.2.3 Description/steps
NOTE 1: For the illustrative purposes of this use case, the 5GC activation
mechanism with UE attached to 5GC via NG-RAN (as described in the clause
4.1.2.15.1 of TS 32.422 [3]) has been selected. Other activation mechanisms
involving E-UTRAN, NG-RAN, EPC and 5GC are possible, but are not conceptually
different from the perspective of this use case.
1\. Management system configures/activates the Trace Session to the UDM. UDM
stores the trace control and configuration parameters.
2\. As UE (to be traced) registers with the network, the AMF starts a new
Trace Session according to the configuration parameters received from UDM (see
steps 3-8 in clause 4.1.2.15.1 of TS 32.422 [3]).
3\. AMF establishes connection to the Trace data consumer and exchanges the
Trace data collection session metadata (e.g. identity of the AMF, nature of
the data being collected, Trace Session Reference).
4\. While the Trace Session is active on the AMF, AMF starts the Trace
Recording Sessions and collects the Trace data prescribed by Trace
configuration received from the UDM.
5\. Periodically, upon the Trace data availability, the AMF sends the
collected data to the data consumer. The periodicity and the amount of data in
each burst sent from AMF to data consumer may be standardized, made
configurable or left implementation-specific. But the key point here is that
the data is being delivered to the consumer while it\'s still relevant to the
diagnostic/troubleshooting task performed by the consumer.
6\. In parallel to the step 5, AMF sends the Trace Start message to the NG-RAN
node (see steps 9-11 in clause 4.1.2.15.1 of TS 32.422 [3] and additional
details in TS 38.413 [11]). NG-RAN node starts the Trace Session and
establishes connection to the Trace data consumer. NG-RAN node and Trace data
consumer exchange the Trace data collection session metadata (e.g. identity of
the NG-RAN node, nature of the data being collected, Trace Session Reference).
7\. While the Trace Session is active on the NG-RAN node, NG-RAN node collects
the Trace data prescribed by Trace configuration received from the AMF.
8\. Periodically, upon the Trace data availability, the NG-RAN node sends the
collected data to the data consumer. The periodicity and the amount of data in
each burst sent from NG-RAN node to data consumer may be standardized, made
configurable or left implementation-specific. But the key point here is that
the data is being delivered to the consumer while it\'s still relevant to the
diagnostic/troubleshooting task performed by the consumer.
9\. In parallel with steps 3-5, AMF activates the Trace sessions on PCF and
SMF (see steps 12-17 in clause 4.1.2.15.1 of TS 32.422 [3]). The PCF and SMF
start Trace sessions and establish connections to the Trace data consumer. PCF
and SMF exchange Trace data collection session metadata (e.g. identity of PCF
or SMF, nature of the data being collected, Trace Session Reference).
10\. Periodically, upon the Trace data availability, the PCF and SMF send the
collected data to the data consumer. The data is being delivered to the
consumer while it\'s still relevant to the diagnostic/troubleshooting task
performed by the consumer.
11\. When traced UE hands-over from one NG-RAN node to another (e.g. Xn
handover), the Trace configuration is propagated in the Trace activation IE of
the HANDOVER REQUEST message (see TS 38.423 [12]). The target NG-RAN node
starts the Trace Session and establishes connection to the Trace data
consumer. The target NG-RAN node and Trace data consumer exchange the Trace
data collection session metadata (e.g. identity of the NG-RAN node, nature of
the data being collected, Trace Session Reference).
12\. While the Trace Session is active on the target NG-RAN node, target NG-
RAN node collects the Trace data prescribed by Trace configuration received
from the source NG-RAN node.
13\. The target NG-RAN node reports the collected trace data to the data
consumer (performs the actions described in the step 8 above).
NOTE 2: The steps 6-8 and 11-13 are repeated while the Trace session is active
(Trace configuration is propagated to target NG-RAN nodes following the UE
handovers). Each NG-RAN node where the Trace is active has an active
connection to the Trace data consumer (establishes connection and exchanges
trace session metadata upon Trace session activation, and reports trace data
upon availability).
14\. 3GPP Management System configures/deactivates the Trace session at the
UDM. It triggers the Trace deactivation process on all NEs where the Trace
session was active (see clause 4.1.4.11 in TS 32.422 [3] for additional
details).
15\. Upon the Trace session deactivation, the NEs / Trace data producers
terminate the connection to the Trace data consumer and potentially inform it
that the data collection tasks have been completed and no further data is
expected.
The use case ends upon successful termination of the Trace session and of the
data collection tasks on all NEs.
### 5.2.4 Post-conditions
The data consumer has the necessary data to perform the near-real-time
diagnostics and troubleshooting tasks.
The specific methods for analysing and/or correlating the captured data, as
well as any actions that may be triggered by such analysis are out of scope of
the present use case.
# 6 Potential Requirements
## 6.1 Introduction
The following requirements are potential requirements to be used in the future
normative work (as per recommendations clause). The usage of normative
terminology should not be interpreted as mandatory in the present document.
## 6.2 General Trace requirements
The requirements for the Maximum Level and for the Maximum Without Vendor
Specific Extension Level (as specified in TS 32.421 [2] clause 5.1) are
applicable here.
## 6.3 Requirements for Trace data
The Trace record requirements (as specified in TS 32.421 [2] clause 5.2) for
the following Network Elements and Traceable interfaces are applicable here:
\- e-NodeB: S1-MME, X2, Uu
\- NG-RAN node: NG-C, Xn-C, Uu, F1-C, E1-C
The requirement on Trace Recording Session Reference (as specified in TS
32.421 [2] clause 5.2) is applicable here.
## 6.4 Requirements for Trace activation
The requirements for Trace Session activation and for starting a Trace
Recording Session (as specified in TS 32.421 [2] clause 5.3) are applicable
here.
Potential new requirements are:
REQ-TA-001: It shall be possible to specify the trace reporting method (file-
based vs. non-file based) during Trace Session Activation.
REQ-TA-002: In case of non-file-based trace reporting method being selected,
the data producer shall establish the connection to the data consumer upon
Trace Session Activation and provide data consumer with information about
Trace Session.
## 6.5 Requirements for Trace deactivation
The requirements for Trace Session deactivation and for stopping a Trace
Recording Session (as specified in TS 32.421 [2] clause 5.4) ae applicable
here.
Potential new requirements are:
REQ-TD-001: In case of non-file-based trace reporting, upon the Trace Session
deactivation and end of the currently open Trace Recording Sessions, the data
producer shall terminate connection to the data consumer.
## 6.6 Requirements for Trace data reporting
The following requirements for Trace Data reporting (as specified in TS 32.421
[2] clause 5.5) are applicable in case of non-file-based trace reporting:
Trace records should be generated in each NE where a Trace Session has been
activated and a Trace Recording Session has been started.
Potential new requirements are:
\- REQ-TR-001: In case of non-file-based trace reporting, the same connection
shall be used for the reporting of Trace data under all Trace Recording
Sessions of the same Trace Session.
\- REQ-TR-002: In case of non-file-based trace reporting, a connection from
the data producer to the consumer shall be established and information about
Trace Session shall be provided to the data consumer.
\- REQ-TR-003: In case of non-file-based trace reporting, binary encoding
shall be used for the transfer of all Trace data from data producer to the
data consumer.
\- REQ-TR-004: In case of non-file-based trace reporting, the periodicity and
amount of data in each data burst from data producer to data consumer shall
maintain the data relevance while minimizing the amount of transport overhead
(e.g. buffering at the data producer no longer that 5 seconds).
\- REQ-TR-005: In case of non-file-based trace reporting, the data producer
shall re-establish connection to the data consumer and provide the information
about Trace Session upon unexpected connection termination (e.g. in cases such
as re-start of data producer).
## 6.7 Requirements for Privacy and Security
The following requirements for Privacy and Security (as specified in TS 32.421
[2] clause 5.6) are applicable in case of non-file-based trace reporting:
\- [SET-SEC-1] Keys stored inside eNBs shall never leave a secure environment
within the eNB. When security key(s) transported on control signalling
messages are included in the trace file, the key value(s) shall be removed and
replaced with the value \"Unavailable\".
\- [SET-SEC-2] Keys stored inside NG-RAN node shall never leave a secure
environment within the NG-RAN node. When security key(s) transported on
control signalling messages are included in the trace file, the key value(s)
shall be removed and replaced with the value \"Unavailable\".
Potential new requirements are:
\- REQ-SEC-001: In case of non-file-based trace reporting, the connection
between data producer and data consumer shall provide the data privacy.
\- REQ-SEC-002: In case of non-file-based trace reporting, the connection
between data producer and data consumer shall provide the data integrity.
## 6.8 Requirements for managing MDT
The requirements for managing MDT (as specified in TS 32.421 [2] clause 6) are
applicable in case of non-file-based trace reporting.
Potential new requirements are:
\- REQ-MDT-001: In case of non-file-based trace reporting, binary encoding
shall be used for the transfer of all MDT data from data producer to the data
consumer.
## 6.9 Requirements for managing RLF reports
The requirements for managing RLF and RCEF reports (as specified in TS 32.421
[2] clause 7) are applicable in case of non-file-based trace reporting.
Potential new requirements are:
\- REQ-RLF-001: In case of non-file-based trace reporting, binary encoding
shall be used for the transfer of all RLF and RCEF reports data from data
producer to the data consumer.
NOTE: The format and the encoding details will be specified in TS 32.423 [4].
# 7 Potential Solutions
## 7.1 Solution for non-file-based trace data reporting
### 7.1.1 Architectural considerations
Existing architecture for Management Based and Signaling Based Trace
Activation/Deactivation (as specified in TS 32.421 [2] clause 4.2, figures
4.2.1 and 4.2.2) is applicable in case of non-file-based trace data reporting.
The concept of Trace Collection Entity (as specified in TS 32.421 [2] clause
4.2, figure 4.2.3) may need to be revisited to either generalize the Trace
Collection Entity as supporting both -- file-based and non-file-based trace
reporting or to introduce a new entity -- non-file-based data consumer. In
case of the non-file-based trace reporting, both -- direct reporting by the NE
and reporting via intermediate entity (e.g. Management Function) should be
possible. In such case, the figure 4.2.3 in TS 32.421 [2] may need to be
revised in the following way:
{width="5.326388888888889in" height="3.125in"}
Figure 7.1.1.1: Revised architecture for High-level view of Trace Reporting in
System Context A
As an option for alignment with the new Services Based Management Architecture
(SBMA) introduced in TS 28.533 [8] and further specified in TS 28.532 [7], the
relationship between Network Element as \"non-file-based trace data reporting
MnS\" producer, Management Function as both producer and consumer of this MnS
and data consumer as consumer of this MnS may be represented as:
{width="4.354166666666667in" height="2.2222222222222223in"}
Figure 7.1.1.2: Example of interactions between producers and consumers of
\"non-file-based trace data reporting MnS\"
Yet another option for alignment with SBMA is to represent the legacy Trace
Collection Entity as a trace reporting MnS consumer supporting either file-
based or non-file-based trace reporting. The following figure illustrates this
option:
{width="4.354166666666667in" height="2.2222222222222223in"}
Figure 7.1.1.3: Example showing Trace Collection Entity and Management
Function as consumers of \"trace data reporting MnS\"
### 7.1.2 Solution overview
Proposed solution focuses on the details of interactions between \"non-file-
based trace reporting MnS\" producer and consumer. What entities play the
roles of MnS consumer (e.g. Management Function, control plane function such
as NWDAF or management plane MDAS producer) and MnS producer (e.g. Network
Element or Management Function) is irrelevant and may be illustrated as
various deployment options. Additional deployment options may illustrate
non-3GPP consumers of the 3GPP MnS (e.g. ONAP DCAE).
For the non-file-based trace reporting solution it is proposed to use ASN.1
binary encoded data transmitted using WebSocket protocol [9] over TCP
connection protected by TLS [10]. Figure below illustrates the proposed
protocol stack:
Figure 7.1.2.1: Protocol stack for non-file-based trace reporting
### 7.1.3 Solution interactions
The sequence of interactions between producer and consumer of the \"non-file-
based trace reporting MnS\" is illustrated by the following figure:
{width="6.298611111111111in" height="9.284722222222221in"}
Figure 7.1.3.1: Sequence of interactions between producer and consumer of the
non-file-based trace reporting MnS
{width="5.118055555555555in" height="2.0902777777777777in"}
Figure 7.1.3.2: Detailed interactions of WebSocket connection establishment
1\. The interactions between MnS producer and consumer begin when Management
System activates (configures) the MnS producer with appropriate Trace
measurement control and configuration parameters (e.g. similar to those
specified in sub-clauses of clause 5 in TS 32.422 [3]). The specific details
of this step depend on the outcome of the on-going work on Trace Management in
the context of Services Based Management Architecture and may rely either on
the capabilities of a new Trace Management MnS or re-use the capabilities of
the Provisioning MnS specified in TS 28.532 [7]. An important aspect of this
interaction is that the MnS producer is provided with the trace reporting
method (\"non-file-based trace reporting\") and details of the connection to
the MnS consumer (e.g. IP address, port, connection credentials, URI).
2\. The MnS producer starts a new Trace Session (e.g. according to one of the
sub-clauses of clause 4.1.1 in TS 32.422 [3]).
3\. Upon the Trace Session activation, the MnS producer establishes a new
connection to the MnS consumer (e.g. performs IP address look-up if necessary,
connects to the specified TCP port, performs TLS handshake, starts WebSocket
connection). The details of the WebSocket connection establishment are
illustrated on the Figure 7.1.3.2. As part of the connection establishment the
MnS producer informs MnS consumer about ASN.1 version to be used via
_Configure_ message. The WebSocket Ping frames (see clause 5.5.1 in [9]) may
be used as a keepalive or as means to verify that remote endpoint is still
responsive. In case of abnormal connection termination (e.g. if either MnS
consumer or MnS producer restarts) the MnS producer re-establishes the
connection to the MnS consumer.
3-1. The MnS producer uses the HTTP POST method to provide the MnS consumer
with connection meta-data such as SourceID (MnS producer identifier) and Trace
Session Reference facilitating MnS consumer actions.
3-2. The MnS consumer uses HTTP response to indicate successful reception of
connection meta-data and includes session cookie allowing the connection meta-
data to be associated with the WebSocket.
3-3. The MnS producer uses HTTP GET method to request connection upgrade to
WebSocket. In the request it includes session cookie associating the requested
WebSocket with previously provided connection meta-data, Upgrade header and
WebSocket-specific headers.
3-4. The MnS consumer uses HTTP response to indicate successful upgrade of the
connection to a WebSocket.
NOTE 1: Further communication between MnS producer and MnS consumer (steps 4,
6, 8, 9, 11, 15, 16 and 17 below) uses WebSocket protocol.
4\. Upon establishment of connection between MnS producer and MnS consumer
(either new connection or connection re-establishment), the MnS producer
reports the Trace Session activation event via _StartSession_ message
including the information allowing the MnS consumer to associate the active
connection to the MnS producer with the Trace Session information.
5\. While the Traces Session is active at the MnS producer, it follows the
procedures specified in TS 32.422 [3] clause 4.2 and starts new recording
sessions once \"start\" triggering event (see TS 32.422 [3] clause 5.1) is
detected. For each recording session a Trace Recording Session Reference
(TRSR) is allocated.
6\. Upon starting a new Trace Recording Session, the MnS producer reports this
event to the MnS consumer via _StartRecordingSession_ message.
7\. The MnS producer captures traceable events (signalling messages,
measurements, RLF reports, RCEF reports, UE location information) according
the Trace Session configuration received in step 1. The captured trace records
may be buffered until the reporting condition (e.g. amount of data or
periodicity) is satisfied.
NOTE 2: Whether the reporting condition needs to be standardized, made
configurable or left for implementation is FFS.
8\. When the reporting condition is satisfied (e.g. desired amount of data is
reached, buffer capacity exceeded or reporting timer expired), the MnS
producer sends the captured trace records to the MnS consumer in ASN.1 binary
encoding over the active WebSocket via _Report_ message. The format of the
ASN.1 encoded trace record follows the specification (e.g. new clauses in TS
32.423 [4]).
9\. In cases where the reporting condition is satisfied (reporting timer
expired), but there are no outstanding trace records to report, the MnS
producer sends _IsAlive_ message to the MnS consumer.
10\. Once the \"stop\" triggering event (see TS 32.422 [3] clause 5.1) is
detected by the MnS producer, it stops the Trace Recording Session following
the procedures specified in TS 32.422 [3] clause 4.2.
11\. Upon stopping a Trace Recording Session, the MnS producer reports this
event to the MnS consumer via _StopRecordingSession_ message.
12\. The interaction between MnS producer and consumer ends when Management
System de-activates (configures) the MnS producer. The specific details of
this step depend on the outcome of the on-going work on Trace Management in
the context of Services Based Management Architecture and may rely either on
the capabilities of a new Trace Management MnS or re-use the capabilities of
the Provisioning MnS specified in TS 28.532 [7].
13\. The MnS producer stops the on-going Trace Session (e.g. according to one
of the sub-clauses of clause 4.1.3 in TS 32.422 [3]).
14\. If there are any on-going Trace Recording Sessions, the MnS producer
stops them all.
15\. If there are any outstanding (buffered) trace records, MnS producer
reports them to the MnS consumer via _Report_ message.
16\. Upon stopping a Trace Recording Session, the MnS producer reports this
event to the MnS consumer via _StopRecordingSession_ message.
17\. Upon stopping the Trace Session, the MnS producer reports this event to
the MnS consumer via _StopSession_ message.
18\. MnS producer terminates the connection to MnS consumer (closes WebSocket,
closes TLS and TCP connections).
### 7.1.4 Solution protocol definition
An example of ASN.1 encoded non-file-based trace reporting messages (partially
addressing NG-RAN node trace reporting) is included below:
\--
****************************************************************************
\-- Non-file-based trace reporting protocol definition
\-- Draft ver. 0.0.1
\-- Encoding: ASN1 aligned PER
\--
****************************************************************************
TraceProtocol DEFINITIONS AUTOMATIC TAGS ::=
BEGIN
TraceMessage ::= CHOICE {
configure Configure,
alive IsAlive,
startSession StartSession,
stopSession StopSession,
startRecordingSession StartRecordingSession,
stopRecordingSession StopRecordingSession,
report Report,
...
}
\--
****************************************************************************
\-- Configure msg
\-- Used to convey the ASN.1 protocol version
\--
****************************************************************************
Configure ::= SEQUENCE {
nodeType NodeTypeId,
version Version,
futureExtension SEQUENCE {}
}
\--
****************************************************************************
\-- IsAlive msg
\-- Used for periodic keepalive at the protocol level
\--
****************************************************************************
IsAlive ::= SEQUENCE {
nodeType NodeTypeId,
timestamp UTC-Timestamp,
futureExtension SEQUENCE {} OPTIONAL
}
\--
****************************************************************************
\-- StartSession msg
\-- Used for reporting the start of Trace Session event
\--
****************************************************************************
StartSession ::= SEQUENCE {
seqNum SequenceNumber,
sourceId SynchronizationSourceId,
nodeType NodeTypeId,
traceReference TraceReference,
cellId NRCGI OPTIONAL,
timestamp UTC-Timestamp,
sessionConfig SessionConfig,
futureExtension SEQUENCE {} OPTIONAL
}
\--
****************************************************************************
\-- StopSession msg
\-- Used for reporting the stop of Trace Session event
\--
****************************************************************************
StopSession ::= SEQUENCE {
seqNum SequenceNumber,
sourceId SynchronizationSourceId,
nodeType NodeTypeId,
traceReference TraceReference,
cellId NRCGI OPTIONAL,
timestamp UTC-Timestamp,
futureExtension SEQUENCE {} OPTIONAL
}
\--
****************************************************************************
\-- StartRecordingSession msg
\-- Used for reporting the start of Trace Recording Session event
\--
****************************************************************************
StartRecordingSession ::= SEQUENCE {
seqNum SequenceNumber,
sourceId SynchronizationSourceId,
nodeType NodeTypeId,
traceReference TraceReference,
traceRecordingSessionRef TraceRecordingSessionRef,
cellId NRCGI OPTIONAL,
recordInitSeqNum SequenceNumber,
timestamp UTC-Timestamp,
futureExtension SEQUENCE {} OPTIONAL
}
\--
****************************************************************************
\-- StopRecordingSession msg
\-- Used for reporting the stop of Trace Recording Session event
\--
****************************************************************************
StopRecordingSession ::= SEQUENCE {
seqNum SequenceNumber,
sourceId SynchronizationSourceId,
nodeType NodeTypeId,
traceReference TraceReference,
traceRecordingSessionRef TraceRecordingSessionRef,
cellId NRCGI OPTIONAL,
recordEndSeqNum SequenceNumber,
timestamp UTC-Timestamp,
futureExtension SEQUENCE {} OPTIONAL
}
\--
****************************************************************************
\-- Report msg
\-- Used for reporting the captured Trace records
\--
****************************************************************************
Report ::= SEQUENCE {
seqNum SequenceNumber,
sourceId SynchronizationSourceId,
nodeType NodeTypeId,
traceReference TraceReference,
cellId NRCGI OPTIONAL,
recordingSessionReportList RecordingSessionReportList OPTIONAL,
futureExtension SEQUENCE {} OPTIONAL
}
\--
****************************************************************************
\-- Types
\--
****************************************************************************
NOTE: Further protocol details (e.g. such as type definitions) are FFS
### 7.1.5 Solution deployment examples
#### 7.1.5.1 Example of 3GPP deployment with NWDAF
The following figure illustrates deployment scenario where NG-RAN node
produces, and NWDAF consumes non-file-based trace reporting MnS under control
of 3GPP Management System:
{width="6.298611111111111in" height="9.534722222222221in"}
Figure 7.1.5.1.1: Example deployment scenario of NG-RAN node producing and
NWDAF consuming non-file-based trace reporting MnS under control of 3GPP
Management System
#### 7.1.5.2 Example of ONAP deployment
The following figure illustrates ONAP deployment scenario where NG-RAN node
produces, and ONAP DCAE consumes non-file-based trace reporting MnS under
control of ONAP Controller:
{width="6.694444444444445in" height="7.986111111111111in"}
Figure 7.1.5.2.1: Example deployment scenario of NG-RAN node producing and
ONAP DCAE consuming non-file-based trace reporting MnS under control of ONAP
Controller (part 1)
{width="6.6875in" height="4.993055555555555in"}
Figure 7.1.5.2.2: Example deployment scenario of NG-RAN node producing and
ONAP DCAE consuming non-file-based trace reporting MnS under control of ONAP
Controller (part 2)
# 8 Conclusions and recommendations
The study has investigated the opportunities for new trace reporting methods
such as non-file-based Trace reporting, a.k.a. streaming Trace.
The study identified and documented use cases for collecting Cell and UE data
for analytics, and for Collecting subscriber and equipment trace data for
near-real-time diagnostics and troubleshooting. It established that enabling
the capabilities for trace data to be delivered to the consumer(s) while it\'s
still relevant to the analytics, diagnostics and troubleshooting tasks
performed by the consumer is important.
The study derived and documented potential requirements to be considered in
the normative work.
The study documented and evaluated potential solutions in various deployment
scenarios.
It is recommended to do normative work enabling the use of non-file-based
Trace reporting (a.k.a. streaming Trace) in 3GPP Rel-16 management.
It is recommended that the normative work includes documenting new
requirements and use cases in TS 32.421 [2], new Trace control and
configuration management aspects in TS 32.422 [3], and new Trace data encoding
format in TS 32.423 [4].
It is recommended to consider the use of non-file-based Trace reporting
(a.k.a. streaming Trace) for 5G MDT feature in collaboration with 3GPP RAN
workgroups.
#
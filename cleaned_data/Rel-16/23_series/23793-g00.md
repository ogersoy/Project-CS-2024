# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The purpose of this document is to study how the 5G System (5GS) can be
extended in order to support Access Traffic Steering, Switching and Splitting
(ATSSS) between 3GPP and non-3GPP access networks. In particular, this
document considers solutions that specify the following:
\- How the 5GC and the 5G UE can support multi-access traffic steering (as
defined in clause 3.1) between 3GPP and non-3GPP accesses.
\- How the 5G Core network and the 5G UE can support multi-access traffic
switching (as defined in clause 3.1) between 3GPP and non-3GPP accesses. This
includes the conditions that can trigger the switching of data traffic to a
new access type.
\- How the 5G Core network and the 5G UE can support multi-access traffic
splitting (as defined in clause 3.1) between 3GPP and non-3GPP accesses (multi
access PDU session). This includes the conditions that can trigger the
splitting of data traffic across multiple accesses.
\- How the multi-access traffic steering, switching and splitting (ATSSS) can
be taken into account by the charging framework in order e.g. to enable the
network operator to differentiate charging for data traffic that is switched
and/or split between 3GPP and non-3GPP accesses.
\- How the policy framework can be extended in order to support the
requirements for ATSSS.
\- How ATSSS can be supported by using multi-access PDU sessions (as defined
in clause 3.1). ATSSS solutions not requiring multi-access PDU sessions can
also be considered.
\- How to handle issues related to ATSSS that may occur when the UE moves
between EPC and 5GC.
The scope of this document excludes the following aspects:
\- Changes to the charging framework are not considered. However, it may be
considered what information needs to be provided to the charging framework in
order to charge traffic that is switched and/or split between 3GPP and
non-3GPP accesses.
\- ATSSS procedures that may be applied in the NG-RAN are not considered. The
study is restricted only to ATSSS procedures applied in the 5G core network.
\- 5GS enhancements to support trusted non-3GPP access networks are not
considered.
\- 5GS enhancements to support wireline access networks are not considered.
All solutions in this document should be based on and aligned with the 5GS
Phase-1 normative work including work on policy management, as documented in
TS 23.501 [5], TS 23.502 [6] and TS 23.503 [7].
The study in this document is organized into two phases:
\- Initially, the study considers ATSSS solutions that enable traffic
selection, switching and splitting between NG-RAN and untrusted non-3GPP
access networks.
\- Subsequently, after the 5GS architecture is enhanced to support trusted
non-3GPP access networks, the study will also consider ATSSS solutions that
enable traffic selection, switching and splitting between NG-RAN and trusted
non-3GPP access networks.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[3] IEEE Std 802.11-2012: \"IEEE Standard for Information technology -
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
[4] 3GPP TS 23.139: \"3GPP system - fixed broadband access network
interworking\".
[5] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[6] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[7] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System;
Stage 2\".
[8] IETF RFC 6824: \"TCP Extensions for Multipath Operation with Multiple
Addresses\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[9] IETF RFC 1928: \"**SOCKS Protocol Version 5\".**
[10] draft-ietf-tcpm-converters-04: \"0-RTT TCP Convert Protocol\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[11] 3GPP TS 38.215: \"Physical layer measurements\".
[12] 3GPP TS 38.300: \"NR and NG-RAN Overall Description\".
[13] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) Overall
Description\".
[14] IETF RFC 1323: \"TCP Extensions for High Performance\".
[15] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[16] IETF RFC 7829: \"SCTP-PF: A Quick Failover Algorithm for the Stream
Control Transmission Protocol\".
[17] IETF RFC 3758: \"Stream Control Transmission Protocol (SCTP) Partial
Reliability Extensions\".
[18] IETF RFC 5681: \" TCP Congestion Control\".
[19] IETF RFC 5348: \"TCP Friendly Rate Control (TFRC): Protocol
Specification\".
[20] IETF RFC 4340: \"Datagram Congestion Control Protocol (DCCP)\".
[21] IETF RFC 2890: \"Key and Sequence Number Extensions to GRE\".
[22] 3GPP TR 23.716: \"Study on the Wireless and Wireline Convergence for the
5G system architecture\".
[23] draft-ietf-quic-transport-16: \"QUIC: A UDP-Based Multiplexed and Secure
Transport\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[24] draft-ietf-quic-recovery-16: \"QUIC Loss Detection and Congestion
Control\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[25] draft-pauly-quic-datagram-00: \"An Unreliable Datagram Extension to
QUIC\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[26] IETF RFC 7413: \"TCP Fast Open\".
[27] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
nodes\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TS 23.501 [5] and the following apply.
**Access Traffic Steering** : The procedure that selects an access network for
a new data flow and transfers the traffic of this data flow over the selected
access network. Access traffic steering is applicable between 3GPP and
non-3GPP accesses.
**Access Traffic Switching** : The procedure that moves all traffic of an
ongoing data flow from one access network to another access network in a way
that maintains the continuity of the data flow. Access traffic switching is
applicable between 3GPP and non-3GPP accesses.
**Access Traffic Splitting** : The procedure that splits the traffic of a data
flow across multiple access networks. When traffic splitting is applied to a
data flow, some traffic of the data flow is transferred via one access and
some other traffic of the same data flow is transferred via another access.
Access traffic splitting is applicable between 3GPP and non-3GPP accesses.
**Multi-Access PDU Session** : A PDU session whose traffic can be sent over
3GPP access, or over non-3GPP access, or over both accesses.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1], TS 23.501 [5], TS 23.502 [6], TS 23.503 [7] and the following apply. An
abbreviation defined in the present document takes precedence over the
definition of the same abbreviation, if any, in TR 21.905 [1].
ATSSS Access Traffic Steering, Switching and Splitting
AT3SF Access Traffic Steering, Switching and Splitting Function
MA-PDU Multi-Access Packet Data Unit
TFCP Traffic Flow Control Protocol
# 4 Architectural requirements and assumptions
## 4.1 Architectural requirements
## 4.2 Architectural assumptions
# 5 Key issues
## 5.1 Key issue#1: Overall Architecture for traffic
Steering/switching/splitting between Multiple Accesses
### 5.1.1 Descriptions: User plane aspects
This KI addresses the overall User plane architecture including the potential
impacts to NF (e.g. UPF) and to interfaces (e.g.N4), etc., including following
points:
1\. Should the same access be used to send a data flow DL and to send the same
data flow UL? Should a data flow use the same access UL and DL?
2\. What is the granularity with which traffic can be split (per SDF / per IP
flow / per packet etc.)? What are the impacts of the split granularity to the
entities handling the User Plane?
3\. Whether the UE, the network or both can decide to switch / split / steer a
data flow across 3GPP access and non-3GPP access?
4\. If the network can take decisions to steer/ switch/split DL Data flows,
what information does it need to take proper decision. How can this
information be provided to the NF taking decisions to steer/ switch/split DL
Data flows?
5\. Are there any impacts between UP transport related with ATSSS and QoS
enforcement in 5GC?
6\. When a data flow has been switched or split, can this have impact on the
dataflow integrity? (data loss and disordering).
7\. Whether and how the service continuity or the service interruption is
considered/guaranteed when performing steering or switching or splitting?
### 5.1.2 Descriptions: Control Plane aspects
The control plane aspects in the overall architecture for traffic
steering/switching/splitting comprise:
\- If all or some ATSSS rules need to be sent to the UE, whether they are sent
via NAS or via user plane. In other words, is it needed to update some ATSSS
rules frequently during the life of a PDU session?
\- If it is deemed useful that traffic steering/switching/splitting decisions
are taken independently for uplink and downlink, whether the measurement
reports from the UE to the network (for downlink traffic
steering/switching/splitting decisions by the network) should use control
plane (i.e. NAS) or user plane.
## 5.2 Key Issue#2: Steering between Multiple Accesses
### 5.2.1 Descriptions
1\. What are the criteria used by the UE or by the network to take a steering
decision on a data flow?
NOTE: The architecture on how to provide ATSSS policies from the network to
the UE is studied as part of another KI.
2\. Should the PCF be informed of the steering decision? If yes, what
information should be provided to the PCF?
3\. Should the charging framework be informed of the steering decision? If
yes, what information should be provided to the charging framework for
enabling appropriate charging?
4\. What is the relationship between ATSSS steering policy and other UE
policies e.g. URSP?
## 5.3 Key Issue#3: Switching between Multiple Accesses
### 5.3.1 Descriptions
1\. What are the criteria used by the UE or by the network to take a switching
decision on a data flow?
NOTE: The architecture on how to provide ATSSS policies from the network to
the UE is studied as part of another KI.
2\. How does the network trigger the switching decision for existing DL data
flows?
3\. Should the PCF be informed of the switching decision? If yes, what
information should be provided to the PCF?
4\. Should the charging framework be informed of the switching decision? If
yes, what information should be provided to the charging framework for
enabling appropriate charging?
## 5.4 Key Issue#4: Splitting Over Multiple Accesses
### 5.4.1 Descriptions
1\. What are the criteria used by the UE (including CPE) or by the network to
take a splitting and restoring decision?
NOTE: The architecture on how to provide ATSSS policies from the network to
the UE is studied as part of another KI.
2\. Should the PCF be informed of the splitting decision? If yes, what
information should be provided to the PCF?
3\. Should the charging framework be informed of the splitting decision? If
yes, what information should be provided to the charging framework for
enabling appropriate charging?
4\. How can the ATSSS traffic spliting solution interwork with application
layer solutions for traffic splitting?
## 5.5 Key Issue#5: Multi-access PDU sessions (Un-trusted access)
### 5.5.1 Descriptions
This KI aims at studying multi-access PDU sessions i.e. PDU sessions that may
simultaneously use a 3GPP and a N3GPP access. The KI will study:
1\. Can a non-IP session type PDU sessions take advantage of the multi-access
PDU session feature? If yes when? (the Ethernet and the Unstructured PDU
session types could correspond to different answers)
2\. How can the UE and the network negotiate the support of multi-access PDU
session? Is the multi-access PDU session subject to subscription?
3\. The signalling procedure for establishing/modifying/terminating a multi-
access PDU session: e.g.
a. How can the UE or network add / remove an access (\"leg\") to a multi-
access PDU session (How to extend a single-access PDU session to make a multi-
access PDU session / How to turn a multi-access PDU session back into a
single-access one)?
NOTE: Considering the case where the UE is using both (3GPP / N3GPP) accesses
when establishing the PDU session and the case where it gets usage of a second
(3GPP / N3GPP) access after having established the PDU session.
b. How to modify a multi-access PDU session?
c. How to release a multi-access PDU session?
4\. Which of the UE and of the network can decide on the mapping between UE\'s
IP flows and UE\'s serving access legs?
a. How can the mapping between data (e.g. IP) flows and access legs be
negotiated between the UE and the 5GC?
5\. Any potential impacts of multi-access PDU session on UPF selection.
6\. Any relationship between multi-access PDU session and slicing.
7\. Any relationship between multi-access PDU session and roaming including
following cases:
a. The 3GPP access and non-3GPP access are located in the same PLMN, and
b. the 3GPP access and non-3GPP access are located in the different PLMNs.
8\. Whether multi-homing is supported for a multi-access PDU session? And if
yes, how should multi-homing be operated for a multi-access PDU session?
9\. Whether Usage of an UL Classifier is supported for multi-access PDU
Session? And if yes, how should the PDU session with UL Classifier be operated
for a multi-access PDU session, e.g. whether the UL Classifier should be
inserted to the two accesses of the PDU Session or only one of the two
accesses of the PDU Session?
10\. What happens to a multi access PDU session in scenarios of interworking
with EPC (e.g. when the UE moves to EPC during the interworking scenario )?
This includes:
a. How can a PDN connection over EPC that is moved to 5GC benefit from the
multi-access PDU session feature when moved to 5GC?
b. Considering UE is in single-registration mode and the UE in dual-
registration mode.
NOTE: The content of the ATSSS policies is studied in other KI.
## 5.6 Key Issue #6: Key issue on differentiation of 3GPP RATs in ATSSS rule
### 5.6.1 Descriptions
In EPS, when a UE has multi-access PDN connection, NBIFOM routing rule is used
to select an access network to send traffic. In the routing rule access type
is defined 3GPP access or non-3GPP access. This restricts the ability for the
operator to provide policies that favour a specific 3GPP RAT over another one
with respect to the non-3GPP preference.
This key issue studies whether and how to provide relative priorities for 3GPP
RATs with respect to the non-3GPP access in ATSSS rule.
# 6 Solutions
## 6.1 Solution 1: Proposed architecture framework for ATSSS
In terms of architecture requirements for this solution, the proposed ATSSS
architecture framework:
1\. Shall support untrusted non-3GPP access, NG-RAN and E-UTRAN. GERAN and
UTRAN are not supported. As part of untrusted non-3GPP access, WLAN access
shall be supported.
2\. Shall support simultaneous connections of an UE via multiple access
technologies.
3\. Shall support separation of control and user plane functions.
4\. Shall support IP (IPv4 & IPv6) and Ethernet PDU session types.
5\. Shall reuse and align with Release 15 architecture, reference points and
functional capabilities in 5GS as stated in TS 23.501 [5] and the procedures
as stated in TS 23.502 [6] as much as possible.
6\. Shall support roaming. As part of roaming, the architecture shall support
both local breakout and home routing scenarios.
7\. Remote host resides at DN (beyond N6) is not aware of traffic steering,
switching and splitting operations in 5GS.
8\. May support traffic usage reports from UE and ATSSS user plane entity to
the ATSSS control plane of the core network to enable ATSSS control plane to
get an end-to-end view of traffic performance over multiple access networks in
order to dynamically manage ATSSS operations over these accesses.
NOTE: Network that support ATSSS can continue to provide ATSSS functionality
if traffic usage report is not provided by UE and ATSSS user plane entity.
Figure 6.1-1 depicts the initial high level ATSSS architecture for the non-
roaming case.
Figure 6.1-1: Initial high level view of non-roaming ATSSS architecture
The following Figure 6.1-2 depicts the ATSSS roaming architecture in the case
of LBO with N3IWF in the same PLMN as 3GPP access (assumed AF resides in
VPLMN).
Figure 6.1-2: Roaming ATSSS architecture - LBO scenario with N3IWF in same the
PLMN as 3GPP access (assuming AF resides in VPLMN)
The following Figure 6.1-3 depicts the ATSSS roaming architecture in the case
of HR with N3IWF in the same PLMN as 3GPP access.
Figure 6.1-3: Roaming ATSSS architecture - HR scenario with N3IWF in same the
PLMN as 3GPP access
### 6.1.1 General
This solution supports Multi-Access (MA PDU). A MA PDU is a type of PDU
session that allows application to send/receive traffic either over 3GPP
access, or non-3GPP access, or both accesses simultaneously. A MA PDU session
comprises of a PDU session over 3GPP access and a \"linked\" PDU session over
non-3GPP access, or vice versa. Each of the PDU sessions may have its own set
of UPFs, but both PDU sessions share a common PDU session anchor (PSA) as
shown in Figure 6.1.1-1**.** For MA PDU session, applications in UE and the N6
host server are not aware of traffic split across multiple accesses.
Editor\'s note: Support for UL CL and multi-homing in (optional) intermediate
UPF is FFS.
Figure 6.1.1-1: MA PDU session
The PDU session and linked PDU session of a MA PDU session share the following
attributes:
1\. DNN.
2\. SSC mode.
3\. S-NSSAI.
4\. PDU session type (IPv4, IPv6 or Ethernet).
5\. IP address (for IPv4 and IPv6 PDU session type).
### 6.1.2 Functional Description
The ATSSS architecture contains the following functional elements:
\- User Data Repository for Access Traffic Steering Switching and Splitting
Function (UDR-AT3SF)
UDR AT3SF holds UE ATSSS subscription data for operator service and user
profiles. This functionality is supported by the UDR in 5GS.
\- Policy Control Access Traffic Steering Switching and Splitting Function
(PC-AT3SF)
PC-AT3SF defines ATSSS policies according to the application-specific
information provided by the AF (via N5), access information/notification
provided by the AMF (via N15), UE ATSSS subscription and user profiles
provided by the UDR-AT3SF (via N25), network local policy or any combination
of them. The PC AT3SF may also take input from Network Data Analytics (NWDA)
into consideration to generate or modify ATSSS policies. The PC-AT3SF can
provide ATSSS rules to UE-ATS3F as described in clause 6.1.4.
\- Session Management Access Traffic Steering Switching and Splitting Function
(SM-AT3SF)
SM-AT3SF is the main control plane function of the ATSSS architecture which is
supported by the SMF. It is responsible for ATSSS policy enforcement and
session management of all PDU sessions between 5GC and UE. SM-AT3SF can
receive the ATSSS policies from PC-AT3SF via N7 and generates ATSSS rules to
control the behaviour of ATSSS traffic by conveying ATSSS rules to UP-AT3SF
over N4. SM-AT3SF may also receive access link information (e.g. access
restriction, mobility status) from the AMF for all access legs as inputs to
manage ATSSS behaviour. The SM-AT3SF can provide ATSSS PDU session related
policies to UE-ATS3F during PDU session establishment and PDU session
modification, as well as receive traffic usage reports from the UE and SM-
AT3SF for dynamic ATSSS operations. Based on the traffic usage reports, SM-
AT3SF may send commands (e.g., change access or access forbidden) to UE-AT3SF
and UP-AT3SF via N1 and N4, respectively to optimise ATSSS behaviour.
\- User Plane Access Traffic Steering Switching and Splitting Function (UP-
AT3SF)
UP AT3SF has a data plane component (UPu-AT3SF) and a control plane component
(UPc-AT3SF). UPu-AT3SF is supported by PDU session anchor representing the UP
anchor point for all ATSSS traffic and presents a single IP address towards DN
via N6. It is responsible for ATSSS policy rule enforcement in the UP of the
core network.
UPc-AT3SF requests, receives and processes traffic usage reports from the UE
(if available) as indicated by the SM-AT3SF via N4. It is responsible for
setting up the multi access connectivity through UPu-AT3SF and
steering/splitting the traffic over available accesses based on path quality
estimation, network access measurement reports and network policies provided
by the SM-AT3SF via N4 interface.
\- UE Access Traffic Steering Switching and Splitting Function (UE-AT3SF)
ATSSS policy rule enforcement at the UE for UE-initiated traffic (UL). It may
also generate traffic reports to be sent to the SM-AT3SF at the request of
UPc-AT3SF.
In order to support ATSSS, it is essential that UDR AT3SF, PC-AT3SF, SM AT3SF
and UP AT3SF are supported by UDR, PCF, SMF and UPF respectively in 5GS. ATSSS
capability may be discovered during initial PDU Session Establishment and
inter-PLMN mobility procedures where these network functions indicate its
support. If one of these network functions indicates no support for ATSSS
capability, corresponding PDU session will not have ATSSS support.
### 6.1.3 MA PDU and URSP
In Rel-15, UE is responsible for establishing new PDU session(s) based on URSP
provided by the network (PCF) and/or preconfigured in the UE as described in
TS 23.503 [7] clause 6.6.2. As such, URSP provides SDF level steering
capability for UE to establish new PDU session(s) over the preferred access
network based on traffic descriptor and rule precedence.
As shown in Figure 6.1.3-1, the URSP approach can be extended to support MA
PDU session in the UE. This can be done by adding a new field in the _Route
Selection Descriptor_ to specify what kind of PDU session (PDU or MA PDU)
should be established for the matching application (see Table 6.1.3-1).
Figure 6.1.3-1: URSP can be extended to support for MA PDU session type. In
this example, UE will establish regular PDU session(s) for App1 & 3, and MA
PDU session for App 2
Table 6.1.3-1: URSP Rule (from TS 23.503 [7] table 6.6.2-1)
* * *
Information name Description Category PCF permitted to modify in a UE context
Scope
**Rule Precedence** Determines the order the URSP rule is enforced in the UE.
Mandatory\ Yes UE context (NOTE 1)
Traffic descriptor _This part defines the traffic descriptors for the policy_
Application identifiers Application identifier(s) Optional
IP descriptors IP 3 tuple(s) (destination IP address or IPv6 network prefix,
destination port number, protocol ID of the protocol above IP) Optional Yes UE
context
Non-IP descriptors Descriptor(s) for non-IP traffic Optional Yes UE context
**Route Selection descriptor** The components for Route selection (see table
6.6.2-2) Mandatory
NOTE 1: Rules in a URSP shall have different precedence values.
* * *
Table 6.1.3-2: Extension of Route Selection Descriptor (from TS 23.503 [7]
table 6.6.2-2) to support MA PDU
* * *
Information name Description Category PCF permitted to modify in a UE context
Scope
**Route selection components** _This part defines the route selection
components_ Mandatory\  
(NOTE 1)
SSC Mode Selection Optional Yes UE context
Network Slice Selection Optional Yes UE context
DNN Selection Optional Yes UE context
Non-seamless Offload indication Indicates if the traffic of the matching
application is to be offloaded to non-3GPP access outside of a PDU Session.
Optional Yes UE context
Access Type preference Indicates the preferred Access Type (3GPP or non-3GPP)
when the UE establishes a PDU Session for the matching application. Optional
Yes UE context
PDU Session Type Indicates whether PDU or MA PDU session should be established
Optional Yes UE context
NOTE 1: At least one of the route selection component shall be present.
* * *
### 6.1.4 Architecture Description
The interactions between AT3SF\'s of UE, UPF, SMF and PCF are shown in Figure
6.1.4-1.
Figure 6.1.4-1: Interaction between AT3SF\'s of UE, SMF, PCF & UPF
5GS can implement ATSSS for MA PDU session according to PCF policy, user
preference settings and link performance of 3GPP & non-3GPP access networks as
shown in Figure 6.1.4-1. clause 6.1.3 already describes SDF level traffic
steering in URSP to enable a UE to identify the need of MA PDU session based
on Traffic Descriptor.
When MA PDU session is invoked by the UE, further traffic steering, switching
and splitting policy can be provided by the PC-AT3SF to SM-AT3SF during MA PDU
session establishment. SM-AT3SF is responsible for mapping the policy into
ATSSS configurations towards the UE-AT3SF (via N1) and UP-AT3SF (via N4). The
SM-AT3SF may also consider local configuration when deriving ATSSS
configurations. Based on these configurations, the UE and UPF/PSA can
determine the appropriate access networks to use for ATSSS operations. Some
examples of ATSSS configurations provided by SM AT3SF can be shown as follows:
\- Load balance - traffic is split over both accesses for equal or weighted
distribution.
\- Hot-standby - traffic is steer to the least cost access (e.g. WLAN) and
switch to the other access when the least cost access is no longer available
or its link condition falls below certain performance thresholds based on for
example link quality, throughput, latency, packet loss, etc.
\- Top up - traffic is steer to least cost access (e.g. WLAN) and if needed
split across both accesses when the performance criteria of the least cost
access falls below certain performance thresholds based on for example link
quality, throughput, latency, packet loss, etc.
\- Least loaded - traffic is steer to the least loaded access and switch to
the other access when the least loaded access is no longer available or its
link condition falls below certain performance thresholds based on for example
link quality, throughput, latency, packet loss, etc.
\- Best performance - traffic is steer to the best performing access based on
traffic measurements and switch to the other access the best performing access
is no longer available.
Based on ATSSS configurations provided by the SM-AT3SF and optionally user
preference settings, the UE-AT3SF derives the ATSSS rules for MA PDU session
data in the UL direction. Similarly, the UP-AT3SF derives the ATSSS rules for
MA PDU session data in the DL direction based on ATSSS configurations received
from SM-AT3SF.
Editor\'s note: The mapping of ATSSS configurations to ATSSS rules in UE-AT3SF
and UP-AT3SF are FFS.
Editor\'s note: The enforcement of ATSSS rules in UE-AT3SF and UP-AT3SF to
support traffic splitting is FFS.
### 6.1.5 Procedures
#### 6.1.5.1 Multi Access PDU Session Establishment Procedure
In this case, theMA-PDU is using two child PDU sessions which are established
with two separate PDU session establishment procedures as it is shown in
clause 6.2.2.1. At the completion of the first PDU session setup the UE is
also provided with the IP address of the UPFc-AT3SF.
Once the multi-access PDU connectivity is setup or when the UE detects changes
in the link status (the link is up or down or IP address change, etc.) the
user plane configuration is setup between UE and UPF-AT3SF as detailed in
clause 6.1.5.2.
NOTE: The details of the communications between the UE and UPF-AT3SF are FFS.
#### 6.1.5.2 User Plane Configuration between UE-AT3SF and UPu-AT3SF
The user plane configuration procedure consists of the following key steps
detailed in Figure 6.1.5.2-1.
The procedure may be either terminal or network initiated and it follows Steps
1-23 in Figure 6.1.5.1-1 for setting up a MA-PDU.
{width="6.677777777777778in" height="5.011805555555555in"}
Figure 6.1.5.2-1: AT3SF Control Procedure for UP Configuration
Once the UE-AT3SF sets up multi-access PDU connectivity or when it detects
changes in the link status (the link is up or down or IP address change, etc.)
it sends a AT3SF_RECONFIG_REQ message to setup/release/update the multi access
session. The message should include the following information:
1\. Session Identifier: an unique identifier of the session.
2\. Action Type (eg. Setup, Release, Update).
3\. Link information including:
a. IP address of the connection.
b. Connection Type (eg. NR, WLAN, etc.).
UPc-AT3ASF is responsible in setting up the user plane protocol to be used in
between the UPu-TA3SF and UE-AT3SF and it informs the UE-AT3SF client of the
user plane protocols to setup at the client and the parameters to be used in
connecting to the UPu-AT3SF.
Each instance of the UPu-AT3SF is responsible for one anchor connection. The
AT3SF_UP_SETUP_CONFIG_REQ message is used to create one or more UPu-AT3SF
instances and it includes the following parameters:
1\. Anchor Connection ID (eg. IP address or other identifier for one end point
of the connection).
2\. Convergence Method: e.g. Loose Aggregation, GRE Aggregation, MP-TCP Proxy,
MP-QUIC Proxy, etc.
In Loose Aggregation packets of the same QoS Flow may be sent over both
accesses without the need of packet reordering at the receiving side.
3\. Convergence Method Parameters: Proxy IP Address, Proxy IP Port(s).
4\. Delivery Connection(s): Connection ID, Connection Type (eg. NR, WLAN,
etc.), Transport Method (eg UDP tunnel, IPSec Tunnel with NULL encryption,
etc.), Transport Method Parameters (eg. Tunnel endpoint IP address and port).
For example when NR and WLAN are two user plane accesses, UPc-AT3ASF may
convey to the UE-AT3ASF that IPSec with NULL encryption needs to be setup as a
transport method between the UE-AT3ASF and UPu-AT3ASF.\ When the anchor does
not need to provide traffic aggregation over multiple accesses with strict in
order packet delivery, no Transport Method needs to be specified.
When the UP setup configuration indicates MP-TCP Proxy as the Convergence
Method, then the request maust include the IP address and port number of the
MP-TCP proxy.
Once the UP protocols are configured UE-AT3ASF informs the UPc-AT3ASF using
the AT3ASF_UP_SETUP_CONFIG_CNF message. This message contains:
1\. Session Identifier.
2\. Convergence Method.
3\. Delivery Connection(s).
##### 6.1.5.2.1 AT3SF Session Termination Procedure
This procedure may be initiated either by the terminal(UE-AT3SF) or the
network (UPc-AT3SF) by either one of the peers sending
AT3SF_SESSION_TERMINATE_REQ to the other peer. The receiving peer shall
acknowledge the termination with a AT3SF_SESSION_TERMINATE_RESP message. The
two messages shall contain the session ID and the reason of termination.
#### 6.1.5.3 Access Measurement Report Procedure
Editor\'s note: The use of the access metrics at the UPc-AT3SF is FFS.
Measurement reports may be delivered, on request from the network (UPc-AT3SF)
when certain threshold levels for the value of the measurements are reached.
The UPc-AT3SF configures the UE-AT3SF with regard to the type of measurements
to be executed as indicated in Figure 6.1.5.2.-1.
{width="5.063194444444444in" height="4.3125in"}
Figure 6.1.5.3-1: UE-AT3SF Measurement configuration and reporting procedure
What information should be included in the traffic reports and how they are
measured?
UPc-AT3SF configures UE-AT3SF with the different parameters (e.g. radio link
information) and the associated thresholds at which the reports shall be
generated. The AT3SF_MEAS_CONFIG contains the Connection type (e.g. WLAN,
5G-NA, etc.) and a set of parameters specific to each connection type and a
timer value during which the measured values should fulfil the threshold
conditions before the measurement report.
When the connection type is 5G-AN the following threshold parameters may be
provided:
a. The RSRP threshold (in dBm), both low and high;
b. The RSRQ threshold (in dBm), both low and high.
When the connection type is WLAN the following threshold parameters may be
provided:
a. The WLAN channel utilization (BSS load) threshold, both low and high.
b. The downlink backhaul available bandwidth threshold, both low and high.
c. The uplink backhaul available bandwidth threshold, both low and high.
d. The beacon RSSI threshold, both low and high.
Each measurement report (AT3SF_MEAS_REPORT) includes the connection type
together with a set of measured parameters.
When the connection type is 5G-AN the measured parameters are:
a. The RSRP value (in dBm) of serving 5G-AN;
b. The RSRQ value (in dBm) of serving 5G-AN.
When the connection type is WLAN the following threshold parameters may be
provided:
a. The WLAN channel utilization (BSS load).
b. The downlink backhaul available bandwidth.
c. The uplink backhaul available bandwidth.
d. The average beacon RSSI.
#### 6.1.5.4 Round Trip Time (RTT) Evaluation Procedure
This procedure is executed under the control of the UPc-AT3SF on the access
for which RTT is to be evaluated. The UPc-AT3SF sends a PING_REQ to the
terminal over the chosen access. The terminal device is expected to answer as
soon as possible with a PING_REQ that carries the same identifier that was
received in the PING_REQ. On the receive of the PING_RESP, the UPc-AT3SF
determines the updated value of the RTT of the associated link. The procedure
to determine the updated value of the UPc-AT3SF it is left to the UPc-AT3SF
implementation. The RTT evaluation procedure is described in Figure 6.1.5.4-1.
It is left to implementation the type of QoS to be applied to the messages
being used.
{width="6.677777777777778in" height="4.290972222222222in"}
Figure 6.1.5.4-1: UE-AT3SF RTT evaluation procedure
### 6.1.6 Control Plane Protocol Stack between UE-AT3SF and UPc-AT3SF
The connection between the UE-AT3SF and the UPc-AT3SF is assumed to be secure
over both non-3GPP access as well as over the 3GPP access. Multi Access
Control Management (MACM) is responsible to implement the exchange of control
plane messages between the UE-AT3SF and UPc-AT3SF.
The following protocol stack is used for the control message exchange between
UE-AT3SF and the UPc-AT3SF. The messages are carried over UDP in IP between
MACM on UE-AT3SF and UPc-AT3SF as it is shown in Figure 6.1.3-1 independent of
the access ( 5G-AN, non-3gpp access, etc.).
{width="6.479861111111111in" height="2.34375in"}
a: UDP based Control Plane Protocol Stack over non-3GPP access
{width="5.9375in" height="2.5256944444444445in"}
b: UDP based Control Plane Protocol Stack over 5G-AN
Figure 6.1.6-1: Control Plane Protocol Stack between UE-AT3SF and UPc-AT3SF
### 6.1.7 User Plane Protocol Stack options between UE-AT3SF and UPu-AT3SF
Multiple access methods are available between the UE-AT3SF and the UPu-AT3SF.
This methods are negotiated between the two peers.
#### 6.1.7.1 User Plane Convergence Method based on NULL Tunneling
This methods allows traffic aggregation over the available accesses at the
level of an IP flow. This solution guarantees that at any moment in time there
are no packets of the same fully specified IP flow over both available
accesses. This solution does not require any reordering on the receiving side
while still allows aggregation of traffic over both accesses at an IP flow
level.
The associated user plane protocol stack is shown in Figure 6.1.7.1-1.
{width="6.690277777777778in" height="3.727777777777778in"}
Figure 6.1.7.1-1: User Plane Protocol Stack with NULL tunnel between UE-AT3SF
and UPu-AT3SF
##### 6.1.7.1.5 Traffic Distribution
In this solution the UPu-AT3SF or the UE distributes the traffic based on
ATSSS rules implementing different policies described in Clause 6.1.4.
The downstream traffic is hashed on a flow basis using a hash function based
on the 5tuple. All packets of the same flow are sent over the same access to
avoid reordering. As a result on the receiving of a downlink packet at the
UPu-AT3SF a hash function is computed using the 5 tuple to identify the
associated entry of the flow in a lookup table. If the entry indicates that
another packet of the same flow was processed less than 2*RTT ago, then the
packet is going to be sent on the same access as the previous packet of this
flow and update the time value of its entry in the lookup table. If there is
no packet of this flow that was processed for this flow in the last 2*RTT
interval, then the UPu-AT3SF decides the outgoing access based on the
associated ATSSS policy for this flow.
On the UE side a potential implementation would allow the UE to decide the
access to be used for a UL packet by using the same access on which it
received packets of the same flow. In order to avoid packet reordering at the
UPu-AT3SF side, the packet of the same flow may use a different access only if
there is no packet of the same flow sent over the other access in the last
2*RTT.
##### 6.1.7.1.6 MTU considerations
This solution does not introduces any extra requirements on the MTU or
fragmentation issues on the path from the UE to the UPu-AT3SF as it makes use
of the existent transport over each access with no changes.
#### 6.1.7.2 User Plane Convergence Method based on GRE tunneling
This method allows transport of the PDN PDUs across both accesses in a GRE
Tunnel. The GRE tunnels are setup over both accesses between the UE-AT3SF and
UPu-AT3SF using the control plane signalling between the UE-AT3SF and UPc-
AT3SF.
This method allows in order PDN PDUs delivery and it may be applied to any PDN
type.
The associated user plane protocol stack is shown in Figure 6.1.7.2-1.
{width="6.690277777777778in" height="4.361805555555556in"}
Figure 6.1.7.2-1: User Plane Protocol Stack with GRE tunnel between UE-AT3SF
and UPu-AT3SF
#### 6.1.7.3 User Plane Convergence Method using L3 Generic Multi-Access
Solutions (GMA)
This method allows transport of the PDN PDUs across both accesses between the
UE-AT3SF and UPu-AT3SF, which supports trailer-based GMA convergence protocol
sublayer below traffic distribution.
This GMA convergence method avoids the use of IP-over-IP tunnelling solution
(GRE), and the GMA protocol appends a trailer with control information which
is used to carry necessary info, e.g. Sequence Number, for IP packets
splitting and reordering, etc.
To apply GMA protocol, the original Protocol Type value of the IP packet is
stored in the GMA trailer and Protocol Type field of the IP header can be set
to a special value as an indication of the presence of the GMA trailer, Length
field and Checksum field in the IP header are recalculated with the GMA
trailer.
This method allows in order PDN PDUs delivery and it may be applied to any PDN
type.
The associated user plane protocol stack is shown in Figure 6.1.7.3-1.
Figure 6.1.7.3-1: User Plane Protocol Stack with Trailer-based GMA protocol
between UE-AT3SF and UPu-AT3SF
#### 6.1.7.4 User Plane Convergence Method using L4 Multipath Solutions (MP-
TCP, QUIC, MP-QUIC, SCTP, UDP generic)
This method allows transport of the IP PDUs across both accesses between the
UE-AT3SF and UPu-AT3SF. It uses a Layer 4 multipath transport service enabling
IP flows to use multiple paths simultaneously.
The L4 multipath transport service may use either MPTCP, QUIC, MP-QUIC, SCTP
or UDP generic. MP-TCP sets up multiple TCP subflows over the different access
networks, MP-QUIC several UDP flows, QUIC several UDP flows, SCTP several SCTP
flows and the UDP generic approach several UDP flows. UE-AT3SF and UP-AT3SF
are responsible for managing the MP-TCP/QUIC/MP-QUIC Hybrid Access paths,
including establishment and tear down.
The peers may terminate the end user layer 4 sessions before transporting the
data over the access paths, effectively executing a proxy function for these
end user sessions.
One or more IP addresses may be allocated, if needed, on the UPFu-AT3SF to
differentiate between the flows over both accesses. Other mechanisms to
provide such a differentiation are precluded. The subsequent assigned IP
addresses are pushed to the peers of the layer 4 sessions using internal
messages of either MP-TCP, MP-QUIC, SCTP or UDP generic (e.g. ADD_ADDRESS for
MP-TCP).
The associated user plane protocol stack is shown in Figure 6.1.7.4-1.
**a) MPTCP transport.**
{width="6.690277777777778in" height="4.361805555555556in"}
Figure 6.1.7.4-1a: User Plane Protocol Stack with L4 Multipath between UE-
AT3SF and UPu-AT3SF
**b) MP-QUIC transport.**
{width="6.156944444444444in" height="4.008333333333334in"}
Figure 6.1.7.4-1b: User Plane Protocol Stack with L4 Multipath between UE-
AT3SF and UPu-AT3SF
c) SCTP transport.
Figure 6.1.7.4-1c: User Plane Protocol Stack with L4 Multipath between UE-
AT3SF and UPu-AT3SF
d) UDP generic transport.
Figure 6.1.7.4-1d: User Plane Protocol Stack with L4 Multipath between UE-
AT3SF and UPu-AT3SF
e) QUIC transport.
{width="6.690972222222222in" height="3.808333333333333in"}
Figure 6.1.7.4-1e: User Plane Protocol Stack with L4 Multipath between UE-
AT3SF and UPu-AT3SF
##### 6.1.7.4.1 Traffic distribution with MP-TCP
##### 6.1.7.4.1.1 Traffic distribution over multi access using MP-TCP tunnel
between the UE and UPu-AT3SF {#traffic-distribution-over-multi-access-using-
mp-tcp-tunnel-between-the-ue-and-upu-at3sf .H6}
In this mode of operation MP-TCP is used as a tunnelling transport between the
UE-AT3SF and UPu-AT3SF. This solution enables different flows (eg: IP flows)
to/from the UE to use multiple paths between UE-AT3SF and UPu-AT3SF. The MP-
TCP multipath service between UE-AT3SF and UPu-AT3SF may set up multiple TCP
subflows over the different accesses and uses the real time flow control
mechanism natively provided for each TCP subflow. The MP-TCP service provides
packet reordering at each side and it guarantees reliable in order packet
delivery for both DL and UL traffic.
##### 6.1.7.4.1.1.1 Usability {#usability .H6}
This solution can be used for any PDN type and it guarantees in order reliable
packet delivery between UE-AT3SF and UPu-AT3SF. Because of the reordering
procedure at the end nodes of the MPTCP tunnel, this solution may not be
suitable for real time traffic with tight latency requirements.
##### 6.1.7.4.1.1.2 IP addressing {#ip-addressing .H6}
In this solution the UE-AT3SF is assigned with the IP address values to be
used over each access. The UPu-AT3SF makes use of a single IP address for the
MP-TCP tunnel. These IP address values are provided to the UE-AT3SF by the
UPc-AT3SF.
##### 6.1.7.4.1.2 Traffic distribution over multi access using MP-TCP proxy at
UPu-AT3SF. {#traffic-distribution-over-multi-access-using-mp-tcp-proxy-at-upu-
at3sf. .H6}
This solution applies only to the IP type PDNs and addresses TCP traffic only.
The UE-AT3SF is using MP-TCP layer functionality available at the UE.
##### 6.1.7.4.1.2.1 Usability {#usability-1 .H6}
This solution applies to TCP traffic flows only. The TCP flows that are
aggregated over both access are identified at the UE using ATSSS rules.
##### 6.1.7.4.1.2.2 IP addressing {#ip-addressing-1 .H6}
Same as in 6.1.7.4.1.1.2.
##### 6.1.7.4.2 Traffic distribution with MP-QUIC
##### 6.1.7.4.2.1 Traffic distribution over multi access using MP-QUIC tunnel
between the UE and UPu-AT3SF {#traffic-distribution-over-multi-access-using-
mp-quic-tunnel-between-the-ue-and-upu-at3sf .H6}
In this mode of operation MP-QUIC is used as a tunnelling transport between
the UE-AT3SF and UPu-AT3SF. This solution enables different flows (e.g. IP
flows) to use multiple paths between UE-AT3SF and UPu-AT3SF. The MP-QUIC
multipath service between UE-AT3SF and UPu-AT3SF sets up multiple encrypted
streams over the different accesses. The MP-QUIC service provides packet
reordering at each side and it also guarantees reliable in order packet
delivery for both DL and UL traffic.
##### 6.1.7.4.2.1.1 Usability {#usability-2 .H6}
This solution can be used for any PDN type and it guarantees in order reliable
packet delivery between UE-AT3SF and UPu-AT3SF. Because of the reordering
procedure at the end nodes of the MP-QUIC tunnel, this solution may not be
suitable for real time traffic with tight latency requirements.
##### 6.1.7.4.2.1.2 IP addressing {#ip-addressing-2 .H6}
In this solution the UE-AT3SF is assigned with the IP address values to be
used over each access. The UPu-AT3SF makes use of a single IP address for the
MP-QUIC tunnel. These IP address values are provided to the UE-AT3SF by the
UPc-AT3SF.
##### 6.1.7.4.3 Traffic distribution with SCTP
##### 6.1.7.4.3.1 Traffic distribution over multi access using SCTP tunnel
between the UE and UPu-AT3SF {#traffic-distribution-over-multi-access-using-
sctp-tunnel-between-the-ue-and-upu-at3sf .H6}
In this mode of operation SCTP is used as a tunnelling transport between the
UE-AT3SF and UPu-AT3SF. This solution enables single communication flows
(e.g.: IP flows or UDP flows) to use multiple paths between UE-AT3SF and UPu-
AT3SF. The SCTP multipath service between UE-AT3SF and UPu-AT3SF sets up a
SCTP association over the different accesses and uses the real time flow and
congestion control mechanism natively provided for each access (IP-to-IP
determined) included in the SCTP association, for path estimation. The SCTP
multipath service uses the SCTP inherent multi-stream feature in the way that
different characteristics in respect to reliability, in-order delivery, stream
prioritization, multipath scheduling (e.g. splitting or switching or steering)
and path prioritization can be assigned per stream. In case services which run
over the SCTP multipath service needs differentiation in terms of transmission
characteristics and/or prioritization, said multi-stream capability can be
used. However, an additional service detection is required.
The solution is based on IETF draft-tuexen-tsvwg-sctp-multipath-16:\"Load
Sharing for the Stream Control Transmission Protocol (SCTP)\" for multi-path
aggregation and following IETF specifications:
\- RFC 4960 [15] (SCTP) with multi-homing and session handover,
\- RFC 4960 [15] \"U Bit\" for unordered delivery,
\- RFC 7829 [16] (SCTP-PF) for quick failover,
\- RFC 3758 [17] (PR-SCTP) for different reliability classes.
##### 6.1.7.4.3.1.1 Usability {#usability-3 .H6}
This solution can be used for any PDN type and can, because of the multi-
stream feature, support different QoS levels and different demands on the
transmission behaviour between UE-AT3SF and UPu-AT3SF. Based on Layer 3/4(/or
higher) separation of the piggybacked traffic, different SCTP streams with
different QoS and/or transmission characteristics can be set up (on demand or
pre-defined).
The SCTP multi-stream feature, which is an integral part of the basic SCTP
specification (RFC 4960 [15]), is further depicted in Figure 6.1.7.4.3.1.1-1.
SCTP in general builds an association between two endpoints (e.g. between UE-
AT3SF and UPu-AT3SF). Because of SCTP\'s multi-homing capabilities, this
association can cover multiple IP connections (e.g. one for Wi-Fi and one for
cellular). Within an SCTP association data is transferred within a stream or a
bunch of streams. Although this multi-stream concept was originally introduced
to overcome head-of-line blocking issues, it can be exploited for service
based multi-connectivity. That is because the individual streams can be
assigned different transmission characteristics by RFC 4960 [15] \"U-Bit\",
RFC 3758 [17] and IETF draft-tuexen-tsvwg-sctp-multipath-16. Exemplary, this
means one stream can aim on unreliable transmission, another on reliable
transmission and yet another on multi-path transmission. Even this three
examples can be mixed to some extent. A further degree of flexibility over
solutions which only pursue multi-homed path scheduling, is the additional
stream multiplexing (scheduling).
{width="4.643055555555556in" height="3.827777777777778in"}
Figure 6.1.7.4.3.1.1-1: SCTP concept
This solution is able to carry any kind of traffic, especially real time
traffic with tight latency requirement Services indicating tight latency
requirements can be transported via SCTP streams which are prioritized over
others and/or apply RFC 4960 [15] \"U-Bit\", RFC 7829 [16] and RFC 3758 [17].
By that, in special cases, reordering, independent of switching, steering or
splitting, can be by passed.
##### 6.1.7.4.3.1.2 IP addressing {#ip-addressing-3 .H6}
In this solution the UE-AT3SF is assigned with the IP address values to be
used over each access. The UPu-AT3SF makes use of a single IP address for the
SCTP tunnel. These IP address values are provided to the UE-AT3SF by the UPc-
AT3SF.
##### 6.1.7.4.3.1.3 Steering modes supported {#steering-modes-supported .H6}
Active-Standby, Load-Balancing, Smallest Delay, Top up.
##### 6.1.7.4.4 Traffic distribution with UDP generic
##### 6.1.7.4.4.1 Traffic distribution over multi access using multiple UDP
flows between the UE and UPu-AT3SF {#traffic-distribution-over-multi-access-
using-multiple-udp-flows-between-the-ue-and-upu-at3sf .H6}
In this mode of operation UDP flows are scheduled between the UE-AT3SF and
UPu-AT3SF. On sender side a scheduling function resides supporting steering
and switching Path (access) characteristic estimation for steering and
switching decisions is applied externally as described in 6.1.5.3 and the
results are considered. The switching functionality requires an address-
rewriting feature at the opposite side to disguise a src-IP change. A
reordering is not part of this scenario.
##### 6.1.7.4.4.1.1 Usability {#usability-4 .H6}
This solution applies only to the IP type PDNs and addresses UDP traffic only,
it does not impose reliability in any case on the piggybacked traffic.
However, the main intend is to provide UDP multi-connectivity as complementary
approach to Layer 4 approaches like MPTCP or MP-QUIC, which offer a traffic
split on a reliable in-order transmission base.
This solution is able to provide transmission reliability (service continuity)
and load-balancing features. Real time traffic with tight latency requirements
is supported.
##### 6.1.7.4.4.1.2 IP addressing {#ip-addressing-4 .H6}
In this solution, the UE-AT3SF is assigned with the IP address values to be
used over each access. The UPu-AT3SF makes use of a single public IP address
(either per UE-AT3SF or as a carrier grade NAT for several UE-AT3SF at a time)
for address-rewriting purposes, guaranteeing session continuity.
##### 6.1.7.4.4.1.3 Steering modes supported {#steering-modes-supported-1 .H6}
In principle same as in 6.1.7.4.3.1.3 but reordering is not part of the
scenario.
##### 6.1.7.4.4.2 Traffic distribution over multi access using a UDP tunnel
between the UE and UPu-AT3SF {#traffic-distribution-over-multi-access-using-a-
udp-tunnel-between-the-ue-and-upu-at3sf .H6}
In this mode of operation UDP is used as a tunnelling transport between the
UE-AT3SF and UPu-AT3SF and exposes a virtual IP interface each. This solution
enables different flows (e.g.: IP flows) to use multiple paths between UE-
AT3SF and UPu-AT3SF. The UDP generic service between UE-AT3SF and UPu-AT3SF
sets up a UDP flow for each of the different accesses and uses a real time
congestion control mechanism on top of the UDP flows each. Potential
congestion control approaches might be RFC 5681 [18] and RFC 5348 [19].
Alternatively a DCCP flow according to RFC 4340 [20] can be used instead of an
UDP flow. On sender side a scheduling function resides supporting steering,
switching and splitting and on receiver side a reordering component is
implemented. The scheduling is thought similar to known implementations in
MPTCP or SCTP. The reordering can orientate on RFC 2890 [21], clause 2.2.
However, in principle the reordering implementation is left open to the
implementer. A more advanced re-ordering algorithm could be used.
##### 6.1.7.4.4.2.1 Usability {#usability-5 .H6}
This solution can be used for any PDN type, it does not impose reliability in
any case on the piggybacked traffic. However, the main intent is to provide
UDP splitting as complementary approach to Layer 4 approaches like MPTCP or
MP-QUIC, which offer a traffic split on a reliable in-order transmission base.
This solution is able to carry any kind of traffic, especially real time
traffic with tight latency requirements, but mainly dominated by the chosen
reordering mechanism.
##### 6.1.7.4.4.2.2 IP addressing {#ip-addressing-5 .H6}
In this solution the UE-AT3SF is assigned with the IP address values to be
used over each access. The UPu-AT3SF makes use of a single IP address for the
UDP tunnel interface. These IP address values are provided to the UE-AT3SF by
the UPc-AT3SF.
##### 6.1.7.4.4.2.3 Steering modes supported {#steering-modes-supported-2 .H6}
Same as in 6.1.7.4.3.1.3
##### 6.1.7.4.5 Traffic distribution with QUIC
###### 6.1.7.4.5.1 Traffic distribution over multi access using QUIC between
the UE and UPu-AT3SF
In this mode of operation QUIC [aa] is used as a tunneling transport between
the UE-AT3SF and UPu-AT3SF. This solution enables single communication flows
(e.g.: IP flows) to/from the UE to use alternative paths between UE-AT3SF and
UPu-AT3SF.
By utilizing QUIC\'s loss detection and congestion control features [bb],
valuable information such as smoothed RTT, RTT variance, packet loss and
throughput can be provided to the Performance Measurement Function (PMF) of
ATSSS to assist with path determination decisions. Because this information is
already built into the transport protocol, it allows for path characteristics
to be passively-measured. Therefore, it does not rely on active probing which
does not scale well and might consume unnecessary system resources, including
power.
The QUIC tunnel service between UE-AT3SF and UPu-AT3SF sets up one or more
QUIC connections over the different accesses. By leveraging the connection
migration feature built into QUIC, each QUIC connection can be steered or
switched from one path to another. The QUIC protocol is equipped with path
validation mechanisms, such that traffic of a given QUIC connection can go
over the new path upon a successful migration. This provides a way to maintain
packet ordering when traffic of the QUIC connection is moved from one path to
another.
Establishing multiple QUIC connections between UE-AT3SF and UPu-AT3SF provides
flexibility in grouping tunneled traffic based on criteria such as:
\- QoS - Each QUIC connection can represent a range of QFI values, including a
single value.
\- IP tuples - Inner IP flow destined to a particular address may get its own
dedicated QUIC connection.
\- Reliability - Each QUIC connection can represent a reliability class.
Multiple streams may optionally be established within a QUIC connection to
provide finer-grained traffic differentiation and characterization, e.g. each
stream may represent a Quality of Service level. In addition, one or more
streams within the connection may also be used to transfer unreliable
datagrams [24] if desired.
The QUIC tunnel service uses NULL encryption, as traffic for the QUIC
connections from UE-AT3SF to UPu-AT3SF is already protected by the underlying
access network connectivity to 5GC. This protection is provided by 5G-AN and
by the IPsec protocols, for 3GPP and non-3GPP access networks, respectively.
Doing so avoids redundant crypto operations which may introduce additional
processing and power costs.
###### # 6.1.7.4.5.1.1 Usability
This solution can be used for any PDN type and addresses traffic whose
transports that are not multipath capable. For multipath capable transports
such as MPTCP, SCTP, or MP-QUIC, their traffic should go directly over the
corresponding access network.
Because a QUIC connection may migrate from one path to another, but not be
split across the paths, this solution covers only traffic steering and
switching. Because this works at the connection level, traffic belonging to a
particular QUIC connection will migrate together as a group. Traffic splitting
is therefore not supported by this solution.
###### # 6.1.7.4.5.1.2 IP addressing
In this solution the UE-AT3SF is assigned with the IP address values to be
used over each access. These IP address values are provided to the UE-AT3SF by
the UPc-AT3SF. The UPu-AT3SF makes use of a single IP address for the QUIC
tunnel endpoint.
### 6.1.8 Impacts On Existing Entities and Interfaces
This solution will impact the following entities in 5GS:
\- SMF.
\- PCF.
\- UDM.
\- UPF.
\- UE.
Editor\'s note: The impact on existing entities and interfaces is FFS.
## 6.2 Solution 2: Support of Multi-Access PDU Sessions
### 6.2.1 General
A Multi-Access PDU (MA-PDU) session is created by bundling together two
separate PDU sessions, which are established over different accesses.
An MA-PDU session is schematically illustrated in the figure below. It is
composed of two PDU sessions, referred to as \"child PDU sessions\"; one
established over 3GPP access and the other established over untrusted non-3GPP
access (e.g. a WLAN AN).
{width="6.261805555555555in" height="1.9729166666666667in"}
Figure 6.2.1-1: Illustration of a Multi-Access PDU session with two child PDU
sessions
The child PDU sessions of a MA-PDU session share the following
characteristics:
(i) a common DNN;
(ii) a common UPF anchor (UPF-A);
(iii) a common PDU type (e.g. IPv6);
(iv) common IP address(es);
(v) a common SSC mode; and
(vi) a common S-NSSAI.
An MA-PDU session realizes a multi-path data link between the UE and an UPF-A,
as shown in the figure 6.2.1-1. It operates below the IP layer and it is
transparent to the IP layer and all layers above the IP layer.
As discussed in the next clause, a MA-PDU session can be established with one
of the following procedures:
(i) Established with two separate PDU session establishment procedures; one of
each child PDU session. This is called \"separate establishment\".
(ii) Established with a single MA-PDU session establishment procedure, where
the two child PDU sessions are established in parallel. This is called
\"combined establishment\".
The child PDU sessions established with any of the above procedures have the
same IP address.
After a MA-PDU session is established, SM signalling related to this MA-PDU
session (e.g. for modification or removal of a child PDU session, etc.) can be
conducted over any of the available accesses of the MA-PDU session.
It is expected that the UE discovers the support of ATSSS for a PDU session
upon attempting to establish the MA-PDU session.
The UE may determine to establish a Multi-Access PDU session based on:
\- The configured policy in the UE may indicate whether multi-access is
preferred when a PDU session is triggered;
### 6.2.2 Establishment of Multi-Access PDU session with multiple PDU Session
IDs
#### 6.2.2.1 Separate Establishment
In this case, the two child PDU sessions are established with two separate PDU
session establishment procedures. For instance, the UE may establish first the
PDU session over 3GPP access and, later, after it connects to a WLAN and
establishes a signalling IPsec SA with the N3IWF, the UE may establish also
the PDU session over non-3GPP access. The two PDU sessions are linked together
and they become child PDU sessions of a MA-PDU session.
To support the separate establishment, the existing \"UE Requested PDU session
establishment\" procedure, as specified in TS 23.502 [6], clause 4.3.2.2, can
be used for each child PDU session. However, when the second child PDU session
is established, then:
\- A \"linked\" PDU session should be provided to 5GC that refers to an
existing PDU session. The 5GC shall link the second PDU session with the
referred \"linked\" PDU session and designate them as child PDU sessions of
the same MA-PDU session.
\- Since a \"linked\" PDU session is provided to 5GC, there is no need for the
UE to request specific values for the DNN, S-NSSAI, SSC Mode, PDU type, etc.
The second PDU session shall inherit all these values from the \"linked\" PDU
session.
\- The Request Type could indicate \"Initial Request\". When the 5GC receives
a PDU Session Establishment Request with a \"linked\" PDU and with Request
Type=\"Initial Request\", then the 5GC interprets that as a request create a
MA-PDU session by linking the requested PDU session with the existing
\"linked\" PDU session. Alternatively, a new Request Type could be specified
if the \"Initial Request\" is not appropriate.
Editor\'s note: Additional changes to the existing \"UE Requested PDU session
establishment\" procedure are FFS.
#### 6.2.2.2 Combined Establishment
In this case, the two child PDU sessions are established in parallel with a
single procedure called \"UE Requested MA-PDU session establishment\"
procedure. This is useful when the UE decides to establish an MA-PDU session
while it is already registered to 5GC via both accesses. Instead of the UE
initiating two separate PDU session establishment procedures, the UE initiates
one MA-PDU session establishment procedure which results in the establishment
of two child PDU sessions. The key advantage of the MA-PDU session
establishment (versus the separate establishment of two PDU sessions) is less
signalling over the air interface, less signalling over network interfaces, as
well as fewer procedures in the UE and, thus, less battery consumption.
Editor\'s note: The advantages of the combined establishment versus the
separate establishment should be further analyzed, considering also failure
scenarios.
The figure below shows a high-level procedure of the combined establishment,
i.e. it shows a \"UE Requested MA-PDU session establishment\" procedure.
{width="6.385416666666667in" height="4.841666666666667in"}
Figure 6.2.2.2-1: Overview of the UE Requested MA-PDU Session Establishment
1\. The UE initiates the \"UE Requested PDU Session Establishment\" procedure
as specified in TS 23.502 [6], clause 4.3.2.2, but it provides two different
PDU Session Ids: one for the child PDU session over 3GPP access (PDU session
Id-1) and another for the child PDU session over non-3GPP access (PDU session
Id‑2). The Request Type indicates \"Initial request\".
Editor\'s note: It is FFS if it is better to provide a single PDU session Id
(instead of two) and an MA-PDU indicator.
2\. The AMF selects an SMF and sends to SMF an
_Nsmf_PDUSession_CreateSMContext Request_ containing both PDU session ids and
their associated AN types.
3\. The SMF registers with the UDM and indicates that it handles both PDU
session Id-1 and PDU session Id-2.
4\. If needed, the secondary authorization/authentication procedure takes
place, as specified in TS 23.502 [6], clause 4.3.2.3.
5\. If dynamic PCC is deployed, the SMF selects a PCF and retrieves the
default Multi-Access PCC rules from PCF. The Multi-Access PCC rules include
QoS rules for each child PDU session and include ATSSS rules that indicate how
traffic within the MA-PDU session should be routed across the two child PDU
sessions. Different QoS flows may be assigned to the child PDU sessions
established over different accesses.
6-9. The user-plane of the child PDU session over untrusted non-3GPP access is
established.
\- In step 7 the SMF indicates to AMF that the transfer of N1/N2 information
should take place over non-3GPP access.
\- In step 8 the normal steps of an N2 PDU session establishment over
untrusted non-3GPP access are carried out. The UE receives a PDU Session
Establishment Accept message containing the PDU session Id-2 and, thus, the UE
determines that the child PDU session over non-3GPP access is established. The
UE receives also the default QoS rules to be applied over non-3GPP access.
10-13. The user-plane of the child PDU session over 3GPP access is
established.
\- In step 10 the SMF provides a \"linked PDU session\" identity to UPF so
that the UPF links this PDU session with the one established in step 6\. The
UPF considers both PDU sessions as part of the same MA-PDU session. The SMF
also provides ATSSS forwarding rules to UPF that indicate how downlink traffic
should be routed across the two child PDU sessions. The ATSSS forwarding rules
are derived based on the Multi-Access PCC rules provided by PCF.
\- In step 11 the SMF indicates to AMF that the transfer of N1/N2 information
should take place over 3GPP access.
\- In step 12 the normal steps of an N2 PDU session establishment over 3GPP
access are carried out. The UE receives a PDU Session Establishment Accept
message containing the PDU session Id-1 and, thus, the UE determines that the
child PDU session over 3GPP access is established. The UE receives also the
default QoS rules to be applied over 3GPP access.
\- In addition, in step 12 the UE may receive ATSSS forwarding rules that
indicate how uplink traffic should be routed across the two child PDU
sessions.
NOTE: The steps 6-9 and 10-13 in the figure 6.2.2.2-1 (i.e. the two N2 PDU
Session Establishment procedures) can be executed in parallel.
Editor\'s note: It is FFS whether it is better to send one PDU Session
Establishment Accept message to UE instead of two, as depicted above in steps
8c and 12b.
Editor\'s note: Further details of the \"UE Requested MA-PDU session
establishment\" procedure (including PCC, QoS, handover and user-plane
aspects) are FFS.
### 6.2.3 Establishment of Multi-Access PDU session with a single PDU Session
ID
#### 6.2.3.1 Separate Establishment
In this case, the two child PDU sessions are established with two separate PDU
session establishment procedures. For instance, the UE may establish first the
PDU session over 3GPP access and, later, after it connects to a WLAN and
establishes a signalling IPsec SA with the N3IWF, the UE may establish also
the PDU session over non-3GPP access.
To support the separate establishment, the existing \"UE Requested PDU session
establishment\" procedure, as specified in TS 23.502 [6], clause 4.3.2.2, can
be used for each child PDU session. However, when the second child PDU session
is established, then:
\- A PDU Session ID should be provided to 5GC in the PDU Session ID IE that
refers to an existing PDU session. The 5GC shall link the second PDU session
with the referred PDU session identified by the PDU Session ID and designate
them as child PDU sessions of the same MA-PDU session.
\- The PDU Session Establishment Request message should include an MA-PDU
Request flag and Request Type=\"Existing PDU Session\". When the 5GC receives
this PDU Session Establishment Request, the 5GC interprets that as a request
to create a MA-PDU session by linking the requested PDU session with the
existing PDU session.
An overview of the separate establishment procedure for a MA-PDU session is
shown in the figure below. In this figure, the child PDU session over 3GPP
access is established first and the child PDU session over non-3GPP is added
subsequently (e.g. after the UE connects to an untrusted non-3GPP access
network).
Figure 6.2.3.1-1: Overview of the UE Requested MA-PDU Session Establishment
(Separate Establishment)
0\. If the UE is not registered via 3GPP access, the UE initiates Registration
procedure via 3GPP access as described in TS 23.502 [6].
1\. The UE sends a PDU Session Establishment Request message with a new PDU
Session ID and Request Type = \"initial request\". The UE also includes an MA-
PDU Capability flag to indicate to the network that it can support MA-PDU
sessions.
2\. The AMF selects an SMF as described in clause 4.3.2.2.3. In this step, the
AMF stores Access Type of the PDU Session = \"3GPP access\". When the AMF
received the MA-PDU Capability flag and it supports MA-PDU sessions, it
includes an MA-PDU Capability flag in the _Nsmf_PDUSession_CreateSMContext
Request_ message sent to SMF.
3\. The SMF registers with the UDM.
4\. If needed, the secondary authorization/authentication procedure takes
place, as specified in TS 23.502 [6], clause 4.3.2.3.
5\. If the UE has sent an MA-PDU Capability flag and both the AMF and the SMF
support MA-PDU sessions, the SMF sends an MA-PDU Capability flag to PCF when
it performs Session Management Policy Establishment procedure. The PCF decides
whether the MA-PDU session is allowed or not based on operator policy and
subscription.
6-9. If the PCF permits the use of MA-PDU procedures for the requested PDU
session (e.g. to later establish another child PDU over non-3GPP access), the
SMF sends a PDU Session Establishment Accept message with a MA-PDU Capability
flag to inform the UE that the network can support MA-PDU procedures for this
PDU session. Otherwise, the SMF may accept the PDU Session establishment but
does not include the MA-PDU Capability flag in the PDU Session Establishment
Accept message.
If the MA-PDU Capability flag is received by the UE, the UE may later add
another child PDU session to the existing PDU session with the steps below.
10\. If the UE is not registered via non-3GPP access, the UE initiates
Registration via non-3GPP access as described in TS 23.502 [6]. The UE sends
PDU Session Establishment Request message with PDU Session ID allocated in
step 1, Request Type = \"Existing PDU Session\", MA-PDU Request flag and
includes the same PDU Session parameters (e.g. S-NSSAI, DNN, PDU Session Type,
SSC mode, PDU Session ID) used with the PDU Session established via 3GPP
access. In the MM NAS message, the UE includes MA-PDU Request flag.
11\. The AMF selects the same SMF selected in step 2 based on Request Type =
\"Existing PDU Session\". In this step, the AMF updates the Access Type of the
PDU Session to \"Multi-Access\". When the AMF received MA-PDU Capability flag
and it support MA-PDU sessions, it includes MA-PDU Capability flag in the
_Nsmf_PDUSession_CreateSMContext Request_ message sent to SMF.
NOTE: The AMF may reject this request if the AMF cannot select the same SMF,
e.g. 3GPP PDU Session is established as a roaming with LBO but the UE is
registered in HPLMN via non-3GPP access.
12\. If the UE has sent an MA-PDU Request flag and the AMF and the SMF
supports MA-PDU sessions, the SMF sends an MA-PDU Request flag and associated
access information to PCF when it performs Session Management Policy
Modification procedure. The PCF decides whether the requested PDU session can
be added to the existing PDU session based on operator policy and
subscription.
When the SMF performs N4 modification, the SMF includes MA-PDU Request flag to
indicate that the PDU Session is a MA-PDU session.
13-15. If the PCF did not permit the establishment of a MA-PDU Session, the
SMF rejects the PDU session establishment request sent by the UE over non-3GPP
access.
#### 6.2.3.2 Combined Establishment
In this case, the two child PDU sessions are established in parallel with a
single procedure called \"UE Requested MA-PDU session establishment\"
procedure. This is useful when the UE decides to establish an MA-PDU session
while it is already registered to 5GC via both accesses in the same PLMN. If a
UE is registered to different PLMNs over 3GPP and non-3GPP accesses, the UE
shall not use this procedure. Such UE can use the Separate Establishment
procedure described in clause 6.2.2.1.
Instead of the UE initiating two separate PDU session establishment
procedures, the UE initiates one MA-PDU session establishment procedure which
results in the establishment of two child PDU sessions. The key advantage of
the MA-PDU session establishment (versus the separate establishment of two PDU
sessions) is less signalling over the air interface, less signalling over
network interfaces, as well as fewer procedures in the UE and, thus, less
battery consumption.
Editor\'s note: The advantages of the combined establishment versus the
separate establishment should be further analyzed, considering also failure
scenarios.
The figure below shows a high-level procedure of the combined establishment,
i.e. it shows a \"UE Requested MA-PDU session establishment\" procedure.
Figure 6.2.3.2.1-1: Overview of the UE Requested MA-PDU Session Establishment
(Combined Establishment)
0\. The UE is Registered via 3GPP access and non-3GPP access in the same PLMN
and the allowed NSSAIs received over the two accesses overlap (i.e. there is
at least one S-NSSAI allowed on both accesses).
1\. The UE initiates the \"UE Requested PDU Session Establishment\" procedure
as specified in TS 23.502 [6], clause 4.3.2.2, and sends a NAS UL Transport
message that includes a single PDU Session ID, Request Type = \"initial
request\", a MA-PDU Request indication and a PDU Session Establishment
Request. The MA-PDU Request indication and the Request Type = \"initial
request\", indicates that this PDU Session Establishment Request is to
establish a Multi-Access PDU Session using a Combined Establishment procedure.
If the UE requests an S-NSSAI, it shall request an S-NSSAI that is allowed on
both accesses.
2\. The AMF selects an SMF and sends to SMF an
_Nsmf_PDUSession_CreateSMContext Request_. If the AMF received the MA-PDU
Request indication and it supports MA-PDU sessions, it includes the MA-PDU
Request indication in the _Nsmf_PDUSession_CreateSMContext Request_ message
sent to the SMF.
If the AMF receives an initial request message with MA-PDU Request flag but
the UE is registered via only one access, or the requested S-NSSAI is not
allowed on both accesses, the AMF rejects the UE request.
3\. The SMF registers with the UDM .
4\. If needed, the secondary authorization/authentication procedure takes
place, as specified in TS 23.502 [6], clause 4.3.2.3.
5\. If dynamic PCC is deployed, the UE sent the MA-PDU Request indication, and
both the AMF and the SMF support MA-PDU sessions, then the SMF sends an MA-PDU
Request indication and associated access information to PCF in the SM Policy
Control Create message. The PCF decides whether the MA-PDU session is allowed
or not based on operator policy and subscription.
The SMF receives from PCF PCC rules and the Session rule(s) (including the
default QoS and the AMBR for each access) for the MA-PDU session. The PCC
rules may include rules for traffic steering and QoS rules for 3GPP access and
non-3GPP access . Based on the received rules for traffic steering, the SMF
derives ATSSS rules for the UE that indicate how uplink traffic of the MA-PDU
session should be routed across the two accesses. Different QoS flows may be
assigned to the different accesses of the MA-PDU session.
6-9. The user-plane over untrusted non-3GPP access is established.
\- In step 7 the SMF indicates to AMF that the transfer of N1/N2 information
should take place over non-3GPP access.
\- In step 8 the normal steps of an N2 PDU session establishment over
untrusted non-3GPP access are carried out.
10-13. The user-plane over 3GPP access is established.
\- The SMF provides the Packet Detection rules to UPF. These rules indicate
how the downlink traffic of the MA-PDU session should be routed across the two
accesses. The Packet Detection rules are derived based on the PCC rules for
traffic steering provided by PCF.
\- In step 11 the SMF indicates to AMF that the transfer of N1/N2 information
should take place over 3GPP access. The SMF include MA-PDU Supported
indication to the N1N2 Message Transfer request to indicate that the MA-PDU
session is established successfully.
\- In step 12 the normal steps of an N2 PDU session establishment over 3GPP
access are carried out. The UE receives a PDU Session Establishment Accept,
the PDU Session ID, and the MA-PDU Supported indication. The UE determines
that the MA-PDU session is established successfully when it receives the MA-
PDU Capability flag and user-plane resources on both accesses have been
established.
\- In addition, in step 12 the UE may receive the ATSSS rules derived by SMF
that indicate how uplink traffic should be routed across the two accesses.
#### 6.2.3.3 UE Requested MA-PDU Session Establishment
This solution is based on the following principles:
1) A MA-PDU session is established by using the existing \"UE Requested PDU
Session Establishment\" procedure specified in TS 23.502 [6], with a few
extensions discussed below.
2) The UE may request a MA-PDU session when the UE is registered to the same
PLMN via both 3GPP and non-3GPP accesses, or when the UE is registered via one
access only.
3) At any given time, a MA-PDU session may have user-plane resources on both
3GPP and non-3GPP accesses, or on one access only, or may not have any user-
plane resources. The Service Request procedure is used to request the
establishment of user-plane resources on one access, as further explained
below.
The UE requests a MA-PDU session by sending a PDU Session Establishment
request that includes:
(1) an \"MA-PDU Request\" only, when the UE wants to activate a MA-PDU session
and is capable to use the ATSSS function only; or
(2) an \"MPTCP Request\" only, when the UE wants to activate a MA-PDU session
and is capable to use the MPTCP function only; or
(3) the \"MA-PDU Request\" and the \"MPTCP Request\", when the UE wants to
activate a MA-PDU session and is capable to use both the ATSSS function and
the MPTCP function.
If the network accepts the MA-PDU session request, then:
(a) user-plane resources are established over both 3GPP and non-3GPP accesses,
when the UE is registered to the same PLMN over both accesses; or
(b) user-plane resources are established over one access only (either 3GPP or
non-3GPP access), when the UE is registered via one access only.
In the latter case (b), i.e. when the user-plane resource are established over
one access only, the user-plane resources on the second access may be
established later, e.g. after the UE registers via the second access.
Editor\'s note: The scenario when the UE is registered to 3GPP and non-3GPP
accesses via different PLMNs is FFS.
The figure below illustrates an example establishment of a MA-PDU session. In
this example, when the UE requests the MA-PDU session, the UE is registered
via both accesses (case 1), or the UE is registered via 3GPP access only (case
2). If the UE is registered via both accesses, then it is assumed that the
list of Allowed S-NSSAIs for the two accesses overlap, i.e. there is at least
one S-NSSAI allowed on both accesses.
Figure 6.2.3.3-1: Overview of the UE Requested MA-PDU Session Establishment
1\. The UE requests a MA-PDU session by initiating the \"UE Requested PDU
Session Establishment\" procedure, as specified in TS 23.502 [6], clause
4.3.2.2, and sends a NAS UL Transport message over 3GPP access that includes a
single PDU Session ID, Request Type = \"initial request\", a \"MA-PDU
Request\" indication and a PDU Session Establishment Request. The \"MA-PDU
Request\" indication and the Request Type = \"initial request\" indicate to
the network that this PDU Session Establishment Request is to establish a
Multi-Access PDU Session and to apply the ATSSS function for steering the
traffic of this MA-PDU session.
If the UE was capable to apply the MPTCP function to steer the traffic of the
MA-PDU session, then the UE would include an \"MPTCP Request\" indication,
instead of the \"MA-PDU Request\" indication.
If the UE requests an S-NSSAI, it shall request an S-NSSAI that is allowed on
3GPP access, if the UE is only registered via 3GPP access (case 2), or it
shall request an S-NSSAI that is allowed on both accesses, if the UE is
registered via both accesses (case 1).
2\. The AMF selects an SMF which supports MA-PDU sessions and sends to SMF an
_Nsmf_PDUSession_CreateSMContext Request_. If the AMF received the \"MA-PDU
Request\" indication in step 1 and it supports MA-PDU sessions, then the AMF
shall include the \"MA-PDU Request\" indication in the
_Nsmf_PDUSession_CreateSMContext Request_ message sent to the SMF.
If the AMF determines that the UE is registered via both accesses but the
requested S-NSSAI is not allowed on both accesses, then the AMF shall reject
the MA-PDU session establishment.
3\. The SMF registers with the UDM.
4\. If needed, the secondary authorization/authentication procedure takes
place, as specified in TS 23.502 [6], clause 4.3.2.3.
5\. If dynamic PCC is deployed and if both the AMF and the SMF support MA-PDU
sessions, then the SMF sends an \"MA-PDU Request\" indication and associated
access information to PCF in the SM Policy Control Create message. The PCF
decides whether the MA-PDU session is allowed or not based on operator policy
and subscription.
The PCF provides PCC rules for the MA-PDU session, i.e. PCC rules that include
MA-PDU Session Control information, as specified in clause 6.13. The PCC rules
may include also Policy Control information that associates a Service Data
Flow with a 5QI and other QoS parameters.
From the received PCC rules, the SMF derives (a) ATSSS rules, which will be
sent to UE for controlling the traffic steering, switching and splitting in
the uplink direction, and (b) N4 rules, which will be sent to UPF for
controlling the traffic steering, switching and splitting in the downlink
direction.
6-9. The user-plane resources over 3GPP access are established.
\- In step 6, the N4 rules derives by SMF for the MA-PDU session are sent to
UPF. These N4 rules are stored in UPF and they are applied when the MA-PDU
session has user-plane resources over both 3GPP and non-3GPP accesses.
\- In step 7 the SMF sends an N1N2 Message Transfer to AMF including N1 SM
information for the UE and N2 Information for the 3GPP access. This message
includes also AN Type=3GPP, indicating to AMF that the N1 SM Information and
the N2 information should be sent over 3GPP access. In this step the SMF also
subscribes with the AMF to receive a notification when the UE registers via
non-3GPP access.
\- In step 8 the normal steps of an N2 PDU session establishment over 3GPP
access are carried out. The UE receives a PDU Session Establishment Accept and
the PDU Session ID. The PDU Session Establishment Accept indicates to UE that
the requested MA-PDU session was successfully established, and it includes the
ATSSS rules for the MA-PDU session, which were derived before by SMF.
10-13. The user-plane resources over non-3GPP access are established, in case
the UE is already registered via non-3GPP access (case 1). These steps may be
executed immediately after steps 6-9, or in parallel with steps 6-9. If the UE
is not registered via non-3GPP (case 2), then steps 10-13 are not executed,
and user-plane resources for the MA-PDU session are established only over 3GPP
access.
\- In step 11 the SMF sends an N1N2 Message Transfer to AMF including N2
Information for the non-3GPP access. This message includes AN Type=non-3GPP,
indicating to AMF that the N2 information should be sent over non-3GPP access.
Note that the N1N2 Message Transfer does not include N1 SM Information for the
UE because this information was sent to UE in step 8.
\- In steps 12 and 13, a normal N2 PDU session establishment procedure over
non-3GPP access is carried out and the user-plane resources over non-3GPP is
established. At this point, one or more IPsec child SAs are established with
the UE, all of them associated with the PDU Session Id of the MA-PDU session.
20-23. These steps are executed when the UE has established a MA-PDU session
but there are no user-plane resources over non-3GPP access, e.g. because the
UE was not registered via non-3GPP access when the MA-PDU session was
requested (case 2).
\- In step 20 the UE registers via (trusted or untrusted) non-3GPP access.
\- In step 21 the AMF sends a notification to SMF to inform it that the UE is
now registered over non-3GPP access.
\- In step 22 the SMF notifies the UPF that it may request the establishment
of user-plane resources over non-3GPP access whenever it is needed. This
enables the UPF to send a Data Notification to SMF whenever it wants to send
MA-PDU data to UE via non-3GPP access.
\- In step 23 the user-plane resources over non-3GPP access are established
for the MA-PDU session. This may be triggered either by the UE sending a
Service Request over non-3GPP access, or by the UPF sending a Data
Notification to SMF, which then initiates a Network-triggered Service Request.
Alternatively, instead of the Service Request, a session management procedure
may be used.
Editor\'s note: During the normative phase of the work, it will be decided if
the Service Request procedure or a Session Management procedure shall be used
for the establishment of user-plane resources on a specific access for a MA-
PDU session.
After step 23, the MA-PDU session has user-plane resources over both accesses.
Hence, the UE can apply the ATSSS rules received in step 8 and the UPF can
apply the N4 rules received in step 6, for routing uplink and downlink traffic
respectively across the two accesses of the MA-PDU session.
### 6.2.4 NW-Requested MA-PDU Session Establishment
In some scenarios, it would be beneficial for 5GC to decide that a single-
access PDU session requested by the UE should be established as a multi-access
PDU session (assuming that the UE is registered over 3GPP and non-3GPP
accesses to the same PLMN). This decision may be made when e.g. the SMF wants
to offload some traffic of the requested PDU session to non-3GPP access. For
example, when the UE requests to establish a single-access PDU session over
3GPP access to the Internet DNN, the SMF may decide to establish instead a MA-
PDU session to the Internet DNN so that some Internet traffic can be offloaded
to non-3GPP access.
To enable such scenarios, the procedure shown in the figure below can be used.
The network elements shown in this figure and the child PDU sessions (red and
blue) correspond to the network elements and the child PDU sessions shown in
figure 6.2.1-1.
{width="6.519444444444445in" height="6.854861111111111in"}
Figure 6.2.4-1: Overview of the NW-Requested MA-PDU Session Establishment
1\. The UE sends over 3GPP access a NAS message to AMF in order to request a
single-access PDU session over 3GPP access and provides the PDU session
identity (id) and other related information, e.g. the requested DNN, the
requested slice type, etc. The UE also provides a MA-PDU Capability flag to
indicate that it supports MA-PDU sessions (although the UE does not request a
MA-PDU session). The UE decides to request a single-access PDU session due to
e.g. configured URSP rules or other information in the UE.
2\. The AMF selects an SMF, sends an SM Request message to SMF and includes a
Multi-Access parameter to indicate to SMF that the UE is connected both to
3GPP access and to non-3GPP access. In addition, the AMF includes a MA-PDU
Capability flag to indicate to SMF that the UE and the AMF can both support
MA-PDU session procedures.
Editor\'s note: It is FFS if the AMF should select a SMF that supports MA-PDU
sessions, if the AMF knows that the UE is simultaneously registered via both
accesses and the UE can support MA-PDU sessions.
3a. If the selected SMF supports MA-PDU sessions, then the SMF may decide
(based on the received Multi-Access parameter and the MA-PDU Capability flag)
to establish a MA-PDU session instead of the single-access PDU session
requested by the UE. Before taking this decision, the SMF may interact with
the UDM to determine if the UE\'s subscription allows the establishment of an
MA-PDU session to the requested DNN. In addition, the SMF may decide to
establish an MA-PDU session based on information retrieved from PCF in step
3b. In this case, the decision to establish a MA-PDU session is taken after
step 3b.3b. The SMF interacts with PCF (e.g. establishes a new PDU-CAN
session) and may retrieve ATSSS rules that should be applied at the UE and at
the UPF anchor to determine how to steer uplink and downlink traffic
respectively across the two child PDU sessions. The SMF may also retrieve from
PCF multi-access QoS rules, i.e. QoS rules that should be applied over 3GPP
access and QoS rules that should be applied over non-3GPP access. The PCF
provides separate QoS rules for each access.
4-8. The SMF establishes a child PDU session over non-3GPP access.
In step 7b, the N3IWF receives the QoS profile(s) to be applied over non-3GPP
access, each one determined from the QoS rules to be applied over non-3GPP
access, provided by PCF in step 3b. In addition, in step 7b the N3IWF receives
the PDU session id that was provided by UE in step 1\. In step 7c, one or more
child IPsec SAs are established between the UE and N3IWF. Based on the
received PDU session id the UE determines that these child IPsec SAs are part
of the PDU Session requested in step 1\. In other words, the UE determines
that the network has decided to establish a MA-PDU session instead of the
requested single-access PDU session.
10-15. The SMF establishes the child PDU session over 3GPP access.
Again, based on the PDU session id received by the UE, the UE determines that
the established user-plane resources over 3GPP access are part of the MA-PDU
session that the network decided to establish. The UE receives a PDU Session
Establishment Accept message over 3GPP access, which completes the signaling
procedure for the NW-Requested MA-PDU session establishment. In step 13c, the
UE receives the QoS rules for both accesses.
Editor\'s note: It is FFS how the UE is informed that the network has
established a multi-access PDU session instead of the single-access PDU
session requested by the UE. The flow above assumes that the UE is informed by
receiving the same PDU session id when the user plane is established on both
accesses. However, additional information may be needed, such as an indication
in the PDU Session Establishment Accept message.
### 6.2.5 Modify a Multi-Access PDU Session to single-access PDU session
For a single session ID Multi-Access PDU session, as established through the
procedure in 6.2.3, the UE or the NW may initiate PDU Session Modification
procedure to turn it back to a normal single-access PDU session. This
procedure may be used e.g. when the UE\'s Allowed NSSAI changes for one of the
access types such that the UE is only allowed to have a PDU session on one of
the access types. In this scenario, the UE may modify the multi-access PDU
Session to a single-access PDU session to keep the session on the access
(either 3GPP or non-3GPP) on which the S-NSSAI is still allowed.
Editor\'s note: Other use cases to modify a multi-access PDU session to
single-access PDU session are FFS.
Editor\'s note: It is FFS whether the implicit release or network initiated
release of one of the PDU session legs is possible to satisfy the scenario
when the change in S-NSSAI triggers the modification of a multi-access PDU
session to a single access PDU session.
Figure 6.2.5-1: UE initiated removal of an access from Multi-Access PDU
Session
1\. The UE initiates the PDU Session Modification procedure to remove one
access from a Multi-Access PDU Session. In the modification request the UE
indicates the Session ID of the Multi-access PDU and the purpose is to remove
an access leg, e.g. 3GPP access or Non-3GPP access. The modification request
may be triggered by the events such as the disconnection from the access, or
the performance of the access link deteriorated.
2\. The AMF invokes the Nsmf_PDUSession_UpdateSMContext service of the SMF and
indicates the Session ID of the Multi-access PDU and the access type that
needs to be removed.
3\. The SMF initiates N4 Session Modification procedure with the UPFs that are
associated with the access to be removed, to switch the traffic flows to the
remaining access.
4\. The SMF invokes the Namf_Communication_N1N2MessageTransfer service to send
the N1 message (PDU Session Modification Command) and the N2 messages (N2
Session Request for the remaining access network and N2 Session Release for
the access to be removed).
5\. The AMF forwards the N2 Session Request to the AN of the remaining access
so the AN can reconfigure the access-specific resources.
6\. The AMF forwards the PDU Session Modification Command message to the UE to
align the PDU session context and reconfigure the related QoS rules, etc.
7\. The AMF forwards the N2 Session Release to the AN of the access to be
removed.
8\. The UE acknowledges the PDU Session Modification Command.
The UE may also request the removal of Non-3GPP access through the Service
Request procedure. If a Multi-access PDU Session is included in the PDU
Session List to be activated and the UE determines it wants to change it to
single-access PDU session, it may include a \"single access\" or \"remove
Non-3GPP access\" indication for the corresponding PDU Session in the Service
Request message. The rest of the procedure is similar to what is described in
Figure 6.2.5-1.
### 6.2.6 Modification of Multi-Access PDU session
The procedure is used when the UE or the network requests access traffic
Steering or Switching or Splitting between 3GPP and non-3GPP accesses by
referring to the ATSSS preference. ATSSS preference is part of the ATSSS Rules
and is used to indicate the preferred access type to transfer the particular
data flow.
The UE or network requested MA-PDU Session Modification procedure is depicted
in figure 6.2.6-1.
Figure 6.2.6-1: UE or network requested MA-PDU Session Modification
1\. The procedure may be triggered by following events:
1a. (UE initiated modification) The UE initiates the PDU Session Modification
procedure by the transmission of an NAS message (N1 SM container (PDU Session
Modification Request (ATSSS preference)), PDU Session ID). The AMF invokes
Nsmf_PDUSession_ UpdateSMContext (PDU Session ID, N1 SM container (PDU Session
Modification Request (ATSSS preference))). The UE derives the ATSSS preference
based on the ATSSS policy created by the PCF during the establishment of the
MA-PDU session as defined in clause 6.4.2. In addition, the ATSSS preference
may also be derived from network measurement parameters as defined in the
Solution 6 or 7.
Editor\'s note: The exact details of ATSSS preference is FFS.
1b. (SMF requested modification) The PCF performs a PCF initiated SM Policy
Association Modification procedure as defined in TS 23.502 [6] clause 4.16.5.2
to notify SMF about the modification of ATSSS policies.
1c. (SMF requested modification) The UDM updates the subscription data of SMF
regarding ATSSS by Nudm_SDM_Notification (SUPI, Session Management
Subscription Data). The SMF updates the Session Management Subscription Data
and acknowledges the UDM by returning an Ack with (SUPI).
2\. The SMF may need to report some subscribed event to the PCF by performing
an SMF initiated SM Policy Association Modification procedure as defined in
clause 4.16.5.1
3a. For UE initiated modification, the SMF responds to the AMF through
Nsmf_PDUSession_UpdateSMContext (N2 SM information (PDU Session ID), N1 SM
container (PDU Session Modification Command (PDU Session ID, ATSSS rule(s)))).
3b. For SMF requested modification, the SMF invokes
Namf_Communication_N1N2MessageTransfer (N2 SM information (PDU Session ID), N1
SM container (PDU Session Modification Command (PDU Session ID, ATSSS
rule(s)))).
4\. Steps 4 - 13 specified in TS 23.502 [6] clause 4.3.3.2 are executed.
### 6.2.7 Release of a Multi-Access PDU Session
A Multi-Access PDU session may be requested by UE or 5GC to release completely
or release partial resource (i.e., release one of child PDU sessions within
the MA-PDU session). In a PDU session release procedure in TS 23.502 [6]
clause 4.3.4 for 3GPP access and clause 4.12.7 for N3GPP access, SMF shall
take care of the two resources to be release:
(a) the IP addresses/Prefixes allocated for an IP-based PDU session; and
(b) any UPF resource (including N3/N9 termination).
However, for a MA-PDU session release operations, it has two conditions:
1) An existing MA-PDU session is asked to release of one of child PDU sessions
within it.
2) An existing MA-PDU session is asked to completely release all of child PDU
sessions within it.
For condition 1), since UE still has at least one on-going PDU session, SMF
will maintain the IP addresses/Prefixes for the UE and release the PDU session
on the required access. For condition 2), since all related PDU Sessions
within the MA-PDU Session needs to be released, SMF will release all resources
including the IP addresses/Prefixes and any UPF resource (including N3/N9).
The current PDU Session Release procedures for 3GPP and N3GPP accesses in TS
23.502 [6] can be used to support the MA-PDU Session Release conditions (i.e.,
Conditions 1 and 2). However, SMF needs to take care whether all resources
need to be released or partial resource needs to be released. In order not to
have impact on current procedures, SMF needs to know whether the current PDU
Session release request is for condition 1 or for condition 2.
In the following procedure, it is modified from clauses 4.3.4 and 4.12.7 in TS
23.502 [6].
Figure 6.2.7-1: MA-PDU Session Release Procedure
1\. The MA-PDU Session Release procedure is triggered by one of the following
events:
1a. UE request PDU Session Release.
1b. AMF request PDU Session Release.
1c. PCF request PDU Session Release.
1d. SMF request PDU Session Release.
However, for all release requests by UE or by Network shall indicate which PDU
Session ID on which Access Type within a MA-PDU Session are going to release.
Access Type indicates whether the MA-PDU Session Release procedure applies to
the 3GPP access, to the non-3GPP access, or to both accesses. In case of both
accesses, all resources of this PDU Session will be released.
2\. When SMF receives the PDU Session Release Request, it will release all
resources or partial resource according to the indication from one of the
events.
3\. Steps 3 - 10 specified in TS 23.502 [6] clause 4.3.4.2 are executed over
an access. The access can be either an indicated access (3GPP/N3GPP access) by
the UE or the Network, or a preferred access (e.g., 3GPP access) in the case
of both accesses in step 1. Additionally, Access Type is transferred between
the AMF and the SMF to indicate the access to be released.
4\. Steps 3b and 4 - 7 specified in TS 23.502 [6] clause 4.3.4.2 are executed
over a non-preferred access (e.g., non-3GPP access). If Access Type is either
the 3GPP access or the non-3GPP access in step 1 for the condition 1, this
step is skipped. Otherwise, this step is performed over a non-preferred access
in the condition 2. Access Type is also transferred between the AMF and the
SMF in this step as the step 3. The \"skip indicator\" from the SMF tells the
AMF whether it may skip sending the N1 SM container (PDU Session Release
Command) to the UE.
SMF needs to generate one PDU Session Release Command message including the
access type information if this MA-PDU Session is established with one single
PDU Session ID described in clause 6.2.3. When UE receives this PDU Session
Release Command message, it knows which access leg(s) of this MA-PDU Session
it needs to perform the release operations.
5\. Steps 11 - 12 specified in TS 23.502 [6] clause 4.3.4.2 are executed.
## 6.3 Solution 3: TFCP (Traffic Flow Control Protocol) based architecture
framework for ATSSS
In terms of architecture requirements for this solution, the proposed ATSSS
architecture framework.
### 6.3.1 Architecture framework Description
Figure 6.3.1-1: ATSSS architecture
Figure 6.3.1-2: ATSSS function
NOTE: Path Performance Measurement function includes access agnostic
performance measurement and access specific performance measurement. The MPTCP
function can use the access specific performance measurement provided by the
Path Performance Measurement function to help traffic
steering/splitting/switching, altogether with the access agnostic performance
information (e.g. RTT) measured by TCP layer itself.
#### 6.3.1.1 ATSSS Policy Control function description
The ATSSS Policy Control function in PCF defines the following policies
according to the application-specific information, the UE subscription data,
user preference, local policy or any combination of them:
\- Traffic steering policy: This rule is used to select an access when
initiating a new data flow.
\- Traffic switching policy: This rule is used to determine when a data flow
should be moved from 3GPP to non-3GPP or vice versa.
\- Traffic splitting policy: This rule is used to determine when a data flow
should be split across 3GPP and non-3GPP.
The above policies may determine the appropriate access by the following
principle, for example:
\- Smallest Delay First: The Smallest Delay path (i.e. the smallest Round-Trip
Time (RTT) path) is selected to forward traffic.
\- Load-balancing: A SDF traffic is split on both access paths, allowing for
equal or unequal traffic distribution, e.g. based on weights.
\- Active-Standby: It is used to steer a SDF on one access (the \"Active
Access\"), when this access is available, and to switch the SDF to the other
access (the Standby access), when Active Access becomes unavailable. When the
Active Access becomes available again, the SDF is switched back to this
access. If the Standby access is not defined, then the SDF is only allowed on
the Active Access and cannot be transferred on another access. For example,
the Active Access is decided based on the traffic/Application type, or user
location information, etc.
\- Traffic/Application type: Special traffic types or applications are bound
to a given access as \"Active Access\" as defined by the user or the operator.
\- User location information: Traffic is bound to a given access type as
\"Active Access\" at the specific location, e.g. non-3GPP is provided higher
priority at home or at office.
\- Redundancy transmission: Traffic is transmitted via 3GPP and non-3GPP
accesses in a redundant way to achieve the lowest latency and lower the loss
rate.
Editor\'s note: It is FFS whether and how Redundancy Transmission or other
steering policies need to be standardized.
The PCF sends the PCC rule to the SMF including the ATSSS policy. As the
extension of the PCC rule, it may include the following new parameters for
ATSSS control in a MA-PDU session:
\- A Steering Mode (Active-Standby, Smallest Delay, Load-Balancing, Redundancy
transmission).
\- A Steering Method MPTCP proxy, TFCP as described in 6.3.1.3, etc.).
\- Access Technology.
\- Routing Factor (optional).
\- Second Access Technology (optional).
\- Routing Factor (optional).
The presence of both access technology means that this PCC rule is applicable
for both accesses. It may because this PCC rule is independent on the access
technology, or it already includes both access specific rules. For example,
one traffic flow can be transported via 3GPP or/and non-3GPP access, and the
PCC rule such as the QoS policy or the charging policy are the same no matter
what is the access technology used for this traffic, then this PCC rule can
include both 3GPP and non-3GPP access technology in the ATSSS policy. Another
example, if only the charging method is different for the differnet access,
this PCC rule may include both charging method for 3GPP and non-3GPP
separately, then this PCC rule may include both access technology in the ATSSS
policy.
The Routing Factor shows the traffic distribution ratio on each access
technology when both accesses are applicable for the traffic flow. It may be
decided by PCF based on the character of the service. For example, the
operator may want the IPTV service mainly transported via the wireline access,
it then defines that the Routing Factor for wireline access is at least 80%
(NOTE 1). In this way, the 3GPP access as the second access technology can
provide some available resource, e.g. no more than 20% (NOTE 1), and avoid
excessive traffic flow impacting on the 3GPP access, especially when the fixed
access failed.
NOTE: The exact Routing Factor values do not mandate it shall be enforced
based on traffic splitting per packet. For example, a Routing Factor as \"3GPP
access : non3GPP = no more than 20% : at least 80%\" can be executed as \"3GPP
access : non3GPP access = 0% : 100%\" if the traffic splitting per packet is
not supported or enforced.
#### 6.3.1.2 ATSSS Policy Enforcement function description
The ATSSS Policy Enforcement function in SMF is responsible for ATSSS policies
enforcement and session management of all PDU sessions between 5GC and UE.
Policy Enforcement function can receive the ATSSS policies from PCF via N7 and
generates ATSSS rules to control the traffic by conveying ATSSS rules to UPF
over N4. The Policy Enforcement function can also provide ATSSS PDU session
related rules to UE during PDU session establishment and PDU session
modification.
The definition of the ATSSS rule can be included in the QoS rule. For each QoS
rule, it contains the QoS rule identifier, the QFI of the QoS Flow, the Packet
Filter Set of the UL part of the SDF template, and the QoS rule precedence
value set to the precedence value of the PCC rule from which the QoS rule is
generated. The SMF creates the ATSSS rules based on the PCC rules, and add
this ATSSS rule to QoS rule which is generated by the same PCC rule.
The QoS rule with the ATSSS rule extension contains the following new
parameters:
\- Access Technology.
\- Routing Factor (optional).
\- Second Access Technology (optional).
\- Routing Factor (optional).
The Routing Factor shows the traffic distribution ratio on each access
technology, when both accesses are applicable for the traffic flows defined in
the QoS rule. The execution of Routing Factor on UE is implementation
specific. For example, the routing ratio can be implemented as the bandwidth
value (see NOTE 1). If the Routing Factor is set to \" NULL\", it means the
traffic splitting ratio via 3GPP and non3GPP access is flexibly decided by the
UE side.
NOTE: For example, when the guaranteed bitrate=150Mbps for the packet flows,
and the routing ratio= 4:1 for non-3GPP and 3GPP access, the UE could use
120Mbps via non-3GPP and 30Mbps via 3GPP. It means a traffic flow with the
bandwidth no more than 30Mbps can be transported via 3GPP or non-3GPP access.
A traffic flow bandwidth exceed 30Mbps can be transported via non-3GPP access
or both accesses simultaneously.
Some instances for the QoS rule extension as follow:
+----------------------+----------------------+----------------------+ | - QoS rule ID=1 | - QoS rule ID=2 | - QoS rule ID=3 | | | | | | - QoS priority = A | - QoS priority = B | - QoS priority = C | | | | | | - Operation Code = | - Operation Code = | - Operation Code = | | Create | Create | Create | | | | | | - Packet Filter | - Packet Filter | - Packet Filter | | list | list | list | | | | | | - | - | - Application ID= | | I | IP | Internet | | Paddress=10.142.15.3 | address=123.180.20.5 | | | | | - PortNumber=80. | | - PortNumber=xx. | - QoS parameters: | | | | | - QoS parameters: | | - QoS parameters: | - 5QI | | | | | - 5QI | | - 5QI | - guaranteed | | | | bitrate =150 Mbps | - QoS flow ID: | | - guaranteed | | QFI=3 | | bitrate =150 Mbps | - QoS flow ID: | | | | QFI=2 | - ATSSS Rule : | | - QoS flow ID: | | | | QFI=1 | - ATSSS Rule : | - Access Technology | | | | =NG RAN | | - ATSSS Rule : | - Access Technology | | | | =NG RAN | - Factor =NULL | | - Access Technology | | | | =3GPP access | - Factor =20% | - Second Access | | | | Technology = WLAN | | | - Second Access | | | | Technology = Fixed | - Factor =NULL | | | | | | | - Factor =80% | | +----------------------+----------------------+----------------------+
NOTE 1: QoS Rule 1 and Rule 2 are applicable for GBR or non GBR flow. QoS Rule
3 is only applicable for non GBR flow. For the QoS Rule 3, the Routing Factor
is flexible based on the link performance measured by UE (UL).
NOTE 2: In the traffic splitting case, QoS Rule 1 is only used for traffic
splitting per traffic flow. QoS Rule 2 and QoS rule 3 can be used for traffic
splitting per traffic flow or per packet.
{width="6.063194444444444in" height="2.801388888888889in"}
Figure 6.3.1.2-1: The traffic splitting based on the QoS rule (with ATSSS
rule)
Editor\'s note: It is FFS if extending QoS rule to include ATSSS rule has any
impact on the existing QoS model.
#### 6.3.1.3 ATSSS function description for TFCP
The ATSSS function contains the following functionality:
\- Traffic Distribution function: Distribute traffic onto the appropriate 3GPP
or non-3GPP access path based on the ATSSS rules/Packet Detection rules and
path performance measurement.
The Traffic Distribution function forwards the traffic either over the 3GPP or
non-3GPP access or both. It determines which path may be used for an incoming
packet given traffic distribution based on the ATSSS rules/Packet Detection
rules and the state of the network. More specifically, the ATSSS rules are
from the SMF as defined in clause 6.3.1.2, the performance of each access path
is reported by the Path Performance Measurement function.
\- Traffic Recombination function: Recombine traffic flows received from the
3GPP and non3GPP access and forwards the traffic to the upper layer, e.g. IP
layer.
If the TFCP Encapsulation/Decapsulation function is used for this traffic, the
Traffic Recombination also provides reordering of potential out of order
packets based on the sequence number in the TFCP layer. The sequence number
defined in TFCP header includes single, double or triple series numbers A, B-A
or C-B-A. The number A shows the sequence number per PDU session, per QoS
flow, or per traffic flow. The optional number B distinguishes the packets
belonging to the different traffic flow. The optional number C shows the
sequence number per access if the detection of access level data loss is
necessary.
Figure 6.3.1.3-1: The usage of the sequence number in TFCP header
Editor\'s note: the impact of reordering procedure on QoS is FFS (e.g. on
different traffic classes)
The Traffic Recombination function sets a buffer memory for the TFCP traffic
flow. The length of the buffer is implementation specific. The received
packets belong to the same TFCP traffic flow shall be reordered in the buffer
based on the sequence number carried in the TFCP header. If a timer T
(implementation dependent, e.g. related with the Max{RTT-3GPP access, RTT-
non3GPP access}) elapses before the packet is received, this packet is treated
as lost. If the received packet sequence number is smaller than the smallest
sequence number stored in the buffer, or there is packet with the same
sequence number already existing in the buffer, the latter received packet is
treated as the replicated and discarded.
In the buffer, the maximum reordering time is equal to the timer T, i.e. the
received packet waits time T for the former missing ones before outputted from
the buffer. The Traffic Recombination function ensures that the packet
transmission time (RTT/2) plus maximum reordering time T satisfies the Packet
Delay Budget defined in the QoS. For the bandwidth, especially for the high
latency and high bandwidth non-GBR/GBR service (e.g. video, TCP-based flows as
defined in TS 23.501 [5], Table 5.7.4-1), transmission via both accesses can
achieve more bandwidth with the proper algorithm (NOTE 1).
NOTE 1: For example, the UE or the UPF may trigger the traffic splitting per
packet for non-GBR service when the RTT on both accesses are on the same
level, e.g. RTT1 for 3GPP is 20ms, RTT2 for non-3GPP is 25ms. The sender may
gradually increase the bandwidth on each access until the RTT for this access
is impacted or close to the latency threshold, e.g. 100Mbps with RTT1=20ms for
3GPP access, 200Mbps with RTT2=25ms for non-3GPP access, then keeping the
routing ratio 3GPP:non-3GPP =1:2 to obtain 300Mbps with RTT=25ms.
\- TFCP Encapsulation/Decapsulation function (Optional):
Encapsulate/Decapsulate the TFCP header may be applied based on the ATSSS
rules/Packet Detection rules, for example:
\- if the Smallest Delay First steering mode is used, the TFCP header is added
to solve the packet disordering issue happened when the traffic is switched to
the smallest delay path.
\- if the Load-Balancing steering mode is used, the TFCP header is added to
support any load-balancing ratio between both accesses, when there is only one
ongoing traffic for a SDF.
\- if the Redundancy transmission steering mode is used, the TFCP header is
added to support packets reordering and duplication detection.
The TFCP Encapsulation/Decapsulation function adds or removes the TFCP header
for the PDU session data. The TFCP layer may be subjected to per PDU session
per QoS flow, or per Packet Filter according to the different requirement. The
TFCP tunnel is added when it is necessary (NOTE 2, NOTE 3). According to
sequence of packets received from the upper layer, the packet Encapsulation
function set the sequence number in the TFCP header.
Editor\'s note: How the ATSSS function determines when it is necessary to add
a TFCP tunnel is FFS.
NOTE 2: For the ongoing traffic, when the TFCP tunnel is added later, the End
Marker packet can be used to distinguish the former packets without the TFCP
header and the latter packets with the TFCP header . When the TFCP tunnel is
removed, the End Marker can still be used to distinguish the former packets
with TFCP header and the latter packets without TFCP header.
NOTE 3: If the TFCP tunnel is needed for single-access PDU session in future,
such as detecting the link performance, this solution can also support the
TFCP tunnel established at the very beginning of the PDU session establishment
procedure.
#### 6.3.1.4 ATSSS path performance measurement function description
The performance of the available path is measured and reported to the Traffic
Distribution function by the Path Performance Measurement function. The path
performance measurement function is deployed in the UE and the UPF, which
means both the UE and the UPF could initiate the path performance measurement,
and the measurement result is used for traffic distribution determination.
The performance measurement parameters includes access agnostic parameters and
access specific parameters (optional). The access agnostic parameters includes
the RTT, jitter, and packet loss ratio parameters, which could be used to
justify the path performance of 3GPP access and Non 3GPP access respectively.
The access specific parameters includes the parameters which could be used to
verify the load or signal strength of each access, e.g. the RSRP/RSRQ for 3GPP
access, and the available bandwidth for Non 3GPP access (e.g. WLAN AP).
Besides, the performance measurement policies, e.g. access type for
measurement, measurement period, report threshold and/or report period, are
also included in the performance measurement parameters.
The measurement granularity could be per PDU session or per QoS flow for each
access. During the PDU session establishment/modification procedure, the SMF
provides path performance measurement parameters for the PDU session or QoS
flows, traffic of which is potentially to be distributed, to the UE in the PDU
session establishment/ modification Accept via NAS message. Besides, the SMF
also provides the PDU session ID or QFI along with path performance
measurement parameters to indicate to the UE to bind the path performance
measurement parameters with the corresponding PDU session or the QoS flow to
be measured.
After receiving the performance measurement parameters for the PDU session or
the QoS flow to be measured, the UE initiates path performance measurement for
the PDU session or QoS flow based on the path performance measurement policy:
Figure 6.3.1.4-1: Path performance measurement on UE side
\- Access agnostic performance measurement: The UE generates the TFCP echo
request message based on the measurement period, and sends the TFCP echo
request message via the 3GPP access and/or Non 3GPP access periodically. When
the UPF receives the TFCP echo request message from the 3GPP and/or Non 3GPP
access node respectively, the UPF generates the TFCP echo response message and
sends back via the corresponding access node. The RTT and jitter could be
measured via the TFCP echo request/response messages. Besides, the UE and the
UPF could exchange the sending and receiving packet data statistics to get the
packet loss ratio result. The UPF also could initiate path performance
measurement similar as UE.
NOTE 1: The measurement traffic per QoS flow can be implemented in a way
without impact on the link performance for the QoS flow, e.g. the interval of
sending TFCP echo request/response message pair for path performance
measurement can be set to a couple of minutes. Since the link performance
would not deteriorates gradually, interval set to minutes(s) for path
performance detection should be enough for ATSSS.
Based on the access agnostic performance measurement, the RTT, jitter and
packet loss ratio could be measured as following:
RTT measurement:
\- When the UE sends out the TFCP echo request message, the UE records the
local time T1.
\- When the UE receives the TFCP echo response message, the UE records the
local time T2.
The UE could calculate the RTT based on these time stamp: RTT(n) = T2-T1.
NOTE 2: Since the internal process delay of UPF for the TFCP echo
request/response message is tiny, it is ignored and not to be eliminated from
the RTT.
Jitter measurement:
\- Jitter is regarded as the reflection of transfer quality stability within
certain time interval. The UL jitter could be calculated by the UPF, and the
DL jitter could be calculated by the UE. The following solution is an example
method for calculating the UL jitter, and the DL jitter could be calculated
using the similar method.
\- It is assumed to calculate the jitter between a certain TFCP echo request
message and the Nth TFCP echo request message after such certain TFCP echo
request message by the UPF.
These continuous TFCP echo request message could be numbered from n-N+1 to n.
The average expectation value of arriving time interval between any two TFCP
echo requests could be represented as {width="0.45in"
height="0.16666666666666666in"}.
The value of variance of arriving time interval of N TFCP echo request could
be represented as {width="0.4083333333333333in"
height="0.16666666666666666in"}.
In this example, the {width="0.4083333333333333in"
height="0.16666666666666666in"} is regarded as the packet transport jitter for
the corresponding QoS Flow or PDU Session. It is assumed that
{width="0.11666666666666667in" height="0.16666666666666666in"} is the local
time of UPF when receiving the TFCP echo request message numbered by variable
k between n-N+1 and n.
{width="1.9083333333333334in" height="0.16666666666666666in"},
{width="2.0166666666666666in" height="0.3416666666666667in"}
Packet loss ratio measurement:
\- UE and UPF exchange the packet counting information in certain period to
calculate the packet loss ratio during the path performance measurement
procedure.
\- The UE counts the number of UL packets between certain TFCP echo request
message and the previous TFCP echo request message of this certain TFCP echo
request message, and provides the result to the UPF via this certain TFCP echo
request message.
\- UPF also counts the number of received UL packets between certain TFCP echo
request message and the previous TFCP echo request message of this certain
TFCP echo request message. UPF calculates the UL packet loss ratio based on
the local counting result and the number of UL packets send by UE.
\- UPF sends the UL packet loss ratio result and the counting number of DL
packets between certain TFCP echo response message and the previous TFCP echo
response message of this certain TFCP echo response message to the UE via this
certain TFCP echo response message.
\- UE also counts the number of received DL between certain TFCP echo response
message and the previous TFCP echo response message of this certain TFCP echo
response message. UE calculates the DL packet loss ratio based on the local
counting result and the number of DL packets send by UPF.
\- Access specific performance measurement (optional): The UE can measure the
radio signal strength for the 3GPP access and the available bandwidth of Non
3GPP access.
Based on the report threshold or period of performance measurement parameters,
the UE could provide the measurement result to the UPF as described in the
step 3 of Figure 6.3.1.4-1, via user plane directly or via control plane to
SMF and then from SMF to the UPF.
Considering the scheduling and transmission delay of Uu interface is
asymmetric for UL traffic and DL traffic even for one QoS flow, the UPF may
also need to initiate the path performance measurement procedure for
calculation of DL jitter, using the same mechanism as for UL jitter
calculation, i.e. the UPF sends the TFCP echo request message to the UE
periodically, and the UE sends the TFCP echo response message to the UPF. The
UE could calculate the DL jitter of the QoS flow using the same method as UPF
calculating UL jitter. The UE could provide the DL jitter result to the UPF
via TFCP echo response message.
When the \"Smallest Delay\" steering mode is selected for a service data flow,
the UE and UPF could select the available access for the UL and DL SDF based
on above several combined measured parameters. The following provides some
examples to illustrate how to use combined measured parameters to select the
available access by the UE and UPF:
\- RTT and Packet loss ratio: The AN node may drop a number of packets to
reduce the load condition in order to achieve the better RTT. In such case,
even the RTT is better, the packet loss ratio may be terrible, so the UE and
UPF could take both RTT and packet loss ratio as the factors when selecting
the available access for the SDF.
\- RTT and jitter: The measured RTT may change frequently when the quality of
radio interface is not stability. The measured RTT may be small in certain
measurement, while may be large in the next measurement. If the UE and UPF
selects the available access only based on RTT, the SDF may be switched
frequently between two access paths. This may bring bad impaction to the
application. Since jitter could reflect the transfer quality stability of the
access within certain time interval, the UE and UPF could take both RTT and
packet loss ratio as the factors when selecting the available access for the
SDF.
NOTE 3: If all detected QoS parameters of each access fulfil the service
requirement, the access with smallest RTT is suggested to be selected. If one
or more of the detected QoS parameters of each access cannot fulfil the
service requirement, the UE and the UPF could select the available access
based on local policy, e.g. the potential vMOS of the service could be
calculated by the UE and the UPF using the detected QoS parameters as input,
and the access with better vMOS can be selected.
### 6.3.2 Protocol Stacks
This clause illustrates the protocol stack for the User plane transport
related with a PDU Session. In this solution, traffic between the UE and the
UPF is tunnelled via a TFCP layer.
Figure 6.3.2-1: User Plane Protocol Stack for 3GPP access
Figure 6.3.2-2: User Plane Protocol Stack for non-3GPP access
### 6.3.3 PDU Session Establishment Procedure
This procedure describes how the UE triggers PDU Session establishment via
both 3GPP and non-3GPP access. More specifically, it covers the following
scenarios:
\- Scenario 1: one PDU Session is already established via one access, then the
UE triggers to add an additional access to the existing PDU Session.
\- Scenario 2: UE triggers to establish a PDU Session supporting multi-access,
i.e. establish Multi-access PDU Session (e.g. via both 3GPP and Non 3GPP
accesses) in one procedure.
NOTE: The above Scenario 1 is very similar as NBIFOM in EPC.
Figure 6.3.3-1: Multi-Access PDU Session establishment procedure with TFCP
tunnel
0\. UE is registered to 5GC via 3GPP and non-3GPP access. The UE may have
established one PDU Session via 3GPP or non-3GPP access, as specified in TS
23.502 [6] clause 4.3.2.2 or clause 4.12.5.
1\. The UE determines to establish a multi-access PDU Session based on the
policy. The UE may add an additional access to the existing PDU Session or
trigger a new PDU Session establishment procedure to establish the multi-
access PDU Session. To be specific, the UE sends NAS Message to AMF including
PDU Session ID, request type, and PDU Session Establishment Request message.
\- If the UE decides to add an additional access to the existing PDU Session,
the UE sets the request type to \"Existing PDU Session\". In the PDU Session
Establishment Request message, the UE sends a multi-access indication to
request the multi-access PDU Session. In addition, if the UE determines to
establish the TFCP tunnel in this PDU Session, the UE allocates the TFCP
tunnel Info and sends it to the SMF in the PDU Session Establishment Request
message. Additionally, the UE indicates the TFCP tunnel subjected to per PDU
session, per QoS flow or per Packet Filter by sending the TFCP indication
binding with the PDU session ID, QFI or Facket Filters. This TFCP indication
shows that the UE requests to add the TFCP header for packets belonging to
this PDU session, or QoS flow, or Packet Filter.
NOTE: The contents of the TFCP tunnel info depend on the definition of TFCP
protocol. For example, if the GRE protocol is used as the TFCP layer, the TFCP
tunnel Info can be the GRE key.
\- If the UE decides to establish a new PDU Session for multi-access, the UE
sets the request type to \"Initial Request\". The other handling is the same
as the above one.
2\. The AMF sends Nsmf_PDUSession_CreateSMContext Request to the SMF including
the PDU Session Establishment Request message.
\- If request type indicates \"Existing PDU Session\", the AMF selects the
same SMF serving the PDU Session identified by the PDU Session ID received in
the request.
Editor\'s note: It is FFS when the existing SMF cannot support multi-access
PDU Session.
\- If request type indicates \"Initial Request\", the AMF selects an SMF that
supports multi-access PDU Session.
3\. If Request Type indicates \"Initial request\"and if the SMF has not yet
registered for this PDU Session ID, then the SMF registers with the UDM. If
Session Management Subscription data is not available, then SMF retrieves the
Session Management Subscription data. The SMF may check the validity of the UE
request based on the subscription data and network policy.
4\. The SMF performs a Session Management Policy Establishment procedure or a
Session Management Policy Modification procedure with the PCF. The PCF may
determine whether the UE is allowed to establish the MA-PDU session. The PCF
determines the ATSSS policy and send the ATSSS policy to the SMF.
5\. If allowed, the SMF selects the UPF and sends N4 Session Establishment
Request/Modification Request message to the selected UPF. For the existing PDU
Session, if there are more than one serving UPFs, the SMF selects N3 UPF or
anchor UPF to send the N4 Session Modification Request message.
The SMF sends N4 Session Establishment/Modification Request to the UPF. If the
UE requested to use the TFCP tunnel and the network supports the TFCP
protocol, the SMF authorized to establish the TFCP tunnel. If UPF TFCP Tunnel
Info is allocated by the SMF, the UPF TFCP Tunnel Info, UE TFCP Tunnel Info
and the corresponding QoS flow Info are provided to UPF in this step. If UPF
TFCP Tunnel Info is allocated by the UPF, the SMF sends UE TFCP Tunnel Info
and the corresponding QoS flow Info to the UPF. The UPF TFCP Tunnel Info is
provided to SMF in the response message. Additionally, the SMF indicates the
TFCP tunnel applicable for per PDU session, per QoS flow or per Packet Filter.
6a-6b. The SMF invokes the single or both separate N2 PDU Session
establishment procedures according to Multi-Access indication and the request
type.
\- If the request type indicates \"Existing PDU Session\", the SMF only
performs step 5a. The SMF sends Namf_Communication_N1N2MessageTransfer to the
AMF including the Multi-Access indication, N2 SM information, 3GPP access and
PDU Session establishment Accept message. The Multi-Access indication notifies
the AMF that it is the Multi-Access PDU Session. The PDU Session establishment
Accept message is included in this message based on the 3GPP access type
received in the step2. The SMF also indicates 3GPP access as the target access
in the message. In the PDU Session Establishment Accept message, it includes
the QoS Rule(s) with 3GPP or/and non-3GPP access type. The access type(s)
included in the Authorized QoS Rule indicate the authorized access type used
for the traffic flows matching this QoS Rule. Optionally, when both 3GPP and
non-3GPP are allowed by this QoS rule, it may include the Routing Factor for
every access, as specified in subclause 6.3.1.2.
\- If the request type indicates \"Initial Request\", the SMF performs step 5a
and 5b. In step 5b, the SMF sends Namf_Communication_N1N2MessageTransfer to
the AMF including the Multi-Access indication, Non-3GPP access and N2 SM
information.
The SMF sends the N2 SM information (PDU Session ID, QFI(s), QoS Profile(s))
to the NG-RAN or/and N3IWF. The QoS Profile(s) is calculated from the
information provided by the PCF. If there is Routing Factor defined for some
Packet Filters, the creation of the QoS profile(s) for NG-RAN or/and N3IWF is
as below:
\- For non-GBR QoS flow: No impact, the same as the existing procedure.
\- For GBR QoS flow: The QoS profile(s) for one access needs to be calculated
according to the QoS parameters related with this access type. For example,
there are Packet Filters 1, Packet Filters 2 and Packet Filters 3 bound to one
QoS flow, and the GFBR=45Mbps. More specific:
\- Packet Filters 1: guaranteed bitrate =5Mbps, access type=3GPP access.
\- Packet Filters 2: guaranteed bitrate =10Mbps, access type = non 3GPP
access.
\- Packet Filters 3: guaranteed bitrate =30Mbps, access type =3GPP, routing
ratio =20%; Second access type =non-3GPP, routing ratio=80%.
QoS profile for 3GPP access: guaranteed bitrate = (QoS rule 1= 5) + (QoS rule
3=30*0.2) =11Mbps.
QoS profile for non-3GPP access: guaranteed bitrate = (QoS rule 2=10) + (QoS
rule 3=30*0.8) =34Mbps.
The AMF marks this PDU Session as Multi-Access PDU Session according to the
Multi-Access indication received from SMF.
7\. The AMF initiates N2 session procedures towards 3GPP RAN, and forwards the
RAN tunnel Info to the UE.
8\. The SMF sends the RAN tunnel Info and 3GPP access type to the selected UPF
in step 3.
9\. The 5G RAN forwards the PDU Session establishment Accept message to the
UE. The existing of the UPF TFCP tunnel Info and TFCP indication with the
binding PDU session ID, or QoS flow Info or Packet Filter included in the PDU
Session Establishment Accept message indicates the successful establishment of
the TFCP tunnel.
10\. The AMF initiates N2 session procedures towards N3IWF, and forwards the
N3IWF tunnel Info to the SMF.
11\. The SMF sends the N3IWF tunnel Info and Non-3GPP access type to the
selected UPF in step 3. The UPF stored both access tunnel information and the
binding access type for this Multi-Access PDU Session. This binding
relationship can be used when performing the traffic splitting or switching in
user plane.
In user plane, the UE and the UPF detect the existing of TFCP header based on
the following information:
\- per PDU session: all the packets transported via one PDU session include
the TFCP header. The TFCP packets can be identified by the GTP-U tunnel for
this PDU session.
\- per QoS flow: all the packets transported via one QoS flow use the TFCP
header. The UE and the UPF identify the TFCP packets based on the QFI included
in the SDAP and GTP-U layer.
\- per traffic flow: all the packets belonging to this traffic flow have TFCP
header. In order to differentiate the TFCP packets from other packets in the
same QoS flow, the UE and the UPF create a TFCP indication in the SDAP or
GTP-U layer for the inner data with TFCP encapsulation.
NOTE: The TFCP indication added to SDAP will occupy one bit of the SDAP
header.
### 6.3.4 PDU Session Modification procedure
This procedure can be used in the following scenarios:
\- UE or network requested traffic steering in 3GPP or non-3GPP access;
\- UE or network requested traffic switching from 3GPP to non-3GPP access and
vice versa;
\- UE or network requested traffic splitting in 3GPP and non-3GPP access.
Figure 6.3.4-1: Multi-Access PDU Session Modification procedure
1a. (UE requested modification) This procedure may be triggered by UE
transmission of a PDU Session Modification Request message to the AMF. The UE
sends the Packet Filters, Operation, requested QoS, and the requested access
type(s). The requested access type indicates 3GPP access or non-3GPP access or
both accesses.
UE may send the PDU Session Modification Request message via 3GPP access or
non-3GPP access. For traffic steering/switching/splitting, the UE may include
Packet Filters targeting in 3GPP access or/and Packet Filters targeting in
non-3GPP access in one PDU session modification request message. If the UE
decided to initiate the TFCP encapsulation for the following cases, the UE
indicates the TFCP tunnel subjected to per QoS flow or per Packet Filter by
sending the TFCP indication binding with the QFI or Packet Filters.
\- Steering: when the loss ratio is higher in one access, redundancy steering
can be applied. The requested access type sent in the ATSSS rule includes 3GPP
and non-3GPP with the routing factors 100% on both sides. The convergence TFCP
tunnel is established to support the packet reordering and the replication
packet elimination.
\- Switching: when the link performance via the current access is
deteriorated, the traffic should be moved to the other access. The packets are
replicated via both accesses during the traffic switching execution phase in
order to lower the transmission delay and the loss ratio. The temporary
convergence TFCP tunnel is used to perform the packet reordering and the
replication packet elimination in the traffic switching execution phase.
\- Splitting: when only one access cannot satisfy the bandwidth requirement,
the traffic splitting per packet is initiated. The convergence TFCP tunnel can
provide sufficient resource taking advantage on both accesses.
1b. (Network requested modification) The PCF performs a Session Management
Policy Modification procedure to notify the SMF about the ATSSS policy. This
may be triggered by the update of ATSSS policy or upon AF requests. If the SMF
decided to initiate the TFCP encapsulation based on the ATSSS policy or the
similar cases as defined in 1a, the SMF indicates the TFCP indication binding
with the QFI or Packet Filters in the PDU session Modification Command
message.
2\. (UE requested modification) The SMF notifies the PCF about the requested
or updated Routing information. The PCF authorizes the Routing information,
generates PCC rule including the ATSSS policy and send it to the SMF.
3a-3b. (UE requested modification) The SMF acknowledges the authorized QoS
rule including the ATSSS rule by sending the N1 SM container to the UE. The
Packet Filters, Authorized QoS, Authorized access type(s) are included in the
Authorized QoS rule.
If there are QoS profile(s) updated for the other access, the SMF sends the
updated N2 SM information (PDU Session ID, QFI(s), QoS Profile(s)) to NG-RAN
or N3IWF via Namf_Communication_N1N2MessageTransfer message.
3c-3d. (Network requested modification) The SMF generates QoS rules including
the ATSSS rules based on the ATSSS policy received from the PCF. The SMF may
invoke two N1N2MessageTransfer for traffic in each access separately. The QoS
rules are included in one Namf_Communication_N1N2MessageTransfer message via
one access.
4a. The AMF sends N2 Session Request to the NG-RAN, including the PDU session
modification command message if received from SMF and N2 SM information
containers for 3GPP access.
4b. The AMF sends N2 Session Request to the N3IWF, including the PDU session
modification command message if received from SMF and N2 SM information
containers for non-3GPP access.
5a-5b. The NG-RAN or N3IWF forwards the PDU session Modification Command to
the UE, including the Authorized QoS rules. For non-3GPP access, there may be
IPSec update procedures as defined in TS 23.502 [6] clause 4.12.6 steps from
4a to 4d. If the TFCP tunnel is requested by UE in step1a, the TFCP indication
with the binding QoS flow Info or Packet Filter included in the PDU session
Modification Command message indicates the successful establishment of the
TFCP tunnel.
6\. The NG-RAN or/and N3IWF may acknowledge N2 PDU Session Request by sending
a N2 PDU Session Response to the AMF.
7\. The AMF forwards the N2 SM information to the SMF.
8 The UE acknowledges the PDU Session Modification Command by sending a NAS
message (PDU Session ID, N1 SM container (PDU Session Modification Command
Ack)) message. For network requested modification procedure, the UE includes
the acknowledgement of the QoS rule including the ATSSS rule and the
establishment of the TFCP tunnel in this step.
9-11. The same as the existing procedures described in TS 23.502 [6] clause
4.3.3. If the TFCP tunnel is established, the SMF indicates the TFCP tunnel
applicable for per QoS flow or per Packet Filter in step 11 to the UPF.
### 6.3.5 ATSSS Execution Procedure
The ATSSS execution procedure descripts how the ATSSS is executed based on the
link quality detection and feedback. The UPF or the UE performs link detection
and provides the measurement result to the SMF via control plane, the SMF
updates the ATSSS rule based on the received measurement results from the UPF
or the UE and configures the updated ATSSS rule to the UE or the UPF. The UE
or the UPF apply the updated ATSSS rule. The detailed call flow can be
illustrated in the following procedures, representing the downlink and uplink
procedure independently.
Figure 6.3.5-1: Downlink ATSSS execution procedure
The procedure is applied for ATSSS execution, in which the UPF implements the
ATSSS operation (steering, switching, splitting) based on the ATSSS rule and
the status of the network. In this procedure, it is assumed that UE has
already established PDU sessions over 3GPP and non-3GPP access.
1\. UE establishes the PDU sessions over 3GPP and non-3GPP access. And the
ATSSS rule is configured at the UE and SMF.
2\. The ATSSS control functionality entity in the SMF determines to perform
ATSSS operation.
3\. SMF configures the ATSSS rule and operation command to the UPF.
4\. UPF executes the ATSSS rule, when downlink data arrives, the UPF entity
determines the appropriate access path based on the ATSSS rule.
5\. UPF sends the downlink data to the UE via the selected access path.
6\. UE performs path performance measurement for each access path, e.g. the
data loss rate, latency, the radio signal quality and reports the results to
the SMF via SM-NAS signalling based on the configured reporting condition.
7\. SMF updates the ATSSS rule considering UE feedback;
8\. SMF sends the updated ATSSS rule to the UPF;
9\. UPF implements the updated ATSSS rule and may adjust the access path for
the service; e.g. switching the path from one access to another one or
start/stop splitting operation for the uplink data based on the updated ATSSS
rule;
10\. UPF sends the downlink data to the UE via the adjusted access path.
Figure 6.3.5-2: Uplink ATSSS execution procedure
The procedure is applied for ATSSS operation uplink transmission, in which the
UE implements the ATSSS operation based on the ATSSS rule and the status of
the network. In this procedure, it is assumed that UE has already established
PDU sessions over 3GPP and non-3GPP access.
1\. UE establishes the PDU sessions over 3GPP and non-3GPP access. And the
ATSSS policy is configured at the UE and SMF.
2\. The ATSSS control functionality entity in the SMF determines to perform
ATSSS operation.
3\. SMF configures the ATSSS rule and operation command to the UE.
4\. The TFCP entity in the UE implements ATSSS rule, and when uplink data
arrives, the UE entity determines the appropriate access path based on the
ATSSS rule.
5\. UE sends the uplink data to the UPF via the selected access path.
6\. UPF performs path performance measurement, e.g. the data loss rate,
latency and reports the results to the SMF based on the configured report
condition.
7-8. SMF updates the ATSSS rule based on UPF feedback and provides the updated
ATSSS rule to the UE;
9\. UE implements the updated ATSSS rule and may adjust the access path for
the service, e.g. switching the path from one access to another one or
start/stop splitting operation for the uplink data based on the updated ATSSS
rule;
10\. UE sends the uplink data to the UPF via the adjusted access path.
### 6.3.6 Solution evaluation
#### 6.3.6.1 Impacts on existing entities and interfaces
TFCP part of the solution has impact on both UE and UPF. It increases the
whole packet size transported by TFCP with addition of the TFCP Tunnel Info to
each packet header. In order to minimize the impact on user plane performance,
the TFCP layer could be added per packet filter, per QoS flow or per PDU
session dynamically when it is needed. This may impact the performance of the
User Plane.
## 6.4 Solution 4: Policy for Access Traffic Steering, Switching and Splitting
### 6.4.1 General
This solution assumes that the access traffic steering, switching and
splitting decisions for a MA-PDU session are based on policy (called ATSSS
policy) that is provisioned in the UE and in the UPF. The ATSSS policy is
created by the PCF during the establishment of a MA-PDU session. Under this
assumption, the solution specifies:
(a) The contents of the ATSSS policy; and
(b) How the ATSSS policy can be applied for deciding how to distribute the
traffic of a MA-PDU session.
The traffic of the MA-PDU session could be distributed across the two accesses
of the MA-PDU session by using different steering modes (or \"steering
strategies\"). Some of these steering modes are discussed in the table below.
NOTE 1: The steering modes discussed in this clause can be used for (i) access
traffic steering, (ii) access traffic switching and (iii) access traffic
splitting, as defined in clause 3.1 (\"Definitions\"). However, for simplicity
they are called \"steering\" modes.
NOTE 2: Each steering mode in the table below can be applied either for a
specific data flow or for the entire traffic of a MA-PDU session.
Table 6.4.1-1: Steering modes for traffic distribution in a MA-PDU session
+-----+------------------------------+------------------------------+ | | Steering Mode | Comments | +-----+------------------------------+------------------------------+ | #1 | { | **Active-Standby steering:** | | | width="2.8020833333333335in" | All (or some of) the traffic | | | he | of the MA-PDU session is | | | ight="2.7305555555555556in"} | sent to one access only, | | | | which is called the | | | | \"Active\" access. The other | | | | access serves as a | | | | \"standby\" access and takes | | | | traffic only when the active | | | | access becomes unavailable. | | | | When the active access | | | | becomes available again, the | | | | traffic is transferred to | | | | the active access. | | | | | | | | The active access can be | | | | defined when the MA-PDU | | | | session is established and | | | | can either (a) remain the | | | | same during the lifetime of | | | | the MA-PDU session or (b) | | | | can change during the | | | | lifetime of the MA-PDU | | | | session. | | | | | | | | - Benefit: The MA-PDU | | | | session can provide enhanced | | | | continuity. Traffic can be | | | | switched from the active | | | | access to the standby access | | | | and vice versa with minimum | | | | or no signalling. | | | | | | | | - Complexity: Small. | +-----+------------------------------+------------------------------+ | #2 | { | **Priority-based steering** : | | | width="2.8020833333333335in" | The two accesses are | | | he | assigned a priority, e.g. | | | ight="2.7305555555555556in"} | during the establishment of | | | | the MA-PDU session. All | | | | traffic (or some) of the | | | | MA-PDU session is sent to | | | | the high priority access. | | | | When congestion arises on | | | | the high priority access, | | | | new data flows (the | | | | \"overflow\" traffic) are | | | | sent to the low priority | | | | access. In addition, when | | | | the high priority access | | | | becomes unavailable, all | | | | traffic is switched to the | | | | low priority access. | | | | | | | | If needed, it could be | | | | possible to change the | | | | priorities of the accesses | | | | during the lifetime of the | | | | MA-PDU session. | | | | | | | | - Benefit: The MA-PDU | | | | session can provide enhanced | | | | continuity and increased | | | | bandwidth (because both | | | | accesses can be used | | | | simultaneously). | | | | | | | | - Complexity: Requires the | | | | UE and/or the network to | | | | determine when congestion | | | | arises on the high priority | | | | access. This may be a | | | | complex task. | +-----+------------------------------+------------------------------+ | #3 | | **Best-Access steering** : | | | {width="2.801388888888889in" | The same as the | | | h | Priority-based steering but | | | eight="2.597916666666667in"} | with the following | | | | difference: The high | | | | priority access is the one | | | | that can provide the best | | | | performance, e.g. the one | | | | with the smallest RTT. In | | | | this case, the high priority | | | | access is not pre-defined | | | | (as in Priority-based | | | | steering) but it is | | | | estimated in real-time and | | | | can change dynamically. | | | | | | | | - Benefit: The MA-PDU | | | | session can provide enhanced | | | | continuity, increased | | | | bandwidth and better | | | | performance (compared to | | | | Priority-based). | | | | | | | | - Complexity: Requires the | | | | UE and/or the network to | | | | estimate the best access and | | | | to determine when congestion | | | | arises on the best access. | | | | This may be a complex task. | | | | | | | | NOTE: The best access could | | | | be estimated by the network | | | | by using Access Measurements | | | | as those considered in | | | | Solution 1 (see TR 23.793, | | | | clause 6.1.2.1) or by using | | | | a Path Performance | | | | measurement function as the | | | | one considered in Solution 3 | | | | (see TR 23.793, | | | | clause 6.1.2.1). | +-----+------------------------------+------------------------------+ | #4 | | Redundant steering: All (or | | | {width="2.801388888888889in" | some) data flows are | | | h | transmitted on both accesses | | | eight="2.597916666666667in"} | in order to increase | | | | reliability. | | | | | | | | - Benefit: The MA-PDU | | | | session can provide very | | | | high data reliability (i.e. | | | | very small packet error | | | | rate) and session | | | | continuity. | | | | | | | | - Complexity: High - The | | | | receiving side should be | | | | able to detect and discard | | | | duplicate packets. For this | | | | purpose, the sending side | | | | could append sequence | | | | numbers to the transmitted | | | | packets. In addition, to | | | | provide in-sequence | | | | delivery, the receiving side | | | | should be able to buffer and | | | | re-order the received | | | | packets. | +-----+------------------------------+------------------------------+ | #5 | { | **Load-balance steering** : | | | width="2.8020833333333335in" | Each access receives a | | | he | percentage of the data flows | | | ight="2.7305555555555556in"} | transmitted via the MA-PDU | | | | session. Each access is | | | | assigned a weight factor | | | | (e.g. 50%) and receives a | | | | percentage of the MA-PDU | | | | session traffic | | | | corresponding to this | | | | factor. | | | | | | | | In a 50/50 load-balancing, | | | | the overall traffic of the | | | | MA-PDU session is equally | | | | split across the two | | | | accesses. In an 80/20 | | | | load-balancing, about 80% of | | | | the overall traffic is sent | | | | on one access and 20% on the | | | | other access. | | | | | | | | - Benefits: The MA-PDU | | | | session can provide | | | | bandwidth aggregation with a | | | | certain load balancing | | | | ratio. | | | | | | | | - Complexity: Relatively | | | | small - There is no need to | | | | assess the transmission | | | | performance on every access. | +-----+------------------------------+------------------------------+
Editor\'s note: Whether additional steering modes should be considered is FFS.
In the context of ATSSS, the Active-Standby steering mode (#1) should be
supported as it provides benefits and minimum complexity. Note that the
Active-Standby steering mode can be applied to all or to some of the traffic
of a MA-PDU session. For example, applying Active-Standby steering to TCP/port
1234 traffic means that this traffic should be transferred on the Active
access, if available, or on the Standby access, when the Active access is
unavailable. It is possible also to define no Standby access, in which case
the traffic is restricted to one access only and it is forbidden on the other
access.
Editor\'s note: Steering modes #2-#5 should be further evaluated especially in
terms of complexity before deciding to support them for ATSSS or not.
### 6.4.2 Content of ATSSS Policy
The steering modes discussed above could be applied in a MA-PDU session by
enforcing the appropriate ATSSS policy for the MA-PDU session. For example,
during the establishment of an MA-PDU session, the PCF in the network could
create the ATSSS policy for the MA-PDU, which could then be transferred to UE
for uplink traffic steering and to UPF for downlink traffic steering.
The ATSSS policy includes a prioritized list of ATSSS rules and each ATSSS
rule includes a steering mode that should be applied to the traffic matching
this rule. For example, the ATSSS policy for a MA-PDU session could contain:
First ATSSS rule (priority 1):
\- Traffic filter: Traffic of App-X.
\- Steering mode: Active-Standby steering; Active access: 3GPP, Standby
access: non-3GPP.
Second ATSSS rule (priority 2):
\- Traffic filter: TCP traffic with destination IP address 10.10.0.1.
\- Steering mode: Active-Standby steering; Active access: 3GPP, Standby
access: None.
Default ATSSS rule (least priority):
\- Traffic filter: All traffic.
\- Steering mode: Active-Standby steering; Active access: non-3GPP, Standby
access: 3GPP.
The first ATSSS rule steers the traffic of App-X to 3GPP access, if available;
if not available, it steers the traffic to non-3GPP access. The second ATSSS
rule steers the TCP traffic with destination IP address 10.10.0.1 to 3GPP
access only. Since no standby access is defined, this traffic cannot be
transferred over non-3GPP access, even when the 3GPP access becomes
unavailable. The default ATSSS rule steers the rest of the traffic to
non-3GPP, if available; if not available, it is steered to 3GPP access.
If more steering modes are supported, then more advanced ATSSS rules could be
constructed and more advanced traffic steering strategies could be enforced.
Below we provide a few examples.
Example 1: If the operator has deployed a video streaming server at address
10.10.0.2, then the streaming traffic between the UE and this server could be
load-balanced across 3GPP and non-3GPP access with the following ATSSS rule:
ATSSS rule (priority x):
\- Traffic filter: UDP traffic to IP address 10.10.0.2.
\- Steering mode: Load-balanced steering; 3GPP access: 30%, non-3GPP access:
70%.
Example 2: If the network should provide very small packet error rate (i.e.
high reliability) when the UE communicates with an application server over
TCP/port 1234, then the following ATSSS rule could be provisioned:
ATSSS rule (priority x):
\- Traffic filter: TCP traffic to port 1234.
\- Steering mode: Redundant steering.
Example 3: If all the traffic sent over a MA-PDU session should be transferred
with the best possible performance, then the following ATSSS rule could be
provisioned:
Default ATSSS rule:
\- Traffic filter: All traffic.
\- Steering mode: Best-access steering.
Example 4: If all the traffic of a MA-PDU session should be offloaded to
non-3GPP access but avoid congestion over non-3GPP access to severely impact
the performance, then the following ATSSS rule could be provisioned:
Default ATSSS rule:
\- Traffic filter: All traffic.
\- Steering mode: Priority-based steering; High-priority: non-3GPP, Low-
priority: 3GPP.
### 6.4.3 Traffic Distribution based on ATSSS Policy
The figure below shows how the UE or the UPF can apply the provisioned ATSSS
rules for deciding how to distribute the traffic of a MA-PDU session across
the 3GPP and the non-3GPP accesses. The ATSSS rules shown in this figure are
example rules that aim to explain how they can be used for selecting the
access on which a data flow should be transmitted.
{width="3.9590277777777776in" height="7.00625in"}
Figure 6.4.3-1: Applying ATSSS rules for deciding how to distribute the
traffic of a MA-PDU session
## 6.5 Solution 5: Multipath TCP (MPTCP) proxy architecture
### 6.5.1 General
This solution addresses Key Issues #1 and #4.
Multipath TCP (MPTCP) defined in [8] is a set of extensions to regular TCP to
provide a Multipath TCP service, which enables a transport connection to
operate across multiple paths simultaneously.
MPTCP defines how to setup multiple paths (\"subflows\"), manage these
subflows, reassemble of data and terminate sessions.
The simultaneous use of multiple disjoint (or partially disjoint) paths across
the network increases the resilience of the connectivity by providing multiple
paths, protects UEs from the failure of one path, and it also increases the
efficiency of the resource usage, and thus increases the network capacity
available to UEs.
### 6.5.2 MPTCP proxy
When communicating with traditional TCP servers, MPTCP capable devices have to
fall back to traditional TCP and cannot fully utilize their MPTCP capability.
In order to support the use of MPTCP session between an MPTCP host and a TCP
host, or to help to aggregate MPTCP subflows, an MPTCP proxy needs to be
introduced.
{width="6.69375in" height="1.6395833333333334in"}
Figure 6.5.2-1: Illustration of an MPTCP proxy
The MPTCP proxy makes it possible to achieve the benefits of MPTCP for access
aggregation and route selection without requiring MPTCP support in all TCP
servers.
### 6.5.3 Addition of MPTCP proxy to 5GC
In order to introduce the MPTCP proxy to 5GC and allow 3GPP UEs to make use of
the MPTCP capability, the UPF shall incorporate the MPTCP proxy functionality
for the MPTCP PDU session.
{width="6.072916666666667in" height="3.811111111111111in"}
Figure 6.5.3-1: Addition of MPTCP proxy to 5GC
An operator may support one or more MPTCP proxies that are reachable from the
access side via separate IP addresses. Each of these proxy IP addresses does
not necessarily correspond to a specific access type (3GPP or non-3GPP), but
it will need to be associated with one of the proxy protocol types below. If
multiple proxy protocol types are supported on an IP address, they will need
to be indicated to the UE using separate proxy entries. Each proxy entry
corresponds to the IP address of the proxy, the port that the service is
running on, and the protocol type. The UE needs to be configured with one or
more of these entries in order for it to send all or selected MPTCP traffic to
the proxy. These entries act as the authoritative source of information for
the MPTCP proxy server IP addresses.
The MPTCP proxy shall implement at least one of the following proxy protocol
types to communicate with the UE:
Type 1. SOCKS v4 or v5 Proxy, RFC 1928 [9];
\- Advantages: Well-known, well-supported.
\- Disadvantages: Additional connection-setup latency, protocol chattiness.
Type 2. Transport converter, draft-ietf-tcpm-converters-0 [10];
\- Advantages: Well supported (adopted by the IETF TCPM (TCP Maintenance)
Working Group), designed specifically for the MPTCP use case, provides 0-RTT
protocol conversion service, no overhead, can support other TCP conversion
services such as TCPinc.
\- Disadvantages: 0-RTT connections between UE and proxy rely on TCP Fast Open
[aa] which needs to be supported by the UE and proxy, and the TFO option (if
present) must not be stripped away by any nodes in between the UE and proxy;
IETF standardization process is ongoing (milestone Dec 2018).
### 6.5.4 MA-PDU session establishment procedure for MPTCP traffic
This solution supports the Multi-Access PDU session establishment defined in
clause 6.2. Each of the PDU sessions may have its own set of UPFs, but both
child PDU sessions share a common PDU session anchor (PSA).
This procedure is based on the procedure defined in clause 6.2.2.2 with the
following exceptions:
1\. The UE requests the network to select an MPTCP proxy on the user plane;
2\. The MPTCP proxy information is transported back to the UE; this includes
the proxy entries.
3\. The child PDU sessions do not share a common IP address and/or IPv6
prefix, but they are allocated separate IP addresses and/or IPv6 prefixes.
Figure 6.5.4-1: UE-requested MPTCP PDU Session Establishment for non-roaming
and roaming with local breakout
1\. The UE initiates the \"UE Requested PDU Session Establishment\" procedure
as specified in TS 23.502 [6] clause 4.3.2.2.1 on 3GPP access with an
additional preference to establish an MA- PDU Session. The UE can also first
initiate the PDU Session Establishment procedure on untrusted non-3GPP access.
NOTE: The UE could also setup two independent PDU sessions for MPTCP
procedures as defined in clause 6.2.2.1. In this case, the UE receives the
address of the MPTCP proxy during the \"linked\" PDU session establishment.
2\. If the network supports MPTCP procedures, the AMF selects an SMF that
supports MPTCP procedures.
3\. The AMF sends an Nsmf_PDUSession_CreateSMContext Request to SMF.
4\. The SMF registers with the UDM.
5\. The SMF sends an Nsmf_PDUSession_CreateSMContext Response to AMF.
6\. Optional Secondary authorization/authentication.
7a. If dynamic PCC is deployed, the SMF performs PCF selection.
7b. The SMF may perform a Session Management Policy Establishment.
8\. The SMF selects an UPF that incorporates an MPTCP proxy functionality.
9\. SMF may perform a Session Management Policy Modification procedure.
10-17. The user plane of the PDU session over 3GPP access is established and
the UE creates the first MPTCP subflow over the 3GPP access, or over the
non-3GPP access once the PDU Session is established over the untrusted
non-3GPP access.
\- In step 11, the SMF indicates to AMF the MPTCP proxy entries, i.e. IP
addresses, ports and proxy protocol types (SOCKSv4/v5 or Transport converter).
\- In step 13, if the network supports MPTCP procedures, the UE receives a PDU
Session Establishment Accept message containing the MPTCP proxy entries, thus,
the UE determines that an MPTCP PDU session over 3GPP access is established
and in case an MPTCP proxy is allocated, it selects one protocol to contact
the MPTCP proxy from the proxy protocol types associated with the proxy IP
addresses provided by the network.
19-27. The user-plane of the PDU session over untrusted non-3GPP access is
established and the UE creates an additional MPTCP subflow over the untrusted
non-3GPP access.
NOTE: The steps 10-17 and 19-27 can be executed in parallel.
### 6.5.5 ATSSS and URSP rules for MPTCP
#### 6.5.5.1 URSP rules for MPTCP
In Rel‑15, the UE is responsible for establishing new PDU session(s) based on
URSP rules provided by the network (PCF) and/or preconfigured in the UE as
described in TS 23.503 [7] clause 6.6.2. As such, URSP rules provide SDF level
steering capability for UE to establish new PDU session(s) over the preferred
access network based on traffic descriptor and rule precedence.
In this solution, the URSP rules described in TS 23.503 [7] clause 6.6.2 are
extended to indicate the list of applications to the UE for which MPTCP should
be applied.
\- The _MPTCP_ field in the _Route Selection Descriptor_ specifies whether to
use MPTCP for the matching application;
\- If present, in case of WLAN access, the _Limited SSID(s) for MPTCP_ field
specifies a list of SSID(s) that are allowed on the WLAN access when MPTCP is
used.
The PCF may select the URSP rules applicable for each UE based on local
configuration and operator policies taking into consideration e.g. UE location
or time of the day.
The PCF may provide the URSP rules at the initial Registration procedure, or
when the operator policies indicate that the conditions for updating the UE
are met, i.e. at change of UE location or at mobility with change the AMF, or
at any time, as defined in TS 23.502 [6]. Operator defined policies in the PCF
may depend on input data such as UE location, time of day, information
provided by other NFs, etc.
Table 6.5.5-1: UE Route Selection Policy (from TS 23.503 [7] table 6.6.2.1-1)
* * *
Information name Description Category PCF permitted to modify in a URSP Scope
URSP rules 1 or more URSP rules as specified in table 6.6.2.1-2 Mandatory Yes
UE context
* * *
Table 6.5.5-2: UE Route Selection Policy Rule (from TS 23.503 [7] table
6.6.2.1-2)
+-----------+-----------+-----------+-----------+-----------+---+ | In | De | Category | PCF | Scope | | | formation | scription | | permitted | | | | name | | | to modify | | | | | | | in a UE | | | | | | | context | | | +-----------+-----------+-----------+-----------+-----------+---+ | Rule | D | M | Yes | UE | | | P | etermines | andatory\ | | context | | | recedence | the order | (NOTE 1) | | | | | | the URSP | | | | | | | rule is | | | | | | | enforced | | | | | | | in the | | | | | | | UE. | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | **Traffic | *This | | | | | | des | part | | | | | | criptor** | defines | | | | | | | the | | | | | | | traffic | | | | | | | de | | | | | | | scriptors | | | | | | | for the | | | | | | | policy _| | | | | +-----------+-----------+-----------+-----------+-----------+---+ | Ap | It | Optional | Yes | UE | | | plication | consists | | | context | | | id | of OSId | | | | | | entifiers | and | | | | | | | OS | | | | | | | AppID(s). | | | | | | | | | | | | | | (NOTE 2) | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | IP | IP 3 | Optional | Yes | UE | | | de | tuple(s) | | | context | | | scriptors | (de | | | | | | | stination | | | | | | | IP | | | | | | | address | | | | | | | or IPv6 | | | | | | | network | | | | | | | prefix, | | | | | | | de | | | | | | | stination | | | | | | | port | | | | | | | number, | | | | | | | protocol | | | | | | | ID of the | | | | | | | protocol | | | | | | | above IP) | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | Non-IP | Desc | Optional | Yes | UE | | | de | riptor(s) | | | context | | | scriptors | for | | | | | | | non-IP | | | | | | | traffic | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | DNN | This is | Optional | Yes | UE | | | | the DNN | | | context | | | | in | | | | | | | formation | | | | | | | provided | | | | | | | by the | | | | | | | ap | | | | | | | plication | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | C | This is | Optional | Yes | UE | | | onnection | the | | | context | | | Cap | in | | | | | | abilities | formation | | | | | | | provided | | | | | | | by a UE | | | | | | | ap | | | | | | | plication | | | | | | | when it | | | | | | | requests | | | | | | | a network | | | | | | | c | | | | | | | onnection | | | | | | | with | | | | | | | certain | | | | | | | capa | | | | | | | bilities. | | | | | +-----------+-----------+-----------+-----------+-----------+---+ |__List of | A list of | Mandatory | | | | | Route | Route | | | | | | Selection | Selection | | | | | | Desc | Des | | | | | | riptors_ * | criptors. | | | | | | | The | | | | | | | c | | | | | | | omponents | | | | | | | of a | | | | | | | Route | | | | | | | Selection | | | | | | | D | | | | | | | escriptor | | | | | | | are | | | | | | | described | | | | | | | in table | | | | | | | 6.6.2.1-3 | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | NOTE 1: | | | | | | | Rules in | | | | | | | a URSP | | | | | | | shall | | | | | | | have | | | | | | | different | | | | | | | p | | | | | | | recedence | | | | | | | values. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | in | | | | | | | formation | | | | | | | is used | | | | | | | to | | | | | | | identify | | | | | | | the | | | | | | | Appli | | | | | | | cation(s) | | | | | | | that | | | | | | | is(are) | | | | | | | running | | | | | | | on the | | | | | | | UE\'s OS. | | | | | | +-----------+-----------+-----------+-----------+-----------+---+
Table 6.5.5-3: : Route Selection Descriptor (from TS 23.503 [7] table
6.6.2.1-3)
+-------------+-------------+------------+-------------+------------+ | Information | Description | Category | PCF | Scope | | name | | | permitted | | | | | | to modify | | | | | | in a UE | | | | | | context | | +-------------+-------------+------------+-------------+------------+ | Route | Determines | Mandatory\ | Yes | UE context | | Selection | the order | (NOTE 1) | | | | Descriptor | in which | | | | | Precedence | the Route | | | | | | Selection | | | | | | Descriptors | | | | | | are to be | | | | | | applied. | | | | +-------------+-------------+------------+-------------+------------+ | **Route | *This part | Mandatory\ | | | | selection | defines the | (NOTE 2) | | | | c | route | | | | | omponents** | selection | | | | | | components* | | | | +-------------+-------------+------------+-------------+------------+ | SSC Mode | One single | Optional | Yes | UE context | | Selection | value of | | | | | | SSC mode. | | | | +-------------+-------------+------------+-------------+------------+ | Network | Either a | Optional | Yes | UE context | | Slice | single | | | | | Selection | value or a | (NOTE 3) | | | | | list of | | | | | | values of | | | | | | S-NSSAI(s). | | | | +-------------+-------------+------------+-------------+------------+ | DNN | Either a | Optional | Yes | UE context | | Selection | single | | | | | | value or a | | | | | | list of | | | | | | values of | | | | | | DNN(s). | | | | +-------------+-------------+------------+-------------+------------+ | PDU Session | One single | Optional | Yes | UE context | | Type | value PDU | | | | | Selection | Session | | | | | | Type | | | | +-------------+-------------+------------+-------------+------------+ | N | Indicates | Optional | Yes | UE context | | on-seamless | if the | | | | | Offload | traffic of | (NOTE 4) | | | | indication | the | | | | | | matching | | | | | | application | | | | | | is to be | | | | | | offloaded | | | | | | to non-3GPP | | | | | | access | | | | | | outside of | | | | | | a PDU | | | | | | Session. | | | | +-------------+-------------+------------+-------------+------------+ | Access Type | Indicates | Optional | Yes | UE context | | preference | the | | | | | | preferred | | | | | | Access Type | | | | | | (3GPP or | | | | | | non-3GPP) | | | | | | when the UE | | | | | | establishes | | | | | | a PDU | | | | | | Session for | | | | | | the | | | | | | matching | | | | | | a | | | | | | pplication. | | | | +-------------+-------------+------------+-------------+------------+ | MPTCP | Indicates | Optional | No | UE context | | | whether to | | | | | | use MPTCP | | | | | | for the | | | | | | matching | | | | | | a | | | | | | pplication. | | | | +-------------+-------------+------------+-------------+------------+ | Limited | If present, | Optional | Yes | UE context | | SSID(s) for | in case of | | | | | MPTCP | WLAN | (NOTE 5) | | | | | access, it | | | | | | indicates a | | | | | | list of | | | | | | SSID(s) on | | | | | | the WLAN | | | | | | acess that | | | | | | are allowed | | | | | | when MPTCP | | | | | | is used. | | | | +-------------+-------------+------------+-------------+------------+ | NOTE 1: | | | | | | Every Route | | | | | | Selection | | | | | | Descriptor | | | | | | in the list | | | | | | shall have | | | | | | a different | | | | | | precedence | | | | | | value. | | | | | | | | | | | | NOTE 2: At | | | | | | least one | | | | | | of the | | | | | | route | | | | | | selection | | | | | | component | | | | | | shall be | | | | | | present. | | | | | | | | | | | | NOTE 3: | | | | | | When the | | | | | | S | | | | | | ubscription | | | | | | Information | | | | | | contains | | | | | | only one | | | | | | S-NSSAI in | | | | | | UDR, the | | | | | | PCF needs | | | | | | not | | | | | | provision | | | | | | the UE with | | | | | | S-NSSAI in | | | | | | the Network | | | | | | Slice | | | | | | Selection | | | | | | i | | | | | | nformation. | | | | | | | | | | | | NOTE 4: If | | | | | | this | | | | | | indication | | | | | | is present | | | | | | in a Route | | | | | | Selection | | | | | | Descriptor, | | | | | | no other | | | | | | components | | | | | | shall be | | | | | | included in | | | | | | the Route | | | | | | Selection | | | | | | Descriptor. | | | | | | | | | | | | NOTE 5: | | | | | | This | | | | | | component | | | | | | shall only | | | | | | be present | | | | | | for the | | | | | | MPTCP PDU | | | | | | Session. | | | | | +-------------+-------------+------------+-------------+------------+
#### 6.5.5.2 ATSSS rules for MPTCP
The SMF maps the PCC rules into ATSSS rules which are sent to UE via the AMF.
An ATSSS rule includes the following:
a) A Precedence value, which identifies the priority of this ATSSS rule with
respect to other ATSSS rules.
b) A Traffic Descriptor, which identifies an SDF. It may include e.g. an
Application ID, IP descriptors, non-IP descriptors, etc.
c) Steering Mode(s), which identifies how the matching SDF should be steered
across 3GPP and non-3GPP accesses. The following Steering Modes will be
supported:
\- Active-Standby: An MPTCP service that provides seamless handover between
non-3GPP and 3GPP access in order to preserve the connection;
\- Smallest Delay: A service whereby MPTCP attempts to use the lowest-latency
interface; or
\- Load-Balancing: An MPTCP service that aggregates the capacities of the
access networks in an attempt to increase throughput and minimize latency;
The steering decision is performed by taking into account the congestion and
delay information of the individual TCP subflows of the MPTCP connection. The
UE may also take into account Access Measurement Reports, as defined in clause
6.1.5.3 or 6.6.3.2, to complement the steering and path-management decisions.
## 6.6 Solution 6: Architecture framework with ATSSS rules via NAS and generic
user plane Reporting Control Protocol
### 6.6.1 Architecture framework Description
In terms of architecture requirements for this solution, the proposed ATSSS
architecture framework is similar to solution #1 as described in clause 6.1.
### 6.6.2 Functional Description
The architecture is similar to solution #1 as described in 6.1.1, with the
following entities:
\- User Data Repository for Access Traffic Steering Switching and Splitting
Function (UDR-AT3SF).
\- Policy Control Access Traffic Steering Switching and Splitting Function
(PC-AT3SF).
\- Session Management Access Traffic Steering Switching and Splitting Function
(SM-AT3SF).
\- User Plane Access Traffic Steering Switching and Splitting Function (UP-
AT3SF).
\- UE Access Traffic Steering Switching and Splitting Function (UE-AT3SF).
UP-AT3SF to CP-AT3SF: UP-AT3SF at the Anchor UPF (other UPF are transparent)
is the entity that decides which access a IP flow shall use or be moved to.
The solution consists in:
\- carrying all ATSSS rules via NAS including convergence method. This differs
from solution #1, where convergence methods can be changed via user plane (new
MACM protocol in clause 6.1.6);
\- carrying Measurement Thresholds and Measurement Reporting over the user
plane (that require fast steering/splitting decisions).
The protocol between the UE and the UP-AT3SF at the Anchor UPF (\"Generic
Reporting Control Protocol\") allows the network to configure measurement
thresholds and reporting timers in the UE, and the UE to send the measurement
reports to UP-AT3SF.
A Data Flow defined by a set of TFTs can be split on both accesses, but all
packets of an IP flow are sent on a single access. This does not preclude an
IP flow to be switched to the other access if needed due to e.g. path quality.
Hence, no sequence numbering is proposed in this solution.
### 6.6.3 Procedures
#### 6.6.3.1 ATSSS Policy Control (via NAS)
ATSSS policies for UL traffic are carried from PCF to UE over existing NAS SM
procedures when a new PDU session is established or modified. ATSSS policies
for DL traffic are carried from PCF to UPF via SMF.
ATSSS policies for a certain data flow (SDF or PDU session) contain:
\- the TFT corresponding to the traffic to which the policies apply, and
\- if there is a preferred access:
\- the preferred access type (3GPP access / non-3GPP access) or an indication
stating that the preferred access is the one with the lowest RTT or is the
least loaded one, etc.,
\- an indication on whether fall-back access is allowed or not, and
\- an indication on whether overflow is allowed or not.
\- or, if there is no preferred access, the traffic load distribution to apply
between accesses. Each access is assigned a weight factor (e.g. 50%) and
receives a percentage of the SDF/PDU session traffic corresponding to this
factor.
ATSSS policies may also contain information about the splitting/switching
method for the data flow:
\- An indication on the allowed Convergence Method (e.g. Null Aggregation, GRE
Aggregation, MP-TCP Proxy, MP-QUIC Proxy, etc) and the associated Convergence
Method Parameters,
\- the Transport Method (e.g. UDP tunnel, IPSec Tunnel with NULL encryption,
etc.),
\- the Transport Method Parameters (e.g. Tunnel endpoint IP address and port)
via NAS, and
\- the IP address and UDP port of the UP-AT3SF.
#### 6.6.3.2 Measurement Configuration and Reporting Control Procedure (via
User Plane)
This procedure describes how and when the network configures measurement
thresholds and reporting timers in the UE, and how and when the UE sends the
measurement reports to the network, using the Generic Reporting Control
Protocol (GRCP).
As in the user plane, GRCP messages are integrity protected over the radio (at
PDCP layer in 3GPP access and at IPsec layer in non-3GPP access). It is
assumed that the RAN and the N3IWF are trusted and connected to the CN nodes
in a secure way.
Figure 6.6.3.2-1: UE-AT3SF measurement configuration and reporting procedure
1\. UP-AT3SF at the Anchor UPF sends GRCP Config Request (list of (threshold
low, threshold high, reporting period)) to the UE. This is performed at least
when the user plane is established, hence triggered by SMF. The UP-AT3SF may
also send GRCP Config Request at any point in time when the UE is in connected
mode.
There may be one or several sets of (threshold low, threshold high, reporting
period). This allows the network to adjust the reporting period.
2\. The UE acknowledges with GRCP Config Response. Repetitions may occur if
the UE does not acknowledge, but this is a stage 3 matter.
3\. The UE performs appropriate measurements and compare them to configured
\"reporting thresholds\".
4\. The UE sends AARCP Measurement Report (access type, set of measurements)
to the UP-AT3SF. When a threshold low/high is reached, the UE adapts its
measurement reporting period.
5\. UP-AT3SF compares the measurements received from the UE with corresponding
\"measurement thresholds\" configured in the UP-AT3SF by the operator and
determines how to split/switch the downlink traffic according to ATSSS rules
related to PDU session and data flow filters.
The GRCP Measurement Reports are sent over the best access to avoid
retransmissions and high transmission power when the UE is at the edge of the
cell in that access.
The measurements need to be independent from the UE implementation, in order
to avoid two UEs in same radio conditions to report different measurement
values. Measurements can be for example:
\- Round Trip Time. There is no need to report such measurement because it is
measurable directly by the UPF.
A first alternative is to calculate RTT from a TCP flow between two hosts, by
using TCP timestamps option according to IETF RFC 1323 [14] which is commonly
used by both end hosts on a connection to refine the RTT to improve the
performance of TCP in the presence of loss. The TCP stack also maintains the
variance in the measured RTT, the RTTVAR.
Another alternative would be to specify GRCP Echo Request and GRCP Echo
Response to be exchanged between the UE and the network. This measurement may
be used by UP-AT3SF for certain applications that are sensitive to latency.
UP-AT3SF can also use the RTT variation to detect that the access is degrading
but this should be taken with care as it will happen at cell changes.
\- the received power/quality, e.g. CSI-RSRP/CSI-RSRQ for NR 3GPP access,
E-UTRA RSRP / E-UTRA RSRQ for E-UTRAN and IEEE 802.11 WLAN RSSI for WLAN as
defined in TS 38.215 [11]).
\- the downlink backhaul data rate and the WLAN channel utilization (defined
in IEEE 802.11 [3]) as specified in TS 36.300 [13].
The corresponding \"reporting thresholds\" in the UE are:
\- For the received power thresholds: the minimum E-UTRAN/NR signal strength
thresholds (RSRP and RSRQ for 3GPP access) and the minimum WLAN signal
strength (Beacon RSSI), as defined in TS 36.300 [13] and TS 38.215 [11].
\- For the WLAN load measurements thresholds: maximum WLAN channel utilization
threshold and minimum WLAN backhaul data rate threshold.
\- For each above reporting threshold, the reporting frequency when the
threshold is reached.
There can be several threshold values for a given type, with different
reporting frequencies. For example:
\- RSRP > -90dBm; reporting frequency = 30 seconds.
\- RSRP \ 1Mbps\"
The UE applies the ATSSS rules after performing a measurement session to
estimate the ANP parameters on each access.
4\. A measurement session over 3GPP (or non-3GPP) access may be initiated by
the UE when there is no PDU session traffic to send over 3GPP (or non-3GPP)
access. This way, the measurement traffic does not interfere with and does not
impact the PDU session traffic. However, if the Measurement Assistance policy
received by the UE allows so, a measurement session may also be initiated when
the UE transmits / receives PDU session traffic.
5\. The measurement traffic between the UE and PMF is not charged (appropriate
PCC rules are created by PCF).
6\. Packet Detection Rules (PDRs) are provided to UPF, which may also contain
specific ANP parameters. The PDRs are used by the UPF to determine how the
downlink traffic of the MA-PDU session should be distributed across the 3GPP
and non-3GPP accesses.
### 6.7.2 Reference Architecture
A new user-plane function is introduced, called _Performance Measurement
Function_ (PMF). The PMF could be implemented in the UPF, or outside the UPF
as a standalone function. The UE can initiate a measurement session with the
PMF over each access in order to estimate the ANP parameters for each access,
such as Throughput, Delay and Loss rate. The UE utilizes the information in
the received Measurement Assistance policy to determine the address/port of
PMF and other details required for the measurement session, e.g. the protocol
to use, the maximum number of bytes to transmit, etc.
Figure 6.7.2-1 shows the architecture when the PMF is implemented as a
standalone function, while Figure 6.7.2-2 shows the architecture when the PMF
is collocated with the UPF. The UE can communicate with the PMF over the user
plane, using either 3GPP access or non-3GPP access. The Mx is a logical
interface between the UE and PMF, employing IP transport. The protocols
running over Mx are used to support measurement sessions between the UE and
PMF, and to measure ANP parameters such as Throughput, Delay and Loss Rate.
NOTE: The communication between the UE and PMF over Mx can be defined by 3GPP
or can be based on existing tools that measure ANP parameters, such as the
iPerf tool (see https://iperf.fr/).
{width="5.570138888888889in" height="2.0027777777777778in"}
Figure 6.7.2-1: Architectural model with standalone PMF
Editor\'s note: It is FFS if the PMF should preferably interface with the SMF,
instead of the PCF.
{width="5.620833333333334in" height="2.463888888888889in"}
Figure 6.7.2-2: Architectural model with PMF located in UPF
Editor\'s note: What kind of extensions may be required on the N4 interface is
FFS.
Editor\'s note: When the PMF is collocated with the UPF, the UE could initiate
DoS attacks to UPF. How these attacks can be prevented is FFS and requires SA3
involvement.
### 6.7.3 Procedures
#### 6.7.3.1 Procedure with Standalone PMF
The procedure in the figure below illustrates (a) how the UE receives ATSSS
rules and Measurement Assistance Policy rules during the MA-PDU session
establishment, (b) how the UE applies the Measurement Assistance Policy to
initiate measurement sessions over 3GPP and non-3GPP accesses and measure ANP
parameters, and (c) how the UE uses the measured ANP parameters to apply the
ATSSS rules and distribute the MA-PDU session traffic across the two accesses.
{width="6.6875in" height="7.29375in"}
Figure 6.7.3.1-1: Procedure with standalone PMF
1-2. The UE requests a MA-PDU session by sending a NAS message to AMF
including a PDU Session Establishment Request (as specified in clause 6.2.3.2,
\"Combined Establishment\"). The NAS message includes a MA-PDU Request
indication, which indicates that the request is for a multi-access PDU
session. It may also include a PMF Supported indication, which indicates that
the UE supports Access Measurements. The UE does not include the PMF Supported
indication in step 1, if the indication has been sent to AMF during a
Registration procedure.
3\. The PMF Supported indication is forwarded to PCF, when the SMF requests
Session Management (SM) policy for the MA-PDU session.
4\. The PCF derives the SM policy for the MA-PDU session, which includes PCC
rules for traffic steering which specify how traffic should be distributed
across the two accesses of the MA-PDU session. When deriving the PCC rules for
traffic steering, the PCF takes into account the PMF Supported indication
received in step 3. If this indication is received, then the PCF may derive
PCC rules for traffic steering that contain ANP parameters, e.g. PCC rules of
the form \"Steer traffic of App-X to the access with the largest Throughput\".
If this indication is not received (i.e. the UE cannot support measurements),
the PCF derives PCC rules for traffic steering that do not contain ANP
parameters.
5\. If the PCF derives one or more PCC rules for traffic steering that contain
ANP parameters, then the PCF must also derive Measurement Assistance Policy
rules, which assist the UE in conducting ANP measurements. To derive the
Measurement Assistance Policy rules, the PCF may select a PMF and then request
from the selected PMF to reserve resources required to support the
measurements of the specific UE. In most cases, reserving such resources means
instantiating a process in PMF which awaits for the measurements requests from
the UE. In some cases, the resource reservation in the PMF may not be
required, so the step 5 is not needed. In such cases, the PMF does not use
dedicated measurement resources for each UE but uses the same measurement
resources shared by all UEs.
Editor\'s note: The details of the PMF selection in step 5a are FFS. The PMF
address could be retrieved either with a DNS query or by using the NRF
discovery service (if the PMF is a NF in 5GC). It is also FFS if one or
multiple PMFs in the standalone scenario are needed.
6\. The PCF sends to SMF the created SM policy for the MA-PDU session, which
includes the derived PCC rules for traffic steering and the Measurement
Assistance Policy rules. The SMF uses the received PCC rules for traffic
steering to create steering rules for the UE (i.e. ATSSS rules) and Packet
Detection Rules for the UPF.
7\. The SMF initiates the establishment of user-plane resources over the
non-3GPP access, as specified in TS 23.502 [6] and according to the MA-PDU
session establishment procedure in clause 6.2.3.2, \"Combined Establishment\".
During this step, the UE does not receive a PDU Session Establishment Accept
message.
8\. The SMF initiates the establishment of user-plane resources over the 3GPP
access. This step is similar to the previous step but it is shown in more
details because in this step the UE receives a PDU Session Establishment
Accept message. This message contains (a) the Measurement Assistance Policy
rules provided by PCF and (b) the ATSSS rules, which were created by the SMF
by using the PCC rules for traffic steering.
9\. The user-plane resources on both accesses have been reserved and, thus,
the UE can send and received PDU session traffic (i.e. user data) over both
accesses.
10\. The UE (possibly before sending any PDU session traffic) starts a
measurement session over 3GPP access (NG-RAN) and also starts a measurement
session over non-3GPP access. These measurement sessions can be conducted in
parallel and utilize the information included in the Measurement Assistance
policy provided to UE.
NOTE: A measurement session between the UE and PMF over Mx can be conducted
based on procedures defined by 3GPP or based on existing tools, such as the
iPerf tool (see https://iperf.fr/).
11\. During each measurement session, one or more ANP parameters (e.g. the
Throughput, the Delay and the Loss Rate) are measured by the UE and by the
PMF.
12\. The PMF forwards the values of the measured ANP parameters to the PCF.
These values are then sent to UPF via the SMF.
13\. The UE and the UPF now use the values of the measured ANP parameters to
decide how to route the uplink and the downlink traffic respectively across
the two accesses of the MA-PDU session. These decisions are taken by using the
ATSSS rules in the UE and the Packet Detection rules in the UPF (provisioned
in step 8).
#### 6.7.3.2 Procedure with PMF collocated with UPF
When the PMF is collocated with the UPF, the procedure is modified (and
simplified) as shown in the figure below. The steps discussed below show the
differences from the standalone case presented in Figure 6.7.3.1-1.
{width="6.689583333333333in" height="7.608333333333333in"}
Figure 6.7.3.2-1: Procedure with PMF located in UPF
3-5. As in the standalone case, the PCF derives PCC rules for traffic steering
for the MA-PDU session that may contain ANP parameters, e.g. rules of the form
\"Steer traffic of App-x to the access with the largest Throughput\". However,
the PCF does not derive Measurement Assistance Policy rules.
6\. If the SMF receives one or more PCC rules for traffic steering that
contain ANP parameters, then the SMF derives Measurement Assistance Policy
rules, which assist the UE in conducting ANP measurements. Before deriving
these rules, the PCF may select a PMF and request from the selected PMF to
reserve resources required to support the measurements from the UE. If all the
PCC rules for traffic steering received by SMF contain no ANP parameters, then
the SMF does not derives Measurement Assistance Policy rules (since the UE
does not need to perform any measurements).
12\. This step is not required because the measured ANP parameters are already
available in UPF.
## 6.8 Solution 8: ATSSS rules for supporting 3GPP RAT differentiation
### 6.8.1 General
This solution applies to Key Issue #6: Key issue on differentiation of 3GPP
RATs in ATSSS rule.
An ATSSS Rule contains the following parameters:
\- ATSSS Rule Identifier.
\- ATSSS Rule Priority.
\- Packet Filter Set.
\- Steering Mode.
\- Access Technology.
The ATSSS Rule Identifier uniquely identifies an ATSSS Rule in the UE.
For the purpose of matching data flows against ATSSS Rules, the Packet Filter
Set is applied in the order of the ATSSS Rule Priority.
There are two types of Packet Filter Set, i.e. IP Packet Filter Set, and
Ethernet Packet Filter Set, corresponding to those PDU Session Types. The
Packet Filter Set may contain multiple packet filters. The Packet Filter Set
is defined in TS 23.501 [5] clause 5.7.6.
The Steering Mode represents how the UE steers or switches uplink traffic
based on Access Technology. For example, if Steering Mode is \"Active-
Standby\", traffic that matches Packet Filter Set is steered over \"Active
Access Technology\" and if the \"Active Technology\" becomes unavailable, the
UE steers the traffic over \"Standby Access Technology\".
NOTE 1: The Steering Modes in Solution 4 such as \"Active-Standby\",
\"Priority-based\", \"Best-Access\", etc are applicable for this solution.
The Access Technology indicates a prioritized access technology for steering
data flows, and possible values for the Access Technology are described in
Table 6.8-1. If a 3GPP access technology corresponding to the value configured
for the Access Technology is not selected by the UE then the UE shall ignore
this configuration until the 3GPP access technology corresponding to the value
configured for the Access Technology becomes selected.
NOTE 2: When a UE is using more than two access technologies at same time
(e.g. Dual Connectivity), the UE uses Master RAN node\'s RAT to find matching
ATSSS rule. In this case, the data flows may be sent over the Secondary RAN
node\'s RAT, which is different from the RAT in the ATSSS rule.
Table 6.8-1: Possible values for the Access Technology
* * *
Value Description 0 Reserved 1 Any 3GPP access technology e.g. NR, E-UTRA 2
WLAN 3 NR 4 E-UTRA 5-255 Reserved
* * *
The SMF sends ATSSS Rule to the UE via NAS signalling. When the SMF sends
ATSSS Rule, the SMF includes a default ATSSS Rule, which has a match all
Packet Filter Set with the highest ATSSS Rule Priority value. The UE uses the
received ATSSS Rule for uplink data flow steering. The UE evaluates UL packets
against the Packet Filter Set in the ATSSS rule based on the ATSSS Rule
Priority in increasing order until a matching ATSSS rule is found. If there is
matching ATSSS rule the UE sends uplink data flow to the target access (i.e.
access using the matched Access Technology). If there is no matching ATSSS
rule, the UE follows default ATSSS rule.
NOTE-3: The UE does not use ATSSS Rule to determine which access or RAT to
connect to.
## 6.9 Solution 9: Solution for the UL CL case on the Multi-access PDU
sessions
### 6.9.1 General
This solution intends to solve the problem of KI 5 bullet 9. For the multi-
access PDU session, the traffic flow also can be supposed to be routed
locally. Therefore, the multi-access PDU session should support the usage of
an UL Classifier.
Two cases are discussed:
Case 1:
In case the N3IWF is distributed deployed by operator, in order to guarantee
the traffic data can be switched between the 3GPP access and the non-3GPP
access type efficiently, in case the SMF decides to add the UL CL function
during the PDU session establishment, the SMF should insert the UL CL function
into the traffic routing of both the 3GPP access type and non-3GPP access type
shown as Figure 6.9.1-1.
After the UL CL function is inserted, the UL CL become the ATSSS anchor. The
SMF should provide the ATSSS forwarding rules to the UL CL. When UL CL receive
the uplink data, UL CL applies filtering rules (e.g. to examine the
destination IP address/Prefix of UL IP packets sent by the UE) and determines
how the uplink packet should be routed as specified in TS 23.501 [5]. When UL
CL receive the downlink data, UL CL determiners which access is selected to
transmit the data based on the ATSSS forwarding rules.
If the UL CL function is inserted after PDU Session Establishment, the ATSSS
anchor is moved from the original UPF, e.g. UPFA, to the UL CL function.
Case 2:
In case the N3IWF is centric deployed by operator, operator select one of the
access to insert the UL CL. For example, if the Application Server is nearby
the 3GPP access (NG-RAN), the operator select the 3GPP access to insert the UL
CL. If the Application Server is nearby the non-3GPP access (N3IWF), the
operator select the non-3GPP access to insert the UL CL.
### 6.9.2 Architecture description
Case 1: Figure 6.9.2-1 depicts the ATSSS architecture with UL CL function
insertion into both 3GPP access and non-3GPP access.
Figure 6.9.2-1 the ATSSS architecture with UL CL function insertion to both
3GPP access and non-3GPP access
NOTE: It is possible for a given UPF to support both the UL CL and the PDU
Session Anchor functionalities. In this case, based on the ATSSS forwarding
rules, the UL CL performs the access traffic switching, splitting, steering.
And UL CL performs the path performance measurement. The PSA1 stops to do the
access traffic switching, splitting, steering and path performance measurement
after insertion.
Case 2: Figure 6.9.2-2 depicts the ATSSS architecture with UL CL function
insertion to single access, e.g., 3GPP access type.
Figure 6.9.2-2: The ATSSS architecture with UL CL function insertion to single
access
NOTE 1: It is possible for a given UPF to support both the UL CL and the PDU
Session Anchor functionalities.
In this case, the UL CL is inserted into 3GPP access, the PSA1 shall not be
impacted.
Editor\'s note: In case the traffic data is encapsulated between the UE and
the PSA1 (e.g. as described in clause 6.1.7 or in clause 6.3 or in clause
6.5), e.g., the GRE, TFCP, MPTCP proxy, how the UL CL identify the traffic
which should be locally routed is FFS.
NOTE 2: The Session-AMBR is not able be controlled in case 2.
NOTE 3: SMF shall ensure ATSSS forwarding rules doesn\'t have conflict with
filtering rules to be sent to UL CL. That means the filtering rules provided
by SMF to inform UL CL perform diverting (locally) traffic should exclude the
traffic steered by MPTCP function.
### 6.9.3 PDU session Establishment Procedure with additional UL CL and PDU
session Anchor
This clause proposes the procedure to insert UL CL based on the MA PDU Session
Establishment Procedure.
#### 6.9.3.1 Establishment of Multi-Access PDU session with UL CL based on the
solution 3 architecture framework
During PDU session establishment procedure, the SMF may decide to insert in
the data path of a PDU Session an \"UL CL\" (Uplink classifier).
In case 1, SMF decide to insert the UL CL to both 3GPP access and non-3GPP
access.
Figure 6.9.3.1-1: Multi-Access PDU Session establishment procedure with UL CL
with TFCP tunnel
1\. The UE initiates the \"UE Requested PDU Session Establishment\" procedure,
the detail is the same with Step 1\~ step 5 as described in figure 6.3.3-1.
2\. SMF selects the UPF (UL CL function). Based on the UPF selection criteria
the SMF decides to add the UL CL function in this PDU session.
3\. The SMF selects a PSA1 and using N4 establish the PSA1 of the PDU Session.
4\. The SMF selects a PSA2 and using N4 establish the PSA2 of the PDU Session.
5\. SMF sends the N4 session establishment message (ATSSS forwarding rules,
PSA1 CN tunnel info, PSA2 CN tunnel info) to establish the tunnel between the
UL CL and PSA1 and PSA1.
Based on the ATSSS forwarding rule, the UL CL function perform the access
traffic switching, splitting, and steering. The UL CL function can perform the
path performance measurement.
If the SMF is aware the PDU session is the MA-PDU session, the SMF should add
the UL CL function to each traffic routing of 3GPP access and Non-3GPP access.
6a. SMF updates the PSA1 via N4. It provides the UL CL tunnel info for the
downlink traffic data.
6b. SMF updates the PSA2 via N4. It provides the UL CL tunnel info for the
downlink traffic data.
7\. The other steps is described as the step 6a\~step 7 in figure 6.3.3-1.
8\. The SMF sends the RAN tunnel Info and 3GPP access type to the UL CL
function.
9\. The step 9\~step 10 in figure 6.3.3-1.
10\. The SMF sends the N3IWF tunnel Info and Non-3GPP access type to the UL CL
function. The UL CL function stored both access tunnel information and the
binding access type for this Multi-Access PDU Session. This binding
relationship can be used when performing the traffic splitting or switching in
user plane.
In case 2: the SMF decide to insert the ULCL to one of the two access, e.g.
3GPP access.
Figure 6.9.3.1-2
1\. The UE initiates the \"UE Requested PDU Session Establishment\" procedure,
the detail is the same with Step 1\~ step 5 as described in figure 6.3.3-1.
2\. SMF selects the UPF (UL CL function), Based on the UPF selection criteria
and operator\'s network deployment, the SMF decides to add the UL CL function
into the 3GPP access side of the PDU session.
3\. The SMF selects a PSA1 and using N4 establish the PSA1 of the PDU Session.
4\. The SMF selects a PSA2 and using N4 establish the PSA2 of the PDU Session.
5\. SMF sends the N4 session establishment message (PSA1 CN tunnel info, PSA2
CN tunnel info) to establish the tunnel between the UL CL and PSA1 and PSA2.
6a. SMF updates the PSA1 via N4. It provides the UL CL tunnel info for the
downlink traffic data.
6b. SMF updates the PSA2 via N4. It provides the UL CL tunnel info for the
downlink traffic data.
7\. The step 6a\~step 7 in figure 6.3.3-1.
8\. The SMF sends the RAN tunnel Info to the UL CL function.
9\. The step 9\~step 10 in figure 6.3.3-1.
10\. The SMF sends the N3IWF tunnel Info and Non-3GPP access type to the PSA1.
The PSA1 update the tunnel info for the downlink traffic.
### 6.9.4 Insert UL CL and additional PDU Session Anchor after PDU Session
Establishment
#### 6.9.4.1 Insert UL CL to both 3GPP access and Non-3GPP access
After the PDU session establishment procedure, in case 1 described in clause
6.9.1, the SMF may decide to insert in the data path of a PDU Session an \"UL
CL\" (Uplink classifier).
Figure 6.9.4.1-1: Addition of additional PDU session anchor and UL CL in the
3GPPaccess and Non-3GPP access
1\. UE has an established MA-PDU session with a UPF including the PDU session
anchor 1(PSA1 in Figure 6.9.4.2-1). The PDU session User plane involves 3GPP
access (the (R)AN and PSA1) and non-3GPP access(the N3IWF and PSA1).
2\. At some point the SMF decides to establish a new PDU Session Anchor e.g.
new flow detection. The SMF selects a UPF and using N4 establish the new PDU
Session Anchor 2 (PSA2 in Figure 6.9.4.1-1) of the PDU Session.
3\. SMF sends the N4 PDU session establishment request (disable ATSSS
forwarding rule) to the PSA1. Based on the disable ATSSS forwarding rule
indication, the PSA1 should stop to do access traffic switching, splitting and
steering. And it stops to perform the path performance measurement as well. If
CN Tunnel Info is allocated by the SMF, the new CN Tunnel Info is provided to
UPF in this step.
4\. PSA1 sends the N4 PDU session establishment response to the SMF.
5\. The SMF selects a UPF and using N4 establish the UL CL for the PDU
Session. It provides the necessary uplink forwarding rules towards PSA1 and
PSA2 including the PSA1 CN Tunnel Info and the PSA2 CN Tunnel Info. In
addition, the AN Tunnel Info of both 3GPP access and non-3GPP access is
provided for downlink forwarding. The SMF provides traffic filters indicating
what traffic shall be forwarded towards PSA1 and PSA2 respectively. The SMF
provides the ATSSS forwarding rule to the UL CL, based on the ATSSS forwarding
rules, the UL CL performs the access traffic switching, splitting and
steering. The UL CL can perform path performance measurement.
6\. The UL CL sends the N4 PDU session establishment response to the SMF.
7\. The SMF updates the PSA1 with the UL CL tunnel info.
8\. The SMF updates the PSA2 with the UL CL tunnel info.
9\. The SMF sends the PDU session release SM Context (3GPP access and non-3GPP
access). The UPF releases the original PSA1 tunnel info associated with the
3GPP access and non-3GPP access.
10\. The SMF updates (R)AN/N3IWF via N2 SM information over N11. It provides
the UL CL Tunnel Info to the (R)AN/N3IWF for the uplink traffic data.
#### 6.9.4.2 Insert UL CL to a single access
Figure 6.9.4.2-1: Addition of additional PDU session anchor and UL CL in the
single access
1\. UE has an established MA-PDU session with a UPF including the PDU session
anchor 1(PSA1 in Figure 6.9.4.1-1). The PDU session User plane involves 3GPP
access (the (R)AN and PSA1) and non-3GPP access(the N3IWF and PSA1).
2\. At some point the SMF decides to establish a new PDU Session Anchor e.g.
new flow detection in a single access side. The SMF selects a UPF and using N4
establish the new PDU Session Anchor 2 (PSA2 in Figure 6.9.4.2-1) of the PDU
Session.
3\. The SMF selects a UPF and using N4 establish the UL CL for the PDU
Session. Based on the network deployment, the SMF decide to insert the UL CL
into 3GPP access side, it provides the necessary uplink forwarding rules
towards PSA1 and PSA2 including the PSA1 CN Tunnel Info and the PSA2 CN Tunnel
Info. In addition, the RAN Tunnel Info of 3GPP access is provided for downlink
forwarding. In this case the SMF provides traffic filters indicating what
traffic shall be forwarded towards PSA1 and PSA2 respectively.
4\. The UL CL sends the N4 PDU session establishment response to the SMF.
5\. SMF sends the N4 PDU session modification request (3GPP access, UL CL
tunnel info) to the PSA1. The SMF provides the UL CL tunnel info for the
downlink traffic data.
6\. PSA1 sends the N4 PDU session modification response to the SMF.
7\. The SMF updates PSA2 via N4. It provides the UL CL CN Tunnel Info for
downlink traffic.
NOTE: In case the Branching Point or UL CL and the PSA2 are co-located in a
single UPF then step 7 is not needed.
8\. The SMF updates (R)AN via N2 SM information over N11. It provides the UL
CL Tunnel Info corresponding to the (R)AN for the uplink traffic data.
## 6.10 Solution 10: ATSSS Solution using a MA-PDU Session
### 6.10.1 General
The solution specified in this clause is an ATSSS solution based on concepts
introduced in other solutions in this technical report, and specifically on
concepts in solution 2, solution 4, solution 5, solution 6 and solution 7.
To support traffic steering, switching and splitting between 3GPP and non-3GPP
accesses, this solution establishes a Multi-Access PDU (MA-PDU) session and:
a) Applies only the Multipath-TCP (MPTCP) function for steering TCP traffic;
or
b) Applies only an ATSSS function for steering IP traffic; or
c) Applies both the MPTCP function (for TCP traffic) and the ATSSS function
(for the rest of the traffic).
Whether both the MPTCP function and the ATSSS function are applied, or whether
one of these functions is applied, is negotiated between the UE and the
network during the MA-PDU session establishment.
The ATSSS function is a low-layer function in the UE and in the UPF that is
specified in this solution for enabling ATSSS. This ATSSS function is required
when the MPTCP alone is not sufficient.
### 6.10.2 Reference Architecture
The reference architecture is shown in the figure below.
The UPF is functionally enhanced (over Rel-15) to support an internal
Performance Measurement Function (PMF) and an internal Multipath-TCP (MPTCP)
proxy. Both of these new functional elements are further described below. The
PMF is also discussed as part of solution 7 and is functionality similar to
the UP-AT3SF in solution 6. The MPTCP proxy is similar to the MPTCP proxy in
solution 5 but it operates as a _transparent_ (or \"on-path\") MPTCP proxy,
i.e. it is transparent to UE.
Figure 6.10.2-1: Reference Architecture
The UE, SMF and PCF are also functionally enhanced to support the
functionality specified in the next clause.
The Mx reference point supports a new logical interface between the UE and
PMF, which is used for access-agnostic measurements.
### 6.10.3 Functional Description
The key functional features of this solution are summarized below:
**Support of MA-PDU sessions (based on Solution 2)**
1\. The solution supports ATSSS with a Multi-Access PDU (MA-PDU) session. In
other words, ATSSS procedures are applied after a MA-PDU session is
established. How ATSSS can be applies without a MA-PDU session is outside the
scope of this solution.
2\. A MA-PDU is established using a single PDU session ID, as specified in
clause 6.2.3.
Editor\'s note: Using different PDU session IDs for a MA-PDU session, as
specified in clause 6.2.2, is FFS.
3\. A MA-PDU session is established either with the Separate Establishment
procedure, as specified in clause 6.2.3.1, or, with the Combined Establishment
procedure, as specified in clause 6.2.3.2.
\- When the UE sends a NAS message to request a MA-PDU session with the
Combined Establishment procedure, the UE includes an \"MA-PDU Request\"
indication in the NAS message.
5\. When the UE sends a NAS message to request a single-access PDU session and
the UE supports MA-PDU sessions, the UE includes an \"MA-PDU capability\"
indication in the NAS message. This indication may be used by the network to
establish a multi-access PDU session instead of a single-access PDU session,
as specified in clause 6.2.4.
\- The network may decide to establish a MA-PDU session, instead of the
requested single-access PDU session, in order e.g. to offload some PDU session
traffic to non-3GPP access.
5\. The UE may decide to request a MA-PDU session for a DNN based on the
provisioned USRP policy. That is, the URSP policy may indicate if a PDU
session should preferably be established as a MA-PDU session.
**Policy for ATSSS Control (based on Solution 4)**
6\. During the establishment of a MA-PDU session, the PCF may provide PCC
rules that contain information for controlling the multiple accesses used by a
MA PDU Session. In addition to the existing information in the PCC rule such
as QoS and charging information, these rules also specify how specific service
data flows should be routed across the 3GPP and non-3GPP accesses. The SMF
maps these PCC rules into (a) ATSSS rules which are sent to UE via the AMF,
and (b) Packet Detection Rules and other N4 rules which are sent to UPF. If
the SMF does not receive PCC rules for ATSSS control from PCF, then the SMF
uses its own, predefined PCC rules for ATSSS control.
7\. Each PCC rule for ATSSS control identifies (a) the traffic matching the
rule and (b) the steering mode to apply to this traffic (as well as other
applicable information e.g. for QoS and charging). Examples of PCC rules for
ATSSS control include the following:
\- \"SDF template: UDP, DestAddr 1.2.3.4\", \"Steering Mode: Active/Standby,
Active=3GPP, Standby=non-3GPP\".
\- This means \"steer UDP traffic with destination IP address 1.2.3.4 to the
active access (3GPP), if available. If the active access is not available, use
the standby access (non-3GPP)\".
\- \"SDF template: TCP, DestPort 8080\", \"Steering Mode: Smallest Delay\".
\- This means \"steer TCP traffic with destination port 8080 to the access
with the smallest Delay\".
\- \"SDF template Application Id: \", \"Steering Mode: Active/Standby,
Active=non-3GPP if Throughput on non-3GPP > 1Mbps\".
\- This means \"steer traffic that matches the application detection filter
referenced by the Application Id (e.g. the traffic of a certain application)
to non-3GPP access, if the Throughput on non-3GPP access is greater to 1Mbps.
NOTE 1: The above rules can be applied because the Throughput and the Delay
are measured for each access, as detailed below.
NOTE 2: As described below, a PCC rule may be used to enable MPTCP-based
steering, e.g. \"SDF template Application Id \", \"Traffic control policy:
Redirect to MPTCP proxy\", \"Steering Mode: Smallest Delay\".
**Support of Access-Agnostic Measurements (based on Solution 6 and Solution
7)**
9\. During the establishment of a MA-PDU session, the PCF may provide to UE
Measurement Assistance Policy, as specified in clause 6.7. This policy is used
by the UE to contact a Performance Measurement Function (PMF) in the network
and measure certain parameters over 3GPP and non-3GPP accesses, including the
Throughput, Delay and Loss rate. These parameters are referred to as \"Access
Network Performance\" (ANP) parameters. The PMF is collocated with the UPF and
it partly similar to the UP-AT3SF in solution 6.
Editor\'s note: Further details of the Measurement Assistant Policy are FFS.
10\. The measurement traffic between the UE and PMF is not charged.
**Support of MPTCP (based on Solution 5)**
11\. The solution supports MPTCP as follows:
\- During the MA-PDU session establishment, if the UE wants to use MPTCP for
traffic steering, the UE provides an \"MPTCP Request\" indication.
\- If the network agrees to enable MPTCP for the MA-PDU session then:
\- The network allocates two IP addresses for the MA-PDU session. This is
required, otherwise MPCTP cannot be used. As specified in RFC 6824 [8], \"...
there must be multiple addresses at least at one endpoint, for MPTCP to be
used\".
Editor\'s note: Whether the two IP addresses are allocated to UE or to the
MPTCP proxy is FFS.
\- The UPF is configured (with the appropriate Packet Detection Rules) to
detect all or selected MPCTP flows (i.e. TCP flows including an MPTCP option
in the TCP header; see RFC 6824 [8]) and to redirect them to the transparent
MPTCP proxy that is collocated with the UPF. The transparent MPTCP proxy
terminates an MPTCP connection with the UE and establishes a regular TCP (non-
MPTCP) connection to the remote host. It then relays data traffic between the
MPTCP connection and the regular TCP connection, as shown in the figure below.
Note that the use of MPTCP is restricted to between the UE and the MPTCP proxy
in the UPF. This is because MPTCP is applied in order to enable ATSSS within
5GS, not from end to end.
Figure 6.10.3-1: Insertion of MPTCP proxy in the data path
The UE is not aware of the MPTCP proxy, i.e. the proxy is transparent to UE.
Editor\'s note: Although this solution assumes the use of a transparent (or
\"on-path\") MPTCP proxy, the use of a non-transparent (or \"off-path\") MPTCP
proxy is also possible. Which type of MPTCP proxy is selected is FFS.
\- The PCF provides PCC rules that apply to MPTCP flows, such as the following
rule:
\- \"SDF template containing Application Id or SDF filter \", \"Traffic
control policy: MPTCP proxy\", \"Steering Mode: Smallest Delay\".
\- This rule applies the transparent MPTCP proxy (inside the UPF) and
configures the MPTCP proxy to route these flows across 3GPP and non-3GPP
accesses using a \"Smallest Delay\" steering mode (this is the same as the
\"Aggregate MPTCP Service Type\" in clause 6.5.5). Other types of steering
modes can be used such as the \"roundrobin\" and \"redundant\", which are
already supported in MPTCP implementations (see https://multipath-
tcp.org/pmwiki.php/Users/ConfigureMPTCP).
\- From the PCC rules, the SMF derives the corresponding Packet Detection
Rules for the UPF, which enable the UPF to detect service data flows for MPTCP
and apply MPTCP proxy, as mentioned above.
\- From the PCC rules for ATSSS control, the SMF also derives the
corresponding ATSSS rules for the UE, which instruct the UE to steer traffic
matching the traffic descriptor with an \"aggregate\" steering mode. In the
above example, the UE would receive the following ATSSS rule:
\- \"Traffic description Application Id/SDF filter\", \"Aggregation method:
MPTCP\", \"Steering Mode: Smallest Delay\".
12\. Within the same MA-PDU session, if MPTCP is enabled, it is possible to
steer the MPTCP flows by using the MPTCP protocol (or the MPTCP function) and,
simultaneously, to steer all other flows by using lower-layer steering
functionality, called the \"ATSSS function\". This is schematically
illustrated in the figure below for the UE.
NOTE 3: The same set of ATSSS rules is applied to configure the MPTCP function
and the ATSSS function. In Figure 7-1 the MPTCP traffic goes through the MA-
PDU session but not through the ATSSS function.
Figure 6.10.3-2: Example UE supporting an MPTCP function and an ATSSS function
## 6.11 Solution 11: Interworking for Multi-Access PDU Session
### 6.11.1 General
This solution addresses Key Issue#5 bullet 10 to handle the Multi-Access PDU
Session in the scenario of interworking between EPC and 5GC.
### 6.11.2 Functional Description
Handling MA-PDU Session in different scenarios of interworking between EPC and
5GC are analysed below.
#### 6.11.2.1 Interworking with N26 from EPC to 5GC
There is no change to EPS procedures.
After registration to 5GC (i.e. registration after handover or mobility
registration update).the UE provides its MA-PDU Session capability to the
PGW-C+SMF, e.g. in UE 5G SM Capability, in PDU Session Modification Request.
Based on local configuration, if SMF determines that this PDU Session can be a
child PDU Session of the MA-PDU Session, SMF interacts with PCF for ATSSS
policy and derives ATSSS rules for the UE. Then, SMF provides the UE with a
MA-PDU Session indication and ATSSS rules. Then UE can initiate the user plane
resource establishment of the MA PDU Session over N3GPP access when UE is
registered over N3GPP. This solution has the same mechanism in which UE
updates its Reflective QoS capability after moving to 5GC, as described in TS
23.501 [5].
Editor\'s note: How to establish the second user plane resources depends on
the conclusion of the Solution 6.2.
Figure 6.11.2.1-1: ATSSS Interworking PDU Session Modification procedure
UE moves from EPC to 5GC. For UE in connected mode, handover and registration
procedures are executed as described in TS 23.502 [6] clause 4.11.1.2 and
4.11.13. For UE in Idle mode, UE does the Mobility Registration Update as
described in TS 23.502 [6] clause 4.11.1.3.
The PDU Session Modification procedure as described in TS 23.502 [6] clause
4.3.3.2 is used with the following enhancements:
1a. UE sends NAS message to AMF including PDU Session ID and PDU Session
Modification Request message. In the PDU Session Modification Request message,
UE indicates its MA-PDU Session capability, e.g. in 5GSM Core Network
Capability. This message should be send per PDU Session ID.
1a. AMF sends Nsmf_PDUSession_UpdateSMContext Request to the SMF including the
PDU Session Modification Request message.
3a. For a PDU Session, SMF determines whether MA-PDU Session feature can be
utilized for this PDU Session, based on UE capability, UE subscription, local
configuration, interaction with PCF, etc. If MA-PDU Session feature can be
applied, SMF sends Nsmf_PDUSession_UpdateSMContext Response to AMF including
the PDU Session ID, MA-PDU Session Indication, PDU Session Modification Accept
message. In the PDU Session Modification Accept, SMF indicates to UE that this
PDU Session can be a MA-PDU Session and ATSSS rules.
14\. After UE also registers over Non-3GPP and has the same S-NSSAI with the
established PDU Session over 3GPP in the Allowed NSSAI for Non-3GPP, if UE
determines to add Non-3GPP access to the existing PDU Session related with MA-
PDU Session indication, UE initiates user plane resource establishment of the
MA-PDU Session.
#### 6.11.2.2 Interworking without N26 from EPC to 5GC
For both single and dual registration, if UE wants to transfer a PDN
Connection from EPC to 5GC , UE can initiate PDU Session Establishment with
setting the Request Type to \"Existing PDU Session\" while providing MA-PDU
Session Capability. The other procedures are same with 6.11.2.1 except that
PDU Session Establishment Accept is used.
#### 6.11.2.3 Interworking with N26 from 5GS to EPS
When a MA-PDU Session established in 5GC, if SMF determines that this PDU
Session can be transferred to EPC, SMF asks EBI allocation and maps EPS bearer
contexts usually as same as treating the normal PDU Session for QoS flows, no
matter which access is transmitted, based on local configuration and policy.
For UE in Idle mode, after UE sends the TAU request to MME, MME retrieves UE
context from AMF. Then AMF gets the EPS beater contexts from SMF, as described
in TS 23.502 [6] clause 4.11.3.2. After the 3GPP leg of MA PDU Session is
transferred to EPS through TAU procedure, SMF releases the network resource
over N3GPP.
For UE in Connected mode, during the handover, AMF gets the EPS beater
contexts from SMF, as described in TS 23.502 [6] clause 4.11.1.2. After
handover procedure, SMF releases the network resource over N3GPP.
#### 6.11.2.4 Interworking without N26 from 5GS to EPS
For single and dual registration, if UE wants to transfer a MA-PDU Session to
EPC, UE requests PDN connection establishment with \"Handover\" indication to
obtain session continuity. After PDN connection establishment, PGW-C+SMF
releases the network resource over N3GPP.
### 6.11.3 Solution evaluation
#### 6.11.3.1 Impacts on existing entities and interfaces
UE:
\- For interworking from EPC to 5GC, after moving to 5GC, UE updates MA-PDU
Session Capability to SMF.
SMF:
\- For interworking from EPC to 5GC, SMF responses MA-PDU Session indication
and ATSSS rules to UE.
## 6.12 Solution 12: QoS framework for Multi-Access PDU Session
### 6.12.1 General
This solution provides overall description on how to support QoS for a Multi-
Access PDU Session.
The QoS Flow is the finest granularity of QoS differentiation in the Multi-
Access PDU Session and the QoS Flow is not associated with specific access,
i.e. access agnostic. When a data flow is steered between two accesses, the
same QoS Flow is used.
The SMF provides QoS rule(s) to the UE when a Multi-Access PDU Session is
established. The UE performs the classification and marking of UL User plane
traffic, i.e. the association of UL traffic to QoS Flows, based on QoS rules.
The QoS rules are commonly used for both 3GPP and non-3GPP access, so the QoS
classification is independent of ATSSS steering rules. The SMF provides a
default QoS rule to the UE.
The SMF provides Packet Detection Rule(s) (PDR) to the UPF when a Multi-Access
PDU Session is established. The UPF performs the classification and marking of
DL User Plane traffic, based on PDR. The PDR is commonly used for both 3GPP
and non-3GPP access, so the QoS classification is independent of ATSSS
steering rules.
### 6.12.2 AN Resource Allocation
The SMF provides QoS profile to the RAN and the N3IWF when a Multi-Access PDU
Session is established. The RAN and N3IWF establish required resources for the
QoS Flow, e.g. establishment of radio bearer, IPsec SA, updating QoS Flows to
AN resources mapping. The resource allocation is performed regardless of the
type of the QoS Flow (e.g. non-GBR QoS Flow, GBR QoS Flow). This enables
dynamic traffic steering between 3GPP and non-3GPP accesses.
If a Multi-Access PDU Session is established using separate PDU Session
Establishment procedure, the SMF may not provide QoS rules to the UE when the
SMF sends PDU Session Establishment Accept message over the second access. In
this case, the SMF provides QoS profile to the AN to establish AN resource for
the QoS Flow (e.g. establishment of radio bearer, IPsec SA, updating QoS Flows
to AN resources mapping).
NOTE: There is no significant waste of radio resources even though network
allocates AN resources in both accesses for GBR QoS Flow because the RAN
allocates radio resources based on amount of uplink traffic reported by the
UE.
### 6.12.3 Management of GBR QoS Flow
When a GBR QoS Flow is established, the UE may enter CM-IDLE state in a single
access. For example, when there is no traffic over 3GPP access, the RAN may
request to release N2 connection due to user inactivity over 3GPP access. Then
the UE enters CM-IDLE in 3GPP access. Moreover, the UE may enter CM-IDLE state
in non-3GPP access when the UE moves out of non-3GPP access coverage. In such
case, the SMF does not release GBR QoS Flow and does not update QoS Rule and
PDR associated with the GBR QoS Flow.
#### 6.12.3.1 UL GBR QoS Flow
When the UE is in CM-IDLE and has pending uplink GBR traffic, the UE initiates
Service Request procedure to activate a PDU Session for the uplink traffic.
The SMF is responsible of establishing radio resources for the GBR QoS Flow
when the user plane is established. Because the SMF does not know whether the
UE wants to send GBR traffic or Non-GBR traffic, the SMF always establishes
radio resource of all QoS Flows (i.e. both GBR and Non-GBR QoS Flows).
If the PDU Session is successfully activated, the UE sends uplink GBR traffic
without any signalling to the SMF.
NOTE: If there are insufficient radio resources in the AN, the AN may reject
establishment of GBR QoS Flows. In this case, the 5GS cannot satisfy QoS for
the uplink GBR traffic.
During the PDU Session activation, the AN may reject the establishment of GBR
QoS Flow. In this case, the SMF may update ATSSS rule and/or QoS rule based on
event from the UPF (e.g. detected access of uplink GBR traffic), PCC rules and
local configuration.
#### 6.12.3.2 DL GBR QoS Flow
In order to guarantee AN resource is established, before switching access, the
UPF shall initiate N4 Session Level Reporting procedure to indicate that the
UPF is going to send GBR QoS Flow to the other access. When the SMF receives
this indication and if AN resource for the GBR QoS Flow is not established,
the SMF requests AN to establish AN resources for GBR QoS Flow.
Figure 6.12.3.2-1: The DL GBR QoS Flow verification by using N4 Session Level
Reporting procedure
1\. When the UPF needs to switch data flow of a GBR QoS Flow to the 3GPP
access, the UPF initiates N4 Session Report procedure to send switching
indication.
2\. The SMF derives affected QoS Flow based on information received in step 1.
The SMF decides to request RAN to establish required RAN resources for the QoS
Flow if corresponding resources are not allocated.
3\. The SMF sends N2 Setup message to the RAN.
4\. RAN performs radio resource establishment and send response message to the
SMF.
5\. The SMF sends N4Session Report Ack message and indicate that the UPF may
start sending data flow over 3GPP access.
### 6.12.4 Notification control
In Rel-15, Notification control is only supported in 3GPP access and it is not
supported in non-3GPP access. In addition, Notification control is designed to
support end-to-end rate adaptation. In a Multi-Access PDU Session,
notification from RAN does not helpful for rate adaptation because even if the
RAN is congested, end-to-end data rate may not be impacted if the UE steers
the data flow over the non-3GPP access. So In Rel-16, Notification control is
not supported for a Multi-Access PDU Session.
## 6.13 Solution 13: PCC support for ATSSS
### 6.13.1 General
This solution addresses PCC aspects related to key issues 1-5.
This solution proposes to enable PCF control of ATSSS by extending the rel-15
PCC rule with ATSSS information. The information should allow the PCF to
control:
\- What aggregation method is used for the SDF, e.g. MPTCP proxy, NULL, etc.
\- What steering mode is used to steer/split/switch traffic, e.g. Active-
Standby, Smallest-Delay, Load-Balancing, as well as what applicable accesses
types.
\- Charging information depending on what access type is used for a packet.
Editor\'s note: The above information e.g. on aggregation methods and steering
modes need to be updated depending on the conclusions in those areas
The QoS parameters in the PCC rule apply to the service (SDF template) as such
and are not dependent on what access type is used for a packet.
### 6.13.2 PCC rule
The table below describes simplified content of a PCC rule extended to include
ATSSS control information. The new information is included in the MA PDU
Session Control clause in the table (shown in yellow highlights). The rest of
the PCC rule information below is copied from Rel-15 TS 23.503 [7] and not
impacted.
Table 6.13.1: The PCC rule information in 5GC
+----------------------+----------------------+----------------------+ | Information name | Description | PCF permitted to | | | | modify for a dynamic | | | | PCC rule in the SMF | +----------------------+----------------------+----------------------+ | Rule identifier | Uniquely identifies | No | | | the PCC rule, within | | | | a PDU Session. | | | | | | | | It is used between | | | | PCF and SMF for | | | | referencing PCC | | | | rules. | | +----------------------+----------------------+----------------------+ | **Service data flow |**_This part defines | | | detection_ _| the method for | | | | detecting packets | | | | belonging to a | | | | service data | | | | flow._**| | +----------------------+----------------------+----------------------+ | Precedence | Determines the | Yes | | | order, in which the | | | | service data flow | | | | templates are | | | | applied at service | | | | data flow detection, | | | | enforcement and | | | | charging. (NOTE 1). | | +----------------------+----------------------+----------------------+ | Service data flow | For IP PDU traffic: | Conditional | | template | Either a list of | | | | service data flow | (NOTE 4) | | | filters or an | | | | application | | | | identifier that | | | | references the | | | | corresponding | | | | application | | | | detection filter for | | | | the detection of the | | | | service data flow. | | | | | | | | For Ethernet PDU | | | | traffic: Combination | | | | of traffic patterns | | | | of the Ethernet PDU | | | | traffic. | | | | | | | | It is defined in | | | | TS 23.501 [5], | | | | clause 5.7.6.3 | | +----------------------+----------------------+----------------------+ | Mute for | Defines whether | No | | notification | application\'s start | | | | or stop notification | | | | is to be muted. | | +----------------------+----------------------+----------------------+ |** Charging**|**_This part defines | | | | identities and | | | | instructions for | | | | charging and | | | | accounting that is | | | | required for an | | | | access point where | | | | flow based charging | | | | is configured_**| | +----------------------+----------------------+----------------------+ | Charging key | The charging system | Yes | | | (CHF) uses the | | | | charging key to | | | | determine the tariff | | | | to apply to the | | | | service data flow. | | +----------------------+----------------------+----------------------+ | Service identifier | The identity of the | Yes | | | service or service | | | | component the | | | | service data flow in | | | | a rule relates to. | | +----------------------+----------------------+----------------------+ | Sponsor Identifier | An identifier, | Yes | | | provided from the AF | | | | which identifies the | | | | Sponsor, used for | | | | sponsored flows to | | | | correlate | | | | measurements from | | | | different users for | | | | accounting purposes. | | +----------------------+----------------------+----------------------+ | Application Service | An identifier, | Yes | | Provider Identifier | provided from the AF | | | | which identifies the | | | | Application Service | | | | Provider, used for | | | | sponsored flows to | | | | correlate | | | | measurements from | | | | different users for | | | | accounting purposes. | | +----------------------+----------------------+----------------------+ | Charging method | Indicates the | No | | | required charging | | | | method for the PCC | | | | rule. | | | | | | | | Values: online, | | | | offline or neither. | | +----------------------+----------------------+----------------------+ | Measurement method | Indicates whether | Yes | | | the service data | | | | flow data volume, | | | | duration, combined | | | | volume/duration or | | | | event shall be | | | | measured. | | | | | | | | This is applicable | | | | to reporting, if the | | | | charging method is | | | | online or offline. | | | | | | | | Note: Event based | | | | charging is only | | | | applicable to | | | | predefined PCC rules | | | | and PCC rules used | | | | for application | | | | detection filter | | | | (i.e. with an | | | | application | | | | identifier). | | +----------------------+----------------------+----------------------+ | Application Function | An identifier, | No | | Record Information | provided from the | | | | AF, correlating the | | | | measurement for the | | | | Charging key/Service | | | | identifier values in | | | | this PCC rule with | | | | application level | | | | reports. | | +----------------------+----------------------+----------------------+ | Service identifier | Indicates that | Yes | | level reporting | separate usage | | | | reports shall be | | | | generated for this | | | | Service identifier. | | | | | | | | Values: mandated or | | | | not required | | +----------------------+----------------------+----------------------+ |** Policy control**|**_This part defines | | | | how to apply policy | | | | control for the | | | | service data | | | | flow._**| | +----------------------+----------------------+----------------------+ | Gate status | The gate status | Yes | | | indicates whether | | | | the service data | | | | flow, detected by | | | | the service data | | | | flow template, may | | | | pass (Gate is open) | | | | or shall be | | | | discarded (Gate is | | | | closed). | | +----------------------+----------------------+----------------------+ | 5G QoS Identifier | Identifier for the | Yes | | (5QI) | authorized QoS | | | | parameters for the | | | | service data flow. | | +----------------------+----------------------+----------------------+ | QoS Notification | Indicates whether | Yes | | Control (QNC) | notifications are | | | | requested from 3GPP | | | | RAN when the GFBR | | | | can no longer (or | | | | again) be fulfilled | | | | for a QoS Flow | | | | during the lifetime | | | | of the QoS Flow. | | +----------------------+----------------------+----------------------+ | Reflective QoS | Indicates to apply | Yes | | Control | reflective QoS for | | | | the SDF. | | +----------------------+----------------------+----------------------+ | UL-maximum bitrate | The uplink maximum | Yes | | | bitrate authorized | | | | for the service data | | | | flow | | +----------------------+----------------------+----------------------+ | DL-maximum bitrate | The downlink maximum | Yes | | | bitrate authorized | | | | for the service data | | | | flow | | +----------------------+----------------------+----------------------+ | UL-guaranteed | The uplink | Yes | | bitrate | guaranteed bitrate | | | | authorized for the | | | | service data flow | | +----------------------+----------------------+----------------------+ | DL-guaranteed | The downlink | Yes | | bitrate | guaranteed bitrate | | | | authorized for the | | | | service data flow | | +----------------------+----------------------+----------------------+ | UL sharing | Indicates resource | No | | indication | sharing in uplink | | | | direction with | | | | service data flows | | | | having the same | | | | value in their PCC | | | | rule | | +----------------------+----------------------+----------------------+ | DL sharing | Indicates resource | No | | indication | sharing in downlink | | | | direction with | | | | service data flows | | | | having the same | | | | value in their PCC | | | | rule | | +----------------------+----------------------+----------------------+ | Redirect | Redirect state of | Yes | | | the service data | | | | flow | | | | (enabled/disabled) | | +----------------------+----------------------+----------------------+ | Redirect Destination | Controlled Address | Yes | | | to which the service | | | | data flow is | | | | redirected when | | | | redirect is enabled | | +----------------------+----------------------+----------------------+ | ARP | The Allocation and | Yes | | | Retention Priority | | | | for the service data | | | | flow consisting of | | | | the priority level, | | | | the pre-emption | | | | capability and the | | | | pre-emption | | | | vulnerability | | +----------------------+----------------------+----------------------+ | Bind to QoS Flow | Indicates that the | Yes | | associated with the | dynamic PCC rule | | | default QoS rule | shall always have | | | | its binding with the | | | | QoS Flow associated | | | | with the default QoS | | | | rule. | | +----------------------+----------------------+----------------------+ | Priority Level | Indicates a priority | Yes | | | in scheduling | | | | resources among QoS | | | | Flows (NOTE 14). | | +----------------------+----------------------+----------------------+ | Averaging Window | Represents the | Yes | | | duration over which | | | | the guaranteed and | | | | maximum bitrate | | | | shall be calculated | | | | (NOTE 14). | | +----------------------+----------------------+----------------------+ | Maximum Data Burst | Denotes the largest | Yes | | Volume | amount of data that | | | | is required to be | | | | transferred within a | | | | period of 5G-AN PDB | | | | (NOTE 14). | | +----------------------+----------------------+----------------------+ |** Access Network | **_This part | | | Information | describes access | | | Reporting_ * | network information | | | | to be reported for | | | | the PCC rule when | | | | the corresponding | | | | bearer is | | | | established, | | | | modified or | | | | terminated.**_| | +----------------------+----------------------+----------------------+ | User Location Report | The serving cell of | Yes | | | the UE is to be | | | | reported. When the | | | | corresponding bearer | | | | is deactivated, and | | | | if available, | | | | information on when | | | | the UE was last | | | | known to be in that | | | | location is also to | | | | be reported. | | +----------------------+----------------------+----------------------+ | UE Timezone Report | The time zone of the | Yes | | | UE is to be | | | | reported. | | +----------------------+----------------------+----------------------+ |__Usage Monitoring |_**This part | | | Control** | describes identities | | | | required for Usage | | | | Monitoring | | | | Control.**_| | +----------------------+----------------------+----------------------+ | Monitoring key | The PCF uses the | Yes | | | monitoring key to | | | | group services that | | | | share a common | | | | allowed usage. | | +----------------------+----------------------+----------------------+ | Indication of | Indicates that the | Yes | | exclusion from | service data flow | | | session level | shall be excluded | | | monitoring | from PDU Session | | | | usage monitoring | | +----------------------+----------------------+----------------------+ |_ *Traffic Steering | **_This part | | | Enforcement | describes identities | | | Control_ _| required for Traffic | | | | Steering Enforcement | | | | Control._**| | +----------------------+----------------------+----------------------+ | Traffic steering | Reference to a | Yes | | policy identifier(s) | pre-configured | | | | traffic steering | | | | policy at the SMF | | | | | | | | (NOTE 12). | | +----------------------+----------------------+----------------------+ | Data Network Access | Identifier(s) of the | Yes | | Identifier(s) | target Data Network | | | | Access. It is | | | | defined in | | | | TS 23.501 [5], | | | | clause 5.6.7. | | +----------------------+----------------------+----------------------+ | Information on AF | Indicates whether | Yes | | subscription to UP | notifications in | | | changes events | case of change of UP | | | | path are requested | | | | (as defined in | | | | TS 23.501 [5] | | | | clause 5.6.7). | | +----------------------+----------------------+----------------------+ |** RAN support | **_This part defines | | | information_ * | information | | | | supporting the RAN | | | | for e.g. handover | | | | threshold | | | | decision.**_| | +----------------------+----------------------+----------------------+ | UL Maximum Packet | The maximum rate for | Yes | | Loss Rate | lost packets that | | | | can be tolerated in | | | | the uplink direction | | | | for the service data | | | | flow. It is defined | | | | in TS 23.501 [5], | | | | clause 5.7.2.8. | | +----------------------+----------------------+----------------------+ | DL Maximum Packet | The maximum rate for | Yes | | Loss Rate | lost packets that | | | | can be tolerated in | | | | the downlink | | | | direction for the | | | | service data flow. | | | | It is defined in | | | | TS 23.501 [5], | | | | clause 5.7.2.8. | | +----------------------+----------------------+----------------------+ |__MA PDU Session |_**This part defines | | | Control** | information | | | | supporting control | | | | of MA PDU | | | | Sessions*** | | +----------------------+----------------------+----------------------+ | Aggregation method | Indicates the | Yes | | | applicable traffic | | | | aggregation method | | | | :\ | | | | Values: MPTCP proxy, | | | | NULL, , etc | | | | | | | | > Editor\'s note: | | | | > The values to be | | | | > used for | | | | > aggregation | | | | > methods are FFS. | | +----------------------+----------------------+----------------------+ | Steering mode | Indicates the rule | Yes | | | for distributing | | | | traffic between | | | | accesses | | | | (Active-Standby, | | | | Smallest-Delay, | | | | Load-Balancing), | | | | together with the | | | | associated | | | | parameters such as | | | | allowed access | | | | types, weights etc. | | | | The PCF may indicate | | | | separate values for | | | | up-link and | | | | down-link | | | | directions. The | | | | actual content | | | | depends on the | | | | detailed steering | | | | modes concluded. | | +----------------------+----------------------+----------------------+ | Charging for 3GPP | Indicates parameters | Yes | | access | used for charging | | | | packets carried via | | | | 3GPP access for a MA | | | | PDU Session. The | | | | same set of | | | | parameters as for | | | | the Charging | | | | information above | | | | applies. If a | | | | parameter is not | | | | included here, the | | | | value provided in | | | | the Charging | | | | information above | | | | applies. | | +----------------------+----------------------+----------------------+ | Charging for N3GPP | Indicates parameters | Yes | | access | used for charging | | | | packets carried via | | | | N3GPP access for a | | | | MA PDU Session. The | | | | same set of | | | | parameters as for | | | | the Charging | | | | information above | | | | applies. If a | | | | parameter is not | | | | included here, the | | | | value provided in | | | | the Charging | | | | information above | | | | applies. | | +----------------------+----------------------+----------------------+
More than one aggregation method may be simultaneously configured for a MA PDU
session.
Aggregation mode: The Aggregation mode indicates the method for how traffic
matching the SDF template is sent over the MA PDU Session. Aggregation mode
NULL indicates that the traffic matching the SDF template is sent over the MA
PDU Session without additional tunnelling, e.g. with IP flow switching.
Aggregation mode MPTCP proxy indicates that the traffic matching the SDF
template is sent over the MA PDU Session using MPTCP proxy.
Editor\'s note: The above information, e.g. for Aggregation Methods and
Steering Mode need to be aligned with the conclusions made.
Editor\'s note: It is FFS whether separate Steering Modes in UL and DL is to
be supported.
### 6.13.3 Impacts on existing entities and interfaces
## 6.14 Solution 14: N4 support for ATSSS
### 6.14.1 General
In order to control ATSSS usage in the UPF, the SMF needs to provide
information over N4 that instructs the UPF how to process the traffic in
relation to ATSSS. This solution describes how N4 rules can be extended to
support ATSSS.
### 6.14.2 Solution description
In current UP processing model, the incoming packets are matched against PDRs
(containing Packet Detection Information, PDI, with traffic descriptors) in
precedence order. The PDR contains pointers (rule IDs) for other rules
handling QoS (QER), usage reporting (URR) and forwarding (FAR). Each PDR can
be associated with multiple QERs and URRs but only one FAR since the
forwarding of each packet is uniquely determined by the FAR associated to the
PDR matching the packet.
With ATSSS we have two alternative forwarding paths (one for 3GPP access and
one for N3GPP access). There is thus a need for two FARs. In this solution it
is proposed that the MAR is introduced to describe the multi-access handling
and include the association to the two FARs, as described below.
This solution proposes that the ATSSS-specific handling is encoded in a new
rule on N4, here called Multi-Access Rule (MAR). Other alternatives would be
to extend existing rules, such as PDR and/or FAR, but to not complicate these
existing rules further it is preferable to encode the MA handling in a
logically separate construct.
The MAR includes pointers to the two FARs, as well as relevant information
related to the steering mode. In case of steering mode \"Active-Standby\",
depending on whether it is the CP (SMF) or the UP (UPF) that detects when an
access becomes unavailable/available, this steering mode can be handled in the
SMF or in the UPF. For the other steering modes (\"Smallest Delay\" and \"Load
Balancing\") the information need to be sent to the UPF.
To enable separate usage reporting (with separate URR IDs) per access, the MAR
can contain pointers to QER per FAR. The PDR-level URR IDs apply to the SDF as
such and will thus apply independent of access used. The MAR-level URR IDs are
associated with a specific Forwarding Action Rule and thus applies per access
type.
The QERs associated to the PDR applies to the SDF as such and is not access
specific if MA PDU Session is used. Packet Detection Rule.
The PDR is enhanced to allow it to be associated to a MAR instead of a FAR, as
shown below.
Table 6.14.1: N4 Rules to support ATSSS
+----------------+----------------+----------------+----------------+ | Attribute | Description | Comment | | +----------------+----------------+----------------+----------------+ | N4 Session ID | Identifies the | | | | | N4 session | | | | | associated to | | | | | this PDR | | | +----------------+----------------+----------------+----------------+ | Rule ID | Unique | | | | | identifier to | | | | | identify this | | | | | rule | | | +----------------+----------------+----------------+----------------+ | Precedence | Determines the | | | | | order, in | | | | | which the | | | | | detection | | | | | information of | | | | | all rules is | | | | | applied | | | +----------------+----------------+----------------+----------------+ | Packet | Source | Contains the | Combination of | | | interface | values | UE IP address | | | | \"access | (together with | | | | side\", \"core | Network | | | | side\", | instance, | | | | \"SMF\", | | | | | \"N6-LAN\" | | +----------------+----------------+----------------+----------------+ | detection | UE IP address | One IPv4 | if necessary), | | | | address and/or | CN tunnel | | | | one IPv6 | info, packet | | | | prefix with | filter set, | | | | prefix length | application | | | | | ID, | +----------------+----------------+----------------+----------------+ | information | Network | Identifies the | Ethernet PDU | | | instance | Network | Session | | | (NOTE 1) | instance | Information | | | | associated | and QFI are | | | | with the | used for | | | | incoming | traffic | | | | packet | detection. | +----------------+----------------+----------------+----------------+ | | CN tunnel info | CN tunnel info | | | | | on N3, N9 | | | | | interfaces, | | | | | i.e. F-TEID | | +----------------+----------------+----------------+----------------+ | | Packet Filter | Details see | Details like | | | Set | clause 5.7.6, | all the | | | | TS | combination | | | | 23.501 [5]. | possibilities | | | | | on N3, N9 | | | | | interfaces | +----------------+----------------+----------------+----------------+ | | Application ID | | are left for | | | | | stage 3 | | | | | decision. | +----------------+----------------+----------------+----------------+ | | QoS Flow ID | Contains the | | | | | value of 5QI | | | | | or | | | | | no | | | | | n-standardized | | | | | QFI | | +----------------+----------------+----------------+----------------+ | | Ethernet PDU | Refers to all | | | | Session | the (DL) | | | | Information | Ethernet | | | | | packets | | | | | matching an | | | | | Ethernet PDU | | | | | session, as | | | | | further | | | | | described in | | | | | c | | | | | lause 5.6.10.2 | | | | | and in | | | | | TS | | | | | 29.244 [27]. | | +----------------+----------------+----------------+----------------+ | Outer header | Instructs the | Any extension | | | removal | UP function to | header shall | | | | remove one or | be stored for | | | | more outer | this packet. | | | | header(s) | | | | | (e.g. | | | | | IP+UDP+GTP, | | | | | VLAN tag), | | | | | from the | | | | | incoming | | | | | packet. | | | +----------------+----------------+----------------+----------------+ | Forwarding | The Forwarding | | | | Action Rule ID | Action Rule ID | | | | | identifies a | | | | (NOTE 2) | forwarding | | | | | action that | | | | | has to be | | | | | applied. | | | +----------------+----------------+----------------+----------------+ | Multi-access | The | | | | Rule ID | Multi-access | | | | | Rule ID | | | | (NOTE 2) | identifies an | | | | | action to be | | | | | applied for | | | | | handling | | | | | forwarding for | | | | | a MA PDU | | | | | Session. | | | +----------------+----------------+----------------+----------------+ | List of Usage | Every Usage | | | | Reporting Rule | Reporting Rule | | | | ID(s) | ID identifies | | | | | a measurement | | | | | action that | | | | | has to be | | | | | applied. | | | +----------------+----------------+----------------+----------------+ | List of QoS | Every QoS | | | | Enforcement | Enforcement | | | | Rule ID(s) | Rule ID | | | | | identifies a | | | | | QoS | | | | | enforcement | | | | | action that | | | | | has to be | | | | | applied. | | | +----------------+----------------+----------------+----------------+ | NOTE 1: Needed | | | | | e.g. in case: | | | | | | | | | | - UPF | | | | | supports | | | | | multiple DNN | | | | | with | | | | | overlapping IP | | | | | addresses; | | | | | | | | | | - UPF is | | | | | connected to | | | | | other UPF or | | | | | AN node in | | | | | different IP | | | | | domains. | | | | | | | | | | NOTE 2: Either | | | | | a FAR ID or a | | | | | MAR ID is | | | | | included, not | | | | | both | | | | +----------------+----------------+----------------+----------------+
Multi-access control Rule:
Table 6.14.1: Multi-access control Rule
+----------------+----------------+----------------+----------------+ | Attribute | Description | Comment | | +----------------+----------------+----------------+----------------+ | N4 Session ID | Identifies the | | | | | N4 session | | | | | associated to | | | | | this PDR | | | +----------------+----------------+----------------+----------------+ | Rule ID | Unique | | | | | identifier to | | | | | identify this | | | | | rule | | | +----------------+----------------+----------------+----------------+ | Steering mode | Values | | | | | \"Smallest | | | | | Delay\", | | | | | \"Load | | | | | Balancing\" or | | | | | \"Ac | | | | | tive-Standby\" | | | +----------------+----------------+----------------+----------------+ | Access | **Access | | | | Forwarding | Forwarding | | | | Action | Action | | | | | information | | | | information | contains one | | | | | of the | | | | | following set | | | | | per access | | | | | type:** | | | +----------------+----------------+----------------+----------------+ | | Forwarding | The Forwarding | | | | Action Rule ID | Action Rule ID | | | | | identifies a | | | | | forwarding | | | | | action that | | | | | has to be | | | | | applied. | | +----------------+----------------+----------------+----------------+ | | Weight | Identifies the | The weights | | | | weight for | for all FARs | | | | each FAR in | need to sum up | | | | case steering | to 100 | | | | mode is \"Load | | | | | Balancing\" | | +----------------+----------------+----------------+----------------+ | | List of Usage | Every Usage | This enables | | | Reporting Rule | Reporting Rule | the SMF to | | | ID(s) | ID identifies | request | | | | a measurement | separate usage | | | | action that | reports for | | | | has to be | different FARs | | | | applied. | (i.e. | | | | | different | | | | | accesses) | +----------------+----------------+----------------+----------------+
QoS Enforcement Rule:
\- There is no impact to the QER.
Usage Reporting Rule:
\- There is no impact to the URR.
### 6.14.3 Impacts on existing entities and interfaces
# 7 Conclusions
The ATSSS solution in Rel-16 shall be based on the following principles:
**Support of MA-PDU sessions**
1\. The solution shall support ATSSS with a Multi-Access PDU (MA-PDU) session,
i.e. ATSSS procedures shall be applied after a MA-PDU session is established.
NOTE 1: A solution using ATSSS without a MA-PDU session shall not be
considered in Rel-16 but may be considered in a subsequent release.
2\. A UE shall request a MA-PDU session based on the procedure specified in
clause 6.2.3.3 \"UE Requested MA-PDU Session Establishment\". When the UE
requests a MA-PDU session and the UE is registered to the same PLMN via both
3GPP and non-3GPP accesses, then user-plane resources for the MA-PDU session
shall be established on both accesses. When the UE requests a MA-PDU session
and the UE is registered via one access only, then user-plane resources for
the MA-PDU session shall be established on one access only.
2a. The UE may request a MA-PDU session when the UE is registered to the same
PLMN via both 3GPP and non-3GPP accesses, or when the UE is registered via one
access only.
2b. At any given time, a MA-PDU session may have user-plane resources on both
3GPP and non-3GPP accesses, or on one access only, or may not have user-plane
resources on any access.
2c. During the normative phase of the work, it will be decided if the user-
plane resources for the MA-PDU on a specific access, shall be established with
a Service Request procedure, or with a session management procedure.
3\. When the UE sends a NAS message to request a single-access PDU session and
the UE supports MA-PDU sessions, the UE includes an \"MA-PDU capability\"
indication in the NAS message. This indication may be used by the network to
establish a multi-access PDU session, instead of the requested single-access
PDU session, as specified in clause 6.2.4.
3a. The Access Type Preference component of a URSP rule shall be able to
indicate \"Multi access\", in addition to the \"3GPP access\" and \"non-3GPP
access\", which are already specified in TS 23.503 [7]. This enables the UE to
request a MA-PDU session based on the provisioned URSP rules. As an example,
if the UE applies the URSP rule shown below, the UE may request a MA-PDU
session with parameters DNN-1, SSC Mode 3, IPv6 and S-NSSAI-1.
URSP rule:
\- Rule Precedence = 1.
\- Traffic descriptor:
\- IP descriptors = a.b.c.d/16.
\- Route selection descriptor:
\- DNN selection = DNN-1.
\- SSC Mode Selection = SSC Mode 3.
\- PDU session type = IPv6.
\- Network slice selection = S-NSSAI-1.
\- Access Type preference = Multi access.
3b. MA-PDU Session is supported only in non-roaming and LBO scenario (i.e.
both accesses serving same PLMN).
3c. ATSSS is not supported in EPC. After moving from EPS to 5GS, under which
conditions a PDU Session can be transformed into a MA-PDU Session will be
considered in normative phase.
3d QoS support of MA-PDU sessions:
a) The SMF provides QoS rule(s) to the UE, which is commonly used for 3GPP and
non-3GPP accesses.
b) The SMF provides PDR to the UPF, which is commonly used for 3GPP and
non-3GPP accesses.
c) Non-GBR QoS Flow and GBR QoS Flow are supported in MA-PDU session.
d) For non-GBR QoS Flow, the SMF requests to setup AN resource (i.e.
establishment of radio bearer and IPsec SA, updating QoS Flows to AN resources
mapping) in 3GPP and non-3GPP access.
e) For GBR QoS Flow,
\- in case of GBR QoS Flow is allowed in single access by PCC rule, the SMF
requests to setup AN resource over single access indicated by PCC rule.
\- in case of GBR QoS Flow is allowed in both accesses by PCC rule, the SMF
decides which access to setup AN resource based on local policy. When the SMF
decides that GBR QoS Flow need to be moved to the other access, the SMF
requests to setup AN resource over the other access.
NOTE: How the SMF decides that GBR QoS Flow needs to be moved to the other
access will be decided during the normative phase.
**Policy for ATSSS Control**
4\. During the establishment of a MA-PDU session, the PCF may create PCC rules
that contain information for controlling the traffic steering across multiple
accesses used by a MA-PDU session. In addition to the existing information in
the PCC rule such as QoS and charging information, these rules as described in
solution#13, also specify how the packets matching the service data flows
template of the PCC rule should be routed across the 3GPP and non-3GPP
accesses.
5\. The SMF maps the PCC rules into (a) ATSSS rules which are sent to UE via
the AMF, and (b) Packet Detection Rules and other N4 rules which are sent to
UPF. The ATSSS rules are used by the UE for uplink traffic steering and the N4
Rules are used by the UPF for downlink traffic steering. The N4 is extended as
described in solution#14.
6\. The ATSSS rules are sent to UE with a NAS message when the MA-PDU session
is created or when they are updated by SMF/PCF. Similarly, the Packet
Detection Rules are sent to UPF when the MA-PDU session is created or when
they are updated by SMF/PCF.
7\. An ATSSS rule includes the following:
a) A Precedence value, which identifies the priority of this ATSSS rule with
respect to other ATSSS rules.
b) A Traffic Descriptor, which identifies a service data flow (SDF). It may
include e.g. an Application ID, IP descriptors (Destination Address,
Destination Port and Destination FQDN), non-IP descriptors, etc.
c) A Steering Mode, which identifies how the matching SDF should be steered
across 3GPP and non-3GPP accesses. The following Steering Modes will be
supported:
\- Active-Standby: It is used to steer a SDF on one access (the Active
access), when this access is available, and to switch the SDF to the other
access (the Standby access), when Active access becomes unavailable. When the
Active access becomes available again, the SDF is switched back to this
access. If the Standby access is not defined, then the SDF is only allowed on
the Active access and cannot be transferred on another access.
\- Smallest Delay: It is used to steer a SDF to the access that is determined
to have the smallest Round-Trip Time (RTT). As defined below, measurements may
be conducted to determine the RTT over 3GPP access and over non-3GPP access.
\- Load-Balancing: It is used to split a SDF across both accesses. With a
50/50 load-balancing, the SDF traffic is equally split across the two
accesses. With an 80/20 load-balancing, about 80% of the SDF traffic is sent
on one access and 20% on the other access.
\- Priority-based: It is used to steer an SDF using only the high priority
access until a congestion arises on the corresponding interface and, when the
high priority access is congested, additionally using the low priority access
by splitting the SDF over the two accesses. In addition, when the high
priority access becomes unavailable, all traffic is switched to the low
priority access. How UE and UPF determine when a congestion occurs on an
interface is implementation dependent.
d) A Steering Function, which identifies whether the Higher Layer Steering
function (i.e. MPTCP function) or the Lower Layer Steering function (e.g.
ATSSS function as shown in Fig. 7-1) should be used to steer the traffic of
the matching SDF. This is useful in case the UE supports multiple functions
for traffic steering.
e) The ATSSS rule supports 3GPP RAT differentiation and may contain Access
Technology instead of access information according to operator\'s policy as
described in Solution 8.
8\. As an example, the following ATSSS rules could be provided to UE:
a) \"Traffic Descriptor: UDP, DestAddr 1.2.3.4\", \"Steering Mode: Active-
Standby, Active=3GPP, Standby=non-3GPP\"
\- This means \"steer UDP traffic with destination IP address 1.2.3.4 to the
active access (3GPP), if available. If the active access is not available, use
the standby access (non-3GPP)\".
b) \"Traffic Descriptor: TCP, DestPort 8080\", \"Steering Mode: Smallest
Delay\"
\- This means \"steer TCP traffic with destination port 8080 to the access
with the smallest delay\". The UE needs to occasionally measure the RTT over
both accesses, in order to determine which access has the smallest delay.
c) \"Traffic Descriptor: Application-1\", \"Steering Mode: Load-Balancing,
3GPP=20%, non-3GPP=80%\", \"Steering Function: MPTCP\"
\- This means \"send 20% of the traffic of Application-1 to 3GPP access and
80% to non-3GPP access by using MPTCP\".
d) \"Traffic Descriptor: TCP, DestDomain Dreamy5G.com\", \"Steering Mode:
Smallest Delay\"
\- This means \"steer TCP traffic with destination domain \"google.com\" to
the access with the smallest delay\".
**Support of Measurements**
9\. The following measurements shall be specified:
‐ It shall be possible for the UE and the network to measure the RTT over both
accesses. Such measurements may be required only under certain conditions,
e.g. only when the UE has a valid ATSSS rule using a \"Smallest Delay\"
steering mode.
‐ It shall be possible for the network to determine when an access becomes
available or unavailable in a timely manner, for e.g. active/standby steering
mode. As how this is determined by the network or whether the UE needs to send
some indication that an access has failed/recovered will be considered in the
normative phase.
10\. Measurements between the UE and the UPF take place over the user-plane.
10a. When the UE requests a MA-PDU session and indicates it is capable to
support the ATSSS function (according to bullet 17a and 17c below), the UE may
receive measurement assistance information, during the establishment of a MA-
PDU session. This information assists the UE in determining how measurements
could be taken over both accesses, and includes the IP address and the port of
a Performance Measurement Function (PMF) in the UPF, with which the UE can
initiate measurement sessions. During the normative phase of the work, it may
be considered if additional parameters (e.g. how often measurements can be
taken, etc.) can be included in the measurement assistance information.
10b. When the UE requests a MA-PDU session and indicates it is capable to
support the MPTCP function only (according to bullet 17b below), the UE shall
not receive measurement assistance information. In this case, the UE and the
MPTCP proxy apply the measurements taken by the MPTCP protocol.
10c. Additional details of measurements, e.g. whether the UE needs to send its
measurements to the network and whether the measurements will be taken by
using only the default QoS flow or additional QoS flows, will be considered in
the normative phase.
**Support of Steering Functions**
11\. Higher Layer Steering function:
I. MPTCP Function.
The solution supports MPTCP as follows:
a) During the MA-PDU session establishment, if the UE is capable to use MPTCP
for traffic steering, the UE provides an \"MPTCP Request\" indication.
b) If the network agrees to enable MPTCP for the MA-PDU session then:
i) The network allocates to UE one IP address/prefix for the MA-PDU session
and two additional IP addresses, called \"link-specific multipath\" addresses;
one associated with 3GPP access and another associated with the non-3GPP
access. . These two IP addresses are used only by the MPTCP function in the
UE. Each \"link-specific multipath\" address assigned to UE may not be
routable via N6. The MPTCP function in the UE shall use the \"link-specific
multipath\" addresses to establish sub-flows over non-3GPP access and over
3GPP access.
ii) The network shall send MPTCP proxy information to UE, i.e. the IP
address(es), a port number and the type of the MPTCP proxy (e.g. SOCKS5 (see
RFC 1928 [9]), or TCP Convert Protocol (see draft-ietf-tcpm-converters-04
[10]), The type(s) of MPTCP proxies that shall be supported, will be decided
during the normative phase of the work.
iii) The network may indicate to UE the list of applications for which MPTCP
should be applied. This is achieved by using the Steering Function component
of an ATSSS rule (see bullet 7d), which indicates to UE whether MPTCP should
be applied for steering the traffic of one or more applications.
Within the same MA-PDU session in the UE, if MPTCP is enabled, it is possible
to steer the MPTCP flows by using the MPTCP protocol (the MPTCP function) and,
simultaneously, to steer all other flows by using a lower-layer steering
functionality, called the \"ATSSS function\". This is schematically
illustrated in Fig. 7-1, which shows an example UE model with an MPTCP
function and an ATSSS function. The MPTCP flows is the traffic of the
applications for which MPTCP can be applied (see bullet 11.b.iii). Note that
in Fig. 7-1, the MPTCP traffic goes through the MA-PDU session but is not
handled by the ATSSS function. The illustrated IP\@3 corresponds to the IP
address of the MA-PDU session and the IP\@1 and IP\@2 correspond to the
\"link-specific multipath\" IP addresses introduced in bullet 11.b.i.
The MPTCP proxy functionality is located in the UPF. For the same N4 Session
in the UPF, if MPTCP is enabled, the UPF shall steer the MPTCP flows by using
the MPTCP protocol and, simultaneously, steer other flows without MPTCP (as
defined for the \"ATSSS function\"). The steering is based on the N4 rules
supporting ATSSS provided by SMF (PDR etc). UPF-internal handling of the
packet flows in a MA PDU Session is based on the packet processing model
described in TS 29.244 [27] (i.e. the UPF supports functionality defined for
the \"ATSSS function\", but a separate \"ATSSS function\" in the UPF is not to
be defined).
The same set of ATSSS rules is applied for steering decisions by the MPTCP
function and by the ATSSS function.
II. Steering methods for non-TCP traffic flow splitting.
Steering methods supporting IP traffic splitting and tunnelling shall be based
on IETF protocols. Currently, the candidates of the IETF protocols are still
work in progress to be standardized. The evaluation of such methods, the
selection of the protocol and the introduction may be considered for Rel-16 as
a low priority. By the completion of the normative phase, if there is no IETF
protocol available to support non-TCP traffic splitting within Rel-16
timeframe, this functionality will be deferred to future release.
12\. Lower Layer Steering functions:
I. ATSSS Function.
ATSSS Function supports NULL tunnelling as described in clause 6.1.7.1 for IP
and Ethernet traffic.
II. Other steering methods for IP and Ethernet traffic flow switching.
Additional steering methods supporting traffic switching shall be based on
IETF protocols. Currently, the candidates of the IETF protocols are still work
in progress to be standardized. The evaluation of such methods, the selection
of the protocol and the introduction may be considered for Rel-16 as a low
priority. By the completion of the normative phase, if there is no IETF
protocol available to support IP and Ethernet traffic switching within Rel-16
timeframe, this functionality will be deferred to future release.
Figure 7-1: An example of a UE supporting the MPTCP function and the ATSSS
function
**Support of different access types**
15\. The ATSSS solution supports any type of access, including Untrusted
non-3GPP access (see TS 23.501 [5], TS 23.502 [6]), Trusted non-3GPP access
(see TR 23.716 [22]), Wireline 5G Access (see TR 23.716 [22]), Wireline 5G
Cable Access (see TR 23.716 [22]), etc., as long as a MA-PDU session can be
established using this type of access.
**Support of different UE capabilities**
16\. An ATSSS-capable UE shall be able to support (a) the ATSSS function only,
or (b) the MPTCP function only, or (c) both the ATSSS function and the MPTCP
function.
17\. When a UE requests a MA-PDU session, the UE sends a PDU session
establishment request including an \"MA-PDU Request\" indication and:
a) the \"ATSSS Capability\", when the UE is capable to support the ATSSS
function only; or
b) the \"MPTCP Capability\", when the UE is capable to support the MPTCP
function only; or
c) the \"ATSSS Capability\" and the \"MPTCP Capability\", when the UE is
capable to support both the ATSSS function and the MPTCP function.
#
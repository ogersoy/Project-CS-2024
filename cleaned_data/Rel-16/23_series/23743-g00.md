# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
With the increase of the size of UE radio capabilities driven by additional
bands supported by RAN specifications and UE support of significantly more
band combinations, the size of the UE Radio Capabilities has and will
significantly grow from Rel-15 onwards, an efficient approach to signal UE
Radio Capability information is therefore needed.
This study item shall address two issues:
\- Optimizations of system procedures pertaining to the transfer UE Radio
Capabilities related information to RAN.
\- Optimizations of system procedures related to transfer UE Radio
Capabilities impacting the Core Network.
The overall goal is to study mechanisms to reduce the signalling over Uu, CN-
RAN, CN-CN and RAN-RAN interfaces as well as the processing load in core and
RAN (taking into account how frequently those message transfers and
corresponding processing occurs) working in collaboration with RAN WGs for the
related RAN interfaces and CT WG4 for the CN interfaces and NFs.
At minimum, the study shall consider the UE Radio Capabilities related aspects
and any other optimisation which is deemed necessary in collaboration with RAN
WGs. The study also considers scenarios where the UE radio capabilities change
based on various events triggered in NAS (e.g. when certain services are not
supported in one system/access and the UE wants to stay registered in another
system/access, the UE may disable the radio capability for accessing the first
system).
As part of the study and in coordination with other WGs especially RAN WGs it
should be concluded whether to proceed with normative work.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.502: \" Procedures for the 5G System\".
[3] 3GPP TS 23.501:\" System Architecture for the 5G System; Stage 2\".
[4] 3GPP TS 23.222: \"Common API Framework for 3GPP Northbound APIs\".
[5] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\".
[6] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
[7] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[8] 3GPP TS 29.501: \"5G System; Principles and Guidelines for Services
Definition; Stage 3\".
[9] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] apply.
# 4 Architectural Requirements and Assumptions
## 4.1 Architectural Requirements
The solution for the UE radio capability signaling optimizations shall take
the following requirements into account:
a) Solutions shall support UE Radio Access Capabilities > 65 536 bytes.
b) Solutions shall provide fast, reliable, low processing complexity
mechanisms for frequently used procedures (at least Service Request, RRC
Connection Resume, X2&Xn handover, secondary gNB addition).
c) The \"UE Capability ID\" should reflect the actual UE capabilities and not
rely on parameters that may be faked, modified, or do not reflect the actual
capabilities (e.g. IMEI and IMEISV might not fulfil this requirement)
NOTE: Even the same UE model with identical software version may have
different UE capabilities e.g. due to customization based on vendor - operator
agreements (sometimes the UE capabilities also differ depending on the PLMN
the device roams on) and would therefore present different \"UE Capability
IDs\" depending e.g. on the PLMN the UE roams.
d) The solution must ensure that malicious implementations (outside of the
operator\'s network) do not update the network with incorrect UE Radio
Capabilities that corresponds to UE capability ID that are used by other
UE\'s.
e) Solution should be flexible enough to cope with additional UE capabilities
that might be added by 3GPP in future releases.
f) Solutions should not require any GTPv2 based interface (e.g. N26, S10) to
carry an Information Element of greater than 50 000 octets.
g) Solutions should not require any HTTP request or response based on TS
29.501 [8] (e.g. for N14) to carry an Information Element of greater than 124
000 octets.
NOTE: Annex A provides background information on this requirement.
## 4.2 Architectural Assumptions
Editor\'s note: This clause will define the underlying architectural
assumptions.
# 5 Key Issues
## 5.1 Key Issue #1: How are the UE Radio Capabilities identified?
### 5.1.1 Description
In TSG SA#79 and TSG RAN#79 discussion took place on defining mechanisms for
optimizing the UE radio capability signalling. RAN sent an LS to TSG SA (cc\'
SA WG2) indicating: \"... conceptual work should be performed in SA WG2 and
RAN WG2 (with potential involvement of other relevant WGs such as RAN WG3 and
CT WG1) since the network should store and manage such UE capability IDs\".
Some form of efficient signaling of the UE Radio Capabilities, is to be
investigated, which may also rely on an efficient representation of UE
capabilities.
Solutions shall take into account a device may have certain features upgraded,
e.g. due to a new SW release, or disabling of certain radio capabilities.
The discussion in TSG RAN and SA WG2 previously considered some options for
such efficient representation:
1\. Using a hash function over the UE capability;
2\. Using components or all of IMEI-SV, i.e., TAC + SVN;
3\. Using a newly defined identifier.
Other options are possible and can be considered.
The study will also determine whether any identifier used for such efficient
representation needs to be globally unique (i.e. standardised), or PLMN-
specific or manufacturer-specific.
This key issue will investigate what is the most appropriate form of such
efficient representation.
## 5.2 Key Issue #2: Where are the UE radio capabilities stored?
### 5.2.1 Description
In LTE/EPS and 5GS Rel-15, the UE radio capabilities are stored in the CN when
the UE is in CM-IDLE and the following principles apply in terms of retrieval
and storage of UE radio capabilities:
\- The AMF/MME stores the UE Radio Capabilities that are forwarded by the RAN
in a N2 or S1 message.
\- When a UE establishes a connection, the AMF/MME includes the last received
UE capabilities as part of the INITIAL CONTEXT SETUP REQUEST message sent to
the RAN.
\- Usually during handover preparation, the source RAN node transfers both the
UE source RAT capabilities and the target RAT capabilities to the target RAN
node, in order to minimize interruptions.
\- UE radio capabilities are not transferred during inter-MME and from MME to
AMF (and vice-versa) mobility but are transferred in inter-AMF mobility inside
5GC.
This key issue investigates whether, the UE radio capabilities will be stored
in RAN or CN. The NF(s) where the UE radio capabilities are stored will be
determined depending on the conclusions reached for key issue #3 \"Management
of UE radio capabilities\", and specifically whether the signalling optimised
scheme applies to 5G System only or both 5G System and EPS will need to be
considered.
## 5.3 Key Issue #3: How are the UE radio capabilities managed?
### 5.3.1 Description
When some form of efficient representation of the UE Radio Capabilities that
represents the actual UE Radio Capabilities is used, the existing procedures
for signalling and retrieval of UE Radio Capabilities may be affected.
This key issue will study the procedures e.g. new procedures or changes in the
existing procedures required in order to accommodate the signalling-optimised
scheme in the management of UE radio capabilities.
Based on the solutions proposed for the procedures it will be decided as part
of this key issue whether the signalling-optimised scheme applies only inside
the 5G System or both in 5G System and EPS.
Any new or modified procedure (if needed) for UE radio capability retrieval
shall co-exist with the Rel-15 mechanisms that apply in EPS and 5GS.
# 6 Solutions
## 6.1 Solution #1: UE manufacturer-specific UE capability ID
### 6.1.1 Introduction
This solution addresses Key Issue #1 (How are the UE capabilities
identified?).
### 6.1.2 Functional Description
In this solution the UE Radio Capabilities are identified with a UE capability
ID that has the following salient characteristics:
\- The UE capability ID is a short pointer (e.g. 2-3 octets; the exact size is
to be determined by RAN) that together with the UE manufacturer information
(e.g.TAC field in the PEI) uniquely identifies a set of UE Radio Capabilities.
Editor\'s note: The detailed manufacturer information will be discussed in
normative work.
\- The UE manufacturer information uniquely identifies the UE manufacturer.
\- The UE capability ID is assigned by the UE manufacturer.
\- The UE is configured with one or more UE capability IDs that map into
distinct set of UE Radio Capabilities.
\- At any given instant the UE has only one UE capability ID that is indicated
to the network.
\- The UE capability ID identifies the UE radio capabilities set that can be
specific to one or multiple RAT types.
### 6.1.3 Procedures
Solutions to other key issues will explain how the UE capability ID is used in
relevant procedures.
### 6.1.4 Impacts on existing entities and interfaces
Solutions to other key issues will explain how the UE capability ID impacts
existing entities and interfaces.
### 6.1.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.2 Solution #2: UE capability ID indicated in Access Stratum and N2
### 6.2.1 Introduction
This solution addresses Key Issues #2 (Where are the UE radio capabilities
stored?) and X3 (How are the UE radio capabilities managed?).
### 6.2.2 Functional Description
This solution has the following salient characteristics:
\- UE indicates the UE capability ID (e.g. as defined in clause 6.1) in
initial access stratum signalling to the RAN node, which further conveys it to
the AMF using N2 signalling.
\- If there is no UE Radio Capabilities corresponding to the UE capability ID,
an indication that the UE Radio Capabilities is not available is also conveyed
to the AMF along with the UE capability ID.
\- The dictionary used for translation of the UE capability ID _[possibly in
combination with PEI or another parameter, depending on the solution to Key
Issue #1]_ into an explicit set of UE Radio Capabilities is stored in the AMF
or in a stand-alone Network Function in the 5GC that can be queried by the
AMF.
NOTE: The indication that the UE Radio Capabilities is not available is
applicable when the UE radio capabilities are identified by means of the UE
capability ID alone.
### 6.2.3 Procedures
If the UE is configured with one or more UE capability IDs, it provides one of
these parameters in initial access stratum signalling. The UE capability ID
and an optional indication that UE radio capabilities is not available is
conveyed to the AMF in an N2 message.
The AMF uses the UE capability ID _[possibly in combination with PEI or
another parameter, depending on the solution to Key Issue #1]_ to retrieve the
explicit set of UE Radio Capabilities. The explicit set of UE Radio
Capabilities is stored locally in the AMF or is fetched from a stand-alone
Network Function in the 5GC architecture.
If the indication that the UE radio capabilities is not available is received
and if the AMF is successful with the retrieval, the AMF signals the explicit
set of UE Radio Capabilities to the RAN in the N2 REQUEST message.
If the AMF is unable to retrieve the explicit set of UE Radio Capabilities
corresponding to the UE capability ID _[possibly in combination with PEI or
another parameter, depending on the solution to Key Issue #1]_ or if the UE\'s
radio capabilities is available in the RAN, the AMF shall not send any UE
Radio Capability information to the RAN in that message. This triggers the RAN
to request the UE Radio Capabilities from the UE and to upload it to the AMF
using an N2 notification message.
### 6.2.4 Impacts on existing entities and interfaces
This clause illustrates the changes to existing procedures in TS 23.502 [2].
Only the impacted steps in the call flows are described. New text is provided
in italics.
#### 6.2.4.1 Registration procedure
Figure 6.2.4.1-1: Registration procedure (same as TS 23.502 [2] Figure
4.2.2.2.2-1)
1\. UE to (R)AN: AN message (AN parameters, Registration Request (Registration
type, SUCI or 5G-GUTI or PEI, last visited TAI (if available), Security
parameters, Requested NSSAI, [Mapping Of Requested NSSAI], UE 5GC Capability,
PDU Session status, List Of PDU Sessions To Be Activated, Follow on request,
MICO mode preference, Requested DRX parameters, UE support of Request Type
flag \"handover\" during the attach procedure) and the list of PSIs).
_The AN parameters may also include a UE Capability ID._
NOTE: The UE Capability ID can be included if the Registration type indicates
Initial Registration or Mobility Registration Update.
3\. (R)AN to new AMF: N2 message (N2 parameters, Registration Request (as
described in step 1) and UE access selection and PDU session selection
information).
_The N2 parameters also include the UE Capability ID if it was provided by UE
in step 1._
_When there is no UE radio capabilities corresponding to the UE capability ID
in the RAN, the N2 parameters also includes an indication that the UE radio
capabilities is not available._
11\. [Conditional] new AMF to UE: Identity Request/Response (PEI).
_If the UE Radio Capability ID was included in step 3 the AMF uses the UE
Capability ID [possibly in combination with PEI or another parameter,
depending on the solution to Key Issue #1] to determine the explicit UE Radio
Capability based on preconfigured mapping information. When there is no UE
radio capabilities corresponding to the UE Capability ID in the AMF, the
determination of the UE Radio Capability may involve a query to a stand-alone
NF that stores the translation dictionary. If the determination of the UE
Radio Capability is successful the AMF stores the UE Capability ID and
optionally the UE Radio Capability in the UE context, overwriting any existing
stored values._
21\. New AMF to UE: Registration Accept (5G-GUTI, Registration Area, Mobility
restrictions, PDU Session status, Allowed NSSAI, [Mapping Of Allowed NSSAI],
[Configured NSSAI for the Serving PLMN], [Mapping Of Configured NSSAI],
Periodic Registration Update timer, LADN Information and accepted MICO mode,
IMS Voice over PS session supported Indication, Emergency Service Support
indicator, Accepted DRX parameters, Network support of Interworking without
N26).
_If the UE Radio Capability is available in the AMF, the UE Radio Capability
is provided to NG-RAN by AMF and an indication that the UE radio capabilities
is not available is received at step3, as part of the UE context in this
step._
Editor\'s note: It is FFS whether there is a benefit in sending the UE Radio
Capability to NG-RAN earlier in this call flow.
#### 6.2.4.2 UE Triggered Service Request
Figure 6.2.4.2-1: UE Triggered Service Request procedure (same as TS 23.502
[2] Figure 4.2.3.2-1)
12\. AMF to (R)AN: N2 Request (N2 SM information received from SMF, security
context, AMF Signalling Connection ID, Handover Restriction List, Subscribed
UE-AMBR, MM NAS Service Accept, list of recommended cells / TAs / NG-RAN node
identifiers).
_If the UE Radio Capability is available in the AMF, the AMF adds the UE Radio
Capability in the N2 Request message to the (R)AN nodes._
#### 6.2.4.3 RAN retrieval of UE Radio Capability
Similar procedure already exists in TS 23.502 [2] clause 4.2.8a (UE Capability
Match Request procedure). It is proposed here as a new stand-alone procedure
for clarity.
_If the AMF has not provided the UE Radio Capability as part of establishment
of UE context in the RAN, the RAN retrieves the UE Radio Capability over the
radio interface and notifies the AMF using the N2 UE Capability Info
Indication message._
Figure 6.2.4.3-1: RAN retrieval of UE Radio Capability (new)
_1\. If the (R)AN has not already received the UE radio capabilities from the
AMF, the (R)AN requests the UE to upload the UE radio capability information._
_2\. The UE provides the (R)AN with its UE radio capabilities sending the RRC
UE Capability Information._
_3\. The (R)AN sends the UE Radio Capability to the AMF. The AMF stores the UE
Radio Capability without interpreting it for further provision to the (R)AN as
per TS 23.501 [3] clause 5.4.4.1._
### 6.2.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.3 Solution #3: Solution using Hash-based Identification of UE radio
capabilities
### 6.3.1. Introduction
This solution addresses Key Issue 1: \"How are the UE Radio Capabilities
identified?\"
### 6.3.2 Functional Description
The following solution proposes to use a HASH value to identify UE Radio
Capabilities. The UE calculates a HASH value of the UE Radio Capabilities and
sends the HASH value to network and the network will determinate if
corresponding UE Radio Capabilities is already available. If the corresponding
UE Radio Capability is not available then it needs to be retrieved from the
UE. When the network receives the UE Radio Capabilities, RAN needs to
calculate the HASH value in order to validate that the HASH value corresponds
to the uploaded UE Radio Capabilities before accepting them.
The RRC Protocol defines how to signal the UE Radio Capability in TS 38.331
[5] for NR.
The HASH value is calculated of the ASN.1 coded representation of the UE radio
capabilities using SHA (Secure Hash Algorithm) algorithm. The HASH value is
used as UE Capability ID.
Editor\'s note: Which one of the different SHA families (SHA-2 or SHA-3) to
use and which function within the hash family is FFS. The different versions
differ in size of the hash and how secure it is calculated. For example, if
128 bit hash is used, which fits into current protocols, the probability for
conflicts is very low. This needs to be evaluated with RAN and SA WG3.
The solution on Key Issue 2 will cover how the HASH value (UE Capability ID)
is signalled between the UE and network. Solution on Key Issue 2 will also
cover procedure how to signal the corresponding UE Radio Capability
information from the UE to RAN if it is not available in the network.
NOTE: Different UE implementations may store the UE Radio Capability in
different orders. UE\'s from different vendors, with the same radio
capability, may have different hashes if the order of the capabilities is
different.
Instead of a single HASH value (UE Capability ID), a list of one or more HASH
values (UE Capability ID\'s) will be used, one for each sub-set of the UE
Radio Capabilities. This also implies that when the UE sends a list of UE
Capability ID\'s then the network will handle them one by one. For example,
some of the UE Capability ID\'s and corresponding UE Radio Capabilities might
be available in RAN or CN and the remaining UE Radio Capability ID\'s need to
be downloaded again from the UE. It is the UE implementation that defines into
which sub-set each UE Radio Capability IE belongs to and each sub-set has its
own HASH value (UE Capability ID). If the size of each sub-set is less than
current maximum allowed size defined by RAN then additional segmentation in
RAN is not needed. Current size limitation defined by RAN PDCP frame size is
9000 octets for NR and 8188 octets for E-UTRA.
Option 1: With the assumption that each subset of UE Radio Capabilities is
calculated with SHA-256 the probability is very low that two different UE
Radio Capabilities have the same hash value so we do not specify any solution
for that.
Option 2: The UE Capability ID is extended to also include a device
manufacturer unique identifier, this could for example be the same as proposed
in solution #1 to use the TAC code. The UE vendor also need to ensure that the
two different UE Radio Capabilities does not have the same HASH value via re-
arrange the order of the individual UE Radio Capabilities to ensure unique
hash.
### 6.3.3 Procedures
Solutions to Key Issue 2 will define procedures on how the HASH value (UE
capability ID) is used in relevant procedures and how RAN will retrieve UE
Radio Capability from the UE.
The only addition in this solution is that after RAN has retrieved the UE
Radio Capabilities then RAN needs to calculate the same HASH value to validate
that the retrieved UE Radio Capabilities corresponds to the HASH value (UE
Capability ID) before accepting it.
### 6.3.4 Impacts on existing entities and interfaces
Solutions to Key Issues 2 will explain how the UE capability ID impacts
existing entities and interfaces. The only additional impact is that the UE
and RAN needs to calculate the HASH value from the UE Radio Capability.
### 6.3.5 Evaluation
This solution supports that the network is protected against malicious updates
of UE Capability ID\'s and corresponding UE Radio Capabilities.
This solution option1 does not accommodate for collisions especially about the
network will be able to detect them. For instance, if the 64Kbyte radio
capabilities of UE A produce after HASH a UE-Capability-1 of 256 bits, but UE
B with different set of radio capabilities produce after HASH UE-Capability-1
the network will not be able to detect this collision without additional
information. Even if such occurrence is rare, any occurence can lead impacted
UEs of the same type being in continuous mis-operation or no service.
The Option 2 in the solution fully accommodate in preventing any hash
collisions.The UE Capability ID is comprised of a UE manufacturer information
(e.g. TAC field in the PEI) and the hash of the actual UE Radio Capability,
allowing the vendor to ensure that no hash collisions is possible for
different UE Radio capabilities.
## 6.4 Solution #4: Provisioning of UE Radio Capability using UDR
### 6.4.1 Introduction
The solution addresses key issue #2. It proposes that Application Function
(e.g., owned by UE manufacturer, or operator) provisions to the UDR the
representation of UE radio capability (e.g., UE Radio Capability ID) and
corresponding UE radio capabilities. In this solution, the UE Radio Capability
and corresponding UE Radio Capability ID compose the UE Radio Capability
Information. The UDR can notify the UE Radio Capability Information to the AMF
if the AMF subscribes change event of UE Radio Capability. Also this solution
allows the AMF updates the UE Radio Capability Information to the UDR after
the AMF resolves the capabilities, the identifier, and the association between
them.
### 6.4.2 Functional Description
This solution has the following characteristics:
\- AF provisions UE Radio Capability ID and corresponding UE Radio
Capabilities to the Network.
\- NEF exposes API for UE Radio Capability provisioning to the AF.
\- NEF updates the UE Radio Capability Information to the UDR.
\- UDR can notify the updated UE Radio Capability Information to the
subscribed AMF.
\- AMF is able to associate the UE Radio Capability ID and the full UE Radio
Capabilities from the UE. AMF is also able to update the UE Radio Capability
Information to the UDR.
### 6.4.3 Procedures
#### 6.4.3.1 Provisioning UE Radio Capability Information to UDR
In this clause, the procedure for provisioning of UE Radio Capability is
described.
Figure 6.4.3-1: Provisioning of UE Radio Capability information to UDR
Editor\'s note: It is FFS whether to use existing service operation for this
procedure.
1\. The AMF triggers Nnef_DM_Subscribe service operation to the NEF in order
to subscribe notification of the UE Radio Capability Information from the UDR.
The UE Radio Capability Information is composed of the UE Radio Capability and
corresponding UE Radio Capability Identifier. In the Nnef_DM_Subscribe service
operation, the AMF indicates the type of data is for UE Radio Capability
Information and includes its AMF ID to be identified by the UDR.
NOTE: In order to synchronize UE Radio Capability Information among AMFs in
the PLMN, AMF should request subscription to UDR for the UE Radio Capability
Information when the AMF is initiated.
2\. The NEF triggers Nudr_DM_Subscribe service operation based on the
information received in the step 1. The UDR performs authorization whether the
AMF can subscribe notification of the UE Radio Capability Information. If
authorized, the UDR stores received subscription request. If the UDR detects
the AMF hasn\'t been notified any UE Radio Capability Information, the UDR may
decide to provision all the UE Radio Capability Information stored in the UDR.
In this case, the UDR can notify to the AMF with UE Radio Capability
Information as in the step 8.
3\. If there is new type of UE with different UE Radio Capabilities
combination, the AF invokes Nnef_RadioCapability_Provisioning Request service
operation to the NEF. The AF includes UE Radio Capability Information in this
message. The AF can include set of UE Radio Capability Information if there
are various type of UEs to provision UE Radio Capability Information.
In the case of architecture without CAPIF support, the AF is locally
configured with the API termination points for this service operation. In case
of architecture with CAPIF support, the AF obtains the service API information
from the CAPIF core function as specified in TS 23.222 [4].
4\. The NEF authorized the AF request based on the operator policy.
5\. The NEF acknowledges the execution of
Nnef_RadioCapability_Provisioning_request..
6\. The NEF invokes Nudr_DM_Update to the UDR. In this message, NEF includes
the received UE Radio Capability Information from the step 3.
7\. The UDR updates the UE Radio Capability. The UDR sends Nudr_DM_Update
response to the NEF.
8\. The UDR detects that the related subscription for notification of the
updated UE Radio Capability Information. The UDR notifies to the NEF of the
update UE Radio Capability Information by invoking Nudr_DM_Notify service
operation. In this message, the UDR includes the update UE Radio Capability
Information, and the AMF ID which needs to be notified.
9\. The NEF triggers Nnef_DM_Notify service operation based on the information
received in the step 8.
#### 6.4.3.2 Update and sharing of UE Radio Capability Information using UDR
In this clause, the procedure for update and sharing of UE Radio Capability is
described.
Figure 6.4.3-2: Update of UE Radio Capability information to UDR and sharing
to other AMF
1\. During The UE performs registration NAS procedure (e.g., Registration
procedure, Service Request procedure),. If the UE is configured with the UE
Radio Capability IDs, it provides it in initial access stratum signalling. The
UE Radio Capability ID is conveyed to the AMF in an N2 message.
2\. If the AMF cannot figure out its explicit set of the UE Radio Capabilities
corresponding to the UE Radio Capability ID received from the UE, the AMF.
If the NG-RAN doesn\'t have the UE Radio Capability for the UE, the NG-RAN
performs RRC procedure to retrieve the explicit set of UE Radio Capabilities.
If the NG-RAN has the UE Radio Capability for the UE, the NG-RAN provides the
UE Radio Capabilities to the AMF. The AMF may decide to allocate UE Radio
Capability ID (e.g., PLMN specific ID) or to use the received UE Radio
Capability ID from the UE, if there is no mapping for the retrieved UE Radio
Capabilities. The AMF associates the UE Radio Capabilities to the UE Radio
Capability ID, and the AMF stores this information. The AMF provides the UE
Radio Capability Information to the NG-RAN. If the AMF allocates new UE Radio
Capability ID to the UE, the AMF performs UE Configuration Update procedure to
provide the new UE Radio Capability ID.
NOTE 1: It is assumed that AMF can use allocation function of UE Radio
Capability ID which may be located in centralized entity in order to avoid
collision of UE Capability ID allocation. How AMF interacts with are out of
scope.
2\. The AMF invokes Nnef_DM_Update to the NEF. In this message, AMF includes
the stored UE Radio Capability Information in the step 1. The NEF invokes
Nudr_DM_Update service operation based on the received information from the
AMF. The UDR updates the received UE Radio Capability Information. The UDR
sends Nudr_DM_Update response with acknowledge of the update request.
NOTE 2: In order to avoid poisoning the UDR for UE Radio Capability
Information, the UDR may consider counter for the received UE Radio Capability
Information. If the received UE Radio Capability Information matches the one
that was previously received by the Nudr_DM_Update service operation, the UDR
increases a counter. If the counter reaches the threshold defined by the
operator, the UDR stores the UE Radio Capability. Regardless of operation
related to the counter, the UDR responds to the AMF with acknowledge of the
update request.
3\. The UDR detects that AMF 2 has subscribed for notification of the updated
UE Radio Capability Information. The UDR notifies to the AMF 2 of the update
UE Radio Capability Information by invoking Nudr_DM_Notify service operation
to the NEF. In this message, the UDR includes the update UE Radio Capability
Information. The NEF invokes Nudr_DM_Notify service operation to the AMF based
on the received information from the UDR.
NOTE 3: It is assumed that AMFs in the PLMN have subscribed the notification
of update of UE Radio Capability Information to UDR, in order to synchronize
updated UE Radio Capability Information.
### 6.4.4 Impacts on existing entities and interfaces
NEF: New API exposure to AF for UE Radio Capability Information provisioning.
New Nnef service operation to AMF for subscription and update of the UE Radio
Capability Information. The NEF (supporting
provisioning/subscribe/update/notification of UE Radio Capability Information)
doesn\'t have to depend on deployment of other NEF features e.g., external
exposure for monitoring event.
AMF: Use Nnef service for the UE Radio Capability Information Subscription and
Update.
The AMF is able to associate unknown UE Radio Capability ID received from the
UE with explicit set of the UE Radio Capabilities.
UDR: Need to update the UDR to support subscription/notification and update of
the UE Radio Capability information (Table 5.2.12.2.1-1 in TS 23.502 [2] to be
updated to add a new data set).
### 6.4.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
Solution #4 describes how UE Radio Capability IDs and the corresponding
capabilities can be distributed to the AMFs of a network. The source of this
information is an Application Function that can either be owned by the
operator or, if a suitable relationship exists between them, a UE
manufacturer. It provides a standardised, multi-vendor, way to ensure that
manufacturer-assigned IDs and the associated capabilities are available as
quickly as possible in the AMFs. This ensures that the AMFs are able to
recognise such UE Radio Capability IDs when they are included in registration
procedures by UEs and so to avoid the need to allocate and manage operator-
assigned IDs for those UEs, and to avoid the need for the UE to provide its
full capabilities during its initial registration.
Use of a subscribe/notify approach ensures that only those AMFs that require
UE Radio Capability ID and corresponding UE Radio Capabilities receive them.
The solution also describes a mechanism for allowing a network to learn a new
UE manufacturer-assigned ID directly from interaction with a UE. An AMF
receiving an unknown UE manufacturer-assigned ID provides this to the UDR (via
the NEF) and other AMFs in the network can be immediately updated with this
ID. As described above this avoids the need to allocate and manage operator-
assigned IDs for other UEs that subsequently use this ID, and avoids the need
for those UEs to provide its full capabilities during initial registration.
This procedure can be described as \"self-learning\", but carries the risk of
the UDR database being poisoned by maleficent UEs. Mechanisms to avoid this
are described in Solution #13.
## 6.5 Solution #5: UE radio capability reporting and management using UE-
capability-ID
### 6.5.1 Introduction
Editor\'s note: This clause lists the key issue(s) addressed by this solution.
This is a solution for key issues #2 and #3.
UE radio capability reporting will initially consist of possible pre-
configured UE-capability-ID as part of initial Registration procedure. If the
UE is not configured with UE-capability-ID, it will not report any capability
profile at initial Registration and wait for one to be allocated by the AMF
when the UE radio capabilities are successfully retrieved.
There does not seem to be a requirement to support multiple UE-capability-IDs
_simultaneously_ , but it may be possible to allow the UE to support multiple
profiles and select the profile with each connection establishment. For
example, a voice centric and a data centric profile; the UE capabilities may
change after an OTA upgrade; or the UE may need to switch between two
capability profiles optimized for two different regions or areas frequently
visited by the UE. Both profiles may be common across many UEs, that are using
one or the other. Thus, there may not be an increase in memory/resource usage
in the network when both capability profiles are already saved in the network.
Alternatively, when the capabilities change the UE can re-Register indicating
to AMF that radio capabilities have changed using the \"UE radio capability
update\" flag as defined in TS 23.501 [3], clause 5.4.4.1.
### 6.5.2 Functional Description
Editor\'s note: This clause outlines solution principles and documents any
assumptions made.
For the UE capabilities reporting:
\- If the UE has pre-configured one or more UE-capability-ID(s) either
manufacturer assigned or PLMN specific it will report one of the UE-
capability-ID(s) ciphered as part of the initial Registration procedure.
\- The UE may update its UE-capability-ID e.g. when changing from voice to
data centric (and vice versa) and report its updated UE-capability-ID in a new
Registration procedure.
\- The AMF tries to retrieve the UE capabilities corresponding to the UE-
capability-ID UE has reported and (if successful) provides the UE capabilities
to the RAN in the initial UE context setup.
\- If the UE has no pre-configured UE-capability-ID, the UE reports nothing
during the registration procedure.
\- The AMF will not include UE capabilities in the initial UE context setup,
and the RAN will query the capabilities as in Rel-15 procedures defined in TS
23.501 [3]. Then the AMF may assign a corresponding UE-capability-ID for
subsequent reporting (once it receives the UE capabilities from the RAN in the
UE Capability Info Indication message).
\- The AMF may modify the UE-capability-ID associated with an existing set of
UE capabilities.
\- When the UE modifies the radio capabilities, the UE may optionally provide
a new UE-capability-ID (if available) via NAS signaling, e.g., based on device
upgrade.
### 6.5.3 Procedures
Editor\'s note: This clause describes high-level procedures and information
flows for the solution.
The following figures show the detailed UE Radio capabilities procedures based
on the description above:
\- Figure 6.5.3-1 shows the call flow where the UE provides a UE-capability-ID
as part of the registration procedure for the case where the network has the
corresponding UE capabilities
\- Figure 6.5.3-2 shows the call flow where either (a) the UE does not
provides a UE-capability-ID as part of the registration procedure; or (b) the
network does not have the corresponding UE capabilities.
\- Figure 6.5.3-3 shows the call flow where the network modifies the UE-
capability-ID.
\- Figure 6.5.3-4 shows the call flow where the UE modifies the set of UE
radio capabilities and the corresponding UE-capability-ID.
Figure 6.5.3-1: UE provides a UE-capability-ID as part of the registration
procedure where the network has the corresponding UE radio capabilities
Figure 6.5.3-2: Either (a) UE does not provides a UE-capability-ID as part of
the registration procedure; or (b) the network does not have the corresponding
UE capabilities
Figure 6.5.3-3: Network modifies the UE-capability-ID with UE Configuration
Update
Figure 6.5.3-4: UE modifies the set of UE capabilities and the corresponding
UE-capability-ID
### 6.5.4 Impacts on existing entities and interfaces
Editor\'s note: This clause describes impacts to existing entities and
interfaces.
UE, AMF and NG-RAN need to support the procedures indicated in this solution.
### 6.5.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
This solution assumes UE sending the UE Capability ID in NAS (initial
registration procedure) in ciphered form and as such provides protection.
## 6.6 Solution #6: UE capability ID indicated in Access Stratum and N2 and
local RAN Storage
### 6.6.1 Introduction
This solution addresses Key Issues #2 (Where are the UE radio capabilities
stored?) and #3 (How are the UE radio capabilities managed?).
This solution targets the use of UE Capability IDs that are standardized
whereby the UE Capability ID uniquely identifies a set of UE Radio
Capabilities. The UE provides a UE Capability ID and optionally a
complementary set of UE Radio Capabilities that together identify the usable
set of Radio Capabilities of a UE i.e. the Radio Capabilities the UE wishes to
use in the network. Similar to Solution #2, this solution proposes the
dictionary of UE Capability IDs be stored in the Core Network, but in addition
enables local RAN storage as well.
### 6.6.2 Functional Description
This solution has the following salient characteristics:
\- UE indicates the UE capability ID and optionally a complementary set of UE
Radio Capabilities in initial access stratum signalling to the RAN node, which
further conveys these to the AMF using N2 signalling.
\- The dictionary used for translation of the UE capability ID into an
explicit set of UE Radio Capabilities is stored in the AMF or in a stand-alone
Network Function in the 5GC that can be queried by the AMF and locally stored
(replicated) in the (R)AN.
\- The AMF stores as part of the UE context, the UE capability ID and, if
received, the complementary set of UE Radio Capabilities.
### 6.6.3 Procedures
If the UE is configured with one or more UE capability IDs, instead of
providing its full UE Radio Capabilities, it provides one of these UE
Capability IDs and optionally a complementary set of Radio Capabilities (if
applicable) in initial access stratum signalling to the RAN. The UE capability
ID and the optional complementary set of Radio Capabilities are then conveyed
to the AMF in an N2 message.
The AMF uses the received UE capability ID to retrieve the associated explicit
set of UE Radio Capabilities from the dictionary. Retrieval is either done
locally in the AMF or fetched from a stand-alone Network Function in the 5GC
architecture depending on where the dictionary is hosted.
If the AMF is successful with the retrieval i.e. the UE Capability ID is in
the dictionary, the AMF signals the associated explicit set of UE Radio
Capabilities to the RAN in the N2 REQUEST message.
If the AMF is unable to retrieve the explicit set of UE Radio Capabilities
corresponding to the UE capability ID, the AMF shall not send any UE Radio
Capability information to the RAN in that message. This triggers the RAN to
request the UE Radio Capabilities from the UE and to upload it to the AMF
using an N2 notification message.
When setting up the UE context upon registration (update) the AMF stores:
\- The UE Capability ID or the associated explicit set of UE Radio
Capabilities; and
\- if available, the complementary set of Radio Capabilities.
### 6.6.4 Impacts on existing entities and interfaces
This clause illustrates the changes to existing procedures in TS 23.502 [2].
Only the impacted steps in the call flows are described. New text is provided
in italics.
#### 6.6.4.1 Registration procedure
Figure 6.6.4.1-1: Registration procedure (same as TS 23.502 [2] Figure
4.2.2.2.2-1)
1\. UE to (R)AN: AN message (AN parameters, Registration Request (Registration
type, SUCI or 5G-GUTI or PEI, last visited TAI (if available), Security
parameters, Requested NSSAI, [Mapping Of Requested NSSAI], UE 5GC Capability,
PDU Session status, List Of PDU Sessions To Be Activated, Follow on request,
MICO mode preference, Requested DRX parameters, UE support of Request Type
flag \"handover\" during the attach procedure) and the list of PSIs).
_The AN parameters may also include a UE Capability ID and optionally a
complementary set of UE Radio Capabilities._
_NOTE 1: The UE Capability ID, complementary set of UE Radio Capabilities can
be included if the Registration type indicates Initial Registration or
Mobility Registration Update._
3\. (R)AN to new AMF: N2 message (N2 parameters, Registration Request (as
described in step 1) and UE access selection and PDU session selection
information).
_The N2 parameters also include the UE Capability ID and optionally a
complementary set of UE Radio Capabilities, if provided by the UE in step 1,
as well as an indication whether or not the UE Capability ID is known by the
RAN._
11\. [Conditional] new AMF to UE: Identity Request/Response (PEI).
_If the UE Radio Capability ID was included in step 3 the AMF uses the UE
Capability ID [possibly in combination with PEI or another parameter,
depending on the solution to Key Issue #1] to determine the corresponding
explicit UE Radio Capabilities based on preconfigured mapping information
(i.e. disctionary). The determination of the UE Radio Capability may involve a
query to a stand-alone NF that stores the translation dictionary. If the
determination of the UE Radio Capabilities is successful the AMF stores in the
UE context the UE Capability ID and optionally the associated UE Radio
Capabilities, as well as the complementary set of UE Radio Capabilities,
overwriting any existing stored values for this UE._
21\. New AMF to UE: Registration Accept (5G-GUTI, Registration Area, Mobility
restrictions, PDU Session status, Allowed NSSAI, [Mapping Of Allowed NSSAI],
[Configured NSSAI for the Serving PLMN], [Mapping Of Configured NSSAI],
Periodic Registration Update timer, LADN Information and accepted MICO mode,
IMS Voice over PS session supported Indication, Emergency Service Support
indicator, Accepted DRX parameters, Network support of Interworking without
N26).
_If the UE Radio Capabilities corresponding to the UE Capability ID are
available in the AMF, the UE Radio Capabilities are provided to NG-RAN by AMF
as part of the UE context in this step in case NG-RAN indicated in step 3 that
the UE Capability ID was unknown._
Editor\'s note: It is FFS whether there is a benefit in sending the UE Radio
Capability to NG-RAN earlier in this call flow (similar to Solution #2).
#### 6.6.4.2 UE Triggered Service Request
Figure 6.6.4.2-1: UE Triggered Service Request procedure (same as TS 23.502
[2] Figure 4.2.3.2-1)
1\. UE to (R)AN: AN message (AN parameters, Service Request (List Of PDU
Sessions To Be Activated, List Of Allowed PDU Sessions, security parameters,
PDU Session status)).
_The UE provides its UE Capability ID as part of the AN parameters._
_NOTE: This is used by the RAN with local storage capabilities to request the
corresponding set of UE Radio Capabilities if unknown. Alternatively the AMF
could keep track of whether or not the UE Capability ID (as part of the UE
Context it holds) is known to the RAN, depending on the version of the
dictionary the AMF knows the RAN to hold._
2\. (R)AN to AMF: N2 Message (N2 parameters, Service Request, UE Context
request).
_If the UE Capability ID received from the UE is unknown to the (R)AN, the RAN
provides an indication to the AMF together with the UE Context request to
request the associated set of UE Radio Capabilities from the AMF._
12\. AMF to (R)AN: N2 Request (N2 SM information received from SMF, security
context, AMF Signalling Connection ID, Handover Restriction List, Subscribed
UE-AMBR, MM NAS Service Accept, list of recommended cells / TAs / NG-RAN node
identifiers).
_In the N2 Request message to the (R)AN nodes, the AMF includes, if available
and if requested by the (R)AN in step 2, the set of UE Radio Capabilities
associated to the UE Capability ID of the UE. It also includes if available
the complementary set of UE Radio Capabilities of the UE._
#### 6.6.4.3 RAN retrieval of UE Radio Capability
Similar procedure already exists in TS 23.502 [2] clause 4.2.8a (UE Capability
Match Request procedure). It is proposed here as a new stand-alone procedure
for clarity.
_If the AMF has not provided the UE Radio Capability as part of establishment
of UE context in the RAN, the RAN retrieves the UE Radio Capability over the
radio interface and notifies the AMF using the N2 UE Capability Info
Indication message._
Figure 6.6.4.3-1: RAN retrieval of UE Radio Capability (new)
_1\. If the (R)AN has not already received the UE Radio Capabilities from the
AMF for this UE, the (R)AN requests the UE to upload the UE radio capability
information._
_2\. The UE provides the (R)AN with its UE Radio Capabilities sending the RRC
UE Capability Information._
_3\. The (R)AN sends the UE Radio Capability to the AMF. The AMF stores the UE
Radio Capability alongside the UE Capability ID of the UE, for further
provision to the (R)AN as per TS 23.501 [3] clause 5.4.4.1._
#### 6.6.4.4 Local (R)AN Storage of dictionary
This procedure describes how the primary dictionary and updates thereof
recording the associations between UE Capability IDs and UE Radio Capabilities
can be provided by the Core Network to the (R)AN for local storage. This
procedure articulates around the following points:
\- The primary (parent) dictionary is stored in the Core Network (AMF or
dedicated NF)
\- The dictionary is pushed to the RAN by the Core Network when necessary
Editor\'s note: This clause is a placeholder. The procedure if FFS.
### 6.6.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.7 Solution #7: Retrieve UE Radio Capability and store it in AMF per UE
Capability ID
### 6.7.1 Introduction
This solution address Key Issue #2 and Key Issue #3.
NOTE: The details of the NGAP signalling will be specified in coordination
with RAN3.
### 6.7.2 Functional Description
During Registration procedure, the UE includes UE Capability ID in NAS
Registration Request, message as a non-cleartext IE ensuring that the
information is encrypted when transmitted over the radio interface::
\- NG-RAN includes in the NGAP INITIAL UE MESSAGE carrying the NAS
Registration Request, support for UE Capabilities ID handling indicator;
NOTE: Whether support for UE Capability ID handling is indicated at each
Idle/Connected transition or at NG setup procedure will be decided in
coordination with RAN3.
\- at subsequent initial context setup, the AMF includes UE Capability ID and
an indicator whether the associated UE Radio Capabilities are available in the
AMF in the NGAP INITIAL CONTEXT SETUP REQUEST message.
\- If the NG-RAN did not indicate to AMF that it supports UE Capabilities ID
handling and the UE Radio Capabilities associated with the UE Capability ID
received in the NAS Registration Request message are available in the AMF,
then the AMF includes the UE Radio Capabilities in the NGAP INITIAL UE CONTEXT
SETUP REQUEST message.
\- If the NG-RAN indicated to AMF that it supports UE Capabilities ID
handling, then at reception of the NGAP INITIAL CONTEXT SETUP REQUEST message,
NG-RAN verifies if the UE Radio Capabilities indicated by the UE Capability ID
are available in the NG-RAN;
\- If the UE Radio Capabilities indicated by the UE Capability ID are neither
available in the NG-RAN nor in the AMF, NG-RAN retrieves the UE Radio
Capabilities from the UE, stores it in in NG-RAN if supported and stores it in
the AMF;
\- If the UE Radio Capabilities indicated by the UE Capability ID are
indicated as available in the AMF but are not available in the NG-RAN, NG-RAN
retrieves the UE Radio Capabilities from the AMF and stores it in in NG-RAN;
\- When the AMF receives the UE Radio Capability for the UE Capability ID from
the NG-RAN, the AMF stores this info independent of the UE Context, and this
info will be used for later other UEs with the same UE Capability ID.
\- If available, which means that the UE Radio Capability for this UE
Capability ID has been retrieved earlier, then the available info will be used
for this UE. The AMF includes both UE Radio Capability and UE Capability ID to
the NG-RAN in NGAP INITIAL CONTEXT SETUP message when required.
### 6.7.3 Procedures
### 6.7.3.1 Registration
The existing procedure (i.e. clause 4.2.2.2.2) in TS 23.502 [2] is reused, and
only changes to the existing steps are described.
##### **4.2.2.2.2 General Registration** {#general-registration .H6}
Figure 4.2.2.2.2-1: Registration procedure
1\. UE includes UE Capability ID in NAS Registration Request message as a non-
cleartext IE, see TS 33.501 [6]. NG-RAN indicates to AMF whether NG-RAN
supports UE Capability ID handling.
NOTE: If there is no shared security context between the UE and AMF, non-
cleartext IEs of the NAS Registration Request will be provided to the AMF in
NAS Security Mode Complete message in step 9.
### 6.7.3.2 Retrieval of UE Radio Capability
Figure 6.7.3-1: AMF request RAN to retrieve UE Radio Capability
0\. The UE Capability ID is stored in the AMF during Registration.
1\. When there is a need for the AMF to send NGAP INITIAL CONTEXT SETUP
REQUEST e.g. at Service Request, and if the NG-RAN indicated support for UE
Capabilities ID handling in the NG-RAN,, the AMF includes UE Capability ID and
indicates if the UE Radio Capabilities for the UE Capability ID are available
in the AMF.
If NG-RAN did not indicate that it supports UE Capabilities ID handling and
the UE Radio Capabilities are available in the AMF, AMF includes the UE Radio
Capability ID and the UE Radio Capabilities.
1a. NG-RAN responds with NGAP INITIAL CONTEXT SETUP RESPONSE.
2\. If the UE Radio Capabilities are not available in NG-RAN and AMF indicates
UE Radio Capabilities availability, NG-RAN retrieves the UE Radio Capabilities
from the AMF.
3\. If the UE Radio Capabilities are not available in NG-RAN and not available
in AMF,NG-RAN to requests the UE to upload the UE radio capability information
associated with UE Capability ID.
4\. The UE provides the NG-RAN with its UE radio capabilities associated with
the UE Capability ID sending the RRC UE Capability Information.
5\. The NG-RAN sends the UE Radio Capability to the AMF. The AMF stores the UE
Radio Capability associated with the UE Capability ID.
This information will be used for all UEs using the same UE Capability ID.
### 6.7.4 Impacts on existing entities and interfaces
Impacted entities:
UE: Include UE Capability ID in Registration Request message as a non-
cleartext IE;
AMF:
Indicates UE Capability ID and UE Radio Capabilities availability using NGAP
INITIAL CONTEXT SETUP including UE Capability ID but not including UE Radio
Capabilities;
Store UE Radio Capabilities for a UE Capability ID on NF level instead of on
UE Context level, and use this info for all UEs using the same UE Capability
ID;
Includes both UE Radio Capabilities (if available) and UE Capability ID in
NGAP INITIAL CONTEXT SETUP REQUEST REQUEST.
NG-RAN:
Retrieve UE Radio Capabilities and UE Capability ID from the UE.
Upload the UE Radio Capability using NGAP UE Capability Info Indication
message.
Impact on interface:
5GC-NAS
NGAP
RRC
Editor\'s note: Impact on NG-RAN is to be confirmed by RAN group.
### 6.7.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
The solution provides a way to signal the UE Capability ID integrity protected
and encrypted over the air. This will improve security, since unencrypted UE
Capability ID\'s might reveal information that could be used maliciously.
Also, the AMF will be able to receive the UE Capability ID even if the current
gNB does not support FS_RACS. This may save memory in the AMF, and if the UE
moves to a gNB that does support FS_RACS, it will be possible to make full use
of the feature.
Compared to the alternative when the UE Capability ID is signalled with RRC,
the gNB will receive the capabilities with some delay, since the gNB will
receive the UE Capability ID after registration is complete. However, the
capability ID will only have to be received from the UE at initial
registration, so this is not expected to have any practical impact.
## 6.8 Solution #8: Solution for identifying UE radio capabilities using PLMN-
specific UE Capability ID
### 6.8.1 Introduction
Editor\'s note: This clause lists the key issue(s) addressed by this solution.
The following requirements apply to this solution:
1\. It shall be possible to optionally identify the UE capabilities with a
manufacturer assigned identifier (as in solution #1 of the present document)
2\. If manufacturer assigned identifier is not used, a PLMN specific one can
be used by serving AMF
3\. It shall be possible for the network or the device to change the UE
Capability ID associated with a device, e.g., due to a SW upgrade enabling new
capabilities on the device side or for remapping or OAM procedures in the
network side.
UE Capability ID format is split in two name/number-spaces:
\- Globally assigned by UE manufacturer as in solution #1 - Operator specific
- this could be preconfigured by operators as part of device certification, or
assigned by the operator the first time any UE reports these capabilities on
the network
Additionally, the UE Capability ID may be permanent or semi-statically
associated with a device. Since a device may have certain features upgraded,
e.g., due to a new SW release, a more flexible approach would be to allow the
capability-profile-ID to be semi-statically defined and not associated with a
permanent device ID such as IMEI.
### 6.8.2 Functional Description
Editor\'s note: This clause outlines solution principles and documents any
assumptions made.
UE radio capabilities are identified by a newly defined UE Capability ID. The
format of UE Capability ID is split in
1\. A manufacturer specific (as in sol.1 of TR 23.743) UE Capability ID(s) can
be optionally configured in the UE e,g. upon manufacturing.
2\. If UE is configured with Manufacturer specific UE Capability ID, UE
reports that at initial Registration in a PLMN based on capabilities it wants
to use.
3\. Serving PLMN AMF:
i. if it has access to mapping of Manufacturer specific UE Capability ID to
radio capabilities can provide stored radio capabilities to RAN.
ii. if it does NOT have access to mapping of Manufacturer specific UE
Capability ID or does not want to use it can query the UEs radio capabilities
and then provide an PLMN specific UE Capability ID for future indications e.g.
using UE Configuration Update as defined in Figure 6.5.3-3.
4\. If UE is configured with PLMN-specific UE Capability ID it provides the
PLMN specific one on this PLMN only.
5\. Else if UE is not configured with any UE Capability ID, query capabilities
and then provide a PLMN specific UE Capability ID for future indications.
If memory for storing UE radio capabilities is a concern, it is up to AMF
implementation to provide the same PLMN specific UE Capability ID to multiple
different UEs with the same radio capabilities e.g. same model/manufacturer.
NOTE: How long the same PLMN-specific UE Capability ID can be kept in the UE
and AMF depends on local operator policy.
### 6.8.3 Procedures
Editor\'s note: This clause describes high-level procedures and information
flows for the solution.
None.
NOTE: How to handle PLMN specific UE Capability ID in case there is no PLMN-
wide support of certain UE radio capabilities and RAN filtering is applied
will be resolved in key issues 2 and 3.
### 6.8.4 Impacts on existing entities and interfaces
Editor\'s note: This clause describes impacts to existing entities and
interfaces.
UE, NG-RAN, and CN (if radio capabilities are stored there) will have to
manage UE radio capabilities using UE Capability ID.
### 6.8.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
This solution builds on top of solution 1 and allows UE Capability ID to be
assigned by (serving) PLMN if Manufacturer UE Capability ID is not used.
## 6.9 Solution #9: UE Capability ID with delta set of UE Radio Capabilities
### 6.9.1 Introduction
This solution addresses Key Issue #1 \"How are the UE Radio Capabilities
identified?\" using a combination of a UE Capability ID (manufacturer
specific, standardized or PLMN specific) and of an optional explicit delta set
of UE Radio Capabilities to represent a full usable set of UE Radio
Capabilities.
The use of a delta set of UE Radio Capabilities enables:
\- _Simplifying_ the definition and management of UE Capability IDs and their
dictionary to focus on \"basic\" sets of UE Radio Capabilities.
_\- Differentiating_ between UE vendors supporting the same UE Capability
ID(s)
A delta set of UE Radio Capabilities allows, together with a UE Capability ID,
indicating a full usable set of UE Radio Capabilities that cannot otherwise be
represented by this UE Capability ID alone. A corollary is that a delta set of
UE Radio Capabilities can then be exploited to avoid explicitly sending a full
usable set of UE Radio Capabilities when a UE Capability ID is available in
the UE but that is not able to represent this set.
NOTE: This may be the case e.g. when the UE holds a PLMN-assigned UE
Capability ID1 but wishes to use a different set of radio capabilities for
which it has no assigned UE Capability ID2 - in this case the UE only needs to
signal UE Capability ID1 with a delta set in order to signal the capabilities
it wishes to use as opposed to signalling the full set of capabilities.
Editor\'s note: The feasibility to define a delta set of UE Radio Capabilities
is under study in RAN2.
### 6.9.2 Functional Description
The functional characteristics of this solution are the following:
\- A UE Capability ID uniquely identifies a set of UE Radio Capabilities.
\- This UE Capability ID together with optionally a delta set of UE Radio
Capabilities identify the usable set of UE Radio Capabilities of a UE.
\- At any point in time the UE uses at most a single UE Capability ID and
optionally a delta set of UE Radio Capabilities
NOTE 1: The usable set of UE Radio Capabilities may not necessarily be the
full set of UE Radio Capabilities the UE features. The UE may hold one or more
UE Capability IDs and corresponding optional one or more complementary sets of
UE Radio Capabilities, among which it can choose a suitable combination that
it wishes to use as applicable.
NOTE 2: The delta set of UE Radio Capabilities is never identified by a UE
Capability ID.
### 6.9.3 Procedures
Impact to procedures for using a delta set of UE Radio Capabilities together
with a UE Capability ID are documented in clause 6.6.3 - where a UE Capability
ID is signalled, a delta set of UE Radio Capabilities can be signalled as an
option.
### 6.9.4 Impacts on existing entities and interfaces
Impact to existing entities and interfaces are documented in clause 6.6.4
### 6.9.5 Evaluation
From a signalling standpoint:
\- The use of a UE Capability ID with a delta set of UE Radio Capabilities is
more efficient than the use of a full explicit set of UE Radio Capabilities
\- The use of a UE Capability ID alone is more signalling efficient than that
of a UE Capability ID with a delta set of UE Radio Capabilities
A UE may have one or more UE Capability IDs available, but none able to
represent the full set of UE Radio Capabilities it wishes to use at a given
time. In this case, a delta set can be used together with this a UE Capability
ID in order to avoid signalling this full set explicitly.
The use of a delta set of capabilities allows to use the benefits of the UE
Capability ID to limit the signalling load, whenever a UE Capability ID is
available in the UE (that is known to the network) regardless whether this UE
Capability ID corresponds exactly to the set of radio capabilities the UE
wants to use.
Delta signalling requires associated complexity to signal both the UE
Capability ID and the delta set, store them in the UE context and combine the
delta set and the UE Capability ID\'s set into a complete set.
When delta signalling is used with a manufacturer allocated UE Capability ID,
the delta signalling will be applied as long as the UE uses radio capabilities
not exactly corresponding to an available UE Capability ID. This will result
in less signalling load compared to providing radio capabilities without a UE
Capability ID. It requires the associated complexity and processing to use the
delta set. A delta set is never used if a UE Capability ID exists that
corresponds exactly to the UE radio capabilities the UE intends to use.
NOTE: Whether support for delta signalling in combination with manufacturer
assigned UE Capability ID is needed is not concluded
When delta signalling is used with a PLMN allocated UE Capability ID, the
delta signalling will be applied to update the network with the radio
capabilities not exactly corresponding to the available UE Capability ID until
a new UE Capability ID is assigned to the UE. This will result in less
signalling load compared to providing radio capabilities without a UE
Capability ID. It requires the associated complexity and processing to use the
delta set. A delta set is never used if a UE Capability ID exists that
corresponds exactly to the UE radio capabilities the UE intends to use.
Not using a delta set systematically imposes to fall back to explicitly
signalling the set of UE Radio Capabilities the UE wants to use whenever no UE
Capability ID is available that corresponds exactly to this set of
capabilities.
## 6.10 Solution #10: Solution based on network-controlled capabilities
sending and UE Capability ID allocation
### 6.10.1 Introduction
This solution assumes that the network controls what UE Radio Capabilities the
UE sends. The network may also allocate UE Capability IDs, i.e. a shorthand
representation of the UE radio capabilities for the indication of UE radio
capabilities. The system entities (including UE) are mutually aware of the
ability of their peers to support the RACS feature and can fall back to Re1-15
operation if a peer is not supporting the feature. The main principles of the
solution are:
1) Network controlled sending of UE radio capabilities (so UEs would provide
the capabilities the network requests based on operator specific policy). To
do so the network indicates to the UE a UE Radio Capability Form (URCF) the UE
stores. The URCF is valid PLMN-wide and is PLMN-specific unless different
PLMNs agree on using same URCF.
2) The UE would respond to the UE capability Enquiry from RAN including a URCF
based on what the network requests
3) The network allocates UE Capability ID for the UE Radio Capabilities
indicated by a UE.
4) The allocation of UE Capability IDs is optional if the network does not
foresee that the capabilities indication from the UE would exceed a certain
number of Octets the PLMN is comfortable to handle without UE Capability IDs.
5) The solution proposal also proposes how to distribute URCF and UE
Capability IDs system-wide and detect support of the feature in UE and network
elements.
The solution, like all others where sending of radio capabilities from UE is
expected at some point, may require segmentation of UE radio capabilities over
the Radio interface, if the URCF may result in a UE radio capability
indication exceeding the PDCP maximum payload size. This is in scope of RAN
WGs to assess.
### 6.10.2 Functional Description
The Network provides the UE with information on which UE Radio Capabilities
the network is interested the UE to indicate support of by means of a UE Radio
Capabilities Form (URCF). This is an evolution of the filtering mechanisms
defined already in RAN TSs which need to be discussed together with RAN WGs.
Editor\'s note: It is to be discussed with RAN WGs whether a single URCF and
matching UE Capability ID per UE is used in a signalling transaction or
multiple can be used at the same time (e,g, if the overall capabilities
filtering is based on RAT etc. and multiple RAT capabilities are sent in one
transaction, then multiple URCFs and related Capability Id may be needed).
The URCF for a UE is valid PLMN-wide and is operator defined based on own
criteria. The advantage vs. a local validity at a RAN node is that there is in
principle no need to indicate the UE radio capabilities more than once in a
PLMN, and this helps with mobility vs. a solution where URCF had a local
validity.
A URCF that indicates the UE to provide all its radio capabilities can also be
defined, if this is the operator policy, i.e. a URCF encoding may also be
defined by 3GPP to ask the UE to provide all its capabilities, if so desired.
This is particularly handy e.g. for UEs that are supposed to support few
capabilities (e.g. a simple IoT device), or if an operator prefers to pull all
the UE capabilities rather than a specific subset it is interested in.
A UE may store the URCF for a PLMN for future use.
Different URCF types may be defined in a PLMN. The PLMN Operator decides which
URCF to provide to a UE based on its own criteria.
The URCF is signalled alongside a version number and type of the URCF. The
radio capabilities the UE sends report also the version of URCF and its type
if it has received one from the PLMN, i.e. the UE provides, the capabilities
to the network based on the received URCF (if the network provides one), or
using the traditional way to signal the capabilities (if the network does not
provide a URCF).
It shall be possible for a network which uses the URCF to create UE Capability
IDs of UE radio capabilities by UEs, so the UE and the network nodes can use
this instead of sending the UE capabilities info based on URCF all the time.
The UE Capability IDs are centrally managed by a URCF Management function
(UMF). The UE Capability IDs can then be used to indicate, alongside the URCF
version number and type, the UE radio capabilities in a very succinct way.
Note that multiple UE Capability IDs can he used by a single UE for same URCF
depending on various settings it may operate with, which may cause a different
indication of UE radio capabilities to the network. If a UE has no UE
Capability ID in a certain setting/configuration, it sends the capabilities
based on URCF and it may receive a UE Capability ID from the PLMN.
A UE stores the latest URCF and related UE Capability IDs for the H-PLMN. It
may also store the URCF and related UE Capability IDs for other PLMNs it
visits. The UE Capability ID can be used among network nodes to exchange the
UE radio capabilities values as part of the UE context, if the peer is known
to support the feature. If a peer does not support the feature, the UE radio
capability info for the UE is provided using to the peer by using the Rel-15
encoding. In a network where not every node supports the URCF and UE
Capability IDs, the AMF an NG-RAN shall be ready to receive the capabilities
using the rel-15 method for the UE.
When the URCF changes for a PLMN, the UE and network nodes erase the old URCF-
related UE Capability IDs.
### 6.10.3 Procedures
1) When the interfaces between NG-RAN nodes (see figure 6.10.3-2) and between
NG- RAN and the AMF (see figure 6.10.3-1) are established, the current URCF
types and their version is exchanged, if the nodes have one. The URCFs with
the higher version number prevails if peers exchange the same URCF type with
different version number over Xn. If no URCF is available, a node that
supports the feature indicates its support, e.g. by an empty URCF with version
zero (this is a stage three decision). If a peer node is detected to not
support the feature, then the Rel-15 UE Radio capability information exchange
is used with the peer function/entity (i.e. UE radio capabilities for a UE are
exchanged between network entities based on the Rel-15 specifications).
Figure 6.10.3-1: N2 setup includes the AMF providing the RAN with URCF
information
Figure 6.10.3-2: Xn setup includes URCF handshaking
2) A URCF may be updated by the CN towards the RAN nodes (see figure 6.10.3-3)
at any time with an indication of when this is going to be a valid URCF (so
there is an absolute time when the change happens network-wide).
Figure 6.10.3-3: The AMF provides new URCF to the RAN, when one becomes
available
Neighbouring RAN nodes may also handshake on a common understanding of the
URCF (see figure 6.10.3-4).
Figure 6.10.3-4: When a RAN node receives a new URCF, it may provide it to the
Xn peers to handshake
3) When a new URCF is introduced in the PLMN, all CN nodes invalidate the
locally stored information for the UEs that use these, so this causes the UE
to provide a new UE RAN capability the next time they transition to connected
mode. A UE in connected mode continues to be handled with the current UE Radio
capabilities until it receives a UE configuration update message or a
Registration Accept informing a new URCF has been introduced. If so, the UE
obtains a URCF by entering idle mode, registering including a \"UE Radio
Capability Update\" indication, and the network will provide it with the new
URCF upon triggering the UE Capabilities Enquiry. Network nodes should be able
to handle UEs that remain in connected mode and so understand recent URCF
types and versions. If a UE is RRC inactive, a change of URCF causes release
of the UE with indication that URCF has changed, unless the UE is known to not
support RACS.
4) When the UE registers, it declares the version and type of the URCF it
knows for the PLMN or its support of the feature if it has no URCF yet. If the
UE knew already a UE Capability ID of its current Radio capabilities, it
provides it also. If the UE does not support the feature then Rel-15 Operation
is used with the UE. If a new URCF version is available for the UE, the
network provides an indication to the UE a new URCF is available in the
registration accept, so that the UE stops using the current URCF and related
UE Capability IDs.
5) UE support of the RACS feature is indicated towards the RAN by the AMF by
inclusion of the URCF type used for the UE, when the AMF sends an Initial
Context Setup Request message to establish the context in the RAN without the
UE Radio capabilities, so the RAN knows whether to use the URCF feature in the
UE capability enquiry or not. The AMF also signals whether the UE has no
(current version of) URCF yet. See figure 6.10.3-5.
Figure 6.10.3-5: AMF indicates the RAN the UE supports URCF handling and
whether it has no current URCF
6) If the UE supports the feature, but does not have a (current) URCF, the UE
is provided with one in the RRC UE Capability Enquiry by the NG-RAN.
7) If the UE supports the feature and the current URCF is provided or is
already stored in the UE when it receives the RRC UE Capabilities Enquiry, the
UE shall report its capabilities based on the URCF in the RRC UE Capabilities
Information, or possibly with a UE Radio capability UE Capability ID if the
network already provided one for the currently active UE Radio Capabilities.
8) When the UE supporting the feature responds with a UE Capabilities
Information based on URCF, the NG-RAN provides this to the CN using a N2 UE
Capability Info Indication. See figure 6.10.3-6. The UE Capability Enquiry
includes a URCF if the RAN is informed that the UE has no current URCF.
Figure 6.10.3-6: UE Capability enquiry including passing URCF to the UE
9) If the AMF, if it receives no UE Capability ID in the UE Capabilities Info
Indication from the NG-RAN, it queries the UMF to obtain a UE Capability ID.
The UMF provides the UE Capability ID (either new or existing one, depending
on whether a match with existing UE Capability ID and related capabilities was
detected by UMF). The NG-RAN shall be provided with the UE Capability ID via a
UE context modification request (see figure 6.10.3-7).
Figure 6.10.3-7: the AMF provides a UE Capability ID for a UE context
The AMF is always assisted by an external centralised entity in the PLMN for
the task of allocating and managing and allocation UE Capability IDs and
managing the URCFs (the URCF Management Function, UMF).
10) When the NG RAN node obtains a UE Capability ID, it provides it to the UE,
and locally stores only the UE Capability ID as a reference to the UE
capabilities, and the mapping to its meaning is retained so other UE contexts
for other UEs can refer to it. See figure 6.10.3-8 where the RAN can proceed
to update UEs with UE Capability ID when their capabilities for the URCF they
use matches the UE Capability ID definition. This step may be initiated
locally by the RAN when it has a UE Capability ID, for all applicable UEs.
Figure 6.10.3-8: The RAN provides the UE Capability ID of its Capabilities for
the current URCF
11) The UE Radio capability info UE Capability ID, if already known in the
RAN, is immediately configured in the UE and sent to the AMF even if the UE
provided capabilities without using a UE Capability ID yet. See figure
6.10.3-9 which summarises both the case where the UE already knows a UE
Capability ID, and the case where the UE does not yet know it, but the RAN has
a UE Capability ID matching the UE capabilities.
Figure 6.10.3-9: The RAN immediately provides the UE with a UE Capability ID
it is aware of, and needs only to pass the UE Capability ID to the CN
12) If a UE Radio Capabilities Info UE Capability ID is not understood by an
AMF, it can be resolved from the UMF which stores the URCF(s) and the related
UE Capability IDs. See figure 6.10.3-10.
Figure 6.10.3-10: resolution of an unknow UE radio Capabilities UE Capability
ID
13) If an AMF receives no UE Capability ID from the UE that is RACS capable
and used the URCF to send the UE RAN capabilities in the UE radio Capability
Info, it may request the UMF to allocate a UE Capability ID (see figure
6.10.3-11). When a UE Capability ID is allocated the point 9 procedure is then
followed.
Figure 6.10.3-11: Allocation of a UE Capability ID
14) AMFs may subscribe to UE Capability ID Allocation information. This may be
useful when a new UE Capability ID is created so resolution step is avoided.
The UE Capability ID includes the URCF type and version it relates to.
Figure 6.10.3-12: subscribe/notify service allowing an AMF to receive UE
Capability IDs
15) The AMF may update all its attached RAN nodes with the UE Capability ID\'s
information it receives from the UMF via an AMF Configuration Update message.
Figure 6.10.3-13: AMF provides new UE Capability ID to a RAN node
16) NG-RAN nodes may handshake on the support of new UE Capability IDs
received from the AMF or peer NG-RAN nodes.
Figure 6.10.3-14: a NG-RAN node may update its neighbouring NG-RAN nodes on a
new UE Capability ID
17) If a NG-RAN node receives an unknown UE Capability ID from the UE in a RRC
UE Capability Information message, then the NG-RAN node can request the
mapping to related radio capabilities from AMF as shown in figure 6.10.3.15.
The AMF, if it does not know the mapping, it gets it from the UMF.
Figure 6.10.3-15: A NG-RAN node provides a capabilities UE Capability ID to
the AMF and requests resolution to the related UE radio capabilities
### 6.10.4 Impacts on existing entities and interfaces
AMF: Support of URCF and UE Capability ID handling.
NG-RAN: Support of handling of URCF and UE Capability IDs.
UE: Support of handling of URCF and UE Capability IDs.
### 6.10.5 Evaluation
Benefits:
\- The solution is designed to handle fully backward compatibility between RAN
and CN, between RAN nodes, between RAN and UE, between CN and UE.
\- It offers the UE Capability ID mechanism as a way to optimise the transport
of the UE Radio capabilities information in UE contexts quite significantly in
both the CN and the RAN, it offers a succinct way for UEs to provide the UE
Radio Capability Info over the Radio Interface.
\- It is fully open and not UE vendor dependent, it is fully network
controlled and there is no need to provision a database with UE vendor
specific information or maintaining it explicitly with the encoding of UE
Capability IDs, as the UE Capability IDs can be automatically created and
managed by UMF.
\- The URCF setting policy can be defined by the operator. An operator may
tune at will what it is according to its criteria.
\- A PLMN-wide self-configuration of URCF in network nodes and UE Capability
IDs is defined to avoid OAM based provisioning.
Requirement:
\- A new function needs to be introduced in the network to coordinate the
allocation of UE Capability IDs and provide resolution/distribution of
unknown/new UE Capability IDs and or URCFs.
## 6.11.1 Solution #11: Standardized UE Capability ID
### 6.11.1 Introduction
This solution addresses Key Issue #1 \"How are the UE Radio Capabilities
identified?\" using a standardized UE Capability ID. It is related to Solution
#6.
### 6.11.2 Functional Description
The functional characteristics of this solution are the following:
\- The UE Capability ID uniquely identifies (i.e. points to) a set of UE Radio
Capabilities.
NOTE 1: The size of the UE Capability ID should be determined by RAN2 as a
function of the number of anticipated _realistic_ combination of Radio
Capabilities - a handful of octets are deemed sufficient
\- The UE Capability ID is standardized.
NOTE 2: GSMA/3GPP are considered viable candidates for such effort
\- The UE Capability ID and optionally a complementary set of UE Radio
Capabilities identify the usable set of UE Radio Capabilities of a UE.
NOTE 3: The usable set of UE Radio Capabilities may not necessarily be the
full set of UE Radio Capabilities the UE features. The UE may hold one or more
UE Capability IDs and corresponding optional one or more complementary sets of
UE Radio Capabilities, among which it can choose a suitable combination that
it wishes to use as applicable.
### 6.11.3 Procedures
To be addressed under Key Issue #3.
### 6.11.4 Impacts on existing interfaces and entities
To be addressed under Key Issues #2 and #3.
## 6.12 Solution #12: Bulk Provisioning of UE Radio Capability from AF
### 6.12.1 Introduction
The solution addresses key issue #2. It proposes that the AF provisions to the
AMF via NEF the representation of UE radio capability (e.g., UE Radio
Capability ID) and corresponding UE radio capabilities. In this solution, UE
Radio Capability Information is composed of the UE Radio Capability and
corresponding UE Radio Capability ID. The NEF provisions the UE Radio
Capability Information to the AMFs in the PLMN by using bulk provisioning
method. The AMF can retrieve the UE Radio Capability information from AF via
NEF if AMF has no UE Radio Capability Information stored.
### 6.12.2 Functional Description
This solution has the following characteristics:
\- The AF is integrated with the data base for UE Radio Capability
Information, in which the information can be provided by UE manufacture or
operator. The AF is able to provision UE Radio Capability Information (UE
Radio Capability ID and corresponding UE Radio Capabilities) to the AMF(s).
The AMF can trigger the API for UE Radio Capability provisioning if the UE
Radio Capability information is updated.
\- The NEF exposes API for UE Radio Capability provisioning to the AF. The NEF
authorizes that the AF provisions the UE Radio Capability Information.
\- The NEF retrieves AMF address from the NRF.
\- The NEF performs bulk provisioning to all AMFs in the PLMN.
\- The AMF exhibits service operation for UE Radio Capability Provisioning.
Consumer of this service operation is NEF.
\- The AMF can retrieve the UE Radio Capability information from AF via NEF if
AMF has no UE Radio Capability Information stored.
### 6.12.3 Procedures
#### 6.12.3.1 Bulk provisioning of UE Radio Capability
In this clause, the procedure for bulk provisioning of UE Radio Capability is
described.
Figure 6.12.3-1: Bulk Provisioning of UE Radio Capability information to AMFs
1\. The AF triggers Nnef_RadioCapability_Provisioning Request service
operation to the NEF. The AF includes UE Radio Capability Information in this
message. The UE Radio Capability information is composed of UE Radio
Capabilities and the corresponding identifier (e.g., UE Radio Capability ID).
The AF can include multiple sets of UE Radio Capability Information.
If CAPIF is not supported, the AF is locally configured with the API
termination points for this service operation. If CAPIF is supported, the AF
obtains the service API information from the CAPIF core function as specified
in TS 23.222 [4].
2\. The NEF authorized the AF request based on the operator policy.
3\. The NEF acknowledges the execution of
Nnef_RadioCapability_Provisioning_request. The NEF stores the received UE
Radio Capability Information in order to provision to AMFs in the PLMN after
invoking NF discovery service operation. The NEF may cache the UE Radio
Capability Information provisioned by the AF.
4\. The NEF invokes Nnrf_NFDiscovery_Request to the NRF. In this message, the
NEF indicates NF Type as AMF. The NEF includes the expected NF service name
for the provisioning request (i.e., Namf_Provisioning service operation).
5\. The NRF authorizes the Nnrf_NFDiscovery_Request. If allowed, the NRF
provides the set of address of discovered AMFs to the NEF via
Nnrf_NFDiscovery_Request Response message. The NEF stores the set of address
of AMFs.
The NEF can register with the NRF for any newly registered AMF by invoking
Nnrf_NFStatus_Subscribe. If NEF gets notified from the NRF for the newly
registered AMF in the PLMN, the NEF can trigger Namf_Provisioning_Request
service operation in order to provide the cached UE Radio Capability
Information to the AMF.
6\. Based on the information of the discovered AMFs in the PLMN from step 5,
the NEF invokes bulk Namf_Provisioning_Request to discovered AMFs in order to
provision UE Radio Capability Information. In this message, one or set of UE
Radio Capability Information received from the step 3 are included.
NOTE: Namf_Provisioning service operation is not per UE operation.
7\. The AMF stores the received UE Radio Capability Information. The AMF
acknowledges to the NEF by sending Namf_Provisioning_Response. The AMF uses
the UE Radio Capability Information to identify UE Radio Capability when UE
requests registration with UE Radio Capability ID.
8\. The NEF may notify to the AF that the UE Radio Capability Information is
successfully provisioned to the all AMF in the PLMN, based on the local
policy.
If the AF is trusted in the PLMN and allowed to invoke Namf_Provisioning
service operation, the AF can directly use Nnrf service operation to discover
AMFs and can directly use Namf service operation to provision the UE Radio
Capability Information.
#### 6.12.3.2 On-demand UE Radio Capability Information Retrieval from AF
This section applies in the case that the AMF has no UE Radio Capability
Information or cannot derive UE capabilities according to the capability ID
received from the UE (e.g. the database is not up to date). The AMF acquires
UE Radio Capability Information from the AF via NEF. This procedure ensures
the AMF always has up to date UE Radio Capability information.
Figure 6.12.3-2: On-demand UE Radio Capability from AF
1\. UE provides UE capability ID and AF information e.g. manufacture
information or PLMN information to the AMF.
2\. AMF receives the UE capability ID and the AF information, e.g. manufacture
information, and obtains UE capabilities according to the stored UE Radio
Capability Information for the received UE Capability ID for this AF.
3\. If AMF has no UE Radio Capability Information for the AF information or
cannot derive UE capabilities according to the capability ID received from the
UE, the AMF acquires UE Radio Capability information from the AF via NEF. The
AMF requests from the NEF UE Radio Capability Information, and if the NEF has
the UE Radio Capability Information, then NEF responds to the AMF.
Regardless of step 1 and step 2, if AMF determines that the stored UE Radio
Capability Information is not up to date then based on local configuration,
the AMF can trigger step 3 to retrieve the up to date UE Radio Capability
Information from the AF.
4-5. If the NEF does not have the UE Radio Capability Information, the NEF
requests the AF to provide the UE Radio Capability Information, and the AF
provides the UE Radio Capability Information based on the request.
NOTE: The NEF is expected to support CAPIF functions for external exposure if
the AF is the third party.
6\. The NEF stores the newly provisioned UE Radio Capability Information and
responses to the AMF.
7\. AMF based on the newly provisioned UE Radio Capability Information,
derives UE Radio Capability and transfers to the RAN if applicable.
### 6.12.4 Impacts on existing entities and interfaces
NEF: new API exposure for UE Radio Capability Information provisioning. The
NEF can cache the UE Radio Capability Information received by the AF to
provision to the AMF. The NEF can store the address of AMFs in the PLMN after
querying to the NRF.
AMF: new Namf service to allow for requesting and provisioning of UE Radio
Capability Information. AMF can trigger service operation to retrieve UE Radio
Capability Information from the AF.
### 6.12.5 Evaluation
The AF provides the UE Radio Capability Information to the related AMFs via
bulk provisioning method when the AF generates or updates the UE Radio
Capability Information. This method decreases the O&M configuration cost for
the operator. And on-demand retrieval from AF can provide the AMF up to date
UE Radio Capability Information if the AMF has no such information. Otherwise,
the AMF will retrieve UE explicit radio capabilities form the UE, which will
cost extra Uu and N2 interface signalling.
Step 4/5 of the procedure described in 6.12.3.2 that, the AF (if owned by the
operator) could allocate a PLMN-specific UE capability ID if the ID provided
by the UE is not known, or if no UE capability ID is provided by the UE. This
provides a centralised way for the operator to allocate PLMN-specific IE
capability IDs that are unique.
The database of UE Radio Capability Information is part of the AF in this
solution, Use of the AF for this could reduce the amount of signalling in the
network as it enables to provision the information to all AMFs proactively.
## 6.13.1 Solution #13: \"Self-learning\" logic for progressive building of a
dictionary
### 6.13.1 Introduction
This solution is an add-on solution that can be combined with other solutions
in this TR. It proposes a logic for progressive building of a dictionary (UE
capability ID \ radio capability) in the network and is particularly
targeting the manufacturer-based UE capability ID, as defined in Solution #1.
### 6.13.2 Functional Description
When manufacturer-based UE capability ID is used (as proposed in Solution #1),
the network can progressively build the dictionary in a \"self-learning\"
process, as described below:
\- Upon connection to the network the UE indicates the manufacturer-based UE
capability ID and the network queries a DataBase (DB).
\- If the DB does not recognize the UE capability ID, the network requests the
UE to explicitly signal the radio capability. The network forwards the
explicitly signalled capability to the DB, which stores it and tags the
corresponding UE capability ID as being \"under validation\". The validation
process is needed in order to prevent fraudulent or misbehaving UEs from
poisoning the dictionary DB.
\- When subsequently another UE indicates the same manufacturer-based UE
capability ID, the network proceeds in the same way. If the explicitly
signalled radio capability matches the one that was previously reported to the
DB by other UE(s), the DB increases a counter. This step is repeated until an
operator-defined threshold is reached for the counter.
\- When the operator-defined threshold is reached, the UE capability ID is
tagged in the DB as \"validated\".
\- For UEs that subsequently indicate the same UE capability ID, the network
queries the DB, but does not request the UE to explicitly signal its
capabilities because the UE capability ID is tagged as \"validated\".
The logic and the counter described above are collocated with the dictionary
DataBase (DB). The DB location will be determined as part of other solutions
(e.g. could be a new NF in the Core Network).
In some cases the network may apply region-specific filters in RAN leading the
UE to report only a subset of its capabilities. In such cases the UE can still
indicate the manufacturer-based UE capability, and in addition:
\- When the network queries the DB with the UE capability ID, it also
indicates the UE location.
\- When the network requests the UE to explicitly signal the radio capability,
the network forwards the explicitly signalled capability to the DB with an
indication that this is a \"partial\" capability.
\- The validation logic in the DB is similar to the one described earlier,
except that it is performed on regional basis (e.g. the validation counters
are specific to a region).
### 6.13.3 Procedures
To be addressed as part of other solutions.
### 6.13.4 Impacts on existing interfaces and entities
To be addressed as part of other solutions.
The specification impact of this solution is limited to tagging of a UE
capability ID as \"validated\" on the interface with the DB (in replies from
the DB). For instance, if the DB is a standalone NF in the 5GC network, the
\"validated\" tagging applies to the UE capability ID parameter signalled on
the AMF-DB interface in the DB=>AMF direction.
To support RAN caching, the \"validated\" tag needs to be supported on N2 in
the AMF=>RAN direction.
To support region-specific filters in RAN, a \"partial\" tag needs to be
applied to the explicitly signalled capability at least on the interface
between AMF and DB in the AMF=>DB direction.
### 6.13.5 Evaluation
This is an add-on solution that can be combined with other solutions.
The self-learning logic can be applied regardless whether the master
dictionary is in the CN or in the OAM plane.
The self-learning logic can be applied in centralized manner (one master
dictionary per PLMN) or distributed manner (one master dictionary per region
or per node). The centralized manner obviously provides overall savings in
terms of signalling volume on the radio, however, it may require
standardization of backend interfaces for dissemination of information that is
used for validation purposes.
NOTE: The self-learning principles of this solution require SA WG3 clearance
before the normative aspects of this solution described in clause 6.13.4 can
be progressed.
## 6.14 Solution #14: RAN mapping of \'Capability Pointer\' to Full UE
capability with Backward Compatibility
### 6.14.1 Introduction
This is a Release 16 study. Hence the interaction with Rel-15 NG-RAN/AMF and
pre-Rel-16 E-UTRAN/MME needs to be considered.
In this proposal, backward compatibility solutions are based on mechanisms
developed as part of the rSRVCC from GERAN to E-UTRAN work, and the Rel-15 CR
that allows the MME to assist with handover from UTRAN to E-UTRAN (CR 3423r5
to TS 23.401 [7]).
In this solution, the UE supplies the network with a \"fallback UE radio
capability\" IE as well as a \"Capability Pointer\". The \"fallback UE radio
capability\" can be used by Rel-16 CN nodes when communicating with pre-Rel-16
RAN nodes. The use of a \"fallback UE radio capability\" avoids pre-Rel-16 RAN
nodes needing to retrieve a \"full\" UE Radio Access Capability over the radio
interface.
The UE ensures that the \"fallback UE radio capability\" is sufficiently small
to be carried by the legacy interfaces (e.g. is less than 2500 bytes). The
mechanism by which the UE selects which capabilities to include in the
\"fallback UE radio capability\" is left to the UE implementation.
This solution uses a RAN cache to map between the \"Capability Pointer\"
(which could be e.g. the \"TAC+config-ID\") and the Full UE Radio Access
Capability.
The UE is pre-configured (or Over The Air updated) with one, or more likely, a
set of \"Capability Pointers\". The different \"Capability Pointers\" could be
used to correspond to when e.g. 2G or 3G or MBMS is enabled/disabled.
### 6.14.2 Functional Description
1) At N2 and S1 (interface) Setup, the RAN and MME/AMF exchange information on
whether they support the \"new Rel-16 mechanism\".
NOTE 1: Knowledge of the MME/AMF support level is useful in the RAN node when
the RAN node is connected to a mix of supporting and non-supporting MMEs or
AMFs.
2) Using the existing Release 8 EPS/Release 15 5GC Attach/Registration
procedures, the Updated UE provides the Updated MME/AMF with the \"Capability
Pointer\" and a \"fall back\" UE Radio Access capability (rather than the Full
UE Radio Access Capability).
NOTE 2: If the UE is in very poor coverage at Attach time, a \"reduced size\"
fall back capability could be provided, and the UE waits until it moves into
normal coverage to provide the regular \"fall back capability\".
3) The Updated RAN performs the mapping between \"Capability Pointer\" and the
Full UE Radio Access Capability.
How the Updated RAN node gets the information to do this mapping is
independent of this proposal (e.g. via RAN O&M the UE; new N2/S1 UE-non-
associated procedure; enquiry to EIR; etc.), although if it is obtained from
the UE, some extra signalling will be used to differentiate the Full
Capability from the Fallback Capability).
4) In the Service Request (and other UE-specific N2/S1 connection
establishment) procedures, the Updated MME/AMF provides an Updated RAN node
with only the e.g. \"Capability Pointer\" and NOT the Full (or \"fall back\")
UE Radio Access Capability.
5) In the S1/N2 handover procedures, Updated RAN nodes only send the e.g.
\"Capability Pointer\".
\- If the Updated target MME/AMF knows (from step 2) that the target RAN node
is not updated, then the MME/AMF adds the \"fall back\" UE Radio Access
capability.
\- if the target MME/AMF and target RAN node are both not updated (and the MME
does not support Rel-15 CR 3423r5 to TS 23.401 [7]), then the target RAN node
can obtain the UE Radio Access Capability from the UE (as in the case of
rSRVCC from GERAN to E-UTRAN).
6) At X2/Xn (interface) Setup, the RAN nodes exchange information as to
whether they support the \"new Rel-16 mechanism\".
At X2/Xn handover; secondary node addition for dual connectivity; and RRC
Resume the \'source\' RAN node uses this \'support\' information to determine
whether to only send the \"Capability Pointer\", or, to send the Full UE Radio
Access Capability.
NOTE 3: The exact details of X2/Xn handover and secondary node addition are
for RAN WGs.
7) Path Switch signalling with the MME/AMF following X2/Xn handover from a
legacy RAN node to an Updated RAN node allows the MME/AMF to send the
\"Capability Pointer\" to the Updated RAN node for use in its subsequent
procedures.
### 6.14.3 Procedures
These can be readily derived from the previous clause.
### 6.14.4 Impacts on existing entities and interfaces
MME, AMF, eNB, NG-RAN are impacted.
UE is impacted in sending the \"fallback UE radio capability\", as well as the
\"capability pointer\".
### 6.14.5 Evaluation
The use of a \"fallback UE radio capability\" of relatively modest size (e.g.
\ 65 536 bytes
(i.e. > 524 288 bits), and, the need to support fast, reliable, low processing
complexity mechanisms for frequently used procedures (at least Service
Request, RRC Connection Resume, X2&Xn handover, secondary gNB addition), the
full UE Radio Access Capabilities shall not normally be transferred as part of
those procedures. This requires that the serving and target RAN stores a local
copy of the mapping between the UE Capability IDs and the full UE Radio Access
Capabilities for the UEs that frequently use that RAN node. In addition, the
(TS 23.501 [3] clause 5.26) Configuration Transfer Procedure and (TS 23.401
[7] clause 5.15) RAN Information Management (RIM) procedures should be updated
so that RACS supporting RAN nodes can be discovered across inter-CN node
boundaries.
\- From SA WG2 perspective it is expected that when a UE capability ID is
assigned to a set of UE capabilities for which a UE capability filter was
applied, the association to this filter is conveyed over the signalling
interfaces inside the network and between the RAN and the UE when the mapping
to the UE capability ID to the UE capabilities is signalled. Based on SA WG2
current understanding the information about the filter that was applied is
expected to be part of the UE radio capability itself (this is subject to RAN2
discussion as RAN2 may apply some changes when they study RACS; e.g. SA WG2
has considered the _appliedFreqBandListFilter_ parameter defined in TS 38.331
[5] containing a list of frequency bands and band combinations, as well as the
set of parameters named _RF-Parameters-vXYZ_ defined in TS 36.331 [9], where
XYZ indicates the specification version when the parameter was introduced).
\- when a RAN node receives a PLMN-assigned UE Capability and ID and
associated UE Radio Capability Filter, and detects that the UE Radio
Capability Filter is not valid anymore, the RAN node trigger radio capability
enquiry and the serving core network will allocate a new UE Capability ID.
\- AMF that supports the RACS feature is mandated to have access to full set
of UEs radio capabilities and the mapping between UE Capability ID and
corresponding UE radio capabilities for at least the UEs registered in this
AMF;
\- NG-RAN that supports RACS, is mandatory to be able to maintain local
storage of UE radio capabilities and have access to the mapping between the UE
Capability ID and the full set of UEs radio capabilities;
\- A specific NG-RAN node that does not have the mapping between a specific UE
Capability ID and the corresponding UE radio capabilities, shall be able to
retrieve the mapping from CN.
\- The serving AMF stores the UE Capability ID in the UE context if received
and provides the capability ID to NG-RAN via N2 message, e.g. INITIAL CONTEXT
SETUP REQUEST.
\- The RACS capability can be configured and operated per PLMN ID in the RAN,
to support network sharing MOCN configuration.
For key issue #3, the following principles are agreed:
\- RACS procedures will apply to 5GS and EPS;
NOTE 7: some of the rationale for inclusion of EPS is as follows:
a) dependent upon operator deployment choices, inter system handover between
EPS and 5GS may be frequent. If RACS is not supported by EPS then the N2
handover messages for handover to EPS, and, handover from EPS will need to
carry the full UE Radio Access Capabilities. These very large signalling
messages could then be prioritised over e.g. data packets for URLLC services
on the backhaul to the gNB. In addition, these signalling messages might
exceed the size limits of GTP-C on the S10/N26 interface and the handovers
systematically fail. Hence not supporting RACS in EPS will have a negative
impact on 5GS.
b) The RAN working groups are endeavouring to encode the NR Radio Access
Capabilities more efficiently than the LTE Radio Access Capabilities. Owing to
the need for the LTE RAC to be understood by legacy LTE eNBs, these NR
efficiency mechanisms are not able to be used for LTE. As a result, it is
likely that the LTE RAC will be (much) larger than the NR RAC and hence the
need for the RACS feature is greater on LTE than on NR.
\- Whether the assignment of PLMN-specific UE Capability ID for a given set of
UE radio capabilities is performed in NAS e.g. using UE Configuration Update
or other NAS procedure or using N2 and RRC signalling will be decided in
normative phase;
\- The UE signals that it supports RACS in NAS layer.
\- The PLMN assigned UE capability ID is unique per PLMN and has PLMN-wide
validity.
\- If a PLMN-wide filter is used, the UE Capabilities Management Function can
be used to provision this filter in the PLMN RAN nodes via the AMF/MME:
subject to RAN 2 and RAN 3 confirmation, the PLMN-wide UE Capability filter is
signalled then by the AMF/MMEs to the RAN using non-UE-specific signalling
N2/S1.
\- subject to RAN3 confirmation the AMF/MME may provide the UE capability ID
and its mapping to UE radio capabilities to the RAN via N2/S1 signalling (UE-
specific signalling when an ID is assigned to a UE, Non UE-specific signalling
when the capability ID to UE radio capabilities mapping is pushed to the RAN
by the AMF/MME according to AMF policies, or the RAN asks the AMF to resolve a
UE capability ID of which the RAN does not know the related mapped UE radio
capabilities).- From SA WG2 point of view, for UEs that support the RACS
feature, for UEs that are already assigned with an applicable UE Capability
ID, it is mandatory to signal the UE Capability ID in Initial Registration. If
both PLMN assigned and manufacturer assigned UE Capability IDs are available,
the UE shall signal the PLMN assigned UE Capability ID.
\- The 5GS/EPS network may utilise the PLMN assigned UE Capability ID, without
involving the UE, when the UE does not support the RACS feature.
> \- UE deletes the PLMN assigned UE Capability ID(s) for the related PLMN on
> receiving an indication from the network. Other conditions will be specified
> as part of stage-3 work.
\- UE indicates the UE capability ID via NAS.
\- For backwards compatibility, the X2, Xn, S1 and N2 interface \"Setup\"
signalling needs to be updated to exchange information on the support level
for the RACS feature.
\- To allow for a mix of upgraded and non-upgraded RAN nodes over the X2/Xn
interfaces, the UE Capability ID should be included in the Path Switch
signalling between MME/AMF and RAN.
\- For backwards compatibility between nodes that support the feature and
nodes that do not support the feature, if a peer node is not supporting RACS,
the source node attempts to send to the peer node the UE capabilities that map
to the UE capability ID. However, owing to message size limits, this may lead
to an inter-CN node handover systematically failing, or, requiring the
retrieval of the UE capabilities across the target RAN node\'s radio
interface.
###### ### Annex A: Maximum supportable information element size
In R3-185103/S2-1810011, RAN WG3 have indicated that the standards for the
SCTP layer (used on S1, X2, N2 and Xn interfaces) do not impose any practical
restrictions on information element or message size.
NOTE 1: The maximum SCTP message size is 2**32 \"chunks\", and each \"chunk\"
could be an IP packet of > 1 kbyte. Operators and vendors may be able to check
the maximum SCTP packet re-assembly capability of their equipment by
examination of the \"a_rwnd\" value sent in SCTP frames.
In C4-186641/S2-1810021, CT WG 4 have indicated that:
a) For the GTPv2 based interfaces, e.g. MME - MME (S10) and MME - MSC (Sv)
over which the RAN transparent container will be transferred, the maximum size
of an IE is 65511 octets. Considering other mandatory and conditional IEs
which needs to be sent along with the RAN transparent container, this implies
that the size for the RAN transparent container is limited to 50000 octets.
NOTE 2: CT WG4 did not comment on the operation of GTPv2/UDP over an IPv6
based signalling link may be needed.
b) For the HTTP based N14 interface (AMF to AMF), there is no upper limit
defined by CT4 to transfer the RAN transparent container.
Subsequently, in C4-187633, CT 4 informed SA 3 that:
> _In HTTP payloads: They are encoded as JSON documents, and the definition of
> the Information Elements where SUCI may be included (JSON strings) do not
> specify any upper limit. Based on previous SA3 requests, CT4 have specified
> an upper bound on the size of the overall JSON body of HTTP requests and
> responses of 124,000 octets (see TS 29.501, subclause 6.2)._
Issues with large E-UTRAN Radio Capability IEs and SRVCC from E-UTRAN to
UTRAN/GERAN have already been solved.
For SRVCC from 5GC to UMTS, it is agreed that there is no requirement for
\'return handover\' from UMTS to 5GC. Hence it is assumed that there is no
need for the NG-RAN to supply the target UTRAN with any UE Capability
information relating to NG-RATs (nor, for UTRAN specific reasons, any
information relating to the UE\'s UTRAN radio capabilities). Therefore, MAP
and SCCP/Iu interface signalling constraints are not applicable to this work.
#
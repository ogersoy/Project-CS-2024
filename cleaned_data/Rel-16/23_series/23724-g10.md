# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This technical report studies and evaluates architecture enhancements to
address the following objectives:
**Objective I: Enable CIoT/MTC functionalities in 5G CN.**
The objective is to study how to support identified CioT/MTC functionalities
in 5G CN with potential connectivity to WB-EUTRA (eMTC) and/or NB-IoT for 5GS
capable devices.
The following CIoT/MTC functionalities need to be evaluated and studied how to
enable them in 5G CN, if needed:
\- Equivalent overall functionalities as provided by SCEF for CIoT/MTC.
\- Monitoring.
\- Small data transmission (infrequent and frequent small data transmission
including frequent small data transmission from tracking devices).
\- Additional power saving functions unless those are supported for 5G system
in Rel-15.
\- Non-IP Data Delivery.
\- Overload control (as relevant in 5G CN).
\- Support of Coverage enhancement including adaptations in 5G CN required to
support latencies.
\- Equivalent to Group communication and messaging.
\- Reliable communication via functionality equivalent to SCEF.
\- Inter-RAT mobility support to/from NB-IoT.
\- High latency communication.
\- Include location services procedures for IoT in 5G location services.
NOTE: Attach without PDN connection and non-IP PDN Connection type is already
supported in 5G CN (TS 23.501 [5]).
Ensure that regulatory requirements can be fulfilled at the same level as in
EPC.
**Objective II: Co-existence and migration from EPC based eMTC/NB-IoT to
5GCN.**
Study solutions for coexistence and migration from EPC towards 5G CN for
eMTC/NB-IoT.
This objective will study solutions where the same service is offered to some
UEs connected to EPC and some UEs connected to 5G CN e.g. using SCEF and
equivalent functionalities in 5GCN. Solutions that assume that 5G CN needs to
support EPC NAS signaling for legacy IoT devices access are not considered.
Any modifications in the EPC-5GC interworking \"baseline\" specific to CIOT
will also be discussed as part of Objective II.
**Objective III: 5G System enhancements to address 5G service requirements
(based on TS 22.261 [2] and TR 38.913 [3]).**
To study system architecture enhancements to address related service
requirements defined in TS 22.261 [2] and RAN requirements defined in TR
38.913 [3] and how to enable them in 5G CN, if needed. At least the following
service requirements have been identified:
\- Enable the change of association between subscription and address/number of
an IoT device within same operator and in between different operators.
\- Restricted Registration procedure to allow IoT device provisioning.
Any system implications for the RAN will be coordinated with RAN WGs.
This study is not going to study enhancements to EPC.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.261:\"Service requirements for next generation new services and
markets\".
[3] 3GPP TR 38.913: \"Study on scenarios and requirements for next generation
access technologies\".
[4] 3GPP TS 23.401:\"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[5] 3GPP TS 23.501: \"System Architecture for the 5G System\".
[6] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
with packet data networks and applications\".
[7] 3GPP TS 23.502: \"Procedures for the 5G System\".
[8] 3GPP TS 24.250: \"Protocol for Reliable Data Service between UE and SCEF;
Stage 3\".
[9] 3GPP TS 29.122: \"T8 reference point for northbound Application
Programming Interfaces (APIs)\".
[10] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System
(5GS)\".
[11] Void.
[12] Open Mobile Alliance: \"Lightweight Machine to Machine Requirements,
V1.0\".
[13] MQTT For Sensor Networks, (MQTT-SN): www.mqtt.org.
[14] IETF RFC 6347: \"Rescorla et al.: Datagram Transport Layer Security\",
IETF, January 2012.
[15] 3GPP TR 38.804: \"Study on New Radio Access Technology; Radio Interface
Protocol Aspects\".
[16] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
nodes\".
[17] 3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\".
[18] 3GPP TS 29.510: \"5G System; Network function repository services; Stage
3\".
[19] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".
[20] 3GPP TS 23.222: \"Functional architecture and information flows to
support Common API Framework for 3GPP Northbound APIs\".
[21] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station (MS) in idle mode\".
[22] 3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network
(E-UTRAN); S1 Application Protocol (S1AP)\".
[23] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[24] 3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security
architecture\".
[25] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
[26] 3GPP TS 29.502: \"Session Management Services; Stage 3\".
[27] 3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Medium Access Control (MAC) protocol specification\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Symbols
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] apply. An abbreviation defined in the present document takes precedence
over the definition of the same abbreviation, if any, in TR 21.905 [1].
# 4 Architectural Assumptions and Principles
The following architecture assumptions and principles apply:
\- The assumption is that WB-E-UTRA and NB-IoT are connected to 5GC via N2/N3.
\- Regulatory requirements (e.g. LI) shall be fulfilled at the same level as
in EPC.
\- No architectural enhancements made to EPC.
\- APIs for CIoT related services provided to the SCS/AS shall be common for
UEs connected to EPS and 5GS and accessed via the HPLMN.
NOTE 1: The level of support of the API may differ between EPS and 5GS.
\- Notifications and data from NFs in the VPLMN to the NEF can be routed
through an IWK-NEF, similar to the IWK-SCEF in EPC.
NOTE 2: Some solutions documented in this TR may not necessarily show the IWK-
NEF. It is however assumed that IWK-NEF support will be added during the
normative phase.
\- Support for small data delivery using IP data and Unstructured (Non-IP).
\- At least equivalent level of security for UEs used for CIoT in 5GS system
as in EPS.
NOTE 3: Security may need to be investigated by SA WG3.
\- Equivalent or reduced level of power consumption for UEs used for CIoT in
5GS system to that in EPS shall be supported.
\- UEs used for CIoT can be mobile or nomadic/static, and resource efficiency
should be considered for both for relevant optimization(s).
\- The 5GS system is assumed to operate with a large number of UEs used for
CIoT in the system and be able to appropriately handle overload and congestion
situations.
\- External exposure of network capabilities towards SCS/AS or AF is supported
via NEF.
> \- UEs used for CIoT can simultaneously connect to one or multiple SCSs/ASs
> or AFs.
# 5 Key Issues
## 5.1 Key Issue 1: Support for infrequent small data transmission
### 5.1.1 Description
This key issue aims to provide solutions to support efficient infrequent small
data transmissions for at least low complexity, power constrained, and low
data-rate CIoT UEs. In some of the usage scenarios the devices (e.g., utility
meters) may not be mobile throughout their lifetime. It is expected that the
number of CIoT devices will increase exponentially but the data size per
device will remain small.
### 5.1.2 Architectural requirements
This key issue addresses infrequently sending and receiving small data with
the following architectural requirements:
\- Resource efficient system signalling load (especially over the Radio
interface);
\- An at least equivalent level of security mechanisms for CIoT in 5G system
as in EPS;
\- Equivalent or reduced level of power consumption for UEs used for CIoT in
5GS system as in EPS;
\- Minimal Access Stratum changes required for NB-IoT/eMTC UEs to connect to
5GS;
\- Support for the following small data transmissions:
\- single packet transmission (UL or DL);
\- dual packet transmission (UL with subsequent DL, or DL with subsequent UL);
\- multiple packet transmission (one or a few UL and/or one or a few DL (in
any combination or order));
\- Support for delivery of IP data and Unstructured (Non-IP) data;
\- Support for charging, roaming and policy control;
\- Support API(s) for infrequent small data transmission and capability
exposure to AF.
\- Support of Exception Report for NB-IoT in 5G system as in EPS.
### 5.1.3 Architectural baseline
The following architectural baseline assumptions should be considered:
\- Small data can be exchanged using either the northbound API interface
between 5GC and AF or the N6 interface between UPF and AF.
\- The 5GS network function terminating the northbound API is assumed to
support message based charging.
### 5.1.4 Open issues
The following open issues remains to be studied:
\- Efficient handling of nomadic/static and mobile usage scenarios.
\- Whether and how small infrequent User Data delivery via Control Plane
and/or User Plane in the 5GS is supported.
\- Assumptions on UE indication of preferred and supported network behaviour
(see TS 23.401 [4], clause 4.3.5.10) may be required: A UE includes in a
Preferred Network Behaviour indication the Network Behaviour the UE can
support and what it would prefer to use.
\- Whether PDU sessions need to be established to exchange infrequent small
data.
\- Identify whether specific AMF/SMF selection for CIoT devices is needed.
\- How to support Exception Report in the manner of infrequent small data
transmission.
NOTE: This key issue may have some dependencies to the key issues for High
Latency Communications.
## 5.2 Key Issue 2: Frequent small data communication
### 5.2.1 Description
This key issue aims at providing a solution to support efficient frequent
small data transmissions for CIoT, e.g. tracking devices for both Mobile
Originated (MO) and Mobile Terminated (MT) use cases. It is expected that the
number of such devices can increase exponentially, but the data size per
device will remain small. Traffic characteristics for UEs used for CIoT using
frequent small data transmissions may lead to inefficient use of resources in
the 3GPP system and high UE power consumption without use of appropriate
optimization.
Frequent small data communication targets optimizations that can meet both
architecture requirements on UE power consumption and resource efficient
system signalling in a balanced way. A traffic pattern is assumed where small
data transmissions may occur from a few small data transmissions per hour to
multiple small data transmissions per minute.
The objective of this key issue is to ensure optimized transmission with IP
based and non-IP based protocols. Failure to do so may lead to sub-optimal
transmission characteristics with increased signalling and UE power
consumption.
### 5.2.2 Architectural requirements
In addition to the common requirements in clause 4, the following architecture
requirements shall be supported in 5GS:
\- It shall be possible to transmit frequent small data with consideration of
resource-efficiency and UE power efficiency;
\- Minimal Access Stratum changes required for NB-IoT UEs to connect to 5GS;
\- Support for delivery of IP data and Unstructured (Non-IP) data;
\- Support for the following small data transmissions:
\- single packet transmission (UL or DL);
\- dual packet transmission (UL with subsequent DL, or DL with subsequent UL);
\- multiple packet transmission (one or a few UL and/or one or a few DL (in
any combination or order));
\- An at least equivalent level of security mechanisms for CIoT in 5G system
as in EPS;
\- Equivalent or reduced level of power consumption for UEs used for CIoT in
5GS system as in EPS;
\- Support for charging, roaming, policy control;
\- Support of Exception Report for NB-IoT in 5G system as in EPS.
### 5.2.3 Architectural baseline
The following are considered architecture baselines for this key issue:
\- The 5GS network function terminating the T8 NIDD API is assumed to support
message based charging.
\- The AF (i.e. SCS/AS) shall be able to access frequent small data service
via an API equivalent to T8 NIDD API.
\- The AF (i.e. SCS/AS) shall be able to access frequent small data
communication over N6.
### 5.2.4 Open issues
The following open issues for supporting key issue Small data frequent
communication:
\- How to enable frequent small data transmissions (see clause 5.2.1) in a
resource-efficient and UE power efficient way in 5GS;
\- Whether and how to support Exception Report in the manner of frequent small
data transmission.
## 5.3 Key Issue 3: High latency communication
### 5.3.1 Description
Functions for high latency communication may be used to handle Mobile
Terminated (MT) communication with UEs being unreachable while using power
saving functions (see key issue on power saving functions) and for
coordinating the maximum latency between the application, the UE and the
network. \"High latency\" refers to the initial response time before normal
exchange of packets is performed and may be further classified into shorter
and longer latencies. That is, the time it takes before a UE has woken up from
its power saving state and responded to the initial downlink packet(s).
In EPC (see TS 23.682 [6]) high latency communication is handled by the
following two mechanisms:
\- Extended buffering of downlink data in the network: The data is buffered
until the UE wakes up from its power saving state and moves to ECM-CONNECTED
state, when the buffered downlink data is conveyed to the UE.
\- Notification procedures: An AF (i.e. SCS/AS) may request notification when
a UE wakes up or is expected to wake up from its power saving state, to send
the downlink data to the UE when the UE becomes reachable.
Similar approaches may be considered for 5GC. Extended buffering is not
recommended for UEs using very long sleep durations.
### 5.3.2 Architectural requirements
In addition to the common requirements in clause 4, the following architecture
requirements shall be supported for high latency communication in the 5G
system:
\- Send DL data to UEs at the earliest possible opportunity when the UEs are
applying power saving functions, followed by subsequent return to power saving
state when the data has been delivered.
\- Coordination of the UE sleep duration between the Application, the UE and
the network.
\- Provide the AF (i.e. SCS/AS) with UE status information (e.g. reachability
notification or the time when the UE is expected to be reachable).
### 5.3.3 Architectural baseline
\- 5GS enhanced with resource efficient buffering until UE wakes up from its
power saving state;
\- The buffered downlink data can be forwarded, if needed, between the network
function instances that provide the buffering to avoid packet loss.
\- Support for UE status information related to power saving functions (e.g.
UE reachability) reporting to SCS/AS .
\- The 5GS may receive parameters related to reachability and buffering via
the Network Parameter Configuration API.
### 5.3.4 Open issues
The following issues shall be considered:
\- Study how to support high latency communication when power saving solutions
are used in 5GS;
\- Study where downlink data can be buffered;
\- Study which monitoring events can be generated;
\- Study whether the 5G system should support obtaining Maximum Latency
parameters from the UE via NAS signalling.
NOTE: This key issue may have some dependencies to the key issues for Power
saving functions, Infrequent small data communication, Frequent small data
communication and Network Parameter Configuration API via NEF.
## 5.4 Key Issue 4: Power Saving Functions
### 5.4.1 Description
EPC supports Power Saving Mode (PSM) and Extended Idle Mode DRX (eDRX). This
key issue addresses how equivalent EPS power saving functions and 5G
enhancements will be supported in the 5G system allowing connectivity between
5GC and WB-EUTRA (eMTC) and/or NB-IoT devices.
E-UTRAN (both WB-E-UTRAN and NB-IoT) already supports extended idle mode DRX
functionality and the same is assumed to be available when E-UTRAN is
connected to 5GC: operators have begun deploying eDRX support for NB-IoT/eMTC
and are expecting continued support of eDRX regardless of whether E-UTRAN is
connected to EPC or 5GC. Therefore, this key issue aims at supporting eDRX in
5GC.
Furthermore, as already studied for EPC, extended idle mode DRX has a
limitation in the amount of time the UE can be in deep sleep (\~45 minutes for
WB-E-UTRAN and \~3hs for NB-IoT). Therefore, a NAS based approach should be
adopted as well to support sleep cycles similar to the ones supported by PSM
in EPC.
Therefore two tracks of this key issue should be studied:
\- Track 1: 5G NAS/5GC support of extended idle mode DRX:
\- Reuse as is the RAN aspects of extended idle mode DRX already supported in
WB-E-UTRAN and NB-IoT.
\- Include NAS, N2, subscription and CN handling aspects of extended idle mode
DRX feature.
\- Track 2: NAS based approach addressing very long delay tolerance for MT
data, i.e. sleep cycles similar in duration as supported by PSM in EPC.
\- NAS based solution with no/minimal RAN impact that allows for sleep periods
of up to similar duration as in EPC PSM.
NOTE 1: How the SCS/AS influences the configuration of the power savings
functions will be impacted by the conclusion of the \"Network Parameter
Configuration API via NEF\" key issue.
NOTE 2: Reachability and buffering aspects will be addressed in the key issue
on high latency communication.
### 5.4.2 Architectural requirements
Architecture goals for UE power consumption optimizations include:
\- Solutions shall enable UE power savings while also supporting mobile
terminating communications with a delay governed by the duration of the UE\'s
sleep cycles.
\- Solutions shall enable UE power savings while also supporting delay-
sensitive mobile terminating communications triggered by mobile originated
communications.
\- Solutions shall optimize UE power savings according to expected and desired
UE and application behaviour (e.g. communication pattern) if such information
is available.
\- Sleep cycle durations supported by 5GC should be the same as supported by
eDRX and PSM in EPC.
### 5.4.3 Architectural baseline
**Track 1:** 5G NAS/CN will be updated to support extended idle mode DRX for
sleep cycles up to \~45 minutes for WB-E-UTRAN and \~3hs for NB-IoT as
follows:
\- 5G NAS to support eDRX sleep cycle negotiation during
registration/registration update, etc.
\- Subscription information to be enhanced by extended idle mode DRX
parameters.
\- AMF to support Hyper SFN, Paging Hyperframe and Paging Time Window length
as described in TS 23.682 [6] for paging the UE.
Editor\'s note: Support for eDRX functionality by E-UTRA connected to 5GC as
described above to be confirmed by RAN groups.
**Track 2:** NAS based approach addressing very long delay tolerance for MT
data, i.e. for sleep cycles similar in duration as supported by PSM in EPC.
\- Power Saving Function (e.g. the MICO mode, PSM), enabling sleep periods
similar in duration to those supported by PSM in EPC is negotiated at NAS.
### 5.4.4 Open issues
\- No open issues for Track 1, translation of signalling to 5G CN should be
straightforward.
\- For Track 2, how to ensure that pending downlink data can be delivered to
the UE when the UE wakes up from a sleep cycle.
\- For 5GS enhancements how 5GS is configured with the UE\'s and
application\'s expected and desired behaviour and and how the 5GS fulfils
those requirements.
\- Support for eDRX in RRC_Inactive is FFS.
NOTE: This key issue may have some dependencies and relations to other key
issues including high latency communication, etc.
## 5.5 Key Issue 5: UE TX Power Saving Functions
### 5.5.1 Description
It is observed that when UE communicates with network, the TX power
consumption of each data transmission is more than ten times of the RX power
consumption and the TX power consumption contributes much to the UE whole
power consumption. So, optimizing the TX power consumption is an effective way
to improve UE power saving.
This key issue aims to optimize UE TX power consumption under certain
conditions, e.g. in weak coverage, with high latency application, or other any
conditions under which UE TX power consumption can be improved.
NOTE: In this key issue UE TX power consumption optimization should be
considered only at system level.
### 5.5.2 Architectural requirements
The following architecture requirement shall be supported:
\- It shall be possible to optimize UE TX power consumption under the
identified conditions.
\- Optimizing UE TX power consumption shall reduce overall UE power
consumption.
### 5.5.3 Architectural baseline
### 5.5.4 Open issues
\- To identify the conditions under which UE TX power consumption can be
improved.
## 5.6 Key Issue 6: Management of Enhanced Coverage
### 5.6.1 Description
Both NB-IoT and WB-E-UTRA, with enhancements for MTC radio access technologies
are expected to be used in 5G to provide radio access support for massive IoT.
Both these RATs support Enhanced Coverage (EC) based on radio signal
repetitions. Radio signal repetition is costly and therefore management of the
feature is important from overall system cost perspective.
### 5.6.2 Architectural requirements
The following functionality should be supported:
\- Enable an Application Server/Function to query the status of the enhanced
coverage restriction for a UE;
\- Means for the 5GC to restrict UE usage of the EC feature;
\- Enable an Application Server/Function to enable, or to disable the EC
restriction for a particular UE; and
\- Temporary storage of RAN parameters in 5GC, related to the EC feature.
\- Indication of UE capability of CE mode B support to the 5GC.
\- Storage of restriction of use of EC as part of subscription parameter in
UDM.
### 5.6.3 Architectural baseline
Baseline for EC support for 5G, is the T8 API towards the AF/AS and the 5GS
architecture.
5GC already support monitoring/exposure function of certain UE aspects, see TS
23.502 [7] clause 4.15. The exposure functionality already specified should be
considered when enabling an Application Server/Function to query the status of
the enhanced coverage restriction for a UE.
The AMF receives, at N2 release, RAN parameters, important for paging a UE in
EC. The AMF shall store the parameters during the time the UE is in CM-IDLE
and return the parameters to RAN in a subsequent paging message unless the UE
is restricted from using EC. Same or similar IE as the Information Element
_UEPagingCoverageInformation_ is used for this purpose in 5GS.
Use of Enhanced Coverage can be restricted per subscriber per PLMN in the UDM.
If the Enhanced Coverage is restricted as per subscription or based on local
configuration then the AMF informs:
\- the UE as part of the Registration procedure;
\- the RAN whenever the UE context is established or modified in the RAN.
### 5.6.4 Open issues
Compared to EPC there are a few new aspects in 5GS that should be studied and
considered in proposed solutions:
\- OI1: Impacts to the Enhanced Coverage feature due to MICO mode and any
other power save solutions proposed and studied for 5GS.
\- OI2: Impacts, if any, to the Enhanced Coverage feature due to RRC_Inactive
feature.
\- OI3: Signalling details for status query of Enhanced Coverage restriction
and enabling/disabling Enhanced coverage restriction by Application
Server/Function.
## 5.7 Key Issue 7: Overload Control for small data
### 5.7.1 Description
In EPC two solutions are provided for small data communication a.k.a. CIoT
optimizations: User Plan CIoT EPS optimization and Control Plane CIoT EPS
optimization. For the Control Plane CIoT EPS optimization overload control
mechanism is defined in EPC to protect the MME and the Signalling Radio
Bearers (SRBs) in the E-UTRAN from the load generated by NAS Data PDUs. This
key issue aims to study whether and how equivalent overload control mechanism
can apply for NB-IoT and WB-E-UTRA connected to 5GC.
NOTE: The Overload control for 5G IoT depends on the selected solution for
small data communication.
### 5.7.2 Architectural requirements
The following architecture requirement shall be supported:
\- The system should support procedures to handle the overload from data
transmission via the control plane (if data transmission via control plane is
agreed as a feature in 5GS).
\- The system should allow Exception Report during overload control.
### 5.7.3 Architectural baseline
Depending on the selected solution for small data communication in 5GS,
similar functionality e.g. control plane data back-off timer, control plane
overload start indication and service gap as applied in the EPC can be applied
to protect the 5GS control plane from overload when used to transport user
data packets.
### 5.7.4 Open issues
The following open issues remains to be studied.
\- In what network function(s) can the overload conditions occur, and where
should the overload control be executed?
\- What are the function and procedures required to handle overload?
\- How to allow Exception Report when network function is in overload
condition?
\- Whether and how to handle UEs configured for Low Priority and Overriding of
Low priority in 5G System?
## 5.8 Key Issue 8: Support of the Reliable Data Service
### 5.8.1 Description
This key issue will address how to enable the Reliable Data Service for
unstructured PDU sessions and functionality equivalent to the Reliable Data
Service.
NOTE: Solutions to this key issue will likely depend on solutions to several
other key issues (e.g. Frequent and Infrequent Small Data key issues).
### 5.8.2 Architectural requirements
\- In an unstructured PDU session type, it shall optionally be possible to
provide for reliability and the detection and elimination of duplicate packets
between the UE and the PDU session termination point.
\- AF\'s shall be able to send and receive data via a set of exposed APIs.
\- When an AF uses an exposed API to send and receive data:
\- It shall optionally be possible for the sender to indicate whether or not
the data needs to be sent with reliability or not.
\- It shall optionally be possible to identify the sending and receiving
application.
\- UE and Network shall be able to indicate its support for reliable
communication.
### 5.8.3 Architectural baseline
\- It shall be an option to use the Reliable Data Service protocol (defined in
TS 24.250 [8]) to provide for reliability and the detection and elimination of
duplicate packets between the UE and the unstructured PDU session termination
point as well as a means for identifying the sending and the receiving
application.
\- The APIs that are exposed to the AF will support the functionality and
features that are exposed on the T8 interface by the Non-IP Data Delivery APIs
that are defined in TS 29.122 [9] so that the T8 APIs may be re-used in 5GC.
### 5.8.4 Open issues
\- What NF is used as the PDU session termination point (UPF, NEF, etc.) will
be decided as part of other key issues (e.g. Frequent and Infrequent Small
Data key issues).
\- How reliable communication is enabled and disabled (e.g. based on static
DNN configuration, or using dynamic mechanism).
## 5.9 Key Issue 9: Support of common north-bound APIs for EPC-5GC
Interworking
### 5.9.1 Description
An IoT UE can possibly switch between EPC and 5GC. An authorized third party
service provider should be able to get access to authorized and available
services when the UE is either on EPC or on 5GC. This key issue will address
architectural issues that may arise when a UE switches between being served
between EPC and 5GC.
NOTE: Evaluation of solutions to this key issue should consider whether there
are any CAPIF impacts.
### 5.9.2 Architectural requirements
\- An authorized third party service provider should be able to get access to
authorized and available services when the UE is either on EPC or on 5GC.
### 5.9.3 Architectural baseline
### 5.9.4 Open issues
\- With respect to the UE\'s movement between EPC and 5GC:
\- Whether this will cause the API termination point(s) associated with the UE
to change.
\- How does the AF become aware of the availability or of the expected level
of support of a given service?
\- Whether it is possible for the exposure function (e.g. SCEF or NEF) serving
a UE to change.
\- If so, then how the AF determines what node to direct API requests towards.
\- If so, then how the new node gets the UE\'s context (i.e. NIDD
Configuration, Monitoring Event Configurations, etc.).
## 5.10 Key Issue 10: Network Parameter Configuration API via NEF
### 5.10.1 Description
This key issue addresses how the Network Parameter Configuration API may be
implemented the Nnef interface.
TS 23.682 [6] defines a Network Parameter Configuration procedure on the T8
interface. The procedure is used by the SCS/AS to provide the EPS with
suggested parameter values for Maximum Latency, Maximum Response Time and
Suggested Number of Downlink Packets.
In the EPS, these values are used to influence the UE\'s PSM, extended idle
mode DRX, and extended buffering configurations. However, the SCS/AS is
largely unaware of the details of the power savings techniques that are used
by the network (e.g. PSM and eDRX). From the SCS/AS point of view, the UE is
essentially reachable or unreachable.
The SCS/AS provides Maximum Latency as a guide for the maximum amount of time
between UE reachability events.
The SCS/AS provides Maximum Response as a guide for how much time the SCS/AS
needs to begin sending data to the UE after receiving a reachability
notification.
The SCS/AS provides the Suggested Number of Downlink Packets parameters to
configure how many packets should be buffered by the network when the UE is
not reachable.
This key issue will examine how, in 5GS, the AF (i.e. SCS/AS) may provide
Maximum Latency, Maximum Response, and Suggested Number of Downlink Packets to
the 5GS and expect network behaviour similar to EPS.
### 5.10.2 Architectural requirements
\- The Nnef interface should allow the AF to provide a Maximum latency
parameter as a guide for the maximum amount of time between UE reachability
events.
\- The Nnef interface should allow the AF to provide a Maximum Response
parameter as a guide for how much time the AF needs to begin sending data to
the UE after receiving a reachability notification.
\- The Nnef interface should allow the AF to provide a Suggested Number of
Downlink Packets parameter to configure how many packets should be buffered by
the network when the UE is not reachable.
### 5.10.3 Architectural baseline
\- As is done on T8, the AF will use the Network Parameter Configuration API
to provide the NEF with Maximum Latency, Maximum Response Time, and Suggested
Number of Downlink Packets.
\- The NEF will provide the Maximum Latency, Maximum Response Time, and
Suggested Number of Downlink Packets parameters to the UDM or UDR and the
values will be added to the UE\'s subscription information.
NOTE 1: Whether UDM or UDR is used depends on whether it is concluded that per
subscriber authorisation and/or data validation is required.
\- The UDM/UDR will provide the Maximum Latency, Maximum Response Time, and
the Suggested Number of Downlink packets to the NFs that use them.
\- An NF that buffers downlink data may use the Suggested Number of Downlink
Packets parameter as a guide for configuring whether or not buffering should
be enabled and the amount of data to be buffered.
NOTE 2: This key issue is dependent on and should adapt to the outcome of
other key issues (e.g. power saving, high latency, etc.).
### 5.10.4 Open issues
\- How and whether Maximum Response Time is used to configure power saving
functions and impact a UE\'s reachability for downlink data.
\- How the 5GS uses the Maximum Response Time parameter to determine when to
send reachability notifications to the AF.
\- How and whether Maximum Latency is used to configure power saving functions
and impact a UE\'s reachability for downlink data.
\- How and whether the Suggested Number of Downlink Packets parameter impacts
buffering.
\- How the UDM knows what NF to provide the Suggested Number of Downlink
Packets to (i.e. what PDU session the setting applies to).
\- Whether the NEF adds parameters to the UE\'s subscription information via
the UDM or directly to the UDR (i.e. do parameter updates need to be
authorised per subscriber and/or is any data validation is required prior to
storage).
\- It is FFS how the Network Parameter Configuration API and the Maximum
Response, Maximum Latency, and Suggested Number of Downlink Packets parameters
are used may be impacted by solutions/conclusions to other key issues within
this study (e.g. 5GS small data, high latency communication, and power saving
functions solution(s)).
NOTE: Where buffering occurs will be decided as part of the High Latency
Communication key issue.
\- It is FFS whether other parameters may be need to configure power saving
functions and buffering in 5GS.
## 5.11 Key Issue 11: Monitoring
### 5.11.1 Description
Rel-15 5GC supports event monitoring for many of the same or similar events as
EPC. This key issue will address how to add support to 5GC for any monitoring
features that are supported in EPC but not 5GC. The key issue shall also make
an assessment of the relevance for any identified features in 5GC. This key
issue will also address how monitoring event configurations are handled when
the UE moves between EPC and 5GC.
### 5.11.2 Architectural requirements
\- Monitoring Events that are available via the T8 interface in EPC should
also be available in 5GC.
### 5.11.3 Architectural baseline
\- The Monitoring Events that are already available in Rel-15 5GC are assumed
to be reused as much as possible.
### 5.11.4 Open issues
\- Identify missing monitoring events, assess their relevance in 5GC, and
study how to add any identified relevant events in 5GC.
\- How is Monitoring Event Configuration information handled or transferred
when a UE moves from EPC to 5GC.
\- Depending on solutions to the Interworking KI, does the node that is
supposed to receive the report (NEF or SCEF) change when a UE moves between
EPC and 5GC.
## 5.12 Key Issue 12: Inter-RAT mobility support to/from NB-IoT
### 5.12.1 Description
In Rel-14, inter-RAT mobility to/from NB-IoT without the need to
detach/reattach was introduced with a CN only approach with three aspects:
\- Force TAU triggering UE via different TAs for different RAT types WB-E-
UTRAN and NB-IoT.
\- Maintaining two separate UE radio capabilities in the CN (MME) depending on
whether they were received when the UE was camping on WB-E-UTRAN or NB-IoT.
\- PDN connection handling based on subscription.
### 5.12.2 Architectural requirements
The architectural requirements are:
\- Intra-PLMN idle mode inter-RAT mobility to and from NB-IoT should be
supported in a radio, core network and battery efficient manner. The other RAT
to be supported are NR, WB-E-UTRAN.
Editor\'s note: Additional considerations for GERAN/UTRAN are FFS.
\- The solution should enable data sent on different RATs to be correctly
recorded on CDRs.
\- The HPLMN should be able to influence which DNNs/S-NSSAIs are maintained,
reconnected or disconnected at inter-RAT idle mode mobility to/from NB-IoT.
### 5.12.3 Architectural baseline
The architecture baseline uses the EPC solution as baseline for the core
network aspects.
\- It is assumed that the UE radio capabilities provided by the UE in NB-IoT
are different from the UE radio capabilities provided by the UE in WB-E-UTRAN
and NR.
\- Therefore two sets of capabilities are maintained by the AMF:
\- UE radio capabilities provided while UE is camping on NB-IoT are stored in
AMF and provided to the RAN only when the UE is camping on NB-IoT.
\- UE radio capabilities provided while UE is camping on WB-E-UTRAN or NR are
stored in AMF and provided to the RAN only when the UE is camping on WB-E-
UTRAN or NR.
\- When the UE preforms inter-RAT idle mode mobility to/from NB-IoT, the SMF
decides, based on policies received from UDM or based on local policy, whether
to maintain, reconnect or release a PDU session based on the DNN/S-NSSAI
information.
### 5.12.4 Open issues
\- How to handle established PDU Session for following idle mode mobility
scenarios:
\- Between NB-IoT connected to 5GC and WB-EUTRAN connected to 5GC;
\- Between NB-IoT connected to 5GC and WB-EUTRAN connected to EPC;
\- Between NB-IoT connected to 5GC and NR connected to 5GC.
## 5.13 Key Issue 13: Support for Expected UE Behaviour
### 5.13.1 Description
The procedure for External Parameter Provisioning is supported in Rel-15 5GC,
and the Expected UE Behaviour parameters can be provided by the 3rd party via
this procedure (see TS 23.502 [7], clause 4.15.6). The Expected UE Behaviour
is regarded as a kind of 3rd party provided parameters set, which should also
include the Communication Pattern parameters (see TS 23.682 [6], clause 5.10)
which were defined for EPC mainly to optimize resource utilization for CIoT.
This key issue investigates:
\- Which parameters are necessary to be indicated to the 5GC in order to allow
the 5GC to operate as effectively as EPC for devices with communication
patterns and how they are provided to the AMF and to the SMF;
\- Investigate the relevance of parameters in Communication Pattern list for
the procedures and features in 5GC.
NOTE: Other key issues, such as Power Saving Functions, Network Parameter
Configuration API via NEF, and High Latency Communication are affected by this
Key Issue.
### 5.13.2 Architectural requirements
\- Communication Pattern parameters and new parameters which may be used by
5GC to optimize network resource usage should also be part of the Expected UE
Behaviour parameters.
\- The 5GC authorises whether the AF is allowed to provide the parameters and
checks that they are within the range allowed by the operator.
### 5.13.3 Architectural baseline
The architectural baseline for supporting the Expected UE Behaviour
provisioning for 5G is the T8 API towards the AF/AS and the 5GS architecture.
\- The External Parameter Provisioning procedure is already available in
Rel-15 5GC and is assumed to be reused and extended to support the
provisioning of Communication Pattern parameters.
### 5.13.4 Open issues
The following open issues remains to be studied:
\- Which existing Communication Pattern parameters and new parameters (e.g.
mobility related parameters) are necessary for 5GC.
\- Which parameters are provided to AMF and to SMF.
\- Whether and how the parameters provided to the 5GC are provided to the RAN.
NOTE: Potential impacts on RAN and whether these parameters are provided to
RAN will be coordinated with the relevant RAN WGs.
## 5.14 Key Issue 14: QoS Support for NB-IoT
### 5.14.1 Description
This key issue aims at studying QoS differentiation for NB-IoT. If relevant
end-user use cases can be identified, the study should include the required
level of QoS differentiation, if any (e.g., QoS differentiation across
different UEs, QoS differentiation across PDU sessions of the same UE, QoS
differentiation for different traffic flows within a PDU session of the same
UE). Consideration should be given for PDU Session types used by NB-IoT (i.e.
IPv6, IPv4, and Unstructured) and that dedicated bearers are not supported in
NB-IoT.
The key issue should assume traffic models used by NB-IoT devices, e.g.,
consideration of relevance for QoS differentiation of traffic flows of small
data transmission.
The key issue should include and assume exception reporting would be present
for NB-IoT in 5G.
### 5.14.2 Architectural requirements
Study whether and how to introduce support for QoS differentiation for NB-IoT.
### 5.14.3 Architectural baseline
The baseline includes:
\- PDU session types can be IPv4, IPv6, or Unstructured.
### 5.14.4 Open issues
If relevant end-user use cases can be identified, the open issues include:
1\. The required level of QoS differentiation, if any (e.g. QoS
differentiation across different UEs, QoS differentiation across PDU sessions
of the same UE, QoS differentiation for different traffic flows within a PDU
session of the same UE).
## 5.15 Key Issue 15: Core Network selection for Cellular IoT
### 5.15.1 Description
Rel-15 provides a mechanism to indicate over E-UTRA whether connectivity to
5GC is available, and a mechanism for the UE to indicate whether it has
selected EPC or 5GC in RRC signaling.
A UE that supports EPS CIoT features and 5GS CIoT features as well as a UE
that only supports 5GS CIoT features needs to additionally be made aware
whether CIoT features are available in EPC and/or 5GC when selecting the core
network to connect to via an NB-IoT/WB-E-UTRA cell.
In the networks that support CIoT features in both EPC and 5GC, the operator
may steer the UEs to a specific CN type due to operator policy, e.g., due to
roaming agreements, UE\'s Preferred and Supported Network Behaviour, load
redistribution, etc. This key issue aims at studying how to inform the UE
whether and which 5GS CIoT features are available in 5GC, and how to steer the
UE to EPC or 5GC based on operator policies if the CIoT features required by
the UE are supported in both EPC in 5GC.
NOTE: Steering of UEs to the other CN type is not assumed to be performed for
frequent load re-distribution. Operator policies in EPC and 5GC, respectively,
are assumed to avoid steering UEs back and forth between EPC and 5GC.
### 5.15.2 Architectural requirements
The architectural requirements are as follows:
\- It shall be possible for a UE supporting CIoT features to discover whether
5G CIoT feature(s) are supported in 5GC via NB-IoT/WB-E-UTRA access, and to
perform core network selection between EPC and 5GC based on such discovery.
\- It shall be possible for the RAN to take into account CIoT feature
indication(s) from the UE to perform AMF selection.- Upon UE selecting 5GC, it
shall be possible for the 5GC, based on e.g. operator policy, to redirect the
UE to EPC, and vice versa.
\- Upon redirecting the UE to EPC, it shall be possible for the EPC to prevent
idle and connected mode mobility to 5GC, and vice versa.
### 5.15.3 Architectural baseline
The architectural baseline is as follows:
\- A UE supporting 5G CIoT feature(s), discovers whether 5G CIoT feature(s)
are supported in 5GC.
\- A UE supporting 5G CIoT feature(s) and EPC CIoT optimizations performs CN
type selection (EPC vs 5GC) based on the information about the features
available for EPS (i.e. CP and/or UP optimizations) and 5GC.
\- A UE selecting 5GC may also request 5G CIoT feature(s) during RRC
connection establishment procedure.
\- If the UE has requested 5G CIoT feature(s), the RAN takes that into account
for AMF selection.
\- If the UE has selected 5GC, the 5GC can based on e.g. operator policy,
redirect the UE to EPC, and vice versa.
\- If the 5GC has redirected the UE to EPC, the EPC indicates the idle mode
camping policy and connected mode mobility restrictions to RAN to prevent
mobility to 5GC, and vice versa.
### 5.15.4 Open issues
The open issues for this key issue are the following:
\- The granularity of CIoT features to be discovered and to be taken into
account, i.e. which solution or set of solutions constitute a 5GS CIoT(s)
features to be taken into account during CN selection.
\- How the network determines the UE(s) need to be moved to the other system
(i.e. EPC to 5GC or vice versa)
\- Whether and how the 5GS C-IoT feature(s) are indicated to UE in broadcast
or by any other means.
\- How the 5GS CIoT feature(s) are indicated in RRC by UE.
Editor\'s note: The previous two aspects require coordination with RAN WGs.
\- How potential solutions relate to network slicing.
\- How the potential solutions for Core Network selection can be generalized
and applied also to other than CIoT UEs.
## 5.16 Key Issue 16: Support of Group communication and messaging
### 5.16.1 Description
In order for 5GS to support similar group communication and messaging as in
EPC, the following aspects should be studied:
\- Mechanisms for efficient delivery of group messages.
\- A service interface provided to application servers to send group messages
intended to a group of devices.
\- Depending on solutions, a mechanism might be needed for synchronized wake
up for group messages reception by UEs in a group that are using power saving
functions.
Editor\'s note: Depending on RAN WGs progress, this Key Issue may be moved to
another Study Item.
### 5.16.2 Architectural requirements
The following architecture requirement shall be supported:
\- The system shall support efficient delivery of a group message to a group
of devices.
\- The system shall support the negotiation of group message delivery between
application server and network.
\- The system shall (depending on selected solution) support to synchronised
wake up for a group of UEs that are using power saving functions.
### 5.16.3 Architectural baseline
The following are considered architecture baselines for this key issue:
\- A group message may be sent to a group of devices via unicast Mobile
Terminated data delivery procedure.
\- The AF (i.e. SCS/AS) may be able to access group messaging service via an
API equivalent to T8 group message delivery API.
### 5.16.4 Open issues
The following issues shall be considered:
\- Pending RAN decisions on multicast/broadcast, study how to support
efficient a group message to a group of devices.
NOTE 1: This key issue may have some dependencies to the key issues for Power
saving functions and Infrequent small data communication.
NOTE 2: Work on multicast/broadcast will not be started until RAN related
decisions. Multicast over UP in the CN is not precluded.
## 5.17 Key Issue 17: MSISDN-less MO SMS
### 5.17.1 Description
This key issue addresses how the MSISDN-less MO SMS API may be implemented on
the Nnef interface.
TS 23.682 [6] defines a procedure for sending MSISDN-less MO SMS via the T8
interface. The procedure is used by the network to send MO SMS to the SCS/AS.
### 5.17.2 Architectural requirements
\- The Nnef interface should allow the NEF to forward MO SMS to an AF.
### 5.17.3 Architectural baseline
\- MO SMS between the UE and SMS-SC is unchanged. The service centre address
points to the SMS-SC which can route the MO SMS to the AF, the destination SME
address is set to short/long code of the AF, and Application Port ID element
of the TP-User-Data field is set to an appropriate value.
\- The SMS-SC uses the destination SME address (long/short code of the AF) to
identify the corresponding NEF based on a pre-configured mapping table. SMS-SC
extracts the SMS payload, Application port ID, and IMSI of the UE and delivers
them to NEF via a T4 Interface along with the destination SME address
(long/short code of the SCS/AS). The NEF acts as an MTC-IWF on the T4
interface.
\- The NEF identifies the AF with the destination SME address (long/short code
of the SCS/AS) received from the SMS-SC.
\- As is done on T8, the NEF will use the MSISDN-less MO SMS API to send MO
SMS to the AF via the Nnef interface.
### 5.17.4 Open issues
None.
# 6 Solutions
## 6.1 Solution 1: Infrequent small data transfer via NAS-SM and N6
### 6.1.1 Introduction
#### 6.1.1.1 General
This solution applies to Key issue 1 (support for infrequent small data
transmission). The key idea of the solution is to convey small data inside NAS
PDUs between UE and SMF for PDU session types IPv4, IPv6, unstructured.
Operators are not required to upgrade all SMFs to support small data transfer
via NAS as the AMF is assumed to be able to select an SMF capable of small
data transfer via NAS. This enables isolation from SMFs handling non-CIoT
related sessions but also allows for separate scaling of SMFs supporting small
data via NAS-SM.
Support for Reliable Data Service (RDS) is provided as described in Solution
[49].
Further details related to infrequent data transfer via API(s)/NEF are
described in clause 6.30 (Solution 30).
#### 6.1.1.2 Architecture reference models
##### 6.1.1.2.0 General
This clause shows the architecture reference models for the cases where a NAS
Small Data Delivery PDU Session terminates at a UPF and architecture reference
models that support API usage in the cases where a NAS Small Data Delivery PDU
Session terminates at a NEF.
This solution presents no Roaming Reference Architecture for the Local
Breakout case when the PDU session terminates at an NEF because a Small Data
API service will not be exposed by the visited network. This is in line with
the architecture principle from TS 23.501 [5] which states \"_For external
exposure of services related to specific UE(s), the NEF resides in the HPLMN.
Depending on operator agreements, the NEF in the HPLMN may have interface(s)
with NF(s) in the VPLMN_.\".
APIs are exposed to the AF via the N33/Nnef reference point.
The N29 reference point will be used to send and receive small data packets
via the NEF.
##### 6.1.1.2.1 Non-roaming reference architectures
Figure 6.1.1.2.1-1: Architecture for small data delivery via NAS and N6 or N33
(non-roaming)
##### 6.2.1.2.2 Roaming reference architectures
Figure 6.1.1.2.2-1: Architecture for small data delivery via NAS and N6 or N33
(home-routed roaming)
Figure 6.1.1.2.2-2: Architecture for small data delivery via NAS and N6
(roaming with local break-out)
### 6.1.2 Functional Description
The following principles apply:
\- Small data transfer via NAS-SM:
\- Small data is exchanged between the UE and SMF as payload of SM data
transfer message in both uplink and downlink direction.
NOTE 1: It is assumed that the PDU Session ID in the SM data transfer message
is not sent in the SM data transfer message but is instead provided separately
by the AMF to the SMF. Whether or not other IEs in the SM header can be
omitted is left for Stage 3.
\- AMF transparently forwards downlink SM data transfer messages between UE
and SMF.
\- NAS transport messages are used to transfer SM data transfer messages
between UE and AMF.
\- The payload container type use for the downlink/uplink NAS transport
message carrying SM data transfer message is a new container type \"SM data
transfer\". This allows the AMF to differentiate between regular SM signaling
and SM data transfer and apply overload control accordingly.
\- For uplink NAS transport, the PDU session ID allows the AMF to route the SM
data transfer message to the correct SMF as stored in the UE context.
\- SM data transfer messages are associated with a PDU session.
\- For a UE in CM Idle mode, it should be possible to send an initial NAS
transport message with the SM data transfer message as payload.
NOTE 2: It is currently not possible to send NAS transport message as defined
in TS 24.501 [10] as Initial NAS message (the UE needs to perform service
request or registration procedure first to establish a secure NAS connection
between UE and AMF). It is up to CT WG1 to decide whether a new NAS message
needs to be defined, NAS transport message is extended or service request is
extended to transport SM data transfer message.
\- Supported PDU session types:
\- Small data transfer supports IP and unstructured data.
\- Integrity protection, ciphering and header compression:
\- Integrity protection and ciphering for small data are performed by AMF
(existing NAS PDU integrity protection and ciphering functionality are re-used
as is).
\- UE and SMF may perform header compression for IP data.
\- AMF selection:
NOTE 3: AMF selection is part of Key Issue 15 (Core Network selection for
Cellular IoT) and the selected solution for Key Issue 15 is used.- SMF
selection.
\- During the PDU session establishment procedure the AMF takes the UE request
into account to select an SMF that supports Data Transfer over NAS-SM.
\- PDU Session Anchor (NEF or UPF) Selection:
\- When the PDU Session is established, as described in clause 6.1.4.1, PDU
Session Anchor (NEF or UPF) selection is performed in step 5 as follows:
\- If the PDU Session type is unstructured, the SMF uses the DNN and/or the
S-NSSAI to check the UE\'s subscription. The UE\'s subscription may include an
\"Invoke NEF Selection\" flag for the DNN/S-NSSAI combination.
\- When the \"Invoke NEF Selection\" flag is present, the subscription
information will also include the NEF Identity that should be used to anchor
the PDU Session.
\- When the \"Invoke NEF Selection\" flag is not present, the SMF will perform
UPF selection to select a UPF to anchor the PDU Session as described in
Solution 1.
\- Further details on the support of APIs for infrequent small data
transmission are described in Solution 30.
\- Releasing the UE based on Release Assistance Indication provided by the UE.
Two options have been discussed:
\- Option 1 (Release Assistance Indication in NAS-MM - NAS RAI):
\- The UE sends the NAS Release Assistance Indication (NAS RAI) to the AMF
inside the NAS PDU, i.e. outside the SM data transfer message embedded in the
NAS PDU.
\- The AMF handles the NAS RAI as follows:
\- if the NAS RAI indicates that no further uplink or downlink data
transmissions are expected and unless the AMF is aware of other pending MT
traffic, the AMF requests NG-RAN to release the UE context;
\- if the NAS RAI indicates that only a single downlink data transmission
subsequent to this uplink data transmission is expected, then the AMF requests
NG-RAN to release the UE context once the AMF has forwarded the next downlink
NAS transport message with container type \"SM data transfer\" to the UE
unless the AMF is aware of other pending MT traffic.
\- Option 2 (Release Assistance Indication in AS - AS RAI plus N2 RAI):
\- The UE sends AS Release Assistance Indication (AS RAI) to the NG-RAN. The
AS RAI indicates whether no further uplink/downlink transmissions or only a
single downlink transmission is expected.
NOTE 4: This differs from the AS RAI defined in Rel-14 EPS (see TS 36.321
[27], TS 36.331 [23]).
\- When NG-RAN receives the AS RAI from the UE, NG-RAN shall maintain the
UE\'s RRC connection in case RRC connection establishment procedure was
executed, and include an N2 RAI indication (no further uplink/downlink
transmissions or only a single downlink transmission) in the Initial UE
message, in the next Uplink NAS transport message or in an RAI specific NGAP
indication;
\- The AMF evaluates the N2 RAI as follows:
\- If the N2 RAI indicates no further uplink/downlink transmissions and the
AMF is not aware of any pending DL data for the UE (e.g. a pending SMS or
pending DL data buffered e.g. in SMF/UPF as part of extended buffering), the
AMF sends the N2 UE Context Release Command to NG-RAN as per the AN Release
procedure (TS 23.502 [7], clause 4.2.6).
\- If the N2 RAI indicates only a single downlink transmission is expected,
the AMF sends the N2 UE Context Release Command to NG-RAN as per the AN
Release procedure (TS 23.502 [7], clause 4.2.6) once the AMF has forwarded the
next downlink NAS transport message with container type \"SM data transfer\"
to the UE and unless the AMF is aware of other pending MT traffic.
NOTE 5: The Release Assistance Indication in AS can also support UP-based data
delivery. In this case the RAN is expected to send the N2 UE Context Release
Request including the N2 RAI to the AMF. The AMF sends the N2 UE Context
Release Command to NG-RAN unless the AMF is aware of other pending MT traffic.
The RAN releases the UE once it has received the N2 UE Context Release Command
from the AMF and once an outstanding UP downlink transmission has been
received (if applicable).
The UE may choose which option to use, allowing it to take advantage of the
different optimisation that each option brings and how the UL traffic the RAI
is associated with is being transferred. The UE should not use NAS RAI when
the last UL traffic is via DRBs or data via AMF is not being used as in these
cases any efficiencies will be lost. The UE may use AS RAI at any time.
NOTE 6: The details of Option 2 are to be defined by RAN WGs.
NOTE 7: The AS RAI and related N2 RAI apply only to Higher Layer PDUs (i.e.
NAS PDU, NAS Signalling, UP Data, but not RLC signalling).
NOTE 8: See Solution 30 for further details on NEF based data transfer.
\- Early Data Transmission may be initiated by the UE for mobile originated
small data over NAS-SM.
### 6.1.3 Support of EPC interworking
EPC interworking for small data transfer via NAS-SM uses the architecture for
EPC-5GC interworking with N26 as specified in TS 23.501 [5] clauses 4.3.1 and
4.3.2 as a baseline.
The following principles apply:
\- Idle-mode mobility from 5GS to EPS is performed as per the procedure
described in TS 23.502 [7] clause 4.11.1.3.2 with the following differences:
\- Step 5b: When the SMF returns the mapped EPS bearer contexts to the AMF the
SMF sets the Control Plane Only PDN Connection Indication for Data over NAS-SM
PDU sessions.
\- Idle-mode mobility from to EPS to 5GS is performed as per the procedure
described in TS 23.502 [7] clause 4.11.1.3.3 with the following differences:
\- AMF indicates support of CIoT Optimizations when requesting the UE context
from the MME via N26;
\- for a PDN connection for which Control Plane Only PDN Connection Indication
is set,
\- in case of home-routed roaming,
\- Step 14: the AMF selects a V-SMF supporting small data over NAS-SM;
\- Step 14: the V-SMF configures the UPF for data transfer via N4;
\- When the \"Invoke NEF Selection\" flag is present in the UE\'s subscription
information for the PDU Session, the identified NEF will point to an SCEF+NEF
if EPC Interworking is supported.
\- When the \"Invoke NEF Selection\" flag is not present in the UE\'s
subscription information for the PDU Session, the identified SMF will select a
PGW+UPF as the PDU Session anchor.
### 6.1.4 Procedures
#### 6.1.4.0 General
This clause describes the procedures for the case where the PDU Session is
terminated at a UPF. Refer to Solution 30 for the case where the PDU session
anchor is an NEF.
#### 6.1.4.1 PDU Session Establishment
This procedure takes the PDU Session Establishment procedure as described in
TS 23.502 [7], clause 4.3.2.2.1 as the baseline.
Figure 6.1.4.2-1: PDU Session Establishment enabling Data over NAS-SM
1\. The UE sends a PDU session establishment request message as SM payload of
a NAS transport message. The NAS transport message contains PDU session ID
along with other regular information e.g. DNN, S-NSSAI, etc. if applicable.
2\. The AMF determines if the PDU Session uses NAS-SM to transfer PDUs. If the
PDU Session will use NAS-SM to transfer PDUs, the AMF selects an SMF that
supports Data over NAS-SM if available for the requested DNN, and S-NSSAI. The
AMF stores the association of the PDU Session ID and the selected SMF ID in
the UE context. The network chooses to transfer data to the DN via N6.
NOTE 1: How the AMF determines if the PDU Session uses NAS-SM to transfer PDUs
will be determined as part of the Key Issue 15 conclusion.
NOTE 2: As captured in clause 4, it is assumed that the exposure of network
capabilities towards the SCS/AS is done via NEF. In addition, as captured in
clause 8.9, _when a UE is capable of switching between EPC and 5GC, it shall
only be associated with combined SCEF+NEF node(s) for Service Capability
Exposure._ Consequently, data towards SCS/AS can be routed via a NEF+SCEF
combined node. See also Solution 30.
3\. The AMF invokes Nsmf_PDUSession_CreateSMContext request including DNN,
S-NSSAI and PDU Session ID. The AMF also indicates to the SMF if the PDU
Session uses NAS-SM to transfer PDUs. The SMF replies with an
Nsmf_PDUSession_CreateSMContext Response.
4\. The SMF may perform a Session Management Policy Establishment procedure.
5\. The SMF selects a UPF.
6\. The SMF configures the UPF for data transfer via N4.
7\. The SMF sends a PDU Session Establishment Accept providing indication that
Data Over NAS-SM is enabled for this PDU session without including the N2 SM
container.
8\. The AMF forwards the NAS message to the UE.
#### 6.1.4.2 Mobile Originated Data Transport via NAS-SM and N6
Figure 6.1.4.2-1: Mobile Originated Data Transport via NAS-SM
0\. The UE is in CM-IDLE.
1\. The UE establishes an RRC connection or sends the RRCEarlyDataRequest
message and sends a NAS PDU as part of this. The NAS PDU carries encrypted
uplink data as payload of an SM data transfer message and a PDU session ID.
2\. NG-RAN forwards the NAS PDU to the AMF. If RRCEarlyDataRequest message was
received in step 1, the NG-RAN includes \"EDT Session\" indication in the N2
Initial UE message. For Option 2, the NG-RAN further indicates request to
release RRC connection in N2 Initial UE message.
3\. AMF checks the integrity of the incoming NAS PDU and decrypts the data it
contains.
3a. If the AMF received \"EDT Session\" indication from the NG-RAN in step 2,
the AMF sends an N2 message to the NG-RAN.
a) If the Release Assistance Information was received from UE in Option 1 with
Uplink data and it indicated that Downlink data was not expected or if the AMF
received a request to release RRC connection in N2 Initial UE message for
Option 2, and the AMF does not expect any other signalling with the UE, the
AMF should:
\- either send a NAS service accept in the N2 Downlink NAS message and include
End Indication to indicate that no further data or signalling is expected with
the UE; or,
\- alternatively, instead of a NAS service accept, the AMF sends an N2
Connection Establishment Indication message including End Indication to
indicate that no further data or signalling is expected with the UE.
b) If the AMF determines more data or signalling may be pending, the AMF sends
an N2 connection establishment indication message without End Indication.
3b. In case 3a was executed, the NG-RAN completes the RRC early data procedure
as follows.
a) For the case of 3a.a) the NG-RAN proceeds with RRCEarlyDataComplete
message. The procedure is completed in Step 5.
b) For the case of 3a.b) the NG-RAN proceeds with RRC connection establishment
procedure. In that case all steps up to step 12 apply,
4\. AMF forwards the data to the (V-)SMF handling the PDU session identified
by the PDU session ID contained in the NAS transport message.
NOTE 1: Whether a new or an existing service operation of SMF should be
invoked in this step is to be decided during normative phase.
5\. The (V-)SMF decompresses the header if header compression applies to the
PDU session. The V-SMF forwards the data to the UPF. (In the home-routed
roaming case, the UPF may forward the data to a different UPF in the HPLMN via
N9.) The UPF forwards the data to the DN, In case of unstructured data,
tunneling may be applied according to clause 5.6.10.3 in TS 23.501 [5].
6\. [Conditional] The UPF forwards available downlink data to the (V-)SMF,
7\. [Conditional] The (V-)SMF compresses the header if header compression
applies to the PDU session and encapsulates the downlink data as payload in an
SM data transfer message. The (V-)SMF forwards the SM data transfer message
and the PDU session ID to the AMF using the
Namf_Communication_N1N2MessageTransfer service operation.
8\. [Conditional] The AMF creates a DL NAS transport message with the received
PDU session ID and the SM data transfer message (container type is set to SM
data transfer). The AMF ciphers and integrity protects the NAS transport
message.
9\. [Conditional] The AMF sends the DL NAS transport message to NG-RAN.
10\. [Conditional] NG-RAN delivers the NAS payload over RRC to the UE.
11\. [Conditional] If no further NAS PDU activity is detected by NG-RAN, then
NG-RAN triggers the AN release procedure.
12\. The UE\'s logical NG-AP signaling connection and RRC signaling connection
are released as per TS 23.502 [7] clause 4.2.6.
NOTE 2: How the UE is released based on Release Assistance Information is
covered in clause 6.1.2.
NOTE 3: The details of the NGAP messages to be used for this procedure are to
be decided by RAN WG3.
#### 6.1.4.3 Mobile Terminated Data Transport via NAS-SM and N6
Figure 6.1.4.3-1: Mobile Terminated Data Transport via NAS-SM
1\. The UPF forwards a downlink data packet to the SMF.
2\. The (V-)SMF compresses the header if header compression applies to the PDU
session and encapsulates the downlink data as payload in an SM data transfer
message. The (V-)SMF forwards the SM data transfer message and the PDU session
ID to the AMF using the Namf_Communication_N1N2MessageTransfer service
operation.
3\. [Conditional] If the UE is in CM Idle, the AMF sends a paging message to
NG-RAN.
4\. [Conditional] If NG-RAN received a paging message from AMF, NG-RAN perform
paging.
5\. [Conditional ] If the UE receives paging message, it responds with service
request.
7\. The AMF creates a DL NAS transport message with the received PDU session
ID and the SM data transfer message (container type is set to SM data
transfer). The AMF ciphers and integrity protects the NAS transport message.
8\. The AMF sends the DL NAS transport message to NG-RAN.
9\. NG-RAN delivers the NAS payload over RRC to the UE.
10\. While the RRC connection is established further uplink and downlink data
can be exchanged. In order to send uplink data, the UE sends an integrity
protected NAS PDU as RRC uplink data. The NAS PDU carries encrypted uplink
data as payload of an SM data transfer message and a PDU session ID.
11\. NG-RAN forwards the NAS PDU to the AMF.
12\. AMF checks the integrity of the incoming NAS PDU and decrypts the data it
contains.
13\. AMF forwards the data to the (V-)SMF handling the PDU session identified
by the PDU session ID contained in the NAS transport message.
NOTE 1: Whether a new or an existing service operation of SMF should be
invoked in this step is to be decided during normative phase.
14\. The (V-)SMF decompresses the header if header compression applies to the
PDU session. The V-SMF forwards the data to the UPF. (In the home-routed
roaming case, the UPF may forward the data to a different UPF in the HPLMN via
N9.) The UPF forwards the data to the DN, In case of unstructured data,
tunneling may be applied according to clause 5.6.10.3 in TS 23.501 [5].
15\. [Conditional] If no further NAS PDU activity is detected by NG-RAN, then
NG-RAN triggers the AN release procedure.
16\. The UE\'s logical NG-AP signaling connection and RRC signaling connection
are released according to TS 23.502 [7] clause 4.2.6.
NOTE 2: How the UE is released based on Release Assistance Information is
covered in clause 6.1.2.
NOTE 3: The details of the NGAP messages to be used for this procedure are to
be decided by RAN WG3.
### 6.1.5 Impacts on existing entities and interfaces
AMF:
\- Support of new payload container type for SM data transfer.
\- Support for initial NAS transport message with the SM data transfer message
as payload.
\- Support for selecting SMF capable of Data over NAS.
\- Support of release assistance indication handling.
SMF:
\- Supports and Sending and Receiving PDUs via NAS-SM.
\- Support of new payload container type and SM data transfer message.
\- Header compression for IP data.
\- Receives the \"Invoke NEF Selection\" and \"NEF ID\" during PDU Session
Establishment.
\- Support for a N4-like services on the N29 interface with the NEF for
Unstructured PDU Session.
\- Supports exchange of Small Data PDUs with the UPF on the N4 interface.
UPF:
\- Support for extended buffering.
\- Supports exchange of Small Data PDUs with the SMF on the N4 interface.
UE:
\- Supports and Sending and Receiving PDUs via NAS-SM.
\- Support of new payload container type and SM data transfer message.
\- Support for initial NAS transport message with the SM data transfer message
as payload.
\- Support of release assistance indication handling.
UDM/UDR:
\- Support for the NIDD Configuration, MT NIDD, and MO NIDD APIs as described
in TS 29.122 [9] and TS 23.682 [6].
\- Support for the authorisation during the NIDD Configuration procedure.
NG-RAN:
\- Release Assistance Indication in AS (if chosen as the way forward).
### 6.1.6 Evaluation
This solution proposes to convey small data inside NAS-SM between UE and SMF
for PDU session types IPv4, IPv6 and unstructured. The AMF transparently
forwards small data inside NAS-SM between UE and SMF. Integrity protection and
ciphering for small data are performed by AMF, and the UE and SMF may perform
header compression for IP data. This solution supports also infrequent data
transfer via API(s)/NEF (see clause 6.30 - in particular conclusions in clause
6.30.6 - for more details). Solution 1 supports early data and reuses EPC
interworking as defined in Rel-15, i.e. relies on mapping PDU sessions to PDN
connections.
Pros:
\- No need to establish user plane PDU session to transfer data.
\- UE\'s application functionality are not affected.
\- Limited or no impact on RAN (depending on RAI conclusions).
\- Easy interworking with EPC based CIoT. Solution 1 follows the same concept
as EPS CP optimization. This enables low complexity IoT devices that support
both EPC and 5GC connectivity to send small data over NAS (i.e. without having
to support a user-plane stack, AS security, etc.) regardless of the core
network those devices are connected to.
Cons:
\- The solution(s) for Overload Control for small data (see KI 7 and related
solutions) are required to help manage any additional load on the AMF and/or
SMF.
\- Impact on AMF and SMF to transfer small data.
\- Whether to send the existing SM header or a shortened SM header with the
small data is up to CT WG1.
This solution successfully addresses Key Issues 1 (Support for infrequent
small data transmission).
## 6.2 Solution 2: Infrequent small data transfer through NAS and a direct
interface between AMF and UPF
### 6.2.1 Introduction
This solution applies to Key Issue 1 - Support for infrequent small data
transmission.
### 6.2.2 Functional Description
This solution introduces a user plane interface between AMF and UPF. We call
it Nx interface here which is a user plane tunnel. Packets are transferred
from UE to AMF through NAS and from AMF to UPF through the Nx tunnel. To
support NIDD, packets can be transferred from UE to AMF through NAS and from
AMF to NEF. It\'s shown in the Figure 6.2.2-1.
Figure 6.2.2-1: Architecture for infrequent small data transfer through NAS
and a direct interface between AMF and UPF
The assumption is UE has registered with network and has negotiated with the
network of control plane small data transfer capabilities.
During the UE requested PDU session establishment procedure, a session level
Nx user plane tunnel is established between AMF and UPF. N11and N4 signalling
is used to control the Nx tunnel setup. E.g. exchanges the tunnel info between
AMF and UPF.
For MO data transfer, When AMF receives the NAS data PDU including the PDU
session ID from UE, AMF identifies the related Nx tunnel based on the PDU
session ID and transfers the received data PDU to UPF through the Nx tunnel.
The UPF forwards the data to the DN. If the Nx tunnel is not established,
N11and N4 signalling is used to control the Nx tunnel setup.
For MT data, after receiving DL data from DN, UPF buffers the DL data and
sends Data Notification to SMF, and SMF sends the Data Notification to AMF.
AMF paging UE in case the UE is in CM-IDLE state. Upon reception of paging
indication, the UE sends a UE triggered Service Request NAS message to AMF,
the Nx tunnel is established after the N11 and N4 signalling interaction. UPF
forwards the DL data to AMF through the Nx tunnel. AMF sends the DL data as
NAS data PDU to UE.
For IP data, the UE and AMF may perform header compression. For uplink IP
data, UE implements the compressor, and AMF implements the decompressor. For
downlink IP data, AMF implements the compressor, and UE implements the
decompressor. The header compression is supported at AMF. The NAS data PDU is
sent using NAS MM message.
For NIDD support, AMF determines whether or not the NIDD via NEF shall be used
for a PDU session based on subscription information and the DNN/S-NSSAI
received from UE. The subscription information includes NEF ID for the
DNN/S-NSSAI. To setup the Session between AMF and NEF, AMF sends NEF id, the
C-Plane address of AMF and the Create NEF Session Request to SMF, SMF forwards
the received information to NEF and gets the Create NEF Session Response and
the NEF C-Plane address. SMF provides the Create NEF Session Response and the
NEF C-Plane address to AMF, thus the Session between AMF and NEF are setup.
NEF supports infrequent small data transmission and capability exposure to AF
is similar to the SCEF as described in TS 23.682 [6]
### 6.2.3 Support of EPC interworking
The existing EPS-5GS interworking principles are used with the differences
that the UE should support for small data over NAS in both in 4G and 5G
network. Idle-mode mobility from 5GS to EPS and Idle-mode mobility from to EPS
to 5GS are supported as the procedures described in TS 23.502 [7], clause
4.11.1.3.
### 6.2.4 Procedures
### 6.2.4.1 Nx tunnel setup
The Nx tunnel is setup during the PDU session establishment procedure. Figure
6.2.4.1-1 depicts how to setup an Nx tunnel between AMF and UPF.
Figure 6.2.4.1-1: Nx tunnel setup
1\. The PDU Session Establishment Request NAS message is received from UE.
2\. If this PDU Session is used for control plane small data transfer and AMF
decides to setup Nx tunnel for the data transfer between AMF and UPF, AMF
allocates the its Nx tunnel info used for DL data forwarding from UPF. AMF
includes its Nx tunnel info in the Nsmf_PDUSession_CreateSMContext Request
from AMF to SMF.
3\. The Nsmf_PDUSession_CreateSMContext Response is provided from SMF to AMF.
4\. The SMF sends an N4 Session Establishment Request to the UPF including the
Nx tunnel info of AMF. If the Nx Tunnel Info of UPF is allocated by the SMF,
the Nx Tunnel Info of UPF is provided to UPF in this step.
5\. The UPF acknowledges by sending an N4 Session Establishment Response. If
UPF is responsible for allocating its Nx Tunnel Info, the Nx Tunnel Info of
UPF is provided to SMF in this step.
6\. SMF sends the Nx Tunnel Info of UPF to AMF using the
Namf_Communication_N1N2MessageTransfer operation. The Nx tunnel is setup
between AMF and UPF. PDU Session Establishment Accept message is carried in
the N1 SM container.
7\. The PDU Session Establishment Accept NAS message is sent to UE.
### 6.2.4.2 Nx tunnel release
The Nx tunnel could be released during the AN release procedure as depicted in
Figure 6.2.4.2-1 or during the CN-initiated selective deactivation of UP
connection of an existing PDU Session procedure as depicted in Figure
6.2.4.2-2.
Figure 6.2.4.2-1: Nx tunnel release due to AN release
1\. AMF may decide to perform AN release based on local reason or the request
received from AN. the AMF sends an N2 UE Context Release Command to the (R)AN.
2\. If the (R)AN connection with the UE is not already released, the (R)AN
requests the UE to release the (R)AN connection.
3\. The (R)AN confirms the N2 Release by returning an N2 UE Context Release
Complete message to the AMF. The N2 signalling connection between the AMF and
the (R)AN for that UE is released.
4\. If there are active Nx tunnels between AMF and UPF for the UE, for each
active Nx tunnel, the AMF invokes Nsmf_PDUSession_UpdateSMContext Request to
deactivate the Nx tunnel for the PDU Session.
5\. SMF sends the N4 Session Modification Request to UPF to remove the Nx
tunnel info.
6\. UPF sends the N4 Session Modification Response acknowledging the SMF
request.
7\. SMF sends Nsmf_PDUSession_UpdateSMContext Ack to AMF to confirm the Nx
tunnel is released.
Figure 6.2.4.2-2: Nx tunnel release due to selective PDU session deactivation
1\. When SMF determines to deactivate a PDU session and the PDU Session is
used for control plane small data transfer, the SMF sends N4 Session
Modification Request to remove the Nx tunnel of the corresponding PDU Session.
2\. UPF sends the N4 Session Modification Response acknowledging the SMF
request.
3\. The SMF invokes the Namf_Communication_N1N2MessageTransfer service
operation to indicate AMF to release the Nx tunnel. AMF removes the related Nx
tunnel info.
4\. The AMF invokes the Nsmf_PDUSession_UpdateSMContext service operation to
acknowledge the Namf service received in step 3.
### 6.2.4.3 MO data transport
Figure 6.2.4.3-1: MO data transfer
1\. UE transfers the data to AMF as the NAS data PDU. The PDU session ID is
included in the NAS data PDU.
2\. When AMF receives the NAS data PDU including the PDU session ID from UE,
The AMF decompresses the IP header if header compression applies to the PDU
session. AMF identifies the related Nx tunnel based on the PDU session ID. If
the Nx tunnel is not established, AMF includes its Nx tunnel info in the
Nsmf_PDUSession_UpdateSMContext from AMF to SMF.
3\. The SMF sends the Nx tunnel info of AMF to UPF, and the Nx tunnel info of
UPF is determined at this step.
4\. SMF sends the Nx Tunnel Info of UPF to AMF. The Nx tunnel is setup between
AMF and UPF.
5\. AMF transfers the received data PDU to UPF through the Nx tunnel. The UPF
forwards the data to the DN.
### 6.2.4.4 MT data transport
Figure 6.2.4.4-1: MT data transfer
1\. When UPF receives downlink data of a PDU session, and the Nx tunnel is not
established, the UPF buffers the downlink data. UPF sends Data Notification
message to the SMF.
2\. The SMF invokes the Namf_Communication_N1N2MessageTransfer to the AMF.
3\. If the UE is in CM-IDLE state, AMF performs paging for the UE.
4\. Upon reception of paging indication, the UE sends a UE triggered Service
Request NAS message to AMF.
5\. AMF includes its Nx tunnel info in the Nsmf_PDUSession_UpdateSMContext
from AMF to SMF.
6\. The SMF sends the Nx tunnel info of AMF to UPF, and the Nx tunnel info of
UPF is determined at this step.
7\. SMF sends the Nx Tunnel Info of UPF to AMF. The Nx tunnel is setup between
AMF and UPF.
8\. UPF forwards the downlink data to the AMF through the Nx tunnel.
9\. The AMF compresses the header if header compression applies to the PDU
session and encapsulates the downlink data into the NAS message. AMF sends the
DL data as NAS data PDU to UE over NAS signalling.
### 6.2.4.5 NIDD support
The procedure for PDU Session Establishment enabling Data over NAS and NEF is
as following:
Figure 6.2.4.5-1: PDU Session Establishment enabling Data over NAS and NEF
1\. The PDU Session Establishment Request is carried in a NAS message. The
session ID and DNN, S-NSSAI, etc. if applicable are also contained in this NAS
message.
2\. If this PDU Session is used for control plane small data transfer, and the
subscription information includes NEF ID for the corresponding DNN/S-NSSAI,
the AMF determines to setup the connection between AMF and NEF, AMF includes
NEF id, the C-Plane address of AMF and the Create NEF Session Request (the UE
ID, session ID and DNN, S-NSSAI, etc.) with the N1 SM container (PDU Session
Establishment Request) in the Nsmf_PDUSession_CreateSMContext Request from AMF
to SMF.
3\. The SMF replies with an Nsmf_PDUSession_CreateSMContext Response.
4\. The SMF sends the connection setup request to NEF including the NEF id,
the C-Plane address of AMF and the Create NEF Session Request (the UE ID,
session ID and DNN, S-NSSAI, etc.). The rate control information may also be
included in this message based on the SMF local configuration or interaction
with PCF.
5\. If an SCS/AS has performed the NIDD Configuration procedure (similar
procedure as described in TS 23.682 [6] clause 5.13) , the NEF associates the
NIDD connection with the PDU Session. Otherwise, the NEF rejects the
procedure. NEF provides connection setup response to SMF including the C-Plane
address of NEF and the Create NEF Session Response.
6\. The SMF sends the Namf_Communication_N1N2MessageTransfer to AMF including
PDU Session Establishment Accept message and the received C-Plane address of
NEF and the Create NEF Session Response.
7\. After receiving the C-Plane address of NEF and the Create NEF Session
Response, the connection between AMF and NEF are setup. The PDU Session
Establishment Accept NAS message is sent to UE.
### 6.2.5 Impacts on existing entities and interfaces
The following nodes are impacted:
AMF:
\- support the user plane Nx tunnel between AMF and UPF including Nx tunnel
info allocation.
\- support the header compression function.
SMF:
\- support the the Nx tunnel info transfer between AMF and UPF.
### 6.2.6 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.3 Solution 3: Infrequent small data transmission with no PDU session
available
### 6.3.1 Introduction
This solution applies to address the Key Issue 1: Support for infrequent small
data transmission.
The solution assumes that the UE does not establish a PDU session before
sending small data packet and addresses. This solution is only used for non-IP
data delivery.
### 6.3.2 Functional Description
Editor\'s note: This clause outlines solution principles and documents any
assumptions made.
The infrequent small data transmission procedure for a scenario where the user
data is forwarded to application server via control plane is illustrated in
Figure 6.4-1.
### 6.3.3 Support of EPC interworking
Editor\'s note: This clause describes if and how EPC-5GC interworking is
supported by this solution.
The solution 3 does not support EPC-5GC interworking. This solution is only
used for the UEs which only support 5GC-NAS.
### 6.3.4 Procedures
#### 6.3.4.1 Registration Procedure
During the Registration procedure, the AMF determines whether the user data
are allowed to be delivered without PDU session.
Figure 6.3.4.1-1: Small data transmission procedure
1\. The UE provides Non Session Data Delivery (NSDD) indication in the
Registration Request message. The UE provides NSDD indication only for non IP
data delivery.
2\. Authentication/Security procedure is performed.
3\. The AMF retrieves the UE subscription from the UDM; the UE subscription
data may indicate whether the NSDD is allowed or not for the UE; The AMF
determines whether the NSDD is activated for the UE according to UE
subscription;
4\. The AMF request NEF (as described in sub-clause 6.4.2) or SMF to create
NSDD context for the UE, which may include UE ID, AMF ID, DNN etc.; The RDS
Configuration procedure as described in sub-clause 6.4.4.2 between NEF and
AF/AS may also be performed.
If the NSDD Context is established at the SMF, the SMF selects UPF and
initiates N4 session establishment procedure; the UPF establishes a point-to-
point tunnelling via the N6 between the UPF and the SCS/AS The tunnel
parameters are determined based on pre-configuration and/or the NSDD context.
If the NSDD Context is established at the NEF, the NEF determines what SCS/AS
is associated with the context based on the user identity and the DDN.
5\. The AMF indicates the UE that NSDD is activated in Registration Accept
message.
#### 6.3.4.2 MO NSDD procedure
If the NSDD is activated, the UE may send small data via NAS without PDU
session establishment.
Figure 6.3.4-1: MO NSDD
0\. The UE was in CM-IDLE state.
1\. The UE transmits the NAS Data PDU to the AMF.
2\. The AMF checks the integrity of the incoming NAS PDU and decrypts the user
data it contains.
If the NSDD Context is established at SMF, step 3 to step 6 are performed. If
the NSDD Context is established at NEF then MO delivery mechanism described in
sub-clause 6.4.4.3 is used and step 3 to step 6 are skipped.
3\. The AMF determines the SMF based on the NSDD context for the UE and
forwards the user data to the SMF with the UE identity via N11 message.
4\. The SMF determines the corresponding N4 session for the user data based on
the UE identity received in step 3, then the SMF forwards the user data to the
UPF via N4 message.
5\. The UPF receives the DL user data and forwards the user data to the SMF
based on the local association information between N4 session and point-to-
point tunnelling in N6.
6\. The SMF receives the DL user data and forwards the user data to the AMF
based on the local association information between the N4 session and NSDD
context.
7\. If downlink data is received, the AMF encrypts and integrity protects the
NAS transport message with downlink user data.
8\. The AMF transmits the DL NAS Data PDU to the UE.
#### 6.3.4.3 MT Small data transmission procedure
Figure 6.3.4.3-1: MT NSDD procedure
If the NSDD Context is established at SMF, step 1 to step 3 are performed; if
the NSDD Context is established at NEF, the MT delivery mechanism described in
clause 6.4.4.4 is used and step 1, step 2 are skipped.
1\. Upon receiving DL data from the N6 tunnel, the UPF forwards the DL data to
the SMF;
2\. The SMF forwards the user data to the AMF with the UE identity via N11
message.
3\. The AMF forwards the user data container to the UE via NAS message.
### 6.3.5 Impacts on existing entities and interfaces
UE:
\- Non Session Data Delivery negotiation with the AMF during the Registration
procedure;
\- Support sending/receiving small data via NAS message without PDU session
available.
AMF:
\- Establish NSDD context with SMF/NEF for the UE if NSDD is enabled;
\- Forwarding small data between the SMF/NEF and the UE.
SMF:
\- Establish NSDD context and corresponding N4 session;
\- Forwarding small data between the UPF and AMF.
NEF:
\- Establish NSDD context with AMF;
\- Forwarding small data between the SCS/AS and AMF.
### 6.3.6 Evaluation
The solution proposes the small data are delivered via NAS message without
available PDU sessions. The proposed NSDD procedure is based on the same
principles as the PDN Connection to the SCEF in EPC and addresses the NSDD
context is established in the core network for small data delivery and the UE
sends/receives small data via NAS message to/from the AMF without PDU session
establishment procedure.
In this solution, 5GC stores NSDD context for the small data delivery. There
is not any PDU session context stored in the UE side and there is no PDU
session establishment procedure performed by the UE, therefore, this solution
can save the storage and power for the CIoT equipment.
## 6.4 Solution 4: Reliable Data Service Support
### 6.4.1 Introduction
This solution addresses the Key Issue 1 - \"Support for infrequent small data
transmission\" and Key Issue 8 - \"Support of the Reliable Data Service\".
### 6.4.2 Functional Description
#### 6.4.2.1 Support of Reliable Data Service
The Reliable Data Service is used by the UE and NEF for reliable small data
delivery of unstructured PDU. The service provides a mechanism for the NEF to
determine if the data was successfully delivered to the UE and for UE to
determine if the data was successfully delivered to the NEF. When a requested
acknowledgement is not received, the Reliable Data Service retransmits the
packet. Support for Reliable Data Service (RDS) incurs the following
functionality:
\- Use of NAS transport between UE and AMF for small data delivery. This
applies to both 3GPP and non-3GPP accesses.
\- Support for AMF determining the NEF for a given UE.
\- Support for subscription checking and actual transmission of MO/MT small
data delivery by the NEF to the AF/UE.
\- Support for MO/MT small data delivery for both roaming and non-roaming
scenarios.
\- Support for unstructured PDU.
\- Support for API exposure for Reliable Data Service towards 3rd party
application provider.
During registration procedure, a UE that wants to use RDS provides \"RDS
supported\" indication over NAS signalling indicating the UE\'s capability for
support of RDS. \"RDS supported\" indication indicates whether UE can support
reliable small data delivery over NAS via 3GPP access or via both 3GPP and
non-3GPP access. If the core network supports RDS functionality, the AMF
includes \"RDS supported\" indication to the UE, and whether RDS delivery over
NAS via 3GPP access or via both the 3GPP and non-3GPP access is accepted by
the network.
RDS packets are transmitted over NAS without the need to establish data radio
bearers, via NAS transport message, which can carry RDS payload. PDU session
establishment is not needed. UE and Network supports RDS protocol as specified
in TS 24.250 [8]. When the RDS is enabled, a protocol is used between the end-
points, i.e. between UE and NEF. The protocol uses a RDS header to identify if
the packet requires no acknowledgement, requires an acknowledgement, or is an
acknowledgment and to allow detection and elimination of duplicate PDUs at the
receiving endpoint. Also Port Numbers in the header are used to identify the
application on the originator and to identify the application on the receiver.
This solution supports RDS over unstructured PDU only.
#### 6.4.2.2 Architecture to support RDS over 5GC
Figure 6.4.2.2-1 shows the non-roaming architecture to support RDS using the
Service-based interfaces within the Control Plane.
Figure 6.4.2.2-1: Non-roaming System Architecture for RDS
Figure 6.4.2.2-2 shows the non-roaming architecture to support RDS using the
reference point representation.
Figure 6.4.2.2-2: Non-roaming System Architecture for RDS in reference point
representation
Figure 6.4.2.2-3 shows the roaming architecture (Home Routed scenario) to
support RDS using the Service-based interfaces within the Control Plane.
{width="4.670138888888889in" height="1.9180555555555556in"}
Figure 6.4.2.2-3: Roaming architecture for RDS over NAS - Home Routed scenario
in service-based interface representation
Figure 6.4.2.2-4 shows the roaming architecture for NEF using the reference
point representation.
{width="3.701388888888889in" height="2.7916666666666665in"}
Figure 6.4.2.2-4: Roaming architecture for NEF in reference point
representation
NOTE 1: For the sake of clarity, SEPPs are not depicted in the roaming figures
6.4.2.2-3, and 6.4.2.2-4.
NOTE 2: IWK-NEF is located in the VPLMN for inter-connection with the NEF of
the HPLMN. IWK-NEF (similar to IWK-SCEF in EPC) relays data between AMF in
VPLMN to NEF in HPLMN for home routed scenario.
### 6.4.3 Support of EPC interworking
The principles of Solution 13 are followed for interworking with EPC. The
S-NSSAI and DNN are used to determine if the Reliable Data Service is used.
When interworking with EPC is required, the RDS endpoint is an SCEF+NEF. When
the UE moves between EPC and 5GC, RDS state is recreated. When the UE moves
from EPC to 5GC and PDN Connections with RDS are active, the PDN connections
are released by the UE and the UE will configure the RDS between the UE and
NEF as described in the Registration Procedure in clause 6.4.2.1. In EPC, RDS
state is maintained for the lifetime of the PDN Connection to the SCEF. In
5GC, RDS state is maintained for the lifetime of the UE Registration or NIDD
Configuration.
When RDS PDUs are sent via NAS,Serving PLMN rate control will apply. Since RDS
PDUs are not sent over a connection, APN rate control need not apply.
### 6.4.4 Procedures
#### 6.4.4.1 Registration procedure supporting reliable small data delivery
over NAS
{width="5.508333333333334in" height="5.688194444444444in"}
Figure 6.4.4.1-1: Registration procedure supporting reliable small data
delivery over NAS
1\. During Registration procedure in 5GS defined in Figure 4.2.2.2.2-1 of TS
23.502 [7], to enable reliable small data delivery, the UE includes an \"RDS
supported\" indication in Registration Request in step 1-3 indicating the
UE\'s capability for RDS. The \"RDS supported\" indication indicates whether
the UE supports reliable small data delivery over NAS via current access.
2\. Step 4 to step 14 of the Registration procedure in Figure 4.2.2.2.2-1 if
TS 23.502 [7] are performed. When AMF relocation happens during the
Registration procedure, the old AMF transfers NEF address to the new AMF as
part of UE context in step 5 of Figure 4.2.2.2.2-1.
3\. If the \"RDS supported\" indication is included in the Registration
Request, the AMF checks subscription from the UDM for the UE on whether the
RDS service is allowed to the UE. If yes and the UE context doesn\'t include
an available NEF of the serving PLMN, the AMF discovers and selects an NEF to
serve the UE. The NEF discovery is based on the following methods:
\- NEF address preconfigured in the AMF (i.e. NEF FQDN); or
\- NEF address received from the UDM; or
\- The AMF invokes Nnrf_NFDiscovery service operation from NRF to discover the
NEF address as described in clause 5.2.7.3.2 of TS 23.502 [7].
For roaming scenario, the AMF discovers and selects an NEF in VPLMN.
4\. Step 15 to step 20 of the Registration procedure in Figure 4.2.2.2.2-1 of
TS 23.502 [7] are performed.
5\. The AMF invokes Nnef_RDS_Activate service operation from the NEF. The
invocation includes AMF address, Access Type, GPSI (if available) and SUPI.
AMF uses the NEF address derived from step 3.
6\. The NEF discovers a UDR as described in TS 23.501 [5], clause 6.3.9.
7a-7b. If the UE context already exists in the NEF, the NEF shall replace the
old AMF address with the new AMF address. Otherwise NEF retrieves RDS related
subscription data using Nudm_UDM_Query and subscribes to be notified using
Nudr_UDM_Notify when the RDS related subscription data is modified.
NEF also creates an UE context to store the RDS subscription information and
the AMF address that is serving this UE.
8\. The NEF responds back to the AMF with Nnef_RDS_Activate service operation
response message. The AMF stores the NEF address received as part of the UE
context.
9\. The AMF includes the \"RDS supported\" indication to the UE in the
Registration Accept message of step 21 of Figure 4.2.2.2.2-1 of TS 23.502 [7]
only after step 8 in which the AMF has received a positive indication from the
selected NEF.
The \"RDS supported\" indication in the Registration Accept message indicates
to the UE whether the network allows the reliable small message delivery over
NAS via 3GPP access or via both the 3GPP and non-3GPP access.
#### 6.4.4.2 RDS Configuration procedure between NEF and AF/AS
Figure 6.4.4.2-1 illustrates the procedure of configuring necessary
information at the NEF and UDR.
In order to avoid MO reliable small data delivery failure, the RDS
configuration procedure should be performed by the AF/AS prior to the UE
requesting send MO reliable small data delivery.
Figure 6.4.4.2-1: RDS Configuration procedure between NEF and AF/AS
1\. The AF/AS used Nnef_RDS_Config_Request service operation to establish
routing information in UE context at NEF. AF/AS provides external identifier
for UE message and reliable data service configuration information (e.g.
application port number) to the NEF.
3\. The NEF used Nudr_UDM-Query_Request service operation to check if RDS
configuration request for the received External Identifier is authorized, and
to receive necessary information for RDS, if required.
4\. The UDR examines the Nudr_UDM-Query_Request, e.g. with regard to the
existence of External Identifier and maps the external identifier to SUPI. The
UDR sends Nudr_UDM_Query_Response (SUPI, Result) to the NEF to acknowledge
acceptance of the RDS Authorization.
6\. The NEF usese Nnef_RDS_Config_Response service operation to acknowledge
acceptance of the RDS Configuration Request to the AF/AS. If the RDS
Configuration was accepted, the NEF will create an association between the
External Identifier and SUPI in UE context. In the MT reliable small data
delivery procedure, the NEF will use External Identifier to determine the SUPI
and receiver port number. In the MO reliable small data delivery procedure,
the NEF will use the SUPI, to determine AS/AF address and application port
number from the UE context.
#### 6.4.4.3 MO reliable small data delivery procedure
{width="6.691666666666666in" height="3.3715277777777777in"}
Figure 6.4.4.3-1: MO reliable small data delivery procedure
It is assumed that the UE is registered with the network.
1\. The UE sends an integrity protected NAS PDU to the AMF via AN node. The
NAS PDU carries the UL RDS PDU data and indication for reliable small data
delivery.
2\. The AMF checks the integrity of the incoming NAS PDU and decrypts the PDU
data.
3\. The AMF determines the NEF based on the UE context and Namf_RDSTransfer
service operation to send RDS PDU to NEF along with UE identity (e.g. SUPI).
4\. The NEF sends the data PDU to the AF/AS according to UE context using
Nnef_DataTransfer service operation.
5\. The NEF sends RDS acknowledgement to AMF using
Namf_Communication_N1N2_message_transfer service operation.
6\. The AMF encrypts the RDS Acknowledgement PDU and send to UE in DL NAS
message.
#### 6.4.4.4 MT reliable small data delivery procedure
{width="6.686805555555556in" height="4.175in"}
Figure 6.4.4.4-1: MT reliable small data delivery procedure
It is assumed that the AF/AS has performed RDS configuration procedure.
1\. The AF/AS request reliable small data delivery using Nnef_dataTransfer
service operation. AS/AF provides External Identifier, DL data PDU, and
Reliable Data Configuration.
2\. The NEF based on UE context derive determines UE identity from UE\'s
External identifier. NEF determines if AF/AS requested reliable small data
delivery and adds RDS header to data PDU. NEF sends RDS PDU to AMF using
Namf_Communication_N1N2_message_transfer service operation.
3\. If the UE is in CM-IDLE, the AMF will buffer the RDS PDU and sends paging
message to AN nodes. Then the UE is paged by the AN nodes. Otherwise, step 3
and step 4 are skipped.
4\. UE responds to paging with initial NAS message.
5\. The AMF performs integrity protection and encryption to the RDS PDU.
6\. The AMF sends encrypted NAS PDU with RDS PDU to the AN node in DL NAS
message.
### 6.4.5 Impacts on existing entities and interfaces
UE:
\- Support the RDS protocol as defined in TS 24.250 [8].
AMF:
\- Support of initial NAS message to carry NAS payload (if not supported in
Rel-15).
\- Support of service operation with NEF for MO/MT data transfer. Re-use of
existing services provided by AMF may be possible.
NEF:
\- Support the RDS protocol as defined in TS 24.250 [8].
\- Support of service operation with AMF for MO/MT data transfer. Re-use of
existing services provided by AMF may be possible.
\- Support of service operation with AS/AF for MO/MT data transfer. Re-use of
existing services provided by NEF may be possible.
\- Support of service operation with UDM/UDR for RDS configuration.
AS/AF:
\- Support of service operation with NEF for MO/MT data transfer and RDS
configuration.
### 6.4.6 Evaluation
This solution relies on use of the RDS protocol (already defined for EPS) for
reliable delivery of small data unstructured PDUs. It does not require
establishment of a PDU session as the RDS header contains the routing
information for the small data transfer between UE and AF. This solution
transmit small data over NAS-MM between UE and AMF and then from AMF to NEF
directly.
## 6.5 Solution 5: Small Data Fast Path communication
### 6.5.1 Introduction
This solution addresses the Key Issue 1: Support for infrequent small data
transmission.
The Small Data Fast Path (SDFP) solution targets to optimize small data
transmission for CIoT UEs in CM-IDLE mode. It describes how small data can be
passed in a fast path of the user plane without the overhead amount of
signalling caused by CM-IDLE / CM-CONNECTED mode transitions.
The SDFP solution has the following specifics:
\- UP security is between UE and UPF. The security information is configured
by AMF during UE registration or PDU session setup.
\- The UE passes information required for the RAN to forward the small data to
the UPF in the RRC message. The RAN derives the UPF information from the
information provided by the UE. The UPF information should be abstract and
hide the internal network architecture.
\- One or several QoS flows can be enabled for SDFP. UE will indicate QoS
information of the packet over radio interface, the RAN will forward the QoS
information for verification by the UPF (i.e. that the UE is authorized to use
a certain QoS flow).
\- The solution support DL data using CN paging. (e)DRX parameters etc. is
configured during UE registration. The solution can also support PSM if
defined.
\- Uses a UP connected to NEF, e.g. according to solution 35, to support NIDD
API(s) to AF/SCS/AS for the Indirect Model of communication.
### 6.5.2 Functional Description
#### 6.5.2.1 General
The Small data fast path is intended as an add-on function handled in a
separate PDU session. It does not replace any existing system function, but it
can be used if both the network and UE support it. This should also keep the
impact on the system lower and simplify the introduction in Low Power Wide
Area Networks (LPWAN).
Figure 6.5.2.1-1: E2E SDFP transmission
The SDFP is realized by providing relevant UPF or PDU session related
information to the UE from the network, which the UE would later provide to
the RAN. The UPF or PDU session relevant information enables the RAN to derive
the path over N3 to the UPF. At UL data arrival the UE passes the data
together with the UPF or PDU session relevant information to the RAN. The RAN
forwards the data on the N3 interface. Since info required to determine the
forwarding of the data is received from the UE, the RAN does not need to
signal to the AMF or have any UE context information stored.
The UPF or PDU session relevant information is provided to the UE as part of
the Session Management (SM) procedures or UE Registration procedures. The SMF
may enable one (or more) of the QoS flows for SDFP.
The AMF derives SDFP security information and provides it to the SMF. The SMF
stores the SDFP security information for the PDU session, enables indicated
QoS flows and acknowledges to the AMF that they have been SDFP enabled.
Header compression is supported in the UE and the UPF.
#### 6.5.2.2 Mobility
Mobility is support as for normal UEs in IDLE mode. When the UE enters a new
TA currently not part of the UE registration area, the UE will initiate a
registration update. During the UE registration update, the AMF notifies the
SMF about the UE location and the SMF may decide to relocate the UPF. When UPF
is to be relocated, the SMF activates the PDU session so UPF N3 UL TEID is
sent to RAN. The RAN then updates the new UPF index and the UPF N3 UL TEID to
UE. SSC mode 2 mobility is probably appropriate for infrequent small data.
The solution assumes the Rel-15 5G baseline that the SMF can be used
throughout the PLMN (e.g. a specific CIoT slice may be used), but UPF can be
changed as of above if needed.
In roaming cases, a UPF in the VPLMN is used for SDFP support.
#### 6.5.2.3 Security
In the SDFP the UE sends traffic without having set up the regular AS
security.
In the described solution the security protection is done by security contexts
in the UE and the AMF/SMF/UPF. These are established as part of existing
signalling, hence keeping the signalling overhead for small data to a minimum.
The SDFP security information is stored in the SMF, UPF and the UE as part of
the PDU Session Resource Request information. It is kept regardless if the
SDFP is active or not, i.e. the security information is kept as long as the
SFDP remains enabled. When the SDFP security information is updated for the
UE, the AMF also updates the SMF/UPF with new SDFP security information.
If AMF is changed e.g. due to mobility, a new SDFP security information is
established by AMF during the Registration Update procedure and provided to
the SMF/UPF and to the UE.
The security protocol between the UE and the UPF consists of the same or
similar protocols to the E-UTRA PDCP layer, i.e. with integrity protection and
ciphering functionality.
Editor\'s note: The security aspects of the solution need to be checked by SA
WG3.
#### 6.5.2.4 UPF and PDU Session information in the UE
The UPF information provided to the UE should not disclose the internal
network architecture and addressing. RAN therefore has a list of UPFs that
support SDFP, with an index and an IP address for each UPF in the list. The
list of UPFs supporting SDFP is preconfigured in the RAN and each RAN node in
the same UPF service area has the same information.
When a PDU Session is created for SDFP, or activated by SMF, RAN receives from
the AMF/SMF a UPF Tunnel information and a SDFP indication. Based on the IP
address in the UPF Tunnel information and the RAN list of UPFs with SDFP
support, RAN determines the UPF index. RAN sends the UPF index and the UPF N3
UL TEID to UE.
### 6.5.3 Support of EPC interworking
**Mobility from EPC to 5GC:**
At mobility from EPC to 5GC, the PDU Session needs to be activated and the UPF
information is provided to the UE by RAN as part of the registration
procedure.
**CIoT support capability detection:**
During mobility through N26 interface, the source AMF(SMF)/MME detects the
target side CIoT support capability through DNS/NRF query or location
configuration. See TS 29.303 [17] and TS 29.510 [18]. Based on the CIoT
support capabilities, source side determines if CIoT related PDU sessions or
PDN connections shall be transferred.
During Idle mobility through N26 interface, the new AMF(SMF)/MME indicates
CIoT support capability at the new side. Based on the capability at the new
side, the old AMF(SMF)/MME determines if CIoT related PDU sessions or PDN
connections shall be transferred.
**Unstructured PDU type vs Non-IP PDN type:**
For PDU session with unstructured PDU type, SMF shall set the PDN type to Non-
IP during transfer to EPC. When Non-IP PDN type PDN connection is received
from EPC side, SMF shall set the PDU session type to Unstructured. This is
specified in TS 23.502 [7], clause 4.11 (Rel-15).
**Selection of control plane or user plane CIoT optimization:**
When SDFP PDU session is transferred to EPS side, it can either use the
control plane CIoT optimization or user plane CIoT optimization based on
preferred and supported network behaviour between UE and EPC.
### 6.5.4 Procedures
#### 6.5.4.1 UE requested SDFP PDU session establishment
Figure 6.5.4.1-1: UE-requested PDU Session Establishment for SDFP
The procedure assumes that the UE has already registered on the AMF. Below are
some modifications for SDFP compared to the existing PDU Session Establishment
procedure. The SDFP information is kept in the UE for the duration of the PDU
Session. The SDFP information can be updated as part of the registration
update procedure, e.g. to reflect UPF changes.
1\. UE provides an indication it wants to establish a SDFP PDU session.
Additionally, the UE could provide NSSAI indicating a specific network slice
for SDFP which could be used by the RAN to select an AMF that supports SDFP.
2\. AMF selects an SMF that supports SDFP.
3\. The AMF generates SDFP security information with same or similar
information as normally is provided to RAN for PDCP when SDFP is not used. The
SDPF security information is forwarded to the SMF/UPF (and to RAN/UE in step
12-13).
Editor\'s note: SA WG3 should check if the SDFP security information could be
derived in the RAN based on the existing AS security information available in
the RAN (might avoid change to step 12).
...
8\. SMF selects a UPF that supports SDFP.
...
10\. SMF performs N4 Session Establishment including setting up the SDFP
security context in the UPF. During this procedure the UE UPF and PDU Session
information will be generated.
12\. The SDPF security information is sent to the RAN.
13\. RAN determines the UPF index based on the UPF Tunnel information received
in step 12. RAN sends the UPF index, the UPF UL TEID and the SDPF security
information to the UE.
15-16a. The SDPF security information is sent to the SMF/UPF.
#### 6.5.4.2 SDFP transfer initiated by UL data
The following figure shows an example of how MO small data packet is passed
from the UE in UL. The term \"SDFP session\" is used in the text below meaning
the time from a fast path is established (e.g. DRB is created) until it is
released (e.g. inactivity timeout).
Figure 6.5.4.2-1: SDFP transfer initiated by UL data
1\. The UE establishes an RRC for SDFP transfer. Parameters for selection of
UPF for the PDU Session for the UE are passed to the RAN i.e. the UPF index
and the UPF UL TEID.
Editor\'s note: The detailed solution for this part should be discussed in RAN
WGs. An alternative would be to transfer the parameters as part of the UL data
PDU.
1a/b. In case AMF trigger paging towards RAN (e.g. due to N1 CP signalling)
during an ongoing \"SDFP transfer initiated by UL data\", RAN may set up N2 UE
association using the 5G S-TMSI received in step 1 and provide the AMF with
NGAP RAN UE ID. AMF replies with NGAP AMF UE ID.
NOTE: This step may be performed at any time between step 1 and 6.
2\. The UE encrypts, and integrity protects an UL data PDU and sends it to
RAN.
3\. RAN forwards the UL data PDU on the N3 tunnel to the selected UPF. RAN
selects the UPF and the N3 tunnel based on the SDFP information provided by
the UE (i.e. UPF index and the UPF UL TEID) and the RAN preconfigured list of
UPFs supporting SDFP. RAN will also provide the UPF with RAN N3 DL Tunnel Info
for the SDFP session.
4\. The UPF checks integrity protection and decrypts the UL data PDU. If
passed the check, the UPF forwards the UL data on the N6/N9 interface. In
addition, the UPF enables subsequent DL data transmissions to the RAN node it
received the UP data PDU from N6/N9 interface.
5\. A DL data packet may arrive on N6/N9 shortly after, e.g. an
acknowledgement.
6\. The UPF encrypt and integrity protects the DL data PDU and passes it to
the RAN node, which was enabled in step 3-4.
7\. RAN forwards the DL data PDU to the UE.
8-9. Based on a UP Activity Timeout timer in RAN and UPF the SDFP information
context in RAN is released and DL data transmission in the UPF is disabled by
setting the SDFP in a non-active state. RAN releases the RRC connection.
#### 6.5.4.3 Alternative 1: SDFP transfer initiated by DL data
Small data initiated in DL on a QoS flow where fast path is enabled but not
active (i.e. the RAN N3 DL TEID is unknown or expired), is handled as
described in the figure below. It should be noted that compared to when small
data is initiated UL, an additional paging of the UE is required.
Figure 6.5.4.3-1: SDFP transfer initiated by DL data
1\. DL data arrives in the UPF for a PDU Session that is SDFP enabled but not
currently active (i.e. the RAN N3 DL TEID is unknown or expired).
2-5. The PDU Session is in CM_IDLE and the UPF notifies the SMF about DL data.
SMF notifies the AMF using the Namf_MT_EnableUEReachability service including
a Fast Path indicator for DL SDFP transfer. The AMF sends a paging message to
the RAN with a Fast Path indicator included. The RAN pages the UE with a FP
indicator included.
6\. UE responds to the paging with a RRC establishment including a NAS Service
Request. The Fast Path indicator in the received paging triggers the UE to
also include the UPF Index and UPF UL TEID and PDU Session ID. As part of the
RRC establishment, the RAN and the UE establishes a Data Radio Bearer (DRB)
with default parameters for SDFP transmissions.
7\. RAN understands based on the included UPF index and UPF UL TEID that a
SDFP shall be established. RAN allocates a RAN N3 TEID, maps it to the DRB and
establishes a N3 tunnel based on the SDFP information provided by the UE (i.e.
UPF index and the UPF UL TEID) and the RAN preconfigured list of UPFs
supporting SDFP. RAN sends an Initial UE message (NAS: Service Request, RAN N3
TEID, PDU Session ID) to AMF.
8\. The AMF takes the received NAS Service Request as a response to the paging
request. AMF sends a Nsmf_PDUSession_UpdateSMContext Request message with the
NAS Service Request, RAN N3 TEID, PDU Session ID included to the SMF which
handles the PDU Session.
9\. The SMF understands based on the included RAN N3 TEID that the PDU Session
shall be moved to active SDFP state. SMF sends a N4 Session Modification
Request (RAN N3 TEID, PDU Session, Fast Path indicator) to the UPF. The UPF
stores the RAN N3 TEID for the PDU Session and opens the PDU Session for SDFP
transmissions. UPF acknowledges to SMF by sending a N4 Session Modification
Response message. The SMF keeps the UE in CM-IDLE but may keep a record of the
SDFP transmission, e.g. in charging information, or statistics.
10\. SMF acknowledges to AMF by sending a Nsmf_PDUSession_UpdateSMContext
Response to AMF.
11\. UPF forwards any buffered DL data to the RAN.
12\. RAN forwards DL data to the UE.
13\. Any additional uplink and downlink small data may be transmitted.
14-15. The UP Activity Timeout timer expires in UPF and RAN. RAN releases the
RRC connection.
#### 6.5.4.3a Alternative 2: SDFP transfer initiated by DL data
This is alternative solution for DL data transfer on a QoS flow where fast
path is enabled but not active (i.e. the RAN N3 DL TEID is unknown or
expired), as described in the figure below. In this solution, if the UE has
PDU session for SDFP and receives paging from the network, it always
establishes the DRB for PDU session for SDFP. The RAN can send dummy uplink
packets to UPF to establish the tunnel between RAN and UPF.
Figure 6.5.4.3a-1: SDFP transfer initiated by DL data
1\. DL data arrives in the UPF for a PDU Session that is SDFP enabled but not
currently active (i.e. the RAN N3 DL TEID is unknown or expired).
2-5. The UE is in CM_IDLE and the UPF notifies the SMF about DL data. SMF
notifies the AMF using the Namf_MT_EnableUEReachability service for SDFP
transfer. The AMF sends a paging message to the RAN. The RAN pages the UE.
6\. UE responds to the paging with a RRC establishment for SDFP transfer.
Parameters for selection of UPF for the PDU Session for the UE are passed to
the RAN i.e. the UPF index and the UPF UL TEID. As part of the RRC
establishment, the RAN and the UE establishes a Data Radio Bearer (DRB) with
default parameters for SDFP transmissions.
7\. RAN set up N2 UE association using the 5G S-TMSI received in step 4 and
provide the AMF with NGAP UE ID. AMF replies with NG AMF ID. This step is same
as step 1b in MO case.
8\. RAN understands based on the included UPF index and UPF UL TEID that a
SDFP shall be established. RAN allocates a RAN N3 DL TEID, maps it to the DRB
and establishes a N3 tunnel based on the SDFP information provided by the UE
(i.e. UPF index and the UPF UL TEID) and the RAN preconfigured list of UPFs
supporting SDFP. The RAN then passes the uplink small data (can be dummy
packets) sent by the UE in step 6 to the selected UPF.
9\. The UPF stores the RAN N3 TEID for the PDU Session and forwards any
buffered DL data to the RAN.
10\. RAN forwards DL data to the UE.
11\. Any additional uplink and downlink small data may be transmitted.
12-14. The UP Activity Timeout timer expires in UPF and RAN. RAN releases the
RRC connection.
### 6.5.5 Impacts on existing entities and interfaces
Editor\'s note: This clause describes impacts to existing entities and
interfaces.
New parameter with SDFP security information on N1, N11, N4 and N2.
New parameters UPF index and UPF UL TEID in RRC message to the UE.
New parameter RAN N3 TEID in GTP-U message to UPF.
SDFP function in UE, RAN, UPF, AMF and SMF.
### 6.5.6 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.6 Solution 6: Small Data Communication based on Data PDU routed over the
User Plane.
### 6.6.1 Introduction
#### 6.6.1.1 General
This solution applies to Key issue 1 and Key issue 2. The main idea of the
solution is to provide a simple migration for the 5G-IoT UE implementation
building on the CP CIoT optimization and at the same time keep the user data
separated from the Control Plane within the Core Network.
To overcome the drawback of routing user data via the Core Networks control
plane function(s) AMF and SMF, a new proxy function is introduced that
includes the functionality needed for handling of the user data in a Data PDU
sent over Uu using Signalling Radio Bearer.
Similar to CP CIoT optimization and NB-IoT RAT, the Data PDU is embedded in an
RRC message (Signalling Radio Bearer, SRB). The Data PDU is transparent to the
RRC layer, similar legacy NB-IoT. The difference compared to legacy is that
the Data PDU shall not be passed to the NAS upper layer, instead passed to the
new function/proxy that performs i.e. integrity protection, ciphering and
header compression.
NOTE 1: This solution does not address congestion issues related to the usage
of Signalling Radio Bearers in RAN when an IoT device uses e.g. NB-IoT RAT and
5G CP CIoT optimization.
NOTE 2: It is assumed that if this solution is selected for 5GS, then the UE
will detect the 5G PLMN and support for small data communication by decoding
the System Information Broadcasted in e.g. MIB-NB, SIB1-NB.
#### 6.6.1.2 Protocol stack for User data
The figure below shows the protocol stack for user data including the new
function/proxy here called New Upper layer.
Figure 6.6.1.2-1: Protocol stack for User plane data
#### 6.6.1.3 Architecture reference models
Figure 6.6.1.3-1: Architecture for small data delivery via UPF to DN and NEF
### 6.6.2 Functional Description
The following principles apply:
\- Small data using encapsulated Data PDU:
\- Small data is exchanged between the UE and the Proxy function using
encapsulated Data PDU in both uplink and downlink direction.
\- The proxy function is implemented in the UPF used as PDU Session Anchor
(PSA) for the small data session.
Figure 6.6.2-1: The location of the proxy function
\- RAN detects the message type is of Data PDU type. RAN forwards the Data PDU
to the proxy function in the UPF.
NOTE: The detection that the message type is of Data PDU type could be based
on an indicator in the RRC message e.g. utilizing _criticalExtensionsFuture_.
Details to be decided by RAN WG2.
\- The proxy function extracts or encapsulates the user data from/in the Data
PDU. This includes e.g. the security operations and header compression.
\- The proxy function forwards/receives the user data over the UPF to/from the
PDU session anchor point.
\- PDU Session Establishment:
\- The PDU session establishment reuse the procedure in TS 23.502 [7], clause
4.3.2.2.1 with the difference that the UPF node will be configured with
security parameters to be stored in the UE context. The AMF provides the
security parameters via the SMF to the UPF and the UPF stores the UE Context
as long as the PDU Session is established.
\- Supported PDU session types:
\- Small data transfer supports IP and unstructured data.
\- Integrity protection, ciphering and header compression:
\- Integrity protection and ciphering for small data are performed by a proxy
function (Similar to existing NAS PDU integrity protection and ciphering
functionality may be re-used in the proxy function).
Editor\'s note: Detailed security solution for the proxy function is FFS and
shall be selected and specified by SA WG3. Example of a possible solution
could be to use the same NAS key but different packet counters for the
different \"flows\", meaning that NAS signalling terminating in the AMF would
have it\'s own packet counters and the user data packets terminating in the
proxy will have it\'s own packet counters. Another possible solution could be
to generate new key and packet counters for the User data communication
between the UE and the proxy function.
\- UE and proxy function may perform header compression for IP data.
\- Roaming:
\- In case of home routed roaming the proxy is in the V-PLMN. The data is
delivered from the UPF in V-PLMN, on the N9 interface, via the UPF in the
H-PLMN to the Data Network.
\- In case of roaming of NIDD via NEF an IWK-NEF located in the V-PLMN is used
for providing inter-connection with the NEF in the H-PLMN. The IWK-NEF
(similar to IWK-SCEF in EPC) relays data between UPF/proxy function in V-PLMN
to NEF in H-PLMN.
\- Early Data Transmission may be initiated by the UE and the NG-RAN node may
indicate to the PSA that the connection is triggered for EDT. EDT can be
combined with AS based Release Assistance Information.
\- AS based Release Assistance Information (RAI) can be used by the UE to
indicate whether it is a single UL packet and if a single consecutive DL
packet is expected.
\- The RAN node will forward the RAI to the PSA and wait for receiving an End
Indication and optionally DL Data PDU from the PSA. After receiving the End
Indication, the RAN will send RRC message to the UE allowing the UE to re-
enter RRC_IDLE. The RRC message will include the optional DL Data PDU.
### 6.6.3 Support of EPC interworking
The UE supports EPC interworking by supporting both EPC NAS and 5G NAS plus
the support for small data over NAS in both 4GS and 5GS. From a UE perspective
the solution can be almost identical, only difference may be in the 5G
solution where the UE might need to mark the Data PDU.
### 6.6.4 Procedures
#### 6.6.4.1 Small Data via UPF
##### 6.6.4.1.1 General
Compared to EPC, 5GC requires that the UE first performs registration and then
PDU Session Establishment for setting up all required PDU sessions. Before any
procedures below, it is assumed that a successful registration procedure has
been performed that included the UE\'s Preferred Network Behaviour
information.
##### 6.6.4.1.2 Assumptions
\- A UE that shall send or receive small data is assumed to have established a
PDU session for small data. The PDU Session Anchor (PSA) stores the specific
UE security parameters for the small data PDU session in the UE context.
\- For a RAN node, there may be one specific UPF that acts as the PDU Session
Anchor for all small data PDU sessions from multiple UEs.
\- The small data from any UE, connected to that RAN node, is then forwarded
via a common N3 tunnel towards this UPF. The tunnel is configured either when
configuring the RAN node, or when the first small data PDU session is
established (as in solution 29 in clause 6.29).
\- The small data from the UPF to a UE is sent via the common N3 tunnel, for
all small data UEs, connected to the RAN node that the UE is connected with.
The RAN identifies the UE and the corresponding RRC Connection based on the UE
ID (e.g. 5G-GUTI) and PDU session ID.
\- If the RAN does not have a common N3 tunnel for small data PDU session when
receiving small data from a UE, then the RAN node will trigger the
establishment of a common N3 tunnel by sending an N2 message requesting the
SMF to configure such.
\- The UPF may keep track of the RRC connection to the UE by a UE Location
Freshness Timer as proposed in solution 29 in clause 6.29. The timer is reset
when the UPF receives UL traffic from the UE. As long as the UE Location
Freshness Timer has not elapsed, the UPF sends a DL Data PDU to the same RAN
node from which it last received UL traffic from this UE. When the DL Data PDU
shall be delivered to the UE and the UE Freshness Activity timer has elapsed
the UPF requests the AMF to page the UE by sending a Downlink Data
Notification to the SMF.
\- When the DL Data PDU cannot be delivered to the UE, the RAN node deletes
the Data PDU and notifies the UPF that the UE is not reachable. Then the UPF
may requests the AMF to page the UE.
\- Once the common N3 tunnel is established for small data communication,
there is no need to release it as long as the Common UPF node for small data
is not changed.
##### 6.6.4.1.3 PDU Session Establishment
Figure 6.6.4.1.3-1: PDU Session Establishment enabling Data over UPF
1\. The UE sends a PDU session establishment request message that includes the
PDU session ID, PDU type, DNN and S-NSSAI. Based on e.g. the Preferred Network
Behaviour and S-NSSAI the AMF selects an SMF and invokes the
Nsmf_PDUSession_CreateSMContext request to trigger the PDU session
establishment.
2\. Steps 2-12 are executed according to TS 23.502 [7], clause 4.3.2.2.1 with
the following changes:
\- The AMF provides UE specific security parameters to the SMF.
\- In step 10, the SMF includes required security parameters for the proxy
function located in the UPF node that acts as the PDU Session Anchor (PSA).
\- A common N3 tunnel is established for the requested PDU session, if the N3
tunnel was not already established.
3\. The AMF forwards the PDU session establishment accept message to the UE.
4\. Steps 14-16 are executed according to TS 23.502 [7] clause 4.3.2.2.1
##### 6.6.4.1.4 Mobile Originated Data Transport
Figure 6.6.4.1.4-1: Mobile Originated Data Transport
0\. The UE is in CM-IDLE and has an established small data PDU session.
1\. The UE establishes an RRC connection and sends an integrity protected Data
PDU as part of this. The Data PDU carries encrypted uplink data as payload and
the corresponding PDU session ID.
2\. RAN detects that the transport message from the UE is for the Proxy in the
PSA. The RAN node associates the UE ID (e.g. 5G-GUTI) with the RRC connection
in case of DL data forwarding in step 8.
3\. RAN forwards the Data PDU together with the PDU session ID and UE ID on
the N3 Tunnel to the UPF node acting as PSA and to the proxy function in the
UPF node.
If the RAN does not have a common N3 tunnel for small data PDU session, then
the RAN node will trigger the establishment of a common N3 tunnel by sending
an N2 message requesting the SMF to configure such.
4\. The proxy function in the UPF node verifies the integrity of the incoming
Data PDU and decrypts the data in the payload and decompresses the IP header
if header compression was applied in the UE on the IP data.
5\. UPF forwards the data to the Data Network (DN).
6\. [Conditional] If there is data available in UPF, the proxy within UPF
applies integrity protection, encryption and header compression for the
transport to the UE.
7\. [Conditional] The UPF forwards the Data PDU together with the PDU session
ID and UE ID over the N3 tunnel to the RAN.
8\. [Conditional] RAN identifies the receiver and sends the Data PDU to the UE
over DL RRC signaling message.
9\. Based on RAN specified inactivity conditions, the RAN releases the UE\'s
RRC connection and corresponding CN connections according to AN release
procedure in TS 23.502 [7], clause 4.2.6.
##### 6.6.4.1.4b Mobile Originated Data Transport, using EDT and AS based RAI
Figure 6.6.4.1.4b-1: Mobile Originated Data Transport
0\. The UE is in CM-IDLE and has an established small data PDU session.
1\. The UE sends RRCEarlyDataRequest message including an integrity protected
Data PDU. The UE may also include an AS based Release Assistance Information
(RAI), that indicates whether a DL message is expected or this was a single
uplink data packet. The Data PDU carries encrypted uplink data as payload and
the corresponding PDU session ID.
2\. RAN detects that the transport message from the UE is for the Proxy in the
PSA and check the RAI if such was included. The RAN node associates the UE ID
(e.g. 5G-GUTI) with the RRC connection in case of DL data forwarding in step
8.
3\. RAN forwards the Data PDU together with the PDU session ID, UE ID, EDT
indicator and RAI over the N3 Tunnel to the UPF node acting as PSA and to the
proxy function in the UPF node.
If the RAN does not have a common N3 tunnel for small data PDU session, then
the RAN node will trigger the establishment of a common N3 tunnel by sending
an N2 message requesting the SMF to configure such.
4\. The proxy function in the UPF node verifies the integrity of the incoming
Data PDU and decrypts the data in the payload and decompresses the IP header
if header compression was applied in the UE on the IP data.
Furthermore, if RAI was included the UPF node should either:
\- send an End Indicator, set to \"No Further Data\", to the RAN node if the
RAI single UL data packet and the UPF node does not have any pending downlink
data;
\- or, wait for the expected DL data packet.
If there was no RAI included then the UPF may send an End Indicator, set to
\"No Further Data\", to RAN if the UPF does not have any pending DL data. This
will enable the RAN to quickly send RRCEarlyDataComplete message to the UE.
5\. UPF forwards the data to the Data Network (DN).
6\. [Conditional] If there is data available in UPF, the proxy within UPF
applies integrity protection, encryption and header compression for the
transport to the UE.
7\. The UPF either forwards the Data PDU together with the PDU session ID and
UE ID or send an empty Data PDU together with an End Indicator, set to \"No
Further Data\", and UE ID over the N3 tunnel to the RAN.
8\. The RAN identifies the receiver using the UE ID and sends a
RRCEarlyDataComplete message to the UE. The RRCEarlyDataComplete message will
include the Data PDU to the UE. The UE will return the RRC_IDLE after this
step.
##### 6.6.4.1.5 Mobile Terminated Data Transport
Figure 6.6.4.1.5-1: Mobile Terminated Data Transport
0\. The UPF receives downlink data for a small data PDU Session to the UE.
1\. Network Triggered Service request according to TS 23.502 [7] clause
4.2.3.3 step 2-6 is performed. The UE responds on the page with a Control
Plane Service Request NAS message which will not trigger any DRB
establishment.
2\. The proxy function in the UPF node acting as PSA apply header compression,
ciphering and integrity protection.
3\. The UPF forwards available Data PDU together with the PDU session ID and
UE ID to the RAN node over the N3 Tunnel.
4\. RAN delivers the Data PDU over RRC to the UE.
5\. [Conditional] The UE sends an integrity protected Data PDU in an uplink
RRC message. The Data PDU carries encrypted uplink data as payload and
corresponding PDU session ID.
6\. [Conditional] The RAN detects that the transport message is from the UE
and for the Proxy in the UPF node.
7\. [Conditional] The RAN forwards the Data PDU together with the PDU session
ID and UE ID to the proxy function located within the UPF node.
8\. [Conditional] The proxy function verifies the integrity of the incoming
Data PDU and decrypts the data in the payload and decompresses the IP header
if header compression was applied in the UE on the IP data.
9\. [Conditional] The UPF forwards the data to the DN.
10\. Based RAN specified inactivity conditions, the RAN releases the UE\'s RRC
connection and corresponding CN connections according to AN release procedure
in TS 23.502 [7], clause 4.2.6.
#### 6.6.4.2 NIDD via NEF specific procedures
##### 6.6.4.2.1 General
This clause details the additional functionality to support NIDD via NEF as
shown in the architecture reference model in clause 6.6.1.3. The procedures
show reuse of T8 and T6 interface, it is possible that stage 3 would decide to
use an alternative protocol than T6 for the Nx reference point.
##### 6.6.4.2.2 Nx Session Establishment
On top of the PDU session establishment procedure in clause 6.6.4.1.3 the
following applies:
\- Based on either subscription data or DNN with \"invoke NEF selection\"
indicator, the SMF will select an NEF for NIDD based on the UE subscription
profile.
\- The SMF configures the NEF and UPF anchor for data transfer for the
specific UE ID and PDU session ID.
\- The SMF also updates the AMF with the NEF ID with
Nsmf_PDUSession_CreateSMContext Response in order for the AMF to invoke
Namf_EventExposure_Notify (User Identity) service once the UE becomes
reachable or is about to become reachable.
##### 6.6.4.2.3 Mobile Terminated NIDD procedure
Figure 6.6.4.2.3-1: Mobile Terminated NIDD Transport via NEF
0\. The UE has registered and performed PDU session establishment for NIDD via
NEF.
1\. If SCS/AS has already activated the NIDD service for a given UE, and has
downlink non-IP data to send to the UE, the SCS/AS sends an MT NIDD Submit
Request (External Identifier or GPSI, non-IP data, Reliable Data Service
Configuration, Maximum Latency, Priority, PDU Session Establishment Option)
message to the NEF.
2\. The NEF determines the PDU session Context based on the DNN associated
with the NIDD configuration and the User Identity. If an NEF PDU session
context corresponding to the External Identifier or GPSI included in step 1 is
found, then the NEF checks whether the SCS/AS is authorised to send NIDD
requests and that the SCS/AS has not exceeded the quota of data submission to
the PDU session.
If no NEF PDU session context is found, then the NEF, depending on PDU session
Establishment Option, may either:
\- send a NIDD Submit Response (Cause) with appropriate error cause value. The
flow stops at this step; or
\- perform device triggering towards the UE to establish a PDU session
according to TS 23.502 [7] clause 4.13.2.2.
3\. If an NEF PDU session context corresponding to the External Identifier or
GPSI included in step 1 is found, then the NEF sends a NIDD Submit Request
(User Identity, PDU session ID, NEF ID, non-IP data, NEF Wait Time, Maximum
Re-transmission time) message toward the UPF/proxy function.
4\. If the UPF can immediately deliver the non-IP data to the UE e.g. when UE
is already in RRC_CONNECTED mode, or UE is in RRC_IDLE and UPF is able to
initiate paging procedure (see TS 23.502 [7] clause 4.2.3.3), the procedure
proceeds at step 8
If the UE is determined not reachable within the NEF Wait time the UPF sends
NIDD Submit Response (Cause, Requested Re-Transmission Time) to the NEF.
The AMF may indicate in Requested Re-Transmission time IE the time when the
NEF is expected to re-transmit the DL data to the currently unreachable UE. In
this case the NEF buffers the DL data and wait for the notification that the
UE becomes reachable.
5\. The NEF may send an MT NIDD Submit Response (Requested Re-Transmission
time, Cause) to the SCS/AS informing of the received results. The flow stops
at this step.
6\. When the AMF detects that the UE is reachable (e.g. by performing periodic
registration, or when the UE is about to become reachable e.g. extended idle
mode DRX cycle expiring, AMF anticipating MO communication pattern for the UE
etc.), and the AMF has the Not Reachable for NIDD flag set, then the AMF
invokes Namf_EventExposure_Notify (User Identity) service. The NIDD Submit
Indication (User Identity) message could also come from the UPF if the UE
initiated MO communication,
7\. If the data has not been purged, the NEF sends a NIDD Submit Request (User
Identity, PDU session ID, NEF ID, non-IP data, NEF Wait Time, Maximum Re-
transmission time) message toward the UPF/Proxy function.
8\. UPF/proxy function performs MT data transport according to clause
6.6.4.1.5
9\. If the UPF/proxy function was able to initiate step 8, then the UPF sends
a NIDD Submit Response (cause) message towards the NEF acknowledging the NIDD
Submit Request from NEF received in step 3 or step 7
10\. The NEF sends an MT NIDD Submit Response to acknowledge the MT NIDD
Submit Request.
##### 6.6.4.2.4 Mobile Originated NIDD procedure
Figure 6.6.4.2.4-1: Mobile Originated NIDD Transport via NEF
0\. The UE has registered and performed PDU session establishment for NIDD via
NEF.
1\. The UE sends MO data according to clause 6.6.4.1.4 including the PDU
session ID corresponding to the session for NIDD via NEF.
2\. The UPF sends NIDD Submit Request (User Identity, PDU session ID, NEF ID,
non-IP data, MO Exception data counter) message to the NEF.
3\. When the NEF receives the non-IP data, and finds an NEF PDU session
context and the related T8 Destination Address, then it sends the non-IP data
to the SCS/AS that is identified by the T8 Destination address, in a MO NIDD
Indication (External Identifier or GPSI, non-IP data, Reliable Data Service
Configuration).
4\. The SCS/AS responds to the NEF with a MO NIDD Acknowledgement.
5\. The NEF sends NIDD Submit Response to UPF.
### 6.6.5 Impacts on existing entities and interfaces
UE:
\- The handling of user data to/from the application.
\- Support for new indication in the RRC Layer used for routing data PDU to
and from the UPF.
RAN:
\- New indication in the RRC Layer used for routing small data to and from the
UPF.
\- Support the common N3 tunnel for all small data in DL and UL.
AMF:
\- Provide the UE specific security parameters to UPF and UE.
Editor\'s note: Details are FFS and depends on SA WG3 design.
SMF:
\- Selection and configuration of UPF based on the small data routing.
UPF:
\- Adding the Proxy function to the UPF that includes functionalities as e.g.
integrity protection, encryption and header compression.
\- Sending small Data PDUs over the common N3 tunnel.
### 6.6.6 Evaluation
Even though the signalling radio bearer is still used it would not impact the
available radio resources blocks for NB-IoT since both SRB1bis and DRB use
same scheduled NPUSCH and NPDSCH resources.
This solution supports UE mobility and roaming.
This solution enables the RAN to provide different priority to NAS messages
and small data PDU messages if needed.
This solution supports delivery of pending DL SMS after paging or combined
with other NAS signaling e.g. Periodic Registration or registration due to
mobility.
Pros:
\- Only impacting RRC relating to the indication of small data PDU message, UE
NAS layer and the handling of user data to/from the application via the new
upper layer functionality that used to be in the NAS layer for Control plane
CIoT EPC optimisation.
NOTE: UE NAS layer anyway needs to be updated to support 5GC, so part of the
above mentioned change is in any case needed.
\- User data is separated from the control plane, which is an architectural
principle for the 5GC.
\- Core Network Congestion due to the user data handling in the control plane
is avoided, since the user data is routed in the user plane.
\- SCS/AS API is not affected.
\- UE\'s lower layer and application functionality is not affected.
Cons:
\- New function is introduced in the UPF that includes functionalities as e.g.
integrity protection, encryption and header compression.
\- New security endpoint in the new UPF function is introduced.
\- A new indication is introduced in the RRC layer for routing purposes,
indicating whether it is a NAS message or data PDU message.
\- New routing solution in RAN for the user data PDU.
## 6.7 Solution 7: Small data frequent communication
### 6.7.1 Introduction
This solution addresses the key issue #2, Frequent Small data communication.
The solution allows the UE used for frequent small data communication to use
the eDRX power saving method as investigated in KI#4. This allows UE power
efficiency for traffic patterns for frequent small data communication with
gaps between transmissions.
This solution uses combinations of RRC Inactive, EDT, power saving methods,
and HLCOM (see key issue 3 High latency communication) to meet the
architecture requirement on both resource-efficiency and UE power efficiency.
The solutions have two options for data buffering at MT data transmissions:
a) DL data buffering in RAN (solution in clause 6.7.4.2.2).
b) DL data buffering in CN (solution 6.7.4.2.1).
c) DL data buffering in CN (moving the UE to IDLE).
Option a), with DL data buffering in RAN, is preferably used when a UE is not
using eDRX (or eDRX with quite short sleep cycle e.g. a minute). In these
cases, the RAN buffering can be very efficient. Option b), with DL data
buffering in CN, is preferred when a UE is using eDRX (with longer sleep
cycles e.g. a minute or more). In such cases, the CN has efficient buffer
handling possibilities also considering full UE mobility. Alternatively,
option c) with DL data buffering in CN with UE moved to CM-IDLE can be used
for UE using longer sleep cycles.
CN buffering is also used when SCS/AS has requested UE reachability Monitoring
Events, except in case of option a). CN is able to send UE reachability event
reports for SCS/AS that has requested notification when the UE wakes up from
its power saving state. The RAN does not handle such reporting.
### 6.7.2 Functional Description
This solution for frequent small data communication supports the following
functions:
\- Small data is transmitted with reduced signalling using the RRC Inactive
state. For single and dual packet transmissions (UL+DL), even further
reduction of signalling over the radio is achieved using the Early Data
Transmission (subject to RAN decision).
\- Fast release of the RRC connection at single and dual packet transmissions
is supported, hence maximizing the UE power efficiency.
\- Support for delivery of IP data and Unstructured (NIDD) data.
\- Support for MT data transmission to power saving devices (KI 4 functions
e.g. eDRX) using extended buffering and UE reachability event notifications
(KI 3 functions).
\- The existing UP security mechanisms in 5G system are supported.
\- Support for charging, roaming, and policy control. Further 5G CIoT support
for charging of messages are supported.
### 6.7.3 Support of EPC interworking
**_General:_**
For DL data buffering, interworking between 5GC and EPC is achieved by a
combined PGW/SMF and PGW-U+UPF. If a SMF/UPF has data buffered for a UE when
the UE moves to EPC and becomes reachable then buffered data will get
delivered in EPC (and vice versa).
**_When interworking with EPC with N26, the source side may also based on CIoT
capability at target side decide if the PDU session or PDN connection shall be
transferred during mobility._**
**EPC to 5GC:**
For a UE using CP CIoT EPS Optimization based PDN connection, CM-IDLE mode
mobility is used from EPC to 5GC, and 5GC decides during mobility or next
MO/MT data if the RRC Inactive optimization is used. Mobility from EPC to 5GC
can also be made in CM-CONNECTED mode for a UE using UP CIoT EPS Optimization
based PDN connection, by a handover in CM-CONNECTED mode.
**5GC to EPC:**
Mobility from 5GC to EPC, can either be made as CM-IDLE mode mobility, or as
5GC to EPS CM-CONNECTED mode handover procedure if UP is supported on the EPC
side (if not supported only CM-IDLE mode mobility is used to EPC). On the EPS
side it is decided if either the UP CIoT EPS Optimization or the CP CIoT EPS
Optimization shall be applied.
### 6.7.4 Procedures
#### 6.7.4.1 MO transmissions
##### 6.7.4.1.0 General
MO transmissions for frequent small data communication uses RRC Inactive and
Early Data Transmission to reduce the signalling. RRC Inactive with MO
transmission saves a UE context in the RAN at an initial small data
transmission. All subsequent MO small data transmissions can then benefit of
MO UL and DL transmission of small data without any 5G CP signalling. The RAN
simply forwards any UL data on the existing N3 interface. And any subsequent
DL data and additional UL data can be forwarded in the same optimized way.
NOTE: Unlike CP-data in the EPS, there is no limit or break even for how much
subsequent DL&UL data can be forwarded during a single RRC connection with
this solution before there is a signalling penalty i.e. before the
optimization becomes less optimized compared to sending the small data without
any optimization at all.
Early Data Transmission with RRC Inactive and MO transmission makes even
further signalling optimization over the radio by piggy back the first UL data
potentially the first DL data to the RRC establishment signalling. This would
save an additional one or potentially two messages over the radio.
Editor\'s note: Whether existing AS RAI can be re-used when the UE is aware of
potential pending DL data in the CN is FFS.
##### 6.7.4.1.1 MO transmission with RRC Inactive
An optimized data transmission for small data can be achieved using the RRC
Inactive state for the UE connected to the 5GS. RRC Inactive is supported in
5GS from Rel-15 when NG-RAN is used. This solution proposes to use RRC
Inactive also when NB-IoT and LTE-M are used.
The RRC_INACTIVE feature can transmit small data without necessarily
performing a full state transition to RRC_CONNECTED (see TR 38.804 [15], Annex
G).
NOTE: RRC Inactive for NB-IoT & LTE-M connected to 5GC is work in progress in
RAN and coordination with RAN is needed.
Figure 6.7.4.1.1-1: RRC Inactive with MO transmission
The UPF-(NEF) entity in the figure above is the UPF-NEF (i.e. Small data
delivery function) in the Indirect Model case (i.e. when NIDD API is used) and
it is a UPF in the Direct Model case.
1-3. The RRC connection is moved from inactive to active.
4-5. The UE sends a UL data PDU with small data to the RAN. The RAN forwards
the UL data PDU to the UPF.
If UE provided an AS RAI in step 4 which indicated single packet, or if the
Expected UE Behaviour stored in the UE context in RAN contains a Release
Assistance Information which indicates single packet (and the AS RAI is not
present), then RAN continues to step 9 and immediately suspends the RRC
connection unless there is pending DL data in RAN by which the pending DL data
is sent to the UE and the RRC connection may be kept for potential subsequent
UL (as a response to the pending DL data).
6\. For the Direct Model case the UPF forwards data to/from the AF (i.e.
SCS/AS). For the Indirect Model case this step is the NIDD API. See for
example the UPF-NEF solution 35.
7-8. The receiver may respond with a DL data PDU, e.g. an acknowledgement,
which is forwarded to the UE by the RAN.
If UE provided an AS RAI in step 4 which indicated dual packets, or if the
Expected UE Behaviour stored in the UE context in RAN contains a Release
Assistance Information which indicates dual packets (and the AS RAI was not
present), then RAN continues to step 9 and immediately suspends the RRC
connection unless there were both pending DL data in RAN and DL data received
in step 7 by which all DL data is sent to the UE and the RRC connection may be
kept for potential subsequent UL (as a response to the pending DL data).
9\. The RAN suspends the RRC connection to inactive mode after a RAN specific
timeout.
10\. UE enters RRC Inactive mode.
##### 6.7.4.1.2 MO transmission with Early Data Transmission and RRC Inactive
A very efficient data transmission can be achieved for one of the most
frequent small data transmissions scenarios, i.e. one UL message (acknowledged
or unacknowledged). Acknowledgements, if used, are often generated by a
protocol layer such as Small data transmission function (see solution 35). The
Small data transmission function is assumed to be dimensioned for low latency
response of small data communications, allowing the potential acknowledgement
to be included as Early Data Transmission in the RRC Command message. This
enables low delay communication and reduced UE power consumption with a
minimum signalling.
Figure 6.7.4.1.2-1: MO transmission with Early Data Transmission and RRC
Inactive
The UPF-(NEF) entity in the figure above is the UPF-NEF (i.e. Small data
delivery function) in the Indirect Model case (i.e. when NIDD API is used) and
it is a UPF in the Direct Model case.
NOTE: EDT has been agreed in RAN for R15. Work with EDT in R16 will be
started.
0\. A UE decides to send a small data sensor value to the SCS/AS.
1\. The UE is in RRC Inactive and before the UL data PDU can be transmitted a
resume of the radio connection is invoked.
2\. The UL data PDU is included as Early Data Transmission with the RRC Resume
Request.
3\. The RAN finds the UE context using the Resume ID and forwards the UL data
PDU on the N3 interface to the UPF.
If UE provided an AS RAI in step 2 which indicated single packet, or if the
Expected UE Behaviour stored in the UE context in RAN contains a Release
Assistance Information which indicates single packet (and the AS RAI was not
present), then RAN immediately suspends the RRC connection unless there is
pending DL data in RAN by which RAN instead sends a RRC Connection Resume to
the UE (to keep the RRC connection for potential subsequent UL and DL data)
with a pending DL data packet included as Early Data Transmission. Normal
inactivity will in that case trigger the suspension of the RRC Connection.
4\. For the Direct Model case the UPF forwards data to/from the AF (i.e.
SCS/AS). For the Indirect Model case this step is the NIDD API. See for
example the UPF-NEF solution.
5\. The receiver may respond with a DL data PDU, e.g. an acknowledgement.
6\. The RAN receives the DL data PDU before the RRC respond timer expires in
the RAN and the UE provided AS RAI indicated dual packets or if the Expected
UE Behaviour stored in the UE context in RAN indicates dual packets and the AS
RAI was not present, then RAN expects no further data and includes the DL data
PDU as Early Data Transmission with the RRC Connection Release with suspend
indication sent to the UE.
If the RRC respond timer expires without any received DL data and RAN expects
further data (i.e. UE provided AS RAI indicated dual packets, or if the
Expected UE Behaviour stored in the UE context in RAN indicates dual or
multiple packets and the AS RAI was not present), then RAN sends an RRC
Connection Resume to the UE to allow DL data that may have been delayed.
Normal inactivity will in that case trigger the suspension of the RRC
Connection.
If AS RAI was not present and the Expected UE Behaviour stored in the UE
context in RAN indicates multiple packets or does not include any Release
Assistance Information, then RAN determines that further packets _can be_
expected and instead moves the UE to RRC_CONNECED state by sending an RRC
Connection Resume to the UE. Normal inactivity will in that case trigger the
suspension of the RRC Connection.
7\. The UE and RAN enter RRC Inactive mode.
#### 6.7.4.2 MT transmissions
##### 6.7.4.2.0 General
MT transmissions are typically less frequent in massive IoT scenarios, but
nevertheless they need to be handled.
The procedure in clause 6.7.4.2.2 describes RRC Inactive with option a) DL
data buffering in RAN as listed in clause 6.7.1.
The procedure below (clause 6.7.4.2.1) describes RRC Inactive with option b)
DL data buffering in CN as listed in clause 6.7.1.
Some details on availability notifications, are left for KI 3 solutions.
##### 6.7.4.2.1 MT transmission with CN extended buffering at RRC Inactive
This procedure describes option b) DL data buffering in CN as listed in clause
6.7.1.
Figure 6.7.4.2.1-1: MT transmission with CN extended buffering at RRC Inactive
The UPF-(NEF) entity in the figure above is the UPF-NEF (i.e. Small data
delivery function) in the Indirect Model case (i.e. when NIDD API is used) and
it is a UPF in the Direct Model case.
0\. Extended Data Buffering is established when RAN transition a UE using eDRX
to RRC Inactive state, the RAN sends a N2 Notification to AMF. RAN provides
buffering support information if there is any. AMF uses the
Nsmf_PDUSession_UpdateSMContext service to pass the buffering info (i.e.
buffering duration) to SMF. SMF uses N4 messages to remove UPF N3 DL tunnel,
activate extended buffering of DL data and set the Buffering duration.
1\. DL data arrives.
2\. DL data is buffered in the UPF based on step 0b.
3\. The SMF requests a UE reachability report via
Namf_MT_EnableUEReachability, based on N4 data notification from UPF.
The SMF may optionally just wait for the next MO data from UE in step 6 to
trigger the sending of downlink data without invoke enabling the UE
reachability reporting.
4\. The AMF may use the N2 Notification procedure to retrieve UE reachability
info. RAN may provide new buffering support information, if there is any.
5\. The AMF notifies the SMF with the latest reachability info (either UE is
reachable or still not reachable with potentially new buffering duration). The
SMF uses N4 data request to update buffering duration for the UPF DL Tunnel if
needed.
6\. The UE contacts the network and the AMF either receives an N2 notification
triggered by an RRC resume or an N2 Path Switch Request (if the RRC resume
triggers a RAN node change). The AMF notifies the SMF/UPF of the UE
reachability.
7\. UPF delivers the buffered DL data to the UE.
8\. For the Indirect Model, the interaction with the AF is according to the
NIDD API. See for example the UPF-NEF solution.
9\. RAN moves the UE to RRC Inactive state after a user inactivity timeout or
based on Release Assistance Information if available in Expected UE Behavior.
Depending on sleep cycle length and local configuration the RAN may then
execute step 0 above and re-establish the CN extended data buffering in
SMF/UPF, otherwise RAN buffering is used at next DL data event.
NOTE: If the UE does not contact the network before expiry of the extended
buffering duration timer, the buffered data may be discarded in the SMF/UPF.
##### 6.7.4.2.2 MT transmission with RAN buffering at RRC Inactive
Figure 6.7.4.2.2-1: Mobile Terminated data with RAN buffering at RRC inactive
procedure
1\. The UPF sends a DL data PDU towards the UE. RAN buffer the DL data during
RAN paging (if necessary) or during the UE sleep cycle (if power saving method
is used).
NOTE: The AMF may use CN buffering (clause 6.7.4.2.1 or 6.7.4.2.3) if the UE
uses eDRX with sleep cycles longer than e.g. one minute.
2\. RAN delivers to UE when UE becomes reachable.
3\. RAN moves the UE to RRC Inactive state after a user inactivity timeout or
based on Release Assistance Information if available in Expected UE Behavior.
### 6.7.5 Impacts on existing entities and interfaces
This solution uses and is dependent on the solution in clause 6.38. In
addition, the following impacts to existing entities and interfaces exists:
RAN:
\- Send buffering info with remaining eDRX interval to AMF.
\- Support for EDT is optionally needed.
\- RAN paging with extended unreachable cycles.
\- N2 notifications procedure of UE reachability.
AMF:
\- New parameter in the Nsmf_PDUSession_UpdateSMContext service to pass
buffering info (i.e. buffering duration) to SMF.
\- Handling of \'Availability after DDN failure\' monitoring event based on N2
Notification of DL data failure at RRC Inactive.
\- N2 notifications procedure of UE reachability.
SMF:
\- Send buffering info (i.e. buffering duration) to UPF.
UPF:
\- Extended buffering while UEs are sleeping.
### 6.7.6 Evaluation
The solution uses the CM-CONNECTED with RRC_INACTIVE state and the Early Data
Transmission optimization when applicable, to transmit MO and MT small data in
a resource efficient system signalling manner, especially over the radio
interface.
The solution supports delivery of IP data and Unstructured (Non-IP) data.
The solution can be used to convey small data over N6, i.e. the Direct Model
case, and over a northbound API at NEF, i.e. the Indirect Model case. In the
latter case the solution can use e.g. solution 35 to provide the API.
The solution uses the 5GS user plane security mechanisms, has minimum AS
impacts and can use the charging, roaming and policy control that exists in
the 5GS.
## 6.8 Solution 8: Enhancing MICO for Mobile terminated data/signaling
### 6.8.1 Introduction
#### 6.8.1.1 General
This solution applies to Key issue 4: Power Saving Functions, Track 2. The
solution is based on keeping a UE, using MICO mode, in CM_CONNECTED and
RRC_CONNECTED state until at least all pending downlink data and/or signalling
has been delivered to the UE.
### 6.8.2 Functional Description
The following principles apply:
\- For mobile terminated data while a UE is in MICO mode, functions for Key
Issue 3: High latency communication are used.
\- When the AMF knows there may be MT data, MT SMS, network originated
signaling or any other DL message pending, the AMF maintains the N2 connection
and provides a Connected time value to the RAN.
\- The Connected time value indicates the minimum time the RAN should keep the
UE in RRC_CONNECTED state regardless of inactivity. The Connected time value
is provided in N2 Request carrying:
\- NAS Registration Accept message; or
\- NAS Service Accept message.
\- If the RAN node receives a Connected time value, the RAN shall keep the UE
in RRC_CONNECTED for at least the indicated duration. Once the Connected time
has elapsed and the RAN inactivity timer has also expired, the RAN releases
the UE\'s RRC connection.
NOTE 1: The RAN node may release the RRC connection after the Connected time
has elapsed and the RAN inactivity timer has also expired. Alternatively, the
RAN node may set the RAN inactivity timer to the value of the Connected time,
and release the RRC connection after the RAN inactivity timer has expired.
NOTE 2: The C-DRX is assumed to be configured to similar value as I-DRX e.g.
1.28s, 2.56s, 5.12s or even 10.24s.
\- The AMF takes the Maximum Response Time if provided by the UDM, and any
local AMF configuration into account for determining the Connected time value.
\- On the UE side, in MICO mode, if the UE moves to CM-IDLE for any reason
other than a successful RRC release procedure, e.g. due to RLF, the UE shall
initiate NAS recovery, even if the registration procedure has been completed
successfully.
NOTE 3: This is current Rel-15 UE behavior, i.e. this does not imply
additional UE impacts.
### 6.8.3 Support of EPC interworking
Rel-15 MICO and PSM interworking applies according to TS 23.501 [5] clause
5.17.2.1, as this solution has no additional NAS impacts.
On the T8 and Nnef reference points the same parameter Maximum Response Time
is used in EPC (e.g. for PSM) and 5GS for MICO, respectively.
### 6.8.4 Procedures
No modification to procedure call flows, only Connected time information is
added to N2 Request from AMF to RAN node.
### 6.8.5 Impacts on existing entities and interfaces
In AMF:
\- Decide on a Connected time to be provided to RAN based on Maximum Response
Time if available and local configuration, and provide value to RAN.
In RAN:
\- Maintain RRC connection for at least the received Connected time, if
received from the AMF.
In UE:
\- No impacts identified.
### 6.8.6 Evaluation
The solution proposes an enhancement for mobile terminated data/signalling by
introducing a minimum time to keep the UE in RRC_CONNECTED (the Connected
time). There are no modifications to the procedure call flows, only the
Connected time information is added to N2 Request from AMF to RAN node. RAN
WGs may provide a more precise analysis of actual power saving based on the UE
power consumption in the different RRC states.
The solution addresses the following architectural requirements for Key
Issue#4:
\- Solutions shall enable UE power savings while also supporting delay-
sensitive mobile terminating communications triggered by mobile originated
communications.
## 6.9 Solution 9: Enhanced MICO mode with Active Time
### 6.9.1 Introduction
This solution addresses Key Issue #4 (Power Saving Functions). The proposal is
to enable a PSM (Power Saving Mode) equivalent feature from EPS in 5GS. In
order to do so, the Mobile Initiated Connection Only (MICO) mode (see TS
23.501 [5] clause 5.4.1.3) is enhanced with an optional Active Time to realize
power saving. Active Time is meant to be only used in combination with MICO
mode. This solution is a NAS based solution with no RAN impact that allows for
deep sleep periods of up to similar duration as in EPS PSM.
### 6.9.2 Functional Description
As the 5GC has a different architecture and some new functionality compared to
EPC, some adaptions are needed compared to PSM in EPS:
**Handling of Active Time and interaction with MICO mode:**
In EPC if the UE wants to use the PSM, it shall request an Active Time value
during every Attach and TAU/RAU procedures. If the network supports PSM and
accepts that the UE uses PSM, the network confirms usage of PSM by allocating
an Active Time value to the UE. In EPS the UE and the MME/SGSN starts the
Active timer with the Active Time value allocated by the network when
transitioning from ECM_CONNECTED to ECM_IDLE.
The same principles can be used on 5GC, with the difference that in 5GS the
MICO mode is a new feature not supported in EPS.
A UE in MICO mode need not listen to paging while in CM-IDLE. A UE in MICO
mode may stop any access stratum procedures in CM-IDLE, until the UE initiates
transition from CM-IDLE to CM-CONNECTED. When the AMF indicates MICO mode to a
UE, the AMF considers the UE always unreachable while the UE CM state in the
AMF is CM-IDLE and the Active timer expires. The AMF rejects any request for
downlink data delivery for UE in MICO mode and whose UE CM state in the AMF is
CM-IDLE with an appropriate cause. The proposal is therefore to apply PSM
functionality on MICO mode terminals if applicable: the **UE may indicate its
preference for MICO mode and optionally request an Active Time value during
Initial Registration or Registration Update procedure. The AMF, based on local
configuration, Expected UE Behaviour if available, UE indicated preferences,
UE subscription information and network policies, or any combination of them,
determines whether MICO mode is allowed and optionally an Active Time value
for the UE, and indicates it to the UE during Registration procedure. If the
UE does not indicate preference for MICO mode during Registration procedure,
the AMF shall not activate MICO mode for this UE. When the AMF allocates the
active time, the AMF should not allocate all PLMN Registration Area to the
UE.**
**The UE and AMF start the Active timer with the Active Time value allocated
by the network when transitioning from CM_CONNECTED state to CM_IDLE state.
When the Active timer expires, the UE enters the MICO mode. The UE and the AMF
re-negotiate the MICO mode and the Active Time value at every subsequent
Registration procedure. When the UE is in CM-CONNECTED, the AMF may deactivate
MICO mode by triggering Registration Update procedure through UE Configuration
Update procedure.**
**Mobile terminated data:**
As indicated in Key Issue #4, the reachability and buffering aspects will be
addressed in the key issue on high latency communication.
**SCS/AS influencing the configuration of the power savings functions:**
In EPS the SCS/AS may issue network parameter configuration requests to the
network, via the SCEF, to suggest parameter values that may be used for
Maximum Latency, Maximum Response Time and Suggested Number of Downlink
Packets. By suggesting values for these parameters, the SCS/AS may influence
certain aspects of UE/network behaviour such as the UE\'s PSM, extended idle
mode DRX, and extended buffering configurations.\ In 5GC the support for
SCS/AS influencing the configuration of the power savings functions shall at
least be at the same level as in EPS. The solution for this will be handled in
the key issue \"Network Parameter Configuration API via NEF\" (see NOTE 1 in
Key Issue #4).
### 6.9.3 Support of interworking
Interworking when a UE is in MICO mode (defined in TS 23.501 [5] clause
5.17.2.1) is reused, where the UE shall locally disable MICO mode and perform
the TAU or Attach procedure as defined in TS 23.501 [5] clause 5.17.2 which
may include PSM (re-)negotiation. When the UE moves back to 5GC from EPC it
locally disables PSM and MICO mode with or without Active Time can be
renegotiated during the (re-)registration procedure.
### 6.9.4 Procedures
The existing procedures in 5GC will be reused to handle the Active Time
signalling between the AMF and UE, by considering also subscription data. In
particular, the negotiation procedure of enhanced MICO mode with Active Time
is depicted as follows.
Figure 6.9.4-1: Negotiation procedure of enhanced MICO mode with Active Time
1\. UE may indicate preference for MICO mode and optionally request an Active
Time value during Initial Registration or Registration Update procedure.
2\. The AMF may retrieve the UE subscription information from the UDM.
NOTE: The UE subscription information may include the Expected UE behaviour
(see Solutions for Key Issue #13).
3\. The AMF, based on local configuration, Expected UE Behaviour if available,
UE indicated preferences, UE subscription information and network policies, or
any combination of them, determines whether MICO mode is allowed and
optionally an Active Time value for the UE.
4\. The AMF indicates the MICO mode indication and optional an Active Time
value to the UE in the Registration Accept message. The AMF may also provide a
Periodic registration timer in the Registration Accept message to decide the
power saving interval for the UE.
5\. After the Registration procedure completed, the UE and AMF start the
Active timer with the Active Time value allocated by the network when
transitioning from CM_CONNECTED state to CM_IDLE state. When the UE and the
AMF enter CM-CONNECTED state from CM-IDLE state during the Active timer is
running, the UE and the AMF stops the Active timer.
6 After the Active timer expires, the UE enters the MICO mode. The AMF
considers the UE is not reachable for paging.
### 6.9.5 Impacts on existing entities and interfaces
AMF:
\- Determines Active Time value and indicates it to the UE in the Registration
Accept message.
UE:
\- Indicates the preferred Active Time value to the AMF in the Registration
Request message.
\- Runs the Active timer as received from the AMF.
### 6.9.6 Evaluation
The solution proposed to enhance MICO mode with an Active Time. The UE and
network can negotiate MICO mode and Active Time during Registration procedure.
The solution is based on the same principle as Power Saving Mode in EPS.
The solution addresses the following Architectural Requirements for Key
Issue#4:
\- Solutions shall enable UE power savings while also supporting mobile
terminating communications with a delay governed by the duration of the UE\'s
sleep cycles.
\- Sleep cycle durations supported by 5GC should be the same as supported by
eDRX and PSM in EPC.
## 6.10 Solution 10: Solution for supporting High Latency Communication
### 6.10.1 Introduction
This solution addresses the Key Issue 3 - \"High Latency Communication\".
### 6.10.2 Functional Description
Functions for High latency communication can be used to handle mobile
terminated (MT) communication with UEs being unreachable while using power
saving functions in 5GS.
High latency communication is handled by notification procedures requested by
NFs, e.g. AF, SMF, UPF, when a UE wakes up from its power saving state and
sends downlink data to the UE when the UE is reachable. This notification
procedure is based on notification service operations including UE
Reachability, and Availability after DDN (downlink data notification) failure.
For UE allowing high latency communication, the following two notification
service operations can be used to optimize system resources and reduce
signaling overhead:
\- UE reachability notification for MT communication.
\- UE availability notification procedure after DDN failure.
### 6.10.3 Support of interworking
The same principle of solution 24 applies.
### 6.10.4 Procedures
#### 6.10.4.1 Support for UE Reachability Notification for Mobile Terminated
Communication
The network can accommodate the UE with scheduled MT communication, e.g. the
AF/SMF subscribes the notification service from the AMF for the UE
reachability.
For AF requesting event exposure from the AMF for the UE reachability
notification, the AF can buffer the packets for MT communication before
receiving the notification.
Further, the SMF can request event exposure from the AMF for the UE
reachability. There are two alternatives to handle DDN due to MT communication
when the UPF receives the MT packets.
**Alternative 1:**
1\. The UPF notifies the SMF for the downlink packets by sending DDN.
2\. The SMF checks the UE\'s reachability and determines if it needs to send
the DDN to the AMF or not.\ \ If the UE is in power saving mode, the SMF
notifies the UPF to buffer the packets and indicates the buffer size, expected
time for UE\'s availability, e.g. next time to be in idle state.\ \ If the UE
is in idle mode, the SMF further sends the DDN to the AMF.
**Alternative 2:**
1\. The SMF has notified the UPF about the buffering information according to
the UE reachability.
2\. The UPF buffers the packets accordingly and sends the DDN only after
reaching the maximum size of the buffering.
Further, if the UE is in CM-CONNECTED mode with RRC INACTIVE, extended
buffering may be done at RAN. If RAN based paging fails or if RAN notification
update guard timer expires RAN initiates AN release and send buffered data to
AMF. AMF can then initiate CN based paging and take further action as
specified in clause 6.10.4.2 step 4 onwards.
#### 6.10.4.2 Support for UE Availability Notification Procedure after DDN
Failure
The AF/SMF/UPF can subscribe to UE availability notification after DDN
failure.
For the AF requesting event exposure from the AMF for the UE availability
notification after DDN failure, the AF buffers the packets for MT
communication before receiving the notification for UE availability.
For the SMF subscribing UE availability notification after DDN failure, the
UPF buffers the packets for MT communication until receiving the notification
for UE availability from the AMF or reaching the buffering criteria indicated
by the SMF/AMF.
For the UPF subscribing UE availability notification after DDN failure, the
UPF buffers the packets for MT communication until receiving the notification
for UE availability from the AMF/SMF or reaching the buffering criteria
indicated by the AMF/SMF.
Figure 6.10.4.2-1 shows the notification procedure subscribed by the SMF for
UE availability after DDN failure.
Editor\'s note: It is FFS for the notification procedure subscribed by UPF/AF
for UE availability notification after DDN failure.
Figure 6.10.4.2-1: Notification procedure for UE availability after DDN
failure
1\. The UPF receives downlink data packets from data network.
2\. The UPF sends downlink data notification message to the SMF.
3\. When a SMF sends DDN (downlink data notification) to the AMF, it indicates
also if it subscribes the notification service from the AMF for the UE
availability when DDN failure.
4\. The AMF may initiate paging procedure.
5\. The DDN failure may be of many causes: paging failure, the paging
suspension due to activated MICO mode, the UE activates high latency
communication. If the DDN failure happens, the AMF replies to the SMF for the
DDN failure with an indication for confirming the notification service for the
next UE availability. Further, the AMF may base on UE\'s reachability
information to calculate buffering info and then include the following
information in DDN response message: the buffer size (number of packets),
buffering time, expected UE reachable time.
6\. The SMF forwards the buffering information to the UPF. The UPF starts to
buffer packets according to the received buffering info.
7\. The UE contacts the AMF via registration update procedure.
8\. The AMF notifies the SMF/UPF for the UE availability.
9\. The UPF starts to deliver buffered downlink packets.
### 6.10.5 Impacts on existing entities and interfaces
Impacts on AMF:
\- Support for UE Reachability Notification from AF and SMF;
\- Support for UE Availability Notification Procedure after DDN Failure from
AF/SMF/UPF.
Impacts on SMF:
\- Support subscribing to UE availability notification after DDN failure, and
indicate buffering information to UPF.
\- Requesting event exposure from the AMF for the UE reachability, checking
the UE\'s reachability and determining if it needs to send the DDN to the AMF
or not, and notification to the UPF to buffer packets and indicate the buffer
size, expected time for UE\'s availability, if necessary;
Impacts on UPF:
\- Support subscribing to the UE availability notification after DDN failure;
\- Buffer the packets for MT communication until receiving the notification
for UE availability from the AMF/SMF or reaching the buffering criteria
indicated by the AMF/SMF.
### 6.10.6 Evaluation
The solution proposes two notification procedures for mobile terminated
communication, UE reachability notification and UE availability notification
procedure after DDN failure. The solution also combines the downlink packet
buffering function with the notification procedure, increasing the complexity
of MT communication handling for AMF/SMF/UPF.
The solution addresses the architectural requirements of key issue 3 to
\"provide the AF (i.e. SCS/AS) with UE status information (e.g. reachability
notification or the time when the UE is expected to be reachable)\".
## 6.11 Solution 11: Extended buffering in SMF and NEF
### 6.11.1 Introduction
This solution addresses Key Issue 3 (High latency communication).
High latency communication is handled by extended buffering of downlink data
in the SMF. The AMF indicates to the SMF when the UE is expected to wake up
from its power saving state. Based on such indication, the SMF triggers
extended buffering. Buffering may be performed by the SMF or the UPF as
currently defined in TS 23.501 [5]. This solution focuses on when extended
buffering is performed in the SMF.
### 6.11.2 Functional Description
**The handling is specified in the Network Triggered Service Request
procedure. When the downlink data is received, the UPF sends the data
notification to the SMF, and the SMF indicates the AMF to page the UE.**
**The AMF then detects that the UE is in a power saving state (e.g. MICO) and
cannot be reached by paging at the moment. The AMF optionally indicates to the
SMF together with the expected time radio bearers can be established to the
UE** and a DL Buffering Suggested Packet Count**.**
### 6.11.3 Support of interworking
Interworking with EPC is achieved by a combined PGW-C+SMF. If an SMF has data
buffered for a UE when the UE moves to EPC and becomes reachable then buffered
data will get delivered in EPC via the P-GW-U. If an S-GW has data buffered
for a UE when the UE moves to 5GC and becomes reachable then the buffered data
will be sent to the PGW-U+UPF by the S-GW and will be delivered in 5GC via the
UPF.
Editor\'s Note: The details of how buffered data is forwarded in the
interworking case are FFS.
### 6.11.4 Procedures
#### 6.11.4.1 Data Transfer via N6 interface
The procedure of extended buffering for Data Transfer via N6 interface is
depicted as following.
Figure 6.10.4.1-1: Extended buffering for Data Transfer via N6 interface
0\. The UE is assumed to be temporarily unavailable (i.e. in some power saving
state).
1\. When the first downlink data packet is received, the UPF sends a Data
Notification message to the SMF. The SMF replies with a Data Notification Ack
message to the UPF. The UPF forwards the downlink data packets towards the
SMF.
2\. The SMF determines that Extended Buffering is possible.
3\. The SMF contacts the AMF and invokes the
Namf_Communication_N1N2MessageTransfer to the AMF. Based on PCC rules, the SMF
indicates to the AMF whether extended buffering is possible or not.
**4\. The AMF detects that the UE is in a power saving state (e.g. eDRX or
MICO) and cannot be reached by paging at the moment**.
5\. Based on the status of the UE of step 4, the AMF sends a
Namf_Communication_N1N2MessageTransfer response to the SMF indicating that the
DL buffering is requested due to the UE in power saving state and temporarily
unreachable and the maximum wait time**.**
6\. The SMF stores the DL Data for the maximum wait time and does not send any
additional Data Notification if subsequent downlink data packets are received.
NOTE: The DL Buffering Suggested Packet Count is derived from the subscription
information which is provided by the SCS/AS via T8 API.
Editor\'s Note: Whether the AMF or SMF determines the DL Buffering Suggested
Packet Count is FFS.
7a or 7b. The UE triggered Service Request procedure or Periodic Registration
procedure may occur.
8\. When receiving UE reachable indication in step 6, the SMF sends the
buffered downlink data to the UE.
#### 6.11.4.2 Data Transfer via API
For MT Data that is sent via the NEF, the buffering should happen in the NEF.
The same principle of clause 6.11.4.1 applies to DL data buffered in the NEF
in case of data transfer via APIs. For data transfer via NEF, the NEF uses the
same interactions with the SMF as the UPF uses in Figure 6.11.4.1-1.
### 6.11.5 Impacts on existing entities and interfaces
AMF:
\- Indicates DL buffering requested and maximum wait time to the SMF.
SMF:
\- Based on indication of AMF that the DL buffering is requested, it triggers
extended buffering.
\- Buffers downlink data.
### 6.11.6 Evaluation
Solution 11 proposes extended buffering for high latency communication. The
SMF triggers extended buffering locally based on the indication of unreachable
UE sent by the AMF. The solution meets the following Architectural Requirement
of Key Issue 3: \"Send DL data to UEs at the earliest possible opportunity
when the UEs are applying power saving functions\".
## 6.12 Solution 12: Solution for Management of Enhanced Coverage for 5GC
### 6.12.1 Introduction
This solution addresses the Key Issue 6 - \"Management of Enhanced Coverage\".
### 6.12.2 Functional Description
#### 6.12.2.1 Support of Enhanced Coverage
The UE shall indicate its capability of support for Enhanced Coverage (i.e. CE
mode B capability support) in the Initial Registration or Registration Update
Request message to the AMF. The AMF stores UE capability of support for
enhanced Coverage in the UE context in AMF.
#### 6.12.2.2 Support of restriction of use of Enhanced Coverage
The usage of Enhanced Coverage may require use of extensive resources (e.g.
radio and signalling resources) from the network. Specific subscribers can be
restricted to use Enhanced Coverage feature through Enhanced Coverage
Restricted information that is stored in UDM as part of subscription data and
specifies per PLMN whether the Enhanced Coverage functionality is restricted
or not for the UE. Enhanced Coverage Restricted information indicates whether
CE mode B is restricted for the UE, or both CE mode A and CE mode B is
restricted for the UE, or both CE mode A and CE mode B is not restricted for
the UE.
The AMF receives Enhanced Coverage Restricted information from the UDM during
registration procedure. AMF based on local configuration, UE Usage setting, UE
subscription information and network policies, or any combination of them,
determines whether Enhanced Coverage (i.e. CE mode B or both CE mode B & CE
mode A) is restricted for the UE and stored updated Enhanced Coverage
restriction information in the UE context in AMF. If the UE usage setting
indicated that UE is \"voice centric\" then the AMF shall set CE mode B
restricted for the UE in Enhanced Coverage restriction information.
The AMF sends Enhanced Coverage Restricted information to the UE in the
Registration Accept message. The UE shall use Enhanced Coverage Restricted
information to determine if Enhanced Coverage is restricted or not. The AMF
provides an Enhanced Coverage Restricted information to the RAN via N2
signalling whenever the UE context is established in the RAN, e.g. during N2
Paging procedure, Service Request procedure, initial Registration and periodic
Registration procedure.
For roaming UEs, if the UDM doesn\'t provide any Enhanced Coverage Restricted
information or the provided Enhanced Coverage Restricted information is in
conflict with the roaming agreement, the AMF uses default Enhanced Coverage
Restricted information locally configured in the VPLMN based on the roaming
agreement with the subscriber\'s HPLMN.
The UE that indicates its support Enhanced coverage over N1 interface shall
also support restriction of the Enhanced Coverage over N1 interface. The UE
shall assume that restriction for use of Enhanced Coverage is same in the
equivalent PLMNs.
### 6.12.3 Support of EPC interworking
#### 6.12.3.1 IDLE Mode aspects
\- When UE moves from 5GS to EPS, the UE context information sent by AMF to
MME includes the Enhanced Coverage Restricted information. MME determines
Enhanced Coverage Restricted parameter and CE mode B restricted parameter from
Enhanced Coverage Restricted information and stores it in MME\'s MM context.
\- When UE moves from EPS to 5GS, the MME\'s MM context information sent by
MME to AMF includes the Enhanced Coverage Restricted parameter and CE mode B
restricted parameter. AMF determines Enhanced Coverage Restricted information
from CE mode B restricted parameter and Enhanced Coverage Restricted parameter
and stores it in the UE context at AMF.
#### 6.12.3.2 CONNECTED Mode aspects
\- When a UE is CM-CONNECTED in 5GC and a handover to EPS occur, source NG-RAN
provides Enhanced Coverage Restricted information to the target eNB.
\- When a UE is CM-CONNECTED in EPS and a handover to 5GC occur, source eNB
provides Enhanced Coverage Restricted information to the target NG RAN.
### 6.12.4 Procedures
#### 6.12.4.1 Procedure for restriction of use of Enhanced Coverage
{width="6.136805555555555in" height="3.126388888888889in"}
Figure 6.12.4.1-1: Procedure for restriction of use of Enhanced Coverage
1\. The UE sends N1 registration Request message to AMF with UE Enhanced
Coverage (EC) support capability indication.
2\. The AMF retrieves the subscription data for the UE from the UDM using
Nudm_SDM_Get service operation. UDM may retrieve this information from UDR by
Nudr_UDM_Query (Access and Mobility Subscription data). This includes also the
E _nhanced Coverage Restriction information_ (i.e. CE mode B is restricted for
the UE, or both CE mode A and CE mode B is restricted for the UE, or both CE
mode A and CE mode B is not restricted for the UE).
3\. AMF based on local configuration, UE Usage setting, UE subscription
information and network policies, or any combination of them, determines
whether Enhanced Coverage (i.e. CE mode B or both CE mode B & CE mode A) is
restricted for the UE and stored updated Enhanced Coverage restriction
information in the UE context in AMF _._
4\. The AMF sends Enhanced Coverage Restricted information to the UE in the
Registration Accept message. The AMF also provides an Enhanced Coverage
Restricted information to the RAN via N2 signalling.
5\. The UE shall use the Enhanced Coverage Restricted information to determine
if Enhanced Coverage is restricted or not.
#### 6.12.4.2 Enhanced Coverage Restriction Control and via NEF
The support for Enhanced Coverage Restriction Control via NEF enables 3rd
party service providers to query status of, enhanced coverage restriction or
enable/disable enhanced coverage restriction per individual UEs.
{width="5.909027777777778in" height="4.795833333333333in"}
Figure 6.12.4.2-1: Procedure for Enhanced Coverage Restriction Control and via
NEF
1\. The AF/AS uses Nnef_ECRestriction_Update ( ) request service operation in
order to enable/disable Enhanced Coverage restriction or
Nnef_ECRestriction_Status_Get ( ) service operation to query the status of
enhanced coverage restriction. Both service operation includes External
Identifier or MSISDN and AS/AF Identifier as required input. Enhanced Coverage
Restriction Data provides an indication to either enable or disable the
enhanced coverage restriction and is required input for
Nnef_ECRestriction_Update ( ) request service operation only.
2\. If either the AS/AF is not authorized to perform this request (e.g. if the
SLA does not allow for it), or the AS/AF has exceeded its quota or rate of
submitting Enhanced Coverage requests, the NEF indicates service operation
failure to AS/AF with appropriate cause code and flow stops here. Otherwise
the flow continues to step 3.
3\. The NEF uses Nudm_SDM_Update ( ) service operation to update the
subscription data for Enhanced Coverage restriction. The NEF uses Nudm_SDM_Get
( ) service operation to query the status of for Enhanced Coverage
restriction. UDM may retrieve this information from UDR by using
Nudr_UDM_Query ( ) service operation.
4\. For Nudm_SDM_Update ( ) when the subscriber data for Enhanced Coverage
restriction is updated at the UDM, serving NF (i.e. AMF in this case) is
notified with the updated Enhanced Coverage restriction information in the
subscription data. AMF may subscribe for the notification for Enhanced
Coverage restriction information change.
In case of Nudm_SDM_Get ( ) service operation steps 5 & 6 are skipped.
5\. The UDM uses Nudm_SDM_Notification ( ) service operation and provide AMF
with updated Enhanced Coverage restriction information.
6\. The AMF updates Enhanced Coverage restriction information stored in the UE
context at AMF. The AMF will transfer the Enhanced Coverage Restricted
Information stored as part of its UE context during AMF change.
NOTE: UE is informed of the updated Enhanced Coverage Restricted information
at the next Registration procedure, or based on the local policy the network
can de-register the UE indicating re-registration is required.
7\. The UDM sends response of Nudm_SDM_Update ( ) / Nudm_SDM_Get ( ) service
operation to the NEF.
8\. The NEF sends response of Nnef_ECRestriction_Update ( ) /
Nnef_ECRestriction_Status_Get ( ) service operation to the AS/AF.
### 6.12.5 Impacts on existing entities and interfaces
UE:
\- Indicate Enhanced Coverage support capability indication to the AMF.
\- Receives Enhanced Coverage Restriction Information as part of N1 procedure
(i.e. Initial and periodic Registration Accept).
\- Stores Enhanced Coverage Restriction Information per PLMN and use Enhanced
Coverage mode based on Enhanced Coverage restriction Information provided by
the AMF.
RAN:
\- Receives an Enhanced Coverage Restricted information from the AMF via N2
signalling whenever the UE context is established in the RAN, e.g. during N2
Paging procedure, Service Request procedure, initial Registration and periodic
Registration procedure.
\- Determines if UE is restricted to operate in Enhanced Coverage mode based
on the Enhanced Coverage Restriction information provided by the AMF.
AMF:
\- Receives Enhanced Coverage Restriction information as part of subscription
data from the UDM.
\- Based on local configuration, UE Usage setting, UE subscription information
and network policies, or any combination of them, determines whether Enhanced
Coverage (i.e. CE mode B or both CE mode B & CE mode A) is restricted for the
UE.
\- Stores Enhanced Coverage Restriction information as part of UE context in
AMF.
\- The AMF provides an Enhanced Coverage Restricted information to the UE via
N1 signalling (i.e. during N2 during initial Registration and periodic
Registration procedure.)
\- Provides an Enhanced Coverage Restricted information to the RAN via N2
signalling whenever the UE context is established in the RAN, e.g. during N2
Paging procedure, Service Request procedure, initial Registration and periodic
Registration procedure..
UDM/UDR:
\- Contains Enhanced Coverage Restriction information as part of subscription
data. UDM may retrieve it from the UDR.
\- Support new Nudm_SDM_Update ( ) service operation with NEF as consumer to
update the subscription data for Enhanced Coverage restriction.
\- Interface with NEF to provide status of Enhanced Coverage restriction using
updated Nudm_SDM_Update ( ) service operation with NEF as consumer.
NEF:
\- Support new Nnef_ECRestriction_Update ( ) request service operation with
AS/AF as consumer in order to enable/disable Enhanced Coverage restriction.
\- Support new Nnef_ECRestriction_Status_Get ( ) service operation with AS/AF
as consumer to query the status of enhanced coverage restriction.
### 6.12.6 Evaluation
The solution is based on the same principles as in EPS. Main difference is in
terms of messages carrying the EC related information for 5G system.
The solution addresses all Architectural Requirements for the key issue#6 -
Management of Enhanced Coverage.
## 6.13 Solution 13: SCEF+NEF Node
### 6.13.1 Introduction
This clause presents a solution for Key Issue 9 - Support of common north-
bound APIs for EPC-5GC Interworking.
The following principles apply to this solution:
\- As a general architecture principle, the 3GPP network topology should be
hidden from the AF (corresponding to SCS/AS in EPS); thus, we should avoid a
situation where the AF needs to be aware of whether the UE is served by EPC or
5GC. The AF should not have to change the network node that it contacts when a
UE moves between 5G and EPC.
\- Configuration of common services that are supported by EPC and 5GC should
not be dependent on whether the UE is attached to 5GC or EPC, thus the APIs
that are used by the AF or SCS/AS to access a given service should not depend
on whether the UE is attached to EPC or 5GC. Using 3rd party APIs an AF
however maybe able to find the access technology the UE is currently
connected. Consequently, an AF can access the available 3rd party services
with the expected level of support available under that technology.
\- If the availability or expected level of support of a service API
associated with a UE changes, for example due do to a mobility between 5GC and
EPC, the AF or SCS/AS can be made aware of the change. Note that the same
principle already applies in EPC where the SCEF is notified if the UE switches
to being served by an MME that does not support a configured monitoring event.
\- For a given UE, the node that the AF or SCS/AS contacts for some services
is configured in the network. The same is already true in EPC. For example,
with respect to NIDD, the SCEF ID associated with the UE for a NIDD PDN
Connection is provided to the MME by the HSS during T6a connection
establishment. For other features (e.g. Device Triggering, Group Message
Delivery MBMS, and NIDD) TS 23.682 [6] recommends that the SCS/AS may
determine the IP address(es)/port(s) of the SCEF associated with a UE by
performing a DNS query using the External Identifier or using a locally
configured SCEF identifier.
\- A UE can be associated with different exposure nodes for each service. The
same is already true in EPC. For example, one SCEF might be used for
monitoring, another SCEF instance might be used for NIDD to one APN, and yet
another SCEF instance might be used for NIDD to another APN.
### 6.13.2 Functional Description
When a UE is capable of switching between EPC and 5GC, it shall only be
associated with combined SCEF+NEF node(s) for Service Capability Exposure. The
SCEF+NEF hides the underlying network topology from the AF (i.e. SCS/AS) and
hides whether the UE is served by 5GC or EPC. Figure 6.13.2-1 shows the
SCEF+NEF architecture.
{width="6.683333333333334in" height="3.341666666666667in"}
Figure 6.13.2â€‘1: Architecture view of the SCEF+NEF node
Interaction between the SCEF and NEF within the combined SCEF+NEF is required.
For example, when the SCEF+NEF supports monitoring APIs, the SCEF and NEF need
to share context/state information about a UE\'s configured monitoring events
in case the UE between from EPC and 5GC. This interaction between the SCEF and
NEF shall not be standardized. The common state information is characterized
as information that needs to be maintained by the combined SCEF+NEF node in
order to meet the external interface requirements of the combined node.
The common state information includes at least the following data that needs
to be identical in a combined SCEF+NEF:
\- SCEF+NEF ID (must be the same towards the AF / SCS/AS).
\- SCEF+NEF common IP address and port number.
\- Monitoring state for any ongoing monitoring request.
\- Configured set of APIs supported by SCEF+ NEF.
\- PDN Connection/PDU Session State and NIDD Configuration Information,
including Reliable Data Service state information.
\- Network Parameter Configuration Information (e.g. Maximum Response Time and
Maximum Latency).
If a configured service becomes unavailable or its level of support changes
because of change of access network for a UE, the SCEF+NEF will notify the
SCS/AS. A configured service may become unavailable because the UE is now
being served by a node (e.g. MME) or NF (e.g. AMF) that does not support the
configured service.
If the service exposure function that is associated with a given service for a
UE is configured in the UE\'s subscription information, then an SCEF+NEF
identity shall be used to identify the exposure function. For example, if a UE
is capable of roaming between EPC and 5GC, then the SCEF ID that is associated
with any of the UE\'s APN configurations should point to an SCEF+NEF node.
In EPC, the SCEF is part of the HPLMN. This solution assumes that an NEF or
SCEF+NEF that exposes API\'s to 3rd party AFs (i.e. SCS/AS) is part of the
HPLMN.
### 6.13.3 Support of EPC interworking
As noted above, interaction between the SCEF and NEF in the SCEF+NEF need not
be standardized, even though the architectural data requirements implied by
the external interfaces are specified.
Consistent with existing EPS-5GS interworking scenarios in TS 23.501 [5], the
subscriber data base is managed by a combined HSS+UDM node. Thus, SCEF+NEF
implementations need not perform the same procedures with the HSS+UDM twice.
For example, monitoring events only need to be configured by the SCEF+NEF one
time, by using either EPC or 5GC procedures. In other words, when a monitoring
event has been configured by the SCEF procedures towards the HSS, the NEF need
not repeat the same monitoring event configuration towards the UDM, and vice
versa. Whether the SCEF+NEF uses SCEF or NEF procedures for monitoring event
configuration is an implementation decision.
### 6.13.4 Procedures
Refer to clause 6.14.4 for procedures that show how the SCS/AS or AF
subscribes and unsubscribes to the SCEF+NEF to be notified of service changes
when a UE\'s serving CN Type changes, how the SCEF+NEF notifies the SCS/AS or
AF of service changes when a UE\'s serving CN Type changes, and how the SCS/AS
or AF queries the SCEF+NEF of supporting service.
### 6.13.5 Impacts on existing entities and interfaces
In terms of the CAPIF, the SCEF+NEF should be viewed as a single node.
The API interface that is exposed by the SCEF+NEF interface is an N33 / Nnef
interface that supports the T8 APIs.
### 6.13.6 Evaluation
The solution shows how the API termination point(s) associated with the UE can
remain consistent even when the UE switches between EPC and 5GC.
If the level of support of a given service changes (e.g. due to the UE\'s
mobility between EPC and 5GC), the SCEF+NEF will notify the SCS/AS.
Since the solution continues the EPC assumption that the exposure function(s)
that serve a UE will not change, there is no need to provide a way for the AF
to detect API termination point changes and there is no need to specifty how
the exposure functions to exchange UE context.
## 6.14 Solution 14: APISupportCapability service
### 6.14.1 Introduction
This clause presents a solution for Key Issue 9 - Support of common north-
bound APIs for EPC-5GC Interworking, in particular it addresses the issue of
how the AF becomes aware of the availability/the expected level of a given
service when the UE changes between EPC and 5GC.
This solution assumes that the combined SCEF+NEF node provides a newly defined
service called APISupportCapability. This service relies on a new Event Id and
a new Query service provided by HSS+UDM. The SCEF+NEF node subscribes to this
Event Id or consumes this Query service in order to retrieve the CN Type
(e.g., 5GC or EPC or 5GC/EPC or None) that has most recently served the UE.
With this CN Type information, the APISupportCapability service determines the
availability or expected level of support of common north-bound APIs, this can
be further informed to the north-bound applications via a response to the
request of the applications or via a notification to the subscription of the
applications.
### 6.14.2 Functional Description
When the IoT UE is capable of moving between 5GC and EPC, the UE shall be
associated with a combined HSS+UDM node and a combined SCEF+NEF node for
Service Capability Exposure. The SCEF+NEF hides the underlying network
topology from the AF (i.e. SCS/AS) and whether the UE is served by 5GC or EPC.
The HSS+UDM supports a new CN Type Change Event Id or CN Type Query. Figure
6.14.2-1 shows the proposed architecture when CAPIF function is not supported
for the solution. Figure 6.14.2-2 shows the proposed architecture when CAPIF
function is supported for the solution.
NOTE: The purpose of Figure 6.14.2-1/6.14.2-2 is to simply show the
interaction between the AMF, MME, HSS+UDM, and SCEF+NEF with respect to CN
Type queries, CN Type Change subscriptions, and CN Type Change notifications;
although not shown in the figure, the SCEF+NEF interacts directly with the AMF
and MME in other procedures which are not related to this solution.
If the Service Capability Exposure that is associated with a given service for
a UE is configured in the UE\'s subscription information, then an SCEF+NEF
identity shall be used to identify the exposure function. For example, if a UE
is capable of roaming between EPC and 5GC, then the SCEF ID associated with
any of the UE\'s APN configurations should point to an SCEF+NEF node, if the
SCEF ID is stored in the UE\'s subscription.
Figure 6.14.2â€‘1: Combined NEF+SCEF NF without CAPIF support
Figure 6.14.2â€‘2: Combined NEF+SCEF NF with CAPIF support
Interactions between the SCEF and NEF within the combined SCEF+NEF node is not
required to be standardized.
In the case of architecture without CAPIF support, the AF is locally
configured with the API termination points for each service. In case of
architecture with CAPIF support, the AF obtains the service API information
from the CAPIF core function via the Availability of service APIs event
notification or Service Discover Response as specified in TS 23.222 [20].
For each UE, a service API may become unavailable because the UE is being
served by a node (e.g. MME) or NF (e.g. AMF) even if the service is exposed by
SCEF+NEF.
If a service API provided by SCEF+NEF becomes unavailable or its level of
support changes because of the change of CN Type serving the UE, the SCEF+NEF
node may inform the change to the related AF per the AF\'s subscription to the
API supported Change event.
HSS+UDM supports CN Type Change Event Id. When the HSS+UDM detects that the UE
switches between being served by a MME and an AMF, the CN Type Change Event is
triggered. HSS+UDM supports CN Type Query. When the UE or all members of a UE
Group are being served by a MME, EPC is determined as CN type. When the UE or
all members of a UE Group are being served by an AMF, 5GC is determined as CN
type. When the UE is operating in dual registration mode, i.e. the UE is
registering both in EPC and 5GC, or some members of a UE Group are registering
in EPC while some members are registering in 5GC, 5GC/EPC is determined as CN
type.
SCEF+NEF supports APISupportCapability service, which will be configured on AF
without CAPIF support or discovered by AF with CAPIF support. This service
consists of Subscribe/Unsubscribe/Notification/Get service operations.
SCEF+NEF determines the CN Type locally in the following conditions:
\- The Freshness Timer of last query request is not expired. The Freshness
Timer is a parameter that is configured based on local SCEF policy. When an
APISupportCapability_Query Request is received, the SCEF checks if it recently
retrieved the CN Type for the indicated UE ID or External Group ID. If the
elapsed time since the last retrieval of the CN Type for the indicated UE ID
or External Group ID is less than the Freshness Timer, then the SCEF may
respond to the AF with the CN Type that was last retrieved, thus avoiding
repeated HSS+UDM requests.
\- The SCEF+NEF has established a direct connection with MME or AMF or SMF for
Non-IP data transfer.
Otherwise, SCEF+NEF gets the CN Type serving the UE from HSS+UDM. With the CN
Type information, the SCEF+NEF can determine the availability or expected
level of support of a given service. The third party applications will be
informed of such information.
For the subscription to APISupportCapability service, the subscription may
include the duration of subscription. If the duration of subscription is
expired, the SCEF deletes the subscription to the APISupportCapability service
without any explicit signalling interaction. For the CN type Change event
subscription, the subscription may include the duration of subscription. If
the duration of subscription is expired, the related NF locally unsubscribe
the CN type change event without any explicit signalling interaction.
### 6.14.3 Support of EPC interworking
Consistent with existing EPS-5GS interworking scenarios in TS 23.501 [5] and
TS 23.502 [7].
### 6.14.4 Procedures
#### 6.14.4.1 Subscribe and Notify service operations information flow
{width="6.311805555555556in" height="3.40625in"}
Figure 6.14.4.1-1: APISupportCapability_Subscribe and Notify operations
1\. The AF subscribes to APISupportCapability service for a UE or a group of
UEs by sending APISupportCapability_Subscribe (UE ID or External Group ID,
callback URI, Duration of Reporting) message to the SCEF+NEF node.
The callback URI parameter is optional and is used in step 8a if provided.
The Duration of Reporting is optional and is used to indicate when the
subscription is invalid.
2\. If the SCEF+NEF has not established connection with MME/AMF/SMF for Non-IP
data transfer, he SCEF+NEF subscribes the CN Type Change event to HSS+UDM by
sending Event Subscribe or Monitoring Request (CN Type Change, UE ID or
External Group ID, Duration of Reporting) message. Otherwise, Step 2 \~ Step 6
are omitted, the SCEF+NEF determines the CN type based on the active type of
connection for Non-IP data transfer.
If Monitoring Request is used, it shall include Reference ID as a parameter.
If Duration of Reporting is received at Step 1, it shall include Duration of
Reporting as a parameter.
3\. HSS+UDM stores the CN Type Change Event subscription for the UE or a group
of UEs indicated in step 2.
4\. UE changes between being served between EPC and 5GC. If UE changes to EPC
from 5GC, the AMF will invoke Nudm_UECM_Deregistration service operation to
HSS+UDM, the MME will send Update Location Request message to HSS+UDM. If UE
changes to 5GC, the AMF will invoke Nudm_UECM_Registration service operation
to HSS+UDM.
5\. Upon reception of the messages at step 4, the HSS+UDM will detect that the
UE is switching between EPC and 5GC. If the UE or the group the UE belongs to
is indicated in the CN Type Change Event subscription at step 3, then the
HSS+UDM determines the CN Type that is serving or going to serve the UE or the
group. If the UE is operating in dual registration mode, the HSS+UDM
determines the 5GC/ECP as CN Type. If some members of the group are
registering in EPC while some members are registering in 5GC, the HSS+UDM
determines the 5GC/ECP as CN Type.
6\. The HSS+UDM informs SCEF+NEF of the CN Type information by sending Event
Notify or Monitoring Response or Indication (CN Type, UE ID or External Group
ID).
The CN Type denotes the 5GC or EPC or 5GC/EPC serving the UE or the group.
If Monitoring Response or Indication is used, it shall include Reference ID
indicated in step 2.
7\. According to the CN Type received and local configuration, the SCEF+NEF
node determines the availability or expected level of support of common north-
bound APIs for the UE or the group.
8\. SCEF+NEF inform AF of the availability or expected level of support of
common north-bound APIs for the UE or the group by sending
APISupportCapability_Notify (API Indication, UE ID or External Group ID)
message.
API Indication can either be the list of available north-bound API or the list
of pair (north-bound API, status). The status indicate whether the north-bound
API is available or unavailable.
8a. [Conditional] If callback URI is provided at step 1, then SCEF+NEF will
send the APISupportCapability_Notify (API Indication, UE ID or External Group
ID) message to the node addressed by callback URI.
9\. Upon reception of the messages at step 8, the AF obtains and stores the
availability or expected level of support of a given service for the UE or the
group. If required later, the AF can select the valid north-bound API based on
availability or expected level of support of a given service for the UE or the
group.
#### 6.14.4.2 Unsubscribe service operation information flow
If the AF invokes APISupportCapability_Subscribe service to SCEF+NEF node with
the Duration of Reporting parameter, the subscription on the SCEF+NEF and
HSS+UDM are implicitly unsubscribed if the Duration of Reporting expires, i.e.
the explicit unsubscribe service operation is not needed.
In case the explicit unsubscribe operation is needed, the information flow is
as following:
{width="4.24375in" height="2.0993055555555555in"}
Figure 6.14.4.2â€‘1: APISupportCapability_Unsubscribe operations
1\. The AF unsubscribes to APISupportCapability service API for a UE or a
group of UEs by sending APISupportCapability_Unsubscribe Request(UE ID or
External Group ID) message to the SCEF+NEF node.
2\. The SCEF+NEF unsubscribes the CN Type Change event from HSS+UDM by sending
Event Unsubscribe or Monitoring Request (CN Type Change, UE ID or External
Group ID) message.
If Monitoring Request is used, it shall include the Reference ID for Deletion.
3\. HSS+UDM deletes the CN Type Change Event subscription for the UE or a
group of UEs indicated in step 2.
4\. HSS+UDM responses to the SCEF+NEF by sending Event Unsubscribe Response or
Monitoring Response or Indication (result indication) message to SCEF+NEF.
5\. If result indication indicates the operation is successful, the SCEF+NEF
deletes the APISupportCapability subscription.
6\. .SCEF+NEF acknowledges the operation result by sending
APISupportCapability_Unsubscribe Response (Result Indication) to AF.
#### 6.14.4.3 Query service operation information flow
{width="5.278472222222222in" height="2.7263888888888888in"}
Figure 6.14.4.3â€‘1: APISupportCapability_Query operation
1\. The AF requests the availability or expected level of support of a service
API for a UE or a group of UEs from SCEF+NEF by sending
APISupportCapability_Query Request (UE ID or External Group ID) message to the
SCEF+NEF node.
2\. If the Freshness Timer of last query is not expired, the SCEF+NEF
determines the CN type locally, Step 2 \~ Step 4 are omitted. Otherwise, the
SCEF+NEF gets the CN Type serving the UE or the group from UDM+HSS by sending
Nudm_UE ContextManagement_Get Request (CN Type, UE ID or External Group ID)
message.
CN Type indicates that this request is for the serving CN Type of the
indicated UE or group.
3\. Upon reception of the request at step 3, the HSS+UDM determines the CN
Type that is serving the UE or the group based on the registered MME or AMF.
4\. The HSS+UDM informs SCEF+NEF of the CN Type by sending Nudm_UE
ContextManagement_Get Response (CN Type, Freshness Timer) message. The
Freshness Timer is set per operator\'s policy, e.g. based on the statistics of
UE activity.
5\. According to the CN Type received and local configuration, the SCEF+NEF
node determines the availability or expected level of support of common north-
bound APIs for the UE or the group.
6\. SCEF+NEF inform AF of the availability or expected level of support of
common north-bound APIs for the UE or the group by sending
APISupportCapability_Query Response (API Indication) message.
API Indication can either be the list of available north-bound API or the list
of pair (north-bound API, status). The status indicate whether the north-bound
API is available or unavailable.
7\. Upon reception of the messages at step 7, the AF obtains the availability
or expected level of support of a given service for the UE or the group. If
required, the AF can select the valid north-bound API based on availability or
expected level of support of a given service for the UE or the group.
### 6.14.5 Impacts on existing entities and interfaces
Enhancements on HSS+UDM include the following:
\- CN Type Change Event, it should provide the subscription and notification
for CN Type Change Event Id to SCEF+NEF;
\- CN Type Information Retrieval, it should support the query request for CN
Type from SCEF+NEF;
Enhancements on SCEF+NEF include the following:
\- APISupportCapability service, it supports informing AF of the availability
or expected level of support of a given service via a response to the request
of the applications or via a notification to the subscription of the
applications.
\- CN Type Change Event Subscribe/Notify, it should support the subscription
to CN Type Change Event to HSS+UDM and receive the notification for CN Type
Change Event from HSS+UDM.
\- CN Type Information Retrieval, it should support the request for CN Type
from HSS+UDM.
Enhancements on AF include the following:
\- APISupportCapability service, it supports obtainment of the availability or
expected level of support of a given service by requesting or subscribing to
the SCEF+NEF via APISupportCapability service.
The API interface that is exposed by the SCEF+NEF interface is an N33 / Nnef
interface that supports the T8 APIs.
In terms of the CAPIF, the SCEF+NEF should be viewed as a single node.
### 6.14.6 Evaluation
The solution describes how, if the level of support of a given service changes
(e.g. due to the UE\'s movement between EPC and 5GC), the SCEF+NEF will notify
the SCS/AS.
## 6.15 Solution 15: External parameter provisioning in the 5GC
### 6.15.1 Introduction
This solution applies to Key issue 10 (Network Parameter Configuration API via
NEF) and to Key issue 13 (Support for Expected UE Behaviour).
The solution attempts to generalize the handling of external parameter
provisioning in the network for the available northbound APIs.
The \"external parameters\" are used as general term for the parameters which
can be provisioned via different northbound APIs, e.g. Communication Pattern
parameters (described in TS 23.682 [6] clause 5.10.1), Network Configuration
parameters (described in TS 23.682 [6] clause 4.5.21), or Expected UE Moving
Trajectory (described in TS 23.502 [7] clause 4.15.6).
New Communication Pattern parameters to assist network/UE configuration for
CIoT features are described in Solution 26 (see clause 6.26).
### 6.15.2 Functional Description
The main principles of the solution are:
\- Certain external parameters are specific to the PDU Session behaviour. Such
parameters are classified as session management (SM) parameters and these are
provisioned to the SMF (i.e. SMF-Associated parameters).
\- Certain external parameters are specific to the UE mobility management (MM)
configuration and these parameters are provisioned to the AMF (i.e. AMF-
Associated parameters).
\- Another external parameters may be specific to the Policy Control (PC) and
can be appropriately stored in the UDR for access by the PCF (i.e. PCF-
Associated parameters).
\- The UDM/UDR classifies the external parameters into AMF- Associated
parameters, SMF- Associated parameters and possibly PCF- Associated
parameters. The SMF- Associated parameters are further associated with a
particular subscribed DNN and/or S-NSSAI.
While processing the external parameters, the UDM/UDR consider whether the
concerned UE has subscribed DNN(s). If there is no subscribed DNN (e.g. the UE
uses SMS only) or S-NSSAI in the user subscription, the UDM/UDR classifies all
external parameters as AMF- Associated parameters. If there is at least one
subscribed DNN or S-NSSAI, the UDM/UDR determines the DNN and the S-NSSAI to
which the sending AF is associated with.
It is a subject of local policy in the UDM/UDR which external parameters are
classified as AMF- Associated, SMF- Associated, and PCF- Associated
parameters.
NOTE: It may be possible for parameters to be classified as being associated
with multiple NFs.
Each external parameter set may be associated with a validity time. The
validity time is stored at the UDM/UDR and in each of the NFs, to which
parameters has been provisioned (e.g. in AMF or SMF). Upon expiration of the
validity time, each node deletes the parameters autonomously without explicit
signalling. This processing is similar to the handling of validity time in EPS
as described in TS 23.682 [6] clause 5.10.1.
### 6.15.3 Support of EPC interworking
The support of interworking in this solution depends on the conclusions for
Key Issue 9 (Support of common north-bound APIs for EPC-5GC Interworking).
Assuming that for EPC interworking a co-located SCEF+NEF entity and co-located
HSS+UDM entity are deployed, then the enhancement proposed in this solution to
the UDM and NEF would be applicable to the co-located entities. During
mobility to/from EPC the entities in the target CN (e.g. MME in EPC; or AMF
and/or SMF in 5GC) need to download the \"external parameters\" from the
HSS+UDM. The HSS+UDM sends the \"external parameters\" in the corresponding
format to be processed in the target CN entity.
A possible mapping table between EPS Communication Pattern parameters and 5GS
Expected UE Behaviour is shown in solution 26 (see clause 6.26.3).
The mapping of the EPS Network Configuration parameters and 5GS Network
Configuration parameters is one to one.
### 6.15.4 Procedures
In this clause the procedure for external parameter provisioning is described.
Figure 6.15.4.1-1: External parameters provisioning to AMF and to SMF
> 1\. The AF(s) may use various APIs to provide parameters specific to a given
> UE application (or the UE as such if a single application is used in the UE)
> in order to help the network for efficient configuration. The AF(s) may
> add/modify/delete the parameters to the network (e.g. to NEF).
>
> 2\. NEF/SCEF discovers a UDM/UDR based on the UE\'s External ID. Similar to
> step 2 in TS 23.682 [6] clause 5.10.2.
>
> 3\. NEF to UDM: Nudm_ParameterProvision_Update (GPSI, AF ID, NEF Transaction
> Reference ID(s), external parameter set(s), validity time(s)).
>
> 4\. In step 4a the UDM/UDR may categorizes the external parameters into AMF-
> Associated and SMF- Associated parameters. The SMF parameters are further
> associated with a particular subscribed DNN and/or S-NSSAI. The UDM/UDR uses
> the AF ID to determine the corresponding DNN and S-NSSAI.
>
> In step 4b the UDM/UDR updates the corresponding fields in the UE
> subscription.
>
> 5\. - 6. Steps similar to steps 5, 6 in TS 23.682 [6] clause 5.10.2.
>
> 7\. UDM to AMF: Nudm_ SubscriberDataManagement (SDM)_Notification (SUPI,
> AMF- Associated parameters, etc.).
>
> The AMF stores and uses the received AMF parameters to derive the
> appropriate UE configuration. The AMF-Associated parameters can be e.g.
> \"Stationary indication\", \"Battery Indication\" or \"Expected UE Moving
> Trajectory\", \"Maximum Latency\", \"Maximum Response Time\", \"Suggested
> Number of Downlink Packets\". For example, the AMF may determine a
> Registration area based on parameters \"Stationary indication\" or
> \"Expected UE Moving Trajectory\". The AMF identifies whether there are
> overlapping parameter set(s) and merges the parameter set(s), if necessary.
>
> 8\. PDU Session Establishment procedure steps 1-3 from TS 23.502 [7] clause
> 4.3.2.2.1.
>
> In step 8a, the PDU Session Establishment procedure is triggered.
>
> In step 8b, UDM to SMF: the UDM performs service operation Nudm_
> SubscriberDataManagement (SDM)_Notification (SUPI, SMF-Associated parameter
> set, DNN/S-NSSAI, etc.). See step 4 of PDU Session Establishment in TS
> 23.502 [7], clause 4.3.2.2.1
The SMF stores the received SMF-Associated parameters and associates them with
a PDU Session based on the DNN and S-NSSAI included in the message from UDM.
The SMF identifies whether there are overlapping parameter set(s) and merges
the parameter set(s), if necessary. The SMF-Associated parameters can be e.g.
Communication Duration Time, Periodic Time, Scheduled Communication Time,
Suggested Number of Downlink Packets. The SMF uses the SMF-Associated
parameters to also appropriately configure the UPF. For example, the SMF can
use the Scheduled Communication Type to configure the UPF how many downlink
packets to buffer. The SMF may use e.g. the Communication duration time to
determine to deactivate UP connection after the Communication duration time
expires and the SMF performs the procedure CN-initiated selective deactivation
of UP connection of an existing PDU Session as described in TS 23.502 [7]
clause 4.3.7.
Step 8c: If the PDU session uses NAS-SM to transfer PDUs, the SMF forwards to
the AMF all parameters in step 8b of the PDU Session Establishment procedure.
The AMF may identify whether there are overlapping SMF parameter set(s) and
merge the parameter set(s), if necessary e.g. when the UE context is provided
to the NG-RAN after RRC msg #3.
NOTE 1: If the PDU sessions uses NAS-SM to transfer PDUs, the delivery of the
UE Expected Behavior parameters to the NG-RAN is done by the AMF. If the PDU
session does not use NAS-SM to transfer PDUs, the delivery of the UE Expected
Behavior parameters to the NG-RAN is done by the SMF. See Solution 28 for more
details.
Step 8d: the remaining steps of the PDU Session Establishment procedure are
executed.
NOTE 2: The SMF can update the parameters in the AMF during the PDU Session
Modification procedure. In that case, Steps 8a-8d of this message flow would
coincide with the steps of Figure 4.3.3.2-1 of TS 23.502 [7]; in particular,
Step 8c would match Step 3a of the PDU Session Modification Procedure.
The deletion or modification of external parameters is performed similarly to
the descriptions in TS 23.682 [6] clause 5.10.2.
### 6.15.5 Impacts on existing entities and interfaces
Enhancements to UDM/UDR (or potentially to co-located HSS+UDM) include the
following:
\- The external parameters are categorized into AMF-Associated, SMF-Associated
-specific and PCF-Associated parameters. The SMF parameters are further
associated with a particular subscribed DNN and/or S-NSSAI.
Enhancements to SMF include the following:
\- The SMF uses the SMF-Associated parameters to appropriately configure the
UPF;
\- The SMF provides the SMF-Associated parameters to the AMF when a PDU
session is created.
Enhancements to the AMF include the following:
\- The AMF takes into account the SMF associated parameters from all SMFs when
deriving CN Assistance Information provided to NG-RAN.
### 6.15.6 Evaluation
This solution allows multiple AFs to provide the CN with set of external
parameters (e.g. Communication Pattern parameters, Network Configuration
parameters) to be used for network configuration and UE configuration.
## 6.16 Solution 16: UE assisted Inter-UE QoS Support for Data over NAS
### 6.16.1 Introduction
This solution addresses Key Issue 14: QoS Support for NB-IoT for the case of
Data over NAS. It can also be applied to WB-E-UTRA (eMTC) when Data over NAS
is used.
### 6.16.2 Functional Description
The solution is based on the UE providing a QoS index during RRC connection
procedure for the case of Data over NAS.
The following applies to the solution:
\- During registration procedure, if Data over NAS is set-up, the AMF provides
a QoS index to the UE. The AMF receives the QoS index from the UDM during the
exchange as defined in TS 23.502 [7].
\- When the UE decides to send data over NAS, during the RRC connection
establishment procedure, the UE provides the QoS index in RRC connection
request message.
\- The RAN determines how to handle the connection based on the UE provided
QoS index, i.e the RAN can prioritise resource allocation between different
UEs when some of the UEs are using data over NAS based on the received QoS
index.
\- If the RAN decides to go ahead and establish the RRC connection and the UE
sends the data over NAS payload, the RAN sends the UE provided QoS index to
the AMF in the N2 message carrying the Data over NAS payload.
\- The AMF can check whether the QoS index provided by the UE and the QoS
index configured by the network are the same. In case they are different, the
AMF has detected a misbehaving UE, i.e. a UE that is not compliant with 3GPP
specifications. The AMF may then back-off or deregister the UE with a
corresponding cause code.
### 6.16.3 Support of EPC interworking
### 6.16.4 Procedures
#### 6.16.4.1 QoS Index configuration during Registration Procedure
{width="6.865277777777778in" height="3.8125in"}
Figure 6.16.4.1-1: QoS index configuration during Registration procedure
All steps from TS 23.502 [7] clause 4.2.2.2.2 are followed with the following
differences.
1\. If the UE wants to use Data over NAS, it indicates this to the AMF in NAS
Registration request message.
2\. (Steps 4-13 from TS 23.502 [7] clause 4.2.2.2.2 unchanged).
3\. In Step 14, the UDM includes the QoS index in the Access and Mobility
Subscription data.
4\. (Steps 15-21 from TS 23.502 [7], clause 4.2.2.2.2 unchanged).
5\. The AMF provides with the QoS Index to the UE in the Registration accept
message. The UE stores this value, and only uses it if Data over NAS is set up
with SMF, and the UE decides to send a data packet over NAS.
#### 6.16.4.2 Using QoS index in MO Data over NAS
The following call flow is based on Solution 1 (clause 6.1) for Data Transport
over NAS-SM, but can easily be used for other possible data over NAS
solutions.
{width="5.365277777777778in" height="3.6680555555555556in"}
Figure 6.16.4.2-1: Use of QoS index in MO data over NAS
0\. The solution applies when the UE initiates data transport over NAS(-SM)
from CM-IDLE state.
1\. If the UE has been configured with QoS index and decides to send data over
NAS(-SM), then the UE includes the QoS index in RRC connection request.
Editor\'s note: The exact mechanism by which the QoS index will be provided to
RAN will be defined by RAN WG2.
2\. The RAN node considers the UE provided QoS index to prioritise resource
allocation between different UEs when some of the UEs are using data over NAS.
3\. RAN node sends RRC connection setup.
4\. UE sends RRC connection Complete(NAS transport(SM data transfer, PDU
Session ID)) as per Solution 1.
5\. The RAN node sends the UE provided QoS index in the Initial UE message to
AMF together with the NAS transport message.
6\. AMF can check if the UE is misbehaving by comparing the UE provided QoS
index with the NW configured QoS index. If the AMF detects the UE is
misbehaving it may take multiple actions, e.g. deregister the UE with specific
cause code, or reject ANS transport with a back-off timer.
7\. Completion of data transport over NAS-SM as per Solution 1.
### 6.16.5 Impacts on existing entities and interfaces
The solution has impacts on the following network functions:
1\. AMF: Provision of QoS index to the UE, and a potential a-posteriori check
on whether the UE is providing the correct QoS Index.
2\. UDM: QoS index storage in subscription information.
3\. RAN: Receive QoS index from UE and perform prioritization based on it.
4\. UE: configuration of QoS index and providing QoS index in RRC connection
request for Data over NAS.
### 6.16.6 Evaluation
Advantages:
\- Support QoS differentiation among UEs that use NAS to delivery data.
\- Support any types of data, IP, Ethernet, unstructured data.
Disadvantages:
\- Does not support QoS differentiation if the UE send only one UL message in
Early Data Transmission over NAS.
\- Increase the size of some RRC messages to carry QoS index.
## 6.17 Solution 17: UE-Driven Packet Classification
### 6.17.1 Introduction
This solution is proposed for Key Issues 14, QoS Support for NB-IoT. The NB-
IoT devices may use UP solutions to send frequent and small data in the UP.
The UE may establish a PDU Session as described in TS 23.502 [7], clause
4.3.2. The NB-IoT devices may require 5GS to support multiple QoS flows in one
Unstructured PDU Session. For example, one QoS Flow may be used to carry low
priority data such as regular sensor data. Another QoS Flow may be used to
carry the emergent messages, such as high temperature alarm, high heart beat
rate.
### 6.17.2 Functional Description
The NB-IoT devices request PDU Session Establishment to send unstructured
data. Based on the UE Subscription information in the UDM/UDR, the UE may
support multiple QoS Flows in one unstructured PDU Session and based on the
SLA, the SMF can assign multiple QoS Rules to the UE. Each QoS Rule is
associated with one QoS Flow Identifier (QFI), but there is no Packet Filter
Sets. The local policy handling function in the UE can understand the QoS
parameters in the QoS rule(s) (such as 5QI, and bit rate). The UE may have
non-standardized packet filtering mechanisms for CIoT protocols. Based on the
QoS requirements and the QoS parameters in the QoS rule(s), the UE has its own
logic to perform packet classification and map the UL PDU to QoS Flows.
During the PDU Session Establishment, the SMF also sends multiple QoS Profiles
to the (R)AN, each QoS Profile has a unique QFI for one QoS Flow the UE may
use.
During the PDU Session Establishment, the SMF also sends multiple N6 Service
Data Flow (SDF) templates to the UPF. Each N6 SDF template has an N6 Packet
Filter Set (PFS) and each N6 PFS is mapped to one N3/N9 QFI. In case of N6 IP
tunnel, the SMF may assign one unique IP address/prefix for each QoS Flow.
Alternatively, the SMF may assign the same IP address/prefix for all QoS
Flows, but each QoS Flow uses a unique UDP port, or unique Flow Label, or
Traffic Class as part of SDF template. The UPF establishes IP tunnel(s) with
the AS using the assigned IP address(es)/prefix(es) or UDP port(s).
When the UE sends an UL PDU, the UE uses its own logic to map the UL PDU to
QoS Flow. The UE may add a QFI to the UL PDU and sends to the (R)AN. The (R)AN
receives the UL PDU, adds a QFI as part of N3 header and sends the
N3-encapsulated PDU to the UPF. The UPF removes the N3 encapsulation, adds the
N6 tunnel header to the PDU. Different QoS Flows can be associated with a
unique N6 IP address/prefix and/or unique UDP port of UPF. The UPF sends the
PDU with unique N6 IP packet header to the Application Server (AS).
The UPF can classify DL unstructured PDUs received from N6 interface into
multiple QoS Flows with different QFI. The AS may send downlink packets to the
UE. The AS uses the source information in the N6 tunnel header that the UPF
used to send the UL PDU for sending DL packet to the UPF. The UPF receives the
DL PDU, uses the mapping between N6 PFS and QFI to classify the PDUs into QoS
Flows and send the DL PDU to the (R)AN. The (R)AN sends the DL PDU to the UE
using a data radio bearer (DRB) assigned to the QoF Flow.
### 6.17.3 Support of EPC interworking
Not applicable.
### 6.17.4 Procedures
The high-level procedure for sending UL unstructured PDU is described in
Figure 6.17.4-1.
{width="5.8909722222222225in" height="4.454166666666667in"}
Figure 6.17.4-1: High level description of UL unstructured PDU delivery
1\. During PDU Session Establishment procedure, the SMF sends QoS Rules to the
UE. The QoS Rules do not contain Packet Filter Sets.
2\. During PDU Session Establishment procedure, the SMF assigns tunnel
parameters for N6 interface. In case of IP/UDP tunnel, the SMF assigns IP
address(es) and UPD port number for QoS Flow(s).
Some other steps are required but not shown in the procedure. For example, the
SMF sends QoS Profiles to the (R)AN, the (R)AN establish DRB(s) for QoS Flows.
If required, one of the QoS Flows may be assigned to carry high priority data,
and another QoS Flow is assigned to carry low priority data.
The SMF assigns corresponding QoS Rules to the UEs, QoS Profiles to the (R)AN,
QoS and charging policies to the UPF to reflect the Priority Level, Packet
Delay Budget requirements, bit rate requirements and other QoS parameters for
QoS Flows.
3\. The UE may have non-standardized packet filtering mechanisms. When the UE
wants to send UL PDUs, based on the QoS requirements and the QoS parameters in
the QoS rule(s), the UE has its own logic to map UL unstructured PDUs into QoS
Flows.
4\. The UE sends UL unstructured PDU to the (R)AN using the assigned DRB. The
(R)AN performs bit rate control for the UL of unstructured PDU Session
according to the QoS Profile(s).
5\. The (R)AN receives the UL PDU. The (R)AN encapsulates the UL PDU with N3
tunnel header.
6\. The (R)AN sends to the N3-encapsulated PDU to the UPF.
7\. The UPF reads the UL QFI, removes the N3 tunnel header. The UPF uses the
mapping between UL QFI and N6 tunnel header (e.g. N6 IP source address/prefix)
to encapsulate the UL PDU into N6 tunnel PDU format.
8\. The UPF sends UL PDU in the N6 tunnel.
### 6.17.5 Impacts on existing entities and interfaces
In the UE:
\- Since no Packet Filter Sets are specified for unstructured PDU data, the UE
uses its own logic to classify PDUs into QoS Flows in the uplink. The QoS
Rules for unstructured QoS Flows do not have Packet Filter Sets.
\- For downlink, the (R)AN uses the assigned DRB(s) for each QoS Flow as the
current (R)AN specifications.
In the UPF:
\- The UPF uses the mapping between N3/N9 QFI and N6 tunnel Packet Filter Sets
to send UL PDU to the AS. In case of IP/UDP tunnel, each N6 PFS has a unique
set of source IP address/prefix, source UDP port number(s), Flow Label.
\- In the downlink, the AS uses the information in the N6 tunnel header to
send the DL packets to the UPF. The UPF uses the mapping between N3/N9 QFI and
N6 tunnel Packet Filter Sets to classify DL packets into QoS Flows and send to
the (R)AN.
### 6.17.6 Evaluation
Solution 17 supports QoS differentiation among QoS flows, among PDU Sessions,
and among UEs for unstructured data. This solution allows multiple QoS flows
in one unstructured PDU Session, which helps to reduce the air interface and
CN signaling for PDU Session establishment, modification, handover, AF
influence traffic routing and other related procedures.
In case of MT data, the solution assumes that the AS selects the appropriate
tunnel when sending DL data. For MT initiated data it is unclear for the AS
which DL tunnel to initially use.
Impacts to UE:
\- The solution requires changes in the UE to support proprietary packet
classification for unstructured PDUs into QoS flows.
\- In Rel. 15, one Unstructured PDU Session supports only one QoS Flow. Using
Solution 17, one Unstructured PDU Session supports multiple QoS Flows. An
application software in the UE may use proprietary methods to classify UL PDUs
into multiple QoS flows of the same Unstructured PDU Session.
Impacts to UPF:
\- There is no impacts to the packet classification method of the UPF. The
packet classification in the UPF uses the existing packet filtering mechanism
based on N6 tunnel header, such as IP tunnel header. After classifying
downlink packets, the UPF sends the downlink PDUs to the N3 or N9 QoS flows as
it does for the IP or Ethernet traffic.
\- In Rel. 15, one N6 tunnel header is mapped to one unstructured PDU session.
Using Solution 16, one N6 tunnel header is mapped to one QoS flow of an
Unstructured PDU Session.
Impacts to QoS Model:
\- In Rel. 15, the Unstructured PDU Session type supports only one QoS flow.
The IP or Ethernet PDU Session types support multiple QoS Flows by using
packet filters in the UE and UPF.
\- Solution 17 allows one Unstructured PDU Session to support multiple QoS
Flows. A new feature of Solution 17 is that there is no standardized packet
filtering methods to be applied in the UE for unstructured data. For
Unstructured PDU Sessions having multiple QoS flows, the QoS Rules sent from
the SMF to the UE does not contain packet filters for unstructured data. The
UE uses its own logic to classify PDUs into QoS Flows in the UL.
\- For the UPF, the SMF sends a mapping between QFI of N3 or N9 tunnel to N6
tunnel header. The UPF uses existing N6 tunnel packet filtering to classify DL
PDUs into N3 or N9 QoS flows. This is different from the current mapping in
Rel. 15, where one N6 tunnel header is mapped to one Unstructured PDU Session.
## 6.18 Solution 18: QoS control for unstructured PDU sessions
### 6.18.1 Introduction
This solution addresses Key Issue #14, QoS Support for NB-IoT by introducing a
mechanism to to differentiate traffic flows within a single unstructured PDU
session.
### 6.18.2 Functional Description
#### 6.18.2.1 QoS Flow mapping for unstructured PDU Session
Similar to the QoS model defined in TS 23.501 [5], the SMF performs the
binding of Service Data Flows (SDFs) to QoS Flows based on the QoS and service
requirements (e.g. the received PCC rules). The SMF assigns the QFI for a new
QoS Flow and derives its QoS profile from the information provided by the PCF.
When applicable, the SMF provides the QFI together with the QoS profile to the
(R)AN. The SMF provides the SDF template, i.e. Field Position based Packet
Filter (see clause 6.18.2.2) associated with the SDF received from the PCF)
together with the SDF template precedence value included in the PCC rule , the
QoS related information, and the corresponding packet marking information,
i.e. the QFI to UPF. For each SDF, when applicable, the SMF generates a QoS
rule. Each of these QoS rules contain the QoS rule identifier, the QFI of the
QoS Flow, the Field Position based Packet Filter of the UL part of the SDF
template, optionally the Field Position based Packet Filter for the DL part of
the SDF template, and the QoS rule precedence value set to the precedence
value of the PCC rule from which the QoS rule is generated. The QoS rules are
then provided to the UE.
The principle for classification and marking of User Plane traffic and mapping
of QoS Flows to AN resources is illustrated in Figure 6.18.2.1-1.
{width="6.653472222222222in" height="3.3541666666666665in"}
Figure 6.18.2.1-1: Principle for classification and User Plane marking for QoS
Flows and mapping to AN Resources for Unstructured PDU Session
In DL, incoming data packets are classified by the UPF based on SDF templates
according to the precedence of the PCC rule authorizing the service data flow,
(without initiating additional N4 signalling). The UPF conveys the
classification of the User Plane traffic belonging to a QoS Flow through an N3
(and N9) User Plane marking using a QFI. The AN binds QoS Flows to AN
resources (i.e. Data Radio Bearers of in case of 3GPP RAN). For PDU Session
types used by NB-IoT (i.e. IPv6, IPv4, and Unstructured), dedicated bearers
are not supported in NB-IoT, so multiple QoS Flows can be band to one AN
resource. It is up to the AN to establish they AN resources that QoS Flows can
be mapped to, and to release it.
If no match is found and all QoS Flows are related with a DL Field Position
based Packet Filter, the UPF shall discard the DL data packet.
In UL, the UE evaluates UL packets against the Packet Filter in the QoS rules
for Unstructured PDU Session based on the precedence value of QoS rules in
increasing order until a matching QoS rule (i.e. whose packet filter matches
the UL packet) is found. The UE uses the QFI in the corresponding matching QoS
rule to bind the UL packet to a QoS Flow. The UE then binds QoS Flows to AN
resources.
If no match is found and the default QoS rule contains an UL Packet Filter,
the UE shall discard the UL data packet.
#### 6.18.2.2 QoS Rule for Unstructured PDU Session
The QoS rules for unstructured PDU sessions are the extension of the QoS rules
used for structured PDU sessions. A generic filtering component type is
defined that can fit into the existing QoS rules as defined by clause 9.8.4.9
of TS 24.501 [10].
The packet filter content is made of a variable number of packet filter
components. Each packet filter component has a type followed by a value.
clause 9.8.4.9 of TS 24.501 [10] dictates that each filter component type can
appear in a filter only once.
In order to extend the filtering capability, a new component type \"Generic
filter type\" is added to the list of supported components. In addition, the
Generic filter type component is exempt from the rule to appear only once in a
filter. The generic filter component type can be realized using the field
position based packet filter or any variation thereof.
To construct a filter that matches more than one field in the packet, multiple
such Generic filter components are used in a manner similar to the other
components. In addition, this Generic filter component can also be used along
with other pre-defined filter components.
#### 6.18.2.2.1 Achieving Reflective QoS
Reflective QoS for IP and Ethernet traffic is enabled by setting rules for the
UE to construct an uplink filtering rule from the downlink packet. These rules
only support UDP/TCP/ESP as the upper layer protocols for IP type traffic.
In order to achieve reflective QoS for any traffic type, including
unstructured PDU sessions, the following procedures are defined:
\- Install QoS rules with filter direction set as \"Reflective\". This
reflective filter acts as a template that the UE can use to create the uplink
filter:
\- Only one filter per QFI can be installed as a reflective filter. This is to
prevent any ambiguity in picking the filter needed to construct the uplink
filter;
\- The presence of a reflective filter supersedes the construction rules
specified in clause 6.2.5.1.4.2 of TS 24.501 [10];
\- Packet filter components apart from the Generic filter component can be
included in reflective filter. When included, the value indicated in these
components are ignored;
\- When the filter is marked as a reflective filter, the \"value\" field in
the packet filter component of the Generic filter is omitted.
#### 6.18.2.3 Field position based Packet Filters
The Field position based Packet Filters is used in the QoS rules or SDF
template for Unstructured PDU Session to identify a QoS Flow. The Field
position based Packet Filter may contain one or more fields position
information and their matching value. The information to generate Field
position based Packet Filters can be either provided by an AF or preconfigured
in the network.
Figure 6.18.2.3-1 represents the format of an example of unstructured protocol
over non-IP.
+-------------+-------------+-------------+-------------+-------------+ | Field 1 | Field 2 | Other | Field 3 | Other | | | | field(s) | | field(s) | | (Value: A1) | (Value: A2) | | (Value: A3) | | | | | (Value: | | (Value: | | (Length: a | (Length: x | ...) | (Length: z | ...) | | bit) | bit) | | bit) | | | | | (Length: y | | (Length: | | | | bit ) | | ...) | +-------------+-------------+-------------+-------------+-------------+
Figure 6.18.2.3-1: Format of An Example Unstructured Protocol over non-IP
As shown in the figure below, Field Position 1, Field Position 2 and Field
Position 3 respectively represent the header field that contain in the Example
Unstructured Protocol over non-IP in Figure 6.18.2.3-1. The field positions
are defined by two attribute, the offset and the length \. The offset
is defined as the starting position in the packet, in number of bits, and the
length field is defined as the number of bits in this field. In addition, a
matching value for the referenced part of the unstructured PDU and an
operation for the comparison of the set of bits is given. Fields that
including in the Field Position based Packet Filters might be any field in the
Unstructured Protocol.
+-------------+-------------+-------------+-------------+-------------+ | Field | Field | Field | Operatio | Matching | | Position | Position | Position | nï¼ˆ=,>,\ The DL buffering suggested packet count indicates the expected maximum
> amount of data packets that will be buffered in the network. The SCS/AS may
> buffer the DL data or send the DL data according to the expected wait time
> and the DL buffering suggested packet count.
NOTE: The DL Buffering Suggested Packet Count modified by the SMF is exposed
towards the SCS/AS.
4\. If DL data transmission becomes available, for example, UE enters
connected mode, CN delivers the buffered downlink packet(s), step 5 and step 6
are perform.
5\. SMF sends the Nsmf_EventExposure_Notify (Extended Buffer event) message to
NEF. The following parameter is included:
\- Packet(s) have been transmitted.
6\. NEF sends the Nnef_EventExposure_Notify (Extended Buffer event) message to
SCS/AS.
If at any point in time the CN drops the buffered packets, the SMF initiates
the Nsmf_EventExposure_Notify (Extended Buffer event) procedure indicating
Packet(s) discarded.
### 6.25.5 Impacts on existing entities and interfaces
PCC:
\- Management of Policies for extended buffering per PDU session.
\- Provide policy information for extended buffering to SMF.
\- Support event exposure for the Monitoring event from NEF.
UPF:
\- Support extended buffering as requested by SMF (for data via N6).
SMF:
\- Receive policies from PCF.
\- Determine whether extended buffering applies, supported extended buffering
for DL data or provide request for extended buffering to UPF.
\- Support event exposure for the monitoring event from PCF.
AMF:
\- Provide Estimated Maximum wait time to SMF.
NEF:
> \- Support extended buffering as requested by SMF (for data via APIs).
### 6.25.6 Evaluation
The solution proposes extended buffering and event notification for high
latency communication. The SMF determines whether Extended Buffering applies
for the downlink packet or not based on the policy information from the PCC
and UPF capability. In addition, two notification procedures towards the AF
are prosed: AF notification from AMF, including the \"UE Reachability\" event
and \"Availability Notification after DDN Failure\" event; AF notification
from SMF, i.e. the \"Extended Buffering\" event.
The solution addresses the architectural requirements of key issue 3 to
\"provide the AF (i.e. SCS/AS) with UE status information (e.g. reachability
notification or the time when the UE is expected to be reachable)\", and
\"Send DL data to UEs at the earliest possible opportunity when the UEs are
applying power saving functions\".
## 6.26 Solution 26: Expected UE Behaviour provisioning for CIoT
### 6.26.1 Introduction
This solution addresses Key Issue #13 (Support for Expected UE Behaviour), and
partially addresses Key Issue #4 (Power Saving Functions) as well as Key Issue
#3 (High Latency Communication) and indicates which parameters, among the
Communication Parameters defined in TS 23.682 [6], shall be re-used for 5GC,
investigating their relevance and analysing how they can be provided to the
AMF and/or the SMF.
This solution proposes that some of the Communication Pattern parameters
defined in TS 23.682 [6] clause 5.10.1 are provided to 5GC to optimize the
resource usage for CIoT. More specifically, the parameters to be used for 5GS
are described in Table 6.26.1-1 below. The differences between the EPS
Communication Pattern parameters and those proposed for 5GS are:
1\. The _Expected UE Moving Trajectory_ (which is not present in TS 23.682 [6]
but is described in TS 23.502 [7]) is added to the list of parameters.
2\. The _Periodic Communication Indicator_ is not needed because it can be
implicitly inferred by the usage of the _Periodic Time_.
3\. The _Communication Duration Time_ has been generalized to be applicable
not only to periodic communication. In this proposal it indicates for how long
the UE will normally stay in CM-Connected for data transmission, independently
of whether the communication is periodic or not.
4\. The _Scheduled Communication Type_ (which is not present in TS 23.682 [6])
is added to the list of parameters.
5\. The _Traffic Profile_ (see TS 23.682 [6]) is added to the list of
parameters.
Table 6.26.1-1: Description of parameters for Expected UE Behaviour
+----------------------------------+----------------------------------+ | Expected UE Behaviour parameter | Description | +----------------------------------+----------------------------------+ | Expected UE Moving Trajectory | Identifies the UE\'s expected | | | geographical movement. | | | | | | Example: A planned path of | | | movement. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Stationary Indication (see | Identifies whether the UE is | | TS 23.682 [6] clause 5.10.1) | stationary or mobile | | | [optional] | +----------------------------------+----------------------------------+ | Communication Duration Time (see | Indicates for how long the UE | | TS 23.682 [6] clause 5.10.1) | will normally stay in | | | CM-Connected for data | | | transmission. | | | | | | Example: 5 minutes. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Periodic Time (see | Interval Time of periodic | | TS 23.682 [6] clause 5.10.1) | communication | | | | | | Example: every hour. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Scheduled Communication Time | Time and day of the week when | | (see TS 23.682 [6] | the UE is available for | | clause 5.10.1) | communication. | | | | | | Example: Time: 13:00-20:00, Day: | | | Monday. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Battery Indication (see | Identifies power consumption | | TS 23.682 [6] clause 5.10.1) | criticality for the UE: if the | | | UE is battery powered with not | | | rechargeable/not replaceable | | | battery, battery powered with | | | rechargeable/replaceable | | | battery, or not battery powered. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Traffic Profile (see | Identifies the type of data | | TS 23.682 [6]) | transmission: single packet | | | transmission (UL or DL), dual | | | packet transmission (UL with | | | subsequent DL or DL with | | | subsequent UL), multiple packets | | | transmission | | | | | | [optional] | +----------------------------------+----------------------------------+ | Scheduled Communication Type | Indicates that the Scheduled | | | Communication Type is Downlink | | | only or Uplink only or | | | Bi-directional [To be used | | | together with Scheduled | | | Communication Time] | | | | | | Example: \, DL only. | | | | | | [optional] | +----------------------------------+----------------------------------+
### 6.26.2 Functional Description
It shall be possible to provide the parameters for CIoT in Table 6.26.1-1 to
the AMF and/or to the SMF. The reasons are as follows:
\- _Expected UE Moving Trajectory_ and _Stationary Indication_ , to configure
the UE with e.g. a Registration Area (TA-list) that includes the TA(s) along
the Expected UE Moving Trajectory. These parameters can be used by the AMF and
SMF.
\- _Communication duration time_ , to be used for inferring the end time of
the communication. The end time could be used to initiate the transition from
CM-CONNECTED to CM-IDLE state. With this value, the SMF can trigger the PDU
Session deactivation, and then if there is no more activated PDU session(s) to
the UE, the AMF can trigger AN release. This parameter can be used by both the
AMF and the SMF.
\- _Periodic time_ , to be used for determining mobility management
parameters, such as determining the periodic time of registration update so as
to save the signalling. Moreover, the SMF can manage the buffering time for
downlink data to the UE, e.g., in the case of UE is in MICO mode which has
periodic communication parameter, the SMF expects the UE is supposed to be
reachable in the time of periodic communication. This parameter can be used by
both the AMF and the SMF.
\- _Scheduled communication time_ , to be used for determining MICO mode UE so
as to save energy consumption of some specific devices. Moreover, the SMF can
determine the inactivity for a certain PDU session, or trigger the PDU Session
release procedure when the time expires and no ongoing traffic for such PDU
session. This parameter can be used by both the AMF and the SMF.
\- _Scheduled communication type_ , to be used for indicating that the
scheduled communication time is DL only or UL only or bi-directional. It may
be used together with the _Scheduled communication time_. This parameter can
be used by both the AMF and the SMF along with the _Scheduled communication
time_.
_\- Traffic Profile_ , to be used for indicating how many packets are
expected. It may be used together with the _Scheduled communication time_.
This parameter can be used by both the AMF and the SMF along with the
_Scheduled communication time_.
NOTE 1: The _Scheduled Communication Type_ and the _Traffic Profile_ should
not be used by the AMF to release the UE when Release Assistance Indication
from the UE is available.
\- _Battery Indication_ , to be used for indicating the power consumption
criticality for the UE. This parameter should be sent to the AMF is mainly
used by the RAN.
NOTE 2: How Expected UE Behavior infleunces CM-CONNECTED to CM-IDLE state
transitions, mobility management paramters, and MICO mode may also be
infleunced by the parameters (Maximum Response Time and Maximum Latency) that
are provided by solutions to Key Issue #10 (Network Parameter Configuration
API via NEF).
The above mentioned parameters are to be forwarded to the RAN to allow
optimisation of Uu resource allocation for NB-IoT UE differentiation. The
_Expected UE Moving Trajectory_ is used also for WB-EUTRA.
### 6.26.3 Support of EPC interworking
The support for interworking between EPC and 5GC is based on the idle-mode
mobility procedures defined in subclause 4.11.1.3 of TS 23.502 [7].
When a UE for which the Expected UE Behaviour parameters are used is moving
to/from EPS, the following mapping with the Communication Pattern parameters
applies:
Table 6.26.3-1: mapping between EPS Communication Pattern parameters and 5GS
Expected UE Behaviour
* * *
EPS Communication Pattern parameter 5GS Expected UE Behaviour parameter 1)
Periodic communication indicator No explicit equivalent parameter, but it is
implicitly indicated by the presence of the Periodic Time. 2) Communication
duration time Communication Duration Time (as in EPS) 3) Periodic time
Periodic Time (as in EPS) 4) Scheduled communication time Scheduled
communication time (as in EPS) 5) Stationary indication Stationary Indication
(as in EPS) 6) Battery indication Battery Indication (ad in EPS) 7) Traffic
Profile Traffic Profile (as in EPS) and Scheduled Communication Type
* * *
The mapping between parameters is done in the HSS+UDM combined entity.
### 6.26.4 Procedures
The external parameter provisioning procedure defined in TS 23.502 [7] clause
4.15.6.2 (External Parameter Provisioning) can be reused to provide
Communication Pattern parameters to 5GC.
NOTE: How the parameters are provided to ng-eNBs is to be discussed together
with RAN WGs.
### 6.26.5 Impacts on existing entities and interfaces
The following nodes are impacted:
\- NEF to provide the Expected UE Parameters to UDM;
\- AMF/SMF to receive and use the related Expected UE Parameters from the UDM
during registration and/or PDU session establishment;
\- RAN to receive the Expected UE Parameters from the AMF/SMF via N2 and N11
interface.
### 6.26.6 Evaluation
This solution analysed and identified which new and existing parameters are to
be provided to the AMF, SMF and ng-eNB to optimise the network behaviour for
an effective CIoT operation.
## 6.27 Solution 27: Reuse of EPS Overload Control Mechanisms
### 6.27.1 Introduction
This solution corresponds to Key Issue 7: Overload Control for small data.
In EPC there are several solutions for overload control which are designed to
protect various network entities when overload occurs and to prevent overload
occurring in the first place. This solution considers whether the features
identified in KI7: Overload Control for small data architectural baseline
(control plane data back-off timer, control plane overload start indication
and service gap) as applied in EPC can be applied to protect 5GC. In addition
this solution also applies APN rate control and low access priority from EPC
to 5GC.
### 6.27.2 Functional Description
#### 6.27.2.1 Small Data Rate Control
Small Data Rate Control in 5GC, similar to APN Rate Control in EPC, is to
allow operators to offer customers services such as \"maximum of Y messages
per day\" as well as allowing the network operator to protect the UPF/NEF.
Small Data Rate Control provides 3 settings; \'number of packets per time
unit\', whether exception reports can be sent then the rate control limit has
been reached and if they can the \'number of additional allowed exception
report packets per time unit\' beyond the base small data rate control limit.
The settings for uplink and downlink are separate. The UE observes the limits
and 5GC may enforce the limits.
#### 6.27.2.2 Service Gap Control
Service Gap Control is an optional feature for CIoT UEs to control the
frequency they access the network by providing a minimum gap between
consecutive MO data communication initiated by the UE for delay tolerant
applications. This helps to reduce peak loading in the network and allows a
distribution of these accesses in time.
Service Gap Time should be a subscription parameter stored in the UDR/UDM,
which is used to set the Service Gap timer, and passed to the UE and AMF.
The UE observes the Service Gap Time restriction and AMF enforces it. When the
timer is running the UE does not initiate connections for MO data transfer or
MO SMS, unless the MO data is exception data in NB-IoT. The UE can still
initiating connections for signalling only and to respond to paging.
#### 6.27.2.3 AMF and SMF Overload
In 5GC general mechanisms exist, as described in TS 23.501 [5] clauses 5.19.5
and 5.19.6 for the AMF and SMF to manage overload. The AMF can request an AN
node to reject connection requests for various reasons related to overload
control and the AMF and SMF can trigger NAS level congestion control, for
example by the SMF indicating congestion in Nsmf_PDUSession service responses,
see TS 29.502 [26].
NB-IoT also includes exception reporting which for the purposes of AMF
overload control is considered to be NB-IoTs equivalent of emergency access.
AMF Overload Control is enhanced to take into account exception reporting
conditions:
\- reject AN signalling connection requests that are for non-exception
reporting; or
\- only permit AN signaling connection requests for exception sessions and
mobile terminated services for that AMF.
The AMF can also signal a percentage value of the amount of signaling traffic
to be rejected.
The RAN node may take the existing and new AMF Overload Control indications
into account when configuring access barring mechanism for the related access
technologies.
If low access priority is supported then AMF Overload Control can further be
enhanced to request the AN reject requests from low access priority UEs (e.g.
UEs using a Delay Tolerant as RRC establishment cause). The AN node further
enable access barring if all AMFs it is connected to send an N2 overload start
message for low access priority UEs.
NAS level congestion control specified in TS 23.501 [5] clause 5.19.7 is
reused.
#### 6.27.2.4 Control plane data back-off timer
In EPC the control plane data back-off timer (T3448) can be returned to the UE
in Attach/TAU/Service Accept or Service Reject messages. The UE then uses this
timer to delay any further transmission of user data via Control Plane CIoT
EPS Optimisation.
The control plane data back-off timer and rules for when the UE is permitted
to ignore it (e.g. exception data, response to paging) are reused in 5GC to
prevent the UE from sending data over the control plane via NAS signalling.
#### 6.27.2.5 Low Access Priority
The UE may be configured with low access priority. When the UE is configured
with a low access priority, when establishing an RRC connection for MO data it
should indicate low access priority or Delay Tolerant in its RRC establishment
cause.
UE provides Low access priority indication (LAPI) in NAS message to the 5GC.
Editor\'s note: It is FFS if LAPI is provided in MM message (e.g. registration
request), or in SM message (e.g. PDU session establishment request), or in
both.
The UE may be configured with permission to override the low access priority,
in which case if any PDU session is configured to use normal access priority
then normal access priority is used instead of low access priority.
The low access priority indication may be included in charging records for the
UE.
### 6.27.3 Support of EPC interworking
Consistent with existing EPS-5GS interworking scenarios in TS 23.501 [5] with
the following differences:
\- Small Data Rate Control is similar to APN Rate Control in EPC and share the
same configuration;
\- Service Gap timer is a subscription parameter and can be used both in EPC
and 5GC.
### 6.27.4 Procedures
#### 6.27.4.1 Small Data Rate Control
##### 6.27.4.1.1 General
Small Data Rate Control is configured by the UPF or NEF via the SMF. The
configuration is performed when a PDU Session is established using the
procedure in TS 23.502 [7] clause 4.3.2.2, with enhancements for Small Data
Rate Control limits.
During PDU Session Establishment the Small Data Rate Control limits are
retrieved from the UPF in step 10b and passed to the UE in the PDU Session
Establishment Accept message sent to the UE in steps 11, 12 and 13 of the
procedure described in clause 4.3.2.2.1 of TS 23.502 [7].
Editor\'s note: If and how the NEF provides the small data rate control limits
is dependent upon solutions for KI#1 and KI#2 for data arriving in the network
using an API.
#### 6.27.4.2 Service Gap Control
##### 6.27.4.2.1 General
The Service Gap timer is a subscription parameter and is therefore stored in
the UDR/UDM. When the Registration procedure is performed as defined in TS
23.502 [7] clause 4.2.2.2 the AMF retrieves the Service Gap Time as part of
the Access and Mobility Subscription data and passed to the UE in the
Registration Accept message.
At subsequent accesses the AMF verifies that any Service Gap limitations have
been observed. If the Service Gap limitations have not been observed then the
AMF rejects the UEs request and returns the remaining time for the Service Gap
timer. The UE starts its Service Gap timer with the value from the AMF and
observes the Service Gap control restrictions.
#### 6.27.4.3 Overload procedure
##### 6.27.4.3.1 General
No enhancements are required to the procedures, however additional code points
maybe required to signal to the AN node the additional restrictions, described
in clause 6.27.2.3 for AMF Overload Control.
#### 6.27.4.4 Low access priority
##### 6.27.4.3.1 General
UE needs to provide Low access priority indication (LAPI) in NAS messages to
the 5GC.
Editor\'s note: It is FFS if LAPI is provided in MM message (e.g. registration
request), or in SM message (e.g. PDU session establishment request), or in
both.
For the low access priority indication to be included in charging records the
UE needs to include the priority in the PDU session establishment request to
the SMF. The SMF can then forward the priority information to other network
nodes, for example the PCF.
#### 6.27.4.5 Control plane data back-off timer procedure
The principle on Control Plane data back-off timer specified in section
4.3.7.4.2.7 of TS 23.401 [4] are reused for 5GS. If Release Assistance
Indication in AS information is available to the AMF this can also be taken
into account.
### 6.27.5 Impacts on existing entities and interfaces
Impacts on AMF:
\- Support of Service Gap Control.
\- Support of Control plane data back-off timer.
\- Support of Low Access Priority.
Impact on SMF:
\- Small Data Rate Control is configured by the UPF or NEF via the SMF.
Impact on UPF:
\- Support of Small Data Rate Control.
Impacts on UE:
\- Support of Small Data Rate Control.
\- Support of Service Gap Control.
\- Support of Control plane data back-off timer.
\- Support of Low Access Priority.
Impact on RAN:
\- Reject connection requests for various reasons related to overload control
based on AMF indication.
### 6.27.6 Evaluation
To support the Overload Control for small data, the solution introduces the
Small Data Rate Control, Service Gap Control, AMF/SMF Overload Control and
Control plane data back-off timer. The solution is based on the same
principles as EPS Overload Control.
The solution addresses all the architectural requirements of Key Issue 7.
## 6.28 Solution 28: SMF assisted NG-RAN information
### 6.28.1 Introduction
This solution applies to Key Issue 13 (Support for Expected UE Behaviour), Key
Issue 1 (Infrequent small data communication) and to Key Issue 2 (Frequent
small data communication) to assist the NG-RAN configuration depending on the
application behaviour.
In particular this solution partially addresses the KI#1 requirements for
\"single packet transmission (UL or DL)\" and \"dual packet transmission (UL
with subsequent DL, or DL with subsequent UL)\" when the SD is transmitted
over the User Plane.
### 6.28.2 Functional Description
The main principles of the solution are:
\- The NG-RAN node is provided with PDU Session specific information (called
\'SMF assisted NG-RAN information\') to be used for proper configuration of
the radio interface upon activation of the UP connection;
\- The SMF determines the SMF assisted NG-RAN information and provides it to
the NG-RAN node within the N2 SM information during the UP connection
activation.
\- In case of PDU Session used for data transmission over user plane, the SMF
may use the SMF-Associated parameters (e.g. Communication Pattern parameters,
Network Configuration parameters) or network configuration to determine the
\'SMF assisted NG-RAN information\'.
> \- In case of PDU Session used for data transmission over control plane, the
> SMF provides the SMF-Associated paramters to the AMF, which, in turn,
> aggregate them and provide them to the NG-RAN.
An AF can provision the 5GS with external parameters (e.g. Communication
Pattern parameters or parameters from the Network Parameter Configuration API
as specified in TS 23.682 [6], but also new parameters can be specified in
Rel-16 as described in solution 26). During the PDU Session establishment
procedure, the SMF is provisioned with some of the external parameters.
NOTE 1: The provisioning of the external parameters to the SMF is described in
solutions 15 and 26 and will be further detailed during the normative phase.
Based on the SMF-Associated external parameters provisioned in the SMF from
the UDM, network configuration or internal statistics, the SMF may determine
\'SMF assisted NG-RAN information\'. The SMF utilises the \"SMF assisted NG-
RAN information\" in one of the following ways:
\- If the PDU Session uses user plane transport (i.e. data transport via N3/N9
tunnels), the SMF sends the SMF assisted NG-RAN information to the NG-RAN node
included in the N2 SM Information container during the UP connection
activation for this PDU Session; or
\- If the PDU Session uses control plane transport (i.e. data PDUs are sent
over NAS SM signalling), the SMF sends the SMF assisted NG-RAN information to
the AMF during the PDU Session establishment procedure. The AMF stores the
received SMF assisted NG-RAN information as part of the UE\'s context and
associated PDU Session ID. This enables the AMF to send the SMF assisted NG-
RAN information to the NG-RAN node at the earliest possible point (e.g. as
shown in step 1 in clause 6.1.4.2 for MO SD transport for solution 1).
The \'SMF assisted NG-RAN information\' is used in the NG-RAN node mainly for
decision for appropriate RRC state, e.g. whether to apply RRC Inactive state,
transition from RRC Connected to RRC Inactive state or transition from RRC
Connected to RRC Idle state. The \'SMF assisted NG-RAN information\' may
include one or more of the following information:
\- \'Expected Session activity behaviour\' describing the periodicity of data
transmission and/or the duration of data transmission for the PDU Session
(e.g. based on the _Communication Duration Time_ and _Periodic Time_
parameters); or
\- The external parameter _Suggested Number of Downlink Packets_ (see Key
Issue 10) indicates the expected number of uplink/downlink packets.
NOTE 2: \'Expected Session activity behaviour\' can have semantic similar to
the semantic of the \"Expected UE activity behaviour\" (as specified in TS
23.401 [4] clause 4.3.21) but applicable for a Session activity, i.e. expected
pattern of the Session\'s changes between data Transmission and Non-
Transmission.
### 6.28.3 Support of EPC interworking
The support of interworking in this solution depends on the conclusions for
Key Issue 9 (Support of common north-bound APIs for EPC-5GC Interworking).
Assuming that for EPC interworking a co-located SCEF+NEF entity and co-located
HSS+UDM entity are deployed, then the enhancement proposed in this solution to
the UDM and NEF would be applicable to the co-located entities. During
mobility to/from EPC the entities in the target CN (e.g. MME in EPC; or AMF
and/or SMF in 5GC) need to download the \"external parameters\" from the
HSS+UDM. The HSS+UDM sends the \"external parameters\" in the corresponding
format to be processed in the target CN entity.
A possible mapping table between EPS Communication Pattern parameters and 5GS
Expected UE Behaviour is shown in Solution 26 (see clause 6.26.3).
### 6.28.4 Procedures
In this clause the procedure for PDU Session activation is described.
Figure 6.28.4-1: PDU Session activation procedure
If the PDU Session is used for data transmission over control plane (data over
NAS SM), the following steps apply:
0a. During the PDU Session establishment procedure, the PDU Session is
configured with (small) data PDU transport over the CP (i.e. Data over NAS SM
transport).
0b. The SMF may receive SMF-Associated external parameters from UDM during the
retrieval of the UE subscription data from UDM.
0c. From SMF to AMF: the SMF replies to the AMF using e.g.
Namf_Communication_N1N2MessageTransfer (SMF assisted NG-RAN information, N1 SM
container, etc.).
The SMF derives and sends the \"SMF assisted NG-RAN information\" (e.g.
Communication Duration Time, Periodic Time, Scheduled Communication Type,
Traffic Profile, Suggested Number of Downlink Packets) to the AMF. The AMF
stores this information as part of the UE\'s context and associated with the
particular PDU Session ID. This enables the AMF to send the \"SMF assisted NG-
RAN information\" as UE differentiation info to the NG-RAN node at the
earliest possible point (e.g. as shown in step 1 in clause 6.1.4.2 for MO SD
transport for solution 1).
If the SMF receives an updated SMF-Associated external parameters from the
UDM, the SMF initiates a service operation towards the AMF to update the SMF
assisted NG-RAN information.
0d. From AMF to UE: the AMF uses NAS transport to send the N1 SM container to
the UE.
0e. The UE initiates RRC Connection establishment with indication for \'Data
over NAS SM transport\'.
0f. The NG-RAN node may query UE context from the AMF. The AMF sends to the
NG-RAN the UE context including AMF assisted information (e.g. RRC Inactive
assistance information), SMF assisted NG-RAN information, etc.
NOTE 1: The AMF provides the UE context to the NG-RAN before step 0g (RRC
Connection Setup message) is executed. The exact format of the RAN-assistance
information (including AMF assisted information and SMF assisted NG-RAN
information) sent from the AMF to the NG-RAN node is to be decided during the
normative phase together with RAN WGs.
0g. The NG-RAN node sends RRC Connection Setup message to the UE to configure
the RRC connection according to the AMF assisted information and SMF assisted
NG-RAN information received from the AMF.
NOTE 2: The procedure described in steps 0b - 0g can be also applied to send
the UE QoS profile/differentiation information to the NG-RAN node, but the
details are described in solution 52.
As a result, Data PDUs can be transmitted in uplink and downlink over the NAS
SM signalling.
If the PDU Session is used for data transmission over user plane (data carried
over N3), the following steps apply:
1\. During the PDU Session establishment procedure the PDU Session is
configured for UP transport. The SMF may store in the UE\'s context the
external SMF-Associated parameters, e.g. as received from UDM/UDR during UE SM
context retrieval procedure.
2\. Due to mobile originated communication (e.g. step 2a using Service
Request) or due to mobile terminated communication (e.g. step 2b), the User
Plane connection activation for this PDU Session is initiated.
3\. The SMF initiates service operation towards the AMF e.g.
Namf_Communication_N1N2MessageTransfer (N2 SM information (PDU Session ID,
QoS, SMF assisted NG-RAN information (_Communication Duration Time_ ,
_Periodic Time_ , _Scheduled Communication Type_ , _Traffic Profile, Suggested
Number of Downlink Packets_))).
The SMF may include within the N2 SM container the SMF assisted NG-RAN
information. The SMF assisted NG-RAN information may contain one or more of
the following parameters: _Communication Duration Time_ , _Periodic Time_ ,
_Scheduled Communication Type_ , _Traffic Profile, Suggested Number of
Downlink Packets_.
4-7. Similar to the steps 12 - 14 in TS 23.502 [7] clause 4.2.3.2.
8\. The NG-RAN node may use the information received in the N2 SM information
together with information received from the AMF to configure the radio
interface. For example the NG-RAN node may receive e.g., RRC inactive
assistance information from AMF and \'SMF assisted NG-RAN information\' from
one or more SMFs. The NG-RAN node may use the \"RRC inactive assistance
information\" from AMF to determine the RRC inactive state configuration, and
use the _Communication Duration Time_ and _Periodic Time_ to decide whether to
configure the RRC Inactive state and/or the duration of the RRC Connected
state.
If the NG-RAN node receives _Scheduled Communication Type_ , _Traffic Profile
or Suggested Number of Downlink Packets_ , the NG-RAN node may determine
whether the data transmission has been completed and the NG-RAN node may
determine the transition from RRC Connected to [RRC Idle or RRC Inactive
states] without waiting for the UE inactivity time to expire; or the NG-RAN
node may initiate selective UP connection deactivation (if there are
additional PDU Sessions activated).
> As a result, Data PDUs can be transmitted in uplink and downlink over the
> NAS SM signalling.
### 6.28.5 Impacts on existing entities and interfaces
Enhancements to SMF include the following:
\- Derive the SMF assisted NG-RAN information and sends it:
\- to the NG-RAN node within the N2 SM information if UP transport is used; or
\- to AMF over N11 if CP transport is used.
Enhancements to AMF include the following:
\- storing the SMF assisted NG-RAN information received from the SMF and
associated with a PDU Session ID in the UE context.
\- sending and aggregating the SMF assisted NG-RAN information to the NG-RAN
node together with the UE context.
Enhancements to NG-RAN node include the following:
\- Using the SMF assisted NG-RAN information 1) from the N2 SM Information
container or 2) from the UE context sent from AMF, in addition to \"RRC
Inactive assistance information\" from the AMF, to fine-tune the configuration
of the Uu interface, e.g. RRC Inactive state.
### 6.28.6 Evaluation
This solution allows to send to the NG-RAN node \"SMF assisted NG-RAN
information\" specific for a particular PDU Session. The following uses cases
are covered:
\- In cases of PDU Session using UP transport, during connection activation
the SMF sends the \"SMF assisted NG-RAN information\" to the NG-RAN node
within the N2 SM Information container.
\- In case of PDU Session using data transport over control plane (Data-over-
NAS transport), the SMF sends the \"SMF assisted NG-RAN information\" to the
AMF during the PDU Session establishment procedure. The \"SMF assisted NG-RAN
information\" is stored as part of the UE\'s context and sent to the NG-RAN
within the UE\'s context.
The \"SMF assisted NG-RAN information\" is used in the NG-RAN node to fine-
tune the configuration of the Uu interface, e.g. RRC Inactive state.
## 6.29 Solution 29: User Plane data transmission with ConnectionLess
signalling
### 6.29.1 Introduction
This solution addresses primarily Key Issue 1: Support for infrequent small
data transmission, Secondarily, it can provide improvements in the area of Key
Issue 5: UE TX Power Saving Functions, Key Issue 7: Overload Control for small
data. The Solution may also be applicable to Key Issue 2: Frequent small data
communication, and ConnectionLess (CL) solution can be used alongside
ConnectionOriented (CO) data solution.
Solutions design to address Key Issue 3: High latency communication, Key Issue
4: Power Saving Functions, Key Issue 9: Support of common north-bound APIs for
EPC-5GC Interworking, Key Issue 12: Inter-RAT mobility support to/from NB-IoT
may be used in combination with this solution.
It is assumed that solution 35 or some other means to provide the T8 API for
NIDD service via user plane is supported.
### 6.29.2 Functional Description
The solution aims to cover at least following use cases:
\- (Massive) IoT UE that may move and need to send sporadic (potentially small
amount) data: in this case the UE sends data to the 5GC via the user plane
path without requiring more signalling in the network (RAN and Core) than the
amount of user data to be transferred.
In such situations, the following architectural concepts are proposed in order
to support a fast switch from IDLE state to a CL-data state where data
transfer occurs:
\- The service itself is not connectionless:
\- The UE needs to register to the network and set-up a PDU session that is
indicated for CL signalling.
\- When the UE exchanges MM or SM related signalling with the network a N2
connection is set-up. Once the MM or SM transaction(s) are over the N2
connection for the UE is released.
\- The MM procedures (e.g. Registration, authentication, Registration Update,
etc.) are independent from whether the UE will activate a PDU session used in
ConnectionLess (CL) mode on the interface between RAN and Core. Thus an UE
needs to Register to the network before being able to activate a PDU session
to be used in ConnectionLess (CL) mode on the interface between RAN and Core.
\- The UE is tracked at Registration Area level and performs Registration
Updates as specified.
\- The UE uses the same SM procedures to manage (set-up, release, etc.) a PDU
session regardless of whether this PDU session is to be used in a Connection
Oriented (CO) or in a ConnectionLess (CL) mode on the interface between RAN
and Core.
\- During the PDU session set-up procedure some parameters specific to the CL
data transfer are nevertheless exchanged between the UE and the network.
\- The solution is not technically dependent on any particular UE category. A
UE that supports CL user plane and the additional CL parameters exchanged
during the establishment of a PDU session may request CL PDU Session
establishment, and the SMF authorises the request based on subscription data.
\- A PDU session that has been established with CL data option may also be
alternatively used as a CO PDU session. It would be technically possible to
prevent this, but it would require additional logic to reject the UE request
for DRB on CL PDU Session.
\- The RAN-Core interface works in ConnectionLess (CL) mode for UP (User
Plane) delivery: once the PDU session has been established, the UE is able to
send and to receive data without any need to first set-up a connection on N2
or N3. All user plane traffic is carried over an N3 tunnel that can be shared
by all active connectionless mode UEs that are currently being served by the
same RAN node and the same PDU session type on the same UPF. The shared N3
tunnel works as follows:
\- If there is no shared N3 tunnel between the UPF and the RAN node serving
the UE when the N3 tunnel is established, then the SMF establishes a shared N3
tunnel and identifies it as a shared tunnel that can be re-used by other CL
UEs served by the same RAN node.
\- If there is already a shared N3 tunnel between the UPF and the RAN node
when the N3 tunnel is established, then the SMF re-uses the existing shared N3
tunnel.
\- The (re-)use of the shared N3 tunnel is determined based on the UE
requesting CL PDU session, which implicitly indicates the UE capability to
send and receive CL data.
\- AN Release procedure related with one of the UEs using the shared N3 tunnel
does not release the shared N3 tunnel, but only removes the affected UE from
the users of the shared N3 tunnel.
\- AN Release procedure related with the last remaining UE using the shared N3
tunnel releases the shared N3 tunnel.
\- The CL procedure is only used over N3. The existing N9 procedures are re-
used without any modification related with CL procedures.
\- The support of the ConnectionLess (CL) mode on the interface between RAN
and Core is independent of the nature of the data being carried in a PDU
session (IPv4, IPv6, non IP).
\- When the UE needs to send data (assuming the UE is already registered to
the network and has established a PDU session):
\- There is no N2 signalling exchange dedicated to the UE between the RAN and
the Core.
\- There is no N3 data plane connection dedicated to the UE between the RAN
and the Core.
\- As there is no signalling exchange dedicated to the UE between the RAN and
the Core, the RAN gets no security material dedicated to the UE. Thus the
security and the header (de)compression of the user plane traffic are handled
in the 5GC (in the UPF part of the 5GC). The corresponding parameters (e.g.
security algorithms, compression algorithms, etc.) are negotiated between the
UE and the AMF/SMF at PDU session set-up.
Editor\'s note: Any potential security impacts on signalling exchanges between
the RAN and the UE in order to re-use of the security parameters in the stored
UE context is to be studied by SA WG3.
\- As the Core network User plane Function (UPF) needs to decipher data
received from a UE via the RAN, the UL (uplink) data are sent by the UE
together with a non ciphered PDU session identifier allowing the UPF to
retrieve the deciphering context of the PDU session.
\- As the RAN needs to route Uplink (UL) traffic from the UE towards the UPF,
the UE needs to put packet forwarding information in its UL traffic allowing
the RAN to determine the relevant UPF.
\- The 5GC provides via NAS signalling UPF CL Service information (UCLSI) to
the UE: For DL traffic, UCLSI is associated with the UE RAN identifier and for
UL traffic, it indicates the packet forwarding information allowing the RAN to
determine the UPF. This information is provided on a per PDU session basis.
\- The 5GC provides UCLSI information to the UE at least upon UE request for a
PDU session set-up. This information needs also to be provided to the UE when
the UPF that supports the PDU session of the UE has been changed.
\- If UPF indicated by UCLSI is not known by RAN, then RAN uses a DNS
procedure based on the UCLSI prefix to determine forwarding information to the
UPF.
\- When the UPF receives UL traffic with a PDU session identifier for which it
has no corresponding context, the UPF fetches the corresponding information
from the AMF/SMF.
\- The UPF keeps track of the RAN from which it last received UL traffic from
a UE and associates this information with a UE Location Freshness Timer. As
long as the UE Location Freshness Timer has not elapsed, the UPF sends DL
(Downlink) traffic for an UE towards the RAN from which it last received UL
traffic from this UE. The DL data are sent by the UPF towards the RAN together
with a non ciphered UE identifier. If the RAN can\'t deliver the PDU (the UE
may have moved in the mean time) the RAN deletes the PDU and notifies the UPF
that removes the relationship between the UE and the RAN.
\- The network may use the expiry of the UE Location Freshness Timer as a
trigger to re-authenticate the UE.
\- When the UPF needs to send DL data towards an UE, and the UE Location
Freshness Timer has elapsed, the UPF may request the AMF/SMF to page the UE.
The AMF/SMF pages the UE in the Tracking Area List where it is registered.
\- The timer values may be set to default timer values. The timer value of the
UE Location Freshness Timer is determined by the network taking into account
the UE subscription.
\- The UE mobility relies on cell reselection, not on network controlled Hand-
Overs and the UE may send a dummy UL data message to the UPF to refresh the
UPF-RAN binding for the UE.
Editor\'s note: The security aspects related with this solution need to be
studied by SA WG3.
The architecture for Data transmission with ConnectionLess RAN-Core interface
consists of the following network elements (fig 6.29.2-1):
\- User equipment (UE).
\- Radio Access Network (RAN).
\- User plane Gateway (UPF).
\- Core control plane (AMF and SMF).
{width="6.675694444444445in" height="2.2291666666666665in"}
Figure 6.29.2-1: Architecture to support PDU sessions with Connectionless mode
transfer on the RAN-Core interface
The User plane protocol stack is derived from the baseline connection oriented
protocol stack with the UE-RAN layer PDCP slit between lower and upper parts:
\- SDAP layer: This layer, placed between IP and access stratum, links UE and
UPF, provides mapping between a QoS flow and a connectionless PDU session.
\- PDCP Upper: This layer, placed between IP and access stratum, links UE and
UPF, provides encryption and integrity protection between the UE and the
network. The PDCP Upper UP layer takes care to avoid packets duplication
(Sequence Numbering). The PDCP security procedure and detection of duplicated
messages are executed as in CO case with these PDCP functions located in the
UPF.
\- PDCP Lower: This layer, placed between the UE and RAN, provides PDU session
identification at RAN level.
\- Core CLS Relay: This layer, placed between the RAN and UPF, provides relay
of the PDU session identification and multiplexing of multiple PDU sessions
over a N3 link between an UPF and an AN Node.
{width="5.688888888888889in" height="2.2708333333333335in"}
Figure 6.29.2-2: User Plane Protocol stack for Connectionless mode transfer on
the RAN-Core interface
Figure 6.29.2-2 shows the layers that are involved in CL data transfer. CL re-
uses the existing protocol layers, and it adds the CLS Core Relay layer.
Following layers are to be defined by RAN groups:
\- PDCP Lower.
\- RLC: Radio control sublayer (responsible for segmentation and ARQ).
\- MAC: Media Access control (responsible for connectionless access and HARQ).
\- PHY: Physical Access.
\- CLS Core relay: CL data relay layer.
Editor\'s note: The protocol stacks over N3 is to be defined together with RAN
groups.
### 6.29.3 Support of EPC interworking
Connectionless (CL) mode is only supported in 5GC, but not in EPC. It is only
possible to initiate CL PDU session in 5GC. Mobility between EPC and 5GC is
supported, but if a CL PDU session is transferred to EPS PDN connection, it
will only work in Connection Oriented (CO) mode The existing UPF may be
maintained as CO anchor and so IP address continuity would be assured.
### 6.29.4 Procedures
#### 6.29.4.1 Identities
##### 6.29.4.1.1 UPF CL SERVICE Id (UCLSI)
UCLSI is used by UE, RAN and UPF to identify a PDU session with Connectionless
mode data transfer on the RAN-Core interface. This identifier contains an
Identifier of the UPF serving the PDU session and a local identifier for a
specific connectionless PDU session for a specific UE. RAN uses UCLSI to
derive the UPF that should handle Data exchanged with the UE. A UE may be
allocated one or more UCLSI on one or more UPF, each UCLSI corresponding to a
unique PDU session.
#### 6.29.4.2 Assumptions
\- The AMF/SMF has to select an UPF that supports PDU sessions with
Connectionless mode data transfer on the RAN-Core interface. The UPF selection
procedure takes also into account the specific parameters (e.g. security
algorithms, compression algorithms,...) proposed by the UE at PDU session set-
up.
\- The UPF manages a state per UCLSI. The UCLSI state can be:
\- REACHABLE: The UCLSI is marked as REACHABLE when the UPF knows the identity
of the RAN serving that UCLSI as the last correctly received UL PDU from the
UE has been received by the UPF via this RAN. The UCLSI REACHABLE state is
controlled by a freshness timer at the expiry of which the UCLSI state becomes
IDLE. The Timer is (re)started at the reception of each UL PDU correctly
received from the UE on that UCLSI.
\- IDLE: The UPF does not know the identity of the RAN serving that UCLSI.
Paging is required to send DL PDU for this UCLSI.
\- The RAN is assumed to also run a UE Location Freshness timer for UCLSI
availability. The Timer in the UPF is assumed to be shorter than the timer in
RAN.
\- The RAN and UPF set their UE Location Freshness timer to default value. The
UE receives its timer value at CL PDU session establishment time.
#### 6.29.4.3 Procedures
##### 6.29.4.3.1 Set-up of a PDU sessions with Connectionless mode data
transfer on the RAN-Core interface
This procedure is used to establish PDU sessions with Connectionless mode data
transfer on the RAN-Core interface. Procedure is re-using TS 23.502 [7] clause
4.3.2.2 UE Requested PDU Session Establishment with the following additions.
{width="6.489583333333333in" height="8.56875in"}
Figure 6.29.4.3.1-1: UE-requested PDU Session Establishment for non-roaming
and roaming with local breakout
The procedure assumes that the UE has already registered on the AMF thus
unless the UE is Emergency registered the AMF has already retrieved the user
subscription data from the UDM.
1\. Additionally to Step 1 actions in TS 23.502 [7] clause 4.3.2.2.1, the UE
may indicate CL PDU session request in the Request Type.
2\. Additionally to Step 2 actions in TS 23.502 [7] clause 4.3.2.2.1, if the
Request Type indicates CL PDU Session, then the AMF selects an SMF that
supports CL PDU Sessions.
3\. Additionally to step 3 in TS 23.502 [7] clause 4.3.2.2.1, the AMF includes
the CL indication in the request that it forwards to SMF.
4\. Additionally to step 4 in TS 23.502 [7] clause 4.3.2.2.1, the SMF
considers also the CL subscription information when authorising the PDU
session set-up, and responds to SMF.
5-7. As in TS 23.502 [7] clause 4.3.2.2.1 steps 5-7.
8\. Additionally to the criteria in step 8 of TS 23.502 [7] clause 4.3.2.2.1,
the SMF takes also the UPF ability to support CL signalling into account when
selecting UPF. SMF chooses a UPF CL SERVICE Id (UCLSI) that identifies the PDU
session and the UPF and gets from the AUC the keys to be used on the user
plane link between the UPF and the UE. The UCLSI includes a UPF prefix for DNS
query of the UPF IP address.
Editor\'s note: The derivation of the keys to be used between UE and UPF is to
be defined at SA WG3. It should consider the master Key output of the last
authentication as well as the UCLSI and the Direction of the traffic.
9\. As in TS 23.502 [7] clause 4.3.2.2.1 step 9
10\. Additionally to Step 10 actions in TS 23.502 [7] clause 4.3.2.2.1, if the
UE requested for CL PDU session in step 1 and the request is accepted by the
network, the SMF includes also the CL PDU session indication and the UCLSI in
the session establishment indication to the UPF.
11\. Additionally to Step 11 actions in TS 23.502 [7] clause 4.3.2.2.1, the
SMF includes the UCLSI to be used in this PDU session. If shared N3 tunnel
does not exist yet, then the SMF creates it.
12\. Additionally to Step 12 actions in TS 23.502 [7] clause 4.3.2.2.1, the
AMF indicates acceptance of CL PDU session and includes the UCLSI.
13\. Additionally to Step 13 actions in TS 23.502 [7] clause 4.3.2.2.1, RAN
selects appropriate RAN connectionless mechanism and sends associated RRC
message to UE along with NAS message from SMF providing PDU session set-up
response.
\- The UE calculates the key for the security association with UPF based on
the same algorithm and on the same input parameters than used by the Core
control plane (SMF) in step 10.
\- UE may use the connectionless service to complete the user plane
configuration (e.g. Router solicitation / IP address assignment, header
compression initiation (if any), etc.).
\- The UE stores the UCLSI for later use.
14-20. As in the corresponding steps in TS 23.502 [7] clause 4.3.2.2.1.
##### 6.29.4.3.2 UE connectionless uplink data transfer
{width="5.115277777777778in" height="3.8625in"}
Figure 6.29.4.3.2-1: UE triggered uplink connectionless transfer
Pre-conditions:
\- The UE has uplink connectionless data (a PDU) to send on one of its already
established PDU sessions with Connectionless mode data transfer on the RAN-
Core interface.
\- The UE is currently under coverage of a radio cell that supports current
connectionless mechanism configuration.
1\. The UE ciphers the PDU to transmit. The UE then puts the previously
assigned UCLSI in the CLS UP data header and adds an integrity check
signature.
UE access stratum may replace the UCLSI with a shorter identifier if available
from RAN and UE RAN freshness timer has not expired.
\- The UE sends uplink connectionless data transfer to the RAN using current
configured connectionless mechanism.
NOTE 1: The integrity check signature is to prevent another UE from injecting
traffic on the PDU session. It is calculated on the UCLSI and ciphered PDU,
not on any shorter RAN identifier possibly used instead the UCLSI on the air
interface.
2\. RAN sends ack to the UE.
RAN resets UE Location Freshness Timer for UCLSI and stores the mapping
between the UCLSI and the UE RAN identifier.
The UE resets the UE UCLSI Location Freshness Timer.
3\. If UPF indicated by UCLSI is not known by RAN then the RAN node constructs
FQDN based on UPF prefix contained in the UCLSI, and obtains the destination
UPF address via DNS procedure.
NOTE 2: This step takes place only for the first user served by the RAN that
is handled by a new UPF.
4\. Based on the received UCLSI, the RAN forwards all complete data PDUs with
header including UCLSI and integrity check to UPF over appropriate transport
interface (N3).
5\. Using the UCLSI, the UPF retrieves the context of the PDU Session. If such
context is not available the UPF may send a query to the Core control plane
(SMF).
6\. Using stored key UPF verifies the integrity check signature and decrypts
incoming uplink data.
If the Integrity check is negative the UPF silently discards the data.
Otherwise, (when needed) the UPF decompresses the PDU header.
The UPF learns that UE is available on a given RAN (the UCLSI state is
REACHABLE): the UPF (re)starts UE Location Freshness Timer for the UCLSI and
stores the UCLSI to RAN transport interface mapping.
7 The UPF forwards the PDU towards its destination.
8 Optionally, if requested during PDU session establishment, the UPF may
acknowledge the outcome of the procedure in a DL CL message, see clause
6.29.4.3.3.
##### 6.29.4.3.3 UE connectionless downlink data transfer
{width="5.115277777777778in" height="3.8625in"}
Figure 6.29.4.3.3-1: Downlink connectionless transfer
Pre-conditions:
\- The UE has previously established a PDU session with Connectionless mode
data transfer on the RAN-Core interface.
1\. The UPF receives downlink incoming data (a PDU).
2\. The UPF retrieves the UCLSI corresponding with the PDU session:
\- if the UCLSI state of the PDU session is marked as \"REACHABLE\", the UPF
uses the last known RAN serving this UCLSI.
\- The UPF compresses the IP header (when needed), encrypts the data, adds an
integrity check signature and selects the appropriate downlink RAN transport
interface for the UCLSI.
\- The UPF restarts UE Location Freshness Timer for UCLSI.
\- if UCLSI state for the PDU session is \"IDLE\" then the UPF may either drop
packet or initiate network page. This behaviour is controlled by a policy
received from Core control plane (SMF) itself possibly depending on
subscription.
\- The UPF sends a paging request for the UCLSI to Core CP, buffers the data
and starts a paging timer. Core CP triggers the corresponding paging by the
RAN. If the page response from UE arrives before the paging timer times out,
then the UPF learns current RAN serving the UE and forwards the data via this
RAN. This is further detailed in clause 6.29.4.3.4.
3\. (assuming UCLSI state is marked REACHABLE) the UPF adds the UCLSI in the
header and forwards the data over the downlink RAN transport interface for the
UCLSI that was selected in step 2. For any downlink incoming data, RAN matches
downlink UCLSI:
\- if UCLSI is known to RAN then RAN transmits the data to UE:
\- if UE transfer is successful, RAN restarts UE Location Freshness Timer for
UCLSI.
\- if UCLSI is not known to RAN (e.g. RAN previously had UE transfer fail or
after RAN UE freshness timer for UCLSI expires) then RAN drops the data and
sends NACK to UPF.
\- if UPF receives NACK from RAN (e.g. the UCLSI was known but transfer failed
or UCLSI was not known) then UPF clears UPF UE freshness timer and so marks
UCLSI state as \"IDLE\" (the UCLSI is no more associated with any RAN Node).
4\. The RAN transmits the data to UE based on the UE identification
corresponding with the UCLSI.
\- if UE transfer fails, RAN drops packet, sends NACK to UPF and deletes its
context for the UCLSI.
5\. When UE receives connectionless data, it processes the data (re-assembles,
decrypts, etc.), delivers the data to the application and sends uplink
acknowledgement. UE resets UCLSI freshness timer.
6\. If UPF UE freshness timer for UCLSI expires, UPF marks UCLSI state as
\"idle\".
7\. If RAN UE freshness timer for UCLSI expires, RAN deletes UCLSI.
8\. If UE freshness timer for UCLSI expires or UE reselects a new cell, UE
returns to connectionless idle state and stops monitoring downlink channels
for data reception.
##### 6.29.4.3.4 Paging for UE connectionless downlink data transfer
{width="5.115277777777778in" height="3.8625in"}
Figure 6.29.4.3.4-1: Paging for UE connectionless downlink data transfer
1\. The UPF receives DL data but the corresponding UCLSI state is marked
\"IDLE\" and the policy received from Core CP is to page the UE in that case
(step 2 of clause 6.29.4.3.3).
2\. The UPF notifies the SM that it has no RAN context for DL data related
with an UCLSI. SMF requests (Permanent User Id; UCLSI) AMF to Page the UE
corresponding to the permanent UE identifier (IMSI) associated with the UCLSI.
The AMF retrieves the corresponding UE NAS identifier (GUTI like) for paging.
3\. The AMF requests the RAN to page the UE and the RAN pages the UE.
4\. The UE issues a NAS Page response to the Core CP (AMF).
5\. The Core CP sends a NAS Reactivate CLS (UCLSI) to request the UE to
reactivate the UCLSI.
6\. The UE issues an UL Data request on the UCLSI (according to clause
6.29.4.3.2). The request contains in the UL CLS data Header the UCLSI as well
as an indication that the data is dummy (if the UE has no data to send and
chooses to send a dummy PDU). The UPF drops the data (if it indicated as a
dummy data) and updates the UCLSI context: The UPF starts UE Location
Freshness Timer for UCLSI and stores the UCLSI to RAN transport interface
mapping.
7\. The UPF restarts the DL data transmission according to Figure
6.29.4.3.3-1.
##### 6.29.4.3.5 Mobility support
{width="5.115277777777778in" height="2.7104166666666667in"}
Figure 6.29.4.3.5-1: Mobility support
1\. The UE and UPF exchange UL and DL connectionless data.
2\. The UE detects cell change while UCLSI remains valid.
3\. The UE issues an UL Data request on the UCLSI (per clause 6.29.4.3.2). The
request contains in the UL CLS data Header the UCLSI as well as an indication
that the data is dummy (if the UE has no data to send and chooses to send a
dummy PDU). RAN stores the mapping between UCLSI and UE RAN identifier.
4\. Using the UCLSI, the UPF retrieves the context of the PDU Session.
4a. If such context is not available the UPF may send a query to the Core
control plane (SMF).
4b. The UPF verifies the integrity check signature and decrypts incoming
uplink data and drops the data (if it was indicated as a dummy data) and
updates the UCLSI context: the UPF restarts UE Location Freshness Timer for
UCLSI and stores the UCLSI to RAN transport interface mapping.
##### 6.29.4.4.6 UPF Triggered Release and Redirection During UE
Connectionless Active Mode
{width="5.115277777777778in" height="2.4583333333333335in"}
Figure 6.29.4.4.6-1: UPF Initiated Release and Redirection
1\. The UE and UPF exchange UL and DL connectionless data.
2\. The UPF detects need for session release (security violation, UE traffic
profile violation, gateway overload protection, etc.).
3\. The UPF sends connectionless release request to the Core-CP (SM) with
session identifier UCLSI. The UPF provides a release cause indication.
4\. The Core-CP (SM) sends connectionless release request to the UE with
session identifier UCLSI. The Core-CP (SM) provides information on the release
cause indication and whether or not the network requires that UE request re-
establishment of the PDU session using CL and/or CO mode.
### 6.29.5 Impacts on existing entities and interfaces
#### 6.29.5.1 Impact on interfaces
The following interfaces are impacted:
N3:
\- Support for a shared N3 tunnel used to transport user data from all active
connectionless UEs on a given RAN that are assigned to the same UPF.
#### 6.29.5.2 Impact on entities
The following nodes are impacted:
UPF:
\- support for user data encryption and integrity protection using per UCLSI
security key.
\- maintain UCLSI freshness timer and RAN node association.
\- selective trigger paging for incoming traffic addressed to UE with expired
UCLSI freshness timer.
RAN:
\- support for at least one connectionless access mechanism (i.e. data over
msg3, data over msg5).
\- maintain RAN UCLSI freshness timer and UE RAN identifier association.
\- Resolve the target UPF based on UCLSI.
UE:
\- Ability to request ConnectionLess PDU session type.
\- storing the assigned UCLSI for subsequent CL data transport.
\- support for CL data transport using UCLSI.
SMF:
\- Ability to negotiate ConnectionLess PDU session type.
### 6.29.6 Evaluation
## 6.30 Solution 30: NEF based infrequent small data transfer via NAS-SM
### 6.30.1 Introduction
#### 6.30.1.1 General
This solution is built on top of Solution 1 in clause 6.1 and allows the
exchange of infrequent small data via an API. The Architecture Reference
Models, Functional Description, Interworking with EPS and Procedures of
Solution 1 are taken as baseline and this solution describes the missing
details to support infrequent small data transfer via NAS-SM via NEF between
the SMF and AF.
NOTE: As captured in clause 4, it is assumed that the exposure of network
capabilities towards the SCS/AS is done via NEF. In addition, as captured in
clause 8.9, _when a UE is capable of switching between EPC and 5GC, it shall
only be associated with combined SCEF+NEF node(s) for Service Capability
Exposure._ Consequently, data towards SCS/AS can be routed via a NEF+SCEF
combined node.
The solution also supports exposing small data APIs for infrequent small data
transmission to the AF. The APIs are based on the NIDD APIs which are defined
for the T8 interface in TS 29.122 [9].
API usage only applies to the case where the PDU Session type is Unstructured.
The following principles apply to this solution:
\- A PDU Session terminates at NEF.
\- The NEF exposes APIs to the AF for Small Data. The APIs are based on the T8
APIs that were defined in Release 15.
Support for RDS is provided as described in Solution 49.
#### 6.30.1.2 Architecture reference models
##### 6.1.1.2.0 General
This clause shows the architecture reference models that support API usage in
the cases where a NAS Small Data Delivery PDU Session terminates at a NEF.
This solution presents no Roaming Reference Architecture for the Local
Breakout case because a Small Data API service will not be exposed by the
visited network. This is in line with the architecture principle from TS
23.501 [5] which states \"_For external exposure of services related to
specific UE(s), the NEF resides in the HPLMN. Depending on operator
agreements, the NEF in the HPLMN may have interface(s) with NF(s) in the
VPLMN_ \".
APIs are exposed to the AF via the N33/Nnef reference point.
The N29 reference point will be used to send and receive small data packets
via the NEF.
##### 6.30.1.2.1 Non-roaming reference architectures
Figure 6.30.1.2.1-1 depicts a simplified service based architecture with the
entities involved in small data transfer via NEF.
{width="4.6875in" height="2.60625in"}
Figure 6.30.1.2.1-1: Simplified Service Based Architecture for small data
delivery via NEF (non-roaming)
##### 6.30.1.2.2 Roaming reference architectures
Figure 6.30.1.2.2-1: Simplified Service Based Architecture for small data
delivery via NEF (roaming with home routed scenario)
### 6.30.2 Functional Description
In addition to clause 6.1.2, the following principles apply:
\- Support of NIDD API:
\- The NIDD API is supported for PDU sessions of type unstructured.
\- The NEF supports the NIDD API towards the SCS/AS for both non-roaming and
home-routed roaming scenarios.
\- Whether or not the NIDD API shall be invoked for a PDU session is
determined by a per DNN per S-NSSAI Invoke NEF Selection indication in the
subscription.
\- If the subscription includes an Invoke NEF Selection indication and an NEF
ID for the S-NSSAI / DNN requested by the UE, then the SMF selects that NEF
for the small data PDU session.
\- The NEF ID for a given S-NSSAI / DNN in the subscription can be updated by
means of the NIDD configuration procedure.
\- The NEF performs buffering for unstructured DL data received via the NIDD
API while the UE is unreachable.
NOTE 1: See Solution 1 for UPF based data transfer.
\- API Exposure for Small Data:
\- The NEF exposes the NIDD Configuration, MT NIDD, and MO NIDD APIs that are
described in TS 23.682 [6] on the N33/Nnef reference point.
\- Routing Unstructured Data Between the NEF and AF:
\- Consistent with the method that is used in EPS and described in TS 23.682
[6], the NEF uses provisioned policies to map an AF Identity and UE Identity
to a DNN/S-NSSAI combination when the Reliable Data Service is not enabled.
When the Reliable Data Service is enabled, the NEF determines the association
based on RDS port numbers and provisioned policies that may be used to map AF
identities and User identity to an DNN.
### 6.30.3 Support of EPC interworking
EPC interworking is enabled by the principles documented in clause 6.1.3 with
the following differences:
\- NIDD API is terminated on a co-located NEF (capable of small data transfer)
and SCEF, referred to as NEF+SCEF.
\- Idle-mode mobility from 5GS to EPS is performed as per the procedure
described in TS 23.502 [7] clause 4.11.1.3.2 with the following differences:
\- Step 5b: NEF+SCEF maps the PDU session for Data over NAS-SM to an SCEF PDN
Connection and sets the Control Plane Only PDN Connection Indication.
\- Idle-mode mobility from EPS to 5GS is performed as per the procedure
described in TS 23.502 [7] clause 4.11.1.3.3 with the following differences:
\- AMF indicates support of CIoT Optimizations when requesting the UE context
from the MME via N26;
\- for a PDN connection for which Control Plane Only PDN Connection Indication
is set:
\- SMF selects a NEF;
\- in the case of home-routed roaming:
\- Step 14: the AMF selects a V-SMF supporting small data over NAS-SM;
\- Step 14: V-SMF selects a IWK-NEF.
\- When the Invoke NEF Selection flag is present in the UE\'s subscription
information for the PDU Session, the identified NEF will point to an SCEF+NEF
if EPC Interworking is supported.
### 6.30.4 Procedures
#### 6.30.4.1 PDU Session Establishment (non-roaming)
It takes the PDU Session Establishment procedure as described in TS 23.502
[7], subclause 4.3.2.2.1 as the baseline.
Figure 6.30.4.1-1: PDU Session Establishment enabling Data over NAS-SM via NEF
(non-roaming)
1\. The UE sends a PDU session establishment request message as SM payload of
a NAS transport message. The NAS transport message contains PDU session ID
along with other regular information e.g. DNN, S-NSSAI, etc. if applicable.
2\. The AMF determines if the PDU Session uses NAS-SM to transfer PDUs. If the
PDU Session will use NAS-SM to transfer PDUs, the AMF selects an SMF that
supports Data over NAS-SM if available for the requested DNN, and S-NSSAI. The
AMF stores the association of the PDU Session ID and the selected SMF ID in
the UE context.
NOTE 1: How the AMF determines if the PDU Session uses NAS-SM to transfer PDUs
will be determined as part of the Key Issue 15 conclusion.
3\. The AMF invokes Nsmf_PDUSession_CreateSMContext request including DNN,
S-NSSAI, PDU Session ID. The SMF replies with an
Nsmf_PDUSession_CreateSMContext Response. The AMF also indicates to the SMF if
the PDU Session uses NAS-SM to transfer PDUs.
4\. The SMF registers with the UDM and retrieves the Session Management
Subscription data for the corresponding SUPI, DNN and S-NSSAI. If the
subscription includes an Invoke NEF Selection indication for the DNN and
S-NSSAI indicated by UE, the SMF retrieves the NIDD information such as
External Group Identifier, External Identifier or MSISDN, AF ID and decides to
transfer data to the DN via NEF. The SMF selects the NEF based on the UE
subscription profile.
5\. The SMF configures the NEF for data transfer. This procedure is described
in clause 6.30.4.6.
6\. If NIDD configuration has been performed by the AF with the NEF, then the
procedure continues at step 7. If the polices that may be used to map SUPI,
DNN, S-NSSAI and Reliable Data Service Port Numbers (if applicable) to an AF
Identity are provisioned in the NEF then the procedure continues at step 7. If
NIDD configuration has not been performed by the AF with the NEF and AF
Identity is configured at NEF then the NEF may initiate NIDD Configuration as
described in clause 6.30.4.7.
If an AF identity is not been provisioned for the procedure of clause 6.30.4.7
then the PDU session establishment fails.
7\. The SMF sends a PDU Session Establishment Accept providing indication that
Data Over NAS-SM is enabled for this PDU session without including the N2 SM
container.
8\. The AMF forwards the NAS message to the UE.
#### 6.30.4.2 PDU Session Establishment (home-routed roaming)
This procedure takes the PDU Session Establishment procedure as described in
TS 23.502 [7], subclause 4.3.2.2.2 as the baseline.
Figure 6.30.4.2-1: PDU Session Establishment enabling Data over NAS-SM via NEF
(home-routed roaming)
1\. The UE sends a PDU session establishment request message as SM payload of
a NAS transport message. The NAS transport message contains PDU session ID
along with other regular information e.g. DNN, S-NSSAI, etc. if applicable.
2\. The AMF determines if the PDU Session uses NAS-SM to transfer PDUs. If the
PDU Session will use NAS-SM to transfer PDUs, the AMF selectsan SMF that
supports Data over NAS-SM if available for the requested DNN, and S-NSSAI. The
AMF stores the association of the PDU Session ID and the selected SMF ID in
the UE context.
NOTE 1: How the AMF determines if the PDU Session uses NAS-SM to transfer PDUs
will be determined as part of the Key Issue 15 conclusion.
3\. The AMF invokes Nsmf_PDUSession_CreateSMContext request including DNN,
S-NSSAI, PDU Session ID. The V-SMF replies with an
Nsmf_PDUSession_CreateSMContext Response. The AMF also indicates to the V-SMF
if the PDU Session uses NAS-SM to transfer PDUs.
4\. The V-SMF sends the Nsmf_PDUSession_CreateSMContext request to the H-SMF.
The V-SMF also indicates to the H-SMF if the PDU Session uses NAS-SM to
transfer PDUs.
5\. The H-SMF registers with the UDM and retrieves the Session Management
Subscription data for the corresponding SUPI, DNN and S-NSSAI. If the
subscription includes an Invoke NEF Selection indication for the DNN and
S-NSSAI indicated by UE, the H-SMF informs the V-SMF to transfer data to the
DN via NEF.
6\. The H-SMF responds to the V-SMF.
7\. The V-SMF configures the NEF via the IWK-NEF for data transfer.
8\. The V-SMF sends a PDU Session Establishment Accept providing indication
that Data Over NAS-SM is enabled for this PDU session without including the N2
SM container.
9\. The AMF forwards the NAS message to the UE.
#### 6.30.4.3 Mobile Originated Data Transport via NAS-SM and N6 (NEF
Anchored)
The Mobile Originated Data Transport Procedure of Solution 1 (see clause
6.1.4.2) is used, with the following modifications:
\- The UPF is changed to an NEF.
\- Between steps 5 and 6, the NEF uses the MO NIDD Indication procedure of TS
23.682 [6], clause 5.13.4 to provide the data to the AF.
#### 6.30.4.4 Mobile Terminated Data Transport via NAS-SM and N6 (NEF
Anchored)
The Mobile Terminated Data Transport Procedure of Solution 1 (see clause
6.1.4.3) is used, with the following modifications:
\- The UPF is changed to an NEF.
\- The NEF may buffer DL data as described in TS 23.682 [6].
\- The procedure is initiated by the AF invoking the MT NIDD Submit Request as
described in TS 23.682 [6], clause 5.13.3.
\- If UL Data is included in step 14, then the NEF will uses the MO NIDD
Indication procedure of TS 23.682 [6], clause 5.13.4 to provide the data to
the AF.
#### 6.30.4.5 NIDD Configuration for Data Transport via NAS-SM
The NIDD Configuration procedure will take place between the AF and NEF as
described in TS 23.682 [6], clause 5.13.2. The NEF uses the UDM/UDR to
authorise the NIDD Configuration.
#### 6.30.4.6 SMF-NEF Connection
Figure 6.30.4.6-1: SMF-NEF Connection Establishment Procedure
1\. UE performs steps 1-4 of PDU Session Establishment Procedure for Data
transfer over NAS-SM described in clause 6.30.4.1. The SMF receives the
Session Management Subscription data for the corresponding SUPI, DNN and
S-NSSAI that is associated with an Invoke NIDD API indication, NEF ID and NIDD
information such as External Group Identifier, External Identifier or MSISDN
and AF ID.
2\. If the subscription information corresponding to DNN and S-NSSAI includes
Invoke NIDD API indication, the SMF shall create a PDU session towards the
NEF. The SMF does so by sending a Create NEF Connection Request (User
Identity, PDU session ID, NEF ID, NIDD information, S-NSSAI, DNN) message
towards the NEF. If the IWK-NEF receives the Create NEF Connection Request
message from the SMF, it shall forward it toward the NEF.
If an AF has performed the NIDD Configuration procedure (see NIDD
configuration procedure of TS 23.682 [6]) with the NEF for User Identity
received in step 2, then step 3 is executed. If no AF has performed the NIDD
Configuration procedure with the NEF for the User Identity, then the NEF
initiates a NIDD Configuration by NEF procedure (see clause 6.30.4.7) with AF.
3\. The NEF creates an NEF PDU session Context for the user identified via
User Identity and PDU session ID. The NEF sends a Create NEF Connection
Response (User Identity, PDU session ID, NEF ID, S-NSSAI, DNN) message towards
the SMF confirming establishment of the PDU session to the NEF for the UE. If
the IWK-NEF receives the Create NEF Connection Response message from the NEF,
it shall forward it toward the SMF.
#### 6.30.4.7 NIDD Configuration by NEF
Figure 6.30.4.7-1 illustrates the procedure for configuring necessary
information triggered by NEF for data delivery via the NIDD API.
Figure 6.30.4.7-1: NIDD Configuration by NEF Procedure
0\. UE performs steps 1-5 of PDU Session Establishment Procedure for Data
transfer over NAS-SM described in clause 6.30.4.1. If NIDD Configuration has
not been performed by the AF with the NEF and AF Identity is configured at NEF
then the NEF may initiate NIDD Configuration.
1\. The NEF sends an NIDD Configuration Trigger (External Group Identifier,
External Identifier or MSISDN, AF ID, NEF ID) message to the AF for asking the
NIDD Configuration Request for the UE identified by External Identifier or
MSISDN.
2\. The AF sends an NIDD Configuration Request message to the NEF as described
in TS 23.682 [6], clause 5.13.2. The NIDD Configuration Request includes the
Authorization Token. The Authorization Token is used for authorizing the AF by
the UDM (the Authorization Token is shared between UDM and AF during SLA).
3\. The NEF sends an NIDD Authorization Request (External Group Identifier,
External Identifier or MSISDN, S-NSSAI, DNN, AF ID, Authorization Token)
message to the UDM to authorize the NIDD configuration request for the
received External Identifier or MSISDN.
4\. The UDM examines the NIDD Authorization Request message with Authorization
Token. If this check fails, the UDM follows step 5 and provides a result
indicating the reason for the failure condition to the NEF.
5\. The UDM sends an NIDD Authorization Response (SUPI and MSISDN or External
Identifier, Result) message to the NEF to acknowledge acceptance of the NIDD
Authorization Request. The SUPI and, if available, the MSISDN (when NIDD
Configuration Request contains an External Identifier) or if available,
External Identifier(s) (when NIDD Configuration Request contains an MSISDN)
are returned by the UDM in this message. This allows the NEF to correlate the
AF request received in step 1 of this procedure with the PDU session to be
established for this subscriber if this procedure takes place during a PDU
Session Establishment procedure.
6\. The NEF sends an NIDD Configuration Response message as described in TS
23.682 [6], clause 5.13.2 to the AF to acknowledge acceptance of the NIDD
Configuration Request. If the NIDD Configuration was accepted, the NEF assigns
a TLTRI to the NIDD Configuration and creates an association between the
TLTRI, External Identifier or MSISDN, SUPI, and PDU session ID which is
received from the SMF in step 5 of the PDU Session Establishment procedure in
clause 6.30.4.1. In the MT NIDD procedure, the NEF will use TLTRI and External
Identifier or MSISDN to determine the SUPI and PDU session ID of PDU session
for delivering non-IP data. In the MO NIDD procedure, the NEF will use the
SUPI and PDU session ID to obtain the TLTRI, External Identifier or MSISDN.
### 6.30.5 Impacts on existing entities and interfaces
The same impacts indicated in clause 6.1.5 apply, with the following
differences:
NEF:
\- Support for extended buffering.
\- Support for the NIDD Configuration, MT NIDD, and MO NIDD APIs as described
in TS 29.122 [9] and TS 23.682 [6].
\- Support for services on the N29 interface with the SMF for Unstructured PDU
Sessions (similar to the functionality that is available on the N4 interface
between the SMF and UPF).
### 6.30.6 Evaluation
Solution 30 is part of Solution 1 and allows the exchange of infrequent
unstructured small data via NIDD API. The NEF supports the NIDD API towards
the AF for both non-roaming and home-routed roaming scenarios. The same pros
and cons of Solution 1 apply.
This solution successfully addresses Key Issues 1 (Support API(s) for
infrequent small data transmission and capability exposure to AF).
## 6.31 Solution 31: Deferring of Periodic Registration Update
### 6.31.1 Introduction
This solution applies to Key issue 4 (Power Saving Functions) as maximize
sleeping period of the UE when the UE applies extended idle mode DRX.
During in idle mode period (i.e. CM-IDLE), UE repeatedly performs paging
monitoring procedure in every Paging Occasion to check incoming call. Also, UE
shall perform periodic Registration Update procedure to update reachability
with AMF. In other words, major jobs of the UE in idle mode period is that
paging reception and periodic Registration Update. It is clear that
maximization of idle period is important for the extreme power saving
requirements. The time for paging reception is an appointment between UE & eNB
(absolute time calculation) so it can\'t be changed. However, the time for
periodic Registration update is an appointment between UE & AMF. Therefore the
time for Registration update is adjustable if the AMF is aware & allowed of
this.
### 6.31.2 Functional Description
When the AMF configures idle mode eDRX via NAS procedure (i.e. Registration
Update), the AMF can additionally provide the applicability of \"Deferring of
Periodic Registration Update\" for further power saving. If the UE receives
the indication, the UE can defer the time for next Registration Update
procedure to the nearest Paging Occasion time when the periodic Registration
Update timer is expired. So the UE can avoid waking-up twice when the time for
paging reception and the time for execution of Registration Update is
adjacent.
If the AMF indicates to use \"Deferring of Periodic Registration Update\",
then the AMF should respect the UE\'s behaviour for deferring of periodic
Registration Update. Therefore the AMF should take the eDRX period into
account when the AMF calculates mobile reachable timer. Support of the
\"Deferring of Periodic Registration Update\" is optional both for UE and AMF.
Editor\'s note: whether this batching of periodic registration update and
paging reception is covered by implementation is FFS.
### 6.31.3 Support of interworking
Editor\'s note: This clause describes if and how EPC-5GC interworking is
supported in this solution.
### 6.31.4 Procedures
Figure 6.31.4-1 illustrates the procedure of configuring of Deferring of
Periodic Registration Update.
{width="6.468055555555556in" height="3.4368055555555554in"}
Figure 6.31.4-1: Configuration of Deferring of Periodic Registration Update
1\. The UE may indicate capability of \"Deferring of Periodic Registration
Update\" while the UE is performing NAS procedures (i.e. Registration) along
with desired idle mode eDRX parameters for power saving.
2\. If the AMF accepts the usage of Deferring of Periodic Registration Update,
the AMF should indicate this via Registration Accept message.
3a. The UE determines the next periodic Registration Update time. If the
Deferring of Periodic Registration Update indicated by the AMF, the UE can
defer the time for next Periodic Registration Update procedure to the time for
nearest Paging Occasion.
Editor\'s note: Necessity of the indication \"Deferring of Periodic
Registration Update is required\" by a UE is FFS.
3b. The AMF applies eDRX period to set Mobile Reachable Timer and control of
PPF (Paging Proceed Flag).
### 6.31.5 Impacts on existing entities and interfaces
Editor\'s note: This clause describes impacts to existing entities and
interfaces.
In the AMF:
\- Considering eDRX period for Mobile Reachable timer handling.
In the UE:
\- Indicating the capability of Deferring of Registration Update to AMF. Also
adjust (defer) the execution time for next periodic Registration Update to the
time for nearest PO.
### 6.31.6 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.32 Solution 32: MO Data Buffering in the UE
### 6.32.1 Introduction
This clause presents a solution for Key Issue 5 - UE Tx Power Saving
Functions.
This solution is suitable for UEs whose traffic patterns can be characterized
as non-delay sensitive or high-latency. For example, many IoT applications are
characterised by the fact that they collect data and send the data to one or
more AF(s) (i.e. SCS/AS(s)) in a delay tolerant manner; e.g. they collect data
and it is acceptable if the data is not sent to the SCS/AS(s) until hours
after it is collected.
The premise of the solution is that when a delay tolerant application on the
UE decides to initiate MO traffic and the UE is in RRC Idle Mode, the UE may
decide to delay establishing an RRC Connection and transmitting the MO data
until the UE decides that it can be sent with relatively low power. For
example, when the UE is in good coverage, is able to use a non-3GPP AN, or is
in a particular location.
### 6.32.2 Functional Description
The following principles apply to this solution:
\- In order to minimize UE power consumption, the UE delays establishing an
RRC connection for sending MO data until it is able to transmit with
relatively low power. Thus, MO data might not be sent when the data is
collected. The UE may send the data when conditions are suitable to the UE and
without regard to whether the AF(s) (i.e. SCS/AS(s)) are ready to receive the
data.
Editor\'s note: It is FFS how the UE determines that traffic is delay tolerant
(e.g. it may be implementation dependent and not specified, configured via OMA
DM, OMA LwM2M, UICC Application Configuration, or configured NAS/AS
signalling).
Editor\'s note: It is FFS how and when the UE decides to begin transmitting
(e.g. it may be implementation dependent and not specified or configuration
dependent (e.g. configured signal quality threshold, configured AN type,
configured location)).
### 6.32.3 Support of EPC interworking
Editor\'s note: This clause describes if and how EPC-5GC interworking is
supported by this solution.
### 6.32.4 Procedures
Figure 6.32.4-1 shows the procedure for delaying MO data until it can be
transmitted with relatively low power.
Figure 6.32.4-1: Procedure for Buffering MO Data in the UE
1\. An application on the UE collects data.
NOTE: If there are multiple UE applications, they may collect data separately
or in a coordinated manner.
2\. The UE delays initiating MO data because it is in weak coverage. How the
UE ultimately decides when to send the MO data is implementation and/or
application dependent and is not specified.
3\. The UE sends the application data to the AF.
### 6.32.5 Impacts on existing entities and interfaces
Editor\'s note: This clause describes impacts to existing entities and
interfaces.
### 6.32.6 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.33 Solution 33: Delayed Paging Response
### 6.33.1 Introduction
This solution propose a solution for Key Issue 5 - UE Tx Power Saving
Functions.
UE transmitting power is sensitive to the link quality, for example, the UE\'s
transmitting power needed is about 100 times higher when RSRP is -100dBm
compared to when RSRP is 80dBm. In the current mechanisms, when a page
arrives, the UE will attempt to transmit the page response in any coverage
condition, e.g. in good, in weak coverage, or even in enhanced coverage. When
in weak coverage, UE might transmit with maximum TX power, and maybe try many
times; when in enhanced coverage, UE will repeat the TX signal tens or hundred
times, all of which consume significant amount of UE battery power.
Some IoT devices or applications are delay tolerant i.e. the data exchange is
not urgent, (e.g. IoT device software update, advertisement push, notification
message etc). This solution intends to avoid the UE responds the paging in a
very bad coverage, which would consumes much more UE battery power.
This solution targeting moving mobile terminals and may not be applied to
stationary mobiles for which coverage is unchanged most of the time.
### 6.33.2 Functional Description
This clause describes a solution for delayed response to the paging by the UE
when paged for delay tolerant services. A UE capable of delayed paging
response indicates its capability for delayed paging during registration and
the UE is allocated a delayed paging response window. The AMF can obtain the
delayed paging response window from the specific AF which UE subscribes. When
such a UE is paged with indication for delayed paging and the radio coverage
conditions are poor, the UE may decide to delay the transmission of the
response to the paging until radio conditions improve, while still within the
delayed paging response window.
Some assumptions and requirements are made:
1) The AF may subscribe for delayed paging service so that it is notified when
the UE responds to the paging.
2) The AMF can determine the delayed paging response window from the
subscription data.
3) The AMF can obtain the delay tolerant information via the
Namf_Communication_N1N2MessageTransfer service operation related to the
incoming downlink data.
4) The AF or the UPF can buffer the downlink data so it is available at least
during the delayed paging response window.
5) The mechanism to establish the PDU Session and data transmission depends on
the solution defined in other key issues.
6) The UE monitors all paging occasions (POs) including POs within the delayed
paging response window. In case the UE uses the eDRX feature the UE monitors
only the PO\'s scheduled within the PTW that was received during eDRX
negotiation.
### 6.33.3 Support of EPC interworking
Not applicable since there is no corresponding mechanism specified in EPC.
### 6.33.4 Procedures
{width="6.690972222222222in" height="3.8944444444444444in"}
Figure 6.33.4-1: Paging for delay tolerant UEs and applications
1\. An AF may subscribe with the SMF/UPF/AMF for delayed paging response, e.g.
to be notified when the UE responds to delayed paging. The AF may also
provision the delayed tolerant service level information via the NEF, this
information is used by the AMF to determine the delayed paging response
window.
2\. UE initiates Registration Request, indicating to the AMF that UE is
delayed paging capable.
3\. The AMF obtains UE subscription information to verify the UE attributes
and the subscribed service characteristic information. The AMF may obtain a
delayed paging response service information from the subscription information.
4\. The AMF accepts the registration request from the UE and returns delayed
paging response window. The AMF shall take into account the subscription
information when determining the delayed paging response window.
5\. When an AF wants to exchange delay tolerant data with a UE, the AF invokes
downlink Nnef_DataTransfer (external UE Id, delayed_paging_ind). The
delayed_paging_ind parameter is present when the AF request is for delayed
paging.
6\. The NEF derives the UE identity from UE\'s External identifier and
triggers Namf_Communication_N1N2_message_transfer service operation.
7-8. When AMF receives the Namf_Communication_N1N2MessageTransfer with delayed
paging indication, the AMF sends paging message to the UE with delayed paging
indicator. The AMF may page the UE in registration area granularity in order
to avoid the case where the UE has moved out of the paging area, e.g. the last
known cell or tracking area. The AMF can also page the UE within a narrower
area (e.g. the cell list) than the registration area in order to save paging
overhead, and if the AMF does not receive UE paging response during the
delayed paging response window, AMF can re-page the UE in the whole
registration area.
9-10. After receiving the paging message with delayed paging indication, the
UE may delay the response to the paging if current radio conditions are not
good (based on UE implementation or radio signal quality thresholds configured
in the UE via OMA DM, for example) until better radio conditions within the
delayed paging response window. If signal quality thresholds are used for the
UE to decide when the radio condition are good or not good, the operator may
configure the UE with lower signal quality thresholds so that the UE employs
the paging delay behaviour only when the current radio coverage is really bad
or the worst coverage (e.g. the UE is close to cell borders or coverage hole).
This way the UE\'s chances to get better radio coverage conditions before the
delayed paging response window expires are much higher.
NOTE 1: If a UE, based on implementation, is determined to be temporary
stationary, then the UE may decide not to delay the page response even if the
radio conditions are not good.
11\. The expected Paging Response/Service Request from the UE is received
within the delayed paging response window. If the paging response is not
received after the delayed paging response window timer expires, AMF will fall
back to normal paging and will re-page the UE with normal paging.
12\. The AMF notifies the AF about the UE response to the delayed paging.
NOTE 2: If the UE receives a normal paging message during the delayed paging
response window, the UE shall respond to this paging message. All pending DL
data can then be delivered including the DL data that triggered the delayed
paging message.
### 6.33.5 Impacts on existing entities and interfaces
NEF:
\- New API allowing the AF to provision the network via the NEF with delayed
tolerant service requirements.
AMF:
\- AMF to support the new function of delayed tolerant paging response window
e.g. acquire new subscription info, determine the window size, and provision
the delayed paging response window to the UE during Registration procedure.
RAN:
\- The Uu Paging message need to include one new bit, the \"delayed paging
indicator\", so the UE can differentiate whether the page is for delay
tolerant DL data or not.
UE:
\- UE to support delayed paging capability indication within the Registration
Request message and the new behaviour associated with this feature.
### 6.33.6 Evaluation
In case the UE can delay the page response and corresponding communication
until the radio channel improves, the UE can save power. However, there is no
guarantee that the radio channel will improve during the delayed paging
window, the radio channel could even deteriorate and make the power
consumption worse. Based on UE implementation, the UE needs to evaluate the
opportunity/risk and determine whether to perform the delayed page response
taking into consideration e.g. the added power consumption while monitoring
the radio channel and the expected mobility.
## 6.34 Solution 34: Provisioning of UE TX power saving parameters
### 6.34.1 Introduction
This solution addresses the Key Issue#5 - \"UE TX Power Saving Functions\" and
Key Issue #13 - \"Support for Expected UE Behaviour\".
### 6.34.2 Functional Description
UE TX power saving is intended to optimize the power consumption of UE when in
bad or weak coverage. This solution has following feature -
1\. UE applying TX power saving feature are assumed to be Delay Tolerant UEs.
Such UE shall be configured as Delay Tolerant, or for Low Access Priority, or
Unified Access Control Access Priority 1.
2\. UE determines bad/weak coverage based on locally configured minimum signal
quality threshold i.e. if the serving cell signal drops below a configured
minimum signal quality threshold. UEs supporting Enhanced Coverage may derive
configured minimum signal quality threshold from CE Mode A & B criterion. For
NB-IoT UEs CE level 1 or CE level 2 criterion can be used to determine minimum
signal quality threshold.
3\. Such UE is provisioned with the following UE TX power saving parameters -
\- **MO Data buffering Indicator** \- This indicates if MO data buffering is
enabled or disabled in the UE when the UE is in bad or weak coverage
condition.
\- **MO Data Buffer Timer** \- Maximum Time for MO data buffering i.e. maximum
time for transmission delay. This timer is started when UE has MO data to
send. If running, this timer is stopped when the UE is in good coverage. On
expiry of this timer UE may transmit buffered MO data even if coverage
condition is not improved.
In addition, following parameters may also be provisioned:
\- **Suggested number of MO PDU to buffer** \- Indicated suggested maximum
number of MO PDUs to be buffered by the UE. In absence of this parameter
number of MO PDUs to be buffered is left to the UE implementation.
\- **Exception Data buffering Indicator** \- This indicates whether or not to
also buffer Exception data when the UE is in bad or weak coverage conditions.
4\. UE TX power saving parameters may be pre-configured in the UE (e.g. at
manufacturing) or by using OTA mechanisms.
5\. UE TX power saving parameters may be included part of Expected UE
Behaviour parameters specified in clause 4.15.6.3 of TS 23.502 [7]. Similar to
Expected UE Behaviour parameters, UE TX power saving parameters may be
provisioned in AMF from AS/AF via NEF (as specified in clause 4.15.6 of TS
23.502 [7]). AMF provides these parameters to the UE via Registration or
Configuration Update procedure.
### 6.34.3 Support of EPC interworking
No additional impact for EPC interworking. UE that supports connectivity to
both EPC and 5GC can be configured with UE Tx power saving parameters and can
apply those for MO data buffering when in bad/weak coverage.The UE Tx power
saving parameters only apply when the UE is connected to the 5GC.
### 6.34.4 Procedures
5GS may expose the capability of UE TX power saving towards external AF/AS,
NEF may provide APIs that allows external AF/AS to control UE TX power saving
parameters. UE TX power saving parameters may be included part of Expected UE
Behaviour parameters specified in clause 4.15.6.3 of TS 23.502 [7]. Similar to
Expected UE Behaviour parameters, UE TX power saving parameters may be
provisioned in AMF from AS/AF via NEF (as specified in clause 4.15.6 of TS
23.502 [7] and Solution 15: External parameter provisioning in the 5GC). AMF
sends UE TX power saving parameters to the UE via registration or
configuration update procedure. UE TX power saving parameters value provided
by the network overrides any pre-configured value in the UE.
### 6.34.5 Impacts on existing entities and interfaces
UE:
\- Configuration of UE TX power saving parameters for MO data buffering as
specified in clause 6.34.2.
NEF:
\- Capability exposure via API to allows external AF/AS to control UE TX power
saving parameters.
AMF:
\- For external parameter provisioning there is no additional impact on top of
solution 15.
### 6.34.6 Evaluation
In order to minimize the impact on the network interfaces the solution allows
pre-configuring UE TX power saving parameters in the UE. For the scenarios
that require 3^rd^ party application server /function to have control, UE TX
power saving parameters can be exposed via NEF APIs. It is expected that NEF
APIs are not used to frequently update UE TX power saving parameters else it
may lead to signalling overload in the 5GS. However this aspect is not
specific to this solution and applies in general to any external parameter
provisioning in the 5GC (covered in solution #15 and solution #26).
## 6.35 Solution 35: Small data delivery
### 6.35.1 Introduction
This solution addresses key issue #1, Infrequent Small data communication, key
issue #2, Frequent Small data communication, and key issue #9 Support of
common north-bound APIs for EPC-5GC Interworking. This solution enables the
NEF to support the same NIDD API for both UP and CP data. If the 3rd party
Application Server has to select different NEFs just because the small data is
routed over the UP or the CP path to the UE, the route inside the 3GPP network
would not be transparent to the Application Server.
### 6.35.2 Functional Description
#### 6.35.2.1 Architecture
The 5GS is assumed to support functions for small data communication
corresponding to EPS. These EPS functions are aka \"NIDD procedures\" and
involves transmission either using the T8 API (see TS 23.682 [6], clause 5.13)
or directly over the SGi (see TS 23.401 [4], clause 4.3.17.8.3.3).
To support small data communication using an API corresponding to T8 NIDD API,
this solution uses NEF which supports the T8 NIDD API and a UPF. The UPF
supports small data delivery via user plane connectivity to NEF. Optionally
the UPF can be co-located with a NEF. The NEF supports an NIDD API, common for
EPC CIoT and 5G CIoT, on the northbound interface. The Small data function is
also referred to as \"UPF-NEF\" in figures below.
The figure 1 below shows two approaches to support frequent small data
communication with the SCS/AS, either:
\- using T8 NIDD API; or
\- directly over N6.
The former refers to the NIDD API over T8 interface specified in TS 23.682
[6].
Roaming is supported by using UPF in VPLMN and in HPLMN connected with N9
interface as shown in Figure 6.35.2.1-2 below.
This solution includes the connectivity between UPF and NEF for Small Data
Communication using T8, and meets the following architecture requirements:
\- KI 1 and KI 2 architecture requirements of both IP-based and Non-IP based
small data communication. The 5G User Plane is designed to handle IP
communication and Non-IP/Unstructured communication.
\- Both infrequent and frequent small data communication can be supported with
API access for SCS/AS.
\- The SMF manages connectivity between UPF and NEF for Small Data
Communication using T8.
Figure 6.35.2.1-1 shows the non-roaming case. In this case, small data is
tunnelled between the UPF and NEF via N6n.
Roaming is supported as shown in Figure 6.35.2.1-2 below. For roaming case,
UPF in VPLMN connects to UPF in HPLMN via N9 interface which has connectivity
via N6n with NEF in HPLMN.
The N6n reference point is between UPF and NEF for support of small data
transmission using UP transport. From UPF viewpoint, N6n is like N6 but using
tunnelling between UPF and NEF in the same PLMN e.g. based on IP
encapsulation/decapsulation as shown below in Figure 6.35.2.1-1.
Figure 6.35.2.1-1: 5G non-roaming architecture reference model
Figure 6.35.2.1-2: Roaming 5G System architecture
#### 6.35.2.2 Small data delivery
The Small data delivery enables UE - SCS/AS communication. The Small data
delivery is supported by a NEF which supports the NIDD API and a UPF. The UPF
may be dedicated for small data delivery which support N6n connectivity to
NEF.
The UPF-NEF interface for small data communication is assumed to be inside the
operator domain:
Northbound NEF interface:
\- API for NIDD related procedures as specified in the TS 29.122 [9] clause
4.4.5.
\- The Common API Framework (CAPIF).
Southbound NEF interface:
\- N6n interface.
\- Forwarding NIDD received over T8 NIDD API to the UE via user plane.
\- The southbound interface has a PDU session layer which support PDU Sessions
of different types. IPv6 and IPv4 PDU session type shall be supported. PDU
Sessions of Unstructured PDU session type (aka \"Non-IP\") are also supported.
\- All types of data (IP data and Unstructured data) should be tunnelled over
N6n. NEF is located within the operator network and its interfaces should not
be directly exposed to UEs for security reasons.
\- Higher layer IoT protocols be used towards the UE on top of the PDU Session
layer, but those protocols are outside of the scope of 3GPP.
The UPF N4 interface:
\- PFCP Session Establishment and N6n tunnelling establishment.
\- SMF support for UDM interaction at NIDD Configuration and NIDD
Authorization Update (see TS 23.682 [6]). Stage 3 decision if new UPïƒ CP
message are used or if the existing PFCP Session Modification message is used.
The NEF supports store-and-forward of small data. The northbound API is
terminated in the NEF.
NOTE 1: Additional application layer functionality of the NEF is beyond the
scope of 3GPP.
The following principles apply in addition:
Southbound as part of the NEF:
\- N6n tunnelling establishment by Nnef service operation. NEF supports N6n
tunnels between UPF and NEF.
\- The NEF supports Functionalities for Unstructured PDU Session Type data
transfer, i.e. IP encapsulation for downlink data and IP decapsulation for
uplink data.
\- The NEF stores its NEF ID in the UDM during NIDD Configuration.
\- Reliable Data Service between UE and NEF is supported when requested and
authorized. The UE indicates its capability of supporting RDS to the network
using PCO and the SMF indicates its NEF support for RDS to the UE in the PCO.
SMF:
\- The SMF retrieves the NEF ID from the UDM during PDU Session establishment
procedure, and the SMF provides the N6 PtP tunnel information (toward NEF) to
the UPF or the UE.
\- The SMF allocates UPF N6n PtP tunnel information or uses N4 services with
UPF to allocate UPF N6n PtP tunnel information (if UPF is used to allocate the
end points).
\- The SMF uses Nnef services to provide the UPF N6n PtP tunnel information
(the IPv6 address and the UDP port of the tunnel end at the UPF) to the NEF
and to request NEF to allocate a NEF N6n PtP tunnel information.
\- The SMF uses Nnef services to negotiate support of RDS and maps this
information with RDS support indication in PCO .
\- The SMF provides the NEF N6n PtP tunnel information to the UPF, as a
separate N4 service or using the same N4 service as the RAN N3 Tunnel
information is provided to the UPF (i.e. the PFCP Session Establishment
Request).
### 6.35.3 Support of EPC interworking
Interworking could be supported via explicit 5GS and EPS specifications, but
it is proposed to re-use the already specified 5GS - EPS interworking
principles.
It is proposed to not add in the EPS specifications the PGW - SCEF interface
corresponding to UPF-NEF interface in 5GC, but the already agreed 5GS - EPS
interworking principles can be re-used to provide interoperability between EPS
and 5GS. TS 23.502 [7] clause 4.11.0a.4 specifies that combined SMF+PGW-C can
be assigned to a UE that is indicating 5G NAS capability. The combined
SMF+PGW-C can then select a combined UPF+PGW-U node, as shown in TS 23.501 [5]
clause 4.3.
The N6n interface is proposed for Rel-16 5GC only, so interoperability
requires network support for combined SCEF+NEF node. For UE moving between 5GC
and EPC, connectivity options supported by UE and combined SCEF+NEF node may
differ.
Editor\'s note: Maintenance of RDS context in the mobility between EPC and 5GC
is FFS.
The capability of tunnelling User Plane small data from UPF to NEF provides
thus the same capability for User Plane small data over the combined UPF+PGW-U
and combined SCEF+NEF (as specified in solution 13) also when the 5GS + EPS
capable UE is served by EPS.
Editor\'s note: How to determine whether APN corresponds to N6 or N6n DNN
after mobility to 5GS is FFS.
Since DNN intended for small data over the user plane is configured in the
network to be associated with NEF supporting T8 services, there is no need to
indicate small data over user plane in the PDU Session or PDN Connection
establishment and the EPS - 5GS mobility does not introduce any additional
requirements on the UE context transfer.
### 6.35.4 Procedures
#### 6.35.4.1 Connection establishment for UPF and NEF
Figure 6.35.4.1-1 shows connection setup procedure for user plane small data
delivery using T8 NIDD API. Transport of small data over IP (IPv4, IPv6) and
Unstructured PDU session types is supported. Small data is tunnelled over the
N6n interface, the tunnel is configured at connection establishment.
Figure 6.35.4.1-1: NIDD configuration and small data transfer path setup
procedure
It is assumed that NIDD configuration between NEF and AF has been performed
already (Step 0). During NIDD configuration, the NEF stores NIDD configuration
parameters along with NEF\'s routing information (e.g., IPv6 address, port
number, etc) to the UE\'s SM subscription data. The data path to the NEF is
established by the UE performing PDU Session Establishment procedure.
The PDU Session Establishment Procedure is performed as defined in TS 23.502
[7] with the following additions:
1\. The UE includes in PDU Session Establishment Request a specific DNN per
URSP. This DNN is configured in the network to be associated with NEF
supporting T8 NIDD API services.
2\. The AMF selects a SMF based on the specific DNN requested by the UE along
with the other parameters as specified in TS 23.502 [7].
4\. The SMF determines that the PDU Session requires the involvement of a NEF
(i.e. for the T8 NIDD API. The SMF retrieves NEF information from the UE\'s
subscription data in the UDM, i.e. NEF ID.
5\. The SMF selects UPF. The SMF allocates UPF N6n Tunnel information and UPF
N3/N9 Tunnel information. If the UE requests IP PDU session type (e.g., IPv4,
IPv6), the SMF allocates an IP address/prefix for the PDU Session as described
in TS 23.501 [5] clause 5.8.1. If the UE requests Unstructured PDU session
type, the SMF allocates an IPv6 prefix for the PDU Session without involving
the UE.
6\. The SMF provides the NEF with the UPF N6n Tunnel information, the PDU
Session Type and optionally the allocated IP address/prefix for the UE for the
N6n UPF-NEF tunnel and with NIDD configuration parameters, e.g., External
Identifier, AF ID (i.e. T8 destination address), and DNN as retrieved in Step
4. The NEF associates the NIDD configuration for the UE with the UPF N6n
Tunnel information and the allocated IP address/prefix for the UE for the PDU
Session. The NEF stores the N6n Tunnel information in order to route the DL
small data towards the UE on PDU session determined based on DNN associated
with the NIDD configuration and the user identity.
The NEF responds to the SMF including the NEF N6n Tunnel information. New Nnef
service operations that supports the above parameters is used for the N6n
tunnel configuration.
If the UE indicated in the PCO its willingness to support RDS, the SMF
negotiates RDS with the NEF during that step.
7\. SMF includes the APN Rate Control parameters in the PCO. If RDS has been
successfully negotiated with the NEF, the SMF sends a RDS indication to the UE
in PCO;
8-9. Same as the PDU Session Establishment Procedure defined in TS 23.502 [7]
10\. SMF updates the UPF using N4 Session Modification Request with the NEF
N6n Tunnel information and the RAN N3 Tunnel Information.
#### 6.35.4.2 MO small data transfer
Figure 6.35.4.2-1 shows delivery over user-plane procedure.
Figure 6.35.4.2-1: Small Data delivery over User Plane using T8 NIDD API
For uplink data:
1\. The UE sends uplink data via user plane.
2-3. The UL PDU is encapsulated and forwarded on the N6n tunnel.
4\. The NEF receives the small data over the N6n connection and determines
target AF. The NEF performs IP decapsulation (i.e. removes the IP header).
5\. NEF forwards the received small data as NIDD to the AF via T8 NIDD API
using public user identity.
For downlink data:
1\. NEF receives the NIDD from the AF via T8 NIDD API targeted for public user
identity.
2\. The NEF resolves the 3GPP user identities, determines if UP or CP shall be
used for the received DL packet and determines target N6n Tunnel and the UE IP
address (if any). The NEF performs IP encapsulation based on the N6n
Tunnelling information.
3-4. The NEF transfers downlink data to the UPF. The UPF acting as PDU Session
Anchor performs IP decapsulation for the received data (i.e. removes the N6n
tunnelling headers) and determines the PDU Session for the UE to deliver the
data.
5\. The UPF forwards the small data to the UE.
### 6.35.5 Impacts on existing entities and interfaces
Impacts on SMF: establishment of a N6n tunnel between UPF and NEF.
Impacts on UDM to support UDM Services equivalent to the NIDD Configuration
and NIDD Authorization Update procedures in TS 23.682 [6]. Provision of NEF ID
to the SMF.
The NEF supports tunnelling of small data over N6n with a UPF and new Nnef
service operation needed for the point-to-point tunnel management between UPF
and NEF.
NOTE: In this solution IP tunnelling at N6n is assumed, but the tunnel type is
expected to be specified as part of Stage 3.
Impacts on UPF to support N6n Tunnelling with NEF including
encapsulation/decapsulation.
### 6.35.6 Evaluation
In addition to small data over N6, this solution can support as a new feature
also small data via NEF over user plane.
This solution enables the 5GC to use the same NEF and NIDD API for both UP and
CP data. A 3rd party Application Server can use T8 NIDD API towards the UE
whether the UE supports UP data or CP data for its small data transmission.
That is, the route inside the 3GPP network is transparent to the Application
Server, and the T8 NIDD API is available also for UEs supporting UP data.
The solution supports UPF and NEF inter-connected via N6n reference point.
This solution can be deployed via combined node that supports UPF and NEF
functionality in a single node.
## 6.36 Solution 36: CM-CONNECTED with RRC Inactive state for frequent small
data transmission
### 6.36.1 Introduction
This solution applies to Key issue 2 (Frequent small data communication). The
key idea of the solution is to introduce CM-CONNECTED with RRC Inactive for
frequent small data transmission.
### 6.36.2 Functional Description
CM-CONNECTED with RRC Inactive is used for frequent small data transmission
with following enhancement to avoid frequent N3 tunnel switching for UE with
mobility within the RNA, especially for frequent single UL or single UL/DL
scenarios:
\- The SMF sends Small Data Information to the RAN to assist the RAN\'s
decision whether the UE can be sent to RRC Inactive state as described in
subclause 6.28.2. The Frequent Small Data Information may include frequent
small data indication, communication pattern, etc. The SMF may retrieve Small
Data Information based on network configuration, user subscription, etc.
\- The UE may send Request for Small amount of Data in RRC Resume Request.
\- The RAN may decide not to switching N3 path to serving RAN to avoid
unnecessary N2 signalling and UE reconfiguration of RNA due to new anchor RAN
node after the path switch.
Additionally, following enhancement for supporting the UP CN-initiated
deactivation of UP connection procedure specified in clause 6.36.4.3:
\- The RAN may remove the PDU session context locally without RAN paging
during the CN-initiated deactivation of UP connection for a UE in RRC
connection inactive state.
### 6.36.3 Support of EPC interworking
There is no interworking with EPC since this solution requires support for RRC
Inactive and EPC does not support RRC Inactive.
### 6.36.4 Procedures
#### 6.36.4.1 Connection Inactive procedure
The serving RAN node may decide to move the UE to RRC Inactive state based on
UE activity, small data Information, etc. as described in subclause 6.28.2,
when the UE is in CM-CONNECTED with RRC Connected state.
NOTE: The details of the procedure will be defined by RAN Group in Rel-15.
#### 6.36.4.2 Connection Resume procedure
The Connection Resume procedure is used by the UE to perform RRC Inactive to
RRC Connected state transition. After the Resume procedure, the UE may deliver
small data via resumed user plane.
Figure 6.36.4.2-1: Resume procedure for small data transmission
0\. The \"Small Data Information\" has been provided to the old RAN node at
PDU session establishment as PDU Session specific information (called \'SMF
assisted NG-RAN information\') within the N2 SM information, see clause 6.28.2
1\. UE to RAN: RRC Resume Request (Resume ID, Request for Small amount of
Data).
The UE initiates the transition from RRC Inactive state to RRC Connected
state. Optionally, the UE may include Request for Small amount of Data in the
Resume Request.
NOTE 1: The details of how the request for \"Small amount of Data\" is
indicated in the RRC Resume request is up to RAN WG2 to define.
2\. [Conditional] The new RAN node performs UE Context Retrieval.
UE Context Retrieval is performed when the UE Context associated with the UE
attempting to resume its connection is not locally available at the new RAN.
The UE Context Retrieval via radio access network is specified in TS 38.300
[19].
The new RAN, based on the \"Small Data Information\" received in the UE
Context or Request for Small amount of Data received from the UE, may decide
to establish a forwarding tunnel between target RAN and old RAN rather than to
perform N3 Path switch for frequent small data transmission.
NOTE 2: The old RAN node keep the UE context, since the N3 tunnel is not
switched to the new RAN node.
NOTE 3: Is up to RAN to define the mechanisms to establish the forwarding
tunnel between the Old RAN and the target RAN.
NOTE 4: How RAN makes decision whether to establish forwarding tunnel or N3
path switch on receiving both \"Small Data Information\" and Request for Small
amount of Data is up to RAN implementation.
3\. New RAN to UE: RRC Resume message.
The new RAN confirms to the UE that the UE has entered RRC Connected state.
4\. The UE delivers small data via user plane.
5\. The new RAN may trigger Connection Inactive procedure to move UE to RRC
inactive state. The old RAN node will remain as Anchor RAN node and the UE
will reuse the same Resume ID and RNA as before the transitioning to
RRC_Connected state. After this procedure, the new RAN removes UE context and
forwarding tunnel and indicates the old RAN that the UE enters RRC inactive
state.
NOTE 5: This procedure refers to the Connection Resume Procedure defined for
NG-RAN. The detailed procedure will be aligned to the procedure for E-UTRA
which will be defined by RAN Group in Rel-15.
#### 6.36.4.3 CN-initiated deactivation of UP connection when the UE is in RRC
inactive state
The following procedure is used to deactivate UP connection (i.e. data radio
bearer and N3 tunnel) for an established PDU session of a UE in CM-CONNECTED
state and RRC_Inactive state.
NOTE 1: This procedure can be evaluated separately from clauses 6.36.4.1 and
6.36.4.2.
Figure 6.36.4.3-1
1\. The SMF determines that the UP connection of the PDU session needs to be
deactivated.
2\. The SMF initiates an N4 Session Modification procedure indicating the need
to remove (R)AN Tunnel Info for N3 tunnel of the corresponding PDU session.
3\. The SMF sends an N11 message containing N2 SM Session Release Request to
release the (R)AN resources associated with the PDU session.
4\. The AMF forwards the N2 SM Session Release Request to the RAN.
5\. The RAN removes UP resources for the PDU session(s) received in step 4 and
do not perform RAN paging, if the UE is in RRC_inactive state;
6\. The RAN acknowledges the N2 Session Release Request by sending an N2 PDU
Session Response (\"N1 SM Message Not Transferred\") to the AMF.
7\. The AMF sends an N11 message to acknowledge the SM request received in
step 4.
8\. When the UE triggers the Connection Resume procedure, the UE provides its
Resume ID needed by the RAN to access the UE\'s stored Context;
9\. The RAN confirms the Resume Procedure UE entered RRC Connected state. The
RAN indicates the resumed PDU sessions via PDU session IDs;
NOTE 2: The exact mechanism by which the PDU sessions are synchronized will be
defined by RAN WG2.
10\. The UE releases locally the UP resources related to the PDU Sessions not
received from the NG-RAN in step 9.
### 6.36.5 Impacts on existing entities and interfaces
RAN:
\- The RAN decides whether the UE can be sent to RRC Inactive state based on
the frequent small data indication received from the SMF.
\- The RAN, based on the \"Small Data Information\" received from the SMF, may
decide establish a forwarding tunnel between target RAN and old RAN during the
Resume procedure.
SMF:
\- The SMF includes \"Small Data Information\" in the N2 SM information if the
SMF determines the PDU session is used for frequent small data.
UE:
\- The UE includes Request for Small Data in the RRC Resume Request.
Additionally, following impacts for supporting the UP CN-initiated
deactivation of UP connection procedure specified in clause 6.36.4.3.
RAN:
\- The RAN removes UP resources for the PDU session(s) and do not perform RAN
paging during the CN-initiated deactivation of UP connection procedure, if the
UE is in RRC inactive state.
\- The RAN notifies the available PDU sessions during the Resume procedure.
UE:
\- The UE releases locally the UP resources related to the PDU Sessions not
received during the Resume procedure.
### 6.36.6 Evaluation
RAN-CN signalling load can be minimized for small data communication for UEs
that have mobility within a RAN Notification Area.
With CN-initiated deactivation of UP connection when the UE is in RRC inactive
state (subclause 6.36.4.3), the paging signalling caused by UP connection
deactivation can be avoided. There is minor impact on the RRC resume message
and no additional signalling is introduced.
## 6.37 Solution 37: Monitoring
### 6.37.1 Introduction
This solution addresses key issue #11 - \"Monitoring\".
### 6.37.2 Functional Description
The Monitoring Events feature is intended for monitoring of specific events in
3GPP system and making such monitoring events information reported via the
NEF. It is comprised of means that allow NFs in 5GS for configuring the
specific events, the event detection, and the event reporting to the requested
party.
5GS supports various monitoring events. List of monitoring event already
supported in 5GC are specified in Table 4.15.3.1-1 of TS 23.502 [7].
Editor\'s note: It is FFS if any additional Monitoring event is required to be
supported by 5GS.
Support for Monitoring Events can be offered either via AMF (as described in
clause 6.37.4.1), or via UDM (as described in clause 6.37.4.2), or via PCF (as
described in clause 6.37.4.2) and can be reported via the NEF (as specified in
in clause 4.15.3 of TS 23.502 [7]). Based on operator policies, it shall be
possible to configure Monitoring Events such that some Monitoring Event
follows procedures in clause 6.37.4.1 while another Monitoring Event follows
procedures in clause 6.37.4.3.
### 6.37.3 Support of EPC interworking
#### 6.37.3.1 General
The support of EPC interworking relies on combined SCEF + NEF node as
specified in solution #13. Interaction between the SCEF and NEF in the
SCEF+NEF need not be standardized.
Monitoring events only need to be configured by the SCEF+NEF one time, by
using either EPC or 5GC procedures. In other words, when a monitoring event
has been configured by the SCEF procedures towards the HSS, the NEF need not
repeat the same monitoring event configuration towards the UDM, and vice
versa.
Consistent with existing EPS-5GS interworking scenarios in TS 23.501 [5], the
subscriber data base is managed by a combined HSS+UDM node.
#### 6.37.3.2 Interworking with N26 interface
When UE moves from 5GS to EPS, the UE context information sent by AMF to MME
includes the monitoring event configuration information. Similarly when UE
moves from EPS to 5GS, the MME\'s MM context information sent by MME to AMF
includes the monitoring event configuration information.
#### 6.37.3.3 Interworking without N26 interface
When SCEF+NEF performs the procedure of monitoring via the AMF as described in
clause 4.15.3.2.4 (\"Exposure with bulk subscription\") in TS 23.502 [7], if
the AMF determines the interworking without N26 interface is supported, the
AMF shall subscribe UE\'s mobility from 5GS to EPS from UDM+HSS on behalf of
SCEF+NEF as described in clause 7.1.2 of TS 23.501 [5] .When UE\'s mobility
from 5GS to EPS happens and Serving MME sends Update Location Request to the
UDM+HSS, the UDM+HSS sends Serving MME ID to the SCEF+NEF which is the
Notification Consumer.Then the SCEF+NEF performs the procedure of configuring
monitoring at the MME as described in clause 5.6.1.1 of TS 23.682 [6].
When SCEF+NEF performs the procedure of monitoring via the UDM+HSS as
described in clause 4.15.3.2.2, when UE\'s mobility between 5GS and EPS
happens, the UDM+HSS performs the procedure of configuring monitoring at the
MME as described in clause 5.6.1.1 of TS 23.682 [6] and at the AMF as
described in clause 4.15.3.2.2 of TS 23.502 [7].
### 6.37.4 Procedures
#### 6.37.4.1 Monitoring events at AMF
Procedure for monitoring via AMF is specified in clause 4.15.3.2.1 of TS
23.502 [7].
#### 6.37.4.2 Monitoring events at UDM
Procedure for monitoring via UDM is specified in clause 4.15.3.2.2 of TS
23.502 [7].
#### 6.37.4.3 Monitoring events at PCF
##### 6.37.4.3.1 General
In EPC Monitoring Events via the PCRF enables the SCEF (or AF/AS) to retrieve
the location information and to report communication failure of a UE. In 5GC
Location reporting and communication failure event reporting are supported via
AMF and PCF.
##### 6.37.4.3.2 PCF service operations information flow
Figure 6.37.4.3.2-1: Npcf_EventExposure_Subscribe and Notify operations
1\. The AS subscribes to one or several Event(s) (identified by Event ID) and
provides the associated notification endpoint of the AS by sending
Nnef_EventExposure_Subscribe request.
Event Reporting Information defines the type of reporting requested (e.g. one-
time reporting, periodic reporting or event based reporting, for Monitoring
Events). If the reporting event subscription is authorized by the NEF, the NEF
records the association of the event trigger and the requester identity. The
subscription may also include Maximum number of reports and/or Maximum
duration of reporting IE.
2\. The NEF subscribes to received Event(s) (identified by Event ID) and
provides the associated notification endpoint of the NEF to PCF by sending
Npcf_EventExposure_Subscribe request.
3a. [Conditional] If the requested event (e.g. monitoring of Loss of
Connectivity) requires AMF assistance, then the PCF sends the
Namf_EventExposure_Subscribe to the AMF serving the requested user. As the PCF
itself is not the Event Receiving NF, the PCF shall additionally provide the
notification endpoint of itself besides the notification endpoint of NEF. Each
notification endpoint is associated with the related (set of) Event ID(s).This
is to assure the PCF can receive the notification of subscription change
related event.
3b. [Conditional] AMF acknowledges the execution of
Namf_EventExposure_Subscribe.
If the subscription in step 1 is applicable to a group of UE(s) or any UE, the
PCF sends the Namf_EventExposure subs request to the corresponding AMF in case
subscripton applied to a UE or a group of UE(s), or all the AMF in this PLMN
in case subscription applied to any UE.
4\. PCF acknowledges the execution of Npcf_EventExposure_Subscribe.
If the subscription is applicable to a group of UE(s) and the Maximum number
of reports is included in the Event Report information in step 1, the Number
of UEs is included in the acknowledgement.
5\. NEF acknowledges the execution of Nnef_EventExposure_Subscribe to the
requester that initiated the request.
6a. [Conditional - depending on the Event] The PCF detects the event occurs
and sends the event report, by means of Npcf_EventExposure_Notify message to
the associated notification endpoint of the NEF.
6b. [Conditional - depending on the Event] The AMF detects the event occurs
and sends the event report, by means of Namf_EventExposure_Notify message to
associated notification endpoint of the NEF.
If the AMF has a maximum number of reports stored for the UE or the individual
member UE the AMF shall decrease its value by one for the reported event if
the UE or the individual member UE.
For both step 6a and step 6b, when the maximum number of reports is reached
and if the subscription is applied to a one UE, The NEF unsubscribes the
monitoring event(s) to the PCF and the PCF unsubscribes the monitoring
event(s) to AMF for the UE.
For both step 6a and step 6b, when the maximum number of reports is reached
for an individual group member UE, the NEF uses the Number of UEs received in
step 4 to determine if reporting for the group is complete. If the NEF
determines that reporting for the group is complete, the NEF unsubscribes the
monitoring event(s) to the PCF and the PCF unsubscribes the monitoring
event(s) to AMF for each individual UE within that group.
When the Maximum duration of reporting expires in the NEF, the PCF and the
AMF, then each of these nodes shall locally unsubscribe the monitoring event.
7\. [Conditional - depending on the Event] The NEF forwards to the AS the
reporting event received by either Npcf_EventExposure_Notify and/or
Npcf_EventExposure_Notify.
8\. [Conditional - depending on the Event] The AMF detects the subscription
change related event occurs, e.g. Subscription Correlation ID change due to
AMF reallocation, it sends the event report, by means of
Namf_EventExposure_Notify message to the associated notification endpoint of
the PCF.
### 6.37.5 Impacts on existing entities and interfaces
PCF:
\- Support of new service operations - Npcf_EventExposure_Subscribe,
Npcf_EventExposure_Notify.
### 6.37.6 Evaluation
This solution addresses the architectural requirements for the Key Issue #11 -
\"Monitoring\".
## 6.38 Solution 38: eDRX RRC_INACTIVE STATE in 5GS
### 6.38.1 Introduction
The proposal is to enable an eDRX equivalent feature from EPS in 5GS for UE in
RRC_INACTIVE. It addresses Key Issue 4, Power saving functions.
### 6.38.2 Functional Description
The proposal is to enable an eDRX equivalent feature from EPS in 5GS for UE in
RRC_INACTIVE.
As the 5GC has a different architecture and some new functionality compared to
EPC some adaptions are needed compared to eDRX in EPS. The following adoptions
are needed:
\- eDRX sleep cycle negotiation:
In EPC the UE requests extended idle mode DRX parameters during attach
procedure and RAU/TAU procedure and the SGSN/MME may reject or accept the UE
request for enabling extended idle mode DRX .\ In case the SGSN/MME accepts
the extended idle mode DRX, the SGSN/MME based on operator policies and, if
available, the extended idle mode DRX cycle length value in the subscription
data from the HSS, may also provide different values of the extended idle mode
DRX parameters than what was requested by the UE. If the SGSN/MME accepts the
use of extended idle mode DRX, the UE applies extended idle mode DRX
parameters either as received or modified by SGSN/MME.
The same principles can be used on 5GC but the procedures used by the UE to
request extended DRX parameters will be Registration and Registration Update.
Three alternatives regarding extended DRX parameters are listed:
Alternative 1: The same extended DRX parameters and thus DRX cycle is used for
UE in CM-IDLE as well as in CM-CONNECTED with RRC_INACTIVE. This ensures that
paging occasions will overlap when UE is paged by the CN (CM-IDLE) or by NG-
RAN (RRC_INACTIVE).
Alternative 2: The UE requests different extended DRX parameters in the
registration request to be used when in UE is in CM-IDLE and CM-CONNECTED with
RRC_INACTIVE. The AMF may reject or accept the UE request for enabling
extended DRX for RRC inactive. If the AMF accepts the use of extended DRX for
RRC inactive, the AMF indicates the enabling of extended DRX for inactive to
the UE and passes the requested extended RRC inactive DRX parameters to RAN.
Then the RAN decides and configures DRX parameters for RRC inactive as
specified in TS 38.300 [19].
Alternative 3: The UE requests idle mode eDRX parameters from the AMF. The AMF
passes the UE\'s Accepted idle mode eDRX parameters to the RAN. If the UE
supports eDRX in RRC inactive, the RAN configures the UE with an eDRX cycle in
RRC-INACTIVE up to the value for the UE\'s idle mode eDRX cycle as provided by
the AMF or up to the maximum value allowed based on the NAS (and SMS)
retransmission timers (whichever is lower). The RAN buffers DL packets up to
the duration of the eDRX cycle chosen by RAN.
NOTE 1: The maximum value will be determined by CT groups and is assumed to be
configured in the RAN.
In EPS the UE and the SGSN/MME handle the request. In 5GS the UE handling
shall be the same but in 5GC it will be the AMF instead of SGSN/MME.
\- Subscription information :
Extended DRX cycle length value needs to be added in the subscription data
from the UDM using the same principles as in EPS. For alternative 2, an
RRC_INACTIVE specific extended DRX cycle needs to be added.
\- Hyper SFN, Paging Hyperframe and Paging Time Window.
Same handling as in EPC but in 5GC the AMF will assign the Paging Time Window.
The AMF will include the Paging Time Window in the extended DRX parameters to
the UE and in the paging eDRX information to the NG-RAN.
NOTE 2: Whether the solution for Hyper SFN and Paging Hyperframe in NB-IoT and
WB-E-UTRAN in the 5GS Rel-16 will look the same as extended idle mode DRX
(eDRX) in E-UTRAN depends on RAN further work.
### 6.38.3 Support of EPC interworking
eDRX depends on UE provided parameters in Attach/TAU respective Registration
Requests, plus subscription information and local policies in the MME
respective AMF. This means the eDRX handling can be kept separate in EPC and
5GC and no specific interworking is required.
### 6.38.4 Procedures
The existing procedures in 5GC will be reused to handle the eDRX signalling
between AMF, NG-RAN, UDM and UE.
### 6.38.5 Impacts on existing entities and interfaces
In alternative 1 the UE shall send request for extended DRX parameters, that
are valid for CM-IDLE and CM-CONNECTED with RRC_INACTIVE to the AMF.
In alternative 2 the UE sends RRC_INACTIVE specific extended DRX parameters to
the AMF. The UE will also receive the extended DRX parameters and utilize this
information for extended DRX handling.
In alternative 3 the UE requests idle mode eDRX parameters from the AMF. The
AMF passes the UE\'s Accepted idle mode eDRX parameters to the RAN. The RAN
configures the UE with an eDRX cycle up to the value for the UE\'s idle mode
eDRX cycle as provided by the AMF or up to the maximum value allowed based on
the NAS (and SMS) retransmission timers (whichever is lower). For CM-CONNECTED
with RRC-INACTIVE, the RAN is assumed to be able to buffer DL packets for the
duration of the eDRX cycle chosen by RAN.
The AMF shall handle the request from the UE and reject, modify or accept the
request. If accepted (as is or with modification) the AMF shall set the
extended DRX parameters and supply relevant parameters to UE and NG-RAN.
The UDM may include the extended DRX cycle length value in the subscription
data to the AMF.
The NG-RAN will receive the paging eDRX information from the AMF.
### 6.38.6 Evaluation
This solution uses eDRX for CM-CONNECTED with RRC_INACTIVE. It allows eDRX
cycles longer than the 2.54 seconds to increase device battery efficiency
while UEs are using CM-CONNECTED with RRC_INACTIVE. The length of the eDRX
cycle supported in RRC inactive depends on the alternative chosen during study
conclusion.
## 6.39 Solution 39: UE availability after DDN failure for multiple AFs
### 6.39.1 Introduction
This solution addresses Key Issue 3 (High latency communication) in case of
multiple Application Functions (AFs).
When multiple AFs communicate with a UE, each of them can subscribe to the
\"Availability after DDN failure\" event. When a Downlink Data Notification
(DDN) failure occurs it should be possible for the CN to notify only a subset
of all the AFs that subscribed to the \"Availability after DDN failure\" event
(e.g., only the AF(s) that previously sent the data which trigged the DDN
failure, or only the AF(s) that want to be notified for a specific traffic
type).
### 6.39.2 Functional Description
**When an AF subscribes to the \"Availability after DDN failure\" event, the
AF includes a Traffic Descriptor to identify the data sent by the AF. The
event is subscribed to UDM through NEF.**
**When the AF sends the downlink data, CN identifies which AF sent the down
link data by using the Traffic description information received from AF. When
the UE becomes available, the CN notifies the AF that has subscribed to the
event and sent the data.**
**The function can be divided into Event Subscription and Activate Event
Report:**
\- Event Subscription:
\- AF subscribe the \"availability after DDN failure event\". The subscribing
event includes traffic description information to identify the data sent by
the AF. The event is subscribed to UDM through NEF. The NEF generate NEF
Reference ID for the event. The NEF Reference ID identify the correlation
between the event and the AF that subscribe the event.
\- The UDM sends the subscription to AMF including NEF ID, NEF Reference ID
and Event type.
\- Based on Slice information, DNN, and/or AF Service ID, the UDM sends the
subscription to (V-)SMF for existing PDU Session or during PDU Session
establishment. The SMF send traffic filters to detect the traffics sent by the
AF. These traffic filters are designed according to the traffic description
info sent by AF. The (V-)UPF detects the traffic sent by AF and report to the
(V-)SMF in the DDN message.
\- Activate Event Report:
\- After receiving the DDN message for the AF service, the (V-)SMF sends
message to AMF including the NEF Reference ID.
\- AMF activates the event after DDN failure based on the NEF Reference ID.
\- When the UE become reachable, the AMF notify the corresponding AF that has
subscribed the event and sent the data.
### 6.39.3 Support of EPC interworking
The solution is only applied for 5GC.
### 6.39.4 Procedures
#### 6.39.4.1 Event Configuration
The procedure of Event Configuration is depicted in Figure 6.39.4.1-1.
The procedure supports the non-roaming case, the local breakout (LBO) case as
well as the home routed case.
The procedures\' message flows for the non roaming and LBO cases are the same.
The only difference is that in the latter case the AMF, the SMF, the UPF are
located in the visited network.
In case of home routed roaming, the UDM subscribes the event to the V-SMF
through the H-SMF.
{width="6.6625in" height="3.6881944444444446in"}
Figure 6.39.4.1-1: Event Configuration - Availability Notification after DDN
Failure
1\. The AF subscribes to the \"Availability after DDN failure\" event by
invoking Nnef_EventExposure_subscribe (UE ID/Group ID, AF ID, Availability
after DDN failure, DNN/S-NSSAI/AF-Service-ID, Traffic Descriptor) service of
the NEF. The \"Availability after DDN failure\" element is used to identify
the event type of the subscription.
The Traffic Descriptor is sent by the AF if it wants to be notified of the
availability after DDN failure for a specific traffic type. The Traffic
Descriptor can be e.g. an IP-3-Tuple(destination IP address/IPv6 prefix, port
number, protocol in use), an Application ID, a non-IP descriptor, or an
Ethernet traffic descriptor or other descriptor information that can be used
to identify specific AF service. UE ID can be GPSI and Group ID can be
external group ID.
2\. The NEF receives the request from the AF and invokes
Nudm_EventExposure_subscribe (UE ID/Group ID, AF ID, Availability after DDN
failure, DNN/S-NSSAI/AF-Service-ID, Traffic Descriptor, NEF ID, NEF Reference
ID) towards the UDM. The NEF Reference ID is used to identify the correlation
between the event and the AF that subscribe the event.
3\. From UDM to AMF: Namf_EventExposure_Subscribe request(Availability after
DDN failure, NEF ID, NEF Reference ID). The AMF responds to the request.
4\. The UDM determines the (V-)SMF based on the Slice information, DNN, and/or
AF Service ID. From UDM to (V-)SMF: Nsmf_EventExposure_Subscribe(Availability
after DDN failure, Traffic Descriptor, NEF ID, NEF Reference ID). Traffic
Descriptor is used to indicate the traffic corresponding to the event and
identify the AF that provide the service. The (V-)SMF generates a Traffic
Indicator that allows the (V-)SMF to correlate the Traffic Descriptor, NEF ID
and NEF Reference ID for future events.
NOTE 1: In the home routed case, the UDM sends the subscription to the V-SMF
via the H-SMF.
5\. The (V-)SMF sends an N4 Session Establishment/Modification Request to the
(V-)UPF and provides Traffic Descriptor and the related Traffic Indicator to
the UPF.
6\. The (V-)SMF acknowledges the execution of Nsmf_EventExposure_Subscribe.
NOTE 2: In the home routed case, the V-SMF sends the subscription to the UDM
via the H-SMF.
7\. The UDM acknowledges the execution of Nudm_EventExposure_Subscribe.
8\. The NEF acknowledges the execution of Nnef_EventExposure_Subscribe.
#### 6.39.4.2 Notification
The procedure for notification after DDN failure is depicted if Figure
6.39.4.2-1.
Figure 6.39.4.2-1: Notification - Availability Notification after DDN Failure
1\. (V-)UPF receives the downlink data sent by AF.
NOTE 1: In the home routed case, the data is received by the V-UPF via the
H-UPF.
2\. (V-)UPF sends Downlink Data Notification (DDN) message to the (V-)SMF,
including the Traffic Indicator related to the Traffic Descriptor that
triggered the event so the (V-)SMF can determine which service the downlink
data belongs to. If multiple applications are bound to the same QoS flow, the
UPF sends the DDN message per application to the (V-)SMF for this QoS flow.
3\. Based on the Traffic Indicator, the (V-)SMF can determine which Event the
downlink data belongs to and determine the NEF ID and the NEF Reference ID to
be sent to the AMF. The (V-)SMF sends Namf_CommunicationN1N2MessageTransfer to
AMF including the NEF ID and the NEF Reference ID. This message is sent even
if the (V-)SMF had previously been notified that the UE is unreachable.
4\. If DDN fails (e.g. UE is not reachable), the AMF sends
Namf_CommunicationN1N2MessageTransfer response to SMF to notify if of the DDN
failure.
5\. The SMF (V-)sends DDN failure indication to (V-)UPF.
6\. The AMF notes the subscription option for notification of availability
after DDN failure for the UE, and sets a Notify-on-available-after-DDN-failure
flag corresponding to the NEF ID and NEF Reference ID received in step 3.
7\. At some later time, the UE contacts the network, e.g., to perform
registration, or as it executes a service request.
8\. If the Notify-on-available-after-DDN-failure flag for the UE is set then
AMF sends Namf_EventExposure_Notify (UE ID, NEF Reference ID) to the NEF to
notify that the UE is available.
9\. NEF identifies the corresponding AF based on NEF Reference ID and sends
Nnef_EventExposure_Notify to AF to notify that the UE is available. Only the
AFs linked to the Traffic Indicator (and related Traffic Descriptor) are
notified.
### 6.39.5 Impacts on existing entities and interfaces
NEF:
\- Receives the Traffic Descriptor from the AF and passes to the UDM.
UDM:
\- Subscribes to the AMF event \"Availability after DDN failure\", passing the
NEF ID and NEF Reference ID to the AMF.
\- The UDM sends the subscription to \"Availability after DDN failure\" to the
SMF for an existing PDU Session or during PDU Session establishment including
Traffic Descriptor, NEF ID and NEF Reference ID.
(V-)SMF:
\- The SMF sends the Traffic Descriptor to the UPF so it can detect the
traffic sent by the AF along with a Traffic Indicator for UPF to relate the
Traffic Descriptor with the Traffic Indicator.
\- After receiving the DDN message with Traffic Indicator, the SMF sends a
message to AMF including the NEF ID and the NEF Reference ID. The SMF sends
this message even if it had previously been notified that the UE is
unreachable.
H-SMF:
\- Forward messages between V-SMF and UPF in the home routed case.
UPF:
\- The UPF detects the traffic sent by AF and sends to the SMF the DDN message
including the Traffic Indicator. If multiple applications are bound to the
same QoS flow, the UPF sends the DDN message per application to the SMF for
this QoS flow.
AMF:
\- AMF activates the event after DDN failure based on the NEF ID and the NEF
Reference ID.
\- When the UE becomes reachable, the AMF notifies the corresponding AF that
has subscribed the event and sent the data.
### 6.39.6 Evaluation
The Solution proposes the Availability after DDN failure notification
procedure in case of multiple Application Functions (AFs). The AF provides the
Traffic Descriptor information during the Event Configuration procedure, and
the Traffic Descriptor information can be used by the network to determine the
corresponding AF.
The solution addresses the architectural requirements for key issue 3
\"Provide the AF (i.e. SCS/AS) with UE status information (e.g. reachability
notification or the time when the UE is expected to be reachable)\".
## 6.40 Solution 40: Infrequent small data transmission with temporary PDU
session
### 6.40.1 Introduction
This solution applies to address the Key Issue 1: Support for infrequent small
data transmission.
The solution assumes that the UE does not establish a PDU session before
sending small data packet based on the negotiation with network. The network
shall establish a temporary PDU session for the data transmission. During the
lifetime of PDU session, the uplink and downlink data can be delivered.
The solution is used to specific application scenario, e.g. MO-initiated
infrequent small data transmission.
### 6.40.2 Functional Description
The AMF decides PDU session mode based on UE support and preference for
temporary session, the UE subscription data, local configuration, **Expected
UE Behaviour** , or negotiated MICO mode. To avoid additional PDU session
establishment/release signalling at every MO-initiated small data transaction,
the AMF may take into account the interval time of small data transaction if
available, e.g. the Periodic Time parameter of Expected UE Behaviour.
The infrequent small data transmission procedure for a scenario where the user
data is forwarded to application server via control plane is illustrated in
figure 6.40.4-1.
### 6.40.3 Support of EPC interworking
This solution does not support EPC-5GC interworking. When the UE with a PDN
connection moves from EPC to 5GC, the UE shall release the PDN connection and
deliver small data as shown in 6.40.4. When the UE with temporary PDU session
moves from 5GC to EPC, the UE establishes a PDN connections for small data
delivery.
### 6.40.4 Procedures
Figure 6.40.4-1: Small data transmission procedure
0\. During UE Registration procedure, the UE and AMF negotiate the PDU session
mode to determine either temporary PDU session mode or normal PDU session mode
is used. The AMF decides PDU session mode based on UE support and preference
of temporary session, the UE subscription data, local configuration, Expected
UE Behaviour if available, or negotiated MICO mode.
1\. If the temporary PDU session is applied, the UE transmits the NAS Data PDU
with the related DNN and S-NSSAI to the AMF without any established PDU
session. For IP data, the UE uses a locally created IP address as the source
IP address of the IP packet.
2\. The AMF checks the integrity of the incoming NAS PDU and decrypts the user
data it contains.
3\. If the UE has no PDU Session for this DNN and S-NSSAI and the temporary
PDU session mode is applied, based on one or any combination of DNN, Network
Slice Selection Assistance Information, operator\'s local configuration or
policy and routing information, the AMF selects a SMF and initiates the PDU
session establishment procedure with a temporary PDU session indication to the
SMF.
4\. The SMF selects a specific pre-configured UPF and initiates the N4 session
establishment procedure with a temporary PDU session indication to the UPF.
5\. The SMF sends the response message to the AMF.
6\. The AMF forward the user data to the SMF.
7\. The SMF forward the user data to the UPF and the UPF forward the user data
to the DN via N6 interface. For IP data, if the temporary PDU session
indication is received from the SMF in step 4, the UPF shall store the source
IP address of the IP packet and change it to the IP address allocated by the
SMF.
8\. The UPF receives the DL user data and forwards the user data to the SMF.
For IP data, the UPF changes the destination IP address of external IP packet
to the IP address stored for the UE.
9\. The SMF receives the DL user data and forwards the user data to the AMF.
10\. If downlink data is received, the AMF encrypts and integrity protects the
NAS transport message with downlink user data.
11\. The AMF transmits the DL NAS Data PDU to the UE.
12\. After the data transmission, the temporary PDU session is released. The
temporary PDU session may be released by the AMF based on the Release
Assistance Indication information from the UE, or by the SMF based on the
expiration of inactivity timer (see TS 23.502 [7] clause 4.3.4.2).
### 6.40.5 Impacts on existing entities and interfaces
Impacts on AMF:
\- Support of the negotiation of PDU session mode with UE;
\- Support of the establishment/release of temporary PDU session;
Impacts on SMF:
\- Support of the establishment of temporary PDU session without N1 SM message
(PDU Session Establishment Request) sent from the UE;
\- Support of the release of temporary PDU session;
Impacts on UPF:
\- Support of IP address translation of UL/DL IP packet for temporary PDU
session;
Impacts on UE:
\- Support of negotiation of PDU session mode with AMF;
\- Support of sending small data packet without PDU session establishment.
### 6.40.6 Evaluation
The solution proposes that the UE can send small data packets without having
to support a user-plane stack, AS security and without PDU session
establishment between UE and network based on the negotiation with the
network. The temporary PDU session is introduced for the small data
transmission, and established in an on-demand way, which saves session
resource consumption of PDU session in 5GC. The core network signalling will
increase due to establishment and release of temporary PDU session. The amount
of signalling depends on how frequently the UE sends UL small data and how
quickly the network releases the PDU session based on Release Assistance
Indication information from the UE or expiration of inactivity timer (e.g.
determined by interval of data transmission). There is no support for DL-
initiated small data.
The solution avoids the PDU session related signalling between UE and network
and avoids storing a PDU session context in the UE.
In case there is no default DNN and S-NSSAI for the UE and the AMF, the UE
needs to send the DNN and S-NSSAI together with UL small data.
## 6.41 Solution 41: Combining RRC-INACTIVE and 5G UP optimization
### 6.41.1 Introduction
This solution addresses key issue 2, key issue 4 and key issue 13.
While RRC-INACTIVE could be an appropriate solution to handle frequent small
data, one open question is how to efficiently handle traffic patterns where
the frequent small data occurs in bursts with significantly long silence
periods in-between the bursts. To optimize UE power consumption during those
silence periods, the UE may benefit from using power saving methods like MICO
mode or eDRX.
Given that MICO mode assumes the UE to be in CM-IDLE it anyhow does not apply
to RRC-INACTIVE. However, eDRX may apply to RRC_INACTIVE (as has been proposed
in solution 38).
The latter has led to the question where DL data buffering should be performed
while the UE is in RRC-INACTIVE with eDRX.
One option to address this problem has been proposed in solution 7 where the
buffering is performed in the core network while the UE is in RRC-INACTIVE
state, i.e. while the N3 interface is still up and the core network is thus
far - by design - not aware of UE reachability. This solution proposes an
alternative.
### 6.41.2 Functional Description
The following principles apply to this solution:
\- The UE is assumed to request idle mode eDRX parameters from the AMF taking
the delay tolerance of all expected mobile terminating communication into
account. The AMF determines the Accepted eDRX parameters.
NOTE 1: This assumption is in line with similar assumptions made in 23.682 [6]
clause 4.5.13.1: \"_A UE should request for extended idle mode DRX only when
all expected mobile terminating communication is tolerant to delay._ \" and
\"_The extended idle mode DRX cycle length requested by UE takes into account
requirements of applications running on the UE._ \"
\- The AMF also passes the UE\'s Accepted eDRX parameter to the RAN.
\- The RAN configures the UE\'s eDRX parameters while the UE is in
RRC_INACTIVE as follows:
\- The RAN configures the eDRX cycle up to the UE\'s Accepted eDRX parameters
as provided by the AMF or or up to the maximum value allowed based on the NAS
retransmission timers (whichever is lower).
NOTE 2: The maximum value will be determined by CT groups and is assumed to be
configured in the RAN.
\- The RAN shall only configure an eDRX cycle for which the RAN is capable and
willing to buffer DL data.
\- While the UE is in RRC_INACTIVE with eDRX the buffering is performed in the
RAN.
\- Based on the UE\'s idle mode eDRX cycle as provided by the AMF and taking
the UE\'s inactivity into account the RAN dynamically determines if:
\- the RAN keeps the UE in RRC_INACTIVE with an eDRX cycle up to the UE\'s
Accepted eDRX parameters as provided by the AMF or up to the maximum value
allowed based on the NAS retransmission timers (whichever is lower) (implying
that the RAN buffers DL packets up to the duration of the eDRX cycle chosen by
RAN); or alternatively,
\- the RAN uses 5GS UP Optimization (see solution 19), i.e. suspends the UE\'s
RRC connection. In this case the buffering of DL data is performed in the core
network using normal CM-IDLE procedures.
NOTE 3: For eDRX cycles requested by the UE that are significantly longer than
the maximum value allowed based on the NAS retransmission timers, the RAN is
assumed to use 5GS UP Optimization (see solution 19), i.e. to suspend the
UE\'s RRC connection instead of using RRC-INACTIVE, after sustained UE
inactivity.
### 6.41.3 Support of EPC interworking
Solution does not apply to EPC.
### 6.41.4 Procedures
Existing procedures are reused.
### 6.41.5 Impacts on existing entities and interfaces
General:
\- Support for eDRX in RRC-INACTIVE (see related impacts documented for
solution 38) and 5GS UP optimization (see related impacts documented for
solution 19).
RAN:
\- Support for buffering up to the maximum value allowed based on the NAS
retransmission timers.
Editor\'s note: This clause describes impacts to existing entities and
interfaces.
### 6.41.6 Evaluation
Solution 41 illustrates how RRC-INACTIVE as defined in Rel-15 can be combined
with 5G UP optimization (see Solution 19) and eDRX to efficiently support
bursty frequent small data. The key idea is to use RRC-INACTIVE (combined with
short eDRX sleep cycles as needed) while a frequent small data burst is sent;
during a silence period (i.e. in-between two bursts) the UE\'s RRC connection
is suspended and long eDRX sleep cycles can be applied as needed. To reduce
over-the-air signaling when the next frequent small data bursts begins, i.e.
when the UE sends small data from CM-IDLE, 5G UP optimization (as per Solution
19) is proposed to be used.
In combination with RRC-INACTIVE 5G UP optimization jointly ensures that
bursty frequent small data can be sent with minimal signaling overhead while
extended DRX sleep cycles ranging from a few seconds to hours can be supported
without causing significant system impacts. The impacts are the same as for
Solution 19.
## 6.42 Solution 42: NAS based Redirection between Core Networks
### 6.42.1 Introduction
This NAS based solution applies to Key issue 15 of load balancing the UEs
between the two systems.
### 6.42.2 Functional Description
This solution is a procedure to steer the UE during the (re-)registration
procedure.
In EPC, when UE sends the Attach Request to the MME and MME determines that
the UE need to move to the 5G system, the MME shall reject the Attach Request
and send an appropriate EMM cause indicating the target CN system to the UE.
After, the UE shall disable S1 mode and re-enable the N1 mode if it was
disabled and perform registration in the target 5G system. Similar, in case of
5GC, the AMF will send a Registration Reject with a cause indicating to the UE
to register in the EPC network. Upon the indication, the UE shall disable the
N1 mode and re-enable the S1 mode if was disabled.
### 6.42.3 Support of EPC interworking
TS 23.501 [5], clause 5.17 applies when a registered/connected UE(s) is moved
to 5GC or EPC systems.
### 6.42.4 Procedures
#### 6.42.4.1 Redirection using NAS indication
##### 6.42.4.1.1 General
When a UE triggered registration either in EPC or 5GC network, network
redirects the UE to target system by indication in the NAS layer.
##### 6.42.4.1.2 Redirection from EPC to 5GC network
Figure 6.42.4.1.2-1: Redirection from EPC to 5GC network
1\. The UE sends the Attach or TAU Request as step#1-2 of Figure 5.3.2.1-1 in
TS 23.401 [4]. The UE includes an indication that it supports N1 mode and its
Preferred Network Behaviour. The Preferred Network Behaviour includes the
5GS/EPS CIoT optimisations the UE supports and what it would prefer to use.
Based on the indication that the UE supports N1 mode and that Preferred
Network Behaviour, the MME knows the UE can be redirected to 5GC.
2\. If the MME decides to redirect the UE to the 5GC network, then the MME
rejects the UE\'s attach request and sends an Attach / TAU Reject with
appropriate EMM cause to indicating the UE to be registered in the 5GC
network.
NOTE: If 5GC is not available for a UE that is redirected from EPC, it can
lead to the UE returning to EPC. This can be avoided by taking the 5GC
coverage into account in the redirection policy in the MME.
3\. Upon target CN type indication in the Attach Reject the UE disables S1
mode and re-enables the N1 mode if disabled, and the UE starts the 5GC
Registration procedure, see Figure 4.2.2.2.2-1 in TS 23.502 [7].
If the UE cannot find a cell supporting connectivity to 5GC, the UE re-enables
the S1 mode and attempts to attach to EPC.
4\. After, the 5GC will accept the UE registration as described in the Figure
4.2.2.2.2-1 in TS 23.502 [7].
##### 6.42.4.1.3 Redirection from 5GC to EPC network
Figure 6.42.4.1.3-1: Redirection from 5GC to EPC network
1\. The UE sends the Registration Request as step#1-3 of Figure 4.2.2.2.2-1 in
TS 23.502 [7]. This can be initial, mobility or periodic registration. The UE
includes an indication that it supports S1 mode and its Preferred Network
Behaviour. The Preferred Network Behaviour includes the 5GS/EPS CIoT
optimisations the UE supports and what it would prefer to use. Based on the
indication that the UE supports S1 mode and the Preferred Network Behaviour,
the AMF knows the UE can be redirected to EPC.
2\. AMF decides to redirect the UE to the EPC, the AMF rejects the UE\'s
Registration Request and sends a Registration Reject with appropriate MM cause
to indicating to the UE to attempt a registration in the EPC network.
NOTE: If EPC is not available for a UE that is redirected from 5GC, it can
lead to the UE returning to 5GC. This can be avoided by taking the EPC
coverage into account in the redirection policy in the AMF.
3\. Upon CN type indication in the Registration Reject, the UE disables the N1
mode and re-enables the S1 mode if disabled, and the UE starts the EPC Attach
or TAU procedure, see Figure 5.3.2.1-1 in TS 23.401 [4].
If the UE cannot find a cell supporting connectivity to EPC, the UE re-enables
the N1 mode and attempts to attach to 5GC.
4\. After, the EPC will accept the UE Attach/TAU as described in the Figure
5.3.2.1-1 in TS 23.401 [4].
##### 6.42.4.1.4 Interaction with Steering of Roaming
If the AMF rejects the registration request and redirects the UE to EPC, the
steering of roaming as described in Annex C in TS 23.122 [21] cannot be
applied. In this case the UE may be redirected to EPC as described in this
solution.
### 6.42.5 Impacts on existing entities and interfaces
EPC impacts:
\- If a MME determines that the UE needs to be redirected to other system,
then MME needs to use a appropriate EMM cause and notify to the UE in NAS
layer.
5GC impacts:
\- AMF uses an appropriate EMM cause and notifies to the UE over NAS.
UE impacts:
\- UE needs to understand the NAS rejection value and performs actions
accordingly, i.e. disable the S1 or N1 mode.
### 6.42.6 Evaluation
This solution uses a NAS level indication in registration/attach rejection to
indicate to the UE that the N1/S1 mode needs to be disabled. The UE then
disables the N1/S1 mode and performs an attach/registration to the target CN
type. The solution uses existing procedures.
NOTE: Whether a new cause value needs to be defined for a redirection, is up
to Stage 3.
## 6.43 Solution 43: RRC based Redirection between Core networks
### 6.43.1 Introduction
This RRC based solution applies to Key issue 15 of load balancing the UEs
between the two systems.
### 6.43.2 Functional Description
This solution provides a procedure to redirect the UE between the 5GC or EPC
by the network over a RRC notification.
Proposed to re-use the \"**_target CN indication\"_** in the N2 release
message by the AMF (in Rel-15 specified for Emergency Services) for the load
balancing purpose. In this case, when the AMF is notified (e.g. by O&M) or
determines based on local policy, and UE\'s Preferred Network Behaviour, then
the AMF triggers N2 release with an indication to redirect the UE to the
target CN. After, the UE performs Attach/TAU procedure in EPC.
In addition, similar indication needs to be introduced in the S1-AP interface
i.e. MME will indicate the RAN to perform the redirection of a UE to the
target 5GC system which will be notified to the UE in the RRC release. In
fact, similar mechanism is defined in TS 36.413 [22] (cause IE \"Load
Balancing TAU Required\") for load balancing between MMEs within the EPC.
Similar, upon determining (e.g. by O&M notification or by local policy, and
UE\'s Preferred Network Behaviour) by the MME that the UE(s) needs to move to
target network, then MME will trigger UE context release command with a cause
IE i.e. target CN information (i.e. 5GC) to the RAN which is notified to the
UE in the RRC release, thus UE can perform the registration procedure in
target CN system (i.e. 5GC). In addition, MME may provide the RFSP Index and
handover restriction list to the RAN which allows the RAN to set proper
camping policies to the UE to ensure the UE stays in 5GC when it returns to
Idle mode, and to prevent handovers to 5GC in Connected mode. After, the UE
performs registration procedure in 5G system.
NOTE: Idle-mode camping policies are not supported for NB-IoT UEs.
Editor\'s note: It is FFS if the target CN needs to know that the UE has been
redirected.
### 6.43.3 Support of EPC interworking
TS 23.501 [5], clause 5.17 applies when a registered/connected UE(s) is moved
to 5GC or EPCsystems.
### 6.43.4 Procedures
#### 6.43.4.1 Redirection using RRC indication
##### 6.43.4.1.1 General
The network will redirect the UEs to the target system based on load balancing
determination as below.
##### 6.43.4.1.2 Redirection from EPC to 5GC network
Figure 6.43.4.1.2-1: Redirection from EPC to 5GC network
0\. A UE is attached to the EPC network. As part of Attach / TAU procedure,
the UE includes an indication that it supports N1 mode and its Preferred
Network Behaviour. The Preferred Network Behaviour includes the 5GS/EPS CIoT
optimisations the UE supports and what it would prefer to use. Based on the
indication that the UE supports N1 mode and the Preferred Network Behaviour,
the MME knows the UE can be redirected to 5GC.
1\. If the MME has determined that the UE need to be redirected to the 5GC,
when the MME releases the S1 context, the MME includes an indication of the
target CN information (i.e. 5GC) to the Initial Context Release command.\ \ In
addition, MME may provide the RFSP Index to the RAN which allows the RAN to
set proper camping policies to the UE to ensure the UE stays in 5GC when it
returns to Idle mode.
NOTE 1: Defining the appropriate cause value of indication is up to the Stage
3.
2\. RAN node will release the RRC connection with an indication of the target
core network type and idle-mode camping policies.
3\. RAN node sends the Release complete to the MME.
4\. After the RRC release, the UE attempts to perform a registration procedure
to the 5G system.
The AS layer in the UE informs the NAS about the CN type. If the UE finds a
cell supporting connection to 5GC, NAS layer sends a Registration Request to
5GC based on the target CN type from the AS layer.
The AMF gets the UE context from EPC as described in the clause 4.11 in TS
23.502 [7], if the N26 interface exists.
5\. The AMF sends the Registration Accept to the UE. Afterwards, the AMF may
provide a handover restriction list to the RAN to prevent the handovers to
EPC.
##### 6.43.4.1.3 Redirection from 5GC to EPC network
Figure 6.43.4.1.3-1: Redirection from 5GC to EPC network
0\. A UE is registered in the 5G system. As part of Registration procedure,
the UE includes an indication that it supports S1 mode and its Preferred
Network Behaviour. The Preferred Network Behaviour includes the 5GS/EPS CIoT
optimisations the UE supports and what it would prefer to use. Based on the
indication that the UE supports S1 mode and that Preferred Network Behaviour,
the AMF knows the UE can be redirected to EPC.
1\. If the AMF has determined that the UE need to be redirected to the EPC,
when the AMF releases the N2 connection, the AMF includes an indication of the
target CN information (i.e. EPC) to the N2 release command.\ \ In addition,
AMF may provide the RFSP Index to the RAN which allows the RAN to set proper
camping policies to the UE to ensure the UE stays in EPC when it returns to
Idle mode.
2\. RAN triggers RRC release procedure includes target CN indicated received
in N2 procedure is conveyed to the UE.
3\. RAN sends N2 release acknowledgement to the AMF.
4\. Based on the RRC indication, the UE attempts to perform the registration
procedure i.e. mobility Attach or TAU procedure in EPC.
The AS layer in the UE informs the NAS about the available and target CN
types. If the UE finds a cell supporting connection to EPC, the NAS layer
sends an Attach or TAU Request to EPC based on the target CN type from the AS
layer.
The MME retrieves the UE context from 5GC as described in the clause 4.11 in
TS 23.502 [7], if the N26 interface exists.
NOTE: As per current procedures the AS layer indicates the available core
networks to the NAS layer. If the target CN is not available for the UE, the
UE stays registered in the source core network.
5\. After, the MME sends the Attach/TAU Accept message to the UE. The MME may
provide a handover restriction list to the RAN to prevent handovers to 5GC.
### 6.43.5 Impacts on existing entities and interfaces
EPC impacts:
\- If a MME determines that the UE needs to be redirected to other system,
then the MME needs to create an appropriate cause and notify to the RAN in
S1-AP.
\- RAN needs to provide the redirection indicationin RRC to the UE.
5GC impacts:
none identified.UE Impacts:
\- The UE needs to understand redirection indication and perform actions
accordingly. The existing redirection indication in RRC Connection Release
(cnType) in WB-E-UTRAN can be reused and a similar indication needs to be
added for NB-IoT.
NOTE: Defining the appropriate cause value of indication is up to the Stage 3.
### 6.43.6 Evaluation
This solution uses an RRC level indication in RRC connection release after the
registration/attach procedure to indicate to the UE that the target CN type
needs to be selected. Such procedure exists for 5GS, but a similar procedure
for EPS would need to be specified. Handovers and idle-mode mobility to the
old CN type are prevented using existing procedures. The solution is not
applicable for NB-IoT UE. Idle-mode mobility to the old CN type cannot be
prevented if the operator uses the same RAT type(s) and frequencies in both
EPS and 5GS.
## 6.44 Solution 44: C-IoT UE Core Network selection based on S-NSSAIs
### 6.44.1 Introduction
This solution applies to Key Issue 15: Core Network selection for Cellular
IoT.
### 6.44.2 Functional Description
#### 6.44.2.1 General
The following applies for Whether and how the 5GS C-IoT feature(s) are
indicated to UE:
\- An NG-RAN node that supports access to both EPC and 5G-CN is configured to
broadcast in system information broadcast the **5G Cellular IoT support
information**.
NOTE 1: For WB-E-UTRAN/EPS there already exists SIB2 broadcast of \"up-CIoT-
EPS-Optimisation-r13\" and/or \"cp-CIoT-EPS-Optimisation-r13\" (see TS 36.331
[23]). Therefore the UE receives information on C-IoT support for both EPC and
5G CN with no impacts to EPS.
The UE supporting both EPC and 5G Cellular IoT and requiring Cellular IoT
services performs CN selection as follows:
\- The UE first checks in SIB whether there is 5G Cellular IoT information. If
the 5G Cellular IoT support is present and consistent with UE required
Cellular IoT feature(s), the UE selects 5G CN.
NOTE 2: Whether 5G C-IoT may have incompatible support scenarios is dependent
on the conclusion of other key issues in this TR.
\- If the UE does not find in SIB 5G Cellular support information consistent
with its own requirements, the UE checks the presence of \"up-CIoT-EPS-
Optimisation-r13\" and/or \"cp-CIoT-EPS-Optimisation-r13\". If the EPC CIoT
support is compatible with UE EPC CIoT support (e.g. UE and EPS support
Control Plane CIoT EPS optimization), the UE selects EPC.
UE Cellular IoT indication of Requested 5G Cellular IoT feature:
\- When the UE initiates RRC connection establishment procedure, the UE
indicates which CN is selected as per Relâ€‘15 for E-UTRA.
\- If the UE selected EPS, the UE proceeds as per TS 23.401 [4].
\- If the UE selected 5G CN, the UE further indicates Requested 5G Cellular
IoT support information in RRC. The NG-RAN uses this information for AMF
selection.
\- The UE furthers indicates the Requested 5G Cellular IoT support information
at NAS layer for the AMF to perform SMF selection based on this information.
#### 6.44.2.2 5G Cellular IoT support information based on S-NSSAIs
The key idea is that 3GPP standardizes S-NSSAI value(s) that correspond to a
specific (set of) 5G Cellular IoT feature(s).
NOTE: This correspondence is dependent on which 5G CIoT features are selected
for normative work.
The 5G Cellular IoT support information as described in clause 6.44.2.1 is the
S-NSSAI(s). The NG-RAN broadcasts the S-NSSAI(s) corresponding to 5G Cellular
IoT features.
In this option, the Requested 5G Cellular IoT support information as per
clause 6.44.2.1 is an S-NSSAI in the Requested NSSAI.
The UE already includes the Requested NSSAI in RRC and in NAS, the NG-RAN node
already performs AMF selction based on Requested NSSAI. Therefore, this option
does not have RRC or NAS signalling impacts, and no impacts to AMF selection,
as it reuses Network slicing feature for those aspects.
### 6.44.3 Support of EPC interworking
By broadcasting C-IoT support in 5G CN, the UE can select the appropriate CN
type based on C-IoT support before initiating RRC connection establishment
procedures.
### 6.44.4 Procedures
Figure 6.44.4-1 shows the call flow for Core Network selection for Cellular
IoT.
Figure 6.44.4-1: Core Network Selection
1\. The NG-RAN broadcasts 5G Cellular IoT support information in SIB via
S-NSSAIs and also broadcasts \"up-CIoT-EPS-Optimisation-r13\" and/or \"cp-
CIoT-EPS-Optimisation-r13\" for EPS CIoT support if it applies.
2\. The UE uses the received broadcasted information to perform CN selection
with the criteria described in clause 6.44.4.1.
**A) UE selects 5G CN, use of S-NSSAI.**
3a. The UE initiates Registration procedure including the S-NSSAI
corresponding to the UE 5G CIoT features in the Requested NSSAI in both RRC
and NAS. Registration procedure continues as per TS 23.501 [5] using regular
Network slicing feature for AMF selection, Allowed NSSAI, etc. The UE receices
in the Allowed NSSAI an S-NSSAI corresponding to the 5G CIoT features enabled
by the network.
4b. The NG-RAN takes into consideration the Requested 5G CIoT support
information when selecting the AMF.
5b. Registration procedure continues as per TS 23.501 [5] with the following
modifications. The AMF decides based on the UE Reqeusted 5G CIoT support
information, netowrk support, subscription information and/or local policies
what is the Allowed 5G CIoT support information, and provides it to the UE in
registratrion accept message. UE knows which features are enabled based on the
Allowed 5G CIoT support information.
**B) UE selects EPC.**
3b**.** Attach/TAU procedure as per TS 23.401 [4]
### 6.44.5 Impacts on existing entities and interfaces
In UE:
\- Receive broadcast information regarding 5G CIoT support.
\- Perform CN selection based on which 5G CIoT features are supported in 5G CN
and/or EPC.
\- Know S-NSSAI value corresponds to certain 5G CIoT feature(s).
In NG-RAN:
\- Broadcast in SIB new information for 5G Cellular IoT support.
### 6.44.6 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.45 Solution 45: Core Network Type and Node Selection for CIoT UE Using
Explicit Indications
### 6.45.1 Introduction
This clause presents a solution for Key Issue 15: Core Network selection for
Cellular IoT. It addresses the requirements captured in the key issue to
support core network type selection at UE, core network node selection at RAN,
AMF and MME.
### 6.45.2 Functional Description
When camping on an E-UTRA cell connected to both EPC and 5GC, in order to
support UEs with different capabilities in the same network, the eNB that
supports access to 5GC broadcasts that it can connect to 5GC (as described in
TS 23.501 [5], clause 5.17.1). In addition, RAN broadcasts the 5G CIoT
optimisations supported by the 5GS via NB-IoT/WB-E-UTRA access. The UE AS
layer indicates the 5G CIoT optimisations broadcast to the UE NAS layer as
well as the \"E-UTRA connected to 5GC\" capability. The UE selects a core
network type (5GC or EPC) taking into account the CIoT optimisations broadcast
for each network type and which optimisations the UE supports and prefers.
The UE AS layer is made aware of whether a NAS signalling connection is to be
initiated to 5GC (the existing \"5GC requested\" indication) and additionally
the 5GS CIoT optimisations supported. The UE shall inform RAN of the \"5GC
requested\" and the supported 5GS CIoT optimisations in an RRC message during
the RRC connection establishment procedure. The RAN will take those
optimisations supported by UE and AMF supported optimizations into account for
AMF selection when 5GC is requested.
When the UE performs the registration procedure it includes its Preferred
Network Behaviour in the Registration Request message and the AMF replies with
the Supported Network Behaviour in the Registration Accept message. The
Preferred Network Behaviour indicates the Network Behaviour the UE can support
and what it would prefer to use. The Supported Network Behaviour indicates the
5G CIoT Optimisations the network accepts.
### 6.45.3 Support of EPC interworking
The supported CIoT optimisations broadcast for EPC and 5GC allows a UE to
select the CN type before initiating the RRC connection establishment. The
optimisations indicated to the RAN during RRC connection establishment allows
RAN to select an AMF in 5GC.
### 6.45.4 Procedures
#### 6.45.4.1 Registration Procedure
Steps 1-23 are executed according to TS 23.502 [7], clause 4.2.2.2.2 with the
following changes:
Step 1: The UE includes the Preferred Network Behaviour in the Registration
Request message.
Step 21: The AMF includes the Supported Network Behaviour in the Registration
Accept message.
Editor\'s note: The granularity of CIoT optimisations indicated in the
Preferred and Supported Network Behaviour is FFS.
#### 6.45.4.2 Core network type selection at UE and AMF selection at RAN
Figure 6.45.4.2-1: Core network type selection at UE and AMF selection at RAN
1\. The RAN is connected to both EPC and 5GC, and broadcasts the following
information:
\- 5GC Connected Indication: indicate that RAN can connect to 5GC (as
described in TS 23.501 [5], clause 5.17.1), and
\- EPS CIoT optimisations that the network supports (as described in TS 23.401
[4], clause 5.3.2.1), e.g., _up-CIoT-EPS-Optimisation_ , c _p-CIoT-EPS-
Optimisation_ , and
\- whether it supports 5GS CIoT optimisations and it can connect to an AMF
that supports 5GS CIoT optimisations.
Editor\'s note: The granularity of 5GC CIoT optimisations to be broadcasted
are for FFS.
2\. The UE selects the core network type (EPC or 5GC) based on the broadcast
indications for both EPC and 5GC, and the UE\'s Preferred Network Behaviour.
3\. 5GC is selected and the UE indicates the 5GS CIoT optimisations supported
by UE, which is used for AMF selection, to RAN at RRC layer.
Editor\'s note: The granularity of CIoT optimisations to be indicated over RRC
layer are for FFS.
4\. In addition to the existing AMF selection behaviour, the 5GS CIoT
optimisations information supported by UE and AMF is taken into account when
the RAN selects an AMF.
5\. RAN sends Initial UE Message to the selected AMF.
### 6.45.5 Impacts on existing entities and interfaces
Enhancements on UE include the following:
\- Core network type selection based on UE\'s Preferred Network Behaviour, and
CIoT optimisations broadcast by the RAN that connects to both EPC and 5GC;
\- Indicate the Preferred Network Behaviour to the MME during Attach/TAU
procedure or to AMF during Registration procedure;
\- Indicate the 5GS CIoT optimisations supported by UE, which is for AMF
selection, to RAN during the RRC connection establishment procedure.
Enhancements on RAN include the following:
\- Take the 5GS CIoT optimisations supported information from UE into
consideration in case of AMF selection.
### 6.45.6 Evaluation
This solution addresses the architectural requirements for key issue 15 i.e.
UE selecting a core network type taking into account:
\- the CIoT optimizations broadcast by the RAN for each network type (EPC,
5GC); and
\- the CIoT optimizations supported by the UE.
This solution supports Preferred and Supported network behavior based on the
same principles as in EPS. The difference is in terms of the preferred and
supported network behavior parameters information for 5G system.
## 6.46 Solution 46: Network controlled UL data transmission delay
### 6.46.1 Introduction
UE transmitting power is sensitive to the link quality, for example, the
transmitting power under -100dBm coverage is about 100 times than the power
under -80dBm. In the current mechanisms, when uplink data arrives, the UE will
attempt to transmit the data in any coverage condition, e.g. in weak coverage,
or in enhanced coverage. When in weak coverage, UE will transmit the data with
maximum TX power, and maybe try many times; when in enhanced coverage, UE will
repeat tens of re-transmission, all of which consume greatly UE power.
For some IoT applications that do not require urgent transmission; these
applications are very tolerant with transmission delay, e.g. daily routine
data report, etc. This solution allows the UE to choose a time with better
coverage to transmit uplink data under the tolerant time for more power saving
purpose.
The AF shall have some prior knowledge on the maximum delaye time the UE
reports the monitored data, then AF can know the exact time at which AF can
collect the reported data. For example, UE is configured to report daily
routine data to the AF at 8:00 am each day, and this routine data may contain
the data of 24hour (from 8:00 am to 8:00 am). If one hour delayed time is
configured to the UE, the AF knows the UE may not report the data at 8:00 am
and may report at 9:00 pm.
### 6.46.2 Functional Description
This clause describes the solution for uplink data. In this solution, the
network authorizes the UE to delay the uplink data transmission within the
configured delay tolerant window. UE can find a better coverage during the
authorized delay tolerant window, when there is uplink data to be transmitted.
Some assumptions and requirements are made.
1) The services characteristic can be subscribed, and the AMF/SMF can obtain
the subscribed service characteristic information.
2) The mechanism to establish PDU Session and data transmission depends on the
solution defined in other key issues.
3) There is a direct or indirect interface between the SMF and the AF for
information exchange.
### 6.46.3 Support of EPC interworking
Not applicable since there is no corresponding mechanism specified in EPC.
### 6.46.4 Procedures
This clause describes high-level procedures and information flows for the
solution.
Figure 6.46.4-1: Delay UL transmission for MO case
1\. UE initiates PDU Session Establishment Request, indicating to the SMF that
UE is requesting delayed transmission and the identity of the AF the UE
intends to transmit data to in this PDU Session.
2\. After receiving the request, the AMF selects the SMF and send
Nsmf_PDUSession_CreateSMContext Request to SMF (with delayed transmission
indication and AF identity).
3\. SMF verifies in the UE subscription information the validity of the UE
request.
4\. Optionally, SMF can interact with AF via direct or indirect interface to
obtain the allowed delay time window from the AF the UE requests. Or SMF can
obtain the allowed delay time window based on UE subscription information.
Editor\'s note: The way how the SMF identifies the AF in this case is FFS.
Editor\'s note: Security issues need to be considered for a direct interaction
between SMF and AF. Indirect interaction need to be detailed.
5-6. The SMF accepts the PDU Session to the UE with the delay time window.
NOTE: The delayed time window can also be configured in the UE.
7\. When UL data belonging to the PDU Session arrives from the application, UE
can choose to wait for a better coverage to send UL data within the delay time
window. It can be based on UE implementation or radio signal quality
thresholds configured in the UE via device management, to determine whether
the coverage is really bad. Or, the operator may configure the UE with lower
signal quality thresholds so that the UE employs the transmission delay
behavior only when the current radio coverage is really bad or the worst
coverage (e.g. the UE is close to cell borders or coverage hole).
Editor\'s note: It is FFS how the UE can predict whether the coverage is
likely to improve or degrade during the delayed time window, e.g. if the UE is
close to a coverage hole.
8\. The AF expects the UL data could be received not later than the allowed
delayed time window.
### 6.46.5 Impacts on existing entities and interfaces
\- New API allowing the AF to provision the network via the NEF with delayed
tolerant service requirements.
\- UE, AMF and SMF to support the new function to establish a delay tolerant
PDU Session.
\- Delay tolerant indication needs to be added in PDU Session Establishment
Request.
\- The delay time window is optionally added in PDU Session Establishment
Accept.
### 6.46.6 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.47 Solution 47: Improved Signalling/Data plane separation for Data over
NAS small data solutions
### 6.47.1 Introduction
This solution applies to Key Issue 1: Support for infrequent small data
transmission and Key Issue 2: Frequent small data communication.
The solution is applicable as an addition to solutions 1, 2, 3, 6 and 40.
### 6.47.2 Functional Description
To enable more independent scalability of the data plane and signalling plane
security functions for \"Data over NAS\", it is proposed that different
encryption and integrity protection key sequences are used for \"data\" and
for \"signalling\".
This approach was used in 2G-GPRS but was ignored in R13 CIoT optimisations.
### 6.47.3 Support of EPC interworking
The EPC security mechanisms are used in EPC, e.g. EPC security is enabled
during the TAU to EPC, and 5GC security is enabled during TAU to NG-RAN.
### 6.47.4 Procedures
These are the same as in the base solution, except that for:
\- Integrity protection, ciphering and header compression:
\- Integrity protection and ciphering for small data are performed by AMF
(existing NAS PDU integrity protection and ciphering functionality are re-
used, except that the \"data over NAS\" PDUs use a per-PDU session parameter
(and which is different to those used for NAS signaling) for the \"BEARER\"
input to the NAS integrity and confidentiality algorithms).
NOTE: The \"Data over NAS\" PDU already has to carry information on the PDU
session to enable routing towards the correct data network, etc. However, this
information would now need to be sent unencrypted.
TS 33.501 [25] is very closely modelled on TS 33.401 [24] and both these
specifications use a parameter called BEARER as an input into the generation
of the key sequences for the confidentiality and integrity protection.
However, currently the BEARER parameter is not used fully within the NAS
security. TS 33.401 [24] clause 8.1.1 (\"NAS input parameters and mechanism\")
states \"_The BEARER identity is not necessary since there is only one NAS
signalling connection per pair of MME and UE, but is included as a constant
value so that the input parameters for AS and NAS will be the same, which
simplifies specification and implementation work_ \".
This creates the opportunity to use (in a somewhat similar manner to GPRS)
different security streams for signalling and data (and different security
streams per PDN connection) by setting the BEARER parameter according to the
PDU session ID.
As TS 33.501 [25] is still under development, some extracts from TS 33.401
[24] are copied below:
_Annex B_
/..../
_The input parameters to the ciphering algorithm are a 128-bit cipher key
named KEY, a 32-bit COUNT, a 5-bit bearer identity BEARER, the 1-bit direction
of the transmission i.e. DIRECTION, and the length of the keystream required
i.e. LENGTH. The DIRECTION bit shall be 0 for uplink and 1 for downlink._
/.../
Figure B.1-1: Ciphering of data
/..../
Figure B.2-1: Derivation of MAC-I/NAS-MAC (or XMAC-I/XNAS-MAC)
/ end of extracts from TS 33.401 [24] /
### 6.47.5 Impacts on existing entities and interfaces
The UE and the security termination point in the network (e.g. AMF) need to
have a common way to generate the PDU Session ID, and, then need to use it
with their existing implementations of the confidentiality and integrity
algorithms.
### 6.47.6 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
Editor\'s note: This solution needs to be evaluated by SA WG3.
## 6.48 Solution 48: NB-IoT idle mode inter-RAT mobility reusing EPS features
### 6.48.1 Introduction
This solution addresses KI#12 Inter-RAT mobility support to/from NB-IoT.
The Key Issue as a baseline assumes the radio capabilities for NB-IoT are
different to those for WB-E-UTRAN and NR, therefore 2 sets of capabilities are
maintained by the AMF. In the KI the SMF is also responsible for whether a PDU
session is maintained, reconnected or released. Both of these aspects are
described in this solution.
In order to support the baseline and architectural requirement from the key
issue, the relevant features are reused from EPS for NB-IoT idle mode inter-
RAT mobility.
### 6.48.2 Functional Description
#### 6.48.2.1 General
Inter-RAT mobility to/from NB-IoT, follows the existing limitations in EPS and
is limited to idle mode mobility only.
#### 6.48.2.2 UE Radio Capability Handling
A UE only provides its NB-IoT radio capabilities to the network over NB-IoT
and these are stored separately from radio capabilities from other RATs by the
AMF.
When the UE Radio Capabilities are sent to the RAN, only the related
capabilities for the RAT type the UE is using are sent to RAN, e.g. if the UE
is using NB-IoT then only the NB-IoT radio capabilities are sent to RAN.
#### 6.48.2.3 PDU Session Handling
PDU session handling is controlled by \"PDU session continuity at inter RAT
mobility information\" in the UDM, which indicates per DNN/S-NSSAI whether to:
\- maintain the PDU session;
\- disconnect the PDU session with a reactivation request;
\- disconnect the PDU session without reactivation request;
\- leave it up to local VPLMN policy.
when the UE moves between a \"broadband\" RAT (WB-E-UTRAN or NR) and a
\"narrowband\" RAT (NB-IoT).During PDU session establishment the SMF retrieves
the \"PDU session continuity at inter RAT mobility information\" (if
available) from the UDM. Local SMF configuration is used when the UDM provides
no information.
The AMF informs the SMF at an inter-RAT idle mobility event, e.g. between NB-
IoT connected to 5GC and WB-EUTRAN or NR connected to 5GC about a RAT type
change in the Nsmf_PDUSession_UpdateSMContext message during the Registration
procedure. Based on this (h-)SMF handles the PDU session according to \"PDU
session continuity at inter RAT mobility information\" from the UDM or based
on local policy.
NOTE: The \"PDU session continuity at inter RAT mobility information\" and
\"PDN continuity at inter-RAT mobility\" subscription should be the same so
that the PDU sessions/PDN connections are handled the same by both CN types.
#### 6.48.2.4 Determining RAT Type Change
Dedicated TAIs are used for NB-IoT; AMF ensures that the TAI list that is
allocated either only contains TAIs of NB-IoT or other RAT types. This
approach ensures that a Registration request is triggered when the UE moves to
or from NB-IoT.
As documented in 23.502 [7], the AMF determines the RAT Type based on the
Global RAN Node ID associated with the N2 interface. In other words, as per
Rel-15 AMF distinguishes WB-EUTRA from NR based on the node type (gNB vs. NG-
eNB).
By additionally considering the dedicated TAIs assigned for NB-IoT, the AMF
distinguishes WB-EUTRA and NB-IoT (which are both served by an NG-eNB).
For mobility to EPC, the MME can continue to determine whether the RAT type
has changed based on TAIs that can only be assigned to an NB-IoT RAT type or
other RAT types, and a TAI List cannot mix NB-IoT RAT types with other RAT
types.
When the RAT type has changed the SMF(s) are informed to allow them to update
the PDU sessions accordingly. The SMF also stores the last RAT type to help
with the PDU session handling.
### 6.48.3 Support of EPC interworking
Idle-mode mobility from 5GS to EPS and from EPS to 5GS is performed as per the
procedure described in TS 23.502 [7] clause 4.11.1.3.2 and clause 4.11.1.3.3
respectively.
For Idle-mode mobility from 5GS to EPS, the \"PDN continuity at inter RAT
mobility\" which is received in the subscription information from HSS is taken
into account by the target MME to decide how to handle the PDU session.
After the Idle-mode mobility from EPS to 5GS, SMF interacts with UDM to
retrieve the subscription information for the PDU session, the \"PDU session
continuity at inter RAT mobility information\" included in the subscription is
taken into account by the SMF to decide how to handle the PDU session.
### 6.48.4 Procedures
#### 6.48.4.1 RAT change with mobility between 5GC and EPC with N26
When idle mode inter-RAT mobility includes changing the core network type,
i.e. between EPC and 5GC and vice versa, at the same time as changing RAT
types no additional procedures are required.
The procedure for idle mode mobility towards EPC defined in TS 23.502 [7]
clause 4.11.1.3.2 is reused (5GS to EPC handover with N26). When mobility
towards EPC occurs, the MME performs the actions related to RAT type change
defined in TS 23.401 [4], clause 5.3.3.1 (tracking area update procedure with
S-GW change), i.e. take the \"PDN continuity at inter RAT mobility\" into
account and perform the relevant actions.
The procedures for idle mode mobility towards 5GC defined in TS 23.502 [7]
clause 4.11.1.3.3 (EPS to 5GC Mobility Registration using N26) are reused. If
there is the subscription information for the PDU session in the SMF, the SMF
then subsequently maintains, reconnects or releases the PDU session according
to the \"PDU session continuity at inter RAT mobility information\". If there
is no subscription information for the PDU session in the SMF, SMF first
retrieves the \"PDU session continuity at inter RAT mobility information\"
from the UDM and then decides how to handle the PDU session.
#### 6.48.4.2 RAT change with mobility between 5GC and EPC without N26
When idle mode inter-RAT mobility includes changing the core network type,
i.e. between EPC and 5GC and vice versa, at the same time as changing RAT
types no additional procedures are required.
The procedure defined in TS 23.501 [5] clause 5.17.2.3.2 (Mobility for UEs in
single-registration mode) is reused with the following addition:
\- If the network determines that the UE is changing RAT type, if the UE
requests to relocate the PDU session from EPC to 5GC or 5GC to EPC, the
SMF/MME uses the \"PDU session continuity at inter RAT mobility\" or \"PDN
continuity at inter-RAT mobility\" information, respectively, in the
subscription to determine whether to maintain the PDU session/PDN connection
(if being handed over) or reject the PDU session request, with the relevant
cause.
\- If the UE requested to move the PDU session and the \"PDN continuity at
inter RAT mobility\" information indicated \"disconnect the PDN connection
with a reactivation request\" the network should provide a suitable cause code
to the UE so that it can request a new PDU session.
#### 6.48.4.3 RAT change without mobility between 5GC and EPC
When the UE remains connected to 5GC but is performing idle mode inter-RAT
mobility, the registration procedure defined in TS 23.502 [7], clause
4.2.2.2.2 is reused. As specific TACs are allocated for NB-IoT, the procedure
is triggered by the UE when the UE moves between NB-IoT and \"broadband\" RAT
(WB-E-UTRAN or NR). In this case the following steps are updated to account
for the idle mode mobility:
\- Steps 4 and 5 fetch the MM context from the old AMF in the case of AMF
change.
\- Step 17 is executed when RAT Type change occurs the
Nsmf_PDUSession_UpdateSMContext service is used to inform the SMF(s) about the
RAT type change for all PDU sessions where the UE has not released them. If
any PDU session are released by the UE then the
Nsmf_PDUSession_ReleaseSMContext is used instead as currently defined.
Step 17 of the procedure invokes steps 5 onwards, without the N11 and N2
interactions, of TS 23.502 [7] clause 4.2.3.2 (UE triggered service request).
In the procedure when the SMF receives the indication that the RAT Type has
changed it uses the stored \"PDU session continuity at inter RAT mobility\"
information to determine whether to maintain the PDU session (if being handed
over) or reject the PDU session request, with the relevant cause.
#### 6.48.4.4 Determining RAT Type Change
No additional procedures are required to determine RAT type change.
The RAT type the UE is currently using is stored in the UE context so that the
AMF can determine that the RAT type has changed. The SMF also stores the
current RAT type that a PDU session is using so it can determine whether the
RAT type for the PDU session has changed.
### 6.48.5 Impacts on existing entities and interfaces
UDM:
\- The subscription data is updated to include \"PDU session continuity at
inter RAT mobility information\".
SMF:
\- Retrieval and use of \"PDU session continuity at inter RAT mobility
information\" when PDU sessions are created.
\- Handle indication of idle mode inter-RAT mobility and update PDU Session(s)
based on \"PDU session continuity at inter RAT mobility information\" or local
policy.
AMF:
\- Retrieval and separate storage of NB-IoT radio capabilities and supply only
the relevant radio capabilities depending upon the RAT type in use to RAN.
\- Determine RAT Type change based on Global RAN Node and TAIs.
\- Inform SMF about RAT Type change during the UE triggered registration
procedure.
### 6.48.6 Evaluation
This solution addresses architectural baseline and requirements of Key Issue
#12 while addressing the open issues for handling PDU sessions at idle mode
inter-RAT mobility. The solution follows the principles use by EPC to
determine the actions (maintain or disconnect, with or without reactivation
request, or left to VPLMN policy) for a PDU session being stored in the
subscription data or in the absence of subscription data local policy can be
used.
## 6.49 Solution 49: Support for RDS with infrequent small data transmission
solutions #1, 2, 3
### 6.49.1 Introduction
This solution for RDS that can be build on top of existing solutions 1, 2, 3.
Solution 4 already has support of RDS so nothing additional is needed for
Solution 4 to support RDS.
The following principles apply to this solution:
\- RDS runs between two end-points of an unstructured PDU session i.e. between
UE and UPF, or between UE and NEF.
\- Protocol for Reliable Data Service between UE and SCEF (as defined in TS
24.250 [8]) is used for RDS.
\- For a PDU Session between UE and NEF, the NEF exposes APIs to the AF/AS for
Small Data transmission. The APIs are based on the NIDD APIs which are defined
for the T8 interface in TS 29.122 [9].
\- For a PDU Session between UE and UPF, the UPF uses Point-to-Point (PtP)
tunnel N6 mechnisms (similar to Point-to-Point SGi tunnel mechnism for EPS
defined in TS 23.401 [4]).
\- RDS is enabled or disabled based on DNN or NSSAI Configuration per SLA.
\- The UE indicates its capability of supporting RDS to the network.
\- The NEF or UPF indicates its support for RDS to the UE.
### 6.49.2 Functional Description
Protocol stack diagrams for support for RDS are shown below.
{width="6.695833333333334in" height="2.2555555555555555in"}
Figure 6.49.2-1: RDS protocol between UE and NEF (over NAS-SM)
{width="6.604166666666667in" height="2.3854166666666665in"}
Figure 6.49.2-2: RDS protocol between UE and NEF (over NAS-MM)
{width="6.691666666666666in" height="2.5194444444444444in"}
Figure 6.49.2-3: RDS protocol between UE and UPF
Solution 1 requires RDS support between UE and NEF and UE and UPF as shown in
Figure 6.49.2-1 and Figure 6.49.2-3, respectively.
Solution 2 requires RDS support between UE and NEF and UE and UPF as shown in
Figure 6.49.2-2 and Figure 6.49.2-3, respectively.
Solution 3 requires RDS support UE and UPF as shown in Figure 6.49.2-3.
In addition, Solution 1 needs to be updated to have capability to have PDU
session to NEF.
PDU session to NEF can be based on using new flag \"Invoke NEF selection\" and
\"NEF ID\" associated with each DNN, NSSAI and stored as part of UE
subscription data in the UDM. Based on \"Invoke NEF selection\" flag SMF (for
Solution 1) or AMF (for Solution 2) selects the identified NEF and establishes
the PDU session to NEF.
The UE indicates its capability of supporting RDS to the network using PCO and
the SMF negotiates RDS support with the NEF or UPF. The SMF indicates network
support for RDS to the UE in the PCO. This is similar to how it is done in EPS
with the SCEF or P-GW (as described in TS 23.682 [6]).
### 6.49.3 Support of EPC interworking
In addition to the EPC Interworking principles that are described for
Solutions 1, 2, and 3, the following principles apply:
\- When the \"Invoke NEF Selection\" flag is present in the UE\'s subscription
information for the PDU Session, the identified NEF will point to an SCEF+NEF
if EPC Interworking is supported.
\- When the \"Invoke NEF Selection\" flag is not present in the UE\'s
subscription information for the PDU Session, the identified SMF will select a
PGW+UPF as the PDU Session anchor.
### 6.49.4 Procedures
Same as defined for Solution 1, 2, 3 with additional aspects specified in
clause 6.49.2 above.
### 6.49.5 Impacts on existing entities and interfaces
Support of RDS protocol (as defined in TS 24.250 [8]) by UE, NEF and UPF.
### 6.49.6 Evaluation
This solution provides support of Reliable Data Service using same design
priciples as the support of RDS in EPS and using exisiting RDS protocol as
defined in TS 24.250 [8]. RDS runs between two end-points of an unstructured
PDU session, i.e. between UE and UPF, or between UE and NEF. This solution
offers a flexible approach and can be built on top of exisiting solutions for
infrequent and frequent small data.
## 6.50 Solution 50: AF Notifications after DDN failure
### 6.50.1 Introduction
This solution addresses Key Issue 3 (High latency communication) in case of
multiple Application Functions (AFs).
When multiple AFs communicate with a UE, each of them can subscribe to the
\"Availability after DDN failure\" event. When a Downlink Data Notification
(DDN) failure occurs it should be possible for the CN to notify only a subset
of all the AFs that subscribed to the \"Availability after DDN failure\" event
(e.g., only the AF(s) that previously sent the data which trigged the DDN
failure, or only the AF(s) that want to be notified for a specific traffic
type).
### 6.50.2 Functional Description
**When an AF subscribes to the \"Availability after DDN failure\" event, an
application ID which identifies the AF is included in the message. The event
is subscribed to UDM through NEF.**
**When the AF send the downlink data, CN identifies the AF by using the
application detection function. When the UE becomes available, the CN notifies
the AF that has subscribed to the event and sent the data.**
**The function can be divided into Event Subscription and Activate Event
Report:**
\- Event Subscription:
\- AF subscribe the \"availability after DDN failure event\" together with
application ID to NEF. The NEF generate NEF Reference for the event. The NEF
Reference ID identify the correlation between the event and the AF that
subscribe the event.
\- The NEF sends the subscription to AMF via UDM including NEF Reference ID,
Event type(\"availability after DDN failure event\"). The AMF stores the
\"availability after DDN failure\" monitoring event.
\- The NEF sends the subscription to (h)SMF via UDM for existing PDU Session
or during PDU Session establishment. The subscription request includes NEF
Reference ID ,Event type(\"application detection event\") and Application ID.
The (h)SMF activates the application detection in the (h)UPF for the
application ID. The (h)UPF detects the traffic sent by AF and report to the
(h)SMF in the N4 Report message.
\- After receives N4 Report message from the (h)UPF, the (h)SMF notifies the
NEF that the traffic sent by AF has been detected. The NEF maintains the list
of AF which has subscribed the \"UE availability after DDN failure\" event and
sent the downlink data, and need to be notified after the UE becomes
available.
\- The NEF further subscribes the \"UE reachability\" event after receiving
application detection notification from (h)SMF. The AMF stores the \"UE
reachability\" event.
\- Event Report:
\- When the UE is reachable, the downlink data will be delivered to UE
successfully. In this case the AMF notifies the \"UE reachability\" event to
NEF. The NEF then removes the AF list and stop storing any new detected
Application ID into the list.
\- When the UE becomes unreachable, the AMF notifies the NEF. The NEF then
starts to store the new detected Application ID into the list.
\- When the UE is not reachable, the AMF remembers the DDN failure. When the
UE becomes reachable again, the AMF notifies the \"UE availability after DDN
failure\" to the NEF. The NEF then notifies the corresponding AF that has
subscribed the event and sent the data.
### 6.50.3 Support of EPC interworking
The NEF+SCEF subscribes the \"availability after DDN failure event\" to the
MME. After it receives notification from the MME about the \"UE availability
after DDN failure\" event, the NEF+SCEF notifies the corresponding AF that has
subscribed the event and sent the data.
The NEF+SCEF subscribes the application detection event in SMF+PGW-C via the
UDM. When the application is detected in SMF+PGW-C, the SMF+PGW-C then
notifies the NEF+SCEF so the NEF+SCEF can add the application ID in the AF
list and subscribe the \"UE reachability\" event with Idle State Indication to
the MME. After the NEF+SCEF receives notification from the MME that the UE is
reachable, the NEF+SCEF removes the AF list and stop storing any new detected
Application ID into the list. Later when the UE becomes idle state, the AMF
notifies the NEF. The NEF then starts to store the new detected Application ID
into the list.
### 6.50.4 Procedures
#### 6.50.4.1 Event Configuration
The procedure of Event Configuration is depicted in Figure 6.50.4.1-1.
Figure 6.50.4.1-1: Event Configuration - Availability Notification after DDN
Failure
1\. The AF subscribes to the \"Availability after DDN failure\" event by
invoking Nnef_EventExposure_subscribe(UE ID/Group ID, Application ID,
Availability after DDN failure, DNN/S-NSSAI/AF-Service-ID) service of the NEF.
The \"Availability after DDN failure\" element is used to identify the event
type of the subscription. UE ID can be GPSI and Group ID can be external group
ID.
2\. The NEF receives the request from the AF and invokes
Nudm_EventExposure_subscribe (UE ID/Group ID, Availability after DDN failure,
NEF ID, NEF Reference ID) towards the UDM. The NEF Reference ID is used to
identify the correlation between the event and the AF that subscribe the
event. The UDM sends Namf_EventExposure_Subscribe request(Availability after
DDN failure, NEF ID, NEF Reference ID) to AMF. The AMF responds to the
request.
3\. The NEF invokes Nudm_EventExposure_subscribe (UE ID/Group ID, Application
Detection, DDN/S-NSSAI/AF Service ID, NEF ID, NEF Reference ID) towards the
UDM. The UDM determines the SMF based on the Slice information, DNN, and/or AF
Service ID. The UDM invokes Nsmf_EventExposure_subscribe (Application
Detection, Application ID, NEF ID, NEF Reference ID) towards the (h)SMF.
From UDM to (h)SMF: Nsmf_EventExposure_Subscribe(Application Detection,
Application ID, NEF ID, NEF Reference ID).
4\. If the (h)SMF has no Packet Flow Description of the Application ID, it
retrieves the corresponding PFD from the NEF. The (h)SMF activates the
application detection function to detect the traffic of the Application ID in
the (h)UPF by using N4 Session Establishment/Modification Request.
5\. The (h)SMF acknowledges the execution of Nsmf_EventExposure_Subscribe.
The UDM acknowledges the execution of Nudm_EventExposure_Subscribe.
6\. The NEF acknowledges to AF.
7\. (h)UPF receives the downlink data sent by AF.
8\. The (h)UPF detects the application traffic and reports start of the
application by N4 Report message to (h)SMF.
9\. The (h)SMF notifies the application detection event to NEF including the
detected Application ID.
10\. The NEF receives the Application ID and puts it into an AF List. The AF
list is composed of Application IDs and indicates who shall be notified UE
availability after DDN failure event. If not subscription before, the NEF
further subscribes the UE reachability event to AMF via UDM.
#### 6.50.4.2 Notification
The procedure for notification after DDN failure is depicted in Figure
6.50.4.2-1.
Figure 6.50.4.2-1: Notification - Availability Notification after DDN Failure
1\. (v)UPF receives the downlink data sent by AF.
2\. (v)UPF sends Downlink Data Notification (DDN) message to the (v)SMF, on
arrival of the first downlink data packet for the QoS flow.
3\. The (v)SMF sends Namf_CommunicationN1N2MessageTransfer to AMF, if the
(v)SMF has not been notified that the UE is unreachable.
4\. If the UE is reachable, the AMF performs network initiated service request
procedure to bring the UE into CONNECTED mode. The AMF then notifies UE
reachability event to NEF. The NEF removes the AF list and stop storing any
new detected Application ID in the list. The procedure stops.
Later when the UE becomes unreachable, the AMF sends notification to NEF, the
NEF then starts to store the new detected Application ID in the list.
5\. If DDN fails (e.g. UE is not reachable), the AMF sends
Namf_CommunicationN1N2MessageTransfer response to (v)SMF to notify the DDN
failure.
6\. The (v)SMF sends DDN failure indication to UPF.
7\. At some later time, the UE contacts the network, e.g., to perform
registration, or as it executes a service request.
8\. The AMF sends Namf_EventExposure_Notify(UE ID) to the NEF to notify that
the UE is available after DDN failure.
9\. The NEF checks the list of AF which has subscribed the event and sent the
downlink data, and sends Nnef_EventExposure_Notify(UE ID, NEF Reference ID) to
the AF in that list to notify.
### 6.50.5 Impacts on existing entities and interfaces
NEF:
\- Receives the Application ID from the AF and then requests to subscribe the
\"Availability after DDN failure\" event in AMF, and invokes Application
detection on the application in (h)SMF.
\- Receives the application detection report from (h)SMF and requests to
subscribe \"UE reachability\" event in AMF and maintain a AF list.
\- Receives the notification on UE reachable event from AMF and then remove
the AF list and stop storing the new detected Application ID into the list.
. - Receives the notification on UE unreachable event from AMF and then start
to store the new detected Application ID into the list.
\- Receives the notification on the \"Availability after DDN failure\" event
from AMF and then notify \"Availability after DDN failure\" event to the AF
identified in the AF list.
UDM:
\- The UDM sends the subscription to \"Application Detection\" to the (h)SMF
for an existing PDU Session or during PDU Session establishment including
Application ID, NEF ID and NEF Reference ID.
\- Sends the \"Availability after DDN failure\" monitoring event subscription
to the AMF.
(h)SMF:
\- The (h)SMF receives new subscription event \"Application Detection\" from
UDM to detect the application.
\- The (h)SMF notifies the NEF that the application has been detected.
AMF:
\- When the UE becomes reachable without DDN failure, the AMF notifies the NEF
on the \"UE reachability\" event.
\- When the UE becomes reachable after DDN failure, the AMF notifies the NEF
on the \"Availability after DDN failure\" event.
### 6.50.6 Evaluation
The solution proposes the Availability after DDN failure notification
procedure in case of multiple Application Functions (AFs). The AF provides the
Application ID during the Event Configuration procedure, and the (h)SMF use
application detection function to detect the application traffic in the
(h)UPF. For PDU Session with home routed it is the home SMF to active the
application detection in the home UPF. The NEF subscribes the \"Availability
after DDN failure\" in the AMF and to notify the AF that has subscribed the
event and has sent packet data.
The solution addresses the architectural requirements for key issue 3
\"Provide the AF (i.e. SCS/AS) with UE status information (e.g. reachability
notification or the time when the UE is expected to be reachable)\".
## 6.51 Solution 51: Core Network steering via CN type selection rules
configuration/reconfiguration
### 6.51.1 Introduction
This solution covers the redirection of a C-IoT UE from 5GC to EPC and
viceversa, as per Key issue #15.
### 6.51.2 Functional Description
The proposed solution is as follows:
\- It is proposed to add a new UE configuration parameter named \"CN type
selection rules\". The CN type selection rules are PLMN specific and may be
provided in USIM (by HPLMN), or provided by the visited PLMN during
registration procedure or via UE configuration update procedure or during
registration in registration accept message.
\- CN type selection rules provided by the HPLMN:
\- The CN type selection rules that apply to the HPLMN are provided by the
HPLMN either in USIM or in ME via a NAS information element in registration
accept message or via UE configuration update. The CN type selection rules
values may be:
\- Prefer 5GC over EPC.
\- The UE shall select 5GC over EPC when 5GC is available for this PLMN.
\- The UE can still select EPC when 5GC not available.
\- Prefer EPC over 5GC.
\- The UE shall select EPC over 5GC when EPC is available for this PLMN.
\- The UE can still select 5GC when EPC not available.
Editor\'s note: How to avoid frequent CN type changes resulting from the CN
type selection rule is FFS.
\- The HPLMN can already from Rel-15 define CN type preference for VPLMNs in
the Operator Controlled PLMN Selector with Access Technology (see TS 23.122
[21]), where the Access Technology can refer to E-UTRAN (which refers to EPC)
or NG-RAN (which refers to 5GC).
\- The visited PLMN may override the HPLMN provided CN type preference in
Operator Controlled PLMN Selector with Access Technology by providing its own
PLMN specific CN type selection rule.
Editor\'s note: Whether VPLMN specific CN type selection rule always takes
precedence is FFS.
\- The visited PLMN may take into account operator policies or other
considerations when providing the PLMN specific CN type selection rules.
\- When the UE is accessing 5GC the visited PLMN may provide the PLMN specific
CN type selection rules in registration accept message and can modify them at
any time via the UE Configuration Update procedure for access and mobility
management related parameters (TS 23.502 [7] clause 4.2.4.2).
\- When the UE is accessing EPC the visited PLMN may provide the PLMN specific
CN type selection rules in attach/TAU accept message.
\- The UE behaves as follows:
\- In initial CN type selection from RM-DEREGISTERED:
\- In the absence of any CN type selection rules, the UE selects the CN type
that indicates support for Cellular IoT features. If both EPC and 5GC support
Cellular IoT features, the CN type selection is implementation dependent.
\- If the UE is performing PLMN selection the Operator Controlled PLMN
Selector with Access Technology information is used by the UE if present.
\- If the UE is configured with PLMN specific CN type selection rule by the
V-PLMN, the UE performs CN type selection based on the PLMN specific CN type
selection rules, overriding the Access Technology part of Operator Controlled
PLMN Selector with Access Technology information.
\- When the UE is RM-REGISTERED with 5GC and moves from CM-CONNECTED to CM-
IDLE:
\- If the UE has a CN type selection rule indicating \"Prefer EPC over 5GC\"
then the UE shall prioritize cells supporting EPC when performing cell
selection/reselection and shall select EPC if available in the cell the UE is
camping on.
\- If the UE has a CN type selection rule indicating \"Prefer 5GC over EPC\"
then the UE shall prioritize cells supporting 5GC when performing cell
selection/reselection.
Editor\'s note: Prioritizing CN type during cell selection/reselection needs
to be confirmed by RAN WG2.
\- When the UE is EMM-REGISTERED with EPC and moves from EMM-CONNECTED to EMM-
IDLE:
\- If the UE has a CN type selection rule indicating \"Prefer 5GC over EPC\"
then the UE shall prioritize cells supporting 5GC when performing cell
selection/reselection and shall select 5GC if available in the cell the UE is
camping on.
\- If the UE has a CN type selection rule indicating \"Prefer EPC over 5GC\"
then the UE shall prioritize cells supporting EPC when performing cell
selection/reselection.
Editor\'s note: Prioritizing CN type during cell selection/reselection needs
to be confirmed by RAN WG2.
When the network prefers the UE to select 5GC and the UE is in CM-CONNECTED
state with 5GC, the core network may prevent the RAN to redirect/handover the
UE to EPC using the Mobility Restrictions to the radio access network within
Handover Restriction List.
When the network prefers the UE to select EPC and the UE is in ECM-CONNECTED
state with EPC, the core network may prevent the RAN to redirect/handover the
UE to 5GC using the Handover Restriction List.
NOTE: CN type selection rules provided by a PLMN during registration or using
UE configuration update are assumed to be stored in the ME as long as the UE
is registered with that PLMN. This aspect is subject to review and final
decision by CT WG1.
### 6.51.3 Support of EPC interworking
Since the configuration in the UE applies in case of CN type selection, it is
only modifying the rules in the UE for a procedure (CN type selection) that is
already defined in Rel-15, and already takes into account EPC interworking.
The actual procedures of a UE moving between EPC and 5GC in CM-IDLE mode are
not modified.
### 6.51.4 Procedures
No procedures are modified. Only new \"CN type selection rules\" IE is added
to existing messages:
\- Registration accept message (5G NAS);
\- UE configuration update (5G NAS);
\- attach/TAU accept (EPC NAS).
### 6.51.5 Impacts on existing entities and interfaces
On AMF/MME:
\- New \"CN type selection rules\" IE in NAS messages;
\- Configuration for CN steering.
On UE:
\- New \"CN type selection rules\" IE in NAS messages;
\- Modification in CN selection rules based on CN type selection rules;
\- Modification in cell selection/reselection procedures based on the
currently registered CN type.
### 6.51.6 Evaluation
This solution provides the CN type selection rules to the UE either in USIM or
in NAS in attach/registration acceptance. The UE then prioritizes the cells
supporting the preferred CN type in cell selection/reselection and selects the
preferred CN type if available in the cell the UE is camping on. The solution
has an impact to the cell selection/reselection procedures that needs to be
confirmed by 3GPP RAN WG2.
## 6.52 Solution 52: Inter-UE QoS differentiation based on retrieval of UE
Context
### 6.52.1 Introduction
This solution addresses Key Issue 14: QoS Support for NB-IoT for the case of
Data over NAS. This solution is intended to be used in combination with Data
over NAS solutions (e.g., Solution 1 and Solution 30) and allows an ng-eNB to
schedule resources for RRC connection establishment messages 4 and 5, by
retrieving the NB-IoT UE QoS Index from the AMF before message 4 is sent.
### 6.52.2 Functional Description
The solution is based on the following principles.
At UE initial registration:
a) The UE indicates to the AMF its 5G-S-TMSI.
b) The AMF retrieves the newly defined NB-IoT UE QoS Index from the UDM and
stores it locally indexing it per 5G-S-TMSI.
At entering CM-CONNECTED:
a) The UE provides the 5G-S-TMSI in the _RRCConnectionRequest_ message.
b) The ng-eNB uses the combined information to retrieve the UE information
either from the AMF by means of a new N2 procedure.
c) Based on the retrieved UE information, which includes at least the NB-IoT
UE QoS Index, the ng-eNB is able to differentiate/prioritise the NB-IoT UEs
before replying with the RRCConnectionSetup message and provide an appropriate
configuration to the UE in RRCConnectionSetup.
### 6.52.3 Support of EPC interworking
There is no interworking with EPC required as the ng-eNB only retrieves
information from the CN the UE is already registered with.
### 6.52.4 Procedures
#### 6.52.4.1 Provision of UE Context to AMF
Figure 6.52.4.1-1: Provision of QoS context to AMF at UE registration
1\. During the registration procedure, the UE, based on the Preferred Network
Behaviour indication indicates it wants to send data over NAS and provides the
AMF with the 5G-S-TMSI.
2\. Steps 4-13 of the registration procedure in TS 23.502 [7] clause
4.2.2.2.2.
3\. The AMF retrieves the NB-IoT UE QoS Index from the UDM. The NB-IoT UE QoS
Index is a subscription parameter used to differentiate the QoS handling among
NB-IoT UEs.
4\. Step 15-20 of the registration procedure.
5\. The AMF locally stores the NB-IoT UE QoS Index per 5G-S-TMSI.
6,7. Completion of the registration procedure.
#### 6.52.4.2 Retrieval of UE Context from AMF and Inter-UE QoS
differentiation
The existing mechanism in EPC for retrieving QoS parameters is updated to
allow the ng-eNB to determine whether it should retrieve the UE information
from the AMF.
NOTE: As clarified in R3-151181 (and related notes of RAN WG3#88 in
R3-151324), since the MMEC for one MME node must be unique across all MME
nodes connected to the same eNB, similarly the S-TMSI is enough to select the
proper AMF.
Figure 6.52.4.2-1: UE QoS differentiation and context retrieval from the AMF
at CM-IDLE to CM-CONNECTED state transition.
1) The UE sends RRConnectionRequest message to the ng-eNB which includes the
5G-S-TMSI and CN indication for which CN the UE is registered with. The ng-eNB
uses the new CN indication to determine whether to retrieve the UE information
from EPC or 5GC.
NOTE 1: According to TS 36.331 [23], the _RRCConnectionRequest-NB_ message
already includes the 40-bit S-TMSI and has 17 spare bits. To include the full
48-bit 5G-S-TMSI, assuming the 40 bits of the S-TMSI are re-used, only 8 bits
are needed. For other RRC messages, such as the _RRCEarlyDataRequest-NB_
message for Early Data Transmission, such limitation does not apply because
they use different physical RACH resources which are larger.
2) The ng-eNB, based on configuration may send the N2 RETRIEVE UE INFORMATION
(5G-S-TMSI) message to the AMF to retrieve the NB-IoT QoS Index. The ng-eNB
may retrieve additional parameters (e.g., UE Radio Capabilities).
3) The AMF replies with the N2 UE INFORMATION TRANSFER (with at least the NB-
IoT UE QoS index) message to the ng-eNB with the UE information.
NOTE 2: The retrieval of further information from the SMF depends on the
solution for KI#13 (see Solution 15 for provision of UE Expected Behaviour to
the NG-RAN).
4) The ng-eNB uses the retrieved UE information to prioritise the UE as
appropriate and determine the configuration for the UE in the
RRCConnectionSetup.
5) The ng-eNB sends RRConnectionSetup to the UE, including configuration for
optional features the UE supports, if required.
6) The UE sends RRCConnectionSetupComplete, including the initial NAS-PDU.
7) The ng-eNB sends the initial NAS-PDU to the AMF.
### 6.52.5 Impacts on existing entities and interfaces
UE/RRC:
\- For NB-IoT, sends the whole 5G-S-TMSI to ng-eNB in RRC Message 3
\- A new N2 procedure to retrieve UE information from the AMF.
AMF:
\- At registration, retrieve from UDM and store locally the UE QoS Index.
\- A new N2 procedure to provide UE information to the ng-eNB.
UDM:
\- Addition of UE QoS Index to subscription data.
### 6.52.6 Evaluation
The solution addresses Key Issue 14 (QoS Support for NB-IoT for the case of
Data over NAS) since it allows the ng-eNB to prioritize different NB-IoT UEs
before RRC message 4 is sent, therefore allowing to improve the schedule of
resources for RRC connection establishment messages 4 and 5. Similarly to the
solution agreed for EPS CIoT Rel-14, the RAN - AMF interaction will cause a
delay in the transmission of RRC msg4, which results in a higher power
consumption in the NB-IoT UE since it has to constantly monitor the NPDCCH
until the msg4 can be decoded.
The solution does not allow to prioritize RRC Message 3 (e.g., in case of
Early Data Transmission with a single UL PDU).
Advantages:
\- Support QoS differentiation among UEs that use NAS to delivery data.
\- Support any types of data, IP, Ethernet, unstructured data.
Disadvantages:
\- Increase the size of some RRC messages to carry 5G-S-TMSI.
# 7 Evaluation
Editor\'s note: This clause will provide a general evaluation of the
solutions.
## 7.1 Key Issue 1: Support for infrequent small data transmission
The following solutions are addressing key issue 1:
\- **Solution 1** supports small data transfer inside a PDU session in NAS-SM
via AMF/SMF to UPF. To also support the NIDD API (i.e. to address the
architectural requirements to \"support API(s) for infrequent small data
transmission and capability exposure to AF\"), solution 1 relies on solution
30, which extends solution 1 by supporting non-IP data in a PDU session via
AMF/SMF/NEF and the NIDD API to AFs. Solution 1 supports early data and reuses
EPC interworking as defined in Rel-15, i.e. relies on mapping PDU sessions to
PDN connections. Solution 1 follows the same concept as EPS CP optimization.
This enables low complexity IoT devices that support both EPC and 5GC
connectivity to send small data over NAS (i.e. without having to support a
user-plane stack, AS security, etc.) regardless of the core network those
devices are connected to. Whether to send the existing SM header or a
shortened SM header with the small data is up to CT WG1 to decide.
\- **Solution 2** transfers small data inside a PDU session by means of NAS-
MM. In addition solution 2 introduces a user-plane tunnel (Nx interface)
between AMF and UPF to bypass SMF for small data transfer to the UPF. This
results in AMF impact to support a user-plane interface (Nx interface) on the
AMF and related changes to the SMF to support Nx tunnel establishment. When
the UE moves from CM-IDLE to CM-CONNECTED the Nx interface first needs to be
established before small data can be forwarded between AMF to UPF. As a result
DL data in response to UL data sent by the UE will be delayed compared to
solution 1 due to the tunnel setup signaling. No SM header is needed for
solution 2.
\- In contrast to solution 1 and 2, **solution 3** is not a generic solution
as it only supports small data transfer of non-IP data. The solution does not
establish a PDU session but establishes a Non Session Data Delivery (NSDD)
context in the SMF instead. The benefit of not establishing a PDU session is
however not obvious since NSDD context is anyhow established at the SMF.
Interworking with EPC is not supported as per the solution description (the
solution targets UEs that only support 5GC-NAS).
\- **Solution 4** relies on use of the RDS protocol (already defined for EPS)
for reliable delivery of small data unstructured PDUs. It does not require
establishment of a PDU session as the RDS header contains the routing
information for the small data transfer between UE and AF. As compared to
solution 30 it carries data over NAS-MM between UE and AMF and then from AMF
to NEF directly. For IP small data transfer, solution 4 would need to rely on
either solution 1 or 2. From a signaling perspective it is more efficient than
solution 30 but when combined with either solution 1 or 2 it would also be
required to support PDU session establishment logic for IP data transfer via
the UPF.
\- **Solution 6** proposes to send IP and non-IP small data in a DATA PDU in
RRC via SRB to the RAN, which in turn forwards the small data to a UPF. As per
the solution description, a single UPF appears to be assumed (as the UE does
not include any UPF ID or similar information together with the UL data). As a
consequence there is no support for different UPFs for different DNNs, slices
or even load-balancing reasons. While this may be addressable, the solution
has two other key drawbacks: (1) In contrast to the other infrequent small
data solutions, solution 6 requires the UE to support an additional security
assocation per PDU session and (2) the solution has RAN impact (handling of
new DATA PDU in RRC; determining the target UPF and new forwarding mechanism
for small data to/from target UPF) compared to all other solutions which are
transparent to the RAN. The latter is important to ensure simple migration to
5GC. This solution does not add any additional load for control plane entities
(AMF and SMF).
\- **Solution 40** proposes to establish a PDU session for sending UL data,
which gets released after UL data is sent and related DL data has been
received or after the expiration of the inactivity timer. As a consequence
there is no support for DL-initiated small data. The solution avoids user-
plane stack and AS security complexity. The solution avoids the PDU session
related signaling between UE and network and avoids the complexity of storing
a PDU session context in the UE. The temporary PDU session is introduced for
the small data transmission, and established in an on-demand way, which saves
PDU session resource consumption in 5GC. The core network signaling will
increase due to establishment and release of temporary PDU session. The amount
of signaling depends on how frequently the UE sends UL small data and how
quickly the network releases the PDU session based on Release Assistance
Indication information from the UE or expiration of inactivity timer (e.g.
determined by interval of data transmission). In case there is no default DNN
and S-NSSAI for the UE and the AMF, the UE needs to send the DNN and S-NSSAI
together with UL small data. The solution requires a network address
translation (NAT) function in the UPF since the UE uses a locally generated IP
address, which needs to be translated to a routable IP address.
Additional load for control plane entities (AMF and SMF) that is implied by
all solutions except solution 6 can be addressed by dynamically adding
virtualized AMF and SMF entities as needed. Control plane overload can be
addressed by solutions for KI#7.
## 7.2 Key Issue 2: Frequent small data communication
### 7.2.1 Overview
Solution 5 proposes to send MO small data together with an indication of the
target UPF and the UL-TEID to the RAN, which in turn forwards the data to that
UPF. Security is provided by a per PDU session security association between UE
and UPF, i.e. AS security is not used. For MT data a procedure similar to
paging in CM-IDLE state is used. The solution impacts both RAN and CN to
support the fast-path model; the UE is impacted due to the need to
additionally support a per PDU session security association with the UPF.
Solution 5 can be used with Early Data Transfer (EDT) and eDRX. It is also
compatible with RRC Inactive.
Solution 7 proposes two aspects:
1\. Extend RRC Inactive as specified in Rel-15 by support for early data.
2\. Re-building CM-IDLE state and related HLCom functionality in CM-CONNECTED
state with RRC Inactive to support eDRX with long sleep cycles in RRC-
Inactive.
Supporting early data for RRC-Inactive has only very limited system impact
(UE, RAN and AMF). In contrast to this, RAN and CN impact to support long
sleep cycles in RRC Inactive is significant (due to the need to make AMF, SMF
and UPF aware about the unreachability of the UE to make the CN behave as if
the UE was in CM-IDLE state while the UE is actually in CM-CONNECTED state).
Solution 19 proposes to introduce RRC Connection suspend and resume procedures
similar to User Plane CIoT EPS Optimization. The solution bypasses Service
Request procedure, based on RAN maintaining the AS context of the suspended
UE. In comparison to EPS UP optimization an additional enhancement has been
proposed: avoiding to fully resume the RRC connection if the UE sends a single
UL packet only (indicated by AS Release Assistance Indication). As the UE is
in CM-IDLE state when its RRC connection has been suspended, the solution can
be easily combined with eDRX with long sleep cycles and the related HLCom
mechanisms for CM-IDLE. The solution has limited impact to UE, RAN and CN.
Solution 29 proposes to send UL small data together with UPF CL Service
information (UCLSI) to the RAN. The RAN in turn looks up the target UPF by
performing a DNS look-up using the UCLSI and forwards the data to the UPF
using a shared N3 tunnel for UEs that are served by the same NR node. To
identity the UE and PDU session the small data belongs to within the shared
tunnel, the UCLSI is included as additional header information. For MT data
the UPF keeps track of the last known RAN node serving a UE. Until a UE
Location Freshness Timer expires, the UPF sends DL data to this last known RAN
node. If the UE is not reachable in this last known RAN node, the DL data will
be dropped, and the UE will be paged to determine its new serving RAN node.
Solution 29 can be used with EDT and eDRX. It is also compatible with RRC
Inactive.
Solution 36 proposes to leverage RRC Inactive with two enhancements for
frequent small data:
1) Enable the RAN to avoid switching the N3 tunnel to the new RAN node by
establishing a data forwarding tunnel between old and new RAN nodes.
2) Enable removing UP resources locally in the RAN, i.e. without paging the
UE, in case of CN-initiated PDU session deactivation when the UE is in RRC
Inactive.
While (1) only impacts the RAN, (2) also impacts the AMF.
Frequent Small Data Information including small data indication, Communication
Pattern, etc. is sent to RAN in order to assist the RAN decision whether to
send the UE to RRC Inactive state. UE resume request is extended to include
small data indication which the NG-RAN can use to decide upon N3 path
switching.
Solution 41 illustrates how RRC Inactive as defined in Rel-15 can be combined
with 5G UP optimization (see solution 19 above) and eDRX to efficiently
support bursty frequent small data. The interoperability between RRC Inactive
and eDRX is achieved via using short eDRX cycles in RRC Inactive. The solution
re-uses the existing procedures for the AMF to pass the NAS negotiated eDRX
value to RAN, and RAN configuring eDRX cycle and using RRC Inactive when
applicable, taking into account also the RRC Inactive Assistance Information
received from the AMF. If RAN chooses to use eDRX in RRC Inactive state, then
the RAN node is responsible for DL data buffering.
### 7.2.2 Enhancements of existing procedures
RRC Inactive, eDRX, and EDT are already existing signalling optimisations, and
even higher optimisation can be achieved by combining them. RRC Inactive can
be enhanced further with EDT and eDRX. The feasibility of avoiding N3 tunnel
switching by data forwarding would still need to be verified with RAN WG3.
RRC Inactive, specifically when combined with the foreseen enhancements is
already a significant improvement over the EPS capabilities, and consequently
the 5G User Plane improvements need to be weighed against RRC Inactive.
However, to efficiently address bursty frequent small data scenarios, i.e.
scenarios where frequent small data occurs in bursts with significantly long
silence periods in-between the bursts, solutions are required to enable UE
power saving during those silence periods. Since long eDRX cycles cannot be
supported efficiently in CM-CONNECTED with RRC Inactive the UE should be moved
to CM-IDLE in order to leverage long eDRX sleep cycles.
To reduce over-the-air signaling when the UE sends small data from CM-IDLE,
the subsequent one-shot small data or burst of small data seems to need some
User Plane optimisation among the candidate solutions documented in clause
7.2.1.
Solution 41 in turn combines 5G UP optimization with RRC Inactive to jointly
ensure that bursty frequent small data can be sent with minimal signaling
overhead while extended DRX sleep cycles ranging from a few seconds to hours
can be supported without causing significant system impacts.
### 7.2.3 Optimised UP data solutions
Solutions 5 and 29 can be used together with RRC Inactive, but since all these
are optimising the RRC Connection establishment, some of the radio interface
benefits of the proposed UP solutions are already available via RRC Inactive.
Consequently, RRC Inactive and EDT can offer comparable optimisations at the
radio interface.
Solutions 5 and 29 can be used with EDT and eDRX.
The proposed UP optimisations are characterized by the following aspects:
\- Shared N3 tunnel.
\- User Plane data does not require CN overload protection that is needed for
Control Plane data.
\- User plane QoS and HLCom concepts can be re-used.
These capabilities need to be weighed against the additional complexity caused
by the solutions.
### 7.2.4 UPF-NEF interface
Solution 35 introduces new interface between UPF and NEF to support
communication via NEF (T8 NIDD API) in addtion to communication via UPF.
Without this interface, T8 NIDD API cannot be provided over user plane.
## 7.3 Key Issue 3: High latency communication
For key issue 3 - High latency communication, the following two categories of
solutions are proposed:
\- Extended buffering of downlink data in the network (solution 11, solution
24 and solution 25).
\- Notification towards the AF(s) (solution 10, Solution 24, Solution 25 and
solution 39).
For Extended buffering of Downlink data in the network:
Solution 10 proposes extended data buffering in UPF but use the term/concept
of \"UE availability after DDN failure\" for communication between
UPF/SMF/AMF.
Solution 11 proposes to handle the High latency communication by extended
buffering of DL data in the SMF. The SMF determines whether DL data shall be
buffered based on input from the AMF. The AMF indicates to the SMF that the UE
is unreachable, a Maximum estimated wait time for the UE to become reachable
and, optionally, a DL Buffering Suggested Packet Count. The buffered DL data
can be sent from the UPF/NEF to the RAN, as soon as the UE becomes reachable.
The solutions has no impacts on UPF or NEF. Buffering in SMF meets the
Architectural Requirement of key issue 3: \"Send DL data to UEs at the
earliest possible opportunity when the UEs are applying power saving
functions\". For UEs that remain in idle mode for a long time the associated
UPF may change while the associated SMF will not. Since this solution is based
on buffering in the SMF, it is more appropriate for this case because it would
not require forwarding any buffered data among UPFs in case of UPF change.
Solution 24 proposes to handle the High latency communication by extended
buffering of downlink data in the UPF or SMF, and controlled by the AMF/SMF.
The AMF asks the SMF to buffer downlink data, and provide buffering
information to SMF. The SMF forward buffering information to UPF, and may
decide the number of packets to buffer.
Solution 25 proposes to buffer the DL data in UPF (for data via N6) or in the
NEF (for data via APIs) based on the decision of the SMF which determines
whether Extended Buffering applies for the downlink packet or not. The AMF
indicates to the SMF that the UE is unreachable, a Maximum estimated wait time
for the UE to become reachable and optionally a DL Buffering Suggested Packet
Count. The SMF indicates to the UPF/NEF to buffer DL data with Extended
Buffering time. The buffered DL data can be sent from the UPF/NEF to RAN as
soon as the UE becomes reachable. Contrary to Solution 11, since this solution
is based on UPF buffering, it seems more appropriate for UEs in idle mode for
short periods of time because the associated UPF will most likely not change.
For solutions for notification towards the AF(s):
\- Notification towards a single AF:
\- Solution 10 proposes two notification procedures for Mobile Terminated
Communication, UE reachability notification and UE availability notification
procedure after DDN failure and has the same principles of solution 24 and 25.
\- Solution 24 proposes the notification procedure from the AMF triggered by
UE Reachability event or Availability after DDN failure event. The
notification procedure for the UE in CM-CONNECTED with RRC_INACTIVE state is
also proposed and this aspect is not in scope for event notifications towards
the SCS/AS. The triggers to generate the events within the network depend upon
solutions to other key issues and are not in scope for notification procedures
aspect of this key issue. The proposed notification procedure is based on the
same principles as the notification procedure for HLCOM in EPC. In addition,
this solution proposes a procedure to notify internal 5GCN NFs of UE
availability after MT CP signalling.
\- Solution 25 proposes two notification procedures towards the AF: one from
the AMF for notification of UE reachability and Availability after DDN failure
(with reference to solution 24), and a second one from the SMF for data
delivery status report to enhance the \"extended data buffering\" method. For
MT control plane signaling handling in this solution, solution 24 is
referenced.
\- Notification of availability after DDN failure towards multiple AFs:
\- Solution 39 is based on Solution 25 and proposes the Availability after DDN
failure notification procedure in case of multiple Application Functions
(AFs). The AF provides the Traffic Descriptor information during the Event
Configuration procedure, and the Traffic Descriptor information can be used by
the network to determine the corresponding AF at notification. The
Availability after DDN failure event is sent to the AMF by the UDM, and the
Availability after DDN failure event including Traffic Descriptor information
is sent to the SMF by the UDM. After receiving the DDN message for the AF
service, the SMF sends the message to the AMF including the NEF Reference ID.
Once the event has happened, the AMF notifies the corresponding AF(s).
\- Solution 50 proposes the Availability after DDN failure notification
procedure in case of multiple Application Functions (AFs). The AF provides the
application ID during the Event configuration procedure, and the Application
ID is used by the network to determine the corresponding AF at notification.
The \"Application detection event\" is sent to the SMF by the UDM, and the
\"Availability after DDN failure event\" is sent to the AMF by the UDM. The
SMF activates the \"Application detection event\" based on the application ID
reported by the UPF. Once the event has happened, the SMF notifies the NEF the
traffic sent by AF has been detected. Then the NEF subscribes the UE
reachability event. The NEF notifies the corresponding AF(s) based on the
SMF\'s notification and AMF\'s notification.
\- The solutions above address the architectural requirements of key issue 3
to \"Provide the AF (i.e. SCS/AS) with UE status information (e.g.
reachability notification or the time when the UE is expected to be
reachable)\". The triggers to generate the events were not considered since
they depend upon solutions to other key issues.
Based on the evaluation above, it can be seen that all solutions support UE
reachability notification and Availability after DDN failure notification from
AMF in CM-IDLE mode. Solution 25 also covers the delivery of an SMF based
buffering status report for the extended buffering approach. Solution 24
covers in addition the handling of these notifications in RRC inactive state
and CM-IDLE with suspend.
NOTE: Due to the limited duration of eDRX cycles for RRC-INACTIVE, it is
assumed that there is no need for interaction between RRC-INACTIVE and HLCOM.
## 7.4 Key Issue 4: Power Saving Functions
Editor\'s note: This clause will capture the evaluation for key issue 4.
For Key Issue 4, Track 1 (\"extended DRX support in CM-IDLE\"), Solution 22
has been proposed and enables eDRX in CM-IDLE state equivalent to eDRX support
in EPS.
For Key Issue 4, Track 1 (\"extended DRX support in RRC-INACTIVE/ CM-
CONNECTED\"), Solutions 38 and 41 have been proposed.
The key idea of Solution 38, Alternative 3 (and the related Solution 41) is to
enable UE power saving as follows:
\- For short silence periods the ng-eNB can configure extended DRX in RRC-
INACTIVE/CM-CONNECTED with sleep cycles up to the duration of the NAS (and
SMS) retransmission timers. Limiting the sleep cycles to the NAS (and SMS)
retransmission timers enables the core network to consider the UE reachable
while the UE is in RRC-INACTIVE/CM-CONNECTED state with extended DRX.
\- For longer silence periods, CM-IDLE state can be used along with longer
extended DRX sleep cycles. As the UE is in CM-IDLE , the buffering and
notification mechanisms that need to be specified for CM-IDLE anyhow can be
re-used. (Note that this approach can be combined with different UP-based
small data solutions, which are discussed as part of key issue 2).
The benefit of this approach is that extended DRX sleep cycles ranging from a
few seconds to hours can be supported without additional system impacts.
In contrast to this, Solution 38 Alternative 1 aims at supporting very long
sleep cycles in RRC-INACTIVE state, which leads to system impact by re-
building CM-IDLE HLcom functionality in CM-CONNECTED state. This stems from
the need to make the AMF, SMF and UPF aware about the unreachability of the UE
to be able to behave as if the UE was in CM-IDLE state while the UE is
actually in CM-CONNECTED state.
For Key Issue 4 Track 2, Solutions 8, 9 and 23 are proposed.
Solution 8 proposes an enhancement for mobile terminated data/signalling by
introducing a minimum time to keep UE in RRC_CONNECTED (the Connected time).
The solution can save power and allows a faster DL data delivery.
Solution 9 proposed the enhancement for MICO mode with Active Time. The
Solution is based on the same principle as Power Saving Mode in EPS, and can
save power for the case when the wait for subsequent data is long (e.g., if an
external AF has a long response time).
Solution 23 proposed to determining MICO mode and periodic registration timer
value for the UE, taking into account communication pattern information, and
providing a _\"do not reset the timer for Periodic Registration\"_ indication
to the UE and saves UE power according to the expected and desired UE and
application behaviour.
The above solutions jointly address all Architectural Requirements for Key
Issue#4 (Power Saving Function) - Track 2.
## 7.5 Key Issue 5: UE TX Power Saving Functions
The solutions #32, #33, #34, #46 are understood to display some gains in some
scenarios, some degradation in some other scenarios; no systematic gain is
guaranteed.
## 7.6 Key Issue 6: Management of Enhanced Coverage
Editor\'s note: This clause will capture the evaluation for key issue 6.
## 7.7 Key Issue 7: Overload Control for small data
Key Issue 7 has only 1 solution: Solution 27.
Solution 27 introduces Small Data Rate Control, Service Gap Control, AMF/SMF
Overload Control and Control plane data back-off timer. The solution is based
on the same principles as the Overload Control functions of EPS, and addresses
all the Architectural requirements of Key Issue 7.
## 7.8 Key Issue 8: Support of the Reliable Data Service
For Key Issue 8 following two solutions are specified:
\- Solution 4 (Reliable data Service Support): This solution target both Key
Issue 8 and Key Issue 1. Solution 4 has RDS support over NAS-MM layer.
\- Solution 49 (Support for RDS with infrequent small data transmission
solutions #1, 2, 3): This solution builds on top of other small data solutions
i.e. solution #1, #2, and #3.
In solution 4 support of RDS is similar to support of RDS over solution 2 (as
described in solution 49) i.e. over NS-MM. Solution 49 provides a generic
meachanism for RDS support and is based on RDS support design priciples in
EPS.
## 7.9 Key Issue 9: Support of common north-bound APIs for EPC-5GC
Interworking
Key Issue 9 has 2 solutions.
Solution 13 introduces the combined SCEF+NEF node. By using a combined node,
the solution shows how the API termination point(s) associated with the UE can
remain consistent even when the UE switches between EPC and 5GC. Since the
solution continues the EPC principle that the exposure function(s) related to
a UE will not change, there is no need to provide a way for the AF to detect
API termination point changes and there is no need for exposure functions to
exchange UE context. Solution 1 also points out that if the level of support
of a given service changes (e.g. due to the UE\'s movement between EPC and
5GC), the SCEF+NEF will notify the SCS/AS.
Solution 14 builds on solution 13 by showing, in more detail, if the level of
support of a given service changes (e.g. due to the UE\'s movement between EPC
and 5GC), the SCEF+NEF notifies the SCS/AS.
## 7.10 Key Issue 10: Network Parameter Configuration API via NEF
### 7.10.1 Overview
Solution 15 addresses Key Issue 10. It aligns with the architectural baseline
of the key issue in that it describes how an NEF API can be used to provide
the network with Maximum Latency, Maximum Response Time, and Suggested Number
of Downlink Packets and add the data to the UE\'s subscription information in
the UDM/UDR.
Solution 15 states that \"_It is a subject of local policy in the UDM/UDR
which external parameters are classified as AMF- Associated, SMF- Associated,
and PCF- Associated parameters_ \" This flexibility, in terms of how
parameters are classified, aligns the solution with solutions that have been
selected for other Key Issues.
### 7.10.2 Evaluation Relative to Key Issue 3 (High Latency Communication)
Key Issue 3 (High Latency Communication) concluded that Solution 11 (DL data
buffered in the SMF) and Solution 25 (DL data buffered in UPF/NEF) are used as
the basis for normative work to address the extended buffering for high
latency communication.
In Solution 11, the AMF requests that the SMF buffer data and indicates how
long the UE is expected to be sleeping. Thus, Maximum Response Time, and
Maximum Latency may be considered an AMF- Associated parameters when Solutions
11 is used. The solution also uses the Suggested Number of Downlink Packets,
however how the AMF or SMF determines the Suggested Number of Downlink Packets
is left for the normative phase.
In Solution 25, the AMF requests that the SMF configure the UPF to buffer data
and indicates how long the UE is expected to be sleeping. Thus, Maximum
Response Time, and Maximum Latency may also be considered an AMF- Associated
parameters when Solutions 25 is used. The solution also uses the Suggested
Number of Downlink Packets, however how the AMF or SMF determines the
Suggested Number of Downlink Packets is left for the normative phase.
### 7.10.3 Evaluation Relative to Key Issue 4 (Power Savings Functions)
Key Issue 4 (Power Savings Functions) concluded that Solutions 22, 38
(Alternative 3), 8, 9, and 23 are used as the basis for normative work.
Solution 22 states that \"_Extended idle mode DRX cycle length value needs to
be added in the subscription data from the UDM using the same principles as in
EPS_ \". In both Solution 22 and Solution 38, alternative 3, the AMF provides
the UE\'s accepted eDRX parameters. Solutions 8 and 9 describe that the AMF
considers Maximum Response Time and Maximum Latency when configuring the UE\'s
MICO mode. Thus, Maximum Response Timer and Maximum Latency may be considered
AMF- Associated parameters.
## 7.11 Key Issue 11: Monitoring
Solution 37 addresses the architectural requirements for the Key Issue #11 -
\"Monitoring\". Solution 37 describes how events may be monitored via the AMF,
UDM, and PCF. It can be concluded that, Monitoring via the PCF is not required
since is no scenario identified for Monitoring via the PCF in 5GC.
In EPC there are two 2 ways of Monitoring Location and Communication Failure;
one via the MME and one via the PCRF. TS 23.682 [6] does not specify why there
are 2 methods or when each method should be used. However, one advantage of
monitoring via the PCRF in EPC is that it can be used to monitor Location and
Communication Failure when the UE accesses the network via WLAN. Since the MME
is not involved in a WLAN access, monitoring via the MME is not possible.
However, in 5GC, monitoring via the AMF is sufficient since the AMF is
involved in when the UE accesses the network via WLAN (via the N3IWF).
## 7.12 Key Issue 12: Inter-RAT mobility support to/from NB-IoT
Solution 48 addresses the architectural baseline and requirements of Key Issue
#12 by supporting separate radio capability handling for NB-IoT and by
handling PDU sessions at idle mode inter-RAT mobility following the principles
used by EPC, i.e. to determine the actions (maintain or disconnect, with or
without reactivation request, or left to VPLMN policy) for a PDU session being
stored in the subscription data or in the absence of subscription data based
on local policy.
## 7.13 Key Issue 13: Support for Expected UE Behaviour
The combination of Solution 15 and Solution 26 describes in detail how and
which parameters are to be provided to AMF and SMF to allow the 5GC to operate
as effectively as EPC for devices with communication patterns.
The parameters identified by Solution 26 are also provided by the 5GC to RAN,
similarly to EPS, to support NB-IoT UE differentiation, appropriately
configure the Uu radio interface, minimize the UE state transitions and
achieve optimum network behaviour.
\- For PDU Session using data over NAS, Solution 28 describes how SMF sends
the \'SMF assisted NG-RAN information\' to the AMF during PDU Session
establishment. The AMF transfers both the \'AMF assisted NG-RAN information\'
and the \'SMF assisted NG-RAN information\' to the NG-RAN within the UE
context.
\- For PDU Session using data over UP, Solution 28 describes how the SMF sends
\'SMF assisted NG-RAN information\' within the N2 SM information.
## 7.14 Key Issue 14: QoS Support for NB-IoT
For Key Issue #14 four solutions categorized into two groups are captured in
this TR:
\- Solutions for Inter-UE QoS differentiation:
\- Solution 16 is based on the UDM provisioning the AMF and the UE of a QoS
Index which, at service request, is indicated by the UE to the ng-eNB and used
by the ng-eNB to prioritize the UE before RRC Message 4 is sent. The AMF later
polices the usage of such QoS Index.
\- In Solution 52 at registration the AMF retrieves from the UDM the NB-IoT
QoS Index associated to that UE, it stores it locally and associates it to the
5G-S-TMSI indicated by the UE in the registration request. Later at service
request, the ng-eNB, if not stored locally, can retrieve from the AMF the NB-
IoT QoS Index associated to the indicated 5G-S-TMSI and, based on that, it
prioritizes the UE before sending RRC Message 4. Such additional roundtrip may
lead to some extra delay, but it allows to retrieve other information such as
the UE Radio Capabilities.
\- Both solutions allow to apply Inter-QoS differentiation before the ng-eNB
sends RRC Message 4.
\- Solutions for Intra-UE QoS differentiation:
\- Solution 17 supports QoS differentiation among QoS flows of the same
Unstructured PDU Session. The SMF sends QoS Rules to the UE without packet
filters for Unstructured PDU Sessions. The UE uses its own logic to classify
PDUs into QoS Flows in the UL. The SMF sends the N6 tunnel headers and mapping
between N6 tunnel header and QFI of N3 or N9 tunnel for QoS Flows of
Unstructured PDU Session to the UPF. The UPF classifies DL PDUs into N3 or N9
QoS flows using existing mechanism that filters DL PDUs based on N6 tunnel
header.
\- Solution 18 supports QoS differentiation among QoS flows of the same
Unstructured PDU Session. A new packet filtering, Field Position Based (FPB)
packet filter, is to be standardized. The SMF sends FPB packet filters to the
UE and UPF. The UE and UPF need to support the new FPB packet filters for
classifying unstructured PDUs into UL and DL QoS Flows, respectively.
## 7.15 Key Issue 15: Core Network selection for Cellular IoT
The solutions for KI#15 either address the architectural requirements for:
\- core network type selection at UE and core network node selection at RAN,
AMF and MME, or
\- redirection between CN types, e.g. for operator policy or load conditions,
architectural requirements.
The following solutions address the core network type selection at UE and core
network node selection architectural requirements:
\- Solution 44. This solution uses standardised S-NSSAI(s) broadcast in system
information that indicate sets of 5G CIoT features supported by the network.
The solution requires the S-NSSAI(s) broadcast to be standardised and which
feature(s) each standardised S-NSSAI represents. The UE provides the S-NSSAI
for the feature(s) it wishes to use when establishing a connection.
\- Solution 45. This solution uses an indication for each 5G CIoT
optimisations, relevant for CN selection, broadcast in system information and
the UE provides which 5G CIoT optimisations it prefers when establishing a
connection in RAN and when performing registration, similar to the existing
mechanism used in EPC.
Both solutions can fulfil the requirements for Key Issue #15. However,
solution #45 has following advantages. Solution 45 is based on similar
mechanism used in EPC and therefore enables better interworking logic with EPC
system. Solution 44 may lead to complex logic of mapping CIoT optimizations in
EPC with standardized S-NSSAI values. It is also to be noted that low
complexity CIoT devices may support single slice and therefore may not be pre-
configured with any S-NSSAI values. In addition given the size of S-NSSAI is
32 bits long, it would be not efficient to broadcast standardized S-NSSAI in
system information as compared to only few bits required for Solution 45.
The following solutions address architectural requirements for redirection
between CN types:
\- Solution 42. This solution uses a NAS level indication in
registration/attach rejection to indicate to the UE that the N1/S1 mode needs
to be disabled. The UE then disables the N1/S1 mode and performs an
attach/registration to the target CN type. The solution uses existing
procedures.
NOTE: Whether a new cause value needs to be defined for a redirection, is up
to Stage 3.
\- Solution 43. This solution uses an RRC level indication in RRC connection
release after the registration/attach procedure to indicate to the UE that the
target CN type needs to be selected. Such procedure exists for 5GS, but a
similar procedure for EPS would need to be specified. Handovers and idle-mode
mobility to the old CN type are prevented using existing procedures. The
solution is not applicable for NB-IoT UE. Idle-mode mobility to the old CN
type cannot be prevented if the operator uses the same RAT type(s) and
frequencies in both EPS and 5GS.
\- Solution 51. This solution provides the CN type selection rules to the UE
either in USIM or in NAS in attach/registration acceptance. The UE then
prioritizes the cells supporting the preferred CN type in cell
selection/reselection and selects the preferred CN type if available in the
cell the UE is camping on. The solution has an impact to the cell
selection/reselection procedures that needs to be confirmed by 3GPP RAN WG2.
## 7.16 Key Issue 16: Support of Group communication and messaging
Group Message Delivery service can be supported by unicast MT NIDD between NEF
and UE, with group based NIDD API used between AF(SCS/AS) and NEF.
Several solutions to Key issue#1 and Key Issue #2 supports unicast MT NIDD.
For example - Solution 30 supports MT NIDD delivery over control plane and
solution 35 supports unicast MT NIDD over user plane. For evaluation of
unicast MT NIDD solutions please refer to clause 7.1 and 7.2.
Solution 30 also supports NIDD Configuration for group basis, which is
essential to support Group Message Delivery service provided by NIDD API
equivalent to T8 group message delivery API.
## 7.17 Key Issue 17: MSISDN-less MO SMS
No new solution is needed for Key Issue 17 as the agreed architectural
baseline for this key issue provides sufficient details on a solution to start
the normative work.
# 8 Conclusions
Editor\'s note: This clause will capture conclusions from the study.
## 8.1 Key Issue 1: Support for infrequent small data transmission
Solution 1 and solution 30 are recommended for normative work to support
infrequent small data transmission via N6 and NIDD API.
## 8.2 Key Issue 2: Frequent small data communication
For Key Issue 2, it is recommended to use Solution 19 as the basis for
normative work.
NOTE: Solution 19 can also be used for infrequent small data scenarios.
## 8.3 Key Issue 3: High latency communication
For Key Issue 3, it is concluded that:
\- Solution 11 (DL data buffered in the SMF) and Solution 25 (DL data buffered
in UPF/NEF) are used as the basis for normative work to address the extended
buffering for high latency communication.
\- Solution 25 is used as the basis for normative work to address the
notification towards the AF for high latency communication.
NOTE 1: For Solution 11 and 25, whether the AMF or SMF determines the DL
Buffering Suggested Packet Count will be addressed during the normative phase.
NOTE 2: For Solution 11, the details of how buffered data is forwarded in the
interworking case will be addressed during the normative phase.
\- To address the availability after DDN failure notification for the case of
multiple AFs, Solution 39 is used as the basis for normative work for the
event configuration.
NOTE 3: How to report the detection of the data from the AF will be addressed
during the normative phase.
## 8.4 Key Issue 4: Power Saving Functions
For key issue 4, track 1, it is recommended that solution 22 is used as the
basis for normative work to support extended DRX for UEs in CM-IDLE state.
For Key Issue 4, Track 1, it is recommended that Solution 38 Alternative 3 is
used as the basis for normative work to support extended DRX for UEs in RRC-
INACTIVE/CM-CONNECTED state. As eDRX sleep cycles in RRC-INACTIVE are
recommended to be supported up to the NAS (and SMS) retransmission timers, the
core network considers the UE reachable while the UE is in RRC-INACTIVE/CM-
CONNECTED state with extended DRX. This implies that from the perspective of
this key issue there is no need to support specific high latency communication
functionality for RRC-INACTIVE/CM-CONNECTED with extended DRX.
NOTE: The maximum value for the eDRX cycle that can be supported in RRC-
INACTIVE/CM-CONNECTED taking into account the NAS (and SMS) retransmission
timers will be determined by CT groups. How the RAN learns whether a UE
supports eDRX in RRC-INACTIVE will be determined as part of the normative
phase.
For Key Issue 4, Track 2, it is concluded that one solution is not sufficient
to address the architectural requirement due to different application
scenarios. It is therefore recommended that Solution 8, Solution 9 and
Solution 23 are used as the basis for normative work to address UE power
saving in different application scenarios.
## 8.5 Key Issue 5: UE TX Power Saving Functions
For Key Issue 5 \"UE TX Power Saving Functions\" it is recommended that no
solution be specified addressing MT data reception and MO data transmission.
## 8.6 Key Issue 6: Management of Enhanced Coverage
For Key Issue #6 (Management of Enhanced Coverage), it is recommended to use
Solution #12: \"Solution for Management of Enhanced Coverage for 5GC\" for
normative work in the Rel-16.
## 8.7 Key Issue 7: Overload Control for small data
Solution 27 includes configuring the UE with low access priority and
signalling it over N1 and it is concluded this is not required. Small Data
Rate Control, Service Gap Control, AMF/SMF Overload Control and Control plane
data back-off timer from Solution 27 are required.
For Key Issue #7 (Overload Control for small data), it is recommended to use
Small Data Rate Control, Service Gap Control, AMF/SMF Overload Control and
Control plane data back-off timer from Solution #27: \"Reuse of EPS Overload
Control Mechanisms\" as the basis for normative work.
## 8.8 Key Issue 8: Support of the Reliable Data Service
For Key Issue 8 (Support of the Reliable Data Service) it is proposed to use
Solution 49 as the basis for normative work.
## 8.9 Key Issue 9: Support of common north-bound APIs for EPC-5GC
Interworking
For the Key Issue 9 \" Support of common north-bound APIs for EPC-5GC
Interworking\", it is concluded that, when a UE is capable of switching
between EPC and 5GC, it shall only be associated with combined SCEF+NEF
node(s) for Service Capability Exposure. It is recommended that the principles
of Solution 13 be used for normative work.
It is recommended that the principles of Solution 14 be used for normative
work when specifying how, if availability and expected the level of support of
a given service changes (e.g. due to the UE\'s movement between EPC and 5GC),
the SCEF+NEF notifies the SCS/AS of the change and how the SCS/AS queries the
SCEF+NEF for the availability and expected level of support of a service.
NOTE: The north-bound APIs which can be supported by an EPC or 5GC network are
discovered by the SCEF+NEF node via the CAPIF function and/or via local
configuration of the SCEF+NEF node. Different sets of APIs can be supported by
the two network types.
## 8.10 Key Issue 10: Network Parameter Configuration API via NEF
For Key Issue #10 (Network Parameter Configuration API via NEF), it is
recommended to use Solution #15: External parameter provisioning in the 5GC as
the basis of normative work in Rel-16. Maximum Response Timer and Maximum
Latency will be considered AMF- Associated parameters.
NOTE: Consistent with the Key Issue 3 conclusions, whether Suggested Number of
Downlink Packets is considered an AMF-, SMF-, or PCF- Associated parameter
will be addressed during the normative phase.
## 8.11 Key Issue 11: Monitoring
For Key Issue #11 (Monitoring), it is recommended to use Solution #37:
Monitoring as the basis of normative work in Rel-16. Monitoring events at PCF
in solution #37 will not be considered for Release -16 normative work.
NOTE: For interworking between EPC and 5GC, Monitoring Location and
Communication Failure is supported via AMF and MME.
## 8.12 Key Issue 12: Inter-RAT mobility support to/from NB-IoT
It is recommended to select solution 48 as the basis for normative work.
## 8.13 Key Issue 13: Support for Expected UE Behaviour
For Key Issue 13, it is concluded that:
\- Solution 15 and Solution 26 are used as the basis for normative work to
address how and which parameters are provided to the CN.
\- For the provision of the parameters identified by Solution 26 to the NG-
RAN, Solution 28 is used as the basis for normative work.
NOTE: The protocol details of the signalling towards NG-RAN are left for
normative phase, in cooperation with RAN WGs.
## 8.14 Key Issue 14: QoS Support for NB-IoT
For inter-UE QoS differentiation for Data over NAS, Solution 52 is selected as
the basis for the normative phase.
NOTE 1: Whether the differentiation is based on the NB-IoT UE QoS Index or on
existing parameters is to be decided during the normative phase.
For intra-UE QoS differentiation no solution is selected as the basis for the
normative phase.
## 8.15 Key Issue 15: Core Network selection for Cellular IoT
For the architectural requirement on CN Type Selection for CIoT and discovery
of 5G CIoT feature(s), it is recommended to use Solution 45 as the basis for
the normative work.
NOTE: The 5GS CIoT feature(s) to be included in RAN information broadcast, and
indicated by the UE in the RRC and NAS signalling will be defined as part of
the normative work.
For the architectural requirement on CN redirection for CIoT UEs, it is
recommended to use Solution 42 as the basis for the normative work.
## 8.16 Key Issue 16: Support of Group communication and messaging
For Group Message Delivery via unicast MT NIDD, NEF shall provide API to the
AF (i.e. SCS/AS) equivalent to T8 group message delivery API, also NEF shall
support unicast MT NIDD to the UE.
## 8.17 Key Issue 17: MSISDN-less MO SMS
The agreed Key Issue 17 architectural baseline will be used as the basis of
normative work.
#